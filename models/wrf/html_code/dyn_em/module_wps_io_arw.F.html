<HTML> <BODY BGCOLOR=#ddeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_WPS_IO_ARW'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#MODULE_WPS_IO_ARW' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>MODULE </font><font color=#cc0000>module_wps_io_arw</font> <A href='../../call_to/MODULE_WPS_IO_ARW.html' TARGET='index'>1</A><a name='3'>
<a name='4'>
   USE <A href='../../html_code/share/module_optional_input.F.html#MODULE_OPTIONAL_INPUT'>module_optional_input</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#module_wps_io_arw.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_OPTIONAL_INPUT_1"><a name='5'>
<a name='6'>
   IMPLICIT NONE<a name='7'>
<font color=#447700>!! FROM MODULE_KINDS<a name='8'></font>
<a name='9'>
<font color=#447700>!   The numerical data types defined in this module are:<a name='10'></font>
<font color=#447700>!      i_byte    - specification kind for byte (1-byte) integer variable<a name='11'></font>
<font color=#447700>!      i_short   - specification kind for short (2-byte) integer variable<a name='12'></font>
<font color=#447700>!      i_long    - specification kind for long (4-byte) integer variable<a name='13'></font>
<font color=#447700>!      i_llong   - specification kind for double long (8-byte) integer variable<a name='14'></font>
<font color=#447700>!      r_single  - specification kind for single precision (4-byte) real variable<a name='15'></font>
<font color=#447700>!      r_double  - specification kind for double precision (8-byte) real variable<a name='16'></font>
<font color=#447700>!      r_quad    - specification kind for quad precision (16-byte) real variable<a name='17'></font>
<font color=#447700>!<a name='18'></font>
<font color=#447700>!      i_kind    - generic specification kind for default integer<a name='19'></font>
<font color=#447700>!      r_kind    - generic specification kind for default floating point<a name='20'></font>
<font color=#447700>!<a name='21'></font>
<font color=#447700>!<a name='22'></font>
<font color=#447700>! Integer type definitions below<a name='23'></font>
<a name='24'>
<font color=#447700>! Integer types<a name='25'></font>
  integer, parameter, public  :: i_byte  = selected_int_kind(1)      <font color=#447700>! byte  integer<a name='26'></font>
  integer, parameter, public  :: i_short = selected_int_kind(4)      <font color=#447700>! short integer<a name='27'></font>
<font color=#447700>! integer, parameter, public  :: i_long  = selected_int_kind(8)      ! long  integer<a name='28'></font>
  integer, parameter, public  :: i_long  = kind(1)                   <font color=#447700>! long  integer<a name='29'></font>
  integer, parameter, private :: llong_t = selected_int_kind(16)     <font color=#447700>! llong integer<a name='30'></font>
  integer, parameter, public  :: i_llong = max( llong_t, i_long )<a name='31'>
<a name='32'>
<font color=#447700>! Expected 8-bit byte sizes of the integer kinds<a name='33'></font>
  integer, parameter, public :: num_bytes_for_i_byte  = 1<a name='34'>
  integer, parameter, public :: num_bytes_for_i_short = 2<a name='35'>
  integer, parameter, public :: num_bytes_for_i_long  = 4<a name='36'>
  integer, parameter, public :: num_bytes_for_i_llong = 8<a name='37'>
<a name='38'>
<font color=#447700>! Define arrays for default definition<a name='39'></font>
  integer, parameter, private :: num_i_kinds = 4<a name='40'>
  integer, parameter, dimension( num_i_kinds ), private :: integer_types = (/ &amp;<a name='41'>
       i_byte, i_short, i_long,  i_llong  /) <a name='42'>
  integer, parameter, dimension( num_i_kinds ), private :: integer_byte_sizes = (/ &amp;<a name='43'>
       num_bytes_for_i_byte, num_bytes_for_i_short, &amp;<a name='44'>
       num_bytes_for_i_long, num_bytes_for_i_llong  /)<a name='45'>
<a name='46'>
<font color=#447700>! Default values<a name='47'></font>
<font color=#447700>! **** CHANGE THE FOLLOWING TO CHANGE THE DEFAULT INTEGER TYPE KIND ***<a name='48'></font>
  integer, parameter, private :: default_integer = 2  <font color=#447700>! 1=byte, <a name='49'></font>
                                                      <font color=#447700>! 2=short, <a name='50'></font>
                                                      <font color=#447700>! 3=long, <a name='51'></font>
                                                      <font color=#447700>! 4=llong<a name='52'></font>
  integer, parameter, public  :: i_kind = integer_types( default_integer )<a name='53'>
  integer, parameter, public  :: num_bytes_for_i_kind = &amp;<a name='54'>
       integer_byte_sizes( default_integer )<a name='55'>
<a name='56'>
<a name='57'>
<font color=#447700>! Real definitions below<a name='58'></font>
<a name='59'>
<font color=#447700>! Real types<a name='60'></font>
  integer, parameter, public  :: r_single = selected_real_kind(6)  <font color=#447700>! single precision<a name='61'></font>
  integer, parameter, public  :: r_double = selected_real_kind(15) <font color=#447700>! double precision<a name='62'></font>
  integer, parameter, private :: quad_t   = selected_real_kind(20) <font color=#447700>! quad precision<a name='63'></font>
  integer, parameter, public  :: r_quad   = max( quad_t, r_double )<a name='64'>
<a name='65'>
<font color=#447700>! Expected 8-bit byte sizes of the real kinds<a name='66'></font>
  integer, parameter, public :: num_bytes_for_r_single = 4<a name='67'>
  integer, parameter, public :: num_bytes_for_r_double = 8<a name='68'>
  integer, parameter, public :: num_bytes_for_r_quad   = 16<a name='69'>
<a name='70'>
<font color=#447700>! Define arrays for default definition<a name='71'></font>
  integer, parameter, private :: num_r_kinds = 3<a name='72'>
  integer, parameter, dimension( num_r_kinds ), private :: real_kinds = (/ &amp;<a name='73'>
       r_single, r_double, r_quad    /) <a name='74'>
  integer, parameter, dimension( num_r_kinds ), private :: real_byte_sizes = (/ &amp;<a name='75'>
       num_bytes_for_r_single, num_bytes_for_r_double, &amp;<a name='76'>
       num_bytes_for_r_quad    /)<a name='77'>
<a name='78'>
<font color=#447700>! Default values<a name='79'></font>
<font color=#447700>! **** CHANGE THE FOLLOWING TO CHANGE THE DEFAULT REAL TYPE KIND ***<a name='80'></font>
  integer, parameter, private :: default_real = 2  <font color=#447700>! 1=single, <a name='81'></font>
                                                   <font color=#447700>! 2=double, <a name='82'></font>
<font color=#447700>!! END FROM MODULE_KINDS<a name='83'></font>
<a name='84'>
      <font color=#447700>!  Input 3D meteorological fields.<a name='85'></font>
<a name='86'>
<a name='87'>
      REAL , DIMENSION(:,:,:) , ALLOCATABLE :: landuse_frac_input , &amp;<a name='88'>
                                               soil_top_cat_input , &amp;<a name='89'>
                                               soil_bot_cat_input<a name='90'>
<a name='91'>
<a name='92'>
      <font color=#447700>!  Input 2D surface fields.<a name='93'></font>
<a name='94'>
      REAL , DIMENSION(:,:)   , ALLOCATABLE :: soilt010_input , soilt040_input , &amp;<a name='95'>
                                               soilt100_input , soilt200_input , &amp;<a name='96'>
                                               soilm010_input , soilm040_input , &amp;<a name='97'>
                                               soilm100_input , soilm200_input , &amp;<a name='98'>
                                               psfc_in,pmsl<a name='99'>
<a name='100'>
      REAL , DIMENSION(:,:)   , ALLOCATABLE :: lat_wind, lon_wind <a name='101'>
<a name='102'>
<a name='103'>
      <font color=#447700>!  Local input arrays<a name='104'></font>
<a name='105'>
      REAL,DIMENSION(:,:),ALLOCATABLE :: dum2d<a name='106'>
      INTEGER,DIMENSION(:,:),ALLOCATABLE :: idum2d<a name='107'>
      REAL,DIMENSION(:,:,:),ALLOCATABLE :: dum3d<a name='108'>
<a name='109'>
      LOGICAL , SAVE :: first_time_in = .TRUE.<a name='110'>
<a name='111'>
      INTEGER :: flag_soilt010 , flag_soilt100 , flag_soilt200 , &amp;<a name='112'>
        	 flag_soilm010 , flag_soilm100 , flag_soilm200<a name='113'>
<a name='114'>
<font color=#447700>!   Some constants to allow simple dimensions in the defined types<a name='115'></font>
<font color=#447700>!   given below.<a name='116'></font>
<a name='117'>
      CHARACTER (LEN=256) , PRIVATE :: a_message<a name='118'>
<a name='119'>
<a name='120'>
CONTAINS<a name='121'>
<a name='122'>
<A NAME='READ_WPS'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#READ_WPS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='123'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>read_wps</font> ( grid, filename, file_date_string, num_metgrid_levels ) <A href='../../call_to/READ_WPS.html' TARGET='index'>3</A>,<A href='../../call_from/READ_WPS.html' TARGET='index'>120</A><a name='124'>
<a name='125'>
      USE <A href='../../html_code/share/module_soil_pre.F.html#MODULE_SOIL_PRE'>module_soil_pre</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SOIL_PRE_1"><a name='126'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_17"><a name='127'>
<a name='128'>
      IMPLICIT NONE<a name='129'>
<a name='130'>
      TYPE(domain) , INTENT(INOUT)  :: grid<a name='131'>
      CHARACTER (LEN=19) , INTENT(IN) :: file_date_string<a name='132'>
      CHARACTER (LEN=4)              :: dummychar<a name='133'>
      CHARACTER (LEN=132)              :: VarName<a name='134'>
      CHARACTER (LEN=150)             :: chartemp<a name='135'>
      CHARACTER (*) , INTENT(IN) :: filename<a name='136'>
<a name='137'>
      INTEGER :: ids,ide,jds,jde,kds,kde           &amp;<a name='138'>
                ,ims,ime,jms,jme,kms,kme           &amp;<a name='139'>
                ,its,ite,jts,jte,kts,kte<a name='140'>
<a name='141'>
      INTEGER :: i , j , k , loop, IMAX, JMAX<a name='142'>
      INTEGER :: DATAHANDLE, num_metgrid_levels<a name='143'>
      INTEGER :: Sysdepinfo, Status<a name='144'>
      INTEGER :: istatus,ioutcount,iret,index,ierr<a name='145'>
      <a name='146'>
      integer :: nrecs,iunit, L,hor_size,hor_size_u,hor_size_v<a name='147'>
<a name='148'>
<font color=#447700>!!<a name='149'></font>
      character*132, allocatable :: datestr_all(:)<a name='150'>
      character*132, allocatable :: varname_all(:)<a name='151'>
      integer, allocatable       :: domainend_all(:,:)<a name='152'>
      integer, allocatable       :: start_block(:)<a name='153'>
      integer, allocatable       :: end_block(:)<a name='154'>
      integer, allocatable       :: start_byte(:)<a name='155'>
      integer, allocatable       :: end_byte(:)<a name='156'>
      integer(kind=i_llong), allocatable           :: file_offset(:)<a name='157'>
<font color=#447700>!!<a name='158'></font>
<a name='159'>
      REAL :: dummy,tmp,garb<a name='160'>
      REAL, ALLOCATABLE:: dumdata(:,:,:)<a name='161'>
      REAL, ALLOCATABLE:: dumdata_u(:,:,:)<a name='162'>
      REAL, ALLOCATABLE:: dumdata_v(:,:,:)<a name='163'>
<a name='164'>
      REAL :: lats16(16),lons16(16)<a name='165'>
<a name='166'>
      CHARACTER (LEN= 8) :: dummy_char<a name='167'>
<a name='168'>
      INTEGER :: ok , map_proj , ok_open, igarb,igarb2, N<a name='169'>
      REAL :: pt<a name='170'>
      INTEGER :: num_veg_cat , num_soil_top_cat , num_soil_bot_cat<a name='171'>
<a name='172'>
#if defined(DM_PARALLEL) &amp;&amp; <font color=#447700>!defined(STUBMPI)<a name='173'></font>
      INCLUDE "<A href='../../html_code/include/mpif.h.html'>mpif.h</A>"<A NAME="mpif.h_1"><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='174'>
<a name='175'>
      SELECT CASE ( model_data_order )<a name='176'>
         CASE ( DATA_ORDER_ZXY )<a name='177'>
            kds = grid%sd31 ; kde = grid%ed31 ;<a name='178'>
            ids = grid%sd32 ; ide = grid%ed32 ;<a name='179'>
            jds = grid%sd33 ; jde = grid%ed33 ;<a name='180'>
<a name='181'>
            kms = grid%sm31 ; kme = grid%em31 ;<a name='182'>
            ims = grid%sm32 ; ime = grid%em32 ;<a name='183'>
            jms = grid%sm33 ; jme = grid%em33 ;<a name='184'>
<a name='185'>
            kts = grid%sp31 ; kte = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='186'></font>
            its = grid%sp32 ; ite = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='187'></font>
            jts = grid%sp33 ; jte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='188'></font>
<a name='189'>
         CASE ( DATA_ORDER_XYZ )<a name='190'>
            ids = grid%sd31 ; ide = grid%ed31 ;<a name='191'>
            jds = grid%sd32 ; jde = grid%ed32 ;<a name='192'>
            kds = grid%sd33 ; kde = grid%ed33 ;<a name='193'>
<a name='194'>
            ims = grid%sm31 ; ime = grid%em31 ;<a name='195'>
            jms = grid%sm32 ; jme = grid%em32 ;<a name='196'>
            kms = grid%sm33 ; kme = grid%em33 ;<a name='197'>
<a name='198'>
            its = grid%sp31 ; ite = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='199'></font>
            jts = grid%sp32 ; jte = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='200'></font>
            kts = grid%sp33 ; kte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='201'></font>
<a name='202'>
         CASE ( DATA_ORDER_XZY )<a name='203'>
            ids = grid%sd31 ; ide = grid%ed31 ;<a name='204'>
            kds = grid%sd32 ; kde = grid%ed32 ;<a name='205'>
            jds = grid%sd33 ; jde = grid%ed33 ;<a name='206'>
<a name='207'>
            ims = grid%sm31 ; ime = grid%em31 ;<a name='208'>
            kms = grid%sm32 ; kme = grid%em32 ;<a name='209'>
            jms = grid%sm33 ; jme = grid%em33 ;<a name='210'>
<a name='211'>
            its = grid%sp31 ; ite = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='212'></font>
            kts = grid%sp32 ; kte = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='213'></font>
            jts = grid%sp33 ; jte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='214'></font>
<a name='215'>
      END SELECT<a name='216'>
<a name='217'>
      <font color=#447700>!  Initialize what soil temperature and moisture is available.<a name='218'></font>
<a name='219'>
<a name='220'>
      flag_st000010 = 0<a name='221'>
      flag_st010040 = 0<a name='222'>
      flag_st040100 = 0<a name='223'>
      flag_st100200 = 0<a name='224'>
      flag_sm000010 = 0 <a name='225'>
      flag_sm010040 = 0<a name='226'>
      flag_sm040100 = 0<a name='227'>
      flag_sm100200 = 0<a name='228'>
      flag_st010200 = 0<a name='229'>
      flag_sm010200 = 0<a name='230'>
<a name='231'>
      flag_soilt010 = 0<a name='232'>
      flag_soilt040 = 0<a name='233'>
      flag_soilt100 = 0<a name='234'>
      flag_soilt200 = 0 <a name='235'>
      flag_soilm010 = 0 <a name='236'>
      flag_soilm040 = 0<a name='237'>
      flag_soilm100 = 0<a name='238'>
      flag_soilm200 = 0<a name='239'>
<a name='240'>
      flag_sst      = 0<a name='241'>
      flag_toposoil = 0<a name='242'>
<a name='243'>
      <font color=#447700>!  How many soil levels have we found?  Well, right now, none.<a name='244'></font>
<a name='245'>
      num_st_levels_input = 0<a name='246'>
      num_sm_levels_input = 0<a name='247'>
      st_levels_input = -1<a name='248'>
      sm_levels_input = -1<a name='249'>
<a name='250'>
      <font color=#447700>!  Get the space for the data if this is the first time here.<a name='251'></font>
<a name='252'>
<a name='253'>
        IF (.NOT. ALLOCATED (pmsl)              ) ALLOCATE ( pmsl(its:ite,jts:jte) )<a name='254'>
        IF (.NOT. ALLOCATED (psfc_in)           ) ALLOCATE ( psfc_in(its:ite,jts:jte) )<a name='255'>
<a name='256'>
<font color=#447700>!!! MPI IO<a name='257'></font>
<a name='258'>
      iunit=33<a name='259'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE'>count_recs_wrf_binary_file</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUNT_RECS_WRF_BINARY_FILE_1">(iunit, trim(fileName), nrecs)<a name='260'>
<a name='261'>
      allocate (datestr_all(nrecs))<a name='262'>
      allocate (varname_all(nrecs))<a name='263'>
      allocate (domainend_all(3,nrecs))<a name='264'>
      allocate (start_block(nrecs))<a name='265'>
      allocate (end_block(nrecs))<a name='266'>
      allocate (start_byte(nrecs))<a name='267'>
      allocate (end_byte(nrecs))<a name='268'>
      allocate (file_offset(nrecs))<a name='269'>
 <a name='270'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE'>inventory_wrf_binary_file</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INVENTORY_WRF_BINARY_FILE_1">(iunit, trim(filename), nrecs,  &amp;<a name='271'>
                      datestr_all,varname_all,domainend_all,   &amp;<a name='272'>
                      start_block,end_block,start_byte,end_byte,file_offset)<a name='273'>
<a name='274'>
      call mpi_file_open(mpi_comm_world, trim(filename),     &amp;<a name='275'>
                         mpi_mode_rdonly,mpi_info_null, iunit, ierr)<a name='276'>
      if (ierr /= 0) then<a name='277'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_34">("Error opening file with mpi io")<a name='278'>
      end if<a name='279'>
<a name='280'>
      VarName='CEN_LAT'<a name='281'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_1">(index,VarName,varname_all,nrecs,iret)<a name='282'>
      if (iret /= 0) then<a name='283'>
        print*,VarName," not found in file"<a name='284'>
      else<a name='285'>
<a name='286'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,      &amp;<a name='287'>
                              garb,1,mpi_real4,                  &amp;<a name='288'>
                              mpi_status_ignore, ierr)<a name='289'>
<a name='290'>
        if (ierr /= 0) then<a name='291'>
          print*,"Error reading ", VarName," using MPIIO"<a name='292'>
        else<a name='293'>
          print*,VarName, ' from MPIIO READ= ',garb<a name='294'>
          CALL nl_set_cen_lat ( grid%id , garb )<a name='295'>
        end if<a name='296'>
      end if<a name='297'>
<a name='298'>
      VarName='CEN_LON'<a name='299'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_2">(index,VarName,varname_all,nrecs,iret)<a name='300'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,      &amp;<a name='301'>
                              garb,1,mpi_real4,                  &amp;<a name='302'>
                              mpi_status_ignore, ierr)<a name='303'>
          CALL nl_set_cen_lon ( grid%id , garb )<a name='304'>
          CALL nl_set_stand_lon ( grid%id , garb )<a name='305'>
<a name='306'>
      VarName='POLE_LAT'<a name='307'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_3">(index,VarName,varname_all,nrecs,iret)<a name='308'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,      &amp;<a name='309'>
                              garb,1,mpi_real4,                  &amp;<a name='310'>
                              mpi_status_ignore, ierr)<a name='311'>
          CALL nl_set_pole_lat ( grid%id , garb )<a name='312'>
<a name='313'>
      VarName='TRUELAT1'<a name='314'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_4">(index,VarName,varname_all,nrecs,iret)<a name='315'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,      &amp;<a name='316'>
                              garb,1,mpi_real4,                  &amp;<a name='317'>
                              mpi_status_ignore, ierr)<a name='318'>
          CALL nl_set_truelat1 ( grid%id , garb )<a name='319'>
<a name='320'>
      VarName='TRUELAT2'<a name='321'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_5">(index,VarName,varname_all,nrecs,iret)<a name='322'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,      &amp;<a name='323'>
                              garb,1,mpi_real4,                  &amp;<a name='324'>
                              mpi_status_ignore, ierr)<a name='325'>
          CALL nl_set_truelat2 ( grid%id , garb )<a name='326'>
<a name='327'>
      VarName='MAP_PROJ'<a name='328'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_6">(index,VarName,varname_all,nrecs,iret)<a name='329'>
<a name='330'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='331'>
                              igarb,1,mpi_integer4,             &amp;<a name='332'>
                              mpi_status_ignore, ierr)<a name='333'>
<a name='334'>
          CALL  nl_set_map_proj( grid%id, igarb)<a name='335'>
<a name='336'>
      VarName='ISURBAN'<a name='337'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_7">(index,VarName,varname_all,nrecs,iret)<a name='338'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='339'>
                              igarb,1,mpi_integer4,             &amp;<a name='340'>
                              mpi_status_ignore, ierr)<a name='341'>
          CALL  nl_set_isurban ( grid%id, igarb)<a name='342'>
<a name='343'>
      VarName='ISWATER'<a name='344'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_8">(index,VarName,varname_all,nrecs,iret)<a name='345'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='346'>
                              igarb,1,mpi_integer4,             &amp;<a name='347'>
                              mpi_status_ignore, ierr)<a name='348'>
	write(a_message,*) 'setting iswater to be: ', igarb<a name='349'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_9"> ( a_message )            <a name='350'>
        CALL nl_set_iswater (grid%id, igarb )<a name='351'>
<a name='352'>
      VarName='ISICE'<a name='353'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_9">(index,VarName,varname_all,nrecs,iret)<a name='354'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='355'>
                              igarb2,1,mpi_integer4,             &amp;<a name='356'>
                              mpi_status_ignore, ierr)<a name='357'>
	write(a_message,*) 'setting isice to be: ', igarb2<a name='358'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_10"> ( a_message )            <a name='359'>
        CALL nl_set_isice (grid%id, igarb2 )<a name='360'>
<a name='361'>
      IF ( igarb .eq. 16 .and. igarb2 .eq. 24 ) THEN<a name='362'>
      CALL nl_set_mminlu ( grid%id, 'USGS')<a name='363'>
      ENDIF<a name='364'>
<a name='365'>
      IF ( igarb .eq. 17 .and. igarb2 .eq. 15 ) THEN<a name='366'>
<font color=#447700>! ambiguous<a name='367'></font>
      CALL nl_set_mminlu ( grid%id, 'MODIFIED_IGBP_MODIS_NOAH')<a name='368'>
<font color=#447700>!      CALL nl_set_mminlu ( grid%id, 'MODIS')<a name='369'></font>
      ENDIF<a name='370'>
<a name='371'>
      IF ( igarb .eq. 15 .and. igarb2 .eq. 16 ) THEN<a name='372'>
      CALL nl_set_mminlu ( grid%id, 'SiB')<a name='373'>
      ENDIF<a name='374'>
<a name='375'>
      VarName='FLAG_SNOWH'<a name='376'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_10">(index,VarName,varname_all,nrecs,iret)<a name='377'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='378'>
                              igarb,1,mpi_integer4,             &amp;<a name='379'>
                              mpi_status_ignore, ierr)<a name='380'>
        flag_snowh=igarb<a name='381'>
<a name='382'>
      VarName='FLAG_SNOW'<a name='383'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_11">(index,VarName,varname_all,nrecs,iret)<a name='384'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='385'>
                              igarb,1,mpi_integer4,             &amp;<a name='386'>
                              mpi_status_ignore, ierr)<a name='387'>
        flag_snow=igarb<a name='388'>
<a name='389'>
      VarName='FLAG_METGRID'<a name='390'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_12">(index,VarName,varname_all,nrecs,iret)<a name='391'>
	if (iret .eq. 0) then<a name='392'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='393'>
                              igarb,1,mpi_integer4,             &amp;<a name='394'>
                              mpi_status_ignore, ierr)<a name='395'>
        flag_metgrid=igarb<a name='396'>
	endif<a name='397'>
<a name='398'>
      VarName='FLAG_SOILHGT'<a name='399'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_13">(index,VarName,varname_all,nrecs,iret)<a name='400'>
	if (iret .eq. 0) then<a name='401'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='402'>
                              igarb,1,mpi_integer4,             &amp;<a name='403'>
                              mpi_status_ignore, ierr)<a name='404'>
        flag_soilhgt=igarb<a name='405'>
	endif<a name='406'>
<a name='407'>
      VarName='FLAG_PSFC'<a name='408'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_14">(index,VarName,varname_all,nrecs,iret)<a name='409'>
	if (iret .eq. 0) then<a name='410'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='411'>
                              igarb,1,mpi_integer4,             &amp;<a name='412'>
                              mpi_status_ignore, ierr)<a name='413'>
        flag_psfc=igarb<a name='414'>
	endif<a name='415'>
<a name='416'>
      VarName='FLAG_SLP'<a name='417'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_15">(index,VarName,varname_all,nrecs,iret)<a name='418'>
	if (iret .eq. 0) then<a name='419'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='420'>
                              igarb,1,mpi_integer4,             &amp;<a name='421'>
                              mpi_status_ignore, ierr)<a name='422'>
        flag_slp=igarb<a name='423'>
	endif<a name='424'>
<a name='425'>
      VarName='NUM_METGRID_SOIL_LEVELS'<a name='426'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_16">(index,VarName,varname_all,nrecs,iret)<a name='427'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='428'>
                              igarb,1,mpi_integer4,             &amp;<a name='429'>
                              mpi_status_ignore, ierr)<a name='430'>
<a name='431'>
        CALL nl_set_num_metgrid_soil_levels(grid%id, igarb)<a name='432'>
        num_sw_levels_input=igarb<a name='433'>
<a name='434'>
<a name='435'>
      VarName='FLAG_SOIL_LEVELS'<a name='436'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_17">(index,VarName,varname_all,nrecs,iret)<a name='437'>
	if (iret .eq. 0) then<a name='438'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='439'>
                              igarb,1,mpi_integer4,             &amp;<a name='440'>
                              mpi_status_ignore, ierr)<a name='441'>
        flag_soil_levels=igarb<a name='442'>
	endif<a name='443'>
<a name='444'>
<a name='445'>
      VarName='FLAG_SOIL_LAYERS'<a name='446'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_18">(index,VarName,varname_all,nrecs,iret)<a name='447'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='448'>
                              igarb,1,mpi_integer4,             &amp;<a name='449'>
                              mpi_status_ignore, ierr)<a name='450'>
        flag_soil_layers=igarb<a name='451'>
<a name='452'>
<a name='453'>
<a name='454'>
      VarName='ISLAKE'<a name='455'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_19">(index,VarName,varname_all,nrecs,iret)<a name='456'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='457'>
                              igarb,1,mpi_integer4,             &amp;<a name='458'>
                              mpi_status_ignore, ierr)<a name='459'>
          CALL  nl_set_islake ( grid%id, igarb)<a name='460'>
<a name='461'>
      VarName='ISOILWATER'<a name='462'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_20">(index,VarName,varname_all,nrecs,iret)<a name='463'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='464'>
                              igarb,1,mpi_integer4,             &amp;<a name='465'>
                              mpi_status_ignore, ierr)<a name='466'>
          CALL  nl_set_isoilwater ( grid%id, igarb)<a name='467'>
<a name='468'>
      VarName='MOAD_CEN_LAT'<a name='469'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_21">(index,VarName,varname_all,nrecs,iret)<a name='470'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='471'>
                              garb,1,mpi_real4,             &amp;<a name='472'>
                              mpi_status_ignore, ierr)<a name='473'>
          CALL  nl_set_moad_cen_lat ( grid%id,garb)<a name='474'>
<a name='475'>
      VarName='corner_lats'<a name='476'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_22">(index,VarName,varname_all,nrecs,iret)<a name='477'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='478'>
                              lats16,16,mpi_real4,             &amp;<a name='479'>
                              mpi_status_ignore, ierr)<a name='480'>
<a name='481'>
      VarName='corner_lons'<a name='482'>
      call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_23">(index,VarName,varname_all,nrecs,iret)<a name='483'>
        call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='484'>
                              lons16,16,mpi_real4,             &amp;<a name='485'>
                              mpi_status_ignore, ierr)<a name='486'>
<a name='487'>
<font color=#447700>!      VarName='MMINLU'<a name='488'></font>
<font color=#447700>!      call retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='489'></font>
<font color=#447700>!	if (iret .eq. 0) then<a name='490'></font>
<font color=#447700>!       call mpi_file_read_at(iunit,file_offset(index)+5*4,     &amp;<a name='491'></font>
<font color=#447700>!                              dummychar,1,mpi_char,             &amp;<a name='492'></font>
<font color=#447700>!                              mpi_status_ignore, ierr)<a name='493'></font>
<font color=#447700>!        endif<a name='494'></font>
<a name='495'>
    hor_size=(IDE-IDS)*(JDE-JDS)<a name='496'>
    hor_size_u=(IDE+1-IDS)*(JDE-JDS)<a name='497'>
    hor_size_v=(IDE-IDS)*(JDE+1-JDS)<a name='498'>
<a name='499'>
    varName='PRES'<a name='500'>
    allocate(dumdata(IDS:IDE-1,JDS:JDE-1,num_metgrid_levels))<a name='501'>
    allocate(dumdata_u(IDS:IDE,JDS:JDE-1,num_metgrid_levels))<a name='502'>
    allocate(dumdata_v(IDS:IDE-1,JDS:JDE,num_metgrid_levels))<a name='503'>
<a name='504'>
     CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_24">(index,VarName,varname_all,nrecs,iret)<a name='505'>
     CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='506'>
                          dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='507'>
                          mpi_status_ignore, ierr)<a name='508'>
<a name='509'>
<a name='510'>
       DO K=1,num_metgrid_levels<a name='511'>
        DO J=JTS,min(JTE,JDE-1)<a name='512'>
         DO I=ITS,min(ITE,IDE-1)<a name='513'>
           grid%p_gc(I,K,J)=dumdata(I,J,K)<a name='514'>
         ENDDO<a name='515'>
        ENDDO<a name='516'>
       ENDDO<a name='517'>
<a name='518'>
<a name='519'>
    varName='GHT'<a name='520'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_25">(index,VarName,varname_all,nrecs,iret)<a name='521'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='522'>
                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='523'>
                             mpi_status_ignore, ierr)<a name='524'>
<a name='525'>
<a name='526'>
       DO K=1,num_metgrid_levels<a name='527'>
        DO J=JTS,min(JTE,JDE-1)<a name='528'>
         DO I=ITS,min(ITE,IDE-1)<a name='529'>
           grid%ght_gc(I,K,J)=dumdata(I,J,K)<a name='530'>
         ENDDO<a name='531'>
        ENDDO<a name='532'>
       ENDDO<a name='533'>
<a name='534'>
    varName='VEGCAT'<a name='535'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_26">(index,VarName,varname_all,nrecs,iret)<a name='536'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='537'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='538'>
                             mpi_status_ignore, ierr)<a name='539'>
<a name='540'>
        DO J=JTS,min(JTE,JDE-1)<a name='541'>
         DO I=ITS,min(ITE,IDE-1)<a name='542'>
           grid%vegcat(I,J)=dumdata(I,J,1)<a name='543'>
         ENDDO<a name='544'>
        ENDDO<a name='545'>
<a name='546'>
<font color=#447700>!    varName='SOIL_CAT'<a name='547'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='548'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='549'></font>
<font color=#447700>!                             dumdata,hor_size,mpi_real4,             &amp;<a name='550'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='551'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='552'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='553'></font>
<font color=#447700>!           grid%input_soil_cat(I,J)=dumdata(I,J,1)<a name='554'></font>
<font color=#447700>!         ENDDO<a name='555'></font>
<font color=#447700>!        ENDDO<a name='556'></font>
<a name='557'>
    varName='CANWAT'<a name='558'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_27">(index,VarName,varname_all,nrecs,iret)<a name='559'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='560'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='561'>
                             mpi_status_ignore, ierr)<a name='562'>
<a name='563'>
        DO J=JTS,min(JTE,JDE-1)<a name='564'>
         DO I=ITS,min(ITE,IDE-1)<a name='565'>
           grid%canwat(I,J)=dumdata(I,J,1)<a name='566'>
         ENDDO<a name='567'>
        ENDDO<a name='568'>
<a name='569'>
    varName='SNOW'<a name='570'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_28">(index,VarName,varname_all,nrecs,iret)<a name='571'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='572'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='573'>
                             mpi_status_ignore, ierr)<a name='574'>
        DO J=JTS,min(JTE,JDE-1)<a name='575'>
         DO I=ITS,min(ITE,IDE-1)<a name='576'>
           grid%snow(I,J)=dumdata(I,J,1)<a name='577'>
         ENDDO<a name='578'>
        ENDDO<a name='579'>
<a name='580'>
    varName='SNOWH'<a name='581'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_29">(index,VarName,varname_all,nrecs,iret)<a name='582'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='583'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='584'>
                             mpi_status_ignore, ierr)<a name='585'>
        DO J=JTS,min(JTE,JDE-1)<a name='586'>
         DO I=ITS,min(ITE,IDE-1)<a name='587'>
           grid%snowh(I,J)=dumdata(I,J,1)<a name='588'>
         ENDDO<a name='589'>
        ENDDO<a name='590'>
<a name='591'>
    varName='SKINTEMP'<a name='592'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_30">(index,VarName,varname_all,nrecs,iret)<a name='593'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='594'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='595'>
                             mpi_status_ignore, ierr)<a name='596'>
        DO J=JTS,min(JTE,JDE-1)<a name='597'>
         DO I=ITS,min(ITE,IDE-1)<a name='598'>
           grid%tsk_gc(I,J)=dumdata(I,J,1)<a name='599'>
         ENDDO<a name='600'>
        ENDDO<a name='601'>
<a name='602'>
    varName='SOILHGT'<a name='603'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_31">(index,VarName,varname_all,nrecs,iret)<a name='604'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='605'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='606'>
                             mpi_status_ignore, ierr)<a name='607'>
        DO J=JTS,min(JTE,JDE-1)<a name='608'>
         DO I=ITS,min(ITE,IDE-1)<a name='609'>
           grid%toposoil(I,J)=dumdata(I,J,1)<a name='610'>
         ENDDO<a name='611'>
        ENDDO<a name='612'>
<a name='613'>
<font color=#447700>!    varName='SEAICE'<a name='614'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='615'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='616'></font>
<font color=#447700>!                             dumdata,hor_size,mpi_real4,             &amp;<a name='617'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='618'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='619'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='620'></font>
<font color=#447700>!           grid%xice_gc(I,J)=dumdata(I,J,1)<a name='621'></font>
<font color=#447700>!         ENDDO<a name='622'></font>
<font color=#447700>!        ENDDO<a name='623'></font>
<a name='624'>
    varName='ST100200'<a name='625'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_32">(index,VarName,varname_all,nrecs,iret)<a name='626'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='627'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='628'>
                             mpi_status_ignore, ierr)<a name='629'>
        DO J=JTS,min(JTE,JDE-1)<a name='630'>
         DO I=ITS,min(ITE,IDE-1)<a name='631'>
           grid%st100200(I,J)=dumdata(I,J,1)<a name='632'>
         ENDDO<a name='633'>
        ENDDO<a name='634'>
<a name='635'>
    varName='ST040100'<a name='636'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_33">(index,VarName,varname_all,nrecs,iret)<a name='637'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='638'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='639'>
                             mpi_status_ignore, ierr)<a name='640'>
        DO J=JTS,min(JTE,JDE-1)<a name='641'>
         DO I=ITS,min(ITE,IDE-1)<a name='642'>
           grid%st040100(I,J)=dumdata(I,J,1)<a name='643'>
         ENDDO<a name='644'>
        ENDDO<a name='645'>
<a name='646'>
    varName='ST010040'<a name='647'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_34">(index,VarName,varname_all,nrecs,iret)<a name='648'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='649'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='650'>
                             mpi_status_ignore, ierr)<a name='651'>
<a name='652'>
        DO J=JTS,min(JTE,JDE-1)<a name='653'>
         DO I=ITS,min(ITE,IDE-1)<a name='654'>
           grid%st010040(I,J)=dumdata(I,J,1)<a name='655'>
         ENDDO<a name='656'>
        ENDDO<a name='657'>
<a name='658'>
    varName='ST000010'<a name='659'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_35">(index,VarName,varname_all,nrecs,iret)<a name='660'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='661'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='662'>
                             mpi_status_ignore, ierr)<a name='663'>
<a name='664'>
        DO J=JTS,min(JTE,JDE-1)<a name='665'>
         DO I=ITS,min(ITE,IDE-1)<a name='666'>
           grid%st000010(I,J)=dumdata(I,J,1)<a name='667'>
         ENDDO<a name='668'>
        ENDDO<a name='669'>
<a name='670'>
    varName='SM100200'<a name='671'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_36">(index,VarName,varname_all,nrecs,iret)<a name='672'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='673'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='674'>
                             mpi_status_ignore, ierr)<a name='675'>
<a name='676'>
        DO J=JTS,min(JTE,JDE-1)<a name='677'>
         DO I=ITS,min(ITE,IDE-1)<a name='678'>
           grid%sm100200(I,J)=dumdata(I,J,1)<a name='679'>
         ENDDO<a name='680'>
        ENDDO<a name='681'>
<a name='682'>
    varName='SM040100'<a name='683'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_37">(index,VarName,varname_all,nrecs,iret)<a name='684'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='685'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='686'>
                             mpi_status_ignore, ierr)<a name='687'>
<a name='688'>
        DO J=JTS,min(JTE,JDE-1)<a name='689'>
         DO I=ITS,min(ITE,IDE-1)<a name='690'>
           grid%sm040100(I,J)=dumdata(I,J,1)<a name='691'>
         ENDDO<a name='692'>
        ENDDO<a name='693'>
<a name='694'>
    varName='SM010040'<a name='695'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_38">(index,VarName,varname_all,nrecs,iret)<a name='696'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='697'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='698'>
                             mpi_status_ignore, ierr)<a name='699'>
<a name='700'>
        DO J=JTS,min(JTE,JDE-1)<a name='701'>
         DO I=ITS,min(ITE,IDE-1)<a name='702'>
           grid%sm010040(I,J)=dumdata(I,J,1)<a name='703'>
         ENDDO<a name='704'>
        ENDDO<a name='705'>
<a name='706'>
    varName='SM000010'<a name='707'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_39">(index,VarName,varname_all,nrecs,iret)<a name='708'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='709'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='710'>
                             mpi_status_ignore, ierr)<a name='711'>
<a name='712'>
        DO J=JTS,min(JTE,JDE-1)<a name='713'>
         DO I=ITS,min(ITE,IDE-1)<a name='714'>
           grid%sm000010(I,J)=dumdata(I,J,1)<a name='715'>
         ENDDO<a name='716'>
        ENDDO<a name='717'>
<a name='718'>
    varName='PSFC'<a name='719'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_40">(index,VarName,varname_all,nrecs,iret)<a name='720'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='721'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='722'>
                             mpi_status_ignore, ierr)<a name='723'>
<a name='724'>
	if ( ierr .eq. 0 ) flag_psfc=1<a name='725'>
<a name='726'>
        DO J=JTS,min(JTE,JDE-1)<a name='727'>
         DO I=ITS,min(ITE,IDE-1)<a name='728'>
           grid%psfc(I,J)=dumdata(I,J,1)<a name='729'>
         ENDDO<a name='730'>
        ENDDO<a name='731'>
<a name='732'>
    varName='RH'<a name='733'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_41">(index,VarName,varname_all,nrecs,iret)<a name='734'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='735'>
                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='736'>
                             mpi_status_ignore, ierr)<a name='737'>
<a name='738'>
       DO K=1,num_metgrid_levels<a name='739'>
        DO J=JTS,min(JTE,JDE-1)<a name='740'>
         DO I=ITS,min(ITE,IDE-1)<a name='741'>
           grid%rh_gc(I,K,J)=dumdata(I,J,K)<a name='742'>
         ENDDO<a name='743'>
        ENDDO<a name='744'>
       ENDDO<a name='745'>
<a name='746'>
    varName='VV'<a name='747'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_42">(index,VarName,varname_all,nrecs,iret)<a name='748'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='749'>
                             dumdata_v,hor_size_v*num_metgrid_levels,mpi_real4,             &amp;<a name='750'>
                             mpi_status_ignore, ierr)<a name='751'>
<a name='752'>
       DO K=1,num_metgrid_levels<a name='753'>
        DO J=JTS,min(JTE,JDE)<a name='754'>
         DO I=ITS,min(ITE,IDE-1)<a name='755'>
           grid%v_gc(I,K,J)=dumdata_v(I,J,K)<a name='756'>
	if (grid%v_gc(I,K,J) .ne. grid%v_gc(I,K,J) .or. abs(grid%v_gc(I,K,J)) .gt. 100.) then<a name='757'>
	write(a_message,*) 'bad v_gc defined: ', I,K,J,grid%v_gc(I,K,J)<a name='758'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_11"> ( a_message )            <a name='759'>
	call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_35">(" bad v_gc")<a name='760'>
	endif<a name='761'>
         ENDDO<a name='762'>
        ENDDO<a name='763'>
       ENDDO<a name='764'>
<a name='765'>
    varName='UU'<a name='766'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_43">(index,VarName,varname_all,nrecs,iret)<a name='767'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='768'>
                             dumdata_u,hor_size_u*num_metgrid_levels,mpi_real4,             &amp;<a name='769'>
                             mpi_status_ignore, ierr)<a name='770'>
       DO K=1,num_metgrid_levels<a name='771'>
        DO J=JTS,min(JTE,JDE-1)<a name='772'>
         DO I=ITS,min(ITE,IDE)<a name='773'>
           grid%u_gc(I,K,J)=dumdata_u(I,J,K)<a name='774'>
	if (grid%u_gc(I,K,J) .ne. grid%u_gc(I,K,J) .or. abs(grid%u_gc(I,K,J)) .gt. 100.) then<a name='775'>
	write(a_message,*) 'bad u_gc defined: ', I,K,J,grid%u_gc(I,K,J)<a name='776'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_12"> ( a_message )            <a name='777'>
	call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_36">(" bad u_gc")<a name='778'>
	endif<a name='779'>
         ENDDO<a name='780'>
        ENDDO<a name='781'>
       ENDDO<a name='782'>
<a name='783'>
    varName='TT'<a name='784'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_44">(index,VarName,varname_all,nrecs,iret)<a name='785'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='786'>
                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='787'>
                             mpi_status_ignore, ierr)<a name='788'>
       DO K=1,num_metgrid_levels<a name='789'>
        DO J=JTS,min(JTE,JDE-1)<a name='790'>
         DO I=ITS,min(ITE,IDE-1)<a name='791'>
           grid%t_gc(I,K,J)=dumdata(I,J,K)<a name='792'>
	if (grid%t_gc(I,K,J) .ne. grid%t_gc(I,K,J) .or. abs(grid%t_gc(I,K,J)) .gt. 350.) then<a name='793'>
	write(a_message,*) 'bad t_gc defined: ', I,K,J,grid%t_gc(I,K,J)<a name='794'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_13"> ( a_message )            <a name='795'>
	call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_37">(" bad t_gc")<a name='796'>
	endif<a name='797'>
         ENDDO<a name='798'>
        ENDDO<a name='799'>
       ENDDO<a name='800'>
<a name='801'>
<font color=#447700>!    varName='RWMR'<a name='802'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='803'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='804'></font>
<font color=#447700>!                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='805'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='806'></font>
<font color=#447700>!       DO K=1,num_metgrid_levels<a name='807'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='808'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='809'></font>
<font color=#447700>!           grid%nmm_rwmr_gc(I,J,K)=dumdata(I,J,K)<a name='810'></font>
<font color=#447700>!         ENDDO<a name='811'></font>
<font color=#447700>!        ENDDO<a name='812'></font>
<font color=#447700>!       ENDDO<a name='813'></font>
<a name='814'>
<font color=#447700>!    varName='SNMR'<a name='815'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='816'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='817'></font>
<font color=#447700>!                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='818'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='819'></font>
<font color=#447700>!       DO K=1,num_metgrid_levels<a name='820'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='821'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='822'></font>
<font color=#447700>!           grid%nmm_snmr_gc(I,J,K)=dumdata(I,J,K)<a name='823'></font>
<font color=#447700>!         ENDDO<a name='824'></font>
<font color=#447700>!        ENDDO<a name='825'></font>
<font color=#447700>!       ENDDO<a name='826'></font>
<a name='827'>
<font color=#447700>!    varName='CLWMR'<a name='828'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='829'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='830'></font>
<font color=#447700>!                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='831'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='832'></font>
<font color=#447700>!       DO K=1,num_metgrid_levels<a name='833'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='834'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='835'></font>
<font color=#447700>!           grid%nmm_clwmr_gc(I,J,K)=dumdata(I,J,K)<a name='836'></font>
<font color=#447700>!         ENDDO<a name='837'></font>
<font color=#447700>!        ENDDO<a name='838'></font>
<font color=#447700>!       ENDDO<a name='839'></font>
<a name='840'>
<font color=#447700>!    varName='CICE'<a name='841'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='842'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='843'></font>
<font color=#447700>!                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='844'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='845'></font>
<font color=#447700>!       DO K=1,num_metgrid_levels<a name='846'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='847'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='848'></font>
<font color=#447700>!           grid%nmm_cice_gc(I,J,K)=dumdata(I,J,K)<a name='849'></font>
<font color=#447700>!         ENDDO<a name='850'></font>
<font color=#447700>!        ENDDO<a name='851'></font>
<font color=#447700>!       ENDDO<a name='852'></font>
<a name='853'>
<font color=#447700>!    varName='FRIMEF'<a name='854'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='855'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='856'></font>
<font color=#447700>!                             dumdata,hor_size*num_metgrid_levels,mpi_real4,             &amp;<a name='857'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='858'></font>
<font color=#447700>!       DO K=1,num_metgrid_levels<a name='859'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='860'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='861'></font>
<font color=#447700>!           grid%nmm_rimef_gc(I,J,K)=dumdata(I,J,K)<a name='862'></font>
<font color=#447700>!         ENDDO<a name='863'></font>
<font color=#447700>!        ENDDO<a name='864'></font>
<font color=#447700>!       ENDDO<a name='865'></font>
<a name='866'>
<a name='867'>
     varName='PMSL'<a name='868'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_45">(index,VarName,varname_all,nrecs,iret)<a name='869'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='870'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='871'>
                             mpi_status_ignore, ierr)<a name='872'>
        DO J=JTS,min(JTE,JDE-1)<a name='873'>
         DO I=ITS,min(ITE,IDE-1)<a name='874'>
           grid%pslv_gc(I,J)=dumdata(I,J,1)<a name='875'>
         ENDDO<a name='876'>
        ENDDO<a name='877'>
<a name='878'>
<a name='879'>
    varName='SLOPECAT'<a name='880'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_46">(index,VarName,varname_all,nrecs,iret)<a name='881'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='882'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='883'>
                             mpi_status_ignore, ierr)<a name='884'>
        DO J=JTS,min(JTE,JDE-1)<a name='885'>
         DO I=ITS,min(ITE,IDE-1)<a name='886'>
           grid%slopecat(I,J)=dumdata(I,J,1)<a name='887'>
         ENDDO<a name='888'>
        ENDDO<a name='889'>
<a name='890'>
    varName='SNOALB'<a name='891'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_47">(index,VarName,varname_all,nrecs,iret)<a name='892'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='893'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='894'>
                             mpi_status_ignore, ierr)<a name='895'>
<a name='896'>
        DO J=JTS,min(JTE,JDE-1)<a name='897'>
         DO I=ITS,min(ITE,IDE-1)<a name='898'>
           grid%snoalb(I,J)=dumdata(I,J,1)<a name='899'>
         ENDDO<a name='900'>
        ENDDO<a name='901'>
<a name='902'>
         num_veg_cat      = SIZE ( grid%landusef , DIM=2 )<a name='903'>
         num_soil_top_cat = SIZE ( grid%soilctop , DIM=2 )<a name='904'>
         num_soil_bot_cat = SIZE ( grid%soilcbot , DIM=2 )<a name='905'>
<a name='906'>
    varName='GREENFRAC'<a name='907'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_48">(index,VarName,varname_all,nrecs,iret)<a name='908'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='909'>
                             dumdata,hor_size*12,mpi_real4,             &amp;<a name='910'>
                             mpi_status_ignore, ierr)<a name='911'>
<a name='912'>
       DO K=1,12<a name='913'>
        DO J=JTS,min(JTE,JDE-1)<a name='914'>
         DO I=ITS,min(ITE,IDE-1)<a name='915'>
           grid%greenfrac(I,K,J)=dumdata(I,J,K)<a name='916'>
         ENDDO<a name='917'>
        ENDDO<a name='918'>
       ENDDO<a name='919'>
<a name='920'>
    varName='ALBEDO12M'<a name='921'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_49">(index,VarName,varname_all,nrecs,iret)<a name='922'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='923'>
                             dumdata,hor_size*12,mpi_real4,             &amp;<a name='924'>
                             mpi_status_ignore, ierr)<a name='925'>
<a name='926'>
       DO K=1,12<a name='927'>
        DO J=JTS,min(JTE,JDE-1)<a name='928'>
         DO I=ITS,min(ITE,IDE-1)<a name='929'>
           grid%albedo12m(I,K,J)=dumdata(I,J,K)<a name='930'>
         ENDDO<a name='931'>
        ENDDO<a name='932'>
       ENDDO<a name='933'>
<a name='934'>
    varName='SOILCBOT'<a name='935'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_50">(index,VarName,varname_all,nrecs,iret)<a name='936'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='937'>
                             dumdata,hor_size*num_soil_bot_cat,mpi_real4,             &amp;<a name='938'>
                             mpi_status_ignore, ierr)<a name='939'>
<a name='940'>
       DO K=1,num_soil_bot_cat<a name='941'>
        DO J=JTS,min(JTE,JDE-1)<a name='942'>
         DO I=ITS,min(ITE,IDE-1)<a name='943'>
           grid%soilcbot(I,K,J)=dumdata(I,J,K)<a name='944'>
         ENDDO<a name='945'>
        ENDDO<a name='946'>
       ENDDO<a name='947'>
<a name='948'>
    varName='SOILCAT'<a name='949'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_51">(index,VarName,varname_all,nrecs,iret)<a name='950'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='951'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='952'>
                             mpi_status_ignore, ierr)<a name='953'>
<a name='954'>
        DO J=JTS,min(JTE,JDE-1)<a name='955'>
         DO I=ITS,min(ITE,IDE-1)<a name='956'>
           grid%soilcat(I,J)=dumdata(I,J,1)<a name='957'>
         ENDDO<a name='958'>
        ENDDO<a name='959'>
<a name='960'>
	write(a_message,*) 'veg_cat and soil_cat sizes:::: ', num_veg_cat , num_soil_top_cat<a name='961'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_14"> ( a_message )            <a name='962'>
<a name='963'>
    varName='SOILCTOP'<a name='964'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_52">(index,VarName,varname_all,nrecs,iret)<a name='965'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='966'>
                             dumdata,hor_size*num_soil_top_cat,mpi_real4,             &amp;<a name='967'>
                             mpi_status_ignore, ierr)<a name='968'>
       DO K=1,num_soil_top_cat<a name='969'>
        DO J=JTS,min(JTE,JDE-1)<a name='970'>
         DO I=ITS,min(ITE,IDE-1)<a name='971'>
           grid%soilctop(I,K,J)=dumdata(I,J,K)<a name='972'>
         ENDDO<a name='973'>
        ENDDO<a name='974'>
       ENDDO<a name='975'>
<a name='976'>
    varName='SOILTEMP'<a name='977'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_53">(index,VarName,varname_all,nrecs,iret)<a name='978'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='979'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='980'>
                             mpi_status_ignore, ierr)<a name='981'>
<a name='982'>
        DO J=JTS,min(JTE,JDE-1)<a name='983'>
         DO I=ITS,min(ITE,IDE-1)<a name='984'>
           grid%tmn_gc(I,J)=dumdata(I,J,1)<a name='985'>
         ENDDO<a name='986'>
        ENDDO<a name='987'>
<a name='988'>
<font color=#447700>!    varName='HGT_V'<a name='989'></font>
<font color=#447700>!    CALL retrieve_index(index,VarName,varname_all,nrecs,iret)<a name='990'></font>
<font color=#447700>!    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='991'></font>
<font color=#447700>!                             dumdata,hor_size,mpi_real4,             &amp;<a name='992'></font>
<font color=#447700>!                             mpi_status_ignore, ierr)<a name='993'></font>
<font color=#447700>!<a name='994'></font>
<font color=#447700>!        DO J=JTS,min(JTE,JDE-1)<a name='995'></font>
<font color=#447700>!         DO I=ITS,min(ITE,IDE-1)<a name='996'></font>
<font color=#447700>!           grid%nmm_htv_gc(I,J)=dumdata(I,J,1)<a name='997'></font>
<font color=#447700>!         ENDDO<a name='998'></font>
<font color=#447700>!        ENDDO<a name='999'></font>
<a name='1000'>
    varName='HGT_M'<a name='1001'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_54">(index,VarName,varname_all,nrecs,iret)<a name='1002'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1003'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1004'>
                             mpi_status_ignore, ierr)<a name='1005'>
<a name='1006'>
        DO J=JTS,min(JTE,JDE-1)<a name='1007'>
         DO I=ITS,min(ITE,IDE-1)<a name='1008'>
           grid%ht_gc(I,J)=dumdata(I,J,1)<a name='1009'>
         ENDDO<a name='1010'>
        ENDDO<a name='1011'>
<a name='1012'>
    varName='LU_INDEX'<a name='1013'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_55">(index,VarName,varname_all,nrecs,iret)<a name='1014'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1015'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1016'>
                             mpi_status_ignore, ierr)<a name='1017'>
<a name='1018'>
        DO J=JTS,min(JTE,JDE-1)<a name='1019'>
         DO I=ITS,min(ITE,IDE-1)<a name='1020'>
           grid%lu_index(I,J)=dumdata(I,J,1)<a name='1021'>
         ENDDO<a name='1022'>
        ENDDO<a name='1023'>
<a name='1024'>
    varName='LANDUSEF'<a name='1025'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_56">(index,VarName,varname_all,nrecs,iret)<a name='1026'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1027'>
                             dumdata,hor_size*num_veg_cat,mpi_real4,             &amp;<a name='1028'>
                             mpi_status_ignore, ierr)<a name='1029'>
<a name='1030'>
       DO K=1,num_veg_cat<a name='1031'>
        DO J=JTS,min(JTE,JDE-1)<a name='1032'>
         DO I=ITS,min(ITE,IDE-1)<a name='1033'>
           grid%landusef(I,K,J)=dumdata(I,J,K)<a name='1034'>
         ENDDO<a name='1035'>
        ENDDO<a name='1036'>
       ENDDO<a name='1037'>
<a name='1038'>
    varName='LANDMASK'<a name='1039'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_57">(index,VarName,varname_all,nrecs,iret)<a name='1040'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1041'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1042'>
                             mpi_status_ignore, ierr)<a name='1043'>
<a name='1044'>
        DO J=JTS,min(JTE,JDE-1)<a name='1045'>
         DO I=ITS,min(ITE,IDE-1)<a name='1046'>
           grid%landmask(I,J)=dumdata(I,J,1)<a name='1047'>
         ENDDO<a name='1048'>
        ENDDO<a name='1049'>
<a name='1050'>
    varName='F'<a name='1051'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_58">(index,VarName,varname_all,nrecs,iret)<a name='1052'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1053'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1054'>
                             mpi_status_ignore, ierr)<a name='1055'>
        DO J=JTS,min(JTE,JDE-1)<a name='1056'>
         DO I=ITS,min(ITE,IDE-1)<a name='1057'>
           grid%f(I,J)=dumdata(I,J,1)<a name='1058'>
         ENDDO<a name='1059'>
        ENDDO<a name='1060'>
<a name='1061'>
    varName='E'<a name='1062'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_59">(index,VarName,varname_all,nrecs,iret)<a name='1063'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1064'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1065'>
                             mpi_status_ignore, ierr)<a name='1066'>
        DO J=JTS,min(JTE,JDE-1)<a name='1067'>
         DO I=ITS,min(ITE,IDE-1)<a name='1068'>
           grid%e(I,J)=dumdata(I,J,1)<a name='1069'>
         ENDDO<a name='1070'>
        ENDDO<a name='1071'>
<a name='1072'>
    varName='COSALPHA'<a name='1073'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_60">(index,VarName,varname_all,nrecs,iret)<a name='1074'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1075'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1076'>
                             mpi_status_ignore, ierr)<a name='1077'>
        DO J=JTS,min(JTE,JDE-1)<a name='1078'>
         DO I=ITS,min(ITE,IDE-1)<a name='1079'>
           grid%cosa(I,J)=dumdata(I,J,1)<a name='1080'>
         ENDDO<a name='1081'>
        ENDDO<a name='1082'>
<a name='1083'>
    varName='SINALPHA'<a name='1084'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_61">(index,VarName,varname_all,nrecs,iret)<a name='1085'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1086'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1087'>
                             mpi_status_ignore, ierr)<a name='1088'>
        DO J=JTS,min(JTE,JDE-1)<a name='1089'>
         DO I=ITS,min(ITE,IDE-1)<a name='1090'>
           grid%sina(I,J)=dumdata(I,J,1)<a name='1091'>
         ENDDO<a name='1092'>
        ENDDO<a name='1093'>
<a name='1094'>
    varName='MAPFAC_U'<a name='1095'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_62">(index,VarName,varname_all,nrecs,iret)<a name='1096'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1097'>
                             dumdata_u,hor_size_u,mpi_real4,             &amp;<a name='1098'>
                             mpi_status_ignore, ierr)<a name='1099'>
        DO J=JTS,min(JTE,JDE-1)<a name='1100'>
         DO I=ITS,min(ITE,IDE)<a name='1101'>
           grid%msfu(I,J)=dumdata_u(I,J,1)<a name='1102'>
<a name='1103'>
<font color=#447700>!! bandaid for newly created WPS geogrid static files<a name='1104'></font>
        if (grid%msfu(I,J) .lt. 0.7) then<a name='1105'>
        write(a_message,*) 'weird msfu at I,J: ', I,J,grid%msfu(I,J)<a name='1106'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_15"> ( a_message )            <a name='1107'>
<a name='1108'>
        if(J .eq. min(JTE,JDE-1)) then<a name='1109'>
        grid%msfu(I,J)=dumdata_u(I,J-1,1)<a name='1110'>
        write(a_message,*) 'changing msfu to: ',I,J,  grid%msfu(I,J)<a name='1111'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_16"> ( a_message )            <a name='1112'>
        endif<a name='1113'>
        <a name='1114'>
        endif<a name='1115'>
<font color=#447700>!! end bandaid <a name='1116'></font>
<a name='1117'>
         ENDDO<a name='1118'>
        ENDDO<a name='1119'>
<a name='1120'>
    varName='MAPFAC_V'<a name='1121'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_63">(index,VarName,varname_all,nrecs,iret)<a name='1122'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1123'>
                             dumdata_v,hor_size_v,mpi_real4,             &amp;<a name='1124'>
                             mpi_status_ignore, ierr)<a name='1125'>
        DO J=JTS,min(JTE,JDE)<a name='1126'>
         DO I=ITS,min(ITE,IDE-1)<a name='1127'>
           grid%msfv(I,J)=dumdata_v(I,J,1)<a name='1128'>
<a name='1129'>
        if (grid%msfv(I,J) .lt. 0.7 ) then<a name='1130'>
        write(a_message,*) 'weird msfv at I,J: ', I,J,grid%msfv(I,J)<a name='1131'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_17"> ( a_message )            <a name='1132'>
        grid%msfv(I,J)=dumdata_v(I,J-1,1)<a name='1133'>
        if( J .eq. min(JTE,JDE)) then<a name='1134'>
        write(a_message,*) 'changing msfv to: ',I,J,  grid%msfv(I,J)<a name='1135'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_18"> ( a_message )            <a name='1136'>
        endif<a name='1137'>
<a name='1138'>
        endif<a name='1139'>
<a name='1140'>
         ENDDO<a name='1141'>
        ENDDO<a name='1142'>
<a name='1143'>
    varName='MAPFAC_M'<a name='1144'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_64">(index,VarName,varname_all,nrecs,iret)<a name='1145'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1146'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1147'>
                             mpi_status_ignore, ierr)<a name='1148'>
        DO J=JTS,min(JTE,JDE-1)<a name='1149'>
         DO I=ITS,min(ITE,IDE-1)<a name='1150'>
           grid%msft(I,J)=dumdata(I,J,1)<a name='1151'>
         ENDDO<a name='1152'>
        ENDDO<a name='1153'>
<a name='1154'>
    varName='CLAT'<a name='1155'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_65">(index,VarName,varname_all,nrecs,iret)<a name='1156'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1157'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1158'>
                             mpi_status_ignore, ierr)<a name='1159'>
        DO J=JTS,min(JTE,JDE-1)<a name='1160'>
         DO I=ITS,min(ITE,IDE-1)<a name='1161'>
           grid%clat(I,J)=dumdata(I,J,1)<a name='1162'>
         ENDDO<a name='1163'>
        ENDDO<a name='1164'>
<a name='1165'>
    varName='XLONG_U'<a name='1166'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_66">(index,VarName,varname_all,nrecs,iret)<a name='1167'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1168'>
                             dumdata_u,hor_size_u,mpi_real4,             &amp;<a name='1169'>
                             mpi_status_ignore, ierr)<a name='1170'>
        DO J=JTS,min(JTE,JDE-1)<a name='1171'>
         DO I=ITS,min(ITE,IDE)<a name='1172'>
           grid%xlong_u(I,J)=dumdata_u(I,J,1)<a name='1173'>
         ENDDO<a name='1174'>
        ENDDO<a name='1175'>
<a name='1176'>
    varName='XLAT_U'<a name='1177'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_67">(index,VarName,varname_all,nrecs,iret)<a name='1178'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1179'>
                             dumdata_u,hor_size_u,mpi_real4,             &amp;<a name='1180'>
                             mpi_status_ignore, ierr)<a name='1181'>
        DO J=JTS,min(JTE,JDE-1)<a name='1182'>
         DO I=ITS,min(ITE,IDE)<a name='1183'>
           grid%xlat_u(I,J)=dumdata_u(I,J,1)<a name='1184'>
         ENDDO<a name='1185'>
        ENDDO<a name='1186'>
<a name='1187'>
    varName='XLONG_V'<a name='1188'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_68">(index,VarName,varname_all,nrecs,iret)<a name='1189'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1190'>
                             dumdata_v,hor_size_v,mpi_real4,             &amp;<a name='1191'>
                             mpi_status_ignore, ierr)<a name='1192'>
        DO J=JTS,min(JTE,JDE)<a name='1193'>
         DO I=ITS,min(ITE,IDE-1)<a name='1194'>
           grid%xlong_v(I,J)=dumdata_v(I,J,1)<a name='1195'>
         ENDDO<a name='1196'>
        ENDDO<a name='1197'>
<a name='1198'>
    varName='XLAT_V'<a name='1199'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_69">(index,VarName,varname_all,nrecs,iret)<a name='1200'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1201'>
                             dumdata_v,hor_size_v,mpi_real4,             &amp;<a name='1202'>
                             mpi_status_ignore, ierr)<a name='1203'>
        DO J=JTS,min(JTE,JDE)<a name='1204'>
         DO I=ITS,min(ITE,IDE-1)<a name='1205'>
           grid%xlat_v(I,J)=dumdata_v(I,J,1)<a name='1206'>
         ENDDO<a name='1207'>
        ENDDO<a name='1208'>
<a name='1209'>
    varName='XLONG_M'<a name='1210'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_70">(index,VarName,varname_all,nrecs,iret)<a name='1211'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1212'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1213'>
                             mpi_status_ignore, ierr)<a name='1214'>
<a name='1215'>
        DO J=JTS,min(JTE,JDE-1)<a name='1216'>
         DO I=ITS,min(ITE,IDE-1)<a name='1217'>
           grid%xlong_gc(I,J)=dumdata(I,J,1)<a name='1218'>
         ENDDO<a name='1219'>
        ENDDO<a name='1220'>
<a name='1221'>
	write(a_message,*) 'reading XLAT_M'<a name='1222'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_19"> ( a_message )            <a name='1223'>
    varName='XLAT_M'<a name='1224'>
    CALL <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX'>retrieve_index</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RETRIEVE_INDEX_71">(index,VarName,varname_all,nrecs,iret)<a name='1225'>
    CALL mpi_file_read_at(iunit,file_offset(index+1),     &amp;<a name='1226'>
                             dumdata,hor_size,mpi_real4,             &amp;<a name='1227'>
                             mpi_status_ignore, ierr)<a name='1228'>
<a name='1229'>
        DO J=JTS,min(JTE,JDE-1)<a name='1230'>
         DO I=ITS,min(ITE,IDE-1)<a name='1231'>
           grid%xlat_gc(I,J)=dumdata(I,J,1)<a name='1232'>
         ENDDO<a name='1233'>
        ENDDO<a name='1234'>
	write(a_message,*) 'xlat_gc defined'<a name='1235'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_20"> ( a_message )            <a name='1236'>
<a name='1237'>
      call mpi_file_close(mpi_comm_world, ierr)<a name='1238'>
<a name='1239'>
	write(a_message,*) 'to ST000010 def'<a name='1240'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_21"> ( a_message )            <a name='1241'>
       varName='ST000010'<a name='1242'>
       flag_st000010 = 1<a name='1243'>
       num_st_levels_input = num_st_levels_input + 1<a name='1244'>
       st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_1">(varName(3:8))<a name='1245'>
       DO J=JTS,min(JTE,JDE-1)<a name='1246'>
        DO I=ITS,min(ITE,IDE-1)<a name='1247'>
           st_input(I,num_st_levels_input + 1,J) = grid%st000010(i,j)<a name='1248'>
        ENDDO<a name='1249'>
       ENDDO<a name='1250'>
	write(a_message,*) 'past ST000010 def'<a name='1251'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_22"> ( a_message )            <a name='1252'>
<a name='1253'>
       varName='ST010040'<a name='1254'>
       flag_st010040 = 1<a name='1255'>
       num_st_levels_input = num_st_levels_input + 1<a name='1256'>
       st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_2">(varName(3:8))<a name='1257'>
       DO J=JTS,min(JTE,JDE-1)<a name='1258'>
        DO I=ITS,min(ITE,IDE-1)<a name='1259'>
            st_input(I,num_st_levels_input + 1,J) = grid%st010040(i,j)<a name='1260'>
        ENDDO<a name='1261'>
       ENDDO<a name='1262'>
<a name='1263'>
       varName='ST040100'<a name='1264'>
       flag_st040100 = 1<a name='1265'>
       num_st_levels_input = num_st_levels_input + 1<a name='1266'>
       st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_3">(varName(3:8))<a name='1267'>
       DO J=JTS,min(JTE,JDE-1)<a name='1268'>
        DO I=ITS,min(ITE,IDE-1)<a name='1269'>
              st_input(I,num_st_levels_input + 1,J) = grid%st040100(i,j)<a name='1270'>
        ENDDO<a name='1271'>
       ENDDO<a name='1272'>
 <a name='1273'>
       varName='ST100200'<a name='1274'>
       flag_st100200 = 1<a name='1275'>
       num_st_levels_input = num_st_levels_input + 1<a name='1276'>
       st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_4">(varName(3:8))<a name='1277'>
       DO J=JTS,min(JTE,JDE-1)<a name='1278'>
        DO I=ITS,min(ITE,IDE-1)<a name='1279'>
              st_input(I,num_st_levels_input + 1,J) = grid%st100200(i,j)<a name='1280'>
        ENDDO<a name='1281'>
       ENDDO<a name='1282'>
<a name='1283'>
       varName='SM000010'<a name='1284'>
       flag_sm000010 = 1<a name='1285'>
       num_sm_levels_input = num_sm_levels_input + 1<a name='1286'>
       sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_5">(varName(3:8))<a name='1287'>
       DO J=JTS,min(JTE,JDE-1)<a name='1288'>
        DO I=ITS,min(ITE,IDE-1)<a name='1289'>
           sm_input(I,num_sm_levels_input + 1,J) = grid%sm000010(i,j)<a name='1290'>
        ENDDO<a name='1291'>
       ENDDO<a name='1292'>
<a name='1293'>
       varName='SM010040'<a name='1294'>
       flag_sm010040 = 1<a name='1295'>
       num_sm_levels_input = num_sm_levels_input + 1<a name='1296'>
       sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_6">(varName(3:8))<a name='1297'>
       DO J=JTS,min(JTE,JDE-1)<a name='1298'>
        DO I=ITS,min(ITE,IDE-1)<a name='1299'>
            sm_input(I,num_sm_levels_input + 1,J) = grid%sm010040(i,j)<a name='1300'>
        ENDDO<a name='1301'>
       ENDDO<a name='1302'>
<a name='1303'>
       varName='SM040100'<a name='1304'>
       flag_sm040100 = 1<a name='1305'>
       num_sm_levels_input = num_sm_levels_input + 1<a name='1306'>
       sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_7">(varName(3:8))<a name='1307'>
       DO J=JTS,min(JTE,JDE-1)<a name='1308'>
        DO I=ITS,min(ITE,IDE-1)<a name='1309'>
              sm_input(I,num_sm_levels_input + 1,J) = grid%sm040100(i,j)<a name='1310'>
        ENDDO<a name='1311'>
       ENDDO<a name='1312'>
 <a name='1313'>
       varName='SM100200'<a name='1314'>
       flag_sm100200 = 1<a name='1315'>
       num_sm_levels_input = num_sm_levels_input + 1<a name='1316'>
       sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_8">(varName(3:8))<a name='1317'>
       DO J=JTS,min(JTE,JDE-1)<a name='1318'>
        DO I=ITS,min(ITE,IDE-1)<a name='1319'>
              sm_input(I,num_sm_levels_input + 1,J) = grid%sm100200(i,j)<a name='1320'>
        ENDDO<a name='1321'>
       ENDDO<a name='1322'>
<a name='1323'>
<font color=#447700>!           flag_sst = 1<a name='1324'></font>
<a name='1325'>
        write(a_message,*) 'maxval st_input(1): ', maxval(st_input(:,1,:))<a name='1326'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_23"> ( a_message )            <a name='1327'>
        write(a_message,*) 'maxval st_input(2): ', maxval(st_input(:,2,:))<a name='1328'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_24"> ( a_message )            <a name='1329'>
        write(a_message,*) 'maxval st_input(3): ', maxval(st_input(:,3,:))<a name='1330'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_25"> ( a_message )            <a name='1331'>
        write(a_message,*) 'maxval st_input(4): ', maxval(st_input(:,4,:))<a name='1332'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_26"> ( a_message )            <a name='1333'>
<a name='1334'>
        DEALLOCATE(pmsl)<a name='1335'>
        DEALLOCATE(psfc_in)<a name='1336'>
        DEALLOCATE(dumdata)<a name='1337'>
        DEALLOCATE(dumdata_u)<a name='1338'>
        DEALLOCATE(dumdata_v)<a name='1339'>
<a name='1340'>
#endif<a name='1341'>
     end subroutine read_wps<a name='1342'>
<a name='1343'>
<font color=#447700>! -------------------------------------------------------------------------<a name='1344'></font>
<font color=#447700>! -------------------------------------------------------------------------<a name='1345'></font>
<a name='1346'>
<font color=#447700>!!!! MPI-IO pieces<a name='1347'></font>
<a name='1348'>
<A NAME='RETRIEVE_INDEX'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_INDEX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1349'>
<font color=#993300>subroutine </font><font color=#cc0000>retrieve_index</font>(index,string,varname_all,nrecs,iret) <A href='../../call_to/RETRIEVE_INDEX.html' TARGET='index'>71</A><a name='1350'>
<font color=#447700>!$$$  subprogram documentation block<a name='1351'></font>
<font color=#447700>!                .      .    .                                       .<a name='1352'></font>
<font color=#447700>! subprogram:    retrieve_index  get record number of desired variable<a name='1353'></font>
<font color=#447700>!   prgmmr: parrish          org: np22                date: 2004-11-29<a name='1354'></font>
<font color=#447700>!<a name='1355'></font>
<font color=#447700>! abstract: by examining previously generated inventory of wrf binary restart file,<a name='1356'></font>
<font color=#447700>!             find record number that contains the header record for variable<a name='1357'></font>
<font color=#447700>!             identified by input character variable "string".<a name='1358'></font>
<font color=#447700>!<a name='1359'></font>
<font color=#447700>! program history log:<a name='1360'></font>
<font color=#447700>!   2004-11-29  parrish<a name='1361'></font>
<font color=#447700>!<a name='1362'></font>
<font color=#447700>!   input argument list:<a name='1363'></font>
<font color=#447700>!     string           - mnemonic for variable desired<a name='1364'></font>
<font color=#447700>!     varname_all      - list of all mnemonics obtained from inventory of file<a name='1365'></font>
<font color=#447700>!     nrecs            - total number of sequential records counted in wrf<a name='1366'></font>
<font color=#447700>!                        binary restart file<a name='1367'></font>
<font color=#447700>!<a name='1368'></font>
<font color=#447700>!   output argument list:<a name='1369'></font>
<font color=#447700>!     index            - desired record number<a name='1370'></font>
<font color=#447700>!     iret             - return status, set to 0 if variable was found,<a name='1371'></font>
<font color=#447700>!                        non-zero if not.<a name='1372'></font>
<font color=#447700>!<a name='1373'></font>
<font color=#447700>! attributes:<a name='1374'></font>
<font color=#447700>!   language: f90<a name='1375'></font>
<font color=#447700>!   machine:  ibm RS/6000 SP<a name='1376'></font>
<font color=#447700>!<a name='1377'></font>
<font color=#447700>!$$$<a name='1378'></font>
<a name='1379'>
  implicit none<a name='1380'>
<a name='1381'>
  integer,intent(out)::iret<a name='1382'>
  integer,intent(in)::nrecs<a name='1383'>
  integer,intent(out):: index<a name='1384'>
  character(*), intent(in):: string<a name='1385'>
  character(132),intent(in)::varname_all(nrecs)<a name='1386'>
<a name='1387'>
  integer i<a name='1388'>
<a name='1389'>
  iret=0<a name='1390'>
<a name='1391'>
  do i=1,nrecs<a name='1392'>
   if(trim(string) == trim(varname_all(i))) then<a name='1393'>
      index=i<a name='1394'>
      return<a name='1395'>
   end if<a name='1396'>
  end do<a name='1397'>
<a name='1398'>
  write(6,*)' problem reading wrf nmm binary file, rec id "',trim(string),'" not found'<a name='1399'>
<a name='1400'>
  iret=-1<a name='1401'>
<a name='1402'>
end subroutine retrieve_index<a name='1403'>
<A NAME='NEXT_BUF'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1404'>
<font color=#993300>subroutine </font><font color=#cc0000>next_buf</font>(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf) <A href='../../call_to/NEXT_BUF.html' TARGET='index'>12</A><a name='1405'>
<font color=#447700>!$$$  subprogram documentation block<a name='1406'></font>
<font color=#447700>!                .      .    .                                       .<a name='1407'></font>
<font color=#447700>! subprogram:    next_buf    bring in next direct access block<a name='1408'></font>
<font color=#447700>!   prgmmr: parrish          org: np22                date: 2004-11-29<a name='1409'></font>
<font color=#447700>!<a name='1410'></font>
<font color=#447700>! abstract: bring in next direct access block when needed, as the file is scanned<a name='1411'></font>
<font color=#447700>!             from beginning to end during counting and inventory of records.<a name='1412'></font>
<font color=#447700>!             (subroutines count_recs_wrf_binary_file and inventory_wrf_binary_file)<a name='1413'></font>
<font color=#447700>!<a name='1414'></font>
<font color=#447700>! program history log:<a name='1415'></font>
<font color=#447700>!   2004-11-29  parrish<a name='1416'></font>
<font color=#447700>!<a name='1417'></font>
<font color=#447700>!   input argument list:<a name='1418'></font>
<font color=#447700>!     in_unit          - fortran unit number where input file is opened through.<a name='1419'></font>
<font color=#447700>!     nextbyte         - byte number from beginning of file that is desired<a name='1420'></font>
<font color=#447700>!     locbyte          - byte number from beginning of last block read for desired byt<a name='1421'></font>
<font color=#447700>!     lrecl            - direct access block length<a name='1422'></font>
<font color=#447700>!     nreads           - number of blocks read before now (for diagnostic information<a name='1423'></font>
<font color=#447700>!     lastbuf          - logical, if true, then no more blocks, so return<a name='1424'></font>
<font color=#447700>!<a name='1425'></font>
<font color=#447700>!   output argument list:<a name='1426'></font>
<font color=#447700>!     buf              - output array containing contents of next block<a name='1427'></font>
<font color=#447700>!     locbyte          - byte number from beginning of new block read for desired byte<a name='1428'></font>
<font color=#447700>!     thisblock        - number of new block being read by this routine<a name='1429'></font>
<font color=#447700>!     nreads           - number of blocks read now (for diagnostic information only)<a name='1430'></font>
<font color=#447700>!     lastbuf          - logical, if true, then at end of file.<a name='1431'></font>
<font color=#447700>!<a name='1432'></font>
<font color=#447700>! attributes:<a name='1433'></font>
<font color=#447700>!   language: f90<a name='1434'></font>
<font color=#447700>!   machine:  ibm RS/6000 SP<a name='1435'></font>
<font color=#447700>!<a name='1436'></font>
<font color=#447700>!$$$<a name='1437'></font>
<font color=#447700>!  use kinds, only: i_byte,i_llong<a name='1438'></font>
  implicit none<a name='1439'>
<a name='1440'>
  integer(i_llong) lrecl<a name='1441'>
  integer in_unit,nreads<a name='1442'>
  integer(i_byte) buf(lrecl)<a name='1443'>
  integer(i_llong) nextbyte,locbyte,thisblock<a name='1444'>
  logical lastbuf<a name='1445'>
<a name='1446'>
  integer ierr<a name='1447'>
<a name='1448'>
  if(lastbuf) return<a name='1449'>
<a name='1450'>
  ierr=0<a name='1451'>
  nreads=nreads+1<a name='1452'>
<a name='1453'>
<font color=#447700>!  compute thisblock:<a name='1454'></font>
<a name='1455'>
  thisblock = 1_i_llong + (nextbyte-1_i_llong)/lrecl<a name='1456'>
<a name='1457'>
  locbyte = 1_i_llong+mod(locbyte-1_i_llong,lrecl)<a name='1458'>
<a name='1459'>
  read(in_unit,rec=thisblock,iostat=ierr)buf<a name='1460'>
  lastbuf = ierr /= 0<a name='1461'>
<a name='1462'>
end subroutine next_buf<a name='1463'>
<a name='1464'>
<A NAME='INVENTORY_WRF_BINARY_FILE'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1465'>
<font color=#993300>subroutine </font><font color=#cc0000>inventory_wrf_binary_file</font>(in_unit,wrf_ges_filename,nrecs, &amp; <A href='../../call_to/INVENTORY_WRF_BINARY_FILE.html' TARGET='index'>1</A>,<A href='../../call_from/INVENTORY_WRF_BINARY_FILE.html' TARGET='index'>28</A><a name='1466'>
                                     datestr_all,varname_all,domainend_all, &amp;<a name='1467'>
                                     start_block,end_block,start_byte,end_byte,file_offset)<a name='1468'>
<font color=#447700>!$$$  subprogram documentation block<a name='1469'></font>
<font color=#447700>!                .      .    .                                       .<a name='1470'></font>
<font color=#447700>! subprogram:    inventory_wrf_binary_file  get contents of wrf binary file<a name='1471'></font>
<font color=#447700>!   prgmmr: parrish          org: np22                date: 2004-11-29<a name='1472'></font>
<font color=#447700>!<a name='1473'></font>
<font color=#447700>! abstract: generate list of contents and map of wrf binary file which can be<a name='1474'></font>
<font color=#447700>!             used for reading and writing with mpi io routines.<a name='1475'></font>
<font color=#447700>!             same basic routine as count_recs_wrf_binary_file, except<a name='1476'></font>
<font color=#447700>!             now wrf unpacking routines are used to decode wrf header<a name='1477'></font>
<font color=#447700>!             records, and send back lists of variable mnemonics, dates,<a name='1478'></font>
<font color=#447700>!             grid dimensions, and byte addresses relative to start of<a name='1479'></font>
<font color=#447700>!             file for each field (this is used by mpi io routines).<a name='1480'></font>
<font color=#447700>!<a name='1481'></font>
<font color=#447700>! program history log:<a name='1482'></font>
<font color=#447700>!   2004-11-29  parrish<a name='1483'></font>
<font color=#447700>!<a name='1484'></font>
<font color=#447700>!<a name='1485'></font>
<font color=#447700>!   input argument list:<a name='1486'></font>
<font color=#447700>!     in_unit          - fortran unit number where input file is opened through.<a name='1487'></font>
<font color=#447700>!     wrf_ges_filename - filename of input wrf binary restart file<a name='1488'></font>
<font color=#447700>!     nrecs            - number of sequential records found on input wrf binary restart file.<a name='1489'></font>
<font color=#447700>!                          (obtained by a previous call to count_recs_wrf_binary_file)<a name='1490'></font>
<font color=#447700>!<a name='1491'></font>
<font color=#447700>!   output argument list:  (all following dimensioned nrecs)<a name='1492'></font>
<font color=#447700>!     datestr_all      - date character string for each field, where applicable (or else blanks)<a name='1493'></font>
<font color=#447700>!     varname_all      - wrf mnemonic for each variable, where applicable (or blank)<a name='1494'></font>
<font color=#447700>!     domainend_all    - dimensions of each field, where applicable (up to 3 dimensions)<a name='1495'></font>
<font color=#447700>!     start_block      - direct access block number containing 1st byte of record<a name='1496'></font>
<font color=#447700>!                            (after 4 byte record mark)<a name='1497'></font>
<font color=#447700>!     end_block        - direct access block number containing last byte of record<a name='1498'></font>
<font color=#447700>!                            (before 4 byte record mark)<a name='1499'></font>
<font color=#447700>!     start_byte       - relative byte address in direct access block of 1st byte of record<a name='1500'></font>
<font color=#447700>!     end_byte         - relative byte address in direct access block of last byte of record<a name='1501'></font>
<font color=#447700>!     file_offset      - absolute address of byte before 1st byte of record (used by mpi io)<a name='1502'></font>
<font color=#447700>!<a name='1503'></font>
<font color=#447700>! attributes:<a name='1504'></font>
<font color=#447700>!   language: f90<a name='1505'></font>
<font color=#447700>!   machine:  ibm RS/6000 SP<a name='1506'></font>
<font color=#447700>!<a name='1507'></font>
<font color=#447700>!$$$<a name='1508'></font>
<font color=#447700>!   use kinds, only: r_single,i_byte,i_long,i_llong<a name='1509'></font>
  use <A href='../../html_code/frame/module_internal_header_util.F.html#MODULE_INTERNAL_HEADER_UTIL'>module_internal_header_util</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INTERNAL_HEADER_UTIL_1"><a name='1510'>
  implicit none<a name='1511'>
<a name='1512'>
  integer,intent(in)::in_unit,nrecs<a name='1513'>
  character(*),intent(in)::wrf_ges_filename<a name='1514'>
  character(132),intent(out)::datestr_all(nrecs),varname_all(nrecs)<a name='1515'>
  integer,intent(out)::domainend_all(3,nrecs)<a name='1516'>
  integer,intent(out)::start_block(nrecs),end_block(nrecs)<a name='1517'>
  integer,intent(out)::start_byte(nrecs),end_byte(nrecs)<a name='1518'>
  integer(i_llong),intent(out)::file_offset(nrecs)<a name='1519'>
<a name='1520'>
  integer irecs<a name='1521'>
  integer(i_llong) nextbyte,locbyte,thisblock<a name='1522'>
  integer(i_byte) lenrec4(4)<a name='1523'>
  integer(i_long) lenrec,lensave<a name='1524'>
  equivalence (lenrec4(1),lenrec)<a name='1525'>
  integer(i_byte) missing4(4)<a name='1526'>
  integer(i_long) missing<a name='1527'>
  equivalence (missing,missing4(1))<a name='1528'>
  integer(i_llong),parameter:: lrecl=2**20<a name='1529'>
  integer(i_byte) buf(lrecl)<a name='1530'>
  integer i,loc_count,nreads<a name='1531'>
  logical lastbuf<a name='1532'>
  integer(i_byte) hdrbuf4(2048)<a name='1533'>
  integer(i_long) hdrbuf(512)<a name='1534'>
  equivalence(hdrbuf(1),hdrbuf4(1))<a name='1535'>
  integer,parameter:: int_field       =       530<a name='1536'>
  integer,parameter:: int_dom_ti_char =       220<a name='1537'>
  integer,parameter:: int_dom_ti_real =       140<a name='1538'>
  integer,parameter:: int_dom_ti_integer =       180<a name='1539'>
  integer hdrbufsize<a name='1540'>
  integer inttypesize<a name='1541'>
  integer datahandle,count<a name='1542'>
  character(128) element,dumstr,strdata<a name='1543'>
  integer loccode<a name='1544'>
  character(132) blanks<a name='1545'>
  integer typesize<a name='1546'>
  integer fieldtype,comm,iocomm<a name='1547'>
  integer domaindesc<a name='1548'>
  character(132) memoryorder,stagger,dimnames(3)<a name='1549'>
  integer domainstart(3),domainend(3)<a name='1550'>
  integer memorystart(3),memoryend(3)<a name='1551'>
  integer patchstart(3),patchend(3)<a name='1552'>
  character(132) datestr,varname<a name='1553'>
  real dummy_field(1)<a name='1554'>
<font color=#447700>!  real(r_single) dummy_field(1)<a name='1555'></font>
<font color=#447700>!  integer dummy_field<a name='1556'></font>
<font color=#447700>!  real dummy_field<a name='1557'></font>
  integer itypesize<a name='1558'>
  integer idata(1)<a name='1559'>
  real rdata(1)<a name='1560'>
<a name='1561'>
  call <A href='../../html_code/frame/module_machine.F.html#WRF_SIZEOF_INTEGER'>wrf_sizeof_integer</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SIZEOF_INTEGER_1">(itypesize)<a name='1562'>
  inttypesize=itypesize<a name='1563'>
<a name='1564'>
  blanks=trim(' ')<a name='1565'>
<a name='1566'>
	write(a_message,*) 'inventory subroutine'<a name='1567'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_27"> ( a_message )            <a name='1568'>
<a name='1569'>
	write(a_message,*) 'opening file : ', trim(wrf_ges_filename)<a name='1570'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_28"> ( a_message )            <a name='1571'>
<a name='1572'>
  open(in_unit,file=trim(wrf_ges_filename),access='direct',recl=lrecl)<a name='1573'>
  irecs=0<a name='1574'>
  missing=-9999<a name='1575'>
  nextbyte=0_i_llong<a name='1576'>
  locbyte=lrecl<a name='1577'>
  nreads=0<a name='1578'>
  lastbuf=.false.<a name='1579'>
  do<a name='1580'>
<a name='1581'>
<font color=#447700>!   get length of next record<a name='1582'></font>
<a name='1583'>
    do i=1,4<a name='1584'>
     nextbyte=nextbyte+1_i_llong<a name='1585'>
     locbyte=locbyte+1_i_llong<a name='1586'>
     if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1587'>
     if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_1">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1588'>
     lenrec4(i)=buf(locbyte)<a name='1589'>
    end do<a name='1590'>
    if(lenrec &lt;= 0 .and. lastbuf) go to 900<a name='1591'>
    if(lenrec &lt;= 0 .and. .not. lastbuf) go to 885<a name='1592'>
    nextbyte=nextbyte+1_i_llong<a name='1593'>
    locbyte=locbyte+1_i_llong<a name='1594'>
    if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1595'>
    if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_2">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1596'>
<a name='1597'>
    irecs=irecs+1<a name='1598'>
    start_block(irecs)=thisblock<a name='1599'>
    start_byte(irecs)=locbyte<a name='1600'>
    file_offset(irecs)=nextbyte-1_i_llong<a name='1601'>
    hdrbuf4(1)=buf(locbyte)<a name='1602'>
    hdrbuf4(2:4)=missing4(2:4)<a name='1603'>
    hdrbuf4(5:8)=missing4(1:4)<a name='1604'>
    datestr_all(irecs)=blanks<a name='1605'>
    varname_all(irecs)=blanks<a name='1606'>
    domainend_all(1:3,irecs)=0<a name='1607'>
<a name='1608'>
    loc_count=1<a name='1609'>
<font color=#447700>!	write(a_message,*) '1, hdrbuf4(1): 1', hdrbuf4(1) <a name='1610'></font>
<font color=#447700>!       CALL wrf_message ( a_message )            <a name='1611'></font>
    do i=2,8<a name='1612'>
       if(loc_count.ge.lenrec) exit<a name='1613'>
       loc_count=loc_count+1<a name='1614'>
       nextbyte=nextbyte+1_i_llong<a name='1615'>
       locbyte=locbyte+1_i_llong<a name='1616'>
       if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1617'>
       if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_3">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1618'>
       hdrbuf4(i)=buf(locbyte)<a name='1619'>
<font color=#447700>!	write(0,*) 'I, hdrbuf4(I): ', I, hdrbuf4(I)<a name='1620'></font>
    end do<a name='1621'>
<a name='1622'>
<font color=#447700>!         if(lenrec==2048) then write(0,*)' irecs,hdrbuf(2),int_dom_ti_char,int_field=', &amp;<a name='1623'></font>
<font color=#447700>!                                      irecs,hdrbuf(2),int_dom_ti_char,int_field, int_dom_ti_real, int_dom_ti_integer<a name='1624'></font>
	<a name='1625'>
    if(lenrec==2048.and.(hdrbuf(2) == int_dom_ti_char .or. hdrbuf(2) == int_field &amp;<a name='1626'>
    .or. hdrbuf(2) == int_dom_ti_real .or. hdrbuf(2) == int_dom_ti_integer)) then<a name='1627'>
<a name='1628'>
<font color=#447700>!    bring in next full record, so we can unpack datestr, varname, and domainend<a name='1629'></font>
       do i=9,lenrec<a name='1630'>
          loc_count=loc_count+1<a name='1631'>
          nextbyte=nextbyte+1_i_llong<a name='1632'>
          locbyte=locbyte+1_i_llong<a name='1633'>
          if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1634'>
          if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_4">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1635'>
          hdrbuf4(i)=buf(locbyte)<a name='1636'>
<font color=#447700>!	write(0,*) 'I, hdrbuf4(I): ', I, hdrbuf4(I)<a name='1637'></font>
       end do<a name='1638'>
<font color=#447700>!	write(0,*) 'past 9,lenrec loop'<a name='1639'></font>
<font color=#447700>!	write(0,*) 'hdrbuf(2): ', hdrbuf(2) <a name='1640'></font>
<a name='1641'>
       if(hdrbuf(2) == int_dom_ti_char) then<a name='1642'>
<a name='1643'>
          call <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_CHAR'>int_get_ti_header_char</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_CHAR_1">(hdrbuf,hdrbufsize,inttypesize, &amp;<a name='1644'>
                   datahandle,element,dumstr,strdata,loccode)<a name='1645'>
          varname_all(irecs)=trim(element)<a name='1646'>
          datestr_all(irecs)=trim(strdata)<a name='1647'>
              write(a_message,*)'(1) irecs,varname,datestr = ',irecs,trim(varname_all(irecs)),trim(datestr_all(irecs))<a name='1648'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_29"> ( a_message )      <a name='1649'>
<a name='1650'>
       else if(hdrbuf(2) == int_dom_ti_real) then<a name='1651'>
<a name='1652'>
<font color=#447700>!	write(0,*) 'call int_get_ti_header_real'<a name='1653'></font>
<a name='1654'>
<font color=#447700>!	write(0,*) 'hdrbuf(1:10): ', hdrbuf(1:10)<a name='1655'></font>
<a name='1656'>
<font color=#447700>!	write(0,*) 'call with inttypesize typesize: ', inttypesize,typesize<a name='1657'></font>
<a name='1658'>
          call <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_REAL'>int_get_ti_header_real</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_REAL_1">(hdrbuf,hdrbufsize,inttypesize,typesize, &amp;<a name='1659'>
                   datahandle,element,rdata,count,loccode)<a name='1660'>
<a name='1661'>
<font color=#447700>!	write(0,*) 'return int_get_ti_header_real'<a name='1662'></font>
<a name='1663'>
          varname_all(irecs)=trim(element)<a name='1664'>
<a name='1665'>
<font color=#447700>!	write(0,*) 'varname_all(irecs): ', varname_all(irecs)<a name='1666'></font>
<a name='1667'>
<font color=#447700>!          datestr_all(irecs)=trim(strdata)<a name='1668'></font>
<a name='1669'>
              write(a_message,*)'(2) irecs,varname,datestr = ',irecs,trim(varname_all(irecs)),rdata(1)<a name='1670'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_30"> ( a_message )      <a name='1671'>
<font color=#447700>!	write(0,*) ' --------------------------- '<a name='1672'></font>
         <a name='1673'>
       else if(hdrbuf(2) == int_dom_ti_integer) then<a name='1674'>
<a name='1675'>
          call <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_TI_HEADER_INTEGER'>int_get_ti_header_integer</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_TI_HEADER_INTEGER_1">(hdrbuf,hdrbufsize,inttypesize,typesize, &amp;<a name='1676'>
                   datahandle,element,idata,count,loccode)<a name='1677'>
          varname_all(irecs)=trim(element)<a name='1678'>
<font color=#447700>!          datestr_all(irecs)=trim(strdata)<a name='1679'></font>
              write(0,*)'(3) irecs,varname,datestr = ',irecs,trim(varname_all(irecs)),idata(1:count)<a name='1680'>
<a name='1681'>
       else<a name='1682'>
<a name='1683'>
<font color=#447700>!	write(0,*) 'call int_get_write_field_header'<a name='1684'></font>
          call <A href='../../html_code/frame/module_internal_header_util.F.html#INT_GET_WRITE_FIELD_HEADER'>int_get_write_field_header</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INT_GET_WRITE_FIELD_HEADER_1">(hdrbuf,hdrbufsize,inttypesize,typesize, &amp;<a name='1685'>
             datahandle,datestr,varname,dummy_field,fieldtype,comm,iocomm, &amp;<a name='1686'>
             domaindesc,memoryorder,stagger,dimnames, &amp;<a name='1687'>
             domainstart,domainend,memorystart,memoryend,patchstart,patchend)<a name='1688'>
          varname_all(irecs)=trim(varname)<a name='1689'>
          datestr_all(irecs)=trim(datestr)<a name='1690'>
          domainend_all(1:3,irecs)=domainend(1:3)<a name='1691'>
<font color=#447700>!              write(0,*)'(4) irecs,datestr,domend,varname = ', &amp;<a name='1692'></font>
<font color=#447700>!                  irecs,trim(datestr_all(irecs)),domainend_all(1:3,irecs),trim(varname_all(irecs))<a name='1693'></font>
<a name='1694'>
       end if<a name='1695'>
    end if<a name='1696'>
<a name='1697'>
    nextbyte=nextbyte-loc_count+lenrec<a name='1698'>
    locbyte=locbyte-loc_count+lenrec<a name='1699'>
    if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1700'>
    if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_5">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1701'>
    end_block(irecs)=thisblock<a name='1702'>
    end_byte(irecs)=locbyte<a name='1703'>
    lensave=lenrec<a name='1704'>
    do i=1,4<a name='1705'>
     nextbyte=nextbyte+1_i_llong<a name='1706'>
     locbyte=locbyte+1_i_llong<a name='1707'>
     if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1708'>
     if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_6">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1709'>
     lenrec4(i)=buf(locbyte)<a name='1710'>
    end do<a name='1711'>
    if(lenrec /= lensave) go to 890<a name='1712'>
<a name='1713'>
  end do<a name='1714'>
<a name='1715'>
880  continue<a name='1716'>
     write(6,*)' reached impossible place in inventory_wrf_binary_file'<a name='1717'>
     close(in_unit)<a name='1718'>
     return<a name='1719'>
<a name='1720'>
885  continue<a name='1721'>
     write(a_message,*)' problem in inventory_wrf_binary_file, lenrec has bad value before end of file'<a name='1722'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_31"> ( a_message )               <a name='1723'>
     write(a_message,*)'     lenrec =',lenrec<a name='1724'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_32"> ( a_message )               <a name='1725'>
     close(in_unit)<a name='1726'>
     return<a name='1727'>
<a name='1728'>
890  continue<a name='1729'>
     write(a_message,*)' problem in inventory_wrf_binary_file, beginning and ending rec len words unequal'<a name='1730'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_33"> ( a_message )               <a name='1731'>
     write(a_message,*)'     begining reclen =',lensave<a name='1732'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_34"> ( a_message )               <a name='1733'>
     write(a_message,*)'       ending reclen =',lenrec<a name='1734'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_35"> ( a_message )               <a name='1735'>
     write(a_message,*)'               irecs =',irecs<a name='1736'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_36"> ( a_message )               <a name='1737'>
     write(a_message,*)'               nrecs =',nrecs<a name='1738'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_37"> ( a_message )               <a name='1739'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_38">("curious reclen discrepancy")<a name='1740'>
     close(in_unit)<a name='1741'>
     return<a name='1742'>
<a name='1743'>
900  continue<a name='1744'>
     write(a_message,*)' normal end of file reached in inventory_wrf_binary_file'<a name='1745'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_38"> ( a_message )               <a name='1746'>
     write(a_message,*)'        nblocks=',thisblock<a name='1747'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_39"> ( a_message )               <a name='1748'>
     write(a_message,*)'          irecs,nrecs=',irecs,nrecs<a name='1749'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_40"> ( a_message )               <a name='1750'>
     write(a_message,*)'         nreads=',nreads<a name='1751'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#INVENTORY_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_41"> ( a_message )               <a name='1752'>
     close(in_unit)<a name='1753'>
<a name='1754'>
end subroutine inventory_wrf_binary_file<a name='1755'>
<a name='1756'>
<A NAME='WRF_SIZEOF_INTEGER'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#WRF_SIZEOF_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1757'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_sizeof_integer</font>( retval ) <A href='../../call_to/WRF_SIZEOF_INTEGER.html' TARGET='index'>1</A><a name='1758'>
  IMPLICIT NONE<a name='1759'>
  INTEGER retval<a name='1760'>
<font color=#447700>! 4 is defined by CPP<a name='1761'></font>
  retval = 4<a name='1762'>
  RETURN<a name='1763'>
END SUBROUTINE wrf_sizeof_integer<a name='1764'>
<a name='1765'>
<A NAME='WRF_SIZEOF_REAL'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#WRF_SIZEOF_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1766'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_sizeof_real</font>( retval )<a name='1767'>
  IMPLICIT NONE<a name='1768'>
  INTEGER retval<a name='1769'>
<font color=#447700>! 4 is defined by CPP<a name='1770'></font>
  retval = 4<a name='1771'>
  RETURN<a name='1772'>
END SUBROUTINE wrf_sizeof_real<a name='1773'>
<a name='1774'>
<font color=#447700>!!!<a name='1775'></font>
<font color=#447700>!!!<a name='1776'></font>
<font color=#447700>!!!<a name='1777'></font>
<a name='1778'>
<A NAME='COUNT_RECS_WRF_BINARY_FILE'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1779'>
<font color=#993300>subroutine </font><font color=#cc0000>count_recs_wrf_binary_file</font>(in_unit,wrf_ges_filename,nrecs) <A href='../../call_to/COUNT_RECS_WRF_BINARY_FILE.html' TARGET='index'>1</A>,<A href='../../call_from/COUNT_RECS_WRF_BINARY_FILE.html' TARGET='index'>7</A><a name='1780'>
<font color=#447700>!$$$  subprogram documentation block<a name='1781'></font>
<font color=#447700>!                .      .    .                                       .<a name='1782'></font>
<font color=#447700>! subprogram:    count_recs_binary_file  count # recs on wrf binary file<a name='1783'></font>
<font color=#447700>!   prgmmr: parrish          org: np22                date: 2004-11-29<a name='1784'></font>
<font color=#447700>!<a name='1785'></font>
<font color=#447700>! abstract: count number of sequential records contained in wrf binary<a name='1786'></font>
<font color=#447700>!             file.  this is done by opening the file in direct access<a name='1787'></font>
<font color=#447700>!             mode with block length of 2**20, the size of the physical<a name='1788'></font>
<font color=#447700>!             blocks on ibm "blue" and "white" machines.  for optimal<a name='1789'></font>
<font color=#447700>!             performance, change block length to correspond to the<a name='1790'></font>
<font color=#447700>!             physical block length of host machine disk space.<a name='1791'></font>
<font color=#447700>!             records are counted by looking for the 4 byte starting<a name='1792'></font>
<font color=#447700>!             and ending sequential record markers, which contain the<a name='1793'></font>
<font color=#447700>!             record size in bytes.  only blocks are read which are known<a name='1794'></font>
<font color=#447700>!             by simple calculation to contain these record markers.<a name='1795'></font>
<font color=#447700>!             even though this is done on one processor, it is still<a name='1796'></font>
<font color=#447700>!             very fast, and the time will always scale by the number of<a name='1797'></font>
<font color=#447700>!             sequential records, not their size.  this step and the<a name='1798'></font>
<font color=#447700>!             following inventory step consistently take less than 0.1 seconds<a name='1799'></font>
<font color=#447700>!             to complete.<a name='1800'></font>
<font color=#447700>!<a name='1801'></font>
<font color=#447700>! program history log:<a name='1802'></font>
<font color=#447700>!   2004-11-29  parrish<a name='1803'></font>
<font color=#447700>!<a name='1804'></font>
<font color=#447700>!   input argument list:<a name='1805'></font>
<font color=#447700>!     in_unit          - fortran unit number where input file is opened through.<a name='1806'></font>
<font color=#447700>!     wrf_ges_filename - filename of input wrf binary restart file<a name='1807'></font>
<font color=#447700>!<a name='1808'></font>
<font color=#447700>!   output argument list:<a name='1809'></font>
<font color=#447700>!     nrecs            - number of sequential records found on input wrf binary restart fil<a name='1810'></font>
<font color=#447700>!<a name='1811'></font>
<font color=#447700>! attributes:<a name='1812'></font>
<font color=#447700>!   language: f90<a name='1813'></font>
<font color=#447700>!   machine:  ibm RS/6000 SP<a name='1814'></font>
<font color=#447700>!<a name='1815'></font>
<font color=#447700>!$$$<a name='1816'></font>
<a name='1817'>
<font color=#447700>!   do an initial read through of a wrf binary file, and get total number of sequential fil<a name='1818'></font>
<a name='1819'>
<font color=#447700>!   use kinds, only: r_single,i_byte,i_long,i_llong<a name='1820'></font>
  implicit none<a name='1821'>
<a name='1822'>
  integer,intent(in)::in_unit<a name='1823'>
  character(*),intent(in)::wrf_ges_filename<a name='1824'>
  integer,intent(out)::nrecs<a name='1825'>
<a name='1826'>
  integer(i_llong) nextbyte,locbyte,thisblock<a name='1827'>
  integer(i_byte) lenrec4(4)<a name='1828'>
  integer(i_long) lenrec,lensave<a name='1829'>
  equivalence (lenrec4(1),lenrec)<a name='1830'>
  integer(i_byte) missing4(4)<a name='1831'>
  integer(i_long) missing<a name='1832'>
  equivalence (missing,missing4(1))<a name='1833'>
  integer(i_llong),parameter:: lrecl=2**20<a name='1834'>
  integer(i_byte) buf(lrecl)<a name='1835'>
  integer i,loc_count,nreads<a name='1836'>
  logical lastbuf<a name='1837'>
<a name='1838'>
  open(in_unit,file=trim(wrf_ges_filename),access='direct',recl=lrecl)<a name='1839'>
  nrecs=0<a name='1840'>
  missing=-9999<a name='1841'>
  nextbyte=0_i_llong<a name='1842'>
  locbyte=lrecl<a name='1843'>
  nreads=0<a name='1844'>
  lastbuf=.false.<a name='1845'>
  do<a name='1846'>
<a name='1847'>
<font color=#447700>!   get length of next record<a name='1848'></font>
<a name='1849'>
    do i=1,4<a name='1850'>
     nextbyte=nextbyte+1_i_llong<a name='1851'>
     locbyte=locbyte+1_i_llong<a name='1852'>
     if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1853'>
     if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_7">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1854'>
     lenrec4(i)=buf(locbyte)<a name='1855'>
    end do<a name='1856'>
    if(lenrec &lt;= 0 .and. lastbuf) go to 900<a name='1857'>
    if(lenrec &lt;= 0 .and. .not.lastbuf) go to 885<a name='1858'>
    nextbyte=nextbyte+1_i_llong<a name='1859'>
    locbyte=locbyte+1_i_llong<a name='1860'>
    if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1861'>
    if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_8">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1862'>
<a name='1863'>
    nrecs=nrecs+1<a name='1864'>
<a name='1865'>
    loc_count=1<a name='1866'>
    do i=2,4<a name='1867'>
       if(loc_count.ge.lenrec) exit<a name='1868'>
       loc_count=loc_count+1<a name='1869'>
       nextbyte=nextbyte+1_i_llong<a name='1870'>
       locbyte=locbyte+1_i_llong<a name='1871'>
       if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1872'>
       if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_9">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1873'>
    end do<a name='1874'>
    do i=1,4<a name='1875'>
       if(loc_count.ge.lenrec) exit<a name='1876'>
       loc_count=loc_count+1<a name='1877'>
       nextbyte=nextbyte+1_i_llong<a name='1878'>
       locbyte=locbyte+1_i_llong<a name='1879'>
       if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1880'>
       if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_10">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1881'>
    end do<a name='1882'>
    nextbyte=nextbyte-loc_count+lenrec<a name='1883'>
    locbyte=locbyte-loc_count+lenrec<a name='1884'>
    if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1885'>
    if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_11">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1886'>
    lensave=lenrec<a name='1887'>
    do i=1,4<a name='1888'>
     nextbyte=nextbyte+1_i_llong<a name='1889'>
     locbyte=locbyte+1_i_llong<a name='1890'>
     if(locbyte &gt; lrecl .and. lastbuf) go to 900<a name='1891'>
     if(locbyte &gt; lrecl) call <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#NEXT_BUF'>next_buf</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXT_BUF_12">(in_unit,buf,nextbyte,locbyte,thisblock,lrecl,nreads,lastbuf)<a name='1892'>
     lenrec4(i)=buf(locbyte)<a name='1893'>
    end do<a name='1894'>
    if(lenrec /= lensave) go to 890<a name='1895'>
<a name='1896'>
  end do<a name='1897'>
<a name='1898'>
880  continue<a name='1899'>
     write(6,*)' reached impossible place in count_recs_wrf_binary_file'<a name='1900'>
     close(in_unit)<a name='1901'>
     return<a name='1902'>
<a name='1903'>
885  continue<a name='1904'>
     write(6,*)' problem in count_recs_wrf_binary_file, lenrec has bad value before end of file'<a name='1905'>
     write(6,*)'     lenrec =',lenrec<a name='1906'>
     close(in_unit)<a name='1907'>
     return<a name='1908'>
<a name='1909'>
890  continue<a name='1910'>
     write(6,*)' problem in count_recs_wrf_binary_file, beginning and ending rec len words unequal'<a name='1911'>
     write(6,*)'     begining reclen =',lensave<a name='1912'>
     write(6,*)'       ending reclen =',lenrec<a name='1913'>
     close(in_unit)<a name='1914'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#COUNT_RECS_WRF_BINARY_FILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_39">("bad reclen stuff")<a name='1915'>
     return<a name='1916'>
<a name='1917'>
900  continue<a name='1918'>
     write(6,*)' normal end of file reached in count_recs_wrf_binary_file'<a name='1919'>
     write(6,*)'        nblocks=',thisblock<a name='1920'>
     write(6,*)'          nrecs=',nrecs<a name='1921'>
     write(6,*)'         nreads=',nreads<a name='1922'>
     close(in_unit)<a name='1923'>
<a name='1924'>
end subroutine count_recs_wrf_binary_file<a name='1925'>
<a name='1926'>
<A NAME='RETRIEVE_FIELD'><A href='../../html_code/dyn_em/module_wps_io_arw.F.html#RETRIEVE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1927'>
<font color=#993300>subroutine </font><font color=#cc0000>retrieve_field</font>(in_unit,wrfges,out,start_block,end_block,start_byte,end_byte)<a name='1928'>
<font color=#447700>!$$$  subprogram documentation block<a name='1929'></font>
<font color=#447700>!                .      .    .                                       .<a name='1930'></font>
<font color=#447700>! subprogram:    retrieve_field  retrieve field from wrf binary file<a name='1931'></font>
<font color=#447700>!   prgmmr: parrish          org: np22                date: 2004-11-29<a name='1932'></font>
<font color=#447700>!<a name='1933'></font>
<font color=#447700>! abstract: still using direct access, retrieve a field from the wrf binary restart file.<a name='1934'></font>
<font color=#447700>!<a name='1935'></font>
<font color=#447700>! program history log:<a name='1936'></font>
<font color=#447700>!   2004-11-29  parrish<a name='1937'></font>
<font color=#447700>!<a name='1938'></font>
<font color=#447700>!   input argument list:<a name='1939'></font>
<font color=#447700>!     in_unit          - fortran unit number where input file is opened through.<a name='1940'></font>
<font color=#447700>!     wrfges - filename of input wrf binary restart file<a name='1941'></font>
<font color=#447700>!     start_block      - direct access block number containing 1st byte of record<a name='1942'></font>
<font color=#447700>!                            (after 4 byte record mark)<a name='1943'></font>
<font color=#447700>!     end_block        - direct access block number containing last byte of record<a name='1944'></font>
<font color=#447700>!                            (before 4 byte record mark)<a name='1945'></font>
<font color=#447700>!     start_byte       - relative byte address in direct access block of 1st byte of record<a name='1946'></font>
<font color=#447700>!     end_byte         - relative byte address in direct access block of last byte of record<a name='1947'></font>
<font color=#447700>!<a name='1948'></font>
<font color=#447700>!   output argument list:<a name='1949'></font>
<font color=#447700>!     out              - output buffer where desired field is deposited<a name='1950'></font>
<font color=#447700>!<a name='1951'></font>
<font color=#447700>! attributes:<a name='1952'></font>
<font color=#447700>!   language: f90<a name='1953'></font>
<font color=#447700>!   machine:  ibm RS/6000 SP<a name='1954'></font>
<font color=#447700>!<a name='1955'></font>
<font color=#447700>!$$$<a name='1956'></font>
<a name='1957'>
 <font color=#447700>! use kinds, only: i_byte,i_kind<a name='1958'></font>
  implicit none<a name='1959'>
<a name='1960'>
  integer(i_kind),intent(in)::in_unit<a name='1961'>
  character(50),intent(in)::wrfges<a name='1962'>
  integer(i_kind),intent(in)::start_block,end_block,start_byte,end_byte<a name='1963'>
  integer(i_byte),intent(out)::out(*)<a name='1964'>
<a name='1965'>
  integer(i_llong),parameter:: lrecl=2**20<a name='1966'>
  integer(i_byte) buf(lrecl)<a name='1967'>
  integer(i_kind) i,ii,k<a name='1968'>
  integer(i_llong) ibegin,iend<a name='1969'>
  integer :: ierr<a name='1970'>
<a name='1971'>
  open(in_unit,file=trim(wrfges),access='direct',recl=lrecl)<a name='1972'>
<a name='1973'>
     write(6,*)' in retrieve_field, start_block,end_block=',start_block,end_block<a name='1974'>
     write(6,*)' in retrieve_field, start_byte,end_byte=',start_byte,end_byte<a name='1975'>
  ii=0<a name='1976'>
  do k=start_block,end_block<a name='1977'>
     read(in_unit,rec=k,iostat=ierr)buf<a name='1978'>
     ibegin=1 ; iend=lrecl<a name='1979'>
     if(k == start_block) ibegin=start_byte<a name='1980'>
     if(k == end_block) iend=end_byte<a name='1981'>
     do i=ibegin,iend<a name='1982'>
        ii=ii+1<a name='1983'>
        out(ii)=buf(i)<a name='1984'>
     end do<a name='1985'>
  end do<a name='1986'>
  close(in_unit)<a name='1987'>
<a name='1988'>
end subroutine retrieve_field<a name='1989'>
<a name='1990'>
<a name='1991'>
END MODULE module_wps_io_arw<a name='1992'>
</pre></body></html>