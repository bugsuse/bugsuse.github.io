<HTML> <BODY BGCOLOR=#ddeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:SOLVER<a name='2'></font>
<a name='3'>
#define BENCH_START(A)<a name='4'>
#define BENCH_END(A)<a name='5'>
<a name='6'>
<A NAME='MODULE_FIRST_RK_STEP_PART2'><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#MODULE_FIRST_RK_STEP_PART2' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='7'>
<font color=#993300>MODULE </font><font color=#cc0000>module_first_rk_step_part2</font> <A href='../../call_to/MODULE_FIRST_RK_STEP_PART2.html' TARGET='index'>1</A><a name='8'>
<a name='9'>
CONTAINS<a name='10'>
<a name='11'>
<A NAME='FIRST_RK_STEP_PART2'><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>first_rk_step_part2</font> (   grid , config_flags              &amp; <A href='../../call_to/FIRST_RK_STEP_PART2.html' TARGET='index'>1</A>,<A href='../../call_from/FIRST_RK_STEP_PART2.html' TARGET='index'>45</A><a name='13'>
                             , moist , moist_tend               &amp;<a name='14'>
                             , chem  , chem_tend                &amp;<a name='15'>
                             , tracer, tracer_tend              &amp;<a name='16'>
                             , scalar , scalar_tend             &amp;<a name='17'>
                             , fdda3d, fdda2d                   &amp;<a name='18'>
                             , ru_tendf, rv_tendf               &amp;<a name='19'>
                             , rw_tendf, t_tendf                &amp;<a name='20'>
                             , ph_tendf, mu_tendf               &amp;<a name='21'>
                             , tke_tend                         &amp;<a name='22'>
                             , adapt_step_flag , curr_secs      &amp;<a name='23'>
                             , psim , psih , wspd , gz1oz0 , chklowq &amp;<a name='24'>
                             , cu_act_flag , hol , th_phy        &amp;<a name='25'>
                             , pi_phy , p_phy , t_phy     &amp;<a name='26'>
                             , dz8w , p8w , t8w           &amp;<a name='27'>
                             , nba_mij, n_nba_mij         &amp; <font color=#447700>!JDM<a name='28'></font>
                             , nba_rij, n_nba_rij         &amp; <font color=#447700>!JDM<a name='29'></font>
                             , ids, ide, jds, jde, kds, kde     &amp;<a name='30'>
                             , ims, ime, jms, jme, kms, kme     &amp;<a name='31'>
                             , ips, ipe, jps, jpe, kps, kpe     &amp;<a name='32'>
                             , imsx,imex,jmsx,jmex,kmsx,kmex    &amp;<a name='33'>
                             , ipsx,ipex,jpsx,jpex,kpsx,kpex    &amp;<a name='34'>
                             , imsy,imey,jmsy,jmey,kmsy,kmey    &amp;<a name='35'>
                             , ipsy,ipey,jpsy,jpey,kpsy,kpey    &amp;<a name='36'>
                             , k_start , k_end                  &amp;<a name='37'>
                            )<a name='38'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_8"><a name='39'>
    USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_8"><a name='40'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_11">, ONLY : domain<a name='41'>
    USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_9">, ONLY : grid_config_rec_type, model_config_rec<a name='42'>
#ifdef DM_PARALLEL<a name='43'>
    USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_7">, ONLY : local_communicator, mytask, ntasks, ntasks_x, ntasks_y, local_communicator_periodic, &amp;<a name='44'>
                          wrf_dm_maxval, wrf_err_message, local_communicator_x, local_communicator_y<a name='45'>
    USE <A href='../../html_code/frame/module_comm_dm.F.html#MODULE_COMM_DM'>module_comm_dm</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_COMM_DM_4">, ONLY : halo_em_tke_c_sub,halo_em_tke_d_sub,halo_em_tke_e_sub            &amp;<a name='46'>
            ,halo_em_phys_pbl_sub,halo_em_phys_shcu_sub &amp;<a name='47'>
            ,halo_em_fdda_sub,halo_em_phys_diffusion_sub,halo_em_tke_3_sub &amp;<a name='48'>
            ,halo_em_tke_5_sub,halo_obs_nudge_sub,period_bdy_em_a1_sub,period_bdy_em_phy_bc_sub &amp;<a name='49'>
            ,period_bdy_em_fdda_bc_sub,period_bdy_em_chem_sub,halo_em_phys_cu_sub,halo_em_helicity_sub<a name='50'>
#endif<a name='51'>
<a name='52'>
    USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_2"><a name='53'>
    USE <A href='../../html_code/dyn_em/module_diffusion_em.F.html#MODULE_DIFFUSION_EM'>module_diffusion_em</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DIFFUSION_EM_1">, ONLY : phy_bc, cal_deform_and_div, compute_diff_metrics, &amp;<a name='54'>
                                    vertical_diffusion_2, horizontal_diffusion_2, calculate_km_kh, &amp;<a name='55'>
                                    tke_rhs, cal_helicity<a name='56'>
    USE <A href='../../html_code/dyn_em/module_em.F.html#MODULE_EM'>module_em</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_EM_2">, ONLY : calculate_phy_tend<a name='57'>
    USE <A href='../../html_code/phys/module_fddaobs_driver.F.html#MODULE_FDDAOBS_DRIVER'>module_fddaobs_driver</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FDDAOBS_DRIVER_1">, ONLY : fddaobs_driver<a name='58'>
    USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_6">, ONLY : set_physical_bc3d, set_physical_bc2d<a name='59'>
    USE <A href='../../html_code/phys/module_physics_addtendc.F.html#MODULE_PHYSICS_ADDTENDC'>module_physics_addtendc</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PHYSICS_ADDTENDC_1">, ONLY : update_phy_ten<a name='60'>
<a name='61'>
    USE <A href='../../html_code/dyn_em/module_sfs_driver.F.html#MODULE_SFS_DRIVER'>module_sfs_driver</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SFS_DRIVER_1"> <font color=#447700>!JDM<a name='62'></font>
    USE <A href='../../html_code/dyn_em/module_stoch.F.html#MODULE_STOCH'>module_stoch</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STOCH_1">, ONLY : update_stoch_ten, perturb_physics_tend,RAND_PERT_UPDATE<a name='63'>
<a name='64'>
<a name='65'>
    IMPLICIT NONE<a name='66'>
<a name='67'>
    TYPE ( domain ), INTENT(INOUT) :: grid<a name='68'>
    TYPE ( grid_config_rec_type ), INTENT(IN) :: config_flags<a name='69'>
<a name='70'>
    INTEGER, INTENT(IN) :: ids, ide, jds, jde, kds, kde,     &amp;<a name='71'>
                           ims, ime, jms, jme, kms, kme,     &amp;<a name='72'>
                           ips, ipe, jps, jpe, kps, kpe,     &amp;<a name='73'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,    &amp;<a name='74'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,    &amp;<a name='75'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,    &amp;<a name='76'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey<a name='77'>
<a name='78'>
<a name='79'>
<a name='80'>
    LOGICAL ,INTENT(IN)                        :: adapt_step_flag<a name='81'>
    REAL, INTENT(IN)                           :: curr_secs<a name='82'>
<a name='83'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_moist),INTENT(INOUT)   :: moist<a name='84'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_moist),INTENT(INOUT)   :: moist_tend<a name='85'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_chem),INTENT(INOUT)   :: chem<a name='86'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_chem),INTENT(INOUT)   :: chem_tend<a name='87'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_tracer),INTENT(INOUT)   :: tracer<a name='88'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_tracer),INTENT(INOUT)   :: tracer_tend<a name='89'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_scalar),INTENT(INOUT)   :: scalar<a name='90'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_scalar),INTENT(INOUT)   :: scalar_tend<a name='91'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,num_fdda3d),INTENT(INOUT)  :: fdda3d<a name='92'>
    REAL    ,DIMENSION(ims:ime,1:1,jms:jme,num_fdda2d),INTENT(INOUT)      :: fdda2d<a name='93'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: psim<a name='94'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: psih<a name='95'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: wspd<a name='96'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: gz1oz0<a name='97'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: chklowq<a name='98'>
    LOGICAL ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: cu_act_flag<a name='99'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT)         :: hol<a name='100'>
<a name='101'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: th_phy<a name='102'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: pi_phy<a name='103'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: p_phy<a name='104'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: t_phy<a name='105'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: dz8w<a name='106'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: p8w<a name='107'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: t8w<a name='108'>
<a name='109'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: ru_tendf<a name='110'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: rv_tendf<a name='111'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: rw_tendf<a name='112'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: ph_tendf<a name='113'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: t_tendf<a name='114'>
    REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(INOUT) :: tke_tend<a name='115'>
<a name='116'>
    REAL    ,DIMENSION(ims:ime,jms:jme), INTENT(INOUT) :: mu_tendf<a name='117'>
<a name='118'>
    INTEGER , INTENT(IN)                          ::  k_start, k_end<a name='119'>
<a name='120'>
<font color=#447700>!JDM<a name='121'></font>
  INTEGER, INTENT(  IN ) :: n_nba_mij, n_nba_rij<a name='122'>
<a name='123'>
  REAL ,DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,n_nba_mij) &amp;<a name='124'>
  :: nba_mij<a name='125'>
<a name='126'>
  REAL ,DIMENSION(grid%sm31:grid%em31,grid%sm32:grid%em32,grid%sm33:grid%em33,n_nba_rij) &amp;<a name='127'>
  :: nba_rij<a name='128'>
<a name='129'>
<font color=#447700>! Local<a name='130'></font>
<a name='131'>
    REAL, DIMENSION( ims:ime, jms:jme ) :: ht_loc<a name='132'>
    REAL :: scale_factor<a name='133'>
    INTEGER, DIMENSION( ims:ime, jms:jme ) :: shadowmask <a name='134'>
    INTEGER                             :: ij<a name='135'>
    INTEGER  num_roof_layers<a name='136'>
    INTEGER  num_wall_layers<a name='137'>
    INTEGER  num_road_layers<a name='138'>
    INTEGER  iswater<a name='139'>
    INTEGER  rk_step <a name='140'>
<a name='141'>
#if ( WRF_DFI_RADAR == 1 )<a name='142'>
    INTEGER  i_start,i_end,j_start,j_end,i,j,k<a name='143'>
#endif<a name='144'>
<a name='145'>
 <font color=#447700>! initialize all tendencies to zero in order to update physics<a name='146'></font>
 <font color=#447700>! tendencies first (separate from dry dynamics).<a name='147'></font>
<a name='148'>
   rk_step = 1<a name='149'>
<a name='150'>
      IF ((grid%skebs_on==1).and.(grid%id .EQ. 1 )) then<a name='151'>
          <font color=#447700>! update and backtransform T<a name='152'></font>
          CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_1">(grid,'T',                                     &amp;<a name='153'>
                          grid%SPTFORCS,grid%SPTFORCC,                        &amp;<a name='154'>
                          grid%SPT_AMP,grid%ALPH_T,                           &amp;<a name='155'>
                          ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='156'>
                          ids, ide, jds, jde, kds, kde,                       &amp;<a name='157'>
                          ims, ime, jms, jme, kms, kme,                       &amp;<a name='158'>
                          k_start, k_end,                                     &amp;<a name='159'>
                          imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='160'>
                          ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='161'>
                          imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='162'>
                          ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='163'>
                          grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='164'>
                          grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='165'>
                          config_flags%restart, grid%iseedarr_skebs,          &amp;<a name='166'>
                          grid%DX,grid%DY,grid%skebs_vertstruc,               &amp;<a name='167'>
                          grid%rt_tendf_stoch,                                &amp;<a name='168'>
                          grid%stddev_cutoff_sppt,grid%gridpt_stddev_sppt, &amp; <a name='169'>
                          grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPUV      )<a name='170'>
          <font color=#447700>! Update streamfunction, backtransform U<a name='171'></font>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_2">(grid,'U',                                    &amp;<a name='172'>
                           grid%SPSTREAMFORCS,grid%SPSTREAMFORCC,             &amp;<a name='173'>
                           grid%SPSTREAM_AMP,grid%ALPH_PSI,                   &amp;<a name='174'>
                           ips, ipe, jps, jpe, kps, kpe,                      &amp;<a name='175'>
                           ids, ide, jds, jde, kds, kde,                      &amp;<a name='176'>
                           ims, ime, jms, jme, kms, kme,                      &amp;<a name='177'>
                           k_start, k_end,                                    &amp;<a name='178'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                     &amp;<a name='179'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                     &amp;<a name='180'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                     &amp;<a name='181'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                     &amp;<a name='182'>
                           grid% num_stoch_levels,grid% num_stoch_levels,     &amp;<a name='183'>
                           grid% num_stoch_levels,grid% num_stoch_levels,     &amp;<a name='184'>
                           config_flags%restart, grid%iseedarr_skebs,         &amp;<a name='185'>
                           grid%DX,grid%DY,grid%skebs_vertstruc,              &amp;<a name='186'>
                           grid%ru_tendf_stoch,                               &amp;<a name='187'>
                           grid%stddev_cutoff_sppt,grid%gridpt_stddev_sppt, &amp; <a name='188'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPUV     )<a name='189'>
          <font color=#447700>! Don't update streamfunction, backtransform V<a name='190'></font>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_3">(grid,'V',                                    &amp;<a name='191'>
                           grid%SPSTREAMFORCS,grid%SPSTREAMFORCC,             &amp;<a name='192'>
                           grid%SPSTREAM_AMP,grid%ALPH_PSI,                   &amp;<a name='193'>
                           ips, ipe, jps, jpe, kps, kpe,                      &amp;<a name='194'>
                           ids, ide, jds, jde, kds, kde,                      &amp;<a name='195'>
                           ims, ime, jms, jme, kms, kme,                      &amp;<a name='196'>
                           k_start, k_end,                                    &amp;<a name='197'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                     &amp;<a name='198'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                     &amp;<a name='199'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                     &amp;<a name='200'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                     &amp;<a name='201'>
                           grid% num_stoch_levels,grid% num_stoch_levels,     &amp;<a name='202'>
                           grid% num_stoch_levels,grid% num_stoch_levels,     &amp;<a name='203'>
                           config_flags%restart, grid%iseedarr_skebs,         &amp;<a name='204'>
                           grid%DX,grid%DY,grid%skebs_vertstruc,              &amp;<a name='205'>
                           grid%rv_tendf_stoch,                               &amp;<a name='206'>
                           grid%stddev_cutoff_sppt,grid%gridpt_stddev_sppt, &amp; <a name='207'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT      )<a name='208'>
       ENDIF <font color=#447700>!skebs_on <a name='209'></font>
<a name='210'>
     if ((grid%sppt_on==1).and.(grid%id .EQ. 1 )) then<a name='211'>
          CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_4">(grid,'T',                                     &amp;<a name='212'>
                          grid%SPPTFORCS,grid%SPPTFORCC,                      &amp;<a name='213'>
                          grid%SPPT_AMP,grid%ALPH_SPPT,                       &amp;<a name='214'>
                          ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='215'>
                          ids, ide, jds, jde, kds, kde,                       &amp;<a name='216'>
                          ims, ime, jms, jme, kms, kme,                       &amp;<a name='217'>
                          k_start, k_end,                                     &amp;<a name='218'>
                          imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='219'>
                          ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='220'>
                          imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='221'>
                          ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='222'>
                          grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='223'>
                          grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='224'>
                          config_flags%restart, grid%iseedarr_sppt,           &amp;<a name='225'>
                          grid%DX,grid%DY,grid%sppt_vertstruc,                &amp;<a name='226'>
                          grid%rstoch,                                        &amp;<a name='227'>
                          grid%stddev_cutoff_sppt,grid%gridpt_stddev_sppt, &amp; <a name='228'>
                          grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT       )<a name='229'>
       ENDIF <font color=#447700>!sppt_on<a name='230'></font>
<a name='231'>
      if ((grid%rand_perturb_on==1).and.(grid%id .EQ. 1 )) then<a name='232'>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_5">(grid,'T',                                     &amp;<a name='233'>
                           grid%SPFORCS,grid%SPFORCC,                          &amp;<a name='234'>
                           grid%SP_AMP,grid%ALPH_RAND,                         &amp;<a name='235'>
                           ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='236'>
                           ids, ide, jds, jde, kds, kde,                       &amp;<a name='237'>
                           ims, ime, jms, jme, kms, kme,                       &amp;<a name='238'>
                           k_start, k_end,                                     &amp;<a name='239'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='240'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='241'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='242'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='243'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='244'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='245'>
                           config_flags%restart, grid%iseedarr_rand_pert,      &amp;<a name='246'>
                           grid%DX,grid%DY,grid%rand_pert_vertstruc,           &amp;<a name='247'>
                           grid%RAND_PERT,                                     &amp;<a name='248'>
                           grid%stddev_cutoff_rand_pert,grid%gridpt_stddev_rand_pert, &amp; <a name='249'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT       )<a name='250'>
      ENDIF <font color=#447700>!rand_perturb_on<a name='251'></font>
      if ((grid%spp_conv==1).and.(grid%id .EQ. 1 )) then<a name='252'>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_6">(grid,'T',                                     &amp;<a name='253'>
                           grid%SPFORCS2,grid%SPFORCC2,                        &amp;<a name='254'>
                           grid%SP_AMP2,grid%ALPH_RAND2,                       &amp;<a name='255'>
                           ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='256'>
                           ids, ide, jds, jde, kds, kde,                       &amp;<a name='257'>
                           ims, ime, jms, jme, kms, kme,                       &amp;<a name='258'>
                           k_start, k_end,                                     &amp;<a name='259'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='260'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='261'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='262'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='263'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='264'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='265'>
                           config_flags%restart, grid%iseedarr_spp_conv,          &amp;<a name='266'>
                           grid%DX,grid%DY,grid%vertstruc_spp_conv,            &amp;<a name='267'>
                           grid%pattern_spp_conv,                             &amp; <a name='268'>
                           grid%stddev_cutoff_spp_conv,grid%gridpt_stddev_spp_conv, &amp; <a name='269'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT       )<a name='270'>
      ENDIF <font color=#447700>!spp_conv<a name='271'></font>
      if ((grid%spp_pbl==1).and.(grid%id .EQ. 1 )) then<a name='272'>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_7">(grid,'T',                                     &amp;<a name='273'>
                           grid%SPFORCS3,grid%SPFORCC3,                        &amp;<a name='274'>
                           grid%SP_AMP3,grid%ALPH_RAND3,                       &amp;<a name='275'>
                           ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='276'>
                           ids, ide, jds, jde, kds, kde,                       &amp;<a name='277'>
                           ims, ime, jms, jme, kms, kme,                       &amp;<a name='278'>
                           k_start, k_end,                                     &amp;<a name='279'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='280'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='281'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='282'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='283'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='284'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='285'>
                           config_flags%restart, grid%iseedarr_spp_pbl,           &amp;<a name='286'>
                           grid%DX,grid%DY,grid%vertstruc_spp_pbl,             &amp;<a name='287'>
                           grid%pattern_spp_pbl,                             &amp; <a name='288'>
                           grid%stddev_cutoff_spp_pbl,grid%gridpt_stddev_spp_pbl, &amp; <a name='289'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT       )<a name='290'>
      ENDIF <font color=#447700>!spp_pbl<a name='291'></font>
      if ((grid%spp_lsm==1).and.(grid%id .EQ. 1 )) then<a name='292'>
           CALL <A href='../../html_code/dyn_em/module_stoch.F.html#RAND_PERT_UPDATE'>RAND_PERT_UPDATE</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_PERT_UPDATE_8">(grid,'T',                                     &amp;<a name='293'>
                           grid%SPFORCS4,grid%SPFORCC4,                        &amp;<a name='294'>
                           grid%SP_AMP4,grid%ALPH_RAND4,                       &amp;<a name='295'>
                           ips, ipe, jps, jpe, kps, kpe,                       &amp;<a name='296'>
                           ids, ide, jds, jde, kds, kde,                       &amp;<a name='297'>
                           ims, ime, jms, jme, kms, kme,                       &amp;<a name='298'>
                           k_start, k_end,                                     &amp;<a name='299'>
                           imsx,imex,jmsx,jmex,kmsx,kmex,                      &amp;<a name='300'>
                           ipsx,ipex,jpsx,jpex,kpsx,kpex,                      &amp;<a name='301'>
                           imsy,imey,jmsy,jmey,kmsy,kmey,                      &amp;<a name='302'>
                           ipsy,ipey,jpsy,jpey,kpsy,kpey,                      &amp;<a name='303'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='304'>
                           grid%num_stoch_levels,grid%num_stoch_levels,        &amp;<a name='305'>
                           config_flags%restart, grid%iseedarr_spp_lsm,           &amp;<a name='306'>
                           grid%DX,grid%DY,grid%vertstruc_spp_lsm,             &amp;<a name='307'>
                           grid%pattern_spp_lsm,                             &amp; <a name='308'>
                           grid%stddev_cutoff_spp_lsm,grid%gridpt_stddev_spp_lsm, &amp; <a name='309'>
                           grid%VERTSTRUCC,grid%VERTSTRUCS,grid%VERTAMPT       )<a name='310'>
      ENDIF <font color=#447700>!spp_lsm<a name='311'></font>
<a name='312'>
<font color=#447700>! calculate_phy_tend<a name='313'></font>
<a name='314'>
BENCH_START(cal_phy_tend)<a name='315'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='316'></font>
      <font color=#447700>!$OMP PRIVATE ( ij )<a name='317'></font>
<a name='318'>
      DO ij = 1 , grid%num_tiles<a name='319'>
<a name='320'>
        CALL wrf_debug ( 200 , ' call calculate_phy_tend' )<a name='321'>
        CALL <A href='../../html_code/dyn_em/module_em.F.html#CALCULATE_PHY_TEND'>calculate_phy_tend</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_PHY_TEND_1"> (config_flags,grid%c1h,grid%c2h,       &amp;<a name='322'>
                     grid%mut,grid%muu,grid%muv,pi_phy,                &amp;<a name='323'>
                     grid%rthraten,                                    &amp;<a name='324'>
                     grid%rublten,grid%rvblten,grid%rthblten,          &amp;<a name='325'>
                     grid%rqvblten,grid%rqcblten,grid%rqiblten,        &amp;<a name='326'>
                     grid%rucuten,grid%rvcuten,grid%rthcuten,          &amp;<a name='327'>
                     grid%rqvcuten,grid%rqccuten,grid%rqrcuten,        &amp;<a name='328'>
                     grid%rqicuten,grid%rqscuten,                      &amp;<a name='329'>
                     grid%rushten,grid%rvshten,grid%rthshten,          &amp;<a name='330'>
                     grid%rqvshten,grid%rqcshten,grid%rqrshten,        &amp;<a name='331'>
                     grid%rqishten,grid%rqsshten,grid%rqgshten,        &amp;<a name='332'>
                     grid%RUNDGDTEN,grid%RVNDGDTEN,grid%RTHNDGDTEN,grid%RQVNDGDTEN, &amp;<a name='333'>
                     grid%RMUNDGDTEN,                                  &amp;<a name='334'>
                     scalar, scalar_tend, num_scalar,                  &amp;<a name='335'>
                     tracer, tracer_tend, num_tracer,                  &amp;<a name='336'>
                     ids,ide, jds,jde, kds,kde,                        &amp;<a name='337'>
                     ims,ime, jms,jme, kms,kme,                        &amp;<a name='338'>
                     grid%i_start(ij), min(grid%i_end(ij),ide-1),      &amp;<a name='339'>
                     grid%j_start(ij), min(grid%j_end(ij),jde-1),      &amp;<a name='340'>
                     k_start    , min(k_end,kde-1)                     )<a name='341'>
<a name='342'>
      ENDDO<a name='343'>
      <font color=#447700>!$OMP END PARALLEL DO<a name='344'></font>
BENCH_END(cal_phy_tend)<a name='345'>
<a name='346'>
<font color=#447700>! tke diffusion<a name='347'></font>
<a name='348'>
       IF(config_flags%diff_opt .eq. 2 .OR. config_flags%diff_opt .eq. 1) THEN<a name='349'>
<a name='350'>
BENCH_START(comp_diff_metrics_tim)<a name='351'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='352'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='353'></font>
         DO ij = 1 , grid%num_tiles<a name='354'>
           CALL wrf_debug ( 200 , ' call compute_diff_metrics ' )<a name='355'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#COMPUTE_DIFF_METRICS'>compute_diff_metrics</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_DIFF_METRICS_1"> ( config_flags, grid%ph_2, grid%phb, grid%z, grid%rdz, grid%rdzw, &amp;<a name='356'>
                                       grid%zx, grid%zy, grid%rdx, grid%rdy,                      &amp;<a name='357'>
                                       ids, ide, jds, jde, kds, kde,          &amp;<a name='358'>
                                       ims, ime, jms, jme, kms, kme,          &amp;<a name='359'>
                                       grid%i_start(ij), grid%i_end(ij),      &amp;<a name='360'>
                                       grid%j_start(ij), grid%j_end(ij),      &amp;<a name='361'>
                                       k_start    , k_end                    )<a name='362'>
         ENDDO<a name='363'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='364'></font>
BENCH_END(comp_diff_metrics_tim)<a name='365'>
<a name='366'>
#ifdef DM_PARALLEL<a name='367'>
#  include "<A href='../../html_code/include/HALO_EM_TKE_C.inc.html'>HALO_EM_TKE_C.inc</A>"<A NAME="HALO_EM_TKE_C.inc_1"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='368'>
#  include "<A href='../../html_code/include/PERIOD_BDY_EM_A1.inc.html'>PERIOD_BDY_EM_A1.inc</A>"<A NAME="PERIOD_BDY_EM_A1.inc_2"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='369'>
#endif<a name='370'>
<a name='371'>
BENCH_START(tke_diff_bc_tim)<a name='372'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='373'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='374'></font>
<a name='375'>
         DO ij = 1 , grid%num_tiles<a name='376'>
<a name='377'>
           CALL wrf_debug ( 200 , ' call bc for diffusion_metrics ' )<a name='378'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_73">( grid%rdzw , 'w', config_flags,           &amp;<a name='379'>
                                   ids, ide, jds, jde, kds, kde,       &amp;<a name='380'>
                                   ims, ime, jms, jme, kms, kme,       &amp;<a name='381'>
                                   ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='382'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='383'>
                                   grid%j_start(ij), grid%j_end(ij),   &amp;<a name='384'>
                                   k_start    , k_end                 )<a name='385'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_74">( grid%rdz , 'w', config_flags,            &amp;<a name='386'>
                                   ids, ide, jds, jde, kds, kde,       &amp;<a name='387'>
                                   ims, ime, jms, jme, kms, kme,       &amp;<a name='388'>
                                   ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='389'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='390'>
                                   grid%j_start(ij), grid%j_end(ij),   &amp;<a name='391'>
                                   k_start    , k_end                 )<a name='392'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_75">( grid%z , 'w', config_flags,              &amp;<a name='393'>
                                   ids, ide, jds, jde, kds, kde,       &amp;<a name='394'>
                                   ims, ime, jms, jme, kms, kme,       &amp;<a name='395'>
                                   ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='396'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='397'>
                                   grid%j_start(ij), grid%j_end(ij),   &amp;<a name='398'>
                                   k_start    , k_end                 )<a name='399'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_76">( grid%zx , 'e', config_flags,             &amp;<a name='400'>
                                   ids, ide, jds, jde, kds, kde,       &amp;<a name='401'>
                                   ims, ime, jms, jme, kms, kme,       &amp;<a name='402'>
                                   ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='403'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='404'>
                                   grid%j_start(ij), grid%j_end(ij),   &amp;<a name='405'>
                                   k_start    , k_end                 )<a name='406'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D'>set_physical_bc3d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC3D_77">( grid%zy , 'f', config_flags,             &amp;<a name='407'>
                                   ids, ide, jds, jde, kds, kde,       &amp;<a name='408'>
                                   ims, ime, jms, jme, kms, kme,       &amp;<a name='409'>
                                   ips, ipe, jps, jpe, kps, kpe,       &amp;<a name='410'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='411'>
                                   grid%j_start(ij), grid%j_end(ij),   &amp;<a name='412'>
                                   k_start    , k_end                 )<a name='413'>
           CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_10">( grid%ustm, 't', config_flags,            &amp;<a name='414'>
                                   ids, ide, jds, jde,                 &amp;<a name='415'>
                                   ims, ime, jms, jme,                 &amp;<a name='416'>
                                   ips, ipe, jps, jpe,                 &amp;<a name='417'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='418'>
                                   grid%j_start(ij), grid%j_end(ij)   )<a name='419'>
          CALL <A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D'>set_physical_bc2d</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICAL_BC2D_11">( grid%ust, 't', config_flags,              &amp;<a name='420'>
                                   ids, ide, jds, jde,                 &amp;<a name='421'>
                                   ims, ime, jms, jme,                 &amp;<a name='422'>
                                   ips, ipe, jps, jpe,                 &amp;<a name='423'>
                                   grid%i_start(ij), grid%i_end(ij),   &amp;<a name='424'>
                                   grid%j_start(ij), grid%j_end(ij)   )<a name='425'>
 <a name='426'>
         ENDDO<a name='427'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='428'></font>
BENCH_END(tke_diff_bc_tim)<a name='429'>
<a name='430'>
BENCH_START(deform_div_tim)<a name='431'>
<a name='432'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='433'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='434'></font>
<a name='435'>
         DO ij = 1 , grid%num_tiles<a name='436'>
<a name='437'>
           CALL wrf_debug ( 200 , ' call cal_deform_and_div' )<a name='438'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CAL_DEFORM_AND_DIV'>cal_deform_and_div</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CAL_DEFORM_AND_DIV_1"> ( config_flags,grid%u_2,grid%v_2,grid%w_2,grid%div,  &amp;<a name='439'>
                                     grid%defor11,grid%defor22,grid%defor33,            &amp;<a name='440'>
                                     grid%defor12,grid%defor13,grid%defor23,            &amp;<a name='441'>
                                     nba_rij, n_nba_rij,                                &amp; <font color=#447700>!JDM<a name='442'></font>
                                     grid%u_base, grid%v_base,grid%msfux,grid%msfuy,    &amp;<a name='443'>
                                     grid%msfvx,grid%msfvy,grid%msftx,grid%msfty,       &amp;<a name='444'>
                                     grid%rdx, grid%rdy, grid%dn, grid%dnw, grid%rdz,   &amp;<a name='445'>
                                     grid%rdzw,grid%fnm,grid%fnp,grid%cf1,grid%cf2,     &amp;<a name='446'>
                                     grid%cf3,grid%zx,grid%zy,            &amp;<a name='447'>
                                     ids, ide, jds, jde, kds, kde,        &amp;<a name='448'>
                                     ims, ime, jms, jme, kms, kme,        &amp;<a name='449'>
                                     grid%i_start(ij), grid%i_end(ij),    &amp;<a name='450'>
                                     grid%j_start(ij), grid%j_end(ij),    &amp;<a name='451'>
                                     k_start    , k_end                  )<a name='452'>
         ENDDO<a name='453'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='454'></font>
BENCH_END(deform_div_tim)<a name='455'>
<a name='456'>
<font color=#447700>! Updraft helicity between output times<a name='457'></font>
<a name='458'>
#ifdef DM_PARALLEL<a name='459'>
#     include "<A href='../../html_code/include/HALO_EM_HELICITY.inc.html'>HALO_EM_HELICITY.inc</A>"<A NAME="HALO_EM_HELICITY.inc_3"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='460'>
#endif<a name='461'>
<a name='462'>
       IF ( ( config_flags%nwp_diagnostics .eq. 1 ) .OR. &amp;<a name='463'>
            ( ( config_flags%afwa_diag_opt .eq. 1 ) .AND. ( config_flags%afwa_severe_opt .EQ. 1 ) ) ) THEN<a name='464'>
BENCH_START(helicity_tim)<a name='465'>
<a name='466'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='467'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='468'></font>
<a name='469'>
       DO ij = 1 , grid%num_tiles<a name='470'>
<a name='471'>
          CALL wrf_debug ( 200 , ' call cal_helicity' )<a name='472'>
          CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CAL_HELICITY'>cal_helicity</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CAL_HELICITY_1"> ( config_flags,grid%u_2,grid%v_2,grid%w_2,  &amp;<a name='473'>
                              grid%uh,                             &amp;<a name='474'>
                              grid%up_heli_max,                    &amp;<a name='475'>
                              grid%ph_2,grid%phb,                  &amp;<a name='476'>
                              grid%msfux,grid%msfuy,               &amp;<a name='477'>
                              grid%msfvx,grid%msfvy,               &amp;<a name='478'>
                              grid%ht,                             &amp;<a name='479'>
                              grid%rdx, grid%rdy, grid%dn, grid%dnw, grid%rdz, grid%rdzw,   &amp;<a name='480'>
                              grid%fnm,grid%fnp,grid%cf1,grid%cf2,grid%cf3,grid%zx,grid%zy, &amp;<a name='481'>
                              ids, ide, jds, jde, kds, kde,        &amp;<a name='482'>
                              ims, ime, jms, jme, kms, kme,        &amp;<a name='483'>
                              grid%i_start(ij), grid%i_end(ij),    &amp;<a name='484'>
                              grid%j_start(ij), grid%j_end(ij),    &amp;<a name='485'>
                              k_start    , k_end                  )<a name='486'>
       ENDDO<a name='487'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='488'></font>
BENCH_END(helicity_tim)<a name='489'>
       ENDIF<a name='490'>
<a name='491'>
#ifdef DM_PARALLEL<a name='492'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_D.inc.html'>HALO_EM_TKE_D.inc</A>"<A NAME="HALO_EM_TKE_D.inc_4"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='493'>
#endif<a name='494'>
<a name='495'>
<font color=#447700>! calculate tke, kmh, and kmv<a name='496'></font>
<a name='497'>
BENCH_START(calc_tke_tim)<a name='498'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='499'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='500'></font>
         DO ij = 1 , grid%num_tiles<a name='501'>
<a name='502'>
           CALL wrf_debug ( 200 , ' call calculate_km_kh' )<a name='503'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#CALCULATE_KM_KH'>calculate_km_kh</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCULATE_KM_KH_1">( config_flags,grid%dt,grid%dampcoef,grid%zdamp,         &amp;<a name='504'>
                                 config_flags%damp_opt,                                 &amp;<a name='505'>
                                 grid%xkmh,grid%xkmv,grid%xkhh,grid%xkhv,grid%bn2,      &amp;<a name='506'>
                                 grid%khdif,grid%kvdif,grid%div,                        &amp;<a name='507'>
                                 grid%defor11,grid%defor22,grid%defor33,grid%defor12,   &amp;<a name='508'>
                                 grid%defor13,grid%defor23,                             &amp;<a name='509'>
                                 grid%tke_2,p8w,t8w,th_phy,                             &amp;<a name='510'>
                                 t_phy,p_phy,moist,grid%dn,grid%dnw,                    &amp;<a name='511'>
                                 grid%dx,grid%dy,grid%rdz,grid%rdzw,                    &amp;<a name='512'>
                                 config_flags%mix_isotropic,num_moist,                  &amp;<a name='513'>
                                 grid%cf1, grid%cf2, grid%cf3, grid%warm_rain,          &amp;<a name='514'>
                                 grid%mix_upper_bound,                                  &amp;<a name='515'>
                                 grid%msftx, grid%msfty,                                &amp;<a name='516'>
                                 grid%zx, grid%zy,                                      &amp; <a name='517'>
                                 ids,ide, jds,jde, kds,kde,                             &amp;<a name='518'>
                                 ims,ime, jms,jme, kms,kme,                             &amp;<a name='519'>
                                 grid%i_start(ij), grid%i_end(ij),                      &amp;<a name='520'>
                                 grid%j_start(ij), grid%j_end(ij),                      &amp;<a name='521'>
                                 k_start    , k_end                          )<a name='522'>
         ENDDO<a name='523'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='524'></font>
BENCH_END(calc_tke_tim)<a name='525'>
<a name='526'>
#ifdef DM_PARALLEL<a name='527'>
#     include "<A href='../../html_code/include/HALO_EM_TKE_E.inc.html'>HALO_EM_TKE_E.inc</A>"<A NAME="HALO_EM_TKE_E.inc_5"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='528'>
#endif<a name='529'>
<a name='530'>
       ENDIF<a name='531'>
<a name='532'>
#ifdef DM_PARALLEL<a name='533'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_PHY_BC.inc.html'>PERIOD_BDY_EM_PHY_BC.inc</A>"<A NAME="PERIOD_BDY_EM_PHY_BC.inc_6"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='534'>
       IF ( config_flags%grid_fdda .eq. 1) THEN<a name='535'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_FDDA_BC.inc.html'>PERIOD_BDY_EM_FDDA_BC.inc</A>"<A NAME="PERIOD_BDY_EM_FDDA_BC.inc_7"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='536'>
       ENDIF<a name='537'>
#      include "<A href='../../html_code/include/PERIOD_BDY_EM_CHEM.inc.html'>PERIOD_BDY_EM_CHEM.inc</A>"<A NAME="PERIOD_BDY_EM_CHEM.inc_8"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='538'>
#endif<a name='539'>
<a name='540'>
BENCH_START(phy_bc_tim)<a name='541'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='542'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='543'></font>
<a name='544'>
       DO ij = 1 , grid%num_tiles<a name='545'>
<a name='546'>
         CALL wrf_debug ( 200 , ' call phy_bc' )<a name='547'>
         CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#PHY_BC'>phy_bc</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_BC_1"> (config_flags,grid%div,grid%defor11,grid%defor22,grid%defor33,            &amp;<a name='548'>
                      grid%defor12,grid%defor13,grid%defor23,      &amp;<a name='549'>
                      grid%xkmh,grid%xkmv,grid%xkhh,grid%xkhv,     &amp;<a name='550'>
                      grid%tke_2,grid%rho,                         &amp;<a name='551'>
                      grid%rublten, grid%rvblten,                  &amp;<a name='552'>
                      grid%rucuten, grid%rvcuten,                  &amp;<a name='553'>
                      grid%rushten, grid%rvshten,                  &amp;<a name='554'>
                      ids, ide, jds, jde, kds, kde,                &amp;<a name='555'>
                      ims, ime, jms, jme, kms, kme,                &amp;<a name='556'>
                      ips, ipe, jps, jpe, kps, kpe,                &amp;<a name='557'>
                      grid%i_start(ij), grid%i_end(ij),            &amp;<a name='558'>
                      grid%j_start(ij), grid%j_end(ij),            &amp;<a name='559'>
                      k_start    , k_end                           )<a name='560'>
       ENDDO<a name='561'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='562'></font>
BENCH_END(phy_bc_tim)<a name='563'>
<a name='564'>
<font color=#447700>!JDM<a name='565'></font>
IF ( ( config_flags%sfs_opt .GT. 0 ) .AND. ( config_flags%diff_opt .eq. 2 ) ) THEN<a name='566'>
<a name='567'>
 CALL <A href='../../html_code/dyn_em/module_sfs_driver.F.html#SFS_DRIVER'>sfs_driver</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SFS_DRIVER_1">( grid, config_flags,     &amp;<a name='568'>
                  nba_mij, n_nba_mij,     &amp; <a name='569'>
                  nba_rij, n_nba_rij      ) <a name='570'>
<a name='571'>
ENDIF<a name='572'>
<a name='573'>
#ifdef DM_PARALLEL<a name='574'>
<font color=#447700>!-----------------------------------------------------------------------<a name='575'></font>
<font color=#447700>!<a name='576'></font>
<font color=#447700>! MPP for some physics tendency, km, kh, deformation, and divergence<a name='577'></font>
<font color=#447700>!<a name='578'></font>
<font color=#447700>!                                                         * * * * * * *<a name='579'></font>
<font color=#447700>!                                            * * * * *    * * * * * * *<a name='580'></font>
<font color=#447700>!               *                     *      * * * * *    * * * * * * *<a name='581'></font>
<font color=#447700>!             * + *      * + *        +      * * + * *    * * * + * * *<a name='582'></font>
<font color=#447700>!               *                     *      * * * * *    * * * * * * *<a name='583'></font>
<font color=#447700>!                                            * * * * *    * * * * * * *<a name='584'></font>
<font color=#447700>!                                                         * * * * * * *<a name='585'></font>
<font color=#447700>!<a name='586'></font>
<font color=#447700>! (for PBL)<a name='587'></font>
<font color=#447700>! rublten                  x<a name='588'></font>
<font color=#447700>! rvblten                             x<a name='589'></font>
<font color=#447700>!<a name='590'></font>
<font color=#447700>! (for Cumulus)<a name='591'></font>
<font color=#447700>! rucuten                  x<a name='592'></font>
<font color=#447700>! rvcuten                             x<a name='593'></font>
<font color=#447700>!<a name='594'></font>
<font color=#447700>! (for Shallow Cumulus)<a name='595'></font>
<font color=#447700>! rushten                  x<a name='596'></font>
<font color=#447700>! rvshten                             x<a name='597'></font>
<font color=#447700>!<a name='598'></font>
<font color=#447700>! (for FDDA)<a name='599'></font>
<font color=#447700>! rundgdten     x<a name='600'></font>
<font color=#447700>! rvndgdten     x<a name='601'></font>
<font color=#447700>!<a name='602'></font>
<font color=#447700>! (for TKE3)<a name='603'></font>
<font color=#447700>! tke_2                                          x               <a name='604'></font>
<font color=#447700>! (for TKE5)<a name='605'></font>
<font color=#447700>! tke_2                                                         x<a name='606'></font>
<font color=#447700>!<a name='607'></font>
<font color=#447700>! (for diff_opt &gt;= 1)<a name='608'></font>
<font color=#447700>! defor11                  x<a name='609'></font>
<font color=#447700>! defor22                             x<a name='610'></font>
<font color=#447700>! defor12       x<a name='611'></font>
<font color=#447700>! defor13                  x<a name='612'></font>
<font color=#447700>! defor23                             x<a name='613'></font>
<font color=#447700>! div           x<a name='614'></font>
<font color=#447700>! xkmv          x<a name='615'></font>
<font color=#447700>! xkmh          x<a name='616'></font>
<font color=#447700>! xkhv          x<a name='617'></font>
<font color=#447700>! xkhh          x<a name='618'></font>
<font color=#447700>! tke           x<a name='619'></font>
<font color=#447700>!<a name='620'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='621'></font>
       IF ( config_flags%bl_pbl_physics .ge. 1 ) THEN<a name='622'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_PBL.inc.html'>HALO_EM_PHYS_PBL.inc</A>"<A NAME="HALO_EM_PHYS_PBL.inc_9"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='623'>
       ENDIF<a name='624'>
       IF ( config_flags%shcu_physics .gt. 1 ) THEN<a name='625'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_SHCU.inc.html'>HALO_EM_PHYS_SHCU.inc</A>"<A NAME="HALO_EM_PHYS_SHCU.inc_10"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='626'>
       ENDIF<a name='627'>
       IF ( config_flags%cu_physics == SASSCHEME      .or.   &amp;<a name='628'>
            config_flags%cu_physics == TIEDTKESCHEME  .or.   &amp;<a name='629'>
            config_flags%cu_physics == NTIEDTKESCHEME .or.   &amp;<a name='630'>
            config_flags%cu_physics == CAMZMSCHEME    .or.   &amp;<a name='631'>
            config_flags%cu_physics == SCALESASSCHEME .or.   &amp;<a name='632'>
            config_flags%cu_physics == NSASSCHEME ) THEN<a name='633'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_CU.inc.html'>HALO_EM_PHYS_CU.inc</A>"<A NAME="HALO_EM_PHYS_CU.inc_11"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='634'>
       ENDIF<a name='635'>
       IF ( config_flags%grid_fdda .ge. 1) THEN<a name='636'>
#      include "<A href='../../html_code/include/HALO_EM_FDDA.inc.html'>HALO_EM_FDDA.inc</A>"<A NAME="HALO_EM_FDDA.inc_12"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='637'>
       ENDIF<a name='638'>
       IF ( config_flags%diff_opt .ge. 1 ) THEN<a name='639'>
#      include "<A href='../../html_code/include/HALO_EM_PHYS_DIFFUSION.inc.html'>HALO_EM_PHYS_DIFFUSION.inc</A>"<A NAME="HALO_EM_PHYS_DIFFUSION.inc_13"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='640'>
       ENDIF<a name='641'>
<a name='642'>
       IF      ( config_flags%h_mom_adv_order &lt;= 4 ) THEN<a name='643'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_3.inc.html'>HALO_EM_TKE_3.inc</A>"<A NAME="HALO_EM_TKE_3.inc_14"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='644'>
       ELSE IF ( config_flags%h_mom_adv_order &lt;= 6 ) THEN<a name='645'>
#       include "<A href='../../html_code/include/HALO_EM_TKE_5.inc.html'>HALO_EM_TKE_5.inc</A>"<A NAME="HALO_EM_TKE_5.inc_15"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='646'>
       ELSE<a name='647'>
         WRITE(wrf_err_message,*)'solve_em: invalid h_mom_adv_order = ',config_flags%h_mom_adv_order<a name='648'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_24">(TRIM(wrf_err_message))<a name='649'>
       ENDIF<a name='650'>
#endif<a name='651'>
<a name='652'>
BENCH_START(update_phy_ten_tim)<a name='653'>
       <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='654'></font>
       <font color=#447700>!$OMP PRIVATE ( ij )<a name='655'></font>
<a name='656'>
       DO ij = 1 , grid%num_tiles<a name='657'>
<a name='658'>
         CALL wrf_debug ( 200 , ' call update_phy_ten' )<a name='659'>
#if ( WRF_DFI_RADAR == 1 )<a name='660'>
         if (config_flags%cu_physics .gt. 0) then<a name='661'>
           i_start = grid%i_start(ij)<a name='662'>
           i_end   = min( grid%i_end(ij),ide-1 )<a name='663'>
           j_start = grid%j_start(ij)<a name='664'>
           j_end   = min( grid%j_end(ij),jde-1 )<a name='665'>
           if (grid%dfi_stage == DFI_FWD ) &amp;<a name='666'>
                 CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_9"> ( 200 , ' Zero out cu_physics' )<a name='667'>
           DO j = j_start, j_end<a name='668'>
           DO k = k_start, min( k_end,kde-1 ) - 1<a name='669'>
           DO i = i_start, i_end<a name='670'>
             if (grid%dfi_stage ==DFI_FWD  &amp;<a name='671'>
             .and. grid%dfi_tten_rad(i,k,j) &gt;= 1.0e-7 .and.  &amp;<a name='672'>
                   grid%dfi_tten_rad(i,k,j) &lt;= 10.) then<a name='673'>
<font color=#447700>! zero out cu-param temp tendency<a name='674'></font>
                grid%rthcuten(i,k,j) = 0.0<a name='675'>
             endif<a name='676'>
           ENDDO<a name='677'>
           ENDDO<a name='678'>
           ENDDO<a name='679'>
         ENDIF<a name='680'>
#endif<a name='681'>
         CALL <A href='../../html_code/phys/module_physics_addtendc.F.html#UPDATE_PHY_TEN'>update_phy_ten</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_PHY_TEN_1">(ph_tendf,t_tendf, ru_tendf, rv_tendf,moist_tend ,&amp;<a name='682'>
                           scalar_tend, mu_tendf,                           &amp;<a name='683'>
                           grid%rthraten,grid%rthblten,grid%rthcuten,grid%rthshten, &amp;<a name='684'>
                           grid%rublten,grid%rucuten,grid%rushten,          &amp;<a name='685'>
                           grid%rvblten,grid%rvcuten,grid%rvshten,          &amp;<a name='686'>
                           grid%rqvblten,grid%rqcblten,grid%rqiblten,       &amp;<a name='687'>
                           grid%rqniblten,                                  &amp; <font color=#447700>!CAMUWPBL scheme<a name='688'></font>
                           grid%rqvcuten,grid%rqccuten,grid%rqrcuten,       &amp;<a name='689'>
                           grid%rqicuten,grid%rqscuten,                     &amp;<a name='690'>
                           grid%rqcncuten,grid%rqincuten,                   &amp; <font color=#447700>!BSINGH - Added two CU tends<a name='691'></font>
                           grid%rqvshten,grid%rqcshten,grid%rqrshten,       &amp;<a name='692'>
                           grid%rqishten,grid%rqsshten,grid%rqgshten,       &amp;<a name='693'>
                           grid%rqcnshten,grid%rqinshten,                   &amp;<font color=#447700>!BSINGH - Added two SHCU tends<a name='694'></font>
                           grid%RUNDGDTEN,                                  &amp;<a name='695'>
                           grid%RVNDGDTEN,grid%RTHNDGDTEN,grid%RPHNDGDTEN,  &amp;<a name='696'>
                           grid%RQVNDGDTEN,grid%RMUNDGDTEN,                 &amp;<a name='697'>
                           grid%rthfrten,grid%rqvfrten,                     &amp;  <font color=#447700>! fire<a name='698'></font>
                           num_moist,num_scalar,config_flags,rk_step,       &amp;<a name='699'>
                           grid%adv_moist_cond,                             &amp;<a name='700'>
                           ids, ide, jds, jde, kds, kde,                    &amp;<a name='701'>
                           ims, ime, jms, jme, kms, kme,                    &amp;<a name='702'>
                           grid%i_start(ij), grid%i_end(ij),                &amp;<a name='703'>
                           grid%j_start(ij), grid%j_end(ij),                &amp;<a name='704'>
                           k_start, k_end                               )<a name='705'>
<a name='706'>
       END DO<a name='707'>
       <font color=#447700>!$OMP END PARALLEL DO<a name='708'></font>
BENCH_END(update_phy_ten_tim)<a name='709'>
<a name='710'>
      IF (grid%skebs_on==1) then<a name='711'>
          <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='712'></font>
          <font color=#447700>!$OMP PRIVATE ( ij )<a name='713'></font>
          DO ij = 1 , grid%num_tiles<a name='714'>
               CALL wrf_debug ( 200 , ' call update_stoch_ten' )<a name='715'>
                CALL <A href='../../html_code/dyn_em/module_stoch.F.html#UPDATE_STOCH_TEN'>update_stoch_ten</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_STOCH_TEN_1">(ru_tendf, rv_tendf, t_tendf,&amp;<a name='716'>
                               grid%ru_tendf_stoch,                          &amp;<a name='717'>
                               grid%rv_tendf_stoch,                          &amp;<a name='718'>
                               grid%rt_tendf_stoch,                          &amp;<a name='719'>
                               grid%mu_2, grid%mub, grid%c1h, grid%c2h,      &amp;<a name='720'>
                               ids, ide, jds, jde, kds, kde,                 &amp;<a name='721'>
                               ims, ime, jms, jme, kms, kme,                 &amp;<a name='722'>
                               grid%i_start(ij), grid%i_end(ij),             &amp;<a name='723'>
                               grid%j_start(ij), grid%j_end(ij),             &amp;<a name='724'>
                               k_start, k_end,                               &amp;<a name='725'>
                               grid%num_stoch_levels,grid%num_stoch_levels   )<a name='726'>
<a name='727'>
           ENDDO<a name='728'>
           <font color=#447700>!$OMP END PARALLEL DO<a name='729'></font>
      ENDIF <font color=#447700>!skebs_on<a name='730'></font>
<a name='731'>
      IF (grid%sppt_on==1) then<a name='732'>
          <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='733'></font>
          <font color=#447700>!$OMP PRIVATE ( ij )<a name='734'></font>
          <font color=#447700>! JB comment:  P_QV is in moist_tend(ims,kms,jms,2)<a name='735'></font>
          DO ij = 1 , grid%num_tiles<a name='736'>
                 call <A href='../../html_code/dyn_em/module_stoch.F.html#PERTURB_PHYSICS_TEND'>perturb_physics_tend</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PERTURB_PHYSICS_TEND_1">(grid%gridpt_stddev_sppt,          &amp;<a name='737'>
                        grid%stddev_cutoff_sppt,grid%rstoch,                 &amp;<a name='738'>
                        ru_tendf,rv_tendf,t_tendf,moist_tend(ims,kms,jms,2), &amp;<a name='739'>
                        ids, ide, jds, jde, kds, kde,                        &amp;<a name='740'>
                        ims, ime, jms, jme, kms, kme,                        &amp;<a name='741'>
                        grid%i_start(ij), grid%i_end(ij),                    &amp;<a name='742'>
                        grid%j_start(ij), grid%j_end(ij),                    &amp;<a name='743'>
                        k_start, k_end,                                      &amp;<a name='744'>
                        grid%num_stoch_levels,grid%num_stoch_levels          )<a name='745'>
           ENDDO<a name='746'>
          <font color=#447700>!$OMP END PARALLEL DO<a name='747'></font>
  ENDIF<a name='748'>
<a name='749'>
#ifdef PLANET<a name='750'>
       <font color=#447700>! do rayleigh (and zonal-average newtonian) damping during<a name='751'></font>
       <font color=#447700>! first iteration of RK loop only<a name='752'></font>
<a name='753'>
=============================================================<a name='754'>
INTENTIONALLY PLACED HERE TO BREAK COMPILE<a name='755'>
The DAMPTOP routine needs to have 1d column arrays c1 and c2<a name='756'>
to correctly use the column pressures mut, muu, and muv.<a name='757'>
=============================================================<a name='758'>
<a name='759'>
       IF ( (config_flags%damp_opt == 101) .OR. &amp;<a name='760'>
            (config_flags%damp_opt == 103)      ) THEN<a name='761'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='762'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='763'></font>
         DO ij = 1 , grid%num_tiles<a name='764'>
           CALL damptop( grid%u_2, grid%v_2, grid%t_2, &amp;<a name='765'>
                         grid%mut, grid%muu, grid%muv, &amp;<a name='766'>
                         pi_phy,                                &amp;<a name='767'>
                         t_tendf, ru_tendf, rv_tendf, P2SI,     &amp;<a name='768'>
                         ids, ide, jds, jde, kds, kde,          &amp;<a name='769'>
                         ims, ime, jms, jme, kms, kme,          &amp;<a name='770'>
                         grid%i_start(ij), grid%i_end(ij),      &amp;<a name='771'>
                         grid%j_start(ij), grid%j_end(ij),      &amp;<a name='772'>
                         k_start, k_end                         )<a name='773'>
         END DO<a name='774'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='775'></font>
       END IF<a name='776'>
#endif<a name='777'>
<a name='778'>
       IF( config_flags%diff_opt .eq. 2 .and. config_flags%km_opt .eq. 2 ) THEN<a name='779'>
<a name='780'>
BENCH_START(tke_rhs_tim)<a name='781'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='782'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='783'></font>
         DO ij = 1 , grid%num_tiles<a name='784'>
<a name='785'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#TKE_RHS'>tke_rhs</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TKE_RHS_1">  ( tke_tend,grid%bn2,                           &amp;<a name='786'>
                         config_flags,grid%defor11,grid%defor22,      &amp;<a name='787'>
                         grid%defor33,                                &amp;<a name='788'>
                         grid%defor12,grid%defor13,grid%defor23,      &amp;<a name='789'>
                         grid%u_2,grid%v_2,grid%w_2,grid%div,         &amp;<a name='790'>
                         grid%tke_2,grid%mut,grid%c1h,grid%c2h,       &amp;<a name='791'>
                         th_phy,p_phy,p8w,t8w,grid%z,grid%fnm,        &amp; <a name='792'>
                         grid%fnp,grid%cf1,grid%cf2,grid%cf3,         &amp;     <a name='793'>
                         grid%msftx,grid%msfty,grid%xkmh,             &amp;<a name='794'>
                         grid%xkmv,grid%xkhv,grid%rdx,grid%rdy,       &amp;<a name='795'>
                         grid%dx,grid%dy,grid%dt,grid%zx,grid%zy,     &amp;<a name='796'>
                         grid%rdz,grid%rdzw,grid%dn,                  &amp;<a name='797'>
                         grid%dnw,config_flags%mix_isotropic,         &amp;<a name='798'>
                         grid%hfx, grid%qfx, moist(ims,kms,jms,P_QV), &amp;<a name='799'>
                         grid%ustm, grid%rho,                         &amp;<a name='800'>
                         ids, ide, jds, jde, kds, kde,                &amp;<a name='801'>
                         ims, ime, jms, jme, kms, kme,                &amp;<a name='802'>
                         grid%i_start(ij), grid%i_end(ij),            &amp;<a name='803'>
                         grid%j_start(ij), grid%j_end(ij),            &amp;<a name='804'>
                         k_start    , k_end                           )<a name='805'>
<a name='806'>
         ENDDO<a name='807'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='808'></font>
BENCH_END(tke_rhs_tim)<a name='809'>
<a name='810'>
       ENDIF<a name='811'>
<a name='812'>
<font color=#447700>! calculate vertical diffusion first and then horizontal<a name='813'></font>
<font color=#447700>! (keep this order)<a name='814'></font>
<a name='815'>
       IF(config_flags%diff_opt .eq. 2) THEN<a name='816'>
<a name='817'>
         IF (config_flags%bl_pbl_physics .eq. 0) THEN<a name='818'>
<a name='819'>
BENCH_START(vert_diff_tim)<a name='820'>
           <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='821'></font>
           <font color=#447700>!$OMP PRIVATE ( ij )<a name='822'></font>
           DO ij = 1 , grid%num_tiles<a name='823'>
<a name='824'>
             CALL wrf_debug ( 200 , ' call vertical_diffusion_2 ' )<a name='825'>
             CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#VERTICAL_DIFFUSION_2'>vertical_diffusion_2</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VERTICAL_DIFFUSION_2_1">( ru_tendf, rv_tendf, rw_tendf,            &amp;<a name='826'>
                                      t_tendf, tke_tend,                         &amp;<a name='827'>
                                      moist_tend, num_moist,                      &amp;<a name='828'>
                                      chem_tend, num_chem,                       &amp;<a name='829'>
                                      scalar_tend, num_scalar,                     &amp;<a name='830'>
                                      tracer_tend, num_tracer,                     &amp;<a name='831'>
                                      grid%u_2, grid%v_2,                                  &amp;<a name='832'>
                                      grid%t_2,grid%u_base,grid%v_base,grid%t_base,grid%qv_base,          &amp;<a name='833'>
                                      grid%tke_2, config_flags,              &amp;<a name='834'>
                                      grid%defor13,grid%defor23,grid%defor33,                   &amp;<a name='835'>
                                      nba_mij, num_nba_mij,          &amp; <font color=#447700>!JDM<a name='836'></font>
                                      grid%div, moist, chem, scalar,tracer,         &amp;<a name='837'>
                                      grid%xkmv, grid%xkhv, grid%xkmh, config_flags%km_opt,       &amp; <font color=#447700>! xkmh added Oct2013<a name='838'></font>
                                      grid%fnm, grid%fnp, grid%dn, grid%dnw, grid%rdz, grid%rdzw, &amp;<a name='839'>
                                      grid%hfx, grid%qfx, grid%ustm, grid%rho,   &amp;<a name='840'>
                                      ids, ide, jds, jde, kds, kde,              &amp;<a name='841'>
                                      ims, ime, jms, jme, kms, kme,              &amp;<a name='842'>
                                      grid%i_start(ij), grid%i_end(ij),          &amp;<a name='843'>
                                      grid%j_start(ij), grid%j_end(ij),          &amp;<a name='844'>
                                      k_start, k_end                             )<a name='845'>
<a name='846'>
           ENDDO<a name='847'>
           <font color=#447700>!$OMP END PARALLEL DO<a name='848'></font>
BENCH_END(vert_diff_tim)<a name='849'>
<a name='850'>
         ENDIF<a name='851'>
<font color=#447700>!<a name='852'></font>
BENCH_START(hor_diff_tim)<a name='853'>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='854'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='855'></font>
         DO ij = 1 , grid%num_tiles<a name='856'>
<a name='857'>
           CALL wrf_debug ( 200 , ' call horizontal_diffusion_2' )<a name='858'>
           CALL <A href='../../html_code/dyn_em/module_diffusion_em.F.html#HORIZONTAL_DIFFUSION_2'>horizontal_diffusion_2</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HORIZONTAL_DIFFUSION_2_1">( t_tendf, ru_tendf, rv_tendf, rw_tendf, &amp;<a name='859'>
                                      tke_tend,                              &amp;<a name='860'>
                                      moist_tend, num_moist,                  &amp;<a name='861'>
                                      chem_tend, num_chem,                   &amp;<a name='862'>
                                      scalar_tend, num_scalar,                 &amp;<a name='863'>
                                      tracer_tend, num_tracer,                 &amp;<a name='864'>
                                      grid%t_2, th_phy,                           &amp;<a name='865'>
                                      grid%tke_2, config_flags,              &amp;<a name='866'>
                                      grid%defor11, grid%defor22, grid%defor12,             &amp;<a name='867'>
                                      grid%defor13, grid%defor23,   &amp;<a name='868'>
                                      nba_mij, num_nba_mij,         &amp; <font color=#447700>!JDM<a name='869'></font>
                                      grid%div,                     &amp;<a name='870'>
                                      moist, chem, scalar,tracer,               &amp;<a name='871'>
                                      grid%msfux,grid%msfuy, grid%msfvx,grid%msfvy, grid%msftx,  &amp;<a name='872'>
                                      grid%msfty, grid%xkmh, grid%xkhh, config_flags%km_opt,     &amp;<a name='873'>
                                      grid%rdx, grid%rdy, grid%rdz, grid%rdzw,                   &amp;<a name='874'>
                                      grid%fnm, grid%fnp, grid%cf1, grid%cf2, grid%cf3,          &amp;<a name='875'>
                                      grid%zx, grid%zy, grid%dn, grid%dnw, grid%rho,             &amp;<a name='876'>
                                      ids, ide, jds, jde, kds, kde,          &amp;<a name='877'>
                                      ims, ime, jms, jme, kms, kme,          &amp;<a name='878'>
                                      grid%i_start(ij), grid%i_end(ij),      &amp;<a name='879'>
                                      grid%j_start(ij), grid%j_end(ij),      &amp;<a name='880'>
                                      k_start    , k_end                    )<a name='881'>
         ENDDO<a name='882'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='883'></font>
BENCH_END(hor_diff_tim)<a name='884'>
       ENDIF<a name='885'>
<a name='886'>
       IF ( grid%obs_nudge_opt .EQ. 1 .AND. grid%xtime &lt;= grid%fdda_end ) THEN<a name='887'>
# ifdef DM_PARALLEL<a name='888'>
#       include "<A href='../../html_code/include/HALO_OBS_NUDGE.inc.html'>HALO_OBS_NUDGE.inc</A>"<A NAME="HALO_OBS_NUDGE.inc_16"><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='889'>
#endif<a name='890'>
<font color=#447700>!***********************************************************************<a name='891'></font>
<font color=#447700>! This section for obs nudging<a name='892'></font>
         <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='893'></font>
         <font color=#447700>!$OMP PRIVATE ( ij )<a name='894'></font>
<a name='895'>
         DO ij = 1 , grid%num_tiles<a name='896'>
<a name='897'>
           CALL <A href='../../html_code/phys/module_fddaobs_driver.F.html#FDDAOBS_DRIVER'>fddaobs_driver</A><A href='../../html_code/dyn_em/module_first_rk_step_part2.F.html#FIRST_RK_STEP_PART2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FDDAOBS_DRIVER_1"> (grid%grid_id, model_config_rec%grid_id, &amp;<a name='898'>
                   model_config_rec%parent_id, config_flags%restart,    &amp;<a name='899'>
                   config_flags,                                        &amp;<a name='900'>
                   grid%obs_nudge_opt,                                  &amp;<a name='901'>
                   grid%obs_ipf_errob,                                  &amp;<a name='902'>
                   grid%obs_ipf_nudob,                                  &amp;<a name='903'>
                   grid%fdda_start,                                     &amp;<a name='904'>
                   grid%fdda_end,                                       &amp;<a name='905'>
                   grid%obs_nudge_wind,                                 &amp;<a name='906'>
                   grid%obs_nudge_temp,                                 &amp;<a name='907'>
                   grid%obs_nudge_mois,                                 &amp;<a name='908'>
                   grid%obs_nudge_pstr,                                 &amp;<a name='909'>
                   grid%obs_coef_wind,                                  &amp;<a name='910'>
                   grid%obs_coef_temp,                                  &amp;<a name='911'>
                   grid%obs_coef_mois,                                  &amp;<a name='912'>
                   grid%obs_coef_pstr,                                  &amp;             <a name='913'>
                   grid%obs_rinxy,                                      &amp;<a name='914'>
                   grid%obs_rinsig,                                     &amp;<a name='915'>
                   grid%obs_npfi,                                       &amp;<a name='916'>
                   grid%obs_ionf,                                       &amp;<a name='917'>
                   grid%obs_prt_max,                                    &amp;<a name='918'>
                   grid%obs_prt_freq,                                   &amp;<a name='919'>
                   grid%obs_idynin,                                     &amp;<a name='920'>
                   grid%obs_dtramp,                                     &amp;<a name='921'>
                   grid%parent_grid_ratio,                              &amp;<a name='922'>
                   grid%max_dom, grid%itimestep,                        &amp;<a name='923'>
                   grid%xtime,                                          &amp;<a name='924'>
                   grid%dt, grid%gmt, grid%julday, grid%fdob,           &amp;<a name='925'>
                   grid%max_obs,                                        &amp;<a name='926'>
                   model_config_rec%nobs_ndg_vars,                      &amp;<a name='927'>
                   model_config_rec%nobs_err_flds,                      &amp;<a name='928'>
                   grid%fdob%nstat, grid%fdob%varobs, grid%fdob%errf,   &amp;<a name='929'>
                   grid%dx, grid%KPBL,grid%HT,                          &amp;<a name='930'>
                   grid%mut, grid%muu, grid%muv, grid%c1h, grid%c2h,    &amp;<a name='931'>
                   grid%msftx, grid%msfty, grid%msfux, grid%msfuy, grid%msfvx, grid%msfvy, &amp;<a name='932'>
                   p_phy, t_tendf, t0,                                  &amp;<a name='933'>
                   grid%u_2, grid%v_2, grid%t_2,                        &amp;<a name='934'>
                   moist(ims,kms,jms,P_QV),                             &amp;<a name='935'>
                   grid%pb, grid%p_top, grid%p, grid%phb, grid%ph_2,    &amp;<a name='936'>
                   grid%uratx, grid%vratx, grid%tratx,                  &amp;<a name='937'>
                   ru_tendf, rv_tendf,                                  &amp;<a name='938'>
                   moist_tend(ims,kms,jms,P_QV), grid%obs_savwt,        &amp;<a name='939'>
                   grid%regime, grid%pblh, grid%z_at_w, grid%z,         &amp;<a name='940'>
                   ids,ide, jds,jde, kds,kde,                           &amp;<a name='941'>
                   ims,ime, jms,jme, kms,kme,                           &amp;<a name='942'>
                   grid%i_start(ij), min(grid%i_end(ij),ide-1),         &amp;<a name='943'>
                   grid%j_start(ij), min(grid%j_end(ij),jde-1),         &amp;<a name='944'>
                   k_start    , min(k_end,kde-1)                     )<a name='945'>
 <a name='946'>
         ENDDO<a name='947'>
         <font color=#447700>!$OMP END PARALLEL DO<a name='948'></font>
       ENDIF  <font color=#447700>! obs_nudge_opt .eq. 1<a name='949'></font>
<font color=#447700>! <a name='950'></font>
<font color=#447700>!***********************************************************************<a name='951'></font>
<a name='952'>
  END SUBROUTINE first_rk_step_part2<a name='953'>
<a name='954'>
END MODULE module_first_rk_step_part2<a name='955'>
<a name='956'>
</pre></body></html>