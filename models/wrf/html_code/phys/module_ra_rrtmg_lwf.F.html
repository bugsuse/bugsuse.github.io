<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!MODULE module_ra_rrtmg_lwf<a name='2'></font>
#define CHNK 8<a name='3'>
<font color=#447700>!#define CHNK 1849<a name='4'></font>
<font color=#447700>!#define CHNK 43<a name='5'></font>
<a name='6'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='7'></font>
<font color=#447700>! |                                                                          |<a name='8'></font>
<font color=#447700>! |  Copyright 2002-2013, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='9'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='10'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='11'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='12'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='13'></font>
<font color=#447700>! |                                                                          |<a name='14'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='15'></font>
<a name='16'>
<font color=#447700>! Uncomment to use GPU, or comment to use CPU<a name='17'></font>
<font color=#447700>!#define _ACCEL<a name='18'></font>
<a name='19'>
#ifdef _ACCEL<a name='20'>
#define _gpudev  ,device<a name='21'>
#define _gpudeva ,device,allocatable<a name='22'>
#define _gpudevanp ,device,allocatable<a name='23'>
#define _gpucon  ,constant<a name='24'>
#define _gpuker  attributes(global)<a name='25'>
#define _gpuked  attributes(device)<a name='26'>
#define _gpuchv  &lt;&lt;&lt;dimGrid,dimBlock&gt;&gt;&gt;<a name='27'>
#define _cpus    <a name='28'>
#define _cpusnp<a name='29'>
#else<a name='30'>
#define _gpudev<a name='31'>
#define _gpudeva ,pointer<a name='32'>
#define _gpudevanp ,allocatable<a name='33'>
#define _gpucon<a name='34'>
#define _gpuker<a name='35'>
#define _gpuked<a name='36'>
#define _gpuchv<a name='37'>
#define _cpus    ,target<a name='38'>
#define _cpusnp  <a name='39'>
#endif<a name='40'>
<a name='41'>
#ifdef _ACCEL<a name='42'>
#define dbreg(x) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBAL'>dbal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBAL_1">(x)<a name='43'>
#define dbcop(x,y) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCP'>dbcp</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCP_1">(x, cpointer);call c_f_pointer( cpointer, y, shape(x)) <a name='44'>
#define dbcopnp(x,y,t,u) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCP'>dbcp</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCP_2">(x, cpointer);call c_f_pointer( cpointer, y, shape(x)) <a name='45'>
#define dreg(x,y,z) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEG'>ddbxeg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDBXEG_1">(x,y,z,cpointer);call c_f_pointer( cpointer, x, [y,z] )<a name='46'>
#define sreg(x,y,z) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEG'>ddbxeg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DDBXEG_2">(x,y,z,cpointer)<a name='47'>
#define dbflushreg() call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBFLUSHRG'>dbflushrg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBFLUSHRG_1">()<a name='48'>
#define dbflushcop() call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBFLUSHCP'>dbflushcp</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#module_ra_rrtmg_lwf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBFLUSHCP_1">()<a name='49'>
#else<a name='50'>
#define dbreg(x) <a name='51'>
#define dbcop(x,y) y=&gt;x<a name='52'>
#define dbcopnp(x,y,u,v) if (allocated(y).eqv..true.) deallocate(y) ;allocate( y( u, v)); y=x<a name='53'>
#define dbflushreg() <a name='54'>
#define dbflushcop() <a name='55'>
#define dreg(x,y,z) if (allocated(x).eqv..true.) deallocate(x) ;allocate( x( y , z))<a name='56'>
#define sreg(x,y,z)<a name='57'>
#endif<a name='58'>
<a name='59'>
<font color=#447700>!! !#define _memdiag<a name='60'></font>
<a name='61'>
<A NAME='MEMORY'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='62'>
<font color=#993300>module </font><font color=#cc0000>memory</font> <A href='../../call_to/MEMORY.html' TARGET='index'>17</A>,<A href='../../call_from/MEMORY.html' TARGET='index'>14</A><a name='63'>
#ifdef _ACCEL<a name='64'>
<a name='65'>
<a name='66'>
use iso_c_binding<a name='67'>
use cudafor<a name='68'>
type adr<a name='69'>
    integer*8 :: loc<a name='70'>
    integer*8 :: size <a name='71'>
    integer*8 :: gap<a name='72'>
    integer :: cindex = 0<a name='73'>
    integer :: cnum = 0<a name='74'>
    integer :: oindex = 0<a name='75'>
    integer :: agn = 0<a name='76'>
    type(c_ptr) :: locp<a name='77'>
end type<a name='78'>
<a name='79'>
type adrd<a name='80'>
    type(c_devptr) :: loc<a name='81'>
    integer*8 :: size<a name='82'>
    real, device, allocatable :: ar(:)<a name='83'>
end type<a name='84'>
<a name='85'>
<a name='86'>
type(adr) :: plist(500)<a name='87'>
type(adr) :: clist(100)<a name='88'>
type(adrd) :: dlist(100)<a name='89'>
integer :: np = 0<a name='90'>
integer :: nc = 0<a name='91'>
integer :: acgap = 4<a name='92'>
type(c_devptr) :: cpointer<a name='93'>
<a name='94'>
integer :: ddnp = 0<a name='95'>
real, device, allocatable :: ddar(:)<a name='96'>
real, device :: ddtemp(1)<a name='97'>
integer :: ddsizec = 0<a name='98'>
integer :: ddindex = 0<a name='99'>
integer :: ddflush = 0<a name='100'>
<a name='101'>
<a name='102'>
<a name='103'>
<A NAME='DBAL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='104'>
<font color=#993300>interface </font><font color=#cc0000>dbal</font> <A href='../../call_to/DBAL.html' TARGET='index'>1</A><a name='105'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR'>dbalr</A><A NAME="DBALR_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR2'>dbalr2</A><A NAME="DBALR2_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR3'>dbalr3</A><A NAME="DBALR3_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI'>dbali</A><A NAME="DBALI_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI2'>dbali2</A><A NAME="DBALI2_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI3'>dbali3</A><A NAME="DBALI3_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='106'>
end interface <a name='107'>
<a name='108'>
<A NAME='DBCP'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='109'>
<font color=#993300>interface </font><font color=#cc0000>dbcp</font> <A href='../../call_to/DBCP.html' TARGET='index'>2</A><a name='110'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI1'>dbcpi1</A><A NAME="DBCPI1_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI2'>dbcpi2</A><A NAME="DBCPI2_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI3'>dbcpi3</A><A NAME="DBCPI3_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR1'>dbcpr1</A><A NAME="DBCPR1_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR2'>dbcpr2</A><A NAME="DBCPR2_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR3'>dbcpr3</A><A NAME="DBCPR3_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='111'>
end interface <a name='112'>
<a name='113'>
<A NAME='DDBXEG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='114'>
<font color=#993300>interface </font><font color=#cc0000>ddbxeg</font> <A href='../../call_to/DDBXEG.html' TARGET='index'>2</A><a name='115'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEGI'>ddbxegi</A><A NAME="DDBXEGI_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEGR'>ddbxegr</A><A NAME="DDBXEGR_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='116'>
end interface<a name='117'>
<a name='118'>
contains<a name='119'>
<a name='120'>
<A NAME='DDBXEGI'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEGI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='121'>
<font color=#993300>subroutine </font><font color=#cc0000>ddbxegi</font>( a, x, y , pt) <A href='../../call_to/DDBXEGI.html' TARGET='index'>1</A><a name='122'>
    integer, allocatable, device :: a(:,:)<a name='123'>
    integer :: x,y<a name='124'>
    type(c_devptr), intent(out) :: pt<a name='125'>
    <a name='126'>
<a name='127'>
    if (ddflush == 0) then<a name='128'>
        <a name='129'>
        ddsizec = ddsizec + (x*y)<a name='130'>
        <font color=#447700>!pt = c_devloc( ddtemp(1) )<a name='131'></font>
<a name='132'>
    else<a name='133'>
        <a name='134'>
        pt = c_devloc( ddar( ddindex ) )<a name='135'>
        ddindex = ddindex + (x*y)<a name='136'>
       <a name='137'>
    end if<a name='138'>
end subroutine<a name='139'>
<a name='140'>
<a name='141'>
<a name='142'>
<A NAME='DDBXEGR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DDBXEGR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='143'>
<font color=#993300>subroutine </font><font color=#cc0000>ddbxegr</font>( a, x, y , pt) <A href='../../call_to/DDBXEGR.html' TARGET='index'>1</A><a name='144'>
    real, allocatable, device :: a(:,:)<a name='145'>
    integer :: x,y<a name='146'>
    type(c_devptr), intent(out) :: pt<a name='147'>
    <a name='148'>
<a name='149'>
    if (ddflush == 0) then<a name='150'>
        <a name='151'>
        ddsizec = ddsizec + (x*y)<a name='152'>
        pt = c_devloc( ddtemp(1) )<a name='153'>
<a name='154'>
    else<a name='155'>
        <a name='156'>
        pt = c_devloc( ddar( ddindex ) )<a name='157'>
        ddindex = ddindex + (x*y)<a name='158'>
       <a name='159'>
    end if<a name='160'>
end subroutine<a name='161'>
<a name='162'>
<A NAME='DFLUSH'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DFLUSH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='163'>
<font color=#993300>subroutine </font><font color=#cc0000>dflush</font>() <A href='../../call_to/DFLUSH.html' TARGET='index'>1</A><a name='164'>
#ifdef _ACCEL<a name='165'>
    allocate( ddar( ddsizec + 1 ) )<a name='166'>
#endif<a name='167'>
    <a name='168'>
    ddflush = 1<a name='169'>
    ddindex = 1<a name='170'>
end subroutine<a name='171'>
<a name='172'>
<A NAME='DCLEAN'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DCLEAN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='173'>
<font color=#993300>subroutine </font><font color=#cc0000>dclean</font>() <A href='../../call_to/DCLEAN.html' TARGET='index'>1</A><a name='174'>
#ifdef _ACCEL<a name='175'>
    deallocate( ddar )<a name='176'>
#endif<a name='177'>
    ddindex = 0<a name='178'>
    ddsizec = 0<a name='179'>
    ddflush = 0<a name='180'>
end subroutine<a name='181'>
<a name='182'>
    <a name='183'>
<A NAME='DBGENR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='184'>
<font color=#993300>subroutine </font><font color=#cc0000>dbgenr</font>( p, s ) <A href='../../call_to/DBGENR.html' TARGET='index'>3</A><a name='185'>
    real, intent(in) :: p(*)<a name='186'>
    integer, intent(in) :: s<a name='187'>
    np = np + 1<a name='188'>
    plist(np)%loc = loc(p(1))<a name='189'>
    plist(np)%locp = c_loc(p(1))<a name='190'>
    plist(np)%size = s<a name='191'>
    plist(np)%gap = 0<a name='192'>
    plist(np)%oindex = np<a name='193'>
#ifdef _memdiag<a name='194'>
    print *, "index ", np<a name='195'>
    print *, "real allocation ", np, " loc: ", plist(np)%loc, " size: ", plist(np)%size<a name='196'>
#endif<a name='197'>
end subroutine<a name='198'>
<a name='199'>
<A NAME='DBGENI'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='200'>
<font color=#993300>subroutine </font><font color=#cc0000>dbgeni</font>( p, s ) <A href='../../call_to/DBGENI.html' TARGET='index'>3</A><a name='201'>
    integer, intent(in) :: p(*)<a name='202'>
    integer, intent(in) :: s<a name='203'>
    np = np + 1<a name='204'>
    plist(np)%loc = loc(p(1))<a name='205'>
    plist(np)%locp = c_loc(p(1))<a name='206'>
    plist(np)%size = s<a name='207'>
    plist(np)%gap = 0<a name='208'>
    plist(np)%oindex = np<a name='209'>
#ifdef _memdiag<a name='210'>
    print *, "index ", np   <a name='211'>
    print *, "integer allocation ", np, " loc: ", plist(np)%loc, " size: ", plist(np)%size<a name='212'>
#endif<a name='213'>
end subroutine<a name='214'>
<a name='215'>
<A NAME='DBALR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='216'>
<font color=#993300>subroutine </font><font color=#cc0000>dbalr</font>( p ) <A href='../../call_to/DBALR.html' TARGET='index'>1</A>,<A href='../../call_from/DBALR.html' TARGET='index'>1</A><a name='217'>
    real, intent(in) :: p(:)<a name='218'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENR'>dbgenr</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENR_1">( p, size(p) * 4)<a name='219'>
end subroutine<a name='220'>
<a name='221'>
<A NAME='DBALR2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='222'>
<font color=#993300>subroutine </font><font color=#cc0000>dbalr2</font>( p) <A href='../../call_to/DBALR2.html' TARGET='index'>1</A>,<A href='../../call_from/DBALR2.html' TARGET='index'>1</A><a name='223'>
    real, intent(in) :: p(:,:)<a name='224'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENR'>dbgenr</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENR_2">( p, size(p) * 4)<a name='225'>
end subroutine<a name='226'>
<a name='227'>
<A NAME='DBALR3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='228'>
<font color=#993300>subroutine </font><font color=#cc0000>dbalr3</font>( p) <A href='../../call_to/DBALR3.html' TARGET='index'>1</A>,<A href='../../call_from/DBALR3.html' TARGET='index'>1</A><a name='229'>
    real, intent(in) :: p(:,:,:)<a name='230'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENR'>dbgenr</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALR3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENR_3">( p, size(p) * 4)<a name='231'>
end subroutine<a name='232'>
<a name='233'>
<A NAME='DBALI'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='234'>
<font color=#993300>subroutine </font><font color=#cc0000>dbali</font>( p ) <A href='../../call_to/DBALI.html' TARGET='index'>1</A>,<A href='../../call_from/DBALI.html' TARGET='index'>1</A><a name='235'>
    integer, intent(in) :: p(:)<a name='236'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENI'>dbgeni</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENI_1">( p, size(p) * 4)<a name='237'>
end subroutine<a name='238'>
<a name='239'>
<A NAME='DBALI2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='240'>
<font color=#993300>subroutine </font><font color=#cc0000>dbali2</font>( p ) <A href='../../call_to/DBALI2.html' TARGET='index'>1</A>,<A href='../../call_from/DBALI2.html' TARGET='index'>1</A><a name='241'>
    integer, intent(in) :: p(:,:)<a name='242'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENI'>dbgeni</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENI_2">( p, size(p) * 4)<a name='243'>
end subroutine<a name='244'>
<a name='245'>
<A NAME='DBALI3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='246'>
<font color=#993300>subroutine </font><font color=#cc0000>dbali3</font>( p ) <A href='../../call_to/DBALI3.html' TARGET='index'>1</A>,<A href='../../call_from/DBALI3.html' TARGET='index'>1</A><a name='247'>
    integer, intent(in) :: p(:,:,:)<a name='248'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBGENI'>dbgeni</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBALI3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBGENI_3">( p, size(p) * 4)<a name='249'>
end subroutine<a name='250'>
<a name='251'>
<a name='252'>
<A NAME='DBFLUSHRG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBFLUSHRG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='253'>
<font color=#993300>subroutine </font><font color=#cc0000>dbflushrg</font>() <A href='../../call_to/DBFLUSHRG.html' TARGET='index'>1</A><a name='254'>
    integer :: i,j<a name='255'>
    integer*8 :: loc, size, oin<a name='256'>
    type(c_ptr) :: locp, cpt<a name='257'>
    integer :: cpti<a name='258'>
#ifdef _memdiag<a name='259'>
    print *, "analyzing memory"<a name='260'>
    print *, "sorting entries"<a name='261'>
#endif<a name='262'>
    do j = 1, np<a name='263'>
        do i = 1, np-1<a name='264'>
<a name='265'>
            if (plist(i)%loc &gt; plist(i+1)%loc) then<a name='266'>
                loc = plist(i)%loc<a name='267'>
                locp = plist(i)%locp<a name='268'>
                size = plist(i)%size<a name='269'>
                oin = plist(i)%oindex<a name='270'>
<a name='271'>
                plist(i)%loc = plist(i+1)%loc<a name='272'>
                plist(i)%locp = plist(i+1)%locp<a name='273'>
                plist(i)%size = plist(i+1)%size<a name='274'>
                plist(i)%oindex = plist(i+1)%oindex<a name='275'>
                plist(i+1)%loc = loc<a name='276'>
                plist(i+1)%locp = locp<a name='277'>
                plist(i+1)%size = size<a name='278'>
                plist(i+1)%oindex = oin<a name='279'>
            end if<a name='280'>
<a name='281'>
        end do<a name='282'>
    end do<a name='283'>
<a name='284'>
    do i = 1, np - 1<a name='285'>
        plist(i)%gap = plist(i+1)%loc - (plist(i)%loc + plist(i)%size)<a name='286'>
    end do<a name='287'>
    plist(np)%gap = 9999999<a name='288'>
#ifdef _memdiag<a name='289'>
    print *, "sorted elements"<a name='290'>
#endif    <a name='291'>
    do i = 1, np <a name='292'>
#ifdef _memdiag<a name='293'>
        print *, plist(i)%loc, plist(i)%size, plist(i)%gap<a name='294'>
#endif<a name='295'>
        if (plist(i)%gap &lt; 0) then<a name='296'>
            print *, "ERROR<font color=#447700>! Memory overlap found at index ", plist(i)%oindex<a name='297'></font>
            stop<a name='298'>
        end if<a name='299'>
    end do<a name='300'>
#ifdef _memdiag<a name='301'>
    print *, "analyzing contiguous regions"<a name='302'>
#endif<a name='303'>
    nc = 1<a name='304'>
    clist(1)%loc = plist(1)%loc<a name='305'>
    clist(1)%cindex = 1<a name='306'>
    do i = 1, np<a name='307'>
        plist(i)%cnum = nc<a name='308'>
        plist(i)%cindex = clist(nc)%size/4 <a name='309'>
<a name='310'>
        if (plist(i)%gap &gt; acgap) then<a name='311'>
            clist(nc)%size = clist(nc)%size + plist(i)%size<a name='312'>
            if (i &lt; np) then<a name='313'>
                clist(nc+1)%loc = plist(i+1)%loc<a name='314'>
                clist(nc+1)%cindex = i+1<a name='315'>
            end if<a name='316'>
            nc = nc + 1<a name='317'>
        else<a name='318'>
            clist(nc)%size = clist(nc)%size + plist(i)%size + plist(i)%gap<a name='319'>
        end if        <a name='320'>
<a name='321'>
    end do<a name='322'>
    nc = nc - 1<a name='323'>
<a name='324'>
#ifdef _memdiag<a name='325'>
    print *, "contiguous regions", nc<a name='326'>
    print *, "number alloc/copy reduced to ", 100.0 * real(nc)/real(np), "%"<a name='327'>
<a name='328'>
    do i = 1, nc <a name='329'>
        print *, clist(i)%loc, clist(i)%size<a name='330'>
    end do<a name='331'>
<a name='332'>
    print *, "allocating device memory"<a name='333'>
#endif<a name='334'>
    do i = 1, nc<a name='335'>
        <a name='336'>
        dlist(i)%size = clist(i)%size<a name='337'>
#ifdef _memdiag        <a name='338'>
        print *, dlist(i)%size<a name='339'>
#endif<a name='340'>
#ifdef _ACCEL<a name='341'>
        allocate( dlist(i)%ar( dlist(i)%size + 2 ))<a name='342'>
#endif<a name='343'>
        dlist(i)%loc = c_devloc( dlist(i)%ar(1) )<a name='344'>
    end do<a name='345'>
<a name='346'>
   <a name='347'>
<a name='348'>
end subroutine<a name='349'>
<a name='350'>
<A NAME='DBCPR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='351'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpr</font>( p, pt )<a name='352'>
    <a name='353'>
    real, intent(in) :: p(*)<a name='354'>
    integer*8 :: lc<a name='355'>
    type(c_devptr), intent(out) :: pt<a name='356'>
<a name='357'>
<a name='358'>
end subroutine<a name='359'>
<a name='360'>
<A NAME='DBCPI1'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='361'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpi1</font>( p, pt ) <A href='../../call_to/DBCPI1.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPI1.html' TARGET='index'>1</A><a name='362'>
    integer, intent(in) :: p(:)<a name='363'>
    integer*8 :: lc<a name='364'>
    type(c_devptr), intent(out) :: pt<a name='365'>
    lc = loc(p(1))<a name='366'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_1">( lc, pt)<a name='367'>
end subroutine<a name='368'>
<a name='369'>
<A NAME='DBCPI2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='370'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpi2</font>( p, pt ) <A href='../../call_to/DBCPI2.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPI2.html' TARGET='index'>1</A><a name='371'>
    integer, intent(in) :: p(:,:)<a name='372'>
    integer*8 :: lc<a name='373'>
    type(c_devptr), intent(out) :: pt<a name='374'>
    lc = loc(p(1,1))<a name='375'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_2">( lc, pt)<a name='376'>
end subroutine<a name='377'>
<a name='378'>
<A NAME='DBCPI3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='379'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpi3</font>( p, pt ) <A href='../../call_to/DBCPI3.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPI3.html' TARGET='index'>1</A><a name='380'>
    integer, intent(in) :: p(:,:,:)<a name='381'>
    integer*8 :: lc<a name='382'>
    type(c_devptr), intent(out) :: pt<a name='383'>
    lc = loc(p(1,1,1))<a name='384'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPI3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_3">( lc, pt)<a name='385'>
end subroutine<a name='386'>
<a name='387'>
<A NAME='DBCPR1'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='388'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpr1</font>( p, pt ) <A href='../../call_to/DBCPR1.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPR1.html' TARGET='index'>1</A><a name='389'>
    real, intent(in) :: p(:)<a name='390'>
    integer*8 :: lc<a name='391'>
    type(c_devptr), intent(out) :: pt<a name='392'>
    lc = loc(p(1))<a name='393'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_4">( lc, pt)<a name='394'>
end subroutine<a name='395'>
<a name='396'>
<A NAME='DBCPR2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='397'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpr2</font>( p, pt ) <A href='../../call_to/DBCPR2.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPR2.html' TARGET='index'>1</A><a name='398'>
    real, intent(in) :: p(:,:)<a name='399'>
    integer*8 :: lc<a name='400'>
    type(c_devptr), intent(out) :: pt<a name='401'>
    lc = loc(p(1,1))<a name='402'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_5">( lc, pt)<a name='403'>
end subroutine<a name='404'>
<a name='405'>
<A NAME='DBCPR3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='406'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpr3</font>( p, pt ) <A href='../../call_to/DBCPR3.html' TARGET='index'>1</A>,<A href='../../call_from/DBCPR3.html' TARGET='index'>1</A><a name='407'>
    real, intent(in) :: p(:,:,:)<a name='408'>
    integer*8 :: lc<a name='409'>
    type(c_devptr), intent(out) :: pt<a name='410'>
    lc = loc(p(1,1,1))<a name='411'>
    call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG'>dbcpg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPR3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCPG_6">( lc, pt)<a name='412'>
end subroutine<a name='413'>
<a name='414'>
<a name='415'>
<a name='416'>
<A NAME='DBCPG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCPG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='417'>
<font color=#993300>subroutine </font><font color=#cc0000>dbcpg</font>( lc, pt ) <A href='../../call_to/DBCPG.html' TARGET='index'>6</A><a name='418'>
    integer*8, intent(in) :: lc<a name='419'>
    type(c_devptr), intent(out) :: pt<a name='420'>
    integer :: fl<a name='421'>
    fl = 0<a name='422'>
    do i = 1, np<a name='423'>
<a name='424'>
        if (plist(i)%loc .eq. lc) then<a name='425'>
#ifdef _memdiag<a name='426'>
            print *, "pointer found at index ", i<a name='427'>
#endif<a name='428'>
            pt = c_devloc( dlist( plist(i)%cnum )%ar( plist(i)%cindex+1 )) <a name='429'>
            fl = 1<a name='430'>
            plist(i)%agn = 1<a name='431'>
        end if<a name='432'>
    end do<a name='433'>
<a name='434'>
    if (fl == 0) then<a name='435'>
        print *, "ERROR<font color=#447700>! pointer not found!"<a name='436'></font>
        stop<a name='437'>
    end if<a name='438'>
<a name='439'>
end subroutine<a name='440'>
<a name='441'>
<a name='442'>
<A NAME='DBFLUSHCP'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBFLUSHCP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='443'>
<font color=#993300>subroutine </font><font color=#cc0000>dbflushcp</font> <A href='../../call_to/DBFLUSHCP.html' TARGET='index'>1</A><a name='444'>
    integer :: i<a name='445'>
    integer :: err<a name='446'>
#ifdef _memdiag   <a name='447'>
    print  *, "checking that all pointers are assigned"<a name='448'>
#endif<a name='449'>
    do i = 1, np<a name='450'>
        if (plist(i)%agn == 0) then<a name='451'>
            print *, "ERROR<font color=#447700>! pointer not assigned at index ", plist(i)%oindex<a name='452'></font>
            stop<a name='453'>
        end if<a name='454'>
    end do<a name='455'>
#ifdef _memdiag<a name='456'>
    print *, "pointers are OK"<a name='457'>
#endif<a name='458'>
    do i=1, nc<a name='459'>
        err = cudaMemCpyAsync( dlist(i)%loc, plist(clist(i)%cindex)%locp , clist(i)%size+1)<a name='460'>
        if (err &lt;&gt; 0) then<a name='461'>
            print *, "ERROR<font color=#447700>! there was an error with a memory copy"<a name='462'></font>
            stop<a name='463'>
        end if<a name='464'>
    end do<a name='465'>
#ifdef _memdiag<a name='466'>
    print *, "memory copied successfully"<a name='467'>
#endif<a name='468'>
end subroutine<a name='469'>
<a name='470'>
<A NAME='DBCLEAN'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCLEAN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='471'>
<font color=#993300>subroutine </font><font color=#cc0000>dbclean</font> <A href='../../call_to/DBCLEAN.html' TARGET='index'>1</A><a name='472'>
    integer :: i<a name='473'>
   <a name='474'>
    do i=1, nc<a name='475'>
        dlist(i)%size=0<a name='476'>
        clist(i)%size=0<a name='477'>
<a name='478'>
#ifdef _ACCEL<a name='479'>
        deallocate( dlist(i)%ar )<a name='480'>
#endif<a name='481'>
    end do<a name='482'>
    nc = 0<a name='483'>
    np = 0<a name='484'>
<a name='485'>
end subroutine<a name='486'>
#endif<a name='487'>
end module<a name='488'>
<a name='489'>
<a name='490'>
<a name='491'>
<A NAME='PARRRTM_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='492'>
      <font color=#993300>module </font><font color=#cc0000>parrrtm_f</font> <A href='../../call_to/PARRRTM_F.html' TARGET='index'>44</A><a name='493'>
<a name='494'>
<font color=#447700>!     use parkind ,only : im =&gt; kind <a name='495'></font>
<a name='496'>
<font color=#447700>!     implicit none<a name='497'></font>
      save<a name='498'>
<a name='499'>
<font color=#447700>!------------------------------------------------------------------<a name='500'></font>
<font color=#447700>! rrtmg_lw main parameters<a name='501'></font>
<font color=#447700>!<a name='502'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, Jul 1998<a name='503'></font>
<font color=#447700>! Revised: MJIacono, AER, Jun 2006<a name='504'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2007<a name='505'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2008<a name='506'></font>
<font color=#447700>!------------------------------------------------------------------<a name='507'></font>
<a name='508'>
<font color=#447700>!  name     type     purpose<a name='509'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='510'></font>
<font color=#447700>! mxlay  :  integer: maximum number of layers<a name='511'></font>
<font color=#447700>! mg     :  integer: number of original g-intervals per spectral band<a name='512'></font>
<font color=#447700>! nbndlw :  integer: number of spectral bands<a name='513'></font>
<font color=#447700>! maxxsec:  integer: maximum number of cross-section molecules<a name='514'></font>
<font color=#447700>!                    (e.g. cfcs)<a name='515'></font>
<font color=#447700>! maxinpx:  integer: <a name='516'></font>
<font color=#447700>! ngptlw :  integer: total number of reduced g-intervals for rrtmg_lw<a name='517'></font>
<font color=#447700>! ngNN   :  integer: number of reduced g-intervals per spectral band<a name='518'></font>
<font color=#447700>! ngsNN  :  integer: cumulative number of g-intervals per band<a name='519'></font>
<font color=#447700>!------------------------------------------------------------------<a name='520'></font>
<a name='521'>
      integer , parameter :: mxlay  = 100<a name='522'>
      integer , parameter :: mg     = 16<a name='523'>
      integer , parameter :: nbndlw = 16<a name='524'>
      integer , parameter :: maxxsec= 4<a name='525'>
      integer , parameter :: mxmol  = 38<a name='526'>
      integer , parameter :: maxinpx= 38<a name='527'>
      integer , parameter :: nmol   = 7<a name='528'>
<font color=#447700>! Use for 140 g-point model <a name='529'></font>
      integer , parameter :: ngptlw = 140<a name='530'>
<font color=#447700>! Use for 256 g-point model <a name='531'></font>
<font color=#447700>!      integer , parameter :: ngptlw = 256<a name='532'></font>
<a name='533'>
<font color=#447700>! Use for 140 g-point model<a name='534'></font>
      integer , parameter :: ng1  = 10<a name='535'>
      integer , parameter :: ng2  = 12<a name='536'>
      integer , parameter :: ng3  = 16<a name='537'>
      integer , parameter :: ng4  = 14<a name='538'>
      integer , parameter :: ng5  = 16<a name='539'>
      integer , parameter :: ng6  = 8<a name='540'>
      integer , parameter :: ng7  = 12<a name='541'>
      integer , parameter :: ng8  = 8<a name='542'>
      integer , parameter :: ng9  = 12<a name='543'>
      integer , parameter :: ng10 = 6<a name='544'>
      integer , parameter :: ng11 = 8<a name='545'>
      integer , parameter :: ng12 = 8<a name='546'>
      integer , parameter :: ng13 = 4<a name='547'>
      integer , parameter :: ng14 = 2<a name='548'>
      integer , parameter :: ng15 = 2<a name='549'>
      integer , parameter :: ng16 = 2<a name='550'>
<a name='551'>
      integer , parameter :: ngs1  = 10<a name='552'>
      integer , parameter :: ngs2  = 22<a name='553'>
      integer , parameter :: ngs3  = 38<a name='554'>
      integer , parameter :: ngs4  = 52<a name='555'>
      integer , parameter :: ngs5  = 68<a name='556'>
      integer , parameter :: ngs6  = 76<a name='557'>
      integer , parameter :: ngs7  = 88<a name='558'>
      integer , parameter :: ngs8  = 96<a name='559'>
      integer , parameter :: ngs9  = 108<a name='560'>
      integer , parameter :: ngs10 = 114<a name='561'>
      integer , parameter :: ngs11 = 122<a name='562'>
      integer , parameter :: ngs12 = 130<a name='563'>
      integer , parameter :: ngs13 = 134<a name='564'>
      integer , parameter :: ngs14 = 136<a name='565'>
      integer , parameter :: ngs15 = 138<a name='566'>
<a name='567'>
<font color=#447700>! Use for 256 g-point model<a name='568'></font>
<font color=#447700>!      integer , parameter :: ng1  = 16<a name='569'></font>
<font color=#447700>!      integer , parameter :: ng2  = 16<a name='570'></font>
<font color=#447700>!      integer , parameter :: ng3  = 16<a name='571'></font>
<font color=#447700>!      integer , parameter :: ng4  = 16<a name='572'></font>
<font color=#447700>!      integer , parameter :: ng5  = 16<a name='573'></font>
<font color=#447700>!      integer , parameter :: ng6  = 16<a name='574'></font>
<font color=#447700>!      integer , parameter :: ng7  = 16<a name='575'></font>
<font color=#447700>!      integer , parameter :: ng8  = 16<a name='576'></font>
<font color=#447700>!      integer , parameter :: ng9  = 16<a name='577'></font>
<font color=#447700>!      integer , parameter :: ng10 = 16<a name='578'></font>
<font color=#447700>!      integer , parameter :: ng11 = 16<a name='579'></font>
<font color=#447700>!      integer , parameter :: ng12 = 16<a name='580'></font>
<font color=#447700>!      integer , parameter :: ng13 = 16<a name='581'></font>
<font color=#447700>!      integer , parameter :: ng14 = 16<a name='582'></font>
<font color=#447700>!      integer , parameter :: ng15 = 16<a name='583'></font>
<font color=#447700>!      integer , parameter :: ng16 = 16<a name='584'></font>
<a name='585'>
<font color=#447700>!      integer , parameter :: ngs1  = 16<a name='586'></font>
<font color=#447700>!      integer , parameter :: ngs2  = 32<a name='587'></font>
<font color=#447700>!      integer , parameter :: ngs3  = 48<a name='588'></font>
<font color=#447700>!      integer , parameter :: ngs4  = 64<a name='589'></font>
<font color=#447700>!      integer , parameter :: ngs5  = 80<a name='590'></font>
<font color=#447700>!      integer , parameter :: ngs6  = 96<a name='591'></font>
<font color=#447700>!      integer , parameter :: ngs7  = 112<a name='592'></font>
<font color=#447700>!      integer , parameter :: ngs8  = 128<a name='593'></font>
<font color=#447700>!      integer , parameter :: ngs9  = 144<a name='594'></font>
<font color=#447700>!      integer , parameter :: ngs10 = 160<a name='595'></font>
<font color=#447700>!      integer , parameter :: ngs11 = 176<a name='596'></font>
<font color=#447700>!      integer , parameter :: ngs12 = 192<a name='597'></font>
<font color=#447700>!      integer , parameter :: ngs13 = 208<a name='598'></font>
<font color=#447700>!      integer , parameter :: ngs14 = 224<a name='599'></font>
<font color=#447700>!      integer , parameter :: ngs15 = 240<a name='600'></font>
<font color=#447700>!      integer , parameter :: ngs16 = 256<a name='601'></font>
<a name='602'>
      end module parrrtm_f<a name='603'>
<a name='604'>
<A NAME='RRLW_CLD_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CLD_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='605'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_cld_f</font> <A href='../../call_to/RRLW_CLD_F.html' TARGET='index'>3</A><a name='606'>
<a name='607'>
<font color=#447700>!     use parkind, only : rb =&gt; kind <a name='608'></font>
<a name='609'>
<font color=#447700>!     implicit none<a name='610'></font>
      save<a name='611'>
<a name='612'>
<font color=#447700>!------------------------------------------------------------------<a name='613'></font>
<font color=#447700>! rrtmg_lw cloud property coefficients<a name='614'></font>
<a name='615'>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='616'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='617'></font>
<font color=#447700>!------------------------------------------------------------------<a name='618'></font>
<a name='619'>
<font color=#447700>!  name     type     purpose<a name='620'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='621'></font>
<font color=#447700>! abscld1:  real   : <a name='622'></font>
<font color=#447700>! absice0:  real   : <a name='623'></font>
<font color=#447700>! absice1:  real   : <a name='624'></font>
<font color=#447700>! absice2:  real   : <a name='625'></font>
<font color=#447700>! absice3:  real   : <a name='626'></font>
<font color=#447700>! absliq0:  real   : <a name='627'></font>
<font color=#447700>! absliq1:  real   : <a name='628'></font>
<font color=#447700>!------------------------------------------------------------------<a name='629'></font>
<a name='630'>
      real  :: abscld1<a name='631'>
      real  , dimension(2) :: absice0<a name='632'>
      real  , dimension(2,5) :: absice1<a name='633'>
      real  , dimension(43,16) :: absice2<a name='634'>
      real  , dimension(46,16) :: absice3<a name='635'>
      real :: absliq0<a name='636'>
      real  , dimension(58,16) :: absliq1<a name='637'>
<a name='638'>
      end module rrlw_cld_f<a name='639'>
<a name='640'>
<A NAME='RRLW_CON_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='641'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_con_f</font> <A href='../../call_to/RRLW_CON_F.html' TARGET='index'>7</A><a name='642'>
<a name='643'>
<font color=#447700>!     use parkind, only : rb =&gt; kind <a name='644'></font>
<a name='645'>
<font color=#447700>!     implicit none<a name='646'></font>
      save<a name='647'>
<a name='648'>
<font color=#447700>!------------------------------------------------------------------<a name='649'></font>
<font color=#447700>! rrtmg_lw constants<a name='650'></font>
<a name='651'>
<font color=#447700>! Initial version: MJIacono, AER, jun2006<a name='652'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='653'></font>
<font color=#447700>!------------------------------------------------------------------<a name='654'></font>
<a name='655'>
<font color=#447700>!  name     type     purpose<a name='656'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='657'></font>
<font color=#447700>! fluxfac:  real   : radiance to flux conversion factor <a name='658'></font>
<font color=#447700>! heatfac:  real   : flux to heating rate conversion factor<a name='659'></font>
<font color=#447700>!oneminus:  real   : 1.-1.e-6<a name='660'></font>
<font color=#447700>! pi     :  real   : pi<a name='661'></font>
<font color=#447700>! grav   :  real   : acceleration of gravity<a name='662'></font>
<font color=#447700>! planck :  real   : planck constant<a name='663'></font>
<font color=#447700>! boltz  :  real   : boltzmann constant<a name='664'></font>
<font color=#447700>! clight :  real   : speed of light<a name='665'></font>
<font color=#447700>! avogad :  real   : avogadro constant <a name='666'></font>
<font color=#447700>! alosmt :  real   : loschmidt constant<a name='667'></font>
<font color=#447700>! gascon :  real   : molar gas constant<a name='668'></font>
<font color=#447700>! radcn1 :  real   : first radiation constant<a name='669'></font>
<font color=#447700>! radcn2 :  real   : second radiation constant<a name='670'></font>
<font color=#447700>! sbcnst :  real   : stefan-boltzmann constant<a name='671'></font>
<font color=#447700>!  secdy :  real   : seconds per day  <a name='672'></font>
<font color=#447700>!------------------------------------------------------------------<a name='673'></font>
<a name='674'>
      real  :: fluxfac, heatfac<a name='675'>
      real  :: oneminus, pi, grav<a name='676'>
      real  :: planck, boltz, clight<a name='677'>
      real  :: avogad, alosmt, gascon<a name='678'>
      real  :: radcn1, radcn2<a name='679'>
      real  :: sbcnst, secdy<a name='680'>
<a name='681'>
      end module rrlw_con_f<a name='682'>
<a name='683'>
<A NAME='RRLW_KG01_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='684'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg01_f</font> <A href='../../call_to/RRLW_KG01_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG01_F.html' TARGET='index'>1</A><a name='685'>
<a name='686'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='687'></font>
<a name='688'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_1"><a name='689'>
<font color=#447700>!     implicit none<a name='690'></font>
      save<a name='691'>
<a name='692'>
<font color=#447700>!-----------------------------------------------------------------<a name='693'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 1<a name='694'></font>
<font color=#447700>! band 1:  10-250 cm-1 (low - h2o; high - h2o)<a name='695'></font>
<font color=#447700>!<a name='696'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='697'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='698'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='699'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='700'></font>
<font color=#447700>!<a name='701'></font>
<font color=#447700>!  name     type     purpose<a name='702'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='703'></font>
<font color=#447700>!fracrefao: real    <a name='704'></font>
<font color=#447700>!fracrefbo: real<a name='705'></font>
<font color=#447700>! kao     : real     <a name='706'></font>
<font color=#447700>! kbo     : real     <a name='707'></font>
<font color=#447700>! kao_mn2 : real     <a name='708'></font>
<font color=#447700>! kbo_mn2 : real     <a name='709'></font>
<font color=#447700>! selfrefo: real     <a name='710'></font>
<font color=#447700>! forrefo : real<a name='711'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='712'></font>
<a name='713'>
      integer , parameter :: no1  = 16<a name='714'>
<a name='715'>
      real  :: fracrefao(no1)  , fracrefbo(no1)<a name='716'>
      real  :: kao(5,13,no1)<a name='717'>
      real  :: kbo(5,13:59,no1)<a name='718'>
      real  :: kao_mn2(19,no1) , kbo_mn2(19,no1)<a name='719'>
      real  :: selfrefo(10,no1), forrefo(4,no1)<a name='720'>
<a name='721'>
<font color=#447700>!-----------------------------------------------------------------<a name='722'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 1<a name='723'></font>
<font color=#447700>! band 1:  10-250 cm-1 (low - h2o; high - h2o)<a name='724'></font>
<font color=#447700>!<a name='725'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='726'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='727'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='728'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='729'></font>
<font color=#447700>!<a name='730'></font>
<font color=#447700>!  name     type     purpose<a name='731'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='732'></font>
<font color=#447700>!fracrefa : real    <a name='733'></font>
<font color=#447700>!fracrefb : real<a name='734'></font>
<font color=#447700>! ka      : real     <a name='735'></font>
<font color=#447700>! kb      : real     <a name='736'></font>
<font color=#447700>! absa    : real<a name='737'></font>
<font color=#447700>! absb    : real<a name='738'></font>
<font color=#447700>! ka_mn2  : real     <a name='739'></font>
<font color=#447700>! kb_mn2  : real     <a name='740'></font>
<font color=#447700>! selfref : real     <a name='741'></font>
<font color=#447700>! forref  : real<a name='742'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='743'></font>
<a name='744'>
      integer , parameter :: ng1  = 10<a name='745'>
<a name='746'>
      <a name='747'>
      real  _cpusnp :: ka(5,13,ng1)   , absa(65,ng1)<a name='748'>
      real  _cpusnp :: kb(5,13:59,ng1), absb(235,ng1)<a name='749'>
      real  _cpus :: fracrefa(ng1)  , fracrefb(ng1)<a name='750'>
      real  _cpus :: ka_mn2(19,ng1) , kb_mn2(19,ng1)<a name='751'>
      real  _cpus :: selfref(10,ng1), forref(4,ng1)<a name='752'>
<a name='753'>
      <a name='754'>
      real  _gpudevanp :: kad(:,:,:), absad(:,:), absbd(:,:)<a name='755'>
      real  _gpudevanp :: kbd(:,:,:)<a name='756'>
      <a name='757'>
      real  _gpudeva :: fracrefad(:)  , fracrefbd(:)<a name='758'>
      real  _gpudeva :: ka_mn2d(:,:) , kb_mn2d(:,:)<a name='759'>
      real  _gpudeva :: selfrefd(:,:), forrefd(:,:)<a name='760'>
<a name='761'>
      equivalence (ka(1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='762'>
<a name='763'>
      contains<a name='764'>
<a name='765'>
<A NAME='COPYTOGPU1'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='766'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU1</font> <A href='../../call_to/COPYTOGPU1.html' TARGET='index'>1</A><a name='767'>
     <a name='768'>
        dbcop(fracrefa,fracrefad)<a name='769'>
        dbcop(fracrefb,fracrefbd)<a name='770'>
        dbcop(ka_mn2,ka_mn2d)<a name='771'>
        dbcop(kb_mn2,kb_mn2d)<a name='772'>
        dbcop(selfref,selfrefd)<a name='773'>
        dbcop(forref,forrefd)<a name='774'>
<a name='775'>
        dbcopnp(absa , absad , 65 , ng1)<a name='776'>
        dbcopnp(absb , absbd , 235 , ng1)<a name='777'>
     <a name='778'>
      end subroutine <a name='779'>
<a name='780'>
<A NAME='REG1'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='781'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg1</font> <A href='../../call_to/REG1.html' TARGET='index'>1</A><a name='782'>
<a name='783'>
        dbreg(fracrefa)<a name='784'>
        dbreg(fracrefb)<a name='785'>
        dbreg(ka_mn2)<a name='786'>
        dbreg(kb_mn2)<a name='787'>
        dbreg(selfref)<a name='788'>
        dbreg(forref)<a name='789'>
        dbreg(absa)<a name='790'>
        dbreg(absb)<a name='791'>
        <a name='792'>
      end subroutine <a name='793'>
<a name='794'>
      end module rrlw_kg01_f<a name='795'>
<a name='796'>
<A NAME='RRLW_KG02_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='797'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg02_f</font> <A href='../../call_to/RRLW_KG02_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG02_F.html' TARGET='index'>1</A><a name='798'>
<a name='799'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='800'></font>
<a name='801'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_2"><a name='802'>
<font color=#447700>!     implicit none<a name='803'></font>
      save<a name='804'>
<a name='805'>
<font color=#447700>!-----------------------------------------------------------------<a name='806'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 2<a name='807'></font>
<font color=#447700>! band 2:  250-500 cm-1 (low - h2o; high - h2o)<a name='808'></font>
<font color=#447700>!<a name='809'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='810'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='811'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='812'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='813'></font>
<font color=#447700>!<a name='814'></font>
<font color=#447700>!  name     type     purpose<a name='815'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='816'></font>
<font color=#447700>!fracrefao: real    <a name='817'></font>
<font color=#447700>!fracrefbo: real<a name='818'></font>
<font color=#447700>! kao     : real     <a name='819'></font>
<font color=#447700>! kbo     : real     <a name='820'></font>
<font color=#447700>! selfrefo: real     <a name='821'></font>
<font color=#447700>! forrefo : real<a name='822'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='823'></font>
<a name='824'>
      integer , parameter :: no2  = 16<a name='825'>
      real  _cpus :: kao(5,13,no2)<a name='826'>
      real  _cpus :: kbo(5,13:59,no2)<a name='827'>
      real  _cpus :: fracrefao(no2)   , fracrefbo(no2)<a name='828'>
      real  _cpus :: selfrefo(10,no2) , forrefo(4,no2)<a name='829'>
<a name='830'>
      real  _gpudeva :: fracrefaod(:)   , fracrefbod(:)<a name='831'>
      real  _gpudeva :: selfrefod(:,:) , forrefod(:,:)<a name='832'>
<a name='833'>
<font color=#447700>!-----------------------------------------------------------------<a name='834'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 2<a name='835'></font>
<font color=#447700>! band 2:  250-500 cm-1 (low - h2o; high - h2o)<a name='836'></font>
<font color=#447700>!<a name='837'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='838'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='839'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='840'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='841'></font>
<font color=#447700>!<a name='842'></font>
<font color=#447700>!  name     type     purpose<a name='843'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='844'></font>
<font color=#447700>!fracrefa : real    <a name='845'></font>
<font color=#447700>!fracrefb : real<a name='846'></font>
<font color=#447700>! ka      : real     <a name='847'></font>
<font color=#447700>! kb      : real     <a name='848'></font>
<font color=#447700>! absa    : real<a name='849'></font>
<font color=#447700>! absb    : real<a name='850'></font>
<font color=#447700>! selfref : real     <a name='851'></font>
<font color=#447700>! forref  : real<a name='852'></font>
<font color=#447700>!<a name='853'></font>
<font color=#447700>! refparam: real<a name='854'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='855'></font>
<a name='856'>
      integer , parameter :: ng2  = 12<a name='857'>
<a name='858'>
      real  _cpus :: fracrefa(ng2)  , fracrefb(ng2)<a name='859'>
      real  _cpusnp :: ka(5,13,ng2)   , absa(65,ng2)<a name='860'>
      real  _cpusnp :: kb(5,13:59,ng2), absb(235,ng2)<a name='861'>
      real  _cpus :: selfref(10,ng2), forref(4,ng2)<a name='862'>
<a name='863'>
      real  _gpudeva :: fracrefad(:)  , fracrefbd(:)<a name='864'>
      real  _gpudevanp :: absad(:,:)<a name='865'>
      real  _gpudevanp :: absbd(:,:)<a name='866'>
      real  _gpudeva :: selfrefd(:,:), forrefd(:,:)<a name='867'>
<a name='868'>
      real  :: refparam(13)<a name='869'>
<a name='870'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='871'>
<a name='872'>
      contains<a name='873'>
      <a name='874'>
<A NAME='COPYTOGPU2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='875'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU2</font> <A href='../../call_to/COPYTOGPU2.html' TARGET='index'>1</A><a name='876'>
<a name='877'>
        dbcop(fracrefao,fracrefaod)<a name='878'>
        dbcop(fracrefbo,fracrefbod)       <a name='879'>
        dbcop(selfrefo, selfrefod)<a name='880'>
        dbcop(forrefo, forrefod)<a name='881'>
<a name='882'>
        dbcop(fracrefa,fracrefad)<a name='883'>
        dbcop(fracrefb,fracrefbd)       <a name='884'>
<a name='885'>
        dbcopnp(absa , absad , 65 , ng2)<a name='886'>
        dbcopnp(absb , absbd , 235 , ng2)<a name='887'>
<a name='888'>
        dbcop(selfref, selfrefd)<a name='889'>
        dbcop(forref, forrefd)<a name='890'>
        <a name='891'>
      end subroutine <a name='892'>
        <a name='893'>
<A NAME='REG2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='894'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg2</font> <A href='../../call_to/REG2.html' TARGET='index'>1</A><a name='895'>
         <font color=#447700>! 9<a name='896'></font>
        dbreg(fracrefao)<a name='897'>
        dbreg(fracrefbo)        <a name='898'>
        dbreg(selfrefo)<a name='899'>
        dbreg(forrefo)<a name='900'>
         <a name='901'>
        dbreg(fracrefa)<a name='902'>
        dbreg(fracrefb)        <a name='903'>
        dbreg(absa)        <a name='904'>
        dbreg(absb)<a name='905'>
        dbreg(selfref)<a name='906'>
        dbreg(forref)<a name='907'>
<a name='908'>
      end subroutine<a name='909'>
<a name='910'>
      end module rrlw_kg02_f<a name='911'>
<a name='912'>
<A NAME='RRLW_KG03_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='913'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg03_f</font> <A href='../../call_to/RRLW_KG03_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG03_F.html' TARGET='index'>1</A><a name='914'>
<a name='915'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='916'></font>
<a name='917'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_3"><a name='918'>
<font color=#447700>!     implicit none<a name='919'></font>
      save<a name='920'>
<a name='921'>
<font color=#447700>!-----------------------------------------------------------------<a name='922'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 3<a name='923'></font>
<font color=#447700>! band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='924'></font>
<font color=#447700>!<a name='925'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='926'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='927'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='928'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='929'></font>
<font color=#447700>!<a name='930'></font>
<font color=#447700>!  name     type     purpose<a name='931'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='932'></font>
<font color=#447700>!fracrefao: real    <a name='933'></font>
<font color=#447700>!fracrefbo: real<a name='934'></font>
<font color=#447700>! kao     : real     <a name='935'></font>
<font color=#447700>! kbo     : real     <a name='936'></font>
<font color=#447700>! kao_mn2o: real     <a name='937'></font>
<font color=#447700>! kbo_mn2o: real     <a name='938'></font>
<font color=#447700>! selfrefo: real     <a name='939'></font>
<font color=#447700>! forrefo : real<a name='940'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='941'></font>
<a name='942'>
      integer , parameter :: no3  = 16<a name='943'>
<a name='944'>
      real  _cpus :: fracrefao(no3,9) ,fracrefbo(no3,5)<a name='945'>
      real  _cpus :: kao(9,5,13,no3)<a name='946'>
      real  _cpus :: kbo(5,5,13:59,no3)<a name='947'>
      real  _cpus :: kao_mn2o(9,19,no3), kbo_mn2o(5,19,no3)<a name='948'>
      real  _cpus :: selfrefo(10,no3)<a name='949'>
      real  _cpus :: forrefo(4,no3)<a name='950'>
<a name='951'>
      real  _gpudeva :: fracrefaod(:,:) ,fracrefbod(:,:)<a name='952'>
      <font color=#447700>!real  _gpudeva :: kaod(9,5,13,no3)<a name='953'></font>
      <font color=#447700>!real  _gpudeva :: kbod(5,5,13:59,no3)<a name='954'></font>
      real  _gpudeva :: kao_mn2od(:,:,:), kbo_mn2od(:,:,:)<a name='955'>
      real  _gpudeva :: selfrefod(:,:)<a name='956'>
      real  _gpudeva :: forrefod(:,:)<a name='957'>
<a name='958'>
<font color=#447700>!-----------------------------------------------------------------<a name='959'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 3<a name='960'></font>
<font color=#447700>! band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='961'></font>
<font color=#447700>!<a name='962'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='963'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='964'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='965'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='966'></font>
<font color=#447700>!<a name='967'></font>
<font color=#447700>!  name     type     purpose<a name='968'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='969'></font>
<font color=#447700>!fracrefa : real    <a name='970'></font>
<font color=#447700>!fracrefb : real<a name='971'></font>
<font color=#447700>! ka      : real     <a name='972'></font>
<font color=#447700>! kb      : real     <a name='973'></font>
<font color=#447700>! ka_mn2o : real     <a name='974'></font>
<font color=#447700>! kb_mn2o : real     <a name='975'></font>
<font color=#447700>! selfref : real     <a name='976'></font>
<font color=#447700>! forref  : real<a name='977'></font>
<font color=#447700>!<a name='978'></font>
<font color=#447700>! absa    : real<a name='979'></font>
<font color=#447700>! absb    : real<a name='980'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='981'></font>
<a name='982'>
      integer , parameter :: ng3  = 16<a name='983'>
<a name='984'>
      real  _cpus :: fracrefa(ng3,9) ,fracrefb(ng3,5)<a name='985'>
      real  _cpusnp :: ka(9,5,13,ng3)  ,absa(585,ng3)<a name='986'>
      real  _cpusnp :: kb(5,5,13:59,ng3),absb(1175,ng3)<a name='987'>
      real  _cpus :: ka_mn2o(9,19,ng3), kb_mn2o(5,19,ng3)<a name='988'>
      real  _cpus :: selfref(10,ng3)<a name='989'>
      real  _cpus :: forref(4,ng3)<a name='990'>
<a name='991'>
      real  _gpudeva :: fracrefad(:,:) ,fracrefbd(:,:)<a name='992'>
      real  _gpudevanp :: absad(:,:)<a name='993'>
      real  _gpudevanp :: absbd(:,:)<a name='994'>
      real  _gpudeva :: ka_mn2od(:,:,:), kb_mn2od(:,:,:)<a name='995'>
      real  _gpudeva :: selfrefd(:,:)<a name='996'>
      real  _gpudeva :: forrefd(:,:)<a name='997'>
<a name='998'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='999'>
<a name='1000'>
      contains <a name='1001'>
<a name='1002'>
<A NAME='COPYTOGPU3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1003'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU3</font> <A href='../../call_to/COPYTOGPU3.html' TARGET='index'>1</A><a name='1004'>
<a name='1005'>
       dbcop( fracrefao , fracrefaod )<a name='1006'>
       dbcop( fracrefbo , fracrefbod )<a name='1007'>
       dbcop( kao_mn2o , kao_mn2od )<a name='1008'>
       dbcop( kbo_mn2o , kbo_mn2od )<a name='1009'>
       dbcop( selfrefo , selfrefod )<a name='1010'>
       dbcop( forrefo , forrefod )<a name='1011'>
<a name='1012'>
       dbcop( fracrefa , fracrefad )<a name='1013'>
       dbcop( fracrefb , fracrefbd )<a name='1014'>
   <a name='1015'>
       dbcopnp( absa , absad , 585 , ng3 )<a name='1016'>
       dbcopnp( absb , absbd , 1175 , ng3 )<a name='1017'>
<a name='1018'>
       dbcop( ka_mn2o , ka_mn2od )<a name='1019'>
       dbcop( kb_mn2o , kb_mn2od )<a name='1020'>
       dbcop( selfref , selfrefd )<a name='1021'>
       dbcop( forref , forrefd )<a name='1022'>
<a name='1023'>
      end subroutine <a name='1024'>
<a name='1025'>
<A NAME='REG3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1026'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg3</font> <A href='../../call_to/REG3.html' TARGET='index'>1</A><a name='1027'>
       <font color=#447700>!19<a name='1028'></font>
       dbreg( fracrefao )<a name='1029'>
       dbreg( fracrefbo )<a name='1030'>
     <a name='1031'>
       dbreg( kao_mn2o )<a name='1032'>
       dbreg( kbo_mn2o )<a name='1033'>
       dbreg( selfrefo )<a name='1034'>
       dbreg( forrefo )<a name='1035'>
<a name='1036'>
       dbreg( fracrefa )<a name='1037'>
       dbreg( fracrefb )<a name='1038'>
      <a name='1039'>
       dbreg( absa )<a name='1040'>
     <a name='1041'>
       dbreg( absb )<a name='1042'>
       dbreg( ka_mn2o )<a name='1043'>
       dbreg( kb_mn2o )<a name='1044'>
       dbreg( selfref )<a name='1045'>
       dbreg( forref )<a name='1046'>
<a name='1047'>
      end subroutine<a name='1048'>
<a name='1049'>
      end module rrlw_kg03_f<a name='1050'>
<a name='1051'>
<A NAME='RRLW_KG04_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1052'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg04_f</font> <A href='../../call_to/RRLW_KG04_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG04_F.html' TARGET='index'>1</A><a name='1053'>
<a name='1054'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1055'></font>
<a name='1056'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_4"><a name='1057'>
<font color=#447700>!     implicit none<a name='1058'></font>
      save<a name='1059'>
<a name='1060'>
<font color=#447700>!-----------------------------------------------------------------<a name='1061'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 4<a name='1062'></font>
<font color=#447700>! band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='1063'></font>
<font color=#447700>!<a name='1064'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1065'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1066'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1067'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1068'></font>
<font color=#447700>!<a name='1069'></font>
<font color=#447700>!  name     type     purpose<a name='1070'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1071'></font>
<font color=#447700>!fracrefao: real    <a name='1072'></font>
<font color=#447700>!fracrefbo: real<a name='1073'></font>
<font color=#447700>! kao     : real     <a name='1074'></font>
<font color=#447700>! kbo     : real     <a name='1075'></font>
<font color=#447700>! selfrefo: real     <a name='1076'></font>
<font color=#447700>! forrefo : real     <a name='1077'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1078'></font>
      integer , parameter :: ng4  = 14<a name='1079'>
      integer , parameter :: no4  = 16<a name='1080'>
<a name='1081'>
      real  _cpus :: kao(9,5,13,no4)<a name='1082'>
      real  _cpus :: kbo(5,5,13:59,no4)<a name='1083'>
      real  _cpusnp :: ka(9,5,13,ng4)   ,absa(585,ng4)<a name='1084'>
      real  _cpusnp :: kb(5,5,13:59,ng4),absb(1175,ng4)<a name='1085'>
<a name='1086'>
      real  _cpus :: fracrefao(no4,9)  ,fracrefbo(no4,5)<a name='1087'>
 <a name='1088'>
      real  _cpus :: selfrefo(10,no4)  ,forrefo(4,no4)<a name='1089'>
<a name='1090'>
      real  _gpudeva :: fracrefaod(:,:)  ,fracrefbod(:,:)<a name='1091'>
      <font color=#447700>!real  _gpudev :: kaod(9,5,13,no4)<a name='1092'></font>
      <font color=#447700>!real  _gpudev :: kbod(5,5,13:59,no4)<a name='1093'></font>
      real  _gpudeva :: selfrefod(:,:)  ,forrefod(:,:)<a name='1094'>
<a name='1095'>
<font color=#447700>!-----------------------------------------------------------------<a name='1096'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 4<a name='1097'></font>
<font color=#447700>! band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='1098'></font>
<font color=#447700>!<a name='1099'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1100'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1101'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1102'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1103'></font>
<font color=#447700>!<a name='1104'></font>
<font color=#447700>!  name     type     purpose<a name='1105'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1106'></font>
<font color=#447700>! absa    : real<a name='1107'></font>
<font color=#447700>! absb    : real<a name='1108'></font>
<font color=#447700>!fracrefa : real    <a name='1109'></font>
<font color=#447700>!fracrefb : real<a name='1110'></font>
<font color=#447700>! ka      : real     <a name='1111'></font>
<font color=#447700>! kb      : real     <a name='1112'></font>
<font color=#447700>! selfref : real     <a name='1113'></font>
<font color=#447700>! forref  : real     <a name='1114'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1115'></font>
<a name='1116'>
      real  _cpus :: fracrefa(ng4,9)  ,fracrefb(ng4,5)<a name='1117'>
      <a name='1118'>
      real  _cpus :: selfref(10,ng4)  ,forref(4,ng4)<a name='1119'>
<a name='1120'>
      real  _gpudeva :: fracrefad(:,:)  ,fracrefbd(:,:)<a name='1121'>
      real  _gpudevanp ::  absad(:,:)<a name='1122'>
      real  _gpudevanp ::  absbd(:,:)<a name='1123'>
      real  _gpudeva :: selfrefd(:,:)  ,forrefd(:,:)<a name='1124'>
<a name='1125'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='1126'>
<a name='1127'>
      contains <a name='1128'>
<a name='1129'>
<A NAME='COPYTOGPU4'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1130'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU4</font> <A href='../../call_to/COPYTOGPU4.html' TARGET='index'>1</A><a name='1131'>
<a name='1132'>
       dbcop( fracrefa , fracrefad )<a name='1133'>
       dbcop( fracrefb , fracrefbd )<a name='1134'>
      <a name='1135'>
       dbcopnp( absa , absad , 585 , ng4 )<a name='1136'>
       dbcopnp( absb , absbd , 1175 , ng4)<a name='1137'>
<a name='1138'>
       dbcop( selfref , selfrefd )<a name='1139'>
       dbcop( forref , forrefd )<a name='1140'>
<a name='1141'>
      end subroutine <a name='1142'>
<a name='1143'>
<A NAME='REG4'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1144'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg4</font> <A href='../../call_to/REG4.html' TARGET='index'>1</A><a name='1145'>
       <font color=#447700>!33<a name='1146'></font>
       dbreg( fracrefa )<a name='1147'>
       dbreg( fracrefb )<a name='1148'>
    <a name='1149'>
       dbreg( absa )<a name='1150'>
<a name='1151'>
       dbreg( absb )<a name='1152'>
       dbreg( selfref )<a name='1153'>
       dbreg( forref )<a name='1154'>
<a name='1155'>
      end subroutine <a name='1156'>
<a name='1157'>
      end module rrlw_kg04_f<a name='1158'>
<a name='1159'>
<A NAME='RRLW_KG05_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1160'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg05_f</font> <A href='../../call_to/RRLW_KG05_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG05_F.html' TARGET='index'>1</A><a name='1161'>
<a name='1162'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1163'></font>
<a name='1164'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_5"><a name='1165'>
<font color=#447700>!     implicit none<a name='1166'></font>
      save<a name='1167'>
<a name='1168'>
<font color=#447700>!-----------------------------------------------------------------<a name='1169'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 5<a name='1170'></font>
<font color=#447700>! band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='1171'></font>
<font color=#447700>!<a name='1172'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1173'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1174'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1175'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1176'></font>
<font color=#447700>!<a name='1177'></font>
<font color=#447700>!  name     type     purpose<a name='1178'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1179'></font>
<font color=#447700>!fracrefao: real    <a name='1180'></font>
<font color=#447700>!fracrefbo: real<a name='1181'></font>
<font color=#447700>! kao     : real     <a name='1182'></font>
<font color=#447700>! kbo     : real     <a name='1183'></font>
<font color=#447700>! kao_mo3 : real     <a name='1184'></font>
<font color=#447700>! selfrefo: real     <a name='1185'></font>
<font color=#447700>! forrefo : real     <a name='1186'></font>
<font color=#447700>! ccl4o   : real<a name='1187'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1188'></font>
<a name='1189'>
      integer , parameter :: no5  = 16<a name='1190'>
      integer , parameter :: ng5  = 16<a name='1191'>
      real  _cpusnp :: ka(9,5,13,ng5),kb(5,5,13:59,ng5)  <a name='1192'>
      real  _cpus :: kao(9,5,13,no5)<a name='1193'>
      real  _cpus :: kbo(5,5,13:59,no5)<a name='1194'>
<a name='1195'>
      real  _cpus :: fracrefao(no5,9) ,fracrefbo(no5,5) <a name='1196'>
      real  _cpusnp :: absa(585,ng5)<a name='1197'>
 <a name='1198'>
      real  _cpus :: kao_mo3(9,19,no5)<a name='1199'>
      real  _cpus :: selfrefo(10,no5)<a name='1200'>
      real  _cpus :: forrefo(4,no5)<a name='1201'>
      real  _cpus :: ccl4o(no5)<a name='1202'>
<a name='1203'>
<a name='1204'>
      real  _gpudeva :: fracrefaod(:,:) ,fracrefbod(:,:)<a name='1205'>
      real  _gpudev :: kaod(9,5,13,no5)<a name='1206'>
      real  _gpudev :: kbod(5,5,13:59,no5)<a name='1207'>
      real  _gpudeva :: kao_mo3d(:,:,:)<a name='1208'>
      real  _gpudeva :: selfrefod(:,:)<a name='1209'>
      real  _gpudeva :: forrefod(:,:)<a name='1210'>
      real  _gpudeva :: ccl4od(:)<a name='1211'>
<font color=#447700>!-----------------------------------------------------------------<a name='1212'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 5<a name='1213'></font>
<font color=#447700>! band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='1214'></font>
<font color=#447700>!<a name='1215'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1216'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1217'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1218'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1219'></font>
<font color=#447700>!<a name='1220'></font>
<font color=#447700>!  name     type     purpose<a name='1221'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1222'></font>
<font color=#447700>!fracrefa : real    <a name='1223'></font>
<font color=#447700>!fracrefb : real<a name='1224'></font>
<font color=#447700>! ka      : real     <a name='1225'></font>
<font color=#447700>! kb      : real     <a name='1226'></font>
<font color=#447700>! ka_mo3  : real     <a name='1227'></font>
<font color=#447700>! selfref : real     <a name='1228'></font>
<font color=#447700>! forref  : real     <a name='1229'></font>
<font color=#447700>! ccl4    : real<a name='1230'></font>
<font color=#447700>!<a name='1231'></font>
<font color=#447700>! absa    : real<a name='1232'></font>
<font color=#447700>! absb    : real<a name='1233'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1234'></font>
<a name='1235'>
      real  _cpusnp :: absb(1175,ng5)<a name='1236'>
<a name='1237'>
      real  _cpus :: fracrefa(ng5,9) ,fracrefb(ng5,5)<a name='1238'>
      <a name='1239'>
      real  _cpus :: ka_mo3(9,19,ng5)<a name='1240'>
      real  _cpus :: selfref(10,ng5)<a name='1241'>
      real  _cpus :: forref(4,ng5)<a name='1242'>
      real  _cpus :: ccl4(ng5)<a name='1243'>
<a name='1244'>
      real  _gpudeva :: fracrefad(:,:) ,fracrefbd(:,:)<a name='1245'>
      real  _gpudevanp ::  absad(:,:)<a name='1246'>
      real  _gpudevanp ::  absbd(:,:)<a name='1247'>
      real  _gpudeva :: ka_mo3d(:,:,:)<a name='1248'>
      real  _gpudeva :: selfrefd(:,:)<a name='1249'>
      real  _gpudeva :: forrefd(:,:)<a name='1250'>
      real  _gpudeva :: ccl4d(:)<a name='1251'>
      <a name='1252'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='1253'>
<a name='1254'>
      contains <a name='1255'>
<a name='1256'>
<A NAME='COPYTOGPU5'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1257'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU5</font> <A href='../../call_to/COPYTOGPU5.html' TARGET='index'>1</A><a name='1258'>
<a name='1259'>
       dbcop( fracrefao , fracrefaod )<a name='1260'>
       dbcop( fracrefbo , fracrefbod )<a name='1261'>
    <a name='1262'>
       dbcop( kao_mo3 , kao_mo3d )<a name='1263'>
       dbcop( selfrefo , selfrefod )<a name='1264'>
       dbcop( forrefo , forrefod )<a name='1265'>
       dbcop( ccl4o , ccl4od )<a name='1266'>
<a name='1267'>
       dbcop( fracrefa , fracrefad )<a name='1268'>
       dbcop( fracrefb , fracrefbd )<a name='1269'>
<a name='1270'>
       dbcopnp( absa , absad, 585 , ng5 )<a name='1271'>
       dbcopnp( absb , absbd, 1175 , ng5 )<a name='1272'>
<a name='1273'>
       dbcop( ka_mo3 , ka_mo3d )<a name='1274'>
       dbcop( selfref , selfrefd )<a name='1275'>
       dbcop( forref , forrefd )<a name='1276'>
       dbcop( ccl4 , ccl4d )<a name='1277'>
<a name='1278'>
      end subroutine <a name='1279'>
<a name='1280'>
<A NAME='REG5'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1281'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg5</font> <A href='../../call_to/REG5.html' TARGET='index'>1</A><a name='1282'>
    <a name='1283'>
       dbreg( fracrefao )<a name='1284'>
       dbreg( fracrefbo )<a name='1285'>
     <a name='1286'>
       dbreg( kao_mo3 )<a name='1287'>
       dbreg( selfrefo )<a name='1288'>
       dbreg( forrefo )<a name='1289'>
       dbreg( ccl4o )<a name='1290'>
<a name='1291'>
       dbreg( fracrefa )<a name='1292'>
       dbreg( fracrefb )<a name='1293'>
      <a name='1294'>
       dbreg( absa )<a name='1295'>
     <a name='1296'>
       dbreg( absb )<a name='1297'>
       dbreg( ka_mo3 )<a name='1298'>
       dbreg( selfref )<a name='1299'>
       dbreg( forref )<a name='1300'>
       dbreg( ccl4 )<a name='1301'>
<a name='1302'>
      end subroutine <a name='1303'>
<a name='1304'>
      end module rrlw_kg05_f<a name='1305'>
<a name='1306'>
<A NAME='RRLW_KG06_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1307'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg06_f</font> <A href='../../call_to/RRLW_KG06_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG06_F.html' TARGET='index'>1</A><a name='1308'>
<a name='1309'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1310'></font>
<a name='1311'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_6"><a name='1312'>
<a name='1313'>
<font color=#447700>!     implicit none<a name='1314'></font>
      save<a name='1315'>
<a name='1316'>
<font color=#447700>!-----------------------------------------------------------------<a name='1317'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 6<a name='1318'></font>
<font color=#447700>! band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='1319'></font>
<font color=#447700>!<a name='1320'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1321'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1322'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1323'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1324'></font>
<font color=#447700>!<a name='1325'></font>
<font color=#447700>!  name     type     purpose<a name='1326'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1327'></font>
<font color=#447700>!fracrefao: real    <a name='1328'></font>
<font color=#447700>! kao     : real     <a name='1329'></font>
<font color=#447700>! kao_mco2: real     <a name='1330'></font>
<font color=#447700>! selfrefo: real     <a name='1331'></font>
<font color=#447700>! forrefo : real     <a name='1332'></font>
<font color=#447700>!cfc11adjo: real<a name='1333'></font>
<font color=#447700>! cfc12o  : real<a name='1334'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1335'></font>
<a name='1336'>
      integer , parameter :: no6  = 16<a name='1337'>
      integer , parameter :: ng6  = 8<a name='1338'>
<a name='1339'>
      real  _cpusnp :: ka(5,13,ng6),absa(65,ng6)<a name='1340'>
      real  _cpus, dimension(no6) :: fracrefao<a name='1341'>
      real  _cpus :: kao(5,13,no6)<a name='1342'>
      real  _cpus :: kao_mco2(19,no6)<a name='1343'>
      real  _cpus :: selfrefo(10,no6)<a name='1344'>
      real  _cpus :: forrefo(4,no6)<a name='1345'>
<a name='1346'>
      real  _cpus, dimension(no6) :: cfc11adjo<a name='1347'>
      real  _cpus, dimension(no6) :: cfc12o<a name='1348'>
<a name='1349'>
      real  _gpudeva , dimension(:) :: fracrefaod<a name='1350'>
      real  _gpudeva :: kaod(:,:,:)<a name='1351'>
      real  _gpudeva :: kao_mco2d(:,:)<a name='1352'>
      real  _gpudeva :: selfrefod(:,:)<a name='1353'>
      real  _gpudeva :: forrefod(:,:)<a name='1354'>
<a name='1355'>
      real  _gpudeva , dimension(:) :: cfc11adjod<a name='1356'>
      real  _gpudeva , dimension(:) :: cfc12od<a name='1357'>
<a name='1358'>
<font color=#447700>!-----------------------------------------------------------------<a name='1359'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 6<a name='1360'></font>
<font color=#447700>! band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='1361'></font>
<font color=#447700>!<a name='1362'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1363'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1364'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1365'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1366'></font>
<font color=#447700>!<a name='1367'></font>
<font color=#447700>!  name     type     purpose<a name='1368'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1369'></font>
<font color=#447700>!fracrefa : real    <a name='1370'></font>
<font color=#447700>! ka      : real     <a name='1371'></font>
<font color=#447700>! ka_mco2 : real     <a name='1372'></font>
<font color=#447700>! selfref : real     <a name='1373'></font>
<font color=#447700>! forref  : real     <a name='1374'></font>
<font color=#447700>!cfc11adj : real<a name='1375'></font>
<font color=#447700>! cfc12   : real<a name='1376'></font>
<font color=#447700>!<a name='1377'></font>
<font color=#447700>! absa    : real<a name='1378'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1379'></font>
<a name='1380'>
      real  _cpus, dimension(ng6) :: fracrefa<a name='1381'>
      <a name='1382'>
      real  _cpus :: ka_mco2(19,ng6)<a name='1383'>
      real  _cpus :: selfref(10,ng6)<a name='1384'>
      real  _cpus :: forref(4,ng6)<a name='1385'>
<a name='1386'>
      real  _cpus, dimension(ng6) :: cfc11adj<a name='1387'>
      real  _cpus, dimension(ng6) :: cfc12<a name='1388'>
<a name='1389'>
      real  _gpudeva , dimension(:) :: fracrefad<a name='1390'>
      real  _gpudevanp :: absad(:,:)<a name='1391'>
      real  _gpudeva :: ka_mco2d(:,:)<a name='1392'>
      real  _gpudeva :: selfrefd(:,:)<a name='1393'>
      real  _gpudeva :: forrefd(:,:)<a name='1394'>
<a name='1395'>
      real  _gpudeva , dimension(:) :: cfc11adjd<a name='1396'>
      real  _gpudeva , dimension(:) :: cfc12d<a name='1397'>
      <a name='1398'>
      equivalence (ka(1,1,1),absa(1,1))<a name='1399'>
<a name='1400'>
      contains <a name='1401'>
<a name='1402'>
<A NAME='COPYTOGPU6'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU6' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1403'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU6</font> <A href='../../call_to/COPYTOGPU6.html' TARGET='index'>1</A><a name='1404'>
<a name='1405'>
       dbcop( fracrefao , fracrefaod )    <a name='1406'>
       dbcop( kao , kaod )      <a name='1407'>
       dbcop( kao_mco2 , kao_mco2d )<a name='1408'>
       dbcop( selfrefo , selfrefod )<a name='1409'>
       dbcop( forrefo , forrefod )<a name='1410'>
       dbcop( cfc11adjo , cfc11adjod )<a name='1411'>
       dbcop( cfc12o , cfc12od )<a name='1412'>
      <a name='1413'>
       dbcop( fracrefa , fracrefad )<a name='1414'>
      <a name='1415'>
       dbcopnp( absa , absad, 65, ng6 )<a name='1416'>
       dbcop( ka_mco2 , ka_mco2d )<a name='1417'>
       dbcop( selfref , selfrefd )<a name='1418'>
       dbcop( forref , forrefd )<a name='1419'>
       dbcop( cfc11adj , cfc11adjd )<a name='1420'>
       dbcop( cfc12 , cfc12d )<a name='1421'>
<a name='1422'>
      end subroutine <a name='1423'>
<a name='1424'>
<A NAME='REG6'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG6' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1425'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg6</font> <A href='../../call_to/REG6.html' TARGET='index'>1</A><a name='1426'>
       <font color=#447700>!53<a name='1427'></font>
       dbreg( fracrefao )    <a name='1428'>
       dbreg( kao )      <a name='1429'>
       dbreg( kao_mco2 )<a name='1430'>
       dbreg( selfrefo )<a name='1431'>
       dbreg( forrefo )<a name='1432'>
       dbreg( cfc11adjo )<a name='1433'>
       dbreg( cfc12o )<a name='1434'>
      <a name='1435'>
       dbreg( fracrefa )<a name='1436'>
     <a name='1437'>
       dbreg( absa )<a name='1438'>
       dbreg( ka_mco2 )<a name='1439'>
       dbreg( selfref )<a name='1440'>
       dbreg( forref )<a name='1441'>
       dbreg( cfc11adj )<a name='1442'>
       dbreg( cfc12 )<a name='1443'>
<a name='1444'>
      end subroutine <a name='1445'>
<a name='1446'>
      end module rrlw_kg06_f<a name='1447'>
<a name='1448'>
<A NAME='RRLW_KG07_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1449'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg07_f</font> <A href='../../call_to/RRLW_KG07_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG07_F.html' TARGET='index'>1</A><a name='1450'>
<a name='1451'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1452'></font>
<a name='1453'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_7"><a name='1454'>
<font color=#447700>!     implicit none<a name='1455'></font>
      save<a name='1456'>
<a name='1457'>
<font color=#447700>!-----------------------------------------------------------------<a name='1458'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 7<a name='1459'></font>
<font color=#447700>! band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='1460'></font>
<font color=#447700>!<a name='1461'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1462'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1463'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1464'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1465'></font>
<font color=#447700>!<a name='1466'></font>
<font color=#447700>!  name     type     purpose<a name='1467'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1468'></font>
<font color=#447700>!fracrefao: real    <a name='1469'></font>
<font color=#447700>!fracrefbo: real    <a name='1470'></font>
<font color=#447700>! kao     : real     <a name='1471'></font>
<font color=#447700>! kbo     : real     <a name='1472'></font>
<font color=#447700>! kao_mco2: real     <a name='1473'></font>
<font color=#447700>! kbo_mco2: real     <a name='1474'></font>
<font color=#447700>! selfrefo: real     <a name='1475'></font>
<font color=#447700>! forrefo : real     <a name='1476'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1477'></font>
<a name='1478'>
      integer , parameter :: no7  = 16<a name='1479'>
      integer , parameter :: ng7  = 12<a name='1480'>
      real  _gpudev :: kaod(9,5,13,no7)<a name='1481'>
      real  _gpudev :: kbod(5,13:59,no7)<a name='1482'>
      real  _cpusnp :: ka(9,5,13,ng7) ,kb(5,13:59,ng7),absa(585,ng7)<a name='1483'>
      real  _cpusnp :: absb(235,ng7)<a name='1484'>
<a name='1485'>
      real  _cpus, dimension(no7) :: fracrefbo<a name='1486'>
      real  _cpus :: fracrefao(no7,9)<a name='1487'>
      real  _cpus :: kao(9,5,13,no7)<a name='1488'>
      real  _cpus :: kbo(5,13:59,no7)<a name='1489'>
      real  _cpus :: kao_mco2(9,19,no7)<a name='1490'>
      real  _cpus :: kbo_mco2(19,no7)<a name='1491'>
      real  _cpus :: selfrefo(10,no7)<a name='1492'>
      real  _cpus :: forrefo(4,no7)<a name='1493'>
<a name='1494'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='1495'>
      real  _gpudeva :: fracrefaod(:,:)<a name='1496'>
    <a name='1497'>
      real  _gpudeva :: kao_mco2d(:,:,:)<a name='1498'>
      real  _gpudeva :: kbo_mco2d(:,:)<a name='1499'>
      real  _gpudeva :: selfrefod(:,:)<a name='1500'>
      real  _gpudeva :: forrefod(:,:)<a name='1501'>
<a name='1502'>
<font color=#447700>!-----------------------------------------------------------------<a name='1503'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 7<a name='1504'></font>
<font color=#447700>! band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='1505'></font>
<font color=#447700>!<a name='1506'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1507'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1508'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1509'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1510'></font>
<font color=#447700>!<a name='1511'></font>
<font color=#447700>!  name     type     purpose<a name='1512'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1513'></font>
<font color=#447700>!fracrefa : real    <a name='1514'></font>
<font color=#447700>!fracrefb : real    <a name='1515'></font>
<font color=#447700>! ka      : real     <a name='1516'></font>
<font color=#447700>! kb      : real     <a name='1517'></font>
<font color=#447700>! ka_mco2 : real     <a name='1518'></font>
<font color=#447700>! kb_mco2 : real     <a name='1519'></font>
<font color=#447700>! selfref : real     <a name='1520'></font>
<font color=#447700>! forref  : real     <a name='1521'></font>
<font color=#447700>!<a name='1522'></font>
<font color=#447700>! absa    : real<a name='1523'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1524'></font>
<a name='1525'>
      real  _cpus, dimension(ng7) :: fracrefb<a name='1526'>
      real  _cpus :: fracrefa(ng7,9)<a name='1527'>
      <a name='1528'>
      real  _cpus :: ka_mco2(9,19,ng7)<a name='1529'>
      real  _cpus :: kb_mco2(19,ng7)<a name='1530'>
      real  _cpus :: selfref(10,ng7)<a name='1531'>
      real  _cpus :: forref(4,ng7)<a name='1532'>
<a name='1533'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='1534'>
      real  _gpudeva :: fracrefad(:,:)<a name='1535'>
      real  _gpudevanp ::  absad(:,:)<a name='1536'>
      real  _gpudevanp ::  absbd(:,:)<a name='1537'>
      real  _gpudeva :: ka_mco2d(:,:,:)<a name='1538'>
      real  _gpudeva :: kb_mco2d(:,:)<a name='1539'>
      real  _gpudeva :: selfrefd(:,:)<a name='1540'>
      real  _gpudeva :: forrefd(:,:)<a name='1541'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='1542'>
<a name='1543'>
      contains<a name='1544'>
<a name='1545'>
<A NAME='COPYTOGPU7'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU7' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1546'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU7</font> <A href='../../call_to/COPYTOGPU7.html' TARGET='index'>1</A><a name='1547'>
<a name='1548'>
       dbcop( fracrefb , fracrefbd )    <a name='1549'>
       dbcop( fracrefa , fracrefad )<a name='1550'>
        <a name='1551'>
       dbcopnp( absa , absad, 585, ng7 )<a name='1552'>
       dbcopnp( absb , absbd, 235, ng7 )<a name='1553'>
<a name='1554'>
       dbcop( ka_mco2 , ka_mco2d )<a name='1555'>
       dbcop( kb_mco2 , kb_mco2d )<a name='1556'>
       dbcop( selfref , selfrefd )<a name='1557'>
       dbcop( forref , forrefd )<a name='1558'>
<a name='1559'>
       dbcop( fracrefbo , fracrefbod )    <a name='1560'>
       dbcop( fracrefao , fracrefaod )<a name='1561'>
     <a name='1562'>
       dbcop( kao_mco2 , kao_mco2d )<a name='1563'>
       dbcop( kbo_mco2 , kbo_mco2d )<a name='1564'>
       dbcop( selfrefo , selfrefod )<a name='1565'>
       dbcop( forrefo , forrefod )<a name='1566'>
<a name='1567'>
      end subroutine <a name='1568'>
<a name='1569'>
<A NAME='REG7'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG7' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1570'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg7</font> <A href='../../call_to/REG7.html' TARGET='index'>1</A><a name='1571'>
       <font color=#447700>!67<a name='1572'></font>
       dbreg( fracrefb )    <a name='1573'>
       dbreg( fracrefa )<a name='1574'>
<a name='1575'>
       <font color=#447700>!dbreg( ka )      <a name='1576'></font>
       dbreg( absa )<a name='1577'>
       <font color=#447700>!dbreg( kb )<a name='1578'></font>
       dbreg( absb )<a name='1579'>
       dbreg( ka_mco2 )<a name='1580'>
       dbreg( kb_mco2 )<a name='1581'>
       dbreg( selfref )<a name='1582'>
       dbreg( forref )<a name='1583'>
<a name='1584'>
       dbreg( fracrefbo )    <a name='1585'>
       dbreg( fracrefao )<a name='1586'>
       <font color=#447700>!dbreg( kao )      <a name='1587'></font>
       <font color=#447700>!dbreg( kbo )<a name='1588'></font>
       <font color=#447700>!dbreg( absbo )<a name='1589'></font>
       dbreg( kao_mco2 )<a name='1590'>
       dbreg( kbo_mco2 )<a name='1591'>
       dbreg( selfrefo )<a name='1592'>
       dbreg( forrefo )<a name='1593'>
<a name='1594'>
      end subroutine <a name='1595'>
<a name='1596'>
      end module rrlw_kg07_f<a name='1597'>
<a name='1598'>
<A NAME='RRLW_KG08_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1599'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg08_f</font> <A href='../../call_to/RRLW_KG08_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG08_F.html' TARGET='index'>1</A><a name='1600'>
<a name='1601'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1602'></font>
<a name='1603'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_8"><a name='1604'>
<font color=#447700>!     implicit none<a name='1605'></font>
      save<a name='1606'>
<a name='1607'>
<font color=#447700>!-----------------------------------------------------------------<a name='1608'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 8<a name='1609'></font>
<font color=#447700>! band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='1610'></font>
<font color=#447700>!<a name='1611'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1612'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1613'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1614'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1615'></font>
<font color=#447700>!<a name='1616'></font>
<font color=#447700>!  name     type     purpose<a name='1617'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1618'></font>
<font color=#447700>!fracrefao: real    <a name='1619'></font>
<font color=#447700>!fracrefbo: real    <a name='1620'></font>
<font color=#447700>! kao     : real     <a name='1621'></font>
<font color=#447700>! kbo     : real     <a name='1622'></font>
<font color=#447700>! kao_mco2: real     <a name='1623'></font>
<font color=#447700>! kbo_mco2: real     <a name='1624'></font>
<font color=#447700>! kao_mn2o: real     <a name='1625'></font>
<font color=#447700>! kbo_mn2o: real     <a name='1626'></font>
<font color=#447700>! kao_mo3 : real     <a name='1627'></font>
<font color=#447700>! selfrefo: real     <a name='1628'></font>
<font color=#447700>! forrefo : real     <a name='1629'></font>
<font color=#447700>! cfc12o  : real     <a name='1630'></font>
<font color=#447700>!cfc22adjo: real     <a name='1631'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1632'></font>
<a name='1633'>
      integer , parameter :: no8  = 16<a name='1634'>
<a name='1635'>
      real  _cpus, dimension(no8) :: fracrefao<a name='1636'>
      real  _cpus, dimension(no8) :: fracrefbo<a name='1637'>
      real  _cpus, dimension(no8) :: cfc12o<a name='1638'>
      real  _cpus, dimension(no8) :: cfc22adjo<a name='1639'>
<a name='1640'>
      real  _cpus :: kao(5,13,no8)<a name='1641'>
      real  _cpus :: kao_mco2(19,no8)<a name='1642'>
      real  _cpus :: kao_mn2o(19,no8)<a name='1643'>
      real  _cpus :: kao_mo3(19,no8)<a name='1644'>
      real  _cpus :: kbo(5,13:59,no8)<a name='1645'>
      real  _cpus :: kbo_mco2(19,no8)<a name='1646'>
      real  _cpus :: kbo_mn2o(19,no8)<a name='1647'>
      real  _cpus :: selfrefo(10,no8)<a name='1648'>
      real  _cpus :: forrefo(4,no8)<a name='1649'>
<a name='1650'>
      real  _gpudeva , dimension(:) :: fracrefaod<a name='1651'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='1652'>
      real  _gpudeva , dimension(:) :: cfc12od<a name='1653'>
      real  _gpudeva , dimension(:) :: cfc22adjod<a name='1654'>
<a name='1655'>
      real  _gpudev :: kaod(5,13,no8)<a name='1656'>
      real  _gpudeva :: kao_mco2d(:,:)<a name='1657'>
      real  _gpudeva :: kao_mn2od(:,:)<a name='1658'>
      real  _gpudeva :: kao_mo3d(:,:)<a name='1659'>
      real  _gpudev :: kbod(5,13:59,no8)<a name='1660'>
      real  _gpudeva :: kbo_mco2d(:,:)<a name='1661'>
      real  _gpudeva :: kbo_mn2od(:,:)<a name='1662'>
      real  _gpudeva :: selfrefod(:,:)<a name='1663'>
      real  _gpudeva :: forrefod(:,:)<a name='1664'>
<a name='1665'>
<font color=#447700>!-----------------------------------------------------------------<a name='1666'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 8<a name='1667'></font>
<font color=#447700>! band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='1668'></font>
<font color=#447700>!<a name='1669'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1670'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1671'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1672'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1673'></font>
<font color=#447700>!<a name='1674'></font>
<font color=#447700>!  name     type     purpose<a name='1675'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1676'></font>
<font color=#447700>!fracrefa : real    <a name='1677'></font>
<font color=#447700>!fracrefb : real    <a name='1678'></font>
<font color=#447700>! ka      : real     <a name='1679'></font>
<font color=#447700>! kb      : real     <a name='1680'></font>
<font color=#447700>! ka_mco2 : real     <a name='1681'></font>
<font color=#447700>! kb_mco2 : real     <a name='1682'></font>
<font color=#447700>! ka_mn2o : real     <a name='1683'></font>
<font color=#447700>! kb_mn2o : real     <a name='1684'></font>
<font color=#447700>! ka_mo3  : real     <a name='1685'></font>
<font color=#447700>! selfref : real     <a name='1686'></font>
<font color=#447700>! forref  : real     <a name='1687'></font>
<font color=#447700>! cfc12   : real     <a name='1688'></font>
<font color=#447700>! cfc22adj: real     <a name='1689'></font>
<font color=#447700>!<a name='1690'></font>
<font color=#447700>! absa    : real<a name='1691'></font>
<font color=#447700>! absb    : real<a name='1692'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1693'></font>
<a name='1694'>
      integer , parameter :: ng8  = 8<a name='1695'>
<a name='1696'>
      real  _cpus, dimension(ng8) :: fracrefa<a name='1697'>
      real  _cpus, dimension(ng8) :: fracrefb<a name='1698'>
      real  _cpus, dimension(ng8) :: cfc12<a name='1699'>
      real  _cpus, dimension(ng8) :: cfc22adj<a name='1700'>
<a name='1701'>
      real  _cpusnp :: ka(5,13,ng8)    ,absa(65,ng8)<a name='1702'>
      real  _cpusnp :: kb(5,13:59,ng8) ,absb(235,ng8)<a name='1703'>
      real  _cpus :: ka_mco2(19,ng8)<a name='1704'>
      real  _cpus :: ka_mn2o(19,ng8)<a name='1705'>
      real  _cpus :: ka_mo3(19,ng8)<a name='1706'>
      real  _cpus :: kb_mco2(19,ng8)<a name='1707'>
      real  _cpus :: kb_mn2o(19,ng8)<a name='1708'>
      real  _cpus :: selfref(10,ng8)<a name='1709'>
      real  _cpus :: forref(4,ng8)<a name='1710'>
<a name='1711'>
      real  _gpudeva  , dimension(:) :: fracrefad<a name='1712'>
      real  _gpudeva  , dimension(:) :: fracrefbd<a name='1713'>
      real  _gpudeva  , dimension(:) :: cfc12d<a name='1714'>
      real  _gpudeva  , dimension(:) :: cfc22adjd<a name='1715'>
<a name='1716'>
      real  _gpudevanp  ::  absad(:,:)<a name='1717'>
      real  _gpudevanp  ::  absbd(:,:)<a name='1718'>
      real  _gpudeva  :: ka_mco2d(:,:)<a name='1719'>
      real  _gpudeva  :: ka_mn2od(:,:)<a name='1720'>
      real  _gpudeva  :: ka_mo3d(:,:)<a name='1721'>
      real  _gpudeva  :: kb_mco2d(:,:)<a name='1722'>
      real  _gpudeva  :: kb_mn2od(:,:)<a name='1723'>
      real  _gpudeva  :: selfrefd(:,:)<a name='1724'>
      real  _gpudeva  :: forrefd(:,:)<a name='1725'>
<a name='1726'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='1727'>
<a name='1728'>
      contains <a name='1729'>
<a name='1730'>
<A NAME='COPYTOGPU8'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1731'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU8</font> <A href='../../call_to/COPYTOGPU8.html' TARGET='index'>1</A><a name='1732'>
<a name='1733'>
       kaod = kao<a name='1734'>
       kbod = kbo<a name='1735'>
<a name='1736'>
       dbcop( fracrefao , fracrefaod )<a name='1737'>
       dbcop( fracrefbo , fracrefbod )<a name='1738'>
       dbcop( cfc12o , cfc12od )<a name='1739'>
       dbcop( cfc22adjo , cfc22adjod )<a name='1740'>
   <a name='1741'>
       dbcop( kao_mco2 , kao_mco2d )<a name='1742'>
       dbcop( kao_mn2o , kao_mn2od )<a name='1743'>
       dbcop( kao_mo3 , kao_mo3d )<a name='1744'>
     <a name='1745'>
       dbcop( kbo_mco2 , kbo_mco2d )<a name='1746'>
       dbcop( kbo_mn2o , kbo_mn2od )<a name='1747'>
       dbcop( selfrefo , selfrefod )<a name='1748'>
       dbcop( forrefo , forrefod )<a name='1749'>
<a name='1750'>
       dbcop( fracrefa , fracrefad )<a name='1751'>
       dbcop( fracrefb , fracrefbd )<a name='1752'>
       dbcop( cfc12 , cfc12d )<a name='1753'>
       dbcop( cfc22adj , cfc22adjd )<a name='1754'>
    <a name='1755'>
       dbcopnp( absa , absad, 65 , ng8 )<a name='1756'>
       dbcopnp( absb , absbd, 235 , ng8 )<a name='1757'>
<a name='1758'>
       dbcop( ka_mco2 , ka_mco2d )<a name='1759'>
       dbcop( ka_mn2o , ka_mn2od )<a name='1760'>
       dbcop( ka_mo3 , ka_mo3d )<a name='1761'>
       dbcop( kb_mco2 , kb_mco2d )<a name='1762'>
       dbcop( kb_mn2o , kb_mn2od )<a name='1763'>
       dbcop( selfref , selfrefd )<a name='1764'>
       dbcop( forref , forrefd )<a name='1765'>
<a name='1766'>
      end subroutine <a name='1767'>
 <a name='1768'>
<A NAME='REG8'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1769'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg8</font> <A href='../../call_to/REG8.html' TARGET='index'>1</A><a name='1770'>
     <a name='1771'>
       dbreg( fracrefao )<a name='1772'>
       dbreg( fracrefbo )<a name='1773'>
       dbreg( cfc12o )<a name='1774'>
       dbreg( cfc22adjo )<a name='1775'>
<a name='1776'>
       dbreg( kao_mco2 )<a name='1777'>
       dbreg( kao_mn2o )<a name='1778'>
       dbreg( kao_mo3 )<a name='1779'>
<a name='1780'>
       dbreg( kbo_mco2 )<a name='1781'>
       dbreg( kbo_mn2o )<a name='1782'>
       dbreg( selfrefo )<a name='1783'>
       dbreg( forrefo )<a name='1784'>
<a name='1785'>
       dbreg( fracrefa )<a name='1786'>
       dbreg( fracrefb )<a name='1787'>
       dbreg( cfc12 )<a name='1788'>
       dbreg( cfc22adj )<a name='1789'>
       dbreg( absa )<a name='1790'>
       dbreg( absb )<a name='1791'>
       dbreg( ka_mco2 )<a name='1792'>
       dbreg( ka_mn2o )<a name='1793'>
       dbreg( ka_mo3 )<a name='1794'>
       dbreg( kb_mco2 )<a name='1795'>
       dbreg( kb_mn2o )<a name='1796'>
       dbreg( selfref )<a name='1797'>
       dbreg( forref )<a name='1798'>
<a name='1799'>
      end subroutine <a name='1800'>
<a name='1801'>
      end module rrlw_kg08_f<a name='1802'>
<a name='1803'>
<A NAME='RRLW_KG09_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1804'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg09_f</font> <A href='../../call_to/RRLW_KG09_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG09_F.html' TARGET='index'>1</A><a name='1805'>
<a name='1806'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1807'></font>
<a name='1808'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_9"><a name='1809'>
<font color=#447700>!     implicit none<a name='1810'></font>
      save<a name='1811'>
<a name='1812'>
<font color=#447700>!-----------------------------------------------------------------<a name='1813'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 9<a name='1814'></font>
<font color=#447700>! band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='1815'></font>
<font color=#447700>!<a name='1816'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1817'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1818'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1819'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1820'></font>
<font color=#447700>!<a name='1821'></font>
<font color=#447700>!  name     type     purpose<a name='1822'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1823'></font>
<font color=#447700>!fracrefao: real    <a name='1824'></font>
<font color=#447700>!fracrefbo: real    <a name='1825'></font>
<font color=#447700>! kao     : real     <a name='1826'></font>
<font color=#447700>! kbo     : real     <a name='1827'></font>
<font color=#447700>! kao_mn2o: real     <a name='1828'></font>
<font color=#447700>! kbo_mn2o: real     <a name='1829'></font>
<font color=#447700>! selfrefo: real     <a name='1830'></font>
<font color=#447700>! forrefo : real     <a name='1831'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1832'></font>
<a name='1833'>
      integer , parameter :: no9  = 16<a name='1834'>
<a name='1835'>
      real  _cpus, dimension(no9) :: fracrefbo<a name='1836'>
<a name='1837'>
      real  _cpus :: fracrefao(no9,9)<a name='1838'>
      real  _cpus :: kao(9,5,13,no9)<a name='1839'>
      real  _cpus :: kbo(5,13:59,no9)<a name='1840'>
      real  _cpus :: kao_mn2o(9,19,no9)<a name='1841'>
      real  _cpus :: kbo_mn2o(19,no9)<a name='1842'>
      real  _cpus :: selfrefo(10,no9)<a name='1843'>
      real  _cpus :: forrefo(4,no9)<a name='1844'>
<a name='1845'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='1846'>
<a name='1847'>
      real  _gpudeva :: fracrefaod(:,:)<a name='1848'>
      real  _gpudev :: kaod(9,5,13,no9)<a name='1849'>
      real  _gpudev :: kbod(5,13:59,no9)<a name='1850'>
      real  _gpudeva :: kao_mn2od(:,:,:)<a name='1851'>
      real  _gpudeva :: kbo_mn2od(:,:)<a name='1852'>
      real  _gpudeva :: selfrefod(:,:)<a name='1853'>
      real  _gpudeva :: forrefod(:,:)<a name='1854'>
<a name='1855'>
<font color=#447700>!-----------------------------------------------------------------<a name='1856'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 9<a name='1857'></font>
<font color=#447700>! band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='1858'></font>
<font color=#447700>!<a name='1859'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1860'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1861'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1862'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1863'></font>
<font color=#447700>!<a name='1864'></font>
<font color=#447700>!  name     type     purpose<a name='1865'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1866'></font>
<font color=#447700>!fracrefa : real    <a name='1867'></font>
<font color=#447700>!fracrefb : real    <a name='1868'></font>
<font color=#447700>! ka      : real     <a name='1869'></font>
<font color=#447700>! kb      : real     <a name='1870'></font>
<font color=#447700>! ka_mn2o : real     <a name='1871'></font>
<font color=#447700>! kb_mn2o : real     <a name='1872'></font>
<font color=#447700>! selfref : real     <a name='1873'></font>
<font color=#447700>! forref  : real     <a name='1874'></font>
<font color=#447700>!<a name='1875'></font>
<font color=#447700>! absa    : real<a name='1876'></font>
<font color=#447700>! absb    : real<a name='1877'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1878'></font>
<a name='1879'>
      integer , parameter :: ng9  = 12<a name='1880'>
<a name='1881'>
      real  _cpus, dimension(ng9) :: fracrefb<a name='1882'>
      real  _cpus :: fracrefa(ng9,9)<a name='1883'>
      real  _cpusnp :: ka(9,5,13,ng9) ,absa(585,ng9)<a name='1884'>
      real  _cpusnp :: kb(5,13:59,ng9) ,absb(235,ng9)<a name='1885'>
      real  _cpus :: ka_mn2o(9,19,ng9)<a name='1886'>
      real  _cpus :: kb_mn2o(19,ng9)<a name='1887'>
      real  _cpus :: selfref(10,ng9)<a name='1888'>
      real  _cpus :: forref(4,ng9)<a name='1889'>
<a name='1890'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='1891'>
      real  _gpudeva :: fracrefad(:,:)<a name='1892'>
      real  _gpudevanp ::  absad(:,:)<a name='1893'>
      real  _gpudevanp ::  absbd(:,:)<a name='1894'>
      real  _gpudeva :: ka_mn2od(:,:,:)<a name='1895'>
      real  _gpudeva :: kb_mn2od(:,:)<a name='1896'>
      real  _gpudeva :: selfrefd(:,:)<a name='1897'>
      real  _gpudeva :: forrefd(:,:)<a name='1898'>
<a name='1899'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='1900'>
<a name='1901'>
      contains <a name='1902'>
<a name='1903'>
<A NAME='COPYTOGPU9'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU9' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1904'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU9</font> <A href='../../call_to/COPYTOGPU9.html' TARGET='index'>1</A><a name='1905'>
<a name='1906'>
       kaod = kao<a name='1907'>
       kbod = kbo<a name='1908'>
<a name='1909'>
       dbcop( fracrefao , fracrefaod )<a name='1910'>
       dbcop( fracrefbo , fracrefbod )<a name='1911'>
<a name='1912'>
       dbcopnp( absa , absad , 585 , ng9  )<a name='1913'>
       dbcopnp( absb , absbd, 235 , ng9 )<a name='1914'>
<a name='1915'>
       dbcop( kao_mn2o , kao_mn2od )<a name='1916'>
       dbcop( kbo_mn2o , kbo_mn2od )<a name='1917'>
       dbcop( selfref , selfrefd )<a name='1918'>
       dbcop( forref , forrefd )<a name='1919'>
<a name='1920'>
       dbcop( fracrefa , fracrefad )<a name='1921'>
       dbcop( fracrefb , fracrefbd )<a name='1922'>
<a name='1923'>
       dbcop( ka_mn2o , ka_mn2od )<a name='1924'>
       dbcop( kb_mn2o , kb_mn2od )<a name='1925'>
       dbcop( selfrefo , selfrefod )<a name='1926'>
       dbcop( forrefo , forrefod )<a name='1927'>
<a name='1928'>
      end subroutine <a name='1929'>
<a name='1930'>
<A NAME='REG9'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG9' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1931'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg9</font> <A href='../../call_to/REG9.html' TARGET='index'>1</A><a name='1932'>
<a name='1933'>
       <font color=#447700>!105<a name='1934'></font>
       dbreg( fracrefao )<a name='1935'>
       dbreg( fracrefbo )<a name='1936'>
<a name='1937'>
       dbreg( kao_mn2o )<a name='1938'>
       dbreg( kbo_mn2o )<a name='1939'>
       dbreg( selfrefo )<a name='1940'>
       dbreg( forrefo )<a name='1941'>
<a name='1942'>
       dbreg( fracrefa )<a name='1943'>
       dbreg( fracrefb )<a name='1944'>
<a name='1945'>
       dbreg( absa )<a name='1946'>
       dbreg( absb )<a name='1947'>
       dbreg( ka_mn2o )<a name='1948'>
       dbreg( kb_mn2o )<a name='1949'>
       dbreg( selfref )<a name='1950'>
       dbreg( forref )<a name='1951'>
<a name='1952'>
      end subroutine <a name='1953'>
<a name='1954'>
      end module rrlw_kg09_f<a name='1955'>
<a name='1956'>
<A NAME='RRLW_KG10_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1957'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg10_f</font> <A href='../../call_to/RRLW_KG10_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG10_F.html' TARGET='index'>1</A><a name='1958'>
<a name='1959'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='1960'></font>
<a name='1961'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_10"><a name='1962'>
<font color=#447700>!     implicit none<a name='1963'></font>
      save<a name='1964'>
<a name='1965'>
<font color=#447700>!-----------------------------------------------------------------<a name='1966'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 10<a name='1967'></font>
<font color=#447700>! band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='1968'></font>
<font color=#447700>!<a name='1969'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1970'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1971'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1972'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1973'></font>
<font color=#447700>!<a name='1974'></font>
<font color=#447700>!  name     type     purpose<a name='1975'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1976'></font>
<font color=#447700>!fracrefao: real    <a name='1977'></font>
<font color=#447700>!fracrefbo: real    <a name='1978'></font>
<font color=#447700>! kao     : real     <a name='1979'></font>
<font color=#447700>! kbo     : real     <a name='1980'></font>
<font color=#447700>! selfrefo: real     <a name='1981'></font>
<font color=#447700>! forrefo : real     <a name='1982'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1983'></font>
<a name='1984'>
      integer , parameter :: no10 = 16<a name='1985'>
<a name='1986'>
      real  _cpus, dimension(no10) :: fracrefao<a name='1987'>
      real  _cpus, dimension(no10) :: fracrefbo<a name='1988'>
<a name='1989'>
      real  _cpus :: kao(5,13,no10)<a name='1990'>
      real  _cpus :: kbo(5,13:59,no10)<a name='1991'>
      real  _cpus :: selfrefo(10,no10)<a name='1992'>
      real  _cpus :: forrefo(4,no10)<a name='1993'>
<a name='1994'>
      real  _gpudeva , dimension(:) :: fracrefaod<a name='1995'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='1996'>
<a name='1997'>
      real  _gpudev :: kaod(5,13,no10)<a name='1998'>
      real  _gpudev :: kbod(5,13:59,no10)<a name='1999'>
      real  _gpudeva :: selfrefod(:,:)<a name='2000'>
      real  _gpudeva :: forrefod(:,:)<a name='2001'>
<a name='2002'>
<font color=#447700>!-----------------------------------------------------------------<a name='2003'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 10<a name='2004'></font>
<font color=#447700>! band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='2005'></font>
<font color=#447700>!<a name='2006'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2007'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2008'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2009'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2010'></font>
<font color=#447700>!<a name='2011'></font>
<font color=#447700>!  name     type     purpose<a name='2012'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2013'></font>
<font color=#447700>!fracrefao: real    <a name='2014'></font>
<font color=#447700>!fracrefbo: real    <a name='2015'></font>
<font color=#447700>! kao     : real     <a name='2016'></font>
<font color=#447700>! kbo     : real     <a name='2017'></font>
<font color=#447700>! selfref : real     <a name='2018'></font>
<font color=#447700>! forref  : real     <a name='2019'></font>
<font color=#447700>!<a name='2020'></font>
<font color=#447700>! absa    : real<a name='2021'></font>
<font color=#447700>! absb    : real<a name='2022'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2023'></font>
<a name='2024'>
      integer , parameter :: ng10 = 6<a name='2025'>
<a name='2026'>
      real  _cpus , dimension(ng10) :: fracrefa<a name='2027'>
      real  _cpus , dimension(ng10) :: fracrefb<a name='2028'>
<a name='2029'>
      real  _cpusnp :: ka(5,13,ng10)   , absa(65,ng10)<a name='2030'>
      real  _cpusnp :: kb(5,13:59,ng10), absb(235,ng10)<a name='2031'>
      real  _cpus :: selfref(10,ng10)<a name='2032'>
      real  _cpus :: forref(4,ng10)<a name='2033'>
<a name='2034'>
      real  _gpudeva , dimension(:) :: fracrefad<a name='2035'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='2036'>
<a name='2037'>
      real  _gpudevanp ::   absad(:,:)<a name='2038'>
      real  _gpudevanp ::   absbd(:,:)<a name='2039'>
      real  _gpudeva :: selfrefd(:,:)<a name='2040'>
      real  _gpudeva :: forrefd(:,:)<a name='2041'>
      <a name='2042'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='2043'>
<a name='2044'>
      contains <a name='2045'>
<a name='2046'>
<A NAME='COPYTOGPU10'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2047'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU10</font> <A href='../../call_to/COPYTOGPU10.html' TARGET='index'>1</A><a name='2048'>
<a name='2049'>
       kaod = kao<a name='2050'>
       kbod = kbo<a name='2051'>
<a name='2052'>
       dbcop( fracrefao , fracrefaod )<a name='2053'>
       dbcop( fracrefbo , fracrefbod )<a name='2054'>
<a name='2055'>
       <font color=#447700>!dbcop( kao , kaod ) <a name='2056'></font>
       <font color=#447700>!dbcop( kbo , kbod )<a name='2057'></font>
       dbcop( selfrefo , selfrefod )<a name='2058'>
       dbcop( forrefo , forrefod )<a name='2059'>
<a name='2060'>
       dbcop( fracrefa , fracrefad )<a name='2061'>
       dbcop( fracrefb , fracrefbd )<a name='2062'>
<a name='2063'>
       <font color=#447700>!dbcop( ka , kad ) <a name='2064'></font>
       <font color=#447700>!dbcop( kb , kbd )<a name='2065'></font>
       dbcopnp( absa , absad, 65 , ng10 )<a name='2066'>
       dbcopnp( absb , absbd, 235 , ng10 )<a name='2067'>
<a name='2068'>
       dbcop( selfref , selfrefd )<a name='2069'>
       dbcop( forref , forrefd )<a name='2070'>
<a name='2071'>
      end subroutine <a name='2072'>
<a name='2073'>
<A NAME='REG10'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2074'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg10</font> <A href='../../call_to/REG10.html' TARGET='index'>1</A><a name='2075'>
<a name='2076'>
       dbreg( fracrefao )<a name='2077'>
       dbreg( fracrefbo )<a name='2078'>
<a name='2079'>
       <font color=#447700>!dbreg( kao ) <a name='2080'></font>
       <font color=#447700>!dbreg( kbo )<a name='2081'></font>
       dbreg( selfrefo )<a name='2082'>
       dbreg( forrefo )<a name='2083'>
<a name='2084'>
       dbreg( fracrefa )<a name='2085'>
       dbreg( fracrefb )<a name='2086'>
<a name='2087'>
       <font color=#447700>!dbreg( ka ) <a name='2088'></font>
       <font color=#447700>!dbreg( kb )<a name='2089'></font>
       dbreg( absa )<a name='2090'>
       dbreg( absb )<a name='2091'>
       dbreg( selfref )<a name='2092'>
       dbreg( forref )<a name='2093'>
<a name='2094'>
      end subroutine <a name='2095'>
<a name='2096'>
      end module rrlw_kg10_f<a name='2097'>
<a name='2098'>
<A NAME='RRLW_KG11_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2099'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg11_f</font> <A href='../../call_to/RRLW_KG11_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG11_F.html' TARGET='index'>1</A><a name='2100'>
<a name='2101'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2102'></font>
<a name='2103'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_11"><a name='2104'>
<font color=#447700>!     implicit none<a name='2105'></font>
      save<a name='2106'>
<a name='2107'>
<font color=#447700>!-----------------------------------------------------------------<a name='2108'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 11<a name='2109'></font>
<font color=#447700>! band 11:  1480-1800 cm-1 (low - h2o; high - h2o)<a name='2110'></font>
<font color=#447700>!<a name='2111'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2112'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2113'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2114'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2115'></font>
<font color=#447700>!<a name='2116'></font>
<font color=#447700>!  name     type     purpose<a name='2117'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2118'></font>
<font color=#447700>!fracrefao: real    <a name='2119'></font>
<font color=#447700>!fracrefbo: real    <a name='2120'></font>
<font color=#447700>! kao     : real     <a name='2121'></font>
<font color=#447700>! kbo     : real     <a name='2122'></font>
<font color=#447700>! kao_mo2 : real     <a name='2123'></font>
<font color=#447700>! kbo_mo2 : real     <a name='2124'></font>
<font color=#447700>! selfrefo: real     <a name='2125'></font>
<font color=#447700>! forrefo : real     <a name='2126'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2127'></font>
<a name='2128'>
      integer , parameter :: no11 = 16<a name='2129'>
<a name='2130'>
      real  _cpus, dimension(no11) :: fracrefao<a name='2131'>
      real  _cpus, dimension(no11) :: fracrefbo<a name='2132'>
<a name='2133'>
      real  _cpus :: kao(5,13,no11)<a name='2134'>
      real  _cpus :: kbo(5,13:59,no11)<a name='2135'>
      real  _cpus :: kao_mo2(19,no11)<a name='2136'>
      real  _cpus :: kbo_mo2(19,no11)<a name='2137'>
      real  _cpus :: selfrefo(10,no11)<a name='2138'>
      real  _cpus :: forrefo(4,no11)<a name='2139'>
<a name='2140'>
      real  _gpudeva , dimension(:) :: fracrefaod<a name='2141'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='2142'>
<a name='2143'>
      real  _gpudev :: kaod(5,13,no11)<a name='2144'>
      real  _gpudev :: kbod(5,13:59,no11)<a name='2145'>
      real  _gpudeva :: kao_mo2d(:,:)<a name='2146'>
      real  _gpudeva :: kbo_mo2d(:,:)<a name='2147'>
      real  _gpudeva :: selfrefod(:,:)<a name='2148'>
      real  _gpudeva :: forrefod(:,:)<a name='2149'>
<a name='2150'>
<font color=#447700>!-----------------------------------------------------------------<a name='2151'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 11<a name='2152'></font>
<font color=#447700>! band 11:  1480-1800 cm-1 (low - h2o; high - h2o)<a name='2153'></font>
<font color=#447700>!<a name='2154'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2155'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2156'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2157'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2158'></font>
<font color=#447700>!<a name='2159'></font>
<font color=#447700>!  name     type     purpose<a name='2160'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2161'></font>
<font color=#447700>!fracrefa : real    <a name='2162'></font>
<font color=#447700>!fracrefb : real    <a name='2163'></font>
<font color=#447700>! ka      : real     <a name='2164'></font>
<font color=#447700>! kb      : real     <a name='2165'></font>
<font color=#447700>! ka_mo2  : real     <a name='2166'></font>
<font color=#447700>! kb_mo2  : real     <a name='2167'></font>
<font color=#447700>! selfref : real     <a name='2168'></font>
<font color=#447700>! forref  : real     <a name='2169'></font>
<font color=#447700>!<a name='2170'></font>
<font color=#447700>! absa    : real<a name='2171'></font>
<font color=#447700>! absb    : real<a name='2172'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2173'></font>
<a name='2174'>
      integer , parameter :: ng11 = 8<a name='2175'>
<a name='2176'>
      real  _cpus, dimension(ng11) :: fracrefa<a name='2177'>
      real  _cpus, dimension(ng11) :: fracrefb<a name='2178'>
<a name='2179'>
      real  _cpusnp :: ka(5,13,ng11)   , absa(65,ng11)<a name='2180'>
      real  _cpusnp :: kb(5,13:59,ng11), absb(235,ng11)<a name='2181'>
      real  _cpus :: ka_mo2(19,ng11)<a name='2182'>
      real  _cpus :: kb_mo2(19,ng11)<a name='2183'>
      real  _cpus :: selfref(10,ng11)<a name='2184'>
      real  _cpus :: forref(4,ng11)<a name='2185'>
<a name='2186'>
      real  _gpudeva , dimension(:) :: fracrefad<a name='2187'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='2188'>
<a name='2189'>
      real  _gpudevanp ::   absad(:,:)<a name='2190'>
      real  _gpudevanp ::   absbd(:,:)<a name='2191'>
      real  _gpudeva :: ka_mo2d(:,:)<a name='2192'>
      real  _gpudeva :: kb_mo2d(:,:)<a name='2193'>
      real  _gpudeva :: selfrefd(:,:)<a name='2194'>
      real  _gpudeva :: forrefd(:,:)<a name='2195'>
<a name='2196'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='2197'>
<a name='2198'>
      contains <a name='2199'>
<a name='2200'>
<A NAME='COPYTOGPU11'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2201'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU11</font> <A href='../../call_to/COPYTOGPU11.html' TARGET='index'>1</A><a name='2202'>
<a name='2203'>
       dbcop( fracrefa , fracrefad )<a name='2204'>
       dbcop( fracrefb , fracrefbd )<a name='2205'>
     <a name='2206'>
       dbcopnp( absa , absad , 65 ,  ng11 )     <a name='2207'>
       dbcopnp( absb , absbd , 235 , ng11 )<a name='2208'>
<a name='2209'>
       dbcop( ka_mo2 , ka_mo2d )<a name='2210'>
       dbcop( kb_mo2 , kb_mo2d )<a name='2211'>
       dbcop( selfref , selfrefd )<a name='2212'>
       dbcop( forref , forrefd )<a name='2213'>
<a name='2214'>
      end subroutine <a name='2215'>
<a name='2216'>
<A NAME='REG11'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2217'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg11</font> <A href='../../call_to/REG11.html' TARGET='index'>1</A><a name='2218'>
<a name='2219'>
       dbreg( fracrefa )<a name='2220'>
       dbreg( fracrefb )<a name='2221'>
<a name='2222'>
       <font color=#447700>!dbreg( ka ) <a name='2223'></font>
       dbreg( absa )<a name='2224'>
       <font color=#447700>!dbreg( kb )<a name='2225'></font>
       dbreg( absb )<a name='2226'>
       dbreg( ka_mo2 )<a name='2227'>
       dbreg( kb_mo2 )<a name='2228'>
       dbreg( selfref )<a name='2229'>
       dbreg( forref )<a name='2230'>
<a name='2231'>
      end subroutine <a name='2232'>
<a name='2233'>
      end module rrlw_kg11_f<a name='2234'>
<a name='2235'>
<A NAME='RRLW_KG12_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2236'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg12_f</font> <A href='../../call_to/RRLW_KG12_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG12_F.html' TARGET='index'>1</A><a name='2237'>
<a name='2238'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2239'></font>
<a name='2240'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_12"><a name='2241'>
<font color=#447700>!     implicit none<a name='2242'></font>
      save<a name='2243'>
<a name='2244'>
<font color=#447700>!-----------------------------------------------------------------<a name='2245'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 12<a name='2246'></font>
<font color=#447700>! band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='2247'></font>
<font color=#447700>!<a name='2248'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2249'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2250'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2251'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2252'></font>
<font color=#447700>!<a name='2253'></font>
<font color=#447700>!  name     type     purpose<a name='2254'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2255'></font>
<font color=#447700>!fracrefao: real    <a name='2256'></font>
<font color=#447700>! kao     : real     <a name='2257'></font>
<font color=#447700>! selfrefo: real     <a name='2258'></font>
<font color=#447700>! forrefo : real     <a name='2259'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2260'></font>
<a name='2261'>
      integer , parameter :: no12 = 16<a name='2262'>
<a name='2263'>
      real  _cpus :: fracrefao(no12,9)<a name='2264'>
      real  _cpus :: kao(9,5,13,no12)<a name='2265'>
      real  _cpus :: selfrefo(10,no12)<a name='2266'>
      real  _cpus :: forrefo(4,no12)<a name='2267'>
<a name='2268'>
      real  _gpudeva :: fracrefaod(:,:)<a name='2269'>
      real  _gpudev :: kaod(9,5,13,no12) <a name='2270'>
      real  _gpudeva :: selfrefod(:,:)<a name='2271'>
      real  _gpudeva :: forrefod(:,:)<a name='2272'>
<a name='2273'>
<font color=#447700>!-----------------------------------------------------------------<a name='2274'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 12<a name='2275'></font>
<font color=#447700>! band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='2276'></font>
<font color=#447700>!<a name='2277'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2278'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2279'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2280'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2281'></font>
<font color=#447700>!<a name='2282'></font>
<font color=#447700>!  name     type     purpose<a name='2283'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2284'></font>
<font color=#447700>!fracrefa : real    <a name='2285'></font>
<font color=#447700>! ka      : real     <a name='2286'></font>
<font color=#447700>! selfref : real     <a name='2287'></font>
<font color=#447700>! forref  : real     <a name='2288'></font>
<font color=#447700>!<a name='2289'></font>
<font color=#447700>! absa    : real<a name='2290'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2291'></font>
<a name='2292'>
      integer , parameter :: ng12 = 8<a name='2293'>
<a name='2294'>
      real  _cpus :: fracrefa(ng12,9)<a name='2295'>
      real  _cpusnp :: ka(9,5,13,ng12) ,absa(585,ng12)<a name='2296'>
      real  _cpus :: selfref(10,ng12)<a name='2297'>
      real  _cpus :: forref(4,ng12)<a name='2298'>
<a name='2299'>
      real  _gpudeva :: fracrefad(:,:)<a name='2300'>
      real  _gpudevanp ::  absad(:,:)<a name='2301'>
      real  _gpudeva :: selfrefd(:,:)<a name='2302'>
      real  _gpudeva :: forrefd(:,:)<a name='2303'>
<a name='2304'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='2305'>
<a name='2306'>
      contains <a name='2307'>
<a name='2308'>
<A NAME='COPYTOGPU12'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2309'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU12</font> <A href='../../call_to/COPYTOGPU12.html' TARGET='index'>1</A><a name='2310'>
<a name='2311'>
       kao = kaod<a name='2312'>
<a name='2313'>
       dbcop( fracrefao , fracrefaod )<a name='2314'>
       <font color=#447700>!dbcop( kao , kaod ) <a name='2315'></font>
       dbcop( selfrefo , selfrefod )<a name='2316'>
       dbcop( forrefo , forrefod )<a name='2317'>
<a name='2318'>
       dbcop( fracrefa , fracrefad )<a name='2319'>
       <font color=#447700>!dbcop( ka , kad ) <a name='2320'></font>
       dbcopnp( absa , absad , 585 , ng12 )<a name='2321'>
     <a name='2322'>
       dbcop( selfref , selfrefd )<a name='2323'>
       dbcop( forref , forrefd )<a name='2324'>
<a name='2325'>
      end subroutine<a name='2326'>
<a name='2327'>
<A NAME='REG12'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2328'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg12</font> <A href='../../call_to/REG12.html' TARGET='index'>1</A><a name='2329'>
<a name='2330'>
       dbreg( fracrefao )<a name='2331'>
       <font color=#447700>!dbreg( kao ) <a name='2332'></font>
       dbreg( selfrefo )<a name='2333'>
       dbreg( forrefo )<a name='2334'>
<a name='2335'>
       dbreg( fracrefa )<a name='2336'>
       <font color=#447700>!dbreg( ka ) <a name='2337'></font>
       dbreg( absa )<a name='2338'>
     <a name='2339'>
       dbreg( selfref )<a name='2340'>
       dbreg( forref )<a name='2341'>
<a name='2342'>
      end subroutine<a name='2343'>
<a name='2344'>
      end module rrlw_kg12_f<a name='2345'>
<a name='2346'>
<A NAME='RRLW_KG13_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2347'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg13_f</font> <A href='../../call_to/RRLW_KG13_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG13_F.html' TARGET='index'>1</A><a name='2348'>
<a name='2349'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2350'></font>
<a name='2351'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_13"><a name='2352'>
<font color=#447700>!     implicit none<a name='2353'></font>
      save<a name='2354'>
<a name='2355'>
<font color=#447700>!-----------------------------------------------------------------<a name='2356'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 13<a name='2357'></font>
<font color=#447700>! band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='2358'></font>
<font color=#447700>!<a name='2359'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2360'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2361'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2362'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2363'></font>
<font color=#447700>!<a name='2364'></font>
<font color=#447700>!  name     type     purpose<a name='2365'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2366'></font>
<font color=#447700>!fracrefao: real    <a name='2367'></font>
<font color=#447700>! kao     : real     <a name='2368'></font>
<font color=#447700>! kao_mco2: real     <a name='2369'></font>
<font color=#447700>! kao_mco : real     <a name='2370'></font>
<font color=#447700>! kbo_mo3 : real     <a name='2371'></font>
<font color=#447700>! selfrefo: real     <a name='2372'></font>
<font color=#447700>! forrefo : real     <a name='2373'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2374'></font>
<a name='2375'>
      integer , parameter :: no13 = 16<a name='2376'>
<a name='2377'>
      real  _cpus, dimension(no13) :: fracrefbo<a name='2378'>
<a name='2379'>
      real  _cpus :: fracrefao(no13,9)<a name='2380'>
      real  _cpus :: kao(9,5,13,no13)<a name='2381'>
      real  _cpus :: kao_mco2(9,19,no13)<a name='2382'>
      real  _cpus :: kao_mco(9,19,no13)<a name='2383'>
      real  _cpus :: kbo_mo3(19,no13)<a name='2384'>
      real  _cpus :: selfrefo(10,no13)<a name='2385'>
      real  _cpus :: forrefo(4,no13)<a name='2386'>
<a name='2387'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='2388'>
<a name='2389'>
      real  _gpudeva  :: fracrefaod(:,:)<a name='2390'>
      real  _gpudev  :: kaod(9,5,13,no13)<a name='2391'>
      real  _gpudeva  :: kao_mco2d(:,:,:)<a name='2392'>
      real  _gpudeva  :: kao_mcod(:,:,:)<a name='2393'>
      real  _gpudeva  :: kbo_mo3d(:,:)<a name='2394'>
      real  _gpudeva  :: selfrefod(:,:)<a name='2395'>
      real  _gpudeva  :: forrefod(:,:)<a name='2396'>
<a name='2397'>
<font color=#447700>!-----------------------------------------------------------------<a name='2398'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 13<a name='2399'></font>
<font color=#447700>! band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='2400'></font>
<font color=#447700>!<a name='2401'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2402'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2403'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2404'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2405'></font>
<font color=#447700>!<a name='2406'></font>
<font color=#447700>!  name     type     purpose<a name='2407'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2408'></font>
<font color=#447700>!fracrefa : real    <a name='2409'></font>
<font color=#447700>! ka      : real     <a name='2410'></font>
<font color=#447700>! ka_mco2 : real     <a name='2411'></font>
<font color=#447700>! ka_mco  : real     <a name='2412'></font>
<font color=#447700>! kb_mo3  : real     <a name='2413'></font>
<font color=#447700>! selfref : real     <a name='2414'></font>
<font color=#447700>! forref  : real     <a name='2415'></font>
<font color=#447700>!<a name='2416'></font>
<font color=#447700>! absa    : real<a name='2417'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2418'></font>
<a name='2419'>
      integer , parameter :: ng13 = 4<a name='2420'>
<a name='2421'>
      real  _cpus, dimension(ng13) :: fracrefb<a name='2422'>
<a name='2423'>
      real  _cpus :: fracrefa(ng13,9)<a name='2424'>
      real  _cpusnp :: ka(9,5,13,ng13) ,absa(585,ng13)<a name='2425'>
      real  _cpus :: ka_mco2(9,19,ng13)<a name='2426'>
      real  _cpus :: ka_mco(9,19,ng13)<a name='2427'>
      real  _cpus :: kb_mo3(19,ng13)<a name='2428'>
      real  _cpus :: selfref(10,ng13)<a name='2429'>
      real  _cpus :: forref(4,ng13)<a name='2430'>
<a name='2431'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='2432'>
<a name='2433'>
      real  _gpudeva :: fracrefad(:,:)<a name='2434'>
      real  _gpudevanp ::  absad(:,:)<a name='2435'>
      real  _gpudeva :: ka_mco2d(:,:,:)<a name='2436'>
      real  _gpudeva :: ka_mcod(:,:,:)<a name='2437'>
      real  _gpudeva :: kb_mo3d(:,:)<a name='2438'>
      real  _gpudeva :: selfrefd(:,:)<a name='2439'>
      real  _gpudeva :: forrefd(:,:)<a name='2440'>
<a name='2441'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='2442'>
<a name='2443'>
      contains<a name='2444'>
      <a name='2445'>
<A NAME='COPYTOGPU13'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2446'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU13</font> <A href='../../call_to/COPYTOGPU13.html' TARGET='index'>1</A><a name='2447'>
<a name='2448'>
       kaod = kao<a name='2449'>
<a name='2450'>
       dbcop( fracrefbo , fracrefbod )<a name='2451'>
       dbcop( fracrefao , fracrefaod )<a name='2452'>
    <a name='2453'>
       dbcop( kao_mco2 , kao_mco2d )<a name='2454'>
       dbcop( kao_mco , kao_mcod )<a name='2455'>
       dbcop( kbo_mo3 , kbo_mo3d )<a name='2456'>
       dbcop( selfrefo , selfrefod )<a name='2457'>
       dbcop( forrefo , forrefod )<a name='2458'>
<a name='2459'>
       dbcop( fracrefb , fracrefbd )<a name='2460'>
       dbcop( fracrefa , fracrefad )<a name='2461'>
<a name='2462'>
       dbcopnp( absa , absad , 585 , ng13)<a name='2463'>
<a name='2464'>
       dbcop( ka_mco2 , ka_mco2d )<a name='2465'>
       dbcop( ka_mco , ka_mcod )<a name='2466'>
       dbcop( kb_mo3 , kb_mo3d )<a name='2467'>
       dbcop( selfref , selfrefd )<a name='2468'>
       dbcop( forref , forrefd )<a name='2469'>
<a name='2470'>
      end subroutine<a name='2471'>
            <a name='2472'>
<A NAME='REG13'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2473'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg13</font> <A href='../../call_to/REG13.html' TARGET='index'>1</A><a name='2474'>
<a name='2475'>
       dbreg( fracrefbo )<a name='2476'>
       dbreg( fracrefao )<a name='2477'>
       <font color=#447700>!dbreg( kao ) <a name='2478'></font>
       dbreg( kao_mco2 )<a name='2479'>
       dbreg( kao_mco )<a name='2480'>
       dbreg( kbo_mo3 )<a name='2481'>
       dbreg( selfrefo )<a name='2482'>
       dbreg( forrefo )<a name='2483'>
<a name='2484'>
       dbreg( fracrefb )<a name='2485'>
       dbreg( fracrefa )<a name='2486'>
       <font color=#447700>!dbreg( ka ) <a name='2487'></font>
       dbreg( absa )<a name='2488'>
       dbreg( ka_mco2 )<a name='2489'>
       dbreg( ka_mco )<a name='2490'>
       dbreg( kb_mo3 )<a name='2491'>
       dbreg( selfref )<a name='2492'>
       dbreg( forref )<a name='2493'>
<a name='2494'>
      end subroutine<a name='2495'>
<a name='2496'>
      end module rrlw_kg13_f<a name='2497'>
<a name='2498'>
<A NAME='RRLW_KG14_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2499'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg14_f</font> <A href='../../call_to/RRLW_KG14_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG14_F.html' TARGET='index'>1</A><a name='2500'>
<a name='2501'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2502'></font>
<a name='2503'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_14"><a name='2504'>
<font color=#447700>!     implicit none<a name='2505'></font>
      save<a name='2506'>
<a name='2507'>
<font color=#447700>!-----------------------------------------------------------------<a name='2508'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 14<a name='2509'></font>
<font color=#447700>! band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='2510'></font>
<font color=#447700>!<a name='2511'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2512'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2513'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2514'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2515'></font>
<font color=#447700>!<a name='2516'></font>
<font color=#447700>!  name     type     purpose<a name='2517'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2518'></font>
<font color=#447700>!fracrefao: real    <a name='2519'></font>
<font color=#447700>!fracrefbo: real    <a name='2520'></font>
<font color=#447700>! kao     : real     <a name='2521'></font>
<font color=#447700>! kbo     : real     <a name='2522'></font>
<font color=#447700>! selfrefo: real     <a name='2523'></font>
<font color=#447700>! forrefo : real     <a name='2524'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2525'></font>
<a name='2526'>
      integer , parameter :: no14 = 16<a name='2527'>
<a name='2528'>
      real  _cpus, dimension(no14) :: fracrefao<a name='2529'>
      real  _cpus, dimension(no14) :: fracrefbo<a name='2530'>
<a name='2531'>
      real  _cpus :: kao(5,13,no14)<a name='2532'>
      real  _cpus :: kbo(5,13:59,no14)<a name='2533'>
      real  _cpus :: selfrefo(10,no14)<a name='2534'>
      real  _cpus :: forrefo(4,no14)<a name='2535'>
<a name='2536'>
      real  _gpudeva , dimension(:) :: fracrefaod<a name='2537'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='2538'>
<a name='2539'>
      real  _gpudev :: kaod(5,13,no14)<a name='2540'>
      real  _gpudev :: kbod(5,13:59,no14)<a name='2541'>
      real  _gpudeva :: selfrefod(:,:)<a name='2542'>
      real  _gpudeva :: forrefod(:,:)<a name='2543'>
<a name='2544'>
<font color=#447700>!-----------------------------------------------------------------<a name='2545'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 14<a name='2546'></font>
<font color=#447700>! band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='2547'></font>
<font color=#447700>!<a name='2548'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2549'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2550'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2551'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2552'></font>
<font color=#447700>!<a name='2553'></font>
<font color=#447700>!  name     type     purpose<a name='2554'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2555'></font>
<font color=#447700>!fracrefa : real    <a name='2556'></font>
<font color=#447700>!fracrefb : real    <a name='2557'></font>
<font color=#447700>! ka      : real     <a name='2558'></font>
<font color=#447700>! kb      : real     <a name='2559'></font>
<font color=#447700>! selfref : real     <a name='2560'></font>
<font color=#447700>! forref  : real     <a name='2561'></font>
<font color=#447700>!<a name='2562'></font>
<font color=#447700>! absa    : real<a name='2563'></font>
<font color=#447700>! absb    : real<a name='2564'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2565'></font>
<a name='2566'>
      integer , parameter :: ng14 = 2<a name='2567'>
<a name='2568'>
      real  _cpus, dimension(ng14) :: fracrefa<a name='2569'>
      real  _cpus, dimension(ng14) :: fracrefb<a name='2570'>
<a name='2571'>
      real  _cpusnp :: ka(5,13,ng14)   ,absa(65,ng14)<a name='2572'>
      real  _cpusnp :: kb(5,13:59,ng14),absb(235,ng14)<a name='2573'>
      real  _cpus :: selfref(10,ng14)<a name='2574'>
      real  _cpus :: forref(4,ng14)<a name='2575'>
<a name='2576'>
      real  _gpudeva , dimension(:) :: fracrefad<a name='2577'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='2578'>
<a name='2579'>
      real  _gpudevanp ::  absad(:,:)<a name='2580'>
      real  _gpudevanp ::  absbd(:,:)<a name='2581'>
      real  _gpudeva :: selfrefd(:,:)<a name='2582'>
      real  _gpudeva :: forrefd(:,:)<a name='2583'>
<a name='2584'>
      equivalence (ka(1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='2585'>
      <a name='2586'>
      contains <a name='2587'>
<a name='2588'>
<A NAME='COPYTOGPU14'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2589'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU14</font> <A href='../../call_to/COPYTOGPU14.html' TARGET='index'>1</A><a name='2590'>
<a name='2591'>
       kaod = kao<a name='2592'>
       kbod = kbo<a name='2593'>
<a name='2594'>
       dbcop( fracrefao , fracrefaod )<a name='2595'>
       dbcop( fracrefbo , fracrefbod )<a name='2596'>
<a name='2597'>
       <font color=#447700>!dbcop( kao , kaod ) <a name='2598'></font>
       <font color=#447700>!dbcop( kbo , kbod )<a name='2599'></font>
       dbcop( selfrefo , selfrefod )<a name='2600'>
       dbcop( forrefo , forrefod )<a name='2601'>
<a name='2602'>
       dbcop( fracrefa , fracrefad )<a name='2603'>
       dbcop( fracrefb , fracrefbd )<a name='2604'>
<a name='2605'>
       <font color=#447700>!dbcop( ka , kad ) <a name='2606'></font>
       <font color=#447700>!dbcop( kb , kbd )<a name='2607'></font>
       dbcopnp( absa , absad , 65 , ng14 )<a name='2608'>
       dbcopnp( absb , absbd , 235 , ng14 )<a name='2609'>
<a name='2610'>
       dbcop( selfref , selfrefd )<a name='2611'>
       dbcop( forref , forrefd )<a name='2612'>
<a name='2613'>
      end subroutine <a name='2614'>
<a name='2615'>
<A NAME='REG14'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2616'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg14</font> <A href='../../call_to/REG14.html' TARGET='index'>1</A><a name='2617'>
<a name='2618'>
       dbreg( fracrefao )<a name='2619'>
       dbreg( fracrefbo )<a name='2620'>
<a name='2621'>
       <font color=#447700>!dbreg( kao )<a name='2622'></font>
       <font color=#447700>!dbreg( kbo )<a name='2623'></font>
       dbreg( selfrefo )<a name='2624'>
       dbreg( forrefo )<a name='2625'>
<a name='2626'>
       dbreg( fracrefa )<a name='2627'>
       dbreg( fracrefb )<a name='2628'>
<a name='2629'>
       <font color=#447700>!dbreg( ka ) <a name='2630'></font>
       <font color=#447700>!dbreg( kb )<a name='2631'></font>
       dbreg( absa )<a name='2632'>
       dbreg( absb )<a name='2633'>
       dbreg( selfref )<a name='2634'>
       dbreg( forref )<a name='2635'>
<a name='2636'>
      end subroutine <a name='2637'>
<a name='2638'>
      end module rrlw_kg14_f<a name='2639'>
<a name='2640'>
<A NAME='RRLW_KG15_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2641'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg15_f</font> <A href='../../call_to/RRLW_KG15_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG15_F.html' TARGET='index'>1</A><a name='2642'>
<a name='2643'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2644'></font>
<a name='2645'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_15"><a name='2646'>
<font color=#447700>!     implicit none<a name='2647'></font>
      save<a name='2648'>
<a name='2649'>
<font color=#447700>!-----------------------------------------------------------------<a name='2650'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 15<a name='2651'></font>
<font color=#447700>! band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='2652'></font>
<font color=#447700>!<a name='2653'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2654'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2655'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2656'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2657'></font>
<font color=#447700>!<a name='2658'></font>
<font color=#447700>!  name     type     purpose<a name='2659'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2660'></font>
<font color=#447700>!fracrefao: real    <a name='2661'></font>
<font color=#447700>! kao     : real     <a name='2662'></font>
<font color=#447700>! kao_mn2 : real     <a name='2663'></font>
<font color=#447700>! selfrefo: real     <a name='2664'></font>
<font color=#447700>! forrefo : real     <a name='2665'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2666'></font>
<a name='2667'>
      integer , parameter :: no15 = 16<a name='2668'>
<a name='2669'>
      real  _cpus :: fracrefao(no15,9)<a name='2670'>
      real  _cpus :: kao(9,5,13,no15)<a name='2671'>
      real  _cpus :: kao_mn2(9,19,no15)<a name='2672'>
      real  _cpus :: selfrefo(10,no15)<a name='2673'>
      real  _cpus :: forrefo(4,no15)<a name='2674'>
<a name='2675'>
      real  _gpudeva :: fracrefaod(:,:)<a name='2676'>
      real  _gpudev :: kaod(9,5,13,no15)<a name='2677'>
      real  _gpudeva :: kao_mn2d(:,:,:)<a name='2678'>
      real  _gpudeva :: selfrefod(:,:)<a name='2679'>
      real  _gpudeva :: forrefod(:,:)<a name='2680'>
<a name='2681'>
<font color=#447700>!-----------------------------------------------------------------<a name='2682'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 15<a name='2683'></font>
<font color=#447700>! band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='2684'></font>
<font color=#447700>!<a name='2685'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2686'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2687'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2688'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2689'></font>
<font color=#447700>!<a name='2690'></font>
<font color=#447700>!  name     type     purpose<a name='2691'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2692'></font>
<font color=#447700>!fracrefa : real    <a name='2693'></font>
<font color=#447700>! ka      : real     <a name='2694'></font>
<font color=#447700>! ka_mn2  : real     <a name='2695'></font>
<font color=#447700>! selfref : real     <a name='2696'></font>
<font color=#447700>! forref  : real     <a name='2697'></font>
<font color=#447700>!<a name='2698'></font>
<font color=#447700>! absa    : real<a name='2699'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2700'></font>
<a name='2701'>
      integer , parameter :: ng15 = 2<a name='2702'>
<a name='2703'>
      real  _cpus :: fracrefa(ng15,9)<a name='2704'>
      real  _cpusnp :: ka(9,5,13,ng15) ,absa(585,ng15)<a name='2705'>
      real  _cpus :: ka_mn2(9,19,ng15)<a name='2706'>
      real  _cpus :: selfref(10,ng15)<a name='2707'>
      real  _cpus :: forref(4,ng15)<a name='2708'>
<a name='2709'>
      real  _gpudeva :: fracrefad(:,:)<a name='2710'>
      real  _gpudevanp ::  absad(:,:)<a name='2711'>
      real  _gpudeva :: ka_mn2d(:,:,:)<a name='2712'>
      real  _gpudeva :: selfrefd(:,:)<a name='2713'>
      real  _gpudeva :: forrefd(:,:)<a name='2714'>
<a name='2715'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='2716'>
<a name='2717'>
      contains <a name='2718'>
<a name='2719'>
<A NAME='COPYTOGPU15'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2720'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU15</font> <A href='../../call_to/COPYTOGPU15.html' TARGET='index'>1</A><a name='2721'>
<a name='2722'>
       kaod = kao<a name='2723'>
<a name='2724'>
       dbcop( fracrefao , fracrefaod )<a name='2725'>
       <font color=#447700>!dbcop( kao , kaod ) <a name='2726'></font>
       dbcop( kao_mn2 , kao_mn2d )<a name='2727'>
       dbcop( selfrefo , selfrefod )<a name='2728'>
       dbcop( forrefo , forrefod )<a name='2729'>
<a name='2730'>
       dbcop( fracrefa , fracrefad )<a name='2731'>
       <font color=#447700>!dbcop( ka , kad ) <a name='2732'></font>
<a name='2733'>
       dbcopnp( absa , absad , 585 , ng15 )<a name='2734'>
<a name='2735'>
       dbcop( ka_mn2 , ka_mn2d )<a name='2736'>
       dbcop( selfref , selfrefd )<a name='2737'>
       dbcop( forref , forrefd )<a name='2738'>
<a name='2739'>
      end subroutine <a name='2740'>
<a name='2741'>
<A NAME='REG15'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2742'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg15</font> <A href='../../call_to/REG15.html' TARGET='index'>1</A><a name='2743'>
<a name='2744'>
       dbreg( fracrefao )<a name='2745'>
       <font color=#447700>!dbreg( kao ) <a name='2746'></font>
       dbreg( kao_mn2 )<a name='2747'>
       dbreg( selfrefo )<a name='2748'>
       dbreg( forrefo )<a name='2749'>
<a name='2750'>
       dbreg( fracrefa )<a name='2751'>
       <font color=#447700>!dbreg( ka ) <a name='2752'></font>
       dbreg( absa )<a name='2753'>
       dbreg( ka_mn2 )<a name='2754'>
       dbreg( selfref )<a name='2755'>
       dbreg( forref )<a name='2756'>
<a name='2757'>
      end subroutine <a name='2758'>
<a name='2759'>
      end module rrlw_kg15_f<a name='2760'>
<a name='2761'>
<A NAME='RRLW_KG16_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2762'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg16_f</font> <A href='../../call_to/RRLW_KG16_F.html' TARGET='index'>4</A>,<A href='../../call_from/RRLW_KG16_F.html' TARGET='index'>1</A><a name='2763'>
<a name='2764'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2765'></font>
<a name='2766'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_16"><a name='2767'>
<font color=#447700>!     implicit none<a name='2768'></font>
      save<a name='2769'>
<a name='2770'>
<font color=#447700>!-----------------------------------------------------------------<a name='2771'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 16<a name='2772'></font>
<font color=#447700>! band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='2773'></font>
<font color=#447700>!<a name='2774'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2775'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2776'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2777'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2778'></font>
<font color=#447700>!<a name='2779'></font>
<font color=#447700>!  name     type     purpose<a name='2780'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2781'></font>
<font color=#447700>!fracrefao: real    <a name='2782'></font>
<font color=#447700>! kao     : real     <a name='2783'></font>
<font color=#447700>! kbo     : real     <a name='2784'></font>
<font color=#447700>! selfrefo: real     <a name='2785'></font>
<font color=#447700>! forrefo : real     <a name='2786'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2787'></font>
<a name='2788'>
      integer , parameter :: no16 = 16<a name='2789'>
<a name='2790'>
      real  _cpus, dimension(no16) :: fracrefbo<a name='2791'>
<a name='2792'>
      real  _cpus :: fracrefao(no16,9)<a name='2793'>
      real  _cpus :: kao(9,5,13,no16)<a name='2794'>
      real  _cpus :: kbo(5,13:59,no16)<a name='2795'>
      real  _cpus :: selfrefo(10,no16)<a name='2796'>
      real  _cpus :: forrefo(4,no16)<a name='2797'>
      <a name='2798'>
      real  _gpudeva , dimension(:) :: fracrefbod<a name='2799'>
      real  _gpudeva :: fracrefaod(:,:)<a name='2800'>
      real  _gpudev :: kaod(9,5,13,no16)<a name='2801'>
      real  _gpudev :: kbod(5,13:59,no16)<a name='2802'>
      real  _gpudeva :: selfrefod(:,:)<a name='2803'>
      real  _gpudeva :: forrefod(:,:)<a name='2804'>
<a name='2805'>
<font color=#447700>!-----------------------------------------------------------------<a name='2806'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 16<a name='2807'></font>
<font color=#447700>! band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='2808'></font>
<font color=#447700>!<a name='2809'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2810'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2811'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2812'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2813'></font>
<font color=#447700>!<a name='2814'></font>
<font color=#447700>!  name     type     purpose<a name='2815'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='2816'></font>
<font color=#447700>!fracrefa : real    <a name='2817'></font>
<font color=#447700>! ka      : real     <a name='2818'></font>
<font color=#447700>! kb      : real     <a name='2819'></font>
<font color=#447700>! selfref : real     <a name='2820'></font>
<font color=#447700>! forref  : real     <a name='2821'></font>
<font color=#447700>!<a name='2822'></font>
<font color=#447700>! absa    : real<a name='2823'></font>
<font color=#447700>! absb    : real<a name='2824'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2825'></font>
<a name='2826'>
      integer , parameter :: ng16 = 2<a name='2827'>
<a name='2828'>
      real  _cpus, dimension(ng16) :: fracrefb<a name='2829'>
<a name='2830'>
      real  _cpus :: fracrefa(ng16,9)<a name='2831'>
      real  _cpusnp :: ka(9,5,13,ng16) ,absa(585,ng16)<a name='2832'>
      real  _cpusnp :: kb(5,13:59,ng16), absb(235,ng16)<a name='2833'>
      real  _cpus :: selfref(10,ng16)<a name='2834'>
      real  _cpus :: forref(4,ng16)<a name='2835'>
<a name='2836'>
      real  _gpudeva , dimension(:) :: fracrefbd<a name='2837'>
<a name='2838'>
      real  _gpudeva :: fracrefad(:,:)<a name='2839'>
      real  _gpudevanp ::  absad(:,:)<a name='2840'>
      real  _gpudevanp ::   absbd(:,:)<a name='2841'>
      real  _gpudeva :: selfrefd(:,:)<a name='2842'>
      real  _gpudeva :: forrefd(:,:)<a name='2843'>
<a name='2844'>
      equivalence (ka(1,1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='2845'>
<a name='2846'>
      contains <a name='2847'>
<a name='2848'>
<A NAME='COPYTOGPU16'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2849'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPU16</font> <A href='../../call_to/COPYTOGPU16.html' TARGET='index'>1</A><a name='2850'>
<a name='2851'>
       kaod = kao<a name='2852'>
       kbod = kbo<a name='2853'>
<a name='2854'>
       dbcop( fracrefao , fracrefaod )<a name='2855'>
<a name='2856'>
       <font color=#447700>!dbcop( kao , kaod ) <a name='2857'></font>
       <font color=#447700>!dbcop( kbo , kbod )<a name='2858'></font>
       dbcop( selfrefo , selfrefod )<a name='2859'>
       dbcop( forrefo , forrefod )<a name='2860'>
<a name='2861'>
       dbcop( fracrefa , fracrefad )<a name='2862'>
       dbcop( fracrefb , fracrefbd )<a name='2863'>
<a name='2864'>
       <font color=#447700>!dbcop( ka , kad ) <a name='2865'></font>
       <font color=#447700>!dbcop( kb , kbd )<a name='2866'></font>
       dbcopnp( absa , absad , 585 , ng16)<a name='2867'>
       dbcopnp( absb , absbd , 235 , ng16)<a name='2868'>
<a name='2869'>
       dbcop( selfref , selfrefd )<a name='2870'>
       dbcop( forref , forrefd )<a name='2871'>
<a name='2872'>
      end subroutine <a name='2873'>
<a name='2874'>
<A NAME='REG16'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2875'>
      <font color=#993300>subroutine </font><font color=#cc0000>reg16</font> <A href='../../call_to/REG16.html' TARGET='index'>1</A><a name='2876'>
 <a name='2877'>
       dbreg( fracrefao )<a name='2878'>
<a name='2879'>
       <font color=#447700>!dbreg( kao ) <a name='2880'></font>
       <font color=#447700>!dbreg( kbo )<a name='2881'></font>
       dbreg( selfrefo )<a name='2882'>
       dbreg( forrefo )<a name='2883'>
<a name='2884'>
       dbreg( fracrefa )<a name='2885'>
       dbreg( fracrefb )<a name='2886'>
<a name='2887'>
       <font color=#447700>!dbreg( ka ) <a name='2888'></font>
       <font color=#447700>!dbreg( kb )<a name='2889'></font>
       dbreg( absa )<a name='2890'>
       dbreg( absb )<a name='2891'>
       dbreg( selfref )<a name='2892'>
       dbreg( forref )<a name='2893'>
<a name='2894'>
      end subroutine <a name='2895'>
<a name='2896'>
      end module rrlw_kg16_f<a name='2897'>
<a name='2898'>
<A NAME='RRLW_NCPAR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_NCPAR' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2899'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_ncpar</font><a name='2900'>
<a name='2901'>
<font color=#447700>!     use parkind ,only : im =&gt; kind , rb =&gt; kind <a name='2902'></font>
<a name='2903'>
<font color=#447700>!     implicit none<a name='2904'></font>
      save<a name='2905'>
        <a name='2906'>
      real , parameter :: cpdair = 1003.5  <font color=#447700>! Specific heat capacity of dry air<a name='2907'></font>
                                                         <font color=#447700>! at constant pressure at 273 K<a name='2908'></font>
                                                         <font color=#447700>! (J kg-1 K-1)<a name='2909'></font>
<a name='2910'>
        <a name='2911'>
      integer , parameter :: maxAbsorberNameLength = 5, &amp;<a name='2912'>
                             Absorber              = 12<a name='2913'>
      character(len = maxAbsorberNameLength), dimension(Absorber), parameter :: &amp;<a name='2914'>
      AbsorberNames = (/        &amp;<a name='2915'>
                                'N2   ',  &amp;<a name='2916'>
                                'CCL4 ',  &amp;<a name='2917'>
                                'CFC11',  &amp;<a name='2918'>
                                'CFC12',  &amp;<a name='2919'>
                                'CFC22',  &amp;<a name='2920'>
                                'H2O  ',  &amp;<a name='2921'>
                                'CO2  ',  &amp;<a name='2922'>
                                'O3   ',  &amp;<a name='2923'>
                                'N2O  ',  &amp; <a name='2924'>
                                'CO   ',  &amp;<a name='2925'>
                                'CH4  ',  &amp;<a name='2926'>
                                'O2   '  /)<a name='2927'>
        <a name='2928'>
       integer , dimension(40) :: status<a name='2929'>
       integer  :: i<a name='2930'>
       integer , parameter :: keylower  = 9,   &amp;<a name='2931'>
                               keyupper  = 5,   &amp;<a name='2932'>
                               Tdiff     = 5,   &amp;<a name='2933'>
                               ps        = 59,  &amp;<a name='2934'>
                               plower    = 13,  &amp;<a name='2935'>
                               pupper    = 47,  &amp;<a name='2936'>
                               Tself     = 10,  &amp;<a name='2937'>
                               Tforeign  = 4,   &amp;<a name='2938'>
                               pforeign  = 4,   &amp;<a name='2939'>
                               T         = 19,  &amp;<a name='2940'>
                               Tplanck   = 181, &amp;<a name='2941'>
                               band      = 16,  &amp;<a name='2942'>
                               GPoint    = 16,  &amp;<a name='2943'>
                               GPointSet = 2<a name='2944'>
                                                  <a name='2945'>
      contains <a name='2946'>
        <a name='2947'>
<A NAME='GETABSORBERINDEX'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETABSORBERINDEX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2948'>
      <font color=#993300>subroutine </font><font color=#cc0000>getAbsorberIndex</font>(AbsorberName,AbsorberIndex)<a name='2949'>
                character(len = *), intent(in) :: AbsorberName<a name='2950'>
                integer , intent(out)           :: AbsorberIndex<a name='2951'>
                <a name='2952'>
                integer  :: m<a name='2953'>
        <a name='2954'>
                AbsorberIndex = -1<a name='2955'>
                do m = 1, Absorber<a name='2956'>
                        if (trim(AbsorberNames(m)) == trim(AbsorberName)) then<a name='2957'>
                                AbsorberIndex = m<a name='2958'>
                        end if<a name='2959'>
                end do<a name='2960'>
                <a name='2961'>
                if (AbsorberIndex == -1) then<a name='2962'>
                        print*, "Absorber name index lookup failed."<a name='2963'>
                end if<a name='2964'>
      end subroutine getAbsorberIndex<a name='2965'>
<a name='2966'>
      end module rrlw_ncpar<a name='2967'>
<a name='2968'>
<A NAME='RRLW_REF_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2969'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_ref_f</font> <A href='../../call_to/RRLW_REF_F.html' TARGET='index'>15</A><a name='2970'>
<a name='2971'>
<font color=#447700>!     use parkind, only : im =&gt; kind , rb =&gt; kind <a name='2972'></font>
<a name='2973'>
<font color=#447700>!     implicit none<a name='2974'></font>
<a name='2975'>
<font color=#447700>!------------------------------------------------------------------<a name='2976'></font>
<font color=#447700>! rrtmg_lw reference atmosphere <a name='2977'></font>
<font color=#447700>! Based on standard mid-latitude summer profile<a name='2978'></font>
<font color=#447700>!<a name='2979'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='2980'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='2981'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='2982'></font>
<font color=#447700>!------------------------------------------------------------------<a name='2983'></font>
<a name='2984'>
<font color=#447700>!  name     type     purpose<a name='2985'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='2986'></font>
<font color=#447700>! pref   :  real   : Reference pressure levels<a name='2987'></font>
<font color=#447700>! preflog:  real   : Reference pressure levels, ln(pref)<a name='2988'></font>
<font color=#447700>! tref   :  real   : Reference temperature levels for MLS profile<a name='2989'></font>
<font color=#447700>! chi_mls:  real   : <a name='2990'></font>
<font color=#447700>!------------------------------------------------------------------<a name='2991'></font>
<a name='2992'>
      real , dimension(59) :: pref<a name='2993'>
      real , dimension(59) :: preflog<a name='2994'>
      real , dimension(59) :: tref<a name='2995'>
      real :: chi_mls(7,59)<a name='2996'>
<a name='2997'>
      <font color=#447700>! (dmb 2012) These GPU arrays are defined as constant so that they are cached.<a name='2998'></font>
      <font color=#447700>! This is really needed because they accessed in quite a scattered pattern.<a name='2999'></font>
      real _gpucon :: chi_mlsd(7,59)<a name='3000'>
      real _gpucon :: preflogd(59)<a name='3001'>
      real _gpucon :: trefd(59)<a name='3002'>
<a name='3003'>
#ifndef _ACCEL<a name='3004'>
# define chi_mlsd chi_mls<a name='3005'>
# define preflogd preflog<a name='3006'>
# define trefd tref<a name='3007'>
#endif<a name='3008'>
<a name='3009'>
      contains<a name='3010'>
<a name='3011'>
      <font color=#447700>! (dmb 2012) Copy the reference arrays over to the GPU<a name='3012'></font>
<A NAME='COPYTOGPUREF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPUREF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3013'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyToGPUref</font>() <A href='../../call_to/COPYTOGPUREF.html' TARGET='index'>1</A><a name='3014'>
<a name='3015'>
        chi_mlsd = chi_mls<a name='3016'>
        preflogd = preflog<a name='3017'>
        trefd = tref<a name='3018'>
<a name='3019'>
      end subroutine <a name='3020'>
<a name='3021'>
      end module rrlw_ref_f<a name='3022'>
<a name='3023'>
<A NAME='RRLW_TBL_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_TBL_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3024'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_tbl_f</font> <A href='../../call_to/RRLW_TBL_F.html' TARGET='index'>4</A><a name='3025'>
<a name='3026'>
<font color=#447700>!     use parkind, only : im =&gt; kind , rb =&gt; kind <a name='3027'></font>
<a name='3028'>
<font color=#447700>!     implicit none<a name='3029'></font>
      save<a name='3030'>
<a name='3031'>
<font color=#447700>!------------------------------------------------------------------<a name='3032'></font>
<font color=#447700>! rrtmg_lw exponential lookup table arrays<a name='3033'></font>
<a name='3034'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='3035'></font>
<font color=#447700>! Revised: MJIacono, AER, Jun 2006<a name='3036'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2007<a name='3037'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2008<a name='3038'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3039'></font>
<a name='3040'>
<font color=#447700>!  name     type     purpose<a name='3041'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='3042'></font>
<font color=#447700>! ntbl   :  integer: Lookup table dimension<a name='3043'></font>
<font color=#447700>! tblint :  real   : Lookup table conversion factor<a name='3044'></font>
<font color=#447700>! tau_tbl:  real   : Clear-sky optical depth (used in cloudy radiative<a name='3045'></font>
<font color=#447700>!                    transfer)<a name='3046'></font>
<font color=#447700>! exp_tbl:  real   : Transmittance lookup table<a name='3047'></font>
<font color=#447700>! tfn_tbl:  real   : Tau transition function; i.e. the transition of<a name='3048'></font>
<font color=#447700>!                    the Planck function from that for the mean layer<a name='3049'></font>
<font color=#447700>!                    temperature to that for the layer boundary<a name='3050'></font>
<font color=#447700>!                    temperature as a function of optical depth.<a name='3051'></font>
<font color=#447700>!                    The "linear in tau" method is used to make <a name='3052'></font>
<font color=#447700>!                    the table.<a name='3053'></font>
<font color=#447700>! pade   :  real   : Pade constant   <a name='3054'></font>
<font color=#447700>! bpade  :  real   : Inverse of Pade constant   <a name='3055'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3056'></font>
<a name='3057'>
      integer , parameter :: ntbl = 10000<a name='3058'>
<a name='3059'>
      real , parameter :: tblint = 10000.0 <a name='3060'>
<a name='3061'>
      real  , dimension(0:ntbl) :: tau_tbl<a name='3062'>
      real  , dimension(0:ntbl) :: exp_tbl<a name='3063'>
      real  , dimension(0:ntbl) :: tfn_tbl<a name='3064'>
<a name='3065'>
      real , parameter :: pade = 0.278 <a name='3066'>
      real  :: bpade<a name='3067'>
<a name='3068'>
      end module rrlw_tbl_f<a name='3069'>
<a name='3070'>
<A NAME='RRLW_VSN_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3071'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_vsn_f</font> <A href='../../call_to/RRLW_VSN_F.html' TARGET='index'>7</A><a name='3072'>
<a name='3073'>
<font color=#447700>!     implicit none<a name='3074'></font>
      save<a name='3075'>
<a name='3076'>
<font color=#447700>!------------------------------------------------------------------<a name='3077'></font>
<font color=#447700>! rrtmg_lw version information<a name='3078'></font>
<a name='3079'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='3080'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='3081'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='3082'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3083'></font>
<a name='3084'>
<font color=#447700>!  name     type     purpose<a name='3085'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='3086'></font>
<font color=#447700>!hnamrtm :character: <a name='3087'></font>
<font color=#447700>!hnamini :character: <a name='3088'></font>
<font color=#447700>!hnamcld :character: <a name='3089'></font>
<font color=#447700>!hnamclc :character: <a name='3090'></font>
<font color=#447700>!hnamrtr :character: <a name='3091'></font>
<font color=#447700>!hnamrtx :character: <a name='3092'></font>
<font color=#447700>!hnamrtc :character: <a name='3093'></font>
<font color=#447700>!hnamset :character: <a name='3094'></font>
<font color=#447700>!hnamtau :character: <a name='3095'></font>
<font color=#447700>!hnamatm :character: <a name='3096'></font>
<font color=#447700>!hnamutl :character: <a name='3097'></font>
<font color=#447700>!hnamext :character: <a name='3098'></font>
<font color=#447700>!hnamkg  :character: <a name='3099'></font>
<font color=#447700>!<a name='3100'></font>
<font color=#447700>! hvrrtm :character: <a name='3101'></font>
<font color=#447700>! hvrini :character: <a name='3102'></font>
<font color=#447700>! hvrcld :character: <a name='3103'></font>
<font color=#447700>! hvrclc :character: <a name='3104'></font>
<font color=#447700>! hvrrtr :character: <a name='3105'></font>
<font color=#447700>! hvrrtx :character: <a name='3106'></font>
<font color=#447700>! hvrrtc :character: <a name='3107'></font>
<font color=#447700>! hvrset :character: <a name='3108'></font>
<font color=#447700>! hvrtau :character: <a name='3109'></font>
<font color=#447700>! hvratm :character: <a name='3110'></font>
<font color=#447700>! hvrutl :character: <a name='3111'></font>
<font color=#447700>! hvrext :character: <a name='3112'></font>
<font color=#447700>! hvrkg  :character: <a name='3113'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3114'></font>
<a name='3115'>
      character*18 hvrrtm,hvrini,hvrcld,hvrclc,hvrrtr,hvrrtx, &amp;<a name='3116'>
                   hvrrtc,hvrset,hvrtau,hvratm,hvrutl,hvrext<a name='3117'>
      character*20 hnamrtm,hnamini,hnamcld,hnamclc,hnamrtr,hnamrtx, &amp;<a name='3118'>
                   hnamrtc,hnamset,hnamtau,hnamatm,hnamutl,hnamext<a name='3119'>
<a name='3120'>
      character*18 hvrkg<a name='3121'>
      character*20 hnamkg<a name='3122'>
<a name='3123'>
      end module rrlw_vsn_f<a name='3124'>
<a name='3125'>
<A NAME='RRLW_WVN_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3126'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_wvn_f</font> <A href='../../call_to/RRLW_WVN_F.html' TARGET='index'>9</A>,<A href='../../call_from/RRLW_WVN_F.html' TARGET='index'>1</A><a name='3127'>
<a name='3128'>
<font color=#447700>!     use parkind, only : im =&gt; kind , rb =&gt; kind <a name='3129'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_1">, only : nbndlw, mg, ngptlw, maxinpx<a name='3130'>
<a name='3131'>
<font color=#447700>!     implicit none<a name='3132'></font>
      save<a name='3133'>
<a name='3134'>
<font color=#447700>!------------------------------------------------------------------<a name='3135'></font>
<font color=#447700>! rrtmg_lw spectral information<a name='3136'></font>
<a name='3137'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='3138'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='3139'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='3140'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3141'></font>
<a name='3142'>
<font color=#447700>!  name     type     purpose<a name='3143'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='3144'></font>
<font color=#447700>! ng     :  integer: Number of original g-intervals in each spectral band<a name='3145'></font>
<font color=#447700>! nspa   :  integer: For the lower atmosphere, the number of reference<a name='3146'></font>
<font color=#447700>!                    atmospheres that are stored for each spectral band<a name='3147'></font>
<font color=#447700>!                    per pressure level and temperature.  Each of these<a name='3148'></font>
<font color=#447700>!                    atmospheres has different relative amounts of the <a name='3149'></font>
<font color=#447700>!                    key species for the band (i.e. different binary<a name='3150'></font>
<font color=#447700>!                    species parameters).<a name='3151'></font>
<font color=#447700>! nspb   :  integer: Same as nspa for the upper atmosphere<a name='3152'></font>
<font color=#447700>!wavenum1:  real   : Spectral band lower boundary in wavenumbers<a name='3153'></font>
<font color=#447700>!wavenum2:  real   : Spectral band upper boundary in wavenumbers<a name='3154'></font>
<font color=#447700>! delwave:  real   : Spectral band width in wavenumbers<a name='3155'></font>
<font color=#447700>! totplnk:  real   : Integrated Planck value for each band; (band 16<a name='3156'></font>
<font color=#447700>!                    includes total from 2600 cm-1 to infinity)<a name='3157'></font>
<font color=#447700>!                    Used for calculation across total spectrum<a name='3158'></font>
<font color=#447700>!totplk16:  real   : Integrated Planck value for band 16 (2600-3250 cm-1)<a name='3159'></font>
<font color=#447700>!                    Used for calculation in band 16 only if <a name='3160'></font>
<font color=#447700>!                    individual band output requested<a name='3161'></font>
<font color=#447700>!totplnkderiv: real: Integrated Planck function derivative with respect<a name='3162'></font>
<font color=#447700>!                    to temperature for each band; (band 16<a name='3163'></font>
<font color=#447700>!                    includes total from 2600 cm-1 to infinity)<a name='3164'></font>
<font color=#447700>!                    Used for calculation across total spectrum<a name='3165'></font>
<font color=#447700>!totplk16deriv:real: Integrated Planck function derivative with respect<a name='3166'></font>
<font color=#447700>!                    to temperature for band 16 (2600-3250 cm-1)<a name='3167'></font>
<font color=#447700>!                    Used for calculation in band 16 only if <a name='3168'></font>
<font color=#447700>!                    individual band output requested<a name='3169'></font>
<font color=#447700>!<a name='3170'></font>
<font color=#447700>! ngc    :  integer: The number of new g-intervals in each band<a name='3171'></font>
<font color=#447700>! ngs    :  integer: The cumulative sum of new g-intervals for each band<a name='3172'></font>
<font color=#447700>! ngm    :  integer: The index of each new g-interval relative to the<a name='3173'></font>
<font color=#447700>!                    original 16 g-intervals in each band<a name='3174'></font>
<font color=#447700>! ngn    :  integer: The number of original g-intervals that are <a name='3175'></font>
<font color=#447700>!                    combined to make each new g-intervals in each band<a name='3176'></font>
<font color=#447700>! ngb    :  integer: The band index for each new g-interval<a name='3177'></font>
<font color=#447700>! wt     :  real   : RRTM weights for the original 16 g-intervals<a name='3178'></font>
<font color=#447700>! rwgt   :  real   : Weights for combining original 16 g-intervals <a name='3179'></font>
<font color=#447700>!                    (256 total) into reduced set of g-intervals <a name='3180'></font>
<font color=#447700>!                    (140 total)<a name='3181'></font>
<font color=#447700>! nxmol  :  integer: Number of cross-section molecules<a name='3182'></font>
<font color=#447700>! ixindx :  integer: Flag for active cross-sections in calculation<a name='3183'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3184'></font>
<a name='3185'>
      integer  :: ng(nbndlw)<a name='3186'>
      integer  :: nspa(nbndlw)<a name='3187'>
      integer  :: nspb(nbndlw)<a name='3188'>
<a name='3189'>
      real  :: wavenum1(nbndlw)<a name='3190'>
      real  :: wavenum2(nbndlw)<a name='3191'>
      real  :: delwave(nbndlw)<a name='3192'>
<a name='3193'>
      real  :: totplnk(181,nbndlw)<a name='3194'>
      real  :: totplk16(181)<a name='3195'>
<a name='3196'>
      real  :: totplnkderiv(181,nbndlw)<a name='3197'>
      real  :: totplk16deriv(181)<a name='3198'>
<a name='3199'>
      integer  :: ngc(nbndlw)<a name='3200'>
      integer  :: ngs(nbndlw)<a name='3201'>
      integer  :: ngn(ngptlw)<a name='3202'>
      integer  :: ngb(ngptlw)<a name='3203'>
      integer  :: ngm(nbndlw*mg)<a name='3204'>
<a name='3205'>
      real  :: wt(mg)<a name='3206'>
      real  :: rwgt(nbndlw*mg)<a name='3207'>
<a name='3208'>
      integer  :: nxmol<a name='3209'>
      integer  :: ixindx(maxinpx)<a name='3210'>
<a name='3211'>
      end module rrlw_wvn_f<a name='3212'>
<a name='3213'>
<a name='3214'>
<font color=#447700>! Fortran-95 implementation of the Mersenne Twister 19937, following <a name='3215'></font>
<font color=#447700>!   the C implementation described below (code mt19937ar-cok.c, dated 2002/2/10), <a name='3216'></font>
<font color=#447700>!   adapted cosmetically by making the names more general.  <a name='3217'></font>
<font color=#447700>! Users must declare one or more variables of type randomNumberSequence in the calling <a name='3218'></font>
<font color=#447700>!   procedure which are then initialized using a required seed. If the <a name='3219'></font>
<font color=#447700>!   variable is not initialized the random numbers will all be 0. <a name='3220'></font>
<font color=#447700>! For example: <a name='3221'></font>
<font color=#447700>! program testRandoms <a name='3222'></font>
<font color=#447700>!   use RandomNumbers<a name='3223'></font>
<font color=#447700>!   type(randomNumberSequence) :: randomNumbers<a name='3224'></font>
<font color=#447700>!   integer                    :: i<a name='3225'></font>
<font color=#447700>!   <a name='3226'></font>
<font color=#447700>!   randomNumbers = new_RandomNumberSequence(seed = 100)<a name='3227'></font>
<font color=#447700>!   do i = 1, 10<a name='3228'></font>
<font color=#447700>!     print ('(f12.10, 2x)'), getRandomReal(randomNumbers)<a name='3229'></font>
<font color=#447700>!   end do<a name='3230'></font>
<font color=#447700>! end program testRandoms<a name='3231'></font>
<font color=#447700>! <a name='3232'></font>
<font color=#447700>! Fortran-95 implementation by <a name='3233'></font>
<font color=#447700>!   Robert Pincus<a name='3234'></font>
<font color=#447700>!   NOAA-CIRES Climate Diagnostics Center<a name='3235'></font>
<font color=#447700>!   Boulder, CO 80305 <a name='3236'></font>
<font color=#447700>!   email: Robert.Pincus@colorado.edu<a name='3237'></font>
<font color=#447700>!<a name='3238'></font>
<font color=#447700>! This documentation in the original C program reads:<a name='3239'></font>
<font color=#447700>! -------------------------------------------------------------<a name='3240'></font>
<font color=#447700>!    A C-program for MT19937, with initialization improved 2002/2/10.<a name='3241'></font>
<font color=#447700>!    Coded by Takuji Nishimura and Makoto Matsumoto.<a name='3242'></font>
<font color=#447700>!    This is a faster version by taking Shawn Cokus's optimization,<a name='3243'></font>
<font color=#447700>!    Matthe Bellew's simplification, Isaku Wada's real version.<a name='3244'></font>
<font color=#447700>! <a name='3245'></font>
<font color=#447700>!    Before using, initialize the state by using init_genrand(seed) <a name='3246'></font>
<font color=#447700>!    or init_by_array(init_key, key_length).<a name='3247'></font>
<font color=#447700>! <a name='3248'></font>
<font color=#447700>!    Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,<a name='3249'></font>
<font color=#447700>!    All rights reserved.                          <a name='3250'></font>
<font color=#447700>! <a name='3251'></font>
<font color=#447700>!    Redistribution and use in source and binary forms, with or without<a name='3252'></font>
<font color=#447700>!    modification, are permitted provided that the following conditions<a name='3253'></font>
<font color=#447700>!    are met:<a name='3254'></font>
<font color=#447700>! <a name='3255'></font>
<font color=#447700>!      1. Redistributions of source code must retain the above copyright<a name='3256'></font>
<font color=#447700>!         notice, this list of conditions and the following disclaimer.<a name='3257'></font>
<font color=#447700>! <a name='3258'></font>
<font color=#447700>!      2. Redistributions in binary form must reproduce the above copyright<a name='3259'></font>
<font color=#447700>!         notice, this list of conditions and the following disclaimer in the<a name='3260'></font>
<font color=#447700>!         documentation and/or other materials provided with the distribution.<a name='3261'></font>
<font color=#447700>! <a name='3262'></font>
<font color=#447700>!      3. The names of its contributors may not be used to endorse or promote <a name='3263'></font>
<font color=#447700>!         products derived from this software without specific prior written <a name='3264'></font>
<font color=#447700>!         permission.<a name='3265'></font>
<font color=#447700>! <a name='3266'></font>
<font color=#447700>!    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS<a name='3267'></font>
<font color=#447700>!    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT<a name='3268'></font>
<font color=#447700>!    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR<a name='3269'></font>
<font color=#447700>!    A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR<a name='3270'></font>
<font color=#447700>!    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,<a name='3271'></font>
<font color=#447700>!    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,<a name='3272'></font>
<font color=#447700>!    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR<a name='3273'></font>
<font color=#447700>!    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF<a name='3274'></font>
<font color=#447700>!    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING<a name='3275'></font>
<font color=#447700>!    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS<a name='3276'></font>
<font color=#447700>!    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<a name='3277'></font>
<font color=#447700>! <a name='3278'></font>
<font color=#447700>! <a name='3279'></font>
<font color=#447700>!    Any feedback is very welcome.<a name='3280'></font>
<font color=#447700>!    http://www.math.keio.ac.jp/matumoto/emt.html<a name='3281'></font>
<font color=#447700>!    email: matumoto@math.keio.ac.jp<a name='3282'></font>
<font color=#447700>! -------------------------------------------------------------<a name='3283'></font>
<a name='3284'>
<A NAME='MERSENNETWISTER_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MERSENNETWISTER_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3285'>
  <font color=#993300>module </font><font color=#cc0000>MersenneTwister_f</font> <A href='../../call_to/MERSENNETWISTER_F.html' TARGET='index'>1</A>,<A href='../../call_from/MERSENNETWISTER_F.html' TARGET='index'>2</A><a name='3286'>
<font color=#447700>! -------------------------------------------------------------<a name='3287'></font>
<a name='3288'>
   <font color=#447700>!use parkind, only : im =&gt; kind , rb =&gt; kind  <a name='3289'></font>
<a name='3290'>
  implicit none<a name='3291'>
  private<a name='3292'>
  <a name='3293'>
  <font color=#447700>! Algorithm parameters<a name='3294'></font>
  <font color=#447700>! -------<a name='3295'></font>
  <font color=#447700>! Period parameters<a name='3296'></font>
  integer , parameter :: blockSize = 624,         &amp;<a name='3297'>
                        M         = 397,         &amp;<a name='3298'>
                        MATRIX_A  = -1727483681, &amp; <font color=#447700>! constant vector a         (0x9908b0dfUL)<a name='3299'></font>
<font color=#447700>!                        UMASK     = -2147483648, &amp; ! most significant w-r bits (0x80000000UL)<a name='3300'></font>
                        UMASK     = -2147483647, &amp; <font color=#447700>! most significant w-r bits (0x80000000UL)<a name='3301'></font>
                        LMASK     =  2147483647    <font color=#447700>! least significant r bits  (0x7fffffffUL)<a name='3302'></font>
  <font color=#447700>! Tempering parameters<a name='3303'></font>
  integer , parameter :: TMASKB= -1658038656, &amp; <font color=#447700>! (0x9d2c5680UL)<a name='3304'></font>
                        TMASKC= -272236544     <font color=#447700>! (0xefc60000UL)<a name='3305'></font>
  <font color=#447700>! -------<a name='3306'></font>
<a name='3307'>
  <font color=#447700>! The type containing the state variable  <a name='3308'></font>
  type randomNumberSequence<a name='3309'>
    integer                             :: currentElement <font color=#447700>! = blockSize<a name='3310'></font>
    integer , dimension(0:blockSize -1) :: state <font color=#447700>! = 0<a name='3311'></font>
  end type randomNumberSequence<a name='3312'>
<a name='3313'>
<A NAME='NEW_RANDOMNUMBERSEQUENCE'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#NEW_RANDOMNUMBERSEQUENCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3314'>
  <font color=#993300>interface </font><font color=#cc0000>new_RandomNumberSequence</font><a name='3315'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_SCALAR'>initialize_scalar</A><A NAME="INITIALIZE_SCALAR_3"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MERSENNETWISTER_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_VECTOR'>initialize_vector</A><A NAME="INITIALIZE_VECTOR_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MERSENNETWISTER_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3316'>
  end interface new_RandomNumberSequence <a name='3317'>
<a name='3318'>
  public :: randomNumberSequence<a name='3319'>
  public :: new_RandomNumberSequence, finalize_RandomNumberSequence, &amp;<a name='3320'>
            getRandomInt, getRandomPositiveInt, getRandomReal<a name='3321'>
<font color=#447700>! -------------------------------------------------------------<a name='3322'></font>
contains<a name='3323'>
  <font color=#447700>! -------------------------------------------------------------<a name='3324'></font>
  <font color=#447700>! Private functions<a name='3325'></font>
  <font color=#447700>! ---------------------------<a name='3326'></font>
<A NAME='MIXBITS'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MIXBITS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3327'>
  <font color=#993300>function </font><font color=#cc0000>mixbits</font>(u, v)<a name='3328'>
    integer , intent( in) :: u, v<a name='3329'>
    integer               :: mixbits<a name='3330'>
    <a name='3331'>
    mixbits = ior(iand(u, UMASK), iand(v, LMASK))<a name='3332'>
  end function mixbits<a name='3333'>
  <font color=#447700>! ---------------------------<a name='3334'></font>
<A NAME='TWIST'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TWIST' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3335'>
  <font color=#993300>function </font><font color=#cc0000>twist</font>(u, v)<a name='3336'>
    integer , intent( in) :: u, v<a name='3337'>
    integer               :: twist<a name='3338'>
<a name='3339'>
    <font color=#447700>! Local variable<a name='3340'></font>
    integer , parameter, dimension(0:1) :: t_matrix = (/ 0 , MATRIX_A /)<a name='3341'>
    <a name='3342'>
    twist = ieor(ishft(mixbits(u, v), -1 ), t_matrix(iand(v, 1 )))<a name='3343'>
    twist = ieor(ishft(mixbits(u, v), -1 ), t_matrix(iand(v, 1 )))<a name='3344'>
  end function twist<a name='3345'>
  <font color=#447700>! ---------------------------<a name='3346'></font>
<A NAME='NEXTSTATE'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#NEXTSTATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3347'>
  <font color=#993300>subroutine </font><font color=#cc0000>nextState</font>(twister) <A href='../../call_to/NEXTSTATE.html' TARGET='index'>2</A><a name='3348'>
    type(randomNumberSequence), intent(inout) :: twister<a name='3349'>
    <a name='3350'>
    <font color=#447700>! Local variables<a name='3351'></font>
    integer  :: k<a name='3352'>
    <a name='3353'>
    do k = 0, blockSize - M - 1<a name='3354'>
      twister%state(k) = ieor(twister%state(k + M), &amp;<a name='3355'>
                              twist(twister%state(k), twister%state(k + 1 )))<a name='3356'>
    end do <a name='3357'>
    do k = blockSize - M, blockSize - 2<a name='3358'>
      twister%state(k) = ieor(twister%state(k + M - blockSize), &amp;<a name='3359'>
                              twist(twister%state(k), twister%state(k + 1 )))<a name='3360'>
    end do <a name='3361'>
    twister%state(blockSize - 1 ) = ieor(twister%state(M - 1 ), &amp;<a name='3362'>
                                        twist(twister%state(blockSize - 1 ), twister%state(0 )))<a name='3363'>
    twister%currentElement = 0 <a name='3364'>
<a name='3365'>
  end subroutine nextState<a name='3366'>
  <font color=#447700>! ---------------------------<a name='3367'></font>
<A NAME='TEMPER'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TEMPER' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3368'>
  elemental <font color=#993300>function </font><font color=#cc0000>temper</font>(y) <A href='../../call_to/TEMPER.html' TARGET='index'>2</A><a name='3369'>
    integer , intent(in) :: y<a name='3370'>
    integer              :: temper<a name='3371'>
    <a name='3372'>
    integer  :: x<a name='3373'>
    <a name='3374'>
    <font color=#447700>! Tempering<a name='3375'></font>
    x      = ieor(y, ishft(y, -11))<a name='3376'>
    x      = ieor(x, iand(ishft(x,  7), TMASKB))<a name='3377'>
    x      = ieor(x, iand(ishft(x, 15), TMASKC))<a name='3378'>
    temper = ieor(x, ishft(x, -18))<a name='3379'>
  end function temper<a name='3380'>
  <font color=#447700>! -------------------------------------------------------------<a name='3381'></font>
  <font color=#447700>! Public (but hidden) functions<a name='3382'></font>
  <font color=#447700>! --------------------<a name='3383'></font>
<A NAME='INITIALIZE_SCALAR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3384'>
  <font color=#993300>function </font><font color=#cc0000>initialize_scalar</font>(seed) result(twister) <A href='../../call_to/INITIALIZE_SCALAR.html' TARGET='index'>4</A><a name='3385'>
    integer ,       intent(in   ) :: seed<a name='3386'>
    type(randomNumberSequence)                :: twister <a name='3387'>
    <a name='3388'>
    integer  :: i<a name='3389'>
    <font color=#447700>! See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. In the previous versions, <a name='3390'></font>
    <font color=#447700>!   MSBs of the seed affect only MSBs of the array state[].                       <a name='3391'></font>
    <font color=#447700>!   2002/01/09 modified by Makoto Matsumoto            <a name='3392'></font>
    <a name='3393'>
    twister%state(0) = iand(seed, -1 )<a name='3394'>
    do i = 1,  blockSize - 1 <font color=#447700>! ubound(twister%state)<a name='3395'></font>
       twister%state(i) = 1812433253  * ieor(twister%state(i-1), &amp;<a name='3396'>
                                            ishft(twister%state(i-1), -30 )) + i<a name='3397'>
       twister%state(i) = iand(twister%state(i), -1 ) <font color=#447700>! for &gt;32 bit machines<a name='3398'></font>
    end do<a name='3399'>
    twister%currentElement = blockSize<a name='3400'>
  end function initialize_scalar<a name='3401'>
  <font color=#447700>! -------------------------------------------------------------<a name='3402'></font>
<A NAME='INITIALIZE_VECTOR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_VECTOR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3403'>
  <font color=#993300>function </font><font color=#cc0000>initialize_vector</font>(seed) result(twister) <A href='../../call_to/INITIALIZE_VECTOR.html' TARGET='index'>2</A>,<A href='../../call_from/INITIALIZE_VECTOR.html' TARGET='index'>2</A><a name='3404'>
    integer , dimension(0:), intent(in) :: seed<a name='3405'>
    type(randomNumberSequence)                      :: twister <a name='3406'>
    <a name='3407'>
    integer  :: i, j, k, nFirstLoop, nWraps<a name='3408'>
    <a name='3409'>
    nWraps  = 0<a name='3410'>
    twister = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_SCALAR'>initialize_scalar</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_VECTOR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIALIZE_SCALAR_4">(19650218 )<a name='3411'>
    <a name='3412'>
    nFirstLoop = max(blockSize, size(seed))<a name='3413'>
    do k = 1, nFirstLoop<a name='3414'>
       i = mod(k + nWraps, blockSize)<a name='3415'>
       j = mod(k - 1,      size(seed))<a name='3416'>
       if(i == 0) then<a name='3417'>
         twister%state(i) = twister%state(blockSize - 1)<a name='3418'>
         twister%state(1) = ieor(twister%state(1),                                 &amp;<a name='3419'>
                                 ieor(twister%state(1-1),                          &amp; <a name='3420'>
                                      ishft(twister%state(1-1), -30 )) * 1664525 ) + &amp; <a name='3421'>
                            seed(j) + j <font color=#447700>! Non-linear<a name='3422'></font>
         twister%state(i) = iand(twister%state(i), -1 ) <font color=#447700>! for &gt;32 bit machines<a name='3423'></font>
         nWraps = nWraps + 1<a name='3424'>
       else<a name='3425'>
         twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='3426'>
                                 ieor(twister%state(i-1),                          &amp; <a name='3427'>
                                      ishft(twister%state(i-1), -30 )) * 1664525 ) + &amp; <a name='3428'>
                            seed(j) + j <font color=#447700>! Non-linear<a name='3429'></font>
         twister%state(i) = iand(twister%state(i), -1 ) <font color=#447700>! for &gt;32 bit machines<a name='3430'></font>
      end if<a name='3431'>
    end do<a name='3432'>
    <a name='3433'>
    <font color=#447700>!<a name='3434'></font>
    <font color=#447700>! Walk through the state array, beginning where we left off in the block above<a name='3435'></font>
    <font color=#447700>! <a name='3436'></font>
    do i = mod(nFirstLoop, blockSize) + nWraps + 1, blockSize - 1<a name='3437'>
      twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='3438'>
                              ieor(twister%state(i-1),                          &amp; <a name='3439'>
                                   ishft(twister%state(i-1), -30 )) * 1566083941 ) - i <font color=#447700>! Non-linear<a name='3440'></font>
      twister%state(i) = iand(twister%state(i), -1 ) <font color=#447700>! for &gt;32 bit machines<a name='3441'></font>
    end do<a name='3442'>
    <a name='3443'>
    twister%state(0) = twister%state(blockSize - 1) <a name='3444'>
    <a name='3445'>
    do i = 1, mod(nFirstLoop, blockSize) + nWraps<a name='3446'>
      twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='3447'>
                              ieor(twister%state(i-1),                          &amp; <a name='3448'>
                                   ishft(twister%state(i-1), -30 )) * 1566083941 ) - i <font color=#447700>! Non-linear<a name='3449'></font>
      twister%state(i) = iand(twister%state(i), -1 ) <font color=#447700>! for &gt;32 bit machines<a name='3450'></font>
    end do<a name='3451'>
    <a name='3452'>
    twister%state(0) = UMASK <a name='3453'>
    twister%currentElement = blockSize<a name='3454'>
    <a name='3455'>
  end function initialize_vector<a name='3456'>
  <font color=#447700>! -------------------------------------------------------------<a name='3457'></font>
  <font color=#447700>! Public functions<a name='3458'></font>
  <font color=#447700>! --------------------<a name='3459'></font>
<A NAME='GETRANDOMINT'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3460'>
  <font color=#993300>function </font><font color=#cc0000>getRandomInt</font>(twister) <A href='../../call_to/GETRANDOMINT.html' TARGET='index'>4</A>,<A href='../../call_from/GETRANDOMINT.html' TARGET='index'>4</A><a name='3461'>
    type(randomNumberSequence), intent(inout) :: twister<a name='3462'>
    integer                         :: getRandomInt<a name='3463'>
    <font color=#447700>! Generate a random integer on the interval [0,0xffffffff]<a name='3464'></font>
    <font color=#447700>!   Equivalent to genrand_int32 in the C code. <a name='3465'></font>
    <font color=#447700>!   Fortran doesn't have a type that's unsigned like C does, <a name='3466'></font>
    <font color=#447700>!   so this is integers in the range -2**31 - 2**31<a name='3467'></font>
    <font color=#447700>! All functions for getting random numbers call this one, <a name='3468'></font>
    <font color=#447700>!   then manipulate the result<a name='3469'></font>
    <a name='3470'>
    if(twister%currentElement &gt;= blockSize) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#NEXTSTATE'>nextState</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXTSTATE_2">(twister)<a name='3471'>
      <a name='3472'>
    getRandomInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TEMPER'>temper</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEMPER_2">(twister%state(twister%currentElement))<a name='3473'>
    twister%currentElement = twister%currentElement + 1<a name='3474'>
  <a name='3475'>
  end function getRandomInt<a name='3476'>
  <font color=#447700>! --------------------<a name='3477'></font>
<A NAME='GETRANDOMPOSITIVEINT'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMPOSITIVEINT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3478'>
  <font color=#993300>function </font><font color=#cc0000>getRandomPositiveInt</font>(twister),<A href='../../call_from/GETRANDOMPOSITIVEINT.html' TARGET='index'>2</A><a name='3479'>
    type(randomNumberSequence), intent(inout) :: twister<a name='3480'>
    integer                         :: getRandomPositiveInt<a name='3481'>
    <font color=#447700>! Generate a random integer on the interval [0,0x7fffffff]<a name='3482'></font>
    <font color=#447700>!   or [0,2**31]<a name='3483'></font>
    <font color=#447700>!   Equivalent to genrand_int31 in the C code. <a name='3484'></font>
    <a name='3485'>
    <font color=#447700>! Local integers<a name='3486'></font>
    integer  :: localInt<a name='3487'>
<a name='3488'>
    localInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT'>getRandomInt</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMPOSITIVEINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMINT_3">(twister)<a name='3489'>
    getRandomPositiveInt = ishft(localInt, -1)<a name='3490'>
  <a name='3491'>
  end function getRandomPositiveInt<a name='3492'>
  <font color=#447700>! --------------------<a name='3493'></font>
<font color=#447700>!! mji - modified Jan 2007, double converted to rrtmg real kind type<a name='3494'></font>
<A NAME='GETRANDOMREAL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3495'>
  <font color=#993300>function </font><font color=#cc0000>getRandomReal</font>(twister) <A href='../../call_to/GETRANDOMREAL.html' TARGET='index'>10</A>,<A href='../../call_from/GETRANDOMREAL.html' TARGET='index'>2</A><a name='3496'>
    type(randomNumberSequence), intent(inout) :: twister<a name='3497'>
<font color=#447700>!    double precision             :: getRandomReal<a name='3498'></font>
    real              :: getRandomReal<a name='3499'>
    <font color=#447700>! Generate a random number on [0,1]<a name='3500'></font>
    <font color=#447700>!   Equivalent to genrand_real1 in the C code<a name='3501'></font>
    <font color=#447700>!   The result is stored as double precision but has 32 bit resolution<a name='3502'></font>
    <a name='3503'>
    integer  :: localInt<a name='3504'>
    <a name='3505'>
    localInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT'>getRandomInt</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMINT_4">(twister)<a name='3506'>
    if(localInt &lt; 0) then<a name='3507'>
<font color=#447700>!      getRandomReal = dble(localInt + 2.0d0**32)/(2.0d0**32 - 1.0d0)<a name='3508'></font>
      getRandomReal = (localInt + 2.0**32 )/(2.0**32  - 1.0 )<a name='3509'>
    else<a name='3510'>
<font color=#447700>!      getRandomReal = dble(localInt            )/(2.0d0**32 - 1.0d0)<a name='3511'></font>
      getRandomReal = (localInt            )/(2.0**32  - 1.0 )<a name='3512'>
    end if<a name='3513'>
<a name='3514'>
  end function getRandomReal<a name='3515'>
  <font color=#447700>! --------------------<a name='3516'></font>
<A NAME='FINALIZE_RANDOMNUMBERSEQUENCE'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#FINALIZE_RANDOMNUMBERSEQUENCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3517'>
  <font color=#993300>subroutine </font><font color=#cc0000>finalize_RandomNumberSequence</font>(twister)<a name='3518'>
    type(randomNumberSequence), intent(inout) :: twister<a name='3519'>
    <a name='3520'>
      twister%currentElement = blockSize<a name='3521'>
      twister%state(:) = 0 <a name='3522'>
  end subroutine finalize_RandomNumberSequence<a name='3523'>
<a name='3524'>
  <font color=#447700>! --------------------  <a name='3525'></font>
  <a name='3526'>
  end module MersenneTwister_f<a name='3527'>
<a name='3528'>
<a name='3529'>
<A NAME='MCICA_RANDOM_NUMBERS_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3530'>
  <font color=#993300>module </font><font color=#cc0000>mcica_random_numbers_f</font> <A href='../../call_to/MCICA_RANDOM_NUMBERS_F.html' TARGET='index'>1</A>,<A href='../../call_from/MCICA_RANDOM_NUMBERS_F.html' TARGET='index'>6</A><a name='3531'>
<a name='3532'>
  <font color=#447700>! Generic module to wrap random number generators. <a name='3533'></font>
  <font color=#447700>!   The module defines a type that identifies the particular stream of random <a name='3534'></font>
  <font color=#447700>!   numbers, and has procedures for initializing it and getting real numbers <a name='3535'></font>
  <font color=#447700>!   in the range 0 to 1. <a name='3536'></font>
  <font color=#447700>! This version uses the Mersenne Twister to generate random numbers on [0, 1]. <a name='3537'></font>
  <font color=#447700>!<a name='3538'></font>
  use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MERSENNETWISTER_F'>MersenneTwister_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MERSENNETWISTER_F_1">, only: randomNumberSequence, &amp; <font color=#447700>! The random number engine.<a name='3539'></font>
                             new_RandomNumberSequence, getRandomReal<a name='3540'>
<font color=#447700>!! mji<a name='3541'></font>
<font color=#447700>!!  use time_manager_mod, only: time_type, get_date<a name='3542'></font>
<a name='3543'>
   <font color=#447700>!use parkind, only : im =&gt; kind , rb =&gt; kind  <a name='3544'></font>
<a name='3545'>
  implicit none<a name='3546'>
  private<a name='3547'>
  <a name='3548'>
  type randomNumberStream<a name='3549'>
    type(randomNumberSequence) :: theNumbers<a name='3550'>
  end type randomNumberStream<a name='3551'>
  <a name='3552'>
<A NAME='GETRANDOMNUMBERS'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBERS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3553'>
  <font color=#993300>interface </font><font color=#cc0000>getRandomNumbers</font><a name='3554'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_SCALAR'>getRandomNumber_Scalar</A><A NAME="GETRANDOMNUMBER_SCALAR_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D'>getRandomNumber_1D</A><A NAME="GETRANDOMNUMBER_1D_3"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_2D'>getRandomNumber_2D</A><A NAME="GETRANDOMNUMBER_2D_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3555'>
  end interface getRandomNumbers<a name='3556'>
  <a name='3557'>
<A NAME='INITIALIZERANDOMNUMBERSTREAM'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3558'>
  <font color=#993300>interface </font><font color=#cc0000>initializeRandomNumberStream</font><a name='3559'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_S'>initializeRandomNumberStream_S</A><A NAME="INITIALIZERANDOMNUMBERSTREAM_S_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_V'>initializeRandomNumberStream_V</A><A NAME="INITIALIZERANDOMNUMBERSTREAM_V_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_RANDOM_NUMBERS_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3560'>
  end interface initializeRandomNumberStream<a name='3561'>
<a name='3562'>
  public :: randomNumberStream,                             &amp;<a name='3563'>
            initializeRandomNumberStream, getRandomNumbers<a name='3564'>
<font color=#447700>!! mji<a name='3565'></font>
<font color=#447700>!!            initializeRandomNumberStream, getRandomNumbers, &amp;<a name='3566'></font>
<font color=#447700>!!            constructSeed<a name='3567'></font>
contains<a name='3568'>
  <font color=#447700>! ---------------------------------------------------------<a name='3569'></font>
  <font color=#447700>! Initialization<a name='3570'></font>
  <font color=#447700>! ---------------------------------------------------------<a name='3571'></font>
<A NAME='INITIALIZERANDOMNUMBERSTREAM_S'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_S' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3572'>
  <font color=#993300>function </font><font color=#cc0000>initializeRandomNumberStream_S</font>(seed) result(new)  <A href='../../call_to/INITIALIZERANDOMNUMBERSTREAM_S.html' TARGET='index'>2</A><a name='3573'>
    integer , intent( in)     :: seed<a name='3574'>
    type(randomNumberStream) :: new<a name='3575'>
    <a name='3576'>
    new%theNumbers = new_RandomNumberSequence(seed)<a name='3577'>
    <a name='3578'>
  end function initializeRandomNumberStream_S<a name='3579'>
  <font color=#447700>! ---------------------------------------------------------<a name='3580'></font>
<A NAME='INITIALIZERANDOMNUMBERSTREAM_V'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_V' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3581'>
  <font color=#993300>function </font><font color=#cc0000>initializeRandomNumberStream_V</font>(seed) result(new)  <A href='../../call_to/INITIALIZERANDOMNUMBERSTREAM_V.html' TARGET='index'>2</A><a name='3582'>
    integer , dimension(:), intent( in) :: seed<a name='3583'>
    type(randomNumberStream)           :: new<a name='3584'>
    <a name='3585'>
    new%theNumbers = new_RandomNumberSequence(seed)<a name='3586'>
    <a name='3587'>
  end function initializeRandomNumberStream_V<a name='3588'>
  <font color=#447700>! ---------------------------------------------------------<a name='3589'></font>
  <font color=#447700>! Procedures for drawing random numbers<a name='3590'></font>
  <font color=#447700>! ---------------------------------------------------------<a name='3591'></font>
<A NAME='GETRANDOMNUMBER_SCALAR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3592'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_Scalar</font>(stream, number) <A href='../../call_to/GETRANDOMNUMBER_SCALAR.html' TARGET='index'>2</A>,<A href='../../call_from/GETRANDOMNUMBER_SCALAR.html' TARGET='index'>2</A><a name='3593'>
    type(randomNumberStream), intent(inout) :: stream<a name='3594'>
    real ,                     intent(  out) :: number<a name='3595'>
    <a name='3596'>
    number = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_6">(stream%theNumbers)<a name='3597'>
  end subroutine getRandomNumber_Scalar<a name='3598'>
  <font color=#447700>! ---------------------------------------------------------<a name='3599'></font>
<A NAME='GETRANDOMNUMBER_1D'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3600'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_1D</font>(stream, numbers) <A href='../../call_to/GETRANDOMNUMBER_1D.html' TARGET='index'>4</A>,<A href='../../call_from/GETRANDOMNUMBER_1D.html' TARGET='index'>2</A><a name='3601'>
    type(randomNumberStream), intent(inout) :: stream<a name='3602'>
    real , dimension(:),       intent(  out) :: numbers<a name='3603'>
    <a name='3604'>
    <font color=#447700>! Local variables<a name='3605'></font>
    integer  :: i<a name='3606'>
    <a name='3607'>
    do i = 1, size(numbers)<a name='3608'>
      numbers(i) = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_7">(stream%theNumbers)<a name='3609'>
    end do<a name='3610'>
  end subroutine getRandomNumber_1D<a name='3611'>
  <font color=#447700>! ---------------------------------------------------------<a name='3612'></font>
<A NAME='GETRANDOMNUMBER_2D'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_2D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3613'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_2D</font>(stream, numbers) <A href='../../call_to/GETRANDOMNUMBER_2D.html' TARGET='index'>2</A>,<A href='../../call_from/GETRANDOMNUMBER_2D.html' TARGET='index'>2</A><a name='3614'>
    type(randomNumberStream), intent(inout) :: stream<a name='3615'>
    real , dimension(:, :),    intent(  out) :: numbers<a name='3616'>
    <a name='3617'>
    <font color=#447700>! Local variables<a name='3618'></font>
    integer  :: i<a name='3619'>
    <a name='3620'>
    do i = 1, size(numbers, 2)<a name='3621'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D'>getRandomNumber_1D</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_2D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMNUMBER_1D_4">(stream, numbers(:, i))<a name='3622'>
    end do<a name='3623'>
  end subroutine getRandomNumber_2D<a name='3624'>
<font color=#447700>! mji<a name='3625'></font>
<font color=#447700>!  ! ---------------------------------------------------------<a name='3626'></font>
<font color=#447700>!  ! Constructing a unique seed from grid cell index and model date/time<a name='3627'></font>
<font color=#447700>!  !   Once we have the GFDL stuff we'll add the year, month, day, hour, minute<a name='3628'></font>
<font color=#447700>!  ! ---------------------------------------------------------<a name='3629'></font>
<font color=#447700>!  function constructSeed(i, j, time) result(seed)<a name='3630'></font>
<font color=#447700>!    integer ,         intent( in)  :: i, j<a name='3631'></font>
<font color=#447700>!    type(time_type), intent( in) :: time<a name='3632'></font>
<font color=#447700>!    integer , dimension(8) :: seed<a name='3633'></font>
<font color=#447700>!    <a name='3634'></font>
<font color=#447700>!    ! Local variables<a name='3635'></font>
<font color=#447700>!    integer  :: year, month, day, hour, minute, second<a name='3636'></font>
<font color=#447700>!    <a name='3637'></font>
<font color=#447700>!    <a name='3638'></font>
<font color=#447700>!    call get_date(time, year, month, day, hour, minute, second)<a name='3639'></font>
<font color=#447700>!    seed = (/ i, j, year, month, day, hour, minute, second /)<a name='3640'></font>
<font color=#447700>!  end function constructSeed<a name='3641'></font>
<a name='3642'>
  end module mcica_random_numbers_f<a name='3643'>
<a name='3644'>
<A NAME='GPU_MCICA_SUBCOL_GEN_LW'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3645'>
      <font color=#993300>module </font><font color=#cc0000>gpu_mcica_subcol_gen_lw</font> <A href='../../call_to/GPU_MCICA_SUBCOL_GEN_LW.html' TARGET='index'>2</A>,<A href='../../call_from/GPU_MCICA_SUBCOL_GEN_LW.html' TARGET='index'>4</A><a name='3646'>
<a name='3647'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='3648'></font>
<font color=#447700>! |                                                                          |<a name='3649'></font>
<font color=#447700>! |  Copyright 2006-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='3650'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='3651'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='3652'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='3653'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='3654'></font>
<font color=#447700>! |                                                                          |<a name='3655'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='3656'></font>
<a name='3657'>
<font color=#447700>! Purpose: Create McICA stochastic arrays for cloud physical or optical properties.<a name='3658'></font>
<font color=#447700>! Two options are possible:<a name='3659'></font>
<font color=#447700>! 1) Input cloud physical properties: cloud fraction, ice and liquid water<a name='3660'></font>
<font color=#447700>!    paths, ice fraction, and particle sizes.  Output will be stochastic<a name='3661'></font>
<font color=#447700>!    arrays of these variables.  (inflag = 1)<a name='3662'></font>
<font color=#447700>! 2) Input cloud optical properties directly: cloud optical depth, single<a name='3663'></font>
<font color=#447700>!    scattering albedo and asymmetry parameter.  Output will be stochastic<a name='3664'></font>
<font color=#447700>!    arrays of these variables.  (inflag = 0; longwave scattering is not<a name='3665'></font>
<font color=#447700>!    yet available, ssac and asmc are for future expansion)<a name='3666'></font>
<a name='3667'>
<font color=#447700>! --------- Modules ----------<a name='3668'></font>
<a name='3669'>
       <font color=#447700>!use parkind, only : im =&gt; kind , rb =&gt; kind <a name='3670'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_2">, only : nbndlw, ngptlw, mxlay<a name='3671'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_1">, only: grav<a name='3672'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_1">, only: ngb<a name='3673'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_1"><a name='3674'>
<a name='3675'>
#ifdef _ACCEL<a name='3676'>
      use cudafor<a name='3677'>
      use cudadevice<a name='3678'>
#endif<a name='3679'>
<a name='3680'>
      implicit none<a name='3681'>
<a name='3682'>
#ifdef _ACCEL<a name='3683'>
      real  _gpudev, allocatable :: pmidd(:, :)<a name='3684'>
      real  _gpudev, allocatable :: cldfracd(:,:), clwpd(:,:), ciwpd(:,:), cswpd(:,:), taucd(:,:,:)<a name='3685'>
<a name='3686'>
<font color=#447700>!$OMP THREADPRIVATE(pmidd,cldfracd,clwpd,ciwpd,cswpd,taucd)<a name='3687'></font>
#endif<a name='3688'>
<a name='3689'>
<font color=#447700>! public interfaces/functions/subroutines<a name='3690'></font>
      <font color=#447700>!public :: mcica_subcol_lwg, generate_stochastic_cloudsg <a name='3691'></font>
<a name='3692'>
      contains<a name='3693'>
<a name='3694'>
<font color=#447700>!------------------------------------------------------------------<a name='3695'></font>
<font color=#447700>! Public subroutines<a name='3696'></font>
<font color=#447700>!------------------------------------------------------------------<a name='3697'></font>
<a name='3698'>
<A NAME='MCICA_SUBCOL_LWG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_SUBCOL_LWG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3699'>
      <font color=#993300>subroutine </font><font color=#cc0000>mcica_subcol_lwg</font>(colstart, ncol, nlay, icld, permuteseed, irng,       &amp; <A href='../../call_to/MCICA_SUBCOL_LWG.html' TARGET='index'>1</A><a name='3700'>
#ifndef _ACCEL<a name='3701'>
                       pmidd,clwpd,ciwpd,cswpd,taucd, &amp;<a name='3702'>
#endif<a name='3703'>
                       play, cldfrac, ciwp, clwp, cswp, tauc, ngbd, cldfmcl, &amp;<a name='3704'>
                       ciwpmcl, clwpmcl, cswpmcl, taucmcl)<a name='3705'>
<a name='3706'>
<font color=#447700>! ----- Input -----<a name='3707'></font>
<font color=#447700>! Control<a name='3708'></font>
      integer , intent(in) :: colstart        <font color=#447700>! column/longitude index<a name='3709'></font>
      integer , intent(in) :: ncol            <font color=#447700>! number of columns<a name='3710'></font>
      integer , intent(in) :: nlay            <font color=#447700>! number of model layers<a name='3711'></font>
      integer , intent(in) :: icld            <font color=#447700>! clear/cloud, cloud overlap flag<a name='3712'></font>
      integer , intent(in) :: permuteseed     <font color=#447700>! if the cloud generator is called multiple times, <a name='3713'></font>
                                                      <font color=#447700>! permute the seed between each call.<a name='3714'></font>
                                                      <font color=#447700>! between calls for LW and SW, recommended<a name='3715'></font>
                                                      <font color=#447700>! permuteseed differes by 'ngpt'<a name='3716'></font>
      integer , intent(in) :: irng         <font color=#447700>! flag for random number generator<a name='3717'></font>
                                                      <font color=#447700>!  0 = kissvec<a name='3718'></font>
                                                      <font color=#447700>!  1 = Mersenne Twister<a name='3719'></font>
<font color=#447700>!      integer , intent(in) :: cloudMH, cloudHH<a name='3720'></font>
<a name='3721'>
<font color=#447700>! Atmosphere<a name='3722'></font>
      real , intent(in) :: play(:,:)          <font color=#447700>! layer pressures (mb) <a name='3723'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='3724'></font>
<a name='3725'>
<font color=#447700>! Atmosphere/clouds - cldprop<a name='3726'></font>
      real , intent(in) :: cldfrac(:,:)       <font color=#447700>! layer cloud fraction<a name='3727'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='3728'></font>
      real , intent(in) :: tauc(:,:,:)        <font color=#447700>! in-cloud optical depth<a name='3729'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw,nlay)<a name='3730'></font>
      real , intent(in) :: ciwp(:,:)          <font color=#447700>! in-cloud ice water path<a name='3731'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='3732'></font>
      real , intent(in) :: clwp(:,:)          <font color=#447700>! in-cloud liquid water path<a name='3733'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='3734'></font>
      real , intent(in) :: cswp(:,:)          <font color=#447700>! in-cloud snow path<a name='3735'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='3736'></font>
      integer  _gpudev, intent(in) :: ngbd(:)<a name='3737'>
<a name='3738'>
<font color=#447700>! ----- Output -----<a name='3739'></font>
<font color=#447700>! Atmosphere/clouds - cldprmc [mcica]<a name='3740'></font>
      real  _gpudev, intent(out) :: cldfmcl(:,:,:)    <font color=#447700>! cloud fraction [mcica]<a name='3741'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3742'></font>
      real  _gpudev, intent(out) :: ciwpmcl(:,:,:)    <font color=#447700>! in-cloud ice water path [mcica]<a name='3743'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3744'></font>
      real  _gpudev, intent(out) :: clwpmcl(:,:,:)    <font color=#447700>! in-cloud liquid water path [mcica]<a name='3745'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3746'></font>
      real  _gpudev, intent(out) :: cswpmcl(:,:,:)    <font color=#447700>! in-cloud snow water path [mcica]<a name='3747'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3748'></font>
      real  _gpudev, intent(out) :: taucmcl(:,:,:)    <font color=#447700>! in-cloud optical depth [mcica]<a name='3749'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3750'></font>
<a name='3751'>
#ifndef _ACCEL<a name='3752'>
<font color=#447700>! were module data but changed to arguments because not thread-safe<a name='3753'></font>
      real  :: pmidd(:, :)<a name='3754'>
      real  :: clwpd(:,:), ciwpd(:,:), cswpd(:,:), taucd(:,:,:)<a name='3755'>
#endif<a name='3756'>
<a name='3757'>
<font color=#447700>! ----- Local -----<a name='3758'></font>
<a name='3759'>
<font color=#447700>! Stochastic cloud generator variables [mcica]<a name='3760'></font>
      integer , parameter :: nsubclw = ngptlw <font color=#447700>! number of sub-columns (g-point intervals)<a name='3761'></font>
      integer  :: ilev                        <font color=#447700>! loop index<a name='3762'></font>
<a name='3763'>
      real  :: pmid(ncol, nlay)               <font color=#447700>! layer pressures (Pa) <a name='3764'></font>
#ifdef _ACCEL<a name='3765'>
      type(dim3) :: dimGrid, dimBlock<a name='3766'>
#endif<a name='3767'>
      integer, save :: counter = 0<a name='3768'>
      integer :: i,j,k,tk<a name='3769'>
      real :: t1, t2<a name='3770'>
  <a name='3771'>
<font color=#447700>! Return if clear sky; or stop if icld out of range<a name='3772'></font>
      if (icld.eq.0) then <a name='3773'>
        cldfmcl = 0.0<a name='3774'>
        ciwpmcl = 0.0<a name='3775'>
        clwpmcl = 0.0<a name='3776'>
        cswpmcl = 0.0<a name='3777'>
        taucmcl = 0.0<a name='3778'>
<font color=#447700>!        cloudFlag = 0.0<a name='3779'></font>
<a name='3780'>
        return<a name='3781'>
      end if <a name='3782'>
      if (icld.lt.0.or.icld.gt.4) then <a name='3783'>
         stop 'MCICA_SUBCOL: INVALID ICLD'<a name='3784'>
      endif <a name='3785'>
   <a name='3786'>
<font color=#447700>! NOTE: For GCM mode, permuteseed must be offset between LW and SW by at least the number of subcolumns<a name='3787'></font>
<a name='3788'>
<a name='3789'>
<font color=#447700>! Pass particle sizes to new arrays, no subcolumns for these properties yet<a name='3790'></font>
<font color=#447700>! Convert pressures from mb to Pa<a name='3791'></font>
<a name='3792'>
#ifdef  _ACCEL<a name='3793'>
      pmid(1:ncol,:nlay) = play(colstart:colstart+ncol-1,:nlay)*1.e2<a name='3794'>
#else<a name='3795'>
      pmidd(1:ncol,:nlay) = play(colstart:colstart+ncol-1,:nlay)*1.e2<a name='3796'>
#endif<a name='3797'>
<a name='3798'>
#ifdef _ACCEL<a name='3799'>
      allocate( pmidd(ncol, nlay), cldfracd(ncol, mxlay+1))<a name='3800'>
      allocate( clwpd(ncol, mxlay+1), ciwpd(ncol, mxlay+1), cswpd(ncol, mxlay+1))<a name='3801'>
      allocate( taucd(ncol, nbndlw, mxlay))<a name='3802'>
#endif<a name='3803'>
<a name='3804'>
#ifdef _ACCEL<a name='3805'>
      pmidd = pmid<a name='3806'>
    <a name='3807'>
      cldfracd = cldfrac<a name='3808'>
      clwpd = clwp<a name='3809'>
      ciwpd = ciwp<a name='3810'>
      cswpd = cswp<a name='3811'>
      taucd = tauc<a name='3812'>
#endif<a name='3813'>
<a name='3814'>
      end subroutine mcica_subcol_lwg<a name='3815'>
<a name='3816'>
<font color=#447700>!-------------------------------------------------------------------------------------------------<a name='3817'></font>
<A NAME='GENERATE_STOCHASTIC_CLOUDSG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3818'>
       _gpuker <font color=#993300>subroutine </font><font color=#cc0000>generate_stochastic_cloudsg</font>(ncol, nlay, icld, ngbd, &amp;,<A href='../../call_from/GENERATE_STOCHASTIC_CLOUDSG.html' TARGET='index'>5</A><a name='3819'>
#ifndef _ACCEL<a name='3820'>
                                 pmidd,cldfracd,clwpd,ciwpd,cswpd,taucd,changeSeed, &amp;<a name='3821'>
#endif<a name='3822'>
                                 cld_stoch, clwp_stoch, ciwp_stoch, cswp_stoch, &amp;<a name='3823'>
                                 tauc_stoch) <a name='3824'>
<font color=#447700>!-------------------------------------------------------------------------------------------------<a name='3825'></font>
<a name='3826'>
  <font color=#447700>!----------------------------------------------------------------------------------------------------------------<a name='3827'></font>
  <font color=#447700>! ---------------------<a name='3828'></font>
  <font color=#447700>! Contact: Cecile Hannay (hannay@ucar.edu)<a name='3829'></font>
  <font color=#447700>! <a name='3830'></font>
  <font color=#447700>! Original code: Based on Raisanen et al., QJRMS, 2004.<a name='3831'></font>
  <font color=#447700>! <a name='3832'></font>
  <font color=#447700>! Modifications: Generalized for use with RRTMG and added Mersenne Twister as the default<a name='3833'></font>
  <font color=#447700>!   random number generator, which can be changed to the optional kissvec random number generator<a name='3834'></font>
  <font color=#447700>!   with flag 'irng'. Some extra functionality has been commented or removed.  <a name='3835'></font>
  <font color=#447700>!   Michael J. Iacono, AER, Inc., February 2007<a name='3836'></font>
  <font color=#447700>!<a name='3837'></font>
  <font color=#447700>! Given a profile of cloud fraction, cloud water and cloud ice, we produce a set of subcolumns.<a name='3838'></font>
  <font color=#447700>! Each layer within each subcolumn is homogeneous, with cloud fraction equal to zero or one <a name='3839'></font>
  <font color=#447700>! and uniform cloud liquid and cloud ice concentration.<a name='3840'></font>
  <font color=#447700>! The ensemble as a whole reproduces the probability function of cloud liquid and ice within each layer <a name='3841'></font>
  <font color=#447700>! and obeys an overlap assumption in the vertical.   <a name='3842'></font>
  <font color=#447700>! <a name='3843'></font>
  <font color=#447700>! Overlap assumption:<a name='3844'></font>
  <font color=#447700>!  The cloud are consistent with 4 overlap assumptions: random, maximum, maximum-random and exponential. <a name='3845'></font>
  <font color=#447700>!  The default option is maximum-random (option 3)<a name='3846'></font>
  <font color=#447700>!  The options are: 1=random overlap, 2=max/random, 3=maximum overlap, 4=exponential overlap<a name='3847'></font>
  <font color=#447700>!  This is set with the variable "overlap" <a name='3848'></font>
  <font color=#447700>!mji - Exponential overlap option (overlap=4) has been deactivated in this version<a name='3849'></font>
  <font color=#447700>!  The exponential overlap uses also a length scale, Zo. (real,    parameter  :: Zo = 2500. ) <a name='3850'></font>
  <font color=#447700>! <a name='3851'></font>
  <font color=#447700>! Seed:<a name='3852'></font>
  <font color=#447700>!  If the stochastic cloud generator is called several times during the same timestep, <a name='3853'></font>
  <font color=#447700>!  one should change the seed between the call to insure that the subcolumns are different.<a name='3854'></font>
  <font color=#447700>!  This is done by changing the argument 'changeSeed'<a name='3855'></font>
  <font color=#447700>!  For example, if one wants to create a set of columns for the shortwave and another set for the longwave ,<a name='3856'></font>
  <font color=#447700>!  use 'changeSeed = 1' for the first call and'changeSeed = 2' for the second call <a name='3857'></font>
  <font color=#447700>!<a name='3858'></font>
  <font color=#447700>! PDF assumption:<a name='3859'></font>
  <font color=#447700>!  We can use arbitrary complicated PDFS. <a name='3860'></font>
  <font color=#447700>!  In the present version, we produce homogeneuous clouds (the simplest case).  <a name='3861'></font>
  <font color=#447700>!  Future developments include using the PDF scheme of Ben Johnson. <a name='3862'></font>
  <font color=#447700>!<a name='3863'></font>
  <font color=#447700>! History file:<a name='3864'></font>
  <font color=#447700>!  Option to add diagnostics variables in the history file. (using FINCL in the namelist)<a name='3865'></font>
  <font color=#447700>!  nsubcol = number of subcolumns<a name='3866'></font>
  <font color=#447700>!  overlap = overlap type (1-3)<a name='3867'></font>
  <font color=#447700>!  Zo = length scale <a name='3868'></font>
  <font color=#447700>!  CLOUD_S = mean of the subcolumn cloud fraction ('_S" means Stochastic)<a name='3869'></font>
  <font color=#447700>!  CLDLIQ_S = mean of the subcolumn cloud water<a name='3870'></font>
  <font color=#447700>!  CLDICE_S = mean of the subcolumn cloud ice <a name='3871'></font>
  <font color=#447700>!<a name='3872'></font>
  <font color=#447700>! Note:<a name='3873'></font>
  <font color=#447700>!   Here: we force that the cloud condensate to be consistent with the cloud fraction <a name='3874'></font>
  <font color=#447700>!   i.e we only have cloud condensate when the cell is cloudy. <a name='3875'></font>
  <font color=#447700>!   In CAM: The cloud condensate and the cloud fraction are obtained from 2 different equations <a name='3876'></font>
  <font color=#447700>!   and the 2 quantities can be inconsistent (i.e. CAM can produce cloud fraction <a name='3877'></font>
  <font color=#447700>!   without cloud condensate or the opposite).<a name='3878'></font>
  <font color=#447700>!---------------------------------------------------------------------------------------------------------------<a name='3879'></font>
<a name='3880'>
<a name='3881'>
<font color=#447700>! -- Arguments<a name='3882'></font>
<a name='3883'>
      integer , intent(in) :: ncol            <font color=#447700>! number of columns<a name='3884'></font>
      integer , intent(in) :: nlay            <font color=#447700>! number of layers<a name='3885'></font>
      integer , intent(in) :: icld            <font color=#447700>! clear/cloud, cloud overlap flag<a name='3886'></font>
  <a name='3887'>
       integer  _gpudev, intent(in) :: ngbd(:)<a name='3888'>
<a name='3889'>
#ifndef _ACCEL<a name='3890'>
<font color=#447700>! were module data but changed to arguments because not thread-safe<a name='3891'></font>
      real  :: pmidd(:, :)<a name='3892'>
      real  :: cldfracd(:,:), clwpd(:,:), ciwpd(:,:), cswpd(:,:), taucd(:,:,:)<a name='3893'>
      integer, intent(in) :: changeSeed<a name='3894'>
#endif<a name='3895'>
<a name='3896'>
<font color=#447700>!      real , intent(in) :: ssac(:,:,:)       ! in-cloud single scattering albedo<a name='3897'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='3898'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='3899'></font>
<font color=#447700>!      real , intent(in) :: asmc(:,:,:)       ! in-cloud asymmetry parameter<a name='3900'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='3901'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='3902'></font>
<a name='3903'>
      real  _gpudev, intent(out) :: cld_stoch(:,:,:)  <font color=#447700>! subcolumn cloud fraction <a name='3904'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlay)<a name='3905'></font>
      real  _gpudev, intent(out) :: clwp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud liquid water path<a name='3906'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlay)<a name='3907'></font>
      real  _gpudev, intent(out) :: ciwp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud ice water path<a name='3908'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlay)<a name='3909'></font>
      real  _gpudev, intent(out) :: cswp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud snow water path<a name='3910'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlay)<a name='3911'></font>
      real  _gpudev, intent(out) :: tauc_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud optical depth<a name='3912'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlay)<a name='3913'></font>
<font color=#447700>!      real , intent(out) :: ssac_stoch(:,:,:)! subcolumn in-cloud single scattering albedo<a name='3914'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3915'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='3916'></font>
<font color=#447700>!      real , intent(out) :: asmc_stoch(:,:,:)! subcolumn in-cloud asymmetry parameter<a name='3917'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='3918'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='3919'></font>
     <a name='3920'>
      <font color=#447700>!integer, value, intent(in) :: counter<a name='3921'></font>
   <a name='3922'>
       <a name='3923'>
<font color=#447700>! Cloud condensate<a name='3924'></font>
      <a name='3925'>
       real  :: RIND1, RIND2, ZCW, SIGMA_QCW<a name='3926'>
       integer  :: IND1, IND2<a name='3927'>
     <a name='3928'>
       real  :: CDF3(mxlay)      <font color=#447700>! random numbers<a name='3929'></font>
<a name='3930'>
       real  :: cfs<a name='3931'>
       integer, parameter :: nsubcol = 140<a name='3932'>
       <a name='3933'>
<font color=#447700>! Constants (min value for cloud fraction and cloud water and ice)<a name='3934'></font>
     <font color=#447700>! real , parameter :: cldmin = 1.0e-20  ! min cloud fraction<a name='3935'></font>
<font color=#447700>!      real , parameter :: qmin   = 1.0e-10    ! min cloud water and cloud ice (not used)<a name='3936'></font>
<a name='3937'>
<font color=#447700>! Variables related to random number and seed <a name='3938'></font>
#ifdef _ACCEL<a name='3939'>
      real  :: CDF(mxlay), CDF2(mxlay)      <font color=#447700>! random numbers<a name='3940'></font>
      integer  :: seed1, seed2, seed3, seed4 <font color=#447700>! seed to create random number (kissvec)<a name='3941'></font>
      real  :: rand_num      <font color=#447700>! random number (kissvec)<a name='3942'></font>
#else<a name='3943'>
      real  :: CDF(ncol,mxlay), CDF2(mxlay)      <font color=#447700>! random numbers<a name='3944'></font>
      integer,dimension(ncol)  :: seed1, seed2, seed3, seed4 <font color=#447700>! seed to create random number (kissvec)<a name='3945'></font>
      real ,dimension(ncol) :: rand_num      <font color=#447700>! random number (kissvec)<a name='3946'></font>
#endif<a name='3947'>
      integer  :: iseed                       <font color=#447700>! seed to create random number (Mersenne Teister)<a name='3948'></font>
      real  :: rand_num_mt                    <font color=#447700>! random number (Mersenne Twister)<a name='3949'></font>
<a name='3950'>
<font color=#447700>! Flag to identify cloud fraction in subcolumns<a name='3951'></font>
   <font color=#447700>!   logical :: iscloudy(mxlay)   ! flag that says whether a gridbox is cloudy<a name='3952'></font>
<a name='3953'>
<font color=#447700>! Indices<a name='3954'></font>
      integer  :: ilev, isubcol, i, n         <font color=#447700>! indices<a name='3955'></font>
      <a name='3956'>
      integer :: iplon, gp<a name='3957'>
      integer  :: m, k, n1, kiss<a name='3958'>
<a name='3959'>
      m(k, n1) = ieor (k, ishft (k, n1) )<a name='3960'>
#ifdef _ACCEL<a name='3961'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='3962'>
      gp = (blockidx%y-1) * blockdim%y + threadidx%y<a name='3963'>
<a name='3964'>
<font color=#447700>!------------------------------------------------------------------------------------------ <a name='3965'></font>
     <font color=#447700>!   print *, "ppp ", iplon, gp<a name='3966'></font>
      if (iplon &lt;= ncol .and. gp &lt;= nsubcol) then<a name='3967'>
# define ILOOP_S_CPU<a name='3968'>
# define ILOOP_E_CPU<a name='3969'>
#else<a name='3970'>
# define ILOOP_S_CPU do iplon = 1, ncol<a name='3971'>
# define ILOOP_E_CPU enddo<a name='3972'>
#endif<a name='3973'>
<a name='3974'>
<a name='3975'>
<font color=#447700>! ----- Create seed  --------<a name='3976'></font>
   <a name='3977'>
<font color=#447700>! Advance randum number generator by changeseed values<a name='3978'></font>
   <a name='3979'>
<font color=#447700>! For kissvec, create a seed that depends on the state of the columns. Maybe not the best way, but it works.  <a name='3980'></font>
<font color=#447700>! Must use pmid from bottom four layers. <a name='3981'></font>
#ifdef _ACCEL<a name='3982'>
           seed1 = (pmidd(iplon,1) - int(pmidd(iplon,1)))  * 1000000000 + (gp) * 11 <a name='3983'>
           seed3 = (pmidd(iplon,3) - int(pmidd(iplon,3)))  * 1000000000 + (gp) * 13 <a name='3984'>
           seed2 = seed1 + gp<a name='3985'>
           seed4 = seed3 - gp <a name='3986'>
#else<a name='3987'>
<font color=#447700>! Have it agree with the original _lw.F version, jm 20141222<a name='3988'></font>
    do iplon = 1, ncol<a name='3989'>
       seed1(iplon) = (pmidd(iplon,1) - int(pmidd(iplon,1)))  * 1000000000<a name='3990'>
       seed2(iplon) = (pmidd(iplon,2) - int(pmidd(iplon,2)))  * 1000000000<a name='3991'>
       seed3(iplon) = (pmidd(iplon,3) - int(pmidd(iplon,3)))  * 1000000000<a name='3992'>
       seed4(iplon) = (pmidd(iplon,4) - int(pmidd(iplon,4)))  * 1000000000<a name='3993'>
       do i=1,changeSeed<a name='3994'>
<font color=#447700>!          call kissvec(seed1(iplon), seed2(iplon), seed3(iplon), seed4(iplon), rand_num(iplon))<a name='3995'></font>
<a name='3996'>
          seed1(iplon) = 69069 * seed1(iplon) + 1327217885<a name='3997'>
          seed2(iplon) = m (m (m (seed2(iplon), 13), - 17), 5)<a name='3998'>
          seed3(iplon) = 18000 * iand (seed3(iplon), 65535) + ishft (seed3(iplon), - 16)<a name='3999'>
          seed4(iplon) = 30903 * iand (seed4(iplon), 65535) + ishft (seed4(iplon), - 16)<a name='4000'>
          kiss = seed1(iplon) + seed2(iplon) + ishft (seed3(iplon), 16) + seed4(iplon)<a name='4001'>
          rand_num(iplon) = kiss*2.328306e-10  + 0.5<a name='4002'>
<a name='4003'>
       enddo<a name='4004'>
    enddo<a name='4005'>
<a name='4006'>
     do gp = 1, nsubcol<a name='4007'>
<a name='4008'>
#endif<a name='4009'>
  <a name='4010'>
<a name='4011'>
<font color=#447700>! ------ Apply overlap assumption --------<a name='4012'></font>
<a name='4013'>
<font color=#447700>! generate the random numbers  <a name='4014'></font>
<a name='4015'>
       select case (icld)<a name='4016'>
<a name='4017'>
#ifdef _ACCEL<a name='4018'>
<font color=#447700>! Random overlap<a name='4019'></font>
       case(1) <a name='4020'>
<a name='4021'>
# if 0<a name='4022'>
           do ilev = 1,nlay<a name='4023'>
             call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_5">(seed1, seed2, seed3, seed4, rand_num)<a name='4024'>
             CDF(iplon,ilev) = rand_num<a name='4025'>
           end do<a name='4026'>
# endif<a name='4027'>
        <a name='4028'>
<a name='4029'>
<font color=#447700>! Maximum-Random overlap<a name='4030'></font>
       case(2)<a name='4031'>
<a name='4032'>
           do ilev = 1,nlay<a name='4033'>
             call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_6">(seed1, seed2, seed3, seed4, rand_num)<a name='4034'>
             CDF(ilev) = rand_num<a name='4035'>
           end do<a name='4036'>
          <a name='4037'>
<a name='4038'>
           do ilev = 2,nlay<a name='4039'>
             if (CDF(ilev-1) &gt; 1.  - cldfracd(iplon, ilev-1)) then <a name='4040'>
                CDF(ilev) = CDF(ilev-1)<a name='4041'>
             else<a name='4042'>
                 CDF(ilev) = CDF(ilev) * (1. - cldfracd(iplon, ilev-1))<a name='4043'>
             end if<a name='4044'>
           end do<a name='4045'>
            <a name='4046'>
<font color=#447700>! Maximum overlap<a name='4047'></font>
       case(3)<a name='4048'>
<a name='4049'>
           call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_7">(seed1, seed2, seed3, seed4, rand_num)<a name='4050'>
           do ilev = 1,nlay<a name='4051'>
            CDF(ilev) = rand_num<a name='4052'>
           end do<a name='4053'>
<a name='4054'>
<a name='4055'>
       end select <a name='4056'>
#else<a name='4057'>
<font color=#447700>! Random overlap<a name='4058'></font>
       case(1)<a name='4059'>
<a name='4060'>
# if 0<a name='4061'>
           do ilev = 1,nlay<a name='4062'>
             call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_8">(seed1, seed2, seed3, seed4, rand_num)<a name='4063'>
             CDF(iplon,ilev) = rand_num<a name='4064'>
           end do<a name='4065'>
# else<a name='4066'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GENERATE_STOCHASTIC_CLOUDSG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1050">("icld == 1 not supported: module_ra_rrtmg_lwf.F")<a name='4067'>
#endif<a name='4068'>
<a name='4069'>
<font color=#447700>! Maximum-Random overlap<a name='4070'></font>
       case(2)<a name='4071'>
   <a name='4072'>
           do ilev = 1,nlay<a name='4073'>
            ILOOP_S_CPU<a name='4074'>
<font color=#447700>!             call kissvec(seed1(iplon), seed2(iplon), seed3(iplon), seed4(iplon), rand_num(iplon))<a name='4075'></font>
             seed1(iplon) = 69069 * seed1(iplon) + 1327217885<a name='4076'>
             seed2(iplon) = m (m (m (seed2(iplon), 13), - 17), 5)<a name='4077'>
             seed3(iplon) = 18000 * iand (seed3(iplon), 65535) + ishft (seed3(iplon), - 16)<a name='4078'>
             seed4(iplon) = 30903 * iand (seed4(iplon), 65535) + ishft (seed4(iplon), - 16)<a name='4079'>
             kiss = seed1(iplon) + seed2(iplon) + ishft (seed3(iplon), 16) + seed4(iplon)<a name='4080'>
             CDF(iplon,ilev) = kiss*2.328306e-10  + 0.5<a name='4081'>
            ILOOP_E_CPU<a name='4082'>
           end do<a name='4083'>
      <a name='4084'>
         <a name='4085'>
           do ilev = 2,nlay<a name='4086'>
            ILOOP_S_CPU<a name='4087'>
             if (CDF(iplon,ilev-1) &gt; 1.  - cldfracd(iplon, ilev-1)) then <a name='4088'>
                CDF(iplon,ilev) = CDF(iplon,ilev-1)<a name='4089'>
             else<a name='4090'>
                 CDF(iplon,ilev) = CDF(iplon,ilev) * (1. - cldfracd(iplon, ilev-1))<a name='4091'>
             end if<a name='4092'>
            ILOOP_E_CPU<a name='4093'>
           end do<a name='4094'>
            <a name='4095'>
<font color=#447700>! Maximum overlap<a name='4096'></font>
       case(3)<a name='4097'>
<a name='4098'>
            ILOOP_S_CPU<a name='4099'>
<font color=#447700>!           call kissvec(seed1(iplon), seed2(iplon), seed3(iplon), seed4(iplon), rand_num(iplon))<a name='4100'></font>
          seed1(iplon) = 69069 * seed1(iplon) + 1327217885<a name='4101'>
          seed2(iplon) = m (m (m (seed2(iplon), 13), - 17), 5)<a name='4102'>
          seed3(iplon) = 18000 * iand (seed3(iplon), 65535) + ishft (seed3(iplon), - 16)<a name='4103'>
          seed4(iplon) = 30903 * iand (seed4(iplon), 65535) + ishft (seed4(iplon), - 16)<a name='4104'>
          kiss = seed1(iplon) + seed2(iplon) + ishft (seed3(iplon), 16) + seed4(iplon)<a name='4105'>
          rand_num(iplon) = kiss*2.328306e-10  + 0.5<a name='4106'>
            ILOOP_E_CPU<a name='4107'>
           do ilev = 1,nlay<a name='4108'>
            ILOOP_S_CPU<a name='4109'>
             CDF(iplon,ilev) = rand_num(iplon)<a name='4110'>
            ILOOP_E_CPU<a name='4111'>
           end do<a name='4112'>
<a name='4113'>
       end select <a name='4114'>
#endif<a name='4115'>
<a name='4116'>
      n = ngbd(gp)<a name='4117'>
<a name='4118'>
      do ilev = 1,nlay<a name='4119'>
       ILOOP_S_CPU<a name='4120'>
        cfs = cldfracd(iplon, ilev)<a name='4121'>
         <font color=#447700>!  do gp = 1, nsubcol<a name='4122'></font>
#ifdef _ACCEL<a name='4123'>
               if (CDF(ilev) &gt;=1.  - cfs) then<a name='4124'>
#else<a name='4125'>
               if (CDF(iplon,ilev) &gt;=1.  - cfs) then<a name='4126'>
#endif<a name='4127'>
<a name='4128'>
                  cld_stoch(iplon,gp,ilev) = 1. <a name='4129'>
                  clwp_stoch(iplon,gp,ilev) = clwpd(iplon,ilev)<a name='4130'>
                  ciwp_stoch(iplon,gp,ilev) = ciwpd(iplon,ilev)<a name='4131'>
                  cswp_stoch(iplon,gp,ilev) = cswpd(iplon,ilev)<a name='4132'>
                <a name='4133'>
                  tauc_stoch(iplon,gp,ilev) = taucd(iplon,n,ilev)<a name='4134'>
                  <a name='4135'>
               else<a name='4136'>
                  cld_stoch(iplon,gp,ilev) = 0. <a name='4137'>
                  clwp_stoch(iplon,gp,ilev) = 0. <a name='4138'>
                  ciwp_stoch(iplon,gp,ilev) = 0. <a name='4139'>
                  cswp_stoch(iplon,gp,ilev) = 0. <a name='4140'>
                  tauc_stoch(iplon,gp,ilev) = 0. <a name='4141'>
<font color=#447700>!                  ssac_stoch(isubcol,i,ilev) = 1. <a name='4142'></font>
<font color=#447700>!                  asmc_stoch(isubcol,i,ilev) = 1. <a name='4143'></font>
               endif<a name='4144'>
           <a name='4145'>
       ILOOP_E_CPU<a name='4146'>
      enddo<a name='4147'>
<a name='4148'>
#ifdef _ACCEL<a name='4149'>
      endif<a name='4150'>
#else<a name='4151'>
      end do<a name='4152'>
#endif<a name='4153'>
<a name='4154'>
      end subroutine generate_stochastic_cloudsg<a name='4155'>
<a name='4156'>
<A NAME='KISSVEC'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#KISSVEC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4157'>
      _gpuked  <font color=#993300>subroutine </font><font color=#cc0000>kissvec</font>(seed1,seed2,seed3,seed4,ran_arr) <A href='../../call_to/KISSVEC.html' TARGET='index'>12</A><a name='4158'>
<font color=#447700>!-------------------------------------------------------------------------------------------------- <a name='4159'></font>
<a name='4160'>
<font color=#447700>! public domain code<a name='4161'></font>
<font color=#447700>! made available from http://www.fortran.com/<a name='4162'></font>
<font color=#447700>! downloaded by pjr on 03/16/04 for NCAR CAM<a name='4163'></font>
<font color=#447700>! converted to vector form, functions inlined by pjr,mvr on 05/10/2004<a name='4164'></font>
<a name='4165'>
<font color=#447700>! The  KISS (Keep It Simple Stupid) random number generator. Combines:<a name='4166'></font>
<font color=#447700>! (1) The congruential generator x(n)=69069*x(n-1)+1327217885, period 2^32.<a name='4167'></font>
<font color=#447700>! (2) A 3-shift shift-register generator, period 2^32-1,<a name='4168'></font>
<font color=#447700>! (3) Two 16-bit multiply-with-carry generators, period 597273182964842497&gt;2^59<a name='4169'></font>
<font color=#447700>!  Overall period&gt;2^123; <a name='4170'></font>
<font color=#447700>!<a name='4171'></font>
      real , intent(inout)  :: ran_arr<a name='4172'>
      integer , intent(inout) :: seed1,seed2,seed3,seed4<a name='4173'>
      integer  :: i,sz,kiss<a name='4174'>
      integer  :: m, k, n<a name='4175'>
<a name='4176'>
<font color=#447700>! inline function <a name='4177'></font>
      m(k, n) = ieor (k, ishft (k, n) )<a name='4178'>
<a name='4179'>
      seed1 = 69069 * seed1 + 1327217885<a name='4180'>
      seed2 = m (m (m (seed2, 13), - 17), 5)<a name='4181'>
      seed3 = 18000 * iand (seed3, 65535) + ishft (seed3, - 16)<a name='4182'>
      seed4 = 30903 * iand (seed4, 65535) + ishft (seed4, - 16)<a name='4183'>
      kiss = seed1 + seed2 + ishft (seed3, 16) + seed4<a name='4184'>
      ran_arr = kiss*2.328306e-10  + 0.5 <a name='4185'>
    <a name='4186'>
      end subroutine kissvec<a name='4187'>
<a name='4188'>
      end module gpu_mcica_subcol_gen_lw<a name='4189'>
<a name='4190'>
<font color=#447700>! (dmb 2012) This is the GPU version of the cldprmc routine.  I have parallelized across <a name='4191'></font>
<font color=#447700>! all 3 dimensions (columns, g-points, and layers) to make this routine run very fast on the GPU.  <a name='4192'></font>
<font color=#447700>! The greatest speedup was obtained by switching the indices for the cloud variables so that <a name='4193'></font>
<font color=#447700>! the columns were the least significant (leftmost) dimension<a name='4194'></font>
<a name='4195'>
<A NAME='GPU_RRTMG_LW_CLDPRMC'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_CLDPRMC' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4196'>
      <font color=#993300>module </font><font color=#cc0000>gpu_rrtmg_lw_cldprmc</font> <A href='../../call_to/GPU_RRTMG_LW_CLDPRMC.html' TARGET='index'>1</A>,<A href='../../call_from/GPU_RRTMG_LW_CLDPRMC.html' TARGET='index'>3</A><a name='4197'>
<a name='4198'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4199'></font>
<font color=#447700>! |                                                                          |<a name='4200'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='4201'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='4202'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='4203'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='4204'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='4205'></font>
<font color=#447700>! |                                                                          |<a name='4206'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4207'></font>
<a name='4208'>
<font color=#447700>! --------- Modules ----------<a name='4209'></font>
<a name='4210'>
<font color=#447700>!      use parkind, only : im =&gt; kind , rb =&gt; kind <a name='4211'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_3">, only : ngptlw, nbndlw<a name='4212'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CLD_F'>rrlw_cld_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CLD_F_1">, only: abscld1, absliq0, absliq1, &amp;<a name='4213'>
                          absice0, absice1, absice2, absice3<a name='4214'>
<font color=#447700>!      use rrlw_wvn_f, only: ngb<a name='4215'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_2">, only: hvrclc, hnamclc<a name='4216'>
<a name='4217'>
#ifdef _ACCEL<a name='4218'>
          use cudafor<a name='4219'>
#endif<a name='4220'>
      implicit none<a name='4221'>
<a name='4222'>
#ifdef _ACCEL<a name='4223'>
<font color=#447700>! (dmb 2012) I moved most GPU variables so that they are module level variables.<a name='4224'></font>
<font color=#447700>! PGI Fortran seems to sometimes have trouble passing arrays into kernels correctly.<a name='4225'></font>
<font color=#447700>! Using module level variables bypasses this issue and allows for cleaner code.<a name='4226'></font>
<font color=#447700>! (jm 2014) but not thread safe.<a name='4227'></font>
      integer  _gpudev, allocatable :: inflagd(:), iceflagd(:), liqflagd(:)<a name='4228'>
<a name='4229'>
      real  _gpudev, allocatable :: ciwpmcd(:,:,:)    <font color=#447700>! in-cloud ice water path [mcica]<a name='4230'></font>
      real  _gpudev, allocatable :: clwpmcd(:,:,:)    <font color=#447700>! in-cloud liquid water path [mcica]<a name='4231'></font>
      real  _gpudev, allocatable :: cswpmcd(:,:,:)    <font color=#447700>! in-cloud snow water path [mcica]<a name='4232'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlayers)<a name='4233'></font>
      real  _gpudev, allocatable :: relqmcd(:,:)      <font color=#447700>! liquid particle effective radius (microns)<a name='4234'></font>
      real  _gpudev, allocatable :: reicmcd(:,:)      <font color=#447700>! ice particle effective size (microns)<a name='4235'></font>
      real  _gpudev, allocatable :: resnmcd(:,:)      <font color=#447700>! snow particle effective size (microns)<a name='4236'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='4237'></font>
                                                      <font color=#447700>! specific definition of reicmc depends on setting of iceflag:<a name='4238'></font>
                                                      <font color=#447700>! iceflag = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='4239'></font>
                                                      <font color=#447700>!              r_ec must be &gt;= 10.0 microns<a name='4240'></font>
                                                      <font color=#447700>! iceflag = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='4241'></font>
                                                      <font color=#447700>!              r_ec range is limited to 13.0 to 130.0 microns<a name='4242'></font>
                                                      <font color=#447700>! iceflag = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='4243'></font>
                                                      <font color=#447700>!              r_k range is limited to 5.0 to 131.0 microns<a name='4244'></font>
                                                      <font color=#447700>! iceflag = 3: generalized effective size, dge, (Fu, 1996),<a name='4245'></font>
                                                      <font color=#447700>!              dge range is limited to 5.0 to 140.0 microns<a name='4246'></font>
                                                      <font color=#447700>!              [dge = 1.0315 * r_ec]<a name='4247'></font>
 <a name='4248'>
      real  _gpucon, dimension(2) :: absice0d<a name='4249'>
      real  _gpucon, dimension(2,5) :: absice1d<a name='4250'>
      real  _gpucon, dimension(43,16) :: absice2d<a name='4251'>
      real  _gpucon, dimension(46,16) :: absice3d<a name='4252'>
      real  _gpucon, dimension(58,16) :: absliq1d<a name='4253'>
<a name='4254'>
<a name='4255'>
<font color=#447700>! (jm 2014) My reading of threadprivate documentation says this should work,<a name='4256'></font>
<font color=#447700>!      see http://publib.boulder.ibm.com/infocenter/comphelp/v101v121<a name='4257'></font>
<font color=#447700>! but keep an eye on it. Different vendors have extended this in different ways.<a name='4258'></font>
<font color=#447700>! See also the intel -qopenmp-threadprivate=legacy/compat documentation.<a name='4259'></font>
<font color=#447700>!$OMP THREADPRIVATE(inflagd,iceflagd,liqflagd,ciwpmcd,clwpmcd,cswpmcd,relqmcd,reicmcd,resnmcd, &amp;<a name='4260'></font>
<font color=#447700>!$OMP               absice0d,absice1d,absice2d,absice3d,absliq1d)<a name='4261'></font>
#endif<a name='4262'>
<a name='4263'>
      contains<a name='4264'>
<a name='4265'>
<font color=#447700>! ------------------------------------------------------------------------------<a name='4266'></font>
<A NAME='CLDPRMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CLDPRMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4267'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>cldprmcg</font>(ncol, nlayers,                                           &amp;,<A href='../../call_from/CLDPRMCG.html' TARGET='index'>1</A><a name='4268'>
#ifndef _ACCEL<a name='4269'>
                inflagd,iceflagd,liqflagd,ciwpmcd,clwpmcd,cswpmcd,relqmcd,reicmcd,resnmcd, &amp;<a name='4270'>
                absice0d,absice1d,absice2d,absice3d,absliq1d,                              &amp;<a name='4271'>
#endif<a name='4272'>
                                  cldfmc, taucmc, ngb, icb, ncbands, icldlyr)<a name='4273'>
<font color=#447700>! ------------------------------------------------------------------------------<a name='4274'></font>
<a name='4275'>
<font color=#447700>! Purpose:  Compute the cloud optical depth(s) for each cloudy layer.<a name='4276'></font>
<a name='4277'>
<font color=#447700>! ------- Input -------<a name='4278'></font>
<a name='4279'>
      integer, value, intent(in) :: ncol              <font color=#447700>! total number of columns<a name='4280'></font>
      integer, value, intent(in) :: nlayers           <font color=#447700>! total number of layers<a name='4281'></font>
<a name='4282'>
#ifndef _ACCEL<a name='4283'>
# define ncol CHNK<a name='4284'>
#endif<a name='4285'>
      <a name='4286'>
      real , intent(in) :: cldfmc(ncol, ngptlw, nlayers+1)        <font color=#447700>! cloud fraction [mcica]<a name='4287'></font>
<a name='4288'>
      integer , intent(out) :: icldlyr( ncol, nlayers+1)<a name='4289'>
      integer , dimension(140), intent(in)  :: ngb<a name='4290'>
      integer , intent(in) :: icb(16)<a name='4291'>
      real , intent(inout) :: taucmc(:,:,:)           <font color=#447700>! cloud optical depth [mcica]<a name='4292'></font>
<a name='4293'>
      real , parameter :: absliq0 = 0.0903614 <a name='4294'>
<a name='4295'>
<font color=#447700>! ------- Output -------<a name='4296'></font>
<a name='4297'>
      integer , intent(out) :: ncbands(:)     <font color=#447700>! number of cloud spectral bands<a name='4298'></font>
<a name='4299'>
#ifndef _ACCEL<a name='4300'>
<font color=#447700>!changed to arguments for thread safety on CPU<a name='4301'></font>
      integer  :: inflagd(:), iceflagd(:), liqflagd(:)<a name='4302'>
<a name='4303'>
      real  :: ciwpmcd(:,:,:)    <font color=#447700>! in-cloud ice water path [mcica]<a name='4304'></font>
      real  :: clwpmcd(:,:,:)    <font color=#447700>! in-cloud liquid water path [mcica]<a name='4305'></font>
      real  :: cswpmcd(:,:,:)    <font color=#447700>! in-cloud snow water path [mcica]<a name='4306'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,ngptlw,nlayers)<a name='4307'></font>
      real  :: relqmcd(:,:)      <font color=#447700>! liquid particle effective radius (microns)<a name='4308'></font>
      real  :: reicmcd(:,:)      <font color=#447700>! ice particle effective size (microns)<a name='4309'></font>
      real  :: resnmcd(:,:)      <font color=#447700>! snow particle effective size (microns)<a name='4310'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='4311'></font>
                                                      <font color=#447700>! specific definition of reicmc depends on setting of iceflag:<a name='4312'></font>
                                                      <font color=#447700>! iceflag = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='4313'></font>
                                                      <font color=#447700>!              r_ec must be &gt;= 10.0 microns<a name='4314'></font>
                                                      <font color=#447700>! iceflag = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='4315'></font>
                                                      <font color=#447700>!              r_ec range is limited to 13.0 to 130.0 microns<a name='4316'></font>
                                                      <font color=#447700>! iceflag = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='4317'></font>
                                                      <font color=#447700>!              r_k range is limited to 5.0 to 131.0 microns<a name='4318'></font>
                                                      <font color=#447700>! iceflag = 3: generalized effective size, dge, (Fu, 1996),<a name='4319'></font>
                                                      <font color=#447700>!              dge range is limited to 5.0 to 140.0 microns<a name='4320'></font>
                                                      <font color=#447700>!              [dge = 1.0315 * r_ec]<a name='4321'></font>
 <a name='4322'>
      real, dimension(2) :: absice0d<a name='4323'>
      real, dimension(2,5) :: absice1d<a name='4324'>
      real, dimension(43,16) :: absice2d<a name='4325'>
      real, dimension(46,16) :: absice3d<a name='4326'>
      real, dimension(58,16) :: absliq1d<a name='4327'>
#endif<a name='4328'>
<a name='4329'>
<font color=#447700>! ------- Local -------<a name='4330'></font>
<a name='4331'>
      integer  :: iplon<a name='4332'>
      integer  :: lay                         <font color=#447700>! Layer index<a name='4333'></font>
      integer  :: ib                          <font color=#447700>! spectral band index<a name='4334'></font>
      integer  :: ig                          <font color=#447700>! g-point interval index<a name='4335'></font>
      integer  :: index <a name='4336'>
     <a name='4337'>
<a name='4338'>
      real  :: abscoice                       <font color=#447700>! ice absorption coefficients<a name='4339'></font>
      real  :: abscoliq                       <font color=#447700>! liquid absorption coefficients<a name='4340'></font>
      real  :: abscosno                       <font color=#447700>! snow absorption coefficients<a name='4341'></font>
      real  :: cwp                            <font color=#447700>! cloud water path<a name='4342'></font>
      real  :: radice                         <font color=#447700>! cloud ice effective size (microns)<a name='4343'></font>
      real  :: radliq                         <font color=#447700>! cloud liquid droplet radius (microns)<a name='4344'></font>
      real  :: radsno                         <font color=#447700>! cloud snow effective radius (microns)<a name='4345'></font>
      real  :: factor                         <font color=#447700>! <a name='4346'></font>
      real  :: fint                           <font color=#447700>! <a name='4347'></font>
      real , parameter :: eps = 1.e-6         <font color=#447700>! epsilon<a name='4348'></font>
      real , parameter :: cldmin = 1.e-20     <font color=#447700>! minimum value for cloud quantities<a name='4349'></font>
<a name='4350'>
      character*256 errmess<a name='4351'>
<font color=#447700>! ------- Definitions -------<a name='4352'></font>
<a name='4353'>
<font color=#447700>!     Explanation of the method for each value of INFLAG.  Values of<a name='4354'></font>
<font color=#447700>!     0 or 1 for INFLAG do not distingish being liquid and ice clouds.<a name='4355'></font>
<font color=#447700>!     INFLAG = 2 does distinguish between liquid and ice clouds, and<a name='4356'></font>
<font color=#447700>!     requires further user input to specify the method to be used to <a name='4357'></font>
<font color=#447700>!     compute the aborption due to each.<a name='4358'></font>
<font color=#447700>!     INFLAG = 0:  For each cloudy layer, the cloud fraction and (gray)<a name='4359'></font>
<font color=#447700>!                  optical depth are input.  <a name='4360'></font>
<font color=#447700>!     INFLAG = 1:  For each cloudy layer, the cloud fraction and cloud<a name='4361'></font>
<font color=#447700>!                  water path (g/m2) are input.  The (gray) cloud optical <a name='4362'></font>
<font color=#447700>!                  depth is computed as in CCM2.<a name='4363'></font>
<font color=#447700>!     INFLAG = 2:  For each cloudy layer, the cloud fraction, cloud <a name='4364'></font>
<font color=#447700>!                  water path (g/m2), and cloud ice fraction are input.<a name='4365'></font>
<font color=#447700>!       ICEFLAG = 0:  The ice effective radius (microns) is input and the<a name='4366'></font>
<font color=#447700>!                     optical depths due to ice clouds are computed as in CCM3.<a name='4367'></font>
<font color=#447700>!       ICEFLAG = 1:  The ice effective radius (microns) is input and the<a name='4368'></font>
<font color=#447700>!                     optical depths due to ice clouds are computed as in <a name='4369'></font>
<font color=#447700>!                     Ebert and Curry, JGR, 97, 3831-3836 (1992).  The <a name='4370'></font>
<font color=#447700>!                     spectral regions in this work have been matched with<a name='4371'></font>
<font color=#447700>!                     the spectral bands in RRTM to as great an extent <a name='4372'></font>
<font color=#447700>!                     as possible:  <a name='4373'></font>
<font color=#447700>!                     E&amp;C 1      IB = 5      RRTM bands 9-16<a name='4374'></font>
<font color=#447700>!                     E&amp;C 2      IB = 4      RRTM bands 6-8<a name='4375'></font>
<font color=#447700>!                     E&amp;C 3      IB = 3      RRTM bands 3-5<a name='4376'></font>
<font color=#447700>!                     E&amp;C 4      IB = 2      RRTM band 2<a name='4377'></font>
<font color=#447700>!                     E&amp;C 5      IB = 1      RRTM band 1<a name='4378'></font>
<font color=#447700>!       ICEFLAG = 2:  The ice effective radius (microns) is input and the<a name='4379'></font>
<font color=#447700>!                     optical properties due to ice clouds are computed from<a name='4380'></font>
<font color=#447700>!                     the optical properties stored in the RT code,<a name='4381'></font>
<font color=#447700>!                     STREAMER v3.0 (Reference: Key. J., Streamer <a name='4382'></font>
<font color=#447700>!                     User's Guide, Cooperative Institute for<a name='4383'></font>
<font color=#447700>!                     Meteorological Satellite Studies, 2001, 96 pp.).<a name='4384'></font>
<font color=#447700>!                     Valid range of values for re are between 5.0 and<a name='4385'></font>
<font color=#447700>!                     131.0 micron.<a name='4386'></font>
<font color=#447700>!       ICEFLAG = 3: The ice generalized effective size (dge) is input<a name='4387'></font>
<font color=#447700>!                    and the optical properties, are calculated as in<a name='4388'></font>
<font color=#447700>!                    Q. Fu, J. Climate, (1998). Q. Fu provided high resolution<a name='4389'></font>
<font color=#447700>!                    tables which were appropriately averaged for the<a name='4390'></font>
<font color=#447700>!                    bands in RRTM_LW.  Linear interpolation is used to<a name='4391'></font>
<font color=#447700>!                    get the coefficients from the stored tables.<a name='4392'></font>
<font color=#447700>!                    Valid range of values for dge are between 5.0 and<a name='4393'></font>
<font color=#447700>!                    140.0 micron.<a name='4394'></font>
<font color=#447700>!       LIQFLAG = 0:  The optical depths due to water clouds are computed as<a name='4395'></font>
<font color=#447700>!                     in CCM3.<a name='4396'></font>
<font color=#447700>!       LIQFLAG = 1:  The water droplet effective radius (microns) is input <a name='4397'></font>
<font color=#447700>!                     and the optical depths due to water clouds are computed <a name='4398'></font>
<font color=#447700>!                     as in Hu and Stamnes, J., Clim., 6, 728-742, (1993).<a name='4399'></font>
<font color=#447700>!                     The values for absorption coefficients appropriate for<a name='4400'></font>
<font color=#447700>!                     the spectral bands in RRTM have been obtained for a <a name='4401'></font>
<font color=#447700>!                     range of effective radii by an averaging procedure <a name='4402'></font>
<font color=#447700>!                     based on the work of J. Pinto (private communication).<a name='4403'></font>
<font color=#447700>!                     Linear interpolation is used to get the absorption <a name='4404'></font>
<font color=#447700>!                     coefficients for the input effective radius.<a name='4405'></font>
<a name='4406'>
<font color=#447700>! (dmb 2012) Here insead of looping over the column, layer, and band dimensions,<a name='4407'></font>
<font color=#447700>! I compute the index for each dimension from the grid and block layout.  This <a name='4408'></font>
<font color=#447700>! function is called once per each thread, and each thread has a unique combination of <a name='4409'></font>
<font color=#447700>! column, layer, and g-point.  <a name='4410'></font>
<a name='4411'>
#ifdef _ACCEL<a name='4412'>
    iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='4413'>
        lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='4414'>
    ig = (blockidx%z-1) * blockdim%z + threadidx%z<a name='4415'>
<font color=#447700>! (dmb 2012) Make sure that the column, layer, and g-points are all within the proper<a name='4416'></font>
<font color=#447700>! range.  They can be out of range if we select certain block configurations due to <a name='4417'></font>
<font color=#447700>! optimizations.<a name='4418'></font>
    if (iplon&lt;=ncol .and. lay&lt;=nlayers .and. ig&lt;=ngptlw) then<a name='4419'>
#else<a name='4420'>
    do iplon = 1, ncol<a name='4421'>
      do lay = 1, nlayers<a name='4422'>
        do ig = 1, ngptlw<a name='4423'>
#endif<a name='4424'>
<a name='4425'>
          ncbands(iplon) = 1<a name='4426'>
<font color=#447700>! (dmb 2012) all of the cloud variables have been modified so that the column dimensions <a name='4427'></font>
<font color=#447700>! is least significant.<a name='4428'></font>
          if (cldfmc(iplon,ig,lay) .eq. 1. ) then<a name='4429'>
            icldlyr(iplon, lay)=1<a name='4430'>
          endif<a name='4431'>
          cwp = ciwpmcd(iplon,ig,lay) + clwpmcd(iplon,ig,lay) + cswpmcd(iplon,ig,lay)<a name='4432'>
<font color=#447700>! (dmb 2012) the stop commands were removed because they aren't supported on the GPU<a name='4433'></font>
          if (cldfmc(iplon,ig,lay) .ge. cldmin .and. &amp;<a name='4434'>
             (cwp .ge. cldmin .or. taucmc(iplon,ig,lay) .ge. cldmin)) then<a name='4435'>
<a name='4436'>
<a name='4437'>
<font color=#447700>!jm top cldprmc inflagd           5<a name='4438'></font>
<font color=#447700>!jm top cldprmc iceflagd           5<a name='4439'></font>
<font color=#447700>!jm top cldprmc liqflagd           1<a name='4440'></font>
<a name='4441'>
<a name='4442'>
<font color=#447700>!jm zap            if(inflagd(iplon) .eq. 2) then<a name='4443'></font>
            if(inflagd(iplon) .ge. 2) then<a name='4444'>
               radice = reicmcd(iplon, lay)<a name='4445'>
<a name='4446'>
<font color=#447700>! Calculation of absorption coefficients due to ice clouds.<a name='4447'></font>
               if (ciwpmcd(iplon,ig,lay)+cswpmcd(iplon,ig,lay) .eq. 0.0) then<a name='4448'>
                  abscoice = 0.0 <a name='4449'>
                  abscosno = 0.0 <a name='4450'>
                                   <a name='4451'>
               elseif (iceflagd(iplon) .eq. 0) then<a name='4452'>
                  abscoice= absice0d(1) + absice0d(2)/radice<a name='4453'>
                  abscosno = 0.0 <a name='4454'>
<a name='4455'>
               elseif (iceflagd(iplon) .eq. 1) then<a name='4456'>
                  ncbands(iplon) = 5<a name='4457'>
                  ib = icb(ngb(ig))<a name='4458'>
                  abscoice = absice1d(1,ib) + absice1d(2,ib)/radice<a name='4459'>
                  abscosno = 0.0 <a name='4460'>
<a name='4461'>
<font color=#447700>! For iceflag=2 option, ice particle effective radius is limited to 5.0 to 131.0 microns<a name='4462'></font>
<a name='4463'>
               elseif (iceflagd(iplon) .eq. 2) then<a name='4464'>
                  ncbands(iplon) = 16<a name='4465'>
                  factor = (radice - 2.)/3. <a name='4466'>
                  index = int(factor)<a name='4467'>
<font color=#447700>! mji - temporary fix to prevent out of range subscripts<a name='4468'></font>
                     if (index .le. 0) index = 1<a name='4469'>
                     if (index .ge. 43) index = 42<a name='4470'>
<font color=#447700>!                  if (index .eq. 43) index = 42<a name='4471'></font>
                  fint = factor - float(index)<a name='4472'>
                  ib = ngb(ig)<a name='4473'>
                  abscoice = &amp;<a name='4474'>
                      absice2d(index,ib) + fint * &amp;<a name='4475'>
                      (absice2d(index+1,ib) - (absice2d(index,ib))) <a name='4476'>
                  abscosno = 0.0 <a name='4477'>
               <a name='4478'>
<font color=#447700>! For iceflag=3 option, ice particle generalized effective size is limited to 5.0 to 140.0 microns<a name='4479'></font>
<a name='4480'>
<font color=#447700>!jm               elseif (iceflagd(iplon) .eq. 3) then<a name='4481'></font>
               elseif (iceflagd(iplon) .ge. 3) then<a name='4482'>
                  ncbands(iplon) = 16<a name='4483'>
                  factor = (radice - 2.)/3. <a name='4484'>
                  index = int(factor)<a name='4485'>
<font color=#447700>! mji - temporary fix to prevent out of range subscripts<a name='4486'></font>
                  if (index .le. 0) index = 1<a name='4487'>
                  if (index .ge. 46) index = 45<a name='4488'>
<font color=#447700>!                  if (index .eq. 46) index = 45<a name='4489'></font>
                  fint = factor - float(index)<a name='4490'>
                  ib = ngb(ig)<a name='4491'>
                  abscoice= &amp;<a name='4492'>
                      absice3d(index,ib) + fint * &amp;<a name='4493'>
                      (absice3d(index+1,ib) - (absice3d(index,ib)))<a name='4494'>
                  abscosno = 0.0 <a name='4495'>
               endif<a name='4496'>
                  <a name='4497'>
<font color=#447700>!..Incorporate additional effects due to snow.<a name='4498'></font>
               if (cswpmcd(iplon,ig,lay).gt.0.0 .and. iceflagd(iplon) .eq. 5) then<a name='4499'>
                  radsno = resnmcd(iplon,lay)<a name='4500'>
<a name='4501'>
#ifndef _ACCEL<a name='4502'>
                  if (radsno .lt. 5.0 .or. radsno .gt. 140.0) then<a name='4503'>
                         write(errmess,'(A,i5,i5,i5,f8.2,f8.2)' )         &amp;<a name='4504'>
               'ERROR: SNOW GENERALIZED EFFECTIVE SIZE OUT OF BOUNDS'   &amp;<a name='4505'>
               ,iplon,ig, lay, cswpmcd(iplon,ig,lay), radsno<a name='4506'>
                         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CLDPRMCG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1051">(errmess)<a name='4507'>
                  end if<a name='4508'>
#endif<a name='4509'>
<a name='4510'>
                  ncbands(iplon) = 16<a name='4511'>
                  factor = (radsno - 2.)/3.<a name='4512'>
                  index = int(factor)<a name='4513'>
<font color=#447700>! mji - temporary fix to prevent out of range subscripts<a name='4514'></font>
                  if (index .le. 0) index = 1<a name='4515'>
                  if (index .ge. 46) index = 45<a name='4516'>
<font color=#447700>!                  if (index .eq. 46) index = 45<a name='4517'></font>
                  fint = factor - float(index)<a name='4518'>
                  ib = ngb(ig)<a name='4519'>
                  abscosno = &amp;<a name='4520'>
                      absice3d(index,ib) + fint * &amp;<a name='4521'>
                      (absice3d(index+1,ib) - (absice3d(index,ib)))<a name='4522'>
               endif<a name='4523'>
<a name='4524'>
<font color=#447700>! Calculation of absorption coefficients due to water clouds.<a name='4525'></font>
<font color=#447700>!jm              if (liqflagd(iplon) .eq. 1) then<a name='4526'></font>
               if (clwpmcd(iplon,ig,lay) .eq. 0.0) then<a name='4527'>
                 abscoliq = 0.0<a name='4528'>
               else if (liqflagd(iplon) .eq. 0) then<a name='4529'>
                 abscoliq = absliq0<a name='4530'>
               else if (liqflagd(iplon) .eq. 1) then<a name='4531'>
                 radliq = relqmcd(iplon, lay)<a name='4532'>
                 index = int(radliq - 1.5 )<a name='4533'>
<font color=#447700>! mji - temporary fix to prevent out of range subscripts<a name='4534'></font>
                     if (index .le. 0) index = 1<a name='4535'>
                     if (index .ge. 58) index = 57<a name='4536'>
<font color=#447700>!                 if (index .eq. 0) index = 1<a name='4537'></font>
<font color=#447700>!                 if (index .eq. 58) index = 57<a name='4538'></font>
                 fint = radliq - 1.5  - float(index)<a name='4539'>
                 ib = ngb(ig)<a name='4540'>
                 abscoliq = &amp;<a name='4541'>
                     absliq1d(index,ib) + fint * &amp;<a name='4542'>
                     (absliq1d(index+1,ib) - (absliq1d(index,ib)))<a name='4543'>
               endif<a name='4544'>
<a name='4545'>
               taucmc(iplon,ig,lay) = ciwpmcd(iplon,ig,lay) * abscoice + &amp;<a name='4546'>
                                      clwpmcd(iplon,ig,lay) * abscoliq + &amp;<a name='4547'>
                                      cswpmcd(iplon,ig,lay) * abscosno<a name='4548'>
<a name='4549'>
<a name='4550'>
            endif<a name='4551'>
          endif<a name='4552'>
<a name='4553'>
#ifdef _ACCEL<a name='4554'>
    endif<a name='4555'>
#else<a name='4556'>
        end do<a name='4557'>
      end do<a name='4558'>
    end do<a name='4559'>
#endif  <a name='4560'>
<a name='4561'>
      end subroutine cldprmcg<a name='4562'>
<a name='4563'>
#ifndef _ACCEL<a name='4564'>
# undef ncol<a name='4565'>
#endif<a name='4566'>
<a name='4567'>
      <a name='4568'>
<font color=#447700>! (dmb 2012) This subroutine allocates the module level arrays on the GPU<a name='4569'></font>
<A NAME='ALLOCATEGPUCLDPRMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUCLDPRMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4570'>
      <font color=#993300>subroutine </font><font color=#cc0000>allocateGPUcldprmcg</font>(ncol, nlay, ngptlw) <A href='../../call_to/ALLOCATEGPUCLDPRMCG.html' TARGET='index'>1</A><a name='4571'>
<a name='4572'>
         integer , intent(in) :: nlay, ngptlw, ncol<a name='4573'>
#ifdef _ACCEL<a name='4574'>
         allocate( inflagd(ncol), iceflagd(ncol), liqflagd(ncol))<a name='4575'>
         allocate( relqmcd(ncol, nlay+1), reicmcd(ncol, nlay+1))<a name='4576'>
         allocate( resnmcd(ncol, nlay+1))<a name='4577'>
      <a name='4578'>
         allocate( ciwpmcd(ncol, ngptlw, nlay+1))<a name='4579'>
         allocate( clwpmcd(ncol, ngptlw, nlay+1))<a name='4580'>
         allocate( cswpmcd(ncol, ngptlw, nlay+1))<a name='4581'>
#endif<a name='4582'>
        <a name='4583'>
      end subroutine<a name='4584'>
<a name='4585'>
      <font color=#447700>! (dmb 2012) This subroutine deallocates any GPU arrays.<a name='4586'></font>
<A NAME='DEALLOCATEGPUCLDPRMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUCLDPRMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4587'>
      <font color=#993300>subroutine </font><font color=#cc0000>deallocateGPUcldprmcg</font>() <A href='../../call_to/DEALLOCATEGPUCLDPRMCG.html' TARGET='index'>1</A><a name='4588'>
<a name='4589'>
#ifdef _ACCEL<a name='4590'>
         deallocate( inflagd, iceflagd, liqflagd)<a name='4591'>
         deallocate( relqmcd, reicmcd, resnmcd)<a name='4592'>
<a name='4593'>
         deallocate( ciwpmcd)<a name='4594'>
         deallocate( clwpmcd)<a name='4595'>
         deallocate( cswpmcd)<a name='4596'>
#endif<a name='4597'>
      <a name='4598'>
      end subroutine<a name='4599'>
<a name='4600'>
      <font color=#447700>! (dmb 2012) This subroutine copies input data from the CPU over to the GPU<a name='4601'></font>
      <font color=#447700>! for use in the cldprmcg subroutine.<a name='4602'></font>
<A NAME='COPYGPUCLDPRMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUCLDPRMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4603'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyGPUcldprmcg</font>(inflag, iceflag, liqflag,&amp; <A href='../../call_to/COPYGPUCLDPRMCG.html' TARGET='index'>1</A><a name='4604'>
                                 absice0, absice1, absice2, absice3, absliq1)<a name='4605'>
                                <a name='4606'>
         integer :: inflag(:), iceflag(:), liqflag(:)<a name='4607'>
        <a name='4608'>
         real , dimension(:) :: absice0<a name='4609'>
         real , dimension(:,:) :: absice1<a name='4610'>
         real , dimension(:,:) :: absice2<a name='4611'>
         real , dimension(:,:) :: absice3<a name='4612'>
         real , dimension(:,:) :: absliq1<a name='4613'>
      <a name='4614'>
#ifdef _ACCEL<a name='4615'>
         inflagd = inflag<a name='4616'>
         iceflagd = iceflag<a name='4617'>
         liqflagd = liqflag<a name='4618'>
<a name='4619'>
         absice0d = absice0<a name='4620'>
         absice1d = absice1<a name='4621'>
         absice2d = absice2<a name='4622'>
         absice3d = absice3<a name='4623'>
         absliq1d = absliq1<a name='4624'>
#endif<a name='4625'>
      <a name='4626'>
      end subroutine <a name='4627'>
<a name='4628'>
      end module gpu_rrtmg_lw_cldprmc<a name='4629'>
<a name='4630'>
<font color=#447700>! (dmb 2012) This is the GPU version of the rtrnmc subroutine.  This has been greatly<a name='4631'></font>
<font color=#447700>! modified to be efficiently run on the GPU.  Originally, there was a g-point loop within<a name='4632'></font>
<font color=#447700>! this subroutine to perform the summation of the fluxes over the g-points.  This has been<a name='4633'></font>
<font color=#447700>! modified so that this subroutine can be run in parallel across the g-points.  This was<a name='4634'></font>
<font color=#447700>! absolutely critical because of two reasons.<a name='4635'></font>
<font color=#447700>! 1. For a relatively low number of profiles, there wouldn't be enough threads to keep<a name='4636'></font>
<font color=#447700>!    the GPU busy enough to run at full potential.  As a result of this, this subroutine<a name='4637'></font>
<font color=#447700>!    would end up being a bottleneck.<a name='4638'></font>
<font color=#447700>! 2. The memory access for the GPU arrays would be innefient because there would be very<a name='4639'></font>
<font color=#447700>!    little coalescing which is critical for obtaining optimal performance.<a name='4640'></font>
<a name='4641'>
<A NAME='GPU_RRTMG_LW_RTRNMC'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4642'>
      <font color=#993300>module </font><font color=#cc0000>gpu_rrtmg_lw_rtrnmc</font> <A href='../../call_to/GPU_RRTMG_LW_RTRNMC.html' TARGET='index'>2</A>,<A href='../../call_from/GPU_RRTMG_LW_RTRNMC.html' TARGET='index'>4</A><a name='4643'>
<a name='4644'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4645'></font>
<font color=#447700>! |                                                                          |<a name='4646'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='4647'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='4648'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='4649'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='4650'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='4651'></font>
<font color=#447700>! |                                                                          |<a name='4652'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4653'></font>
<a name='4654'>
<font color=#447700>! --------- Modules ----------<a name='4655'></font>
<a name='4656'>
<font color=#447700>!      use parkind, only : im =&gt; kind , rb =&gt; kind <a name='4657'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_4">, only : mg, nbndlw, ngptlw, mxlay<a name='4658'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_2">, only: fluxfac, heatfac<a name='4659'>
<font color=#447700>! (jm 2014) not sure why the GPU version defines ntbl 2x instead of using it <a name='4660'></font>
<font color=#447700>! from rrlw_tbl, but will leave it alone for now. However, it is an error when<a name='4661'></font>
<font color=#447700>! compiling for CPU, at least with the Intel compiler.  Says it's defined twice.<a name='4662'></font>
#ifdef _ACCEL<a name='4663'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_TBL_F'>rrlw_tbl_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_F_1">, only: bpade, tblint, tau_tbl, exp_tbl, tfn_tbl<a name='4664'>
#else<a name='4665'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_TBL_F'>rrlw_tbl_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_F_2">, only: bpade, tblint, tau_tbl, exp_tbl, tfn_tbl, ntbl<a name='4666'>
#endif<a name='4667'>
<a name='4668'>
#ifdef _ACCEL<a name='4669'>
      use cudafor<a name='4670'>
#endif      <a name='4671'>
    <a name='4672'>
      implicit none <a name='4673'>
      <a name='4674'>
#ifdef _ACCEL<a name='4675'>
<font color=#447700>! (jm 2014) see comment above)<a name='4676'></font>
      integer(kind=4), parameter :: ntbl = 10000<a name='4677'>
#endif<a name='4678'>
#ifdef _ACCEL<a name='4679'>
      integer  _gpucon :: ngsd(nbndlw)      <a name='4680'>
<a name='4681'>
<font color=#447700>! (dmb 2012) I moved most GPU variables so that they are module level variables.<a name='4682'></font>
<font color=#447700>! PGI Fortran seems to sometimes have trouble passing arrays into kernels correctly.<a name='4683'></font>
<font color=#447700>! Using module level variables bypasses this issue and allows for cleaner code.<a name='4684'></font>
<font color=#447700>! (jm 2014) but not thread safe.<a name='4685'></font>
<a name='4686'>
<font color=#447700>! Atmosphere<a name='4687'></font>
      real , allocatable _gpudev :: taucmcd(:,:,:)<a name='4688'>
   <a name='4689'>
      real , allocatable _gpudev, dimension(:,:) :: pzd            <font color=#447700>! level (interface) pressures (hPa, mb)<a name='4690'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol,0:nlayers)<a name='4691'></font>
      real , allocatable _gpudev, dimension(:) :: pwvcmd           <font color=#447700>! precipitable water vapor (cm)<a name='4692'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol)<a name='4693'></font>
      real , allocatable _gpudev, dimension(:,:) :: semissd        <font color=#447700>! lw surface emissivity<a name='4694'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='4695'></font>
      real , allocatable _gpudev, dimension(:,:,:) :: planklayd    <font color=#447700>! <a name='4696'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol,nlayers,nbndlw)<a name='4697'></font>
      real , allocatable _gpudev, dimension(:,:,:) :: planklevd    <font color=#447700>! <a name='4698'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol,0:nlayers,nbndlw)<a name='4699'></font>
      real, allocatable _gpudev, dimension(:,:) :: plankbndd       <font color=#447700>! <a name='4700'></font>
                                                                   <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='4701'></font>
   <a name='4702'>
      real , allocatable _gpudev :: gurad(:,:,:)          <font color=#447700>! upward longwave flux (w/m2)<a name='4703'></font>
      real , allocatable _gpudev :: gdrad(:,:,:)          <font color=#447700>! downward longwave flux (w/m2)<a name='4704'></font>
      real , allocatable _gpudev :: gclrurad(:,:,:)       <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='4705'></font>
      real , allocatable _gpudev :: gclrdrad(:,:,:)       <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='4706'></font>
<a name='4707'>
      real  _gpudev, allocatable :: gdtotuflux_dtd(:,:,:) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='4708'></font>
                                                          <font color=#447700>! with respect to surface temperature<a name='4709'></font>
<a name='4710'>
      real  _gpudev, allocatable :: gdtotuclfl_dtd(:,:,:) <font color=#447700>! change in clear sky upward longwave flux (w/m2/k)<a name='4711'></font>
                                                          <font color=#447700>! with respect to surface temperature<a name='4712'></font>
  <a name='4713'>
<a name='4714'>
<font color=#447700>! Clouds<a name='4715'></font>
      integer  _gpudev :: idrvd                       <font color=#447700>! flag for calculation of dF/dt from <a name='4716'></font>
                                                      <font color=#447700>! Planck derivative [0=off, 1=on]<a name='4717'></font>
      real  _gpucon :: bpaded<a name='4718'>
      real  _gpucon :: heatfacd<a name='4719'>
      real  _gpucon :: fluxfacd<a name='4720'>
      real  _gpucon :: a0d(nbndlw), a1d(nbndlw), a2d(nbndlw)<a name='4721'>
      integer  _gpucon :: delwaved(nbndlw)<a name='4722'>
      real , allocatable _gpudev :: totufluxd(:,:)     <font color=#447700>! upward longwave flux (w/m2)<a name='4723'></font>
      real , allocatable _gpudev :: totdfluxd(:,:)     <font color=#447700>! downward longwave flux (w/m2)<a name='4724'></font>
      real , allocatable _gpudev :: fnetd(:,:)         <font color=#447700>! net longwave flux (w/m2)<a name='4725'></font>
      real , allocatable _gpudev :: htrd(:,:)          <font color=#447700>! longwave heating rate (k/day)<a name='4726'></font>
      real , allocatable _gpudev :: totuclfld(:,:)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='4727'></font>
      real , allocatable _gpudev :: totdclfld(:,:)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='4728'></font>
      real , allocatable _gpudev :: fnetcd(:,:)        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='4729'></font>
      real , allocatable _gpudev :: htrcd(:,:)         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='4730'></font>
      real , allocatable _gpudev :: dtotuflux_dtd(:,:) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='4731'></font>
                                                       <font color=#447700>! with respect to surface temperature<a name='4732'></font>
      real , allocatable _gpudev :: dtotuclfl_dtd(:,:) <font color=#447700>! change in clear sky upward longwave flux (w/m2/k)<a name='4733'></font>
                                                       <font color=#447700>! with respect to surface temperature<a name='4734'></font>
      real , allocatable _gpudev :: dplankbnd_dtd(:,:) <a name='4735'>
<a name='4736'>
<font color=#447700>! (jm 2014)<a name='4737'></font>
<font color=#447700>!$OMP THREADPRIVATE( taucmcd,pzd,pwvcmd,semissd,planklayd,planklevd,plankbndd,gurad,gdrad,gclrurad,gclrdrad,&amp;<a name='4738'></font>
<font color=#447700>!$OMP                gdtotuflux_dtd,gdtotuclfl_dtd,idrvd,bpaded,heatfacd,fluxfacd,a0d,a1d,a2d, &amp;<a name='4739'></font>
<font color=#447700>!$OMP                delwaved,totufluxd,totdfluxd,fnetd,htrd,totuclfld,totdclfld,fnetcd,htrcd,dtotuflux_dtd, &amp;<a name='4740'></font>
<font color=#447700>!$OMP                dtotuclfl_dtd,dplankbnd_dtd )<a name='4741'></font>
#endif<a name='4742'>
<a name='4743'>
      contains<a name='4744'>
<a name='4745'>
<font color=#447700>!-----------------------------------------------------------------------------<a name='4746'></font>
<A NAME='RTRNMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4747'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>rtrnmcg</font>(ncol, nlayers, istart, iend, iout                               &amp;<a name='4748'>
#include "<A href='../../html_code/include/rrtmg_lw_cpu_args.h.html'>rrtmg_lw_cpu_args.h</A>"<A NAME="rrtmg_lw_cpu_args.h_1"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNMCG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4749'>
                                 ,ngb,icldlyr, taug, fracsd, cldfmcd)<a name='4750'>
<font color=#447700>!-----------------------------------------------------------------------------<a name='4751'></font>
<font color=#447700>!<a name='4752'></font>
<font color=#447700>!  Original version:   E. J. Mlawer, et al. RRTM_V3.0<a name='4753'></font>
<font color=#447700>!  Revision for GCMs:  Michael J. Iacono; October, 2002<a name='4754'></font>
<font color=#447700>!  Revision for F90:  Michael J. Iacono; June, 2006<a name='4755'></font>
<font color=#447700>!  Revision for dFdT option: M. J. Iacono and E. J. Mlawer, November 2009<a name='4756'></font>
<font color=#447700>!<a name='4757'></font>
<font color=#447700>!  This program calculates the upward fluxes, downward fluxes, and<a name='4758'></font>
<font color=#447700>!  heating rates for an arbitrary clear or cloudy atmosphere.  The input<a name='4759'></font>
<font color=#447700>!  to this program is the atmospheric profile, all Planck function<a name='4760'></font>
<font color=#447700>!  information, and the cloud fraction by layer.  A variable diffusivity <a name='4761'></font>
<font color=#447700>!  angle (SECDIFF) is used for the angle integration.  Bands 2-3 and 5-9 <a name='4762'></font>
<font color=#447700>!  use a value for SECDIFF that varies from 1.50 to 1.80 as a function of <a name='4763'></font>
<font color=#447700>!  the column water vapor, and other bands use a value of 1.66.  The Gaussian <a name='4764'></font>
<font color=#447700>!  weight appropriate to this angle (WTDIFF=0.5) is applied here.  Note that <a name='4765'></font>
<font color=#447700>!  use of the emissivity angle for the flux integration can cause errors of <a name='4766'></font>
<font color=#447700>!  1 to 4 W/m2 within cloudy layers.  <a name='4767'></font>
<font color=#447700>!  Clouds are treated with the McICA stochastic approach and maximum-random<a name='4768'></font>
<font color=#447700>!  cloud overlap. <a name='4769'></font>
<font color=#447700>!  This subroutine also provides the optional capability to calculate<a name='4770'></font>
<font color=#447700>!  the derivative of upward flux respect to surface temperature using<a name='4771'></font>
<font color=#447700>!  the pre-tabulated derivative of the Planck function with respect to <a name='4772'></font>
<font color=#447700>!  temperature integrated over each spectral band.<a name='4773'></font>
<font color=#447700>!***************************************************************************<a name='4774'></font>
<a name='4775'>
<font color=#447700>! ------- Declarations -------<a name='4776'></font>
<a name='4777'>
<font color=#447700>! ----- Input -----<a name='4778'></font>
      integer(kind=4), value, intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='4779'></font>
      integer(kind=4), value, intent(in) :: ncol            <font color=#447700>! total number of columns<a name='4780'></font>
      integer(kind=4), value, intent(in) :: istart          <font color=#447700>! beginning band of calculation<a name='4781'></font>
      integer(kind=4), value, intent(in) :: iend            <font color=#447700>! ending band of calculation<a name='4782'></font>
      integer(kind=4), value, intent(in) :: iout            <font color=#447700>! output option flag<a name='4783'></font>
      integer , intent(in) :: ngb(:)                        <font color=#447700>! band index<a name='4784'></font>
     <a name='4785'>
      integer , intent(in) :: icldlyr(:,:)<a name='4786'>
      real  _gpudev :: taug(:,:,:)<a name='4787'>
      real  _gpudev :: fracsd(:,:,:)<a name='4788'>
      real  _gpudev :: cldfmcd(:,:,:)<a name='4789'>
<a name='4790'>
#include "<A href='../../html_code/include/rrtmg_lw_cpu_defs.h.html'>rrtmg_lw_cpu_defs.h</A>"<A NAME="rrtmg_lw_cpu_defs.h_2"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNMCG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4791'>
     <a name='4792'>
   <font color=#447700>! ----- Local -----<a name='4793'></font>
<font color=#447700>! Declarations for radiative transfer<a name='4794'></font>
<a name='4795'>
#ifndef _ACCEL<a name='4796'>
# define IDIM (ncol)<a name='4797'>
# define IDIM1 ncol,<a name='4798'>
#else<a name='4799'>
# define IDIM<a name='4800'>
# define IDIM1<a name='4801'>
#endif<a name='4802'>
   <a name='4803'>
      real  :: atot( IDIM1 mxlay)<a name='4804'>
      real  :: atrans( IDIM1 mxlay)<a name='4805'>
      real  :: bbugas( IDIM1 mxlay)<a name='4806'>
      real  :: bbutot( IDIM1 mxlay)<a name='4807'>
     <a name='4808'>
      real  :: uflux( IDIM1 0:mxlay)<a name='4809'>
      real  :: dflux( IDIM1 0:mxlay)<a name='4810'>
      real  :: uclfl( IDIM1 0:mxlay)<a name='4811'>
      real  :: dclfl( IDIM1 0:mxlay)<a name='4812'>
<a name='4813'>
#ifndef _ACCEL<a name='4814'>
# define atot(X)     ATOT(iplon,X)<a name='4815'>
# define atrans(X) ATRANS(iplon,X)<a name='4816'>
# define bbugas(X) BBUGAS(iplon,X)<a name='4817'>
# define bbutot(X) BBUTOT(iplon,X)<a name='4818'>
# define uflux(X)   UFLUX(iplon,X)<a name='4819'>
# define dflux(X)   DFLUX(iplon,X)<a name='4820'>
# define uclfl(X)   UCLFL(iplon,X)<a name='4821'>
# define dclfl(X)   DCLFL(iplon,X)<a name='4822'>
#endif<a name='4823'>
    <a name='4824'>
      real  :: odclds<a name='4825'>
      real  :: efclfracs<a name='4826'>
      real  :: absclds<a name='4827'>
<a name='4828'>
      real  :: secdiff IDIM                         <font color=#447700>! secant of diffusivity angle<a name='4829'></font>
      real  :: transcld, radld IDIM, radclrd IDIM, plfrac, blay, dplankup, dplankdn<a name='4830'>
      real  :: odepth, odtot, odepth_rec, odtot_rec, gassrc<a name='4831'>
      real  :: tblind, tfactot, bbd, bbdtot, tfacgas, transc, tausfac<a name='4832'>
      real  :: rad0, reflect, radlu IDIM , radclru IDIM<a name='4833'>
      real  :: d_rad0_dt, d_radlu_dt IDIM , d_radclru_dt IDIM<a name='4834'>
   <a name='4835'>
      integer  :: ibnd, ib, lay, lev, l, ig         <font color=#447700>! loop indices<a name='4836'></font>
      integer  :: igc                               <font color=#447700>! g-point interval counter<a name='4837'></font>
      integer  :: iclddn IDIM                       <font color=#447700>! flag for cloud in down path<a name='4838'></font>
      integer  :: ittot, itgas, itr                 <font color=#447700>! lookup table indices<a name='4839'></font>
   <a name='4840'>
<font color=#447700>! ------- Definitions -------<a name='4841'></font>
<font color=#447700>! input<a name='4842'></font>
<font color=#447700>!    nlayers                      ! number of model layers<a name='4843'></font>
<font color=#447700>!    ngptlw                       ! total number of g-point subintervals<a name='4844'></font>
<font color=#447700>!    nbndlw                       ! number of longwave spectral bands<a name='4845'></font>
<font color=#447700>!    ncbands                      ! number of spectral bands for clouds<a name='4846'></font>
<font color=#447700>!    secdiff                      ! diffusivity angle<a name='4847'></font>
<font color=#447700>!    wtdiff                       ! weight for radiance to flux conversion<a name='4848'></font>
<font color=#447700>!    pavel                        ! layer pressures (mb)<a name='4849'></font>
<font color=#447700>!    pz                           ! level (interface) pressures (mb)<a name='4850'></font>
<font color=#447700>!    tavel                        ! layer temperatures (k)<a name='4851'></font>
<font color=#447700>!    tz                           ! level (interface) temperatures(mb)<a name='4852'></font>
<font color=#447700>!    tbound                       ! surface temperature (k)<a name='4853'></font>
<font color=#447700>!    cldfrac                      ! layer cloud fraction<a name='4854'></font>
<font color=#447700>!    taucloud                     ! layer cloud optical depth<a name='4855'></font>
<font color=#447700>!    itr                          ! integer look-up table index<a name='4856'></font>
<font color=#447700>!    icldlyr                      ! flag for cloudy layers<a name='4857'></font>
<font color=#447700>!    iclddn                       ! flag for cloud in column at any layer<a name='4858'></font>
<font color=#447700>!    semiss                       ! surface emissivities for each band<a name='4859'></font>
<font color=#447700>!    reflect                      ! surface reflectance<a name='4860'></font>
<font color=#447700>!    bpade                        ! 1/(pade constant)<a name='4861'></font>
<font color=#447700>!    tau_tbl                      ! clear sky optical depth look-up table<a name='4862'></font>
<font color=#447700>!    exp_tbl                      ! exponential look-up table for transmittance<a name='4863'></font>
<font color=#447700>!    tfn_tbl                      ! tau transition function look-up table<a name='4864'></font>
<a name='4865'>
<font color=#447700>! local<a name='4866'></font>
<font color=#447700>!    atrans                       ! gaseous absorptivity<a name='4867'></font>
<font color=#447700>!    abscld                       ! cloud absorptivity<a name='4868'></font>
<font color=#447700>!    atot                         ! combined gaseous and cloud absorptivity<a name='4869'></font>
<font color=#447700>!    odclr                        ! clear sky (gaseous) optical depth<a name='4870'></font>
<font color=#447700>!    odcld                        ! cloud optical depth<a name='4871'></font>
<font color=#447700>!    odtot                        ! optical depth of gas and cloud<a name='4872'></font>
<font color=#447700>!    tfacgas                      ! gas-only pade factor, used for planck fn<a name='4873'></font>
<font color=#447700>!    tfactot                      ! gas and cloud pade factor, used for planck fn<a name='4874'></font>
<font color=#447700>!    bbdgas                       ! gas-only planck function for downward rt<a name='4875'></font>
<font color=#447700>!    bbugas                       ! gas-only planck function for upward rt<a name='4876'></font>
<font color=#447700>!    bbdtot                       ! gas and cloud planck function for downward rt<a name='4877'></font>
<font color=#447700>!    bbutot                       ! gas and cloud planck function for upward calc.<a name='4878'></font>
<font color=#447700>!    gassrc                       ! source radiance due to gas only<a name='4879'></font>
<font color=#447700>!    efclfrac                     ! effective cloud fraction<a name='4880'></font>
<font color=#447700>!    radlu                        ! spectrally summed upward radiance <a name='4881'></font>
<font color=#447700>!    radclru                      ! spectrally summed clear sky upward radiance <a name='4882'></font>
<font color=#447700>!    urad                         ! upward radiance by layer<a name='4883'></font>
<font color=#447700>!    clrurad                      ! clear sky upward radiance by layer<a name='4884'></font>
<font color=#447700>!    radld                        ! spectrally summed downward radiance <a name='4885'></font>
<font color=#447700>!    radclrd                      ! spectrally summed clear sky downward radiance <a name='4886'></font>
<font color=#447700>!    drad                         ! downward radiance by layer<a name='4887'></font>
<font color=#447700>!    clrdrad                      ! clear sky downward radiance by layer<a name='4888'></font>
<font color=#447700>!    d_radlu_dt                   ! spectrally summed upward radiance <a name='4889'></font>
<font color=#447700>!    d_radclru_dt                 ! spectrally summed clear sky upward radiance <a name='4890'></font>
<font color=#447700>!    d_urad_dt                    ! upward radiance by layer<a name='4891'></font>
<font color=#447700>!    d_clrurad_dt                 ! clear sky upward radiance by layer<a name='4892'></font>
<a name='4893'>
<font color=#447700>! output<a name='4894'></font>
<font color=#447700>!    totuflux                     ! upward longwave flux (w/m2)<a name='4895'></font>
<font color=#447700>!    totdflux                     ! downward longwave flux (w/m2)<a name='4896'></font>
<font color=#447700>!    fnet                         ! net longwave flux (w/m2)<a name='4897'></font>
<font color=#447700>!    htr                          ! longwave heating rate (k/day)<a name='4898'></font>
<font color=#447700>!    totuclfl                     ! clear sky upward longwave flux (w/m2)<a name='4899'></font>
<font color=#447700>!    totdclfl                     ! clear sky downward longwave flux (w/m2)<a name='4900'></font>
<font color=#447700>!    fnetc                        ! clear sky net longwave flux (w/m2)<a name='4901'></font>
<font color=#447700>!    htrc                         ! clear sky longwave heating rate (k/day)<a name='4902'></font>
<font color=#447700>!    dtotuflux_dt                 ! change in upward longwave flux (w/m2/k)<a name='4903'></font>
<font color=#447700>!                                 ! with respect to surface temperature<a name='4904'></font>
<font color=#447700>!    dtotuclfl_dt                 ! change in clear sky upward longwave flux (w/m2/k)<a name='4905'></font>
<font color=#447700>!    <a name='4906'></font>
   <a name='4907'>
  <a name='4908'>
<font color=#447700>! This secant and weight corresponds to the standard diffusivity <a name='4909'></font>
<font color=#447700>! angle.  This initial value is redefined below for some bands.<a name='4910'></font>
      real , parameter :: wtdiff = 0.5      <a name='4911'>
      real , parameter :: rec_6 = 0.166667  <a name='4912'>
<a name='4913'>
<font color=#447700>! Reset diffusivity angle for Bands 2-3 and 5-9 to vary (between 1.50<a name='4914'></font>
<font color=#447700>! and 1.80) as a function of total column water vapor.  The function<a name='4915'></font>
<font color=#447700>! has been defined to minimize flux and cooling rate errors in these bands<a name='4916'></font>
<font color=#447700>! over a wide range of precipitable water values.<a name='4917'></font>
<a name='4918'>
      integer :: iplon<a name='4919'>
      real :: bbb<a name='4920'>
<a name='4921'>
<font color=#447700>! (dmb 2012) Here we compute the index for the column and band dimensions<a name='4922'></font>
#ifdef _ACCEL<a name='4923'>
   iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='4924'>
   igc = (blockidx%y-1) * blockdim%y + threadidx%y<a name='4925'>
<font color=#447700>! (dmb 2012) Make sure that the column and bands are within the proper ranges<a name='4926'></font>
   if (iplon &lt;= ncol .and. igc&lt;=140) then<a name='4927'>
<a name='4928'>
    <a name='4929'>
#else<a name='4930'>
      do igc = 1, 140 <a name='4931'>
# define secdiff   SECDIFF(iplon)<a name='4932'>
#endif<a name='4933'>
         ibnd = ngb(igc)<a name='4934'>
<a name='4935'>
       ILOOP_S_CPU<a name='4936'>
         if (ibnd.eq.1 .or. ibnd.eq.4 .or. ibnd.ge.10) then<a name='4937'>
           secdiff = 1.66 <a name='4938'>
         else<a name='4939'>
           secdiff = a0d(ibnd) + a1d(ibnd)*exp(a2d(ibnd)*pwvcmd(iplon))<a name='4940'>
           if (secdiff .gt. 1.80 ) secdiff = 1.80 <a name='4941'>
           if (secdiff .lt. 1.50 ) secdiff = 1.50 <a name='4942'>
         endif<a name='4943'>
         gurad(iplon, igc, 0) = 0.0 <a name='4944'>
         gdrad(iplon, igc, 0) = 0.0 <a name='4945'>
<font color=#447700>!totuflux(iplon,igc,0) = 0.0 <a name='4946'></font>
<font color=#447700>!totdflux(iplon,igc,0) = 0.0 <a name='4947'></font>
         gclrurad(iplon, igc, 0) = 0.0 <a name='4948'>
         gclrdrad(iplon, igc, 0) = 0.0 <a name='4949'>
<font color=#447700>!totuclfl(iplon,igc,0) = 0.0 <a name='4950'></font>
<font color=#447700>!totdclfl(iplon,igc,0) = 0.0 <a name='4951'></font>
         if (idrvd .eq. 1) then<a name='4952'>
            gdtotuflux_dtd(iplon,igc,0) = 0.0 <a name='4953'>
            gdtotuclfl_dtd(iplon,igc,0) = 0.0 <a name='4954'>
         endif<a name='4955'>
       ILOOP_E_CPU<a name='4956'>
<a name='4957'>
         do lay = 1, nlayers<a name='4958'>
       ILOOP_S_CPU<a name='4959'>
            gurad(iplon, igc, lay) = 0.0 <a name='4960'>
            gdrad(iplon, igc, lay) = 0.0 <a name='4961'>
            gclrurad(iplon, igc, lay) = 0.0 <a name='4962'>
            gclrdrad(iplon, igc, lay) = 0.0 <a name='4963'>
          <a name='4964'>
<font color=#447700>! (dmb 2012) I removed the band loop here because it was terribly inefficient<a name='4965'></font>
<font color=#447700>! I now set the required variables outside of the kernel<a name='4966'></font>
<a name='4967'>
            if (idrvd .eq. 1) then<a name='4968'>
               gdtotuflux_dtd(iplon,igc,lay) = 0.0 <a name='4969'>
               gdtotuclfl_dtd(iplon,igc,lay) = 0.0 <a name='4970'>
            endif<a name='4971'>
       ILOOP_E_CPU<a name='4972'>
         enddo<a name='4973'>
<a name='4974'>
<font color=#447700>! Radiative transfer starts here.<a name='4975'></font>
         radld = 0. <a name='4976'>
         radclrd = 0. <a name='4977'>
         iclddn = 0<a name='4978'>
<a name='4979'>
<font color=#447700>! Downward radiative transfer loop.  <a name='4980'></font>
<a name='4981'>
# ifndef _ACCEL<a name='4982'>
#  define radld   RADLD(iplon)<a name='4983'>
#  define radclrd RADCLRD(iplon)<a name='4984'>
#  define iclddn  ICLDDN(iplon)<a name='4985'>
# endif<a name='4986'>
<a name='4987'>
         do lev = nlayers, 1, -1<a name='4988'>
       ILOOP_S_CPU<a name='4989'>
               plfrac = fracsd(iplon,lev,igc)<a name='4990'>
               blay = planklayd(iplon,lev,ibnd)<a name='4991'>
               dplankup = planklevd(iplon,lev,ibnd) - blay<a name='4992'>
               dplankdn = planklevd(iplon,lev-1,ibnd) - blay<a name='4993'>
               odepth = secdiff * taug(iplon,lev,igc)<a name='4994'>
               if (odepth .lt. 0.0 ) odepth = 0.0 <a name='4995'>
<font color=#447700>!  Cloudy layer<a name='4996'></font>
               if (icldlyr(iplon, lev).eq.1) then<a name='4997'>
                  iclddn = 1<a name='4998'>
<font color=#447700>! (dmb 2012) Here instead of using the lookup tables to compute <a name='4999'></font>
<font color=#447700>! the optical depth and related quantities, I compute them on the <a name='5000'></font>
<font color=#447700>! fly because this is actually much more efficient on the GPU.<a name='5001'></font>
                  odclds = secdiff * taucmcd(iplon,igc,lev)<a name='5002'>
                  absclds = 1.  - exp(-odclds)<a name='5003'>
                  efclfracs = absclds * cldfmcd(iplon, igc,lev)<a name='5004'>
                  odtot = odepth + odclds<a name='5005'>
                <a name='5006'>
#ifdef _ACCEL<a name='5007'>
                  tblind = odepth/(bpaded+odepth)<a name='5008'>
                  itgas = tblint*tblind+0.5 <a name='5009'>
                  bbb = itgas / float(tblint)<a name='5010'>
                  odepth = bpaded * bbb / (1.  - bbb)<a name='5011'>
<a name='5012'>
                  atrans(lev) = exp( -odepth)<a name='5013'>
                  atrans(lev) = 1  -atrans(lev)<a name='5014'>
<font color=#447700>! (dmb 2012) Compute tfacgas on the fly.  Even though this is an expensive operation,<a name='5015'></font>
<font color=#447700>! it is more efficient to do the calculation within the kernel on the GPU. <a name='5016'></font>
                  if (odepth &lt; 0.06) then<a name='5017'>
                     tfacgas = odepth/6. <a name='5018'>
                  else<a name='5019'>
                     tfacgas = 1. -2. *((1. /odepth)-((1.  - atrans(lev))/(atrans(lev))))<a name='5020'>
                  endif<a name='5021'>
                  gassrc = atrans(lev) * plfrac * (blay + tfacgas*dplankdn)<a name='5022'>
<a name='5023'>
                  odtot = odepth + odclds<a name='5024'>
                  tblind = odtot/(bpaded+odtot)<a name='5025'>
                  ittot = tblint*tblind + 0.5 <a name='5026'>
                  bbb = ittot / float(tblint)<a name='5027'>
                  bbb = bpaded * bbb / (1.  - bbb)<a name='5028'>
                  atot(lev) = 1.  - exp(-bbb)<a name='5029'>
                  if (bbb &lt; 0.06) then<a name='5030'>
                     tfactot = bbb/6. <a name='5031'>
                  else<a name='5032'>
                     tfactot = 1. -2. *((1. /bbb)-((1-atot(lev))/(atot(lev))))<a name='5033'>
                  endif<a name='5034'>
                  bbdtot = plfrac * (blay + tfactot*dplankdn)<a name='5035'>
                  bbd = plfrac*(blay+tfacgas*dplankdn)<a name='5036'>
#else<a name='5037'>
                  tblind = odepth/(bpade+odepth)<a name='5038'>
                  itgas = tblint*tblind+0.5 <a name='5039'>
                  odepth = tau_tbl(itgas)<a name='5040'>
                  atrans(lev) = 1.  - exp_tbl(itgas)<a name='5041'>
                  tfacgas = tfn_tbl(itgas)<a name='5042'>
                  gassrc = atrans(lev) * plfrac * (blay + tfacgas*dplankdn)<a name='5043'>
<a name='5044'>
                  odtot = odepth + odclds<a name='5045'>
                  tblind = odtot/(bpade+odtot)<a name='5046'>
                  ittot = tblint*tblind + 0.5 <a name='5047'>
                  tfactot = tfn_tbl(ittot)<a name='5048'>
                  bbdtot = plfrac * (blay + tfactot*dplankdn)<a name='5049'>
                  bbd = plfrac*(blay+tfacgas*dplankdn)<a name='5050'>
                  atot(lev) = 1.  - exp_tbl(ittot)<a name='5051'>
#endif<a name='5052'>
<a name='5053'>
                  radld = radld - radld * (atrans(lev) + &amp;<a name='5054'>
                  efclfracs * (1.  - atrans(lev))) + &amp;<a name='5055'>
                  gassrc + cldfmcd(iplon, igc,lev) * &amp;<a name='5056'>
                  (bbdtot * atot(lev) - gassrc)<a name='5057'>
                  gdrad(iplon, igc, lev-1) = gdrad(iplon, igc, lev-1) + radld <a name='5058'>
                  bbugas(lev) = plfrac * (blay + tfacgas * dplankup)<a name='5059'>
                  bbutot(lev) = plfrac * (blay + tfactot * dplankup)<a name='5060'>
              <a name='5061'>
<font color=#447700>!  Clear layer<a name='5062'></font>
               else<a name='5063'>
<a name='5064'>
#ifdef _ACCEL<a name='5065'>
                  tblind = odepth/(bpaded+odepth)<a name='5066'>
                  itr = tblint*tblind+0.5 <a name='5067'>
<font color=#447700>! (dmb 2012) Compute the atrans and related values on the fly instead<a name='5068'></font>
<font color=#447700>! of using the lookup tables.<a name='5069'></font>
                  bbb = itr/float(tblint)<a name='5070'>
                  bbb = bpaded * bbb / (1.  - bbb)<a name='5071'>
                  transc = exp( -bbb )<a name='5072'>
                  if (transc &lt; 1.e-20 ) transc = 1.e-20 <a name='5073'>
                  atrans(lev) = 1. -transc<a name='5074'>
<a name='5075'>
                  if (bbb &lt; 0.06 ) then<a name='5076'>
                     tausfac = bbb/6. <a name='5077'>
                  else<a name='5078'>
                     tausfac = 1. -2. *((1. /bbb)-(transc/(1.-transc)))<a name='5079'>
                  endif <a name='5080'>
<a name='5081'>
                  bbd = plfrac*(blay+tausfac*dplankdn)<a name='5082'>
                  bbugas(lev) = plfrac * (blay + tausfac * dplankup)<a name='5083'>
#else<a name='5084'>
#  if 0<a name='5085'>
                  tblind = odepth/(bpade+odepth)<a name='5086'>
                  itr = tblint*tblind+0.5 <a name='5087'>
                  transc = exp_tbl(itr)<a name='5088'>
                  atrans(lev) = 1. -transc<a name='5089'>
                  tausfac = tfn_tbl(itr)<a name='5090'>
                  bbd = plfrac*(blay+tausfac*dplankdn)<a name='5091'>
                  bbugas(lev) = plfrac * (blay + tausfac * dplankup)<a name='5092'>
#  else<a name='5093'>
  <font color=#447700>! jm agree with the calculation in module_ra_rrtmg_lw.F ~line 3340<a name='5094'></font>
                  if (odepth .le. 0.06) then<a name='5095'>
                     atrans(lev) = odepth-0.5*odepth*odepth<a name='5096'>
                     odepth = rec_6*odepth<a name='5097'>
                     bbd = plfrac*(blay+dplankdn*odepth)<a name='5098'>
                     bbugas(lev) = plfrac*(blay+dplankup*odepth)<a name='5099'>
                  else<a name='5100'>
                     tblind = odepth/(bpade+odepth)<a name='5101'>
                     itr = tblint*tblind+0.5<a name='5102'>
                     transc = exp_tbl(itr)<a name='5103'>
                     atrans(lev) = 1.-transc<a name='5104'>
                     tausfac = tfn_tbl(itr)<a name='5105'>
                     bbd = plfrac*(blay+tausfac*dplankdn)<a name='5106'>
                     bbugas(lev) = plfrac * (blay + tausfac * dplankup)<a name='5107'>
                  endif<a name='5108'>
#  endif<a name='5109'>
#endif<a name='5110'>
                  radld = radld + (bbd-radld )*atrans(lev)<a name='5111'>
                  gdrad(iplon, igc, lev-1) = gdrad(iplon, igc, lev-1) + radld <a name='5112'>
<a name='5113'>
               endif<a name='5114'>
<a name='5115'>
<font color=#447700>!  Set clear sky stream to total sky stream as long as layers<a name='5116'></font>
<font color=#447700>!  remain clear.  Streams diverge when a cloud is reached (iclddn=1),<a name='5117'></font>
<font color=#447700>!  and clear sky stream must be computed separately from that point.<a name='5118'></font>
               if (iclddn .eq.1) then<a name='5119'>
                  radclrd = radclrd + (bbd-radclrd) * atrans(lev) <a name='5120'>
<font color=#447700>! (dmb 2012) Rather than summing up the results and then computing the <a name='5121'></font>
<font color=#447700>! total fluxes, I store the g-point specific values in GPU arrays to be <a name='5122'></font>
<font color=#447700>! summed up later in a new kernel.  This ensures that we can parallelize <a name='5123'></font>
<font color=#447700>! across enough dimensions so that the GPU remains busy.<a name='5124'></font>
                  gclrdrad(iplon, igc, lev-1) = gclrdrad(iplon, igc, lev-1) + radclrd<a name='5125'>
               else<a name='5126'>
                  radclrd = radld <a name='5127'>
                  gclrdrad(iplon, igc, lev-1) = gdrad(iplon, igc, lev-1)<a name='5128'>
               endif<a name='5129'>
       ILOOP_E_CPU<a name='5130'>
         enddo   <font color=#447700>! end of downward radiation loop<a name='5131'></font>
<a name='5132'>
<font color=#447700>! Spectral emissivity &amp; reflectance<a name='5133'></font>
<font color=#447700>!  Include the contribution of spectrally varying longwave emissivity<a name='5134'></font>
<font color=#447700>!  and reflection from the surface to the upward radiative transfer.<a name='5135'></font>
<font color=#447700>!  Note: Spectral and Lambertian reflection are identical for the<a name='5136'></font>
<font color=#447700>!  diffusivity angle flux integration used here.<a name='5137'></font>
<font color=#447700>!  Note: The emissivity is applied to plankbnd and dplankbnd_dt when <a name='5138'></font>
<font color=#447700>!  they are defined in subroutine setcoef. <a name='5139'></font>
<a name='5140'>
# ifndef _ACCEL<a name='5141'>
#  define radlu         RADLU(iplon)<a name='5142'>
#  define radclru       RADCLRU(iplon)<a name='5143'>
#  define d_radlu_dt    D_RADLU_DT(iplon)<a name='5144'>
#  define d_radclru_dt  D_RADCLRU_DT(iplon)<a name='5145'>
# endif<a name='5146'>
    <a name='5147'>
       ILOOP_S_CPU<a name='5148'>
         rad0 = fracsd(iplon,1,igc) * plankbndd(iplon,ibnd)<a name='5149'>
<font color=#447700>!  Add in specular reflection of surface downward radiance.<a name='5150'></font>
         reflect = 1.  - semissd(iplon,ibnd)<a name='5151'>
         radlu = rad0 + reflect * radld<a name='5152'>
         radclru = rad0 + reflect * radclrd<a name='5153'>
<a name='5154'>
<font color=#447700>! Upward radiative transfer loop.<a name='5155'></font>
         gurad(iplon, igc, 0) = gurad(iplon, igc, 0) + radlu <a name='5156'>
         gclrurad(iplon, igc, 0) = gclrurad(iplon, igc, 0) + radclru<a name='5157'>
       ILOOP_E_CPU<a name='5158'>
<a name='5159'>
         do lev = 1, nlayers<a name='5160'>
       ILOOP_S_CPU<a name='5161'>
<font color=#447700>!  Cloudy layer<a name='5162'></font>
            if (icldlyr(iplon, lev) .eq. 1) then<a name='5163'>
               gassrc = bbugas(lev) * atrans(lev)<a name='5164'>
               odclds = secdiff * taucmcd(iplon,igc,lev)<a name='5165'>
               absclds = 1.  - exp(-odclds)<a name='5166'>
               efclfracs = absclds * cldfmcd(iplon, igc,lev)<a name='5167'>
               radlu = radlu - radlu * (atrans(lev) + &amp;<a name='5168'>
                   efclfracs * (1.  - atrans(lev))) + &amp;<a name='5169'>
                   gassrc + cldfmcd(iplon, igc,lev) * &amp;<a name='5170'>
                   (bbutot(lev) * atot(lev) - gassrc)<a name='5171'>
               gurad(iplon, igc, lev) = gurad(iplon, igc, lev) + radlu<a name='5172'>
<font color=#447700>!  Clear layer<a name='5173'></font>
            else<a name='5174'>
               radlu = radlu + (bbugas(lev)-radlu)*atrans(lev)<a name='5175'>
               gurad(iplon, igc, lev) = gurad(iplon, igc, lev) + radlu<a name='5176'>
            endif<a name='5177'>
<a name='5178'>
<a name='5179'>
<a name='5180'>
<font color=#447700>!  Set clear sky stream to total sky stream as long as all layers<a name='5181'></font>
<font color=#447700>!  are clear (iclddn=0).  Streams must be calculated separately at <a name='5182'></font>
<font color=#447700>!  all layers when a cloud is present (ICLDDN=1), because surface <a name='5183'></font>
<font color=#447700>!  reflectance is different for each stream.<a name='5184'></font>
               if (iclddn.eq.1) then<a name='5185'>
                  radclru = radclru + (bbugas(lev)-radclru)*atrans(lev) <a name='5186'>
                  gclrurad(iplon, igc, lev) = gclrurad(iplon, igc, lev) + radclru<a name='5187'>
               else<a name='5188'>
                  radclru = radlu<a name='5189'>
                  gclrurad(iplon, igc, lev) = gurad(iplon, igc, lev)<a name='5190'>
               endif<a name='5191'>
       ILOOP_E_CPU<a name='5192'>
          enddo<a name='5193'>
          <a name='5194'>
          <a name='5195'>
          tblind = wtdiff * delwaved(ibnd) * fluxfacd<a name='5196'>
 <font color=#447700>! (dmb 2012) Now that the g-points values were created, we modify them <a name='5197'></font>
 <font color=#447700>! so that later summation (integration) will be simpler.  <a name='5198'></font>
          do lev = 0, nlayers  <a name='5199'>
       ILOOP_S_CPU<a name='5200'>
           gurad(iplon, igc, lev) = gurad(iplon, igc, lev) * tblind<a name='5201'>
           gdrad(iplon, igc, lev) = gdrad(iplon, igc, lev) * tblind<a name='5202'>
           gclrurad(iplon, igc, lev) = gclrurad(iplon, igc, lev) * tblind<a name='5203'>
           gclrdrad(iplon, igc, lev) = gclrdrad(iplon, igc, lev) * tblind<a name='5204'>
       ILOOP_E_CPU<a name='5205'>
          end do<a name='5206'>
<a name='5207'>
#ifdef _ACCEL<a name='5208'>
      endif<a name='5209'>
#else<a name='5210'>
      end do   <font color=#447700>! igc loop<a name='5211'></font>
#endif<a name='5212'>
<a name='5213'>
      end subroutine rtrnmcg<a name='5214'>
<a name='5215'>
<font color=#447700>! (dmb 2012) This subroutine adds up the indivial g-point fluxes to arrive at a <a name='5216'></font>
<font color=#447700>! final upward and downward flux value for each column and layer.  This subroutine <a name='5217'></font>
<font color=#447700>! is parallelized across the column and layer dimensions.  As long as we parallelize <a name='5218'></font>
<font color=#447700>! across two of the three dimesnions, we should usually have enough GPU saturation.<a name='5219'></font>
<A NAME='RTRNADD'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNADD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5220'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>rtrnadd</font>(ncol, nlay, ngpt, drvf                &amp;<a name='5221'>
#include "<A href='../../html_code/include/rrtmg_lw_cpu_args.h.html'>rrtmg_lw_cpu_args.h</A>"<A NAME="rrtmg_lw_cpu_args.h_3"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNADD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5222'>
                                )<a name='5223'>
<a name='5224'>
      integer, intent(in), value :: ncol<a name='5225'>
      integer, intent(in), value :: nlay<a name='5226'>
      integer, intent(in), value :: ngpt<a name='5227'>
      integer, intent(in), value :: drvf<a name='5228'>
#include "<A href='../../html_code/include/rrtmg_lw_cpu_defs.h.html'>rrtmg_lw_cpu_defs.h</A>"<A NAME="rrtmg_lw_cpu_defs.h_4"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNADD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5229'>
        <a name='5230'>
      integer :: iplon, ilay, igp<a name='5231'>
<font color=#447700>!      real :: d(140)<a name='5232'></font>
<a name='5233'>
<font color=#447700>! (dmb 2012) compute the column and layer indices from the grid and block <a name='5234'></font>
<font color=#447700>! configurations. <a name='5235'></font>
<a name='5236'>
#ifdef _ACCEL<a name='5237'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='5238'>
      ilay = (blockidx%y-1) * blockdim%y + threadidx%y - 1<a name='5239'>
       <a name='5240'>
<font color=#447700>! (dmb 2012) make sure that the column and layer are within range<a name='5241'></font>
      if (ilay &lt;= nlay .and. iplon &lt;= ncol) then<a name='5242'>
#else<a name='5243'>
<font color=#447700>! zap should move this inside the igp loop<a name='5244'></font>
      do iplon = 1, ncol<a name='5245'>
        do ilay = 0, nlay<a name='5246'>
#endif<a name='5247'>
<a name='5248'>
          do igp = 1, ngpt<a name='5249'>
              <a name='5250'>
            totufluxd(iplon, ilay)=totufluxd(iplon, ilay)+gurad(iplon, igp, ilay)<a name='5251'>
            totdfluxd(iplon, ilay)=totdfluxd(iplon, ilay)+gdrad(iplon, igp, ilay)<a name='5252'>
            totuclfld(iplon, ilay)=totuclfld(iplon, ilay)+gclrurad(iplon, igp, ilay)<a name='5253'>
            totdclfld(iplon, ilay)=totdclfld(iplon, ilay)+gclrdrad(iplon, igp, ilay)<a name='5254'>
<a name='5255'>
          end do<a name='5256'>
<a name='5257'>
          if (drvf .eq. 1) then<a name='5258'>
<a name='5259'>
            do igp = 1, ngpt<a name='5260'>
                <a name='5261'>
              dtotuflux_dtd(iplon, ilay) = dtotuflux_dtd(iplon, ilay) + gdtotuflux_dtd( iplon, igp, ilay)<a name='5262'>
              dtotuclfl_dtd(iplon, ilay) = dtotuclfl_dtd(iplon, ilay) + gdtotuclfl_dtd( iplon, igp, ilay)<a name='5263'>
<a name='5264'>
            end do<a name='5265'>
<a name='5266'>
          end if<a name='5267'>
<a name='5268'>
#ifdef _ACCEL<a name='5269'>
      end if<a name='5270'>
#else<a name='5271'>
        end do<a name='5272'>
      end do<a name='5273'>
#endif<a name='5274'>
<a name='5275'>
      end subroutine<a name='5276'>
<a name='5277'>
<font color=#447700>! (dmb 2012) This kernel computes the heating rates separately.  It is parallelized across the <a name='5278'></font>
<font color=#447700>! columnn and layer dimensions.<a name='5279'></font>
<A NAME='RTRNHEATRATES'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RTRNHEATRATES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5280'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>rtrnheatrates</font>(ncol, nlay &amp;<a name='5281'>
#ifndef _ACCEL<a name='5282'>
         ,ncol_,nlayers_,nbndlw_,ngptlw_                                                          &amp;<a name='5283'>
         ,taucmcd,pzd,pwvcmd,semissd,planklayd,planklevd,plankbndd,gurad,gdrad,gclrurad,gclrdrad  &amp;<a name='5284'>
         ,gdtotuflux_dtd,gdtotuclfl_dtd,idrvd,bpaded,heatfacd,fluxfacd,a0d,a1d,a2d                &amp;<a name='5285'>
         ,delwaved,totufluxd,totdfluxd,fnetd,htrd,totuclfld,totdclfld,fnetcd,htrcd,dtotuflux_dtd  &amp;<a name='5286'>
         ,dtotuclfl_dtd,dplankbnd_dtd                                                             &amp;<a name='5287'>
#endif<a name='5288'>
                                      )<a name='5289'>
<a name='5290'>
      integer, intent(in), value :: ncol<a name='5291'>
      integer, intent(in), value :: nlay<a name='5292'>
#ifndef _ACCEL<a name='5293'>
      integer :: ncol_,nlayers_,nbndlw_,ngptlw_<a name='5294'>
<font color=#447700>! changed to arguments for thread safety<a name='5295'></font>
# ifndef ncol_<a name='5296'>
#   define ncol_ CHNK<a name='5297'>
# endif<a name='5298'>
      integer  :: ngsd(nbndlw)      <a name='5299'>
<a name='5300'>
<font color=#447700>! Atmosphere<a name='5301'></font>
      real :: taucmcd(ncol_, ngptlw_, nlayers_+1)<a name='5302'>
   <a name='5303'>
      real , dimension(ncol_, 0:nlayers_+1) :: pzd      <font color=#447700>! level (interface) pressures (hPa, mb)<a name='5304'></font>
                                                        <font color=#447700>!    Dimensions: (ncol,0:nlayers)<a name='5305'></font>
      real , dimension(ncol_) :: pwvcmd                 <font color=#447700>! precipitable water vapor (cm)<a name='5306'></font>
                                                        <font color=#447700>!    Dimensions: (ncol)<a name='5307'></font>
      real , dimension(ncol_,nbndlw_) :: semissd        <font color=#447700>! lw surface emissivity<a name='5308'></font>
                                                        <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='5309'></font>
      real , dimension(ncol_,nlayers_+1,nbndlw_) :: planklayd    <font color=#447700>! <a name='5310'></font>
                                                        <font color=#447700>!    Dimensions: (ncol,nlayers+1,nbndlw)<a name='5311'></font>
      real , dimension(ncol_,0:nlayers_+1,nbndlw_) :: planklevd    <font color=#447700>! <a name='5312'></font>
                                                        <font color=#447700>!    Dimensions: (ncol,0:nlayers+1,nbndlw)<a name='5313'></font>
      real, dimension(ncol_,nbndlw_) :: plankbndd       <font color=#447700>! <a name='5314'></font>
                                                        <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='5315'></font>
   <a name='5316'>
      real :: gurad(ncol_,ngptlw_,0:nlayers_+1)         <font color=#447700>! upward longwave flux (w/m2)<a name='5317'></font>
      real :: gdrad(ncol_,ngptlw_,0:nlayers_+1)         <font color=#447700>! downward longwave flux (w/m2)<a name='5318'></font>
      real :: gclrurad(ncol_,ngptlw_,0:nlayers_+1)      <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5319'></font>
      real :: gclrdrad(ncol_,ngptlw_,0:nlayers_+1)      <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5320'></font>
<a name='5321'>
      real  :: gdtotuflux_dtd(ncol_, ngptlw_, 0:nlayers_+1) <font color=#447700>! change in upward longwave flux (w/m1/k)<a name='5322'></font>
                                     <font color=#447700>! with respect to surface temperature<a name='5323'></font>
<a name='5324'>
      real  :: gdtotuclfl_dtd(ncol_, ngptlw_, 0:nlayers_+1) <font color=#447700>! change in clear sky upward longwave flux (w/m2/k)<a name='5325'></font>
                                     <font color=#447700>! with respect to surface temperature<a name='5326'></font>
<a name='5327'>
<font color=#447700>! Clouds<a name='5328'></font>
      integer  :: idrvd                       <font color=#447700>! flag for calculation of dF/dt from <a name='5329'></font>
                                                      <font color=#447700>! Planck derivative [0=off, 1=on]<a name='5330'></font>
      real  :: bpaded<a name='5331'>
      real  :: heatfacd<a name='5332'>
      real  :: fluxfacd<a name='5333'>
      real  :: a0d(nbndlw_), a1d(nbndlw_), a2d(nbndlw_)<a name='5334'>
      real  :: delwaved(nbndlw_)<a name='5335'>
      real :: totufluxd(ncol_, 0:nlayers_+1)     <font color=#447700>! upward longwave flux (w/m2)<a name='5336'></font>
      real :: totdfluxd(ncol_, 0:nlayers_+1)     <font color=#447700>! downward longwave flux (w/m2)<a name='5337'></font>
      real :: fnetd(ncol_, 0:nlayers_+1)         <font color=#447700>! net longwave flux (w/m2)<a name='5338'></font>
      real :: htrd(ncol_, 0:nlayers_+1)          <font color=#447700>! longwave heating rate (k/day)<a name='5339'></font>
      real :: totuclfld(ncol_, 0:nlayers_+1)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5340'></font>
      real :: totdclfld(ncol_, 0:nlayers_+1)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5341'></font>
      real :: fnetcd(ncol_, 0:nlayers_+1)        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='5342'></font>
      real :: htrcd(ncol_, 0:nlayers_+1)         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='5343'></font>
      real :: dtotuflux_dtd(ncol_, 0:nlayers_+1) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='5344'></font>
                                                       <font color=#447700>! with respect to surface temperature<a name='5345'></font>
      real :: dtotuclfl_dtd(ncol_, 0:nlayers_+1) <font color=#447700>! change in clear sky upward longwave flux (w/m2/k)<a name='5346'></font>
                                                       <font color=#447700>! with respect to surface temperature<a name='5347'></font>
      real :: dplankbnd_dtd(ncol_,nbndlw_) <a name='5348'>
# undef ncol_<a name='5349'>
#endif<a name='5350'>
      <a name='5351'>
      real :: t2<a name='5352'>
      integer :: iplon, ilay<a name='5353'>
<a name='5354'>
#ifdef _ACCEL        <a name='5355'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='5356'>
      ilay = (blockidx%y-1) * blockdim%y + threadidx%y - 1<a name='5357'>
<a name='5358'>
    <a name='5359'>
      if (ilay&lt;nlay .and. iplon&lt;=ncol) then<a name='5360'>
#else<a name='5361'>
      do iplon = 1, ncol<a name='5362'>
        do ilay = 0, nlay - 1<a name='5363'>
#endif<a name='5364'>
          t2 = pzd(iplon, ilay ) - pzd(iplon, ilay + 1)<a name='5365'>
          htrd(iplon, ilay) = heatfacd * ((totufluxd(iplon, ilay) - totdfluxd(iplon, ilay)) &amp;<a name='5366'>
                 - (totufluxd(iplon, ilay+1) - totdfluxd(iplon, ilay+1)))/t2<a name='5367'>
          htrcd(iplon, ilay) = heatfacd * ((totuclfld(iplon, ilay) - totdclfld(iplon, ilay)) &amp;<a name='5368'>
                 - (totuclfld(iplon, ilay+1) - totdclfld(iplon, ilay+1)))/t2<a name='5369'>
<a name='5370'>
#ifdef _ACCEL<a name='5371'>
      end if<a name='5372'>
#else<a name='5373'>
        end do<a name='5374'>
      end do<a name='5375'>
#endif<a name='5376'>
       <a name='5377'>
      end subroutine<a name='5378'>
<a name='5379'>
<font color=#447700>! (dmb 2012) Copy needed variables over to the GPU.  These arrays are pretty small so simple <a name='5380'></font>
<font color=#447700>! stream 0 assignment operators suffice.<a name='5381'></font>
<A NAME='COPYGPURTRNMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPURTRNMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5382'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyGPUrtrnmcg</font>(pz, pwvcm, idrv, taut) <A href='../../call_to/COPYGPURTRNMCG.html' TARGET='index'>1</A><a name='5383'>
            <a name='5384'>
      real , intent(in) :: pz(:,:)             <font color=#447700>! level (interface) pressures (hPa, mb)<a name='5385'></font>
      integer , intent(in) :: idrv             <font color=#447700>! flag for calculation of dF/dt from <a name='5386'></font>
      real , intent(in) :: taut(:,:,:)  <a name='5387'>
      real , intent(in) :: pwvcm(:)<a name='5388'>
<a name='5389'>
#ifdef _ACCEL<a name='5390'>
      pzd = pz<a name='5391'>
      pwvcmd = pwvcm<a name='5392'>
      idrvd = idrv<a name='5393'>
      bpaded = bpade<a name='5394'>
      heatfacd = heatfac<a name='5395'>
      fluxfacd = fluxfac<a name='5396'>
#endif<a name='5397'>
         <a name='5398'>
      end subroutine<a name='5399'>
<a name='5400'>
<font color=#447700>! (dmb 2012) Allocate the arrays for the rtrnmc routine on the GPU.  Some of these arrays are <a name='5401'></font>
<font color=#447700>! quite large as they contain all 3 dimensions.  Luckily, for the gurad arrays, no copying of data<a name='5402'></font>
<font color=#447700>! from the CPU is needed because they are only stored on the GPU.<a name='5403'></font>
<A NAME='ALLOCATEGPURTRNMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPURTRNMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5404'>
      <font color=#993300>subroutine </font><font color=#cc0000>allocateGPUrtrnmcg</font>(ncol, nlay, ngptlw, drvf) <A href='../../call_to/ALLOCATEGPURTRNMCG.html' TARGET='index'>1</A><a name='5405'>
<a name='5406'>
      integer , intent(in) :: ncol, nlay, ngptlw, drvf<a name='5407'>
integer,external :: omp_get_thread_num<a name='5408'>
<a name='5409'>
#ifdef _ACCEL<a name='5410'>
      allocate( taucmcd(ncol, ngptlw, nlay+1))<a name='5411'>
      allocate( pzd(ncol, 0:nlay+1))<a name='5412'>
      allocate( pwvcmd(ncol))<a name='5413'>
      allocate( semissd(ncol, nbndlw))<a name='5414'>
      allocate( planklayd(ncol,nlay+1,nbndlw))<a name='5415'>
      allocate( planklevd(ncol, 0:nlay+1, nbndlw))<a name='5416'>
      allocate( plankbndd(ncol,nbndlw))<a name='5417'>
      allocate ( gurad(ncol,ngptlw,0:nlay+1))        <font color=#447700>! upward longwave flux (w/m2)<a name='5418'></font>
      allocate ( gdrad(ncol,ngptlw,0:nlay+1))        <font color=#447700>! downward longwave flux (w/m2)<a name='5419'></font>
      allocate ( gclrurad(ncol,ngptlw,0:nlay+1))     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5420'></font>
      allocate ( gclrdrad(ncol,ngptlw,0:nlay+1))     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5421'></font>
<a name='5422'>
<font color=#447700>! (dmb 2012) Only allocate the optional derivative arrays if the flag is set<a name='5423'></font>
      if (drvf .eq. 1) then<a name='5424'>
            <a name='5425'>
        allocate( gdtotuflux_dtd( ncol, ngptlw, 0:nlay+1))<a name='5426'>
        allocate( gdtotuclfl_dtd( ncol, ngptlw, 0:nlay+1))<a name='5427'>
<a name='5428'>
      endif<a name='5429'>
          <a name='5430'>
      allocate (totufluxd(ncol, 0:nlay+1))     <font color=#447700>! upward longwave flux (w/m2)<a name='5431'></font>
      allocate (totdfluxd(ncol, 0:nlay+1))     <font color=#447700>! downward longwave flux (w/m2)<a name='5432'></font>
      allocate (fnetd(ncol, 0:nlay+1))         <font color=#447700>! net longwave flux (w/m2)<a name='5433'></font>
      allocate (htrd(ncol, 0:nlay+1))          <font color=#447700>! longwave heating rate (k/day)<a name='5434'></font>
      allocate (totuclfld(ncol, 0:nlay+1))     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5435'></font>
      allocate (totdclfld(ncol, 0:nlay+1))     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5436'></font>
      allocate (fnetcd(ncol, 0:nlay+1))        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='5437'></font>
      allocate (htrcd(ncol, 0:nlay+1))         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='5438'></font>
      allocate (dtotuflux_dtd(ncol, 0:nlay+1)) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='5439'></font>
      allocate (dtotuclfl_dtd(ncol, 0:nlay+1))<a name='5440'>
      allocate (dplankbnd_dtd(ncol,nbndlw)) <a name='5441'>
#endif<a name='5442'>
<a name='5443'>
      end subroutine <a name='5444'>
<a name='5445'>
<font color=#447700>! (dmb 2012) This subroutine deallocates rtrnmc related GPU arrays.<a name='5446'></font>
<A NAME='DEALLOCATEGPURTRNMCG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPURTRNMCG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5447'>
      <font color=#993300>subroutine </font><font color=#cc0000>deallocateGPUrtrnmcg</font>( drvf ) <A href='../../call_to/DEALLOCATEGPURTRNMCG.html' TARGET='index'>1</A><a name='5448'>
<a name='5449'>
      integer , intent(in) :: drvf<a name='5450'>
          <a name='5451'>
#ifdef _ACCEL<a name='5452'>
      deallocate( taucmcd)<a name='5453'>
      deallocate( pzd)<a name='5454'>
      deallocate( pwvcmd)<a name='5455'>
      deallocate( semissd)<a name='5456'>
      deallocate( planklayd)<a name='5457'>
      deallocate( planklevd)<a name='5458'>
      deallocate( plankbndd)<a name='5459'>
      deallocate ( gurad)        <font color=#447700>! upward longwave flux (w/m2)<a name='5460'></font>
      deallocate ( gdrad)        <font color=#447700>! downward longwave flux (w/m2)<a name='5461'></font>
      deallocate ( gclrurad)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5462'></font>
      deallocate ( gclrdrad)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5463'></font>
      deallocate (totufluxd)     <font color=#447700>! upward longwave flux (w/m2)<a name='5464'></font>
      deallocate (totdfluxd)     <font color=#447700>! downward longwave flux (w/m2)<a name='5465'></font>
      deallocate (fnetd)         <font color=#447700>! net longwave flux (w/m2)<a name='5466'></font>
      deallocate (htrd)          <font color=#447700>! longwave heating rate (k/day)<a name='5467'></font>
      deallocate (totuclfld)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='5468'></font>
      deallocate (totdclfld)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='5469'></font>
      deallocate (fnetcd)        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='5470'></font>
      deallocate (htrcd)         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='5471'></font>
      deallocate (dtotuflux_dtd) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='5472'></font>
      deallocate (dtotuclfl_dtd)<a name='5473'>
      deallocate (dplankbnd_dtd) <a name='5474'>
<a name='5475'>
      if ( drvf .eq. 1) then<a name='5476'>
        deallocate( gdtotuflux_dtd, gdtotuclfl_dtd )<a name='5477'>
      end if<a name='5478'>
#endif<a name='5479'>
<a name='5480'>
      end subroutine <a name='5481'>
<a name='5482'>
      end module gpu_rrtmg_lw_rtrnmc<a name='5483'>
<a name='5484'>
<a name='5485'>
<font color=#447700>! (dmb 2012) This is the GPU version of the taumol subroutines.  At first I was going to <a name='5486'></font>
<font color=#447700>! try and combine the taumol routines into a single subroutine, but it turns out that <a name='5487'></font>
<font color=#447700>! all 16 can remain and run efficiently on the GPU.  <a name='5488'></font>
<A NAME='GPU_RRTMG_LW_TAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='5489'>
      <font color=#993300>module </font><font color=#cc0000>gpu_rrtmg_lw_taumol</font> <A href='../../call_to/GPU_RRTMG_LW_TAUMOL.html' TARGET='index'>2</A>,<A href='../../call_from/GPU_RRTMG_LW_TAUMOL.html' TARGET='index'>7</A><a name='5490'>
<a name='5491'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='5492'></font>
<font color=#447700>! |                                                                          |<a name='5493'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='5494'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='5495'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='5496'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='5497'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='5498'></font>
<font color=#447700>! |                                                                          |<a name='5499'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='5500'></font>
<a name='5501'>
<font color=#447700>! ------- Modules -------<a name='5502'></font>
<a name='5503'>
<font color=#447700>!      use parkind, only : im =&gt; kind , rb =&gt; kind  <a name='5504'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_5">, only : mg, nbndlw, maxxsec, ngptlw<a name='5505'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_3">, only: oneminus<a name='5506'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_2">, only: nspa, nspb<a name='5507'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_3">, only: hvrtau, hnamtau<a name='5508'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_3">, only: ngb<a name='5509'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_1"><a name='5510'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MEMORY'>memory</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEMORY_17"><a name='5511'>
 <a name='5512'>
#ifdef _ACCEL<a name='5513'>
      use cudafor<a name='5514'>
#endif<a name='5515'>
<a name='5516'>
      implicit none<a name='5517'>
<a name='5518'>
#ifdef _ACCEL<a name='5519'>
<font color=#447700>! (dmb 2012) There are a lot of GPU module level variables in this module<a name='5520'></font>
<font color=#447700>! The parameter list for the taumol subroutines have been reduced for <a name='5521'></font>
<font color=#447700>! efficiency and readability.<a name='5522'></font>
<font color=#447700>! (jm 2014) not thread-safe<a name='5523'></font>
      real  _gpudev, allocatable :: pavel(:,:)<a name='5524'>
      real  _gpudev, allocatable :: wx1(:,:)<a name='5525'>
      real  _gpudev, allocatable :: wx2(:,:)<a name='5526'>
      real  _gpudev, allocatable :: wx3(:,:)<a name='5527'>
      real  _gpudev, allocatable :: wx4(:,:)<a name='5528'>
      real  _gpudev, allocatable :: coldry(:,:)<a name='5529'>
      integer  _gpudev, allocatable :: laytrop(:)<a name='5530'>
      integer  _gpudev, allocatable :: jp(:,:)<a name='5531'>
      integer  _gpudev, allocatable :: jt(:,:)<a name='5532'>
      integer  _gpudev, allocatable :: jt1(:,:)<a name='5533'>
      real  _gpudev, allocatable :: colh2o(:,:)<a name='5534'>
      real  _gpudev, allocatable :: colco2(:,:)<a name='5535'>
      real  _gpudev, allocatable :: colo3(:,:)<a name='5536'>
      real  _gpudev, allocatable :: coln2o(:,:)<a name='5537'>
      real  _gpudev, allocatable :: colco(:,:)<a name='5538'>
      real  _gpudev, allocatable :: colch4(:,:)<a name='5539'>
      real  _gpudev, allocatable :: colo2(:,:)<a name='5540'>
      real  _gpudev, allocatable :: colbrd(:,:)<a name='5541'>
      integer  _gpudev, allocatable :: indself(:,:)<a name='5542'>
      integer  _gpudev, allocatable :: indfor(:,:)<a name='5543'>
      real  _gpudev, allocatable :: selffac(:,:)<a name='5544'>
      real  _gpudev, allocatable :: selffrac(:,:)<a name='5545'>
      real  _gpudev, allocatable :: forfac(:,:)<a name='5546'>
      real  _gpudev, allocatable :: forfrac(:,:)<a name='5547'>
      integer  _gpudev, allocatable :: indminor(:,:)<a name='5548'>
      real  _gpudev, allocatable :: minorfrac(:,:)<a name='5549'>
      real  _gpudev, allocatable :: scaleminor(:,:)<a name='5550'>
      real  _gpudev, allocatable :: scaleminorn2(:,:)<a name='5551'>
      real  _gpudev, allocatable :: fac00(:,:), fac01(:,:), fac10(:,:), fac11(:,:)<a name='5552'>
      real  _gpudev, allocatable :: rat_h2oco2(:,:),rat_h2oco2_1(:,:), &amp;<a name='5553'>
                                            rat_h2oo3(:,:),rat_h2oo3_1(:,:), &amp;<a name='5554'>
                                            rat_h2on2o(:,:),rat_h2on2o_1(:,:), &amp;<a name='5555'>
                                            rat_h2och4(:,:),rat_h2och4_1(:,:), &amp;<a name='5556'>
                                            rat_n2oco2(:,:),rat_n2oco2_1(:,:), &amp;<a name='5557'>
                                            rat_o3co2(:,:),rat_o3co2_1(:,:)<a name='5558'>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='5559'></font>
      real  _gpudev, allocatable :: tauaa(:,:,:)<a name='5560'>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers,ngptlw)<a name='5561'></font>
     <a name='5562'>
      integer  _gpudev, allocatable :: nspad(:)<a name='5563'>
      integer  _gpudev, allocatable :: nspbd(:)<a name='5564'>
      real  _gpucon :: oneminusd <a name='5565'>
<font color=#447700>!$OMP THREADPRIVATE( pavel,wx1,wx2,wx3,wx4,coldry,laytrop,jp,jt,jt1,colh2o,colco2,colo3,coln2o, &amp;<a name='5566'></font>
<font color=#447700>!$OMP                colco,colch4,colo2,colbrd,indself,indfor,selffac,selffrac,forfac,forfrac,  &amp;<a name='5567'></font>
<font color=#447700>!$OMP                indminor,minorfrac,scaleminor,scaleminorn2,fac00,fac01,fac10,fac11,        &amp;<a name='5568'></font>
<font color=#447700>!$OMP                rat_h2oco2,rat_h2oco2_1,rat_h2oo3,rat_h2oo3_1,rat_h2on2o,rat_h2on2o_1,     &amp;<a name='5569'></font>
<font color=#447700>!$OMP                rat_h2och4,rat_h2och4_1,rat_n2oco2,rat_n2oco2_1,rat_o3co2,rat_o3co2_1,     &amp;<a name='5570'></font>
<font color=#447700>!$OMP                tauaa,nspad,nspbd,oneminusd )<a name='5571'></font>
#endif<a name='5572'>
<a name='5573'>
      contains<a name='5574'>
<a name='5575'>
#ifndef _ACCEL<a name='5576'>
<font color=#447700>!defines for taugb functions<a name='5577'></font>
<a name='5578'>
# define absad absa<a name='5579'>
# define absbd absb<a name='5580'>
# define absbod absbo<a name='5581'>
# define ccl4d ccl4<a name='5582'>
# define ccl4od ccl4o<a name='5583'>
# define cfc11adjd cfc11adj<a name='5584'>
# define cfc11adjod cfc11adjo<a name='5585'>
# define cfc12d cfc12<a name='5586'>
# define cfc12od cfc12o<a name='5587'>
# define cfc22adjd cfc22adj<a name='5588'>
# define cfc22adjod cfc22adjo<a name='5589'>
# define forrefd forref<a name='5590'>
# define forrefod forrefo<a name='5591'>
# define fracrefad fracrefa<a name='5592'>
# define fracrefaod fracrefao<a name='5593'>
# define fracrefbd fracrefb<a name='5594'>
# define fracrefbod fracrefbo<a name='5595'>
# define kad ka<a name='5596'>
# define ka_mcod ka_mco<a name='5597'>
# define ka_mco2d ka_mco2<a name='5598'>
# define ka_mn2d ka_mn2<a name='5599'>
# define ka_mn2od ka_mn2o<a name='5600'>
# define ka_mo2d ka_mo2<a name='5601'>
# define ka_mo3d ka_mo3<a name='5602'>
# define kaod kao<a name='5603'>
# define kao_mcod kao_mco<a name='5604'>
# define kao_mco2d kao_mco2<a name='5605'>
# define kao_mn2d kao_mn2<a name='5606'>
# define kao_mn2od kao_mn2o<a name='5607'>
# define kao_mo3d kao_mo3<a name='5608'>
# define kbd kb<a name='5609'>
# define kb_mco2d kb_mco2<a name='5610'>
# define kb_mn2d kb_mn2<a name='5611'>
# define kb_mn2od kb_mn2o<a name='5612'>
# define kb_mo2d kb_mo2<a name='5613'>
# define kb_mo3d kb_mo3<a name='5614'>
# define kbod kbo<a name='5615'>
# define kbo_mco2d kbo_mco2<a name='5616'>
# define kbo_mn2od kbo_mn2o<a name='5617'>
# define kbo_mo3d kbo_mo3<a name='5618'>
# define selfrefd selfref<a name='5619'>
# define selfrefod selfrefo<a name='5620'>
<a name='5621'>
#endif<a name='5622'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5623'></font>
<A NAME='TAUGB1G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB1G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5624'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb1g</font>( ncol, nlayers, taug, fracsd  &amp;,<A href='../../call_from/TAUGB1G.html' TARGET='index'>1</A><a name='5625'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_5"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB1G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5626'>
                                )<a name='5627'>
<a name='5628'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5629'></font>
<a name='5630'>
<font color=#447700>! ------- Modifications -------<a name='5631'></font>
<font color=#447700>!  Written by Eli J. Mlawer, Atmospheric &amp; Environmental Research.<a name='5632'></font>
<font color=#447700>!  Revised by Michael J. Iacono, Atmospheric &amp; Environmental Research.<a name='5633'></font>
<font color=#447700>!<a name='5634'></font>
<font color=#447700>!     band 1:  10-350 cm-1 (low key - h2o; low minor - n2)<a name='5635'></font>
<font color=#447700>!                          (high key - h2o; high minor - n2)<a name='5636'></font>
<font color=#447700>!<a name='5637'></font>
<font color=#447700>!     note: previous versions of rrtm band 1: <a name='5638'></font>
<font color=#447700>!           10-250 cm-1 (low - h2o; high - h2o)<a name='5639'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5640'></font>
<a name='5641'>
<font color=#447700>! ------- Modules -------<a name='5642'></font>
<a name='5643'>
<font color=#447700>!      use parrrtm_f, only : ng1<a name='5644'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F'>rrlw_kg01_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB1G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_F_1"><a name='5645'>
<a name='5646'>
<font color=#447700>! ------- Declarations -------<a name='5647'></font>
<a name='5648'>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='5649'>
      real  :: pp, corradj, scalen2, tauself, taufor, taun2<a name='5650'>
      integer , value, intent(in) :: ncol, nlayers<a name='5651'>
      real  _gpudev :: taug(:,:,:)<a name='5652'>
      real  _gpudev :: fracsd(:,:,:)<a name='5653'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_6"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB1G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5654'>
<a name='5655'>
<font color=#447700>! Local <a name='5656'></font>
      integer  :: iplon<a name='5657'>
<a name='5658'>
#ifdef _ACCEL<a name='5659'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='5660'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='5661'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='5662'>
#else<a name='5663'>
      do iplon = 1, ncol<a name='5664'>
      do lay = 1, nlayers<a name='5665'>
#endif<a name='5666'>
<a name='5667'>
<font color=#447700>! Minor gas mapping levels:<a name='5668'></font>
<font color=#447700>!     lower - n2, p = 142.5490 mbar, t = 215.70 k<a name='5669'></font>
<font color=#447700>!     upper - n2, p = 142.5490 mbar, t = 215.70 k<a name='5670'></font>
<a name='5671'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5672'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='5673'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='5674'></font>
<a name='5675'>
<font color=#447700>! Lower atmosphere loop<a name='5676'></font>
<a name='5677'>
<a name='5678'>
       if (lay &lt;= laytrop(iplon)) then<a name='5679'>
<a name='5680'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(1) + 1<a name='5681'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(1) + 1<a name='5682'>
         inds = indself(iplon,lay)<a name='5683'>
         indf = indfor(iplon,lay)<a name='5684'>
         indm = indminor(iplon,lay)<a name='5685'>
         pp = pavel(iplon, lay)<a name='5686'>
         corradj =  1.<a name='5687'>
         if (pp .lt. 250. ) then<a name='5688'>
            corradj = 1.  - 0.15  * (250. -pp) / 154.4 <a name='5689'>
         endif<a name='5690'>
<a name='5691'>
         scalen2 = colbrd(iplon,lay) * scaleminorn2(iplon,lay)<a name='5692'>
         do ig = 1, ng1<a name='5693'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='5694'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='5695'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='5696'>
                 (forrefd(indf+1,ig) -  forrefd(indf,ig))) <a name='5697'>
            taun2 = scalen2*(ka_mn2d(indm,ig) + &amp; <a name='5698'>
                 minorfrac(iplon,lay) * (ka_mn2d(indm+1,ig) - ka_mn2d(indm,ig)))<a name='5699'>
            taug(iplon,lay,ig) = corradj * (colh2o(iplon,lay) * &amp;<a name='5700'>
                (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='5701'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='5702'>
                 fac01(iplon,lay) * absad(ind1,ig) + &amp;<a name='5703'>
                 fac11(iplon,lay) * absad(ind1+1,ig)) &amp; <a name='5704'>
                 + tauself + taufor + taun2)<a name='5705'>
             fracsd(iplon,lay,ig) = fracrefad(ig)<a name='5706'>
            <a name='5707'>
         enddo<a name='5708'>
      else<a name='5709'>
<a name='5710'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(1) + 1<a name='5711'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(1) + 1<a name='5712'>
         indf = indfor(iplon,lay)<a name='5713'>
         indm = indminor(iplon,lay)<a name='5714'>
         pp = pavel(iplon, lay)<a name='5715'>
         corradj =  1.  - 0.15  * (pp / 95.6 )<a name='5716'>
<a name='5717'>
         scalen2 = colbrd(iplon,lay) * scaleminorn2(iplon,lay)<a name='5718'>
         do ig = 1, ng1<a name='5719'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + &amp;<a name='5720'>
                 forfrac(iplon,lay) * (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='5721'>
            taun2 = scalen2*(kb_mn2d(indm,ig) + &amp; <a name='5722'>
                 minorfrac(iplon,lay) * (kb_mn2d(indm+1,ig) - kb_mn2d(indm,ig)))<a name='5723'>
            taug(iplon,lay,ig) = corradj * (colh2o(iplon,lay) * &amp;<a name='5724'>
                (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='5725'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='5726'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='5727'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;  <a name='5728'>
                 + taufor + taun2)<a name='5729'>
            fracsd(iplon,lay,ig) = fracrefbd(ig)<a name='5730'>
         enddo<a name='5731'>
      endif<a name='5732'>
<a name='5733'>
#ifdef _ACCEL<a name='5734'>
      endif<a name='5735'>
#else<a name='5736'>
      end do<a name='5737'>
      end do<a name='5738'>
#endif<a name='5739'>
<a name='5740'>
      end subroutine taugb1g<a name='5741'>
<a name='5742'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5743'></font>
<A NAME='TAUGB2G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB2G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5744'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb2g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB2G.html' TARGET='index'>2</A><a name='5745'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_7"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB2G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5746'>
                                )<a name='5747'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5748'></font>
<font color=#447700>!<a name='5749'></font>
<font color=#447700>!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)<a name='5750'></font>
<font color=#447700>!<a name='5751'></font>
<font color=#447700>!     note: previous version of rrtm band 2: <a name='5752'></font>
<font color=#447700>!           250 - 500 cm-1 (low - h2o; high - h2o)<a name='5753'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5754'></font>
<a name='5755'>
<font color=#447700>! ------- Modules -------<a name='5756'></font>
<a name='5757'>
<font color=#447700>!      use parrrtm_f, only : ng2, ngs1<a name='5758'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB2G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_6">, only : ngs1<a name='5759'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F'>rrlw_kg02_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB2G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_F_1"><a name='5760'>
<a name='5761'>
<font color=#447700>! ------- Declarations -------<a name='5762'></font>
      real  _gpudev :: taug(:,:,:)<a name='5763'>
      real  _gpudev :: fracsd(:,:,:)<a name='5764'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_8"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB2G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5765'>
     <a name='5766'>
<font color=#447700>! Local <a name='5767'></font>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='5768'>
      real  :: pp, corradj, tauself, taufor<a name='5769'>
      integer , value, intent(in) :: ncol, nlayers<a name='5770'>
      integer  :: iplon<a name='5771'>
<a name='5772'>
#ifdef _ACCEL<a name='5773'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='5774'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='5775'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='5776'>
#else<a name='5777'>
      do iplon = 1, ncol<a name='5778'>
      do lay = 1, nlayers<a name='5779'>
#endif<a name='5780'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5781'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='5782'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='5783'></font>
<a name='5784'>
<font color=#447700>! Lower atmosphere loop<a name='5785'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='5786'>
<a name='5787'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(2) + 1<a name='5788'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(2) + 1<a name='5789'>
         inds = indself(iplon,lay)<a name='5790'>
         indf = indfor(iplon,lay)<a name='5791'>
         pp = pavel(iplon, lay)<a name='5792'>
         corradj = 1.  - .05  * (pp - 100. ) / 900. <a name='5793'>
         do ig = 1, ng2<a name='5794'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='5795'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='5796'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='5797'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='5798'>
            taug(iplon,lay,ngs1+ig) = corradj * (colh2o(iplon,lay) * &amp;<a name='5799'>
                (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='5800'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='5801'>
                 fac01(iplon,lay) * absad(ind1,ig) + &amp;<a name='5802'>
                 fac11(iplon,lay) * absad(ind1+1,ig)) &amp;<a name='5803'>
                 + tauself + taufor)<a name='5804'>
            fracsd(iplon,lay,ngs1+ig) = fracrefad(ig)<a name='5805'>
         enddo<a name='5806'>
      else<a name='5807'>
<a name='5808'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(2) + 1<a name='5809'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(2) + 1<a name='5810'>
         indf = indfor(iplon,lay)<a name='5811'>
         do ig = 1, ng2<a name='5812'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + &amp;<a name='5813'>
                 forfrac(iplon,lay) * (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='5814'>
            taug(iplon,lay,ngs1+ig) = colh2o(iplon,lay) * &amp;<a name='5815'>
                (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='5816'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='5817'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='5818'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;<a name='5819'>
                 + taufor<a name='5820'>
            fracsd(iplon,lay,ngs1+ig) = fracrefbd(ig)<a name='5821'>
         enddo<a name='5822'>
      endif<a name='5823'>
      <a name='5824'>
#ifdef _ACCEL<a name='5825'>
      endif<a name='5826'>
#else<a name='5827'>
      end do<a name='5828'>
      end do<a name='5829'>
#endif<a name='5830'>
<a name='5831'>
      end subroutine taugb2g<a name='5832'>
<a name='5833'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5834'></font>
<A NAME='TAUGB3G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5835'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb3g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB3G.html' TARGET='index'>3</A><a name='5836'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_9"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5837'>
                                )<a name='5838'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5839'></font>
<font color=#447700>!<a name='5840'></font>
<font color=#447700>!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)<a name='5841'></font>
<font color=#447700>!                           (high key - h2o,co2; high minor - n2o)<a name='5842'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5843'></font>
<a name='5844'>
<font color=#447700>! ------- Modules -------<a name='5845'></font>
<a name='5846'>
<font color=#447700>!      use parrrtm_f, only : ng3, ngs2<a name='5847'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_7">, only : ngs2<a name='5848'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_2">, only : chi_mlsd<a name='5849'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F'>rrlw_kg03_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_F_1"><a name='5850'>
<a name='5851'>
<font color=#447700>! ------- Declarations -------<a name='5852'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_10"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB3G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='5853'>
<a name='5854'>
<font color=#447700>! Local <a name='5855'></font>
      real  _gpudev :: taug(:,:,:)<a name='5856'>
      real  _gpudev :: fracsd(:,:,:)<a name='5857'>
     <a name='5858'>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='5859'>
      integer  :: js, js1, jmn2o, jpl<a name='5860'>
      real  :: speccomb, specparm, specmult, fs<a name='5861'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='5862'>
      real  :: speccomb_mn2o, specparm_mn2o, specmult_mn2o, &amp;<a name='5863'>
                       fmn2o, fmn2omf, chi_n2o, ratn2o, adjfac, adjcoln2o<a name='5864'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='5865'>
      real  :: p, p4, fk0, fk1, fk2<a name='5866'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='5867'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='5868'>
      real  :: tauself, taufor, n2om1, n2om2, absn2o<a name='5869'>
      real  :: refrat_planck_a, refrat_planck_b, refrat_m_a, refrat_m_b<a name='5870'>
      real  :: tau_major, tau_major1<a name='5871'>
      integer , value, intent(in) :: ncol, nlayers<a name='5872'>
      integer  :: iplon<a name='5873'>
<a name='5874'>
#ifdef _ACCEL<a name='5875'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='5876'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='5877'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='5878'>
#else<a name='5879'>
      do iplon = 1, ncol<a name='5880'>
      do lay = 1, nlayers<a name='5881'>
#endif<a name='5882'>
<font color=#447700>! Minor gas mapping levels:<a name='5883'></font>
<font color=#447700>!     lower - n2o, p = 706.272 mbar, t = 278.94 k<a name='5884'></font>
<font color=#447700>!     upper - n2o, p = 95.58 mbar, t = 215.7 k<a name='5885'></font>
<a name='5886'>
<font color=#447700>!  P = 212.725 mb<a name='5887'></font>
      refrat_planck_a = chi_mlsd(1,9)/chi_mlsd(2,9)<a name='5888'>
<a name='5889'>
<font color=#447700>!  P = 95.58 mb<a name='5890'></font>
      refrat_planck_b = chi_mlsd(1,13)/chi_mlsd(2,13)<a name='5891'>
<a name='5892'>
<font color=#447700>!  P = 706.270mb<a name='5893'></font>
      refrat_m_a = chi_mlsd(1,3)/chi_mlsd(2,3)<a name='5894'>
<a name='5895'>
<font color=#447700>!  P = 95.58 mb <a name='5896'></font>
      refrat_m_b = chi_mlsd(1,13)/chi_mlsd(2,13)<a name='5897'>
<a name='5898'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5899'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water vapor <a name='5900'></font>
<font color=#447700>! self-continuum and foreign continuum is interpolated (in temperature) <a name='5901'></font>
<font color=#447700>! separately.<a name='5902'></font>
<a name='5903'>
<font color=#447700>! Lower atmosphere loop<a name='5904'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='5905'>
<a name='5906'>
         speccomb = colh2o(iplon,lay) + rat_h2oco2(iplon,lay)*colco2(iplon,lay)<a name='5907'>
         specparm = colh2o(iplon,lay)/speccomb<a name='5908'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='5909'>
         specmult = 8. *(specparm)<a name='5910'>
         js = 1 + int(specmult)<a name='5911'>
         fs = mod(specmult,1.0 )        <a name='5912'>
<a name='5913'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='5914'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='5915'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='5916'>
         specmult1 = 8. *(specparm1)<a name='5917'>
         js1 = 1 + int(specmult1)<a name='5918'>
         fs1 = mod(specmult1,1.0 )<a name='5919'>
<a name='5920'>
         speccomb_mn2o = colh2o(iplon,lay) + refrat_m_a*colco2(iplon,lay)<a name='5921'>
         specparm_mn2o = colh2o(iplon,lay)/speccomb_mn2o<a name='5922'>
         if (specparm_mn2o .ge. oneminusd) specparm_mn2o = oneminusd<a name='5923'>
         specmult_mn2o = 8. *specparm_mn2o<a name='5924'>
         jmn2o = 1 + int(specmult_mn2o)<a name='5925'>
         fmn2o = mod(specmult_mn2o,1.0 )<a name='5926'>
         fmn2omf = minorfrac(iplon,lay)*fmn2o<a name='5927'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='5928'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='5929'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='5930'></font>
         chi_n2o = coln2o(iplon,lay)/coldry(iplon,lay)<a name='5931'>
         ratn2o = 1.e20 *chi_n2o/chi_mlsd(4,jp(iplon,lay)+1)<a name='5932'>
         if (ratn2o .gt. 1.5 ) then<a name='5933'>
            adjfac = 0.5 +(ratn2o-0.5 )**0.65 <a name='5934'>
            adjcoln2o = adjfac*chi_mlsd(4,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='5935'>
         else<a name='5936'>
            adjcoln2o = coln2o(iplon,lay)<a name='5937'>
         endif<a name='5938'>
<a name='5939'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colco2(iplon,lay)<a name='5940'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='5941'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='5942'>
         specmult_planck = 8. *specparm_planck<a name='5943'>
         jpl= 1 + int(specmult_planck)<a name='5944'>
         fpl = mod(specmult_planck,1.0 )<a name='5945'>
<a name='5946'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(3) + js<a name='5947'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(3) + js1<a name='5948'>
         inds = indself(iplon,lay)<a name='5949'>
         indf = indfor(iplon,lay)<a name='5950'>
         indm = indminor(iplon,lay)<a name='5951'>
<a name='5952'>
         if (specparm .lt. 0.125 ) then<a name='5953'>
            p = fs - 1<a name='5954'>
            p4 = p**4<a name='5955'>
            fk0 = p4<a name='5956'>
            fk1 = 1 - p - 2.0 *p4<a name='5957'>
            fk2 = p + p4<a name='5958'>
            fac000 = fk0*fac00(iplon,lay)<a name='5959'>
            fac100 = fk1*fac00(iplon,lay)<a name='5960'>
            fac200 = fk2*fac00(iplon,lay)<a name='5961'>
            fac010 = fk0*fac10(iplon,lay)<a name='5962'>
            fac110 = fk1*fac10(iplon,lay)<a name='5963'>
            fac210 = fk2*fac10(iplon,lay)<a name='5964'>
         else if (specparm .gt. 0.875 ) then<a name='5965'>
            p = -fs <a name='5966'>
            p4 = p**4<a name='5967'>
            fk0 = p4<a name='5968'>
            fk1 = 1 - p - 2.0 *p4<a name='5969'>
            fk2 = p + p4<a name='5970'>
            fac000 = fk0*fac00(iplon,lay)<a name='5971'>
            fac100 = fk1*fac00(iplon,lay)<a name='5972'>
            fac200 = fk2*fac00(iplon,lay)<a name='5973'>
            fac010 = fk0*fac10(iplon,lay)<a name='5974'>
            fac110 = fk1*fac10(iplon,lay)<a name='5975'>
            fac210 = fk2*fac10(iplon,lay)<a name='5976'>
         else<a name='5977'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='5978'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='5979'>
            fac100 = fs * fac00(iplon,lay)<a name='5980'>
            fac110 = fs * fac10(iplon,lay)<a name='5981'>
         endif<a name='5982'>
         if (specparm1 .lt. 0.125 ) then<a name='5983'>
            p = fs1 - 1<a name='5984'>
            p4 = p**4<a name='5985'>
            fk0 = p4<a name='5986'>
            fk1 = 1 - p - 2.0 *p4<a name='5987'>
            fk2 = p + p4<a name='5988'>
            fac001 = fk0*fac01(iplon,lay)<a name='5989'>
            fac101 = fk1*fac01(iplon,lay)<a name='5990'>
            fac201 = fk2*fac01(iplon,lay)<a name='5991'>
            fac011 = fk0*fac11(iplon,lay)<a name='5992'>
            fac111 = fk1*fac11(iplon,lay)<a name='5993'>
            fac211 = fk2*fac11(iplon,lay)<a name='5994'>
         else if (specparm1 .gt. 0.875 ) then<a name='5995'>
            p = -fs1 <a name='5996'>
            p4 = p**4<a name='5997'>
            fk0 = p4<a name='5998'>
            fk1 = 1 - p - 2.0 *p4<a name='5999'>
            fk2 = p + p4<a name='6000'>
            fac001 = fk0*fac01(iplon,lay)<a name='6001'>
            fac101 = fk1*fac01(iplon,lay)<a name='6002'>
            fac201 = fk2*fac01(iplon,lay)<a name='6003'>
            fac011 = fk0*fac11(iplon,lay)<a name='6004'>
            fac111 = fk1*fac11(iplon,lay)<a name='6005'>
            fac211 = fk2*fac11(iplon,lay)<a name='6006'>
         else<a name='6007'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6008'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6009'>
            fac101 = fs1 * fac01(iplon,lay)<a name='6010'>
            fac111 = fs1 * fac11(iplon,lay)<a name='6011'>
         endif<a name='6012'>
<a name='6013'>
         do ig = 1, ng3<a name='6014'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='6015'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='6016'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='6017'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='6018'>
            n2om1 = ka_mn2od(jmn2o,indm,ig) + fmn2o * &amp;<a name='6019'>
                 (ka_mn2od(jmn2o+1,indm,ig) - ka_mn2od(jmn2o,indm,ig))<a name='6020'>
            n2om2 = ka_mn2od(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='6021'>
                 (ka_mn2od(jmn2o+1,indm+1,ig) - ka_mn2od(jmn2o,indm+1,ig))<a name='6022'>
            absn2o = n2om1 + minorfrac(iplon,lay) * (n2om2 - n2om1)<a name='6023'>
<a name='6024'>
            if (specparm .lt. 0.125 ) then<a name='6025'>
               tau_major = speccomb * &amp;<a name='6026'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6027'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6028'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='6029'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6030'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='6031'>
                    fac210 * absad(ind0+11,ig))<a name='6032'>
            else if (specparm .gt. 0.875 ) then<a name='6033'>
               tau_major = speccomb * &amp;<a name='6034'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='6035'>
                    fac100 * absad(ind0,ig) + &amp;<a name='6036'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='6037'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='6038'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='6039'>
                    fac010 * absad(ind0+10,ig))<a name='6040'>
            else<a name='6041'>
               tau_major = speccomb * &amp;<a name='6042'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6043'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6044'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6045'>
                    fac110 * absad(ind0+10,ig))<a name='6046'>
            endif<a name='6047'>
<a name='6048'>
            if (specparm1 .lt. 0.125 ) then<a name='6049'>
               tau_major1 = speccomb1 * &amp;<a name='6050'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='6051'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6052'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='6053'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6054'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='6055'>
                    fac211 * absad(ind1+11,ig))<a name='6056'>
            else if (specparm1 .gt. 0.875 ) then<a name='6057'>
               tau_major1 = speccomb1 * &amp;<a name='6058'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='6059'>
                    fac101 * absad(ind1,ig) + &amp;<a name='6060'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='6061'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='6062'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='6063'>
                    fac011 * absad(ind1+10,ig))<a name='6064'>
            else<a name='6065'>
               tau_major1 = speccomb1 * &amp;<a name='6066'>
                    (fac001 * absad(ind1,ig) +  &amp;<a name='6067'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6068'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6069'>
                    fac111 * absad(ind1+10,ig))<a name='6070'>
            endif<a name='6071'>
<a name='6072'>
            taug(iplon,lay,ngs2+ig) = tau_major + tau_major1 &amp;<a name='6073'>
                 + tauself + taufor &amp;<a name='6074'>
                 + adjcoln2o*absn2o<a name='6075'>
            fracsd(iplon,lay,ngs2+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='6076'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='6077'>
         enddo<a name='6078'>
    <a name='6079'>
<a name='6080'>
<font color=#447700>! Upper atmosphere loop<a name='6081'></font>
      else<a name='6082'>
<a name='6083'>
         speccomb = colh2o(iplon,lay) + rat_h2oco2(iplon,lay)*colco2(iplon,lay)<a name='6084'>
         specparm = colh2o(iplon,lay)/speccomb<a name='6085'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6086'>
         specmult = 4. *(specparm)<a name='6087'>
         js = 1 + int(specmult)<a name='6088'>
         fs = mod(specmult,1.0 )<a name='6089'>
<a name='6090'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='6091'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='6092'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6093'>
         specmult1 = 4. *(specparm1)<a name='6094'>
         js1 = 1 + int(specmult1)<a name='6095'>
         fs1 = mod(specmult1,1.0 )<a name='6096'>
<a name='6097'>
         fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6098'>
         fac010 = (1.  - fs) * fac10(iplon,lay)<a name='6099'>
         fac100 = fs * fac00(iplon,lay)<a name='6100'>
         fac110 = fs * fac10(iplon,lay)<a name='6101'>
         fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6102'>
         fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6103'>
         fac101 = fs1 * fac01(iplon,lay)<a name='6104'>
         fac111 = fs1 * fac11(iplon,lay)<a name='6105'>
<a name='6106'>
         speccomb_mn2o = colh2o(iplon,lay) + refrat_m_b*colco2(iplon,lay)<a name='6107'>
         specparm_mn2o = colh2o(iplon,lay)/speccomb_mn2o<a name='6108'>
         if (specparm_mn2o .ge. oneminusd) specparm_mn2o = oneminusd<a name='6109'>
         specmult_mn2o = 4. *specparm_mn2o<a name='6110'>
         jmn2o = 1 + int(specmult_mn2o)<a name='6111'>
         fmn2o = mod(specmult_mn2o,1.0 )<a name='6112'>
         fmn2omf = minorfrac(iplon,lay)*fmn2o<a name='6113'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='6114'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='6115'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6116'></font>
         chi_n2o = coln2o(iplon,lay)/coldry(iplon,lay)<a name='6117'>
         ratn2o = 1.e20*chi_n2o/chi_mlsd(4,jp(iplon,lay)+1)<a name='6118'>
         if (ratn2o .gt. 1.5 ) then<a name='6119'>
            adjfac = 0.5 +(ratn2o-0.5 )**0.65 <a name='6120'>
            adjcoln2o = adjfac*chi_mlsd(4,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='6121'>
         else<a name='6122'>
            adjcoln2o = coln2o(iplon,lay)<a name='6123'>
         endif<a name='6124'>
<a name='6125'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_b*colco2(iplon,lay)<a name='6126'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='6127'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6128'>
         specmult_planck = 4. *specparm_planck<a name='6129'>
         jpl= 1 + int(specmult_planck)<a name='6130'>
         fpl = mod(specmult_planck,1.0 )<a name='6131'>
<a name='6132'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(3) + js<a name='6133'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(3) + js1<a name='6134'>
         indf = indfor(iplon,lay)<a name='6135'>
         indm = indminor(iplon,lay)<a name='6136'>
<a name='6137'>
         do ig = 1, ng3<a name='6138'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + &amp;<a name='6139'>
                 forfrac(iplon,lay) * (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='6140'>
            n2om1 = kb_mn2od(jmn2o,indm,ig) + fmn2o * &amp;<a name='6141'>
                 (kb_mn2od(jmn2o+1,indm,ig)-kb_mn2od(jmn2o,indm,ig))<a name='6142'>
            n2om2 = kb_mn2od(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='6143'>
                 (kb_mn2od(jmn2o+1,indm+1,ig)-kb_mn2od(jmn2o,indm+1,ig))<a name='6144'>
            absn2o = n2om1 + minorfrac(iplon,lay) * (n2om2 - n2om1)<a name='6145'>
            taug(iplon,lay,ngs2+ig) = speccomb * &amp;<a name='6146'>
                (fac000 * absbd(ind0,ig) + &amp;<a name='6147'>
                fac100 * absbd(ind0+1,ig) + &amp;<a name='6148'>
                fac010 * absbd(ind0+5,ig) + &amp;<a name='6149'>
                fac110 * absbd(ind0+6,ig)) &amp;<a name='6150'>
                + speccomb1 * &amp;<a name='6151'>
                (fac001 * absbd(ind1,ig) +  &amp;<a name='6152'>
                fac101 * absbd(ind1+1,ig) + &amp;<a name='6153'>
                fac011 * absbd(ind1+5,ig) + &amp;<a name='6154'>
                fac111 * absbd(ind1+6,ig))  &amp;<a name='6155'>
                + taufor &amp;<a name='6156'>
                + adjcoln2o*absn2o<a name='6157'>
            fracsd(iplon,lay,ngs2+ig) = fracrefbd(ig,jpl) + fpl * &amp;<a name='6158'>
                (fracrefbd(ig,jpl+1)-fracrefbd(ig,jpl))<a name='6159'>
         enddo<a name='6160'>
      endif<a name='6161'>
<a name='6162'>
#ifdef _ACCEL<a name='6163'>
      endif<a name='6164'>
#else<a name='6165'>
      end do<a name='6166'>
      end do<a name='6167'>
#endif<a name='6168'>
<a name='6169'>
      end subroutine taugb3g<a name='6170'>
<a name='6171'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6172'></font>
<A NAME='TAUGB4G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6173'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb4g</font>( ncol, nlayers, taug, fracsd  &amp;,<A href='../../call_from/TAUGB4G.html' TARGET='index'>3</A><a name='6174'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_11"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6175'>
                                )<a name='6176'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6177'></font>
<font color=#447700>!<a name='6178'></font>
<font color=#447700>!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)<a name='6179'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6180'></font>
<a name='6181'>
<font color=#447700>! ------- Modules -------<a name='6182'></font>
<a name='6183'>
<font color=#447700>!      use parrrtm_f, only : ng4, ngs3<a name='6184'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_8">, only : ngs3<a name='6185'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_3">, only : chi_mlsd<a name='6186'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F'>rrlw_kg04_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_F_1"><a name='6187'>
<a name='6188'>
<font color=#447700>! ------- Declarations -------<a name='6189'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_12"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB4G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6190'>
<a name='6191'>
<font color=#447700>! Local <a name='6192'></font>
      real  _gpudev :: taug(:,:,:)<a name='6193'>
      real  _gpudev :: fracsd(:,:,:)<a name='6194'>
     <a name='6195'>
      <a name='6196'>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='6197'>
      integer  :: js, js1, jpl<a name='6198'>
      real  :: speccomb, specparm, specmult, fs<a name='6199'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='6200'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6201'>
      real  :: p, p4, fk0, fk1, fk2<a name='6202'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6203'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6204'>
      real  :: tauself, taufor<a name='6205'>
      real  :: refrat_planck_a, refrat_planck_b<a name='6206'>
      real  :: tau_major, tau_major1<a name='6207'>
      integer , value, intent(in) :: ncol, nlayers<a name='6208'>
      integer  :: iplon<a name='6209'>
<a name='6210'>
#ifdef _ACCEL<a name='6211'>
        iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='6212'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='6213'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='6214'>
#else<a name='6215'>
      do iplon = 1, ncol<a name='6216'>
      do lay = 1, nlayers<a name='6217'>
#endif <a name='6218'>
<font color=#447700>! P =   142.5940 mb<a name='6219'></font>
      refrat_planck_a = chi_mlsd(1,11)/chi_mlsd(2,11)<a name='6220'>
<a name='6221'>
<font color=#447700>! P = 95.58350 mb<a name='6222'></font>
      refrat_planck_b = chi_mlsd(3,13)/chi_mlsd(2,13)<a name='6223'>
<a name='6224'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='6225'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water <a name='6226'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated (in temperature) <a name='6227'></font>
<font color=#447700>! separately.<a name='6228'></font>
<a name='6229'>
<font color=#447700>! Lower atmosphere loop<a name='6230'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='6231'>
<a name='6232'>
         speccomb = colh2o(iplon,lay) + rat_h2oco2(iplon,lay)*colco2(iplon,lay)<a name='6233'>
         specparm = colh2o(iplon,lay)/speccomb<a name='6234'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6235'>
         specmult = 8. *(specparm)<a name='6236'>
         js = 1 + int(specmult)<a name='6237'>
         fs = mod(specmult,1.0 )<a name='6238'>
<a name='6239'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='6240'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='6241'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6242'>
         specmult1 = 8. *(specparm1)<a name='6243'>
         js1 = 1 + int(specmult1)<a name='6244'>
         fs1 = mod(specmult1,1.0 )<a name='6245'>
<a name='6246'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colco2(iplon,lay)<a name='6247'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='6248'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6249'>
         specmult_planck = 8. *specparm_planck<a name='6250'>
         jpl= 1 + int(specmult_planck)<a name='6251'>
         fpl = mod(specmult_planck,1.0 )<a name='6252'>
<a name='6253'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(4) + js<a name='6254'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(4) + js1<a name='6255'>
         inds = indself(iplon,lay)<a name='6256'>
         indf = indfor(iplon,lay)<a name='6257'>
<a name='6258'>
         if (specparm .lt. 0.125 ) then<a name='6259'>
            p = fs - 1<a name='6260'>
            p4 = p**4<a name='6261'>
            fk0 = p4<a name='6262'>
            fk1 = 1 - p - 2.0 *p4<a name='6263'>
            fk2 = p + p4<a name='6264'>
            fac000 = fk0*fac00(iplon,lay)<a name='6265'>
            fac100 = fk1*fac00(iplon,lay)<a name='6266'>
            fac200 = fk2*fac00(iplon,lay)<a name='6267'>
            fac010 = fk0*fac10(iplon,lay)<a name='6268'>
            fac110 = fk1*fac10(iplon,lay)<a name='6269'>
            fac210 = fk2*fac10(iplon,lay)<a name='6270'>
         else if (specparm .gt. 0.875 ) then<a name='6271'>
            p = -fs <a name='6272'>
            p4 = p**4<a name='6273'>
            fk0 = p4<a name='6274'>
            fk1 = 1 - p - 2.0 *p4<a name='6275'>
            fk2 = p + p4<a name='6276'>
            fac000 = fk0*fac00(iplon,lay)<a name='6277'>
            fac100 = fk1*fac00(iplon,lay)<a name='6278'>
            fac200 = fk2*fac00(iplon,lay)<a name='6279'>
            fac010 = fk0*fac10(iplon,lay)<a name='6280'>
            fac110 = fk1*fac10(iplon,lay)<a name='6281'>
            fac210 = fk2*fac10(iplon,lay)<a name='6282'>
         else<a name='6283'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6284'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='6285'>
            fac100 = fs * fac00(iplon,lay)<a name='6286'>
            fac110 = fs * fac10(iplon,lay)<a name='6287'>
         endif<a name='6288'>
<a name='6289'>
         if (specparm1 .lt. 0.125 ) then<a name='6290'>
            p = fs1 - 1<a name='6291'>
            p4 = p**4<a name='6292'>
            fk0 = p4<a name='6293'>
            fk1 = 1 - p - 2.0 *p4<a name='6294'>
            fk2 = p + p4<a name='6295'>
            fac001 = fk0*fac01(iplon,lay)<a name='6296'>
            fac101 = fk1*fac01(iplon,lay)<a name='6297'>
            fac201 = fk2*fac01(iplon,lay)<a name='6298'>
            fac011 = fk0*fac11(iplon,lay)<a name='6299'>
            fac111 = fk1*fac11(iplon,lay)<a name='6300'>
            fac211 = fk2*fac11(iplon,lay)<a name='6301'>
         else if (specparm1 .gt. 0.875 ) then<a name='6302'>
            p = -fs1 <a name='6303'>
            p4 = p**4<a name='6304'>
            fk0 = p4<a name='6305'>
            fk1 = 1 - p - 2.0 *p4<a name='6306'>
            fk2 = p + p4<a name='6307'>
            fac001 = fk0*fac01(iplon,lay)<a name='6308'>
            fac101 = fk1*fac01(iplon,lay)<a name='6309'>
            fac201 = fk2*fac01(iplon,lay)<a name='6310'>
            fac011 = fk0*fac11(iplon,lay)<a name='6311'>
            fac111 = fk1*fac11(iplon,lay)<a name='6312'>
            fac211 = fk2*fac11(iplon,lay)<a name='6313'>
         else<a name='6314'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6315'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6316'>
            fac101 = fs1 * fac01(iplon,lay)<a name='6317'>
            fac111 = fs1 * fac11(iplon,lay)<a name='6318'>
         endif<a name='6319'>
<a name='6320'>
         do ig = 1, ng4<a name='6321'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='6322'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='6323'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='6324'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='6325'>
<a name='6326'>
            if (specparm .lt. 0.125 ) then<a name='6327'>
               tau_major = speccomb * &amp;<a name='6328'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6329'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6330'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='6331'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6332'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='6333'>
                    fac210 * absad(ind0+11,ig))<a name='6334'>
            else if (specparm .gt. 0.875 ) then<a name='6335'>
               tau_major = speccomb * &amp;<a name='6336'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='6337'>
                    fac100 * absad(ind0,ig) + &amp;<a name='6338'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='6339'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='6340'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='6341'>
                    fac010 * absad(ind0+10,ig))<a name='6342'>
            else<a name='6343'>
               tau_major = speccomb * &amp;<a name='6344'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6345'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6346'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6347'>
                    fac110 * absad(ind0+10,ig))<a name='6348'>
            endif<a name='6349'>
<a name='6350'>
            if (specparm1 .lt. 0.125 ) then<a name='6351'>
               tau_major1 = speccomb1 * &amp;<a name='6352'>
                    (fac001 * absad(ind1,ig) +  &amp;<a name='6353'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6354'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='6355'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6356'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='6357'>
                    fac211 * absad(ind1+11,ig))<a name='6358'>
            else if (specparm1 .gt. 0.875 ) then<a name='6359'>
               tau_major1 = speccomb1 * &amp;<a name='6360'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='6361'>
                    fac101 * absad(ind1,ig) + &amp;<a name='6362'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='6363'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='6364'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='6365'>
                    fac011 * absad(ind1+10,ig))<a name='6366'>
            else<a name='6367'>
               tau_major1 = speccomb1 * &amp;<a name='6368'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='6369'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6370'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6371'>
                    fac111 * absad(ind1+10,ig))<a name='6372'>
            endif<a name='6373'>
<a name='6374'>
            taug(iplon,lay,ngs3+ig) = tau_major + tau_major1 &amp;<a name='6375'>
                 + tauself + taufor<a name='6376'>
            fracsd(iplon,lay,ngs3+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='6377'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='6378'>
         enddo<a name='6379'>
    <a name='6380'>
<a name='6381'>
<font color=#447700>! Upper atmosphere loop<a name='6382'></font>
      else<a name='6383'>
<a name='6384'>
         speccomb = colo3(iplon,lay) + rat_o3co2(iplon,lay)*colco2(iplon,lay)<a name='6385'>
         specparm = colo3(iplon,lay)/speccomb<a name='6386'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6387'>
         specmult = 4. *(specparm)<a name='6388'>
         js = 1 + int(specmult)<a name='6389'>
         fs = mod(specmult,1.0 )<a name='6390'>
<a name='6391'>
         speccomb1 = colo3(iplon,lay) + rat_o3co2_1(iplon,lay)*colco2(iplon,lay)<a name='6392'>
         specparm1 = colo3(iplon,lay)/speccomb1<a name='6393'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6394'>
         specmult1 = 4. *(specparm1)<a name='6395'>
         js1 = 1 + int(specmult1)<a name='6396'>
         fs1 = mod(specmult1,1.0 )<a name='6397'>
<a name='6398'>
         fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6399'>
         fac010 = (1.  - fs) * fac10(iplon,lay)<a name='6400'>
         fac100 = fs * fac00(iplon,lay)<a name='6401'>
         fac110 = fs * fac10(iplon,lay)<a name='6402'>
         fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6403'>
         fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6404'>
         fac101 = fs1 * fac01(iplon,lay)<a name='6405'>
         fac111 = fs1 * fac11(iplon,lay)<a name='6406'>
<a name='6407'>
         speccomb_planck = colo3(iplon,lay)+refrat_planck_b*colco2(iplon,lay)<a name='6408'>
         specparm_planck = colo3(iplon,lay)/speccomb_planck<a name='6409'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6410'>
         specmult_planck = 4. *specparm_planck<a name='6411'>
         jpl= 1 + int(specmult_planck)<a name='6412'>
         fpl = mod(specmult_planck,1.0 )<a name='6413'>
<a name='6414'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(4) + js<a name='6415'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(4) + js1<a name='6416'>
<a name='6417'>
         do ig = 1, ng4<a name='6418'>
            taug(iplon,lay,ngs3+ig) =  speccomb * &amp;<a name='6419'>
                (fac000 * absbd(ind0,ig) + &amp;<a name='6420'>
                fac100 * absbd(ind0+1,ig) + &amp;<a name='6421'>
                fac010 * absbd(ind0+5,ig) + &amp;<a name='6422'>
                fac110 * absbd(ind0+6,ig)) &amp;<a name='6423'>
                + speccomb1 * &amp;<a name='6424'>
                (fac001 * absbd(ind1,ig) +  &amp;<a name='6425'>
                fac101 * absbd(ind1+1,ig) + &amp;<a name='6426'>
                fac011 * absbd(ind1+5,ig) + &amp;<a name='6427'>
                fac111 * absbd(ind1+6,ig))<a name='6428'>
            fracsd(iplon,lay,ngs3+ig) = fracrefbd(ig,jpl) + fpl * &amp;<a name='6429'>
                (fracrefbd(ig,jpl+1)-fracrefbd(ig,jpl))<a name='6430'>
         enddo<a name='6431'>
<a name='6432'>
<font color=#447700>! Empirical modification to code to improve stratospheric cooling rates<a name='6433'></font>
<font color=#447700>! for co2.  Revised to apply weighting for g-point reduction in this band.<a name='6434'></font>
<a name='6435'>
         taug(iplon,lay,ngs3+8)=taug(iplon,lay,ngs3+8)*0.92<a name='6436'>
         taug(iplon,lay,ngs3+9)=taug(iplon,lay,ngs3+9)*0.88<a name='6437'>
         taug(iplon,lay,ngs3+10)=taug(iplon,lay,ngs3+10)*1.07<a name='6438'>
         taug(iplon,lay,ngs3+11)=taug(iplon,lay,ngs3+11)*1.1<a name='6439'>
         taug(iplon,lay,ngs3+12)=taug(iplon,lay,ngs3+12)*0.99<a name='6440'>
         taug(iplon,lay,ngs3+13)=taug(iplon,lay,ngs3+13)*0.88<a name='6441'>
         taug(iplon,lay,ngs3+14)=taug(iplon,lay,ngs3+14)*0.943<a name='6442'>
<a name='6443'>
      endif<a name='6444'>
<a name='6445'>
#ifdef _ACCEL<a name='6446'>
      endif<a name='6447'>
#else<a name='6448'>
      end do<a name='6449'>
      end do<a name='6450'>
#endif<a name='6451'>
<a name='6452'>
      end subroutine taugb4g<a name='6453'>
<a name='6454'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6455'></font>
<A NAME='TAUGB5G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6456'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb5g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB5G.html' TARGET='index'>3</A><a name='6457'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_13"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6458'>
                                )<a name='6459'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6460'></font>
<font color=#447700>!<a name='6461'></font>
<font color=#447700>!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)<a name='6462'></font>
<font color=#447700>!                           (high key - o3,co2)<a name='6463'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6464'></font>
<a name='6465'>
<font color=#447700>! ------- Modules -------<a name='6466'></font>
<a name='6467'>
<font color=#447700>!      use parrrtm_f, only : ng5, ngs4<a name='6468'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_9">, only : ngs4<a name='6469'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_4">, only : chi_mlsd<a name='6470'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F'>rrlw_kg05_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_F_1"><a name='6471'>
<a name='6472'>
<font color=#447700>! ------- Declarations -------<a name='6473'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_14"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB5G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6474'>
<a name='6475'>
<font color=#447700>! Local <a name='6476'></font>
      real  _gpudev :: taug(:,:,:)<a name='6477'>
      real  _gpudev :: fracsd(:,:,:)<a name='6478'>
     <a name='6479'>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='6480'>
      integer  :: js, js1, jmo3, jpl<a name='6481'>
      real  :: speccomb, specparm, specmult, fs<a name='6482'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='6483'>
      real  :: speccomb_mo3, specparm_mo3, specmult_mo3, fmo3<a name='6484'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6485'>
      real  :: p, p4, fk0, fk1, fk2<a name='6486'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6487'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6488'>
      real  :: tauself, taufor, o3m1, o3m2, abso3<a name='6489'>
      real  :: refrat_planck_a, refrat_planck_b, refrat_m_a<a name='6490'>
      real  :: tau_major, tau_major1<a name='6491'>
      integer , value, intent(in) :: ncol, nlayers<a name='6492'>
      integer  :: iplon<a name='6493'>
<a name='6494'>
#ifdef _ACCEL<a name='6495'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='6496'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='6497'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='6498'>
#else<a name='6499'>
      do iplon = 1, ncol<a name='6500'>
      do lay = 1, nlayers<a name='6501'>
#endif<a name='6502'>
<font color=#447700>! Minor gas mapping level :<a name='6503'></font>
<font color=#447700>!     lower - o3, p = 317.34 mbar, t = 240.77 k<a name='6504'></font>
<font color=#447700>!     lower - ccl4<a name='6505'></font>
<a name='6506'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='6507'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='6508'></font>
<a name='6509'>
<font color=#447700>! P = 473.420 mb<a name='6510'></font>
      refrat_planck_a = chi_mlsd(1,5)/chi_mlsd(2,5)<a name='6511'>
<a name='6512'>
<font color=#447700>! P = 0.2369 mb<a name='6513'></font>
      refrat_planck_b = chi_mlsd(3,43)/chi_mlsd(2,43)<a name='6514'>
<a name='6515'>
<font color=#447700>! P = 317.3480<a name='6516'></font>
      refrat_m_a = chi_mlsd(1,7)/chi_mlsd(2,7)<a name='6517'>
<a name='6518'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='6519'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the <a name='6520'></font>
<font color=#447700>! water vapor self-continuum and foreign continuum is <a name='6521'></font>
<font color=#447700>! interpolated (in temperature) separately.<a name='6522'></font>
<a name='6523'>
<font color=#447700>! Lower atmosphere loop<a name='6524'></font>
      <font color=#447700>!do lay = 1, laytrop(iplon)<a name='6525'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='6526'>
         speccomb = colh2o(iplon,lay) + rat_h2oco2(iplon,lay)*colco2(iplon,lay)<a name='6527'>
         specparm = colh2o(iplon,lay)/speccomb<a name='6528'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6529'>
         specmult = 8. *(specparm)<a name='6530'>
         js = 1 + int(specmult)<a name='6531'>
         fs = mod(specmult,1.0 )<a name='6532'>
<a name='6533'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='6534'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='6535'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6536'>
         specmult1 = 8. *(specparm1)<a name='6537'>
         js1 = 1 + int(specmult1)<a name='6538'>
         fs1 = mod(specmult1,1.0 )<a name='6539'>
<a name='6540'>
         speccomb_mo3 = colh2o(iplon,lay) + refrat_m_a*colco2(iplon,lay)<a name='6541'>
         specparm_mo3 = colh2o(iplon,lay)/speccomb_mo3<a name='6542'>
         if (specparm_mo3 .ge. oneminusd) specparm_mo3 = oneminusd<a name='6543'>
         specmult_mo3 = 8. *specparm_mo3<a name='6544'>
         jmo3 = 1 + int(specmult_mo3)<a name='6545'>
         fmo3 = mod(specmult_mo3,1.0 )<a name='6546'>
<a name='6547'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colco2(iplon,lay)<a name='6548'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='6549'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6550'>
         specmult_planck = 8. *specparm_planck<a name='6551'>
         jpl= 1 + int(specmult_planck)<a name='6552'>
         fpl = mod(specmult_planck,1.0 )<a name='6553'>
<a name='6554'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(5) + js<a name='6555'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(5) + js1<a name='6556'>
         inds = indself(iplon,lay)<a name='6557'>
         indf = indfor(iplon,lay)<a name='6558'>
         indm = indminor(iplon,lay)<a name='6559'>
<a name='6560'>
         if (specparm .lt. 0.125 ) then<a name='6561'>
            p = fs - 1<a name='6562'>
            p4 = p**4<a name='6563'>
            fk0 = p4<a name='6564'>
            fk1 = 1 - p - 2.0 *p4<a name='6565'>
            fk2 = p + p4<a name='6566'>
            fac000 = fk0*fac00(iplon,lay)<a name='6567'>
            fac100 = fk1*fac00(iplon,lay)<a name='6568'>
            fac200 = fk2*fac00(iplon,lay)<a name='6569'>
            fac010 = fk0*fac10(iplon,lay)<a name='6570'>
            fac110 = fk1*fac10(iplon,lay)<a name='6571'>
            fac210 = fk2*fac10(iplon,lay)<a name='6572'>
         else if (specparm .gt. 0.875 ) then<a name='6573'>
            p = -fs <a name='6574'>
            p4 = p**4<a name='6575'>
            fk0 = p4<a name='6576'>
            fk1 = 1 - p - 2.0 *p4<a name='6577'>
            fk2 = p + p4<a name='6578'>
            fac000 = fk0*fac00(iplon,lay)<a name='6579'>
            fac100 = fk1*fac00(iplon,lay)<a name='6580'>
            fac200 = fk2*fac00(iplon,lay)<a name='6581'>
            fac010 = fk0*fac10(iplon,lay)<a name='6582'>
            fac110 = fk1*fac10(iplon,lay)<a name='6583'>
            fac210 = fk2*fac10(iplon,lay)<a name='6584'>
         else<a name='6585'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6586'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='6587'>
            fac100 = fs * fac00(iplon,lay)<a name='6588'>
            fac110 = fs * fac10(iplon,lay)<a name='6589'>
         endif<a name='6590'>
<a name='6591'>
         if (specparm1 .lt. 0.125 ) then<a name='6592'>
            p = fs1 - 1<a name='6593'>
            p4 = p**4<a name='6594'>
            fk0 = p4<a name='6595'>
            fk1 = 1 - p - 2.0 *p4<a name='6596'>
            fk2 = p + p4<a name='6597'>
            fac001 = fk0*fac01(iplon,lay)<a name='6598'>
            fac101 = fk1*fac01(iplon,lay)<a name='6599'>
            fac201 = fk2*fac01(iplon,lay)<a name='6600'>
            fac011 = fk0*fac11(iplon,lay)<a name='6601'>
            fac111 = fk1*fac11(iplon,lay)<a name='6602'>
            fac211 = fk2*fac11(iplon,lay)<a name='6603'>
         else if (specparm1 .gt. 0.875 ) then<a name='6604'>
            p = -fs1 <a name='6605'>
            p4 = p**4<a name='6606'>
            fk0 = p4<a name='6607'>
            fk1 = 1 - p - 2.0 *p4<a name='6608'>
            fk2 = p + p4<a name='6609'>
            fac001 = fk0*fac01(iplon,lay)<a name='6610'>
            fac101 = fk1*fac01(iplon,lay)<a name='6611'>
            fac201 = fk2*fac01(iplon,lay)<a name='6612'>
            fac011 = fk0*fac11(iplon,lay)<a name='6613'>
            fac111 = fk1*fac11(iplon,lay)<a name='6614'>
            fac211 = fk2*fac11(iplon,lay)<a name='6615'>
         else<a name='6616'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6617'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6618'>
            fac101 = fs1 * fac01(iplon,lay)<a name='6619'>
            fac111 = fs1 * fac11(iplon,lay)<a name='6620'>
         endif<a name='6621'>
<a name='6622'>
         do ig = 1, ng5<a name='6623'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='6624'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='6625'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='6626'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='6627'>
            o3m1 = ka_mo3d(jmo3,indm,ig) + fmo3 * &amp;<a name='6628'>
                 (ka_mo3d(jmo3+1,indm,ig)-ka_mo3d(jmo3,indm,ig))<a name='6629'>
            o3m2 = ka_mo3d(jmo3,indm+1,ig) + fmo3 * &amp;<a name='6630'>
                 (ka_mo3d(jmo3+1,indm+1,ig)-ka_mo3d(jmo3,indm+1,ig))<a name='6631'>
            abso3 = o3m1 + minorfrac(iplon,lay)*(o3m2-o3m1)<a name='6632'>
<a name='6633'>
            if (specparm .lt. 0.125 ) then<a name='6634'>
               tau_major = speccomb * &amp;<a name='6635'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6636'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6637'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='6638'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6639'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='6640'>
                    fac210 * absad(ind0+11,ig))<a name='6641'>
            else if (specparm .gt. 0.875 ) then<a name='6642'>
               tau_major = speccomb * &amp;<a name='6643'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='6644'>
                    fac100 * absad(ind0,ig) + &amp;<a name='6645'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='6646'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='6647'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='6648'>
                    fac010 * absad(ind0+10,ig))<a name='6649'>
            else<a name='6650'>
               tau_major = speccomb * &amp;<a name='6651'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='6652'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='6653'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='6654'>
                    fac110 * absad(ind0+10,ig))<a name='6655'>
            endif<a name='6656'>
<a name='6657'>
            if (specparm1 .lt. 0.125 ) then<a name='6658'>
               tau_major1 = speccomb1 * &amp;<a name='6659'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='6660'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6661'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='6662'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6663'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='6664'>
                    fac211 * absad(ind1+11,ig))<a name='6665'>
            else if (specparm1 .gt. 0.875 ) then<a name='6666'>
               tau_major1 = speccomb1 * &amp; <a name='6667'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='6668'>
                    fac101 * absad(ind1,ig) + &amp;<a name='6669'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='6670'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='6671'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='6672'>
                    fac011 * absad(ind1+10,ig))<a name='6673'>
            else<a name='6674'>
               tau_major1 = speccomb1 * &amp;<a name='6675'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='6676'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='6677'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='6678'>
                    fac111 * absad(ind1+10,ig))<a name='6679'>
            endif<a name='6680'>
<a name='6681'>
            taug(iplon,lay,ngs4+ig) = tau_major + tau_major1 &amp;<a name='6682'>
                 + tauself + taufor &amp;<a name='6683'>
                 + abso3*colo3(iplon,lay) &amp;<a name='6684'>
                 + wx1(iplon,lay) * coldry(iplon,lay) * 1.e-20  * ccl4d(ig)<a name='6685'>
            fracsd(iplon,lay,ngs4+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='6686'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='6687'>
         enddo<a name='6688'>
      else<a name='6689'>
<a name='6690'>
<font color=#447700>! Upper atmosphere loop<a name='6691'></font>
      <font color=#447700>!do lay = laytrop(iplon)+1, nlayers<a name='6692'></font>
<a name='6693'>
         speccomb = colo3(iplon,lay) + rat_o3co2(iplon,lay)*colco2(iplon,lay)<a name='6694'>
         specparm = colo3(iplon,lay)/speccomb<a name='6695'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6696'>
         specmult = 4. *(specparm)<a name='6697'>
         js = 1 + int(specmult)<a name='6698'>
         fs = mod(specmult,1.0 )<a name='6699'>
<a name='6700'>
         speccomb1 = colo3(iplon,lay) + rat_o3co2_1(iplon,lay)*colco2(iplon,lay)<a name='6701'>
         specparm1 = colo3(iplon,lay)/speccomb1<a name='6702'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6703'>
         specmult1 = 4. *(specparm1)<a name='6704'>
         js1 = 1 + int(specmult1)<a name='6705'>
         fs1 = mod(specmult1,1.0 )<a name='6706'>
<a name='6707'>
         fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6708'>
         fac010 = (1.  - fs) * fac10(iplon,lay)<a name='6709'>
         fac100 = fs * fac00(iplon,lay)<a name='6710'>
         fac110 = fs * fac10(iplon,lay)<a name='6711'>
         fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='6712'>
         fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='6713'>
         fac101 = fs1 * fac01(iplon,lay)<a name='6714'>
         fac111 = fs1 * fac11(iplon,lay)<a name='6715'>
<a name='6716'>
         speccomb_planck = colo3(iplon,lay)+refrat_planck_b*colco2(iplon,lay)<a name='6717'>
         specparm_planck = colo3(iplon,lay)/speccomb_planck<a name='6718'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6719'>
         specmult_planck = 4. *specparm_planck<a name='6720'>
         jpl= 1 + int(specmult_planck)<a name='6721'>
         fpl = mod(specmult_planck,1.0 )<a name='6722'>
<a name='6723'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(5) + js<a name='6724'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(5) + js1<a name='6725'>
         <a name='6726'>
         do ig = 1, ng5<a name='6727'>
            taug(iplon,lay,ngs4+ig) = speccomb * &amp;<a name='6728'>
                (fac000 * absbd(ind0,ig) + &amp;<a name='6729'>
                fac100 * absbd(ind0+1,ig) + &amp;<a name='6730'>
                fac010 * absbd(ind0+5,ig) + &amp;<a name='6731'>
                fac110 * absbd(ind0+6,ig)) &amp;<a name='6732'>
                + speccomb1 * &amp;<a name='6733'>
                (fac001 * absbd(ind1,ig) + &amp;<a name='6734'>
                fac101 * absbd(ind1+1,ig) + &amp;<a name='6735'>
                fac011 * absbd(ind1+5,ig) + &amp;<a name='6736'>
                fac111 * absbd(ind1+6,ig))  &amp;<a name='6737'>
                + wx1(iplon, lay) * coldry(iplon,lay) * 1.e-20  * ccl4d(ig)<a name='6738'>
            fracsd(iplon,lay,ngs4+ig) = fracrefbd(ig,jpl) + fpl * &amp;<a name='6739'>
                (fracrefbd(ig,jpl+1)-fracrefbd(ig,jpl))<a name='6740'>
         enddo<a name='6741'>
      endif<a name='6742'>
<a name='6743'>
#ifdef _ACCEL<a name='6744'>
      endif<a name='6745'>
#else<a name='6746'>
      end do<a name='6747'>
      end do<a name='6748'>
#endif<a name='6749'>
<a name='6750'>
      end subroutine taugb5g<a name='6751'>
<a name='6752'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6753'></font>
<A NAME='TAUGB6G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6754'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb6g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB6G.html' TARGET='index'>3</A><a name='6755'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_15"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6756'>
                                )<a name='6757'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6758'></font>
<font color=#447700>!<a name='6759'></font>
<font color=#447700>!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)<a name='6760'></font>
<font color=#447700>!                           (high key - nothing; high minor - cfc11, cfc12)<a name='6761'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6762'></font>
<a name='6763'>
<font color=#447700>! ------- Modules -------<a name='6764'></font>
<a name='6765'>
<font color=#447700>!      use parrrtm_f, only : ng6, ngs5<a name='6766'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_10">, only : ngs5<a name='6767'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_5">, only : chi_mlsd<a name='6768'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F'>rrlw_kg06_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_F_1"><a name='6769'>
<a name='6770'>
<font color=#447700>! ------- Declarations -------<a name='6771'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_16"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB6G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6772'>
<a name='6773'>
<font color=#447700>! Local <a name='6774'></font>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='6775'>
      real  :: chi_co2, ratco2, adjfac, adjcolco2<a name='6776'>
      real  :: tauself, taufor, absco2<a name='6777'>
      integer , value, intent(in) :: ncol, nlayers<a name='6778'>
      integer  :: iplon<a name='6779'>
      real  _gpudev :: taug(:,:,:)<a name='6780'>
      real  _gpudev :: fracsd(:,:,:)<a name='6781'>
     <a name='6782'>
#ifdef _ACCEL<a name='6783'>
        iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='6784'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='6785'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='6786'>
#else<a name='6787'>
      do iplon = 1, ncol<a name='6788'>
      do lay = 1, nlayers<a name='6789'>
#endif<a name='6790'>
<font color=#447700>! Minor gas mapping level:<a name='6791'></font>
<font color=#447700>!     lower - co2, p = 706.2720 mb, t = 294.2 k<a name='6792'></font>
<font color=#447700>!     upper - cfc11, cfc12<a name='6793'></font>
<a name='6794'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and<a name='6795'></font>
<font color=#447700>! temperature. The water vapor self-continuum and foreign continuum<a name='6796'></font>
<font color=#447700>! is interpolated (in temperature) separately.  <a name='6797'></font>
<a name='6798'>
<font color=#447700>! Lower atmosphere loop<a name='6799'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='6800'>
<a name='6801'>
<font color=#447700>! In atmospheres where the amount of CO2 is too great to be considered<a name='6802'></font>
<font color=#447700>! a minor species, adjust the column amount of CO2 by an empirical factor <a name='6803'></font>
<font color=#447700>! to obtain the proper contribution.<a name='6804'></font>
         chi_co2 = colco2(iplon,lay)/(coldry(iplon,lay))<a name='6805'>
         ratco2 = 1.e20 *chi_co2/chi_mlsd(2,jp(iplon,lay)+1)<a name='6806'>
         if (ratco2 .gt. 3.0 ) then<a name='6807'>
            adjfac = 2.0 +(ratco2-2.0 )**0.77 <a name='6808'>
            adjcolco2 = adjfac*chi_mlsd(2,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='6809'>
         else<a name='6810'>
            adjcolco2 = colco2(iplon,lay)<a name='6811'>
         endif<a name='6812'>
<a name='6813'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(6) + 1<a name='6814'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(6) + 1<a name='6815'>
         inds = indself(iplon,lay)<a name='6816'>
         indf = indfor(iplon,lay)<a name='6817'>
         indm = indminor(iplon,lay)<a name='6818'>
<a name='6819'>
         do ig = 1, ng6<a name='6820'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='6821'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='6822'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='6823'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig)))<a name='6824'>
            absco2 =  (ka_mco2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='6825'>
                 (ka_mco2d(indm+1,ig) - ka_mco2d(indm,ig)))<a name='6826'>
            taug(iplon,lay,ngs5+ig) = colh2o(iplon,lay) * &amp;<a name='6827'>
                (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='6828'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='6829'>
                 fac01(iplon,lay) * absad(ind1,ig) +  &amp;<a name='6830'>
                 fac11(iplon,lay) * absad(ind1+1,ig))  &amp;<a name='6831'>
                 + tauself + taufor &amp;<a name='6832'>
                 + adjcolco2 * absco2 &amp;<a name='6833'>
                 + wx2(iplon, lay) * coldry(iplon,lay) * 1.e-20  * cfc11adjd(ig) &amp;<a name='6834'>
                 + wx3(iplon, lay) * coldry(iplon,lay) * 1.e-20  * cfc12d(ig)<a name='6835'>
            fracsd(iplon,lay,ngs5+ig) = fracrefad(ig)<a name='6836'>
         enddo<a name='6837'>
      else<a name='6838'>
<a name='6839'>
         do ig = 1, ng6<a name='6840'>
            taug(iplon,lay,ngs5+ig) = 0.0  &amp;<a name='6841'>
                 + wx2(iplon, lay) * coldry(iplon,lay) * 1.e-20   * cfc11adjd(ig) &amp;<a name='6842'>
                 + wx3(iplon, lay) * coldry(iplon,lay) * 1.e-20  * cfc12d(ig)<a name='6843'>
            fracsd(iplon,lay,ngs5+ig) = fracrefad(ig)<a name='6844'>
         enddo<a name='6845'>
      endif<a name='6846'>
<a name='6847'>
#ifdef _ACCEL<a name='6848'>
      endif<a name='6849'>
#else<a name='6850'>
      end do<a name='6851'>
      end do<a name='6852'>
#endif<a name='6853'>
<a name='6854'>
      end subroutine taugb6g<a name='6855'>
<a name='6856'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6857'></font>
<A NAME='TAUGB7G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6858'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb7g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB7G.html' TARGET='index'>3</A><a name='6859'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_17"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6860'>
                                )<a name='6861'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6862'></font>
<font color=#447700>!<a name='6863'></font>
<font color=#447700>!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)<a name='6864'></font>
<font color=#447700>!                            (high key - o3; high minor - co2)<a name='6865'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6866'></font>
<a name='6867'>
<font color=#447700>! ------- Modules -------<a name='6868'></font>
<a name='6869'>
<font color=#447700>!      use parrrtm_f, only : ng7, ngs6<a name='6870'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_11">, only : ngs6<a name='6871'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_6">, only : chi_mlsd<a name='6872'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F'>rrlw_kg07_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_F_1"><a name='6873'>
<a name='6874'>
<font color=#447700>! ------- Declarations -------<a name='6875'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_18"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB7G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='6876'>
<a name='6877'>
<font color=#447700>! Local <a name='6878'></font>
      real  _gpudev :: taug(:,:,:)<a name='6879'>
      real  _gpudev :: fracsd(:,:,:)<a name='6880'>
     <a name='6881'>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='6882'>
      integer  :: js, js1, jmco2, jpl<a name='6883'>
      real  :: speccomb, specparm, specmult, fs<a name='6884'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='6885'>
      real  :: speccomb_mco2, specparm_mco2, specmult_mco2, fmco2<a name='6886'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6887'>
      real  :: p, p4, fk0, fk1, fk2<a name='6888'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6889'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6890'>
      real  :: tauself, taufor, co2m1, co2m2, absco2<a name='6891'>
      real  :: chi_co2, ratco2, adjfac, adjcolco2<a name='6892'>
      real  :: refrat_planck_a, refrat_m_a<a name='6893'>
      real  :: tau_major, tau_major1<a name='6894'>
      integer , value, intent(in) :: ncol, nlayers<a name='6895'>
      integer  :: iplon<a name='6896'>
<a name='6897'>
#ifdef _ACCEL<a name='6898'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='6899'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='6900'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='6901'>
#else<a name='6902'>
      do iplon = 1, ncol<a name='6903'>
      do lay = 1, nlayers<a name='6904'>
#endif<a name='6905'>
<font color=#447700>! Minor gas mapping level :<a name='6906'></font>
<font color=#447700>!     lower - co2, p = 706.2620 mbar, t= 278.94 k<a name='6907'></font>
<font color=#447700>!     upper - co2, p = 12.9350 mbar, t = 234.01 k<a name='6908'></font>
<a name='6909'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='6910'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='6911'></font>
<a name='6912'>
<font color=#447700>! P = 706.2620 mb<a name='6913'></font>
      refrat_planck_a = chi_mlsd(1,3)/chi_mlsd(3,3)<a name='6914'>
<a name='6915'>
<font color=#447700>! P = 706.2720 mb<a name='6916'></font>
      refrat_m_a = chi_mlsd(1,3)/chi_mlsd(3,3)<a name='6917'>
<a name='6918'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='6919'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='6920'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='6921'></font>
<font color=#447700>! (in temperature) separately. <a name='6922'></font>
<a name='6923'>
<font color=#447700>! Lower atmosphere loop<a name='6924'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='6925'>
<a name='6926'>
         speccomb = colh2o(iplon,lay) + rat_h2oo3(iplon,lay)*colo3(iplon,lay)<a name='6927'>
         specparm = colh2o(iplon,lay)/speccomb<a name='6928'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='6929'>
         specmult = 8. *(specparm)<a name='6930'>
         js = 1 + int(specmult)<a name='6931'>
         fs = mod(specmult,1.0 )<a name='6932'>
<a name='6933'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oo3_1(iplon,lay)*colo3(iplon,lay)<a name='6934'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='6935'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='6936'>
         specmult1 = 8. *(specparm1)<a name='6937'>
         js1 = 1 + int(specmult1)<a name='6938'>
         fs1 = mod(specmult1,1.0 )<a name='6939'>
<a name='6940'>
         speccomb_mco2 = colh2o(iplon,lay) + refrat_m_a*colo3(iplon,lay)<a name='6941'>
         specparm_mco2 = colh2o(iplon,lay)/speccomb_mco2<a name='6942'>
         if (specparm_mco2 .ge. oneminusd) specparm_mco2 = oneminusd<a name='6943'>
         specmult_mco2 = 8. *specparm_mco2<a name='6944'>
<a name='6945'>
         jmco2 = 1 + int(specmult_mco2)<a name='6946'>
         fmco2 = mod(specmult_mco2,1.0 )<a name='6947'>
<a name='6948'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='6949'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='6950'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6951'></font>
         chi_co2 = colco2(iplon,lay)/(coldry(iplon,lay))<a name='6952'>
         ratco2 = 1.e20*chi_co2/chi_mlsd(2,jp(iplon,lay)+1)<a name='6953'>
         if (ratco2 .gt. 3.0 ) then<a name='6954'>
            adjfac = 3.0 +(ratco2-3.0 )**0.79 <a name='6955'>
            adjcolco2 = adjfac*chi_mlsd(2,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='6956'>
         else<a name='6957'>
            adjcolco2 = colco2(iplon,lay)<a name='6958'>
         endif<a name='6959'>
<a name='6960'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colo3(iplon,lay)<a name='6961'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='6962'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='6963'>
         specmult_planck = 8. *specparm_planck<a name='6964'>
         jpl= 1 + int(specmult_planck)<a name='6965'>
         fpl = mod(specmult_planck,1.0 )<a name='6966'>
<a name='6967'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(7) + js<a name='6968'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(7) + js1<a name='6969'>
         inds = indself(iplon,lay)<a name='6970'>
         indf = indfor(iplon,lay)<a name='6971'>
         indm = indminor(iplon,lay)<a name='6972'>
<a name='6973'>
         if (specparm .lt. 0.125 ) then<a name='6974'>
            p = fs - 1<a name='6975'>
            p4 = p**4<a name='6976'>
            fk0 = p4<a name='6977'>
            fk1 = 1 - p - 2.0 *p4<a name='6978'>
            fk2 = p + p4<a name='6979'>
            fac000 = fk0*fac00(iplon,lay)<a name='6980'>
            fac100 = fk1*fac00(iplon,lay)<a name='6981'>
            fac200 = fk2*fac00(iplon,lay)<a name='6982'>
            fac010 = fk0*fac10(iplon,lay)<a name='6983'>
            fac110 = fk1*fac10(iplon,lay)<a name='6984'>
            fac210 = fk2*fac10(iplon,lay)<a name='6985'>
         else if (specparm .gt. 0.875 ) then<a name='6986'>
            p = -fs <a name='6987'>
            p4 = p**4<a name='6988'>
            fk0 = p4<a name='6989'>
            fk1 = 1 - p - 2.0 *p4<a name='6990'>
            fk2 = p + p4<a name='6991'>
            fac000 = fk0*fac00(iplon,lay)<a name='6992'>
            fac100 = fk1*fac00(iplon,lay)<a name='6993'>
            fac200 = fk2*fac00(iplon,lay)<a name='6994'>
            fac010 = fk0*fac10(iplon,lay)<a name='6995'>
            fac110 = fk1*fac10(iplon,lay)<a name='6996'>
            fac210 = fk2*fac10(iplon,lay)<a name='6997'>
         else<a name='6998'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='6999'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='7000'>
            fac100 = fs * fac00(iplon,lay)<a name='7001'>
            fac110 = fs * fac10(iplon,lay)<a name='7002'>
         endif<a name='7003'>
         if (specparm1 .lt. 0.125 ) then<a name='7004'>
            p = fs1 - 1<a name='7005'>
            p4 = p**4<a name='7006'>
            fk0 = p4<a name='7007'>
            fk1 = 1 - p - 2.0 *p4<a name='7008'>
            fk2 = p + p4<a name='7009'>
            fac001 = fk0*fac01(iplon,lay)<a name='7010'>
            fac101 = fk1*fac01(iplon,lay)<a name='7011'>
            fac201 = fk2*fac01(iplon,lay)<a name='7012'>
            fac011 = fk0*fac11(iplon,lay)<a name='7013'>
            fac111 = fk1*fac11(iplon,lay)<a name='7014'>
            fac211 = fk2*fac11(iplon,lay)<a name='7015'>
         else if (specparm1 .gt. 0.875 ) then<a name='7016'>
            p = -fs1 <a name='7017'>
            p4 = p**4<a name='7018'>
            fk0 = p4<a name='7019'>
            fk1 = 1 - p - 2.0 *p4<a name='7020'>
            fk2 = p + p4<a name='7021'>
            fac001 = fk0*fac01(iplon,lay)<a name='7022'>
            fac101 = fk1*fac01(iplon,lay)<a name='7023'>
            fac201 = fk2*fac01(iplon,lay)<a name='7024'>
            fac011 = fk0*fac11(iplon,lay)<a name='7025'>
            fac111 = fk1*fac11(iplon,lay)<a name='7026'>
            fac211 = fk2*fac11(iplon,lay)<a name='7027'>
         else<a name='7028'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='7029'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='7030'>
            fac101 = fs1 * fac01(iplon,lay)<a name='7031'>
            fac111 = fs1 * fac11(iplon,lay)<a name='7032'>
         endif<a name='7033'>
<a name='7034'>
         do ig = 1, ng7<a name='7035'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7036'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7037'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7038'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7039'>
            co2m1 = ka_mco2d(jmco2,indm,ig) + fmco2 * &amp;<a name='7040'>
                 (ka_mco2d(jmco2+1,indm,ig) - ka_mco2d(jmco2,indm,ig))<a name='7041'>
            co2m2 = ka_mco2d(jmco2,indm+1,ig) + fmco2 * &amp;<a name='7042'>
                 (ka_mco2d(jmco2+1,indm+1,ig) - ka_mco2d(jmco2,indm+1,ig))<a name='7043'>
            absco2 = co2m1 + minorfrac(iplon,lay) * (co2m2 - co2m1)<a name='7044'>
<a name='7045'>
            if (specparm .lt. 0.125 ) then<a name='7046'>
               tau_major = speccomb * &amp;<a name='7047'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7048'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7049'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='7050'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7051'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='7052'>
                    fac210 * absad(ind0+11,ig))<a name='7053'>
            else if (specparm .gt. 0.875 ) then<a name='7054'>
               tau_major = speccomb * &amp;<a name='7055'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='7056'>
                    fac100 * absad(ind0,ig) + &amp;<a name='7057'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='7058'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='7059'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='7060'>
                    fac010 * absad(ind0+10,ig))<a name='7061'>
            else<a name='7062'>
               tau_major = speccomb * &amp;<a name='7063'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7064'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7065'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7066'>
                    fac110 * absad(ind0+10,ig))<a name='7067'>
            endif<a name='7068'>
<a name='7069'>
            if (specparm1 .lt. 0.125 ) then<a name='7070'>
               tau_major1 = speccomb1 * &amp;<a name='7071'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='7072'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7073'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='7074'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7075'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='7076'>
                    fac211 * absad(ind1+11,ig))<a name='7077'>
            else if (specparm1 .gt. 0.875 ) then<a name='7078'>
               tau_major1 = speccomb1 * &amp;<a name='7079'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='7080'>
                    fac101 * absad(ind1,ig) + &amp;<a name='7081'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='7082'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='7083'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='7084'>
                    fac011 * absad(ind1+10,ig))<a name='7085'>
            else<a name='7086'>
               tau_major1 = speccomb1 * &amp;<a name='7087'>
                    (fac001 * absad(ind1,ig) +  &amp;<a name='7088'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7089'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7090'>
                    fac111 * absad(ind1+10,ig))<a name='7091'>
            endif<a name='7092'>
<a name='7093'>
            taug(iplon,lay,ngs6+ig) = tau_major + tau_major1 &amp;<a name='7094'>
                 + tauself + taufor &amp;<a name='7095'>
                 + adjcolco2*absco2<a name='7096'>
            fracsd(iplon,lay,ngs6+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='7097'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='7098'>
         enddo<a name='7099'>
    else<a name='7100'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='7101'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='7102'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7103'></font>
         chi_co2 = colco2(iplon,lay)/(coldry(iplon,lay))<a name='7104'>
         ratco2 = 1.e20*chi_co2/chi_mlsd(2,jp(iplon,lay)+1)<a name='7105'>
         if (ratco2 .gt. 3.0 ) then<a name='7106'>
            adjfac = 2.0 +(ratco2-2.0 )**0.79 <a name='7107'>
            adjcolco2 = adjfac*chi_mlsd(2,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='7108'>
         else<a name='7109'>
            adjcolco2 = colco2(iplon,lay)<a name='7110'>
         endif<a name='7111'>
<a name='7112'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(7) + 1<a name='7113'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(7) + 1<a name='7114'>
         indm = indminor(iplon,lay)<a name='7115'>
<a name='7116'>
         do ig = 1, ng7<a name='7117'>
            absco2 = kb_mco2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7118'>
                 (kb_mco2d(indm+1,ig) - kb_mco2d(indm,ig))<a name='7119'>
            taug(iplon,lay,ngs6+ig) = colo3(iplon,lay) * &amp;<a name='7120'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='7121'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='7122'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='7123'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;<a name='7124'>
                 + adjcolco2 * absco2<a name='7125'>
            fracsd(iplon,lay,ngs6+ig) = fracrefbd(ig)<a name='7126'>
         enddo<a name='7127'>
<a name='7128'>
<font color=#447700>! Empirical modification to code to improve stratospheric cooling rates<a name='7129'></font>
<font color=#447700>! for o3.  Revised to apply weighting for g-point reduction in this band.<a name='7130'></font>
<a name='7131'>
         taug(iplon,lay,ngs6+6)=taug(iplon,lay,ngs6+6)*0.92 <a name='7132'>
         taug(iplon,lay,ngs6+7)=taug(iplon,lay,ngs6+7)*0.88 <a name='7133'>
         taug(iplon,lay,ngs6+8)=taug(iplon,lay,ngs6+8)*1.07 <a name='7134'>
         taug(iplon,lay,ngs6+9)=taug(iplon,lay,ngs6+9)*1.1 <a name='7135'>
         taug(iplon,lay,ngs6+10)=taug(iplon,lay,ngs6+10)*0.99 <a name='7136'>
         taug(iplon,lay,ngs6+11)=taug(iplon,lay,ngs6+11)*0.855 <a name='7137'>
<a name='7138'>
      endif<a name='7139'>
<a name='7140'>
#ifdef _ACCEL<a name='7141'>
      endif<a name='7142'>
#else<a name='7143'>
      end do<a name='7144'>
      end do<a name='7145'>
#endif<a name='7146'>
<a name='7147'>
      end subroutine taugb7g<a name='7148'>
<a name='7149'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7150'></font>
<A NAME='TAUGB8G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7151'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb8g</font>( ncol, nlayers, taug, fracsd  &amp;,<A href='../../call_from/TAUGB8G.html' TARGET='index'>3</A><a name='7152'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_19"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7153'>
                                )<a name='7154'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7155'></font>
<font color=#447700>!<a name='7156'></font>
<font color=#447700>!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)<a name='7157'></font>
<font color=#447700>!                             (high key - o3; high minor - co2, n2o)<a name='7158'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7159'></font>
<a name='7160'>
<font color=#447700>! ------- Modules -------<a name='7161'></font>
<a name='7162'>
<font color=#447700>!      use parrrtm_f, only : ng8, ngs7<a name='7163'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_12">, only : ngs7<a name='7164'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_7">, only : chi_mlsd<a name='7165'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F'>rrlw_kg08_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_F_1"><a name='7166'>
<a name='7167'>
<font color=#447700>! ------- Declarations -------<a name='7168'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_20"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB8G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7169'>
<a name='7170'>
<font color=#447700>! Local  <a name='7171'></font>
      real  _gpudev :: taug(:,:,:)<a name='7172'>
      real  _gpudev :: fracsd(:,:,:)<a name='7173'>
     <a name='7174'>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='7175'>
      real  :: tauself, taufor, absco2, abso3, absn2o<a name='7176'>
      real  :: chi_co2, ratco2, adjfac, adjcolco2<a name='7177'>
      integer , value, intent(in) :: ncol, nlayers<a name='7178'>
      integer  :: iplon<a name='7179'>
<a name='7180'>
#ifdef _ACCEL<a name='7181'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='7182'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='7183'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='7184'>
#else<a name='7185'>
      do iplon = 1, ncol<a name='7186'>
      do lay = 1, nlayers<a name='7187'>
#endif<a name='7188'>
<font color=#447700>! Minor gas mapping level:<a name='7189'></font>
<font color=#447700>!     lower - co2, p = 1053.63 mb, t = 294.2 k<a name='7190'></font>
<font color=#447700>!     lower - o3,  p = 317.348 mb, t = 240.77 k<a name='7191'></font>
<font color=#447700>!     lower - n2o, p = 706.2720 mb, t= 278.94 k<a name='7192'></font>
<font color=#447700>!     lower - cfc12,cfc11<a name='7193'></font>
<font color=#447700>!     upper - co2, p = 35.1632 mb, t = 223.28 k<a name='7194'></font>
<font color=#447700>!     upper - n2o, p = 8.716e-2 mb, t = 226.03 k<a name='7195'></font>
<a name='7196'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='7197'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water vapor <a name='7198'></font>
<font color=#447700>! self-continuum and foreign continuum is interpolated (in temperature) <a name='7199'></font>
<font color=#447700>! separately.<a name='7200'></font>
<a name='7201'>
<font color=#447700>! Lower atmosphere loop<a name='7202'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='7203'>
<a name='7204'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='7205'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='7206'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7207'></font>
         chi_co2 = colco2(iplon,lay)/(coldry(iplon,lay))<a name='7208'>
         ratco2 = 1.e20 *chi_co2/chi_mlsd(2,jp(iplon,lay)+1)<a name='7209'>
         if (ratco2 .gt. 3.0 ) then<a name='7210'>
            adjfac = 2.0 +(ratco2-2.0 )**0.65 <a name='7211'>
            adjcolco2 = adjfac*chi_mlsd(2,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='7212'>
         else<a name='7213'>
            adjcolco2 = colco2(iplon,lay)<a name='7214'>
         endif<a name='7215'>
<a name='7216'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(8) + 1<a name='7217'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(8) + 1<a name='7218'>
         inds = indself(iplon,lay)<a name='7219'>
         indf = indfor(iplon,lay)<a name='7220'>
         indm = indminor(iplon,lay)<a name='7221'>
<a name='7222'>
         do ig = 1, ng8<a name='7223'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7224'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7225'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7226'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig)))<a name='7227'>
            absco2 =  (ka_mco2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7228'>
                 (ka_mco2d(indm+1,ig) - ka_mco2d(indm,ig)))<a name='7229'>
            abso3 =  (ka_mo3d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7230'>
                 (ka_mo3d(indm+1,ig) - ka_mo3d(indm,ig)))<a name='7231'>
            absn2o =  (ka_mn2od(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7232'>
                 (ka_mn2od(indm+1,ig) - ka_mn2od(indm,ig)))<a name='7233'>
            taug(iplon,lay,ngs7+ig) = colh2o(iplon,lay) * &amp;<a name='7234'>
                 (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='7235'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='7236'>
                 fac01(iplon,lay) * absad(ind1,ig) +  &amp;<a name='7237'>
                 fac11(iplon,lay) * absad(ind1+1,ig)) &amp;<a name='7238'>
                 + tauself + taufor &amp;<a name='7239'>
                 + adjcolco2*absco2 &amp;<a name='7240'>
                 + colo3(iplon,lay) * abso3 &amp;<a name='7241'>
                 + coln2o(iplon,lay) * absn2o &amp;<a name='7242'>
                 + wx3(iplon, lay) * coldry(iplon,lay) * 1.e-20  * cfc12d(ig) &amp;<a name='7243'>
                 + wx4(iplon, lay) * coldry(iplon,lay) * 1.e-20  * cfc22adjd(ig)<a name='7244'>
            fracsd(iplon,lay,ngs7+ig) = fracrefad(ig)<a name='7245'>
         enddo<a name='7246'>
      else<a name='7247'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='7248'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='7249'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7250'></font>
         chi_co2 = colco2(iplon,lay)/coldry(iplon,lay)<a name='7251'>
         ratco2 = 1.e20 *chi_co2/chi_mlsd(2,jp(iplon,lay)+1)<a name='7252'>
         if (ratco2 .gt. 3.0 ) then<a name='7253'>
            adjfac = 2.0 +(ratco2-2.0 )**0.65 <a name='7254'>
            adjcolco2 = adjfac*chi_mlsd(2,jp(iplon,lay)+1) * coldry(iplon,lay)*1.e-20 <a name='7255'>
         else<a name='7256'>
            adjcolco2 = colco2(iplon,lay)<a name='7257'>
         endif<a name='7258'>
<a name='7259'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(8) + 1<a name='7260'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(8) + 1<a name='7261'>
         indm = indminor(iplon,lay)<a name='7262'>
<a name='7263'>
         do ig = 1, ng8<a name='7264'>
            absco2 =  (kb_mco2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7265'>
                 (kb_mco2d(indm+1,ig) - kb_mco2d(indm,ig)))<a name='7266'>
            absn2o =  (kb_mn2od(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7267'>
                 (kb_mn2od(indm+1,ig) - kb_mn2od(indm,ig)))<a name='7268'>
            taug(iplon,lay,ngs7+ig) = colo3(iplon,lay) * &amp;<a name='7269'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='7270'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='7271'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='7272'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;<a name='7273'>
                 + adjcolco2*absco2 &amp;<a name='7274'>
                 + coln2o(iplon,lay)*absn2o &amp; <a name='7275'>
                 + wx3(iplon,lay) * coldry(iplon,lay) * 1.e-20  * cfc12d(ig) &amp;<a name='7276'>
                 + wx4(iplon,lay) * coldry(iplon,lay) * 1.e-20  * cfc22adjd(ig)<a name='7277'>
            fracsd(iplon,lay,ngs7+ig) = fracrefbd(ig)<a name='7278'>
         enddo<a name='7279'>
      endif<a name='7280'>
<a name='7281'>
#ifdef _ACCEL<a name='7282'>
      endif<a name='7283'>
#else<a name='7284'>
      end do<a name='7285'>
      end do<a name='7286'>
#endif<a name='7287'>
<a name='7288'>
      end subroutine taugb8g<a name='7289'>
<a name='7290'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7291'></font>
<A NAME='TAUGB9G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7292'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb9g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB9G.html' TARGET='index'>3</A><a name='7293'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_21"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7294'>
                                )<a name='7295'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7296'></font>
<font color=#447700>!<a name='7297'></font>
<font color=#447700>!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)<a name='7298'></font>
<font color=#447700>!                             (high key - ch4; high minor - n2o)<a name='7299'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7300'></font>
<a name='7301'>
<font color=#447700>! ------- Modules -------<a name='7302'></font>
<a name='7303'>
<font color=#447700>!      use parrrtm_f, only : ng9, ngs8<a name='7304'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_13">, only : ngs8<a name='7305'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_8">, only : chi_mlsd<a name='7306'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F'>rrlw_kg09_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_F_1"><a name='7307'>
<a name='7308'>
<font color=#447700>! ------- Declarations -------<a name='7309'></font>
      real  _gpudev :: taug(:,:,:)<a name='7310'>
      real  _gpudev :: fracsd(:,:,:)<a name='7311'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_22"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB9G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7312'>
     <a name='7313'>
<font color=#447700>! Local <a name='7314'></font>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='7315'>
      integer  :: js, js1, jmn2o, jpl<a name='7316'>
      real  :: speccomb, specparm, specmult, fs<a name='7317'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='7318'>
      real  :: speccomb_mn2o, specparm_mn2o, specmult_mn2o, fmn2o<a name='7319'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='7320'>
      real  :: p, p4, fk0, fk1, fk2<a name='7321'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='7322'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='7323'>
      real  :: tauself, taufor, n2om1, n2om2, absn2o<a name='7324'>
      real  :: chi_n2o, ratn2o, adjfac, adjcoln2o<a name='7325'>
      real  :: refrat_planck_a, refrat_m_a<a name='7326'>
      real  :: tau_major, tau_major1<a name='7327'>
      integer , value, intent(in) :: ncol, nlayers<a name='7328'>
      integer  :: iplon<a name='7329'>
<a name='7330'>
#ifdef _ACCEL<a name='7331'>
        iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='7332'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='7333'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='7334'>
#else<a name='7335'>
      do iplon = 1, ncol<a name='7336'>
      do lay = 1, nlayers<a name='7337'>
#endif<a name='7338'>
<font color=#447700>! Minor gas mapping level :<a name='7339'></font>
<font color=#447700>!     lower - n2o, p = 706.272 mbar, t = 278.94 k<a name='7340'></font>
<font color=#447700>!     upper - n2o, p = 95.58 mbar, t = 215.7 k<a name='7341'></font>
<a name='7342'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='7343'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='7344'></font>
<a name='7345'>
<font color=#447700>! P = 212 mb<a name='7346'></font>
      refrat_planck_a = chi_mlsd(1,9)/chi_mlsd(6,9)<a name='7347'>
<a name='7348'>
<font color=#447700>! P = 706.272 mb <a name='7349'></font>
      refrat_m_a = chi_mlsd(1,3)/chi_mlsd(6,3)<a name='7350'>
<a name='7351'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='7352'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='7353'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='7354'></font>
<font color=#447700>! (in temperature) separately.  <a name='7355'></font>
<a name='7356'>
<font color=#447700>! Lower atmosphere loop<a name='7357'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='7358'>
<a name='7359'>
         speccomb = colh2o(iplon,lay) + rat_h2och4(iplon,lay)*colch4(iplon,lay)<a name='7360'>
         specparm = colh2o(iplon,lay)/speccomb<a name='7361'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='7362'>
         specmult = 8. *(specparm)<a name='7363'>
         js = 1 + int(specmult)<a name='7364'>
         fs = mod(specmult,1.0 )<a name='7365'>
<a name='7366'>
         speccomb1 = colh2o(iplon,lay) + rat_h2och4_1(iplon,lay)*colch4(iplon,lay)<a name='7367'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='7368'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='7369'>
         specmult1 = 8. *(specparm1)<a name='7370'>
         js1 = 1 + int(specmult1)<a name='7371'>
         fs1 = mod(specmult1,1.0 )<a name='7372'>
<a name='7373'>
         speccomb_mn2o = colh2o(iplon,lay) + refrat_m_a*colch4(iplon,lay)<a name='7374'>
         specparm_mn2o = colh2o(iplon,lay)/speccomb_mn2o<a name='7375'>
         if (specparm_mn2o .ge. oneminusd) specparm_mn2o = oneminusd<a name='7376'>
         specmult_mn2o = 8. *specparm_mn2o<a name='7377'>
         jmn2o = 1 + int(specmult_mn2o)<a name='7378'>
         fmn2o = mod(specmult_mn2o,1.0 )<a name='7379'>
<a name='7380'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='7381'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='7382'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7383'></font>
         chi_n2o = coln2o(iplon,lay)/(coldry(iplon,lay))<a name='7384'>
         ratn2o = 1.e20 *chi_n2o/chi_mlsd(4,jp(iplon,lay)+1)<a name='7385'>
         if (ratn2o .gt. 1.5 ) then<a name='7386'>
            adjfac = 0.5 +(ratn2o-0.5 )**0.65 <a name='7387'>
            adjcoln2o = adjfac*chi_mlsd(4,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='7388'>
         else<a name='7389'>
            adjcoln2o = coln2o(iplon,lay)<a name='7390'>
         endif<a name='7391'>
<a name='7392'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colch4(iplon,lay)<a name='7393'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='7394'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='7395'>
         specmult_planck = 8. *specparm_planck<a name='7396'>
         jpl= 1 + int(specmult_planck)<a name='7397'>
         fpl = mod(specmult_planck,1.0 )<a name='7398'>
<a name='7399'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(9) + js<a name='7400'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(9) + js1<a name='7401'>
         inds = indself(iplon,lay)<a name='7402'>
         indf = indfor(iplon,lay)<a name='7403'>
         indm = indminor(iplon,lay)<a name='7404'>
<a name='7405'>
         if (specparm .lt. 0.125 ) then<a name='7406'>
            p = fs - 1<a name='7407'>
            p4 = p**4<a name='7408'>
            fk0 = p4<a name='7409'>
            fk1 = 1 - p - 2.0 *p4<a name='7410'>
            fk2 = p + p4<a name='7411'>
            fac000 = fk0*fac00(iplon,lay)<a name='7412'>
            fac100 = fk1*fac00(iplon,lay)<a name='7413'>
            fac200 = fk2*fac00(iplon,lay)<a name='7414'>
            fac010 = fk0*fac10(iplon,lay)<a name='7415'>
            fac110 = fk1*fac10(iplon,lay)<a name='7416'>
            fac210 = fk2*fac10(iplon,lay)<a name='7417'>
         else if (specparm .gt. 0.875 ) then<a name='7418'>
            p = -fs <a name='7419'>
            p4 = p**4<a name='7420'>
            fk0 = p4<a name='7421'>
            fk1 = 1 - p - 2.0 *p4<a name='7422'>
            fk2 = p + p4<a name='7423'>
            fac000 = fk0*fac00(iplon,lay)<a name='7424'>
            fac100 = fk1*fac00(iplon,lay)<a name='7425'>
            fac200 = fk2*fac00(iplon,lay)<a name='7426'>
            fac010 = fk0*fac10(iplon,lay)<a name='7427'>
            fac110 = fk1*fac10(iplon,lay)<a name='7428'>
            fac210 = fk2*fac10(iplon,lay)<a name='7429'>
         else<a name='7430'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='7431'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='7432'>
            fac100 = fs * fac00(iplon,lay)<a name='7433'>
            fac110 = fs * fac10(iplon,lay)<a name='7434'>
         endif<a name='7435'>
<a name='7436'>
         if (specparm1 .lt. 0.125 ) then<a name='7437'>
            p = fs1 - 1<a name='7438'>
            p4 = p**4<a name='7439'>
            fk0 = p4<a name='7440'>
            fk1 = 1 - p - 2.0 *p4<a name='7441'>
            fk2 = p + p4<a name='7442'>
            fac001 = fk0*fac01(iplon,lay)<a name='7443'>
            fac101 = fk1*fac01(iplon,lay)<a name='7444'>
            fac201 = fk2*fac01(iplon,lay)<a name='7445'>
            fac011 = fk0*fac11(iplon,lay)<a name='7446'>
            fac111 = fk1*fac11(iplon,lay)<a name='7447'>
            fac211 = fk2*fac11(iplon,lay)<a name='7448'>
         else if (specparm1 .gt. 0.875 ) then<a name='7449'>
            p = -fs1 <a name='7450'>
            p4 = p**4<a name='7451'>
            fk0 = p4<a name='7452'>
            fk1 = 1 - p - 2.0 *p4<a name='7453'>
            fk2 = p + p4<a name='7454'>
            fac001 = fk0*fac01(iplon,lay)<a name='7455'>
            fac101 = fk1*fac01(iplon,lay)<a name='7456'>
            fac201 = fk2*fac01(iplon,lay)<a name='7457'>
            fac011 = fk0*fac11(iplon,lay)<a name='7458'>
            fac111 = fk1*fac11(iplon,lay)<a name='7459'>
            fac211 = fk2*fac11(iplon,lay)<a name='7460'>
         else<a name='7461'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='7462'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='7463'>
            fac101 = fs1 * fac01(iplon,lay)<a name='7464'>
            fac111 = fs1 * fac11(iplon,lay)<a name='7465'>
         endif<a name='7466'>
<a name='7467'>
         do ig = 1, ng9<a name='7468'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7469'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7470'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7471'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7472'>
            n2om1 = ka_mn2od(jmn2o,indm,ig) + fmn2o * &amp;<a name='7473'>
                 (ka_mn2od(jmn2o+1,indm,ig) - ka_mn2od(jmn2o,indm,ig))<a name='7474'>
            n2om2 = ka_mn2od(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='7475'>
                 (ka_mn2od(jmn2o+1,indm+1,ig) - ka_mn2od(jmn2o,indm+1,ig))<a name='7476'>
            absn2o = n2om1 + minorfrac(iplon,lay) * (n2om2 - n2om1)<a name='7477'>
<a name='7478'>
            if (specparm .lt. 0.125 ) then<a name='7479'>
               tau_major = speccomb * &amp;<a name='7480'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7481'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7482'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='7483'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7484'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='7485'>
                    fac210 * absad(ind0+11,ig))<a name='7486'>
            else if (specparm .gt. 0.875 ) then<a name='7487'>
               tau_major = speccomb * &amp;<a name='7488'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='7489'>
                    fac100 * absad(ind0,ig) + &amp;<a name='7490'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='7491'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='7492'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='7493'>
                    fac010 * absad(ind0+10,ig))<a name='7494'>
            else<a name='7495'>
               tau_major = speccomb * &amp;<a name='7496'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7497'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7498'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7499'>
                    fac110 * absad(ind0+10,ig))<a name='7500'>
            endif<a name='7501'>
<a name='7502'>
            if (specparm1 .lt. 0.125 ) then<a name='7503'>
               tau_major1 = speccomb1 * &amp;<a name='7504'>
                    (fac001 * absad(ind1,ig) + &amp; <a name='7505'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7506'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='7507'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7508'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='7509'>
                    fac211 * absad(ind1+11,ig))<a name='7510'>
            else if (specparm1 .gt. 0.875 ) then<a name='7511'>
               tau_major1 = speccomb1 * &amp;<a name='7512'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='7513'>
                    fac101 * absad(ind1,ig) + &amp;<a name='7514'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='7515'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='7516'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='7517'>
                    fac011 * absad(ind1+10,ig))<a name='7518'>
            else<a name='7519'>
               tau_major1 = speccomb1 * &amp;<a name='7520'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='7521'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7522'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7523'>
                    fac111 * absad(ind1+10,ig))<a name='7524'>
            endif<a name='7525'>
<a name='7526'>
            taug(iplon,lay,ngs8+ig) = tau_major + tau_major1 &amp;<a name='7527'>
                 + tauself + taufor &amp;<a name='7528'>
                 + adjcoln2o*absn2o<a name='7529'>
            fracsd(iplon,lay,ngs8+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='7530'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='7531'>
         enddo<a name='7532'>
      else<a name='7533'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='7534'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='7535'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7536'></font>
         chi_n2o = coln2o(iplon,lay)/(coldry(iplon,lay))<a name='7537'>
         ratn2o = 1.e20 *chi_n2o/chi_mlsd(4,jp(iplon,lay)+1)<a name='7538'>
         if (ratn2o .gt. 1.5 ) then<a name='7539'>
            adjfac = 0.5 +(ratn2o-0.5 )**0.65 <a name='7540'>
            adjcoln2o = adjfac*chi_mlsd(4,jp(iplon,lay)+1)*coldry(iplon,lay)*1.e-20 <a name='7541'>
         else<a name='7542'>
            adjcoln2o = coln2o(iplon,lay)<a name='7543'>
         endif<a name='7544'>
<a name='7545'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(9) + 1<a name='7546'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(9) + 1<a name='7547'>
         indm = indminor(iplon,lay)<a name='7548'>
<a name='7549'>
         do ig = 1, ng9<a name='7550'>
            absn2o = kb_mn2od(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7551'>
                (kb_mn2od(indm+1,ig) - kb_mn2od(indm,ig))<a name='7552'>
            taug(iplon,lay,ngs8+ig) = colch4(iplon,lay) * &amp;<a name='7553'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='7554'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='7555'>
                 fac01(iplon,lay) * absbd(ind1,ig) +  &amp;<a name='7556'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;<a name='7557'>
                 + adjcoln2o*absn2o<a name='7558'>
            fracsd(iplon,lay,ngs8+ig) = fracrefbd(ig)<a name='7559'>
         enddo<a name='7560'>
      endif<a name='7561'>
<a name='7562'>
#ifdef _ACCEL<a name='7563'>
      endif<a name='7564'>
#else<a name='7565'>
      end do<a name='7566'>
      end do<a name='7567'>
#endif<a name='7568'>
<a name='7569'>
      end subroutine taugb9g<a name='7570'>
<a name='7571'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7572'></font>
<A NAME='TAUGB10G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB10G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7573'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb10g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB10G.html' TARGET='index'>2</A><a name='7574'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_23"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB10G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7575'>
                                 )<a name='7576'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7577'></font>
<font color=#447700>!<a name='7578'></font>
<font color=#447700>!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)<a name='7579'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7580'></font>
<a name='7581'>
<font color=#447700>! ------- Modules -------<a name='7582'></font>
<a name='7583'>
<font color=#447700>!      use parrrtm_f, only : ng10, ngs9<a name='7584'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB10G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_14">, only : ngs9<a name='7585'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F'>rrlw_kg10_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB10G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_F_1"><a name='7586'>
<a name='7587'>
<font color=#447700>! ------- Declarations -------<a name='7588'></font>
      real  _gpudev :: taug(:,:,:)<a name='7589'>
      real  _gpudev :: fracsd(:,:,:)<a name='7590'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_24"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB10G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7591'>
     <a name='7592'>
<font color=#447700>! Local <a name='7593'></font>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='7594'>
      real  :: tauself, taufor<a name='7595'>
      integer , value, intent(in) :: ncol, nlayers<a name='7596'>
      integer  :: iplon<a name='7597'>
<a name='7598'>
#ifdef _ACCEL<a name='7599'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='7600'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='7601'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='7602'>
#else<a name='7603'>
      do iplon = 1, ncol<a name='7604'>
      do lay = 1, nlayers<a name='7605'>
#endif<a name='7606'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='7607'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='7608'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='7609'></font>
<a name='7610'>
<font color=#447700>! Lower atmosphere loop<a name='7611'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='7612'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(10) + 1<a name='7613'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(10) + 1<a name='7614'>
         inds = indself(iplon,lay)<a name='7615'>
         indf = indfor(iplon,lay)<a name='7616'>
<a name='7617'>
         do ig = 1, ng10<a name='7618'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7619'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7620'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7621'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7622'>
            taug(iplon,lay,ngs9+ig) = colh2o(iplon,lay) * &amp;<a name='7623'>
                 (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='7624'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='7625'>
                 fac01(iplon,lay) * absad(ind1,ig) + &amp;<a name='7626'>
                 fac11(iplon,lay) * absad(ind1+1,ig))  &amp;<a name='7627'>
                 + tauself + taufor<a name='7628'>
            fracsd(iplon,lay,ngs9+ig) = fracrefad(ig)<a name='7629'>
         enddo<a name='7630'>
      else<a name='7631'>
   <a name='7632'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(10) + 1<a name='7633'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(10) + 1<a name='7634'>
         indf = indfor(iplon,lay)<a name='7635'>
<a name='7636'>
         do ig = 1, ng10<a name='7637'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7638'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7639'>
            taug(iplon,lay,ngs9+ig) = colh2o(iplon,lay) * &amp;<a name='7640'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='7641'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='7642'>
                 fac01(iplon,lay) * absbd(ind1,ig) +  &amp;<a name='7643'>
                 fac11(iplon,lay) * absbd(ind1+1,ig)) &amp;<a name='7644'>
                 + taufor<a name='7645'>
            fracsd(iplon,lay,ngs9+ig) = fracrefbd(ig)<a name='7646'>
         enddo<a name='7647'>
      end if<a name='7648'>
<a name='7649'>
#ifdef _ACCEL<a name='7650'>
      endif<a name='7651'>
#else<a name='7652'>
      end do<a name='7653'>
      end do<a name='7654'>
#endif<a name='7655'>
      end subroutine taugb10g<a name='7656'>
<a name='7657'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7658'></font>
<A NAME='TAUGB11G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB11G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7659'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb11g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB11G.html' TARGET='index'>2</A><a name='7660'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_25"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB11G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7661'>
                                 )<a name='7662'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7663'></font>
<font color=#447700>!<a name='7664'></font>
<font color=#447700>!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='7665'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='7666'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7667'></font>
<a name='7668'>
<font color=#447700>! ------- Modules -------<a name='7669'></font>
<a name='7670'>
<font color=#447700>!      use parrrtm_f, only : ng11, ngs10<a name='7671'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB11G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_15">, only : ngs10<a name='7672'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F'>rrlw_kg11_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB11G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_F_1"><a name='7673'>
<a name='7674'>
<font color=#447700>! ------- Declarations -------<a name='7675'></font>
      real  _gpudev :: taug(:,:,:)<a name='7676'>
      real  _gpudev :: fracsd(:,:,:)<a name='7677'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_26"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB11G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7678'>
     <a name='7679'>
<font color=#447700>! Local <a name='7680'></font>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='7681'>
      real  :: scaleo2, tauself, taufor, tauo2<a name='7682'>
      integer , value, intent(in) :: ncol, nlayers<a name='7683'>
      integer  :: iplon<a name='7684'>
<a name='7685'>
#ifdef _ACCEL<a name='7686'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='7687'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='7688'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='7689'>
#else<a name='7690'>
      do iplon = 1, ncol<a name='7691'>
      do lay = 1, nlayers<a name='7692'>
#endif<a name='7693'>
<font color=#447700>! Minor gas mapping level :<a name='7694'></font>
<font color=#447700>!     lower - o2, p = 706.2720 mbar, t = 278.94 k<a name='7695'></font>
<font color=#447700>!     upper - o2, p = 4.758820 mbarm t = 250.85 k<a name='7696'></font>
<a name='7697'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='7698'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='7699'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='7700'></font>
<a name='7701'>
<font color=#447700>! Lower atmosphere loop<a name='7702'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='7703'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(11) + 1<a name='7704'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(11) + 1<a name='7705'>
         inds = indself(iplon,lay)<a name='7706'>
         indf = indfor(iplon,lay)<a name='7707'>
         indm = indminor(iplon,lay)<a name='7708'>
         scaleo2 = colo2(iplon,lay)*scaleminor(iplon,lay)<a name='7709'>
         do ig = 1, ng11<a name='7710'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7711'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7712'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7713'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig)))<a name='7714'>
            tauo2 =  scaleo2 * (ka_mo2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7715'>
                 (ka_mo2d(indm+1,ig) - ka_mo2d(indm,ig)))<a name='7716'>
            taug(iplon,lay,ngs10+ig) = colh2o(iplon,lay) * &amp;<a name='7717'>
                 (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='7718'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='7719'>
                 fac01(iplon,lay) * absad(ind1,ig) + &amp;<a name='7720'>
                 fac11(iplon,lay) * absad(ind1+1,ig)) &amp;<a name='7721'>
                 + tauself + taufor &amp;<a name='7722'>
                 + tauo2<a name='7723'>
            fracsd(iplon,lay,ngs10+ig) = fracrefad(ig)<a name='7724'>
         enddo<a name='7725'>
      else<a name='7726'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(11) + 1<a name='7727'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(11) + 1<a name='7728'>
         indf = indfor(iplon,lay)<a name='7729'>
         indm = indminor(iplon,lay)<a name='7730'>
         scaleo2 = colo2(iplon,lay)*scaleminor(iplon,lay)<a name='7731'>
         do ig = 1, ng11<a name='7732'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7733'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7734'>
            tauo2 =  scaleo2 * (kb_mo2d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='7735'>
                 (kb_mo2d(indm+1,ig) - kb_mo2d(indm,ig)))<a name='7736'>
            taug(iplon,lay,ngs10+ig) = colh2o(iplon,lay) * &amp;<a name='7737'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='7738'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='7739'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='7740'>
                 fac11(iplon,lay) * absbd(ind1+1,ig))  &amp;<a name='7741'>
                 + taufor &amp;<a name='7742'>
                 + tauo2<a name='7743'>
            fracsd(iplon,lay,ngs10+ig) = fracrefbd(ig)<a name='7744'>
         enddo<a name='7745'>
      endif<a name='7746'>
<a name='7747'>
#ifdef _ACCEL<a name='7748'>
      endif<a name='7749'>
#else<a name='7750'>
      end do<a name='7751'>
      end do<a name='7752'>
#endif<a name='7753'>
<a name='7754'>
      end subroutine taugb11g<a name='7755'>
<a name='7756'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7757'></font>
<A NAME='TAUGB12G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7758'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb12g</font>( ncol, nlayers, taug, fracsd &amp;,<A href='../../call_from/TAUGB12G.html' TARGET='index'>3</A><a name='7759'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_27"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7760'>
                                 )<a name='7761'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7762'></font>
<font color=#447700>!<a name='7763'></font>
<font color=#447700>!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='7764'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7765'></font>
<a name='7766'>
<font color=#447700>! ------- Modules -------<a name='7767'></font>
<a name='7768'>
<font color=#447700>!      use parrrtm_f, only : ng12, ngs11<a name='7769'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_16">, only : ngs11<a name='7770'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_9">, only : chi_mlsd<a name='7771'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F'>rrlw_kg12_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_F_1"><a name='7772'>
<a name='7773'>
<font color=#447700>! ------- Declarations -------<a name='7774'></font>
      real  _gpudev :: taug(:,:,:)<a name='7775'>
      real  _gpudev :: fracsd(:,:,:)<a name='7776'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_28"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB12G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7777'>
     <a name='7778'>
<font color=#447700>! Local <a name='7779'></font>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='7780'>
      integer  :: js, js1, jpl<a name='7781'>
      real  :: speccomb, specparm, specmult, fs<a name='7782'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='7783'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='7784'>
      real  :: p, p4, fk0, fk1, fk2<a name='7785'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='7786'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='7787'>
      real  :: tauself, taufor<a name='7788'>
      real  :: refrat_planck_a<a name='7789'>
      real  :: tau_major, tau_major1<a name='7790'>
      integer , value, intent(in) :: ncol, nlayers<a name='7791'>
      integer  :: iplon<a name='7792'>
<a name='7793'>
#ifdef _ACCEL<a name='7794'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='7795'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='7796'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='7797'>
#else<a name='7798'>
      do iplon = 1, ncol<a name='7799'>
      do lay = 1, nlayers<a name='7800'>
#endif<a name='7801'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='7802'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='7803'></font>
<a name='7804'>
<font color=#447700>! P =   174.164 mb <a name='7805'></font>
      refrat_planck_a = chi_mlsd(1,10)/chi_mlsd(2,10)<a name='7806'>
<a name='7807'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='7808'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='7809'></font>
<font color=#447700>! vapor self-continuum adn foreign continuum is interpolated <a name='7810'></font>
<font color=#447700>! (in temperature) separately.  <a name='7811'></font>
<a name='7812'>
<font color=#447700>! Lower atmosphere loop<a name='7813'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='7814'>
<a name='7815'>
         speccomb = colh2o(iplon,lay) + rat_h2oco2(iplon,lay)*colco2(iplon,lay)<a name='7816'>
         specparm = colh2o(iplon,lay)/speccomb<a name='7817'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='7818'>
         specmult = 8. *(specparm)<a name='7819'>
         js = 1 + int(specmult)<a name='7820'>
         fs = mod(specmult,1.0 )<a name='7821'>
<a name='7822'>
         speccomb1 = colh2o(iplon,lay) + rat_h2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='7823'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='7824'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='7825'>
         specmult1 = 8. *(specparm1)<a name='7826'>
         js1 = 1 + int(specmult1)<a name='7827'>
         fs1 = mod(specmult1,1.0 )<a name='7828'>
<a name='7829'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colco2(iplon,lay)<a name='7830'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='7831'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='7832'>
         specmult_planck = 8. *specparm_planck<a name='7833'>
         jpl= 1 + int(specmult_planck)<a name='7834'>
         fpl = mod(specmult_planck,1.0 )<a name='7835'>
<a name='7836'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(12) + js<a name='7837'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(12) + js1<a name='7838'>
         inds = indself(iplon,lay)<a name='7839'>
         indf = indfor(iplon,lay)<a name='7840'>
<a name='7841'>
         if (specparm .lt. 0.125 ) then<a name='7842'>
            p = fs - 1<a name='7843'>
            p4 = p**4<a name='7844'>
            fk0 = p4<a name='7845'>
            fk1 = 1 - p - 2.0 *p4<a name='7846'>
            fk2 = p + p4<a name='7847'>
            fac000 = fk0*fac00(iplon,lay)<a name='7848'>
            fac100 = fk1*fac00(iplon,lay)<a name='7849'>
            fac200 = fk2*fac00(iplon,lay)<a name='7850'>
            fac010 = fk0*fac10(iplon,lay)<a name='7851'>
            fac110 = fk1*fac10(iplon,lay)<a name='7852'>
            fac210 = fk2*fac10(iplon,lay)<a name='7853'>
         else if (specparm .gt. 0.875 ) then<a name='7854'>
            p = -fs <a name='7855'>
            p4 = p**4<a name='7856'>
            fk0 = p4<a name='7857'>
            fk1 = 1 - p - 2.0 *p4<a name='7858'>
            fk2 = p + p4<a name='7859'>
            fac000 = fk0*fac00(iplon,lay)<a name='7860'>
            fac100 = fk1*fac00(iplon,lay)<a name='7861'>
            fac200 = fk2*fac00(iplon,lay)<a name='7862'>
            fac010 = fk0*fac10(iplon,lay)<a name='7863'>
            fac110 = fk1*fac10(iplon,lay)<a name='7864'>
            fac210 = fk2*fac10(iplon,lay)<a name='7865'>
         else<a name='7866'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='7867'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='7868'>
            fac100 = fs * fac00(iplon,lay)<a name='7869'>
            fac110 = fs * fac10(iplon,lay)<a name='7870'>
         endif<a name='7871'>
<a name='7872'>
         if (specparm1 .lt. 0.125 ) then<a name='7873'>
            p = fs1 - 1<a name='7874'>
            p4 = p**4<a name='7875'>
            fk0 = p4<a name='7876'>
            fk1 = 1 - p - 2.0 *p4<a name='7877'>
            fk2 = p + p4<a name='7878'>
            fac001 = fk0*fac01(iplon,lay)<a name='7879'>
            fac101 = fk1*fac01(iplon,lay)<a name='7880'>
            fac201 = fk2*fac01(iplon,lay)<a name='7881'>
            fac011 = fk0*fac11(iplon,lay)<a name='7882'>
            fac111 = fk1*fac11(iplon,lay)<a name='7883'>
            fac211 = fk2*fac11(iplon,lay)<a name='7884'>
         else if (specparm1 .gt. 0.875 ) then<a name='7885'>
            p = -fs1 <a name='7886'>
            p4 = p**4<a name='7887'>
            fk0 = p4<a name='7888'>
            fk1 = 1 - p - 2.0 *p4<a name='7889'>
            fk2 = p + p4<a name='7890'>
            fac001 = fk0*fac01(iplon,lay)<a name='7891'>
            fac101 = fk1*fac01(iplon,lay)<a name='7892'>
            fac201 = fk2*fac01(iplon,lay)<a name='7893'>
            fac011 = fk0*fac11(iplon,lay)<a name='7894'>
            fac111 = fk1*fac11(iplon,lay)<a name='7895'>
            fac211 = fk2*fac11(iplon,lay)<a name='7896'>
         else<a name='7897'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='7898'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='7899'>
            fac101 = fs1 * fac01(iplon,lay)<a name='7900'>
            fac111 = fs1 * fac11(iplon,lay)<a name='7901'>
         endif<a name='7902'>
<a name='7903'>
         do ig = 1, ng12<a name='7904'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='7905'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='7906'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='7907'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='7908'>
<a name='7909'>
            if (specparm .lt. 0.125 ) then<a name='7910'>
               tau_major = speccomb * &amp;<a name='7911'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7912'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7913'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='7914'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7915'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='7916'>
                    fac210 * absad(ind0+11,ig))<a name='7917'>
            else if (specparm .gt. 0.875 ) then<a name='7918'>
               tau_major = speccomb * &amp;<a name='7919'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='7920'>
                    fac100 * absad(ind0,ig) + &amp;<a name='7921'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='7922'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='7923'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='7924'>
                    fac010 * absad(ind0+10,ig))<a name='7925'>
            else<a name='7926'>
               tau_major = speccomb * &amp;<a name='7927'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='7928'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='7929'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='7930'>
                    fac110 * absad(ind0+10,ig))<a name='7931'>
            endif<a name='7932'>
<a name='7933'>
            if (specparm1 .lt. 0.125 ) then<a name='7934'>
               tau_major1 = speccomb1 * &amp;<a name='7935'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='7936'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7937'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='7938'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7939'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='7940'>
                    fac211 * absad(ind1+11,ig))<a name='7941'>
            else if (specparm1 .gt. 0.875 ) then<a name='7942'>
               tau_major1 = speccomb1 * &amp;<a name='7943'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='7944'>
                    fac101 * absad(ind1,ig) + &amp;<a name='7945'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='7946'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='7947'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='7948'>
                    fac011 * absad(ind1+10,ig))<a name='7949'>
            else<a name='7950'>
               tau_major1 = speccomb1 * &amp;<a name='7951'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='7952'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='7953'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='7954'>
                    fac111 * absad(ind1+10,ig))<a name='7955'>
            endif<a name='7956'>
<a name='7957'>
            taug(iplon,lay,ngs11+ig) = tau_major + tau_major1 &amp;<a name='7958'>
                 + tauself + taufor<a name='7959'>
            fracsd(iplon,lay,ngs11+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='7960'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='7961'>
         enddo<a name='7962'>
   <a name='7963'>
      else<a name='7964'>
         do ig = 1, ng12<a name='7965'>
            taug(iplon,lay,ngs11+ig) = 0.0 <a name='7966'>
            fracsd(iplon,lay,ngs11+ig) = 0.0 <a name='7967'>
         enddo<a name='7968'>
      endif<a name='7969'>
<a name='7970'>
#ifdef _ACCEL<a name='7971'>
      endif<a name='7972'>
#else<a name='7973'>
      end do<a name='7974'>
      end do<a name='7975'>
#endif<a name='7976'>
<a name='7977'>
      end subroutine taugb12g<a name='7978'>
<a name='7979'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7980'></font>
<A NAME='TAUGB13G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7981'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb13g</font>( ncol, nlayers, taug, fracsd  &amp;,<A href='../../call_from/TAUGB13G.html' TARGET='index'>3</A><a name='7982'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_29"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7983'>
                                 )<a name='7984'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7985'></font>
<font color=#447700>!<a name='7986'></font>
<font color=#447700>!     band 13:  2080-2250 cm-1 (low key - h2o,n2o; high minor - o3 minor)<a name='7987'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7988'></font>
<a name='7989'>
<font color=#447700>! ------- Modules -------<a name='7990'></font>
<a name='7991'>
<font color=#447700>!      use parrrtm_f, only : ng13, ngs12<a name='7992'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_17">, only : ngs12<a name='7993'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_10">, only : chi_mlsd<a name='7994'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F'>rrlw_kg13_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_F_1"><a name='7995'>
<font color=#447700>! ------- Declarations -------<a name='7996'></font>
      real  _gpudev :: taug(:,:,:)<a name='7997'>
      real  _gpudev :: fracsd(:,:,:)<a name='7998'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_30"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB13G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='7999'>
     <a name='8000'>
<font color=#447700>! Local <a name='8001'></font>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='8002'>
      integer  :: js, js1, jmco2, jmco, jpl<a name='8003'>
      real  :: speccomb, specparm, specmult, fs<a name='8004'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='8005'>
      real  :: speccomb_mco2, specparm_mco2, specmult_mco2, fmco2<a name='8006'>
      real  :: speccomb_mco, specparm_mco, specmult_mco, fmco<a name='8007'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='8008'>
      real  :: p, p4, fk0, fk1, fk2<a name='8009'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='8010'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='8011'>
      real  :: tauself, taufor, co2m1, co2m2, absco2 <a name='8012'>
      real  :: com1, com2, absco, abso3<a name='8013'>
      real  :: chi_co2, ratco2, adjfac, adjcolco2<a name='8014'>
      real  :: refrat_planck_a, refrat_m_a, refrat_m_a3<a name='8015'>
      real  :: tau_major, tau_major1<a name='8016'>
      integer , value, intent(in) :: ncol, nlayers<a name='8017'>
      integer  :: iplon<a name='8018'>
<a name='8019'>
#ifdef _ACCEL<a name='8020'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='8021'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='8022'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='8023'>
#else<a name='8024'>
      do iplon = 1, ncol<a name='8025'>
      do lay = 1, nlayers<a name='8026'>
#endif<a name='8027'>
<font color=#447700>! Minor gas mapping levels :<a name='8028'></font>
<font color=#447700>!     lower - co2, p = 1053.63 mb, t = 294.2 k<a name='8029'></font>
<font color=#447700>!     lower - co, p = 706 mb, t = 278.94 k<a name='8030'></font>
<font color=#447700>!     upper - o3, p = 95.5835 mb, t = 215.7 k<a name='8031'></font>
<a name='8032'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='8033'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='8034'></font>
<a name='8035'>
<font color=#447700>! P = 473.420 mb (Level 5)<a name='8036'></font>
      refrat_planck_a = chi_mlsd(1,5)/chi_mlsd(4,5)<a name='8037'>
<a name='8038'>
<font color=#447700>! P = 1053. (Level 1)<a name='8039'></font>
      refrat_m_a = chi_mlsd(1,1)/chi_mlsd(4,1)<a name='8040'>
<a name='8041'>
<font color=#447700>! P = 706. (Level 3)<a name='8042'></font>
      refrat_m_a3 = chi_mlsd(1,3)/chi_mlsd(4,3)<a name='8043'>
<a name='8044'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='8045'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='8046'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='8047'></font>
<font color=#447700>! (in temperature) separately.  <a name='8048'></font>
<a name='8049'>
<font color=#447700>! Lower atmosphere loop<a name='8050'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='8051'>
<a name='8052'>
         speccomb = colh2o(iplon,lay) + rat_h2on2o(iplon,lay)*coln2o(iplon,lay)<a name='8053'>
         specparm = colh2o(iplon,lay)/speccomb<a name='8054'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='8055'>
         specmult = 8. *(specparm)<a name='8056'>
         js = 1 + int(specmult)<a name='8057'>
         fs = mod(specmult,1.0 )<a name='8058'>
<a name='8059'>
         speccomb1 = colh2o(iplon,lay) + rat_h2on2o_1(iplon,lay)*coln2o(iplon,lay)<a name='8060'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='8061'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='8062'>
         specmult1 = 8. *(specparm1)<a name='8063'>
         js1 = 1 + int(specmult1)<a name='8064'>
         fs1 = mod(specmult1,1.0 )<a name='8065'>
<a name='8066'>
         speccomb_mco2 = colh2o(iplon,lay) + refrat_m_a*coln2o(iplon,lay)<a name='8067'>
         specparm_mco2 = colh2o(iplon,lay)/speccomb_mco2<a name='8068'>
         if (specparm_mco2 .ge. oneminusd) specparm_mco2 = oneminusd<a name='8069'>
         specmult_mco2 = 8. *specparm_mco2<a name='8070'>
         jmco2 = 1 + int(specmult_mco2)<a name='8071'>
         fmco2 = mod(specmult_mco2,1.0 )<a name='8072'>
<a name='8073'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='8074'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='8075'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='8076'></font>
         chi_co2 = colco2(iplon,lay)/(coldry(iplon,lay))<a name='8077'>
         ratco2 = 1.e20 *chi_co2/3.55e-4 <a name='8078'>
         if (ratco2 .gt. 3.0 ) then<a name='8079'>
            adjfac = 2.0 +(ratco2-2.0 )**0.68 <a name='8080'>
            adjcolco2 = adjfac*3.55e-4*coldry(iplon,lay)*1.e-20 <a name='8081'>
         else<a name='8082'>
            adjcolco2 = colco2(iplon,lay)<a name='8083'>
         endif<a name='8084'>
<a name='8085'>
         speccomb_mco = colh2o(iplon,lay) + refrat_m_a3*coln2o(iplon,lay)<a name='8086'>
         specparm_mco = colh2o(iplon,lay)/speccomb_mco<a name='8087'>
         if (specparm_mco .ge. oneminusd) specparm_mco = oneminusd<a name='8088'>
         specmult_mco = 8. *specparm_mco<a name='8089'>
         jmco = 1 + int(specmult_mco)<a name='8090'>
         fmco = mod(specmult_mco,1.0 )<a name='8091'>
<a name='8092'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*coln2o(iplon,lay)<a name='8093'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='8094'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='8095'>
         specmult_planck = 8. *specparm_planck<a name='8096'>
         jpl= 1 + int(specmult_planck)<a name='8097'>
         fpl = mod(specmult_planck,1.0 )<a name='8098'>
<a name='8099'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(13) + js<a name='8100'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(13) + js1<a name='8101'>
         inds = indself(iplon,lay)<a name='8102'>
         indf = indfor(iplon,lay)<a name='8103'>
         indm = indminor(iplon,lay)<a name='8104'>
<a name='8105'>
         if (specparm .lt. 0.125 ) then<a name='8106'>
            p = fs - 1<a name='8107'>
            p4 = p**4<a name='8108'>
            fk0 = p4<a name='8109'>
            fk1 = 1 - p - 2.0 *p4<a name='8110'>
            fk2 = p + p4<a name='8111'>
            fac000 = fk0*fac00(iplon,lay)<a name='8112'>
            fac100 = fk1*fac00(iplon,lay)<a name='8113'>
            fac200 = fk2*fac00(iplon,lay)<a name='8114'>
            fac010 = fk0*fac10(iplon,lay)<a name='8115'>
            fac110 = fk1*fac10(iplon,lay)<a name='8116'>
            fac210 = fk2*fac10(iplon,lay)<a name='8117'>
         else if (specparm .gt. 0.875 ) then<a name='8118'>
            p = -fs <a name='8119'>
            p4 = p**4<a name='8120'>
            fk0 = p4<a name='8121'>
            fk1 = 1 - p - 2.0 *p4<a name='8122'>
            fk2 = p + p4<a name='8123'>
            fac000 = fk0*fac00(iplon,lay)<a name='8124'>
            fac100 = fk1*fac00(iplon,lay)<a name='8125'>
            fac200 = fk2*fac00(iplon,lay)<a name='8126'>
            fac010 = fk0*fac10(iplon,lay)<a name='8127'>
            fac110 = fk1*fac10(iplon,lay)<a name='8128'>
            fac210 = fk2*fac10(iplon,lay)<a name='8129'>
         else<a name='8130'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='8131'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='8132'>
            fac100 = fs * fac00(iplon,lay)<a name='8133'>
            fac110 = fs * fac10(iplon,lay)<a name='8134'>
         endif<a name='8135'>
<a name='8136'>
         if (specparm1 .lt. 0.125 ) then<a name='8137'>
            p = fs1 - 1<a name='8138'>
            p4 = p**4<a name='8139'>
            fk0 = p4<a name='8140'>
            fk1 = 1 - p - 2.0 *p4<a name='8141'>
            fk2 = p + p4<a name='8142'>
            fac001 = fk0*fac01(iplon,lay)<a name='8143'>
            fac101 = fk1*fac01(iplon,lay)<a name='8144'>
            fac201 = fk2*fac01(iplon,lay)<a name='8145'>
            fac011 = fk0*fac11(iplon,lay)<a name='8146'>
            fac111 = fk1*fac11(iplon,lay)<a name='8147'>
            fac211 = fk2*fac11(iplon,lay)<a name='8148'>
         else if (specparm1 .gt. 0.875 ) then<a name='8149'>
            p = -fs1 <a name='8150'>
            p4 = p**4<a name='8151'>
            fk0 = p4<a name='8152'>
            fk1 = 1 - p - 2.0 *p4<a name='8153'>
            fk2 = p + p4<a name='8154'>
            fac001 = fk0*fac01(iplon,lay)<a name='8155'>
            fac101 = fk1*fac01(iplon,lay)<a name='8156'>
            fac201 = fk2*fac01(iplon,lay)<a name='8157'>
            fac011 = fk0*fac11(iplon,lay)<a name='8158'>
            fac111 = fk1*fac11(iplon,lay)<a name='8159'>
            fac211 = fk2*fac11(iplon,lay)<a name='8160'>
         else<a name='8161'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='8162'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='8163'>
            fac101 = fs1 * fac01(iplon,lay)<a name='8164'>
            fac111 = fs1 * fac11(iplon,lay)<a name='8165'>
         endif<a name='8166'>
<a name='8167'>
         do ig = 1, ng13<a name='8168'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='8169'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='8170'>
            taufor = forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='8171'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='8172'>
            co2m1 = ka_mco2d(jmco2,indm,ig) + fmco2 * &amp;<a name='8173'>
                 (ka_mco2d(jmco2+1,indm,ig) - ka_mco2d(jmco2,indm,ig))<a name='8174'>
            co2m2 = ka_mco2d(jmco2,indm+1,ig) + fmco2 * &amp;<a name='8175'>
                 (ka_mco2d(jmco2+1,indm+1,ig) - ka_mco2d(jmco2,indm+1,ig))<a name='8176'>
            absco2 = co2m1 + minorfrac(iplon,lay) * (co2m2 - co2m1)<a name='8177'>
            com1 = ka_mcod(jmco,indm,ig) + fmco * &amp;<a name='8178'>
                 (ka_mcod(jmco+1,indm,ig) - ka_mcod(jmco,indm,ig))<a name='8179'>
            com2 = ka_mcod(jmco,indm+1,ig) + fmco * &amp;<a name='8180'>
                 (ka_mcod(jmco+1,indm+1,ig) - ka_mcod(jmco,indm+1,ig))<a name='8181'>
            absco = com1 + minorfrac(iplon,lay) * (com2 - com1)<a name='8182'>
<a name='8183'>
            if (specparm .lt. 0.125 ) then<a name='8184'>
               tau_major = speccomb * &amp;<a name='8185'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8186'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8187'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='8188'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8189'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='8190'>
                    fac210 * absad(ind0+11,ig))<a name='8191'>
            else if (specparm .gt. 0.875 ) then<a name='8192'>
               tau_major = speccomb * &amp;<a name='8193'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='8194'>
                    fac100 * absad(ind0,ig) + &amp;<a name='8195'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='8196'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='8197'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='8198'>
                    fac010 * absad(ind0+10,ig))<a name='8199'>
            else<a name='8200'>
               tau_major = speccomb * &amp;<a name='8201'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8202'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8203'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8204'>
                    fac110 * absad(ind0+10,ig))<a name='8205'>
            endif<a name='8206'>
<a name='8207'>
            if (specparm1 .lt. 0.125 ) then<a name='8208'>
               tau_major1 = speccomb1 * &amp;<a name='8209'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8210'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8211'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='8212'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8213'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='8214'>
                    fac211 * absad(ind1+11,ig))<a name='8215'>
            else if (specparm1 .gt. 0.875 ) then<a name='8216'>
               tau_major1 = speccomb1 * &amp;<a name='8217'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='8218'>
                    fac101 * absad(ind1,ig) + &amp;<a name='8219'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='8220'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='8221'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='8222'>
                    fac011 * absad(ind1+10,ig))<a name='8223'>
            else<a name='8224'>
               tau_major1 = speccomb1 * &amp;<a name='8225'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8226'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8227'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8228'>
                    fac111 * absad(ind1+10,ig))<a name='8229'>
            endif<a name='8230'>
<a name='8231'>
            taug(iplon,lay,ngs12+ig) = tau_major + tau_major1 &amp;<a name='8232'>
                 + tauself + taufor &amp;<a name='8233'>
                 + adjcolco2*absco2 &amp;<a name='8234'>
                 + colco(iplon,lay)*absco<a name='8235'>
            fracsd(iplon,lay,ngs12+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='8236'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='8237'>
         enddo<a name='8238'>
      else<a name='8239'>
         indm = indminor(iplon,lay)<a name='8240'>
         do ig = 1, ng13<a name='8241'>
            abso3 = kb_mo3d(indm,ig) + minorfrac(iplon,lay) * &amp;<a name='8242'>
                 (kb_mo3d(indm+1,ig) - kb_mo3d(indm,ig))<a name='8243'>
            taug(iplon,lay,ngs12+ig) = colo3(iplon,lay)*abso3<a name='8244'>
            fracsd(iplon,lay,ngs12+ig) =  fracrefbd(ig)<a name='8245'>
         enddo<a name='8246'>
      endif<a name='8247'>
<a name='8248'>
#ifdef _ACCEL<a name='8249'>
      endif<a name='8250'>
#else<a name='8251'>
      end do<a name='8252'>
      end do<a name='8253'>
#endif<a name='8254'>
<a name='8255'>
      end subroutine taugb13g<a name='8256'>
<a name='8257'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8258'></font>
<A NAME='TAUGB14G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB14G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8259'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb14g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB14G.html' TARGET='index'>2</A><a name='8260'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_31"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB14G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8261'>
                                 )<a name='8262'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8263'></font>
<font color=#447700>!<a name='8264'></font>
<font color=#447700>!     band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='8265'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='8266'></font>
<a name='8267'>
<font color=#447700>! ------- Modules -------<a name='8268'></font>
<a name='8269'>
<font color=#447700>!      use parrrtm_f, only : ng14, ngs13<a name='8270'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB14G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_18">, only : ngs13<a name='8271'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F'>rrlw_kg14_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB14G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_F_1"><a name='8272'>
<a name='8273'>
<font color=#447700>! ------- Declarations -------<a name='8274'></font>
      real  _gpudev :: taug(:,:,:)<a name='8275'>
      real  _gpudev :: fracsd(:,:,:)<a name='8276'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_32"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB14G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8277'>
     <a name='8278'>
<font color=#447700>! Local <a name='8279'></font>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='8280'>
      real  :: tauself, taufor<a name='8281'>
      integer , value, intent(in) :: ncol, nlayers<a name='8282'>
      integer  :: iplon<a name='8283'>
<a name='8284'>
#ifdef _ACCEL<a name='8285'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='8286'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='8287'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='8288'>
#else<a name='8289'>
      do iplon = 1, ncol<a name='8290'>
      do lay = 1, nlayers<a name='8291'>
#endif<a name='8292'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='8293'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum <a name='8294'></font>
<font color=#447700>! and foreign continuum is interpolated (in temperature) separately.  <a name='8295'></font>
<a name='8296'>
<font color=#447700>! Lower atmosphere loop<a name='8297'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='8298'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(14) + 1<a name='8299'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(14) + 1<a name='8300'>
         inds = indself(iplon,lay)<a name='8301'>
         indf = indfor(iplon,lay)<a name='8302'>
         do ig = 1, ng14<a name='8303'>
            tauself = selffac(iplon,lay) * (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='8304'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='8305'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='8306'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='8307'>
            taug(iplon,lay,ngs13+ig) = colco2(iplon,lay) * &amp;<a name='8308'>
                 (fac00(iplon,lay) * absad(ind0,ig) + &amp;<a name='8309'>
                 fac10(iplon,lay) * absad(ind0+1,ig) + &amp;<a name='8310'>
                 fac01(iplon,lay) * absad(ind1,ig) + &amp;<a name='8311'>
                 fac11(iplon,lay) * absad(ind1+1,ig)) &amp;<a name='8312'>
                 + tauself + taufor<a name='8313'>
            fracsd(iplon,lay,ngs13+ig) = fracrefad(ig)<a name='8314'>
         enddo<a name='8315'>
      else<a name='8316'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(14) + 1<a name='8317'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(14) + 1<a name='8318'>
         do ig = 1, ng14<a name='8319'>
            taug(iplon,lay,ngs13+ig) = colco2(iplon,lay) * &amp;<a name='8320'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='8321'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='8322'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='8323'>
                 fac11(iplon,lay) * absbd(ind1+1,ig))<a name='8324'>
            fracsd(iplon,lay,ngs13+ig) = fracrefbd(ig)<a name='8325'>
         enddo<a name='8326'>
      endif<a name='8327'>
<a name='8328'>
#ifdef _ACCEL<a name='8329'>
      endif<a name='8330'>
#else<a name='8331'>
      end do<a name='8332'>
      end do<a name='8333'>
#endif<a name='8334'>
<a name='8335'>
      end subroutine taugb14g<a name='8336'>
<a name='8337'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8338'></font>
<A NAME='TAUGB15G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8339'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb15g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB15G.html' TARGET='index'>3</A><a name='8340'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_33"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8341'>
                                 )<a name='8342'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8343'></font>
<font color=#447700>!<a name='8344'></font>
<font color=#447700>!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)<a name='8345'></font>
<font color=#447700>!                              (high - nothing)<a name='8346'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='8347'></font>
<a name='8348'>
<font color=#447700>! ------- Modules -------<a name='8349'></font>
<a name='8350'>
<font color=#447700>!      use parrrtm_f, only : ng15, ngs14<a name='8351'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_19">, only : ngs14<a name='8352'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_11">, only : chi_mlsd<a name='8353'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F'>rrlw_kg15_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_F_1"><a name='8354'>
<a name='8355'>
<font color=#447700>! ------- Declarations -------<a name='8356'></font>
      real  _gpudev :: taug(:,:,:)<a name='8357'>
      real  _gpudev :: fracsd(:,:,:)<a name='8358'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_34"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB15G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8359'>
     <a name='8360'>
<font color=#447700>! Local <a name='8361'></font>
      integer  :: lay, ind0, ind1, inds, indf, indm, ig<a name='8362'>
      integer  :: js, js1, jmn2, jpl<a name='8363'>
      real  :: speccomb, specparm, specmult, fs<a name='8364'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='8365'>
      real  :: speccomb_mn2, specparm_mn2, specmult_mn2, fmn2<a name='8366'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='8367'>
      real  :: p, p4, fk0, fk1, fk2<a name='8368'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='8369'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='8370'>
      real  :: scalen2, tauself, taufor, n2m1, n2m2, taun2 <a name='8371'>
      real  :: refrat_planck_a, refrat_m_a<a name='8372'>
      real  :: tau_major, tau_major1<a name='8373'>
      integer , value, intent(in) :: ncol, nlayers<a name='8374'>
      integer  :: iplon<a name='8375'>
<a name='8376'>
#ifdef _ACCEL<a name='8377'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='8378'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='8379'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='8380'>
#else<a name='8381'>
      do iplon = 1, ncol<a name='8382'>
      do lay = 1, nlayers<a name='8383'>
#endif<a name='8384'>
<font color=#447700>! Minor gas mapping level : <a name='8385'></font>
<font color=#447700>!     Lower - Nitrogen Continuum, P = 1053., T = 294.<a name='8386'></font>
<a name='8387'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='8388'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='8389'></font>
<font color=#447700>! P = 1053. mb (Level 1)<a name='8390'></font>
      refrat_planck_a = chi_mlsd(4,1)/chi_mlsd(2,1)<a name='8391'>
<a name='8392'>
<font color=#447700>! P = 1053.<a name='8393'></font>
      refrat_m_a = chi_mlsd(4,1)/chi_mlsd(2,1)<a name='8394'>
<a name='8395'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='8396'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='8397'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='8398'></font>
<font color=#447700>! (in temperature) separately.  <a name='8399'></font>
<a name='8400'>
<font color=#447700>! Lower atmosphere loop<a name='8401'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='8402'>
<a name='8403'>
         speccomb = coln2o(iplon,lay) + rat_n2oco2(iplon,lay)*colco2(iplon,lay)<a name='8404'>
         specparm = coln2o(iplon,lay)/speccomb<a name='8405'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='8406'>
         specmult = 8. *(specparm)<a name='8407'>
         js = 1 + int(specmult)<a name='8408'>
         fs = mod(specmult,1.0 )<a name='8409'>
<a name='8410'>
         speccomb1 = coln2o(iplon,lay) + rat_n2oco2_1(iplon,lay)*colco2(iplon,lay)<a name='8411'>
         specparm1 = coln2o(iplon,lay)/speccomb1<a name='8412'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='8413'>
         specmult1 = 8. *(specparm1)<a name='8414'>
         js1 = 1 + int(specmult1)<a name='8415'>
         fs1 = mod(specmult1,1.0 )<a name='8416'>
<a name='8417'>
         speccomb_mn2 = coln2o(iplon,lay) + refrat_m_a*colco2(iplon,lay)<a name='8418'>
         specparm_mn2 = coln2o(iplon,lay)/speccomb_mn2<a name='8419'>
         if (specparm_mn2 .ge. oneminusd) specparm_mn2 = oneminusd<a name='8420'>
         specmult_mn2 = 8. *specparm_mn2<a name='8421'>
         jmn2 = 1 + int(specmult_mn2)<a name='8422'>
         fmn2 = mod(specmult_mn2,1.0 )<a name='8423'>
<a name='8424'>
         speccomb_planck = coln2o(iplon,lay)+refrat_planck_a*colco2(iplon,lay)<a name='8425'>
         specparm_planck = coln2o(iplon,lay)/speccomb_planck<a name='8426'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='8427'>
         specmult_planck = 8. *specparm_planck<a name='8428'>
         jpl= 1 + int(specmult_planck)<a name='8429'>
         fpl = mod(specmult_planck,1.0 )<a name='8430'>
<a name='8431'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(15) + js<a name='8432'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(15) + js1<a name='8433'>
         inds = indself(iplon,lay)<a name='8434'>
         indf = indfor(iplon,lay)<a name='8435'>
         indm = indminor(iplon,lay)<a name='8436'>
         <a name='8437'>
         scalen2 = colbrd(iplon,lay)*scaleminor(iplon,lay)<a name='8438'>
<a name='8439'>
         if (specparm .lt. 0.125 ) then<a name='8440'>
            p = fs - 1<a name='8441'>
            p4 = p**4<a name='8442'>
            fk0 = p4<a name='8443'>
            fk1 = 1 - p - 2.0 *p4<a name='8444'>
            fk2 = p + p4<a name='8445'>
            fac000 = fk0*fac00(iplon,lay)<a name='8446'>
            fac100 = fk1*fac00(iplon,lay)<a name='8447'>
            fac200 = fk2*fac00(iplon,lay)<a name='8448'>
            fac010 = fk0*fac10(iplon,lay)<a name='8449'>
            fac110 = fk1*fac10(iplon,lay)<a name='8450'>
            fac210 = fk2*fac10(iplon,lay)<a name='8451'>
         else if (specparm .gt. 0.875 ) then<a name='8452'>
            p = -fs <a name='8453'>
            p4 = p**4<a name='8454'>
            fk0 = p4<a name='8455'>
            fk1 = 1 - p - 2.0 *p4<a name='8456'>
            fk2 = p + p4<a name='8457'>
            fac000 = fk0*fac00(iplon,lay)<a name='8458'>
            fac100 = fk1*fac00(iplon,lay)<a name='8459'>
            fac200 = fk2*fac00(iplon,lay)<a name='8460'>
            fac010 = fk0*fac10(iplon,lay)<a name='8461'>
            fac110 = fk1*fac10(iplon,lay)<a name='8462'>
            fac210 = fk2*fac10(iplon,lay)<a name='8463'>
         else<a name='8464'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='8465'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='8466'>
            fac100 = fs * fac00(iplon,lay)<a name='8467'>
            fac110 = fs * fac10(iplon,lay)<a name='8468'>
         endif<a name='8469'>
         if (specparm1 .lt. 0.125 ) then<a name='8470'>
            p = fs1 - 1<a name='8471'>
            p4 = p**4<a name='8472'>
            fk0 = p4<a name='8473'>
            fk1 = 1 - p - 2.0 *p4<a name='8474'>
            fk2 = p + p4<a name='8475'>
            fac001 = fk0*fac01(iplon,lay)<a name='8476'>
            fac101 = fk1*fac01(iplon,lay)<a name='8477'>
            fac201 = fk2*fac01(iplon,lay)<a name='8478'>
            fac011 = fk0*fac11(iplon,lay)<a name='8479'>
            fac111 = fk1*fac11(iplon,lay)<a name='8480'>
            fac211 = fk2*fac11(iplon,lay)<a name='8481'>
         else if (specparm1 .gt. 0.875 ) then<a name='8482'>
            p = -fs1 <a name='8483'>
            p4 = p**4<a name='8484'>
            fk0 = p4<a name='8485'>
            fk1 = 1 - p - 2.0 *p4<a name='8486'>
            fk2 = p + p4<a name='8487'>
            fac001 = fk0*fac01(iplon,lay)<a name='8488'>
            fac101 = fk1*fac01(iplon,lay)<a name='8489'>
            fac201 = fk2*fac01(iplon,lay)<a name='8490'>
            fac011 = fk0*fac11(iplon,lay)<a name='8491'>
            fac111 = fk1*fac11(iplon,lay)<a name='8492'>
            fac211 = fk2*fac11(iplon,lay)<a name='8493'>
         else<a name='8494'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='8495'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='8496'>
            fac101 = fs1 * fac01(iplon,lay)<a name='8497'>
            fac111 = fs1 * fac11(iplon,lay)<a name='8498'>
         endif<a name='8499'>
<a name='8500'>
         do ig = 1, ng15<a name='8501'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='8502'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='8503'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='8504'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='8505'>
            n2m1 = ka_mn2d(jmn2,indm,ig) + fmn2 * &amp;<a name='8506'>
                 (ka_mn2d(jmn2+1,indm,ig) - ka_mn2d(jmn2,indm,ig))<a name='8507'>
            n2m2 = ka_mn2d(jmn2,indm+1,ig) + fmn2 * &amp;<a name='8508'>
                 (ka_mn2d(jmn2+1,indm+1,ig) - ka_mn2d(jmn2,indm+1,ig))<a name='8509'>
            taun2 = scalen2 * (n2m1 + minorfrac(iplon,lay) * (n2m2 - n2m1))<a name='8510'>
<a name='8511'>
            if (specparm .lt. 0.125 ) then<a name='8512'>
               tau_major = speccomb * &amp;<a name='8513'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8514'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8515'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='8516'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8517'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='8518'>
                    fac210 * absad(ind0+11,ig))<a name='8519'>
            else if (specparm .gt. 0.875 ) then<a name='8520'>
               tau_major = speccomb * &amp;<a name='8521'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='8522'>
                    fac100 * absad(ind0,ig) + &amp;<a name='8523'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='8524'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='8525'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='8526'>
                    fac010 * absad(ind0+10,ig))<a name='8527'>
            else<a name='8528'>
               tau_major = speccomb * &amp;<a name='8529'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8530'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8531'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8532'>
                    fac110 * absad(ind0+10,ig))<a name='8533'>
            endif <a name='8534'>
<a name='8535'>
            if (specparm1 .lt. 0.125 ) then<a name='8536'>
               tau_major1 = speccomb1 * &amp;<a name='8537'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8538'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8539'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='8540'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8541'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='8542'>
                    fac211 * absad(ind1+11,ig))<a name='8543'>
            else if (specparm1 .gt. 0.875 ) then<a name='8544'>
               tau_major1 = speccomb1 * &amp;<a name='8545'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='8546'>
                    fac101 * absad(ind1,ig) + &amp;<a name='8547'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='8548'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='8549'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='8550'>
                    fac011 * absad(ind1+10,ig))<a name='8551'>
            else<a name='8552'>
               tau_major1 = speccomb1 * &amp;<a name='8553'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8554'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8555'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8556'>
                    fac111 * absad(ind1+10,ig))<a name='8557'>
            endif<a name='8558'>
<a name='8559'>
            taug(iplon,lay,ngs14+ig) = tau_major + tau_major1 &amp;<a name='8560'>
                 + tauself + taufor &amp;<a name='8561'>
                 + taun2<a name='8562'>
            fracsd(iplon,lay,ngs14+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='8563'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='8564'>
         enddo<a name='8565'>
    <a name='8566'>
      else<a name='8567'>
         do ig = 1, ng15<a name='8568'>
            taug(iplon,lay,ngs14+ig) = 0.0 <a name='8569'>
            fracsd(iplon,lay,ngs14+ig) = 0.0 <a name='8570'>
         enddo<a name='8571'>
      endif<a name='8572'>
<a name='8573'>
#ifdef _ACCEL<a name='8574'>
      endif<a name='8575'>
#else<a name='8576'>
      end do<a name='8577'>
      end do<a name='8578'>
#endif<a name='8579'>
<a name='8580'>
      end subroutine taugb15g<a name='8581'>
<a name='8582'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8583'></font>
<A NAME='TAUGB16G'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8584'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>taugb16g</font>( ncol, nlayers , taug, fracsd &amp;,<A href='../../call_from/TAUGB16G.html' TARGET='index'>3</A><a name='8585'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_35"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8586'>
                                 )<a name='8587'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8588'></font>
<font color=#447700>!<a name='8589'></font>
<font color=#447700>!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)<a name='8590'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='8591'></font>
<a name='8592'>
<font color=#447700>! ------- Modules -------<a name='8593'></font>
<a name='8594'>
<font color=#447700>!      use parrrtm_f, only : ng16, ngs15<a name='8595'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_20">, only : ngs15<a name='8596'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_12">, only : chi_mlsd<a name='8597'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F'>rrlw_kg16_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_F_1"><a name='8598'>
<a name='8599'>
<font color=#447700>! ------- Declarations -------<a name='8600'></font>
      real  _gpudev :: taug(:,:,:)<a name='8601'>
      real  _gpudev :: fracsd(:,:,:)<a name='8602'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_36"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUGB16G' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8603'>
     <a name='8604'>
<font color=#447700>! Local <a name='8605'></font>
      integer  :: lay, ind0, ind1, inds, indf, ig<a name='8606'>
      integer  :: js, js1, jpl<a name='8607'>
      real  :: speccomb, specparm, specmult, fs<a name='8608'>
      real  :: speccomb1, specparm1, specmult1, fs1<a name='8609'>
      real  :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='8610'>
      real  :: p, p4, fk0, fk1, fk2<a name='8611'>
      real  :: fac000, fac100, fac200, fac010, fac110, fac210<a name='8612'>
      real  :: fac001, fac101, fac201, fac011, fac111, fac211<a name='8613'>
      real  :: tauself, taufor<a name='8614'>
      real  :: refrat_planck_a<a name='8615'>
      real  :: tau_major, tau_major1<a name='8616'>
      integer , value, intent(in) :: ncol, nlayers<a name='8617'>
      integer  :: iplon<a name='8618'>
<a name='8619'>
#ifdef _ACCEL<a name='8620'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='8621'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='8622'>
      if (iplon &lt;= ncol .and. lay &lt;= nlayers) then<a name='8623'>
#else<a name='8624'>
      do iplon = 1, ncol<a name='8625'>
      do lay = 1, nlayers<a name='8626'>
#endif <a name='8627'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='8628'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='8629'></font>
<a name='8630'>
<font color=#447700>! P = 387. mb (Level 6)<a name='8631'></font>
      refrat_planck_a = chi_mlsd(1,6)/chi_mlsd(6,6)<a name='8632'>
<a name='8633'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='8634'></font>
<font color=#447700>! temperature,and appropriate species.  Below laytrop, the water<a name='8635'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='8636'></font>
<font color=#447700>! (in temperature) separately.  <a name='8637'></font>
<a name='8638'>
<font color=#447700>! Lower atmosphere loop<a name='8639'></font>
      if (lay &lt;= laytrop(iplon)) then<a name='8640'>
         speccomb = colh2o(iplon,lay) + rat_h2och4(iplon,lay)*colch4(iplon,lay)<a name='8641'>
         specparm = colh2o(iplon,lay)/speccomb<a name='8642'>
         if (specparm .ge. oneminusd) specparm = oneminusd<a name='8643'>
         specmult = 8. *(specparm)<a name='8644'>
         js = 1 + int(specmult)<a name='8645'>
         fs = mod(specmult,1.0 )<a name='8646'>
<a name='8647'>
         speccomb1 = colh2o(iplon,lay) + rat_h2och4_1(iplon,lay)*colch4(iplon,lay)<a name='8648'>
         specparm1 = colh2o(iplon,lay)/speccomb1<a name='8649'>
         if (specparm1 .ge. oneminusd) specparm1 = oneminusd<a name='8650'>
         specmult1 = 8. *(specparm1)<a name='8651'>
         js1 = 1 + int(specmult1)<a name='8652'>
         fs1 = mod(specmult1,1.0 )<a name='8653'>
<a name='8654'>
         speccomb_planck = colh2o(iplon,lay)+refrat_planck_a*colch4(iplon,lay)<a name='8655'>
         specparm_planck = colh2o(iplon,lay)/speccomb_planck<a name='8656'>
         if (specparm_planck .ge. oneminusd) specparm_planck=oneminusd<a name='8657'>
         specmult_planck = 8. *specparm_planck<a name='8658'>
         jpl= 1 + int(specmult_planck)<a name='8659'>
         fpl = mod(specmult_planck,1.0 )<a name='8660'>
<a name='8661'>
         ind0 = ((jp(iplon,lay)-1)*5+(jt(iplon,lay)-1))*nspad(16) + js<a name='8662'>
         ind1 = (jp(iplon,lay)*5+(jt1(iplon,lay)-1))*nspad(16) + js1<a name='8663'>
         inds = indself(iplon,lay)<a name='8664'>
         indf = indfor(iplon,lay)<a name='8665'>
<a name='8666'>
         if (specparm .lt. 0.125 ) then<a name='8667'>
            p = fs - 1<a name='8668'>
            p4 = p**4<a name='8669'>
            fk0 = p4<a name='8670'>
            fk1 = 1 - p - 2.0 *p4<a name='8671'>
            fk2 = p + p4<a name='8672'>
            fac000 = fk0*fac00(iplon,lay)<a name='8673'>
            fac100 = fk1*fac00(iplon,lay)<a name='8674'>
            fac200 = fk2*fac00(iplon,lay)<a name='8675'>
            fac010 = fk0*fac10(iplon,lay)<a name='8676'>
            fac110 = fk1*fac10(iplon,lay)<a name='8677'>
            fac210 = fk2*fac10(iplon,lay)<a name='8678'>
         else if (specparm .gt. 0.875 ) then<a name='8679'>
            p = -fs <a name='8680'>
            p4 = p**4<a name='8681'>
            fk0 = p4<a name='8682'>
            fk1 = 1 - p - 2.0 *p4<a name='8683'>
            fk2 = p + p4<a name='8684'>
            fac000 = fk0*fac00(iplon,lay)<a name='8685'>
            fac100 = fk1*fac00(iplon,lay)<a name='8686'>
            fac200 = fk2*fac00(iplon,lay)<a name='8687'>
            fac010 = fk0*fac10(iplon,lay)<a name='8688'>
            fac110 = fk1*fac10(iplon,lay)<a name='8689'>
            fac210 = fk2*fac10(iplon,lay)<a name='8690'>
         else<a name='8691'>
            fac000 = (1.  - fs) * fac00(iplon,lay)<a name='8692'>
            fac010 = (1.  - fs) * fac10(iplon,lay)<a name='8693'>
            fac100 = fs * fac00(iplon,lay)<a name='8694'>
            fac110 = fs * fac10(iplon,lay)<a name='8695'>
         endif<a name='8696'>
<a name='8697'>
         if (specparm1 .lt. 0.125 ) then<a name='8698'>
            p = fs1 - 1<a name='8699'>
            p4 = p**4<a name='8700'>
            fk0 = p4<a name='8701'>
            fk1 = 1 - p - 2.0 *p4<a name='8702'>
            fk2 = p + p4<a name='8703'>
            fac001 = fk0*fac01(iplon,lay)<a name='8704'>
            fac101 = fk1*fac01(iplon,lay)<a name='8705'>
            fac201 = fk2*fac01(iplon,lay)<a name='8706'>
            fac011 = fk0*fac11(iplon,lay)<a name='8707'>
            fac111 = fk1*fac11(iplon,lay)<a name='8708'>
            fac211 = fk2*fac11(iplon,lay)<a name='8709'>
         else if (specparm1 .gt. 0.875 ) then<a name='8710'>
            p = -fs1 <a name='8711'>
            p4 = p**4<a name='8712'>
            fk0 = p4<a name='8713'>
            fk1 = 1 - p - 2.0 *p4<a name='8714'>
            fk2 = p + p4<a name='8715'>
            fac001 = fk0*fac01(iplon,lay)<a name='8716'>
            fac101 = fk1*fac01(iplon,lay)<a name='8717'>
            fac201 = fk2*fac01(iplon,lay)<a name='8718'>
            fac011 = fk0*fac11(iplon,lay)<a name='8719'>
            fac111 = fk1*fac11(iplon,lay)<a name='8720'>
            fac211 = fk2*fac11(iplon,lay)<a name='8721'>
         else<a name='8722'>
            fac001 = (1.  - fs1) * fac01(iplon,lay)<a name='8723'>
            fac011 = (1.  - fs1) * fac11(iplon,lay)<a name='8724'>
            fac101 = fs1 * fac01(iplon,lay)<a name='8725'>
            fac111 = fs1 * fac11(iplon,lay)<a name='8726'>
         endif<a name='8727'>
<a name='8728'>
         do ig = 1, ng16<a name='8729'>
            tauself = selffac(iplon,lay)* (selfrefd(inds,ig) + selffrac(iplon,lay) * &amp;<a name='8730'>
                 (selfrefd(inds+1,ig) - selfrefd(inds,ig)))<a name='8731'>
            taufor =  forfac(iplon,lay) * (forrefd(indf,ig) + forfrac(iplon,lay) * &amp;<a name='8732'>
                 (forrefd(indf+1,ig) - forrefd(indf,ig))) <a name='8733'>
<a name='8734'>
            if (specparm .lt. 0.125 ) then<a name='8735'>
               tau_major = speccomb * &amp;<a name='8736'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8737'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8738'>
                    fac200 * absad(ind0+2,ig) + &amp;<a name='8739'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8740'>
                    fac110 * absad(ind0+10,ig) + &amp;<a name='8741'>
                    fac210 * absad(ind0+11,ig))<a name='8742'>
            else if (specparm .gt. 0.875 ) then<a name='8743'>
               tau_major = speccomb * &amp;<a name='8744'>
                    (fac200 * absad(ind0-1,ig) + &amp;<a name='8745'>
                    fac100 * absad(ind0,ig) + &amp;<a name='8746'>
                    fac000 * absad(ind0+1,ig) + &amp;<a name='8747'>
                    fac210 * absad(ind0+8,ig) + &amp;<a name='8748'>
                    fac110 * absad(ind0+9,ig) + &amp;<a name='8749'>
                    fac010 * absad(ind0+10,ig))<a name='8750'>
            else<a name='8751'>
               tau_major = speccomb * &amp;<a name='8752'>
                    (fac000 * absad(ind0,ig) + &amp;<a name='8753'>
                    fac100 * absad(ind0+1,ig) + &amp;<a name='8754'>
                    fac010 * absad(ind0+9,ig) + &amp;<a name='8755'>
                    fac110 * absad(ind0+10,ig))<a name='8756'>
            endif<a name='8757'>
<a name='8758'>
            if (specparm1 .lt. 0.125 ) then<a name='8759'>
               tau_major1 = speccomb1 * &amp;<a name='8760'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8761'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8762'>
                    fac201 * absad(ind1+2,ig) + &amp;<a name='8763'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8764'>
                    fac111 * absad(ind1+10,ig) + &amp;<a name='8765'>
                    fac211 * absad(ind1+11,ig))<a name='8766'>
            else if (specparm1 .gt. 0.875 ) then<a name='8767'>
               tau_major1 = speccomb1 * &amp;<a name='8768'>
                    (fac201 * absad(ind1-1,ig) + &amp;<a name='8769'>
                    fac101 * absad(ind1,ig) + &amp;<a name='8770'>
                    fac001 * absad(ind1+1,ig) + &amp;<a name='8771'>
                    fac211 * absad(ind1+8,ig) + &amp;<a name='8772'>
                    fac111 * absad(ind1+9,ig) + &amp;<a name='8773'>
                    fac011 * absad(ind1+10,ig))<a name='8774'>
            else<a name='8775'>
               tau_major1 = speccomb1 * &amp;<a name='8776'>
                    (fac001 * absad(ind1,ig) + &amp;<a name='8777'>
                    fac101 * absad(ind1+1,ig) + &amp;<a name='8778'>
                    fac011 * absad(ind1+9,ig) + &amp;<a name='8779'>
                    fac111 * absad(ind1+10,ig))<a name='8780'>
            endif<a name='8781'>
<a name='8782'>
            taug(iplon,lay,ngs15+ig) = tau_major + tau_major1 &amp;<a name='8783'>
                 + tauself + taufor<a name='8784'>
            fracsd(iplon,lay,ngs15+ig) = fracrefad(ig,jpl) + fpl * &amp;<a name='8785'>
                 (fracrefad(ig,jpl+1)-fracrefad(ig,jpl))<a name='8786'>
         enddo<a name='8787'>
      else<a name='8788'>
         ind0 = ((jp(iplon,lay)-13)*5+(jt(iplon,lay)-1))*nspbd(16) + 1<a name='8789'>
         ind1 = ((jp(iplon,lay)-12)*5+(jt1(iplon,lay)-1))*nspbd(16) + 1<a name='8790'>
         do ig = 1, ng16<a name='8791'>
            taug(iplon,lay,ngs15+ig) = colch4(iplon,lay) * &amp;<a name='8792'>
                 (fac00(iplon,lay) * absbd(ind0,ig) + &amp;<a name='8793'>
                 fac10(iplon,lay) * absbd(ind0+1,ig) + &amp;<a name='8794'>
                 fac01(iplon,lay) * absbd(ind1,ig) + &amp;<a name='8795'>
                 fac11(iplon,lay) * absbd(ind1+1,ig))<a name='8796'>
            fracsd(iplon,lay,ngs15+ig) = fracrefbd(ig)<a name='8797'>
         enddo<a name='8798'>
      endif<a name='8799'>
<a name='8800'>
#ifdef _ACCEL<a name='8801'>
      endif<a name='8802'>
#else<a name='8803'>
      end do<a name='8804'>
      end do<a name='8805'>
#endif<a name='8806'>
<a name='8807'>
      end subroutine taugb16g<a name='8808'>
<a name='8809'>
<A NAME='ADDAEROSOLS'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ADDAEROSOLS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8810'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>addAerosols</font>( ncol, nlayers, ngptlw, nbndlw, ngbd, taug &amp;<a name='8811'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_37"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ADDAEROSOLS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8812'>
                                    )<a name='8813'>
<a name='8814'>
      integer , intent(in), value :: ncol, nlayers, ngptlw, nbndlw<a name='8815'>
      integer , intent(in) :: ngbd(:)<a name='8816'>
        <a name='8817'>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_38"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ADDAEROSOLS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8818'>
        <a name='8819'>
      integer  :: iplon, lay, ig<a name='8820'>
      real  _gpudev :: taug(:,:,:)<a name='8821'>
     <a name='8822'>
#ifdef _ACCEL     <a name='8823'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='8824'>
      lay = (blockidx%y-1) * blockdim%y + threadidx%y<a name='8825'>
      ig = (blockidx%z-1) * blockdim%z + threadidx%z<a name='8826'>
      if (iplon&lt;=ncol .and. lay&lt;=nlayers .and. ig&lt;=ngptlw) then<a name='8827'>
#else<a name='8828'>
      do iplon = 1, ncol<a name='8829'>
      do lay = 1, nlayers<a name='8830'>
      do ig = 1, ngptlw<a name='8831'>
#endif<a name='8832'>
<a name='8833'>
        taug(iplon, lay, ig) = taug(iplon, lay, ig) + tauaa(iplon, lay, ngbd(ig))<a name='8834'>
<a name='8835'>
#ifdef _ACCEL<a name='8836'>
      endif<a name='8837'>
#else<a name='8838'>
      end do<a name='8839'>
      end do<a name='8840'>
      end do<a name='8841'>
#endif<a name='8842'>
<a name='8843'>
      end subroutine<a name='8844'>
<a name='8845'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8846'></font>
<A NAME='TAUMOLG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8847'>
      <font color=#993300>subroutine </font><font color=#cc0000>taumolg</font>(iplon, ncol, nlayers, ngbd, taug, fracsd &amp; <A href='../../call_to/TAUMOLG.html' TARGET='index'>1</A>,<A href='../../call_from/TAUMOLG.html' TARGET='index'>1</A><a name='8848'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_39"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8849'>
                        )<a name='8850'>
<font color=#447700>!----------------------------------------------------------------------------<a name='8851'></font>
<a name='8852'>
<font color=#447700>! *******************************************************************************<a name='8853'></font>
<font color=#447700>! *                                                                             *<a name='8854'></font>
<font color=#447700>! *                  Optical depths developed for the                           *<a name='8855'></font>
<font color=#447700>! *                                                                             *<a name='8856'></font>
<font color=#447700>! *                RAPID RADIATIVE TRANSFER MODEL (RRTM)                        *<a name='8857'></font>
<font color=#447700>! *                                                                             *<a name='8858'></font>
<font color=#447700>! *                                                                             *<a name='8859'></font>
<font color=#447700>! *            ATMOSPHERIC AND ENVIRONMENTAL RESEARCH, INC.                     *<a name='8860'></font>
<font color=#447700>! *                        131 HARTWELL AVENUE                                  *<a name='8861'></font>
<font color=#447700>! *                        LEXINGTON, MA 02421                                  *<a name='8862'></font>
<font color=#447700>! *                                                                             *<a name='8863'></font>
<font color=#447700>! *                                                                             *<a name='8864'></font>
<font color=#447700>! *                           ELI J. MLAWER                                     * <a name='8865'></font>
<font color=#447700>! *                         JENNIFER DELAMERE                                   * <a name='8866'></font>
<font color=#447700>! *                         STEVEN J. TAUBMAN                                   *<a name='8867'></font>
<font color=#447700>! *                         SHEPARD A. CLOUGH                                   *<a name='8868'></font>
<font color=#447700>! *                                                                             *<a name='8869'></font>
<font color=#447700>! *                                                                             *<a name='8870'></font>
<font color=#447700>! *                                                                             *<a name='8871'></font>
<font color=#447700>! *                                                                             *<a name='8872'></font>
<font color=#447700>! *                       email:  mlawer@aer.com                                *<a name='8873'></font>
<font color=#447700>! *                       email:  jdelamer@aer.com                              *<a name='8874'></font>
<font color=#447700>! *                                                                             *<a name='8875'></font>
<font color=#447700>! *        The authors wish to acknowledge the contributions of the             *<a name='8876'></font>
<font color=#447700>! *        following people:  Karen Cady-Pereira, Patrick D. Brown,             *  <a name='8877'></font>
<font color=#447700>! *        Michael J. Iacono, Ronald E. Farren, Luke Chen, Robert Bergstrom.    *<a name='8878'></font>
<font color=#447700>! *                                                                             *<a name='8879'></font>
<font color=#447700>! *******************************************************************************<a name='8880'></font>
<font color=#447700>! *                                                                             *<a name='8881'></font>
<font color=#447700>! *  Revision for g-point reduction: Michael J. Iacono, AER, Inc.               *<a name='8882'></font>
<font color=#447700>! *                                                                             *<a name='8883'></font>
<font color=#447700>! *******************************************************************************<a name='8884'></font>
<font color=#447700>! *     TAUMOL                                                                  *<a name='8885'></font>
<font color=#447700>! *                                                                             *<a name='8886'></font>
<font color=#447700>! *     This file contains the subroutines TAUGBn (where n goes from            *<a name='8887'></font>
<font color=#447700>! *     1 to 16).  TAUGBn calculates the optical depths and Planck fractions    *<a name='8888'></font>
<font color=#447700>! *     per g-value and layer for band n.                                       *<a name='8889'></font>
<font color=#447700>! *                                                                             *<a name='8890'></font>
<font color=#447700>! *  Output:  optical depths (unitless)                                         *<a name='8891'></font>
<font color=#447700>! *           fractions needed to compute Planck functions at every layer       *<a name='8892'></font>
<font color=#447700>! *               and g-value                                                   *<a name='8893'></font>
<font color=#447700>! *                                                                             *<a name='8894'></font>
<font color=#447700>! *     COMMON /TAUGCOM/  TAUG(MXLAY,MG)                                        *<a name='8895'></font>
<font color=#447700>! *     COMMON /PLANKG/   fracsd(MXLAY,MG)                                       *<a name='8896'></font>
<font color=#447700>! *                                                                             *<a name='8897'></font>
<font color=#447700>! *  Input                                                                      *<a name='8898'></font>
<font color=#447700>! *                                                                             *<a name='8899'></font>
<font color=#447700>! *     COMMON /FEATURES/ NG(NBANDS),NSPA(NBANDS),NSPB(NBANDS)                  *<a name='8900'></font>
<font color=#447700>! *     COMMON /PRECISE/  oneminusd                                              *<a name='8901'></font>
<font color=#447700>! *     COMMON /PROFILE/  NLAYERS,PAVEL(MXLAY),TAVEL(MXLAY),                    *<a name='8902'></font>
<font color=#447700>! *     &amp;                 PZ(0:MXLAY),TZ(0:MXLAY)                               *<a name='8903'></font>
<font color=#447700>! *     COMMON /PROFDATA/ LAYTROP,                                              *<a name='8904'></font>
<font color=#447700>! *    &amp;                  COLH2O(MXLAY),COLCO2(MXLAY),COLO3(MXLAY),             *<a name='8905'></font>
<font color=#447700>! *    &amp;                  COLN2O(MXLAY),colco(MXLAY),COLCH4(MXLAY),             *<a name='8906'></font>
<font color=#447700>! *    &amp;                  COLO2(MXLAY)<a name='8907'></font>
<font color=#447700>! *     COMMON /INTFAC/   fac00(iplon,MXLAY),fac01(iplon,MXLAY),                            *<a name='8908'></font>
<font color=#447700>! *    &amp;                  FAC10(MXLAY),fac11(iplon,MXLAY)                             *<a name='8909'></font>
<font color=#447700>! *     COMMON /INTIND/   JP(MXLAY),JT(MXLAY),JT1(MXLAY)                        *<a name='8910'></font>
<font color=#447700>! *     COMMON /SELF/     SELFFAC(MXLAY), SELFFRAC(MXLAY), INDSELF(MXLAY)       *<a name='8911'></font>
<font color=#447700>! *                                                                             *<a name='8912'></font>
<font color=#447700>! *     Description:                                                            *<a name='8913'></font>
<font color=#447700>! *     NG(IBAND) - number of g-values in band IBAND                            *<a name='8914'></font>
<font color=#447700>! *     NSPA(IBAND) - for the lower atmosphere, the number of reference         *<a name='8915'></font>
<font color=#447700>! *                   atmospheres that are stored for band IBAND per            *<a name='8916'></font>
<font color=#447700>! *                   pressure level and temperature.  Each of these            *<a name='8917'></font>
<font color=#447700>! *                   atmospheres has different relative amounts of the         *<a name='8918'></font>
<font color=#447700>! *                   key species for the band (i.e. different binary           *<a name='8919'></font>
<font color=#447700>! *                   species parameters).                                      *<a name='8920'></font>
<font color=#447700>! *     NSPB(IBAND) - same for upper atmosphere                                 *<a name='8921'></font>
<font color=#447700>! *     oneminusd - since problems are caused in some cases by interpolation     *<a name='8922'></font>
<font color=#447700>! *                parameters equal to or greater than 1, for these cases       *<a name='8923'></font>
<font color=#447700>! *                these parameters are set to this value, slightly &lt; 1.        *<a name='8924'></font>
<font color=#447700>! *     PAVEL - layer pressures (mb)                                            *<a name='8925'></font>
<font color=#447700>! *     TAVEL - layer temperatures (degrees K)                                  *<a name='8926'></font>
<font color=#447700>! *     PZ - level pressures (mb)                                               *<a name='8927'></font>
<font color=#447700>! *     TZ - level temperatures (degrees K)                                     *<a name='8928'></font>
<font color=#447700>! *     LAYTROP - layer at which switch is made from one combination of         *<a name='8929'></font>
<font color=#447700>! *               key species to another                                        *<a name='8930'></font>
<font color=#447700>! *     COLH2O, COLCO2, COLO3, COLN2O, COLCH4 - column amounts of water         *<a name='8931'></font>
<font color=#447700>! *               vapor,carbon dioxide, ozone, nitrous ozide, methane,          *<a name='8932'></font>
<font color=#447700>! *               respectively (molecules/cm**2)                                *<a name='8933'></font>
<font color=#447700>! *     FACij(LAY) - for layer LAY, these are factors that are needed to        *<a name='8934'></font>
<font color=#447700>! *                  compute the interpolation factors that multiply the        *<a name='8935'></font>
<font color=#447700>! *                  appropriate reference k-values.  A value of 0 (1) for      *<a name='8936'></font>
<font color=#447700>! *                  i,j indicates that the corresponding factor multiplies     *<a name='8937'></font>
<font color=#447700>! *                  reference k-value for the lower (higher) of the two        *<a name='8938'></font>
<font color=#447700>! *                  appropriate temperatures, and altitudes, respectively.     *<a name='8939'></font>
<font color=#447700>! *     JP - the index of the lower (in altitude) of the two appropriate        *<a name='8940'></font>
<font color=#447700>! *          reference pressure levels needed for interpolation                 *<a name='8941'></font>
<font color=#447700>! *     JT, JT1 - the indices of the lower of the two appropriate reference     *<a name='8942'></font>
<font color=#447700>! *               temperatures needed for interpolation (for pressure           *<a name='8943'></font>
<font color=#447700>! *               levels JP and JP+1, respectively)                             *<a name='8944'></font>
<font color=#447700>! *     SELFFAC - scale factor needed for water vapor self-continuum, equals    *<a name='8945'></font>
<font color=#447700>! *               (water vapor density)/(atmospheric density at 296K and        *<a name='8946'></font>
<font color=#447700>! *               1013 mb)                                                      *<a name='8947'></font>
<font color=#447700>! *     SELFFRAC - factor needed for temperature interpolation of reference     *<a name='8948'></font>
<font color=#447700>! *                water vapor self-continuum data                              *<a name='8949'></font>
<font color=#447700>! *     INDSELF - index of the lower of the two appropriate reference           *<a name='8950'></font>
<font color=#447700>! *               temperatures needed for the self-continuum interpolation      *<a name='8951'></font>
<font color=#447700>! *     FORFAC  - scale factor needed for water vapor foreign-continuum.        *<a name='8952'></font>
<font color=#447700>! *     FORFRAC - factor needed for temperature interpolation of reference      *<a name='8953'></font>
<font color=#447700>! *                water vapor foreign-continuum data                           *<a name='8954'></font>
<font color=#447700>! *     INDFOR  - index of the lower of the two appropriate reference           *<a name='8955'></font>
<font color=#447700>! *               temperatures needed for the foreign-continuum interpolation   *<a name='8956'></font>
<font color=#447700>! *                                                                             *<a name='8957'></font>
<font color=#447700>! *  Data input                                                                 *<a name='8958'></font>
<font color=#447700>! *     COMMON /Kn/ KA(NSPA(n),5,13,MG), KB(NSPB(n),5,13:59,MG), SELFREF(10,MG),*<a name='8959'></font>
<font color=#447700>! *                 FORREF(4,MG), KA_M'MGAS', KB_M'MGAS'                        *<a name='8960'></font>
<font color=#447700>! *        (note:  n is the band number,'MGAS' is the species name of the minor *<a name='8961'></font>
<font color=#447700>! *         gas)                                                                *<a name='8962'></font>
<font color=#447700>! *                                                                             *<a name='8963'></font>
<font color=#447700>! *     Description:                                                            *<a name='8964'></font>
<font color=#447700>! *     KA - k-values for low reference atmospheres (key-species only)          *<a name='8965'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='8966'></font>
<font color=#447700>! *     KB - k-values for high reference atmospheres (key-species only)         *<a name='8967'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='8968'></font>
<font color=#447700>! *     KA_M'MGAS' - k-values for low reference atmosphere minor species        *<a name='8969'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='8970'></font>
<font color=#447700>! *     KB_M'MGAS' - k-values for high reference atmosphere minor species       *<a name='8971'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='8972'></font>
<font color=#447700>! *     SELFREF - k-values for water vapor self-continuum for reference         *<a name='8973'></font>
<font color=#447700>! *               atmospheres (used below LAYTROP)                              *<a name='8974'></font>
<font color=#447700>! *               (units: cm**2/molecule)                                       *<a name='8975'></font>
<font color=#447700>! *     FORREF  - k-values for water vapor foreign-continuum for reference      *<a name='8976'></font>
<font color=#447700>! *               atmospheres (used below/above LAYTROP)                        *<a name='8977'></font>
<font color=#447700>! *               (units: cm**2/molecule)                                       *<a name='8978'></font>
<font color=#447700>! *                                                                             *<a name='8979'></font>
<font color=#447700>! *     DIMENSION ABSA(65*NSPA(n),MG), ABSB(235*NSPB(n),MG)                     *<a name='8980'></font>
<font color=#447700>! *     EQUIVALENCE (KA,ABSA),(KB,ABSB)                                         *<a name='8981'></font>
<font color=#447700>! *                                                                             *<a name='8982'></font>
<font color=#447700>!*******************************************************************************<a name='8983'></font>
<a name='8984'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_21">, only : ng1<a name='8985'>
<a name='8986'>
<font color=#447700>! ------- Declarations -------<a name='8987'></font>
#include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_40"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8988'>
<a name='8989'>
<font color=#447700>! ----- Input -----<a name='8990'></font>
      integer , intent(in) :: iplon           <font color=#447700>! the column number (move to calculated in kernel)<a name='8991'></font>
      integer , intent(in) :: ncol            <font color=#447700>! the total number of columns<a name='8992'></font>
      integer , intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='8993'></font>
      integer  _gpudev, intent(in) :: ngbd(:)<a name='8994'>
      real , intent(in) _gpudev :: fracsd(:,:,:)<a name='8995'>
      real , intent(in) _gpudev :: taug(:,:,:)<a name='8996'>
   <a name='8997'>
      <font color=#447700>!real  :: taugcc(ncol, nlayers, 140)<a name='8998'></font>
<a name='8999'>
<font color=#447700>! ----- Output -----<a name='9000'></font>
  <a name='9001'>
      integer :: i,j,err<a name='9002'>
      real :: t1, t2<a name='9003'>
<a name='9004'>
#ifdef _ACCEL<a name='9005'>
      type(dim3) :: dimGrid, dimBlock<a name='9006'>
#endif<a name='9007'>
#ifdef _ACCEL<a name='9008'>
      <font color=#447700>!dimGrid = dim3( (ncol + 127) / 128, 1, 1)<a name='9009'></font>
          <font color=#447700>!dimBlock = dim3( 128,1,1)<a name='9010'></font>
<a name='9011'>
      dimGrid = dim3( (ncol + 63) / 64, ((nlayers+1)/2), 1)<a name='9012'>
      dimBlock = dim3( 64, 2, 1)<a name='9013'>
      <a name='9014'>
#else<a name='9015'>
<font color=#447700>!jm this can be made constant if the arrays are padded out, otherwise<a name='9016'></font>
<font color=#447700>!jm will generate a seg fault computing garbage data on unused ends of vectors<a name='9017'></font>
<font color=#447700>!jm zap #  define ncol CHNK<a name='9018'></font>
#endif   <a name='9019'>
<a name='9020'>
<font color=#447700>! Calculate gaseous optical depth and planck fractions for each spectral band.<a name='9021'></font>
<a name='9022'>
<font color=#447700>! (dmb 2012) Here we configure the grid and thread blocks.  These subroutines are<a name='9023'></font>
<font color=#447700>! only parallelized across the column dimension so the blocks are one dimensional.<a name='9024'></font>
      call taugb1g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9025'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_41"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9026'>
                           )<a name='9027'>
<a name='9028'>
      call taugb2g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9029'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_42"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9030'>
                           )<a name='9031'>
      <a name='9032'>
      call taugb3g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9033'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_43"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9034'>
                           )<a name='9035'>
<a name='9036'>
      call taugb4g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9037'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_44"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9038'>
                           )<a name='9039'>
      <a name='9040'>
      call taugb5g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9041'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_45"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9042'>
                           )<a name='9043'>
<a name='9044'>
      call taugb6g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9045'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_46"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9046'>
                           )<a name='9047'>
<a name='9048'>
      call taugb7g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9049'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_47"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9050'>
                           )<a name='9051'>
<a name='9052'>
      call taugb8g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9053'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_48"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9054'>
                           )<a name='9055'>
<a name='9056'>
      call taugb9g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9057'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_49"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9058'>
                           )<a name='9059'>
<a name='9060'>
      call taugb10g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9061'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_50"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9062'>
                           )<a name='9063'>
<a name='9064'>
      call taugb11g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9065'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_51"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9066'>
                           )<a name='9067'>
 <a name='9068'>
      call taugb12g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9069'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_52"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9070'>
                           )<a name='9071'>
<a name='9072'>
      call taugb13g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9073'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_53"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9074'>
                           )<a name='9075'>
<a name='9076'>
      call taugb14g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9077'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_54"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9078'>
                           )<a name='9079'>
<a name='9080'>
      call taugb15g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9081'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_55"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9082'>
                           )<a name='9083'>
<a name='9084'>
      call taugb16g _gpuchv (ncol, nlayers, taug, fracsd  &amp;<a name='9085'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_56"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9086'>
                           )<a name='9087'>
<a name='9088'>
#ifdef _ACCEL<a name='9089'>
      dimGrid = dim3( (ncol+ 255) / 256, nlayers, ngptlw )<a name='9090'>
      dimBlock = dim3( 256, 1, 1)<a name='9091'>
#endif<a name='9092'>
<a name='9093'>
<font color=#447700>! (dmb 2012) This code used to be in the main rrtmg_lw_rad source file<a name='9094'></font>
<font color=#447700>! We add the aerosol optical depths to the gas optical depths<a name='9095'></font>
      call addAerosols _gpuchv (ncol, nlayers, ngptlw, nbndlw, ngbd, taug &amp;<a name='9096'>
#include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_57"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9097'>
                               )<a name='9098'>
<a name='9099'>
      end subroutine taumolg<a name='9100'>
<a name='9101'>
#ifndef _ACCEL<a name='9102'>
<font color=#447700>! undefines for taug functions<a name='9103'></font>
# undef absad<a name='9104'>
# undef absbd<a name='9105'>
# undef absbod<a name='9106'>
# undef ccl4d<a name='9107'>
# undef ccl4od<a name='9108'>
# undef cfc11adjd<a name='9109'>
# undef cfc11adjod<a name='9110'>
# undef cfc12d<a name='9111'>
# undef cfc12od<a name='9112'>
# undef cfc22adjd<a name='9113'>
# undef cfc22adjod<a name='9114'>
# undef forrefd<a name='9115'>
# undef forrefod<a name='9116'>
# undef fracrefad<a name='9117'>
# undef fracrefaod<a name='9118'>
# undef fracrefbd<a name='9119'>
# undef fracrefbod<a name='9120'>
# undef kad<a name='9121'>
# undef ka_mcod<a name='9122'>
# undef ka_mco2d<a name='9123'>
# undef ka_mn2d<a name='9124'>
# undef ka_mn2od<a name='9125'>
# undef ka_mo2d<a name='9126'>
# undef ka_mo3d<a name='9127'>
# undef kaod<a name='9128'>
# undef kao_mcod<a name='9129'>
# undef kao_mco2d<a name='9130'>
# undef kao_mn2d<a name='9131'>
# undef kao_mn2od<a name='9132'>
# undef kao_mo3d<a name='9133'>
# undef kbd<a name='9134'>
# undef kb_mco2d<a name='9135'>
# undef kb_mn2d<a name='9136'>
# undef kb_mn2od<a name='9137'>
# undef kb_mo2d<a name='9138'>
# undef kb_mo3d<a name='9139'>
# undef kbod<a name='9140'>
# undef kbo_mco2d<a name='9141'>
# undef kbo_mn2od<a name='9142'>
# undef kbo_mo3d<a name='9143'>
# undef selfrefd<a name='9144'>
# undef selfrefod<a name='9145'>
#endif<a name='9146'>
<a name='9147'>
<a name='9148'>
<font color=#447700>!#ifndef _ACCEL<a name='9149'></font>
#  undef ncol<a name='9150'>
<font color=#447700>!#endif<a name='9151'></font>
<a name='9152'>
<font color=#447700>! (dmb 2012) Allocate all of the needed memory for the taumol subroutines<a name='9153'></font>
<A NAME='ALLOCATEGPUTAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUTAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9154'>
      <font color=#993300>subroutine </font><font color=#cc0000>allocateGPUTaumol</font>(ncol, nlayers, npart) <A href='../../call_to/ALLOCATEGPUTAUMOL.html' TARGET='index'>1</A>,<A href='../../call_from/ALLOCATEGPUTAUMOL.html' TARGET='index'>1</A><a name='9155'>
<a name='9156'>
      integer , intent(in) :: ncol<a name='9157'>
      integer , intent(in) :: nlayers<a name='9158'>
      integer , intent(in) :: npart<a name='9159'>
      integer :: i<a name='9160'>
#ifdef _ACCEL<a name='9161'>
      sreg( wx1 , ncol, nlayers )<a name='9162'>
      sreg( wx2 , ncol, nlayers )<a name='9163'>
      sreg( wx3 , ncol, nlayers )<a name='9164'>
      sreg( wx4 , ncol, nlayers )<a name='9165'>
<a name='9166'>
      sreg( jp , ncol, nlayers )<a name='9167'>
      sreg( jt , ncol, nlayers )<a name='9168'>
      sreg( jt1 , ncol, nlayers )<a name='9169'>
      sreg( colh2o , ncol, nlayers )<a name='9170'>
      sreg( colco2 , ncol, nlayers )<a name='9171'>
      sreg( colo3 , ncol, nlayers )<a name='9172'>
      sreg( coln2o , ncol, nlayers )<a name='9173'>
      sreg( colco , ncol, nlayers )<a name='9174'>
      sreg( colch4 , ncol, nlayers )<a name='9175'>
      sreg( colo2 , ncol, nlayers )<a name='9176'>
      sreg( colbrd , ncol, nlayers )<a name='9177'>
      sreg( indself , ncol, nlayers )<a name='9178'>
      sreg( indfor , ncol, nlayers )<a name='9179'>
      sreg( selffac , ncol, nlayers )<a name='9180'>
      sreg( selffrac , ncol, nlayers )<a name='9181'>
      sreg( forfac , ncol, nlayers )<a name='9182'>
      sreg( forfrac , ncol, nlayers )<a name='9183'>
      sreg( indminor , ncol, nlayers )<a name='9184'>
      sreg( minorfrac , ncol, nlayers )<a name='9185'>
      sreg( scaleminor , ncol, nlayers )<a name='9186'>
      sreg( scaleminorn2 , ncol, nlayers )<a name='9187'>
        <a name='9188'>
      sreg( fac00 , ncol, nlayers )<a name='9189'>
      sreg( fac10 , ncol, nlayers )<a name='9190'>
      sreg( fac01 , ncol, nlayers )<a name='9191'>
      sreg( fac11 , ncol, nlayers )<a name='9192'>
      sreg( rat_h2oco2 , ncol, nlayers )<a name='9193'>
      sreg( rat_h2oco2_1 , ncol, nlayers )<a name='9194'>
      sreg( rat_h2oo3 , ncol, nlayers )<a name='9195'>
      sreg( rat_h2oo3_1 , ncol, nlayers )<a name='9196'>
      sreg( rat_h2on2o , ncol, nlayers )<a name='9197'>
      sreg( rat_h2on2o_1 , ncol, nlayers )<a name='9198'>
      sreg( rat_h2och4 , ncol, nlayers )<a name='9199'>
      sreg( rat_h2och4_1 , ncol, nlayers )<a name='9200'>
      sreg( rat_n2oco2 , ncol, nlayers )<a name='9201'>
      sreg( rat_n2oco2_1 , ncol, nlayers )<a name='9202'>
      sreg( rat_o3co2 , ncol, nlayers )<a name='9203'>
      sreg( rat_o3co2_1 , ncol, nlayers )<a name='9204'>
<a name='9205'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DFLUSH'>dflush</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DFLUSH_1">()<a name='9206'>
<a name='9207'>
      allocate( pavel( ncol, nlayers ))<a name='9208'>
      dreg( wx1 , ncol, nlayers )<a name='9209'>
      dreg( wx2 , ncol, nlayers )<a name='9210'>
      dreg( wx3 , ncol, nlayers )<a name='9211'>
      dreg( wx4 , ncol, nlayers )<a name='9212'>
<a name='9213'>
      allocate( coldry( ncol, nlayers ))<a name='9214'>
        <a name='9215'>
      dreg( jp , ncol, nlayers )<a name='9216'>
      dreg( jt , ncol, nlayers )<a name='9217'>
      dreg( jt1 , ncol, nlayers )<a name='9218'>
      dreg( colh2o , ncol, nlayers )<a name='9219'>
      dreg( colco2 , ncol, nlayers )<a name='9220'>
      dreg( colo3 , ncol, nlayers )<a name='9221'>
      dreg( coln2o , ncol, nlayers )<a name='9222'>
      dreg( colco , ncol, nlayers )<a name='9223'>
      dreg( colch4 , ncol, nlayers )<a name='9224'>
      dreg( colo2 , ncol, nlayers )<a name='9225'>
      dreg( colbrd , ncol, nlayers )<a name='9226'>
      dreg( indself , ncol, nlayers )<a name='9227'>
      dreg( indfor , ncol, nlayers )<a name='9228'>
      dreg( selffac , ncol, nlayers )<a name='9229'>
      dreg( selffrac , ncol, nlayers )<a name='9230'>
      dreg( forfac , ncol, nlayers )<a name='9231'>
      dreg( forfrac , ncol, nlayers )<a name='9232'>
      dreg( indminor , ncol, nlayers )<a name='9233'>
      dreg( minorfrac , ncol, nlayers )<a name='9234'>
      dreg( scaleminor , ncol, nlayers )<a name='9235'>
      dreg( scaleminorn2 , ncol, nlayers )<a name='9236'>
<a name='9237'>
      dreg( fac00 , ncol, nlayers )<a name='9238'>
      dreg( fac10 , ncol, nlayers )<a name='9239'>
      dreg( fac01 , ncol, nlayers )<a name='9240'>
      dreg( fac11 , ncol, nlayers )<a name='9241'>
      dreg( rat_h2oco2 , ncol, nlayers )<a name='9242'>
      dreg( rat_h2oco2_1 , ncol, nlayers )<a name='9243'>
      dreg( rat_h2oo3 , ncol, nlayers )<a name='9244'>
      dreg( rat_h2oo3_1 , ncol, nlayers )<a name='9245'>
      dreg( rat_h2on2o , ncol, nlayers )<a name='9246'>
      dreg( rat_h2on2o_1 , ncol, nlayers )<a name='9247'>
      dreg( rat_h2och4 , ncol, nlayers )<a name='9248'>
      dreg( rat_h2och4_1 , ncol, nlayers )<a name='9249'>
      dreg( rat_n2oco2 , ncol, nlayers )<a name='9250'>
      dreg( rat_n2oco2_1 , ncol, nlayers )<a name='9251'>
      dreg( rat_o3co2 , ncol, nlayers )<a name='9252'>
      dreg( rat_o3co2_1 , ncol, nlayers )<a name='9253'>
<a name='9254'>
      allocate( laytrop( ncol ))<a name='9255'>
      allocate( tauaa( ncol, nlayers, nbndlw ))<a name='9256'>
      allocate( nspad( nbndlw ))<a name='9257'>
      allocate( nspbd( nbndlw ))<a name='9258'>
<a name='9259'>
#endif<a name='9260'>
        <a name='9261'>
      end subroutine<a name='9262'>
<a name='9263'>
<font color=#447700>! (dmb 2012) Perform the necessary cleanup of the GPU arrays<a name='9264'></font>
<A NAME='DEALLOCATEGPUTAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUTAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9265'>
      <font color=#993300>subroutine </font><font color=#cc0000>deallocateGPUTaumol</font>() <A href='../../call_to/DEALLOCATEGPUTAUMOL.html' TARGET='index'>1</A>,<A href='../../call_from/DEALLOCATEGPUTAUMOL.html' TARGET='index'>2</A><a name='9266'>
<a name='9267'>
#ifdef _ACCEL<a name='9268'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DBCLEAN'>dbclean</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DBCLEAN_1"><a name='9269'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DCLEAN'>dclean</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DCLEAN_1"><a name='9270'>
      deallocate( pavel)<a name='9271'>
      <a name='9272'>
      deallocate( tauaa )<a name='9273'>
      deallocate( laytrop)<a name='9274'>
       <a name='9275'>
      deallocate( nspad)<a name='9276'>
      deallocate( nspbd)<a name='9277'>
      deallocate( coldry)<a name='9278'>
#endif<a name='9279'>
<a name='9280'>
      end subroutine<a name='9281'>
       <a name='9282'>
<A NAME='COPYGPUTAUMOLMOL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOLMOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9283'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyGPUTaumolMol</font>( colstart, pncol, nlayers, colh2oc, colco2c, colo3c, coln2oc, colch4c, colo2c,&amp; <A href='../../call_to/COPYGPUTAUMOLMOL.html' TARGET='index'>1</A><a name='9284'>
                                   px1,px2,px3,px4, npart)<a name='9285'>
        <a name='9286'>
      integer, value, intent(in) :: colstart, pncol, nlayers, npart<a name='9287'>
      real , intent(in) :: colh2oc(:,:), colco2c(:,:), colo3c(:,:), coln2oc(:,:), &amp;<a name='9288'>
                                     colch4c(:,:), colo2c(:,:), px1(:,:), px2(:,:), px3(:,:), px4(:,:)<a name='9289'>
<a name='9290'>
#ifdef _ACCEL<a name='9291'>
      if (npart &gt; 1) then<a name='9292'>
        colh2o(1:pncol, :) = colh2oc( colstart:(colstart+pncol-1), 1:nlayers)<a name='9293'>
        colco2(1:pncol, :) = colco2c( colstart:(colstart+pncol-1), 1:nlayers)<a name='9294'>
        colo3(1:pncol, :) = colo3c( colstart:(colstart+pncol-1), 1:nlayers)<a name='9295'>
        coln2o(1:pncol, :) = coln2oc( colstart:(colstart+pncol-1), 1:nlayers)<a name='9296'>
      <a name='9297'>
        colch4(1:pncol, :) = colch4c( colstart:(colstart+pncol-1), 1:nlayers)<a name='9298'>
        colo2(1:pncol, :) = colo2c( colstart:(colstart+pncol-1), 1:nlayers)<a name='9299'>
        wx1(1:pncol, :) = px1(colstart:(colstart+pncol-1), 1:nlayers)<a name='9300'>
        wx2(1:pncol, :) = px2(colstart:(colstart+pncol-1), 1:nlayers)<a name='9301'>
        wx3(1:pncol, :) = px3(colstart:(colstart+pncol-1), 1:nlayers)<a name='9302'>
        wx4(1:pncol, :) = px4(colstart:(colstart+pncol-1), 1:nlayers)<a name='9303'>
      else<a name='9304'>
        colh2o = colh2oc<a name='9305'>
        colco2 = colco2c<a name='9306'>
        colo3 = colo3c<a name='9307'>
        coln2o = coln2oc<a name='9308'>
        colch4 = colch4c<a name='9309'>
        colo2 = colo2c<a name='9310'>
        wx1 = px1<a name='9311'>
        wx2 = px2<a name='9312'>
        wx3 = px3<a name='9313'>
        wx4 = px4<a name='9314'>
<a name='9315'>
      endif<a name='9316'>
      colco = 0<a name='9317'>
#endif<a name='9318'>
      end subroutine<a name='9319'>
<a name='9320'>
<font color=#447700>! (dmb 2012) Copy the needed data from the CPU to the GPU.  I had to separate this<a name='9321'></font>
<font color=#447700>! out into 16 separate functions to correspond with the 16 taumol subroutines.<a name='9322'></font>
<A NAME='COPYGPUTAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9323'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyGPUTaumol</font>(pavelc, wxc, coldryc, tauap, pncol, colstart, nlay, npart) <A href='../../call_to/COPYGPUTAUMOL.html' TARGET='index'>1</A>,<A href='../../call_from/COPYGPUTAUMOL.html' TARGET='index'>49</A><a name='9324'>
<a name='9325'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F'>rrlw_kg01_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_F_2">, only : copyToGPU1, reg1<a name='9326'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F'>rrlw_kg02_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_F_2">, only : copyToGPU2, reg2<a name='9327'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F'>rrlw_kg03_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_F_2">, only : copyToGPU3, reg3<a name='9328'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F'>rrlw_kg04_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_F_2">, only : copyToGPU4, reg4<a name='9329'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F'>rrlw_kg05_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_F_2">, only : copyToGPU5, reg5<a name='9330'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F'>rrlw_kg06_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_F_2">, only : copyToGPU6, reg6<a name='9331'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F'>rrlw_kg07_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_F_2">, only : copyToGPU7, reg7<a name='9332'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F'>rrlw_kg08_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_F_2">, only : copyToGPU8, reg8<a name='9333'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F'>rrlw_kg09_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_F_2">, only : copyToGPU9, reg9<a name='9334'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F'>rrlw_kg10_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_F_2">, only : copyToGPU10, reg10<a name='9335'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F'>rrlw_kg11_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_F_2">, only : copyToGPU11, reg11<a name='9336'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F'>rrlw_kg12_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_F_2">, only : copyToGPU12, reg12<a name='9337'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F'>rrlw_kg13_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_F_2">, only : copyToGPU13, reg13<a name='9338'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F'>rrlw_kg14_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_F_2">, only : copyToGPU14, reg14<a name='9339'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F'>rrlw_kg15_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_F_2">, only : copyToGPU15, reg15<a name='9340'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F'>rrlw_kg16_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_F_2">, only : copyToGPU16, reg16<a name='9341'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_13">, only  : copyToGPUref<a name='9342'>
<a name='9343'>
      real , intent(in) :: pavelc(:,:)                <font color=#447700>! layer pressures (mb) <a name='9344'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9345'></font>
      real  , intent(in) :: wxc(:,:,:)                <font color=#447700>! cross-section amounts (mol/cm2)<a name='9346'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,maxxsec,nlayers)<a name='9347'></font>
      real  , intent(in) :: coldryc(:,:)              <font color=#447700>! column amount (dry air)<a name='9348'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9349'></font>
<a name='9350'>
      real , intent(in) :: tauap(:,:,:)<a name='9351'>
                                                      <font color=#447700>!    Dimensions: (ncol,nlayers,ngptlw)<a name='9352'></font>
      integer, intent(in)      :: pncol, colstart, nlay, npart<a name='9353'>
     <a name='9354'>
#ifdef _ACCEL<a name='9355'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG1'>reg1</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG1_1"><a name='9356'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG2'>reg2</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG2_1"><a name='9357'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG3'>reg3</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG3_1"><a name='9358'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG4'>reg4</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG4_1"><a name='9359'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG5'>reg5</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG5_1"><a name='9360'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG6'>reg6</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG6_1"><a name='9361'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG7'>reg7</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG7_1"><a name='9362'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG8'>reg8</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG8_1"><a name='9363'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG9'>reg9</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG9_1"><a name='9364'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG10'>reg10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG10_1"><a name='9365'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG11'>reg11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG11_1"><a name='9366'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG12'>reg12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG12_1"><a name='9367'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG13'>reg13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG13_1"><a name='9368'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG14'>reg14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG14_1"><a name='9369'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG15'>reg15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG15_1"><a name='9370'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REG16'>reg16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REG16_1"><a name='9371'>
      <a name='9372'>
      dbflushreg()<a name='9373'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU1'>CopyToGPU1</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU1_1"><a name='9374'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU2'>CopyToGPU2</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU2_1"><a name='9375'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU3'>CopyToGPU3</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU3_1"><a name='9376'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU4'>CopyToGPU4</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU4_1"><a name='9377'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU5'>CopyToGPU5</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU5_1"><a name='9378'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU6'>CopyToGPU6</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU6_1"><a name='9379'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU7'>CopyToGPU7</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU7_1"><a name='9380'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU8'>CopyToGPU8</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU8_1"><a name='9381'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU9'>CopyToGPU9</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU9_1"><a name='9382'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU10'>CopyToGPU10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU10_1"><a name='9383'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU11'>CopyToGPU11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU11_1"><a name='9384'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU12'>CopyToGPU12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU12_1"><a name='9385'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU13'>CopyToGPU13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU13_1"><a name='9386'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU14'>CopyToGPU14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU14_1"><a name='9387'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU15'>CopyToGPU15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU15_1"><a name='9388'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPU16'>CopyToGPU16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPU16_1"><a name='9389'>
<a name='9390'>
      nspad= nspa<a name='9391'>
      nspbd= nspb<a name='9392'>
      pavel= pavelc<a name='9393'>
      coldry= coldryc<a name='9394'>
      <a name='9395'>
      oneminusd = oneminus<a name='9396'>
<a name='9397'>
      dbflushcop()<a name='9398'>
     <a name='9399'>
      if (npart &gt; 1) then<a name='9400'>
         tauaa(1:pncol, :, :)  = tauap(colstart:(colstart+pncol-1), :, :)<a name='9401'>
      else<a name='9402'>
         tauaa = tauap<a name='9403'>
      endif<a name='9404'>
#endif<a name='9405'>
      end subroutine <a name='9406'>
<a name='9407'>
      end module gpu_rrtmg_lw_taumol<a name='9408'>
<a name='9409'>
<font color=#447700>! This is the gpu version of the setcoef routine.<a name='9410'></font>
<A NAME='GPU_RRTMG_LW_SETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='9411'>
      <font color=#993300>module </font><font color=#cc0000>gpu_rrtmg_lw_setcoef</font> <A href='../../call_to/GPU_RRTMG_LW_SETCOEF.html' TARGET='index'>1</A>,<A href='../../call_from/GPU_RRTMG_LW_SETCOEF.html' TARGET='index'>6</A><a name='9412'>
<a name='9413'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC'>gpu_rrtmg_lw_rtrnmc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_RTRNMC_1"><a name='9414'>
     <a name='9415'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_22">, only : nbndlw, mg, maxxsec, mxmol<a name='9416'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_4">, only: totplnk, totplk16, totplnkderiv, totplk16deriv<a name='9417'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_4">, only: hvrset, hnamset<a name='9418'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_14">, only : chi_mlsd<a name='9419'>
     <a name='9420'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL'>gpu_rrtmg_lw_taumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_TAUMOL_1"><a name='9421'>
   <a name='9422'>
      implicit none<a name='9423'>
<a name='9424'>
#ifdef _ACCEL<a name='9425'>
      real  _gpudev, allocatable :: taveld(:,:)          <font color=#447700>! layer temperatures (K)<a name='9426'></font>
                                                         <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9427'></font>
      real  _gpudev, allocatable :: tzd(:,:)             <font color=#447700>! level (interface) temperatures (K)<a name='9428'></font>
                                                         <font color=#447700>!    Dimensions: (ncol,0:nlayers)<a name='9429'></font>
      real  _gpudev, allocatable :: tboundd(:)           <font color=#447700>! surface temperature (K)<a name='9430'></font>
                                                         <font color=#447700>!    Dimensions: (ncol)<a name='9431'></font>
      real  _gpudev, allocatable :: wbroadd(:,:)         <font color=#447700>! broadening gas column density (mol/cm2)<a name='9432'></font>
                                                         <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9433'></font>
<a name='9434'>
      real  _gpudev :: totplnkd(181,nbndlw)<a name='9435'>
      real  _gpudev :: totplk16d(181)<a name='9436'>
<a name='9437'>
      real  _gpudev :: totplnkderivd(181,nbndlw)<a name='9438'>
      real  _gpudev :: totplk16derivd(181)<a name='9439'>
<font color=#447700>!$OMP THREADPRIVATE(taveld,tzd,tboundd,wbroadd,totplnkd,totplk16d,totplnkderivd,totplk16derivd)<a name='9440'></font>
#endif<a name='9441'>
<a name='9442'>
      contains<a name='9443'>
<a name='9444'>
<font color=#447700>! (dmb 2012) This subroutine allocates the needed GPU arrays<a name='9445'></font>
<A NAME='ALLOCATEGPUSETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUSETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9446'>
      <font color=#993300>subroutine </font><font color=#cc0000>allocateGPUSetCoef</font>( ncol, nlayers ) <A href='../../call_to/ALLOCATEGPUSETCOEF.html' TARGET='index'>1</A><a name='9447'>
<a name='9448'>
         integer, intent(in) :: ncol<a name='9449'>
         integer, intent(in) :: nlayers<a name='9450'>
#ifdef _ACCEL<a name='9451'>
         allocate( taveld( ncol, nlayers) )<a name='9452'>
         allocate( tzd( ncol, 0:nlayers) )<a name='9453'>
         allocate( tboundd( ncol ))<a name='9454'>
         allocate( wbroadd( ncol, nlayers) )<a name='9455'>
#endif<a name='9456'>
   <a name='9457'>
      end subroutine<a name='9458'>
<a name='9459'>
<font color=#447700>! (dmb 2012) This subroutine deallocates the GPU arrays<a name='9460'></font>
<A NAME='DEALLOCATEGPUSETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUSETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9461'>
      <font color=#993300>subroutine </font><font color=#cc0000>deallocateGPUSetCoef</font>( ) <A href='../../call_to/DEALLOCATEGPUSETCOEF.html' TARGET='index'>1</A><a name='9462'>
<a name='9463'>
#ifdef _ACCEL<a name='9464'>
         deallocate( taveld )<a name='9465'>
         deallocate( tzd )<a name='9466'>
         deallocate( tboundd)<a name='9467'>
         deallocate( wbroadd)<a name='9468'>
#endif<a name='9469'>
      <a name='9470'>
      end subroutine<a name='9471'>
<a name='9472'>
<font color=#447700>! (dmb 2012) Copy the needed reference data from the CPU to the GPU<a name='9473'></font>
<A NAME='COPYGPUSETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUSETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9474'>
      <font color=#993300>subroutine </font><font color=#cc0000>copyGPUSetCoef</font>() <A href='../../call_to/COPYGPUSETCOEF.html' TARGET='index'>1</A><a name='9475'>
<a name='9476'>
#ifdef _ACCEL<a name='9477'>
         totplnkd = totplnk<a name='9478'>
         totplk16d = totplk16<a name='9479'>
         totplnkderivd = totplnkderiv<a name='9480'>
         totplk16derivd = totplk16deriv<a name='9481'>
#endif<a name='9482'>
<a name='9483'>
      end subroutine<a name='9484'>
<a name='9485'>
<font color=#447700>!----------------------------------------------------------------------------<a name='9486'></font>
<A NAME='SETCOEFG'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#SETCOEFG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9487'>
      _gpuker <font color=#993300>subroutine </font><font color=#cc0000>setcoefg</font>(ncol, nlayers, istart                       &amp;<a name='9488'>
# include "<A href='../../html_code/include/rrtmg_lw_cpu_args.h.html'>rrtmg_lw_cpu_args.h</A>"<A NAME="rrtmg_lw_cpu_args.h_58"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#SETCOEFG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9489'>
# include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_59"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#SETCOEFG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9490'>
#ifndef _ACCEL<a name='9491'>
   ,taveld,tzd,tboundd,wbroadd,totplnkd,totplk16d,totplnkderivd,totplk16derivd &amp;<a name='9492'>
#endif<a name='9493'>
                                 )<a name='9494'>
<font color=#447700>!----------------------------------------------------------------------------<a name='9495'></font>
<font color=#447700>!<a name='9496'></font>
<font color=#447700>!  Purpose:  For a given atmosphere, calculate the indices and<a name='9497'></font>
<font color=#447700>!  fractions related to the pressure and temperature interpolations.<a name='9498'></font>
<font color=#447700>!  Also calculate the values of the integrated Planck functions <a name='9499'></font>
<font color=#447700>!  for each band at the level and layer temperatures.<a name='9500'></font>
<a name='9501'>
<font color=#447700>! ------- Declarations -------<a name='9502'></font>
#ifndef _ACCEL<a name='9503'>
# include "<A href='../../html_code/include/rrtmg_lw_cpu_defs.h.html'>rrtmg_lw_cpu_defs.h</A>"<A NAME="rrtmg_lw_cpu_defs.h_60"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#SETCOEFG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9504'>
# include "<A href='../../html_code/include/taug_cpu_defs.h.html'>taug_cpu_defs.h</A>"<A NAME="taug_cpu_defs.h_61"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#SETCOEFG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9505'>
      real  :: taveld(CHNK,nlayers+1)       <font color=#447700>! layer temperatures (K)<a name='9506'></font>
                                            <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9507'></font>
      real  :: tzd(CHNK,0:nlayers+1)        <font color=#447700>! level (interface) temperatures (K)<a name='9508'></font>
                                            <font color=#447700>!    Dimensions: (ncol,0:nlayers)<a name='9509'></font>
      real  :: tboundd(CHNK)                <font color=#447700>! surface temperature (K)<a name='9510'></font>
                                            <font color=#447700>!    Dimensions: (ncol)<a name='9511'></font>
      real  :: wbroadd(CHNK,nlayers+1)      <font color=#447700>! broadening gas column density (mol/cm2)<a name='9512'></font>
                                            <font color=#447700>!    Dimensions: (ncol,nlayers)<a name='9513'></font>
<a name='9514'>
      real  :: totplnkd(181,nbndlw)<a name='9515'>
      real  :: totplk16d(181)<a name='9516'>
<a name='9517'>
      real  :: totplnkderivd(181,nbndlw)<a name='9518'>
      real  :: totplk16derivd(181)<a name='9519'>
#endif<a name='9520'>
<a name='9521'>
<font color=#447700>! ----- Input -----<a name='9522'></font>
      integer , value, intent(in) :: ncol<a name='9523'>
      integer , value, intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='9524'></font>
      integer , value, intent(in) :: istart          <font color=#447700>! beginning band of calculation<a name='9525'></font>
<font color=#447700>!jm      integer , value, intent(in) :: idrv            ! Planck derivative option flag<a name='9526'></font>
<a name='9527'>
<font color=#447700>! ----- Local -----<a name='9528'></font>
      integer  :: indbound, indlev0<a name='9529'>
      integer  :: lay, indlay, indlev, iband<a name='9530'>
      integer  :: jp1<a name='9531'>
      real  :: stpfac, tbndfrac, t0frac, tlayfrac, tlevfrac<a name='9532'>
      real  :: dbdtlev, dbdtlay<a name='9533'>
      real  :: plog, fp, ft, ft1, water, scalefac, factor, compfp<a name='9534'>
      integer  :: iplon<a name='9535'>
      real  :: wv, lcoldry<a name='9536'>
<a name='9537'>
#ifdef _ACCEL<a name='9538'>
      iplon = (blockidx%x-1) * blockdim%x + threadidx%x<a name='9539'>
      if (iplon &lt;= ncol) then<a name='9540'>
#else<a name='9541'>
      do iplon = 1, ncol<a name='9542'>
#endif<a name='9543'>
<a name='9544'>
        stpfac = 296. /1013. <a name='9545'>
<a name='9546'>
        indbound = tboundd(iplon) - 159. <a name='9547'>
        if (indbound .lt. 1) then<a name='9548'>
           indbound = 1<a name='9549'>
        elseif (indbound .gt. 180) then<a name='9550'>
           indbound = 180<a name='9551'>
        endif<a name='9552'>
        tbndfrac = tboundd(iplon) - 159.  - float(indbound)<a name='9553'>
        indlev0 = tzd(iplon, 0) - 159. <a name='9554'>
        if (indlev0 .lt. 1) then<a name='9555'>
           indlev0 = 1<a name='9556'>
        elseif (indlev0 .gt. 180) then<a name='9557'>
           indlev0 = 180<a name='9558'>
        endif<a name='9559'>
        t0frac = tzd(iplon, 0) - 159.  - float(indlev0)<a name='9560'>
        laytrop(iplon) = 0<a name='9561'>
<a name='9562'>
<font color=#447700>! Begin layer loop <a name='9563'></font>
<font color=#447700>!  Calculate the integrated Planck functions for each band at the<a name='9564'></font>
<font color=#447700>!  surface, level, and layer temperatures.<a name='9565'></font>
        do lay = 1, nlayers<a name='9566'>
          indlay = taveld(iplon, lay) - 159. <a name='9567'>
          lcoldry = coldry( iplon, lay) <a name='9568'>
          wv = colh2o(iplon, lay) * lcoldry<a name='9569'>
          if (indlay .lt. 1) then<a name='9570'>
             indlay = 1<a name='9571'>
          elseif (indlay .gt. 180) then<a name='9572'>
             indlay = 180<a name='9573'>
          endif<a name='9574'>
          tlayfrac = taveld(iplon, lay) - 159.  - float(indlay)<a name='9575'>
          indlev = tzd(iplon, lay) - 159. <a name='9576'>
          if (indlev .lt. 1) then<a name='9577'>
             indlev = 1<a name='9578'>
          elseif (indlev .gt. 180) then<a name='9579'>
             indlev = 180<a name='9580'>
          endif<a name='9581'>
          tlevfrac = tzd(iplon, lay) - 159.  - float(indlev)<a name='9582'>
<a name='9583'>
<font color=#447700>! Begin spectral band loop <a name='9584'></font>
          do iband = 1, 15<a name='9585'>
            if (lay.eq.1) then<a name='9586'>
               dbdtlev = totplnkd(indbound+1,iband) - totplnkd(indbound,iband)<a name='9587'>
               plankbndd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9588'>
                   (totplnkd(indbound,iband) + tbndfrac * dbdtlev)<a name='9589'>
               dbdtlev = totplnkd(indlev0+1,iband)-totplnkd(indlev0,iband)<a name='9590'>
               planklevd(iplon, 0,iband) = totplnkd(indlev0,iband) + t0frac * dbdtlev<a name='9591'>
               if (idrvd .eq. 1) then <a name='9592'>
                  dbdtlev = totplnkderivd(indbound+1,iband) - totplnkderivd(indbound,iband)<a name='9593'>
                  dplankbnd_dtd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9594'>
                        (totplnkderivd(indbound,iband) + tbndfrac * dbdtlev)<a name='9595'>
               endif<a name='9596'>
            endif<a name='9597'>
            dbdtlev = totplnkd(indlev+1,iband) - totplnkd(indlev,iband)<a name='9598'>
            dbdtlay = totplnkd(indlay+1,iband) - totplnkd(indlay,iband)<a name='9599'>
            planklayd(iplon, lay,iband) = totplnkd(indlay,iband) + tlayfrac * dbdtlay<a name='9600'>
<a name='9601'>
            planklevd(iplon, lay,iband) = totplnkd(indlev,iband) + tlevfrac * dbdtlev<a name='9602'>
          enddo<a name='9603'>
<a name='9604'>
<font color=#447700>!  For band 16, if radiative transfer will be performed on just<a name='9605'></font>
<font color=#447700>!  this band, use integrated Planck values up to 3250 cm-1.  <a name='9606'></font>
<font color=#447700>!  If radiative transfer will be performed across all 16 bands,<a name='9607'></font>
<font color=#447700>!  then include in the integrated Planck values for this band<a name='9608'></font>
<font color=#447700>!  contributions from 2600 cm-1 to infinity.<a name='9609'></font>
          iband = 16<a name='9610'>
          if (istart .eq. 16) then<a name='9611'>
             if (lay.eq.1) then<a name='9612'>
                dbdtlev = totplk16d( indbound+1) - totplk16d( indbound)<a name='9613'>
                plankbndd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9614'>
                     (totplk16d( indbound) + tbndfrac * dbdtlev)<a name='9615'>
                if (idrvd .eq. 1) then<a name='9616'>
                   dbdtlev = totplk16derivd( indbound+1) - totplk16derivd( indbound)<a name='9617'>
                   dplankbnd_dtd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9618'>
                        (totplk16derivd(indbound) + tbndfrac * dbdtlev)<a name='9619'>
                endif<a name='9620'>
                dbdtlev = totplnkd(indlev0+1,iband)-totplnkd(indlev0,iband)<a name='9621'>
                planklevd(iplon, 0,iband) = totplk16d( indlev0) + &amp;<a name='9622'>
                     t0frac * dbdtlev<a name='9623'>
             endif<a name='9624'>
             dbdtlev = totplk16d( indlev+1) - totplk16d( indlev)<a name='9625'>
             dbdtlay = totplk16d( indlay+1) - totplk16d( indlay)<a name='9626'>
             planklayd(iplon, lay,iband) = totplk16d( indlay) + tlayfrac * dbdtlay<a name='9627'>
             planklevd(iplon, lay,iband) = totplk16d( indlev) + tlevfrac * dbdtlev<a name='9628'>
          else<a name='9629'>
             if (lay.eq.1) then<a name='9630'>
                dbdtlev = totplnkd(indbound+1,iband) - totplnkd(indbound,iband)<a name='9631'>
                plankbndd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9632'>
                     (totplnkd(indbound,iband) + tbndfrac * dbdtlev)<a name='9633'>
                if (idrvd .eq. 1) then <a name='9634'>
                   dbdtlev = totplnkderivd( indbound+1,iband) - totplnkderivd( indbound,iband)<a name='9635'>
                   dplankbnd_dtd(iplon, iband) = semissd(iplon, iband) * &amp;<a name='9636'>
                        (totplnkderivd( indbound,iband) + tbndfrac * dbdtlev)<a name='9637'>
                endif<a name='9638'>
                dbdtlev = totplnkd(indlev0+1,iband)-totplnkd(indlev0,iband)<a name='9639'>
                planklevd(iplon, 0,iband) = totplnkd(indlev0,iband) + t0frac * dbdtlev<a name='9640'>
             endif<a name='9641'>
             dbdtlev = totplnkd(indlev+1,iband) - totplnkd(indlev,iband)<a name='9642'>
             dbdtlay = totplnkd(indlay+1,iband) - totplnkd(indlay,iband)<a name='9643'>
             planklayd(iplon, lay,iband) = totplnkd(indlay,iband) + tlayfrac * dbdtlay<a name='9644'>
             planklevd(iplon, lay,iband) = totplnkd(indlev,iband) + tlevfrac * dbdtlev<a name='9645'>
          endif<a name='9646'>
<a name='9647'>
<a name='9648'>
<font color=#447700>!  Find the two reference pressures on either side of the<a name='9649'></font>
<font color=#447700>!  layer pressure.  Store them in JP and JP1.  Store in FP the<a name='9650'></font>
<font color=#447700>!  fraction of the difference (in ln(pressure)) between these<a name='9651'></font>
<font color=#447700>!  two values that the layer pressure lies.<a name='9652'></font>
<font color=#447700>!         plog = alog(pavel(lay))<a name='9653'></font>
          plog = alog(pavel(iplon, lay))<a name='9654'>
          jp(iplon, lay) = int(36.  - 5*(plog+0.04 ))<a name='9655'>
          if (jp(iplon, lay) .lt. 1) then<a name='9656'>
             jp(iplon, lay) = 1<a name='9657'>
          elseif (jp(iplon, lay) .gt. 58) then<a name='9658'>
             jp(iplon, lay) = 58<a name='9659'>
          endif<a name='9660'>
          jp1 = jp(iplon, lay) + 1<a name='9661'>
          fp = 5.  *(preflogd(jp(iplon, lay)) - plog)<a name='9662'>
<a name='9663'>
<font color=#447700>!  Determine, for each reference pressure (JP and JP1), which<a name='9664'></font>
<font color=#447700>!  reference temperature (these are different for each  <a name='9665'></font>
<font color=#447700>!  reference pressure) is nearest the layer temperature but does<a name='9666'></font>
<font color=#447700>!  not exceed it.  Store these indices in JT and JT1, resp.<a name='9667'></font>
<font color=#447700>!  Store in FT (resp. FT1) the fraction of the way between JT<a name='9668'></font>
<font color=#447700>!  (JT1) and the next highest reference temperature that the <a name='9669'></font>
<font color=#447700>!  layer temperature falls.<a name='9670'></font>
          jt(iplon, lay) = int(3.  + (taveld(iplon, lay)-trefd(jp(iplon, lay)))/15. )<a name='9671'>
          if (jt(iplon, lay) .lt. 1) then<a name='9672'>
             jt(iplon, lay) = 1<a name='9673'>
          elseif (jt(iplon, lay) .gt. 4) then<a name='9674'>
             jt(iplon, lay) = 4<a name='9675'>
          endif<a name='9676'>
          ft = ((taveld(iplon, lay)-trefd(jp(iplon, lay)))/15. ) - float(jt(iplon, lay)-3)<a name='9677'>
          jt1(iplon, lay) = int(3.  + (taveld(iplon, lay)-trefd( jp1))/15. )<a name='9678'>
          if (jt1(iplon, lay) .lt. 1) then<a name='9679'>
             jt1(iplon, lay) = 1<a name='9680'>
          elseif (jt1(iplon, lay) .gt. 4) then<a name='9681'>
             jt1(iplon, lay) = 4<a name='9682'>
          endif<a name='9683'>
          ft1 = ((taveld(iplon, lay)-trefd(jp1))/15. ) - float(jt1(iplon, lay)-3)<a name='9684'>
          water = wv/lcoldry<a name='9685'>
          scalefac = pavel(iplon, lay) * stpfac / taveld(iplon, lay)<a name='9686'>
<a name='9687'>
<font color=#447700>!  If the pressure is less than ~100mb, perform a different<a name='9688'></font>
<font color=#447700>!  set of species interpolations.<a name='9689'></font>
          if (plog .le. 4.56 ) go to 5300<a name='9690'>
          laytrop(iplon) =  laytrop(iplon) + 1<a name='9691'>
<a name='9692'>
          forfac(iplon, lay) = scalefac / (1.+water)<a name='9693'>
          factor = (332.0 -taveld(iplon, lay))/36.0 <a name='9694'>
          indfor(iplon, lay) = min(2, max(1, int(factor)))<a name='9695'>
          forfrac(iplon, lay) = factor - float(indfor(iplon, lay))<a name='9696'>
<a name='9697'>
<font color=#447700>!  Set up factors needed to separately include the water vapor<a name='9698'></font>
<font color=#447700>!  self-continuum in the calculation of absorption coefficient.<a name='9699'></font>
          selffac(iplon, lay) = water * forfac(iplon, lay)<a name='9700'>
          factor = (taveld(iplon, lay)-188.0 )/7.2 <a name='9701'>
          indself(iplon, lay) = min(9, max(1, int(factor)-7))<a name='9702'>
          selffrac(iplon, lay) = factor - float(indself(iplon, lay) + 7)<a name='9703'>
<a name='9704'>
<font color=#447700>!  Set up factors needed to separately include the minor gases<a name='9705'></font>
<font color=#447700>!  in the calculation of absorption coefficient<a name='9706'></font>
          scaleminor(iplon, lay) = pavel(iplon, lay)/taveld(iplon, lay)<a name='9707'>
          scaleminorn2(iplon, lay) = (pavel(iplon, lay)/taveld(iplon, lay)) &amp;<a name='9708'>
              *(wbroadd(iplon, lay)/(lcoldry+wv))<a name='9709'>
          factor = (taveld(iplon, lay)-180.8 )/7.2 <a name='9710'>
          indminor(iplon, lay) = min(18, max(1, int(factor)))<a name='9711'>
          minorfrac(iplon, lay) = factor - float(indminor(iplon, lay))<a name='9712'>
<a name='9713'>
<font color=#447700>!  Setup reference ratio to be used in calculation of binary<a name='9714'></font>
<font color=#447700>!  species parameter in lower atmosphere.<a name='9715'></font>
          rat_h2oco2(iplon, lay)=chi_mlsd( 1,jp(iplon, lay))/chi_mlsd( 2,jp(iplon, lay))<a name='9716'>
          rat_h2oco2_1(iplon, lay)=chi_mlsd( 1,jp(iplon, lay)+1)/chi_mlsd( 2,jp(iplon, lay)+1)<a name='9717'>
<a name='9718'>
          rat_h2oo3(iplon, lay)=chi_mlsd( 1,jp(iplon, lay))/chi_mlsd( 3,jp(iplon, lay))<a name='9719'>
          rat_h2oo3_1(iplon, lay)=chi_mlsd( 1,jp(iplon, lay)+1)/chi_mlsd( 3,jp(iplon, lay)+1)<a name='9720'>
<a name='9721'>
          rat_h2on2o(iplon, lay)=chi_mlsd( 1,jp(iplon, lay))/chi_mlsd( 4,jp(iplon, lay))<a name='9722'>
          rat_h2on2o_1(iplon, lay)=chi_mlsd( 1,jp(iplon, lay)+1)/chi_mlsd( 4,jp(iplon, lay)+1)<a name='9723'>
<a name='9724'>
          rat_h2och4(iplon, lay)=chi_mlsd( 1,jp(iplon, lay))/chi_mlsd( 6,jp(iplon, lay))<a name='9725'>
          rat_h2och4_1(iplon, lay)=chi_mlsd( 1,jp(iplon, lay)+1)/chi_mlsd( 6,jp(iplon, lay)+1)<a name='9726'>
<a name='9727'>
          rat_n2oco2(iplon, lay)=chi_mlsd( 4,jp(iplon, lay))/chi_mlsd( 2,jp(iplon, lay))<a name='9728'>
          rat_n2oco2_1(iplon, lay)=chi_mlsd( 4,jp(iplon, lay)+1)/chi_mlsd( 2,jp(iplon, lay)+1)<a name='9729'>
<a name='9730'>
<font color=#447700>!  Calculate needed column amounts.<a name='9731'></font>
          colh2o(iplon, lay) = 1.e-20  * colh2o(iplon, lay) * lcoldry<a name='9732'>
          colco2(iplon, lay) = 1.e-20  *  colco2(iplon, lay) * lcoldry<a name='9733'>
          colo3(iplon, lay) = 1.e-20  * colo3(iplon, lay) * lcoldry<a name='9734'>
          coln2o(iplon, lay) = 1.e-20  * coln2o(iplon, lay) * lcoldry<a name='9735'>
          colco(iplon, lay) = 1.e-20  * colco(iplon, lay) * lcoldry<a name='9736'>
          colch4(iplon, lay) = 1.e-20  * colch4(iplon, lay) * lcoldry<a name='9737'>
          colo2(iplon, lay) = 1.e-20  * colo2(iplon, lay) * lcoldry<a name='9738'>
          if (colco2(iplon, lay) .eq. 0. ) colco2(iplon, lay) = 1.e-32  * lcoldry<a name='9739'>
          if (colo3(iplon, lay) .eq. 0. ) colo3(iplon, lay) = 1.e-32  * lcoldry<a name='9740'>
          if (coln2o(iplon, lay) .eq. 0. ) coln2o(iplon, lay) = 1.e-32  * lcoldry<a name='9741'>
          if (colco(iplon, lay) .eq. 0. ) colco(iplon, lay) = 1.e-32  * lcoldry<a name='9742'>
          if (colch4(iplon, lay) .eq. 0. ) colch4(iplon, lay) = 1.e-32  * lcoldry<a name='9743'>
          colbrd(iplon, lay) = 1.e-20  * wbroadd(iplon, lay)<a name='9744'>
          go to 5400<a name='9745'>
<a name='9746'>
<font color=#447700>!  Above laytrop.<a name='9747'></font>
 5300     continue<a name='9748'>
<a name='9749'>
          forfac(iplon, lay) = scalefac / (1.+water)<a name='9750'>
          factor = (taveld(iplon, lay)-188.0 )/36.0 <a name='9751'>
          indfor(iplon, lay) = 3<a name='9752'>
          forfrac(iplon, lay) = factor - 1.0 <a name='9753'>
<a name='9754'>
<font color=#447700>!  Set up factors needed to separately include the water vapor<a name='9755'></font>
<font color=#447700>!  self-continuum in the calculation of absorption coefficient.<a name='9756'></font>
          selffac(iplon, lay) = water * forfac(iplon, lay)<a name='9757'>
<a name='9758'>
<font color=#447700>!  Set up factors needed to separately include the minor gases<a name='9759'></font>
<font color=#447700>!  in the calculation of absorption coefficient<a name='9760'></font>
          scaleminor(iplon, lay) = pavel(iplon, lay)/taveld(iplon, lay)         <a name='9761'>
          scaleminorn2(iplon, lay) = (pavel(iplon, lay)/taveld(iplon, lay)) &amp;<a name='9762'>
              * (wbroadd(iplon, lay)/(coldry(iplon, lay)+wv))<a name='9763'>
          factor = (taveld(iplon, lay)-180.8 )/7.2 <a name='9764'>
          indminor(iplon, lay) = min(18, max(1, int(factor)))<a name='9765'>
          minorfrac(iplon, lay) = factor - float(indminor(iplon, lay))<a name='9766'>
<a name='9767'>
<font color=#447700>!  Setup reference ratio to be used in calculation of binary<a name='9768'></font>
<font color=#447700>!  species parameter in upper atmosphere.<a name='9769'></font>
          rat_h2oco2(iplon, lay)=chi_mlsd( 1,jp(iplon, lay))/chi_mlsd( 2,jp(iplon, lay))<a name='9770'>
          rat_h2oco2_1(iplon, lay)=chi_mlsd( 1,jp(iplon, lay)+1)/chi_mlsd( 2,jp(iplon, lay)+1) <a name='9771'>
<a name='9772'>
          rat_o3co2(iplon, lay)=chi_mlsd( 3,jp(iplon, lay))/chi_mlsd( 2,jp(iplon, lay))<a name='9773'>
          rat_o3co2_1(iplon, lay)=chi_mlsd( 3,jp(iplon, lay)+1)/chi_mlsd( 2,jp(iplon, lay)+1)         <a name='9774'>
<a name='9775'>
<font color=#447700>!  Calculate needed column amounts.<a name='9776'></font>
          colh2o(iplon, lay) = 1.e-20  * colh2o(iplon, lay) * lcoldry<a name='9777'>
          colco2(iplon, lay) = 1.e-20  *  colco2(iplon, lay) * lcoldry<a name='9778'>
          colo3(iplon, lay) = 1.e-20  * colo3(iplon, lay) * lcoldry<a name='9779'>
          coln2o(iplon, lay) = 1.e-20  * coln2o(iplon, lay) * lcoldry<a name='9780'>
          colco(iplon, lay) = 1.e-20  * colco(iplon, lay) * lcoldry<a name='9781'>
          colch4(iplon, lay) = 1.e-20  * colch4(iplon, lay) * lcoldry<a name='9782'>
          colo2(iplon, lay) = 1.e-20  * colo2(iplon, lay) * lcoldry<a name='9783'>
          if (colco2(iplon, lay) .eq. 0. ) colco2(iplon, lay) = 1.e-32  * lcoldry<a name='9784'>
          if (colo3(iplon, lay) .eq. 0. ) colo3(iplon, lay) = 1.e-32  * lcoldry<a name='9785'>
          if (coln2o(iplon, lay) .eq. 0. ) coln2o(iplon, lay) = 1.e-32  * lcoldry<a name='9786'>
          if (colco(iplon, lay)  .eq. 0. ) colco(iplon, lay) = 1.e-32  * lcoldry<a name='9787'>
          if (colch4(iplon, lay) .eq. 0. ) colch4(iplon, lay) = 1.e-32  * lcoldry<a name='9788'>
          colbrd(iplon, lay) = 1.e-20  * wbroadd(iplon, lay)<a name='9789'>
 5400     continue<a name='9790'>
<a name='9791'>
<font color=#447700>!  We have now isolated the layer ln pressure and temperature,<a name='9792'></font>
<font color=#447700>!  between two reference pressures and two reference temperatures <a name='9793'></font>
<font color=#447700>!  (for each reference pressure).  We multiply the pressure <a name='9794'></font>
<font color=#447700>!  fraction FP with the appropriate temperature fractions to get <a name='9795'></font>
<font color=#447700>!  the factors that will be needed for the interpolation that yields<a name='9796'></font>
<font color=#447700>!  the optical depths (performed in routines TAUGBn for band n).`<a name='9797'></font>
<a name='9798'>
          compfp = 1. - fp<a name='9799'>
          fac10(iplon, lay) = compfp * ft<a name='9800'>
          fac00(iplon, lay) = compfp * (1.  - ft)<a name='9801'>
          fac11(iplon, lay) = fp * ft1<a name='9802'>
          fac01(iplon, lay) = fp * (1.  - ft1)<a name='9803'>
<a name='9804'>
<font color=#447700>!  Rescale selffac and forfac for use in taumol<a name='9805'></font>
          selffac(iplon, lay) = colh2o(iplon, lay)*selffac(iplon, lay)<a name='9806'>
          forfac(iplon, lay) = colh2o(iplon, lay)*forfac(iplon, lay)<a name='9807'>
<font color=#447700>! End layer loop<a name='9808'></font>
        enddo<a name='9809'>
<a name='9810'>
#ifdef _ACCEL<a name='9811'>
      endif<a name='9812'>
#else<a name='9813'>
      end do<a name='9814'>
#endif<a name='9815'>
      end subroutine setcoefg<a name='9816'>
<a name='9817'>
      end module gpu_rrtmg_lw_setcoef<a name='9818'>
<a name='9819'>
<A NAME='RRTMG_LW_SETCOEF_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_SETCOEF_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='9820'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_setcoef_f</font> <A href='../../call_to/RRTMG_LW_SETCOEF_F.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_SETCOEF_F.html' TARGET='index'>3</A><a name='9821'>
<a name='9822'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='9823'></font>
<font color=#447700>! |                                                                          |<a name='9824'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='9825'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='9826'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='9827'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='9828'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='9829'></font>
<font color=#447700>! |                                                                          |<a name='9830'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='9831'></font>
<a name='9832'>
<font color=#447700>! ------- Modules -------<a name='9833'></font>
<a name='9834'>
<font color=#447700>!     use parkind, only : im =&gt; kind , rb =&gt; kind <a name='9835'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_SETCOEF_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_23">, only : nbndlw, mg, maxxsec, mxmol<a name='9836'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_SETCOEF_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_5">, only: totplnk, totplk16, totplnkderiv, totplk16deriv<a name='9837'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_REF_F'>rrlw_ref_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_SETCOEF_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_F_15"><a name='9838'>
<a name='9839'>
      implicit none<a name='9840'>
<a name='9841'>
      contains<a name='9842'>
<a name='9843'>
<font color=#447700>!***************************************************************************<a name='9844'></font>
<A NAME='LWATMREF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWATMREF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9845'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwatmref</font> <A href='../../call_to/LWATMREF.html' TARGET='index'>2</A><a name='9846'>
<font color=#447700>!***************************************************************************<a name='9847'></font>
<a name='9848'>
      save<a name='9849'>
 <a name='9850'>
<font color=#447700>! These pressures are chosen such that the ln of the first pressure<a name='9851'></font>
<font color=#447700>! has only a few non-zero digits (i.e. ln(PREF(1)) = 6.96000) and<a name='9852'></font>
<font color=#447700>! each subsequent ln(pressure) differs from the previous one by 0.2.<a name='9853'></font>
<a name='9854'>
      pref(:) = (/ &amp;<a name='9855'>
          1.05363e+03 ,8.62642e+02 ,7.06272e+02 ,5.78246e+02 ,4.73428e+02 , &amp;<a name='9856'>
          3.87610e+02 ,3.17348e+02 ,2.59823e+02 ,2.12725e+02 ,1.74164e+02 , &amp;<a name='9857'>
          1.42594e+02 ,1.16746e+02 ,9.55835e+01 ,7.82571e+01 ,6.40715e+01 , &amp;<a name='9858'>
          5.24573e+01 ,4.29484e+01 ,3.51632e+01 ,2.87892e+01 ,2.35706e+01 , &amp;<a name='9859'>
          1.92980e+01 ,1.57998e+01 ,1.29358e+01 ,1.05910e+01 ,8.67114e+00 , &amp;<a name='9860'>
          7.09933e+00 ,5.81244e+00 ,4.75882e+00 ,3.89619e+00 ,3.18993e+00 , &amp;<a name='9861'>
          2.61170e+00 ,2.13828e+00 ,1.75067e+00 ,1.43333e+00 ,1.17351e+00 , &amp;<a name='9862'>
          9.60789e-01 ,7.86628e-01 ,6.44036e-01 ,5.27292e-01 ,4.31710e-01 , &amp;<a name='9863'>
          3.53455e-01 ,2.89384e-01 ,2.36928e-01 ,1.93980e-01 ,1.58817e-01 , &amp;<a name='9864'>
          1.30029e-01 ,1.06458e-01 ,8.71608e-02 ,7.13612e-02 ,5.84256e-02 , &amp;<a name='9865'>
          4.78349e-02 ,3.91639e-02 ,3.20647e-02 ,2.62523e-02 ,2.14936e-02 , &amp;<a name='9866'>
          1.75975e-02 ,1.44076e-02 ,1.17959e-02 ,9.65769e-03 /)<a name='9867'>
<a name='9868'>
      preflog(:) = (/ &amp;<a name='9869'>
           6.9600e+00 , 6.7600e+00 , 6.5600e+00 , 6.3600e+00 , 6.1600e+00 , &amp;<a name='9870'>
           5.9600e+00 , 5.7600e+00 , 5.5600e+00 , 5.3600e+00 , 5.1600e+00 , &amp;<a name='9871'>
           4.9600e+00 , 4.7600e+00 , 4.5600e+00 , 4.3600e+00 , 4.1600e+00 , &amp;<a name='9872'>
           3.9600e+00 , 3.7600e+00 , 3.5600e+00 , 3.3600e+00 , 3.1600e+00 , &amp;<a name='9873'>
           2.9600e+00 , 2.7600e+00 , 2.5600e+00 , 2.3600e+00 , 2.1600e+00 , &amp;<a name='9874'>
           1.9600e+00 , 1.7600e+00 , 1.5600e+00 , 1.3600e+00 , 1.1600e+00 , &amp;<a name='9875'>
           9.6000e-01 , 7.6000e-01 , 5.6000e-01 , 3.6000e-01 , 1.6000e-01 , &amp;<a name='9876'>
          -4.0000e-02 ,-2.4000e-01 ,-4.4000e-01 ,-6.4000e-01 ,-8.4000e-01 , &amp;<a name='9877'>
          -1.0400e+00 ,-1.2400e+00 ,-1.4400e+00 ,-1.6400e+00 ,-1.8400e+00 , &amp;<a name='9878'>
          -2.0400e+00 ,-2.2400e+00 ,-2.4400e+00 ,-2.6400e+00 ,-2.8400e+00 , &amp;<a name='9879'>
          -3.0400e+00 ,-3.2400e+00 ,-3.4400e+00 ,-3.6400e+00 ,-3.8400e+00 , &amp;<a name='9880'>
          -4.0400e+00 ,-4.2400e+00 ,-4.4400e+00 ,-4.6400e+00 /)<a name='9881'>
<a name='9882'>
<font color=#447700>! These are the temperatures associated with the respective <a name='9883'></font>
<font color=#447700>! pressures for the mls standard atmosphere. <a name='9884'></font>
<a name='9885'>
      tref(:) = (/ &amp;<a name='9886'>
           2.9420e+02 , 2.8799e+02 , 2.7894e+02 , 2.6925e+02 , 2.5983e+02 , &amp;<a name='9887'>
           2.5017e+02 , 2.4077e+02 , 2.3179e+02 , 2.2306e+02 , 2.1578e+02 , &amp;<a name='9888'>
           2.1570e+02 , 2.1570e+02 , 2.1570e+02 , 2.1706e+02 , 2.1858e+02 , &amp;<a name='9889'>
           2.2018e+02 , 2.2174e+02 , 2.2328e+02 , 2.2479e+02 , 2.2655e+02 , &amp;<a name='9890'>
           2.2834e+02 , 2.3113e+02 , 2.3401e+02 , 2.3703e+02 , 2.4022e+02 , &amp;<a name='9891'>
           2.4371e+02 , 2.4726e+02 , 2.5085e+02 , 2.5457e+02 , 2.5832e+02 , &amp;<a name='9892'>
           2.6216e+02 , 2.6606e+02 , 2.6999e+02 , 2.7340e+02 , 2.7536e+02 , &amp;<a name='9893'>
           2.7568e+02 , 2.7372e+02 , 2.7163e+02 , 2.6955e+02 , 2.6593e+02 , &amp;<a name='9894'>
           2.6211e+02 , 2.5828e+02 , 2.5360e+02 , 2.4854e+02 , 2.4348e+02 , &amp;<a name='9895'>
           2.3809e+02 , 2.3206e+02 , 2.2603e+02 , 2.2000e+02 , 2.1435e+02 , &amp;<a name='9896'>
           2.0887e+02 , 2.0340e+02 , 1.9792e+02 , 1.9290e+02 , 1.8809e+02 , &amp;<a name='9897'>
           1.8329e+02 , 1.7849e+02 , 1.7394e+02 , 1.7212e+02 /)<a name='9898'>
<a name='9899'>
       chi_mls(1,1:12) = (/ &amp;<a name='9900'>
        1.8760e-02 , 1.2223e-02 , 5.8909e-03 , 2.7675e-03 , 1.4065e-03 , &amp;<a name='9901'>
        7.5970e-04 , 3.8876e-04 , 1.6542e-04 , 3.7190e-05 , 7.4765e-06 , &amp;<a name='9902'>
        4.3082e-06 , 3.3319e-06 /)<a name='9903'>
       chi_mls(1,13:59) = (/ &amp;<a name='9904'>
        3.2039e-06 ,  3.1619e-06 ,  3.2524e-06 ,  3.4226e-06 ,  3.6288e-06 , &amp;<a name='9905'>
        3.9148e-06 ,  4.1488e-06 ,  4.3081e-06 ,  4.4420e-06 ,  4.5778e-06 , &amp;<a name='9906'>
        4.7087e-06 ,  4.7943e-06 ,  4.8697e-06 ,  4.9260e-06 ,  4.9669e-06 , &amp;<a name='9907'>
        4.9963e-06 ,  5.0527e-06 ,  5.1266e-06 ,  5.2503e-06 ,  5.3571e-06 , &amp;<a name='9908'>
        5.4509e-06 ,  5.4830e-06 ,  5.5000e-06 ,  5.5000e-06 ,  5.4536e-06 , &amp;<a name='9909'>
        5.4047e-06 ,  5.3558e-06 ,  5.2533e-06 ,  5.1436e-06 ,  5.0340e-06 , &amp;<a name='9910'>
        4.8766e-06 ,  4.6979e-06 ,  4.5191e-06 ,  4.3360e-06 ,  4.1442e-06 , &amp;<a name='9911'>
        3.9523e-06 ,  3.7605e-06 ,  3.5722e-06 ,  3.3855e-06 ,  3.1988e-06 , &amp;<a name='9912'>
        3.0121e-06 ,  2.8262e-06 ,  2.6407e-06 ,  2.4552e-06 ,  2.2696e-06 , &amp;<a name='9913'>
        4.3360e-06 ,  4.1442e-06 /)<a name='9914'>
       chi_mls(2,1:12) = (/ &amp;<a name='9915'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9916'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9917'>
        3.5500e-04 ,  3.5500e-04 /)<a name='9918'>
       chi_mls(2,13:59) = (/ &amp;<a name='9919'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9920'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9921'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9922'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9923'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9924'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9925'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9926'>
        3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 ,  3.5500e-04 , &amp;<a name='9927'>
        3.5500e-04 ,  3.5471e-04 ,  3.5427e-04 ,  3.5384e-04 ,  3.5340e-04 , &amp;<a name='9928'>
        3.5500e-04 ,  3.5500e-04 /)<a name='9929'>
       chi_mls(3,1:12) = (/ &amp;<a name='9930'>
        3.0170e-08 ,  3.4725e-08 ,  4.2477e-08 ,  5.2759e-08 ,  6.6944e-08 , &amp;<a name='9931'>
        8.7130e-08 ,  1.1391e-07 ,  1.5677e-07 ,  2.1788e-07 ,  3.2443e-07 , &amp;<a name='9932'>
        4.6594e-07 ,  5.6806e-07 /)<a name='9933'>
       chi_mls(3,13:59) = (/ &amp;<a name='9934'>
        6.9607e-07 ,  1.1186e-06 ,  1.7618e-06 ,  2.3269e-06 ,  2.9577e-06 , &amp;<a name='9935'>
        3.6593e-06 ,  4.5950e-06 ,  5.3189e-06 ,  5.9618e-06 ,  6.5113e-06 , &amp;<a name='9936'>
        7.0635e-06 ,  7.6917e-06 ,  8.2577e-06 ,  8.7082e-06 ,  8.8325e-06 , &amp;<a name='9937'>
        8.7149e-06 ,  8.0943e-06 ,  7.3307e-06 ,  6.3101e-06 ,  5.3672e-06 , &amp;<a name='9938'>
        4.4829e-06 ,  3.8391e-06 ,  3.2827e-06 ,  2.8235e-06 ,  2.4906e-06 , &amp;<a name='9939'>
        2.1645e-06 ,  1.8385e-06 ,  1.6618e-06 ,  1.5052e-06 ,  1.3485e-06 , &amp;<a name='9940'>
        1.1972e-06 ,  1.0482e-06 ,  8.9926e-07 ,  7.6343e-07 ,  6.5381e-07 , &amp;<a name='9941'>
        5.4419e-07 ,  4.3456e-07 ,  3.6421e-07 ,  3.1194e-07 ,  2.5967e-07 , &amp;<a name='9942'>
        2.0740e-07 ,  1.9146e-07 ,  1.9364e-07 ,  1.9582e-07 ,  1.9800e-07 , &amp;<a name='9943'>
        7.6343e-07 ,  6.5381e-07 /)<a name='9944'>
       chi_mls(4,1:12) = (/ &amp;<a name='9945'>
        3.2000e-07 ,  3.2000e-07 ,  3.2000e-07 ,  3.2000e-07 ,  3.2000e-07 , &amp;<a name='9946'>
        3.1965e-07 ,  3.1532e-07 ,  3.0383e-07 ,  2.9422e-07 ,  2.8495e-07 , &amp;<a name='9947'>
        2.7671e-07 ,  2.6471e-07 /)<a name='9948'>
       chi_mls(4,13:59) = (/ &amp;<a name='9949'>
        2.4285e-07 ,  2.0955e-07 ,  1.7195e-07 ,  1.3749e-07 ,  1.1332e-07 , &amp;<a name='9950'>
        1.0035e-07 ,  9.1281e-08 ,  8.5463e-08 ,  8.0363e-08 ,  7.3372e-08 , &amp;<a name='9951'>
        6.5975e-08 ,  5.6039e-08 ,  4.7090e-08 ,  3.9977e-08 ,  3.2979e-08 , &amp;<a name='9952'>
        2.6064e-08 ,  2.1066e-08 ,  1.6592e-08 ,  1.3017e-08 ,  1.0090e-08 , &amp;<a name='9953'>
        7.6249e-09 ,  6.1159e-09 ,  4.6672e-09 ,  3.2857e-09 ,  2.8484e-09 , &amp;<a name='9954'>
        2.4620e-09 ,  2.0756e-09 ,  1.8551e-09 ,  1.6568e-09 ,  1.4584e-09 , &amp;<a name='9955'>
        1.3195e-09 ,  1.2072e-09 ,  1.0948e-09 ,  9.9780e-10 ,  9.3126e-10 , &amp;<a name='9956'>
        8.6472e-10 ,  7.9818e-10 ,  7.5138e-10 ,  7.1367e-10 ,  6.7596e-10 , &amp;<a name='9957'>
        6.3825e-10 ,  6.0981e-10 ,  5.8600e-10 ,  5.6218e-10 ,  5.3837e-10 , &amp;<a name='9958'>
        9.9780e-10 ,  9.3126e-10 /)<a name='9959'>
       chi_mls(5,1:12) = (/ &amp;<a name='9960'>
        1.5000e-07 ,  1.4306e-07 ,  1.3474e-07 ,  1.3061e-07 ,  1.2793e-07 , &amp;<a name='9961'>
        1.2038e-07 ,  1.0798e-07 ,  9.4238e-08 ,  7.9488e-08 ,  6.1386e-08 , &amp;<a name='9962'>
        4.5563e-08 ,  3.3475e-08 /)<a name='9963'>
       chi_mls(5,13:59) = (/ &amp;<a name='9964'>
        2.5118e-08 ,  1.8671e-08 ,  1.4349e-08 ,  1.2501e-08 ,  1.2407e-08 , &amp;<a name='9965'>
        1.3472e-08 ,  1.4900e-08 ,  1.6079e-08 ,  1.7156e-08 ,  1.8616e-08 , &amp;<a name='9966'>
        2.0106e-08 ,  2.1654e-08 ,  2.3096e-08 ,  2.4340e-08 ,  2.5643e-08 , &amp;<a name='9967'>
        2.6990e-08 ,  2.8456e-08 ,  2.9854e-08 ,  3.0943e-08 ,  3.2023e-08 , &amp;<a name='9968'>
        3.3101e-08 ,  3.4260e-08 ,  3.5360e-08 ,  3.6397e-08 ,  3.7310e-08 , &amp;<a name='9969'>
        3.8217e-08 ,  3.9123e-08 ,  4.1303e-08 ,  4.3652e-08 ,  4.6002e-08 , &amp;<a name='9970'>
        5.0289e-08 ,  5.5446e-08 ,  6.0603e-08 ,  6.8946e-08 ,  8.3652e-08 , &amp;<a name='9971'>
        9.8357e-08 ,  1.1306e-07 ,  1.4766e-07 ,  1.9142e-07 ,  2.3518e-07 , &amp;<a name='9972'>
        2.7894e-07 ,  3.5001e-07 ,  4.3469e-07 ,  5.1938e-07 ,  6.0407e-07 , &amp;<a name='9973'>
        6.8946e-08 ,  8.3652e-08 /)<a name='9974'>
       chi_mls(6,1:12) = (/ &amp;<a name='9975'>
        1.7000e-06 ,  1.7000e-06 ,  1.6999e-06 ,  1.6904e-06 ,  1.6671e-06 , &amp;<a name='9976'>
        1.6351e-06 ,  1.6098e-06 ,  1.5590e-06 ,  1.5120e-06 ,  1.4741e-06 , &amp;<a name='9977'>
        1.4385e-06 ,  1.4002e-06 /)<a name='9978'>
       chi_mls(6,13:59) = (/ &amp;<a name='9979'>
        1.3573e-06 ,  1.3130e-06 ,  1.2512e-06 ,  1.1668e-06 ,  1.0553e-06 , &amp;<a name='9980'>
        9.3281e-07 ,  8.1217e-07 ,  7.5239e-07 ,  7.0728e-07 ,  6.6722e-07 , &amp;<a name='9981'>
        6.2733e-07 ,  5.8604e-07 ,  5.4769e-07 ,  5.1480e-07 ,  4.8206e-07 , &amp;<a name='9982'>
        4.4943e-07 ,  4.1702e-07 ,  3.8460e-07 ,  3.5200e-07 ,  3.1926e-07 , &amp;<a name='9983'>
        2.8646e-07 ,  2.5498e-07 ,  2.2474e-07 ,  1.9588e-07 ,  1.8295e-07 , &amp;<a name='9984'>
        1.7089e-07 ,  1.5882e-07 ,  1.5536e-07 ,  1.5304e-07 ,  1.5072e-07 , &amp;<a name='9985'>
        1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 , &amp;<a name='9986'>
        1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 , &amp;<a name='9987'>
        1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 ,  1.5000e-07 , &amp;<a name='9988'>
        1.5000e-07 ,  1.5000e-07 /)<a name='9989'>
       chi_mls(7,1:12) = (/ &amp;<a name='9990'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9991'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9992'>
        0.2090 ,  0.2090 /)<a name='9993'>
       chi_mls(7,13:59) = (/ &amp;<a name='9994'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9995'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9996'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9997'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9998'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='9999'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='10000'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='10001'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='10002'>
        0.2090 ,  0.2090 ,  0.2090 ,  0.2090 ,  0.2090 , &amp;<a name='10003'>
        0.2090 ,  0.2090 /)<a name='10004'>
<a name='10005'>
      end subroutine lwatmref<a name='10006'>
<a name='10007'>
<font color=#447700>!***************************************************************************<a name='10008'></font>
<A NAME='LWAVPLANK'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWAVPLANK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='10009'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwavplank</font> <A href='../../call_to/LWAVPLANK.html' TARGET='index'>2</A><a name='10010'>
<font color=#447700>!***************************************************************************<a name='10011'></font>
<a name='10012'>
      save<a name='10013'>
 <a name='10014'>
      totplnk(1:50,  1) = (/ &amp;<a name='10015'>
      0.14783e-05 ,0.15006e-05 ,0.15230e-05 ,0.15455e-05 ,0.15681e-05 , &amp;<a name='10016'>
      0.15908e-05 ,0.16136e-05 ,0.16365e-05 ,0.16595e-05 ,0.16826e-05 , &amp;<a name='10017'>
      0.17059e-05 ,0.17292e-05 ,0.17526e-05 ,0.17762e-05 ,0.17998e-05 , &amp;<a name='10018'>
      0.18235e-05 ,0.18473e-05 ,0.18712e-05 ,0.18953e-05 ,0.19194e-05 , &amp;<a name='10019'>
      0.19435e-05 ,0.19678e-05 ,0.19922e-05 ,0.20166e-05 ,0.20412e-05 , &amp;<a name='10020'>
      0.20658e-05 ,0.20905e-05 ,0.21153e-05 ,0.21402e-05 ,0.21652e-05 , &amp;<a name='10021'>
      0.21902e-05 ,0.22154e-05 ,0.22406e-05 ,0.22659e-05 ,0.22912e-05 , &amp;<a name='10022'>
      0.23167e-05 ,0.23422e-05 ,0.23678e-05 ,0.23934e-05 ,0.24192e-05 , &amp;<a name='10023'>
      0.24450e-05 ,0.24709e-05 ,0.24968e-05 ,0.25229e-05 ,0.25490e-05 , &amp;<a name='10024'>
      0.25751e-05 ,0.26014e-05 ,0.26277e-05 ,0.26540e-05 ,0.26805e-05 /)<a name='10025'>
      totplnk(51:100,  1) = (/ &amp;<a name='10026'>
      0.27070e-05 ,0.27335e-05 ,0.27602e-05 ,0.27869e-05 ,0.28136e-05 , &amp;<a name='10027'>
      0.28404e-05 ,0.28673e-05 ,0.28943e-05 ,0.29213e-05 ,0.29483e-05 , &amp;<a name='10028'>
      0.29754e-05 ,0.30026e-05 ,0.30298e-05 ,0.30571e-05 ,0.30845e-05 , &amp;<a name='10029'>
      0.31119e-05 ,0.31393e-05 ,0.31669e-05 ,0.31944e-05 ,0.32220e-05 , &amp;<a name='10030'>
      0.32497e-05 ,0.32774e-05 ,0.33052e-05 ,0.33330e-05 ,0.33609e-05 , &amp;<a name='10031'>
      0.33888e-05 ,0.34168e-05 ,0.34448e-05 ,0.34729e-05 ,0.35010e-05 , &amp;<a name='10032'>
      0.35292e-05 ,0.35574e-05 ,0.35857e-05 ,0.36140e-05 ,0.36424e-05 , &amp;<a name='10033'>
      0.36708e-05 ,0.36992e-05 ,0.37277e-05 ,0.37563e-05 ,0.37848e-05 , &amp;<a name='10034'>
      0.38135e-05 ,0.38421e-05 ,0.38708e-05 ,0.38996e-05 ,0.39284e-05 , &amp;<a name='10035'>
      0.39572e-05 ,0.39861e-05 ,0.40150e-05 ,0.40440e-05 ,0.40730e-05 /)<a name='10036'>
      totplnk(101:150,  1) = (/ &amp;<a name='10037'>
      0.41020e-05 ,0.41311e-05 ,0.41602e-05 ,0.41893e-05 ,0.42185e-05 , &amp;<a name='10038'>
      0.42477e-05 ,0.42770e-05 ,0.43063e-05 ,0.43356e-05 ,0.43650e-05 , &amp;<a name='10039'>
      0.43944e-05 ,0.44238e-05 ,0.44533e-05 ,0.44828e-05 ,0.45124e-05 , &amp;<a name='10040'>
      0.45419e-05 ,0.45715e-05 ,0.46012e-05 ,0.46309e-05 ,0.46606e-05 , &amp;<a name='10041'>
      0.46903e-05 ,0.47201e-05 ,0.47499e-05 ,0.47797e-05 ,0.48096e-05 , &amp;<a name='10042'>
      0.48395e-05 ,0.48695e-05 ,0.48994e-05 ,0.49294e-05 ,0.49594e-05 , &amp;<a name='10043'>
      0.49895e-05 ,0.50196e-05 ,0.50497e-05 ,0.50798e-05 ,0.51100e-05 , &amp;<a name='10044'>
      0.51402e-05 ,0.51704e-05 ,0.52007e-05 ,0.52309e-05 ,0.52612e-05 , &amp;<a name='10045'>
      0.52916e-05 ,0.53219e-05 ,0.53523e-05 ,0.53827e-05 ,0.54132e-05 , &amp;<a name='10046'>
      0.54436e-05 ,0.54741e-05 ,0.55047e-05 ,0.55352e-05 ,0.55658e-05 /)<a name='10047'>
      totplnk(151:181,  1) = (/ &amp;<a name='10048'>
      0.55964e-05 ,0.56270e-05 ,0.56576e-05 ,0.56883e-05 ,0.57190e-05 , &amp;<a name='10049'>
      0.57497e-05 ,0.57804e-05 ,0.58112e-05 ,0.58420e-05 ,0.58728e-05 , &amp;<a name='10050'>
      0.59036e-05 ,0.59345e-05 ,0.59653e-05 ,0.59962e-05 ,0.60272e-05 , &amp;<a name='10051'>
      0.60581e-05 ,0.60891e-05 ,0.61201e-05 ,0.61511e-05 ,0.61821e-05 , &amp;<a name='10052'>
      0.62131e-05 ,0.62442e-05 ,0.62753e-05 ,0.63064e-05 ,0.63376e-05 , &amp;<a name='10053'>
      0.63687e-05 ,0.63998e-05 ,0.64310e-05 ,0.64622e-05 ,0.64935e-05 , &amp;<a name='10054'>
      0.65247e-05 /)<a name='10055'>
      totplnk(1:50,  2) = (/ &amp;<a name='10056'>
      0.20262e-05 ,0.20757e-05 ,0.21257e-05 ,0.21763e-05 ,0.22276e-05 , &amp;<a name='10057'>
      0.22794e-05 ,0.23319e-05 ,0.23849e-05 ,0.24386e-05 ,0.24928e-05 , &amp;<a name='10058'>
      0.25477e-05 ,0.26031e-05 ,0.26591e-05 ,0.27157e-05 ,0.27728e-05 , &amp;<a name='10059'>
      0.28306e-05 ,0.28889e-05 ,0.29478e-05 ,0.30073e-05 ,0.30673e-05 , &amp;<a name='10060'>
      0.31279e-05 ,0.31890e-05 ,0.32507e-05 ,0.33129e-05 ,0.33757e-05 , &amp;<a name='10061'>
      0.34391e-05 ,0.35029e-05 ,0.35674e-05 ,0.36323e-05 ,0.36978e-05 , &amp;<a name='10062'>
      0.37638e-05 ,0.38304e-05 ,0.38974e-05 ,0.39650e-05 ,0.40331e-05 , &amp;<a name='10063'>
      0.41017e-05 ,0.41708e-05 ,0.42405e-05 ,0.43106e-05 ,0.43812e-05 , &amp;<a name='10064'>
      0.44524e-05 ,0.45240e-05 ,0.45961e-05 ,0.46687e-05 ,0.47418e-05 , &amp;<a name='10065'>
      0.48153e-05 ,0.48894e-05 ,0.49639e-05 ,0.50389e-05 ,0.51143e-05 /)<a name='10066'>
      totplnk(51:100,  2) = (/ &amp;<a name='10067'>
      0.51902e-05 ,0.52666e-05 ,0.53434e-05 ,0.54207e-05 ,0.54985e-05 , &amp;<a name='10068'>
      0.55767e-05 ,0.56553e-05 ,0.57343e-05 ,0.58139e-05 ,0.58938e-05 , &amp;<a name='10069'>
      0.59742e-05 ,0.60550e-05 ,0.61362e-05 ,0.62179e-05 ,0.63000e-05 , &amp;<a name='10070'>
      0.63825e-05 ,0.64654e-05 ,0.65487e-05 ,0.66324e-05 ,0.67166e-05 , &amp;<a name='10071'>
      0.68011e-05 ,0.68860e-05 ,0.69714e-05 ,0.70571e-05 ,0.71432e-05 , &amp;<a name='10072'>
      0.72297e-05 ,0.73166e-05 ,0.74039e-05 ,0.74915e-05 ,0.75796e-05 , &amp;<a name='10073'>
      0.76680e-05 ,0.77567e-05 ,0.78459e-05 ,0.79354e-05 ,0.80252e-05 , &amp;<a name='10074'>
      0.81155e-05 ,0.82061e-05 ,0.82970e-05 ,0.83883e-05 ,0.84799e-05 , &amp;<a name='10075'>
      0.85719e-05 ,0.86643e-05 ,0.87569e-05 ,0.88499e-05 ,0.89433e-05 , &amp;<a name='10076'>
      0.90370e-05 ,0.91310e-05 ,0.92254e-05 ,0.93200e-05 ,0.94150e-05 /)<a name='10077'>
      totplnk(101:150,  2) = (/ &amp;<a name='10078'>
      0.95104e-05 ,0.96060e-05 ,0.97020e-05 ,0.97982e-05 ,0.98948e-05 , &amp;<a name='10079'>
      0.99917e-05 ,0.10089e-04 ,0.10186e-04 ,0.10284e-04 ,0.10382e-04 , &amp;<a name='10080'>
      0.10481e-04 ,0.10580e-04 ,0.10679e-04 ,0.10778e-04 ,0.10877e-04 , &amp;<a name='10081'>
      0.10977e-04 ,0.11077e-04 ,0.11178e-04 ,0.11279e-04 ,0.11380e-04 , &amp;<a name='10082'>
      0.11481e-04 ,0.11583e-04 ,0.11684e-04 ,0.11786e-04 ,0.11889e-04 , &amp;<a name='10083'>
      0.11992e-04 ,0.12094e-04 ,0.12198e-04 ,0.12301e-04 ,0.12405e-04 , &amp;<a name='10084'>
      0.12509e-04 ,0.12613e-04 ,0.12717e-04 ,0.12822e-04 ,0.12927e-04 , &amp;<a name='10085'>
      0.13032e-04 ,0.13138e-04 ,0.13244e-04 ,0.13349e-04 ,0.13456e-04 , &amp;<a name='10086'>
      0.13562e-04 ,0.13669e-04 ,0.13776e-04 ,0.13883e-04 ,0.13990e-04 , &amp;<a name='10087'>
      0.14098e-04 ,0.14206e-04 ,0.14314e-04 ,0.14422e-04 ,0.14531e-04 /)<a name='10088'>
      totplnk(151:181,  2) = (/ &amp;<a name='10089'>
      0.14639e-04 ,0.14748e-04 ,0.14857e-04 ,0.14967e-04 ,0.15076e-04 , &amp;<a name='10090'>
      0.15186e-04 ,0.15296e-04 ,0.15407e-04 ,0.15517e-04 ,0.15628e-04 , &amp;<a name='10091'>
      0.15739e-04 ,0.15850e-04 ,0.15961e-04 ,0.16072e-04 ,0.16184e-04 , &amp;<a name='10092'>
      0.16296e-04 ,0.16408e-04 ,0.16521e-04 ,0.16633e-04 ,0.16746e-04 , &amp;<a name='10093'>
      0.16859e-04 ,0.16972e-04 ,0.17085e-04 ,0.17198e-04 ,0.17312e-04 , &amp;<a name='10094'>
      0.17426e-04 ,0.17540e-04 ,0.17654e-04 ,0.17769e-04 ,0.17883e-04 , &amp;<a name='10095'>
      0.17998e-04 /)<a name='10096'>
      totplnk(1:50, 3) = (/ &amp;<a name='10097'>
      1.34822e-06 ,1.39134e-06 ,1.43530e-06 ,1.48010e-06 ,1.52574e-06 , &amp;<a name='10098'>
      1.57222e-06 ,1.61956e-06 ,1.66774e-06 ,1.71678e-06 ,1.76666e-06 , &amp;<a name='10099'>
      1.81741e-06 ,1.86901e-06 ,1.92147e-06 ,1.97479e-06 ,2.02898e-06 , &amp;<a name='10100'>
      2.08402e-06 ,2.13993e-06 ,2.19671e-06 ,2.25435e-06 ,2.31285e-06 , &amp;<a name='10101'>
      2.37222e-06 ,2.43246e-06 ,2.49356e-06 ,2.55553e-06 ,2.61837e-06 , &amp;<a name='10102'>
      2.68207e-06 ,2.74664e-06 ,2.81207e-06 ,2.87837e-06 ,2.94554e-06 , &amp;<a name='10103'>
      3.01356e-06 ,3.08245e-06 ,3.15221e-06 ,3.22282e-06 ,3.29429e-06 , &amp;<a name='10104'>
      3.36662e-06 ,3.43982e-06 ,3.51386e-06 ,3.58876e-06 ,3.66451e-06 , &amp;<a name='10105'>
      3.74112e-06 ,3.81857e-06 ,3.89688e-06 ,3.97602e-06 ,4.05601e-06 , &amp;<a name='10106'>
      4.13685e-06 ,4.21852e-06 ,4.30104e-06 ,4.38438e-06 ,4.46857e-06 /)<a name='10107'>
      totplnk(51:100, 3) = (/ &amp;<a name='10108'>
      4.55358e-06 ,4.63943e-06 ,4.72610e-06 ,4.81359e-06 ,4.90191e-06 , &amp;<a name='10109'>
      4.99105e-06 ,5.08100e-06 ,5.17176e-06 ,5.26335e-06 ,5.35573e-06 , &amp;<a name='10110'>
      5.44892e-06 ,5.54292e-06 ,5.63772e-06 ,5.73331e-06 ,5.82970e-06 , &amp;<a name='10111'>
      5.92688e-06 ,6.02485e-06 ,6.12360e-06 ,6.22314e-06 ,6.32346e-06 , &amp;<a name='10112'>
      6.42455e-06 ,6.52641e-06 ,6.62906e-06 ,6.73247e-06 ,6.83664e-06 , &amp;<a name='10113'>
      6.94156e-06 ,7.04725e-06 ,7.15370e-06 ,7.26089e-06 ,7.36883e-06 , &amp;<a name='10114'>
      7.47752e-06 ,7.58695e-06 ,7.69712e-06 ,7.80801e-06 ,7.91965e-06 , &amp;<a name='10115'>
      8.03201e-06 ,8.14510e-06 ,8.25891e-06 ,8.37343e-06 ,8.48867e-06 , &amp;<a name='10116'>
      8.60463e-06 ,8.72128e-06 ,8.83865e-06 ,8.95672e-06 ,9.07548e-06 , &amp;<a name='10117'>
      9.19495e-06 ,9.31510e-06 ,9.43594e-06 ,9.55745e-06 ,9.67966e-06 /)<a name='10118'>
      totplnk(101:150, 3) = (/ &amp;<a name='10119'>
      9.80254e-06 ,9.92609e-06 ,1.00503e-05 ,1.01752e-05 ,1.03008e-05 , &amp;<a name='10120'>
      1.04270e-05 ,1.05539e-05 ,1.06814e-05 ,1.08096e-05 ,1.09384e-05 , &amp;<a name='10121'>
      1.10679e-05 ,1.11980e-05 ,1.13288e-05 ,1.14601e-05 ,1.15922e-05 , &amp;<a name='10122'>
      1.17248e-05 ,1.18581e-05 ,1.19920e-05 ,1.21265e-05 ,1.22616e-05 , &amp;<a name='10123'>
      1.23973e-05 ,1.25337e-05 ,1.26706e-05 ,1.28081e-05 ,1.29463e-05 , &amp;<a name='10124'>
      1.30850e-05 ,1.32243e-05 ,1.33642e-05 ,1.35047e-05 ,1.36458e-05 , &amp;<a name='10125'>
      1.37875e-05 ,1.39297e-05 ,1.40725e-05 ,1.42159e-05 ,1.43598e-05 , &amp;<a name='10126'>
      1.45044e-05 ,1.46494e-05 ,1.47950e-05 ,1.49412e-05 ,1.50879e-05 , &amp;<a name='10127'>
      1.52352e-05 ,1.53830e-05 ,1.55314e-05 ,1.56803e-05 ,1.58297e-05 , &amp;<a name='10128'>
      1.59797e-05 ,1.61302e-05 ,1.62812e-05 ,1.64327e-05 ,1.65848e-05 /)<a name='10129'>
      totplnk(151:181, 3) = (/ &amp;<a name='10130'>
      1.67374e-05 ,1.68904e-05 ,1.70441e-05 ,1.71982e-05 ,1.73528e-05 , &amp;<a name='10131'>
      1.75079e-05 ,1.76635e-05 ,1.78197e-05 ,1.79763e-05 ,1.81334e-05 , &amp;<a name='10132'>
      1.82910e-05 ,1.84491e-05 ,1.86076e-05 ,1.87667e-05 ,1.89262e-05 , &amp;<a name='10133'>
      1.90862e-05 ,1.92467e-05 ,1.94076e-05 ,1.95690e-05 ,1.97309e-05 , &amp;<a name='10134'>
      1.98932e-05 ,2.00560e-05 ,2.02193e-05 ,2.03830e-05 ,2.05472e-05 , &amp;<a name='10135'>
      2.07118e-05 ,2.08768e-05 ,2.10423e-05 ,2.12083e-05 ,2.13747e-05 , &amp;<a name='10136'>
      2.15414e-05 /)<a name='10137'>
      totplnk(1:50, 4) = (/ &amp;<a name='10138'>
      8.90528e-07 ,9.24222e-07 ,9.58757e-07 ,9.94141e-07 ,1.03038e-06 , &amp;<a name='10139'>
      1.06748e-06 ,1.10545e-06 ,1.14430e-06 ,1.18403e-06 ,1.22465e-06 , &amp;<a name='10140'>
      1.26618e-06 ,1.30860e-06 ,1.35193e-06 ,1.39619e-06 ,1.44136e-06 , &amp;<a name='10141'>
      1.48746e-06 ,1.53449e-06 ,1.58246e-06 ,1.63138e-06 ,1.68124e-06 , &amp;<a name='10142'>
      1.73206e-06 ,1.78383e-06 ,1.83657e-06 ,1.89028e-06 ,1.94495e-06 , &amp;<a name='10143'>
      2.00060e-06 ,2.05724e-06 ,2.11485e-06 ,2.17344e-06 ,2.23303e-06 , &amp;<a name='10144'>
      2.29361e-06 ,2.35519e-06 ,2.41777e-06 ,2.48134e-06 ,2.54592e-06 , &amp;<a name='10145'>
      2.61151e-06 ,2.67810e-06 ,2.74571e-06 ,2.81433e-06 ,2.88396e-06 , &amp;<a name='10146'>
      2.95461e-06 ,3.02628e-06 ,3.09896e-06 ,3.17267e-06 ,3.24741e-06 , &amp;<a name='10147'>
      3.32316e-06 ,3.39994e-06 ,3.47774e-06 ,3.55657e-06 ,3.63642e-06 /)<a name='10148'>
      totplnk(51:100, 4) = (/ &amp;<a name='10149'>
      3.71731e-06 ,3.79922e-06 ,3.88216e-06 ,3.96612e-06 ,4.05112e-06 , &amp;<a name='10150'>
      4.13714e-06 ,4.22419e-06 ,4.31227e-06 ,4.40137e-06 ,4.49151e-06 , &amp;<a name='10151'>
      4.58266e-06 ,4.67485e-06 ,4.76806e-06 ,4.86229e-06 ,4.95754e-06 , &amp;<a name='10152'>
      5.05383e-06 ,5.15113e-06 ,5.24946e-06 ,5.34879e-06 ,5.44916e-06 , &amp;<a name='10153'>
      5.55053e-06 ,5.65292e-06 ,5.75632e-06 ,5.86073e-06 ,5.96616e-06 , &amp;<a name='10154'>
      6.07260e-06 ,6.18003e-06 ,6.28848e-06 ,6.39794e-06 ,6.50838e-06 , &amp;<a name='10155'>
      6.61983e-06 ,6.73229e-06 ,6.84573e-06 ,6.96016e-06 ,7.07559e-06 , &amp;<a name='10156'>
      7.19200e-06 ,7.30940e-06 ,7.42779e-06 ,7.54715e-06 ,7.66749e-06 , &amp;<a name='10157'>
      7.78882e-06 ,7.91110e-06 ,8.03436e-06 ,8.15859e-06 ,8.28379e-06 , &amp;<a name='10158'>
      8.40994e-06 ,8.53706e-06 ,8.66515e-06 ,8.79418e-06 ,8.92416e-06 /)<a name='10159'>
      totplnk(101:150, 4) = (/ &amp;<a name='10160'>
      9.05510e-06 ,9.18697e-06 ,9.31979e-06 ,9.45356e-06 ,9.58826e-06 , &amp;<a name='10161'>
      9.72389e-06 ,9.86046e-06 ,9.99793e-06 ,1.01364e-05 ,1.02757e-05 , &amp;<a name='10162'>
      1.04159e-05 ,1.05571e-05 ,1.06992e-05 ,1.08422e-05 ,1.09861e-05 , &amp;<a name='10163'>
      1.11309e-05 ,1.12766e-05 ,1.14232e-05 ,1.15707e-05 ,1.17190e-05 , &amp;<a name='10164'>
      1.18683e-05 ,1.20184e-05 ,1.21695e-05 ,1.23214e-05 ,1.24741e-05 , &amp;<a name='10165'>
      1.26277e-05 ,1.27822e-05 ,1.29376e-05 ,1.30939e-05 ,1.32509e-05 , &amp;<a name='10166'>
      1.34088e-05 ,1.35676e-05 ,1.37273e-05 ,1.38877e-05 ,1.40490e-05 , &amp;<a name='10167'>
      1.42112e-05 ,1.43742e-05 ,1.45380e-05 ,1.47026e-05 ,1.48680e-05 , &amp;<a name='10168'>
      1.50343e-05 ,1.52014e-05 ,1.53692e-05 ,1.55379e-05 ,1.57074e-05 , &amp;<a name='10169'>
      1.58778e-05 ,1.60488e-05 ,1.62207e-05 ,1.63934e-05 ,1.65669e-05 /)<a name='10170'>
      totplnk(151:181, 4) = (/ &amp;<a name='10171'>
      1.67411e-05 ,1.69162e-05 ,1.70920e-05 ,1.72685e-05 ,1.74459e-05 , &amp;<a name='10172'>
      1.76240e-05 ,1.78029e-05 ,1.79825e-05 ,1.81629e-05 ,1.83440e-05 , &amp;<a name='10173'>
      1.85259e-05 ,1.87086e-05 ,1.88919e-05 ,1.90760e-05 ,1.92609e-05 , &amp;<a name='10174'>
      1.94465e-05 ,1.96327e-05 ,1.98199e-05 ,2.00076e-05 ,2.01961e-05 , &amp;<a name='10175'>
      2.03853e-05 ,2.05752e-05 ,2.07658e-05 ,2.09571e-05 ,2.11491e-05 , &amp;<a name='10176'>
      2.13418e-05 ,2.15352e-05 ,2.17294e-05 ,2.19241e-05 ,2.21196e-05 , &amp;<a name='10177'>
      2.23158e-05 /)<a name='10178'>
      totplnk(1:50, 5) = (/ &amp;<a name='10179'>
      5.70230e-07 ,5.94788e-07 ,6.20085e-07 ,6.46130e-07 ,6.72936e-07 , &amp;<a name='10180'>
      7.00512e-07 ,7.28869e-07 ,7.58019e-07 ,7.87971e-07 ,8.18734e-07 , &amp;<a name='10181'>
      8.50320e-07 ,8.82738e-07 ,9.15999e-07 ,9.50110e-07 ,9.85084e-07 , &amp;<a name='10182'>
      1.02093e-06 ,1.05765e-06 ,1.09527e-06 ,1.13378e-06 ,1.17320e-06 , &amp;<a name='10183'>
      1.21353e-06 ,1.25479e-06 ,1.29698e-06 ,1.34011e-06 ,1.38419e-06 , &amp;<a name='10184'>
      1.42923e-06 ,1.47523e-06 ,1.52221e-06 ,1.57016e-06 ,1.61910e-06 , &amp;<a name='10185'>
      1.66904e-06 ,1.71997e-06 ,1.77192e-06 ,1.82488e-06 ,1.87886e-06 , &amp;<a name='10186'>
      1.93387e-06 ,1.98991e-06 ,2.04699e-06 ,2.10512e-06 ,2.16430e-06 , &amp;<a name='10187'>
      2.22454e-06 ,2.28584e-06 ,2.34821e-06 ,2.41166e-06 ,2.47618e-06 , &amp;<a name='10188'>
      2.54178e-06 ,2.60847e-06 ,2.67626e-06 ,2.74514e-06 ,2.81512e-06 /)<a name='10189'>
      totplnk(51:100, 5) = (/ &amp;<a name='10190'>
      2.88621e-06 ,2.95841e-06 ,3.03172e-06 ,3.10615e-06 ,3.18170e-06 , &amp;<a name='10191'>
      3.25838e-06 ,3.33618e-06 ,3.41511e-06 ,3.49518e-06 ,3.57639e-06 , &amp;<a name='10192'>
      3.65873e-06 ,3.74221e-06 ,3.82684e-06 ,3.91262e-06 ,3.99955e-06 , &amp;<a name='10193'>
      4.08763e-06 ,4.17686e-06 ,4.26725e-06 ,4.35880e-06 ,4.45150e-06 , &amp;<a name='10194'>
      4.54537e-06 ,4.64039e-06 ,4.73659e-06 ,4.83394e-06 ,4.93246e-06 , &amp;<a name='10195'>
      5.03215e-06 ,5.13301e-06 ,5.23504e-06 ,5.33823e-06 ,5.44260e-06 , &amp;<a name='10196'>
      5.54814e-06 ,5.65484e-06 ,5.76272e-06 ,5.87177e-06 ,5.98199e-06 , &amp;<a name='10197'>
      6.09339e-06 ,6.20596e-06 ,6.31969e-06 ,6.43460e-06 ,6.55068e-06 , &amp;<a name='10198'>
      6.66793e-06 ,6.78636e-06 ,6.90595e-06 ,7.02670e-06 ,7.14863e-06 , &amp;<a name='10199'>
      7.27173e-06 ,7.39599e-06 ,7.52142e-06 ,7.64802e-06 ,7.77577e-06 /)<a name='10200'>
      totplnk(101:150, 5) = (/ &amp;<a name='10201'>
      7.90469e-06 ,8.03477e-06 ,8.16601e-06 ,8.29841e-06 ,8.43198e-06 , &amp;<a name='10202'>
      8.56669e-06 ,8.70256e-06 ,8.83957e-06 ,8.97775e-06 ,9.11706e-06 , &amp;<a name='10203'>
      9.25753e-06 ,9.39915e-06 ,9.54190e-06 ,9.68580e-06 ,9.83085e-06 , &amp;<a name='10204'>
      9.97704e-06 ,1.01243e-05 ,1.02728e-05 ,1.04224e-05 ,1.05731e-05 , &amp;<a name='10205'>
      1.07249e-05 ,1.08779e-05 ,1.10320e-05 ,1.11872e-05 ,1.13435e-05 , &amp;<a name='10206'>
      1.15009e-05 ,1.16595e-05 ,1.18191e-05 ,1.19799e-05 ,1.21418e-05 , &amp;<a name='10207'>
      1.23048e-05 ,1.24688e-05 ,1.26340e-05 ,1.28003e-05 ,1.29676e-05 , &amp;<a name='10208'>
      1.31361e-05 ,1.33056e-05 ,1.34762e-05 ,1.36479e-05 ,1.38207e-05 , &amp;<a name='10209'>
      1.39945e-05 ,1.41694e-05 ,1.43454e-05 ,1.45225e-05 ,1.47006e-05 , &amp;<a name='10210'>
      1.48797e-05 ,1.50600e-05 ,1.52413e-05 ,1.54236e-05 ,1.56070e-05 /)<a name='10211'>
      totplnk(151:181, 5) = (/ &amp;<a name='10212'>
      1.57914e-05 ,1.59768e-05 ,1.61633e-05 ,1.63509e-05 ,1.65394e-05 , &amp;<a name='10213'>
      1.67290e-05 ,1.69197e-05 ,1.71113e-05 ,1.73040e-05 ,1.74976e-05 , &amp;<a name='10214'>
      1.76923e-05 ,1.78880e-05 ,1.80847e-05 ,1.82824e-05 ,1.84811e-05 , &amp;<a name='10215'>
      1.86808e-05 ,1.88814e-05 ,1.90831e-05 ,1.92857e-05 ,1.94894e-05 , &amp;<a name='10216'>
      1.96940e-05 ,1.98996e-05 ,2.01061e-05 ,2.03136e-05 ,2.05221e-05 , &amp;<a name='10217'>
      2.07316e-05 ,2.09420e-05 ,2.11533e-05 ,2.13657e-05 ,2.15789e-05 , &amp;<a name='10218'>
      2.17931e-05 /)<a name='10219'>
      totplnk(1:50, 6) = (/ &amp;<a name='10220'>
      2.73493e-07 ,2.87408e-07 ,3.01848e-07 ,3.16825e-07 ,3.32352e-07 , &amp;<a name='10221'>
      3.48439e-07 ,3.65100e-07 ,3.82346e-07 ,4.00189e-07 ,4.18641e-07 , &amp;<a name='10222'>
      4.37715e-07 ,4.57422e-07 ,4.77774e-07 ,4.98784e-07 ,5.20464e-07 , &amp;<a name='10223'>
      5.42824e-07 ,5.65879e-07 ,5.89638e-07 ,6.14115e-07 ,6.39320e-07 , &amp;<a name='10224'>
      6.65266e-07 ,6.91965e-07 ,7.19427e-07 ,7.47666e-07 ,7.76691e-07 , &amp;<a name='10225'>
      8.06516e-07 ,8.37151e-07 ,8.68607e-07 ,9.00896e-07 ,9.34029e-07 , &amp;<a name='10226'>
      9.68018e-07 ,1.00287e-06 ,1.03860e-06 ,1.07522e-06 ,1.11274e-06 , &amp;<a name='10227'>
      1.15117e-06 ,1.19052e-06 ,1.23079e-06 ,1.27201e-06 ,1.31418e-06 , &amp;<a name='10228'>
      1.35731e-06 ,1.40141e-06 ,1.44650e-06 ,1.49257e-06 ,1.53965e-06 , &amp;<a name='10229'>
      1.58773e-06 ,1.63684e-06 ,1.68697e-06 ,1.73815e-06 ,1.79037e-06 /)<a name='10230'>
      totplnk(51:100, 6) = (/ &amp;<a name='10231'>
      1.84365e-06 ,1.89799e-06 ,1.95341e-06 ,2.00991e-06 ,2.06750e-06 , &amp;<a name='10232'>
      2.12619e-06 ,2.18599e-06 ,2.24691e-06 ,2.30895e-06 ,2.37212e-06 , &amp;<a name='10233'>
      2.43643e-06 ,2.50189e-06 ,2.56851e-06 ,2.63628e-06 ,2.70523e-06 , &amp;<a name='10234'>
      2.77536e-06 ,2.84666e-06 ,2.91916e-06 ,2.99286e-06 ,3.06776e-06 , &amp;<a name='10235'>
      3.14387e-06 ,3.22120e-06 ,3.29975e-06 ,3.37953e-06 ,3.46054e-06 , &amp;<a name='10236'>
      3.54280e-06 ,3.62630e-06 ,3.71105e-06 ,3.79707e-06 ,3.88434e-06 , &amp;<a name='10237'>
      3.97288e-06 ,4.06270e-06 ,4.15380e-06 ,4.24617e-06 ,4.33984e-06 , &amp;<a name='10238'>
      4.43479e-06 ,4.53104e-06 ,4.62860e-06 ,4.72746e-06 ,4.82763e-06 , &amp;<a name='10239'>
      4.92911e-06 ,5.03191e-06 ,5.13603e-06 ,5.24147e-06 ,5.34824e-06 , &amp;<a name='10240'>
      5.45634e-06 ,5.56578e-06 ,5.67656e-06 ,5.78867e-06 ,5.90213e-06 /)<a name='10241'>
      totplnk(101:150, 6) = (/ &amp;<a name='10242'>
      6.01694e-06 ,6.13309e-06 ,6.25060e-06 ,6.36947e-06 ,6.48968e-06 , &amp;<a name='10243'>
      6.61126e-06 ,6.73420e-06 ,6.85850e-06 ,6.98417e-06 ,7.11120e-06 , &amp;<a name='10244'>
      7.23961e-06 ,7.36938e-06 ,7.50053e-06 ,7.63305e-06 ,7.76694e-06 , &amp;<a name='10245'>
      7.90221e-06 ,8.03887e-06 ,8.17690e-06 ,8.31632e-06 ,8.45710e-06 , &amp;<a name='10246'>
      8.59928e-06 ,8.74282e-06 ,8.88776e-06 ,9.03409e-06 ,9.18179e-06 , &amp;<a name='10247'>
      9.33088e-06 ,9.48136e-06 ,9.63323e-06 ,9.78648e-06 ,9.94111e-06 , &amp;<a name='10248'>
      1.00971e-05 ,1.02545e-05 ,1.04133e-05 ,1.05735e-05 ,1.07351e-05 , &amp;<a name='10249'>
      1.08980e-05 ,1.10624e-05 ,1.12281e-05 ,1.13952e-05 ,1.15637e-05 , &amp;<a name='10250'>
      1.17335e-05 ,1.19048e-05 ,1.20774e-05 ,1.22514e-05 ,1.24268e-05 , &amp;<a name='10251'>
      1.26036e-05 ,1.27817e-05 ,1.29612e-05 ,1.31421e-05 ,1.33244e-05 /)<a name='10252'>
      totplnk(151:181, 6) = (/ &amp;<a name='10253'>
      1.35080e-05 ,1.36930e-05 ,1.38794e-05 ,1.40672e-05 ,1.42563e-05 , &amp;<a name='10254'>
      1.44468e-05 ,1.46386e-05 ,1.48318e-05 ,1.50264e-05 ,1.52223e-05 , &amp;<a name='10255'>
      1.54196e-05 ,1.56182e-05 ,1.58182e-05 ,1.60196e-05 ,1.62223e-05 , &amp;<a name='10256'>
      1.64263e-05 ,1.66317e-05 ,1.68384e-05 ,1.70465e-05 ,1.72559e-05 , &amp;<a name='10257'>
      1.74666e-05 ,1.76787e-05 ,1.78921e-05 ,1.81069e-05 ,1.83230e-05 , &amp;<a name='10258'>
      1.85404e-05 ,1.87591e-05 ,1.89791e-05 ,1.92005e-05 ,1.94232e-05 , &amp;<a name='10259'>
      1.96471e-05 /)<a name='10260'>
      totplnk(1:50, 7) = (/ &amp;<a name='10261'>
      1.25349e-07 ,1.32735e-07 ,1.40458e-07 ,1.48527e-07 ,1.56954e-07 , &amp;<a name='10262'>
      1.65748e-07 ,1.74920e-07 ,1.84481e-07 ,1.94443e-07 ,2.04814e-07 , &amp;<a name='10263'>
      2.15608e-07 ,2.26835e-07 ,2.38507e-07 ,2.50634e-07 ,2.63229e-07 , &amp;<a name='10264'>
      2.76301e-07 ,2.89864e-07 ,3.03930e-07 ,3.18508e-07 ,3.33612e-07 , &amp;<a name='10265'>
      3.49253e-07 ,3.65443e-07 ,3.82195e-07 ,3.99519e-07 ,4.17428e-07 , &amp;<a name='10266'>
      4.35934e-07 ,4.55050e-07 ,4.74785e-07 ,4.95155e-07 ,5.16170e-07 , &amp;<a name='10267'>
      5.37844e-07 ,5.60186e-07 ,5.83211e-07 ,6.06929e-07 ,6.31355e-07 , &amp;<a name='10268'>
      6.56498e-07 ,6.82373e-07 ,7.08990e-07 ,7.36362e-07 ,7.64501e-07 , &amp;<a name='10269'>
      7.93420e-07 ,8.23130e-07 ,8.53643e-07 ,8.84971e-07 ,9.17128e-07 , &amp;<a name='10270'>
      9.50123e-07 ,9.83969e-07 ,1.01868e-06 ,1.05426e-06 ,1.09073e-06 /)<a name='10271'>
      totplnk(51:100, 7) = (/ &amp;<a name='10272'>
      1.12810e-06 ,1.16638e-06 ,1.20558e-06 ,1.24572e-06 ,1.28680e-06 , &amp;<a name='10273'>
      1.32883e-06 ,1.37183e-06 ,1.41581e-06 ,1.46078e-06 ,1.50675e-06 , &amp;<a name='10274'>
      1.55374e-06 ,1.60174e-06 ,1.65078e-06 ,1.70087e-06 ,1.75200e-06 , &amp;<a name='10275'>
      1.80421e-06 ,1.85749e-06 ,1.91186e-06 ,1.96732e-06 ,2.02389e-06 , &amp;<a name='10276'>
      2.08159e-06 ,2.14040e-06 ,2.20035e-06 ,2.26146e-06 ,2.32372e-06 , &amp;<a name='10277'>
      2.38714e-06 ,2.45174e-06 ,2.51753e-06 ,2.58451e-06 ,2.65270e-06 , &amp;<a name='10278'>
      2.72210e-06 ,2.79272e-06 ,2.86457e-06 ,2.93767e-06 ,3.01201e-06 , &amp;<a name='10279'>
      3.08761e-06 ,3.16448e-06 ,3.24261e-06 ,3.32204e-06 ,3.40275e-06 , &amp;<a name='10280'>
      3.48476e-06 ,3.56808e-06 ,3.65271e-06 ,3.73866e-06 ,3.82595e-06 , &amp;<a name='10281'>
      3.91456e-06 ,4.00453e-06 ,4.09584e-06 ,4.18851e-06 ,4.28254e-06 /)<a name='10282'>
      totplnk(101:150, 7) = (/ &amp;<a name='10283'>
      4.37796e-06 ,4.47475e-06 ,4.57293e-06 ,4.67249e-06 ,4.77346e-06 , &amp;<a name='10284'>
      4.87583e-06 ,4.97961e-06 ,5.08481e-06 ,5.19143e-06 ,5.29948e-06 , &amp;<a name='10285'>
      5.40896e-06 ,5.51989e-06 ,5.63226e-06 ,5.74608e-06 ,5.86136e-06 , &amp;<a name='10286'>
      5.97810e-06 ,6.09631e-06 ,6.21597e-06 ,6.33713e-06 ,6.45976e-06 , &amp;<a name='10287'>
      6.58388e-06 ,6.70950e-06 ,6.83661e-06 ,6.96521e-06 ,7.09531e-06 , &amp;<a name='10288'>
      7.22692e-06 ,7.36005e-06 ,7.49468e-06 ,7.63084e-06 ,7.76851e-06 , &amp;<a name='10289'>
      7.90773e-06 ,8.04846e-06 ,8.19072e-06 ,8.33452e-06 ,8.47985e-06 , &amp;<a name='10290'>
      8.62674e-06 ,8.77517e-06 ,8.92514e-06 ,9.07666e-06 ,9.22975e-06 , &amp;<a name='10291'>
      9.38437e-06 ,9.54057e-06 ,9.69832e-06 ,9.85762e-06 ,1.00185e-05 , &amp;<a name='10292'>
      1.01810e-05 ,1.03450e-05 ,1.05106e-05 ,1.06777e-05 ,1.08465e-05 /)<a name='10293'>
      totplnk(151:181, 7) = (/ &amp;<a name='10294'>
      1.10168e-05 ,1.11887e-05 ,1.13621e-05 ,1.15372e-05 ,1.17138e-05 , &amp;<a name='10295'>
      1.18920e-05 ,1.20718e-05 ,1.22532e-05 ,1.24362e-05 ,1.26207e-05 , &amp;<a name='10296'>
      1.28069e-05 ,1.29946e-05 ,1.31839e-05 ,1.33749e-05 ,1.35674e-05 , &amp;<a name='10297'>
      1.37615e-05 ,1.39572e-05 ,1.41544e-05 ,1.43533e-05 ,1.45538e-05 , &amp;<a name='10298'>
      1.47558e-05 ,1.49595e-05 ,1.51647e-05 ,1.53716e-05 ,1.55800e-05 , &amp;<a name='10299'>
      1.57900e-05 ,1.60017e-05 ,1.62149e-05 ,1.64296e-05 ,1.66460e-05 , &amp;<a name='10300'>
      1.68640e-05 /)<a name='10301'>
      totplnk(1:50, 8) = (/ &amp;<a name='10302'>
      6.74445e-08 ,7.18176e-08 ,7.64153e-08 ,8.12456e-08 ,8.63170e-08 , &amp;<a name='10303'>
      9.16378e-08 ,9.72168e-08 ,1.03063e-07 ,1.09184e-07 ,1.15591e-07 , &amp;<a name='10304'>
      1.22292e-07 ,1.29296e-07 ,1.36613e-07 ,1.44253e-07 ,1.52226e-07 , &amp;<a name='10305'>
      1.60540e-07 ,1.69207e-07 ,1.78236e-07 ,1.87637e-07 ,1.97421e-07 , &amp;<a name='10306'>
      2.07599e-07 ,2.18181e-07 ,2.29177e-07 ,2.40598e-07 ,2.52456e-07 , &amp;<a name='10307'>
      2.64761e-07 ,2.77523e-07 ,2.90755e-07 ,3.04468e-07 ,3.18673e-07 , &amp;<a name='10308'>
      3.33381e-07 ,3.48603e-07 ,3.64352e-07 ,3.80638e-07 ,3.97474e-07 , &amp;<a name='10309'>
      4.14871e-07 ,4.32841e-07 ,4.51395e-07 ,4.70547e-07 ,4.90306e-07 , &amp;<a name='10310'>
      5.10687e-07 ,5.31699e-07 ,5.53357e-07 ,5.75670e-07 ,5.98652e-07 , &amp;<a name='10311'>
      6.22315e-07 ,6.46672e-07 ,6.71731e-07 ,6.97511e-07 ,7.24018e-07 /)<a name='10312'>
      totplnk(51:100, 8) = (/ &amp;<a name='10313'>
      7.51266e-07 ,7.79269e-07 ,8.08038e-07 ,8.37584e-07 ,8.67922e-07 , &amp;<a name='10314'>
      8.99061e-07 ,9.31016e-07 ,9.63797e-07 ,9.97417e-07 ,1.03189e-06 , &amp;<a name='10315'>
      1.06722e-06 ,1.10343e-06 ,1.14053e-06 ,1.17853e-06 ,1.21743e-06 , &amp;<a name='10316'>
      1.25726e-06 ,1.29803e-06 ,1.33974e-06 ,1.38241e-06 ,1.42606e-06 , &amp;<a name='10317'>
      1.47068e-06 ,1.51630e-06 ,1.56293e-06 ,1.61056e-06 ,1.65924e-06 , &amp;<a name='10318'>
      1.70894e-06 ,1.75971e-06 ,1.81153e-06 ,1.86443e-06 ,1.91841e-06 , &amp;<a name='10319'>
      1.97350e-06 ,2.02968e-06 ,2.08699e-06 ,2.14543e-06 ,2.20500e-06 , &amp;<a name='10320'>
      2.26573e-06 ,2.32762e-06 ,2.39068e-06 ,2.45492e-06 ,2.52036e-06 , &amp;<a name='10321'>
      2.58700e-06 ,2.65485e-06 ,2.72393e-06 ,2.79424e-06 ,2.86580e-06 , &amp;<a name='10322'>
      2.93861e-06 ,3.01269e-06 ,3.08803e-06 ,3.16467e-06 ,3.24259e-06 /)<a name='10323'>
      totplnk(101:150, 8) = (/ &amp;<a name='10324'>
      3.32181e-06 ,3.40235e-06 ,3.48420e-06 ,3.56739e-06 ,3.65192e-06 , &amp;<a name='10325'>
      3.73779e-06 ,3.82502e-06 ,3.91362e-06 ,4.00359e-06 ,4.09494e-06 , &amp;<a name='10326'>
      4.18768e-06 ,4.28182e-06 ,4.37737e-06 ,4.47434e-06 ,4.57273e-06 , &amp;<a name='10327'>
      4.67254e-06 ,4.77380e-06 ,4.87651e-06 ,4.98067e-06 ,5.08630e-06 , &amp;<a name='10328'>
      5.19339e-06 ,5.30196e-06 ,5.41201e-06 ,5.52356e-06 ,5.63660e-06 , &amp;<a name='10329'>
      5.75116e-06 ,5.86722e-06 ,5.98479e-06 ,6.10390e-06 ,6.22453e-06 , &amp;<a name='10330'>
      6.34669e-06 ,6.47042e-06 ,6.59569e-06 ,6.72252e-06 ,6.85090e-06 , &amp;<a name='10331'>
      6.98085e-06 ,7.11238e-06 ,7.24549e-06 ,7.38019e-06 ,7.51646e-06 , &amp;<a name='10332'>
      7.65434e-06 ,7.79382e-06 ,7.93490e-06 ,8.07760e-06 ,8.22192e-06 , &amp;<a name='10333'>
      8.36784e-06 ,8.51540e-06 ,8.66459e-06 ,8.81542e-06 ,8.96786e-06 /)<a name='10334'>
      totplnk(151:181, 8) = (/ &amp;<a name='10335'>
      9.12197e-06 ,9.27772e-06 ,9.43513e-06 ,9.59419e-06 ,9.75490e-06 , &amp;<a name='10336'>
      9.91728e-06 ,1.00813e-05 ,1.02471e-05 ,1.04144e-05 ,1.05835e-05 , &amp;<a name='10337'>
      1.07543e-05 ,1.09267e-05 ,1.11008e-05 ,1.12766e-05 ,1.14541e-05 , &amp;<a name='10338'>
      1.16333e-05 ,1.18142e-05 ,1.19969e-05 ,1.21812e-05 ,1.23672e-05 , &amp;<a name='10339'>
      1.25549e-05 ,1.27443e-05 ,1.29355e-05 ,1.31284e-05 ,1.33229e-05 , &amp;<a name='10340'>
      1.35193e-05 ,1.37173e-05 ,1.39170e-05 ,1.41185e-05 ,1.43217e-05 , &amp;<a name='10341'>
      1.45267e-05 /)<a name='10342'>
      totplnk(1:50, 9) = (/ &amp;<a name='10343'>
      2.61522e-08 ,2.80613e-08 ,3.00838e-08 ,3.22250e-08 ,3.44899e-08 , &amp;<a name='10344'>
      3.68841e-08 ,3.94129e-08 ,4.20820e-08 ,4.48973e-08 ,4.78646e-08 , &amp;<a name='10345'>
      5.09901e-08 ,5.42799e-08 ,5.77405e-08 ,6.13784e-08 ,6.52001e-08 , &amp;<a name='10346'>
      6.92126e-08 ,7.34227e-08 ,7.78375e-08 ,8.24643e-08 ,8.73103e-08 , &amp;<a name='10347'>
      9.23832e-08 ,9.76905e-08 ,1.03240e-07 ,1.09039e-07 ,1.15097e-07 , &amp;<a name='10348'>
      1.21421e-07 ,1.28020e-07 ,1.34902e-07 ,1.42075e-07 ,1.49548e-07 , &amp;<a name='10349'>
      1.57331e-07 ,1.65432e-07 ,1.73860e-07 ,1.82624e-07 ,1.91734e-07 , &amp;<a name='10350'>
      2.01198e-07 ,2.11028e-07 ,2.21231e-07 ,2.31818e-07 ,2.42799e-07 , &amp;<a name='10351'>
      2.54184e-07 ,2.65983e-07 ,2.78205e-07 ,2.90862e-07 ,3.03963e-07 , &amp;<a name='10352'>
      3.17519e-07 ,3.31541e-07 ,3.46039e-07 ,3.61024e-07 ,3.76507e-07 /)<a name='10353'>
      totplnk(51:100, 9) = (/ &amp;<a name='10354'>
      3.92498e-07 ,4.09008e-07 ,4.26050e-07 ,4.43633e-07 ,4.61769e-07 , &amp;<a name='10355'>
      4.80469e-07 ,4.99744e-07 ,5.19606e-07 ,5.40067e-07 ,5.61136e-07 , &amp;<a name='10356'>
      5.82828e-07 ,6.05152e-07 ,6.28120e-07 ,6.51745e-07 ,6.76038e-07 , &amp;<a name='10357'>
      7.01010e-07 ,7.26674e-07 ,7.53041e-07 ,7.80124e-07 ,8.07933e-07 , &amp;<a name='10358'>
      8.36482e-07 ,8.65781e-07 ,8.95845e-07 ,9.26683e-07 ,9.58308e-07 , &amp;<a name='10359'>
      9.90732e-07 ,1.02397e-06 ,1.05803e-06 ,1.09292e-06 ,1.12866e-06 , &amp;<a name='10360'>
      1.16526e-06 ,1.20274e-06 ,1.24109e-06 ,1.28034e-06 ,1.32050e-06 , &amp;<a name='10361'>
      1.36158e-06 ,1.40359e-06 ,1.44655e-06 ,1.49046e-06 ,1.53534e-06 , &amp;<a name='10362'>
      1.58120e-06 ,1.62805e-06 ,1.67591e-06 ,1.72478e-06 ,1.77468e-06 , &amp;<a name='10363'>
      1.82561e-06 ,1.87760e-06 ,1.93066e-06 ,1.98479e-06 ,2.04000e-06 /)<a name='10364'>
      totplnk(101:150, 9) = (/ &amp;<a name='10365'>
      2.09631e-06 ,2.15373e-06 ,2.21228e-06 ,2.27196e-06 ,2.33278e-06 , &amp;<a name='10366'>
      2.39475e-06 ,2.45790e-06 ,2.52222e-06 ,2.58773e-06 ,2.65445e-06 , &amp;<a name='10367'>
      2.72238e-06 ,2.79152e-06 ,2.86191e-06 ,2.93354e-06 ,3.00643e-06 , &amp;<a name='10368'>
      3.08058e-06 ,3.15601e-06 ,3.23273e-06 ,3.31075e-06 ,3.39009e-06 , &amp;<a name='10369'>
      3.47074e-06 ,3.55272e-06 ,3.63605e-06 ,3.72072e-06 ,3.80676e-06 , &amp;<a name='10370'>
      3.89417e-06 ,3.98297e-06 ,4.07315e-06 ,4.16474e-06 ,4.25774e-06 , &amp;<a name='10371'>
      4.35217e-06 ,4.44802e-06 ,4.54532e-06 ,4.64406e-06 ,4.74428e-06 , &amp;<a name='10372'>
      4.84595e-06 ,4.94911e-06 ,5.05376e-06 ,5.15990e-06 ,5.26755e-06 , &amp;<a name='10373'>
      5.37671e-06 ,5.48741e-06 ,5.59963e-06 ,5.71340e-06 ,5.82871e-06 , &amp;<a name='10374'>
      5.94559e-06 ,6.06403e-06 ,6.18404e-06 ,6.30565e-06 ,6.42885e-06 /)<a name='10375'>
      totplnk(151:181, 9) = (/ &amp;<a name='10376'>
      6.55364e-06 ,6.68004e-06 ,6.80806e-06 ,6.93771e-06 ,7.06898e-06 , &amp;<a name='10377'>
      7.20190e-06 ,7.33646e-06 ,7.47267e-06 ,7.61056e-06 ,7.75010e-06 , &amp;<a name='10378'>
      7.89133e-06 ,8.03423e-06 ,8.17884e-06 ,8.32514e-06 ,8.47314e-06 , &amp;<a name='10379'>
      8.62284e-06 ,8.77427e-06 ,8.92743e-06 ,9.08231e-06 ,9.23893e-06 , &amp;<a name='10380'>
      9.39729e-06 ,9.55741e-06 ,9.71927e-06 ,9.88291e-06 ,1.00483e-05 , &amp;<a name='10381'>
      1.02155e-05 ,1.03844e-05 ,1.05552e-05 ,1.07277e-05 ,1.09020e-05 , &amp;<a name='10382'>
      1.10781e-05 /)<a name='10383'>
      totplnk(1:50,10) = (/ &amp;<a name='10384'>
      8.89300e-09 ,9.63263e-09 ,1.04235e-08 ,1.12685e-08 ,1.21703e-08 , &amp;<a name='10385'>
      1.31321e-08 ,1.41570e-08 ,1.52482e-08 ,1.64090e-08 ,1.76428e-08 , &amp;<a name='10386'>
      1.89533e-08 ,2.03441e-08 ,2.18190e-08 ,2.33820e-08 ,2.50370e-08 , &amp;<a name='10387'>
      2.67884e-08 ,2.86402e-08 ,3.05969e-08 ,3.26632e-08 ,3.48436e-08 , &amp;<a name='10388'>
      3.71429e-08 ,3.95660e-08 ,4.21179e-08 ,4.48040e-08 ,4.76294e-08 , &amp;<a name='10389'>
      5.05996e-08 ,5.37201e-08 ,5.69966e-08 ,6.04349e-08 ,6.40411e-08 , &amp;<a name='10390'>
      6.78211e-08 ,7.17812e-08 ,7.59276e-08 ,8.02670e-08 ,8.48059e-08 , &amp;<a name='10391'>
      8.95508e-08 ,9.45090e-08 ,9.96873e-08 ,1.05093e-07 ,1.10733e-07 , &amp;<a name='10392'>
      1.16614e-07 ,1.22745e-07 ,1.29133e-07 ,1.35786e-07 ,1.42711e-07 , &amp;<a name='10393'>
      1.49916e-07 ,1.57410e-07 ,1.65202e-07 ,1.73298e-07 ,1.81709e-07 /)<a name='10394'>
      totplnk(51:100,10) = (/ &amp;<a name='10395'>
      1.90441e-07 ,1.99505e-07 ,2.08908e-07 ,2.18660e-07 ,2.28770e-07 , &amp;<a name='10396'>
      2.39247e-07 ,2.50101e-07 ,2.61340e-07 ,2.72974e-07 ,2.85013e-07 , &amp;<a name='10397'>
      2.97467e-07 ,3.10345e-07 ,3.23657e-07 ,3.37413e-07 ,3.51623e-07 , &amp;<a name='10398'>
      3.66298e-07 ,3.81448e-07 ,3.97082e-07 ,4.13212e-07 ,4.29848e-07 , &amp;<a name='10399'>
      4.47000e-07 ,4.64680e-07 ,4.82898e-07 ,5.01664e-07 ,5.20991e-07 , &amp;<a name='10400'>
      5.40888e-07 ,5.61369e-07 ,5.82440e-07 ,6.04118e-07 ,6.26410e-07 , &amp;<a name='10401'>
      6.49329e-07 ,6.72887e-07 ,6.97095e-07 ,7.21964e-07 ,7.47506e-07 , &amp;<a name='10402'>
      7.73732e-07 ,8.00655e-07 ,8.28287e-07 ,8.56635e-07 ,8.85717e-07 , &amp;<a name='10403'>
      9.15542e-07 ,9.46122e-07 ,9.77469e-07 ,1.00960e-06 ,1.04251e-06 , &amp;<a name='10404'>
      1.07623e-06 ,1.11077e-06 ,1.14613e-06 ,1.18233e-06 ,1.21939e-06 /)<a name='10405'>
      totplnk(101:150,10) = (/ &amp;<a name='10406'>
      1.25730e-06 ,1.29610e-06 ,1.33578e-06 ,1.37636e-06 ,1.41785e-06 , &amp;<a name='10407'>
      1.46027e-06 ,1.50362e-06 ,1.54792e-06 ,1.59319e-06 ,1.63942e-06 , &amp;<a name='10408'>
      1.68665e-06 ,1.73487e-06 ,1.78410e-06 ,1.83435e-06 ,1.88564e-06 , &amp;<a name='10409'>
      1.93797e-06 ,1.99136e-06 ,2.04582e-06 ,2.10137e-06 ,2.15801e-06 , &amp;<a name='10410'>
      2.21576e-06 ,2.27463e-06 ,2.33462e-06 ,2.39577e-06 ,2.45806e-06 , &amp;<a name='10411'>
      2.52153e-06 ,2.58617e-06 ,2.65201e-06 ,2.71905e-06 ,2.78730e-06 , &amp;<a name='10412'>
      2.85678e-06 ,2.92749e-06 ,2.99946e-06 ,3.07269e-06 ,3.14720e-06 , &amp;<a name='10413'>
      3.22299e-06 ,3.30007e-06 ,3.37847e-06 ,3.45818e-06 ,3.53923e-06 , &amp;<a name='10414'>
      3.62161e-06 ,3.70535e-06 ,3.79046e-06 ,3.87695e-06 ,3.96481e-06 , &amp;<a name='10415'>
      4.05409e-06 ,4.14477e-06 ,4.23687e-06 ,4.33040e-06 ,4.42538e-06 /)<a name='10416'>
      totplnk(151:181,10) = (/ &amp;<a name='10417'>
      4.52180e-06 ,4.61969e-06 ,4.71905e-06 ,4.81991e-06 ,4.92226e-06 , &amp;<a name='10418'>
      5.02611e-06 ,5.13148e-06 ,5.23839e-06 ,5.34681e-06 ,5.45681e-06 , &amp;<a name='10419'>
      5.56835e-06 ,5.68146e-06 ,5.79614e-06 ,5.91242e-06 ,6.03030e-06 , &amp;<a name='10420'>
      6.14978e-06 ,6.27088e-06 ,6.39360e-06 ,6.51798e-06 ,6.64398e-06 , &amp;<a name='10421'>
      6.77165e-06 ,6.90099e-06 ,7.03198e-06 ,7.16468e-06 ,7.29906e-06 , &amp;<a name='10422'>
      7.43514e-06 ,7.57294e-06 ,7.71244e-06 ,7.85369e-06 ,7.99666e-06 , &amp;<a name='10423'>
      8.14138e-06 /)<a name='10424'>
      totplnk(1:50,11) = (/ &amp;<a name='10425'>
      2.53767e-09 ,2.77242e-09 ,3.02564e-09 ,3.29851e-09 ,3.59228e-09 , &amp;<a name='10426'>
      3.90825e-09 ,4.24777e-09 ,4.61227e-09 ,5.00322e-09 ,5.42219e-09 , &amp;<a name='10427'>
      5.87080e-09 ,6.35072e-09 ,6.86370e-09 ,7.41159e-09 ,7.99628e-09 , &amp;<a name='10428'>
      8.61974e-09 ,9.28404e-09 ,9.99130e-09 ,1.07437e-08 ,1.15436e-08 , &amp;<a name='10429'>
      1.23933e-08 ,1.32953e-08 ,1.42522e-08 ,1.52665e-08 ,1.63410e-08 , &amp;<a name='10430'>
      1.74786e-08 ,1.86820e-08 ,1.99542e-08 ,2.12985e-08 ,2.27179e-08 , &amp;<a name='10431'>
      2.42158e-08 ,2.57954e-08 ,2.74604e-08 ,2.92141e-08 ,3.10604e-08 , &amp;<a name='10432'>
      3.30029e-08 ,3.50457e-08 ,3.71925e-08 ,3.94476e-08 ,4.18149e-08 , &amp;<a name='10433'>
      4.42991e-08 ,4.69043e-08 ,4.96352e-08 ,5.24961e-08 ,5.54921e-08 , &amp;<a name='10434'>
      5.86277e-08 ,6.19081e-08 ,6.53381e-08 ,6.89231e-08 ,7.26681e-08 /)<a name='10435'>
      totplnk(51:100,11) = (/ &amp;<a name='10436'>
      7.65788e-08 ,8.06604e-08 ,8.49187e-08 ,8.93591e-08 ,9.39879e-08 , &amp;<a name='10437'>
      9.88106e-08 ,1.03834e-07 ,1.09063e-07 ,1.14504e-07 ,1.20165e-07 , &amp;<a name='10438'>
      1.26051e-07 ,1.32169e-07 ,1.38525e-07 ,1.45128e-07 ,1.51982e-07 , &amp;<a name='10439'>
      1.59096e-07 ,1.66477e-07 ,1.74132e-07 ,1.82068e-07 ,1.90292e-07 , &amp;<a name='10440'>
      1.98813e-07 ,2.07638e-07 ,2.16775e-07 ,2.26231e-07 ,2.36015e-07 , &amp;<a name='10441'>
      2.46135e-07 ,2.56599e-07 ,2.67415e-07 ,2.78592e-07 ,2.90137e-07 , &amp;<a name='10442'>
      3.02061e-07 ,3.14371e-07 ,3.27077e-07 ,3.40186e-07 ,3.53710e-07 , &amp;<a name='10443'>
      3.67655e-07 ,3.82031e-07 ,3.96848e-07 ,4.12116e-07 ,4.27842e-07 , &amp;<a name='10444'>
      4.44039e-07 ,4.60713e-07 ,4.77876e-07 ,4.95537e-07 ,5.13706e-07 , &amp;<a name='10445'>
      5.32392e-07 ,5.51608e-07 ,5.71360e-07 ,5.91662e-07 ,6.12521e-07 /)<a name='10446'>
      totplnk(101:150,11) = (/ &amp;<a name='10447'>
      6.33950e-07 ,6.55958e-07 ,6.78556e-07 ,7.01753e-07 ,7.25562e-07 , &amp;<a name='10448'>
      7.49992e-07 ,7.75055e-07 ,8.00760e-07 ,8.27120e-07 ,8.54145e-07 , &amp;<a name='10449'>
      8.81845e-07 ,9.10233e-07 ,9.39318e-07 ,9.69113e-07 ,9.99627e-07 , &amp;<a name='10450'>
      1.03087e-06 ,1.06286e-06 ,1.09561e-06 ,1.12912e-06 ,1.16340e-06 , &amp;<a name='10451'>
      1.19848e-06 ,1.23435e-06 ,1.27104e-06 ,1.30855e-06 ,1.34690e-06 , &amp;<a name='10452'>
      1.38609e-06 ,1.42614e-06 ,1.46706e-06 ,1.50886e-06 ,1.55155e-06 , &amp;<a name='10453'>
      1.59515e-06 ,1.63967e-06 ,1.68512e-06 ,1.73150e-06 ,1.77884e-06 , &amp;<a name='10454'>
      1.82715e-06 ,1.87643e-06 ,1.92670e-06 ,1.97797e-06 ,2.03026e-06 , &amp;<a name='10455'>
      2.08356e-06 ,2.13791e-06 ,2.19330e-06 ,2.24975e-06 ,2.30728e-06 , &amp;<a name='10456'>
      2.36589e-06 ,2.42560e-06 ,2.48641e-06 ,2.54835e-06 ,2.61142e-06 /)<a name='10457'>
      totplnk(151:181,11) = (/ &amp;<a name='10458'>
      2.67563e-06 ,2.74100e-06 ,2.80754e-06 ,2.87526e-06 ,2.94417e-06 , &amp;<a name='10459'>
      3.01429e-06 ,3.08562e-06 ,3.15819e-06 ,3.23199e-06 ,3.30704e-06 , &amp;<a name='10460'>
      3.38336e-06 ,3.46096e-06 ,3.53984e-06 ,3.62002e-06 ,3.70151e-06 , &amp;<a name='10461'>
      3.78433e-06 ,3.86848e-06 ,3.95399e-06 ,4.04084e-06 ,4.12907e-06 , &amp;<a name='10462'>
      4.21868e-06 ,4.30968e-06 ,4.40209e-06 ,4.49592e-06 ,4.59117e-06 , &amp;<a name='10463'>
      4.68786e-06 ,4.78600e-06 ,4.88561e-06 ,4.98669e-06 ,5.08926e-06 , &amp;<a name='10464'>
      5.19332e-06 /)<a name='10465'>
      totplnk(1:50,12) = (/ &amp;<a name='10466'>
      2.73921e-10 ,3.04500e-10 ,3.38056e-10 ,3.74835e-10 ,4.15099e-10 , &amp;<a name='10467'>
      4.59126e-10 ,5.07214e-10 ,5.59679e-10 ,6.16857e-10 ,6.79103e-10 , &amp;<a name='10468'>
      7.46796e-10 ,8.20335e-10 ,9.00144e-10 ,9.86671e-10 ,1.08039e-09 , &amp;<a name='10469'>
      1.18180e-09 ,1.29142e-09 ,1.40982e-09 ,1.53757e-09 ,1.67529e-09 , &amp;<a name='10470'>
      1.82363e-09 ,1.98327e-09 ,2.15492e-09 ,2.33932e-09 ,2.53726e-09 , &amp;<a name='10471'>
      2.74957e-09 ,2.97710e-09 ,3.22075e-09 ,3.48145e-09 ,3.76020e-09 , &amp;<a name='10472'>
      4.05801e-09 ,4.37595e-09 ,4.71513e-09 ,5.07672e-09 ,5.46193e-09 , &amp;<a name='10473'>
      5.87201e-09 ,6.30827e-09 ,6.77205e-09 ,7.26480e-09 ,7.78794e-09 , &amp;<a name='10474'>
      8.34304e-09 ,8.93163e-09 ,9.55537e-09 ,1.02159e-08 ,1.09151e-08 , &amp;<a name='10475'>
      1.16547e-08 ,1.24365e-08 ,1.32625e-08 ,1.41348e-08 ,1.50554e-08 /)<a name='10476'>
      totplnk(51:100,12) = (/ &amp;<a name='10477'>
      1.60264e-08 ,1.70500e-08 ,1.81285e-08 ,1.92642e-08 ,2.04596e-08 , &amp;<a name='10478'>
      2.17171e-08 ,2.30394e-08 ,2.44289e-08 ,2.58885e-08 ,2.74209e-08 , &amp;<a name='10479'>
      2.90290e-08 ,3.07157e-08 ,3.24841e-08 ,3.43371e-08 ,3.62782e-08 , &amp;<a name='10480'>
      3.83103e-08 ,4.04371e-08 ,4.26617e-08 ,4.49878e-08 ,4.74190e-08 , &amp;<a name='10481'>
      4.99589e-08 ,5.26113e-08 ,5.53801e-08 ,5.82692e-08 ,6.12826e-08 , &amp;<a name='10482'>
      6.44245e-08 ,6.76991e-08 ,7.11105e-08 ,7.46634e-08 ,7.83621e-08 , &amp;<a name='10483'>
      8.22112e-08 ,8.62154e-08 ,9.03795e-08 ,9.47081e-08 ,9.92066e-08 , &amp;<a name='10484'>
      1.03879e-07 ,1.08732e-07 ,1.13770e-07 ,1.18998e-07 ,1.24422e-07 , &amp;<a name='10485'>
      1.30048e-07 ,1.35880e-07 ,1.41924e-07 ,1.48187e-07 ,1.54675e-07 , &amp;<a name='10486'>
      1.61392e-07 ,1.68346e-07 ,1.75543e-07 ,1.82988e-07 ,1.90688e-07 /)<a name='10487'>
      totplnk(101:150,12) = (/ &amp;<a name='10488'>
      1.98650e-07 ,2.06880e-07 ,2.15385e-07 ,2.24172e-07 ,2.33247e-07 , &amp;<a name='10489'>
      2.42617e-07 ,2.52289e-07 ,2.62272e-07 ,2.72571e-07 ,2.83193e-07 , &amp;<a name='10490'>
      2.94147e-07 ,3.05440e-07 ,3.17080e-07 ,3.29074e-07 ,3.41430e-07 , &amp;<a name='10491'>
      3.54155e-07 ,3.67259e-07 ,3.80747e-07 ,3.94631e-07 ,4.08916e-07 , &amp;<a name='10492'>
      4.23611e-07 ,4.38725e-07 ,4.54267e-07 ,4.70245e-07 ,4.86666e-07 , &amp;<a name='10493'>
      5.03541e-07 ,5.20879e-07 ,5.38687e-07 ,5.56975e-07 ,5.75751e-07 , &amp;<a name='10494'>
      5.95026e-07 ,6.14808e-07 ,6.35107e-07 ,6.55932e-07 ,6.77293e-07 , &amp;<a name='10495'>
      6.99197e-07 ,7.21656e-07 ,7.44681e-07 ,7.68278e-07 ,7.92460e-07 , &amp;<a name='10496'>
      8.17235e-07 ,8.42614e-07 ,8.68606e-07 ,8.95223e-07 ,9.22473e-07 , &amp;<a name='10497'>
      9.50366e-07 ,9.78915e-07 ,1.00813e-06 ,1.03802e-06 ,1.06859e-06 /)<a name='10498'>
      totplnk(151:181,12) = (/ &amp;<a name='10499'>
      1.09986e-06 ,1.13184e-06 ,1.16453e-06 ,1.19796e-06 ,1.23212e-06 , &amp;<a name='10500'>
      1.26703e-06 ,1.30270e-06 ,1.33915e-06 ,1.37637e-06 ,1.41440e-06 , &amp;<a name='10501'>
      1.45322e-06 ,1.49286e-06 ,1.53333e-06 ,1.57464e-06 ,1.61679e-06 , &amp;<a name='10502'>
      1.65981e-06 ,1.70370e-06 ,1.74847e-06 ,1.79414e-06 ,1.84071e-06 , &amp;<a name='10503'>
      1.88821e-06 ,1.93663e-06 ,1.98599e-06 ,2.03631e-06 ,2.08759e-06 , &amp;<a name='10504'>
      2.13985e-06 ,2.19310e-06 ,2.24734e-06 ,2.30260e-06 ,2.35888e-06 , &amp;<a name='10505'>
      2.41619e-06 /)<a name='10506'>
      totplnk(1:50,13) = (/ &amp;<a name='10507'>
      4.53634e-11 ,5.11435e-11 ,5.75754e-11 ,6.47222e-11 ,7.26531e-11 , &amp;<a name='10508'>
      8.14420e-11 ,9.11690e-11 ,1.01921e-10 ,1.13790e-10 ,1.26877e-10 , &amp;<a name='10509'>
      1.41288e-10 ,1.57140e-10 ,1.74555e-10 ,1.93665e-10 ,2.14613e-10 , &amp;<a name='10510'>
      2.37548e-10 ,2.62633e-10 ,2.90039e-10 ,3.19948e-10 ,3.52558e-10 , &amp;<a name='10511'>
      3.88073e-10 ,4.26716e-10 ,4.68719e-10 ,5.14331e-10 ,5.63815e-10 , &amp;<a name='10512'>
      6.17448e-10 ,6.75526e-10 ,7.38358e-10 ,8.06277e-10 ,8.79625e-10 , &amp;<a name='10513'>
      9.58770e-10 ,1.04410e-09 ,1.13602e-09 ,1.23495e-09 ,1.34135e-09 , &amp;<a name='10514'>
      1.45568e-09 ,1.57845e-09 ,1.71017e-09 ,1.85139e-09 ,2.00268e-09 , &amp;<a name='10515'>
      2.16464e-09 ,2.33789e-09 ,2.52309e-09 ,2.72093e-09 ,2.93212e-09 , &amp;<a name='10516'>
      3.15740e-09 ,3.39757e-09 ,3.65341e-09 ,3.92579e-09 ,4.21559e-09 /)<a name='10517'>
      totplnk(51:100,13) = (/ &amp;<a name='10518'>
      4.52372e-09 ,4.85115e-09 ,5.19886e-09 ,5.56788e-09 ,5.95928e-09 , &amp;<a name='10519'>
      6.37419e-09 ,6.81375e-09 ,7.27917e-09 ,7.77168e-09 ,8.29256e-09 , &amp;<a name='10520'>
      8.84317e-09 ,9.42487e-09 ,1.00391e-08 ,1.06873e-08 ,1.13710e-08 , &amp;<a name='10521'>
      1.20919e-08 ,1.28515e-08 ,1.36514e-08 ,1.44935e-08 ,1.53796e-08 , &amp;<a name='10522'>
      1.63114e-08 ,1.72909e-08 ,1.83201e-08 ,1.94008e-08 ,2.05354e-08 , &amp;<a name='10523'>
      2.17258e-08 ,2.29742e-08 ,2.42830e-08 ,2.56545e-08 ,2.70910e-08 , &amp;<a name='10524'>
      2.85950e-08 ,3.01689e-08 ,3.18155e-08 ,3.35373e-08 ,3.53372e-08 , &amp;<a name='10525'>
      3.72177e-08 ,3.91818e-08 ,4.12325e-08 ,4.33727e-08 ,4.56056e-08 , &amp;<a name='10526'>
      4.79342e-08 ,5.03617e-08 ,5.28915e-08 ,5.55270e-08 ,5.82715e-08 , &amp;<a name='10527'>
      6.11286e-08 ,6.41019e-08 ,6.71951e-08 ,7.04119e-08 ,7.37560e-08 /)<a name='10528'>
      totplnk(101:150,13) = (/ &amp;<a name='10529'>
      7.72315e-08 ,8.08424e-08 ,8.45927e-08 ,8.84866e-08 ,9.25281e-08 , &amp;<a name='10530'>
      9.67218e-08 ,1.01072e-07 ,1.05583e-07 ,1.10260e-07 ,1.15107e-07 , &amp;<a name='10531'>
      1.20128e-07 ,1.25330e-07 ,1.30716e-07 ,1.36291e-07 ,1.42061e-07 , &amp;<a name='10532'>
      1.48031e-07 ,1.54206e-07 ,1.60592e-07 ,1.67192e-07 ,1.74015e-07 , &amp;<a name='10533'>
      1.81064e-07 ,1.88345e-07 ,1.95865e-07 ,2.03628e-07 ,2.11643e-07 , &amp;<a name='10534'>
      2.19912e-07 ,2.28443e-07 ,2.37244e-07 ,2.46318e-07 ,2.55673e-07 , &amp;<a name='10535'>
      2.65316e-07 ,2.75252e-07 ,2.85489e-07 ,2.96033e-07 ,3.06891e-07 , &amp;<a name='10536'>
      3.18070e-07 ,3.29576e-07 ,3.41417e-07 ,3.53600e-07 ,3.66133e-07 , &amp;<a name='10537'>
      3.79021e-07 ,3.92274e-07 ,4.05897e-07 ,4.19899e-07 ,4.34288e-07 , &amp;<a name='10538'>
      4.49071e-07 ,4.64255e-07 ,4.79850e-07 ,4.95863e-07 ,5.12300e-07 /)<a name='10539'>
      totplnk(151:181,13) = (/ &amp;<a name='10540'>
      5.29172e-07 ,5.46486e-07 ,5.64250e-07 ,5.82473e-07 ,6.01164e-07 , &amp;<a name='10541'>
      6.20329e-07 ,6.39979e-07 ,6.60122e-07 ,6.80767e-07 ,7.01922e-07 , &amp;<a name='10542'>
      7.23596e-07 ,7.45800e-07 ,7.68539e-07 ,7.91826e-07 ,8.15669e-07 , &amp;<a name='10543'>
      8.40076e-07 ,8.65058e-07 ,8.90623e-07 ,9.16783e-07 ,9.43544e-07 , &amp;<a name='10544'>
      9.70917e-07 ,9.98912e-07 ,1.02754e-06 ,1.05681e-06 ,1.08673e-06 , &amp;<a name='10545'>
      1.11731e-06 ,1.14856e-06 ,1.18050e-06 ,1.21312e-06 ,1.24645e-06 , &amp;<a name='10546'>
      1.28049e-06 /)<a name='10547'>
      totplnk(1:50,14) = (/ &amp;<a name='10548'>
      1.40113e-11 ,1.59358e-11 ,1.80960e-11 ,2.05171e-11 ,2.32266e-11 , &amp;<a name='10549'>
      2.62546e-11 ,2.96335e-11 ,3.33990e-11 ,3.75896e-11 ,4.22469e-11 , &amp;<a name='10550'>
      4.74164e-11 ,5.31466e-11 ,5.94905e-11 ,6.65054e-11 ,7.42522e-11 , &amp;<a name='10551'>
      8.27975e-11 ,9.22122e-11 ,1.02573e-10 ,1.13961e-10 ,1.26466e-10 , &amp;<a name='10552'>
      1.40181e-10 ,1.55206e-10 ,1.71651e-10 ,1.89630e-10 ,2.09265e-10 , &amp;<a name='10553'>
      2.30689e-10 ,2.54040e-10 ,2.79467e-10 ,3.07128e-10 ,3.37190e-10 , &amp;<a name='10554'>
      3.69833e-10 ,4.05243e-10 ,4.43623e-10 ,4.85183e-10 ,5.30149e-10 , &amp;<a name='10555'>
      5.78755e-10 ,6.31255e-10 ,6.87910e-10 ,7.49002e-10 ,8.14824e-10 , &amp;<a name='10556'>
      8.85687e-10 ,9.61914e-10 ,1.04385e-09 ,1.13186e-09 ,1.22631e-09 , &amp;<a name='10557'>
      1.32761e-09 ,1.43617e-09 ,1.55243e-09 ,1.67686e-09 ,1.80992e-09 /)<a name='10558'>
      totplnk(51:100,14) = (/ &amp;<a name='10559'>
      1.95212e-09 ,2.10399e-09 ,2.26607e-09 ,2.43895e-09 ,2.62321e-09 , &amp;<a name='10560'>
      2.81949e-09 ,3.02844e-09 ,3.25073e-09 ,3.48707e-09 ,3.73820e-09 , &amp;<a name='10561'>
      4.00490e-09 ,4.28794e-09 ,4.58819e-09 ,4.90647e-09 ,5.24371e-09 , &amp;<a name='10562'>
      5.60081e-09 ,5.97875e-09 ,6.37854e-09 ,6.80120e-09 ,7.24782e-09 , &amp;<a name='10563'>
      7.71950e-09 ,8.21740e-09 ,8.74271e-09 ,9.29666e-09 ,9.88054e-09 , &amp;<a name='10564'>
      1.04956e-08 ,1.11434e-08 ,1.18251e-08 ,1.25422e-08 ,1.32964e-08 , &amp;<a name='10565'>
      1.40890e-08 ,1.49217e-08 ,1.57961e-08 ,1.67140e-08 ,1.76771e-08 , &amp;<a name='10566'>
      1.86870e-08 ,1.97458e-08 ,2.08553e-08 ,2.20175e-08 ,2.32342e-08 , &amp;<a name='10567'>
      2.45077e-08 ,2.58401e-08 ,2.72334e-08 ,2.86900e-08 ,3.02122e-08 , &amp;<a name='10568'>
      3.18021e-08 ,3.34624e-08 ,3.51954e-08 ,3.70037e-08 ,3.88899e-08 /)<a name='10569'>
      totplnk(101:150,14) = (/ &amp;<a name='10570'>
      4.08568e-08 ,4.29068e-08 ,4.50429e-08 ,4.72678e-08 ,4.95847e-08 , &amp;<a name='10571'>
      5.19963e-08 ,5.45058e-08 ,5.71161e-08 ,5.98309e-08 ,6.26529e-08 , &amp;<a name='10572'>
      6.55857e-08 ,6.86327e-08 ,7.17971e-08 ,7.50829e-08 ,7.84933e-08 , &amp;<a name='10573'>
      8.20323e-08 ,8.57035e-08 ,8.95105e-08 ,9.34579e-08 ,9.75488e-08 , &amp;<a name='10574'>
      1.01788e-07 ,1.06179e-07 ,1.10727e-07 ,1.15434e-07 ,1.20307e-07 , &amp;<a name='10575'>
      1.25350e-07 ,1.30566e-07 ,1.35961e-07 ,1.41539e-07 ,1.47304e-07 , &amp;<a name='10576'>
      1.53263e-07 ,1.59419e-07 ,1.65778e-07 ,1.72345e-07 ,1.79124e-07 , &amp;<a name='10577'>
      1.86122e-07 ,1.93343e-07 ,2.00792e-07 ,2.08476e-07 ,2.16400e-07 , &amp;<a name='10578'>
      2.24568e-07 ,2.32988e-07 ,2.41666e-07 ,2.50605e-07 ,2.59813e-07 , &amp;<a name='10579'>
      2.69297e-07 ,2.79060e-07 ,2.89111e-07 ,2.99455e-07 ,3.10099e-07 /)<a name='10580'>
      totplnk(151:181,14) = (/ &amp;<a name='10581'>
      3.21049e-07 ,3.32311e-07 ,3.43893e-07 ,3.55801e-07 ,3.68041e-07 , &amp;<a name='10582'>
      3.80621e-07 ,3.93547e-07 ,4.06826e-07 ,4.20465e-07 ,4.34473e-07 , &amp;<a name='10583'>
      4.48856e-07 ,4.63620e-07 ,4.78774e-07 ,4.94325e-07 ,5.10280e-07 , &amp;<a name='10584'>
      5.26648e-07 ,5.43436e-07 ,5.60652e-07 ,5.78302e-07 ,5.96397e-07 , &amp;<a name='10585'>
      6.14943e-07 ,6.33949e-07 ,6.53421e-07 ,6.73370e-07 ,6.93803e-07 , &amp;<a name='10586'>
      7.14731e-07 ,7.36157e-07 ,7.58095e-07 ,7.80549e-07 ,8.03533e-07 , &amp;<a name='10587'>
      8.27050e-07 /)<a name='10588'>
      totplnk(1:50,15) = (/ &amp;<a name='10589'>
      3.90483e-12 ,4.47999e-12 ,5.13122e-12 ,5.86739e-12 ,6.69829e-12 , &amp;<a name='10590'>
      7.63467e-12 ,8.68833e-12 ,9.87221e-12 ,1.12005e-11 ,1.26885e-11 , &amp;<a name='10591'>
      1.43534e-11 ,1.62134e-11 ,1.82888e-11 ,2.06012e-11 ,2.31745e-11 , &amp;<a name='10592'>
      2.60343e-11 ,2.92087e-11 ,3.27277e-11 ,3.66242e-11 ,4.09334e-11 , &amp;<a name='10593'>
      4.56935e-11 ,5.09455e-11 ,5.67338e-11 ,6.31057e-11 ,7.01127e-11 , &amp;<a name='10594'>
      7.78096e-11 ,8.62554e-11 ,9.55130e-11 ,1.05651e-10 ,1.16740e-10 , &amp;<a name='10595'>
      1.28858e-10 ,1.42089e-10 ,1.56519e-10 ,1.72243e-10 ,1.89361e-10 , &amp;<a name='10596'>
      2.07978e-10 ,2.28209e-10 ,2.50173e-10 ,2.73999e-10 ,2.99820e-10 , &amp;<a name='10597'>
      3.27782e-10 ,3.58034e-10 ,3.90739e-10 ,4.26067e-10 ,4.64196e-10 , &amp;<a name='10598'>
      5.05317e-10 ,5.49631e-10 ,5.97347e-10 ,6.48689e-10 ,7.03891e-10 /)<a name='10599'>
      totplnk(51:100,15) = (/ &amp;<a name='10600'>
      7.63201e-10 ,8.26876e-10 ,8.95192e-10 ,9.68430e-10 ,1.04690e-09 , &amp;<a name='10601'>
      1.13091e-09 ,1.22079e-09 ,1.31689e-09 ,1.41957e-09 ,1.52922e-09 , &amp;<a name='10602'>
      1.64623e-09 ,1.77101e-09 ,1.90401e-09 ,2.04567e-09 ,2.19647e-09 , &amp;<a name='10603'>
      2.35690e-09 ,2.52749e-09 ,2.70875e-09 ,2.90127e-09 ,3.10560e-09 , &amp;<a name='10604'>
      3.32238e-09 ,3.55222e-09 ,3.79578e-09 ,4.05375e-09 ,4.32682e-09 , &amp;<a name='10605'>
      4.61574e-09 ,4.92128e-09 ,5.24420e-09 ,5.58536e-09 ,5.94558e-09 , &amp;<a name='10606'>
      6.32575e-09 ,6.72678e-09 ,7.14964e-09 ,7.59526e-09 ,8.06470e-09 , &amp;<a name='10607'>
      8.55897e-09 ,9.07916e-09 ,9.62638e-09 ,1.02018e-08 ,1.08066e-08 , &amp;<a name='10608'>
      1.14420e-08 ,1.21092e-08 ,1.28097e-08 ,1.35446e-08 ,1.43155e-08 , &amp;<a name='10609'>
      1.51237e-08 ,1.59708e-08 ,1.68581e-08 ,1.77873e-08 ,1.87599e-08 /)<a name='10610'>
      totplnk(101:150,15) = (/ &amp;<a name='10611'>
      1.97777e-08 ,2.08423e-08 ,2.19555e-08 ,2.31190e-08 ,2.43348e-08 , &amp;<a name='10612'>
      2.56045e-08 ,2.69302e-08 ,2.83140e-08 ,2.97578e-08 ,3.12636e-08 , &amp;<a name='10613'>
      3.28337e-08 ,3.44702e-08 ,3.61755e-08 ,3.79516e-08 ,3.98012e-08 , &amp;<a name='10614'>
      4.17265e-08 ,4.37300e-08 ,4.58143e-08 ,4.79819e-08 ,5.02355e-08 , &amp;<a name='10615'>
      5.25777e-08 ,5.50114e-08 ,5.75393e-08 ,6.01644e-08 ,6.28896e-08 , &amp;<a name='10616'>
      6.57177e-08 ,6.86521e-08 ,7.16959e-08 ,7.48520e-08 ,7.81239e-08 , &amp;<a name='10617'>
      8.15148e-08 ,8.50282e-08 ,8.86675e-08 ,9.24362e-08 ,9.63380e-08 , &amp;<a name='10618'>
      1.00376e-07 ,1.04555e-07 ,1.08878e-07 ,1.13349e-07 ,1.17972e-07 , &amp;<a name='10619'>
      1.22751e-07 ,1.27690e-07 ,1.32793e-07 ,1.38064e-07 ,1.43508e-07 , &amp;<a name='10620'>
      1.49129e-07 ,1.54931e-07 ,1.60920e-07 ,1.67099e-07 ,1.73473e-07 /)<a name='10621'>
      totplnk(151:181,15) = (/ &amp;<a name='10622'>
      1.80046e-07 ,1.86825e-07 ,1.93812e-07 ,2.01014e-07 ,2.08436e-07 , &amp;<a name='10623'>
      2.16082e-07 ,2.23957e-07 ,2.32067e-07 ,2.40418e-07 ,2.49013e-07 , &amp;<a name='10624'>
      2.57860e-07 ,2.66963e-07 ,2.76328e-07 ,2.85961e-07 ,2.95868e-07 , &amp;<a name='10625'>
      3.06053e-07 ,3.16524e-07 ,3.27286e-07 ,3.38345e-07 ,3.49707e-07 , &amp;<a name='10626'>
      3.61379e-07 ,3.73367e-07 ,3.85676e-07 ,3.98315e-07 ,4.11287e-07 , &amp;<a name='10627'>
      4.24602e-07 ,4.38265e-07 ,4.52283e-07 ,4.66662e-07 ,4.81410e-07 , &amp;<a name='10628'>
      4.96535e-07 /)<a name='10629'>
      totplnk(1:50,16) = (/ &amp;<a name='10630'>
      0.28639e-12 ,0.33349e-12 ,0.38764e-12 ,0.44977e-12 ,0.52093e-12 , &amp;<a name='10631'>
      0.60231e-12 ,0.69522e-12 ,0.80111e-12 ,0.92163e-12 ,0.10586e-11 , &amp;<a name='10632'>
      0.12139e-11 ,0.13899e-11 ,0.15890e-11 ,0.18138e-11 ,0.20674e-11 , &amp;<a name='10633'>
      0.23531e-11 ,0.26744e-11 ,0.30352e-11 ,0.34401e-11 ,0.38936e-11 , &amp;<a name='10634'>
      0.44011e-11 ,0.49681e-11 ,0.56010e-11 ,0.63065e-11 ,0.70919e-11 , &amp;<a name='10635'>
      0.79654e-11 ,0.89357e-11 ,0.10012e-10 ,0.11205e-10 ,0.12526e-10 , &amp;<a name='10636'>
      0.13986e-10 ,0.15600e-10 ,0.17380e-10 ,0.19342e-10 ,0.21503e-10 , &amp;<a name='10637'>
      0.23881e-10 ,0.26494e-10 ,0.29362e-10 ,0.32509e-10 ,0.35958e-10 , &amp;<a name='10638'>
      0.39733e-10 ,0.43863e-10 ,0.48376e-10 ,0.53303e-10 ,0.58679e-10 , &amp;<a name='10639'>
      0.64539e-10 ,0.70920e-10 ,0.77864e-10 ,0.85413e-10 ,0.93615e-10 /)<a name='10640'>
      totplnk(51:100,16) = (/ &amp;<a name='10641'>
      0.10252e-09 ,0.11217e-09 ,0.12264e-09 ,0.13397e-09 ,0.14624e-09 , &amp;<a name='10642'>
      0.15950e-09 ,0.17383e-09 ,0.18930e-09 ,0.20599e-09 ,0.22399e-09 , &amp;<a name='10643'>
      0.24339e-09 ,0.26427e-09 ,0.28674e-09 ,0.31090e-09 ,0.33686e-09 , &amp;<a name='10644'>
      0.36474e-09 ,0.39466e-09 ,0.42676e-09 ,0.46115e-09 ,0.49800e-09 , &amp;<a name='10645'>
      0.53744e-09 ,0.57964e-09 ,0.62476e-09 ,0.67298e-09 ,0.72448e-09 , &amp;<a name='10646'>
      0.77945e-09 ,0.83809e-09 ,0.90062e-09 ,0.96725e-09 ,0.10382e-08 , &amp;<a name='10647'>
      0.11138e-08 ,0.11941e-08 ,0.12796e-08 ,0.13704e-08 ,0.14669e-08 , &amp;<a name='10648'>
      0.15694e-08 ,0.16781e-08 ,0.17934e-08 ,0.19157e-08 ,0.20453e-08 , &amp;<a name='10649'>
      0.21825e-08 ,0.23278e-08 ,0.24815e-08 ,0.26442e-08 ,0.28161e-08 , &amp;<a name='10650'>
      0.29978e-08 ,0.31898e-08 ,0.33925e-08 ,0.36064e-08 ,0.38321e-08 /)<a name='10651'>
      totplnk(101:150,16) = (/ &amp;<a name='10652'>
      0.40700e-08 ,0.43209e-08 ,0.45852e-08 ,0.48636e-08 ,0.51567e-08 , &amp;<a name='10653'>
      0.54652e-08 ,0.57897e-08 ,0.61310e-08 ,0.64897e-08 ,0.68667e-08 , &amp;<a name='10654'>
      0.72626e-08 ,0.76784e-08 ,0.81148e-08 ,0.85727e-08 ,0.90530e-08 , &amp;<a name='10655'>
      0.95566e-08 ,0.10084e-07 ,0.10638e-07 ,0.11217e-07 ,0.11824e-07 , &amp;<a name='10656'>
      0.12458e-07 ,0.13123e-07 ,0.13818e-07 ,0.14545e-07 ,0.15305e-07 , &amp;<a name='10657'>
      0.16099e-07 ,0.16928e-07 ,0.17795e-07 ,0.18699e-07 ,0.19643e-07 , &amp;<a name='10658'>
      0.20629e-07 ,0.21656e-07 ,0.22728e-07 ,0.23845e-07 ,0.25010e-07 , &amp;<a name='10659'>
      0.26223e-07 ,0.27487e-07 ,0.28804e-07 ,0.30174e-07 ,0.31600e-07 , &amp;<a name='10660'>
      0.33084e-07 ,0.34628e-07 ,0.36233e-07 ,0.37902e-07 ,0.39637e-07 , &amp;<a name='10661'>
      0.41440e-07 ,0.43313e-07 ,0.45259e-07 ,0.47279e-07 ,0.49376e-07 /)<a name='10662'>
      totplnk(151:181,16) = (/ &amp;<a name='10663'>
      0.51552e-07 ,0.53810e-07 ,0.56153e-07 ,0.58583e-07 ,0.61102e-07 , &amp;<a name='10664'>
      0.63713e-07 ,0.66420e-07 ,0.69224e-07 ,0.72129e-07 ,0.75138e-07 , &amp;<a name='10665'>
      0.78254e-07 ,0.81479e-07 ,0.84818e-07 ,0.88272e-07 ,0.91846e-07 , &amp;<a name='10666'>
      0.95543e-07 ,0.99366e-07 ,0.10332e-06 ,0.10740e-06 ,0.11163e-06 , &amp;<a name='10667'>
      0.11599e-06 ,0.12050e-06 ,0.12515e-06 ,0.12996e-06 ,0.13493e-06 , &amp;<a name='10668'>
      0.14005e-06 ,0.14534e-06 ,0.15080e-06 ,0.15643e-06 ,0.16224e-06 , &amp;<a name='10669'>
      0.16823e-06 /)<a name='10670'>
      totplk16(1:50) = (/ &amp;<a name='10671'>
      0.28481e-12 ,0.33159e-12 ,0.38535e-12 ,0.44701e-12 ,0.51763e-12 , &amp;<a name='10672'>
      0.59836e-12 ,0.69049e-12 ,0.79549e-12 ,0.91493e-12 ,0.10506e-11 , &amp;<a name='10673'>
      0.12045e-11 ,0.13788e-11 ,0.15758e-11 ,0.17984e-11 ,0.20493e-11 , &amp;<a name='10674'>
      0.23317e-11 ,0.26494e-11 ,0.30060e-11 ,0.34060e-11 ,0.38539e-11 , &amp;<a name='10675'>
      0.43548e-11 ,0.49144e-11 ,0.55387e-11 ,0.62344e-11 ,0.70086e-11 , &amp;<a name='10676'>
      0.78692e-11 ,0.88248e-11 ,0.98846e-11 ,0.11059e-10 ,0.12358e-10 , &amp;<a name='10677'>
      0.13794e-10 ,0.15379e-10 ,0.17128e-10 ,0.19055e-10 ,0.21176e-10 , &amp;<a name='10678'>
      0.23508e-10 ,0.26070e-10 ,0.28881e-10 ,0.31963e-10 ,0.35339e-10 , &amp;<a name='10679'>
      0.39034e-10 ,0.43073e-10 ,0.47484e-10 ,0.52299e-10 ,0.57548e-10 , &amp;<a name='10680'>
      0.63267e-10 ,0.69491e-10 ,0.76261e-10 ,0.83616e-10 ,0.91603e-10 /)<a name='10681'>
      totplk16(51:100) = (/ &amp;<a name='10682'>
      0.10027e-09 ,0.10966e-09 ,0.11983e-09 ,0.13084e-09 ,0.14275e-09 , &amp;<a name='10683'>
      0.15562e-09 ,0.16951e-09 ,0.18451e-09 ,0.20068e-09 ,0.21810e-09 , &amp;<a name='10684'>
      0.23686e-09 ,0.25704e-09 ,0.27875e-09 ,0.30207e-09 ,0.32712e-09 , &amp;<a name='10685'>
      0.35400e-09 ,0.38282e-09 ,0.41372e-09 ,0.44681e-09 ,0.48223e-09 , &amp;<a name='10686'>
      0.52013e-09 ,0.56064e-09 ,0.60392e-09 ,0.65015e-09 ,0.69948e-09 , &amp;<a name='10687'>
      0.75209e-09 ,0.80818e-09 ,0.86794e-09 ,0.93157e-09 ,0.99929e-09 , &amp;<a name='10688'>
      0.10713e-08 ,0.11479e-08 ,0.12293e-08 ,0.13157e-08 ,0.14074e-08 , &amp;<a name='10689'>
      0.15047e-08 ,0.16079e-08 ,0.17172e-08 ,0.18330e-08 ,0.19557e-08 , &amp;<a name='10690'>
      0.20855e-08 ,0.22228e-08 ,0.23680e-08 ,0.25214e-08 ,0.26835e-08 , &amp;<a name='10691'>
      0.28546e-08 ,0.30352e-08 ,0.32257e-08 ,0.34266e-08 ,0.36384e-08 /)<a name='10692'>
      totplk16(101:150) = (/ &amp;<a name='10693'>
      0.38615e-08 ,0.40965e-08 ,0.43438e-08 ,0.46041e-08 ,0.48779e-08 , &amp;<a name='10694'>
      0.51658e-08 ,0.54683e-08 ,0.57862e-08 ,0.61200e-08 ,0.64705e-08 , &amp;<a name='10695'>
      0.68382e-08 ,0.72240e-08 ,0.76285e-08 ,0.80526e-08 ,0.84969e-08 , &amp;<a name='10696'>
      0.89624e-08 ,0.94498e-08 ,0.99599e-08 ,0.10494e-07 ,0.11052e-07 , &amp;<a name='10697'>
      0.11636e-07 ,0.12246e-07 ,0.12884e-07 ,0.13551e-07 ,0.14246e-07 , &amp;<a name='10698'>
      0.14973e-07 ,0.15731e-07 ,0.16522e-07 ,0.17347e-07 ,0.18207e-07 , &amp;<a name='10699'>
      0.19103e-07 ,0.20037e-07 ,0.21011e-07 ,0.22024e-07 ,0.23079e-07 , &amp;<a name='10700'>
      0.24177e-07 ,0.25320e-07 ,0.26508e-07 ,0.27744e-07 ,0.29029e-07 , &amp;<a name='10701'>
      0.30365e-07 ,0.31753e-07 ,0.33194e-07 ,0.34691e-07 ,0.36246e-07 , &amp;<a name='10702'>
      0.37859e-07 ,0.39533e-07 ,0.41270e-07 ,0.43071e-07 ,0.44939e-07 /)<a name='10703'>
      totplk16(151:181) = (/ &amp;<a name='10704'>
      0.46875e-07 ,0.48882e-07 ,0.50961e-07 ,0.53115e-07 ,0.55345e-07 , &amp;<a name='10705'>
      0.57655e-07 ,0.60046e-07 ,0.62520e-07 ,0.65080e-07 ,0.67728e-07 , &amp;<a name='10706'>
      0.70466e-07 ,0.73298e-07 ,0.76225e-07 ,0.79251e-07 ,0.82377e-07 , &amp;<a name='10707'>
      0.85606e-07 ,0.88942e-07 ,0.92386e-07 ,0.95942e-07 ,0.99612e-07 , &amp;<a name='10708'>
      0.10340e-06 ,0.10731e-06 ,0.11134e-06 ,0.11550e-06 ,0.11979e-06 , &amp;<a name='10709'>
      0.12421e-06 ,0.12876e-06 ,0.13346e-06 ,0.13830e-06 ,0.14328e-06 , &amp;<a name='10710'>
      0.14841e-06 /)<a name='10711'>
<a name='10712'>
      end subroutine lwavplank<a name='10713'>
<a name='10714'>
<font color=#447700>!***************************************************************************<a name='10715'></font>
<A NAME='LWAVPLANKDERIV'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWAVPLANKDERIV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='10716'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwavplankderiv</font> <A href='../../call_to/LWAVPLANKDERIV.html' TARGET='index'>1</A><a name='10717'>
<font color=#447700>!***************************************************************************<a name='10718'></font>
<a name='10719'>
      save<a name='10720'>
 <a name='10721'>
      totplnkderiv(1:50,  1) = (/ &amp;<a name='10722'>
      2.22125e-08 ,2.23245e-08 ,2.24355e-08 ,2.25435e-08 ,2.26560e-08 , &amp;<a name='10723'>
      2.27620e-08 ,2.28690e-08 ,2.29760e-08 ,2.30775e-08 ,2.31800e-08 , &amp;<a name='10724'>
      2.32825e-08 ,2.33825e-08 ,2.34820e-08 ,2.35795e-08 ,2.36760e-08 , &amp;<a name='10725'>
      2.37710e-08 ,2.38655e-08 ,2.39595e-08 ,2.40530e-08 ,2.41485e-08 , &amp;<a name='10726'>
      2.42395e-08 ,2.43300e-08 ,2.44155e-08 ,2.45085e-08 ,2.45905e-08 , &amp;<a name='10727'>
      2.46735e-08 ,2.47565e-08 ,2.48465e-08 ,2.49315e-08 ,2.50100e-08 , &amp;<a name='10728'>
      2.50905e-08 ,2.51705e-08 ,2.52490e-08 ,2.53260e-08 ,2.54075e-08 , &amp;<a name='10729'>
      2.54785e-08 ,2.55555e-08 ,2.56340e-08 ,2.57050e-08 ,2.57820e-08 , &amp;<a name='10730'>
      2.58525e-08 ,2.59205e-08 ,2.59945e-08 ,2.60680e-08 ,2.61375e-08 , &amp;<a name='10731'>
      2.61980e-08 ,2.62745e-08 ,2.63335e-08 ,2.63995e-08 ,2.64710e-08 /)<a name='10732'>
      totplnkderiv(51:100,  1) = (/ &amp;<a name='10733'>
      2.65300e-08 ,2.66005e-08 ,2.66685e-08 ,2.67310e-08 ,2.67915e-08 , &amp;<a name='10734'>
      2.68540e-08 ,2.69065e-08 ,2.69730e-08 ,2.70270e-08 ,2.70690e-08 , &amp;<a name='10735'>
      2.71420e-08 ,2.71985e-08 ,2.72560e-08 ,2.73180e-08 ,2.73760e-08 , &amp;<a name='10736'>
      2.74285e-08 ,2.74840e-08 ,2.75290e-08 ,2.75950e-08 ,2.76360e-08 , &amp;<a name='10737'>
      2.76975e-08 ,2.77475e-08 ,2.78080e-08 ,2.78375e-08 ,2.79120e-08 , &amp;<a name='10738'>
      2.79510e-08 ,2.79955e-08 ,2.80625e-08 ,2.80920e-08 ,2.81570e-08 , &amp;<a name='10739'>
      2.81990e-08 ,2.82330e-08 ,2.82830e-08 ,2.83365e-08 ,2.83740e-08 , &amp;<a name='10740'>
      2.84295e-08 ,2.84910e-08 ,2.85275e-08 ,2.85525e-08 ,2.86085e-08 , &amp;<a name='10741'>
      2.86535e-08 ,2.86945e-08 ,2.87355e-08 ,2.87695e-08 ,2.88105e-08 , &amp;<a name='10742'>
      2.88585e-08 ,2.88945e-08 ,2.89425e-08 ,2.89580e-08 ,2.90265e-08 /)<a name='10743'>
      totplnkderiv(101:150,  1) = (/ &amp;<a name='10744'>
      2.90445e-08 ,2.90905e-08 ,2.91425e-08 ,2.91560e-08 ,2.91970e-08 , &amp;<a name='10745'>
      2.91905e-08 ,2.92880e-08 ,2.92950e-08 ,2.93630e-08 ,2.93995e-08 , &amp;<a name='10746'>
      2.94425e-08 ,2.94635e-08 ,2.94770e-08 ,2.95290e-08 ,2.95585e-08 , &amp;<a name='10747'>
      2.95815e-08 ,2.95995e-08 ,2.96745e-08 ,2.96725e-08 ,2.97040e-08 , &amp;<a name='10748'>
      2.97750e-08 ,2.97905e-08 ,2.98175e-08 ,2.98355e-08 ,2.98705e-08 , &amp;<a name='10749'>
      2.99040e-08 ,2.99680e-08 ,2.99860e-08 ,3.00270e-08 ,3.00200e-08 , &amp;<a name='10750'>
      3.00770e-08 ,3.00795e-08 ,3.01065e-08 ,3.01795e-08 ,3.01815e-08 , &amp;<a name='10751'>
      3.02025e-08 ,3.02360e-08 ,3.02360e-08 ,3.03090e-08 ,3.03155e-08 , &amp;<a name='10752'>
      3.03725e-08 ,3.03635e-08 ,3.04270e-08 ,3.04610e-08 ,3.04635e-08 , &amp;<a name='10753'>
      3.04610e-08 ,3.05180e-08 ,3.05430e-08 ,3.05290e-08 ,3.05885e-08 /)<a name='10754'>
      totplnkderiv(151:181,  1) = (/ &amp;<a name='10755'>
      3.05750e-08 ,3.05775e-08 ,3.06795e-08 ,3.07025e-08 ,3.07365e-08 , &amp;<a name='10756'>
      3.07435e-08 ,3.07525e-08 ,3.07680e-08 ,3.08115e-08 ,3.07930e-08 , &amp;<a name='10757'>
      3.08155e-08 ,3.08660e-08 ,3.08865e-08 ,3.08390e-08 ,3.09340e-08 , &amp;<a name='10758'>
      3.09685e-08 ,3.09340e-08 ,3.09820e-08 ,3.10365e-08 ,3.10705e-08 , &amp;<a name='10759'>
      3.10750e-08 ,3.10475e-08 ,3.11685e-08 ,3.11455e-08 ,3.11500e-08 , &amp;<a name='10760'>
      3.11775e-08 ,3.11890e-08 ,3.12045e-08 ,3.12185e-08 ,3.12415e-08 , &amp;<a name='10761'>
      3.12590e-08 /)<a name='10762'>
      totplnkderiv(1:50,  2) = (/ &amp;<a name='10763'>
      4.91150e-08 ,4.97290e-08 ,5.03415e-08 ,5.09460e-08 ,5.15550e-08 , &amp;<a name='10764'>
      5.21540e-08 ,5.27575e-08 ,5.33500e-08 ,5.39500e-08 ,5.45445e-08 , &amp;<a name='10765'>
      5.51290e-08 ,5.57235e-08 ,5.62955e-08 ,5.68800e-08 ,5.74620e-08 , &amp;<a name='10766'>
      5.80425e-08 ,5.86145e-08 ,5.91810e-08 ,5.97435e-08 ,6.03075e-08 , &amp;<a name='10767'>
      6.08625e-08 ,6.14135e-08 ,6.19775e-08 ,6.25185e-08 ,6.30675e-08 , &amp;<a name='10768'>
      6.36145e-08 ,6.41535e-08 ,6.46920e-08 ,6.52265e-08 ,6.57470e-08 , &amp;<a name='10769'>
      6.62815e-08 ,6.68000e-08 ,6.73320e-08 ,6.78550e-08 ,6.83530e-08 , &amp;<a name='10770'>
      6.88760e-08 ,6.93735e-08 ,6.98790e-08 ,7.03950e-08 ,7.08810e-08 , &amp;<a name='10771'>
      7.13815e-08 ,7.18795e-08 ,7.23415e-08 ,7.28505e-08 ,7.33285e-08 , &amp;<a name='10772'>
      7.38075e-08 ,7.42675e-08 ,7.47605e-08 ,7.52380e-08 ,7.57020e-08 /)<a name='10773'>
      totplnkderiv(51:100,  2) = (/ &amp;<a name='10774'>
      7.61495e-08 ,7.65955e-08 ,7.70565e-08 ,7.75185e-08 ,7.79735e-08 , &amp;<a name='10775'>
      7.83915e-08 ,7.88625e-08 ,7.93215e-08 ,7.97425e-08 ,8.02195e-08 , &amp;<a name='10776'>
      8.05905e-08 ,8.10335e-08 ,8.14770e-08 ,8.19025e-08 ,8.22955e-08 , &amp;<a name='10777'>
      8.27115e-08 ,8.31165e-08 ,8.35645e-08 ,8.39440e-08 ,8.43785e-08 , &amp;<a name='10778'>
      8.47380e-08 ,8.51495e-08 ,8.55405e-08 ,8.59720e-08 ,8.63135e-08 , &amp;<a name='10779'>
      8.67065e-08 ,8.70930e-08 ,8.74545e-08 ,8.78780e-08 ,8.82160e-08 , &amp;<a name='10780'>
      8.85625e-08 ,8.89850e-08 ,8.93395e-08 ,8.97080e-08 ,9.00675e-08 , &amp;<a name='10781'>
      9.04085e-08 ,9.07360e-08 ,9.11315e-08 ,9.13815e-08 ,9.18320e-08 , &amp;<a name='10782'>
      9.21500e-08 ,9.24725e-08 ,9.28640e-08 ,9.31955e-08 ,9.35185e-08 , &amp;<a name='10783'>
      9.38645e-08 ,9.41780e-08 ,9.45465e-08 ,9.48470e-08 ,9.51375e-08 /)<a name='10784'>
      totplnkderiv(101:150,  2) = (/ &amp;<a name='10785'>
      9.55245e-08 ,9.57925e-08 ,9.61195e-08 ,9.64750e-08 ,9.68110e-08 , &amp;<a name='10786'>
      9.71715e-08 ,9.74150e-08 ,9.77250e-08 ,9.79600e-08 ,9.82600e-08 , &amp;<a name='10787'>
      9.85300e-08 ,9.88400e-08 ,9.91600e-08 ,9.95350e-08 ,9.97500e-08 , &amp;<a name='10788'>
      1.00090e-07 ,1.00370e-07 ,1.00555e-07 ,1.00935e-07 ,1.01275e-07 , &amp;<a name='10789'>
      1.01400e-07 ,1.01790e-07 ,1.01945e-07 ,1.02225e-07 ,1.02585e-07 , &amp;<a name='10790'>
      1.02895e-07 ,1.03010e-07 ,1.03285e-07 ,1.03540e-07 ,1.03890e-07 , &amp;<a name='10791'>
      1.04015e-07 ,1.04420e-07 ,1.04640e-07 ,1.04810e-07 ,1.05090e-07 , &amp;<a name='10792'>
      1.05385e-07 ,1.05600e-07 ,1.05965e-07 ,1.06050e-07 ,1.06385e-07 , &amp;<a name='10793'>
      1.06390e-07 ,1.06795e-07 ,1.06975e-07 ,1.07240e-07 ,1.07435e-07 , &amp;<a name='10794'>
      1.07815e-07 ,1.07960e-07 ,1.08010e-07 ,1.08535e-07 ,1.08670e-07 /)<a name='10795'>
      totplnkderiv(151:181,  2) = (/ &amp;<a name='10796'>
      1.08855e-07 ,1.09210e-07 ,1.09195e-07 ,1.09510e-07 ,1.09665e-07 , &amp;<a name='10797'>
      1.09885e-07 ,1.10130e-07 ,1.10440e-07 ,1.10640e-07 ,1.10760e-07 , &amp;<a name='10798'>
      1.11125e-07 ,1.11195e-07 ,1.11345e-07 ,1.11710e-07 ,1.11765e-07 , &amp;<a name='10799'>
      1.11960e-07 ,1.12225e-07 ,1.12460e-07 ,1.12595e-07 ,1.12730e-07 , &amp;<a name='10800'>
      1.12880e-07 ,1.13295e-07 ,1.13215e-07 ,1.13505e-07 ,1.13665e-07 , &amp;<a name='10801'>
      1.13870e-07 ,1.14025e-07 ,1.14325e-07 ,1.14495e-07 ,1.14605e-07 , &amp;<a name='10802'>
      1.14905e-07 /)<a name='10803'>
      totplnkderiv(1:50, 3) = (/ &amp;<a name='10804'>
      4.27040e-08 ,4.35430e-08 ,4.43810e-08 ,4.52210e-08 ,4.60630e-08 , &amp;<a name='10805'>
      4.69135e-08 ,4.77585e-08 ,4.86135e-08 ,4.94585e-08 ,5.03230e-08 , &amp;<a name='10806'>
      5.11740e-08 ,5.20250e-08 ,5.28940e-08 ,5.37465e-08 ,5.46175e-08 , &amp;<a name='10807'>
      5.54700e-08 ,5.63430e-08 ,5.72085e-08 ,5.80735e-08 ,5.89430e-08 , &amp;<a name='10808'>
      5.98015e-08 ,6.06680e-08 ,6.15380e-08 ,6.24130e-08 ,6.32755e-08 , &amp;<a name='10809'>
      6.41340e-08 ,6.50060e-08 ,6.58690e-08 ,6.67315e-08 ,6.76025e-08 , &amp;<a name='10810'>
      6.84585e-08 ,6.93205e-08 ,7.01845e-08 ,7.10485e-08 ,7.19160e-08 , &amp;<a name='10811'>
      7.27695e-08 ,7.36145e-08 ,7.44840e-08 ,7.53405e-08 ,7.61770e-08 , &amp;<a name='10812'>
      7.70295e-08 ,7.78745e-08 ,7.87350e-08 ,7.95740e-08 ,8.04150e-08 , &amp;<a name='10813'>
      8.12565e-08 ,8.20885e-08 ,8.29455e-08 ,8.37830e-08 ,8.46035e-08 /)<a name='10814'>
      totplnkderiv(51:100, 3) = (/ &amp;<a name='10815'>
      8.54315e-08 ,8.62770e-08 ,8.70975e-08 ,8.79140e-08 ,8.87190e-08 , &amp;<a name='10816'>
      8.95625e-08 ,9.03625e-08 ,9.11795e-08 ,9.19930e-08 ,9.27685e-08 , &amp;<a name='10817'>
      9.36095e-08 ,9.43785e-08 ,9.52375e-08 ,9.59905e-08 ,9.67680e-08 , &amp;<a name='10818'>
      9.75840e-08 ,9.83755e-08 ,9.91710e-08 ,9.99445e-08 ,1.00706e-07 , &amp;<a name='10819'>
      1.01477e-07 ,1.02255e-07 ,1.03021e-07 ,1.03776e-07 ,1.04544e-07 , &amp;<a name='10820'>
      1.05338e-07 ,1.06082e-07 ,1.06843e-07 ,1.07543e-07 ,1.08298e-07 , &amp;<a name='10821'>
      1.09103e-07 ,1.09812e-07 ,1.10536e-07 ,1.11268e-07 ,1.12027e-07 , &amp;<a name='10822'>
      1.12727e-07 ,1.13464e-07 ,1.14183e-07 ,1.15037e-07 ,1.15615e-07 , &amp;<a name='10823'>
      1.16329e-07 ,1.17057e-07 ,1.17734e-07 ,1.18448e-07 ,1.19149e-07 , &amp;<a name='10824'>
      1.19835e-07 ,1.20512e-07 ,1.21127e-07 ,1.21895e-07 ,1.22581e-07 /)<a name='10825'>
      totplnkderiv(101:150, 3) = (/ &amp;<a name='10826'>
      1.23227e-07 ,1.23928e-07 ,1.24560e-07 ,1.25220e-07 ,1.25895e-07 , &amp;<a name='10827'>
      1.26565e-07 ,1.27125e-07 ,1.27855e-07 ,1.28490e-07 ,1.29195e-07 , &amp;<a name='10828'>
      1.29790e-07 ,1.30470e-07 ,1.31070e-07 ,1.31690e-07 ,1.32375e-07 , &amp;<a name='10829'>
      1.32960e-07 ,1.33570e-07 ,1.34230e-07 ,1.34840e-07 ,1.35315e-07 , &amp;<a name='10830'>
      1.35990e-07 ,1.36555e-07 ,1.37265e-07 ,1.37945e-07 ,1.38425e-07 , &amp;<a name='10831'>
      1.38950e-07 ,1.39640e-07 ,1.40220e-07 ,1.40775e-07 ,1.41400e-07 , &amp;<a name='10832'>
      1.42020e-07 ,1.42500e-07 ,1.43085e-07 ,1.43680e-07 ,1.44255e-07 , &amp;<a name='10833'>
      1.44855e-07 ,1.45385e-07 ,1.45890e-07 ,1.46430e-07 ,1.46920e-07 , &amp;<a name='10834'>
      1.47715e-07 ,1.48090e-07 ,1.48695e-07 ,1.49165e-07 ,1.49715e-07 , &amp;<a name='10835'>
      1.50130e-07 ,1.50720e-07 ,1.51330e-07 ,1.51725e-07 ,1.52350e-07 /)<a name='10836'>
      totplnkderiv(151:181, 3) = (/ &amp;<a name='10837'>
      1.52965e-07 ,1.53305e-07 ,1.53915e-07 ,1.54280e-07 ,1.54950e-07 , &amp;<a name='10838'>
      1.55370e-07 ,1.55850e-07 ,1.56260e-07 ,1.56825e-07 ,1.57470e-07 , &amp;<a name='10839'>
      1.57760e-07 ,1.58295e-07 ,1.58780e-07 ,1.59470e-07 ,1.59940e-07 , &amp;<a name='10840'>
      1.60325e-07 ,1.60825e-07 ,1.61100e-07 ,1.61605e-07 ,1.62045e-07 , &amp;<a name='10841'>
      1.62670e-07 ,1.63020e-07 ,1.63625e-07 ,1.63900e-07 ,1.64420e-07 , &amp;<a name='10842'>
      1.64705e-07 ,1.65430e-07 ,1.65610e-07 ,1.66220e-07 ,1.66585e-07 , &amp;<a name='10843'>
      1.66965e-07 /)<a name='10844'>
      totplnkderiv(1:50, 4) = (/ &amp;<a name='10845'>
      3.32829e-08 ,3.41160e-08 ,3.49626e-08 ,3.58068e-08 ,3.66765e-08 , &amp;<a name='10846'>
      3.75320e-08 ,3.84095e-08 ,3.92920e-08 ,4.01830e-08 ,4.10715e-08 , &amp;<a name='10847'>
      4.19735e-08 ,4.28835e-08 ,4.37915e-08 ,4.47205e-08 ,4.56410e-08 , &amp;<a name='10848'>
      4.65770e-08 ,4.75090e-08 ,4.84530e-08 ,4.93975e-08 ,5.03470e-08 , &amp;<a name='10849'>
      5.13000e-08 ,5.22560e-08 ,5.32310e-08 ,5.41865e-08 ,5.51655e-08 , &amp;<a name='10850'>
      5.61590e-08 ,5.71120e-08 ,5.81075e-08 ,5.91060e-08 ,6.00895e-08 , &amp;<a name='10851'>
      6.10750e-08 ,6.20740e-08 ,6.30790e-08 ,6.40765e-08 ,6.50940e-08 , &amp;<a name='10852'>
      6.60895e-08 ,6.71230e-08 ,6.81200e-08 ,6.91260e-08 ,7.01485e-08 , &amp;<a name='10853'>
      7.11625e-08 ,7.21870e-08 ,7.32010e-08 ,7.42080e-08 ,7.52285e-08 , &amp;<a name='10854'>
      7.62930e-08 ,7.73040e-08 ,7.83185e-08 ,7.93410e-08 ,8.03560e-08 /)<a name='10855'>
      totplnkderiv(51:100, 4) = (/ &amp;<a name='10856'>
      8.14115e-08 ,8.24200e-08 ,8.34555e-08 ,8.45100e-08 ,8.55265e-08 , &amp;<a name='10857'>
      8.65205e-08 ,8.75615e-08 ,8.85870e-08 ,8.96175e-08 ,9.07015e-08 , &amp;<a name='10858'>
      9.16475e-08 ,9.27525e-08 ,9.37055e-08 ,9.47375e-08 ,9.57995e-08 , &amp;<a name='10859'>
      9.67635e-08 ,9.77980e-08 ,9.87735e-08 ,9.98485e-08 ,1.00904e-07 , &amp;<a name='10860'>
      1.01900e-07 ,1.02876e-07 ,1.03905e-07 ,1.04964e-07 ,1.05956e-07 , &amp;<a name='10861'>
      1.06870e-07 ,1.07952e-07 ,1.08944e-07 ,1.10003e-07 ,1.10965e-07 , &amp;<a name='10862'>
      1.11952e-07 ,1.12927e-07 ,1.13951e-07 ,1.14942e-07 ,1.15920e-07 , &amp;<a name='10863'>
      1.16968e-07 ,1.17877e-07 ,1.18930e-07 ,1.19862e-07 ,1.20817e-07 , &amp;<a name='10864'>
      1.21817e-07 ,1.22791e-07 ,1.23727e-07 ,1.24751e-07 ,1.25697e-07 , &amp;<a name='10865'>
      1.26634e-07 ,1.27593e-07 ,1.28585e-07 ,1.29484e-07 ,1.30485e-07 /)<a name='10866'>
      totplnkderiv(101:150, 4) = (/ &amp;<a name='10867'>
      1.31363e-07 ,1.32391e-07 ,1.33228e-07 ,1.34155e-07 ,1.35160e-07 , &amp;<a name='10868'>
      1.36092e-07 ,1.37070e-07 ,1.37966e-07 ,1.38865e-07 ,1.39740e-07 , &amp;<a name='10869'>
      1.40770e-07 ,1.41620e-07 ,1.42605e-07 ,1.43465e-07 ,1.44240e-07 , &amp;<a name='10870'>
      1.45305e-07 ,1.46220e-07 ,1.47070e-07 ,1.47935e-07 ,1.48890e-07 , &amp;<a name='10871'>
      1.49905e-07 ,1.50640e-07 ,1.51435e-07 ,1.52335e-07 ,1.53235e-07 , &amp;<a name='10872'>
      1.54045e-07 ,1.54895e-07 ,1.55785e-07 ,1.56870e-07 ,1.57360e-07 , &amp;<a name='10873'>
      1.58395e-07 ,1.59185e-07 ,1.60060e-07 ,1.60955e-07 ,1.61770e-07 , &amp;<a name='10874'>
      1.62445e-07 ,1.63415e-07 ,1.64170e-07 ,1.65125e-07 ,1.65995e-07 , &amp;<a name='10875'>
      1.66545e-07 ,1.67580e-07 ,1.68295e-07 ,1.69130e-07 ,1.69935e-07 , &amp;<a name='10876'>
      1.70800e-07 ,1.71610e-07 ,1.72365e-07 ,1.73215e-07 ,1.73770e-07 /)<a name='10877'>
      totplnkderiv(151:181, 4) = (/ &amp;<a name='10878'>
      1.74590e-07 ,1.75525e-07 ,1.76095e-07 ,1.77125e-07 ,1.77745e-07 , &amp;<a name='10879'>
      1.78580e-07 ,1.79315e-07 ,1.80045e-07 ,1.80695e-07 ,1.81580e-07 , &amp;<a name='10880'>
      1.82360e-07 ,1.83205e-07 ,1.84055e-07 ,1.84315e-07 ,1.85225e-07 , &amp;<a name='10881'>
      1.85865e-07 ,1.86660e-07 ,1.87445e-07 ,1.88350e-07 ,1.88930e-07 , &amp;<a name='10882'>
      1.89420e-07 ,1.90275e-07 ,1.90630e-07 ,1.91650e-07 ,1.92485e-07 , &amp;<a name='10883'>
      1.93285e-07 ,1.93695e-07 ,1.94595e-07 ,1.94895e-07 ,1.95960e-07 , &amp;<a name='10884'>
      1.96525e-07 /)<a name='10885'>
      totplnkderiv(1:50, 5) = (/ &amp;<a name='10886'>
      2.41948e-08 ,2.49273e-08 ,2.56705e-08 ,2.64263e-08 ,2.71899e-08 , &amp;<a name='10887'>
      2.79687e-08 ,2.87531e-08 ,2.95520e-08 ,3.03567e-08 ,3.11763e-08 , &amp;<a name='10888'>
      3.20014e-08 ,3.28390e-08 ,3.36865e-08 ,3.45395e-08 ,3.54083e-08 , &amp;<a name='10889'>
      3.62810e-08 ,3.71705e-08 ,3.80585e-08 ,3.89650e-08 ,3.98750e-08 , &amp;<a name='10890'>
      4.07955e-08 ,4.17255e-08 ,4.26635e-08 ,4.36095e-08 ,4.45605e-08 , &amp;<a name='10891'>
      4.55190e-08 ,4.64910e-08 ,4.74670e-08 ,4.84480e-08 ,4.94430e-08 , &amp;<a name='10892'>
      5.04460e-08 ,5.14440e-08 ,5.24500e-08 ,5.34835e-08 ,5.44965e-08 , &amp;<a name='10893'>
      5.55325e-08 ,5.65650e-08 ,5.76050e-08 ,5.86615e-08 ,5.97175e-08 , &amp;<a name='10894'>
      6.07750e-08 ,6.18400e-08 ,6.29095e-08 ,6.39950e-08 ,6.50665e-08 , &amp;<a name='10895'>
      6.61405e-08 ,6.72290e-08 ,6.82800e-08 ,6.94445e-08 ,7.05460e-08 /)<a name='10896'>
      totplnkderiv(51:100, 5) = (/ &amp;<a name='10897'>
      7.16400e-08 ,7.27475e-08 ,7.38790e-08 ,7.49845e-08 ,7.61270e-08 , &amp;<a name='10898'>
      7.72375e-08 ,7.83770e-08 ,7.95045e-08 ,8.06315e-08 ,8.17715e-08 , &amp;<a name='10899'>
      8.29275e-08 ,8.40555e-08 ,8.52110e-08 ,8.63565e-08 ,8.75045e-08 , &amp;<a name='10900'>
      8.86735e-08 ,8.98150e-08 ,9.09970e-08 ,9.21295e-08 ,9.32730e-08 , &amp;<a name='10901'>
      9.44605e-08 ,9.56170e-08 ,9.67885e-08 ,9.79275e-08 ,9.91190e-08 , &amp;<a name='10902'>
      1.00278e-07 ,1.01436e-07 ,1.02625e-07 ,1.03792e-07 ,1.04989e-07 , &amp;<a name='10903'>
      1.06111e-07 ,1.07320e-07 ,1.08505e-07 ,1.09626e-07 ,1.10812e-07 , &amp;<a name='10904'>
      1.11948e-07 ,1.13162e-07 ,1.14289e-07 ,1.15474e-07 ,1.16661e-07 , &amp;<a name='10905'>
      1.17827e-07 ,1.19023e-07 ,1.20167e-07 ,1.21356e-07 ,1.22499e-07 , &amp;<a name='10906'>
      1.23653e-07 ,1.24876e-07 ,1.25983e-07 ,1.27175e-07 ,1.28325e-07 /)<a name='10907'>
      totplnkderiv(101:150, 5) = (/ &amp;<a name='10908'>
      1.29517e-07 ,1.30685e-07 ,1.31840e-07 ,1.33013e-07 ,1.34160e-07 , &amp;<a name='10909'>
      1.35297e-07 ,1.36461e-07 ,1.37630e-07 ,1.38771e-07 ,1.39913e-07 , &amp;<a name='10910'>
      1.41053e-07 ,1.42218e-07 ,1.43345e-07 ,1.44460e-07 ,1.45692e-07 , &amp;<a name='10911'>
      1.46697e-07 ,1.47905e-07 ,1.49010e-07 ,1.50210e-07 ,1.51285e-07 , &amp;<a name='10912'>
      1.52380e-07 ,1.53555e-07 ,1.54655e-07 ,1.55805e-07 ,1.56850e-07 , &amp;<a name='10913'>
      1.58055e-07 ,1.59115e-07 ,1.60185e-07 ,1.61255e-07 ,1.62465e-07 , &amp;<a name='10914'>
      1.63575e-07 ,1.64675e-07 ,1.65760e-07 ,1.66765e-07 ,1.67945e-07 , &amp;<a name='10915'>
      1.69070e-07 ,1.70045e-07 ,1.71145e-07 ,1.72260e-07 ,1.73290e-07 , &amp;<a name='10916'>
      1.74470e-07 ,1.75490e-07 ,1.76515e-07 ,1.77555e-07 ,1.78660e-07 , &amp;<a name='10917'>
      1.79670e-07 ,1.80705e-07 ,1.81895e-07 ,1.82745e-07 ,1.83950e-07 /)<a name='10918'>
      totplnkderiv(151:181, 5) = (/ &amp;<a name='10919'>
      1.84955e-07 ,1.85940e-07 ,1.87080e-07 ,1.88010e-07 ,1.89145e-07 , &amp;<a name='10920'>
      1.90130e-07 ,1.91110e-07 ,1.92130e-07 ,1.93205e-07 ,1.94230e-07 , &amp;<a name='10921'>
      1.95045e-07 ,1.96070e-07 ,1.97155e-07 ,1.98210e-07 ,1.99080e-07 , &amp;<a name='10922'>
      2.00280e-07 ,2.01135e-07 ,2.02150e-07 ,2.03110e-07 ,2.04135e-07 , &amp;<a name='10923'>
      2.05110e-07 ,2.06055e-07 ,2.07120e-07 ,2.08075e-07 ,2.08975e-07 , &amp;<a name='10924'>
      2.09950e-07 ,2.10870e-07 ,2.11830e-07 ,2.12960e-07 ,2.13725e-07 , &amp;<a name='10925'>
      2.14765e-07 /)<a name='10926'>
      totplnkderiv(1:50, 6) = (/ &amp;<a name='10927'>
      1.36567e-08 ,1.41766e-08 ,1.47079e-08 ,1.52499e-08 ,1.58075e-08 , &amp;<a name='10928'>
      1.63727e-08 ,1.69528e-08 ,1.75429e-08 ,1.81477e-08 ,1.87631e-08 , &amp;<a name='10929'>
      1.93907e-08 ,2.00297e-08 ,2.06808e-08 ,2.13432e-08 ,2.20183e-08 , &amp;<a name='10930'>
      2.27076e-08 ,2.34064e-08 ,2.41181e-08 ,2.48400e-08 ,2.55750e-08 , &amp;<a name='10931'>
      2.63231e-08 ,2.70790e-08 ,2.78502e-08 ,2.86326e-08 ,2.94259e-08 , &amp;<a name='10932'>
      3.02287e-08 ,3.10451e-08 ,3.18752e-08 ,3.27108e-08 ,3.35612e-08 , &amp;<a name='10933'>
      3.44198e-08 ,3.52930e-08 ,3.61785e-08 ,3.70690e-08 ,3.79725e-08 , &amp;<a name='10934'>
      3.88845e-08 ,3.98120e-08 ,4.07505e-08 ,4.16965e-08 ,4.26515e-08 , &amp;<a name='10935'>
      4.36190e-08 ,4.45925e-08 ,4.55760e-08 ,4.65735e-08 ,4.75835e-08 , &amp;<a name='10936'>
      4.85970e-08 ,4.96255e-08 ,5.06975e-08 ,5.16950e-08 ,5.27530e-08 /)<a name='10937'>
      totplnkderiv(51:100, 6) = (/ &amp;<a name='10938'>
      5.38130e-08 ,5.48860e-08 ,5.59715e-08 ,5.70465e-08 ,5.81385e-08 , &amp;<a name='10939'>
      5.92525e-08 ,6.03565e-08 ,6.14815e-08 ,6.26175e-08 ,6.37475e-08 , &amp;<a name='10940'>
      6.48855e-08 ,6.60340e-08 ,6.71980e-08 ,6.83645e-08 ,6.95430e-08 , &amp;<a name='10941'>
      7.07145e-08 ,7.19015e-08 ,7.30995e-08 ,7.43140e-08 ,7.55095e-08 , &amp;<a name='10942'>
      7.67115e-08 ,7.79485e-08 ,7.91735e-08 ,8.03925e-08 ,8.16385e-08 , &amp;<a name='10943'>
      8.28775e-08 ,8.41235e-08 ,8.53775e-08 ,8.66405e-08 ,8.78940e-08 , &amp;<a name='10944'>
      8.91805e-08 ,9.04515e-08 ,9.17290e-08 ,9.30230e-08 ,9.43145e-08 , &amp;<a name='10945'>
      9.56200e-08 ,9.69160e-08 ,9.82140e-08 ,9.95285e-08 ,1.00829e-07 , &amp;<a name='10946'>
      1.02145e-07 ,1.03478e-07 ,1.04787e-07 ,1.06095e-07 ,1.07439e-07 , &amp;<a name='10947'>
      1.08785e-07 ,1.10078e-07 ,1.11466e-07 ,1.12795e-07 ,1.14133e-07 /)<a name='10948'>
      totplnkderiv(101:150, 6) = (/ &amp;<a name='10949'>
      1.15479e-07 ,1.16825e-07 ,1.18191e-07 ,1.19540e-07 ,1.20908e-07 , &amp;<a name='10950'>
      1.22257e-07 ,1.23634e-07 ,1.24992e-07 ,1.26345e-07 ,1.27740e-07 , &amp;<a name='10951'>
      1.29098e-07 ,1.30447e-07 ,1.31831e-07 ,1.33250e-07 ,1.34591e-07 , &amp;<a name='10952'>
      1.36011e-07 ,1.37315e-07 ,1.38721e-07 ,1.40103e-07 ,1.41504e-07 , &amp;<a name='10953'>
      1.42882e-07 ,1.44259e-07 ,1.45674e-07 ,1.46997e-07 ,1.48412e-07 , &amp;<a name='10954'>
      1.49794e-07 ,1.51167e-07 ,1.52577e-07 ,1.53941e-07 ,1.55369e-07 , &amp;<a name='10955'>
      1.56725e-07 ,1.58125e-07 ,1.59460e-07 ,1.60895e-07 ,1.62260e-07 , &amp;<a name='10956'>
      1.63610e-07 ,1.65085e-07 ,1.66410e-07 ,1.67805e-07 ,1.69185e-07 , &amp;<a name='10957'>
      1.70570e-07 ,1.71915e-07 ,1.73375e-07 ,1.74775e-07 ,1.76090e-07 , &amp;<a name='10958'>
      1.77485e-07 ,1.78905e-07 ,1.80190e-07 ,1.81610e-07 ,1.82960e-07 /)<a name='10959'>
      totplnkderiv(151:181, 6) = (/ &amp;<a name='10960'>
      1.84330e-07 ,1.85750e-07 ,1.87060e-07 ,1.88470e-07 ,1.89835e-07 , &amp;<a name='10961'>
      1.91250e-07 ,1.92565e-07 ,1.93925e-07 ,1.95220e-07 ,1.96620e-07 , &amp;<a name='10962'>
      1.98095e-07 ,1.99330e-07 ,2.00680e-07 ,2.02090e-07 ,2.03360e-07 , &amp;<a name='10963'>
      2.04775e-07 ,2.06080e-07 ,2.07440e-07 ,2.08820e-07 ,2.10095e-07 , &amp;<a name='10964'>
      2.11445e-07 ,2.12785e-07 ,2.14050e-07 ,2.15375e-07 ,2.16825e-07 , &amp;<a name='10965'>
      2.18080e-07 ,2.19345e-07 ,2.20710e-07 ,2.21980e-07 ,2.23425e-07 , &amp;<a name='10966'>
      2.24645e-07 /)<a name='10967'>
      totplnkderiv(1:50, 7) = (/ &amp;<a name='10968'>
      7.22270e-09 ,7.55350e-09 ,7.89480e-09 ,8.24725e-09 ,8.60780e-09 , &amp;<a name='10969'>
      8.98215e-09 ,9.36430e-09 ,9.76035e-09 ,1.01652e-08 ,1.05816e-08 , &amp;<a name='10970'>
      1.10081e-08 ,1.14480e-08 ,1.18981e-08 ,1.23600e-08 ,1.28337e-08 , &amp;<a name='10971'>
      1.33172e-08 ,1.38139e-08 ,1.43208e-08 ,1.48413e-08 ,1.53702e-08 , &amp;<a name='10972'>
      1.59142e-08 ,1.64704e-08 ,1.70354e-08 ,1.76178e-08 ,1.82065e-08 , &amp;<a name='10973'>
      1.88083e-08 ,1.94237e-08 ,2.00528e-08 ,2.06913e-08 ,2.13413e-08 , &amp;<a name='10974'>
      2.20058e-08 ,2.26814e-08 ,2.33686e-08 ,2.40729e-08 ,2.47812e-08 , &amp;<a name='10975'>
      2.55099e-08 ,2.62449e-08 ,2.69966e-08 ,2.77569e-08 ,2.85269e-08 , &amp;<a name='10976'>
      2.93144e-08 ,3.01108e-08 ,3.09243e-08 ,3.17433e-08 ,3.25756e-08 , &amp;<a name='10977'>
      3.34262e-08 ,3.42738e-08 ,3.51480e-08 ,3.60285e-08 ,3.69160e-08 /)<a name='10978'>
      totplnkderiv(51:100, 7) = (/ &amp;<a name='10979'>
      3.78235e-08 ,3.87390e-08 ,3.96635e-08 ,4.06095e-08 ,4.15600e-08 , &amp;<a name='10980'>
      4.25180e-08 ,4.34895e-08 ,4.44800e-08 ,4.54715e-08 ,4.64750e-08 , &amp;<a name='10981'>
      4.74905e-08 ,4.85210e-08 ,4.95685e-08 ,5.06135e-08 ,5.16725e-08 , &amp;<a name='10982'>
      5.27480e-08 ,5.38265e-08 ,5.49170e-08 ,5.60120e-08 ,5.71275e-08 , &amp;<a name='10983'>
      5.82610e-08 ,5.93775e-08 ,6.05245e-08 ,6.17025e-08 ,6.28355e-08 , &amp;<a name='10984'>
      6.40135e-08 ,6.52015e-08 ,6.63865e-08 ,6.75790e-08 ,6.88120e-08 , &amp;<a name='10985'>
      7.00070e-08 ,7.12335e-08 ,7.24720e-08 ,7.37340e-08 ,7.49775e-08 , &amp;<a name='10986'>
      7.62415e-08 ,7.75185e-08 ,7.87915e-08 ,8.00875e-08 ,8.13630e-08 , &amp;<a name='10987'>
      8.26710e-08 ,8.39645e-08 ,8.53060e-08 ,8.66305e-08 ,8.79915e-08 , &amp;<a name='10988'>
      8.93080e-08 ,9.06560e-08 ,9.19860e-08 ,9.33550e-08 ,9.47305e-08 /)<a name='10989'>
      totplnkderiv(101:150, 7) = (/ &amp;<a name='10990'>
      9.61180e-08 ,9.74500e-08 ,9.88850e-08 ,1.00263e-07 ,1.01688e-07 , &amp;<a name='10991'>
      1.03105e-07 ,1.04489e-07 ,1.05906e-07 ,1.07345e-07 ,1.08771e-07 , &amp;<a name='10992'>
      1.10220e-07 ,1.11713e-07 ,1.13098e-07 ,1.14515e-07 ,1.16019e-07 , &amp;<a name='10993'>
      1.17479e-07 ,1.18969e-07 ,1.20412e-07 ,1.21852e-07 ,1.23387e-07 , &amp;<a name='10994'>
      1.24851e-07 ,1.26319e-07 ,1.27811e-07 ,1.29396e-07 ,1.30901e-07 , &amp;<a name='10995'>
      1.32358e-07 ,1.33900e-07 ,1.35405e-07 ,1.36931e-07 ,1.38443e-07 , &amp;<a name='10996'>
      1.39985e-07 ,1.41481e-07 ,1.43072e-07 ,1.44587e-07 ,1.46133e-07 , &amp;<a name='10997'>
      1.47698e-07 ,1.49203e-07 ,1.50712e-07 ,1.52363e-07 ,1.53795e-07 , &amp;<a name='10998'>
      1.55383e-07 ,1.56961e-07 ,1.58498e-07 ,1.60117e-07 ,1.61745e-07 , &amp;<a name='10999'>
      1.63190e-07 ,1.64790e-07 ,1.66370e-07 ,1.67975e-07 ,1.69555e-07 /)<a name='11000'>
      totplnkderiv(151:181, 7) = (/ &amp;<a name='11001'>
      1.71060e-07 ,1.72635e-07 ,1.74345e-07 ,1.75925e-07 ,1.77395e-07 , &amp;<a name='11002'>
      1.78960e-07 ,1.80620e-07 ,1.82180e-07 ,1.83840e-07 ,1.85340e-07 , &amp;<a name='11003'>
      1.86940e-07 ,1.88550e-07 ,1.90095e-07 ,1.91670e-07 ,1.93385e-07 , &amp;<a name='11004'>
      1.94895e-07 ,1.96500e-07 ,1.98090e-07 ,1.99585e-07 ,2.01280e-07 , &amp;<a name='11005'>
      2.02950e-07 ,2.04455e-07 ,2.06075e-07 ,2.07635e-07 ,2.09095e-07 , &amp;<a name='11006'>
      2.10865e-07 ,2.12575e-07 ,2.14050e-07 ,2.15630e-07 ,2.17060e-07 , &amp;<a name='11007'>
      2.18715e-07 /)<a name='11008'>
      totplnkderiv(1:50, 8) = (/ &amp;<a name='11009'>
      4.26397e-09 ,4.48470e-09 ,4.71299e-09 ,4.94968e-09 ,5.19542e-09 , &amp;<a name='11010'>
      5.44847e-09 ,5.71195e-09 ,5.98305e-09 ,6.26215e-09 ,6.55290e-09 , &amp;<a name='11011'>
      6.85190e-09 ,7.15950e-09 ,7.47745e-09 ,7.80525e-09 ,8.14190e-09 , &amp;<a name='11012'>
      8.48915e-09 ,8.84680e-09 ,9.21305e-09 ,9.59105e-09 ,9.98130e-09 , &amp;<a name='11013'>
      1.03781e-08 ,1.07863e-08 ,1.12094e-08 ,1.16371e-08 ,1.20802e-08 , &amp;<a name='11014'>
      1.25327e-08 ,1.29958e-08 ,1.34709e-08 ,1.39592e-08 ,1.44568e-08 , &amp;<a name='11015'>
      1.49662e-08 ,1.54828e-08 ,1.60186e-08 ,1.65612e-08 ,1.71181e-08 , &amp;<a name='11016'>
      1.76822e-08 ,1.82591e-08 ,1.88487e-08 ,1.94520e-08 ,2.00691e-08 , &amp;<a name='11017'>
      2.06955e-08 ,2.13353e-08 ,2.19819e-08 ,2.26479e-08 ,2.33234e-08 , &amp;<a name='11018'>
      2.40058e-08 ,2.47135e-08 ,2.54203e-08 ,2.61414e-08 ,2.68778e-08 /)<a name='11019'>
      totplnkderiv(51:100, 8) = (/ &amp;<a name='11020'>
      2.76265e-08 ,2.83825e-08 ,2.91632e-08 ,2.99398e-08 ,3.07389e-08 , &amp;<a name='11021'>
      3.15444e-08 ,3.23686e-08 ,3.31994e-08 ,3.40487e-08 ,3.49020e-08 , &amp;<a name='11022'>
      3.57715e-08 ,3.66515e-08 ,3.75465e-08 ,3.84520e-08 ,3.93675e-08 , &amp;<a name='11023'>
      4.02985e-08 ,4.12415e-08 ,4.21965e-08 ,4.31630e-08 ,4.41360e-08 , &amp;<a name='11024'>
      4.51220e-08 ,4.61235e-08 ,4.71440e-08 ,4.81515e-08 ,4.91905e-08 , &amp;<a name='11025'>
      5.02395e-08 ,5.12885e-08 ,5.23735e-08 ,5.34460e-08 ,5.45245e-08 , &amp;<a name='11026'>
      5.56375e-08 ,5.67540e-08 ,5.78780e-08 ,5.90065e-08 ,6.01520e-08 , &amp;<a name='11027'>
      6.13000e-08 ,6.24720e-08 ,6.36530e-08 ,6.48500e-08 ,6.60500e-08 , &amp;<a name='11028'>
      6.72435e-08 ,6.84735e-08 ,6.97025e-08 ,7.09530e-08 ,7.21695e-08 , &amp;<a name='11029'>
      7.34270e-08 ,7.47295e-08 ,7.59915e-08 ,7.72685e-08 ,7.85925e-08 /)<a name='11030'>
      totplnkderiv(101:150, 8) = (/ &amp;<a name='11031'>
      7.98855e-08 ,8.12205e-08 ,8.25120e-08 ,8.38565e-08 ,8.52005e-08 , &amp;<a name='11032'>
      8.65570e-08 ,8.79075e-08 ,8.92920e-08 ,9.06535e-08 ,9.20455e-08 , &amp;<a name='11033'>
      9.34230e-08 ,9.48355e-08 ,9.62720e-08 ,9.76890e-08 ,9.90755e-08 , &amp;<a name='11034'>
      1.00528e-07 ,1.01982e-07 ,1.03436e-07 ,1.04919e-07 ,1.06368e-07 , &amp;<a name='11035'>
      1.07811e-07 ,1.09326e-07 ,1.10836e-07 ,1.12286e-07 ,1.13803e-07 , &amp;<a name='11036'>
      1.15326e-07 ,1.16809e-07 ,1.18348e-07 ,1.19876e-07 ,1.21413e-07 , &amp;<a name='11037'>
      1.22922e-07 ,1.24524e-07 ,1.26049e-07 ,1.27573e-07 ,1.29155e-07 , &amp;<a name='11038'>
      1.30708e-07 ,1.32327e-07 ,1.33958e-07 ,1.35480e-07 ,1.37081e-07 , &amp;<a name='11039'>
      1.38716e-07 ,1.40326e-07 ,1.41872e-07 ,1.43468e-07 ,1.45092e-07 , &amp;<a name='11040'>
      1.46806e-07 ,1.48329e-07 ,1.49922e-07 ,1.51668e-07 ,1.53241e-07 /)<a name='11041'>
      totplnkderiv(151:181, 8) = (/ &amp;<a name='11042'>
      1.54996e-07 ,1.56561e-07 ,1.58197e-07 ,1.59884e-07 ,1.61576e-07 , &amp;<a name='11043'>
      1.63200e-07 ,1.64885e-07 ,1.66630e-07 ,1.68275e-07 ,1.69935e-07 , &amp;<a name='11044'>
      1.71650e-07 ,1.73245e-07 ,1.75045e-07 ,1.76710e-07 ,1.78330e-07 , &amp;<a name='11045'>
      1.79995e-07 ,1.81735e-07 ,1.83470e-07 ,1.85200e-07 ,1.86890e-07 , &amp;<a name='11046'>
      1.88595e-07 ,1.90300e-07 ,1.91995e-07 ,1.93715e-07 ,1.95495e-07 , &amp;<a name='11047'>
      1.97130e-07 ,1.98795e-07 ,2.00680e-07 ,2.02365e-07 ,2.04090e-07 , &amp;<a name='11048'>
      2.05830e-07 /)<a name='11049'>
      totplnkderiv(1:50, 9) = (/ &amp;<a name='11050'>
      1.85410e-09 ,1.96515e-09 ,2.08117e-09 ,2.20227e-09 ,2.32861e-09 , &amp;<a name='11051'>
      2.46066e-09 ,2.59812e-09 ,2.74153e-09 ,2.89058e-09 ,3.04567e-09 , &amp;<a name='11052'>
      3.20674e-09 ,3.37442e-09 ,3.54854e-09 ,3.72892e-09 ,3.91630e-09 , &amp;<a name='11053'>
      4.11013e-09 ,4.31150e-09 ,4.52011e-09 ,4.73541e-09 ,4.95870e-09 , &amp;<a name='11054'>
      5.18913e-09 ,5.42752e-09 ,5.67340e-09 ,5.92810e-09 ,6.18995e-09 , &amp;<a name='11055'>
      6.46055e-09 ,6.73905e-09 ,7.02620e-09 ,7.32260e-09 ,7.62700e-09 , &amp;<a name='11056'>
      7.94050e-09 ,8.26370e-09 ,8.59515e-09 ,8.93570e-09 ,9.28535e-09 , &amp;<a name='11057'>
      9.64575e-09 ,1.00154e-08 ,1.03944e-08 ,1.07839e-08 ,1.11832e-08 , &amp;<a name='11058'>
      1.15909e-08 ,1.20085e-08 ,1.24399e-08 ,1.28792e-08 ,1.33280e-08 , &amp;<a name='11059'>
      1.37892e-08 ,1.42573e-08 ,1.47408e-08 ,1.52345e-08 ,1.57371e-08 /)<a name='11060'>
      totplnkderiv(51:100, 9) = (/ &amp;<a name='11061'>
      1.62496e-08 ,1.67756e-08 ,1.73101e-08 ,1.78596e-08 ,1.84161e-08 , &amp;<a name='11062'>
      1.89869e-08 ,1.95681e-08 ,2.01632e-08 ,2.07626e-08 ,2.13800e-08 , &amp;<a name='11063'>
      2.20064e-08 ,2.26453e-08 ,2.32970e-08 ,2.39595e-08 ,2.46340e-08 , &amp;<a name='11064'>
      2.53152e-08 ,2.60158e-08 ,2.67235e-08 ,2.74471e-08 ,2.81776e-08 , &amp;<a name='11065'>
      2.89233e-08 ,2.96822e-08 ,3.04488e-08 ,3.12298e-08 ,3.20273e-08 , &amp;<a name='11066'>
      3.28304e-08 ,3.36455e-08 ,3.44765e-08 ,3.53195e-08 ,3.61705e-08 , &amp;<a name='11067'>
      3.70385e-08 ,3.79155e-08 ,3.88065e-08 ,3.97055e-08 ,4.06210e-08 , &amp;<a name='11068'>
      4.15490e-08 ,4.24825e-08 ,4.34355e-08 ,4.43920e-08 ,4.53705e-08 , &amp;<a name='11069'>
      4.63560e-08 ,4.73565e-08 ,4.83655e-08 ,4.93815e-08 ,5.04180e-08 , &amp;<a name='11070'>
      5.14655e-08 ,5.25175e-08 ,5.35865e-08 ,5.46720e-08 ,5.57670e-08 /)<a name='11071'>
      totplnkderiv(101:150, 9) = (/ &amp;<a name='11072'>
      5.68640e-08 ,5.79825e-08 ,5.91140e-08 ,6.02515e-08 ,6.13985e-08 , &amp;<a name='11073'>
      6.25525e-08 ,6.37420e-08 ,6.49220e-08 ,6.61145e-08 ,6.73185e-08 , &amp;<a name='11074'>
      6.85520e-08 ,6.97760e-08 ,7.10050e-08 ,7.22650e-08 ,7.35315e-08 , &amp;<a name='11075'>
      7.48035e-08 ,7.60745e-08 ,7.73740e-08 ,7.86870e-08 ,7.99845e-08 , &amp;<a name='11076'>
      8.13325e-08 ,8.26615e-08 ,8.40010e-08 ,8.53640e-08 ,8.67235e-08 , &amp;<a name='11077'>
      8.80960e-08 ,8.95055e-08 ,9.08945e-08 ,9.23045e-08 ,9.37100e-08 , &amp;<a name='11078'>
      9.51555e-08 ,9.65630e-08 ,9.80235e-08 ,9.94920e-08 ,1.00966e-07 , &amp;<a name='11079'>
      1.02434e-07 ,1.03898e-07 ,1.05386e-07 ,1.06905e-07 ,1.08418e-07 , &amp;<a name='11080'>
      1.09926e-07 ,1.11454e-07 ,1.13010e-07 ,1.14546e-07 ,1.16106e-07 , &amp;<a name='11081'>
      1.17652e-07 ,1.19264e-07 ,1.20817e-07 ,1.22395e-07 ,1.24024e-07 /)<a name='11082'>
      totplnkderiv(151:181, 9) = (/ &amp;<a name='11083'>
      1.25585e-07 ,1.27213e-07 ,1.28817e-07 ,1.30472e-07 ,1.32088e-07 , &amp;<a name='11084'>
      1.33752e-07 ,1.35367e-07 ,1.37018e-07 ,1.38698e-07 ,1.40394e-07 , &amp;<a name='11085'>
      1.42026e-07 ,1.43796e-07 ,1.45438e-07 ,1.47175e-07 ,1.48866e-07 , &amp;<a name='11086'>
      1.50576e-07 ,1.52281e-07 ,1.54018e-07 ,1.55796e-07 ,1.57515e-07 , &amp;<a name='11087'>
      1.59225e-07 ,1.60989e-07 ,1.62754e-07 ,1.64532e-07 ,1.66285e-07 , &amp;<a name='11088'>
      1.68070e-07 ,1.69870e-07 ,1.71625e-07 ,1.73440e-07 ,1.75275e-07 , &amp;<a name='11089'>
      1.77040e-07 /)<a name='11090'>
      totplnkderiv(1:50,10) = (/ &amp;<a name='11091'>
      7.14917e-10 ,7.64833e-10 ,8.17460e-10 ,8.72980e-10 ,9.31380e-10 , &amp;<a name='11092'>
      9.92940e-10 ,1.05746e-09 ,1.12555e-09 ,1.19684e-09 ,1.27162e-09 , &amp;<a name='11093'>
      1.35001e-09 ,1.43229e-09 ,1.51815e-09 ,1.60831e-09 ,1.70271e-09 , &amp;<a name='11094'>
      1.80088e-09 ,1.90365e-09 ,2.01075e-09 ,2.12261e-09 ,2.23924e-09 , &amp;<a name='11095'>
      2.36057e-09 ,2.48681e-09 ,2.61814e-09 ,2.75506e-09 ,2.89692e-09 , &amp;<a name='11096'>
      3.04423e-09 ,3.19758e-09 ,3.35681e-09 ,3.52113e-09 ,3.69280e-09 , &amp;<a name='11097'>
      3.86919e-09 ,4.05205e-09 ,4.24184e-09 ,4.43877e-09 ,4.64134e-09 , &amp;<a name='11098'>
      4.85088e-09 ,5.06670e-09 ,5.29143e-09 ,5.52205e-09 ,5.75980e-09 , &amp;<a name='11099'>
      6.00550e-09 ,6.25840e-09 ,6.51855e-09 ,6.78800e-09 ,7.06435e-09 , &amp;<a name='11100'>
      7.34935e-09 ,7.64220e-09 ,7.94470e-09 ,8.25340e-09 ,8.57030e-09 /)<a name='11101'>
      totplnkderiv(51:100,10) = (/ &amp;<a name='11102'>
      8.89680e-09 ,9.23255e-09 ,9.57770e-09 ,9.93045e-09 ,1.02932e-08 , &amp;<a name='11103'>
      1.06649e-08 ,1.10443e-08 ,1.14348e-08 ,1.18350e-08 ,1.22463e-08 , &amp;<a name='11104'>
      1.26679e-08 ,1.30949e-08 ,1.35358e-08 ,1.39824e-08 ,1.44425e-08 , &amp;<a name='11105'>
      1.49126e-08 ,1.53884e-08 ,1.58826e-08 ,1.63808e-08 ,1.68974e-08 , &amp;<a name='11106'>
      1.74159e-08 ,1.79447e-08 ,1.84886e-08 ,1.90456e-08 ,1.96124e-08 , &amp;<a name='11107'>
      2.01863e-08 ,2.07737e-08 ,2.13720e-08 ,2.19837e-08 ,2.26044e-08 , &amp;<a name='11108'>
      2.32396e-08 ,2.38856e-08 ,2.45344e-08 ,2.52055e-08 ,2.58791e-08 , &amp;<a name='11109'>
      2.65706e-08 ,2.72758e-08 ,2.79852e-08 ,2.87201e-08 ,2.94518e-08 , &amp;<a name='11110'>
      3.02063e-08 ,3.09651e-08 ,3.17357e-08 ,3.25235e-08 ,3.33215e-08 , &amp;<a name='11111'>
      3.41285e-08 ,3.49485e-08 ,3.57925e-08 ,3.66330e-08 ,3.74765e-08 /)<a name='11112'>
      totplnkderiv(101:150,10) = (/ &amp;<a name='11113'>
      3.83675e-08 ,3.92390e-08 ,4.01330e-08 ,4.10340e-08 ,4.19585e-08 , &amp;<a name='11114'>
      4.28815e-08 ,4.38210e-08 ,4.47770e-08 ,4.57575e-08 ,4.67325e-08 , &amp;<a name='11115'>
      4.77170e-08 ,4.87205e-08 ,4.97410e-08 ,5.07620e-08 ,5.18180e-08 , &amp;<a name='11116'>
      5.28540e-08 ,5.39260e-08 ,5.50035e-08 ,5.60885e-08 ,5.71900e-08 , &amp;<a name='11117'>
      5.82940e-08 ,5.94380e-08 ,6.05690e-08 ,6.17185e-08 ,6.28860e-08 , &amp;<a name='11118'>
      6.40670e-08 ,6.52300e-08 ,6.64225e-08 ,6.76485e-08 ,6.88715e-08 , &amp;<a name='11119'>
      7.00750e-08 ,7.13760e-08 ,7.25910e-08 ,7.38860e-08 ,7.51290e-08 , &amp;<a name='11120'>
      7.64420e-08 ,7.77550e-08 ,7.90725e-08 ,8.03825e-08 ,8.17330e-08 , &amp;<a name='11121'>
      8.30810e-08 ,8.44330e-08 ,8.57720e-08 ,8.72115e-08 ,8.85800e-08 , &amp;<a name='11122'>
      8.99945e-08 ,9.13905e-08 ,9.28345e-08 ,9.42665e-08 ,9.56765e-08 /)<a name='11123'>
      totplnkderiv(151:181,10) = (/ &amp;<a name='11124'>
      9.72000e-08 ,9.86780e-08 ,1.00105e-07 ,1.01616e-07 ,1.03078e-07 , &amp;<a name='11125'>
      1.04610e-07 ,1.06154e-07 ,1.07639e-07 ,1.09242e-07 ,1.10804e-07 , &amp;<a name='11126'>
      1.12384e-07 ,1.13871e-07 ,1.15478e-07 ,1.17066e-07 ,1.18703e-07 , &amp;<a name='11127'>
      1.20294e-07 ,1.21930e-07 ,1.23543e-07 ,1.25169e-07 ,1.26806e-07 , &amp;<a name='11128'>
      1.28503e-07 ,1.30233e-07 ,1.31834e-07 ,1.33596e-07 ,1.35283e-07 , &amp;<a name='11129'>
      1.36947e-07 ,1.38594e-07 ,1.40362e-07 ,1.42131e-07 ,1.43823e-07 , &amp;<a name='11130'>
      1.45592e-07 /)<a name='11131'>
      totplnkderiv(1:50,11) = (/ &amp;<a name='11132'>
      2.25919e-10 ,2.43810e-10 ,2.62866e-10 ,2.83125e-10 ,3.04676e-10 , &amp;<a name='11133'>
      3.27536e-10 ,3.51796e-10 ,3.77498e-10 ,4.04714e-10 ,4.33528e-10 , &amp;<a name='11134'>
      4.64000e-10 ,4.96185e-10 ,5.30165e-10 ,5.65999e-10 ,6.03749e-10 , &amp;<a name='11135'>
      6.43579e-10 ,6.85479e-10 ,7.29517e-10 ,7.75810e-10 ,8.24440e-10 , &amp;<a name='11136'>
      8.75520e-10 ,9.29065e-10 ,9.85175e-10 ,1.04405e-09 ,1.10562e-09 , &amp;<a name='11137'>
      1.17005e-09 ,1.23742e-09 ,1.30780e-09 ,1.38141e-09 ,1.45809e-09 , &amp;<a name='11138'>
      1.53825e-09 ,1.62177e-09 ,1.70884e-09 ,1.79942e-09 ,1.89390e-09 , &amp;<a name='11139'>
      1.99205e-09 ,2.09429e-09 ,2.20030e-09 ,2.31077e-09 ,2.42510e-09 , &amp;<a name='11140'>
      2.54410e-09 ,2.66754e-09 ,2.79529e-09 ,2.92777e-09 ,3.06498e-09 , &amp;<a name='11141'>
      3.20691e-09 ,3.35450e-09 ,3.50653e-09 ,3.66427e-09 ,3.82723e-09 /)<a name='11142'>
      totplnkderiv(51:100,11) = (/ &amp;<a name='11143'>
      3.99549e-09 ,4.16911e-09 ,4.34892e-09 ,4.53415e-09 ,4.72504e-09 , &amp;<a name='11144'>
      4.92197e-09 ,5.12525e-09 ,5.33485e-09 ,5.55085e-09 ,5.77275e-09 , &amp;<a name='11145'>
      6.00105e-09 ,6.23650e-09 ,6.47855e-09 ,6.72735e-09 ,6.98325e-09 , &amp;<a name='11146'>
      7.24695e-09 ,7.51730e-09 ,7.79480e-09 ,8.07975e-09 ,8.37170e-09 , &amp;<a name='11147'>
      8.67195e-09 ,8.98050e-09 ,9.29575e-09 ,9.61950e-09 ,9.95150e-09 , &amp;<a name='11148'>
      1.02912e-08 ,1.06397e-08 ,1.09964e-08 ,1.13611e-08 ,1.17348e-08 , &amp;<a name='11149'>
      1.21158e-08 ,1.25072e-08 ,1.29079e-08 ,1.33159e-08 ,1.37342e-08 , &amp;<a name='11150'>
      1.41599e-08 ,1.45966e-08 ,1.50438e-08 ,1.54964e-08 ,1.59605e-08 , &amp;<a name='11151'>
      1.64337e-08 ,1.69189e-08 ,1.74134e-08 ,1.79136e-08 ,1.84272e-08 , &amp;<a name='11152'>
      1.89502e-08 ,1.94845e-08 ,2.00248e-08 ,2.05788e-08 ,2.11455e-08 /)<a name='11153'>
      totplnkderiv(101:150,11) = (/ &amp;<a name='11154'>
      2.17159e-08 ,2.23036e-08 ,2.28983e-08 ,2.35033e-08 ,2.41204e-08 , &amp;<a name='11155'>
      2.47485e-08 ,2.53860e-08 ,2.60331e-08 ,2.66891e-08 ,2.73644e-08 , &amp;<a name='11156'>
      2.80440e-08 ,2.87361e-08 ,2.94412e-08 ,3.01560e-08 ,3.08805e-08 , &amp;<a name='11157'>
      3.16195e-08 ,3.23690e-08 ,3.31285e-08 ,3.39015e-08 ,3.46820e-08 , &amp;<a name='11158'>
      3.54770e-08 ,3.62805e-08 ,3.70960e-08 ,3.79295e-08 ,3.87715e-08 , &amp;<a name='11159'>
      3.96185e-08 ,4.04860e-08 ,4.13600e-08 ,4.22500e-08 ,4.31490e-08 , &amp;<a name='11160'>
      4.40610e-08 ,4.49810e-08 ,4.59205e-08 ,4.68650e-08 ,4.78260e-08 , &amp;<a name='11161'>
      4.87970e-08 ,4.97790e-08 ,5.07645e-08 ,5.17730e-08 ,5.27960e-08 , &amp;<a name='11162'>
      5.38285e-08 ,5.48650e-08 ,5.59205e-08 ,5.69960e-08 ,5.80690e-08 , &amp;<a name='11163'>
      5.91570e-08 ,6.02640e-08 ,6.13750e-08 ,6.25015e-08 ,6.36475e-08 /)<a name='11164'>
      totplnkderiv(151:181,11) = (/ &amp;<a name='11165'>
      6.47950e-08 ,6.59510e-08 ,6.71345e-08 ,6.83175e-08 ,6.95250e-08 , &amp;<a name='11166'>
      7.07325e-08 ,7.19490e-08 ,7.31880e-08 ,7.44315e-08 ,7.56880e-08 , &amp;<a name='11167'>
      7.69500e-08 ,7.82495e-08 ,7.95330e-08 ,8.08450e-08 ,8.21535e-08 , &amp;<a name='11168'>
      8.34860e-08 ,8.48330e-08 ,8.61795e-08 ,8.75480e-08 ,8.89235e-08 , &amp;<a name='11169'>
      9.03060e-08 ,9.17045e-08 ,9.31140e-08 ,9.45240e-08 ,9.59720e-08 , &amp;<a name='11170'>
      9.74140e-08 ,9.88825e-08 ,1.00347e-07 ,1.01825e-07 ,1.03305e-07 , &amp;<a name='11171'>
      1.04826e-07 /)<a name='11172'>
      totplnkderiv(1:50,12) = (/ &amp;<a name='11173'>
      2.91689e-11 ,3.20300e-11 ,3.51272e-11 ,3.84803e-11 ,4.21014e-11 , &amp;<a name='11174'>
      4.60107e-11 ,5.02265e-11 ,5.47685e-11 ,5.96564e-11 ,6.49111e-11 , &amp;<a name='11175'>
      7.05522e-11 ,7.66060e-11 ,8.30974e-11 ,9.00441e-11 ,9.74820e-11 , &amp;<a name='11176'>
      1.05435e-10 ,1.13925e-10 ,1.22981e-10 ,1.32640e-10 ,1.42933e-10 , &amp;<a name='11177'>
      1.53882e-10 ,1.65527e-10 ,1.77903e-10 ,1.91054e-10 ,2.05001e-10 , &amp;<a name='11178'>
      2.19779e-10 ,2.35448e-10 ,2.52042e-10 ,2.69565e-10 ,2.88128e-10 , &amp;<a name='11179'>
      3.07714e-10 ,3.28370e-10 ,3.50238e-10 ,3.73235e-10 ,3.97433e-10 , &amp;<a name='11180'>
      4.22964e-10 ,4.49822e-10 ,4.78042e-10 ,5.07721e-10 ,5.38915e-10 , &amp;<a name='11181'>
      5.71610e-10 ,6.05916e-10 ,6.41896e-10 ,6.79600e-10 ,7.19110e-10 , &amp;<a name='11182'>
      7.60455e-10 ,8.03625e-10 ,8.48870e-10 ,8.96080e-10 ,9.45490e-10 /)<a name='11183'>
      totplnkderiv(51:100,12) = (/ &amp;<a name='11184'>
      9.96930e-10 ,1.05071e-09 ,1.10679e-09 ,1.16521e-09 ,1.22617e-09 , &amp;<a name='11185'>
      1.28945e-09 ,1.35554e-09 ,1.42427e-09 ,1.49574e-09 ,1.56984e-09 , &amp;<a name='11186'>
      1.64695e-09 ,1.72715e-09 ,1.81034e-09 ,1.89656e-09 ,1.98613e-09 , &amp;<a name='11187'>
      2.07898e-09 ,2.17515e-09 ,2.27498e-09 ,2.37826e-09 ,2.48517e-09 , &amp;<a name='11188'>
      2.59566e-09 ,2.71004e-09 ,2.82834e-09 ,2.95078e-09 ,3.07686e-09 , &amp;<a name='11189'>
      3.20739e-09 ,3.34232e-09 ,3.48162e-09 ,3.62515e-09 ,3.77337e-09 , &amp;<a name='11190'>
      3.92614e-09 ,4.08317e-09 ,4.24567e-09 ,4.41272e-09 ,4.58524e-09 , &amp;<a name='11191'>
      4.76245e-09 ,4.94450e-09 ,5.13235e-09 ,5.32535e-09 ,5.52415e-09 , &amp;<a name='11192'>
      5.72770e-09 ,5.93815e-09 ,6.15315e-09 ,6.37525e-09 ,6.60175e-09 , &amp;<a name='11193'>
      6.83485e-09 ,7.07490e-09 ,7.32060e-09 ,7.57225e-09 ,7.83035e-09 /)<a name='11194'>
      totplnkderiv(101:150,12) = (/ &amp;<a name='11195'>
      8.09580e-09 ,8.36620e-09 ,8.64410e-09 ,8.93110e-09 ,9.22170e-09 , &amp;<a name='11196'>
      9.52055e-09 ,9.82595e-09 ,1.01399e-08 ,1.04613e-08 ,1.07878e-08 , &amp;<a name='11197'>
      1.11223e-08 ,1.14667e-08 ,1.18152e-08 ,1.21748e-08 ,1.25410e-08 , &amp;<a name='11198'>
      1.29147e-08 ,1.32948e-08 ,1.36858e-08 ,1.40827e-08 ,1.44908e-08 , &amp;<a name='11199'>
      1.49040e-08 ,1.53284e-08 ,1.57610e-08 ,1.61995e-08 ,1.66483e-08 , &amp;<a name='11200'>
      1.71068e-08 ,1.75714e-08 ,1.80464e-08 ,1.85337e-08 ,1.90249e-08 , &amp;<a name='11201'>
      1.95309e-08 ,2.00407e-08 ,2.05333e-08 ,2.10929e-08 ,2.16346e-08 , &amp;<a name='11202'>
      2.21829e-08 ,2.27402e-08 ,2.33112e-08 ,2.38922e-08 ,2.44802e-08 , &amp;<a name='11203'>
      2.50762e-08 ,2.56896e-08 ,2.63057e-08 ,2.69318e-08 ,2.75705e-08 , &amp;<a name='11204'>
      2.82216e-08 ,2.88787e-08 ,2.95505e-08 ,3.02335e-08 ,3.09215e-08 /)<a name='11205'>
      totplnkderiv(151:181,12) = (/ &amp;<a name='11206'>
      3.16235e-08 ,3.23350e-08 ,3.30590e-08 ,3.37960e-08 ,3.45395e-08 , &amp;<a name='11207'>
      3.52955e-08 ,3.60615e-08 ,3.68350e-08 ,3.76265e-08 ,3.84255e-08 , &amp;<a name='11208'>
      3.92400e-08 ,4.00485e-08 ,4.08940e-08 ,4.17310e-08 ,4.25860e-08 , &amp;<a name='11209'>
      4.34585e-08 ,4.43270e-08 ,4.52220e-08 ,4.61225e-08 ,4.70345e-08 , &amp;<a name='11210'>
      4.79560e-08 ,4.89000e-08 ,4.98445e-08 ,5.07985e-08 ,5.17705e-08 , &amp;<a name='11211'>
      5.27575e-08 ,5.37420e-08 ,5.47495e-08 ,5.57725e-08 ,5.68105e-08 , &amp;<a name='11212'>
      5.78395e-08 /)<a name='11213'>
      totplnkderiv(1:50,13) = (/ &amp;<a name='11214'>
      5.47482e-12 ,6.09637e-12 ,6.77874e-12 ,7.52703e-12 ,8.34784e-12 , &amp;<a name='11215'>
      9.24486e-12 ,1.02246e-11 ,1.12956e-11 ,1.24615e-11 ,1.37321e-11 , &amp;<a name='11216'>
      1.51131e-11 ,1.66129e-11 ,1.82416e-11 ,2.00072e-11 ,2.19187e-11 , &amp;<a name='11217'>
      2.39828e-11 ,2.62171e-11 ,2.86290e-11 ,3.12283e-11 ,3.40276e-11 , &amp;<a name='11218'>
      3.70433e-11 ,4.02847e-11 ,4.37738e-11 ,4.75070e-11 ,5.15119e-11 , &amp;<a name='11219'>
      5.58120e-11 ,6.04059e-11 ,6.53208e-11 ,7.05774e-11 ,7.61935e-11 , &amp;<a name='11220'>
      8.21832e-11 ,8.85570e-11 ,9.53575e-11 ,1.02592e-10 ,1.10298e-10 , &amp;<a name='11221'>
      1.18470e-10 ,1.27161e-10 ,1.36381e-10 ,1.46161e-10 ,1.56529e-10 , &amp;<a name='11222'>
      1.67521e-10 ,1.79142e-10 ,1.91423e-10 ,2.04405e-10 ,2.18123e-10 , &amp;<a name='11223'>
      2.32608e-10 ,2.47889e-10 ,2.63994e-10 ,2.80978e-10 ,2.98843e-10 /)<a name='11224'>
      totplnkderiv(51:100,13) = (/ &amp;<a name='11225'>
      3.17659e-10 ,3.37423e-10 ,3.58206e-10 ,3.80090e-10 ,4.02996e-10 , &amp;<a name='11226'>
      4.27065e-10 ,4.52298e-10 ,4.78781e-10 ,5.06493e-10 ,5.35576e-10 , &amp;<a name='11227'>
      5.65942e-10 ,5.97761e-10 ,6.31007e-10 ,6.65740e-10 ,7.02095e-10 , &amp;<a name='11228'>
      7.39945e-10 ,7.79575e-10 ,8.20845e-10 ,8.63870e-10 ,9.08680e-10 , &amp;<a name='11229'>
      9.55385e-10 ,1.00416e-09 ,1.05464e-09 ,1.10737e-09 ,1.16225e-09 , &amp;<a name='11230'>
      1.21918e-09 ,1.27827e-09 ,1.33988e-09 ,1.40370e-09 ,1.46994e-09 , &amp;<a name='11231'>
      1.53850e-09 ,1.60993e-09 ,1.68382e-09 ,1.76039e-09 ,1.83997e-09 , &amp;<a name='11232'>
      1.92182e-09 ,2.00686e-09 ,2.09511e-09 ,2.18620e-09 ,2.28034e-09 , &amp;<a name='11233'>
      2.37753e-09 ,2.47805e-09 ,2.58193e-09 ,2.68935e-09 ,2.80064e-09 , &amp;<a name='11234'>
      2.91493e-09 ,3.03271e-09 ,3.15474e-09 ,3.27987e-09 ,3.40936e-09 /)<a name='11235'>
      totplnkderiv(101:150,13) = (/ &amp;<a name='11236'>
      3.54277e-09 ,3.68019e-09 ,3.82173e-09 ,3.96703e-09 ,4.11746e-09 , &amp;<a name='11237'>
      4.27104e-09 ,4.43020e-09 ,4.59395e-09 ,4.76060e-09 ,4.93430e-09 , &amp;<a name='11238'>
      5.11085e-09 ,5.29280e-09 ,5.48055e-09 ,5.67300e-09 ,5.86950e-09 , &amp;<a name='11239'>
      6.07160e-09 ,6.28015e-09 ,6.49295e-09 ,6.71195e-09 ,6.93455e-09 , &amp;<a name='11240'>
      7.16470e-09 ,7.39985e-09 ,7.64120e-09 ,7.88885e-09 ,8.13910e-09 , &amp;<a name='11241'>
      8.39930e-09 ,8.66535e-09 ,8.93600e-09 ,9.21445e-09 ,9.49865e-09 , &amp;<a name='11242'>
      9.78845e-09 ,1.00856e-08 ,1.04361e-08 ,1.07018e-08 ,1.10164e-08 , &amp;<a name='11243'>
      1.13438e-08 ,1.16748e-08 ,1.20133e-08 ,1.23575e-08 ,1.27117e-08 , &amp;<a name='11244'>
      1.30708e-08 ,1.34383e-08 ,1.38138e-08 ,1.41985e-08 ,1.45859e-08 , &amp;<a name='11245'>
      1.49846e-08 ,1.53879e-08 ,1.58042e-08 ,1.62239e-08 ,1.66529e-08 /)<a name='11246'>
      totplnkderiv(151:181,13) = (/ &amp;<a name='11247'>
      1.70954e-08 ,1.75422e-08 ,1.79943e-08 ,1.84537e-08 ,1.89280e-08 , &amp;<a name='11248'>
      1.94078e-08 ,1.98997e-08 ,2.03948e-08 ,2.08956e-08 ,2.14169e-08 , &amp;<a name='11249'>
      2.19330e-08 ,2.24773e-08 ,2.30085e-08 ,2.35676e-08 ,2.41237e-08 , &amp;<a name='11250'>
      2.46919e-08 ,2.52720e-08 ,2.58575e-08 ,2.64578e-08 ,2.70675e-08 , &amp;<a name='11251'>
      2.76878e-08 ,2.83034e-08 ,2.89430e-08 ,2.95980e-08 ,3.02480e-08 , &amp;<a name='11252'>
      3.09105e-08 ,3.15980e-08 ,3.22865e-08 ,3.29755e-08 ,3.36775e-08 , &amp;<a name='11253'>
      3.43990e-08 /)<a name='11254'>
      totplnkderiv(1:50,14) = (/ &amp;<a name='11255'>
      1.81489e-12 ,2.03846e-12 ,2.28659e-12 ,2.56071e-12 ,2.86352e-12 , &amp;<a name='11256'>
      3.19789e-12 ,3.56668e-12 ,3.97211e-12 ,4.41711e-12 ,4.90616e-12 , &amp;<a name='11257'>
      5.44153e-12 ,6.02790e-12 ,6.67001e-12 ,7.37018e-12 ,8.13433e-12 , &amp;<a name='11258'>
      8.96872e-12 ,9.87526e-12 ,1.08601e-11 ,1.19328e-11 ,1.30938e-11 , &amp;<a name='11259'>
      1.43548e-11 ,1.57182e-11 ,1.71916e-11 ,1.87875e-11 ,2.05091e-11 , &amp;<a name='11260'>
      2.23652e-11 ,2.43627e-11 ,2.65190e-11 ,2.88354e-11 ,3.13224e-11 , &amp;<a name='11261'>
      3.39926e-11 ,3.68664e-11 ,3.99372e-11 ,4.32309e-11 ,4.67496e-11 , &amp;<a name='11262'>
      5.05182e-11 ,5.45350e-11 ,5.88268e-11 ,6.34126e-11 ,6.82878e-11 , &amp;<a name='11263'>
      7.34973e-11 ,7.90201e-11 ,8.49075e-11 ,9.11725e-11 ,9.78235e-11 , &amp;<a name='11264'>
      1.04856e-10 ,1.12342e-10 ,1.20278e-10 ,1.28680e-10 ,1.37560e-10 /)<a name='11265'>
      totplnkderiv(51:100,14) = (/ &amp;<a name='11266'>
      1.46953e-10 ,1.56900e-10 ,1.67401e-10 ,1.78498e-10 ,1.90161e-10 , &amp;<a name='11267'>
      2.02523e-10 ,2.15535e-10 ,2.29239e-10 ,2.43665e-10 ,2.58799e-10 , &amp;<a name='11268'>
      2.74767e-10 ,2.91522e-10 ,3.09141e-10 ,3.27625e-10 ,3.47011e-10 , &amp;<a name='11269'>
      3.67419e-10 ,3.88720e-10 ,4.11066e-10 ,4.34522e-10 ,4.59002e-10 , &amp;<a name='11270'>
      4.84657e-10 ,5.11391e-10 ,5.39524e-10 ,5.68709e-10 ,5.99240e-10 , &amp;<a name='11271'>
      6.31295e-10 ,6.64520e-10 ,6.99200e-10 ,7.35525e-10 ,7.73135e-10 , &amp;<a name='11272'>
      8.12440e-10 ,8.53275e-10 ,8.95930e-10 ,9.40165e-10 ,9.86260e-10 , &amp;<a name='11273'>
      1.03423e-09 ,1.08385e-09 ,1.13567e-09 ,1.18916e-09 ,1.24469e-09 , &amp;<a name='11274'>
      1.30262e-09 ,1.36268e-09 ,1.42479e-09 ,1.48904e-09 ,1.55557e-09 , &amp;<a name='11275'>
      1.62478e-09 ,1.69642e-09 ,1.77023e-09 ,1.84696e-09 ,1.92646e-09 /)<a name='11276'>
      totplnkderiv(101:150,14) = (/ &amp;<a name='11277'>
      2.00831e-09 ,2.09299e-09 ,2.18007e-09 ,2.27093e-09 ,2.36398e-09 , &amp;<a name='11278'>
      2.46020e-09 ,2.55985e-09 ,2.66230e-09 ,2.76795e-09 ,2.87667e-09 , &amp;<a name='11279'>
      2.98971e-09 ,3.10539e-09 ,3.22462e-09 ,3.34779e-09 ,3.47403e-09 , &amp;<a name='11280'>
      3.60419e-09 ,3.73905e-09 ,3.87658e-09 ,4.01844e-09 ,4.16535e-09 , &amp;<a name='11281'>
      4.31470e-09 ,4.46880e-09 ,4.62765e-09 ,4.78970e-09 ,4.95735e-09 , &amp;<a name='11282'>
      5.12890e-09 ,5.30430e-09 ,5.48595e-09 ,5.67010e-09 ,5.86145e-09 , &amp;<a name='11283'>
      6.05740e-09 ,6.25725e-09 ,6.46205e-09 ,6.67130e-09 ,6.88885e-09 , &amp;<a name='11284'>
      7.10845e-09 ,7.33450e-09 ,7.56700e-09 ,7.80440e-09 ,8.04465e-09 , &amp;<a name='11285'>
      8.29340e-09 ,8.54820e-09 ,8.80790e-09 ,9.07195e-09 ,9.34605e-09 , &amp;<a name='11286'>
      9.62005e-09 ,9.90685e-09 ,1.01939e-08 ,1.04938e-08 ,1.07957e-08 /)<a name='11287'>
      totplnkderiv(151:181,14) = (/ &amp;<a name='11288'>
      1.11059e-08 ,1.14208e-08 ,1.17447e-08 ,1.20717e-08 ,1.24088e-08 , &amp;<a name='11289'>
      1.27490e-08 ,1.31020e-08 ,1.34601e-08 ,1.38231e-08 ,1.41966e-08 , &amp;<a name='11290'>
      1.45767e-08 ,1.49570e-08 ,1.53503e-08 ,1.57496e-08 ,1.61663e-08 , &amp;<a name='11291'>
      1.65784e-08 ,1.70027e-08 ,1.74290e-08 ,1.78730e-08 ,1.83235e-08 , &amp;<a name='11292'>
      1.87810e-08 ,1.92418e-08 ,1.97121e-08 ,2.01899e-08 ,2.05787e-08 , &amp;<a name='11293'>
      2.11784e-08 ,2.16824e-08 ,2.21931e-08 ,2.27235e-08 ,2.32526e-08 , &amp;<a name='11294'>
      2.37850e-08 /)<a name='11295'>
      totplnkderiv(1:50,15) = (/ &amp;<a name='11296'>
      5.39905e-13 ,6.11835e-13 ,6.92224e-13 ,7.81886e-13 ,8.81851e-13 , &amp;<a name='11297'>
      9.93072e-13 ,1.11659e-12 ,1.25364e-12 ,1.40562e-12 ,1.57359e-12 , &amp;<a name='11298'>
      1.75937e-12 ,1.96449e-12 ,2.19026e-12 ,2.43892e-12 ,2.71249e-12 , &amp;<a name='11299'>
      3.01233e-12 ,3.34163e-12 ,3.70251e-12 ,4.09728e-12 ,4.52885e-12 , &amp;<a name='11300'>
      4.99939e-12 ,5.51242e-12 ,6.07256e-12 ,6.68167e-12 ,7.34274e-12 , &amp;<a name='11301'>
      8.06178e-12 ,8.84185e-12 ,9.68684e-12 ,1.06020e-11 ,1.15909e-11 , &amp;<a name='11302'>
      1.26610e-11 ,1.38158e-11 ,1.50620e-11 ,1.64047e-11 ,1.78508e-11 , &amp;<a name='11303'>
      1.94055e-11 ,2.10805e-11 ,2.28753e-11 ,2.48000e-11 ,2.68699e-11 , &amp;<a name='11304'>
      2.90824e-11 ,3.14526e-11 ,3.39882e-11 ,3.67020e-11 ,3.95914e-11 , &amp;<a name='11305'>
      4.26870e-11 ,4.59824e-11 ,4.94926e-11 ,5.32302e-11 ,5.72117e-11 /)<a name='11306'>
      totplnkderiv(51:100,15) = (/ &amp;<a name='11307'>
      6.14475e-11 ,6.59483e-11 ,7.07393e-11 ,7.57999e-11 ,8.11980e-11 , &amp;<a name='11308'>
      8.68920e-11 ,9.29390e-11 ,9.93335e-11 ,1.06101e-10 ,1.13263e-10 , &amp;<a name='11309'>
      1.20827e-10 ,1.28819e-10 ,1.37255e-10 ,1.46163e-10 ,1.55547e-10 , &amp;<a name='11310'>
      1.65428e-10 ,1.75837e-10 ,1.86816e-10 ,1.98337e-10 ,2.10476e-10 , &amp;<a name='11311'>
      2.23218e-10 ,2.36600e-10 ,2.50651e-10 ,2.65425e-10 ,2.80895e-10 , &amp;<a name='11312'>
      2.97102e-10 ,3.14100e-10 ,3.31919e-10 ,3.50568e-10 ,3.70064e-10 , &amp;<a name='11313'>
      3.90464e-10 ,4.11813e-10 ,4.34111e-10 ,4.57421e-10 ,4.81717e-10 , &amp;<a name='11314'>
      5.07039e-10 ,5.33569e-10 ,5.61137e-10 ,5.89975e-10 ,6.19980e-10 , &amp;<a name='11315'>
      6.51170e-10 ,6.83650e-10 ,7.17520e-10 ,7.52735e-10 ,7.89390e-10 , &amp;<a name='11316'>
      8.27355e-10 ,8.66945e-10 ,9.08020e-10 ,9.50665e-10 ,9.95055e-10 /)<a name='11317'>
      totplnkderiv(101:150,15) = (/ &amp;<a name='11318'>
      1.04101e-09 ,1.08864e-09 ,1.13823e-09 ,1.18923e-09 ,1.24257e-09 , &amp;<a name='11319'>
      1.29741e-09 ,1.35442e-09 ,1.41347e-09 ,1.47447e-09 ,1.53767e-09 , &amp;<a name='11320'>
      1.60322e-09 ,1.67063e-09 ,1.74033e-09 ,1.81256e-09 ,1.88704e-09 , &amp;<a name='11321'>
      1.96404e-09 ,2.04329e-09 ,2.12531e-09 ,2.21032e-09 ,2.29757e-09 , &amp;<a name='11322'>
      2.38739e-09 ,2.48075e-09 ,2.57628e-09 ,2.67481e-09 ,2.77627e-09 , &amp;<a name='11323'>
      2.88100e-09 ,2.98862e-09 ,3.09946e-09 ,3.21390e-09 ,3.33105e-09 , &amp;<a name='11324'>
      3.45185e-09 ,3.57599e-09 ,3.70370e-09 ,3.83512e-09 ,3.96909e-09 , &amp;<a name='11325'>
      4.10872e-09 ,4.25070e-09 ,4.39605e-09 ,4.54670e-09 ,4.70015e-09 , &amp;<a name='11326'>
      4.85850e-09 ,5.02050e-09 ,5.18655e-09 ,5.35815e-09 ,5.53180e-09 , &amp;<a name='11327'>
      5.71225e-09 ,5.89495e-09 ,6.08260e-09 ,6.27485e-09 ,6.47345e-09 /)<a name='11328'>
      totplnkderiv(151:181,15) = (/ &amp;<a name='11329'>
      6.67520e-09 ,6.88310e-09 ,7.09400e-09 ,7.31140e-09 ,7.53350e-09 , &amp;<a name='11330'>
      7.76040e-09 ,7.99215e-09 ,8.22850e-09 ,8.47235e-09 ,8.71975e-09 , &amp;<a name='11331'>
      8.97360e-09 ,9.23365e-09 ,9.49950e-09 ,9.76965e-09 ,1.00441e-08 , &amp;<a name='11332'>
      1.03270e-08 ,1.06158e-08 ,1.09112e-08 ,1.12111e-08 ,1.15172e-08 , &amp;<a name='11333'>
      1.18263e-08 ,1.21475e-08 ,1.24735e-08 ,1.28027e-08 ,1.32023e-08 , &amp;<a name='11334'>
      1.34877e-08 ,1.38399e-08 ,1.42000e-08 ,1.45625e-08 ,1.49339e-08 , &amp;<a name='11335'>
      1.53156e-08 /)<a name='11336'>
      totplnkderiv(1:50,16) = (/ &amp;<a name='11337'>
      4.38799e-14 ,5.04835e-14 ,5.79773e-14 ,6.64627e-14 ,7.60706e-14 , &amp;<a name='11338'>
      8.69213e-14 ,9.91554e-14 ,1.12932e-13 ,1.28419e-13 ,1.45809e-13 , &amp;<a name='11339'>
      1.65298e-13 ,1.87109e-13 ,2.11503e-13 ,2.38724e-13 ,2.69058e-13 , &amp;<a name='11340'>
      3.02878e-13 ,3.40423e-13 ,3.82128e-13 ,4.28390e-13 ,4.79625e-13 , &amp;<a name='11341'>
      5.36292e-13 ,5.98933e-13 ,6.68066e-13 ,7.44216e-13 ,8.28159e-13 , &amp;<a name='11342'>
      9.20431e-13 ,1.02180e-12 ,1.13307e-12 ,1.25504e-12 ,1.38863e-12 , &amp;<a name='11343'>
      1.53481e-12 ,1.69447e-12 ,1.86896e-12 ,2.05903e-12 ,2.26637e-12 , &amp;<a name='11344'>
      2.49193e-12 ,2.73736e-12 ,3.00416e-12 ,3.29393e-12 ,3.60781e-12 , &amp;<a name='11345'>
      3.94805e-12 ,4.31675e-12 ,4.71543e-12 ,5.14627e-12 ,5.61226e-12 , &amp;<a name='11346'>
      6.11456e-12 ,6.65585e-12 ,7.23969e-12 ,7.86811e-12 ,8.54456e-12 /)<a name='11347'>
      totplnkderiv(51:100,16) = (/ &amp;<a name='11348'>
      9.27075e-12 ,1.00516e-11 ,1.08898e-11 ,1.17884e-11 ,1.27514e-11 , &amp;<a name='11349'>
      1.37839e-11 ,1.48893e-11 ,1.60716e-11 ,1.73333e-11 ,1.86849e-11 , &amp;<a name='11350'>
      2.01237e-11 ,2.16610e-11 ,2.33001e-11 ,2.50440e-11 ,2.69035e-11 , &amp;<a name='11351'>
      2.88827e-11 ,3.09881e-11 ,3.32234e-11 ,3.55981e-11 ,3.81193e-11 , &amp;<a name='11352'>
      4.07946e-11 ,4.36376e-11 ,4.66485e-11 ,4.98318e-11 ,5.32080e-11 , &amp;<a name='11353'>
      5.67754e-11 ,6.05524e-11 ,6.45450e-11 ,6.87639e-11 ,7.32160e-11 , &amp;<a name='11354'>
      7.79170e-11 ,8.28780e-11 ,8.81045e-11 ,9.36200e-11 ,9.94280e-11 , &amp;<a name='11355'>
      1.05545e-10 ,1.11982e-10 ,1.18752e-10 ,1.25866e-10 ,1.33350e-10 , &amp;<a name='11356'>
      1.41210e-10 ,1.49469e-10 ,1.58143e-10 ,1.67233e-10 ,1.76760e-10 , &amp;<a name='11357'>
      1.86758e-10 ,1.97236e-10 ,2.08227e-10 ,2.19723e-10 ,2.31737e-10 /)<a name='11358'>
      totplnkderiv(101:150,16) = (/ &amp;<a name='11359'>
      2.44329e-10 ,2.57503e-10 ,2.71267e-10 ,2.85647e-10 ,3.00706e-10 , &amp;<a name='11360'>
      3.16391e-10 ,3.32807e-10 ,3.49887e-10 ,3.67748e-10 ,3.86369e-10 , &amp;<a name='11361'>
      4.05746e-10 ,4.25984e-10 ,4.47060e-10 ,4.68993e-10 ,4.91860e-10 , &amp;<a name='11362'>
      5.15601e-10 ,5.40365e-10 ,5.66085e-10 ,5.92855e-10 ,6.20640e-10 , &amp;<a name='11363'>
      6.49605e-10 ,6.79585e-10 ,7.10710e-10 ,7.43145e-10 ,7.76805e-10 , &amp;<a name='11364'>
      8.11625e-10 ,8.47800e-10 ,8.85300e-10 ,9.24220e-10 ,9.64550e-10 , &amp;<a name='11365'>
      1.00623e-09 ,1.04957e-09 ,1.09429e-09 ,1.14079e-09 ,1.18882e-09 , &amp;<a name='11366'>
      1.23848e-09 ,1.28986e-09 ,1.34301e-09 ,1.39796e-09 ,1.45493e-09 , &amp;<a name='11367'>
      1.51372e-09 ,1.57440e-09 ,1.63702e-09 ,1.70173e-09 ,1.76874e-09 , &amp;<a name='11368'>
      1.83753e-09 ,1.90898e-09 ,1.98250e-09 ,2.05836e-09 ,2.13646e-09 /)<a name='11369'>
      totplnkderiv(151:181,16) = (/ &amp;<a name='11370'>
      2.21710e-09 ,2.30027e-09 ,2.38591e-09 ,2.47432e-09 ,2.56503e-09 , &amp;<a name='11371'>
      2.65878e-09 ,2.75516e-09 ,2.85432e-09 ,2.95688e-09 ,3.06201e-09 , &amp;<a name='11372'>
      3.17023e-09 ,3.28153e-09 ,3.39604e-09 ,3.51391e-09 ,3.63517e-09 , &amp;<a name='11373'>
      3.75955e-09 ,3.88756e-09 ,4.01880e-09 ,4.15405e-09 ,4.29255e-09 , &amp;<a name='11374'>
      4.43535e-09 ,4.58145e-09 ,4.73165e-09 ,4.88560e-09 ,5.04390e-09 , &amp;<a name='11375'>
      5.20630e-09 ,5.37255e-09 ,5.54355e-09 ,5.71915e-09 ,5.89855e-09 , &amp;<a name='11376'>
      6.08280e-09 /)<a name='11377'>
      totplk16deriv(1:50) = (/ &amp;<a name='11378'>
      4.35811e-14 ,5.01270e-14 ,5.75531e-14 ,6.59588e-14 ,7.54735e-14 , &amp;<a name='11379'>
      8.62147e-14 ,9.83225e-14 ,1.11951e-13 ,1.27266e-13 ,1.44456e-13 , &amp;<a name='11380'>
      1.63715e-13 ,1.85257e-13 ,2.09343e-13 ,2.36209e-13 ,2.66136e-13 , &amp;<a name='11381'>
      2.99486e-13 ,3.36493e-13 ,3.77582e-13 ,4.23146e-13 ,4.73578e-13 , &amp;<a name='11382'>
      5.29332e-13 ,5.90936e-13 ,6.58891e-13 ,7.33710e-13 ,8.16135e-13 , &amp;<a name='11383'>
      9.06705e-13 ,1.00614e-12 ,1.11524e-12 ,1.23477e-12 ,1.36561e-12 , &amp;<a name='11384'>
      1.50871e-12 ,1.66488e-12 ,1.83552e-12 ,2.02123e-12 ,2.22375e-12 , &amp;<a name='11385'>
      2.44389e-12 ,2.68329e-12 ,2.94338e-12 ,3.22570e-12 ,3.53129e-12 , &amp;<a name='11386'>
      3.86236e-12 ,4.22086e-12 ,4.60827e-12 ,5.02666e-12 ,5.47890e-12 , &amp;<a name='11387'>
      5.96595e-12 ,6.49057e-12 ,7.05592e-12 ,7.66401e-12 ,8.31821e-12 /)<a name='11388'>
      totplk16deriv(51:100) = (/ &amp;<a name='11389'>
      9.01998e-12 ,9.77390e-12 ,1.05826e-11 ,1.14491e-11 ,1.23769e-11 , &amp;<a name='11390'>
      1.33709e-11 ,1.44341e-11 ,1.55706e-11 ,1.67821e-11 ,1.80793e-11 , &amp;<a name='11391'>
      1.94586e-11 ,2.09316e-11 ,2.25007e-11 ,2.41685e-11 ,2.59454e-11 , &amp;<a name='11392'>
      2.78356e-11 ,2.98440e-11 ,3.19744e-11 ,3.42355e-11 ,3.66340e-11 , &amp;<a name='11393'>
      3.91772e-11 ,4.18773e-11 ,4.47339e-11 ,4.77509e-11 ,5.09490e-11 , &amp;<a name='11394'>
      5.43240e-11 ,5.78943e-11 ,6.16648e-11 ,6.56445e-11 ,6.98412e-11 , &amp;<a name='11395'>
      7.42680e-11 ,7.89335e-11 ,8.38450e-11 ,8.90220e-11 ,9.44695e-11 , &amp;<a name='11396'>
      1.00197e-10 ,1.06221e-10 ,1.12550e-10 ,1.19193e-10 ,1.26175e-10 , &amp;<a name='11397'>
      1.33498e-10 ,1.41188e-10 ,1.49251e-10 ,1.57693e-10 ,1.66530e-10 , &amp;<a name='11398'>
      1.75798e-10 ,1.85495e-10 ,1.95661e-10 ,2.06275e-10 ,2.17357e-10 /)<a name='11399'>
      totplk16deriv(101:150) = (/ &amp;<a name='11400'>
      2.28959e-10 ,2.41085e-10 ,2.53739e-10 ,2.66944e-10 ,2.80755e-10 , &amp;<a name='11401'>
      2.95121e-10 ,3.10141e-10 ,3.25748e-10 ,3.42057e-10 ,3.59026e-10 , &amp;<a name='11402'>
      3.76668e-10 ,3.95066e-10 ,4.14211e-10 ,4.34111e-10 ,4.54818e-10 , &amp;<a name='11403'>
      4.76295e-10 ,4.98681e-10 ,5.21884e-10 ,5.46000e-10 ,5.71015e-10 , &amp;<a name='11404'>
      5.97065e-10 ,6.23965e-10 ,6.51865e-10 ,6.80905e-10 ,7.11005e-10 , &amp;<a name='11405'>
      7.42100e-10 ,7.74350e-10 ,8.07745e-10 ,8.42355e-10 ,8.78185e-10 , &amp;<a name='11406'>
      9.15130e-10 ,9.53520e-10 ,9.93075e-10 ,1.03415e-09 ,1.07649e-09 , &amp;<a name='11407'>
      1.12021e-09 ,1.16539e-09 ,1.21207e-09 ,1.26025e-09 ,1.31014e-09 , &amp;<a name='11408'>
      1.36156e-09 ,1.41453e-09 ,1.46909e-09 ,1.52540e-09 ,1.58368e-09 , &amp;<a name='11409'>
      1.64334e-09 ,1.70527e-09 ,1.76888e-09 ,1.83442e-09 ,1.90182e-09 /)<a name='11410'>
      totplk16deriv(151:181) = (/ &amp;<a name='11411'>
      1.97128e-09 ,2.04281e-09 ,2.11635e-09 ,2.19219e-09 ,2.26979e-09 , &amp;<a name='11412'>
      2.34989e-09 ,2.43219e-09 ,2.51660e-09 ,2.60396e-09 ,2.69317e-09 , &amp;<a name='11413'>
      2.78501e-09 ,2.87927e-09 ,2.97600e-09 ,3.07548e-09 ,3.17772e-09 , &amp;<a name='11414'>
      3.28235e-09 ,3.38982e-09 ,3.49985e-09 ,3.61307e-09 ,3.72883e-09 , &amp;<a name='11415'>
      3.84805e-09 ,3.96975e-09 ,4.09465e-09 ,4.22240e-09 ,4.35370e-09 , &amp;<a name='11416'>
      4.48800e-09 ,4.62535e-09 ,4.76640e-09 ,4.91110e-09 ,5.05850e-09 , &amp;<a name='11417'>
      5.20965e-09 /)<a name='11418'>
<a name='11419'>
      end subroutine lwavplankderiv<a name='11420'>
<a name='11421'>
      end module rrtmg_lw_setcoef_f<a name='11422'>
<a name='11423'>
<A NAME='RRTMG_LW_INIT_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INIT_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='11424'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_init_f</font> <A href='../../call_to/RRTMG_LW_INIT_F.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_INIT_F.html' TARGET='index'>2</A><a name='11425'>
<a name='11426'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='11427'></font>
<font color=#447700>! |                                                                          |<a name='11428'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='11429'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='11430'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='11431'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='11432'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='11433'></font>
<font color=#447700>! |                                                                          |<a name='11434'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='11435'></font>
<a name='11436'>
<font color=#447700>! ------- Modules -------<a name='11437'></font>
<font color=#447700>!      use parkind, only : im =&gt; kind , rb =&gt; kind <a name='11438'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INIT_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_6"><a name='11439'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_SETCOEF_F'>rrtmg_lw_setcoef_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INIT_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_SETCOEF_F_1">, only: lwatmref, lwavplank, lwavplankderiv<a name='11440'>
<a name='11441'>
      implicit none<a name='11442'>
<a name='11443'>
      contains<a name='11444'>
<a name='11445'>
<font color=#447700>! **************************************************************************<a name='11446'></font>
<A NAME='RRTMG_LW_INI'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11447'>
      <font color=#993300>subroutine </font><font color=#cc0000>rrtmg_lw_ini</font>(cpdair) <A href='../../call_to/RRTMG_LW_INI.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LW_INI.html' TARGET='index'>49</A><a name='11448'>
<font color=#447700>! **************************************************************************<a name='11449'></font>
<font color=#447700>!<a name='11450'></font>
<font color=#447700>!  Original version:       Michael J. Iacono; July, 1998<a name='11451'></font>
<font color=#447700>!  First revision for GCMs:   September, 1998<a name='11452'></font>
<font color=#447700>!  Second revision for RRTM_V3.0:  September, 2002<a name='11453'></font>
<font color=#447700>!<a name='11454'></font>
<font color=#447700>!  This subroutine performs calculations necessary for the initialization<a name='11455'></font>
<font color=#447700>!  of the longwave model.  Lookup tables are computed for use in the LW<a name='11456'></font>
<font color=#447700>!  radiative transfer, and input absorption coefficient data for each<a name='11457'></font>
<font color=#447700>!  spectral band are reduced from 256 g-point intervals to 140.<a name='11458'></font>
<font color=#447700>! **************************************************************************<a name='11459'></font>
<a name='11460'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_24">, only : mg, nbndlw, ngptlw<a name='11461'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_TBL_F'>rrlw_tbl_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_F_3">, only: ntbl, tblint, pade, bpade, tau_tbl, exp_tbl, tfn_tbl<a name='11462'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_5">, only: hvrini, hnamini<a name='11463'>
<a name='11464'>
      real , intent(in) :: cpdair     <font color=#447700>! Specific heat capacity of dry air<a name='11465'></font>
                                      <font color=#447700>! at constant pressure at 273 K<a name='11466'></font>
                                      <font color=#447700>! (J kg-1 K-1)<a name='11467'></font>
<a name='11468'>
<font color=#447700>! ------- Local -------<a name='11469'></font>
<a name='11470'>
      integer  :: itr, ibnd, igc, ig, ind, ipr <a name='11471'>
      integer  :: igcsm, iprsm<a name='11472'>
<a name='11473'>
      real  :: wtsum, wtsm(mg)        <font color=#447700>!<a name='11474'></font>
      real  :: tfn                    <font color=#447700>!<a name='11475'></font>
<a name='11476'>
      real , parameter :: expeps = 1.e-20    <font color=#447700>! Smallest value for exponential table<a name='11477'></font>
<a name='11478'>
<font color=#447700>! ------- Definitions -------<a name='11479'></font>
<font color=#447700>!     Arrays for 10000-point look-up tables:<a name='11480'></font>
<font color=#447700>!     TAU_TBL Clear-sky optical depth (used in cloudy radiative transfer)<a name='11481'></font>
<font color=#447700>!     EXP_TBL Exponential lookup table for ransmittance<a name='11482'></font>
<font color=#447700>!     TFN_TBL Tau transition function; i.e. the transition of the Planck<a name='11483'></font>
<font color=#447700>!             function from that for the mean layer temperature to that for<a name='11484'></font>
<font color=#447700>!             the layer boundary temperature as a function of optical depth.<a name='11485'></font>
<font color=#447700>!             The "linear in tau" method is used to make the table.<a name='11486'></font>
<font color=#447700>!     PADE    Pade approximation constant (= 0.278)<a name='11487'></font>
<font color=#447700>!     BPADE   Inverse of the Pade approximation constant<a name='11488'></font>
<font color=#447700>!<a name='11489'></font>
<a name='11490'>
      hvrini = '$Revision: 1.1.1.2 $'<a name='11491'>
<a name='11492'>
<font color=#447700>! Initialize model data<a name='11493'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT'>lwdatinit</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWDATINIT_2">(cpdair)<a name='11494'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCMBDAT'>lwcmbdat</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWCMBDAT_2">               <font color=#447700>! g-point interval reduction data<a name='11495'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCLDPR'>lwcldpr</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWCLDPR_2">                <font color=#447700>! cloud optical properties<a name='11496'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWATMREF'>lwatmref</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWATMREF_2">               <font color=#447700>! reference MLS profile<a name='11497'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWAVPLANK'>lwavplank</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWAVPLANK_2">              <font color=#447700>! Planck function <a name='11498'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWAVPLANKDERIV'>lwavplankderiv</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWAVPLANKDERIV_1">         <font color=#447700>! Planck function derivative wrt temp<a name='11499'></font>
<font color=#447700>! Moved to module_ra_rrtmg_lw for WRF<a name='11500'></font>
<font color=#447700>!      call lw_kgb01               ! molecular absorption coefficients<a name='11501'></font>
<font color=#447700>!      call lw_kgb02<a name='11502'></font>
<font color=#447700>!      call lw_kgb03<a name='11503'></font>
<font color=#447700>!      call lw_kgb04<a name='11504'></font>
<font color=#447700>!      call lw_kgb05<a name='11505'></font>
<font color=#447700>!      call lw_kgb06<a name='11506'></font>
<font color=#447700>!      call lw_kgb07<a name='11507'></font>
<font color=#447700>!      call lw_kgb08<a name='11508'></font>
<font color=#447700>!      call lw_kgb09<a name='11509'></font>
<font color=#447700>!      call lw_kgb10<a name='11510'></font>
<font color=#447700>!      call lw_kgb11<a name='11511'></font>
<font color=#447700>!      call lw_kgb12<a name='11512'></font>
<font color=#447700>!      call lw_kgb13<a name='11513'></font>
<font color=#447700>!      call lw_kgb14<a name='11514'></font>
<font color=#447700>!      call lw_kgb15<a name='11515'></font>
<font color=#447700>!      call lw_kgb16<a name='11516'></font>
<a name='11517'>
<font color=#447700>! Compute lookup tables for transmittance, tau transition function,<a name='11518'></font>
<font color=#447700>! and clear sky tau (for the cloudy sky radiative transfer).  Tau is <a name='11519'></font>
<font color=#447700>! computed as a function of the tau transition function, transmittance <a name='11520'></font>
<font color=#447700>! is calculated as a function of tau, and the tau transition function <a name='11521'></font>
<font color=#447700>! is calculated using the linear in tau formulation at values of tau <a name='11522'></font>
<font color=#447700>! above 0.01.  TF is approximated as tau/6 for tau &lt; 0.01.  All tables <a name='11523'></font>
<font color=#447700>! are computed at intervals of 0.001.  The inverse of the constant used<a name='11524'></font>
<font color=#447700>! in the Pade approximation to the tau transition function is set to b.<a name='11525'></font>
<a name='11526'>
      tau_tbl(0) = 0.0 <a name='11527'>
      tau_tbl(ntbl) = 1.e10 <a name='11528'>
      exp_tbl(0) = 1.0 <a name='11529'>
      exp_tbl(ntbl) = expeps<a name='11530'>
      tfn_tbl(0) = 0.0 <a name='11531'>
      tfn_tbl(ntbl) = 1.0 <a name='11532'>
      bpade = 1.0  / pade<a name='11533'>
      do itr = 1, ntbl-1<a name='11534'>
         tfn = float(itr) / float(ntbl)<a name='11535'>
         tau_tbl(itr) = bpade * tfn / (1.  - tfn)<a name='11536'>
         exp_tbl(itr) = exp(-tau_tbl(itr))<a name='11537'>
         if (exp_tbl(itr) .le. expeps) exp_tbl(itr) = expeps<a name='11538'>
         if (tau_tbl(itr) .lt. 0.06 ) then<a name='11539'>
            tfn_tbl(itr) = tau_tbl(itr)/6. <a name='11540'>
         else<a name='11541'>
            tfn_tbl(itr) = 1. -2. *((1. /tau_tbl(itr))-(exp_tbl(itr)/(1.-exp_tbl(itr))))<a name='11542'>
         endif<a name='11543'>
      enddo<a name='11544'>
<a name='11545'>
<font color=#447700>! Perform g-point reduction from 16 per band (256 total points) to<a name='11546'></font>
<font color=#447700>! a band dependant number (140 total points) for all absorption<a name='11547'></font>
<font color=#447700>! coefficient input data and Planck fraction input data.<a name='11548'></font>
<font color=#447700>! Compute relative weighting for new g-point combinations.<a name='11549'></font>
<a name='11550'>
      igcsm = 0<a name='11551'>
      do ibnd = 1,nbndlw<a name='11552'>
         iprsm = 0<a name='11553'>
         if (ngc(ibnd).lt.mg) then<a name='11554'>
            do igc = 1,ngc(ibnd) <a name='11555'>
               igcsm = igcsm + 1<a name='11556'>
               wtsum = 0. <a name='11557'>
               do ipr = 1, ngn(igcsm)<a name='11558'>
                  iprsm = iprsm + 1<a name='11559'>
                  wtsum = wtsum + wt(iprsm)<a name='11560'>
               enddo<a name='11561'>
               wtsm(igc) = wtsum<a name='11562'>
            enddo<a name='11563'>
            do ig = 1, ng(ibnd)<a name='11564'>
               ind = (ibnd-1)*mg + ig<a name='11565'>
               rwgt(ind) = wt(ig)/wtsm(ngm(ind))<a name='11566'>
            enddo<a name='11567'>
         else<a name='11568'>
            do ig = 1, ng(ibnd)<a name='11569'>
               igcsm = igcsm + 1<a name='11570'>
               ind = (ibnd-1)*mg + ig<a name='11571'>
               rwgt(ind) = 1.0 <a name='11572'>
            enddo<a name='11573'>
         endif<a name='11574'>
      enddo<a name='11575'>
<a name='11576'>
<font color=#447700>! Reduce g-points for absorption coefficient data in each LW spectral band.<a name='11577'></font>
<a name='11578'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1'>cmbgb1</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB1_3"><a name='11579'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2'>cmbgb2</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB2_3"><a name='11580'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3'>cmbgb3</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB3_3"><a name='11581'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4'>cmbgb4</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB4_3"><a name='11582'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5'>cmbgb5</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB5_3"><a name='11583'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6'>cmbgb6</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB6_3"><a name='11584'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7'>cmbgb7</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB7_3"><a name='11585'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8'>cmbgb8</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB8_3"><a name='11586'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9'>cmbgb9</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB9_3"><a name='11587'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10'>cmbgb10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB10_3"><a name='11588'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11'>cmbgb11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB11_3"><a name='11589'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12'>cmbgb12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB12_3"><a name='11590'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13'>cmbgb13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB13_3"><a name='11591'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14'>cmbgb14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB14_3"><a name='11592'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15'>cmbgb15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB15_3"><a name='11593'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16'>cmbgb16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB16_3"><a name='11594'>
<a name='11595'>
      end subroutine rrtmg_lw_ini<a name='11596'>
<a name='11597'>
<font color=#447700>!***************************************************************************<a name='11598'></font>
<A NAME='LWDATINIT'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11599'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwdatinit</font>(cpdair) <A href='../../call_to/LWDATINIT.html' TARGET='index'>2</A>,<A href='../../call_from/LWDATINIT.html' TARGET='index'>6</A><a name='11600'>
<font color=#447700>!***************************************************************************<a name='11601'></font>
<a name='11602'>
<font color=#447700>! --------- Modules ----------<a name='11603'></font>
<a name='11604'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_25">, only : maxxsec, maxinpx<a name='11605'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_4">, only: heatfac, grav, planck, boltz, &amp;<a name='11606'>
                          clight, avogad, alosmt, gascon, radcn1, radcn2, &amp;<a name='11607'>
                          sbcnst, secdy <a name='11608'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_6"><a name='11609'>
<a name='11610'>
      save <a name='11611'>
 <a name='11612'>
      real , intent(in) :: cpdair      <font color=#447700>! Specific heat capacity of dry air<a name='11613'></font>
                                       <font color=#447700>! at constant pressure at 273 K<a name='11614'></font>
                                       <font color=#447700>! (J kg-1 K-1)<a name='11615'></font>
<a name='11616'>
<font color=#447700>! Longwave spectral band limits (wavenumbers)<a name='11617'></font>
      wavenum1(:) = (/ 10. , 350. , 500. , 630. , 700. , 820. , &amp;<a name='11618'>
                      980. ,1080. ,1180. ,1390. ,1480. ,1800. , &amp;<a name='11619'>
                     2080. ,2250. ,2380. ,2600. /)<a name='11620'>
      wavenum2(:) = (/350. , 500. , 630. , 700. , 820. , 980. , &amp;<a name='11621'>
                     1080. ,1180. ,1390. ,1480. ,1800. ,2080. , &amp;<a name='11622'>
                     2250. ,2380. ,2600. ,3250. /)<a name='11623'>
      delwave(:) =  (/340. , 150. , 130. ,  70. , 120. , 160. , &amp;<a name='11624'>
                      100. , 100. , 210. ,  90. , 320. , 280. , &amp;<a name='11625'>
                      170. , 130. , 220. , 650. /)<a name='11626'>
<a name='11627'>
<font color=#447700>! Spectral band information<a name='11628'></font>
      ng(:) = (/16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16/)<a name='11629'>
      nspa(:) = (/1,1,9,9,9,1,9,1,9,1,1,9,9,1,9,9/)<a name='11630'>
      nspb(:) = (/1,1,5,5,5,0,1,1,1,1,1,0,0,1,0,0/)<a name='11631'>
<a name='11632'>
<font color=#447700>!     nxmol     - number of cross-sections input by user<a name='11633'></font>
<font color=#447700>!     ixindx(i) - index of cross-section molecule corresponding to Ith<a name='11634'></font>
<font color=#447700>!                 cross-section specified by user<a name='11635'></font>
<font color=#447700>!                 = 0 -- not allowed in rrtm<a name='11636'></font>
<font color=#447700>!                 = 1 -- ccl4<a name='11637'></font>
<font color=#447700>!                 = 2 -- cfc11<a name='11638'></font>
<font color=#447700>!                 = 3 -- cfc12<a name='11639'></font>
<font color=#447700>!                 = 4 -- cfc22<a name='11640'></font>
      nxmol = 4<a name='11641'>
      ixindx(1) = 1<a name='11642'>
      ixindx(2) = 2<a name='11643'>
      ixindx(3) = 3<a name='11644'>
      ixindx(4) = 4<a name='11645'>
      ixindx(5:maxinpx) = 0<a name='11646'>
<a name='11647'>
<font color=#447700>! Fundamental physical constants from NIST 2002<a name='11648'></font>
<a name='11649'>
      grav = 9.8066                         <font color=#447700>! Acceleration of gravity<a name='11650'></font>
                                              <font color=#447700>! (m s-2)<a name='11651'></font>
      planck = 6.62606876e-27               <font color=#447700>! Planck constant<a name='11652'></font>
                                              <font color=#447700>! (ergs s; g cm2 s-1)<a name='11653'></font>
      boltz = 1.3806503e-16                 <font color=#447700>! Boltzmann constant<a name='11654'></font>
                                              <font color=#447700>! (ergs K-1; g cm2 s-2 K-1)<a name='11655'></font>
      clight = 2.99792458e+10               <font color=#447700>! Speed of light in a vacuum  <a name='11656'></font>
                                              <font color=#447700>! (cm s-1)<a name='11657'></font>
      avogad = 6.02214199e+23               <font color=#447700>! Avogadro constant<a name='11658'></font>
                                              <font color=#447700>! (mol-1)<a name='11659'></font>
      alosmt = 2.6867775e+19                <font color=#447700>! Loschmidt constant<a name='11660'></font>
                                              <font color=#447700>! (cm-3)<a name='11661'></font>
      gascon = 8.31447200e+07               <font color=#447700>! Molar gas constant<a name='11662'></font>
                                              <font color=#447700>! (ergs mol-1 K-1)<a name='11663'></font>
      radcn1 = 1.191042722e-12              <font color=#447700>! First radiation constant<a name='11664'></font>
                                              <font color=#447700>! (W cm2 sr-1)<a name='11665'></font>
      radcn2 = 1.4387752                    <font color=#447700>! Second radiation constant<a name='11666'></font>
                                              <font color=#447700>! (cm K)<a name='11667'></font>
      sbcnst = 5.670400e-04                 <font color=#447700>! Stefan-Boltzmann constant<a name='11668'></font>
                                              <font color=#447700>! (W cm-2 K-4)<a name='11669'></font>
      secdy = 8.6400e4                      <font color=#447700>! Number of seconds per day<a name='11670'></font>
                                              <font color=#447700>! (s d-1)<a name='11671'></font>
<font color=#447700>!<a name='11672'></font>
<font color=#447700>!     units are generally cgs<a name='11673'></font>
<font color=#447700>!<a name='11674'></font>
<font color=#447700>!     The first and second radiation constants are taken from NIST.<a name='11675'></font>
<font color=#447700>!     They were previously obtained from the relations:<a name='11676'></font>
<font color=#447700>!          radcn1 = 2.*planck*clight*clight*1.e-07<a name='11677'></font>
<font color=#447700>!          radcn2 = planck*clight/boltz<a name='11678'></font>
<a name='11679'>
<font color=#447700>!     Heatfac is the factor by which delta-flux / delta-pressure is<a name='11680'></font>
<font color=#447700>!     multiplied, with flux in W/m-2 and pressure in mbar, to get <a name='11681'></font>
<font color=#447700>!     the heating rate in units of degrees/day.  It is equal to:<a name='11682'></font>
<font color=#447700>!     Original value:<a name='11683'></font>
<font color=#447700>!           (g)x(#sec/day)x(1e-5)/(specific heat of air at const. p)<a name='11684'></font>
<font color=#447700>!           Here, cpdair (1.004) is in units of J g-1 K-1, and the <a name='11685'></font>
<font color=#447700>!           constant (1.e-5) converts mb to Pa and g-1 to kg-1.<a name='11686'></font>
<font color=#447700>!        =  (9.8066)(86400)(1e-5)/(1.004)<a name='11687'></font>
<font color=#447700>!      heatfac = 8.4391 <a name='11688'></font>
<font color=#447700>!<a name='11689'></font>
<font color=#447700>!     Modified value for consistency with CAM3:<a name='11690'></font>
<font color=#447700>!           (g)x(#sec/day)x(1e-5)/(specific heat of air at const. p)<a name='11691'></font>
<font color=#447700>!           Here, cpdair (1.00464) is in units of J g-1 K-1, and the<a name='11692'></font>
<font color=#447700>!           constant (1.e-5) converts mb to Pa and g-1 to kg-1.<a name='11693'></font>
<font color=#447700>!        =  (9.80616)(86400)(1e-5)/(1.00464)<a name='11694'></font>
<font color=#447700>!      heatfac = 8.43339130434 <a name='11695'></font>
<font color=#447700>!<a name='11696'></font>
<font color=#447700>!     Calculated value:<a name='11697'></font>
<font color=#447700>!        (grav) x (#sec/day) / (specific heat of dry air at const. p x 1.e2)<a name='11698'></font>
<font color=#447700>!           Here, cpdair is in units of J kg-1 K-1, and the constant (1.e2) <a name='11699'></font>
<font color=#447700>!           converts mb to Pa when heatfac is multiplied by W m-2 mb-1. <a name='11700'></font>
      heatfac = grav * secdy / (cpdair * 1.e2 )<a name='11701'>
<a name='11702'>
      end subroutine lwdatinit<a name='11703'>
<a name='11704'>
<font color=#447700>!***************************************************************************<a name='11705'></font>
<A NAME='LWCMBDAT'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCMBDAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11706'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwcmbdat</font> <A href='../../call_to/LWCMBDAT.html' TARGET='index'>2</A><a name='11707'>
<font color=#447700>!***************************************************************************<a name='11708'></font>
<a name='11709'>
      save<a name='11710'>
 <a name='11711'>
<font color=#447700>! ------- Definitions -------<a name='11712'></font>
<font color=#447700>!     Arrays for the g-point reduction from 256 to 140 for the 16 LW bands:<a name='11713'></font>
<font color=#447700>!     This mapping from 256 to 140 points has been carefully selected to <a name='11714'></font>
<font color=#447700>!     minimize the effect on the resulting fluxes and cooling rates, and<a name='11715'></font>
<font color=#447700>!     caution should be used if the mapping is modified.  The full 256<a name='11716'></font>
<font color=#447700>!     g-point set can be restored with ngptlw=256, ngc=16*16, ngn=256*1., etc.<a name='11717'></font>
<font color=#447700>!     ngptlw  The total number of new g-points<a name='11718'></font>
<font color=#447700>!     ngc     The number of new g-points in each band<a name='11719'></font>
<font color=#447700>!     ngs     The cumulative sum of new g-points for each band<a name='11720'></font>
<font color=#447700>!     ngm     The index of each new g-point relative to the original<a name='11721'></font>
<font color=#447700>!             16 g-points for each band.  <a name='11722'></font>
<font color=#447700>!     ngn     The number of original g-points that are combined to make<a name='11723'></font>
<font color=#447700>!             each new g-point in each band.<a name='11724'></font>
<font color=#447700>!     ngb     The band index for each new g-point.<a name='11725'></font>
<font color=#447700>!     wt      RRTM weights for 16 g-points.<a name='11726'></font>
<a name='11727'>
<font color=#447700>! ------- Data statements -------<a name='11728'></font>
      ngc(:) = (/10,12,16,14,16,8,12,8,12,6,8,8,4,2,2,2/)<a name='11729'>
      ngs(:) = (/10,22,38,52,68,76,88,96,108,114,122,130,134,136,138,140/)<a name='11730'>
      ngm(:) = (/1,2,3,3,4,4,5,5,6,6,7,7,8,8,9,10, &amp;          <font color=#447700>! band 1<a name='11731'></font>
                 1,2,3,4,5,6,7,8,9,9,10,10,11,11,12,12, &amp;     <font color=#447700>! band 2<a name='11732'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &amp;    <font color=#447700>! band 3<a name='11733'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,14,14, &amp;    <font color=#447700>! band 4<a name='11734'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &amp;    <font color=#447700>! band 5<a name='11735'></font>
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &amp;           <font color=#447700>! band 6<a name='11736'></font>
                 1,1,2,2,3,4,5,6,7,8,9,10,11,11,12,12, &amp;      <font color=#447700>! band 7<a name='11737'></font>
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &amp;           <font color=#447700>! band 8<a name='11738'></font>
                 1,2,3,4,5,6,7,8,9,9,10,10,11,11,12,12, &amp;     <font color=#447700>! band 9<a name='11739'></font>
                 1,1,2,2,3,3,4,4,5,5,5,5,6,6,6,6, &amp;           <font color=#447700>! band 10<a name='11740'></font>
                 1,2,3,3,4,4,5,5,6,6,7,7,7,8,8,8, &amp;           <font color=#447700>! band 11<a name='11741'></font>
                 1,2,3,4,5,5,6,6,7,7,7,7,8,8,8,8, &amp;           <font color=#447700>! band 12<a name='11742'></font>
                 1,1,1,2,2,2,3,3,3,3,4,4,4,4,4,4, &amp;           <font color=#447700>! band 13<a name='11743'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &amp;           <font color=#447700>! band 14<a name='11744'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &amp;           <font color=#447700>! band 15<a name='11745'></font>
                 1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2/)            <font color=#447700>! band 16<a name='11746'></font>
      ngn(:) = (/1,1,2,2,2,2,2,2,1,1, &amp;                       <font color=#447700>! band 1<a name='11747'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2, &amp;                   <font color=#447700>! band 2<a name='11748'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, &amp;           <font color=#447700>! band 3<a name='11749'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,3, &amp;               <font color=#447700>! band 4<a name='11750'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, &amp;           <font color=#447700>! band 5<a name='11751'></font>
                 2,2,2,2,2,2,2,2, &amp;                           <font color=#447700>! band 6<a name='11752'></font>
                 2,2,1,1,1,1,1,1,1,1,2,2, &amp;                   <font color=#447700>! band 7<a name='11753'></font>
                 2,2,2,2,2,2,2,2, &amp;                           <font color=#447700>! band 8<a name='11754'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2, &amp;                   <font color=#447700>! band 9<a name='11755'></font>
                 2,2,2,2,4,4, &amp;                               <font color=#447700>! band 10<a name='11756'></font>
                 1,1,2,2,2,2,3,3, &amp;                           <font color=#447700>! band 11<a name='11757'></font>
                 1,1,1,1,2,2,4,4, &amp;                           <font color=#447700>! band 12<a name='11758'></font>
                 3,3,4,6, &amp;                                   <font color=#447700>! band 13<a name='11759'></font>
                 8,8, &amp;                                       <font color=#447700>! band 14<a name='11760'></font>
                 8,8, &amp;                                       <font color=#447700>! band 15<a name='11761'></font>
                 4,12/)                                       <font color=#447700>! band 16<a name='11762'></font>
      ngb(:) = (/1,1,1,1,1,1,1,1,1,1, &amp;                       <font color=#447700>! band 1<a name='11763'></font>
                 2,2,2,2,2,2,2,2,2,2,2,2, &amp;                   <font color=#447700>! band 2<a name='11764'></font>
                 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3, &amp;           <font color=#447700>! band 3<a name='11765'></font>
                 4,4,4,4,4,4,4,4,4,4,4,4,4,4, &amp;               <font color=#447700>! band 4<a name='11766'></font>
                 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5, &amp;           <font color=#447700>! band 5<a name='11767'></font>
                 6,6,6,6,6,6,6,6, &amp;                           <font color=#447700>! band 6<a name='11768'></font>
                 7,7,7,7,7,7,7,7,7,7,7,7, &amp;                   <font color=#447700>! band 7<a name='11769'></font>
                 8,8,8,8,8,8,8,8, &amp;                           <font color=#447700>! band 8<a name='11770'></font>
                 9,9,9,9,9,9,9,9,9,9,9,9, &amp;                   <font color=#447700>! band 9<a name='11771'></font>
                 10,10,10,10,10,10, &amp;                         <font color=#447700>! band 10<a name='11772'></font>
                 11,11,11,11,11,11,11,11, &amp;                   <font color=#447700>! band 11<a name='11773'></font>
                 12,12,12,12,12,12,12,12, &amp;                   <font color=#447700>! band 12<a name='11774'></font>
                 13,13,13,13, &amp;                               <font color=#447700>! band 13<a name='11775'></font>
                 14,14, &amp;                                     <font color=#447700>! band 14<a name='11776'></font>
                 15,15, &amp;                                     <font color=#447700>! band 15<a name='11777'></font>
                 16,16/)                                      <font color=#447700>! band 16<a name='11778'></font>
      wt(:) = (/ 0.1527534276 , 0.1491729617 , 0.1420961469 , &amp;<a name='11779'>
                 0.1316886544 , 0.1181945205 , 0.1019300893 , &amp;<a name='11780'>
                 0.0832767040 , 0.0626720116 , 0.0424925000 , &amp;<a name='11781'>
                 0.0046269894 , 0.0038279891 , 0.0030260086 , &amp;<a name='11782'>
                 0.0022199750 , 0.0014140010 , 0.0005330000 , &amp;<a name='11783'>
                 0.0000750000 /)<a name='11784'>
<a name='11785'>
      end subroutine lwcmbdat<a name='11786'>
<a name='11787'>
<font color=#447700>!***************************************************************************<a name='11788'></font>
<A NAME='CMBGB1'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11789'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb1</font> <A href='../../call_to/CMBGB1.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB1.html' TARGET='index'>4</A><a name='11790'>
<font color=#447700>!***************************************************************************<a name='11791'></font>
<font color=#447700>!<a name='11792'></font>
<font color=#447700>!  Original version:    MJIacono; July 1998<a name='11793'></font>
<font color=#447700>!  Revision for GCMs:   MJIacono; September 1998<a name='11794'></font>
<font color=#447700>!  Revision for RRTMG:  MJIacono, September 2002<a name='11795'></font>
<font color=#447700>!  Revision for F90 reformatting:  MJIacono, June 2006<a name='11796'></font>
<font color=#447700>!<a name='11797'></font>
<font color=#447700>!  The subroutines CMBGB1-&gt;CMBGB16 input the absorption coefficient<a name='11798'></font>
<font color=#447700>!  data for each band, which are defined for 16 g-points and 16 spectral<a name='11799'></font>
<font color=#447700>!  bands. The data are combined with appropriate weighting following the<a name='11800'></font>
<font color=#447700>!  g-point mapping arrays specified in RRTMINIT.  Plank fraction data<a name='11801'></font>
<font color=#447700>!  in arrays FRACREFA and FRACREFB are combined without weighting.  All<a name='11802'></font>
<font color=#447700>!  g-point reduced data are put into new arrays for use in RRTM.<a name='11803'></font>
<font color=#447700>!<a name='11804'></font>
<font color=#447700>!  band 1:  10-350 cm-1 (low key - h2o; low minor - n2)<a name='11805'></font>
<font color=#447700>!                       (high key - h2o; high minor - n2)<a name='11806'></font>
<font color=#447700>!  note: previous versions of rrtm band 1: <a name='11807'></font>
<font color=#447700>!        10-250 cm-1 (low - h2o; high - h2o)<a name='11808'></font>
<font color=#447700>!***************************************************************************<a name='11809'></font>
<a name='11810'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_26">, only : mg, nbndlw, ngptlw, ng1<a name='11811'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F'>rrlw_kg01_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_F_3">, only: fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, &amp;<a name='11812'>
                           selfrefo, forrefo, &amp;<a name='11813'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mn2, kb_mn2, &amp;<a name='11814'>
                           selfref, forref<a name='11815'>
<a name='11816'>
<font color=#447700>! ------- Local -------<a name='11817'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='11818'>
      real  :: sumk, sumk1, sumk2, sumf1, sumf2<a name='11819'>
<a name='11820'>
<a name='11821'>
      do jt = 1,5<a name='11822'>
         do jp = 1,13<a name='11823'>
            iprsm = 0<a name='11824'>
            do igc = 1,ngc(1)<a name='11825'>
               sumk = 0.<a name='11826'>
               do ipr = 1, ngn(igc)<a name='11827'>
                  iprsm = iprsm + 1<a name='11828'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm)<a name='11829'>
               enddo<a name='11830'>
               ka(jt,jp,igc) = sumk<a name='11831'>
            enddo<a name='11832'>
         enddo<a name='11833'>
         do jp = 13,59<a name='11834'>
            iprsm = 0<a name='11835'>
            do igc = 1,ngc(1)<a name='11836'>
               sumk = 0.<a name='11837'>
               do ipr = 1, ngn(igc)<a name='11838'>
                  iprsm = iprsm + 1<a name='11839'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm)<a name='11840'>
               enddo<a name='11841'>
               kb(jt,jp,igc) = sumk<a name='11842'>
            enddo<a name='11843'>
         enddo<a name='11844'>
      enddo<a name='11845'>
<a name='11846'>
      do jt = 1,10<a name='11847'>
         iprsm = 0<a name='11848'>
         do igc = 1,ngc(1)<a name='11849'>
            sumk = 0.<a name='11850'>
            do ipr = 1, ngn(igc)<a name='11851'>
               iprsm = iprsm + 1<a name='11852'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm)<a name='11853'>
            enddo<a name='11854'>
            selfref(jt,igc) = sumk<a name='11855'>
         enddo<a name='11856'>
      enddo<a name='11857'>
<a name='11858'>
      do jt = 1,4<a name='11859'>
         iprsm = 0<a name='11860'>
         do igc = 1,ngc(1)<a name='11861'>
            sumk = 0.<a name='11862'>
            do ipr = 1, ngn(igc)<a name='11863'>
               iprsm = iprsm + 1<a name='11864'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm)<a name='11865'>
            enddo<a name='11866'>
            forref(jt,igc) = sumk<a name='11867'>
         enddo<a name='11868'>
      enddo<a name='11869'>
<a name='11870'>
      do jt = 1,19<a name='11871'>
         iprsm = 0<a name='11872'>
         do igc = 1,ngc(1)<a name='11873'>
            sumk1 = 0.<a name='11874'>
            sumk2 = 0.<a name='11875'>
            do ipr = 1, ngn(igc)<a name='11876'>
               iprsm = iprsm + 1<a name='11877'>
               sumk1 = sumk1 + kao_mn2(jt,iprsm)*rwgt(iprsm)<a name='11878'>
               sumk2 = sumk2 + kbo_mn2(jt,iprsm)*rwgt(iprsm)<a name='11879'>
            enddo<a name='11880'>
            ka_mn2(jt,igc) = sumk1<a name='11881'>
            kb_mn2(jt,igc) = sumk2<a name='11882'>
         enddo<a name='11883'>
      enddo<a name='11884'>
<a name='11885'>
      iprsm = 0<a name='11886'>
      do igc = 1,ngc(1)<a name='11887'>
         sumf1 = 0.<a name='11888'>
         sumf2 = 0.<a name='11889'>
         do ipr = 1, ngn(igc)<a name='11890'>
            iprsm = iprsm + 1<a name='11891'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='11892'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='11893'>
         enddo<a name='11894'>
         fracrefa(igc) = sumf1<a name='11895'>
         fracrefb(igc) = sumf2<a name='11896'>
      enddo<a name='11897'>
<a name='11898'>
      end subroutine cmbgb1<a name='11899'>
<a name='11900'>
<font color=#447700>!***************************************************************************<a name='11901'></font>
<A NAME='CMBGB2'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11902'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb2</font> <A href='../../call_to/CMBGB2.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB2.html' TARGET='index'>4</A><a name='11903'>
<font color=#447700>!***************************************************************************<a name='11904'></font>
<font color=#447700>!<a name='11905'></font>
<font color=#447700>!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)<a name='11906'></font>
<font color=#447700>!<a name='11907'></font>
<font color=#447700>!     note: previous version of rrtm band 2: <a name='11908'></font>
<font color=#447700>!           250 - 500 cm-1 (low - h2o; high - h2o)<a name='11909'></font>
<font color=#447700>!***************************************************************************<a name='11910'></font>
<a name='11911'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_27">, only : mg, nbndlw, ngptlw, ng2<a name='11912'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F'>rrlw_kg02_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_F_3">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='11913'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='11914'>
<a name='11915'>
<font color=#447700>! ------- Local -------<a name='11916'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='11917'>
      real  :: sumk, sumf1, sumf2<a name='11918'>
<a name='11919'>
<a name='11920'>
      do jt = 1,5<a name='11921'>
         do jp = 1,13<a name='11922'>
            iprsm = 0<a name='11923'>
            do igc = 1,ngc(2)<a name='11924'>
               sumk = 0.<a name='11925'>
               do ipr = 1, ngn(ngs(1)+igc)<a name='11926'>
                  iprsm = iprsm + 1<a name='11927'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+16)<a name='11928'>
               enddo<a name='11929'>
               ka(jt,jp,igc) = sumk<a name='11930'>
            enddo<a name='11931'>
         enddo<a name='11932'>
         do jp = 13,59<a name='11933'>
            iprsm = 0<a name='11934'>
            do igc = 1,ngc(2)<a name='11935'>
               sumk = 0.<a name='11936'>
               do ipr = 1, ngn(ngs(1)+igc)<a name='11937'>
                  iprsm = iprsm + 1<a name='11938'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+16)<a name='11939'>
               enddo<a name='11940'>
               kb(jt,jp,igc) = sumk<a name='11941'>
            enddo<a name='11942'>
         enddo<a name='11943'>
      enddo<a name='11944'>
<a name='11945'>
      do jt = 1,10<a name='11946'>
         iprsm = 0<a name='11947'>
         do igc = 1,ngc(2)<a name='11948'>
            sumk = 0.<a name='11949'>
            do ipr = 1, ngn(ngs(1)+igc)<a name='11950'>
               iprsm = iprsm + 1<a name='11951'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+16)<a name='11952'>
            enddo<a name='11953'>
            selfref(jt,igc) = sumk<a name='11954'>
         enddo<a name='11955'>
      enddo<a name='11956'>
<a name='11957'>
      do jt = 1,4<a name='11958'>
         iprsm = 0<a name='11959'>
         do igc = 1,ngc(2)<a name='11960'>
            sumk = 0.<a name='11961'>
            do ipr = 1, ngn(ngs(1)+igc)<a name='11962'>
               iprsm = iprsm + 1<a name='11963'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+16)<a name='11964'>
            enddo<a name='11965'>
            forref(jt,igc) = sumk<a name='11966'>
         enddo<a name='11967'>
      enddo<a name='11968'>
<a name='11969'>
      iprsm = 0<a name='11970'>
      do igc = 1,ngc(2)<a name='11971'>
         sumf1 = 0.<a name='11972'>
         sumf2 = 0.<a name='11973'>
         do ipr = 1, ngn(ngs(1)+igc)<a name='11974'>
            iprsm = iprsm + 1<a name='11975'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='11976'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='11977'>
         enddo<a name='11978'>
         fracrefa(igc) = sumf1<a name='11979'>
         fracrefb(igc) = sumf2<a name='11980'>
      enddo<a name='11981'>
<a name='11982'>
      end subroutine cmbgb2<a name='11983'>
<a name='11984'>
<font color=#447700>!***************************************************************************<a name='11985'></font>
<A NAME='CMBGB3'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11986'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb3</font> <A href='../../call_to/CMBGB3.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB3.html' TARGET='index'>4</A><a name='11987'>
<font color=#447700>!***************************************************************************<a name='11988'></font>
<font color=#447700>!<a name='11989'></font>
<font color=#447700>!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)<a name='11990'></font>
<font color=#447700>!                           (high key - h2o,co2; high minor - n2o)<a name='11991'></font>
<font color=#447700>!<a name='11992'></font>
<font color=#447700>! old band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='11993'></font>
<font color=#447700>!***************************************************************************<a name='11994'></font>
<a name='11995'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_28">, only : mg, nbndlw, ngptlw, ng3<a name='11996'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F'>rrlw_kg03_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_F_3">, only: fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, &amp;<a name='11997'>
                           selfrefo, forrefo, &amp;<a name='11998'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mn2o, kb_mn2o, &amp;<a name='11999'>
                           selfref, forref<a name='12000'>
<a name='12001'>
<font color=#447700>! ------- Local -------<a name='12002'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='12003'>
      real  :: sumk, sumf<a name='12004'>
<a name='12005'>
<a name='12006'>
      do jn = 1,9<a name='12007'>
         do jt = 1,5<a name='12008'>
            do jp = 1,13<a name='12009'>
               iprsm = 0<a name='12010'>
               do igc = 1,ngc(3)<a name='12011'>
                 sumk = 0.<a name='12012'>
                  do ipr = 1, ngn(ngs(2)+igc)<a name='12013'>
                     iprsm = iprsm + 1<a name='12014'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+32)<a name='12015'>
                  enddo<a name='12016'>
                  ka(jn,jt,jp,igc) = sumk<a name='12017'>
               enddo<a name='12018'>
            enddo<a name='12019'>
         enddo<a name='12020'>
      enddo<a name='12021'>
      do jn = 1,5<a name='12022'>
         do jt = 1,5<a name='12023'>
            do jp = 13,59<a name='12024'>
               iprsm = 0<a name='12025'>
               do igc = 1,ngc(3)<a name='12026'>
                  sumk = 0.<a name='12027'>
                  do ipr = 1, ngn(ngs(2)+igc)<a name='12028'>
                     iprsm = iprsm + 1<a name='12029'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+32)<a name='12030'>
                  enddo<a name='12031'>
                  kb(jn,jt,jp,igc) = sumk<a name='12032'>
               enddo<a name='12033'>
            enddo<a name='12034'>
         enddo<a name='12035'>
      enddo<a name='12036'>
<a name='12037'>
      do jn = 1,9<a name='12038'>
         do jt = 1,19<a name='12039'>
            iprsm = 0<a name='12040'>
            do igc = 1,ngc(3)<a name='12041'>
              sumk = 0.<a name='12042'>
               do ipr = 1, ngn(ngs(2)+igc)<a name='12043'>
                  iprsm = iprsm + 1<a name='12044'>
                  sumk = sumk + kao_mn2o(jn,jt,iprsm)*rwgt(iprsm+32)<a name='12045'>
               enddo<a name='12046'>
               ka_mn2o(jn,jt,igc) = sumk<a name='12047'>
            enddo<a name='12048'>
         enddo<a name='12049'>
      enddo<a name='12050'>
<a name='12051'>
      do jn = 1,5<a name='12052'>
         do jt = 1,19<a name='12053'>
            iprsm = 0<a name='12054'>
            do igc = 1,ngc(3)<a name='12055'>
              sumk = 0.<a name='12056'>
               do ipr = 1, ngn(ngs(2)+igc)<a name='12057'>
                  iprsm = iprsm + 1<a name='12058'>
                  sumk = sumk + kbo_mn2o(jn,jt,iprsm)*rwgt(iprsm+32)<a name='12059'>
               enddo<a name='12060'>
               kb_mn2o(jn,jt,igc) = sumk<a name='12061'>
            enddo<a name='12062'>
         enddo<a name='12063'>
      enddo<a name='12064'>
<a name='12065'>
      do jt = 1,10<a name='12066'>
         iprsm = 0<a name='12067'>
         do igc = 1,ngc(3)<a name='12068'>
            sumk = 0.<a name='12069'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='12070'>
               iprsm = iprsm + 1<a name='12071'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+32)<a name='12072'>
            enddo<a name='12073'>
            selfref(jt,igc) = sumk<a name='12074'>
         enddo<a name='12075'>
      enddo<a name='12076'>
<a name='12077'>
      do jt = 1,4<a name='12078'>
         iprsm = 0<a name='12079'>
         do igc = 1,ngc(3)<a name='12080'>
            sumk = 0.<a name='12081'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='12082'>
               iprsm = iprsm + 1<a name='12083'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+32)<a name='12084'>
            enddo<a name='12085'>
            forref(jt,igc) = sumk<a name='12086'>
         enddo<a name='12087'>
      enddo<a name='12088'>
<a name='12089'>
      do jp = 1,9<a name='12090'>
         iprsm = 0<a name='12091'>
         do igc = 1,ngc(3)<a name='12092'>
            sumf = 0.<a name='12093'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='12094'>
               iprsm = iprsm + 1<a name='12095'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='12096'>
            enddo<a name='12097'>
            fracrefa(igc,jp) = sumf<a name='12098'>
         enddo<a name='12099'>
      enddo<a name='12100'>
<a name='12101'>
      do jp = 1,5<a name='12102'>
         iprsm = 0<a name='12103'>
         do igc = 1,ngc(3)<a name='12104'>
            sumf = 0.<a name='12105'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='12106'>
               iprsm = iprsm + 1<a name='12107'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='12108'>
            enddo<a name='12109'>
            fracrefb(igc,jp) = sumf<a name='12110'>
         enddo<a name='12111'>
      enddo<a name='12112'>
<a name='12113'>
      end subroutine cmbgb3<a name='12114'>
<a name='12115'>
<font color=#447700>!***************************************************************************<a name='12116'></font>
<A NAME='CMBGB4'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12117'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb4</font> <A href='../../call_to/CMBGB4.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB4.html' TARGET='index'>4</A><a name='12118'>
<font color=#447700>!***************************************************************************<a name='12119'></font>
<font color=#447700>!<a name='12120'></font>
<font color=#447700>!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)<a name='12121'></font>
<font color=#447700>!<a name='12122'></font>
<font color=#447700>! old band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='12123'></font>
<font color=#447700>!***************************************************************************<a name='12124'></font>
<a name='12125'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_29">, only : mg, nbndlw, ngptlw, ng4<a name='12126'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F'>rrlw_kg04_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_F_3">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='12127'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='12128'>
<a name='12129'>
<font color=#447700>! ------- Local -------<a name='12130'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='12131'>
      real  :: sumk, sumf<a name='12132'>
<a name='12133'>
<a name='12134'>
      do jn = 1,9<a name='12135'>
         do jt = 1,5<a name='12136'>
            do jp = 1,13<a name='12137'>
               iprsm = 0<a name='12138'>
               do igc = 1,ngc(4)<a name='12139'>
                 sumk = 0.<a name='12140'>
                  do ipr = 1, ngn(ngs(3)+igc)<a name='12141'>
                     iprsm = iprsm + 1<a name='12142'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+48)<a name='12143'>
                  enddo<a name='12144'>
                  ka(jn,jt,jp,igc) = sumk<a name='12145'>
               enddo<a name='12146'>
            enddo<a name='12147'>
         enddo<a name='12148'>
      enddo<a name='12149'>
      do jn = 1,5<a name='12150'>
         do jt = 1,5<a name='12151'>
            do jp = 13,59<a name='12152'>
               iprsm = 0<a name='12153'>
               do igc = 1,ngc(4)<a name='12154'>
                  sumk = 0.<a name='12155'>
                  do ipr = 1, ngn(ngs(3)+igc)<a name='12156'>
                     iprsm = iprsm + 1<a name='12157'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+48)<a name='12158'>
                  enddo<a name='12159'>
                  kb(jn,jt,jp,igc) = sumk<a name='12160'>
               enddo<a name='12161'>
            enddo<a name='12162'>
         enddo<a name='12163'>
      enddo<a name='12164'>
<a name='12165'>
      do jt = 1,10<a name='12166'>
         iprsm = 0<a name='12167'>
         do igc = 1,ngc(4)<a name='12168'>
            sumk = 0.<a name='12169'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='12170'>
               iprsm = iprsm + 1<a name='12171'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+48)<a name='12172'>
            enddo<a name='12173'>
            selfref(jt,igc) = sumk<a name='12174'>
         enddo<a name='12175'>
      enddo<a name='12176'>
<a name='12177'>
      do jt = 1,4<a name='12178'>
         iprsm = 0<a name='12179'>
         do igc = 1,ngc(4)<a name='12180'>
            sumk = 0.<a name='12181'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='12182'>
               iprsm = iprsm + 1<a name='12183'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+48)<a name='12184'>
            enddo<a name='12185'>
            forref(jt,igc) = sumk<a name='12186'>
         enddo<a name='12187'>
      enddo<a name='12188'>
<a name='12189'>
      do jp = 1,9<a name='12190'>
         iprsm = 0<a name='12191'>
         do igc = 1,ngc(4)<a name='12192'>
            sumf = 0.<a name='12193'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='12194'>
               iprsm = iprsm + 1<a name='12195'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='12196'>
            enddo<a name='12197'>
            fracrefa(igc,jp) = sumf<a name='12198'>
         enddo<a name='12199'>
      enddo<a name='12200'>
<a name='12201'>
      do jp = 1,5<a name='12202'>
         iprsm = 0<a name='12203'>
         do igc = 1,ngc(4)<a name='12204'>
            sumf = 0.<a name='12205'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='12206'>
               iprsm = iprsm + 1<a name='12207'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='12208'>
            enddo<a name='12209'>
            fracrefb(igc,jp) = sumf<a name='12210'>
         enddo<a name='12211'>
      enddo<a name='12212'>
<a name='12213'>
      end subroutine cmbgb4<a name='12214'>
<a name='12215'>
<font color=#447700>!***************************************************************************<a name='12216'></font>
<A NAME='CMBGB5'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12217'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb5</font> <A href='../../call_to/CMBGB5.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB5.html' TARGET='index'>4</A><a name='12218'>
<font color=#447700>!***************************************************************************<a name='12219'></font>
<font color=#447700>!<a name='12220'></font>
<font color=#447700>!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)<a name='12221'></font>
<font color=#447700>!                           (high key - o3,co2)<a name='12222'></font>
<font color=#447700>!<a name='12223'></font>
<font color=#447700>! old band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='12224'></font>
<font color=#447700>!***************************************************************************<a name='12225'></font>
<a name='12226'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_30">, only : mg, nbndlw, ngptlw, ng5<a name='12227'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F'>rrlw_kg05_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_F_3">, only: fracrefao, fracrefbo, kao, kbo, kao_mo3, ccl4o, &amp;<a name='12228'>
                           selfrefo, forrefo, &amp;<a name='12229'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mo3, ccl4, &amp;<a name='12230'>
                           selfref, forref<a name='12231'>
<a name='12232'>
<font color=#447700>! ------- Local -------<a name='12233'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='12234'>
      real  :: sumk, sumf<a name='12235'>
<a name='12236'>
<a name='12237'>
      do jn = 1,9<a name='12238'>
         do jt = 1,5<a name='12239'>
            do jp = 1,13<a name='12240'>
               iprsm = 0<a name='12241'>
               do igc = 1,ngc(5)<a name='12242'>
                 sumk = 0.<a name='12243'>
                  do ipr = 1, ngn(ngs(4)+igc)<a name='12244'>
                     iprsm = iprsm + 1<a name='12245'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+64)<a name='12246'>
                  enddo<a name='12247'>
                  ka(jn,jt,jp,igc) = sumk<a name='12248'>
               enddo<a name='12249'>
            enddo<a name='12250'>
         enddo<a name='12251'>
      enddo<a name='12252'>
      do jn = 1,5<a name='12253'>
         do jt = 1,5<a name='12254'>
            do jp = 13,59<a name='12255'>
               iprsm = 0<a name='12256'>
               do igc = 1,ngc(5)<a name='12257'>
                  sumk = 0.<a name='12258'>
                  do ipr = 1, ngn(ngs(4)+igc)<a name='12259'>
                     iprsm = iprsm + 1<a name='12260'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+64)<a name='12261'>
                  enddo<a name='12262'>
                  kb(jn,jt,jp,igc) = sumk<a name='12263'>
               enddo<a name='12264'>
            enddo<a name='12265'>
         enddo<a name='12266'>
      enddo<a name='12267'>
<a name='12268'>
      do jn = 1,9<a name='12269'>
         do jt = 1,19<a name='12270'>
            iprsm = 0<a name='12271'>
            do igc = 1,ngc(5)<a name='12272'>
              sumk = 0.<a name='12273'>
               do ipr = 1, ngn(ngs(4)+igc)<a name='12274'>
                  iprsm = iprsm + 1<a name='12275'>
                  sumk = sumk + kao_mo3(jn,jt,iprsm)*rwgt(iprsm+64)<a name='12276'>
               enddo<a name='12277'>
               ka_mo3(jn,jt,igc) = sumk<a name='12278'>
            enddo<a name='12279'>
         enddo<a name='12280'>
      enddo<a name='12281'>
<a name='12282'>
      do jt = 1,10<a name='12283'>
         iprsm = 0<a name='12284'>
         do igc = 1,ngc(5)<a name='12285'>
            sumk = 0.<a name='12286'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='12287'>
               iprsm = iprsm + 1<a name='12288'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+64)<a name='12289'>
            enddo<a name='12290'>
            selfref(jt,igc) = sumk<a name='12291'>
         enddo<a name='12292'>
      enddo<a name='12293'>
<a name='12294'>
      do jt = 1,4<a name='12295'>
         iprsm = 0<a name='12296'>
         do igc = 1,ngc(5)<a name='12297'>
            sumk = 0.<a name='12298'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='12299'>
               iprsm = iprsm + 1<a name='12300'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+64)<a name='12301'>
            enddo<a name='12302'>
            forref(jt,igc) = sumk<a name='12303'>
         enddo<a name='12304'>
      enddo<a name='12305'>
<a name='12306'>
      do jp = 1,9<a name='12307'>
         iprsm = 0<a name='12308'>
         do igc = 1,ngc(5)<a name='12309'>
            sumf = 0.<a name='12310'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='12311'>
               iprsm = iprsm + 1<a name='12312'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='12313'>
            enddo<a name='12314'>
            fracrefa(igc,jp) = sumf<a name='12315'>
         enddo<a name='12316'>
      enddo<a name='12317'>
<a name='12318'>
      do jp = 1,5<a name='12319'>
         iprsm = 0<a name='12320'>
         do igc = 1,ngc(5)<a name='12321'>
            sumf = 0.<a name='12322'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='12323'>
               iprsm = iprsm + 1<a name='12324'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='12325'>
            enddo<a name='12326'>
            fracrefb(igc,jp) = sumf<a name='12327'>
         enddo<a name='12328'>
      enddo<a name='12329'>
<a name='12330'>
      iprsm = 0<a name='12331'>
      do igc = 1,ngc(5)<a name='12332'>
         sumk = 0.<a name='12333'>
         do ipr = 1, ngn(ngs(4)+igc)<a name='12334'>
            iprsm = iprsm + 1<a name='12335'>
            sumk = sumk + ccl4o(iprsm)*rwgt(iprsm+64)<a name='12336'>
         enddo<a name='12337'>
         ccl4(igc) = sumk<a name='12338'>
      enddo<a name='12339'>
<a name='12340'>
      end subroutine cmbgb5<a name='12341'>
<a name='12342'>
<font color=#447700>!***************************************************************************<a name='12343'></font>
<A NAME='CMBGB6'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12344'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb6</font> <A href='../../call_to/CMBGB6.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB6.html' TARGET='index'>4</A><a name='12345'>
<font color=#447700>!***************************************************************************<a name='12346'></font>
<font color=#447700>!<a name='12347'></font>
<font color=#447700>!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)<a name='12348'></font>
<font color=#447700>!                           (high key - nothing; high minor - cfc11, cfc12)<a name='12349'></font>
<font color=#447700>!<a name='12350'></font>
<font color=#447700>! old band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='12351'></font>
<font color=#447700>!***************************************************************************<a name='12352'></font>
<a name='12353'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_31">, only : mg, nbndlw, ngptlw, ng6<a name='12354'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F'>rrlw_kg06_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_F_3">, only: fracrefao, kao, kao_mco2, cfc11adjo, cfc12o, &amp;<a name='12355'>
                           selfrefo, forrefo, &amp;<a name='12356'>
                           fracrefa, absa, ka, ka_mco2, cfc11adj, cfc12, &amp;<a name='12357'>
                           selfref, forref<a name='12358'>
<a name='12359'>
<font color=#447700>! ------- Local -------<a name='12360'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='12361'>
      real  :: sumk, sumf, sumk1, sumk2<a name='12362'>
<a name='12363'>
<a name='12364'>
      do jt = 1,5<a name='12365'>
         do jp = 1,13<a name='12366'>
            iprsm = 0<a name='12367'>
            do igc = 1,ngc(6)<a name='12368'>
               sumk = 0.<a name='12369'>
               do ipr = 1, ngn(ngs(5)+igc)<a name='12370'>
                  iprsm = iprsm + 1<a name='12371'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+80)<a name='12372'>
               enddo<a name='12373'>
               ka(jt,jp,igc) = sumk<a name='12374'>
            enddo<a name='12375'>
         enddo<a name='12376'>
      enddo<a name='12377'>
<a name='12378'>
      do jt = 1,19<a name='12379'>
         iprsm = 0<a name='12380'>
         do igc = 1,ngc(6)<a name='12381'>
            sumk = 0.<a name='12382'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='12383'>
               iprsm = iprsm + 1<a name='12384'>
               sumk = sumk + kao_mco2(jt,iprsm)*rwgt(iprsm+80)<a name='12385'>
            enddo<a name='12386'>
            ka_mco2(jt,igc) = sumk<a name='12387'>
         enddo<a name='12388'>
      enddo<a name='12389'>
<a name='12390'>
      do jt = 1,10<a name='12391'>
         iprsm = 0<a name='12392'>
         do igc = 1,ngc(6)<a name='12393'>
            sumk = 0.<a name='12394'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='12395'>
               iprsm = iprsm + 1<a name='12396'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+80)<a name='12397'>
            enddo<a name='12398'>
            selfref(jt,igc) = sumk<a name='12399'>
         enddo<a name='12400'>
      enddo<a name='12401'>
<a name='12402'>
      do jt = 1,4<a name='12403'>
         iprsm = 0<a name='12404'>
         do igc = 1,ngc(6)<a name='12405'>
            sumk = 0.<a name='12406'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='12407'>
               iprsm = iprsm + 1<a name='12408'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+80)<a name='12409'>
            enddo<a name='12410'>
            forref(jt,igc) = sumk<a name='12411'>
         enddo<a name='12412'>
      enddo<a name='12413'>
<a name='12414'>
      iprsm = 0<a name='12415'>
      do igc = 1,ngc(6)<a name='12416'>
         sumf = 0.<a name='12417'>
         sumk1= 0.<a name='12418'>
         sumk2= 0.<a name='12419'>
         do ipr = 1, ngn(ngs(5)+igc)<a name='12420'>
            iprsm = iprsm + 1<a name='12421'>
            sumf = sumf + fracrefao(iprsm)<a name='12422'>
            sumk1= sumk1+ cfc11adjo(iprsm)*rwgt(iprsm+80)<a name='12423'>
            sumk2= sumk2+ cfc12o(iprsm)*rwgt(iprsm+80)<a name='12424'>
         enddo<a name='12425'>
         fracrefa(igc) = sumf<a name='12426'>
         cfc11adj(igc) = sumk1<a name='12427'>
         cfc12(igc) = sumk2<a name='12428'>
      enddo<a name='12429'>
<a name='12430'>
      end subroutine cmbgb6<a name='12431'>
<a name='12432'>
<font color=#447700>!***************************************************************************<a name='12433'></font>
<A NAME='CMBGB7'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12434'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb7</font> <A href='../../call_to/CMBGB7.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB7.html' TARGET='index'>4</A><a name='12435'>
<font color=#447700>!***************************************************************************<a name='12436'></font>
<font color=#447700>!<a name='12437'></font>
<font color=#447700>!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)<a name='12438'></font>
<font color=#447700>!                            (high key - o3; high minor - co2)<a name='12439'></font>
<font color=#447700>!<a name='12440'></font>
<font color=#447700>! old band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='12441'></font>
<font color=#447700>!***************************************************************************<a name='12442'></font>
<a name='12443'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_32">, only : mg, nbndlw, ngptlw, ng7<a name='12444'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F'>rrlw_kg07_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_F_3">, only: fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, &amp;<a name='12445'>
                           selfrefo, forrefo, &amp;<a name='12446'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mco2, kb_mco2, &amp;<a name='12447'>
                           selfref, forref<a name='12448'>
<a name='12449'>
<font color=#447700>! ------- Local -------<a name='12450'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='12451'>
      real  :: sumk, sumf<a name='12452'>
<a name='12453'>
<a name='12454'>
      do jn = 1,9<a name='12455'>
         do jt = 1,5<a name='12456'>
            do jp = 1,13<a name='12457'>
               iprsm = 0<a name='12458'>
               do igc = 1,ngc(7)<a name='12459'>
                 sumk = 0.<a name='12460'>
                  do ipr = 1, ngn(ngs(6)+igc)<a name='12461'>
                     iprsm = iprsm + 1<a name='12462'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+96)<a name='12463'>
                  enddo<a name='12464'>
                  ka(jn,jt,jp,igc) = sumk<a name='12465'>
               enddo<a name='12466'>
            enddo<a name='12467'>
         enddo<a name='12468'>
      enddo<a name='12469'>
      do jt = 1,5<a name='12470'>
         do jp = 13,59<a name='12471'>
            iprsm = 0<a name='12472'>
            do igc = 1,ngc(7)<a name='12473'>
               sumk = 0.<a name='12474'>
               do ipr = 1, ngn(ngs(6)+igc)<a name='12475'>
                  iprsm = iprsm + 1<a name='12476'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+96)<a name='12477'>
               enddo<a name='12478'>
               kb(jt,jp,igc) = sumk<a name='12479'>
            enddo<a name='12480'>
         enddo<a name='12481'>
      enddo<a name='12482'>
<a name='12483'>
      do jn = 1,9<a name='12484'>
         do jt = 1,19<a name='12485'>
            iprsm = 0<a name='12486'>
            do igc = 1,ngc(7)<a name='12487'>
              sumk = 0.<a name='12488'>
               do ipr = 1, ngn(ngs(6)+igc)<a name='12489'>
                  iprsm = iprsm + 1<a name='12490'>
                  sumk = sumk + kao_mco2(jn,jt,iprsm)*rwgt(iprsm+96)<a name='12491'>
               enddo<a name='12492'>
               ka_mco2(jn,jt,igc) = sumk<a name='12493'>
            enddo<a name='12494'>
         enddo<a name='12495'>
      enddo<a name='12496'>
<a name='12497'>
      do jt = 1,19<a name='12498'>
         iprsm = 0<a name='12499'>
         do igc = 1,ngc(7)<a name='12500'>
            sumk = 0.<a name='12501'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='12502'>
               iprsm = iprsm + 1<a name='12503'>
               sumk = sumk + kbo_mco2(jt,iprsm)*rwgt(iprsm+96)<a name='12504'>
            enddo<a name='12505'>
            kb_mco2(jt,igc) = sumk<a name='12506'>
         enddo<a name='12507'>
      enddo<a name='12508'>
<a name='12509'>
      do jt = 1,10<a name='12510'>
         iprsm = 0<a name='12511'>
         do igc = 1,ngc(7)<a name='12512'>
            sumk = 0.<a name='12513'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='12514'>
               iprsm = iprsm + 1<a name='12515'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+96)<a name='12516'>
            enddo<a name='12517'>
            selfref(jt,igc) = sumk<a name='12518'>
         enddo<a name='12519'>
      enddo<a name='12520'>
<a name='12521'>
      do jt = 1,4<a name='12522'>
         iprsm = 0<a name='12523'>
         do igc = 1,ngc(7)<a name='12524'>
            sumk = 0.<a name='12525'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='12526'>
               iprsm = iprsm + 1<a name='12527'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+96)<a name='12528'>
            enddo<a name='12529'>
            forref(jt,igc) = sumk<a name='12530'>
         enddo<a name='12531'>
      enddo<a name='12532'>
<a name='12533'>
      do jp = 1,9<a name='12534'>
         iprsm = 0<a name='12535'>
         do igc = 1,ngc(7)<a name='12536'>
            sumf = 0.<a name='12537'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='12538'>
               iprsm = iprsm + 1<a name='12539'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='12540'>
            enddo<a name='12541'>
            fracrefa(igc,jp) = sumf<a name='12542'>
         enddo<a name='12543'>
      enddo<a name='12544'>
<a name='12545'>
      iprsm = 0<a name='12546'>
      do igc = 1,ngc(7)<a name='12547'>
         sumf = 0.<a name='12548'>
         do ipr = 1, ngn(ngs(6)+igc)<a name='12549'>
            iprsm = iprsm + 1<a name='12550'>
            sumf = sumf + fracrefbo(iprsm)<a name='12551'>
         enddo<a name='12552'>
         fracrefb(igc) = sumf<a name='12553'>
      enddo<a name='12554'>
<a name='12555'>
      end subroutine cmbgb7<a name='12556'>
<a name='12557'>
<font color=#447700>!***************************************************************************<a name='12558'></font>
<A NAME='CMBGB8'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12559'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb8</font> <A href='../../call_to/CMBGB8.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB8.html' TARGET='index'>4</A><a name='12560'>
<font color=#447700>!***************************************************************************<a name='12561'></font>
<font color=#447700>!<a name='12562'></font>
<font color=#447700>!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)<a name='12563'></font>
<font color=#447700>!                             (high key - o3; high minor - co2, n2o)<a name='12564'></font>
<font color=#447700>!<a name='12565'></font>
<font color=#447700>! old band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='12566'></font>
<font color=#447700>!***************************************************************************<a name='12567'></font>
<a name='12568'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_33">, only : mg, nbndlw, ngptlw, ng8<a name='12569'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F'>rrlw_kg08_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_F_3">, only: fracrefao, fracrefbo, kao, kao_mco2, kao_mn2o, &amp;<a name='12570'>
                           kao_mo3, kbo, kbo_mco2, kbo_mn2o, selfrefo, forrefo, &amp;<a name='12571'>
                           cfc12o, cfc22adjo, &amp;<a name='12572'>
                           fracrefa, fracrefb, absa, ka, ka_mco2, ka_mn2o, &amp;<a name='12573'>
                           ka_mo3, absb, kb, kb_mco2, kb_mn2o, selfref, forref, &amp;<a name='12574'>
                           cfc12, cfc22adj<a name='12575'>
<a name='12576'>
<font color=#447700>! ------- Local -------<a name='12577'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='12578'>
      real  :: sumk, sumk1, sumk2, sumk3, sumk4, sumk5, sumf1, sumf2<a name='12579'>
<a name='12580'>
<a name='12581'>
      do jt = 1,5<a name='12582'>
         do jp = 1,13<a name='12583'>
            iprsm = 0<a name='12584'>
            do igc = 1,ngc(8)<a name='12585'>
              sumk = 0.<a name='12586'>
               do ipr = 1, ngn(ngs(7)+igc)<a name='12587'>
                  iprsm = iprsm + 1<a name='12588'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+112)<a name='12589'>
               enddo<a name='12590'>
               ka(jt,jp,igc) = sumk<a name='12591'>
            enddo<a name='12592'>
         enddo<a name='12593'>
      enddo<a name='12594'>
      do jt = 1,5<a name='12595'>
         do jp = 13,59<a name='12596'>
            iprsm = 0<a name='12597'>
            do igc = 1,ngc(8)<a name='12598'>
               sumk = 0.<a name='12599'>
               do ipr = 1, ngn(ngs(7)+igc)<a name='12600'>
                  iprsm = iprsm + 1<a name='12601'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+112)<a name='12602'>
               enddo<a name='12603'>
               kb(jt,jp,igc) = sumk<a name='12604'>
            enddo<a name='12605'>
         enddo<a name='12606'>
      enddo<a name='12607'>
<a name='12608'>
      do jt = 1,10<a name='12609'>
         iprsm = 0<a name='12610'>
         do igc = 1,ngc(8)<a name='12611'>
            sumk = 0.<a name='12612'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='12613'>
               iprsm = iprsm + 1<a name='12614'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+112)<a name='12615'>
            enddo<a name='12616'>
            selfref(jt,igc) = sumk<a name='12617'>
         enddo<a name='12618'>
      enddo<a name='12619'>
<a name='12620'>
      do jt = 1,4<a name='12621'>
         iprsm = 0<a name='12622'>
         do igc = 1,ngc(8)<a name='12623'>
            sumk = 0.<a name='12624'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='12625'>
               iprsm = iprsm + 1<a name='12626'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+112)<a name='12627'>
            enddo<a name='12628'>
            forref(jt,igc) = sumk<a name='12629'>
         enddo<a name='12630'>
      enddo<a name='12631'>
<a name='12632'>
      do jt = 1,19<a name='12633'>
         iprsm = 0<a name='12634'>
         do igc = 1,ngc(8)<a name='12635'>
            sumk1 = 0.<a name='12636'>
            sumk2 = 0.<a name='12637'>
            sumk3 = 0.<a name='12638'>
            sumk4 = 0.<a name='12639'>
            sumk5 = 0.<a name='12640'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='12641'>
               iprsm = iprsm + 1<a name='12642'>
               sumk1 = sumk1 + kao_mco2(jt,iprsm)*rwgt(iprsm+112)<a name='12643'>
               sumk2 = sumk2 + kbo_mco2(jt,iprsm)*rwgt(iprsm+112)<a name='12644'>
               sumk3 = sumk3 + kao_mo3(jt,iprsm)*rwgt(iprsm+112)<a name='12645'>
               sumk4 = sumk4 + kao_mn2o(jt,iprsm)*rwgt(iprsm+112)<a name='12646'>
               sumk5 = sumk5 + kbo_mn2o(jt,iprsm)*rwgt(iprsm+112)<a name='12647'>
            enddo<a name='12648'>
            ka_mco2(jt,igc) = sumk1<a name='12649'>
            kb_mco2(jt,igc) = sumk2<a name='12650'>
            ka_mo3(jt,igc) = sumk3<a name='12651'>
            ka_mn2o(jt,igc) = sumk4<a name='12652'>
            kb_mn2o(jt,igc) = sumk5<a name='12653'>
         enddo<a name='12654'>
      enddo<a name='12655'>
<a name='12656'>
      iprsm = 0<a name='12657'>
      do igc = 1,ngc(8)<a name='12658'>
         sumf1= 0.<a name='12659'>
         sumf2= 0.<a name='12660'>
         sumk1= 0.<a name='12661'>
         sumk2= 0.<a name='12662'>
         do ipr = 1, ngn(ngs(7)+igc)<a name='12663'>
            iprsm = iprsm + 1<a name='12664'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='12665'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='12666'>
            sumk1= sumk1+ cfc12o(iprsm)*rwgt(iprsm+112)<a name='12667'>
            sumk2= sumk2+ cfc22adjo(iprsm)*rwgt(iprsm+112)<a name='12668'>
         enddo<a name='12669'>
         fracrefa(igc) = sumf1<a name='12670'>
         fracrefb(igc) = sumf2<a name='12671'>
         cfc12(igc) = sumk1<a name='12672'>
         cfc22adj(igc) = sumk2<a name='12673'>
      enddo<a name='12674'>
<a name='12675'>
      end subroutine cmbgb8<a name='12676'>
<a name='12677'>
<font color=#447700>!***************************************************************************<a name='12678'></font>
<A NAME='CMBGB9'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12679'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb9</font> <A href='../../call_to/CMBGB9.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB9.html' TARGET='index'>4</A><a name='12680'>
<font color=#447700>!***************************************************************************<a name='12681'></font>
<font color=#447700>!<a name='12682'></font>
<font color=#447700>!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)<a name='12683'></font>
<font color=#447700>!                             (high key - ch4; high minor - n2o)!<a name='12684'></font>
<a name='12685'>
<font color=#447700>! old band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='12686'></font>
<font color=#447700>!***************************************************************************<a name='12687'></font>
<a name='12688'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_34">, only : mg, nbndlw, ngptlw, ng9<a name='12689'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F'>rrlw_kg09_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_F_3">, only: fracrefao, fracrefbo, kao, kao_mn2o, &amp;<a name='12690'>
                           kbo, kbo_mn2o, selfrefo, forrefo, &amp;<a name='12691'>
                           fracrefa, fracrefb, absa, ka, ka_mn2o, &amp;<a name='12692'>
                           absb, kb, kb_mn2o, selfref, forref<a name='12693'>
<a name='12694'>
<font color=#447700>! ------- Local -------<a name='12695'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='12696'>
      real  :: sumk, sumf<a name='12697'>
<a name='12698'>
<a name='12699'>
      do jn = 1,9<a name='12700'>
         do jt = 1,5<a name='12701'>
            do jp = 1,13<a name='12702'>
               iprsm = 0<a name='12703'>
               do igc = 1,ngc(9)<a name='12704'>
                  sumk = 0.<a name='12705'>
                  do ipr = 1, ngn(ngs(8)+igc)<a name='12706'>
                     iprsm = iprsm + 1<a name='12707'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+128)<a name='12708'>
                  enddo<a name='12709'>
                  ka(jn,jt,jp,igc) = sumk<a name='12710'>
               enddo<a name='12711'>
            enddo<a name='12712'>
         enddo<a name='12713'>
      enddo<a name='12714'>
<a name='12715'>
      do jt = 1,5<a name='12716'>
         do jp = 13,59<a name='12717'>
            iprsm = 0<a name='12718'>
            do igc = 1,ngc(9)<a name='12719'>
               sumk = 0.<a name='12720'>
               do ipr = 1, ngn(ngs(8)+igc)<a name='12721'>
                  iprsm = iprsm + 1<a name='12722'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+128)<a name='12723'>
               enddo<a name='12724'>
               kb(jt,jp,igc) = sumk<a name='12725'>
            enddo<a name='12726'>
         enddo<a name='12727'>
      enddo<a name='12728'>
<a name='12729'>
      do jn = 1,9<a name='12730'>
         do jt = 1,19<a name='12731'>
            iprsm = 0<a name='12732'>
            do igc = 1,ngc(9)<a name='12733'>
              sumk = 0.<a name='12734'>
               do ipr = 1, ngn(ngs(8)+igc)<a name='12735'>
                  iprsm = iprsm + 1<a name='12736'>
                  sumk = sumk + kao_mn2o(jn,jt,iprsm)*rwgt(iprsm+128)<a name='12737'>
               enddo<a name='12738'>
               ka_mn2o(jn,jt,igc) = sumk<a name='12739'>
            enddo<a name='12740'>
         enddo<a name='12741'>
      enddo<a name='12742'>
<a name='12743'>
      do jt = 1,19<a name='12744'>
         iprsm = 0<a name='12745'>
         do igc = 1,ngc(9)<a name='12746'>
            sumk = 0.<a name='12747'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='12748'>
               iprsm = iprsm + 1<a name='12749'>
               sumk = sumk + kbo_mn2o(jt,iprsm)*rwgt(iprsm+128)<a name='12750'>
            enddo<a name='12751'>
            kb_mn2o(jt,igc) = sumk<a name='12752'>
         enddo<a name='12753'>
      enddo<a name='12754'>
<a name='12755'>
      do jt = 1,10<a name='12756'>
         iprsm = 0<a name='12757'>
         do igc = 1,ngc(9)<a name='12758'>
            sumk = 0.<a name='12759'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='12760'>
               iprsm = iprsm + 1<a name='12761'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+128)<a name='12762'>
            enddo<a name='12763'>
            selfref(jt,igc) = sumk<a name='12764'>
         enddo<a name='12765'>
      enddo<a name='12766'>
<a name='12767'>
      do jt = 1,4<a name='12768'>
         iprsm = 0<a name='12769'>
         do igc = 1,ngc(9)<a name='12770'>
            sumk = 0.<a name='12771'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='12772'>
               iprsm = iprsm + 1<a name='12773'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+128)<a name='12774'>
            enddo<a name='12775'>
            forref(jt,igc) = sumk<a name='12776'>
         enddo<a name='12777'>
      enddo<a name='12778'>
<a name='12779'>
      do jp = 1,9<a name='12780'>
         iprsm = 0<a name='12781'>
         do igc = 1,ngc(9)<a name='12782'>
            sumf = 0.<a name='12783'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='12784'>
               iprsm = iprsm + 1<a name='12785'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='12786'>
            enddo<a name='12787'>
            fracrefa(igc,jp) = sumf<a name='12788'>
         enddo<a name='12789'>
      enddo<a name='12790'>
<a name='12791'>
      iprsm = 0<a name='12792'>
      do igc = 1,ngc(9)<a name='12793'>
         sumf = 0.<a name='12794'>
         do ipr = 1, ngn(ngs(8)+igc)<a name='12795'>
            iprsm = iprsm + 1<a name='12796'>
            sumf = sumf + fracrefbo(iprsm)<a name='12797'>
         enddo<a name='12798'>
         fracrefb(igc) = sumf<a name='12799'>
      enddo<a name='12800'>
<a name='12801'>
      end subroutine cmbgb9<a name='12802'>
<a name='12803'>
<font color=#447700>!***************************************************************************<a name='12804'></font>
<A NAME='CMBGB10'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12805'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb10</font> <A href='../../call_to/CMBGB10.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB10.html' TARGET='index'>4</A><a name='12806'>
<font color=#447700>!***************************************************************************<a name='12807'></font>
<font color=#447700>!<a name='12808'></font>
<font color=#447700>!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)<a name='12809'></font>
<font color=#447700>!<a name='12810'></font>
<font color=#447700>! old band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='12811'></font>
<font color=#447700>!***************************************************************************<a name='12812'></font>
<a name='12813'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_35">, only : mg, nbndlw, ngptlw, ng10<a name='12814'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F'>rrlw_kg10_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_F_3">, only: fracrefao, fracrefbo, kao, kbo, &amp;<a name='12815'>
                           selfrefo, forrefo, &amp;<a name='12816'>
                           fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='12817'>
                           selfref, forref<a name='12818'>
<a name='12819'>
<font color=#447700>! ------- Local -------<a name='12820'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='12821'>
      real  :: sumk, sumf1, sumf2<a name='12822'>
<a name='12823'>
<a name='12824'>
      do jt = 1,5<a name='12825'>
         do jp = 1,13<a name='12826'>
            iprsm = 0<a name='12827'>
            do igc = 1,ngc(10)<a name='12828'>
               sumk = 0.<a name='12829'>
               do ipr = 1, ngn(ngs(9)+igc)<a name='12830'>
                  iprsm = iprsm + 1<a name='12831'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+144)<a name='12832'>
               enddo<a name='12833'>
               ka(jt,jp,igc) = sumk<a name='12834'>
            enddo<a name='12835'>
         enddo<a name='12836'>
      enddo<a name='12837'>
<a name='12838'>
      do jt = 1,5<a name='12839'>
         do jp = 13,59<a name='12840'>
            iprsm = 0<a name='12841'>
            do igc = 1,ngc(10)<a name='12842'>
               sumk = 0.<a name='12843'>
               do ipr = 1, ngn(ngs(9)+igc)<a name='12844'>
                  iprsm = iprsm + 1<a name='12845'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+144)<a name='12846'>
               enddo<a name='12847'>
               kb(jt,jp,igc) = sumk<a name='12848'>
            enddo<a name='12849'>
         enddo<a name='12850'>
      enddo<a name='12851'>
<a name='12852'>
      do jt = 1,10<a name='12853'>
         iprsm = 0<a name='12854'>
         do igc = 1,ngc(10)<a name='12855'>
            sumk = 0.<a name='12856'>
            do ipr = 1, ngn(ngs(9)+igc)<a name='12857'>
               iprsm = iprsm + 1<a name='12858'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+144)<a name='12859'>
            enddo<a name='12860'>
            selfref(jt,igc) = sumk<a name='12861'>
         enddo<a name='12862'>
      enddo<a name='12863'>
<a name='12864'>
      do jt = 1,4<a name='12865'>
         iprsm = 0<a name='12866'>
         do igc = 1,ngc(10)<a name='12867'>
            sumk = 0.<a name='12868'>
            do ipr = 1, ngn(ngs(9)+igc)<a name='12869'>
               iprsm = iprsm + 1<a name='12870'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+144)<a name='12871'>
            enddo<a name='12872'>
            forref(jt,igc) = sumk<a name='12873'>
         enddo<a name='12874'>
      enddo<a name='12875'>
<a name='12876'>
      iprsm = 0<a name='12877'>
      do igc = 1,ngc(10)<a name='12878'>
         sumf1= 0.<a name='12879'>
         sumf2= 0.<a name='12880'>
         do ipr = 1, ngn(ngs(9)+igc)<a name='12881'>
            iprsm = iprsm + 1<a name='12882'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='12883'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='12884'>
         enddo<a name='12885'>
         fracrefa(igc) = sumf1<a name='12886'>
         fracrefb(igc) = sumf2<a name='12887'>
      enddo<a name='12888'>
<a name='12889'>
      end subroutine cmbgb10<a name='12890'>
<a name='12891'>
<font color=#447700>!***************************************************************************<a name='12892'></font>
<A NAME='CMBGB11'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12893'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb11</font> <A href='../../call_to/CMBGB11.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB11.html' TARGET='index'>4</A><a name='12894'>
<font color=#447700>!***************************************************************************<a name='12895'></font>
<font color=#447700>!<a name='12896'></font>
<font color=#447700>!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='12897'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='12898'></font>
<font color=#447700>!<a name='12899'></font>
<font color=#447700>! old band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='12900'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='12901'></font>
<font color=#447700>!***************************************************************************<a name='12902'></font>
<a name='12903'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_36">, only : mg, nbndlw, ngptlw, ng11<a name='12904'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F'>rrlw_kg11_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_F_3">, only: fracrefao, fracrefbo, kao, kao_mo2, &amp;<a name='12905'>
                           kbo, kbo_mo2, selfrefo, forrefo, &amp;<a name='12906'>
                           fracrefa, fracrefb, absa, ka, ka_mo2, &amp;<a name='12907'>
                           absb, kb, kb_mo2, selfref, forref<a name='12908'>
<a name='12909'>
<font color=#447700>! ------- Local -------<a name='12910'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='12911'>
      real  :: sumk, sumk1, sumk2, sumf1, sumf2<a name='12912'>
<a name='12913'>
<a name='12914'>
      do jt = 1,5<a name='12915'>
         do jp = 1,13<a name='12916'>
            iprsm = 0<a name='12917'>
            do igc = 1,ngc(11)<a name='12918'>
               sumk = 0.<a name='12919'>
               do ipr = 1, ngn(ngs(10)+igc)<a name='12920'>
                  iprsm = iprsm + 1<a name='12921'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+160)<a name='12922'>
               enddo<a name='12923'>
               ka(jt,jp,igc) = sumk<a name='12924'>
            enddo<a name='12925'>
         enddo<a name='12926'>
      enddo<a name='12927'>
      do jt = 1,5<a name='12928'>
         do jp = 13,59<a name='12929'>
            iprsm = 0<a name='12930'>
            do igc = 1,ngc(11)<a name='12931'>
               sumk = 0.<a name='12932'>
               do ipr = 1, ngn(ngs(10)+igc)<a name='12933'>
                  iprsm = iprsm + 1<a name='12934'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+160)<a name='12935'>
               enddo<a name='12936'>
               kb(jt,jp,igc) = sumk<a name='12937'>
            enddo<a name='12938'>
         enddo<a name='12939'>
      enddo<a name='12940'>
<a name='12941'>
      do jt = 1,19<a name='12942'>
         iprsm = 0<a name='12943'>
         do igc = 1,ngc(11)<a name='12944'>
            sumk1 = 0.<a name='12945'>
            sumk2 = 0.<a name='12946'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='12947'>
               iprsm = iprsm + 1<a name='12948'>
               sumk1 = sumk1 + kao_mo2(jt,iprsm)*rwgt(iprsm+160)<a name='12949'>
               sumk2 = sumk2 + kbo_mo2(jt,iprsm)*rwgt(iprsm+160)<a name='12950'>
            enddo<a name='12951'>
            ka_mo2(jt,igc) = sumk1<a name='12952'>
            kb_mo2(jt,igc) = sumk2<a name='12953'>
         enddo<a name='12954'>
      enddo<a name='12955'>
<a name='12956'>
      do jt = 1,10<a name='12957'>
         iprsm = 0<a name='12958'>
         do igc = 1,ngc(11)<a name='12959'>
            sumk = 0.<a name='12960'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='12961'>
               iprsm = iprsm + 1<a name='12962'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+160)<a name='12963'>
            enddo<a name='12964'>
            selfref(jt,igc) = sumk<a name='12965'>
         enddo<a name='12966'>
      enddo<a name='12967'>
<a name='12968'>
      do jt = 1,4<a name='12969'>
         iprsm = 0<a name='12970'>
         do igc = 1,ngc(11)<a name='12971'>
            sumk = 0.<a name='12972'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='12973'>
               iprsm = iprsm + 1<a name='12974'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+160)<a name='12975'>
            enddo<a name='12976'>
            forref(jt,igc) = sumk<a name='12977'>
         enddo<a name='12978'>
      enddo<a name='12979'>
<a name='12980'>
      iprsm = 0<a name='12981'>
      do igc = 1,ngc(11)<a name='12982'>
         sumf1= 0.<a name='12983'>
         sumf2= 0.<a name='12984'>
         do ipr = 1, ngn(ngs(10)+igc)<a name='12985'>
            iprsm = iprsm + 1<a name='12986'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='12987'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='12988'>
         enddo<a name='12989'>
         fracrefa(igc) = sumf1<a name='12990'>
         fracrefb(igc) = sumf2<a name='12991'>
      enddo<a name='12992'>
<a name='12993'>
      end subroutine cmbgb11<a name='12994'>
<a name='12995'>
<font color=#447700>!***************************************************************************<a name='12996'></font>
<A NAME='CMBGB12'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12997'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb12</font> <A href='../../call_to/CMBGB12.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB12.html' TARGET='index'>4</A><a name='12998'>
<font color=#447700>!***************************************************************************<a name='12999'></font>
<font color=#447700>!<a name='13000'></font>
<font color=#447700>!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='13001'></font>
<font color=#447700>!<a name='13002'></font>
<font color=#447700>! old band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='13003'></font>
<font color=#447700>!***************************************************************************<a name='13004'></font>
<a name='13005'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_37">, only : mg, nbndlw, ngptlw, ng12<a name='13006'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F'>rrlw_kg12_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_F_3">, only: fracrefao, kao, selfrefo, forrefo, &amp;<a name='13007'>
                           fracrefa, absa, ka, selfref, forref<a name='13008'>
<a name='13009'>
<font color=#447700>! ------- Local -------<a name='13010'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='13011'>
      real  :: sumk, sumf<a name='13012'>
<a name='13013'>
<a name='13014'>
      do jn = 1,9<a name='13015'>
         do jt = 1,5<a name='13016'>
            do jp = 1,13<a name='13017'>
               iprsm = 0<a name='13018'>
               do igc = 1,ngc(12)<a name='13019'>
                  sumk = 0.<a name='13020'>
                  do ipr = 1, ngn(ngs(11)+igc)<a name='13021'>
                     iprsm = iprsm + 1<a name='13022'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+176)<a name='13023'>
                  enddo<a name='13024'>
                  ka(jn,jt,jp,igc) = sumk<a name='13025'>
               enddo<a name='13026'>
            enddo<a name='13027'>
         enddo<a name='13028'>
      enddo<a name='13029'>
<a name='13030'>
      do jt = 1,10<a name='13031'>
         iprsm = 0<a name='13032'>
         do igc = 1,ngc(12)<a name='13033'>
            sumk = 0.<a name='13034'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='13035'>
               iprsm = iprsm + 1<a name='13036'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+176)<a name='13037'>
            enddo<a name='13038'>
            selfref(jt,igc) = sumk<a name='13039'>
         enddo<a name='13040'>
      enddo<a name='13041'>
<a name='13042'>
      do jt = 1,4<a name='13043'>
         iprsm = 0<a name='13044'>
         do igc = 1,ngc(12)<a name='13045'>
            sumk = 0.<a name='13046'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='13047'>
               iprsm = iprsm + 1<a name='13048'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+176)<a name='13049'>
            enddo<a name='13050'>
            forref(jt,igc) = sumk<a name='13051'>
         enddo<a name='13052'>
      enddo<a name='13053'>
<a name='13054'>
      do jp = 1,9<a name='13055'>
         iprsm = 0<a name='13056'>
         do igc = 1,ngc(12)<a name='13057'>
            sumf = 0.<a name='13058'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='13059'>
               iprsm = iprsm + 1<a name='13060'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='13061'>
            enddo<a name='13062'>
            fracrefa(igc,jp) = sumf<a name='13063'>
         enddo<a name='13064'>
      enddo<a name='13065'>
<a name='13066'>
      end subroutine cmbgb12<a name='13067'>
<a name='13068'>
<font color=#447700>!***************************************************************************<a name='13069'></font>
<A NAME='CMBGB13'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13070'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb13</font> <A href='../../call_to/CMBGB13.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB13.html' TARGET='index'>4</A><a name='13071'>
<font color=#447700>!***************************************************************************<a name='13072'></font>
<font color=#447700>!<a name='13073'></font>
<font color=#447700>!     band 13:  2080-2250 cm-1 (low key - h2o,n2o; high minor - o3 minor)<a name='13074'></font>
<font color=#447700>!<a name='13075'></font>
<font color=#447700>! old band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='13076'></font>
<font color=#447700>!***************************************************************************<a name='13077'></font>
<a name='13078'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_38">, only : mg, nbndlw, ngptlw, ng13<a name='13079'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F'>rrlw_kg13_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_F_3">, only: fracrefao, fracrefbo, kao, kao_mco2, kao_mco, &amp;<a name='13080'>
                           kbo_mo3, selfrefo, forrefo, &amp;<a name='13081'>
                           fracrefa, fracrefb, absa, ka, ka_mco2, ka_mco, &amp;<a name='13082'>
                           kb_mo3, selfref, forref<a name='13083'>
<a name='13084'>
<font color=#447700>! ------- Local -------<a name='13085'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='13086'>
      real  :: sumk, sumk1, sumk2, sumf<a name='13087'>
<a name='13088'>
<a name='13089'>
      do jn = 1,9<a name='13090'>
         do jt = 1,5<a name='13091'>
            do jp = 1,13<a name='13092'>
               iprsm = 0<a name='13093'>
               do igc = 1,ngc(13)<a name='13094'>
                  sumk = 0.<a name='13095'>
                  do ipr = 1, ngn(ngs(12)+igc)<a name='13096'>
                     iprsm = iprsm + 1<a name='13097'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+192)<a name='13098'>
                  enddo<a name='13099'>
                  ka(jn,jt,jp,igc) = sumk<a name='13100'>
               enddo<a name='13101'>
            enddo<a name='13102'>
         enddo<a name='13103'>
      enddo<a name='13104'>
<a name='13105'>
      do jn = 1,9<a name='13106'>
         do jt = 1,19<a name='13107'>
            iprsm = 0<a name='13108'>
            do igc = 1,ngc(13)<a name='13109'>
              sumk1 = 0.<a name='13110'>
              sumk2 = 0.<a name='13111'>
               do ipr = 1, ngn(ngs(12)+igc)<a name='13112'>
                  iprsm = iprsm + 1<a name='13113'>
                  sumk1 = sumk1 + kao_mco2(jn,jt,iprsm)*rwgt(iprsm+192)<a name='13114'>
                  sumk2 = sumk2 + kao_mco(jn,jt,iprsm)*rwgt(iprsm+192)<a name='13115'>
               enddo<a name='13116'>
               ka_mco2(jn,jt,igc) = sumk1<a name='13117'>
               ka_mco(jn,jt,igc) = sumk2<a name='13118'>
            enddo<a name='13119'>
         enddo<a name='13120'>
      enddo<a name='13121'>
<a name='13122'>
      do jt = 1,19<a name='13123'>
         iprsm = 0<a name='13124'>
         do igc = 1,ngc(13)<a name='13125'>
            sumk = 0.<a name='13126'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='13127'>
               iprsm = iprsm + 1<a name='13128'>
               sumk = sumk + kbo_mo3(jt,iprsm)*rwgt(iprsm+192)<a name='13129'>
            enddo<a name='13130'>
            kb_mo3(jt,igc) = sumk<a name='13131'>
         enddo<a name='13132'>
      enddo<a name='13133'>
<a name='13134'>
      do jt = 1,10<a name='13135'>
         iprsm = 0<a name='13136'>
         do igc = 1,ngc(13)<a name='13137'>
            sumk = 0.<a name='13138'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='13139'>
               iprsm = iprsm + 1<a name='13140'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+192)<a name='13141'>
            enddo<a name='13142'>
            selfref(jt,igc) = sumk<a name='13143'>
         enddo<a name='13144'>
      enddo<a name='13145'>
<a name='13146'>
      do jt = 1,4<a name='13147'>
         iprsm = 0<a name='13148'>
         do igc = 1,ngc(13)<a name='13149'>
            sumk = 0.<a name='13150'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='13151'>
               iprsm = iprsm + 1<a name='13152'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+192)<a name='13153'>
            enddo<a name='13154'>
            forref(jt,igc) = sumk<a name='13155'>
         enddo<a name='13156'>
      enddo<a name='13157'>
<a name='13158'>
      iprsm = 0<a name='13159'>
      do igc = 1,ngc(13)<a name='13160'>
         sumf = 0.<a name='13161'>
         do ipr = 1, ngn(ngs(12)+igc)<a name='13162'>
            iprsm = iprsm + 1<a name='13163'>
            sumf = sumf + fracrefbo(iprsm)<a name='13164'>
         enddo<a name='13165'>
         fracrefb(igc) = sumf<a name='13166'>
      enddo<a name='13167'>
<a name='13168'>
      do jp = 1,9<a name='13169'>
         iprsm = 0<a name='13170'>
         do igc = 1,ngc(13)<a name='13171'>
            sumf = 0.<a name='13172'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='13173'>
               iprsm = iprsm + 1<a name='13174'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='13175'>
            enddo<a name='13176'>
            fracrefa(igc,jp) = sumf<a name='13177'>
         enddo<a name='13178'>
      enddo<a name='13179'>
<a name='13180'>
      end subroutine cmbgb13<a name='13181'>
<a name='13182'>
<font color=#447700>!***************************************************************************<a name='13183'></font>
<A NAME='CMBGB14'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13184'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb14</font> <A href='../../call_to/CMBGB14.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB14.html' TARGET='index'>4</A><a name='13185'>
<font color=#447700>!***************************************************************************<a name='13186'></font>
<font color=#447700>!<a name='13187'></font>
<font color=#447700>!     band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='13188'></font>
<font color=#447700>!<a name='13189'></font>
<font color=#447700>! old band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='13190'></font>
<font color=#447700>!***************************************************************************<a name='13191'></font>
<a name='13192'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_39">, only : mg, nbndlw, ngptlw, ng14<a name='13193'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F'>rrlw_kg14_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_F_3">, only: fracrefao, fracrefbo, kao, kbo, &amp;<a name='13194'>
                           selfrefo, forrefo, &amp;<a name='13195'>
                           fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='13196'>
                           selfref, forref<a name='13197'>
<a name='13198'>
<font color=#447700>! ------- Local -------<a name='13199'></font>
      integer  :: jt, jp, igc, ipr, iprsm <a name='13200'>
      real  :: sumk, sumf1, sumf2<a name='13201'>
<a name='13202'>
<a name='13203'>
      do jt = 1,5<a name='13204'>
         do jp = 1,13<a name='13205'>
            iprsm = 0<a name='13206'>
            do igc = 1,ngc(14)<a name='13207'>
               sumk = 0.<a name='13208'>
               do ipr = 1, ngn(ngs(13)+igc)<a name='13209'>
                  iprsm = iprsm + 1<a name='13210'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+208)<a name='13211'>
               enddo<a name='13212'>
               ka(jt,jp,igc) = sumk<a name='13213'>
            enddo<a name='13214'>
         enddo<a name='13215'>
      enddo<a name='13216'>
<a name='13217'>
      do jt = 1,5<a name='13218'>
         do jp = 13,59<a name='13219'>
            iprsm = 0<a name='13220'>
            do igc = 1,ngc(14)<a name='13221'>
               sumk = 0.<a name='13222'>
               do ipr = 1, ngn(ngs(13)+igc)<a name='13223'>
                  iprsm = iprsm + 1<a name='13224'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+208)<a name='13225'>
               enddo<a name='13226'>
               kb(jt,jp,igc) = sumk<a name='13227'>
            enddo<a name='13228'>
         enddo<a name='13229'>
      enddo<a name='13230'>
<a name='13231'>
      do jt = 1,10<a name='13232'>
         iprsm = 0<a name='13233'>
         do igc = 1,ngc(14)<a name='13234'>
            sumk = 0.<a name='13235'>
            do ipr = 1, ngn(ngs(13)+igc)<a name='13236'>
               iprsm = iprsm + 1<a name='13237'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+208)<a name='13238'>
            enddo<a name='13239'>
            selfref(jt,igc) = sumk<a name='13240'>
         enddo<a name='13241'>
      enddo<a name='13242'>
<a name='13243'>
      do jt = 1,4<a name='13244'>
         iprsm = 0<a name='13245'>
         do igc = 1,ngc(14)<a name='13246'>
            sumk = 0.<a name='13247'>
            do ipr = 1, ngn(ngs(13)+igc)<a name='13248'>
               iprsm = iprsm + 1<a name='13249'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+208)<a name='13250'>
            enddo<a name='13251'>
            forref(jt,igc) = sumk<a name='13252'>
         enddo<a name='13253'>
      enddo<a name='13254'>
<a name='13255'>
      iprsm = 0<a name='13256'>
      do igc = 1,ngc(14)<a name='13257'>
         sumf1= 0.<a name='13258'>
         sumf2= 0.<a name='13259'>
         do ipr = 1, ngn(ngs(13)+igc)<a name='13260'>
            iprsm = iprsm + 1<a name='13261'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='13262'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='13263'>
         enddo<a name='13264'>
         fracrefa(igc) = sumf1<a name='13265'>
         fracrefb(igc) = sumf2<a name='13266'>
      enddo<a name='13267'>
<a name='13268'>
      end subroutine cmbgb14<a name='13269'>
<a name='13270'>
<font color=#447700>!***************************************************************************<a name='13271'></font>
<A NAME='CMBGB15'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13272'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb15</font> <A href='../../call_to/CMBGB15.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB15.html' TARGET='index'>4</A><a name='13273'>
<font color=#447700>!***************************************************************************<a name='13274'></font>
<font color=#447700>!<a name='13275'></font>
<font color=#447700>!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)<a name='13276'></font>
<font color=#447700>!                              (high - nothing)<a name='13277'></font>
<font color=#447700>!<a name='13278'></font>
<font color=#447700>! old band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='13279'></font>
<font color=#447700>!***************************************************************************<a name='13280'></font>
<a name='13281'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_40">, only : mg, nbndlw, ngptlw, ng15<a name='13282'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F'>rrlw_kg15_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_F_3">, only: fracrefao, kao, kao_mn2, selfrefo, forrefo, &amp;<a name='13283'>
                           fracrefa, absa, ka, ka_mn2, selfref, forref<a name='13284'>
<a name='13285'>
<font color=#447700>! ------- Local -------<a name='13286'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='13287'>
      real  :: sumk, sumf<a name='13288'>
<a name='13289'>
<a name='13290'>
      do jn = 1,9<a name='13291'>
         do jt = 1,5<a name='13292'>
            do jp = 1,13<a name='13293'>
               iprsm = 0<a name='13294'>
               do igc = 1,ngc(15)<a name='13295'>
                  sumk = 0.<a name='13296'>
                  do ipr = 1, ngn(ngs(14)+igc)<a name='13297'>
                     iprsm = iprsm + 1<a name='13298'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+224)<a name='13299'>
                  enddo<a name='13300'>
                  ka(jn,jt,jp,igc) = sumk<a name='13301'>
               enddo<a name='13302'>
            enddo<a name='13303'>
         enddo<a name='13304'>
      enddo<a name='13305'>
<a name='13306'>
      do jn = 1,9<a name='13307'>
         do jt = 1,19<a name='13308'>
            iprsm = 0<a name='13309'>
            do igc = 1,ngc(15)<a name='13310'>
              sumk = 0.<a name='13311'>
               do ipr = 1, ngn(ngs(14)+igc)<a name='13312'>
                  iprsm = iprsm + 1<a name='13313'>
                  sumk = sumk + kao_mn2(jn,jt,iprsm)*rwgt(iprsm+224)<a name='13314'>
               enddo<a name='13315'>
               ka_mn2(jn,jt,igc) = sumk<a name='13316'>
            enddo<a name='13317'>
         enddo<a name='13318'>
      enddo<a name='13319'>
<a name='13320'>
      do jt = 1,10<a name='13321'>
         iprsm = 0<a name='13322'>
         do igc = 1,ngc(15)<a name='13323'>
            sumk = 0.<a name='13324'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='13325'>
               iprsm = iprsm + 1<a name='13326'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+224)<a name='13327'>
            enddo<a name='13328'>
            selfref(jt,igc) = sumk<a name='13329'>
         enddo<a name='13330'>
      enddo<a name='13331'>
<a name='13332'>
      do jt = 1,4<a name='13333'>
         iprsm = 0<a name='13334'>
         do igc = 1,ngc(15)<a name='13335'>
            sumk = 0.<a name='13336'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='13337'>
               iprsm = iprsm + 1<a name='13338'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+224)<a name='13339'>
            enddo<a name='13340'>
            forref(jt,igc) = sumk<a name='13341'>
         enddo<a name='13342'>
      enddo<a name='13343'>
<a name='13344'>
      do jp = 1,9<a name='13345'>
         iprsm = 0<a name='13346'>
         do igc = 1,ngc(15)<a name='13347'>
            sumf = 0.<a name='13348'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='13349'>
               iprsm = iprsm + 1<a name='13350'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='13351'>
            enddo<a name='13352'>
            fracrefa(igc,jp) = sumf<a name='13353'>
         enddo<a name='13354'>
      enddo<a name='13355'>
<a name='13356'>
      end subroutine cmbgb15<a name='13357'>
<a name='13358'>
<font color=#447700>!***************************************************************************<a name='13359'></font>
<A NAME='CMBGB16'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13360'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb16</font> <A href='../../call_to/CMBGB16.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB16.html' TARGET='index'>4</A><a name='13361'>
<font color=#447700>!***************************************************************************<a name='13362'></font>
<font color=#447700>!<a name='13363'></font>
<font color=#447700>!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)<a name='13364'></font>
<font color=#447700>!<a name='13365'></font>
<font color=#447700>! old band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='13366'></font>
<font color=#447700>!***************************************************************************<a name='13367'></font>
<a name='13368'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_41">, only : mg, nbndlw, ngptlw, ng16<a name='13369'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F'>rrlw_kg16_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_F_3">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='13370'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='13371'>
<a name='13372'>
<font color=#447700>! ------- Local -------<a name='13373'></font>
      integer  :: jn, jt, jp, igc, ipr, iprsm <a name='13374'>
      real  :: sumk, sumf<a name='13375'>
<a name='13376'>
<a name='13377'>
      do jn = 1,9<a name='13378'>
         do jt = 1,5<a name='13379'>
            do jp = 1,13<a name='13380'>
               iprsm = 0<a name='13381'>
               do igc = 1,ngc(16)<a name='13382'>
                  sumk = 0.<a name='13383'>
                  do ipr = 1, ngn(ngs(15)+igc)<a name='13384'>
                     iprsm = iprsm + 1<a name='13385'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+240)<a name='13386'>
                  enddo<a name='13387'>
                  ka(jn,jt,jp,igc) = sumk<a name='13388'>
               enddo<a name='13389'>
            enddo<a name='13390'>
         enddo<a name='13391'>
      enddo<a name='13392'>
<a name='13393'>
      do jt = 1,5<a name='13394'>
         do jp = 13,59<a name='13395'>
            iprsm = 0<a name='13396'>
            do igc = 1,ngc(16)<a name='13397'>
               sumk = 0.<a name='13398'>
               do ipr = 1, ngn(ngs(15)+igc)<a name='13399'>
                  iprsm = iprsm + 1<a name='13400'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+240)<a name='13401'>
               enddo<a name='13402'>
               kb(jt,jp,igc) = sumk<a name='13403'>
            enddo<a name='13404'>
         enddo<a name='13405'>
      enddo<a name='13406'>
<a name='13407'>
      do jt = 1,10<a name='13408'>
         iprsm = 0<a name='13409'>
         do igc = 1,ngc(16)<a name='13410'>
            sumk = 0.<a name='13411'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='13412'>
               iprsm = iprsm + 1<a name='13413'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+240)<a name='13414'>
            enddo<a name='13415'>
            selfref(jt,igc) = sumk<a name='13416'>
         enddo<a name='13417'>
      enddo<a name='13418'>
<a name='13419'>
      do jt = 1,4<a name='13420'>
         iprsm = 0<a name='13421'>
         do igc = 1,ngc(16)<a name='13422'>
            sumk = 0.<a name='13423'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='13424'>
               iprsm = iprsm + 1<a name='13425'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+240)<a name='13426'>
            enddo<a name='13427'>
            forref(jt,igc) = sumk<a name='13428'>
         enddo<a name='13429'>
      enddo<a name='13430'>
<a name='13431'>
      iprsm = 0<a name='13432'>
      do igc = 1,ngc(16)<a name='13433'>
         sumf = 0.<a name='13434'>
         do ipr = 1, ngn(ngs(15)+igc)<a name='13435'>
            iprsm = iprsm + 1<a name='13436'>
            sumf = sumf + fracrefbo(iprsm)<a name='13437'>
         enddo<a name='13438'>
         fracrefb(igc) = sumf<a name='13439'>
      enddo<a name='13440'>
<a name='13441'>
      do jp = 1,9<a name='13442'>
         iprsm = 0<a name='13443'>
         do igc = 1,ngc(16)<a name='13444'>
            sumf = 0.<a name='13445'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='13446'>
               iprsm = iprsm + 1<a name='13447'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='13448'>
            enddo<a name='13449'>
            fracrefa(igc,jp) = sumf<a name='13450'>
         enddo<a name='13451'>
      enddo<a name='13452'>
<a name='13453'>
      end subroutine cmbgb16<a name='13454'>
<a name='13455'>
<font color=#447700>!***************************************************************************<a name='13456'></font>
<A NAME='LWCLDPR'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCLDPR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13457'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwcldpr</font> <A href='../../call_to/LWCLDPR.html' TARGET='index'>2</A>,<A href='../../call_from/LWCLDPR.html' TARGET='index'>2</A><a name='13458'>
<font color=#447700>!***************************************************************************<a name='13459'></font>
<a name='13460'>
<font color=#447700>! --------- Modules ----------<a name='13461'></font>
<a name='13462'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CLD_F'>rrlw_cld_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCLDPR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CLD_F_2">, only: abscld1, absliq0, absliq1, &amp;<a name='13463'>
                          absice0, absice1, absice2, absice3<a name='13464'>
<a name='13465'>
      save<a name='13466'>
<a name='13467'>
<font color=#447700>! ABSCLDn is the liquid water absorption coefficient (m2/g). <a name='13468'></font>
<font color=#447700>! For INFLAG = 1.<a name='13469'></font>
      abscld1 = 0.0602410 <a name='13470'>
<font color=#447700>!  <a name='13471'></font>
<font color=#447700>! Everything below is for INFLAG = 2.<a name='13472'></font>
<a name='13473'>
<font color=#447700>! ABSICEn(J,IB) are the parameters needed to compute the liquid water <a name='13474'></font>
<font color=#447700>! absorption coefficient in spectral region IB for ICEFLAG=n.  The units<a name='13475'></font>
<font color=#447700>! of ABSICEn(1,IB) are m2/g and ABSICEn(2,IB) has units (microns (m2/g)).<a name='13476'></font>
<font color=#447700>! For ICEFLAG = 0.<a name='13477'></font>
<a name='13478'>
      absice0(:)= (/0.005 ,  1.0 /)<a name='13479'>
<a name='13480'>
<font color=#447700>! For ICEFLAG = 1.<a name='13481'></font>
      absice1(1,:) = (/0.0036 , 0.0068 , 0.0003 , 0.0016 , 0.0020 /)<a name='13482'>
      absice1(2,:) = (/1.136  , 0.600  , 1.338  , 1.166  , 1.118  /)<a name='13483'>
<a name='13484'>
<font color=#447700>! For ICEFLAG = 2.  In each band, the absorption<a name='13485'></font>
<font color=#447700>! coefficients are listed for a range of effective radii from 5.0<a name='13486'></font>
<font color=#447700>! to 131.0 microns in increments of 3.0 microns.<a name='13487'></font>
<font color=#447700>! Spherical Ice Particle Parameterization<a name='13488'></font>
<font color=#447700>! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]<a name='13489'></font>
      absice2(:,1) = (/ &amp;<a name='13490'>
<font color=#447700>! band 1<a name='13491'></font>
       7.798999e-02 ,6.340479e-02 ,5.417973e-02 ,4.766245e-02 ,4.272663e-02 , &amp;<a name='13492'>
       3.880939e-02 ,3.559544e-02 ,3.289241e-02 ,3.057511e-02 ,2.855800e-02 , &amp;<a name='13493'>
       2.678022e-02 ,2.519712e-02 ,2.377505e-02 ,2.248806e-02 ,2.131578e-02 , &amp;<a name='13494'>
       2.024194e-02 ,1.925337e-02 ,1.833926e-02 ,1.749067e-02 ,1.670007e-02 , &amp;<a name='13495'>
       1.596113e-02 ,1.526845e-02 ,1.461739e-02 ,1.400394e-02 ,1.342462e-02 , &amp;<a name='13496'>
       1.287639e-02 ,1.235656e-02 ,1.186279e-02 ,1.139297e-02 ,1.094524e-02 , &amp;<a name='13497'>
       1.051794e-02 ,1.010956e-02 ,9.718755e-03 ,9.344316e-03 ,8.985139e-03 , &amp;<a name='13498'>
       8.640223e-03 ,8.308656e-03 ,7.989606e-03 ,7.682312e-03 ,7.386076e-03 , &amp;<a name='13499'>
       7.100255e-03 ,6.824258e-03 ,6.557540e-03 /)<a name='13500'>
      absice2(:,2) = (/ &amp;<a name='13501'>
<font color=#447700>! band 2<a name='13502'></font>
       2.784879e-02 ,2.709863e-02 ,2.619165e-02 ,2.529230e-02 ,2.443225e-02 , &amp;<a name='13503'>
       2.361575e-02 ,2.284021e-02 ,2.210150e-02 ,2.139548e-02 ,2.071840e-02 , &amp;<a name='13504'>
       2.006702e-02 ,1.943856e-02 ,1.883064e-02 ,1.824120e-02 ,1.766849e-02 , &amp;<a name='13505'>
       1.711099e-02 ,1.656737e-02 ,1.603647e-02 ,1.551727e-02 ,1.500886e-02 , &amp;<a name='13506'>
       1.451045e-02 ,1.402132e-02 ,1.354084e-02 ,1.306842e-02 ,1.260355e-02 , &amp;<a name='13507'>
       1.214575e-02 ,1.169460e-02 ,1.124971e-02 ,1.081072e-02 ,1.037731e-02 , &amp;<a name='13508'>
       9.949167e-03 ,9.526021e-03 ,9.107615e-03 ,8.693714e-03 ,8.284096e-03 , &amp;<a name='13509'>
       7.878558e-03 ,7.476910e-03 ,7.078974e-03 ,6.684586e-03 ,6.293589e-03 , &amp;<a name='13510'>
       5.905839e-03 ,5.521200e-03 ,5.139543e-03 /)<a name='13511'>
      absice2(:,3) = (/ &amp;<a name='13512'>
<font color=#447700>! band 3<a name='13513'></font>
       1.065397e-01 ,8.005726e-02 ,6.546428e-02 ,5.589131e-02 ,4.898681e-02 , &amp;<a name='13514'>
       4.369932e-02 ,3.947901e-02 ,3.600676e-02 ,3.308299e-02 ,3.057561e-02 , &amp;<a name='13515'>
       2.839325e-02 ,2.647040e-02 ,2.475872e-02 ,2.322164e-02 ,2.183091e-02 , &amp;<a name='13516'>
       2.056430e-02 ,1.940407e-02 ,1.833586e-02 ,1.734787e-02 ,1.643034e-02 , &amp;<a name='13517'>
       1.557512e-02 ,1.477530e-02 ,1.402501e-02 ,1.331924e-02 ,1.265364e-02 , &amp;<a name='13518'>
       1.202445e-02 ,1.142838e-02 ,1.086257e-02 ,1.032445e-02 ,9.811791e-03 , &amp;<a name='13519'>
       9.322587e-03 ,8.855053e-03 ,8.407591e-03 ,7.978763e-03 ,7.567273e-03 , &amp;<a name='13520'>
       7.171949e-03 ,6.791728e-03 ,6.425642e-03 ,6.072809e-03 ,5.732424e-03 , &amp;<a name='13521'>
       5.403748e-03 ,5.086103e-03 ,4.778865e-03 /)<a name='13522'>
      absice2(:,4) = (/ &amp;<a name='13523'>
<font color=#447700>! band 4<a name='13524'></font>
       1.804566e-01 ,1.168987e-01 ,8.680442e-02 ,6.910060e-02 ,5.738174e-02 , &amp;<a name='13525'>
       4.902332e-02 ,4.274585e-02 ,3.784923e-02 ,3.391734e-02 ,3.068690e-02 , &amp;<a name='13526'>
       2.798301e-02 ,2.568480e-02 ,2.370600e-02 ,2.198337e-02 ,2.046940e-02 , &amp;<a name='13527'>
       1.912777e-02 ,1.793016e-02 ,1.685420e-02 ,1.588193e-02 ,1.499882e-02 , &amp;<a name='13528'>
       1.419293e-02 ,1.345440e-02 ,1.277496e-02 ,1.214769e-02 ,1.156669e-02 , &amp;<a name='13529'>
       1.102694e-02 ,1.052412e-02 ,1.005451e-02 ,9.614854e-03 ,9.202335e-03 , &amp;<a name='13530'>
       8.814470e-03 ,8.449077e-03 ,8.104223e-03 ,7.778195e-03 ,7.469466e-03 , &amp;<a name='13531'>
       7.176671e-03 ,6.898588e-03 ,6.634117e-03 ,6.382264e-03 ,6.142134e-03 , &amp;<a name='13532'>
       5.912913e-03 ,5.693862e-03 ,5.484308e-03 /)<a name='13533'>
      absice2(:,5) = (/ &amp;<a name='13534'>
<font color=#447700>! band 5<a name='13535'></font>
       2.131806e-01 ,1.311372e-01 ,9.407171e-02 ,7.299442e-02 ,5.941273e-02 , &amp;<a name='13536'>
       4.994043e-02 ,4.296242e-02 ,3.761113e-02 ,3.337910e-02 ,2.994978e-02 , &amp;<a name='13537'>
       2.711556e-02 ,2.473461e-02 ,2.270681e-02 ,2.095943e-02 ,1.943839e-02 , &amp;<a name='13538'>
       1.810267e-02 ,1.692057e-02 ,1.586719e-02 ,1.492275e-02 ,1.407132e-02 , &amp;<a name='13539'>
       1.329989e-02 ,1.259780e-02 ,1.195618e-02 ,1.136761e-02 ,1.082583e-02 , &amp;<a name='13540'>
       1.032552e-02 ,9.862158e-03 ,9.431827e-03 ,9.031157e-03 ,8.657217e-03 , &amp;<a name='13541'>
       8.307449e-03 ,7.979609e-03 ,7.671724e-03 ,7.382048e-03 ,7.109032e-03 , &amp;<a name='13542'>
       6.851298e-03 ,6.607615e-03 ,6.376881e-03 ,6.158105e-03 ,5.950394e-03 , &amp;<a name='13543'>
       5.752942e-03 ,5.565019e-03 ,5.385963e-03 /)<a name='13544'>
      absice2(:,6) = (/ &amp;<a name='13545'>
<font color=#447700>! band 6<a name='13546'></font>
       1.546177e-01 ,1.039251e-01 ,7.910347e-02 ,6.412429e-02 ,5.399997e-02 , &amp;<a name='13547'>
       4.664937e-02 ,4.104237e-02 ,3.660781e-02 ,3.300218e-02 ,3.000586e-02 , &amp;<a name='13548'>
       2.747148e-02 ,2.529633e-02 ,2.340647e-02 ,2.174723e-02 ,2.027731e-02 , &amp;<a name='13549'>
       1.896487e-02 ,1.778492e-02 ,1.671761e-02 ,1.574692e-02 ,1.485978e-02 , &amp;<a name='13550'>
       1.404543e-02 ,1.329489e-02 ,1.260066e-02 ,1.195636e-02 ,1.135657e-02 , &amp;<a name='13551'>
       1.079664e-02 ,1.027257e-02 ,9.780871e-03 ,9.318505e-03 ,8.882815e-03 , &amp;<a name='13552'>
       8.471458e-03 ,8.082364e-03 ,7.713696e-03 ,7.363817e-03 ,7.031264e-03 , &amp;<a name='13553'>
       6.714725e-03 ,6.413021e-03 ,6.125086e-03 ,5.849958e-03 ,5.586764e-03 , &amp;<a name='13554'>
       5.334707e-03 ,5.093066e-03 ,4.861179e-03 /)<a name='13555'>
      absice2(:,7) = (/ &amp;<a name='13556'>
<font color=#447700>! band 7<a name='13557'></font>
       7.583404e-02 ,6.181558e-02 ,5.312027e-02 ,4.696039e-02 ,4.225986e-02 , &amp;<a name='13558'>
       3.849735e-02 ,3.538340e-02 ,3.274182e-02 ,3.045798e-02 ,2.845343e-02 , &amp;<a name='13559'>
       2.667231e-02 ,2.507353e-02 ,2.362606e-02 ,2.230595e-02 ,2.109435e-02 , &amp;<a name='13560'>
       1.997617e-02 ,1.893916e-02 ,1.797328e-02 ,1.707016e-02 ,1.622279e-02 , &amp;<a name='13561'>
       1.542523e-02 ,1.467241e-02 ,1.395997e-02 ,1.328414e-02 ,1.264164e-02 , &amp;<a name='13562'>
       1.202958e-02 ,1.144544e-02 ,1.088697e-02 ,1.035218e-02 ,9.839297e-03 , &amp;<a name='13563'>
       9.346733e-03 ,8.873057e-03 ,8.416980e-03 ,7.977335e-03 ,7.553066e-03 , &amp;<a name='13564'>
       7.143210e-03 ,6.746888e-03 ,6.363297e-03 ,5.991700e-03 ,5.631422e-03 , &amp;<a name='13565'>
       5.281840e-03 ,4.942378e-03 ,4.612505e-03 /)<a name='13566'>
      absice2(:,8) = (/ &amp;<a name='13567'>
<font color=#447700>! band 8<a name='13568'></font>
       9.022185e-02 ,6.922700e-02 ,5.710674e-02 ,4.898377e-02 ,4.305946e-02 , &amp;<a name='13569'>
       3.849553e-02 ,3.484183e-02 ,3.183220e-02 ,2.929794e-02 ,2.712627e-02 , &amp;<a name='13570'>
       2.523856e-02 ,2.357810e-02 ,2.210286e-02 ,2.078089e-02 ,1.958747e-02 , &amp;<a name='13571'>
       1.850310e-02 ,1.751218e-02 ,1.660205e-02 ,1.576232e-02 ,1.498440e-02 , &amp;<a name='13572'>
       1.426107e-02 ,1.358624e-02 ,1.295474e-02 ,1.236212e-02 ,1.180456e-02 , &amp;<a name='13573'>
       1.127874e-02 ,1.078175e-02 ,1.031106e-02 ,9.864433e-03 ,9.439878e-03 , &amp;<a name='13574'>
       9.035637e-03 ,8.650140e-03 ,8.281981e-03 ,7.929895e-03 ,7.592746e-03 , &amp;<a name='13575'>
       7.269505e-03 ,6.959238e-03 ,6.661100e-03 ,6.374317e-03 ,6.098185e-03 , &amp;<a name='13576'>
       5.832059e-03 ,5.575347e-03 ,5.327504e-03 /)<a name='13577'>
      absice2(:,9) = (/ &amp;<a name='13578'>
<font color=#447700>! band 9<a name='13579'></font>
       1.294087e-01 ,8.788217e-02 ,6.728288e-02 ,5.479720e-02 ,4.635049e-02 , &amp;<a name='13580'>
       4.022253e-02 ,3.555576e-02 ,3.187259e-02 ,2.888498e-02 ,2.640843e-02 , &amp;<a name='13581'>
       2.431904e-02 ,2.253038e-02 ,2.098024e-02 ,1.962267e-02 ,1.842293e-02 , &amp;<a name='13582'>
       1.735426e-02 ,1.639571e-02 ,1.553060e-02 ,1.474552e-02 ,1.402953e-02 , &amp;<a name='13583'>
       1.337363e-02 ,1.277033e-02 ,1.221336e-02 ,1.169741e-02 ,1.121797e-02 , &amp;<a name='13584'>
       1.077117e-02 ,1.035369e-02 ,9.962643e-03 ,9.595509e-03 ,9.250088e-03 , &amp;<a name='13585'>
       8.924447e-03 ,8.616876e-03 ,8.325862e-03 ,8.050057e-03 ,7.788258e-03 , &amp;<a name='13586'>
       7.539388e-03 ,7.302478e-03 ,7.076656e-03 ,6.861134e-03 ,6.655197e-03 , &amp;<a name='13587'>
       6.458197e-03 ,6.269543e-03 ,6.088697e-03 /)<a name='13588'>
      absice2(:,10) = (/ &amp;<a name='13589'>
<font color=#447700>! band 10<a name='13590'></font>
       1.593628e-01 ,1.014552e-01 ,7.458955e-02 ,5.903571e-02 ,4.887582e-02 , &amp;<a name='13591'>
       4.171159e-02 ,3.638480e-02 ,3.226692e-02 ,2.898717e-02 ,2.631256e-02 , &amp;<a name='13592'>
       2.408925e-02 ,2.221156e-02 ,2.060448e-02 ,1.921325e-02 ,1.799699e-02 , &amp;<a name='13593'>
       1.692456e-02 ,1.597177e-02 ,1.511961e-02 ,1.435289e-02 ,1.365933e-02 , &amp;<a name='13594'>
       1.302890e-02 ,1.245334e-02 ,1.192576e-02 ,1.144037e-02 ,1.099230e-02 , &amp;<a name='13595'>
       1.057739e-02 ,1.019208e-02 ,9.833302e-03 ,9.498395e-03 ,9.185047e-03 , &amp;<a name='13596'>
       8.891237e-03 ,8.615185e-03 ,8.355325e-03 ,8.110267e-03 ,7.878778e-03 , &amp;<a name='13597'>
       7.659759e-03 ,7.452224e-03 ,7.255291e-03 ,7.068166e-03 ,6.890130e-03 , &amp;<a name='13598'>
       6.720536e-03 ,6.558794e-03 ,6.404371e-03 /)<a name='13599'>
      absice2(:,11) = (/ &amp;<a name='13600'>
<font color=#447700>! band 11<a name='13601'></font>
       1.656227e-01 ,1.032129e-01 ,7.487359e-02 ,5.871431e-02 ,4.828355e-02 , &amp;<a name='13602'>
       4.099989e-02 ,3.562924e-02 ,3.150755e-02 ,2.824593e-02 ,2.560156e-02 , &amp;<a name='13603'>
       2.341503e-02 ,2.157740e-02 ,2.001169e-02 ,1.866199e-02 ,1.748669e-02 , &amp;<a name='13604'>
       1.645421e-02 ,1.554015e-02 ,1.472535e-02 ,1.399457e-02 ,1.333553e-02 , &amp;<a name='13605'>
       1.273821e-02 ,1.219440e-02 ,1.169725e-02 ,1.124104e-02 ,1.082096e-02 , &amp;<a name='13606'>
       1.043290e-02 ,1.007336e-02 ,9.739338e-03 ,9.428223e-03 ,9.137756e-03 , &amp;<a name='13607'>
       8.865964e-03 ,8.611115e-03 ,8.371686e-03 ,8.146330e-03 ,7.933852e-03 , &amp;<a name='13608'>
       7.733187e-03 ,7.543386e-03 ,7.363597e-03 ,7.193056e-03 ,7.031072e-03 , &amp;<a name='13609'>
       6.877024e-03 ,6.730348e-03 ,6.590531e-03 /)<a name='13610'>
      absice2(:,12) = (/ &amp;<a name='13611'>
<font color=#447700>! band 12<a name='13612'></font>
       9.194591e-02 ,6.446867e-02 ,4.962034e-02 ,4.042061e-02 ,3.418456e-02 , &amp;<a name='13613'>
       2.968856e-02 ,2.629900e-02 ,2.365572e-02 ,2.153915e-02 ,1.980791e-02 , &amp;<a name='13614'>
       1.836689e-02 ,1.714979e-02 ,1.610900e-02 ,1.520946e-02 ,1.442476e-02 , &amp;<a name='13615'>
       1.373468e-02 ,1.312345e-02 ,1.257858e-02 ,1.209010e-02 ,1.164990e-02 , &amp;<a name='13616'>
       1.125136e-02 ,1.088901e-02 ,1.055827e-02 ,1.025531e-02 ,9.976896e-03 , &amp;<a name='13617'>
       9.720255e-03 ,9.483022e-03 ,9.263160e-03 ,9.058902e-03 ,8.868710e-03 , &amp;<a name='13618'>
       8.691240e-03 ,8.525312e-03 ,8.369886e-03 ,8.224042e-03 ,8.086961e-03 , &amp;<a name='13619'>
       7.957917e-03 ,7.836258e-03 ,7.721400e-03 ,7.612821e-03 ,7.510045e-03 , &amp;<a name='13620'>
       7.412648e-03 ,7.320242e-03 ,7.232476e-03 /)<a name='13621'>
      absice2(:,13) = (/ &amp;<a name='13622'>
<font color=#447700>! band 13<a name='13623'></font>
       1.437021e-01 ,8.872535e-02 ,6.392420e-02 ,4.991833e-02 ,4.096790e-02 , &amp;<a name='13624'>
       3.477881e-02 ,3.025782e-02 ,2.681909e-02 ,2.412102e-02 ,2.195132e-02 , &amp;<a name='13625'>
       2.017124e-02 ,1.868641e-02 ,1.743044e-02 ,1.635529e-02 ,1.542540e-02 , &amp;<a name='13626'>
       1.461388e-02 ,1.390003e-02 ,1.326766e-02 ,1.270395e-02 ,1.219860e-02 , &amp;<a name='13627'>
       1.174326e-02 ,1.133107e-02 ,1.095637e-02 ,1.061442e-02 ,1.030126e-02 , &amp;<a name='13628'>
       1.001352e-02 ,9.748340e-03 ,9.503256e-03 ,9.276155e-03 ,9.065205e-03 , &amp;<a name='13629'>
       8.868808e-03 ,8.685571e-03 ,8.514268e-03 ,8.353820e-03 ,8.203272e-03 , &amp;<a name='13630'>
       8.061776e-03 ,7.928578e-03 ,7.803001e-03 ,7.684443e-03 ,7.572358e-03 , &amp;<a name='13631'>
       7.466258e-03 ,7.365701e-03 ,7.270286e-03 /)<a name='13632'>
      absice2(:,14) = (/ &amp;<a name='13633'>
<font color=#447700>! band 14<a name='13634'></font>
       1.288870e-01 ,8.160295e-02 ,5.964745e-02 ,4.703790e-02 ,3.888637e-02 , &amp;<a name='13635'>
       3.320115e-02 ,2.902017e-02 ,2.582259e-02 ,2.330224e-02 ,2.126754e-02 , &amp;<a name='13636'>
       1.959258e-02 ,1.819130e-02 ,1.700289e-02 ,1.598320e-02 ,1.509942e-02 , &amp;<a name='13637'>
       1.432666e-02 ,1.364572e-02 ,1.304156e-02 ,1.250220e-02 ,1.201803e-02 , &amp;<a name='13638'>
       1.158123e-02 ,1.118537e-02 ,1.082513e-02 ,1.049605e-02 ,1.019440e-02 , &amp;<a name='13639'>
       9.916989e-03 ,9.661116e-03 ,9.424457e-03 ,9.205005e-03 ,9.001022e-03 , &amp;<a name='13640'>
       8.810992e-03 ,8.633588e-03 ,8.467646e-03 ,8.312137e-03 ,8.166151e-03 , &amp;<a name='13641'>
       8.028878e-03 ,7.899597e-03 ,7.777663e-03 ,7.662498e-03 ,7.553581e-03 , &amp;<a name='13642'>
       7.450444e-03 ,7.352662e-03 ,7.259851e-03 /)<a name='13643'>
      absice2(:,15) = (/ &amp;<a name='13644'>
<font color=#447700>! band 15<a name='13645'></font>
       8.254229e-02 ,5.808787e-02 ,4.492166e-02 ,3.675028e-02 ,3.119623e-02 , &amp;<a name='13646'>
       2.718045e-02 ,2.414450e-02 ,2.177073e-02 ,1.986526e-02 ,1.830306e-02 , &amp;<a name='13647'>
       1.699991e-02 ,1.589698e-02 ,1.495199e-02 ,1.413374e-02 ,1.341870e-02 , &amp;<a name='13648'>
       1.278883e-02 ,1.223002e-02 ,1.173114e-02 ,1.128322e-02 ,1.087900e-02 , &amp;<a name='13649'>
       1.051254e-02 ,1.017890e-02 ,9.873991e-03 ,9.594347e-03 ,9.337044e-03 , &amp;<a name='13650'>
       9.099589e-03 ,8.879842e-03 ,8.675960e-03 ,8.486341e-03 ,8.309594e-03 , &amp;<a name='13651'>
       8.144500e-03 ,7.989986e-03 ,7.845109e-03 ,7.709031e-03 ,7.581007e-03 , &amp;<a name='13652'>
       7.460376e-03 ,7.346544e-03 ,7.238978e-03 ,7.137201e-03 ,7.040780e-03 , &amp;<a name='13653'>
       6.949325e-03 ,6.862483e-03 ,6.779931e-03 /)<a name='13654'>
      absice2(:,16) = (/ &amp;<a name='13655'>
<font color=#447700>! band 16<a name='13656'></font>
       1.382062e-01 ,8.643227e-02 ,6.282935e-02 ,4.934783e-02 ,4.063891e-02 , &amp;<a name='13657'>
       3.455591e-02 ,3.007059e-02 ,2.662897e-02 ,2.390631e-02 ,2.169972e-02 , &amp;<a name='13658'>
       1.987596e-02 ,1.834393e-02 ,1.703924e-02 ,1.591513e-02 ,1.493679e-02 , &amp;<a name='13659'>
       1.407780e-02 ,1.331775e-02 ,1.264061e-02 ,1.203364e-02 ,1.148655e-02 , &amp;<a name='13660'>
       1.099099e-02 ,1.054006e-02 ,1.012807e-02 ,9.750215e-03 ,9.402477e-03 , &amp;<a name='13661'>
       9.081428e-03 ,8.784143e-03 ,8.508107e-03 ,8.251146e-03 ,8.011373e-03 , &amp;<a name='13662'>
       7.787140e-03 ,7.577002e-03 ,7.379687e-03 ,7.194071e-03 ,7.019158e-03 , &amp;<a name='13663'>
       6.854061e-03 ,6.697986e-03 ,6.550224e-03 ,6.410138e-03 ,6.277153e-03 , &amp;<a name='13664'>
       6.150751e-03 ,6.030462e-03 ,5.915860e-03 /)<a name='13665'>
<a name='13666'>
<font color=#447700>! ICEFLAG = 3; Fu parameterization. Particle size 5 - 140 micron in <a name='13667'></font>
<font color=#447700>! increments of 3 microns.<a name='13668'></font>
<font color=#447700>! units = m2/g<a name='13669'></font>
<font color=#447700>! Hexagonal Ice Particle Parameterization<a name='13670'></font>
<font color=#447700>! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]<a name='13671'></font>
      absice3(:,1) = (/ &amp;<a name='13672'>
<font color=#447700>! band 1<a name='13673'></font>
       3.110649e-03 ,4.666352e-02 ,6.606447e-02 ,6.531678e-02 ,6.012598e-02 , &amp;<a name='13674'>
       5.437494e-02 ,4.906411e-02 ,4.441146e-02 ,4.040585e-02 ,3.697334e-02 , &amp;<a name='13675'>
       3.403027e-02 ,3.149979e-02 ,2.931596e-02 ,2.742365e-02 ,2.577721e-02 , &amp;<a name='13676'>
       2.433888e-02 ,2.307732e-02 ,2.196644e-02 ,2.098437e-02 ,2.011264e-02 , &amp;<a name='13677'>
       1.933561e-02 ,1.863992e-02 ,1.801407e-02 ,1.744812e-02 ,1.693346e-02 , &amp;<a name='13678'>
       1.646252e-02 ,1.602866e-02 ,1.562600e-02 ,1.524933e-02 ,1.489399e-02 , &amp;<a name='13679'>
       1.455580e-02 ,1.423098e-02 ,1.391612e-02 ,1.360812e-02 ,1.330413e-02 , &amp;<a name='13680'>
       1.300156e-02 ,1.269801e-02 ,1.239127e-02 ,1.207928e-02 ,1.176014e-02 , &amp;<a name='13681'>
       1.143204e-02 ,1.109334e-02 ,1.074243e-02 ,1.037786e-02 ,9.998198e-03 , &amp;<a name='13682'>
       9.602126e-03 /)<a name='13683'>
      absice3(:,2) = (/ &amp;<a name='13684'>
<font color=#447700>! band 2<a name='13685'></font>
       3.984966e-04 ,1.681097e-02 ,2.627680e-02 ,2.767465e-02 ,2.700722e-02 , &amp;<a name='13686'>
       2.579180e-02 ,2.448677e-02 ,2.323890e-02 ,2.209096e-02 ,2.104882e-02 , &amp;<a name='13687'>
       2.010547e-02 ,1.925003e-02 ,1.847128e-02 ,1.775883e-02 ,1.710358e-02 , &amp;<a name='13688'>
       1.649769e-02 ,1.593449e-02 ,1.540829e-02 ,1.491429e-02 ,1.444837e-02 , &amp;<a name='13689'>
       1.400704e-02 ,1.358729e-02 ,1.318654e-02 ,1.280258e-02 ,1.243346e-02 , &amp;<a name='13690'>
       1.207750e-02 ,1.173325e-02 ,1.139941e-02 ,1.107487e-02 ,1.075861e-02 , &amp;<a name='13691'>
       1.044975e-02 ,1.014753e-02 ,9.851229e-03 ,9.560240e-03 ,9.274003e-03 , &amp;<a name='13692'>
       8.992020e-03 ,8.713845e-03 ,8.439074e-03 ,8.167346e-03 ,7.898331e-03 , &amp;<a name='13693'>
       7.631734e-03 ,7.367286e-03 ,7.104742e-03 ,6.843882e-03 ,6.584504e-03 , &amp;<a name='13694'>
       6.326424e-03 /)<a name='13695'>
      absice3(:,3) = (/ &amp;<a name='13696'>
<font color=#447700>! band 3<a name='13697'></font>
       6.933163e-02 ,8.540475e-02 ,7.701816e-02 ,6.771158e-02 ,5.986953e-02 , &amp;<a name='13698'>
       5.348120e-02 ,4.824962e-02 ,4.390563e-02 ,4.024411e-02 ,3.711404e-02 , &amp;<a name='13699'>
       3.440426e-02 ,3.203200e-02 ,2.993478e-02 ,2.806474e-02 ,2.638464e-02 , &amp;<a name='13700'>
       2.486516e-02 ,2.348288e-02 ,2.221890e-02 ,2.105780e-02 ,1.998687e-02 , &amp;<a name='13701'>
       1.899552e-02 ,1.807490e-02 ,1.721750e-02 ,1.641693e-02 ,1.566773e-02 , &amp;<a name='13702'>
       1.496515e-02 ,1.430509e-02 ,1.368398e-02 ,1.309865e-02 ,1.254634e-02 , &amp;<a name='13703'>
       1.202456e-02 ,1.153114e-02 ,1.106409e-02 ,1.062166e-02 ,1.020224e-02 , &amp;<a name='13704'>
       9.804381e-03 ,9.426771e-03 ,9.068205e-03 ,8.727578e-03 ,8.403876e-03 , &amp;<a name='13705'>
       8.096160e-03 ,7.803564e-03 ,7.525281e-03 ,7.260560e-03 ,7.008697e-03 , &amp;<a name='13706'>
       6.769036e-03 /)<a name='13707'>
      absice3(:,4) = (/ &amp;<a name='13708'>
<font color=#447700>! band 4<a name='13709'></font>
       1.765735e-01 ,1.382700e-01 ,1.095129e-01 ,8.987475e-02 ,7.591185e-02 , &amp;<a name='13710'>
       6.554169e-02 ,5.755500e-02 ,5.122083e-02 ,4.607610e-02 ,4.181475e-02 , &amp;<a name='13711'>
       3.822697e-02 ,3.516432e-02 ,3.251897e-02 ,3.021073e-02 ,2.817876e-02 , &amp;<a name='13712'>
       2.637607e-02 ,2.476582e-02 ,2.331871e-02 ,2.201113e-02 ,2.082388e-02 , &amp;<a name='13713'>
       1.974115e-02 ,1.874983e-02 ,1.783894e-02 ,1.699922e-02 ,1.622280e-02 , &amp;<a name='13714'>
       1.550296e-02 ,1.483390e-02 ,1.421064e-02 ,1.362880e-02 ,1.308460e-02 , &amp;<a name='13715'>
       1.257468e-02 ,1.209611e-02 ,1.164628e-02 ,1.122287e-02 ,1.082381e-02 , &amp;<a name='13716'>
       1.044725e-02 ,1.009154e-02 ,9.755166e-03 ,9.436783e-03 ,9.135163e-03 , &amp;<a name='13717'>
       8.849193e-03 ,8.577856e-03 ,8.320225e-03 ,8.075451e-03 ,7.842755e-03 , &amp;<a name='13718'>
       7.621418e-03 /)<a name='13719'>
      absice3(:,5) = (/ &amp;<a name='13720'>
<font color=#447700>! band 5<a name='13721'></font>
       2.339673e-01 ,1.692124e-01 ,1.291656e-01 ,1.033837e-01 ,8.562949e-02 , &amp;<a name='13722'>
       7.273526e-02 ,6.298262e-02 ,5.537015e-02 ,4.927787e-02 ,4.430246e-02 , &amp;<a name='13723'>
       4.017061e-02 ,3.669072e-02 ,3.372455e-02 ,3.116995e-02 ,2.894977e-02 , &amp;<a name='13724'>
       2.700471e-02 ,2.528842e-02 ,2.376420e-02 ,2.240256e-02 ,2.117959e-02 , &amp;<a name='13725'>
       2.007567e-02 ,1.907456e-02 ,1.816271e-02 ,1.732874e-02 ,1.656300e-02 , &amp;<a name='13726'>
       1.585725e-02 ,1.520445e-02 ,1.459852e-02 ,1.403419e-02 ,1.350689e-02 , &amp;<a name='13727'>
       1.301260e-02 ,1.254781e-02 ,1.210941e-02 ,1.169468e-02 ,1.130118e-02 , &amp;<a name='13728'>
       1.092675e-02 ,1.056945e-02 ,1.022757e-02 ,9.899560e-03 ,9.584021e-03 , &amp;<a name='13729'>
       9.279705e-03 ,8.985479e-03 ,8.700322e-03 ,8.423306e-03 ,8.153590e-03 , &amp;<a name='13730'>
       7.890412e-03 /)<a name='13731'>
      absice3(:,6) = (/ &amp;<a name='13732'>
<font color=#447700>! band 6<a name='13733'></font>
       1.145369e-01 ,1.174566e-01 ,9.917866e-02 ,8.332990e-02 ,7.104263e-02 , &amp;<a name='13734'>
       6.153370e-02 ,5.405472e-02 ,4.806281e-02 ,4.317918e-02 ,3.913795e-02 , &amp;<a name='13735'>
       3.574916e-02 ,3.287437e-02 ,3.041067e-02 ,2.828017e-02 ,2.642292e-02 , &amp;<a name='13736'>
       2.479206e-02 ,2.335051e-02 ,2.206851e-02 ,2.092195e-02 ,1.989108e-02 , &amp;<a name='13737'>
       1.895958e-02 ,1.811385e-02 ,1.734245e-02 ,1.663573e-02 ,1.598545e-02 , &amp;<a name='13738'>
       1.538456e-02 ,1.482700e-02 ,1.430750e-02 ,1.382150e-02 ,1.336499e-02 , &amp;<a name='13739'>
       1.293447e-02 ,1.252685e-02 ,1.213939e-02 ,1.176968e-02 ,1.141555e-02 , &amp;<a name='13740'>
       1.107508e-02 ,1.074655e-02 ,1.042839e-02 ,1.011923e-02 ,9.817799e-03 , &amp;<a name='13741'>
       9.522962e-03 ,9.233688e-03 ,8.949041e-03 ,8.668171e-03 ,8.390301e-03 , &amp;<a name='13742'>
       8.114723e-03 /)<a name='13743'>
      absice3(:,7) = (/ &amp;<a name='13744'>
<font color=#447700>! band 7<a name='13745'></font>
       1.222345e-02 ,5.344230e-02 ,5.523465e-02 ,5.128759e-02 ,4.676925e-02 , &amp;<a name='13746'>
       4.266150e-02 ,3.910561e-02 ,3.605479e-02 ,3.342843e-02 ,3.115052e-02 , &amp;<a name='13747'>
       2.915776e-02 ,2.739935e-02 ,2.583499e-02 ,2.443266e-02 ,2.316681e-02 , &amp;<a name='13748'>
       2.201687e-02 ,2.096619e-02 ,2.000112e-02 ,1.911044e-02 ,1.828481e-02 , &amp;<a name='13749'>
       1.751641e-02 ,1.679866e-02 ,1.612598e-02 ,1.549360e-02 ,1.489742e-02 , &amp;<a name='13750'>
       1.433392e-02 ,1.380002e-02 ,1.329305e-02 ,1.281068e-02 ,1.235084e-02 , &amp;<a name='13751'>
       1.191172e-02 ,1.149171e-02 ,1.108936e-02 ,1.070341e-02 ,1.033271e-02 , &amp;<a name='13752'>
       9.976220e-03 ,9.633021e-03 ,9.302273e-03 ,8.983216e-03 ,8.675161e-03 , &amp;<a name='13753'>
       8.377478e-03 ,8.089595e-03 ,7.810986e-03 ,7.541170e-03 ,7.279706e-03 , &amp;<a name='13754'>
       7.026186e-03 /)<a name='13755'>
      absice3(:,8) = (/ &amp;<a name='13756'>
<font color=#447700>! band 8<a name='13757'></font>
       6.711058e-02 ,6.918198e-02 ,6.127484e-02 ,5.411944e-02 ,4.836902e-02 , &amp;<a name='13758'>
       4.375293e-02 ,3.998077e-02 ,3.683587e-02 ,3.416508e-02 ,3.186003e-02 , &amp;<a name='13759'>
       2.984290e-02 ,2.805671e-02 ,2.645895e-02 ,2.501733e-02 ,2.370689e-02 , &amp;<a name='13760'>
       2.250808e-02 ,2.140532e-02 ,2.038609e-02 ,1.944018e-02 ,1.855918e-02 , &amp;<a name='13761'>
       1.773609e-02 ,1.696504e-02 ,1.624106e-02 ,1.555990e-02 ,1.491793e-02 , &amp;<a name='13762'>
       1.431197e-02 ,1.373928e-02 ,1.319743e-02 ,1.268430e-02 ,1.219799e-02 , &amp;<a name='13763'>
       1.173682e-02 ,1.129925e-02 ,1.088393e-02 ,1.048961e-02 ,1.011516e-02 , &amp;<a name='13764'>
       9.759543e-03 ,9.421813e-03 ,9.101089e-03 ,8.796559e-03 ,8.507464e-03 , &amp;<a name='13765'>
       8.233098e-03 ,7.972798e-03 ,7.725942e-03 ,7.491940e-03 ,7.270238e-03 , &amp;<a name='13766'>
       7.060305e-03 /)<a name='13767'>
      absice3(:,9) = (/ &amp;<a name='13768'>
<font color=#447700>! band 9<a name='13769'></font>
       1.236780e-01 ,9.222386e-02 ,7.383997e-02 ,6.204072e-02 ,5.381029e-02 , &amp;<a name='13770'>
       4.770678e-02 ,4.296928e-02 ,3.916131e-02 ,3.601540e-02 ,3.335878e-02 , &amp;<a name='13771'>
       3.107493e-02 ,2.908247e-02 ,2.732282e-02 ,2.575276e-02 ,2.433968e-02 , &amp;<a name='13772'>
       2.305852e-02 ,2.188966e-02 ,2.081757e-02 ,1.982974e-02 ,1.891599e-02 , &amp;<a name='13773'>
       1.806794e-02 ,1.727865e-02 ,1.654227e-02 ,1.585387e-02 ,1.520924e-02 , &amp;<a name='13774'>
       1.460476e-02 ,1.403730e-02 ,1.350416e-02 ,1.300293e-02 ,1.253153e-02 , &amp;<a name='13775'>
       1.208808e-02 ,1.167094e-02 ,1.127862e-02 ,1.090979e-02 ,1.056323e-02 , &amp;<a name='13776'>
       1.023786e-02 ,9.932665e-03 ,9.646744e-03 ,9.379250e-03 ,9.129409e-03 , &amp;<a name='13777'>
       8.896500e-03 ,8.679856e-03 ,8.478852e-03 ,8.292904e-03 ,8.121463e-03 , &amp;<a name='13778'>
       7.964013e-03 /)<a name='13779'>
      absice3(:,10) = (/ &amp;<a name='13780'>
<font color=#447700>! band 10<a name='13781'></font>
       1.655966e-01 ,1.134205e-01 ,8.714344e-02 ,7.129241e-02 ,6.063739e-02 , &amp;<a name='13782'>
       5.294203e-02 ,4.709309e-02 ,4.247476e-02 ,3.871892e-02 ,3.559206e-02 , &amp;<a name='13783'>
       3.293893e-02 ,3.065226e-02 ,2.865558e-02 ,2.689288e-02 ,2.532221e-02 , &amp;<a name='13784'>
       2.391150e-02 ,2.263582e-02 ,2.147549e-02 ,2.041476e-02 ,1.944089e-02 , &amp;<a name='13785'>
       1.854342e-02 ,1.771371e-02 ,1.694456e-02 ,1.622989e-02 ,1.556456e-02 , &amp;<a name='13786'>
       1.494415e-02 ,1.436491e-02 ,1.382354e-02 ,1.331719e-02 ,1.284339e-02 , &amp;<a name='13787'>
       1.239992e-02 ,1.198486e-02 ,1.159647e-02 ,1.123323e-02 ,1.089375e-02 , &amp;<a name='13788'>
       1.057679e-02 ,1.028124e-02 ,1.000607e-02 ,9.750376e-03 ,9.513303e-03 , &amp;<a name='13789'>
       9.294082e-03 ,9.092003e-03 ,8.906412e-03 ,8.736702e-03 ,8.582314e-03 , &amp;<a name='13790'>
       8.442725e-03 /)<a name='13791'>
      absice3(:,11) = (/ &amp;<a name='13792'>
<font color=#447700>! band 11<a name='13793'></font>
       1.775615e-01 ,1.180046e-01 ,8.929607e-02 ,7.233500e-02 ,6.108333e-02 , &amp;<a name='13794'>
       5.303642e-02 ,4.696927e-02 ,4.221206e-02 ,3.836768e-02 ,3.518576e-02 , &amp;<a name='13795'>
       3.250063e-02 ,3.019825e-02 ,2.819758e-02 ,2.643943e-02 ,2.487953e-02 , &amp;<a name='13796'>
       2.348414e-02 ,2.222705e-02 ,2.108762e-02 ,2.004936e-02 ,1.909892e-02 , &amp;<a name='13797'>
       1.822539e-02 ,1.741975e-02 ,1.667449e-02 ,1.598330e-02 ,1.534084e-02 , &amp;<a name='13798'>
       1.474253e-02 ,1.418446e-02 ,1.366325e-02 ,1.317597e-02 ,1.272004e-02 , &amp;<a name='13799'>
       1.229321e-02 ,1.189350e-02 ,1.151915e-02 ,1.116859e-02 ,1.084042e-02 , &amp;<a name='13800'>
       1.053338e-02 ,1.024636e-02 ,9.978326e-03 ,9.728357e-03 ,9.495613e-03 , &amp;<a name='13801'>
       9.279327e-03 ,9.078798e-03 ,8.893383e-03 ,8.722488e-03 ,8.565568e-03 , &amp;<a name='13802'>
       8.422115e-03 /)<a name='13803'>
      absice3(:,12) = (/ &amp;<a name='13804'>
<font color=#447700>! band 12<a name='13805'></font>
       9.465447e-02 ,6.432047e-02 ,5.060973e-02 ,4.267283e-02 ,3.741843e-02 , &amp;<a name='13806'>
       3.363096e-02 ,3.073531e-02 ,2.842405e-02 ,2.651789e-02 ,2.490518e-02 , &amp;<a name='13807'>
       2.351273e-02 ,2.229056e-02 ,2.120335e-02 ,2.022541e-02 ,1.933763e-02 , &amp;<a name='13808'>
       1.852546e-02 ,1.777763e-02 ,1.708528e-02 ,1.644134e-02 ,1.584009e-02 , &amp;<a name='13809'>
       1.527684e-02 ,1.474774e-02 ,1.424955e-02 ,1.377957e-02 ,1.333549e-02 , &amp;<a name='13810'>
       1.291534e-02 ,1.251743e-02 ,1.214029e-02 ,1.178265e-02 ,1.144337e-02 , &amp;<a name='13811'>
       1.112148e-02 ,1.081609e-02 ,1.052642e-02 ,1.025178e-02 ,9.991540e-03 , &amp;<a name='13812'>
       9.745130e-03 ,9.512038e-03 ,9.291797e-03 ,9.083980e-03 ,8.888195e-03 , &amp;<a name='13813'>
       8.704081e-03 ,8.531306e-03 ,8.369560e-03 ,8.218558e-03 ,8.078032e-03 , &amp;<a name='13814'>
       7.947730e-03 /)<a name='13815'>
      absice3(:,13) = (/ &amp;<a name='13816'>
<font color=#447700>! band 13<a name='13817'></font>
       1.560311e-01 ,9.961097e-02 ,7.502949e-02 ,6.115022e-02 ,5.214952e-02 , &amp;<a name='13818'>
       4.578149e-02 ,4.099731e-02 ,3.724174e-02 ,3.419343e-02 ,3.165356e-02 , &amp;<a name='13819'>
       2.949251e-02 ,2.762222e-02 ,2.598073e-02 ,2.452322e-02 ,2.321642e-02 , &amp;<a name='13820'>
       2.203516e-02 ,2.096002e-02 ,1.997579e-02 ,1.907036e-02 ,1.823401e-02 , &amp;<a name='13821'>
       1.745879e-02 ,1.673819e-02 ,1.606678e-02 ,1.544003e-02 ,1.485411e-02 , &amp;<a name='13822'>
       1.430574e-02 ,1.379215e-02 ,1.331092e-02 ,1.285996e-02 ,1.243746e-02 , &amp;<a name='13823'>
       1.204183e-02 ,1.167164e-02 ,1.132567e-02 ,1.100281e-02 ,1.070207e-02 , &amp;<a name='13824'>
       1.042258e-02 ,1.016352e-02 ,9.924197e-03 ,9.703953e-03 ,9.502199e-03 , &amp;<a name='13825'>
       9.318400e-03 ,9.152066e-03 ,9.002749e-03 ,8.870038e-03 ,8.753555e-03 , &amp;<a name='13826'>
       8.652951e-03 /)<a name='13827'>
      absice3(:,14) = (/ &amp;<a name='13828'>
<font color=#447700>! band 14<a name='13829'></font>
       1.559547e-01 ,9.896700e-02 ,7.441231e-02 ,6.061469e-02 ,5.168730e-02 , &amp;<a name='13830'>
       4.537821e-02 ,4.064106e-02 ,3.692367e-02 ,3.390714e-02 ,3.139438e-02 , &amp;<a name='13831'>
       2.925702e-02 ,2.740783e-02 ,2.578547e-02 ,2.434552e-02 ,2.305506e-02 , &amp;<a name='13832'>
       2.188910e-02 ,2.082842e-02 ,1.985789e-02 ,1.896553e-02 ,1.814165e-02 , &amp;<a name='13833'>
       1.737839e-02 ,1.666927e-02 ,1.600891e-02 ,1.539279e-02 ,1.481712e-02 , &amp;<a name='13834'>
       1.427865e-02 ,1.377463e-02 ,1.330266e-02 ,1.286068e-02 ,1.244689e-02 , &amp;<a name='13835'>
       1.205973e-02 ,1.169780e-02 ,1.135989e-02 ,1.104492e-02 ,1.075192e-02 , &amp;<a name='13836'>
       1.048004e-02 ,1.022850e-02 ,9.996611e-03 ,9.783753e-03 ,9.589361e-03 , &amp;<a name='13837'>
       9.412924e-03 ,9.253977e-03 ,9.112098e-03 ,8.986903e-03 ,8.878039e-03 , &amp;<a name='13838'>
       8.785184e-03 /)<a name='13839'>
      absice3(:,15) = (/ &amp;<a name='13840'>
<font color=#447700>! band 15<a name='13841'></font>
       1.102926e-01 ,7.176622e-02 ,5.530316e-02 ,4.606056e-02 ,4.006116e-02 , &amp;<a name='13842'>
       3.579628e-02 ,3.256909e-02 ,3.001360e-02 ,2.791920e-02 ,2.615617e-02 , &amp;<a name='13843'>
       2.464023e-02 ,2.331426e-02 ,2.213817e-02 ,2.108301e-02 ,2.012733e-02 , &amp;<a name='13844'>
       1.925493e-02 ,1.845331e-02 ,1.771269e-02 ,1.702531e-02 ,1.638493e-02 , &amp;<a name='13845'>
       1.578648e-02 ,1.522579e-02 ,1.469940e-02 ,1.420442e-02 ,1.373841e-02 , &amp;<a name='13846'>
       1.329931e-02 ,1.288535e-02 ,1.249502e-02 ,1.212700e-02 ,1.178015e-02 , &amp;<a name='13847'>
       1.145348e-02 ,1.114612e-02 ,1.085730e-02 ,1.058633e-02 ,1.033263e-02 , &amp;<a name='13848'>
       1.009564e-02 ,9.874895e-03 ,9.669960e-03 ,9.480449e-03 ,9.306014e-03 , &amp;<a name='13849'>
       9.146339e-03 ,9.001138e-03 ,8.870154e-03 ,8.753148e-03 ,8.649907e-03 , &amp;<a name='13850'>
       8.560232e-03 /)<a name='13851'>
      absice3(:,16) = (/ &amp;<a name='13852'>
<font color=#447700>! band 16<a name='13853'></font>
       1.688344e-01 ,1.077072e-01 ,7.994467e-02 ,6.403862e-02 ,5.369850e-02 , &amp;<a name='13854'>
       4.641582e-02 ,4.099331e-02 ,3.678724e-02 ,3.342069e-02 ,3.065831e-02 , &amp;<a name='13855'>
       2.834557e-02 ,2.637680e-02 ,2.467733e-02 ,2.319286e-02 ,2.188299e-02 , &amp;<a name='13856'>
       2.071701e-02 ,1.967121e-02 ,1.872692e-02 ,1.786931e-02 ,1.708641e-02 , &amp;<a name='13857'>
       1.636846e-02 ,1.570743e-02 ,1.509665e-02 ,1.453052e-02 ,1.400433e-02 , &amp;<a name='13858'>
       1.351407e-02 ,1.305631e-02 ,1.262810e-02 ,1.222688e-02 ,1.185044e-02 , &amp;<a name='13859'>
       1.149683e-02 ,1.116436e-02 ,1.085153e-02 ,1.055701e-02 ,1.027961e-02 , &amp;<a name='13860'>
       1.001831e-02 ,9.772141e-03 ,9.540280e-03 ,9.321966e-03 ,9.116517e-03 , &amp;<a name='13861'>
       8.923315e-03 ,8.741803e-03 ,8.571472e-03 ,8.411860e-03 ,8.262543e-03 , &amp;<a name='13862'>
       8.123136e-03 /)<a name='13863'>
<a name='13864'>
<font color=#447700>! For LIQFLAG = 0.<a name='13865'></font>
      absliq0 = 0.0903614 <a name='13866'>
<a name='13867'>
<font color=#447700>! For LIQFLAG = 1.  In each band, the absorption<a name='13868'></font>
<font color=#447700>! coefficients are listed for a range of effective radii from 2.5<a name='13869'></font>
<font color=#447700>! to 59.5 microns in increments of 1.0 micron.<a name='13870'></font>
      absliq1(:, 1) = (/ &amp;<a name='13871'>
<font color=#447700>! band  1<a name='13872'></font>
       1.64047e-03 , 6.90533e-02 , 7.72017e-02 , 7.78054e-02 , 7.69523e-02 , &amp;<a name='13873'>
       7.58058e-02 , 7.46400e-02 , 7.35123e-02 , 7.24162e-02 , 7.13225e-02 , &amp;<a name='13874'>
       6.99145e-02 , 6.66409e-02 , 6.36582e-02 , 6.09425e-02 , 5.84593e-02 , &amp;<a name='13875'>
       5.61743e-02 , 5.40571e-02 , 5.20812e-02 , 5.02245e-02 , 4.84680e-02 , &amp;<a name='13876'>
       4.67959e-02 , 4.51944e-02 , 4.36516e-02 , 4.21570e-02 , 4.07015e-02 , &amp;<a name='13877'>
       3.92766e-02 , 3.78747e-02 , 3.64886e-02 , 3.53632e-02 , 3.41992e-02 , &amp;<a name='13878'>
       3.31016e-02 , 3.20643e-02 , 3.10817e-02 , 3.01490e-02 , 2.92620e-02 , &amp;<a name='13879'>
       2.84171e-02 , 2.76108e-02 , 2.68404e-02 , 2.61031e-02 , 2.53966e-02 , &amp;<a name='13880'>
       2.47189e-02 , 2.40678e-02 , 2.34418e-02 , 2.28392e-02 , 2.22586e-02 , &amp;<a name='13881'>
       2.16986e-02 , 2.11580e-02 , 2.06356e-02 , 2.01305e-02 , 1.96417e-02 , &amp;<a name='13882'>
       1.91682e-02 , 1.87094e-02 , 1.82643e-02 , 1.78324e-02 , 1.74129e-02 , &amp;<a name='13883'>
       1.70052e-02 , 1.66088e-02 , 1.62231e-02 /)<a name='13884'>
      absliq1(:, 2) = (/ &amp;<a name='13885'>
<font color=#447700>! band  2<a name='13886'></font>
       2.19486e-01 , 1.80687e-01 , 1.59150e-01 , 1.44731e-01 , 1.33703e-01 , &amp;<a name='13887'>
       1.24355e-01 , 1.15756e-01 , 1.07318e-01 , 9.86119e-02 , 8.92739e-02 , &amp;<a name='13888'>
       8.34911e-02 , 7.70773e-02 , 7.15240e-02 , 6.66615e-02 , 6.23641e-02 , &amp;<a name='13889'>
       5.85359e-02 , 5.51020e-02 , 5.20032e-02 , 4.91916e-02 , 4.66283e-02 , &amp;<a name='13890'>
       4.42813e-02 , 4.21236e-02 , 4.01330e-02 , 3.82905e-02 , 3.65797e-02 , &amp;<a name='13891'>
       3.49869e-02 , 3.35002e-02 , 3.21090e-02 , 3.08957e-02 , 2.97601e-02 , &amp;<a name='13892'>
       2.86966e-02 , 2.76984e-02 , 2.67599e-02 , 2.58758e-02 , 2.50416e-02 , &amp;<a name='13893'>
       2.42532e-02 , 2.35070e-02 , 2.27997e-02 , 2.21284e-02 , 2.14904e-02 , &amp;<a name='13894'>
       2.08834e-02 , 2.03051e-02 , 1.97536e-02 , 1.92271e-02 , 1.87239e-02 , &amp;<a name='13895'>
       1.82425e-02 , 1.77816e-02 , 1.73399e-02 , 1.69162e-02 , 1.65094e-02 , &amp;<a name='13896'>
       1.61187e-02 , 1.57430e-02 , 1.53815e-02 , 1.50334e-02 , 1.46981e-02 , &amp;<a name='13897'>
       1.43748e-02 , 1.40628e-02 , 1.37617e-02 /)<a name='13898'>
      absliq1(:, 3) = (/ &amp;<a name='13899'>
<font color=#447700>! band  3<a name='13900'></font>
       2.95174e-01 , 2.34765e-01 , 1.98038e-01 , 1.72114e-01 , 1.52083e-01 , &amp;<a name='13901'>
       1.35654e-01 , 1.21613e-01 , 1.09252e-01 , 9.81263e-02 , 8.79448e-02 , &amp;<a name='13902'>
       8.12566e-02 , 7.44563e-02 , 6.86374e-02 , 6.36042e-02 , 5.92094e-02 , &amp;<a name='13903'>
       5.53402e-02 , 5.19087e-02 , 4.88455e-02 , 4.60951e-02 , 4.36124e-02 , &amp;<a name='13904'>
       4.13607e-02 , 3.93096e-02 , 3.74338e-02 , 3.57119e-02 , 3.41261e-02 , &amp;<a name='13905'>
       3.26610e-02 , 3.13036e-02 , 3.00425e-02 , 2.88497e-02 , 2.78077e-02 , &amp;<a name='13906'>
       2.68317e-02 , 2.59158e-02 , 2.50545e-02 , 2.42430e-02 , 2.34772e-02 , &amp;<a name='13907'>
       2.27533e-02 , 2.20679e-02 , 2.14181e-02 , 2.08011e-02 , 2.02145e-02 , &amp;<a name='13908'>
       1.96561e-02 , 1.91239e-02 , 1.86161e-02 , 1.81311e-02 , 1.76673e-02 , &amp;<a name='13909'>
       1.72234e-02 , 1.67981e-02 , 1.63903e-02 , 1.59989e-02 , 1.56230e-02 , &amp;<a name='13910'>
       1.52615e-02 , 1.49138e-02 , 1.45791e-02 , 1.42565e-02 , 1.39455e-02 , &amp;<a name='13911'>
       1.36455e-02 , 1.33559e-02 , 1.30761e-02 /)<a name='13912'>
      absliq1(:, 4) = (/ &amp;<a name='13913'>
<font color=#447700>! band  4<a name='13914'></font>
       3.00925e-01 , 2.36949e-01 , 1.96947e-01 , 1.68692e-01 , 1.47190e-01 , &amp;<a name='13915'>
       1.29986e-01 , 1.15719e-01 , 1.03568e-01 , 9.30028e-02 , 8.36658e-02 , &amp;<a name='13916'>
       7.71075e-02 , 7.07002e-02 , 6.52284e-02 , 6.05024e-02 , 5.63801e-02 , &amp;<a name='13917'>
       5.27534e-02 , 4.95384e-02 , 4.66690e-02 , 4.40925e-02 , 4.17664e-02 , &amp;<a name='13918'>
       3.96559e-02 , 3.77326e-02 , 3.59727e-02 , 3.43561e-02 , 3.28662e-02 , &amp;<a name='13919'>
       3.14885e-02 , 3.02110e-02 , 2.90231e-02 , 2.78948e-02 , 2.69109e-02 , &amp;<a name='13920'>
       2.59884e-02 , 2.51217e-02 , 2.43058e-02 , 2.35364e-02 , 2.28096e-02 , &amp;<a name='13921'>
       2.21218e-02 , 2.14700e-02 , 2.08515e-02 , 2.02636e-02 , 1.97041e-02 , &amp;<a name='13922'>
       1.91711e-02 , 1.86625e-02 , 1.81769e-02 , 1.77126e-02 , 1.72683e-02 , &amp;<a name='13923'>
       1.68426e-02 , 1.64344e-02 , 1.60427e-02 , 1.56664e-02 , 1.53046e-02 , &amp;<a name='13924'>
       1.49565e-02 , 1.46214e-02 , 1.42985e-02 , 1.39871e-02 , 1.36866e-02 , &amp;<a name='13925'>
       1.33965e-02 , 1.31162e-02 , 1.28453e-02 /)<a name='13926'>
      absliq1(:, 5) = (/ &amp;<a name='13927'>
<font color=#447700>! band  5<a name='13928'></font>
       2.64691e-01 , 2.12018e-01 , 1.78009e-01 , 1.53539e-01 , 1.34721e-01 , &amp;<a name='13929'>
       1.19580e-01 , 1.06996e-01 , 9.62772e-02 , 8.69710e-02 , 7.87670e-02 , &amp;<a name='13930'>
       7.29272e-02 , 6.70920e-02 , 6.20977e-02 , 5.77732e-02 , 5.39910e-02 , &amp;<a name='13931'>
       5.06538e-02 , 4.76866e-02 , 4.50301e-02 , 4.26374e-02 , 4.04704e-02 , &amp;<a name='13932'>
       3.84981e-02 , 3.66948e-02 , 3.50394e-02 , 3.35141e-02 , 3.21038e-02 , &amp;<a name='13933'>
       3.07957e-02 , 2.95788e-02 , 2.84438e-02 , 2.73790e-02 , 2.64390e-02 , &amp;<a name='13934'>
       2.55565e-02 , 2.47263e-02 , 2.39437e-02 , 2.32047e-02 , 2.25056e-02 , &amp;<a name='13935'>
       2.18433e-02 , 2.12149e-02 , 2.06177e-02 , 2.00495e-02 , 1.95081e-02 , &amp;<a name='13936'>
       1.89917e-02 , 1.84984e-02 , 1.80269e-02 , 1.75755e-02 , 1.71431e-02 , &amp;<a name='13937'>
       1.67283e-02 , 1.63303e-02 , 1.59478e-02 , 1.55801e-02 , 1.52262e-02 , &amp;<a name='13938'>
       1.48853e-02 , 1.45568e-02 , 1.42400e-02 , 1.39342e-02 , 1.36388e-02 , &amp;<a name='13939'>
       1.33533e-02 , 1.30773e-02 , 1.28102e-02 /)<a name='13940'>
      absliq1(:, 6) = (/ &amp;<a name='13941'>
<font color=#447700>! band  6<a name='13942'></font>
       8.81182e-02 , 1.06745e-01 , 9.79753e-02 , 8.99625e-02 , 8.35200e-02 , &amp;<a name='13943'>
       7.81899e-02 , 7.35939e-02 , 6.94696e-02 , 6.56266e-02 , 6.19148e-02 , &amp;<a name='13944'>
       5.83355e-02 , 5.49306e-02 , 5.19642e-02 , 4.93325e-02 , 4.69659e-02 , &amp;<a name='13945'>
       4.48148e-02 , 4.28431e-02 , 4.10231e-02 , 3.93332e-02 , 3.77563e-02 , &amp;<a name='13946'>
       3.62785e-02 , 3.48882e-02 , 3.35758e-02 , 3.23333e-02 , 3.11536e-02 , &amp;<a name='13947'>
       3.00310e-02 , 2.89601e-02 , 2.79365e-02 , 2.70502e-02 , 2.62618e-02 , &amp;<a name='13948'>
       2.55025e-02 , 2.47728e-02 , 2.40726e-02 , 2.34013e-02 , 2.27583e-02 , &amp;<a name='13949'>
       2.21422e-02 , 2.15522e-02 , 2.09869e-02 , 2.04453e-02 , 1.99260e-02 , &amp;<a name='13950'>
       1.94280e-02 , 1.89501e-02 , 1.84913e-02 , 1.80506e-02 , 1.76270e-02 , &amp;<a name='13951'>
       1.72196e-02 , 1.68276e-02 , 1.64500e-02 , 1.60863e-02 , 1.57357e-02 , &amp;<a name='13952'>
       1.53975e-02 , 1.50710e-02 , 1.47558e-02 , 1.44511e-02 , 1.41566e-02 , &amp;<a name='13953'>
       1.38717e-02 , 1.35960e-02 , 1.33290e-02 /)<a name='13954'>
      absliq1(:, 7) = (/ &amp;<a name='13955'>
<font color=#447700>! band  7<a name='13956'></font>
       4.32174e-02 , 7.36078e-02 , 6.98340e-02 , 6.65231e-02 , 6.41948e-02 , &amp;<a name='13957'>
       6.23551e-02 , 6.06638e-02 , 5.88680e-02 , 5.67124e-02 , 5.38629e-02 , &amp;<a name='13958'>
       4.99579e-02 , 4.86289e-02 , 4.70120e-02 , 4.52854e-02 , 4.35466e-02 , &amp;<a name='13959'>
       4.18480e-02 , 4.02169e-02 , 3.86658e-02 , 3.71992e-02 , 3.58168e-02 , &amp;<a name='13960'>
       3.45155e-02 , 3.32912e-02 , 3.21390e-02 , 3.10538e-02 , 3.00307e-02 , &amp;<a name='13961'>
       2.90651e-02 , 2.81524e-02 , 2.72885e-02 , 2.62821e-02 , 2.55744e-02 , &amp;<a name='13962'>
       2.48799e-02 , 2.42029e-02 , 2.35460e-02 , 2.29108e-02 , 2.22981e-02 , &amp;<a name='13963'>
       2.17079e-02 , 2.11402e-02 , 2.05945e-02 , 2.00701e-02 , 1.95663e-02 , &amp;<a name='13964'>
       1.90824e-02 , 1.86174e-02 , 1.81706e-02 , 1.77411e-02 , 1.73281e-02 , &amp;<a name='13965'>
       1.69307e-02 , 1.65483e-02 , 1.61801e-02 , 1.58254e-02 , 1.54835e-02 , &amp;<a name='13966'>
       1.51538e-02 , 1.48358e-02 , 1.45288e-02 , 1.42322e-02 , 1.39457e-02 , &amp;<a name='13967'>
       1.36687e-02 , 1.34008e-02 , 1.31416e-02 /)<a name='13968'>
      absliq1(:, 8) = (/ &amp;<a name='13969'>
<font color=#447700>! band  8<a name='13970'></font>
       1.41881e-01 , 7.15419e-02 , 6.30335e-02 , 6.11132e-02 , 6.01931e-02 , &amp;<a name='13971'>
       5.92420e-02 , 5.78968e-02 , 5.58876e-02 , 5.28923e-02 , 4.84462e-02 , &amp;<a name='13972'>
       4.60839e-02 , 4.56013e-02 , 4.45410e-02 , 4.31866e-02 , 4.17026e-02 , &amp;<a name='13973'>
       4.01850e-02 , 3.86892e-02 , 3.72461e-02 , 3.58722e-02 , 3.45749e-02 , &amp;<a name='13974'>
       3.33564e-02 , 3.22155e-02 , 3.11494e-02 , 3.01541e-02 , 2.92253e-02 , &amp;<a name='13975'>
       2.83584e-02 , 2.75488e-02 , 2.67925e-02 , 2.57692e-02 , 2.50704e-02 , &amp;<a name='13976'>
       2.43918e-02 , 2.37350e-02 , 2.31005e-02 , 2.24888e-02 , 2.18996e-02 , &amp;<a name='13977'>
       2.13325e-02 , 2.07870e-02 , 2.02623e-02 , 1.97577e-02 , 1.92724e-02 , &amp;<a name='13978'>
       1.88056e-02 , 1.83564e-02 , 1.79241e-02 , 1.75079e-02 , 1.71070e-02 , &amp;<a name='13979'>
       1.67207e-02 , 1.63482e-02 , 1.59890e-02 , 1.56424e-02 , 1.53077e-02 , &amp;<a name='13980'>
       1.49845e-02 , 1.46722e-02 , 1.43702e-02 , 1.40782e-02 , 1.37955e-02 , &amp;<a name='13981'>
       1.35219e-02 , 1.32569e-02 , 1.30000e-02 /)<a name='13982'>
      absliq1(:, 9) = (/ &amp;<a name='13983'>
<font color=#447700>! band  9<a name='13984'></font>
       6.72726e-02 , 6.61013e-02 , 6.47866e-02 , 6.33780e-02 , 6.18985e-02 , &amp;<a name='13985'>
       6.03335e-02 , 5.86136e-02 , 5.65876e-02 , 5.39839e-02 , 5.03536e-02 , &amp;<a name='13986'>
       4.71608e-02 , 4.63630e-02 , 4.50313e-02 , 4.34526e-02 , 4.17876e-02 , &amp;<a name='13987'>
       4.01261e-02 , 3.85171e-02 , 3.69860e-02 , 3.55442e-02 , 3.41954e-02 , &amp;<a name='13988'>
       3.29384e-02 , 3.17693e-02 , 3.06832e-02 , 2.96745e-02 , 2.87374e-02 , &amp;<a name='13989'>
       2.78662e-02 , 2.70557e-02 , 2.63008e-02 , 2.52450e-02 , 2.45424e-02 , &amp;<a name='13990'>
       2.38656e-02 , 2.32144e-02 , 2.25885e-02 , 2.19873e-02 , 2.14099e-02 , &amp;<a name='13991'>
       2.08554e-02 , 2.03230e-02 , 1.98116e-02 , 1.93203e-02 , 1.88482e-02 , &amp;<a name='13992'>
       1.83944e-02 , 1.79578e-02 , 1.75378e-02 , 1.71335e-02 , 1.67440e-02 , &amp;<a name='13993'>
       1.63687e-02 , 1.60069e-02 , 1.56579e-02 , 1.53210e-02 , 1.49958e-02 , &amp;<a name='13994'>
       1.46815e-02 , 1.43778e-02 , 1.40841e-02 , 1.37999e-02 , 1.35249e-02 , &amp;<a name='13995'>
       1.32585e-02 , 1.30004e-02 , 1.27502e-02 /)<a name='13996'>
      absliq1(:,10) = (/ &amp;<a name='13997'>
<font color=#447700>! band 10<a name='13998'></font>
       7.97040e-02 , 7.63844e-02 , 7.36499e-02 , 7.13525e-02 , 6.93043e-02 , &amp;<a name='13999'>
       6.72807e-02 , 6.50227e-02 , 6.22395e-02 , 5.86093e-02 , 5.37815e-02 , &amp;<a name='14000'>
       5.14682e-02 , 4.97214e-02 , 4.77392e-02 , 4.56961e-02 , 4.36858e-02 , &amp;<a name='14001'>
       4.17569e-02 , 3.99328e-02 , 3.82224e-02 , 3.66265e-02 , 3.51416e-02 , &amp;<a name='14002'>
       3.37617e-02 , 3.24798e-02 , 3.12887e-02 , 3.01812e-02 , 2.91505e-02 , &amp;<a name='14003'>
       2.81900e-02 , 2.72939e-02 , 2.64568e-02 , 2.54165e-02 , 2.46832e-02 , &amp;<a name='14004'>
       2.39783e-02 , 2.33017e-02 , 2.26531e-02 , 2.20314e-02 , 2.14359e-02 , &amp;<a name='14005'>
       2.08653e-02 , 2.03187e-02 , 1.97947e-02 , 1.92924e-02 , 1.88106e-02 , &amp;<a name='14006'>
       1.83483e-02 , 1.79043e-02 , 1.74778e-02 , 1.70678e-02 , 1.66735e-02 , &amp;<a name='14007'>
       1.62941e-02 , 1.59286e-02 , 1.55766e-02 , 1.52371e-02 , 1.49097e-02 , &amp;<a name='14008'>
       1.45937e-02 , 1.42885e-02 , 1.39936e-02 , 1.37085e-02 , 1.34327e-02 , &amp;<a name='14009'>
       1.31659e-02 , 1.29075e-02 , 1.26571e-02 /)<a name='14010'>
      absliq1(:,11) = (/ &amp;<a name='14011'>
<font color=#447700>! band 11<a name='14012'></font>
       1.49438e-01 , 1.33535e-01 , 1.21542e-01 , 1.11743e-01 , 1.03263e-01 , &amp;<a name='14013'>
       9.55774e-02 , 8.83382e-02 , 8.12943e-02 , 7.42533e-02 , 6.70609e-02 , &amp;<a name='14014'>
       6.38761e-02 , 5.97788e-02 , 5.59841e-02 , 5.25318e-02 , 4.94132e-02 , &amp;<a name='14015'>
       4.66014e-02 , 4.40644e-02 , 4.17706e-02 , 3.96910e-02 , 3.77998e-02 , &amp;<a name='14016'>
       3.60742e-02 , 3.44947e-02 , 3.30442e-02 , 3.17079e-02 , 3.04730e-02 , &amp;<a name='14017'>
       2.93283e-02 , 2.82642e-02 , 2.72720e-02 , 2.61789e-02 , 2.53277e-02 , &amp;<a name='14018'>
       2.45237e-02 , 2.37635e-02 , 2.30438e-02 , 2.23615e-02 , 2.17140e-02 , &amp;<a name='14019'>
       2.10987e-02 , 2.05133e-02 , 1.99557e-02 , 1.94241e-02 , 1.89166e-02 , &amp;<a name='14020'>
       1.84317e-02 , 1.79679e-02 , 1.75238e-02 , 1.70983e-02 , 1.66901e-02 , &amp;<a name='14021'>
       1.62983e-02 , 1.59219e-02 , 1.55599e-02 , 1.52115e-02 , 1.48761e-02 , &amp;<a name='14022'>
       1.45528e-02 , 1.42411e-02 , 1.39402e-02 , 1.36497e-02 , 1.33690e-02 , &amp;<a name='14023'>
       1.30976e-02 , 1.28351e-02 , 1.25810e-02 /)<a name='14024'>
      absliq1(:,12) = (/ &amp;<a name='14025'>
<font color=#447700>! band 12<a name='14026'></font>
       3.71985e-02 , 3.88586e-02 , 3.99070e-02 , 4.04351e-02 , 4.04610e-02 , &amp;<a name='14027'>
       3.99834e-02 , 3.89953e-02 , 3.74886e-02 , 3.54551e-02 , 3.28870e-02 , &amp;<a name='14028'>
       3.32576e-02 , 3.22444e-02 , 3.12384e-02 , 3.02584e-02 , 2.93146e-02 , &amp;<a name='14029'>
       2.84120e-02 , 2.75525e-02 , 2.67361e-02 , 2.59618e-02 , 2.52280e-02 , &amp;<a name='14030'>
       2.45327e-02 , 2.38736e-02 , 2.32487e-02 , 2.26558e-02 , 2.20929e-02 , &amp;<a name='14031'>
       2.15579e-02 , 2.10491e-02 , 2.05648e-02 , 1.99749e-02 , 1.95704e-02 , &amp;<a name='14032'>
       1.91731e-02 , 1.87839e-02 , 1.84032e-02 , 1.80315e-02 , 1.76689e-02 , &amp;<a name='14033'>
       1.73155e-02 , 1.69712e-02 , 1.66362e-02 , 1.63101e-02 , 1.59928e-02 , &amp;<a name='14034'>
       1.56842e-02 , 1.53840e-02 , 1.50920e-02 , 1.48080e-02 , 1.45318e-02 , &amp;<a name='14035'>
       1.42631e-02 , 1.40016e-02 , 1.37472e-02 , 1.34996e-02 , 1.32586e-02 , &amp;<a name='14036'>
       1.30239e-02 , 1.27954e-02 , 1.25728e-02 , 1.23559e-02 , 1.21445e-02 , &amp;<a name='14037'>
       1.19385e-02 , 1.17376e-02 , 1.15417e-02 /)<a name='14038'>
      absliq1(:,13) = (/ &amp;<a name='14039'>
<font color=#447700>! band 13<a name='14040'></font>
       3.11868e-02 , 4.48357e-02 , 4.90224e-02 , 4.96406e-02 , 4.86806e-02 , &amp;<a name='14041'>
       4.69610e-02 , 4.48630e-02 , 4.25795e-02 , 4.02138e-02 , 3.78236e-02 , &amp;<a name='14042'>
       3.74266e-02 , 3.60384e-02 , 3.47074e-02 , 3.34434e-02 , 3.22499e-02 , &amp;<a name='14043'>
       3.11264e-02 , 3.00704e-02 , 2.90784e-02 , 2.81463e-02 , 2.72702e-02 , &amp;<a name='14044'>
       2.64460e-02 , 2.56698e-02 , 2.49381e-02 , 2.42475e-02 , 2.35948e-02 , &amp;<a name='14045'>
       2.29774e-02 , 2.23925e-02 , 2.18379e-02 , 2.11793e-02 , 2.07076e-02 , &amp;<a name='14046'>
       2.02470e-02 , 1.97981e-02 , 1.93613e-02 , 1.89367e-02 , 1.85243e-02 , &amp;<a name='14047'>
       1.81240e-02 , 1.77356e-02 , 1.73588e-02 , 1.69935e-02 , 1.66392e-02 , &amp;<a name='14048'>
       1.62956e-02 , 1.59624e-02 , 1.56393e-02 , 1.53259e-02 , 1.50219e-02 , &amp;<a name='14049'>
       1.47268e-02 , 1.44404e-02 , 1.41624e-02 , 1.38925e-02 , 1.36302e-02 , &amp;<a name='14050'>
       1.33755e-02 , 1.31278e-02 , 1.28871e-02 , 1.26530e-02 , 1.24253e-02 , &amp;<a name='14051'>
       1.22038e-02 , 1.19881e-02 , 1.17782e-02 /)<a name='14052'>
      absliq1(:,14) = (/ &amp;<a name='14053'>
<font color=#447700>! band 14<a name='14054'></font>
       1.58988e-02 , 3.50652e-02 , 4.00851e-02 , 4.07270e-02 , 3.98101e-02 , &amp;<a name='14055'>
       3.83306e-02 , 3.66829e-02 , 3.50327e-02 , 3.34497e-02 , 3.19609e-02 , &amp;<a name='14056'>
       3.13712e-02 , 3.03348e-02 , 2.93415e-02 , 2.83973e-02 , 2.75037e-02 , &amp;<a name='14057'>
       2.66604e-02 , 2.58654e-02 , 2.51161e-02 , 2.44100e-02 , 2.37440e-02 , &amp;<a name='14058'>
       2.31154e-02 , 2.25215e-02 , 2.19599e-02 , 2.14282e-02 , 2.09242e-02 , &amp;<a name='14059'>
       2.04459e-02 , 1.99915e-02 , 1.95594e-02 , 1.90254e-02 , 1.86598e-02 , &amp;<a name='14060'>
       1.82996e-02 , 1.79455e-02 , 1.75983e-02 , 1.72584e-02 , 1.69260e-02 , &amp;<a name='14061'>
       1.66013e-02 , 1.62843e-02 , 1.59752e-02 , 1.56737e-02 , 1.53799e-02 , &amp;<a name='14062'>
       1.50936e-02 , 1.48146e-02 , 1.45429e-02 , 1.42782e-02 , 1.40203e-02 , &amp;<a name='14063'>
       1.37691e-02 , 1.35243e-02 , 1.32858e-02 , 1.30534e-02 , 1.28270e-02 , &amp;<a name='14064'>
       1.26062e-02 , 1.23909e-02 , 1.21810e-02 , 1.19763e-02 , 1.17766e-02 , &amp;<a name='14065'>
       1.15817e-02 , 1.13915e-02 , 1.12058e-02 /)<a name='14066'>
      absliq1(:,15) = (/ &amp;<a name='14067'>
<font color=#447700>! band 15<a name='14068'></font>
       5.02079e-03 , 2.17615e-02 , 2.55449e-02 , 2.59484e-02 , 2.53650e-02 , &amp;<a name='14069'>
       2.45281e-02 , 2.36843e-02 , 2.29159e-02 , 2.22451e-02 , 2.16716e-02 , &amp;<a name='14070'>
       2.11451e-02 , 2.05817e-02 , 2.00454e-02 , 1.95372e-02 , 1.90567e-02 , &amp;<a name='14071'>
       1.86028e-02 , 1.81742e-02 , 1.77693e-02 , 1.73866e-02 , 1.70244e-02 , &amp;<a name='14072'>
       1.66815e-02 , 1.63563e-02 , 1.60477e-02 , 1.57544e-02 , 1.54755e-02 , &amp;<a name='14073'>
       1.52097e-02 , 1.49564e-02 , 1.47146e-02 , 1.43684e-02 , 1.41728e-02 , &amp;<a name='14074'>
       1.39762e-02 , 1.37797e-02 , 1.35838e-02 , 1.33891e-02 , 1.31961e-02 , &amp;<a name='14075'>
       1.30051e-02 , 1.28164e-02 , 1.26302e-02 , 1.24466e-02 , 1.22659e-02 , &amp;<a name='14076'>
       1.20881e-02 , 1.19131e-02 , 1.17412e-02 , 1.15723e-02 , 1.14063e-02 , &amp;<a name='14077'>
       1.12434e-02 , 1.10834e-02 , 1.09264e-02 , 1.07722e-02 , 1.06210e-02 , &amp;<a name='14078'>
       1.04725e-02 , 1.03269e-02 , 1.01839e-02 , 1.00436e-02 , 9.90593e-03 , &amp;<a name='14079'>
       9.77080e-03 , 9.63818e-03 , 9.50800e-03 /)<a name='14080'>
      absliq1(:,16) = (/ &amp;<a name='14081'>
<font color=#447700>! band 16<a name='14082'></font>
       5.64971e-02 , 9.04736e-02 , 8.11726e-02 , 7.05450e-02 , 6.20052e-02 , &amp;<a name='14083'>
       5.54286e-02 , 5.03503e-02 , 4.63791e-02 , 4.32290e-02 , 4.06959e-02 , &amp;<a name='14084'>
       3.74690e-02 , 3.52964e-02 , 3.33799e-02 , 3.16774e-02 , 3.01550e-02 , &amp;<a name='14085'>
       2.87856e-02 , 2.75474e-02 , 2.64223e-02 , 2.53953e-02 , 2.44542e-02 , &amp;<a name='14086'>
       2.35885e-02 , 2.27894e-02 , 2.20494e-02 , 2.13622e-02 , 2.07222e-02 , &amp;<a name='14087'>
       2.01246e-02 , 1.95654e-02 , 1.90408e-02 , 1.84398e-02 , 1.80021e-02 , &amp;<a name='14088'>
       1.75816e-02 , 1.71775e-02 , 1.67889e-02 , 1.64152e-02 , 1.60554e-02 , &amp;<a name='14089'>
       1.57089e-02 , 1.53751e-02 , 1.50531e-02 , 1.47426e-02 , 1.44428e-02 , &amp;<a name='14090'>
       1.41532e-02 , 1.38734e-02 , 1.36028e-02 , 1.33410e-02 , 1.30875e-02 , &amp;<a name='14091'>
       1.28420e-02 , 1.26041e-02 , 1.23735e-02 , 1.21497e-02 , 1.19325e-02 , &amp;<a name='14092'>
       1.17216e-02 , 1.15168e-02 , 1.13177e-02 , 1.11241e-02 , 1.09358e-02 , &amp;<a name='14093'>
       1.07525e-02 , 1.05741e-02 , 1.04003e-02 /)<a name='14094'>
<a name='14095'>
      end subroutine lwcldpr<a name='14096'>
<a name='14097'>
      end module rrtmg_lw_init_f<a name='14098'>
<a name='14099'>
<A NAME='RRTMG_LW_RAD_F'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='14100'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_rad_f</font> <A href='../../call_to/RRTMG_LW_RAD_F.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_RAD_F.html' TARGET='index'>10</A><a name='14101'>
<a name='14102'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='14103'></font>
<font color=#447700>! |                                                                          |<a name='14104'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='14105'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='14106'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='14107'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='14108'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='14109'></font>
<font color=#447700>! |                                                                          |<a name='14110'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='14111'></font>
<font color=#447700>!<a name='14112'></font>
<a name='14113'>
#ifdef _ACCEL<a name='14114'>
      use cudafor<a name='14115'>
#endif<a name='14116'>
<a name='14117'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW'>gpu_mcica_subcol_gen_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_MCICA_SUBCOL_GEN_LW_1"><a name='14118'>
<a name='14119'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_RTRNMC'>gpu_rrtmg_lw_rtrnmc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_RTRNMC_2"><a name='14120'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_SETCOEF'>gpu_rrtmg_lw_setcoef</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_SETCOEF_1"><a name='14121'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_CLDPRMC'>gpu_rrtmg_lw_cldprmc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_CLDPRMC_1"><a name='14122'>
    <a name='14123'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_RRTMG_LW_TAUMOL'>gpu_rrtmg_lw_taumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_RRTMG_LW_TAUMOL_2">, only: taumolg, copyGPUTaumol<a name='14124'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CLD_F'>rrlw_cld_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CLD_F_3">, only: abscld1, absliq0, absliq1, &amp;<a name='14125'>
                          absice0, absice1, absice2, absice3<a name='14126'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_7">, only: ngb, ngs<a name='14127'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_TBL_F'>rrlw_tbl_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_F_4">, only: tblint, bpade, tau_tbl, exp_tbl, tfn_tbl, ntbl<a name='14128'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_5">, only: fluxfac, heatfac, oneminus, pi, grav, avogad<a name='14129'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_VSN_F'>rrlw_vsn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_F_7">  <a name='14130'>
<a name='14131'>
      implicit none<a name='14132'>
<a name='14133'>
#ifdef _ACCEL<a name='14134'>
      integer  _gpudev, allocatable :: ngbd(:)<a name='14135'>
      integer, allocatable _gpudev :: ncbandsd(:)<a name='14136'>
      integer, allocatable _gpudev :: icbd(:)<a name='14137'>
      integer, allocatable _gpudev :: icldlyr(:,:)<a name='14138'>
      real  _gpudev, allocatable :: fracsd(:,:,:)<a name='14139'>
      real  _gpudev, allocatable :: taug(:,:,:)<a name='14140'>
<font color=#447700>!$OMP THREADPRIVATE(ngbd,ncbandsd,icbd,icldlyr,fracsd,taug)<a name='14141'></font>
#endif<a name='14142'>
   <a name='14143'>
      real :: timings(10)<a name='14144'>
      INTEGER, PARAMETER :: debug_level_lwf=100<a name='14145'>
<a name='14146'>
<font color=#447700>!------------------------------------------------------------------<a name='14147'></font>
      contains<a name='14148'>
<font color=#447700>!------------------------------------------------------------------<a name='14149'></font>
<A NAME='RRTMG_LW'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14150'>
      <font color=#993300>subroutine </font><font color=#cc0000>rrtmg_lw</font>( &amp; <A href='../../call_to/RRTMG_LW.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LW.html' TARGET='index'>18</A><a name='14151'>
             ncol    ,nlay    ,icld    ,idrv    , &amp;<a name='14152'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='14153'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='14154'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='14155'>
             inflglw ,iceflglw,liqflglw,cldfrac , &amp;<a name='14156'>
             tauc    ,ciwp    ,clwp    ,cswp    ,rei     ,rel   , res , &amp;<a name='14157'>
             tauaer  , &amp;<a name='14158'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc   ,hrc , &amp;<a name='14159'>
             duflx_dt,duflxc_dt)<a name='14160'>
<font color=#447700>! -------- Description --------<a name='14161'></font>
<a name='14162'>
<font color=#447700>! This program is the driver subroutine for RRTMG_LW, the AER LW radiation <a name='14163'></font>
<font color=#447700>! model for application to GCMs, that has been adapted from RRTM_LW for<a name='14164'></font>
<font color=#447700>! improved efficiency.<a name='14165'></font>
<font color=#447700>!<a name='14166'></font>
<font color=#447700>! NOTE: The call to RRTMG_LW_INI should be moved to the GCM initialization<a name='14167'></font>
<font color=#447700>!  area, since this has to be called only once. <a name='14168'></font>
<font color=#447700>!<a name='14169'></font>
<font color=#447700>! This routine:<a name='14170'></font>
<font color=#447700>!    a) calls INATM to read in the atmospheric profile from GCM;<a name='14171'></font>
<font color=#447700>!       all layering in RRTMG is ordered from surface to toa. <a name='14172'></font>
<font color=#447700>!    b) calls CLDPRMC to set cloud optical depth for McICA based <a name='14173'></font>
<font color=#447700>!       on input cloud properties <a name='14174'></font>
<font color=#447700>!    c) calls SETCOEF to calculate various quantities needed for <a name='14175'></font>
<font color=#447700>!       the radiative transfer algorithm<a name='14176'></font>
<font color=#447700>!    d) calls TAUMOL to calculate gaseous optical depths for each <a name='14177'></font>
<font color=#447700>!       of the 16 spectral bands<a name='14178'></font>
<font color=#447700>!    e) calls RTRNMC (for both clear and cloudy profiles) to perform the<a name='14179'></font>
<font color=#447700>!       radiative transfer calculation using McICA, the Monte-Carlo <a name='14180'></font>
<font color=#447700>!       Independent Column Approximation, to represent sub-grid scale <a name='14181'></font>
<font color=#447700>!       cloud variability<a name='14182'></font>
<font color=#447700>!    f) passes the necessary fluxes and cooling rates back to GCM<a name='14183'></font>
<font color=#447700>!<a name='14184'></font>
<font color=#447700>! Two modes of operation are possible:<a name='14185'></font>
<font color=#447700>!     The mode is chosen by using either rrtmg_lw.nomcica.f90 (to not use<a name='14186'></font>
<font color=#447700>!     McICA) or rrtmg_lw.f90 (to use McICA) to interface with a GCM. <a name='14187'></font>
<font color=#447700>!<a name='14188'></font>
<font color=#447700>!    1) Standard, single forward model calculation (imca = 0)<a name='14189'></font>
<font color=#447700>!    2) Monte Carlo Independent Column Approximation (McICA, Pincus et al., <a name='14190'></font>
<font color=#447700>!       JC, 2003) method is applied to the forward model calculation (imca = 1)<a name='14191'></font>
<font color=#447700>!<a name='14192'></font>
<font color=#447700>! This call to RRTMG_LW must be preceeded by a call to the module<a name='14193'></font>
<font color=#447700>!     mcica_subcol_gen_lw.f90 to run the McICA sub-column cloud generator,<a name='14194'></font>
<font color=#447700>!     which will provide the cloud physical or cloud optical properties<a name='14195'></font>
<font color=#447700>!     on the RRTMG quadrature point (ngpt) dimension.<a name='14196'></font>
<font color=#447700>!     Two random number generators are available for use when imca = 1.<a name='14197'></font>
<font color=#447700>!     This is chosen by setting flag irnd on input to mcica_subcol_gen_lw.<a name='14198'></font>
<font color=#447700>!     1) KISSVEC (irnd = 0)<a name='14199'></font>
<font color=#447700>!     2) Mersenne-Twister (irnd = 1)<a name='14200'></font>
<font color=#447700>!<a name='14201'></font>
<font color=#447700>! Two methods of cloud property input are possible:<a name='14202'></font>
<font color=#447700>!     Cloud properties can be input in one of two ways (controlled by input <a name='14203'></font>
<font color=#447700>!     flags inflglw, iceflglw, and liqflglw; see text file rrtmg_lw_instructions<a name='14204'></font>
<font color=#447700>!     and subroutine rrtmg_lw_cldprmc.f90 for further details):<a name='14205'></font>
<font color=#447700>!<a name='14206'></font>
<font color=#447700>!    1) Input cloud fraction and cloud optical depth directly (inflglw = 0)<a name='14207'></font>
<font color=#447700>!    2) Input cloud fraction and cloud physical properties (inflglw = 1 or 2);  <a name='14208'></font>
<font color=#447700>!       cloud optical properties are calculated by cldprmc or cldprmc based<a name='14209'></font>
<font color=#447700>!       on input settings of iceflglw and liqflglw.  Ice particle size provided<a name='14210'></font>
<font color=#447700>!       must be appropriately defined for the ice parameterization selected. <a name='14211'></font>
<font color=#447700>!<a name='14212'></font>
<font color=#447700>! One method of aerosol property input is possible:<a name='14213'></font>
<font color=#447700>!     Aerosol properties can be input in only one way (controlled by input <a name='14214'></font>
<font color=#447700>!     flag iaer; see text file rrtmg_lw_instructions for further details):<a name='14215'></font>
<font color=#447700>!<a name='14216'></font>
<font color=#447700>!    1) Input aerosol optical depth directly by layer and spectral band (iaer=10);<a name='14217'></font>
<font color=#447700>!       band average optical depth at the mid-point of each spectral band.<a name='14218'></font>
<font color=#447700>!       RRTMG_LW currently treats only aerosol absorption;<a name='14219'></font>
<font color=#447700>!       scattering capability is not presently available.<a name='14220'></font>
<font color=#447700>!<a name='14221'></font>
<font color=#447700>! The optional calculation of the change in upward flux as a function of surface <a name='14222'></font>
<font color=#447700>! temperature is available (controlled by input flag idrv).  This can be utilized <a name='14223'></font>
<font color=#447700>! to approximate adjustments to the upward flux profile caused only by a change in <a name='14224'></font>
<font color=#447700>! surface temperature between full radiation calls.  This feature uses the pre-<a name='14225'></font>
<font color=#447700>! calculated derivative of the Planck function with respect to surface temperature. <a name='14226'></font>
<font color=#447700>!<a name='14227'></font>
<font color=#447700>!    1) Normal forward calculation for the input profile (idrv=0)<a name='14228'></font>
<font color=#447700>!    2) Normal forward calculation with optional calculation of the change<a name='14229'></font>
<font color=#447700>!       in upward flux as a function of surface temperature for clear sky<a name='14230'></font>
<font color=#447700>!       and total sky flux.  Flux partial derivatives are provided in arrays<a name='14231'></font>
<font color=#447700>!       duflx_dt and duflxc_dt for total and clear sky.  (idrv=1)<a name='14232'></font>
<font color=#447700>!<a name='14233'></font>
<font color=#447700>!<a name='14234'></font>
<font color=#447700>! ------- Modifications -------<a name='14235'></font>
<font color=#447700>!<a name='14236'></font>
<font color=#447700>! This version of RRTMG_LW has been modified from RRTM_LW to use a reduced <a name='14237'></font>
<font color=#447700>! set of g-points for application to GCMs.  <a name='14238'></font>
<font color=#447700>!<a name='14239'></font>
<font color=#447700>!-- Original version (derived from RRTM_LW), reduction of g-points, other<a name='14240'></font>
<font color=#447700>!   revisions for use with GCMs.  <a name='14241'></font>
<font color=#447700>!     1999: M. J. Iacono, AER, Inc.<a name='14242'></font>
<font color=#447700>!-- Adapted for use with NCAR/CAM.<a name='14243'></font>
<font color=#447700>!     May 2004: M. J. Iacono, AER, Inc.<a name='14244'></font>
<font color=#447700>!-- Revised to add McICA capability. <a name='14245'></font>
<font color=#447700>!     Nov 2005: M. J. Iacono, AER, Inc.<a name='14246'></font>
<font color=#447700>!-- Conversion to F90 formatting for consistency with rrtmg_sw.<a name='14247'></font>
<font color=#447700>!     Feb 2007: M. J. Iacono, AER, Inc.<a name='14248'></font>
<font color=#447700>!-- Modifications to formatting to use assumed-shape arrays.<a name='14249'></font>
<font color=#447700>!     Aug 2007: M. J. Iacono, AER, Inc.<a name='14250'></font>
<font color=#447700>!-- Modified to add longwave aerosol absorption.<a name='14251'></font>
<font color=#447700>!     Apr 2008: M. J. Iacono, AER, Inc.<a name='14252'></font>
<font color=#447700>!-- Added capability to calculate derivative of upward flux wrt surface temperature. <a name='14253'></font>
<font color=#447700>!     Nov 2009: M. J. Iacono, E. J. Mlawer, AER, Inc.<a name='14254'></font>
<font color=#447700>!-- Added capability to run on GPU<a name='14255'></font>
<font color=#447700>!     Aug 2012: David Berthiaume, AER, Inc.<a name='14256'></font>
<font color=#447700>! --------- Modules ----------<a name='14257'></font>
<a name='14258'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_42">, only : nbndlw, ngptlw, maxxsec, mxmol, mxlay, nbndlw<a name='14259'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_6">, only: fluxfac, heatfac, oneminus, pi<a name='14260'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_8">, only: ng, ngb, nspa, nspb, wavenum1, wavenum2, delwave<a name='14261'>
<a name='14262'>
<font color=#447700>! ------- Declarations -------<a name='14263'></font>
<a name='14264'>
         <font color=#447700>! integer , parameter:: maxlay = 203<a name='14265'></font>
         <font color=#447700>! integer , parameter:: mxmol = 38<a name='14266'></font>
          <a name='14267'>
<a name='14268'>
<font color=#447700>! ----- Input -----<a name='14269'></font>
<font color=#447700>! Note: All volume mixing ratios are in dimensionless units of mole fraction obtained<a name='14270'></font>
<font color=#447700>! by scaling mass mixing ratio (g/g) with the appropriate molecular weights (g/mol) <a name='14271'></font>
      integer , intent(in) :: ncol                    <font color=#447700>! Number of horizontal columns<a name='14272'></font>
      integer , intent(in) :: nlay                    <font color=#447700>! Number of model layers<a name='14273'></font>
      integer , intent(inout) :: icld                 <font color=#447700>! Cloud overlap method<a name='14274'></font>
                                                      <font color=#447700>!    0: Clear only<a name='14275'></font>
                                                      <font color=#447700>!    1: Random<a name='14276'></font>
                                                      <font color=#447700>!    2: Maximum/random<a name='14277'></font>
                                                      <font color=#447700>!    3: Maximum<a name='14278'></font>
                                                      <font color=#447700>!    4: Exponential (inactive)<a name='14279'></font>
      integer , intent(in) :: idrv                    <font color=#447700>! Flag for calculation of dFdT, the change<a name='14280'></font>
                                                      <font color=#447700>!    in upward flux as a function of <a name='14281'></font>
                                                      <font color=#447700>!    surface temperature [0=off, 1=on]<a name='14282'></font>
                                                      <font color=#447700>!    0: Normal forward calculation<a name='14283'></font>
                                                      <font color=#447700>!    1: Normal forward calculation with<a name='14284'></font>
                                                      <font color=#447700>!       duflx_dt and duflxc_dt output<a name='14285'></font>
<a name='14286'>
<font color=#447700>!      integer , intent(in) :: cloudMH, cloudHH        ! cloud layer heights for cloudFlag<a name='14287'></font>
      real , intent(in) :: play(:,:)                  <font color=#447700>! Layer pressures (hPa, mb)<a name='14288'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14289'></font>
      real , intent(in) :: plev(:,0:)                 <font color=#447700>! Interface pressures (hPa, mb)<a name='14290'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14291'></font>
      real , intent(in) :: tlay(:,:)                  <font color=#447700>! Layer temperatures (K)<a name='14292'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14293'></font>
      real , intent(in) :: tlev(:,0:)                 <font color=#447700>! Interface temperatures (K)<a name='14294'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14295'></font>
      real , intent(in) :: tsfc(:)                    <font color=#447700>! Surface temperature (K)<a name='14296'></font>
                                                      <font color=#447700>!    Dimensions: (ncol)<a name='14297'></font>
      real , intent(in) :: h2ovmr(:,:)                <font color=#447700>! H2O volume mixing ratio<a name='14298'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14299'></font>
      real , intent(in) :: o3vmr(:,:)                 <font color=#447700>! O3 volume mixing ratio<a name='14300'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14301'></font>
      real , intent(in) :: co2vmr(:,:)                <font color=#447700>! CO2 volume mixing ratio<a name='14302'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14303'></font>
      real , intent(in) :: ch4vmr(:,:)                <font color=#447700>! Methane volume mixing ratio<a name='14304'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14305'></font>
      real , intent(in) :: n2ovmr(:,:)                <font color=#447700>! Nitrous oxide volume mixing ratio<a name='14306'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14307'></font>
      real , intent(in) :: o2vmr(:,:)                 <font color=#447700>! Oxygen volume mixing ratio<a name='14308'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14309'></font>
      real , intent(in) :: cfc11vmr(:, :)             <font color=#447700>! CFC11 volume mixing ratio<a name='14310'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14311'></font>
      real , intent(in) :: cfc12vmr(:, :)             <font color=#447700>! CFC12 volume mixing ratio<a name='14312'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14313'></font>
      real , intent(in) :: cfc22vmr(:, :)             <font color=#447700>! CFC22 volume mixing ratio<a name='14314'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14315'></font>
      real , intent(in) :: ccl4vmr(:, :)              <font color=#447700>! CCL4 volume mixing ratio<a name='14316'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14317'></font>
      real , intent(in) :: emis(:, :)                 <font color=#447700>! Surface emissivity<a name='14318'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='14319'></font>
<a name='14320'>
      integer , intent(in) :: inflglw                 <font color=#447700>! Flag for cloud optical properties<a name='14321'></font>
      integer , intent(in) :: iceflglw                <font color=#447700>! Flag for ice particle specification<a name='14322'></font>
      integer , intent(in) :: liqflglw                <font color=#447700>! Flag for liquid droplet specification<a name='14323'></font>
<a name='14324'>
      real , intent(in) :: cldfrac(:,:)               <font color=#447700>! Cloud fraction<a name='14325'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14326'></font>
      real , intent(in) :: ciwp(:,:)                  <font color=#447700>! In-cloud ice water path (g/m2)<a name='14327'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14328'></font>
      real , intent(in) :: clwp(:,:)                  <font color=#447700>! In-cloud liquid water path (g/m2)<a name='14329'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14330'></font>
      real , intent(in) :: cswp(:,:)                  <font color=#447700>! In-cloud snow water path (g/m2)<a name='14331'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14332'></font>
      real , intent(in) :: rei(:,:)                   <font color=#447700>! Cloud ice particle effective size (microns)<a name='14333'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14334'></font>
                                                      <font color=#447700>! specific definition of reicmcl depends on setting of iceflglw:<a name='14335'></font>
                                                      <font color=#447700>! iceflglw = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14336'></font>
                                                      <font color=#447700>!               r_ec must be &gt;= 10.0 microns<a name='14337'></font>
                                                      <font color=#447700>! iceflglw = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14338'></font>
                                                      <font color=#447700>!               r_ec range is limited to 13.0 to 130.0 microns<a name='14339'></font>
                                                      <font color=#447700>! iceflglw = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='14340'></font>
                                                      <font color=#447700>!               r_k range is limited to 5.0 to 131.0 microns<a name='14341'></font>
                                                      <font color=#447700>! iceflglw = 3: generalized effective size, dge, (Fu, 1996),<a name='14342'></font>
                                                      <font color=#447700>!               dge range is limited to 5.0 to 140.0 microns<a name='14343'></font>
                                                      <font color=#447700>!               [dge = 1.0315 * r_ec]<a name='14344'></font>
      real , intent(in) :: rel(:, :)                  <font color=#447700>! Cloud water drop effective radius (microns)<a name='14345'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14346'></font>
      real , intent(in) :: res(:, :)                  <font color=#447700>! Cloud snow effective radius (microns)<a name='14347'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14348'></font>
      real , intent(in) :: tauc(:, :, :)              <font color=#447700>! In-cloud optical depth<a name='14349'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw,nlay)<a name='14350'></font>
      real , intent(in) :: tauaer(:,:,:)              <font color=#447700>! aerosol optical depth<a name='14351'></font>
                                                      <font color=#447700>!   at mid-point of LW spectral bands<a name='14352'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='14353'></font>
<a name='14354'>
<font color=#447700>! ----- Output -----<a name='14355'></font>
<a name='14356'>
      real , intent(out) :: uflx(:,:)                 <font color=#447700>! Total sky longwave upward flux (W/m2)<a name='14357'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14358'></font>
      real , intent(out) :: dflx(:,:)                 <font color=#447700>! Total sky longwave downward flux (W/m2)<a name='14359'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14360'></font>
      real , intent(out) :: hr(:,:)                   <font color=#447700>! Total sky longwave radiative heating rate (K/d)<a name='14361'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14362'></font>
      real , intent(out) :: uflxc(:,:)                <font color=#447700>! Clear sky longwave upward flux (W/m2)<a name='14363'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14364'></font>
      real , intent(out) :: dflxc(:,:)                <font color=#447700>! Clear sky longwave downward flux (W/m2)<a name='14365'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14366'></font>
      real , intent(out) :: hrc(:,:)                  <font color=#447700>! Clear sky longwave radiative heating rate (K/d)<a name='14367'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14368'></font>
<a name='14369'>
<font color=#447700>! ----- Optional Output -----<a name='14370'></font>
      real , intent(out), optional :: duflx_dt(:,:)     <a name='14371'>
                                                      <font color=#447700>! change in upward longwave flux (w/m2/K)<a name='14372'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14373'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14374'></font>
      real , intent(out), optional :: duflxc_dt(:,:)    <a name='14375'>
                                                      <font color=#447700>! change in clear sky upward longwave flux (w/m2/K)<a name='14376'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14377'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14378'></font>
<font color=#447700>!      integer , intent(out), optional :: cloudFlag(:,:)<a name='14379'></font>
      <a name='14380'>
      real,  pointer :: alp(:,:)<a name='14381'>
<a name='14382'>
      integer  :: pncol<a name='14383'>
      integer  :: colstart<a name='14384'>
      integer  :: cn, ns, i, np, mns<a name='14385'>
      real :: minmem<a name='14386'>
      integer :: hetflag<a name='14387'>
      integer :: numDevices, err<a name='14388'>
    <a name='14389'>
      integer :: numThreads<a name='14390'>
integer,external :: omp_get_thread_num<a name='14391'>
      CHARACTER(LEN=256) :: message<a name='14392'>
<a name='14393'>
      <font color=#447700>! Cuda device information<a name='14394'></font>
#ifdef _ACCEL<a name='14395'>
      type(cudadeviceprop) :: prop<a name='14396'>
#endif<a name='14397'>
      <font color=#447700>! store the available device global and constant memory<a name='14398'></font>
      real gmem, cmem<a name='14399'>
<font color=#447700>! mji - time      <a name='14400'></font>
      real t1,t2<a name='14401'>
<a name='14402'>
<font color=#447700>!jm write(0,*)__FILE__,__LINE__,omp_get_thread_num()<a name='14403'></font>
#ifdef _ACCEL<a name='14404'>
 <a name='14405'>
      err = cudaGetDeviceProperties( prop, 0)<a name='14406'>
      gmem = prop%totalGlobalMem<a name='14407'>
<font color=#447700>!      print *, "total GPU global memory is ", gmem / (1024.0*1024.0) , "MB"<a name='14408'></font>
 <a name='14409'>
#endif<a name='14410'>
      <a name='14411'>
<font color=#447700>! (dmb 2012) Here we calculate the number of groups to partition<a name='14412'></font>
<font color=#447700>! the inputs.<a name='14413'></font>
<a name='14414'>
<font color=#447700>! determine the minimum GPU memory<a name='14415'></font>
<font color=#447700>! force the GPUFlag off if there are no devices available<a name='14416'></font>
      <a name='14417'>
#ifdef _ACCEL<a name='14418'>
      minmem = gmem        <a name='14419'>
#else<a name='14420'>
<a name='14421'>
<font color=#447700>! on the CPU partiion the inputs into 2 GB chunks.  Runtime<a name='14422'></font>
<font color=#447700>! is pretty constant on the CPU as a function of the number<a name='14423'></font>
<font color=#447700>! of steps, so we pick a quantity that uses a relatively low<a name='14424'></font>
<font color=#447700>! amount of CPU memory.<a name='14425'></font>
      minmem = 2.0 * (1024.0**3)<a name='14426'>
         <a name='14427'>
<font color=#447700>! set the number of 'devices' to the available number of CPUs<a name='14428'></font>
#endif<a name='14429'>
<font color=#447700>!      print *, "available working memory is ", int(minmem / (1024*1024)) , " MB"<a name='14430'></font>
    <a name='14431'>
#ifdef _ACCEL<a name='14432'>
<font color=#447700>! use the available memory to determine the minumum number <a name='14433'></font>
<font color=#447700>! of steps that will be required.<a name='14434'></font>
<font color=#447700>! We use 1500 profiles per available GB as a conservative <a name='14435'></font>
<font color=#447700>! lower bound.<a name='14436'></font>
      cn = minmem * 1500 / (1024**3)<a name='14437'>
<a name='14438'>
<font color=#447700>! with device emulation (for debugging) make sure there is a lower<a name='14439'></font>
<font color=#447700>! limit to the number of supported columns<a name='14440'></font>
      if (cn &lt; 500) then <a name='14441'>
        cn = 500 <a name='14442'>
      end if<a name='14443'>
<font color=#447700>! Set number of columns per partition to be no larger than total number of columns<a name='14444'></font>
      if (cn &gt; ncol) then <a name='14445'>
        cn = ncol<a name='14446'>
      end if<a name='14447'>
#else<a name='14448'>
      cn = CHNK<a name='14449'>
#endif<a name='14450'>
<font color=#447700>!<a name='14451'></font>
      WRITE(message,*)'RRTMG_LWF: Number of columns is               ',ncol<a name='14452'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_780">( debug_level_lwf, message)<a name='14453'>
      WRITE(message,*)'RRTMG_LWF: Number of columns per partition is ',cn<a name='14454'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_781">( debug_level_lwf, message)<a name='14455'>
      ns = ceiling( real(ncol) / real(cn) )<a name='14456'>
      WRITE(message,*)'RRTMG_LWF: Number of partitions is            ',ns<a name='14457'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_782">( debug_level_lwf, message)<a name='14458'>
<a name='14459'>
<font color=#447700>! mji - time      <a name='14460'></font>
      call cpu_time(t1)<a name='14461'>
<a name='14462'>
      do  i = 1, ns <a name='14463'>
<a name='14464'>
<font color=#447700>!jm if ( i .eq. IDEBUG_BASE ) then<a name='14465'></font>
<font color=#447700>!jm call setdebug<a name='14466'></font>
<font color=#447700>!jm else <a name='14467'></font>
<font color=#447700>!jm call unsetdebug<a name='14468'></font>
<font color=#447700>!jm endif<a name='14469'></font>
<a name='14470'>
<a name='14471'>
<a name='14472'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART'>rrtmg_lw_part</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_PART_1"> &amp;<a name='14473'>
            (ns, ncol, (i-1)*cn + 1, min(cn, ncol - (i-1)*cn), &amp;<a name='14474'>
             nlay    ,icld    ,idrv,&amp;<a name='14475'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='14476'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='14477'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='14478'>
             inflglw ,iceflglw,liqflglw,cldfrac , &amp;<a name='14479'>
             tauc ,ciwp ,clwp ,cswp ,rei ,rel ,res , &amp;<a name='14480'>
             tauaer  , &amp;<a name='14481'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc,  hrc, &amp;<a name='14482'>
             duflx_dt,duflxc_dt)    <a name='14483'>
      end do  <a name='14484'>
      <a name='14485'>
<font color=#447700>! mji - time      <a name='14486'></font>
      call cpu_time(t2)<a name='14487'>
      WRITE(message,*)'------------------------------------------------'<a name='14488'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_783">( debug_level_lwf, message)<a name='14489'>
      WRITE(message,*)'TOTAL RRTMG_LWF RUN TIME IS   ', t2-t1<a name='14490'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_784">( debug_level_lwf, message)<a name='14491'>
      WRITE(message,*)'------------------------------------------------'<a name='14492'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_785">( debug_level_lwf, message)<a name='14493'>
<a name='14494'>
      end subroutine<a name='14495'>
<a name='14496'>
<A NAME='RRTMG_LW_PART'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14497'>
      <font color=#993300>subroutine </font><font color=#cc0000>rrtmg_lw_part</font> &amp; <A href='../../call_to/RRTMG_LW_PART.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_PART.html' TARGET='index'>25</A><a name='14498'>
            (npart, ncol , colstart, pncol , &amp;<a name='14499'>
             nlay    ,icld    ,idrv    , &amp;<a name='14500'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='14501'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='14502'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='14503'>
             inflglw ,iceflglw,liqflglw,cldfrac , &amp;<a name='14504'>
             tauc ,ciwp ,clwp ,cswp ,rei ,rel ,res , &amp;<a name='14505'>
             tauaer  , &amp;<a name='14506'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc,  hrc, &amp;<a name='14507'>
             duflx_dt,duflxc_dt)<a name='14508'>
   <a name='14509'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GPU_MCICA_SUBCOL_GEN_LW'>gpu_mcica_subcol_gen_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GPU_MCICA_SUBCOL_GEN_LW_2">, only: mcica_subcol_lwg, generate_stochastic_cloudsg<a name='14510'>
   <a name='14511'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_43">, only : nbndlw, ngptlw, maxxsec, mxmol, mxlay, nbndlw, nmol<a name='14512'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_CON_F'>rrlw_con_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_F_7">, only: fluxfac, heatfac, oneminus, pi<a name='14513'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_WVN_F'>rrlw_wvn_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_F_9">, only: ng, ngb, nspa, nspb, wavenum1, wavenum2, delwave, ixindx<a name='14514'>
<a name='14515'>
<a name='14516'>
<font color=#447700>! ----- Input -----<a name='14517'></font>
<font color=#447700>! Note: All volume mixing ratios are in dimensionless units of mole fraction obtained<a name='14518'></font>
<font color=#447700>! by scaling mass mixing ratio (g/g) with the appropriate molecular weights (g/mol) <a name='14519'></font>
      integer , intent(in) :: npart<a name='14520'>
      integer , intent(in) :: ncol                    <font color=#447700>! Number of horizontal columns<a name='14521'></font>
      integer , intent(in) :: nlay                    <font color=#447700>! Number of model layers<a name='14522'></font>
      integer , intent(inout) :: icld                 <font color=#447700>! Cloud overlap method<a name='14523'></font>
                                                      <font color=#447700>!    0: Clear only<a name='14524'></font>
                                                      <font color=#447700>!    1: Random<a name='14525'></font>
                                                      <font color=#447700>!    2: Maximum/random<a name='14526'></font>
                                                      <font color=#447700>!    3: Maximum<a name='14527'></font>
                                                      <font color=#447700>!    4: Exponential (inactive)<a name='14528'></font>
      integer , intent(in) :: idrv                    <font color=#447700>! Flag for calculation of dFdT, the change<a name='14529'></font>
                                                      <font color=#447700>!    in upward flux as a function of <a name='14530'></font>
                                                      <font color=#447700>!    surface temperature [0=off, 1=on]<a name='14531'></font>
                                                      <font color=#447700>!    0: Normal forward calculation<a name='14532'></font>
                                                      <font color=#447700>!    1: Normal forward calculation with<a name='14533'></font>
                                                      <font color=#447700>!       duflx_dt and duflxc_dt output<a name='14534'></font>
<a name='14535'>
      real , intent(in) :: play(:,:)                  <font color=#447700>! Layer pressures (hPa, mb)<a name='14536'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14537'></font>
      real , intent(in) :: plev(:,0:)                 <font color=#447700>! Interface pressures (hPa, mb)<a name='14538'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14539'></font>
      real , intent(in) :: tlay(:,:)                  <font color=#447700>! Layer temperatures (K)<a name='14540'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14541'></font>
      real , intent(in) :: tlev(:,0:)                 <font color=#447700>! Interface temperatures (K)<a name='14542'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14543'></font>
      real , intent(in) :: tsfc(:)                    <font color=#447700>! Surface temperature (K)<a name='14544'></font>
                                                      <font color=#447700>!    Dimensions: (ncol)<a name='14545'></font>
      real , intent(in) :: h2ovmr(:,:)                <font color=#447700>! H2O volume mixing ratio<a name='14546'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14547'></font>
      real , intent(in) :: o3vmr(:,:)                 <font color=#447700>! O3 volume mixing ratio<a name='14548'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14549'></font>
      real , intent(in) :: co2vmr(:,:)                <font color=#447700>! CO2 volume mixing ratio<a name='14550'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14551'></font>
      real , intent(in) :: ch4vmr(:,:)                <font color=#447700>! Methane volume mixing ratio<a name='14552'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14553'></font>
      real , intent(in) :: n2ovmr(:,:)                <font color=#447700>! Nitrous oxide volume mixing ratio<a name='14554'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14555'></font>
      real , intent(in) :: o2vmr(:,:)                 <font color=#447700>! Oxygen volume mixing ratio<a name='14556'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14557'></font>
      real , intent(in) :: cfc11vmr(:, :)             <font color=#447700>! CFC11 volume mixing ratio<a name='14558'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14559'></font>
      real , intent(in) :: cfc12vmr(:, :)             <font color=#447700>! CFC12 volume mixing ratio<a name='14560'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14561'></font>
      real , intent(in) :: cfc22vmr(:, :)             <font color=#447700>! CFC22 volume mixing ratio<a name='14562'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14563'></font>
      real , intent(in) :: ccl4vmr(:, :)              <font color=#447700>! CCL4 volume mixing ratio<a name='14564'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14565'></font>
      real , intent(in) :: emis(:, :)                 <font color=#447700>! Surface emissivity<a name='14566'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='14567'></font>
<a name='14568'>
      integer , intent(in) :: inflglw                 <font color=#447700>! Flag for cloud optical properties<a name='14569'></font>
      integer , intent(in) :: iceflglw                <font color=#447700>! Flag for ice particle specification<a name='14570'></font>
      integer , intent(in) :: liqflglw                <font color=#447700>! Flag for liquid droplet specification<a name='14571'></font>
<a name='14572'>
      real , intent(in) :: cldfrac(:,:)               <font color=#447700>! Cloud fraction<a name='14573'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14574'></font>
      real , intent(in) :: ciwp(:,:)                  <font color=#447700>! In-cloud ice water path (g/m2)<a name='14575'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14576'></font>
      real , intent(in) :: clwp(:,:)                  <font color=#447700>! In-cloud liquid water path (g/m2)<a name='14577'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14578'></font>
      real , intent(in) :: cswp(:,:)                  <font color=#447700>! In-cloud snow water path (g/m2)<a name='14579'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14580'></font>
      real , intent(in) :: rei(:,:)                   <font color=#447700>! Cloud ice particle effective size (microns)<a name='14581'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14582'></font>
                                                      <font color=#447700>! specific definition of reicmcl depends on setting of iceflglw:<a name='14583'></font>
                                                      <font color=#447700>! iceflglw = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14584'></font>
                                                      <font color=#447700>!               r_ec must be &gt;= 10.0 microns<a name='14585'></font>
                                                      <font color=#447700>! iceflglw = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14586'></font>
                                                      <font color=#447700>!               r_ec range is limited to 13.0 to 130.0 microns<a name='14587'></font>
                                                      <font color=#447700>! iceflglw = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='14588'></font>
                                                      <font color=#447700>!               r_k range is limited to 5.0 to 131.0 microns<a name='14589'></font>
                                                      <font color=#447700>! iceflglw = 3: generalized effective size, dge, (Fu, 1996),<a name='14590'></font>
                                                      <font color=#447700>!               dge range is limited to 5.0 to 140.0 microns<a name='14591'></font>
                                                      <font color=#447700>!               [dge = 1.0315 * r_ec]<a name='14592'></font>
      real , intent(in) :: rel(:, :)                  <font color=#447700>! Cloud water drop effective radius (microns)<a name='14593'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14594'></font>
      real , intent(in) :: res(:, :)                  <font color=#447700>! Cloud snow effective radius (microns)<a name='14595'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14596'></font>
      real , intent(in) :: tauc(:, :,:)               <font color=#447700>! In-cloud optical depth<a name='14597'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw,nlay)<a name='14598'></font>
<a name='14599'>
      real , intent(in) :: tauaer(:,:,:)              <font color=#447700>! aerosol optical depth<a name='14600'></font>
                                                      <font color=#447700>!   at mid-point of LW spectral bands<a name='14601'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='14602'></font>
<a name='14603'>
      integer , intent(in) :: pncol<a name='14604'>
      integer , intent(in) :: colstart<a name='14605'>
<a name='14606'>
#ifndef _ACCEL<a name='14607'>
# define pncol CHNK<a name='14608'>
#endif<a name='14609'>
      <a name='14610'>
<font color=#447700>! ----- Output -----<a name='14611'></font>
<a name='14612'>
      real , intent(out) :: uflx(:,:)                 <font color=#447700>! Total sky longwave upward flux (W/m2)<a name='14613'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14614'></font>
      real , intent(out) :: dflx(:,:)                 <font color=#447700>! Total sky longwave downward flux (W/m2)<a name='14615'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14616'></font>
      real , intent(out) :: hr(:,:)                   <font color=#447700>! Total sky longwave radiative heating rate (K/d)<a name='14617'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14618'></font>
      real , intent(out) :: uflxc(:,:)                <font color=#447700>! Clear sky longwave upward flux (W/m2)<a name='14619'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14620'></font>
      real , intent(out) :: dflxc(:,:)                <font color=#447700>! Clear sky longwave downward flux (W/m2)<a name='14621'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='14622'></font>
      real , intent(out) :: hrc(:,:)                  <font color=#447700>! Clear sky longwave radiative heating rate (K/d)<a name='14623'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14624'></font>
<a name='14625'>
<font color=#447700>! ----- Optional Output -----<a name='14626'></font>
      real , intent(out), optional :: duflx_dt(:,:)     <a name='14627'>
                                                      <font color=#447700>! change in upward longwave flux (w/m2/K)<a name='14628'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14629'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14630'></font>
      real , intent(out), optional :: duflxc_dt(:,:)    <a name='14631'>
                                                      <font color=#447700>! change in clear sky upward longwave flux (w/m2/K)<a name='14632'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14633'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14634'></font>
<font color=#447700>!      integer , intent(out), optional :: cloudFlag(:,:)<a name='14635'></font>
#ifdef _ACCEL<a name='14636'>
      real  _gpudeva :: cldfmcd(:,:,:)                <font color=#447700>! layer cloud fraction [mcica]<a name='14637'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='14638'></font>
#else<a name='14639'>
      real  ::  cldfmcd(pncol, ngptlw, nlay+1)        <font color=#447700>! layer cloud fraction [mcica]<a name='14640'></font>
<a name='14641'>
#endif<a name='14642'>
<a name='14643'>
<font color=#447700>! ----- Local -----<a name='14644'></font>
<a name='14645'>
#ifndef _ACCEL<a name='14646'>
      integer  ncol_,nlayers_,nbndlw_,ngptlw_      <font color=#447700>! for passing through argument list<a name='14647'></font>
      integer  ncol__,nlayers__,nbndlw__,ngptlw__  <font color=#447700>! for passing through argument list<a name='14648'></font>
<font color=#447700>! here is where the previously allocatable things are made local variables<a name='14649'></font>
      real ::  pmid(pncol, nlay)<a name='14650'>
<a name='14651'>
      real :: relqmc(pncol, nlay+1), reicmc(pncol, nlay+1)<a name='14652'>
      real :: resnmc(pncol, nlay+1)<a name='14653'>
      <a name='14654'>
      real :: ciwpmcd(pncol, ngptlw, nlay+1)<a name='14655'>
      real :: clwpmcd(pncol, ngptlw, nlay+1)<a name='14656'>
      real :: cswpmcd(pncol, ngptlw, nlay+1)<a name='14657'>
<a name='14658'>
      real :: taucmcd(pncol, ngptlw, nlay+1)<a name='14659'>
      real :: pzd(pncol, 0:nlay+1)<a name='14660'>
      real :: pwvcmd(pncol)<a name='14661'>
      real :: semissd(pncol, nbndlw)<a name='14662'>
      real :: planklayd(pncol,nlay+1,nbndlw)<a name='14663'>
      real :: planklevd(pncol, 0:nlay+1, nbndlw)<a name='14664'>
      real :: plankbndd(pncol,nbndlw)<a name='14665'>
      real :: gurad(pncol,ngptlw,0:nlay+1)        <font color=#447700>! upward longwave flux (w/m2)<a name='14666'></font>
      real :: gdrad(pncol,ngptlw,0:nlay+1)        <font color=#447700>! downward longwave flux (w/m2)<a name='14667'></font>
      real :: gclrurad(pncol,ngptlw,0:nlay+1)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='14668'></font>
      real :: gclrdrad(pncol,ngptlw,0:nlay+1)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='14669'></font>
<a name='14670'>
      real :: gdtotuflux_dtd( pncol, ngptlw, 0:nlay+1)<a name='14671'>
      real :: gdtotuclfl_dtd( pncol, ngptlw, 0:nlay+1)<a name='14672'>
<a name='14673'>
      real :: totufluxd(pncol, 0:nlay+1)     <font color=#447700>! upward longwave flux (w/m2)<a name='14674'></font>
      real :: totdfluxd(pncol, 0:nlay+1)     <font color=#447700>! downward longwave flux (w/m2)<a name='14675'></font>
      real :: fnetd(pncol, 0:nlay+1)         <font color=#447700>! net longwave flux (w/m2)<a name='14676'></font>
      real :: htrd(pncol, 0:nlay+1)          <font color=#447700>! longwave heating rate (k/day)<a name='14677'></font>
      real :: totuclfld(pncol, 0:nlay+1)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='14678'></font>
      real :: totdclfld(pncol, 0:nlay+1)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='14679'></font>
      real :: fnetcd(pncol, 0:nlay+1)        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='14680'></font>
      real :: htrcd(pncol, 0:nlay+1)         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='14681'></font>
      real :: dtotuflux_dtd(pncol, 0:nlay+1) <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='14682'></font>
      real :: dtotuclfl_dtd(pncol, 0:nlay+1)<a name='14683'>
      real :: dplankbnd_dtd(pncol,nbndlw)<a name='14684'>
<a name='14685'>
      real :: taveld( pncol, nlay)<a name='14686'>
      real :: tzd( pncol, 0:nlay)<a name='14687'>
      real :: tboundd( pncol )<a name='14688'>
      real :: wbroadd( pncol, nlay)<a name='14689'>
<a name='14690'>
      real :: wx1( pncol, nlay )<a name='14691'>
      real :: wx2( pncol, nlay )<a name='14692'>
      real :: wx3( pncol, nlay )<a name='14693'>
      real :: wx4( pncol, nlay )<a name='14694'>
<a name='14695'>
      real :: tauaa( pncol, nlay, nbndlw )<a name='14696'>
<font color=#447700>!jm      integer :: nspad( nbndlw )<a name='14697'></font>
<font color=#447700>!jm      integer :: nspbd( nbndlw )<a name='14698'></font>
<a name='14699'>
      integer :: icbd(16)<a name='14700'>
      integer :: ncbandsd(pncol)<a name='14701'>
      integer :: icldlyr(pncol, nlay+1)<a name='14702'>
      real :: fracsd( pncol, nlay+1, ngptlw )<a name='14703'>
      real :: taug( pncol, nlay+1, ngptlw )<a name='14704'>
#endif<a name='14705'>
<a name='14706'>
<a name='14707'>
<font color=#447700>! Control<a name='14708'></font>
      integer(kind=4) :: nlayers                      <font color=#447700>! total number of layers<a name='14709'></font>
      integer(kind=4) :: istart                       <font color=#447700>! beginning band of calculation<a name='14710'></font>
      integer(kind=4) :: iend                         <font color=#447700>! ending band of calculation<a name='14711'></font>
      integer(kind=4) :: iout                         <font color=#447700>! output option flag (inactive)<a name='14712'></font>
      integer  :: iaer                                <font color=#447700>! aerosol option flag<a name='14713'></font>
      integer(kind=4) :: iplon                        <font color=#447700>! column loop index<a name='14714'></font>
      integer  :: imca                                <font color=#447700>! flag for mcica [0=off, 1=on]<a name='14715'></font>
      integer  :: ims                                 <font color=#447700>! value for changing mcica permute seed<a name='14716'></font>
      integer  :: k                                   <font color=#447700>! layer loop index<a name='14717'></font>
      integer  :: ig                                  <font color=#447700>! g-point loop index<a name='14718'></font>
      real  :: t1, t2<a name='14719'>
<a name='14720'>
<font color=#447700>! Atmosphere<a name='14721'></font>
      real  :: pavel(pncol,nlay+1)                    <font color=#447700>! layer pressures (mb) <a name='14722'></font>
      real  :: tavel(pncol,nlay+1)                    <font color=#447700>! layer temperatures (K)<a name='14723'></font>
      real  :: pz(pncol,0:nlay+1)                     <font color=#447700>! level (interface) pressures (hPa, mb)<a name='14724'></font>
      real  :: tz(pncol,0:nlay+1)                     <font color=#447700>! level (interface) temperatures (K)<a name='14725'></font>
      real  :: tbound(pncol)                          <font color=#447700>! surface temperature (K)<a name='14726'></font>
      real  :: coldry(pncol,nlay+1)                   <font color=#447700>! dry air column density (mol/cm2)<a name='14727'></font>
      real  :: wbrodl(pncol,nlay+1)                   <font color=#447700>! broadening gas column density (mol/cm2)<a name='14728'></font>
      real  :: wkl(pncol,mxmol,nlay+1)                <font color=#447700>! molecular amounts (mol/cm-2)<a name='14729'></font>
      real  :: wx(pncol,maxxsec,nlay+1)               <font color=#447700>! cross-section amounts (mol/cm-2)<a name='14730'></font>
      real  :: pwvcm(pncol)                           <font color=#447700>! precipitable water vapor (cm)<a name='14731'></font>
      real  :: semiss(pncol,nbndlw)                   <font color=#447700>! lw surface emissivity<a name='14732'></font>
      real  :: fracs(pncol,nlay+1,ngptlw)             <font color=#447700>! <a name='14733'></font>
   <a name='14734'>
      real  :: taut(pncol,nlay+1,ngptlw)              <font color=#447700>! gaseous + aerosol optical depths<a name='14735'></font>
<a name='14736'>
      real  :: taua(pncol,nlay+1,nbndlw)              <font color=#447700>! aerosol optical depth<a name='14737'></font>
<font color=#447700>!      real :: ssaa(pncol,nlay+1,nbndlw)              ! aerosol single scattering albedo<a name='14738'></font>
                                                      <font color=#447700>!   for future expansion <a name='14739'></font>
                                                      <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='14740'></font>
<font color=#447700>!      real :: asma(pncol,nlay+1,nbndlw)              ! aerosol asymmetry parameter<a name='14741'></font>
                                                      <font color=#447700>!   for future expansion <a name='14742'></font>
                                                      <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='14743'></font>
 <a name='14744'>
<font color=#447700>! Atmosphere - setcoef<a name='14745'></font>
      integer  :: laytrop(pncol)                      <font color=#447700>! tropopause layer index<a name='14746'></font>
      integer  :: jp(pncol,nlay+1)                    <font color=#447700>! lookup table index <a name='14747'></font>
      integer  :: jt(pncol,nlay+1)                    <font color=#447700>! lookup table index <a name='14748'></font>
      integer  :: jt1(pncol,nlay+1)                   <font color=#447700>! lookup table index <a name='14749'></font>
      real  :: planklay(pncol,nlay+1,nbndlw)          <font color=#447700>! <a name='14750'></font>
      real  :: planklev(pncol,0:nlay+1,nbndlw)        <font color=#447700>! <a name='14751'></font>
      real  :: plankbnd(pncol,nbndlw)                 <font color=#447700>! <a name='14752'></font>
      real  :: dplankbnd_dt(pncol,nbndlw)             <font color=#447700>! <a name='14753'></font>
<a name='14754'>
      real  :: colh2o(pncol,nlay+1)                   <font color=#447700>! column amount (h2o)<a name='14755'></font>
      real  :: colco2(pncol,nlay+1)                   <font color=#447700>! column amount (co2)<a name='14756'></font>
      real  :: colo3(pncol,nlay+1)                    <font color=#447700>! column amount (o3)<a name='14757'></font>
      real  :: coln2o(pncol,nlay+1)                   <font color=#447700>! column amount (n2o)<a name='14758'></font>
      real  :: colco(pncol,nlay+1)                    <font color=#447700>! column amount (co)<a name='14759'></font>
      real  :: colch4(pncol,nlay+1)                   <font color=#447700>! column amount (ch4)<a name='14760'></font>
      real  :: colo2(pncol,nlay+1)                    <font color=#447700>! column amount (o2)<a name='14761'></font>
      real  :: colbrd(pncol,nlay+1)                   <font color=#447700>! column amount (broadening gases)<a name='14762'></font>
<a name='14763'>
      integer  :: indself(pncol,nlay+1)<a name='14764'>
      integer  :: indfor(pncol,nlay+1)<a name='14765'>
      real  :: selffac(pncol,nlay+1)<a name='14766'>
      real  :: selffrac(pncol,nlay+1)<a name='14767'>
      real  :: forfac(pncol,nlay+1)<a name='14768'>
      real  :: forfrac(pncol,nlay+1)<a name='14769'>
<a name='14770'>
      integer  :: indminor(pncol,nlay+1)<a name='14771'>
      real  :: minorfrac(pncol,nlay+1)<a name='14772'>
      real  :: scaleminor(pncol,nlay+1)<a name='14773'>
      real  :: scaleminorn2(pncol,nlay+1)<a name='14774'>
<a name='14775'>
      real  :: &amp;                      <font color=#447700>!<a name='14776'></font>
                         fac00(pncol,nlay+1), fac01(pncol,nlay+1), &amp;<a name='14777'>
                         fac10(pncol,nlay+1), fac11(pncol,nlay+1) <a name='14778'>
      real  :: &amp;                      <font color=#447700>!<a name='14779'></font>
                         rat_h2oco2(pncol,nlay+1),rat_h2oco2_1(pncol,nlay+1), &amp;<a name='14780'>
                         rat_h2oo3(pncol,nlay+1),rat_h2oo3_1(pncol,nlay+1), &amp;<a name='14781'>
                         rat_h2on2o(pncol,nlay+1),rat_h2on2o_1(pncol,nlay+1), &amp;<a name='14782'>
                         rat_h2och4(pncol,nlay+1),rat_h2och4_1(pncol,nlay+1), &amp;<a name='14783'>
                         rat_n2oco2(pncol,nlay+1),rat_n2oco2_1(pncol,nlay+1), &amp;<a name='14784'>
                         rat_o3co2(pncol,nlay+1),rat_o3co2_1(pncol,nlay+1)<a name='14785'>
<a name='14786'>
<font color=#447700>! Atmosphere/clouds - cldprop<a name='14787'></font>
      integer  :: ncbands(pncol)                      <font color=#447700>! number of cloud spectral bands<a name='14788'></font>
      integer  :: inflag(pncol)                       <font color=#447700>! flag for cloud property method<a name='14789'></font>
      integer  :: iceflag(pncol)                      <font color=#447700>! flag for ice cloud properties<a name='14790'></font>
      integer  :: liqflag(pncol)                      <font color=#447700>! flag for liquid cloud properties<a name='14791'></font>
<a name='14792'>
<a name='14793'>
<font color=#447700>! Output<a name='14794'></font>
      real  :: totuflux(pncol,0:nlay+1)               <font color=#447700>! upward longwave flux (w/m2)<a name='14795'></font>
      real  :: totdflux(pncol,0:nlay+1)               <font color=#447700>! downward longwave flux (w/m2)<a name='14796'></font>
      real  :: fnet(pncol,0:nlay+1)                   <font color=#447700>! net longwave flux (w/m2)<a name='14797'></font>
      real  :: htr(pncol,0:nlay+1)                    <font color=#447700>! longwave heating rate (k/day)<a name='14798'></font>
      real  :: totuclfl(pncol,0:nlay+1)               <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='14799'></font>
      real  :: totdclfl(pncol,0:nlay+1)               <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='14800'></font>
      real  :: fnetc(pncol,0:nlay+1)                  <font color=#447700>! clear sky net longwave flux (w/m2)<a name='14801'></font>
      real  :: htrc(pncol,0:nlay+1)                   <font color=#447700>! clear sky longwave heating rate (k/day)<a name='14802'></font>
      real  :: dtotuflux_dt(pncol,0:nlay+1)           <font color=#447700>! change in upward longwave flux (w/m2/k)<a name='14803'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14804'></font>
      real  :: dtotuclfl_dt(pncol,0:nlay+1)           <font color=#447700>! change in clear sky upward longwave flux (w/m2/k)<a name='14805'></font>
                                                      <font color=#447700>! with respect to surface temperature<a name='14806'></font>
      real  :: curad(pncol,ngptlw,0:nlay+1)           <font color=#447700>! upward longwave flux (w/m2)<a name='14807'></font>
      real  :: cdrad(pncol,ngptlw,0:nlay+1)           <font color=#447700>! downward longwave flux (w/m2)<a name='14808'></font>
      real  :: cclrurad(pncol,ngptlw,0:nlay+1)        <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='14809'></font>
      real  :: cclrdrad(pncol,ngptlw,0:nlay+1)        <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='14810'></font>
      <a name='14811'>
      real  :: cldfracq(pncol,mxlay+1)                <font color=#447700>! Cloud fraction<a name='14812'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14813'></font>
      real  :: ciwpq(pncol,mxlay+1)                   <font color=#447700>! In-cloud ice water path (g/m2)<a name='14814'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14815'></font>
      real  :: clwpq(pncol,mxlay+1)                   <font color=#447700>! In-cloud liquid water path (g/m2)<a name='14816'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14817'></font>
      real  :: cswpq(pncol,mxlay+1)                   <font color=#447700>! In-cloud snow water path (g/m2)<a name='14818'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='14819'></font>
      real  :: reiq(pncol,mxlay)                      <font color=#447700>! Cloud ice particle effective size (microns)<a name='14820'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14821'></font>
                                                      <font color=#447700>! specific definition of reicmcl depends on setting of iceflglw:<a name='14822'></font>
                                                      <font color=#447700>! iceflglw = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14823'></font>
                                                      <font color=#447700>!               r_ec must be &gt;= 10.0 microns<a name='14824'></font>
                                                      <font color=#447700>! iceflglw = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='14825'></font>
                                                      <font color=#447700>!               r_ec range is limited to 13.0 to 130.0 microns<a name='14826'></font>
                                                      <font color=#447700>! iceflglw = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='14827'></font>
                                                      <font color=#447700>!               r_k range is limited to 5.0 to 131.0 microns<a name='14828'></font>
                                                      <font color=#447700>! iceflglw = 3: generalized effective size, dge, (Fu, 1996),<a name='14829'></font>
                                                      <font color=#447700>!               dge range is limited to 5.0 to 140.0 microns<a name='14830'></font>
                                                      <font color=#447700>!               [dge = 1.0315 * r_ec]<a name='14831'></font>
      real  :: relq(pncol, mxlay)                     <font color=#447700>! Cloud water drop effective radius (microns)<a name='14832'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14833'></font>
      real  :: resq(pncol, mxlay)                     <font color=#447700>! Cloud snow effective radius (microns)<a name='14834'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='14835'></font>
      real  :: taucq(pncol, nbndlw, mxlay)            <font color=#447700>! In-cloud optical depth<a name='14836'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw,nlay)<a name='14837'></font>
<font color=#447700>! mji - tauaq dimensions?<a name='14838'></font>
      real  :: tauaq(pncol, mxlay, nbndlw)            <font color=#447700>! aerosol optical depth<a name='14839'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='14840'></font>
<a name='14841'>
<a name='14842'>
      integer :: permuteseed  <font color=#447700>! this is set, below<a name='14843'></font>
      integer  :: icb(16)<a name='14844'>
         <a name='14845'>
      <font color=#447700>! local looping variables<a name='14846'></font>
      integer :: i,j,kk, piplon<a name='14847'>
<a name='14848'>
      <font color=#447700>! cuda return code<a name='14849'></font>
          integer :: ierr<a name='14850'>
      <font color=#447700>! cuda thread and grid block dimensions<a name='14851'></font>
#ifdef _ACCEL<a name='14852'>
      type(dim3) :: dimGrid, dimBlock<a name='14853'>
#endif<a name='14854'>
      <a name='14855'>
      real , dimension(16) :: a0 =(/ 1.66 ,  1.55 ,  1.58 ,  1.66 , &amp;<a name='14856'>
                1.54 , 1.454 ,  1.89 ,  1.33 , &amp;<a name='14857'>
               1.668 ,  1.66 ,  1.66 ,  1.66 , &amp;<a name='14858'>
                1.66 ,  1.66 ,  1.66 ,  1.66  /)<a name='14859'>
      real , dimension(16) :: a1=(/ 0.00 ,  0.25 ,  0.22 ,  0.00 , &amp;<a name='14860'>
                0.13 , 0.446 , -0.10 ,  0.40 , &amp;<a name='14861'>
              -0.006 ,  0.00 ,  0.00 ,  0.00 , &amp;<a name='14862'>
                0.00 ,  0.00 ,  0.00 ,  0.00  /)<a name='14863'>
      real , dimension(16) :: a2 =(/ 0.00 , -12.0 , -11.7 ,  0.00 , &amp;<a name='14864'>
               -0.72 ,-0.243 ,  0.19 ,-0.062 , &amp;<a name='14865'>
               0.414 ,  0.00 ,  0.00 ,  0.00 , &amp;<a name='14866'>
                0.00 ,  0.00 ,  0.00 ,  0.00  /)<a name='14867'>
      real , parameter :: amd = 28.9660     <font color=#447700>! Effective molecular weight of dry air (g/mol)<a name='14868'></font>
      real , parameter :: amw = 18.0160     <font color=#447700>! Molecular weight of water vapor (g/mol)<a name='14869'></font>
<a name='14870'>
<font color=#447700>! (dmb 2012) these arrays were moved to the main routine so that we can bypass some of the <a name='14871'></font>
<font color=#447700>! inatm inefficiencies when running on the GPU<a name='14872'></font>
      real , parameter :: amdw = 1.607793   <font color=#447700>! Molecular weight of dry air / water vapor<a name='14873'></font>
      real , parameter :: amdc = 0.658114   <font color=#447700>! Molecular weight of dry air / carbon dioxide<a name='14874'></font>
      real , parameter :: amdo = 0.603428   <font color=#447700>! Molecular weight of dry air / ozone<a name='14875'></font>
      real , parameter :: amdm = 1.805423   <font color=#447700>! Molecular weight of dry air / methane<a name='14876'></font>
      real , parameter :: amdn = 0.658090   <font color=#447700>! Molecular weight of dry air / nitrous oxide<a name='14877'></font>
      real , parameter :: amdo2 = 0.905140  <font color=#447700>! Molecular weight of dry air / oxygen<a name='14878'></font>
      real , parameter :: amdc1 = 0.210852  <font color=#447700>! Molecular weight of dry air / CFC11<a name='14879'></font>
      real , parameter :: amdc2 = 0.239546  <font color=#447700>! Molecular weight of dry air / CFC12<a name='14880'></font>
      real  :: amm, amttl, wvttl, wvsh, summol  <a name='14881'>
      integer  :: isp, l, ix, n, imol, ib   <font color=#447700>! Loop indices<a name='14882'></font>
      integer, save :: counter =0<a name='14883'>
      real  :: btemp<a name='14884'>
<font color=#447700>!real  :: gwiff1,gwiff2,gwiff3,gwiff4<a name='14885'></font>
<font color=#447700>!integer :: ilay, iplon, igp<a name='14886'></font>
<font color=#447700>!      integer  :: cloudFlagq(pncol, 4)<a name='14887'></font>
      integer _gpudev :: pncold, nlayd, icldd<a name='14888'>
integer,external :: omp_get_thread_num<a name='14889'>
<a name='14890'>
<font color=#447700>!<a name='14891'></font>
#ifndef _ACCEL<a name='14892'>
# undef pncol<a name='14893'>
      ncol_  = pncol ; nlayers_  = nlay ; nbndlw_  = nbndlw ; ngptlw_  = ngptlw <font color=#447700>! for passing through argument list<a name='14894'></font>
      ncol__ = pncol ; nlayers__ = nlay ; nbndlw__ = nbndlw ; ngptlw__ = ngptlw <font color=#447700>! for passing through argument list<a name='14895'></font>
#endif<a name='14896'>
<font color=#447700>! Initializations<a name='14897'></font>
      icb(:) = (/  1,2,3,3,3,4,4,4,5, 5, 5, 5, 5, 5, 5, 5 /)<a name='14898'>
         <a name='14899'>
      oneminus = 1.  - 1.e-6 <a name='14900'>
      pi = 2.  * asin(1. )<a name='14901'>
      fluxfac = pi * 2.e4                   <font color=#447700>! orig:   fluxfac = pi * 2.d4  <a name='14902'></font>
      istart = 1<a name='14903'>
      iend = 16<a name='14904'>
      iout = 0<a name='14905'>
      ims = 1<a name='14906'>
      pncold = pncol<a name='14907'>
      nlayd = nlay<a name='14908'>
    <a name='14909'>
      cldfracq(1:pncol,1:nlay) = cldfrac(colstart:(colstart+pncol-1), 1:nlay)<a name='14910'>
      ciwpq(1:pncol,1:nlay) = ciwp(colstart:(colstart+pncol-1), 1:nlay)<a name='14911'>
      clwpq(1:pncol,1:nlay) = clwp(colstart:(colstart+pncol-1), 1:nlay)<a name='14912'>
      cswpq(1:pncol,1:nlay) = cswp(colstart:(colstart+pncol-1), 1:nlay)<a name='14913'>
      reiq(1:pncol,1:nlay) = rei(colstart:(colstart+pncol-1), 1:nlay)<a name='14914'>
      relq(1:pncol,1:nlay) = rel(colstart:(colstart+pncol-1), 1:nlay)<a name='14915'>
      resq(1:pncol,1:nlay) = res(colstart:(colstart+pncol-1), 1:nlay)<a name='14916'>
      taucq(1:pncol,1:nbndlw,1:nlay) = tauc(colstart:(colstart+pncol-1), 1:nbndlw, 1:nlay)<a name='14917'>
      tauaq(1:pncol,1:nlay,1:nbndlw) = tauaer(colstart:(colstart+pncol-1), 1:nlay, 1:nbndlw)<a name='14918'>
  <a name='14919'>
#ifdef _ACCEL<a name='14920'>
      allocate( cldfmcd(pncol, ngptlw, nlay+1))<a name='14921'>
      allocate( ngbd(140) )<a name='14922'>
#endif<a name='14923'>
           <a name='14924'>
<a name='14925'>
#ifndef _ACCEL<a name='14926'>
#  define pncol CHNK<a name='14927'>
#endif<a name='14928'>
#ifdef _ACCEL<a name='14929'>
      allocate( icbd(16))<a name='14930'>
      allocate( ncbandsd(pncol))<a name='14931'>
      allocate( icldlyr(pncol, nlay+1))<a name='14932'>
   <a name='14933'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUCLDPRMCG'>allocateGPUcldprmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOCATEGPUCLDPRMCG_1">(pncol, nlay, ngptlw)<a name='14934'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPURTRNMCG'>allocateGPUrtrnmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOCATEGPURTRNMCG_1">(pncol, nlay, ngptlw, idrv)<a name='14935'>
  <a name='14936'>
      ngbd = ngb<a name='14937'>
      ngsd = ngs<a name='14938'>
      icldd = icld<a name='14939'>
#else<a name='14940'>
# define nspad nspa<a name='14941'>
# define nspbd nspb<a name='14942'>
# define icbd icb<a name='14943'>
# define fracsd fracs<a name='14944'>
# define ngbd ngb<a name='14945'>
# define ngsd ngs<a name='14946'>
# define icldd icld<a name='14947'>
#endif<a name='14948'>
<a name='14949'>
<font color=#447700>! Set imca to select calculation type:<a name='14950'></font>
<font color=#447700>!  imca = 0, use standard forward model calculation<a name='14951'></font>
<font color=#447700>!  imca = 1, use McICA for Monte Carlo treatment of sub-grid cloud variability<a name='14952'></font>
<a name='14953'>
<font color=#447700>! *** This version uses McICA (imca = 1) ***<a name='14954'></font>
<a name='14955'>
<font color=#447700>! Set icld to select of clear or cloud calculation and cloud overlap method  <a name='14956'></font>
<font color=#447700>! icld = 0, clear only<a name='14957'></font>
<font color=#447700>! icld = 1, with clouds using random cloud overlap<a name='14958'></font>
<font color=#447700>! icld = 2, with clouds using maximum/random cloud overlap<a name='14959'></font>
<font color=#447700>! icld = 3, with clouds using maximum cloud overlap (McICA only)<a name='14960'></font>
<font color=#447700>! icld = 4, with clouds using exponential cloud overlap (INACTIVE; McICA only)<a name='14961'></font>
      if (icld.lt.0.or.icld.gt.4) icld = 2<a name='14962'>
<a name='14963'>
<font color=#447700>! Set iaer to select aerosol option<a name='14964'></font>
<font color=#447700>! iaer = 0, no aerosols<a name='14965'></font>
<font color=#447700>! icld = 10, input total aerosol optical depth (tauaer) directly<a name='14966'></font>
      iaer = 10<a name='14967'>
<a name='14968'>
<font color=#447700>! Call model and data initialization, compute lookup tables, perform<a name='14969'></font>
<font color=#447700>! reduction of g-points from 256 to 140 for input absorption coefficient <a name='14970'></font>
<font color=#447700>! data and other arrays.<a name='14971'></font>
<font color=#447700>!<a name='14972'></font>
<font color=#447700>! In a GCM this call should be placed in the model initialization<a name='14973'></font>
<font color=#447700>! area, since this has to be called only once.  <a name='14974'></font>
<font color=#447700>! call rrtmg_lw_ini(cpdair)<a name='14975'></font>
       <a name='14976'>
<font color=#447700>!     call rrtmg_lw_ini(1.004 )<a name='14977'></font>
<font color=#447700>!  This is the main longitude/column loop within RRTMG.<a name='14978'></font>
<font color=#447700>!  Prepare atmospheric profile from GCM for use in RRTMG, and define<a name='14979'></font>
<font color=#447700>!  other input parameters.  <a name='14980'></font>
<a name='14981'>
<font color=#447700>! (dmb 2012)<a name='14982'></font>
<a name='14983'>
      nlayers = nlay<a name='14984'>
<a name='14985'>
<a name='14986'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUTAUMOL'>allocateGPUTaumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOCATEGPUTAUMOL_1">( pncol, nlayers, npart)<a name='14987'>
<a name='14988'>
#ifdef _ACCEL<a name='14989'>
      allocate( fracsd( pncol, nlayers+1, ngptlw ))<a name='14990'>
      allocate( taug( pncol, nlayers+1, ngptlw ))<a name='14991'>
#endif<a name='14992'>
      tbound = tsfc(colstart:(colstart+pncol-1))<a name='14993'>
      pz(:,0:nlay) = plev(colstart:(colstart+pncol-1),0:nlay)<a name='14994'>
      tz(:,0:nlay) = tlev(colstart:(colstart+pncol-1),0:nlay)<a name='14995'>
      pavel(:,1:nlay) = play(colstart:(colstart+pncol-1),1:nlay)<a name='14996'>
      tavel(:,1:nlay) = tlay(colstart:(colstart+pncol-1),1:nlay)<a name='14997'>
      <a name='14998'>
#ifdef _ACCEL<a name='14999'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOLMOL'>copyGPUTaumolMol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYGPUTAUMOLMOL_1">( colstart, pncol, nlayers, h2ovmr, co2vmr, o3vmr, n2ovmr, ch4vmr, &amp;<a name='15000'>
                             o2vmr, ccl4vmr, cfc11vmr, cfc12vmr, cfc22vmr, npart)<a name='15001'>
#else<a name='15002'>
      colh2o(1:pncol, 1:nlayers) = h2ovmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15003'>
      colco2(1:pncol, 1:nlayers) = co2vmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15004'>
      colo3(1:pncol, 1:nlayers) = o3vmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15005'>
      coln2o(1:pncol, 1:nlayers) = n2ovmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15006'>
<a name='15007'>
      colch4(1:pncol, 1:nlayers) = ch4vmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15008'>
      colo2(1:pncol, 1:nlayers) = o2vmr( colstart:(colstart+pncol-1), 1:nlayers)<a name='15009'>
      wx1(1:pncol, 1:nlayers) = ccl4vmr(colstart:(colstart+pncol-1), 1:nlayers)<a name='15010'>
      wx2(1:pncol, 1:nlayers) = cfc11vmr(colstart:(colstart+pncol-1), 1:nlayers)<a name='15011'>
      wx3(1:pncol, 1:nlayers) = cfc12vmr(colstart:(colstart+pncol-1), 1:nlayers)<a name='15012'>
      wx4(1:pncol, 1:nlayers) = cfc22vmr(colstart:(colstart+pncol-1), 1:nlayers)<a name='15013'>
      colco(1:pncol, :) = 0<a name='15014'>
      if (npart &gt; 1) then<a name='15015'>
         tauaa(1:pncol, :, :)  = tauaer(colstart:(colstart+pncol-1), :, :)<a name='15016'>
      else<a name='15017'>
         tauaa = tauaer<a name='15018'>
      endif<a name='15019'>
#endif<a name='15020'>
<a name='15021'>
#ifndef _ACCEL<a name='15022'>
#  undef pncol<a name='15023'>
#endif<a name='15024'>
<a name='15025'>
      permuteseed=150 <font color=#447700>! if you change this, change value in module_ra_rrtmg_lw.F<a name='15026'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MCICA_SUBCOL_LWG'>mcica_subcol_lwg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MCICA_SUBCOL_LWG_1">(colstart, pncol, nlay, icld, counter, permuteseed,            &amp;<a name='15027'>
#ifndef _ACCEL<a name='15028'>
                            pmid,clwp,ciwp,cswp,tauc,                                     &amp;<a name='15029'>
#endif<a name='15030'>
                            play, cldfracq, ciwpq,                                        &amp;<a name='15031'>
                            clwpq, cswpq, taucq,ngbd, cldfmcd, ciwpmcd, clwpmcd, cswpmcd, &amp; <a name='15032'>
                            taucmcd)<a name='15033'>
<a name='15034'>
<a name='15035'>
<font color=#447700>!jm write(0,*)__FILE__,__LINE__,omp_get_thread_num()<a name='15036'></font>
<a name='15037'>
<font color=#447700>!  Generate the stochastic subcolumns of cloud optical properties for the longwave;<a name='15038'></font>
#ifdef _ACCEL<a name='15039'>
      dimGrid = dim3( (ncol+255)/256,(140+1)/2, 1)<a name='15040'>
      dimBlock = dim3( 256,2,1)<a name='15041'>
#endif<a name='15042'>
      if (icld &gt; 0) then<a name='15043'>
         call generate_stochastic_cloudsg _gpuchv (pncold, nlayd, icldd, ngbd, &amp;<a name='15044'>
#ifndef _ACCEL<a name='15045'>
                               pmid,cldfracq,clwpq,ciwpq,cswpq,taucq,permuteseed,  &amp;<a name='15046'>
#endif<a name='15047'>
                               cldfmcd, clwpmcd, ciwpmcd, cswpmcd, taucmcd)<a name='15048'>
      end if<a name='15049'>
<a name='15050'>
<font color=#447700>!jm write(0,*)__FILE__,__LINE__,omp_get_thread_num()<a name='15051'></font>
      do iplon = 1, pncol<a name='15052'>
 <a name='15053'>
        piplon = iplon + colstart - 1<a name='15054'>
        amttl = 0.0 <a name='15055'>
        wvttl = 0.0 <a name='15056'>
        do l = 1, nlayers<a name='15057'>
          amm = (1.  - h2ovmr(piplon,l)) * amd +h2ovmr(piplon,l) * amw            <a name='15058'>
          coldry(iplon, l) = (pz(iplon, l-1)-pz(iplon, l)) * 1.e3  * avogad / &amp;<a name='15059'>
                     (1.e2  * grav * amm * (1.  + h2ovmr(piplon,l)))<a name='15060'>
        end do<a name='15061'>
         <a name='15062'>
        do l = 1, nlayers<a name='15063'>
          summol = co2vmr(piplon,l) + o3vmr(piplon,l) + n2ovmr(piplon,l) + ch4vmr(piplon,l) + o2vmr(piplon,l) <a name='15064'>
          btemp = h2ovmr(piplon, l) * coldry(iplon, l)<a name='15065'>
          wbrodl(iplon, l) = coldry(iplon, l) * (1.  - summol)<a name='15066'>
          amttl = amttl + coldry(iplon, l)+btemp<a name='15067'>
          wvttl = wvttl + btemp<a name='15068'>
        enddo<a name='15069'>
<a name='15070'>
        wvsh = (amw * wvttl) / (amd * amttl)<a name='15071'>
        pwvcm(iplon) = wvsh * (1.e3  * pz(iplon, 0)) / (1.e2  * grav)<a name='15072'>
    <a name='15073'>
<font color=#447700>! Transfer aerosol optical properties to RRTM variable;<a name='15074'></font>
<font color=#447700>! modify to reverse layer indexing here if necessary.<a name='15075'></font>
<a name='15076'>
        if (icld .ge. 1) then <a name='15077'>
          inflag(iplon) = inflglw<a name='15078'>
          iceflag(iplon) = iceflglw<a name='15079'>
          liqflag(iplon) = liqflglw<a name='15080'>
<a name='15081'>
<font color=#447700>! Move incoming GCM cloud arrays to RRTMG cloud arrays.<a name='15082'></font>
<font color=#447700>! For GCM input, incoming reicmcl is defined based on selected ice parameterization (inflglw)<a name='15083'></font>
<a name='15084'>
        endif<a name='15085'>
      enddo<a name='15086'>
<a name='15087'>
#ifdef _ACCEL<a name='15088'>
      deallocate( pmidd, cldfracd)<a name='15089'>
      deallocate( clwpd, ciwpd, cswpd, taucd)<a name='15090'>
<a name='15091'>
<font color=#447700>!  For cloudy atmosphere, use cldprmc to set cloud optical properties based on<a name='15092'></font>
<font color=#447700>!  input cloud physical properties.  Select method based on choices described<a name='15093'></font>
<font color=#447700>!  in cldprmc.  Cloud fraction, water path, liquid droplet and ice particle<a name='15094'></font>
<font color=#447700>!  effective radius must be passed into cldprmc.  Cloud fraction and cloud<a name='15095'></font>
<font color=#447700>!  optical depth are transferred to rrtmg_lw arrays in cldprmc.  <a name='15096'></font>
<a name='15097'>
<font color=#447700>! If the GPU flag is active, then we call the GPU code.  Otherwise, call the CPU code   <a name='15098'></font>
<a name='15099'>
<font color=#447700>! (dmb 2012) Copy the needed arrays over to the GPU for the cldprmc subroutine.<a name='15100'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUCLDPRMCG'>copyGPUcldprmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYGPUCLDPRMCG_1">( inflag, iceflag, liqflag,&amp;<a name='15101'>
                                 absice0, absice1, absice2, absice3, absliq1 )<a name='15102'>
  <a name='15103'>
<font color=#447700>! copy common arrays over to the GPU<a name='15104'></font>
      icbd = icb<a name='15105'>
      a0d=a0<a name='15106'>
      a1d=a1<a name='15107'>
      a2d=a2<a name='15108'>
      delwaved=delwave<a name='15109'>
      relqmcd = relq<a name='15110'>
      reicmcd = reiq<a name='15111'>
      resnmcd = resq<a name='15112'>
#else<a name='15113'>
#  define a0d a0<a name='15114'>
#  define a1d a1<a name='15115'>
#  define a2d a2<a name='15116'>
#  define delwaved delwave<a name='15117'>
#  define relqmcd relq<a name='15118'>
#  define reicmcd reiq<a name='15119'>
#  define resnmcd resq<a name='15120'>
#endif<a name='15121'>
<a name='15122'>
      icldlyr = 0.0<a name='15123'>
<a name='15124'>
#ifdef _ACCEL<a name='15125'>
<font color=#447700>! (dmb 2012) Allocate the arrays for the SetCoef and Taumol kernels<a name='15126'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#ALLOCATEGPUSETCOEF'>allocateGPUSetCoef</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOCATEGPUSETCOEF_1">( pncol, nlayers)<a name='15127'>
      <a name='15128'>
<font color=#447700>! (dmb 2012) Copy the needed data of to the GPU for the SetCoef and Taumol kernels<a name='15129'></font>
<a name='15130'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUTAUMOL'>copyGPUTaumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYGPUTAUMOL_1">( pavel, wx, coldry, tauaer, pncol, colstart, nlay , npart)<a name='15131'>
<a name='15132'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPUSETCOEF'>copyGPUSetCoef</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYGPUSETCOEF_1">( )<a name='15133'>
<font color=#447700>! (dmb 2012) Copy over additional common arrays <a name='15134'></font>
      taveld = tavel<a name='15135'>
      tzd = tz<a name='15136'>
      tboundd = tbound<a name='15137'>
      wbroadd = wbrodl<a name='15138'>
<font color=#447700>!      wkld = wkl<a name='15139'></font>
      semissd(1:pncol,1:nbndlw) = emis(colstart:(colstart+pncol-1),1:nbndlw)<a name='15140'>
<a name='15141'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYTOGPUREF'>copyToGPUref</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYTOGPUREF_1">()<a name='15142'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#COPYGPURTRNMCG'>copyGPUrtrnmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COPYGPURTRNMCG_1">(pz, pwvcm, idrv, taut)<a name='15143'>
#else<a name='15144'>
<a name='15145'>
      semissd(1:pncol,1:nbndlw) = emis(colstart:(colstart+pncol-1),1:nbndlw)<a name='15146'>
<a name='15147'>
# define tzd tz<a name='15148'>
# define taveld tavel<a name='15149'>
# define tboundd tbound<a name='15150'>
# define wbroadd wbrodl<a name='15151'>
<a name='15152'>
# define pzd pz<a name='15153'>
# define pwvcmd pwvcm<a name='15154'>
# define idrvd idrv<a name='15155'>
# define bpaded bpade<a name='15156'>
# define heatfacd heatfac<a name='15157'>
# define fluxfacd fluxfac<a name='15158'>
# define oneminusd oneminus<a name='15159'>
#endif<a name='15160'>
 <a name='15161'>
<font color=#447700>! (dmb 2012) Here we configure the grids and blocks to run the cldpmcd kernel<a name='15162'></font>
<font color=#447700>! on the GPU.  I decided to keep the block dimensions to 16x16 to coincide with<a name='15163'></font>
<font color=#447700>! coalesced memory access when I am able to parition the profiles to multiples<a name='15164'></font>
<font color=#447700>! of 32.<a name='15165'></font>
#ifdef _ACCEL<a name='15166'>
      dimGrid = dim3( (pncol+255)/256,(nlayers)/1, ngptlw)<a name='15167'>
      dimBlock = dim3( 256,1,1)<a name='15168'>
#endif<a name='15169'>
<font color=#447700>!     clwpmcd = 0<a name='15170'></font>
<font color=#447700>!     clwpmcd = clwpmc<a name='15171'></font>
<font color=#447700>! (dmb 2012) Call the cldprmcg kernel<a name='15172'></font>
      call cldprmcg _gpuchv (pncol, nlayers,                                      &amp;<a name='15173'>
#ifndef _ACCEL<a name='15174'>
                inflag,iceflag,liqflag,ciwpmcd,clwpmcd,cswpmcd,relqmcd,reicmcd,resnmcd, &amp;<a name='15175'>
                absice0,absice1,absice2,absice3,absliq1,                                &amp;<a name='15176'>
#endif<a name='15177'>
                cldfmcd, taucmcd,  ngbd, icbd, ncbandsd, icldlyr)<a name='15178'>
<a name='15179'>
<font color=#447700>! synchronize the GPU with the CPU before taking timing results or passing data back to the CPU<a name='15180'></font>
#ifdef _ACCEL    <a name='15181'>
      ierr = cudaThreadSynchronize() <a name='15182'>
#endif<a name='15183'>
   <a name='15184'>
<a name='15185'>
<font color=#447700>! Calculate information needed by the radiative transfer routine<a name='15186'></font>
<font color=#447700>! that is specific to this atmosphere, especially some of the <a name='15187'></font>
<font color=#447700>! coefficients and indices needed to compute the optical depths<a name='15188'></font>
<font color=#447700>! by interpolating data from stored reference atmospheres. <a name='15189'></font>
<a name='15190'>
<font color=#447700>! (dmb 2012) Initialize the grid and block dimensions and call the setcoefg kernel<a name='15191'></font>
#ifdef _ACCEL<a name='15192'>
      dimGrid = dim3( (pncol+255)/256,1, 1)<a name='15193'>
      dimBlock = dim3( 256,1,1)<a name='15194'>
#endif<a name='15195'>
      call setcoefg _gpuchv (pncol, nlayers, istart                    &amp;<a name='15196'>
# include "<A href='../../html_code/include/rrtmg_lw_cpu_args.h.html'>rrtmg_lw_cpu_args.h</A>"<A NAME="rrtmg_lw_cpu_args.h_62"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='15197'>
# include "<A href='../../html_code/include/taug_cpu_args.h.html'>taug_cpu_args.h</A>"<A NAME="taug_cpu_args.h_63"><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='15198'>
#ifndef _ACCEL<a name='15199'>
   ,tavel,tz,tbound,wbroadd,totplnk,totplk16,totplnkderiv,totplk16deriv &amp;<a name='15200'>
#endif<a name='15201'>
                            )<a name='15202'>
<a name='15203'>
<font color=#447700>! (dmb 2012) end if GPU flag <a name='15204'></font>
<a name='15205'>
<font color=#447700>!  Calculate the gaseous optical depths and Planck fractions for <a name='15206'></font>
<font color=#447700>!  each longwave spectral band.<a name='15207'></font>
<a name='15208'>
<font color=#447700>! (dmb 2012) Call the taumolg subroutine.  This subroutine calls all of the individal taumol kernels.     <a name='15209'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TAUMOLG'>taumolg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUMOLG_1">(1, pncol,nlayers, ngbd, taug, fracsd &amp;<a name='15210'>
<font color=#447700>!# include "taug_cpu_args.h"<a name='15211'></font>
#ifndef _ACCEL<a name='15212'>
                    ,ncol__,nlayers__,nbndlw__,ngptlw__                                             &amp;<a name='15213'>
                    ,pavel,wx1,wx2,wx3,wx4,coldry,laytrop,jp,jt,jt1,colh2o,colco2,colo3,coln2o  &amp;<a name='15214'>
                    ,colco,colch4,colo2,colbrd,indself,indfor,selffac,selffrac,forfac,forfrac   &amp;<a name='15215'>
                    ,indminor,minorfrac,scaleminor,scaleminorn2,fac00,fac01,fac10,fac11         &amp;<a name='15216'>
                    ,rat_h2oco2,rat_h2oco2_1,rat_h2oo3,rat_h2oo3_1,rat_h2on2o,rat_h2on2o_1      &amp;<a name='15217'>
                    ,rat_h2och4,rat_h2och4_1,rat_n2oco2,rat_n2oco2_1,rat_o3co2,rat_o3co2_1      &amp;<a name='15218'>
                    ,tauaa,nspad,nspbd,oneminusd                                                &amp;<a name='15219'>
#endif<a name='15220'>
                  )<a name='15221'>
   <a name='15222'>
<font color=#447700>! Call the radiative transfer routine.<a name='15223'></font>
<font color=#447700>! Either routine can be called to do clear sky calculation.  If clouds<a name='15224'></font>
<font color=#447700>! are present, then select routine based on cloud overlap assumption<a name='15225'></font>
<font color=#447700>! to be used.  Clear sky calculation is done simultaneously.<a name='15226'></font>
<font color=#447700>! For McICA, RTRNMC is called for clear and cloudy calculations.<a name='15227'></font>
<a name='15228'>
   <a name='15229'>
#ifdef _ACCEL<a name='15230'>
      ierr = cudaThreadSynchronize()<a name='15231'>
#endif <a name='15232'>
   <a name='15233'>
#ifdef _ACCEL    <a name='15234'>
      dimGrid = dim3( (pncol+255)/256, 70, 1)<a name='15235'>
      dimBlock = dim3( 256,2,1)<a name='15236'>
#endif    <a name='15237'>
<a name='15238'>
      call rtrnmcg _gpuchv (pncol,nlayers, istart, iend, iout  &amp;<a name='15239'>
#ifndef _ACCEL<a name='15240'>
         ,ncol_,nlayers_,nbndlw_,ngptlw_                                                          &amp;<a name='15241'>
         ,taucmcd,pzd,pwvcmd,semissd,planklayd,planklevd,plankbndd,gurad,gdrad,gclrurad,gclrdrad  &amp;<a name='15242'>
         ,gdtotuflux_dtd,gdtotuclfl_dtd,idrvd,bpaded,heatfacd,fluxfacd,a0d,a1d,a2d                &amp;<a name='15243'>
         ,delwaved,totufluxd,totdfluxd,fnetd,htrd,totuclfld,totdclfld,fnetcd,htrcd,dtotuflux_dtd  &amp;<a name='15244'>
         ,dtotuclfl_dtd,dplankbnd_dtd                                                             &amp;<a name='15245'>
#endif<a name='15246'>
                    ,ngbd, icldlyr, taug, fracsd, cldfmcd)<a name='15247'>
<a name='15248'>
#ifdef _ACCEL<a name='15249'>
      ierr = cudaThreadSynchronize() <a name='15250'>
#endif<a name='15251'>
<a name='15252'>
<font color=#447700>!jm write(0,*)__FILE__,__LINE__,omp_get_thread_num()<a name='15253'></font>
<a name='15254'>
<font color=#447700>! sum up the results<a name='15255'></font>
  <a name='15256'>
      totufluxd = 0.0<a name='15257'>
      totdfluxd = 0.0<a name='15258'>
      totuclfld = 0.0<a name='15259'>
      totdclfld = 0.0<a name='15260'>
      dtotuflux_dtd = 0.0<a name='15261'>
      dtotuclfl_dtd = 0.0<a name='15262'>
<a name='15263'>
#ifdef _ACCEL<a name='15264'>
      dimGrid = dim3( (pncol+255)/256,nlayers+1,1)<a name='15265'>
      dimBlock = dim3( 256, 1, 1)<a name='15266'>
#endif<a name='15267'>
<a name='15268'>
      uflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totufluxd(1:pncol,0:(nlayers))<a name='15269'>
      dflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totdfluxd(1:pncol,0:(nlayers))<a name='15270'>
<a name='15271'>
<font color=#447700>! (dmb 2012) Here we integrate across the g-point fluxes to arrive at total fluxes<a name='15272'></font>
<font color=#447700>! This functionality was factored out of the original rtrnmc routine so that I could<a name='15273'></font>
<font color=#447700>! parallelize across multiple dimensions.<a name='15274'></font>
      call rtrnadd _gpuchv (pncol, nlayers, ngptlw, idrv &amp;<a name='15275'>
#ifndef _ACCEL<a name='15276'>
         ,ncol_,nlayers_,nbndlw_,ngptlw_                                                          &amp;<a name='15277'>
         ,taucmcd,pzd,pwvcmd,semissd,planklayd,planklevd,plankbndd,gurad,gdrad,gclrurad,gclrdrad  &amp;<a name='15278'>
         ,gdtotuflux_dtd,gdtotuclfl_dtd,idrvd,bpaded,heatfacd,fluxfacd,a0d,a1d,a2d                &amp;<a name='15279'>
         ,delwaved,totufluxd,totdfluxd,fnetd,htrd,totuclfld,totdclfld,fnetcd,htrcd,dtotuflux_dtd  &amp;<a name='15280'>
         ,dtotuclfl_dtd,dplankbnd_dtd                                                             &amp;<a name='15281'>
#endif<a name='15282'>
                           )<a name='15283'>
#ifdef _ACCEL<a name='15284'>
      ierr = cudaThreadSynchronize()<a name='15285'>
      dimGrid = dim3( (pncol+255)/256,nlayers,1)<a name='15286'>
#endif<a name='15287'>
<a name='15288'>
      uflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totufluxd(1:pncol,0:(nlayers))<a name='15289'>
      dflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totdfluxd(1:pncol,0:(nlayers))<a name='15290'>
<a name='15291'>
<font color=#447700>! (dmb 2012) Calculate the heating rates.<a name='15292'></font>
      call rtrnheatrates _gpuchv (pncol, nlayers &amp;<a name='15293'>
#ifndef _ACCEL<a name='15294'>
         ,ncol_,nlayers_,nbndlw_,ngptlw_                                                          &amp;<a name='15295'>
         ,taucmcd,pzd,pwvcmd,semissd,planklayd,planklevd,plankbndd,gurad,gdrad,gclrurad,gclrdrad  &amp;<a name='15296'>
         ,gdtotuflux_dtd,gdtotuclfl_dtd,idrvd,bpaded,heatfacd,fluxfacd,a0d,a1d,a2d                &amp;<a name='15297'>
         ,delwaved,totufluxd,totdfluxd,fnetd,htrd,totuclfld,totdclfld,fnetcd,htrcd,dtotuflux_dtd  &amp;<a name='15298'>
         ,dtotuclfl_dtd,dplankbnd_dtd                                                             &amp;<a name='15299'>
#endif<a name='15300'>
                                 )    <a name='15301'>
#ifdef _ACCEL<a name='15302'>
      ierr = cudaThreadSynchronize() <a name='15303'>
#endif    <a name='15304'>
<a name='15305'>
<font color=#447700>! copy the partition data back to the CPU<a name='15306'></font>
#if 0<a name='15307'>
<font color=#447700>!these are redundant with the copies before the call to rtrnheatrates, above<a name='15308'></font>
      uflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totufluxd(1:pncol,0:(nlayers))<a name='15309'>
      dflx(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totdfluxd(1:pncol,0:(nlayers))<a name='15310'>
#endif<a name='15311'>
      uflxc(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totuclfld(1:pncol,0:(nlayers))<a name='15312'>
      dflxc(colstart:(colstart+pncol-1), 1:(nlayers+1)) = totdclfld(1:pncol,0:(nlayers))<a name='15313'>
      hr(colstart:(colstart+pncol-1), 1:(nlayers+1)) = htrd(1:pncol,0:(nlayers))<a name='15314'>
      hrc(colstart:(colstart+pncol-1), 1:(nlayers+1)) = htrcd(1:pncol,0:(nlayers))<a name='15315'>
<a name='15316'>
      if (idrv .eq. 1) then<a name='15317'>
<a name='15318'>
         duflx_dt(colstart:(colstart+pncol-1), 1:(nlayers+1)) = dtotuflux_dtd(1:pncol,0:(nlayers))<a name='15319'>
         duflxc_dt(colstart:(colstart+pncol-1), 1:(nlayers+1)) = dtotuclfl_dtd(1:pncol,0:(nlayers))<a name='15320'>
 <a name='15321'>
      end if<a name='15322'>
<a name='15323'>
<font color=#447700>!jm write(0,*)__FILE__,__LINE__,omp_get_thread_num()<a name='15324'></font>
<a name='15325'>
<font color=#447700>!  Transfer up and down fluxes and heating rate to output arrays.<a name='15326'></font>
<font color=#447700>!  Vertical indexing goes from bottom to top; reverse here for GCM if necessary.<a name='15327'></font>
#ifdef _ACCEL<a name='15328'>
      deallocate( cldfmcd)<a name='15329'>
      deallocate( icbd)<a name='15330'>
      deallocate( ncbandsd)<a name='15331'>
      deallocate( icldlyr)<a name='15332'>
<a name='15333'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUTAUMOL'>deallocateGPUTaumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOCATEGPUTAUMOL_1">()<a name='15334'>
      deallocate( fracsd)<a name='15335'>
      deallocate( taug)<a name='15336'>
      deallocate( ngbd)<a name='15337'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUCLDPRMCG'>deallocateGPUcldprmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOCATEGPUCLDPRMCG_1">()<a name='15338'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPURTRNMCG'>deallocateGPUrtrnmcg</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOCATEGPURTRNMCG_1">(idrv)<a name='15339'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#DEALLOCATEGPUSETCOEF'>deallocateGPUSetCoef</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOCATEGPUSETCOEF_1">( )<a name='15340'>
#else<a name='15341'>
# undef tzd<a name='15342'>
# undef taveld<a name='15343'>
# undef tboundd<a name='15344'>
# undef wbroadd<a name='15345'>
<a name='15346'>
# undef ngbd<a name='15347'>
# undef ngsd<a name='15348'>
# undef icldd<a name='15349'>
# undef pzd<a name='15350'>
# undef pwvcmd<a name='15351'>
# undef idrvd<a name='15352'>
# undef bpaded<a name='15353'>
# undef heatfacd<a name='15354'>
# undef fluxfacd<a name='15355'>
# undef a0d<a name='15356'>
# undef a1d<a name='15357'>
# undef a2d<a name='15358'>
# undef delwaved<a name='15359'>
# undef oneminusd<a name='15360'>
# undef nspad<a name='15361'>
# undef nspbd<a name='15362'>
# undef icbd<a name='15363'>
# undef fracsd<a name='15364'>
#endif<a name='15365'>
 <a name='15366'>
      end subroutine rrtmg_lw_part<a name='15367'>
<a name='15368'>
      end module rrtmg_lw_rad_f<a name='15369'>
<a name='15370'>
#ifndef _ACCEL<a name='15371'>
# undef pncol<a name='15372'>
# undef pncold<a name='15373'>
#endif<a name='15374'>
<a name='15375'>
<a name='15376'>
<font color=#447700>!------------------------------------------------------------------<a name='15377'></font>
<A NAME='MODULE_RA_RRTMG_LWF'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#MODULE_RA_RRTMG_LWF' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='15378'>
      <font color=#993300>MODULE </font><font color=#cc0000>module_ra_rrtmg_lwf</font> <A href='../../call_to/MODULE_RA_RRTMG_LWF.html' TARGET='index'>3</A><a name='15379'>
<a name='15380'>
      use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_84">, only : cp<a name='15381'>
      use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_79"><a name='15382'>
<font color=#447700>!     use module_dm<a name='15383'></font>
<a name='15384'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#PARRRTM_F'>parrrtm_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_F_44">, only : nbndlw, ngptlw<a name='15385'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INIT_F'>rrtmg_lw_init_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_INIT_F_1">, only: rrtmg_lw_ini<a name='15386'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_RAD_F'>rrtmg_lw_rad_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_PART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_RAD_F_1">, only: rrtmg_lw<a name='15387'>
<font color=#447700>!      use mcica_subcol_gen_lw, only: mcica_subcol_lw<a name='15388'></font>
<a name='15389'>
      real retab(95)<a name='15390'>
      data retab /                                              &amp;<a name='15391'>
         5.92779, 6.26422, 6.61973, 6.99539, 7.39234,           &amp;<a name='15392'>
         7.81177, 8.25496, 8.72323, 9.21800, 9.74075, 10.2930,  &amp;<a name='15393'>
         10.8765, 11.4929, 12.1440, 12.8317, 13.5581, 14.2319,  &amp;<a name='15394'>
         15.0351, 15.8799, 16.7674, 17.6986, 18.6744, 19.6955,  &amp;<a name='15395'>
         20.7623, 21.8757, 23.0364, 24.2452, 25.5034, 26.8125,  &amp;<a name='15396'>
         27.7895, 28.6450, 29.4167, 30.1088, 30.7306, 31.2943,  &amp;<a name='15397'>
         31.8151, 32.3077, 32.7870, 33.2657, 33.7540, 34.2601,  &amp;<a name='15398'>
         34.7892, 35.3442, 35.9255, 36.5316, 37.1602, 37.8078,  &amp;<a name='15399'>
         38.4720, 39.1508, 39.8442, 40.5552, 41.2912, 42.0635,  &amp;<a name='15400'>
         42.8876, 43.7863, 44.7853, 45.9170, 47.2165, 48.7221,  &amp;<a name='15401'>
         50.4710, 52.4980, 54.8315, 57.4898, 60.4785, 63.7898,  &amp;<a name='15402'>
         65.5604, 71.2885, 75.4113, 79.7368, 84.2351, 88.8833,  &amp;<a name='15403'>
         93.6658, 98.5739, 103.603, 108.752, 114.025, 119.424,  &amp;<a name='15404'>
         124.954, 130.630, 136.457, 142.446, 148.608, 154.956,  &amp;<a name='15405'>
         161.503, 168.262, 175.248, 182.473, 189.952, 197.699,  &amp;<a name='15406'>
         205.728, 214.055, 222.694, 231.661, 240.971, 250.639/  <a name='15407'>
    <font color=#447700>!<a name='15408'></font>
      save retab<a name='15409'>
    <font color=#447700>! For buffer layer adjustment.  Steven Cavallo, Dec 2010.<a name='15410'></font>
      INTEGER , SAVE    :: nlayers    <a name='15411'>
      REAL, PARAMETER :: deltap = 4.  <font color=#447700>! Pressure interval for buffer layer in mb<a name='15412'></font>
    <a name='15413'>
      CONTAINS<a name='15414'>
<a name='15415'>
<font color=#447700>!------------------------------------------------------------------<a name='15416'></font>
<A NAME='RRTMG_LWRAD_FAST'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='15417'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>RRTMG_LWRAD_FAST</font>(                                &amp; <A href='../../call_to/RRTMG_LWRAD_FAST.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LWRAD_FAST.html' TARGET='index'>17</A><a name='15418'>
                       rthratenlw,                                &amp;<a name='15419'>
                       lwupt, lwuptc, lwdnt, lwdntc,              &amp;<a name='15420'>
                       lwupb, lwupbc, lwdnb, lwdnbc,              &amp;<a name='15421'>
<font color=#447700>!                      lwupflx, lwupflxc, lwdnflx, lwdnflxc,      &amp;<a name='15422'></font>
                       glw, olr, lwcf, emiss,                     &amp;<a name='15423'>
                       p8w, p3d, pi3d,                            &amp;<a name='15424'>
                       dz8w, tsk, t3d, t8w, rho3d, r, g,          &amp;<a name='15425'>
                       icloud, warm_rain, cldfra3d,               &amp;<a name='15426'>
                       lradius,iradius,                           &amp; <a name='15427'>
                       is_cammgmp_used,                           &amp; <a name='15428'>
                       f_ice_phy, f_rain_phy,                     &amp;<a name='15429'>
                       xland, xice, snow,                         &amp;<a name='15430'>
                       qv3d, qc3d, qr3d,                          &amp;<a name='15431'>
                       qi3d, qs3d, qg3d,                          &amp;<a name='15432'>
                       o3input, o33d,                             &amp;<a name='15433'>
                       f_qv, f_qc, f_qr, f_qi, f_qs, f_qg,        &amp;<a name='15434'>
                       re_cloud, re_ice, re_snow,                 &amp;  <font color=#447700>! G. Thompson<a name='15435'></font>
                       has_reqc, has_reqi, has_reqs,              &amp;  <font color=#447700>! G. Thompson<a name='15436'></font>
                       tauaerlw1,tauaerlw2,tauaerlw3,tauaerlw4,   &amp; <font color=#447700>! czhao <a name='15437'></font>
                       tauaerlw5,tauaerlw6,tauaerlw7,tauaerlw8,   &amp; <font color=#447700>! czhao <a name='15438'></font>
                       tauaerlw9,tauaerlw10,tauaerlw11,tauaerlw12,   &amp; <font color=#447700>! czhao <a name='15439'></font>
                       tauaerlw13,tauaerlw14,tauaerlw15,tauaerlw16,   &amp; <font color=#447700>! czhao <a name='15440'></font>
                       aer_ra_feedback,                           &amp; <font color=#447700>!czhao<a name='15441'></font>
<font color=#447700>!jdfcz                 progn,prescribe,                           &amp; !czhao<a name='15442'></font>
                       progn,                                     &amp; <font color=#447700>!czhao<a name='15443'></font>
                       qndrop3d,f_qndrop,                         &amp; <font color=#447700>!czhao<a name='15444'></font>
<font color=#447700>!ccc added for time varying gases.<a name='15445'></font>
                       yr,julian,                                 &amp;<a name='15446'>
<font color=#447700>!ccc<a name='15447'></font>
                       ids,ide, jds,jde, kds,kde,                 &amp; <a name='15448'>
                       ims,ime, jms,jme, kms,kme,                 &amp;<a name='15449'>
                       its,ite, jts,jte, kts,kte,                 &amp;<a name='15450'>
                       lwupflx, lwupflxc, lwdnflx, lwdnflxc       &amp;<a name='15451'>
                                                                  )<a name='15452'>
<font color=#447700>!------------------------------------------------------------------<a name='15453'></font>
<font color=#447700>!ccc To use clWRF time varying trace gases<a name='15454'></font>
   USE <A href='../../html_code/phys/module_ra_clWRF_support.F.html#MODULE_RA_CLWRF_SUPPORT'>MODULE_RA_CLWRF_SUPPORT</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_CLWRF_SUPPORT_4">, ONLY : read_CAMgases<a name='15455'>
<a name='15456'>
   IMPLICIT NONE<a name='15457'>
<font color=#447700>!------------------------------------------------------------------<a name='15458'></font>
   LOGICAL, INTENT(IN )      ::        warm_rain<a name='15459'>
   LOGICAL, INTENT(IN )      ::   is_CAMMGMP_used <font color=#447700>! Added for CAM5 RRTMG&lt;-&gt;CAMMGMP<a name='15460'></font>
<font color=#447700>!<a name='15461'></font>
   INTEGER, INTENT(IN )      ::        ids,ide, jds,jde, kds,kde, &amp;<a name='15462'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='15463'>
                                       its,ite, jts,jte, kts,kte<a name='15464'>
<a name='15465'>
   INTEGER, INTENT(IN )      ::        ICLOUD<a name='15466'>
<font color=#447700>!<a name='15467'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='15468'>
         INTENT(IN   ) ::                                   dz8w, &amp;<a name='15469'>
                                                             t3d, &amp;<a name='15470'>
                                                             t8w, &amp;<a name='15471'>
                                                             p8w, &amp;<a name='15472'>
                                                             p3d, &amp;<a name='15473'>
                                                            pi3d, &amp;<a name='15474'>
                                                           rho3d<a name='15475'>
<a name='15476'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='15477'>
         INTENT(INOUT)  ::                            RTHRATENLW<a name='15478'>
<a name='15479'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='15480'>
         INTENT(INOUT)  ::                                   GLW, &amp;<a name='15481'>
                                                             OLR, &amp;<a name='15482'>
                                                            LWCF<a name='15483'>
<a name='15484'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='15485'>
         INTENT(IN   )  ::                                 EMISS, &amp;<a name='15486'>
                                                             TSK<a name='15487'>
<a name='15488'>
   REAL, INTENT(IN  )   ::                                   R,G<a name='15489'>
<a name='15490'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='15491'>
         INTENT(IN   )  ::                                 XLAND, &amp;<a name='15492'>
                                                            XICE, &amp;<a name='15493'>
                                                            SNOW<a name='15494'>
<font color=#447700>!ccc Added for time-varying trace gases.<a name='15495'></font>
   INTEGER, INTENT(IN    ) ::                                 yr<a name='15496'>
   REAL, INTENT(IN    ) ::                                julian<a name='15497'>
<font color=#447700>!ccc<a name='15498'></font>
<a name='15499'>
<font color=#447700>!<a name='15500'></font>
<font color=#447700>! Optional<a name='15501'></font>
<font color=#447700>!<a name='15502'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='15503'>
         OPTIONAL                                               , &amp;<a name='15504'>
         INTENT(IN   ) ::                                         &amp;<a name='15505'>
                                                        CLDFRA3D, &amp;<a name='15506'>
                                                         LRADIUS, &amp;<a name='15507'>
                                                         IRADIUS, &amp;<a name='15508'>
<a name='15509'>
                                                            QV3D, &amp;<a name='15510'>
                                                            QC3D, &amp;<a name='15511'>
                                                            QR3D, &amp;<a name='15512'>
                                                            QI3D, &amp;<a name='15513'>
                                                            QS3D, &amp;<a name='15514'>
                                                            QG3D, &amp;<a name='15515'>
                                                        QNDROP3D<a name='15516'>
<a name='15517'>
<font color=#447700>!..Added by G. Thompson to couple cloud physics effective radii.<a name='15518'></font>
   REAL, DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(IN)::         &amp;<a name='15519'>
                                                        re_cloud, &amp;<a name='15520'>
                                                          re_ice, &amp;<a name='15521'>
                                                         re_snow<a name='15522'>
   INTEGER, INTENT(IN):: has_reqc, has_reqi, has_reqs<a name='15523'>
<a name='15524'>
   real pi,third,relconst,lwpmin,rhoh2o<a name='15525'>
<a name='15526'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='15527'>
         OPTIONAL                                               , &amp;<a name='15528'>
         INTENT(IN   ) ::                                         &amp;<a name='15529'>
                                                       F_ICE_PHY, &amp;<a name='15530'>
                                                      F_RAIN_PHY<a name='15531'>
<a name='15532'>
   LOGICAL, OPTIONAL, INTENT(IN)   ::                             &amp;<a name='15533'>
                                   F_QV,F_QC,F_QR,F_QI,F_QS,F_QG,F_QNDROP<a name='15534'>
<font color=#447700>! Optional<a name='15535'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ), OPTIONAL ,       &amp;<a name='15536'>
         INTENT(IN    ) :: tauaerlw1,tauaerlw2,tauaerlw3,tauaerlw4, &amp; <font color=#447700>! czhao <a name='15537'></font>
                           tauaerlw5,tauaerlw6,tauaerlw7,tauaerlw8, &amp; <font color=#447700>! czhao <a name='15538'></font>
                           tauaerlw9,tauaerlw10,tauaerlw11,tauaerlw12, &amp; <font color=#447700>! czhao <a name='15539'></font>
                           tauaerlw13,tauaerlw14,tauaerlw15,tauaerlw16<a name='15540'>
<a name='15541'>
   INTEGER,    INTENT(IN  ), OPTIONAL   ::       aer_ra_feedback<a name='15542'>
<font color=#447700>!jdfcz   INTEGER,    INTENT(IN  ), OPTIONAL   ::       progn,prescribe<a name='15543'></font>
   INTEGER,    INTENT(IN  ), OPTIONAL   ::       progn<a name='15544'>
<font color=#447700>!  Ozone<a name='15545'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='15546'>
         OPTIONAL                                               , &amp;<a name='15547'>
         INTENT(IN   ) :: O33D<a name='15548'>
   INTEGER, OPTIONAL, INTENT(IN ) :: o3input<a name='15549'>
<a name='15550'>
      real, parameter :: thresh=1.e-9<a name='15551'>
      real slope<a name='15552'>
      character(len=200) :: msg<a name='15553'>
<a name='15554'>
<a name='15555'>
<font color=#447700>! Top of atmosphere and surface longwave fluxes (W m-2)<a name='15556'></font>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='15557'>
         OPTIONAL, INTENT(INOUT) ::                               &amp;<a name='15558'>
                                       LWUPT,LWUPTC,LWDNT,LWDNTC, &amp;<a name='15559'>
                                       LWUPB,LWUPBC,LWDNB,LWDNBC<a name='15560'>
<a name='15561'>
<font color=#447700>! Layer longwave fluxes (including extra layer above model top)<a name='15562'></font>
<font color=#447700>! Vertical ordering is from bottom to top (W m-2)<a name='15563'></font>
   REAL, DIMENSION( ims:ime, kms:kme+2, jms:jme ),                &amp;<a name='15564'>
         OPTIONAL, INTENT(OUT) ::                                 &amp;<a name='15565'>
                               LWUPFLX,LWUPFLXC,LWDNFLX,LWDNFLXC<a name='15566'>
<a name='15567'>
<font color=#447700>!  LOCAL VARS<a name='15568'></font>
 <a name='15569'>
   REAL, DIMENSION( kts:kte+1 ) ::                          Pw1D, &amp;<a name='15570'>
                                                            Tw1D<a name='15571'>
<a name='15572'>
   REAL, DIMENSION( kts:kte ) ::                          TTEN1D, &amp;<a name='15573'>
                                                        CLDFRA1D, &amp;<a name='15574'>
                                                            DZ1D, &amp;<a name='15575'>
                                                             P1D, &amp;<a name='15576'>
                                                             T1D, &amp;<a name='15577'>
                                                            QV1D, &amp;<a name='15578'>
                                                            QC1D, &amp;<a name='15579'>
                                                            QR1D, &amp;<a name='15580'>
                                                            QI1D, &amp;<a name='15581'>
                                                            QS1D, &amp;<a name='15582'>
                                                            QG1D, &amp;<a name='15583'>
                                                            O31D, &amp;<a name='15584'>
                                                          qndrop1d <a name='15585'>
<a name='15586'>
<font color=#447700>! Added local arrays for RRTMG<a name='15587'></font>
    integer ::                                              ncol, &amp;<a name='15588'>
                                                            nlay, &amp;<a name='15589'>
                                                            idrv, &amp;<a name='15590'>
                                                            icld, &amp;<a name='15591'>
                                                         inflglw, &amp;<a name='15592'>
                                                        iceflglw, &amp;<a name='15593'>
                                                        liqflglw<a name='15594'>
<font color=#447700>! the mod in the macro below is to quiet range checking <a name='15595'></font>
#define TILEPTS (jte-jts+1)*(ite-its+1)+mod((jte-jts+1)*(ite-its+1),CHNK)<a name='15596'>
<font color=#447700>! Dimension with extra layer from model top to TOA<a name='15597'></font>
    real, dimension( TILEPTS, kts:nlayers+1 )  ::                 &amp;<a name='15598'>
                                                            plev, &amp;<a name='15599'>
                                                            tlev<a name='15600'>
    real, dimension( TILEPTS, kts:nlayers )  ::                   &amp;<a name='15601'>
                                                            play, &amp;<a name='15602'>
                                                            tlay, &amp;<a name='15603'>
                                                          h2ovmr, &amp;<a name='15604'>
                                                           o3vmr, &amp;<a name='15605'>
                                                          co2vmr, &amp;<a name='15606'>
                                                           o2vmr, &amp;<a name='15607'>
                                                          ch4vmr, &amp;<a name='15608'>
                                                          n2ovmr, &amp;<a name='15609'>
                                                        cfc11vmr, &amp;<a name='15610'>
                                                        cfc12vmr, &amp;<a name='15611'>
                                                        cfc22vmr, &amp;<a name='15612'>
                                                         ccl4vmr<a name='15613'>
    real, dimension( kts:nlayers )  ::                     o3mmr<a name='15614'>
<font color=#447700>! For old cloud property specification for rrtm_lw<a name='15615'></font>
    real, dimension( kts:kte )  ::                          clwp, &amp;<a name='15616'>
                                                            ciwp, &amp;<a name='15617'>
                                                            cswp, &amp;<a name='15618'>
                                                            plwp, &amp;<a name='15619'>
                                                            piwp<a name='15620'>
<font color=#447700>! Surface emissivity (for 16 LW spectral bands)<a name='15621'></font>
    real, dimension( TILEPTS, nbndlw )  ::                        &amp;<a name='15622'>
                                                            emis<a name='15623'>
<font color=#447700>! Dimension with extra layer from model top to TOA, <a name='15624'></font>
<font color=#447700>! though no clouds are allowed in extra layer<a name='15625'></font>
    real, dimension( TILEPTS, kts:nlayers )  ::                   &amp;<a name='15626'>
                                                          clwpth, &amp;<a name='15627'>
                                                          ciwpth, &amp;<a name='15628'>
                                                          cswpth, &amp;<a name='15629'>
                                                             rel, &amp;<a name='15630'>
                                                             rei, &amp;<a name='15631'>
                                                             res, &amp;<a name='15632'>
                                                         cldfrac<a name='15633'>
    real, dimension( TILEPTS, nbndlw, kts:nlayers )  ::           &amp;<a name='15634'>
                                                          taucld<a name='15635'>
    real, dimension( TILEPTS, kts:nlayers, nbndlw )  ::           &amp;<a name='15636'>
                                                          tauaer<a name='15637'>
    real, dimension( TILEPTS, kts:nlayers+1 )  ::                 &amp;<a name='15638'>
                                                            uflx, &amp;<a name='15639'>
                                                            dflx, &amp;<a name='15640'>
                                                           uflxc, &amp;<a name='15641'>
                                                           dflxc<a name='15642'>
    real, dimension( TILEPTS, kts:nlayers+1 )  ::                 &amp;<a name='15643'>
                                                        duflx_dt, &amp;<a name='15644'>
                                                       duflxc_dt<a name='15645'>
    real, dimension( TILEPTS, kts:nlayers+1 )  ::                 &amp;<a name='15646'>
                                                              hr, &amp;<a name='15647'>
                                                             hrc<a name='15648'>
<a name='15649'>
    real, dimension ( TILEPTS ) ::                                &amp;<a name='15650'>
                                                            tsfc, &amp;<a name='15651'>
                                                              ps<a name='15652'>
    real ::                                                   ro, &amp;<a name='15653'>
                                                              dz<a name='15654'>
    real:: snow_mass_factor<a name='15655'>
<a name='15656'>
<font color=#447700>!..We can use message interface regardless of what options are running,<a name='15657'></font>
<font color=#447700>!.. so let us ask for it here.<a name='15658'></font>
      CHARACTER(LEN=256)                           :: message<a name='15659'>
      LOGICAL, EXTERNAL                            :: wrf_dm_on_monitor<a name='15660'>
<a name='15661'>
<font color=#447700>!ccc To add time-varying trace gases (CO2, N2O and CH4). Read the conc.  from file<a name='15662'></font>
<font color=#447700>! then interpolate to date of run.<a name='15663'></font>
#ifdef CLWRFGHG<a name='15664'>
<font color=#447700>! CLWRF-UC June.09<a name='15665'></font>
      REAL(8)                                      :: co2, n2o, ch4, cfc11, cfc12<a name='15666'>
#else<a name='15667'>
<a name='15668'>
<font color=#447700>! Set trace gas volume mixing ratios, 2005 values, IPCC (2007)<a name='15669'></font>
<font color=#447700>! carbon dioxide (379 ppmv)<a name='15670'></font>
    real :: co2<a name='15671'>
    data co2 / 379.e-6 / <a name='15672'>
<font color=#447700>! methane (1774 ppbv)<a name='15673'></font>
    real :: ch4<a name='15674'>
    data ch4 / 1774.e-9 / <a name='15675'>
<font color=#447700>! nitrous oxide (319 ppbv)<a name='15676'></font>
    real :: n2o<a name='15677'>
    data n2o / 319.e-9 / <a name='15678'>
<font color=#447700>! cfc-11 (251 ppt)<a name='15679'></font>
    real :: cfc11<a name='15680'>
    data cfc11 / 0.251e-9 / <a name='15681'>
<font color=#447700>! cfc-12 (538 ppt)<a name='15682'></font>
    real :: cfc12<a name='15683'>
    data cfc12 / 0.538e-9 / <a name='15684'>
#endif<a name='15685'>
<font color=#447700>! cfc-22 (169 ppt)<a name='15686'></font>
    real :: cfc22<a name='15687'>
    data cfc22 / 0.169e-9 / <a name='15688'>
<font color=#447700>! ccl4 (93 ppt)<a name='15689'></font>
    real :: ccl4<a name='15690'>
    data ccl4 / 0.093e-9 / <a name='15691'>
<font color=#447700>! Set oxygen volume mixing ratio (for o2mmr=0.23143)<a name='15692'></font>
    real :: o2<a name='15693'>
    data o2 / 0.209488 /<a name='15694'>
<a name='15695'>
    integer :: iplon, irng, permuteseed<a name='15696'>
    integer :: nb<a name='15697'>
<a name='15698'>
<font color=#447700>! For old cloud property specification for rrtm_lw<a name='15699'></font>
<font color=#447700>! Cloud and precipitation absorption coefficients<a name='15700'></font>
    real :: abcw,abice,abrn,absn<a name='15701'>
    data abcw /0.144/<a name='15702'>
    data abice /0.0735/<a name='15703'>
    data abrn /0.330e-3/<a name='15704'>
    data absn /2.34e-3/<a name='15705'>
<a name='15706'>
<font color=#447700>! Molecular weights and ratios for converting mmr to vmr units<a name='15707'></font>
<font color=#447700>!    real :: amd       ! Effective molecular weight of dry air (g/mol)  <a name='15708'></font>
<font color=#447700>!    real :: amw       ! Molecular weight of water vapor (g/mol)        <a name='15709'></font>
<font color=#447700>!    real :: amo       ! Molecular weight of ozone (g/mol)              <a name='15710'></font>
<font color=#447700>!    real :: amo2      ! Molecular weight of oxygen (g/mol)              <a name='15711'></font>
<font color=#447700>! Atomic weights for conversion from mass to volume mixing ratios                <a name='15712'></font>
<font color=#447700>!    data amd   /  28.9660   /                                                  <a name='15713'></font>
<font color=#447700>!    data amw   /  18.0160   /                                                  <a name='15714'></font>
<font color=#447700>!    data amo   /  47.9998   /                                                  <a name='15715'></font>
<font color=#447700>!    data amo2  /  31.9999   /<a name='15716'></font>
                                                                                 <a name='15717'>
    real :: amdw     <font color=#447700>! Molecular weight of dry air / water vapor  <a name='15718'></font>
    real :: amdo     <font color=#447700>! Molecular weight of dry air / ozone<a name='15719'></font>
    real :: amdo2    <font color=#447700>! Molecular weight of dry air / oxygen<a name='15720'></font>
    data amdw /  1.607793 /                                                    <a name='15721'>
    data amdo /  0.603461 /<a name='15722'>
    data amdo2 / 0.905190 /<a name='15723'>
    <a name='15724'>
<font color=#447700>!!<a name='15725'></font>
    real, dimension( (jte-jts+1)*(ite-its+1), 1:kte-kts+1 )  :: pdel         <font color=#447700>! Layer pressure thickness (mb)<a name='15726'></font>
<a name='15727'>
    real, dimension( (jte-jts+1)*(ite-its+1), 1:kte-kts+1) ::   cicewp, &amp;     <font color=#447700>! in-cloud cloud ice water path<a name='15728'></font>
                                             cliqwp, &amp;     <font color=#447700>! in-cloud cloud liquid water path<a name='15729'></font>
                                             csnowp, &amp;     <font color=#447700>! in-cloud snow water path<a name='15730'></font>
                                              reliq, &amp;     <font color=#447700>! effective drop radius (microns)<a name='15731'></font>
                                              reice        <font color=#447700>! effective ice crystal size (microns)<a name='15732'></font>
    real, dimension( (jte-jts+1)*(ite-its+1), 1:kte-kts+1):: recloud1d, &amp;<a name='15733'>
                                            reice1d, &amp;<a name='15734'>
                                           resnow1d<a name='15735'>
<a name='15736'>
    real :: gliqwp, gicewp, gsnowp, gravmks<a name='15737'>
<a name='15738'>
<font color=#447700>!<a name='15739'></font>
<font color=#447700>!    REAL   ::  TSFC,GLW0,OLR0,EMISS0,FP<a name='15740'></font>
<a name='15741'>
    real, dimension ((jte-jts+1)*(ite-its+1)) :: landfrac, landm, snowh, icefrac<a name='15742'>
<a name='15743'>
    integer :: pcols, pver<a name='15744'>
    integer :: icol<a name='15745'>
<font color=#447700>!<a name='15746'></font>
    INTEGER :: i,j,K, idx_rei<a name='15747'>
    REAL :: corr<a name='15748'>
    LOGICAL :: predicate<a name='15749'>
<a name='15750'>
<font color=#447700>! Added for top of model adjustment.  Steven Cavallo NCAR/MMM December 2010<a name='15751'></font>
    INTEGER, PARAMETER :: nproflevs = 60 <font color=#447700>! Constant, from the table<a name='15752'></font>
    INTEGER :: L, LL, klev               <font color=#447700>! Loop indices      <a name='15753'></font>
    REAL, DIMENSION( kts:nlayers+1 ) :: varint<a name='15754'>
    REAL :: wght,vark,vark1       <a name='15755'>
    REAL :: PPROF(nproflevs), TPROF(nproflevs)            <a name='15756'>
    <font color=#447700>! Weighted mean pressure and temperature profiles from midlatitude <a name='15757'></font>
    <font color=#447700>! summer (MLS),midlatitude winter (MLW), sub-Arctic <a name='15758'></font>
    <font color=#447700>! winter (SAW),sub-Arctic summer (SAS), and tropical (TROP) <a name='15759'></font>
    <font color=#447700>! standard atmospheres.<a name='15760'></font>
    DATA PPROF   /1000.00,855.47,731.82,626.05,535.57,458.16,     &amp;<a name='15761'>
                  391.94,335.29,286.83,245.38,209.91,179.57,      &amp;<a name='15762'>
                  153.62,131.41,112.42,96.17,82.27,70.38,         &amp;<a name='15763'>
                  60.21,51.51,44.06,37.69,32.25,27.59,            &amp;<a name='15764'>
                  23.60,20.19,17.27,14.77,12.64,10.81,            &amp;<a name='15765'>
                  9.25,7.91,6.77,5.79,4.95,4.24,                  &amp;<a name='15766'>
                  3.63,3.10,2.65,2.27,1.94,1.66,                  &amp;<a name='15767'>
                  1.42,1.22,1.04,0.89,0.76,0.65,                  &amp;<a name='15768'>
                  0.56,0.48,0.41,0.35,0.30,0.26,                  &amp;<a name='15769'>
                  0.22,0.19,0.16,0.14,0.12,0.10/<a name='15770'>
    DATA TPROF   /286.96,281.07,275.16,268.11,260.56,253.02,      &amp;<a name='15771'>
                  245.62,238.41,231.57,225.91,221.72,217.79,      &amp;<a name='15772'>
                  215.06,212.74,210.25,210.16,210.69,212.14,      &amp;<a name='15773'>
                  213.74,215.37,216.82,217.94,219.03,220.18,      &amp;<a name='15774'>
                  221.37,222.64,224.16,225.88,227.63,229.51,      &amp;<a name='15775'>
                  231.50,233.73,236.18,238.78,241.60,244.44,      &amp;<a name='15776'>
                  247.35,250.33,253.32,256.30,259.22,262.12,      &amp;<a name='15777'>
                  264.80,266.50,267.59,268.44,268.69,267.76,      &amp;<a name='15778'>
                  266.13,263.96,261.54,258.93,256.15,253.23,      &amp;<a name='15779'>
                  249.89,246.67,243.48,240.25,236.66,233.86/    <a name='15780'>
<font color=#447700>!------------------------------------------------------------------<a name='15781'></font>
#if ( WRF_CHEM == 1 )<a name='15782'>
      IF ( aer_ra_feedback == 1) then<a name='15783'>
      IF ( .NOT. &amp;<a name='15784'>
      ( PRESENT(tauaerlw1) .AND. &amp;<a name='15785'>
        PRESENT(tauaerlw2) .AND. &amp;<a name='15786'>
        PRESENT(tauaerlw3) .AND. &amp;<a name='15787'>
        PRESENT(tauaerlw4) .AND. &amp;<a name='15788'>
        PRESENT(tauaerlw5) .AND. &amp;<a name='15789'>
        PRESENT(tauaerlw6) .AND. &amp;<a name='15790'>
        PRESENT(tauaerlw7) .AND. &amp;<a name='15791'>
        PRESENT(tauaerlw8) .AND. &amp;<a name='15792'>
        PRESENT(tauaerlw9) .AND. &amp;<a name='15793'>
        PRESENT(tauaerlw10) .AND. &amp;<a name='15794'>
        PRESENT(tauaerlw11) .AND. &amp;<a name='15795'>
        PRESENT(tauaerlw12) .AND. &amp;<a name='15796'>
        PRESENT(tauaerlw13) .AND. &amp;<a name='15797'>
        PRESENT(tauaerlw14) .AND. &amp;<a name='15798'>
        PRESENT(tauaerlw15) .AND. &amp;<a name='15799'>
        PRESENT(tauaerlw16) ) ) THEN<a name='15800'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1052">  &amp;<a name='15801'>
      ('Warning: missing fields required for aerosol radiation' )<a name='15802'>
      ENDIF<a name='15803'>
      ENDIF<a name='15804'>
#endif<a name='15805'>
<a name='15806'>
<a name='15807'>
<font color=#447700>!-----CALCULATE LONG WAVE RADIATION<a name='15808'></font>
<font color=#447700>!                                                              <a name='15809'></font>
<font color=#447700>! All fields are ordered vertically from bottom to top<a name='15810'></font>
<font color=#447700>! Pressures are in mb<a name='15811'></font>
<font color=#447700>!<a name='15812'></font>
<font color=#447700>!ccc Read time-varying trace gases concentrations and interpolate them to run date.<a name='15813'></font>
<font color=#447700>!<a name='15814'></font>
#ifdef CLWRFGHG<a name='15815'>
<a name='15816'>
   CALL <A href='../../html_code/phys/module_ra_clWRF_support.F.html#READ_CAMGASES'>read_CAMgases</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_CAMGASES_4">(yr,julian,"RRTMG",co2,n2o,ch4,cfc11,cfc12)<a name='15817'>
<a name='15818'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='15819'>
     WRITE(message,*)'CAM-CLWRF interpolated values______ year:',yr,' julian day:',julian<a name='15820'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_786">( 100, message)<a name='15821'>
     WRITE(message,*)'  CAM-CLWRF co2vmr: ',co2,' n2ovmr:',n2o,' ch4vmr:',ch4,' cfc11vmr:',cfc11,' cfc12vmr:',cfc12<a name='15822'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_787">( 100, message)<a name='15823'>
   ENDIF<a name='15824'>
<a name='15825'>
#endif<a name='15826'>
<font color=#447700>!ccc<a name='15827'></font>
<a name='15828'>
   ncol = (jte-jts+1)*(ite-its+1)<a name='15829'>
<a name='15830'>
<font color=#447700>! latitude loop<a name='15831'></font>
   j_loop: do j = jts,jte<a name='15832'>
<a name='15833'>
<font color=#447700>! longitude loop<a name='15834'></font>
      i_loop: do i = its,ite<a name='15835'>
<a name='15836'>
         icol = i-its+1 + (j-jts)*(ite-its+1)<a name='15837'>
<a name='15838'>
         do k=kts,kte+1<a name='15839'>
            Pw1D(K) = p8w(I,K,J)/100.<a name='15840'>
            Tw1D(K) = t8w(I,K,J)<a name='15841'>
         enddo<a name='15842'>
<a name='15843'>
         DO K=kts,kte<a name='15844'>
            QV1D(K)=0.<a name='15845'>
            QC1D(K)=0.<a name='15846'>
            QR1D(K)=0.<a name='15847'>
            QI1D(K)=0.<a name='15848'>
            QS1D(K)=0.<a name='15849'>
            CLDFRA1D(k)=0.<a name='15850'>
         ENDDO<a name='15851'>
<a name='15852'>
         DO K=kts,kte<a name='15853'>
            QV1D(K)=QV3D(I,K,J)<a name='15854'>
            QV1D(K)=max(0.,QV1D(K))<a name='15855'>
         ENDDO<a name='15856'>
<a name='15857'>
         IF (PRESENT(O33D)) THEN<a name='15858'>
            DO K=kts,kte<a name='15859'>
               O31D(K)=O33D(I,K,J)<a name='15860'>
            ENDDO<a name='15861'>
         ELSE<a name='15862'>
            DO K=kts,kte<a name='15863'>
               O31D(K)=0.0<a name='15864'>
            ENDDO<a name='15865'>
         ENDIF<a name='15866'>
<a name='15867'>
         DO K=kts,kte<a name='15868'>
            TTEN1D(K)=0.<a name='15869'>
            T1D(K)=T3D(I,K,J)<a name='15870'>
            P1D(K)=P3D(I,K,J)/100.<a name='15871'>
            DZ1D(K)=dz8w(I,K,J)<a name='15872'>
         ENDDO<a name='15873'>
<a name='15874'>
<font color=#447700>! moist variables<a name='15875'></font>
<a name='15876'>
         IF (ICLOUD .ne. 0) THEN<a name='15877'>
            IF ( PRESENT( CLDFRA3D ) ) THEN<a name='15878'>
              DO K=kts,kte<a name='15879'>
                 CLDFRA1D(k)=CLDFRA3D(I,K,J)<a name='15880'>
              ENDDO<a name='15881'>
            ENDIF<a name='15882'>
<a name='15883'>
            IF (PRESENT(F_QC) .AND. PRESENT(QC3D)) THEN<a name='15884'>
              IF ( F_QC) THEN<a name='15885'>
                 DO K=kts,kte<a name='15886'>
                    QC1D(K)=QC3D(I,K,J)<a name='15887'>
                    QC1D(K)=max(0.,QC1D(K))<a name='15888'>
                 ENDDO<a name='15889'>
              ENDIF<a name='15890'>
            ENDIF<a name='15891'>
<a name='15892'>
            IF (PRESENT(F_QR) .AND. PRESENT(QR3D)) THEN<a name='15893'>
              IF ( F_QR) THEN<a name='15894'>
                 DO K=kts,kte<a name='15895'>
                    QR1D(K)=QR3D(I,K,J)<a name='15896'>
                    QR1D(K)=max(0.,QR1D(K))<a name='15897'>
                 ENDDO<a name='15898'>
              ENDIF<a name='15899'>
            ENDIF<a name='15900'>
<a name='15901'>
            IF ( PRESENT(F_QNDROP).AND.PRESENT(QNDROP3D)) THEN<a name='15902'>
             IF (F_QNDROP) THEN<a name='15903'>
              DO K=kts,kte<a name='15904'>
               qndrop1d(K)=qndrop3d(I,K,J)<a name='15905'>
              ENDDO<a name='15906'>
             ENDIF<a name='15907'>
            ENDIF<a name='15908'>
<a name='15909'>
<font color=#447700>! This logic is tortured because cannot test F_QI unless<a name='15910'></font>
<font color=#447700>! it is present, and order of evaluation of expressions<a name='15911'></font>
<font color=#447700>! is not specified in Fortran<a name='15912'></font>
<a name='15913'>
            IF ( PRESENT ( F_QI ) ) THEN<a name='15914'>
              predicate = F_QI<a name='15915'>
            ELSE<a name='15916'>
              predicate = .FALSE.<a name='15917'>
            ENDIF<a name='15918'>
<a name='15919'>
<font color=#447700>! For MP option 3<a name='15920'></font>
            IF (.NOT. predicate .and. .not. warm_rain) THEN<a name='15921'>
               DO K=kts,kte<a name='15922'>
                  IF (T1D(K) .lt. 273.15) THEN<a name='15923'>
                  QI1D(K)=QC1D(K)<a name='15924'>
                  QS1D(K)=QR1D(K)<a name='15925'>
                  QC1D(K)=0.<a name='15926'>
                  QR1D(K)=0.<a name='15927'>
                  ENDIF<a name='15928'>
               ENDDO<a name='15929'>
            ENDIF<a name='15930'>
<a name='15931'>
            IF (PRESENT(F_QI) .AND. PRESENT(QI3D)) THEN<a name='15932'>
               IF (F_QI) THEN<a name='15933'>
                  DO K=kts,kte<a name='15934'>
                     QI1D(K)=QI3D(I,K,J)<a name='15935'>
                     QI1D(K)=max(0.,QI1D(K))<a name='15936'>
                  ENDDO<a name='15937'>
               ENDIF<a name='15938'>
            ENDIF<a name='15939'>
<a name='15940'>
            IF (PRESENT(F_QS) .AND. PRESENT(QS3D)) THEN<a name='15941'>
               IF (F_QS) THEN<a name='15942'>
                  DO K=kts,kte<a name='15943'>
                     QS1D(K)=QS3D(I,K,J)<a name='15944'>
                     QS1D(K)=max(0.,QS1D(K))<a name='15945'>
                  ENDDO<a name='15946'>
               ENDIF<a name='15947'>
            ENDIF<a name='15948'>
<a name='15949'>
            IF (PRESENT(F_QG) .AND. PRESENT(QG3D)) THEN<a name='15950'>
               IF (F_QG) THEN<a name='15951'>
                  DO K=kts,kte<a name='15952'>
                     QG1D(K)=QG3D(I,K,J)<a name='15953'>
                     QG1D(K)=max(0.,QG1D(K))<a name='15954'>
                  ENDDO<a name='15955'>
               ENDIF<a name='15956'>
            ENDIF<a name='15957'>
<a name='15958'>
<font color=#447700>! mji - For MP option 5<a name='15959'></font>
            IF ( PRESENT(F_QI) .and. PRESENT(F_QC) .and. PRESENT(F_QS) .and. PRESENT(F_ICE_PHY) ) THEN<a name='15960'>
               IF ( F_QC .and. .not. F_QI .and. F_QS ) THEN<a name='15961'>
                  DO K=kts,kte<a name='15962'>
                     qi1d(k) = 0.1*qs3d(i,k,j)<a name='15963'>
                     qs1d(k) = 0.9*qs3d(i,k,j)<a name='15964'>
                     qc1d(k) = qc3d(i,k,j)<a name='15965'>
                     qi1d(k) = max(0.,qi1d(k))<a name='15966'>
                     qc1d(k) = max(0.,qc1d(k))<a name='15967'>
                  ENDDO<a name='15968'>
               ENDIF<a name='15969'>
            ENDIF<a name='15970'>
<a name='15971'>
        ENDIF<a name='15972'>
<a name='15973'>
<font color=#447700>!         EMISS0=EMISS(I,J)<a name='15974'></font>
<font color=#447700>!         GLW0=0. <a name='15975'></font>
<font color=#447700>!         OLR0=0. <a name='15976'></font>
<font color=#447700>!         TSFC=TSK(I,J)<a name='15977'></font>
         DO K=kts,kte<a name='15978'>
            QV1D(K)=AMAX1(QV1D(K),1.E-12) <a name='15979'>
         ENDDO<a name='15980'>
<a name='15981'>
<font color=#447700>! Set up input for longwave<a name='15982'></font>
<font color=#447700>!         ncol = 1<a name='15983'></font>
<font color=#447700>! Add extra layer from top of model to top of atmosphere<a name='15984'></font>
<font color=#447700>!         nlay = (kte - kts + 1) + 1<a name='15985'></font>
<font color=#447700>! Edited for top of model adjustment (nlayers = kte + 1).  <a name='15986'></font>
<font color=#447700>! Steven Cavallo, December 2010<a name='15987'></font>
         nlay = nlayers <font color=#447700>! Keep these indices the same<a name='15988'></font>
<a name='15989'>
<font color=#447700>! For optional calculation of the approximate change in upward flux as a function<a name='15990'></font>
<font color=#447700>! of surface temperature only between full radiation calls (0=off, 1=on)<a name='15991'></font>
         idrv = 0<a name='15992'>
<a name='15993'>
<font color=#447700>! Select cloud liquid and ice optics parameterization options<a name='15994'></font>
<font color=#447700>! For passing in cloud optical properties directly:<a name='15995'></font>
<font color=#447700>!         icld = 2<a name='15996'></font>
<font color=#447700>!         inflglw = 0<a name='15997'></font>
<font color=#447700>!         iceflglw = 0<a name='15998'></font>
<font color=#447700>!         liqflglw = 0<a name='15999'></font>
<font color=#447700>! For passing in cloud physical properties; cloud optics parameterized in RRTMG:<a name='16000'></font>
         icld = 2<a name='16001'>
         inflglw = 2<a name='16002'>
         iceflglw = 3<a name='16003'>
         liqflglw = 1<a name='16004'>
<a name='16005'>
<font color=#447700>!Mukul change the flags here with reference to the new effective cloud/ice/snow radius<a name='16006'></font>
         IF (ICLOUD .ne. 0) THEN<a name='16007'>
            IF ( has_reqc .ne. 0) THEN<a name='16008'>
               inflglw = 3<a name='16009'>
               DO K=kts,kte<a name='16010'>
                  recloud1D(icol,K) = MAX(2.5, re_cloud(I,K,J)*1.E6)<a name='16011'>
                  if (recloud1D(icol,K).LE.2.5.AND.cldfra3d(i,k,j).gt.0. &amp;<a name='16012'>
     &amp;                            .AND. (XLAND(I,J)-1.5).GT.0.) then     <font color=#447700>!--- Ocean<a name='16013'></font>
                     recloud1D(icol,K) = 10.5<a name='16014'>
                  elseif(recloud1D(icol,K).LE.2.5.AND.cldfra3d(i,k,j).gt.0. &amp;<a name='16015'>
     &amp;                            .AND. (XLAND(I,J)-1.5).LT.0.) then     <font color=#447700>!--- Land<a name='16016'></font>
                     recloud1D(icol,K) = 7.5<a name='16017'>
                  endif<a name='16018'>
               ENDDO<a name='16019'>
            ELSE<a name='16020'>
               DO K=kts,kte<a name='16021'>
                  recloud1D(icol,K) = 5.0<a name='16022'>
               ENDDO<a name='16023'>
            ENDIF<a name='16024'>
<a name='16025'>
            IF ( has_reqi .ne. 0) THEN<a name='16026'>
               inflglw  = 4<a name='16027'>
               iceflglw = 4<a name='16028'>
               DO K=kts,kte<a name='16029'>
                  reice1D(icol,K) = MAX(5., re_ice(I,K,J)*1.E6)<a name='16030'>
                  if (reice1D(icol,K).LE.5..AND.cldfra3d(i,k,j).gt.0.) then<a name='16031'>
                     idx_rei = int(t3d(i,k,j)-179.)<a name='16032'>
                     idx_rei = min(max(idx_rei,1),75)<a name='16033'>
                     corr = t3d(i,k,j) - int(t3d(i,k,j))<a name='16034'>
                     reice1D(icol,K) = retab(idx_rei)*(1.-corr) +       &amp;<a name='16035'>
     &amp;                                 retab(idx_rei+1)*corr<a name='16036'>
                     reice1D(icol,K) = MAX(reice1D(icol,K), 5.0)<a name='16037'>
                  endif<a name='16038'>
               ENDDO<a name='16039'>
            ELSE<a name='16040'>
               DO K=kts,kte<a name='16041'>
                  reice1D(icol,K) = 10.0<a name='16042'>
               ENDDO<a name='16043'>
            ENDIF<a name='16044'>
<a name='16045'>
            IF ( has_reqs .ne. 0) THEN<a name='16046'>
               inflglw  = 5<a name='16047'>
               iceflglw = 5<a name='16048'>
               DO K=kts,kte<a name='16049'>
                  resnow1D(icol,K) = MAX(10., re_snow(I,K,J)*1.E6)<a name='16050'>
               ENDDO<a name='16051'>
            ELSE<a name='16052'>
               DO K=kts,kte<a name='16053'>
                  resnow1D(icol,K) = 10.0<a name='16054'>
               ENDDO<a name='16055'>
            ENDIF<a name='16056'>
<a name='16057'>
<font color=#447700>! special case for P3 microphysics<a name='16058'></font>
<font color=#447700>! put ice into snow category for optics, then set ice to zero<a name='16059'></font>
            IF (has_reqs .eq. 0 .and. has_reqi .ne. 0 .and. has_reqc .ne. 0) THEN<a name='16060'>
               inflglw  = 5<a name='16061'>
               iceflglw = 5<a name='16062'>
               DO K=kts,kte<a name='16063'>
                  resnow1D(ncol,K) = MAX(10., re_ice(I,K,J)*1.E6)<a name='16064'>
                  QS1D(K)=QI3D(I,K,J)<a name='16065'>
                  QI1D(K)=0.<a name='16066'>
                  reice1D(ncol,K)=10.<a name='16067'>
               END DO<a name='16068'>
            END IF<a name='16069'>
<a name='16070'>
         ENDIF<a name='16071'>
<a name='16072'>
<font color=#447700>! Layer indexing goes bottom to top here for all fields.<a name='16073'></font>
<font color=#447700>! Water vapor and ozone are converted from mmr to vmr. <a name='16074'></font>
<font color=#447700>! Pressures are in units of mb here. <a name='16075'></font>
         plev(icol,1) = pw1d(1)<a name='16076'>
<a name='16077'>
<a name='16078'>
         tlev(icol,1) = tw1d(1)<a name='16079'>
         tsfc(icol) = tsk(i,j)<a name='16080'>
         do k = kts, kte<a name='16081'>
            play(icol,k) = p1d(k)<a name='16082'>
            plev(icol,k+1) = pw1d(k+1)<a name='16083'>
            pdel(icol,k) = plev(icol,k) - plev(icol,k+1)<a name='16084'>
            tlay(icol,k) = t1d(k)<a name='16085'>
            tlev(icol,k+1) = tw1d(k+1)<a name='16086'>
            h2ovmr(icol,k) = qv1d(k) * amdw<a name='16087'>
            co2vmr(icol,k) = co2<a name='16088'>
            o2vmr(icol,k) = o2<a name='16089'>
            ch4vmr(icol,k) = ch4<a name='16090'>
            n2ovmr(icol,k) = n2o<a name='16091'>
            cfc11vmr(icol,k) = cfc11<a name='16092'>
            cfc12vmr(icol,k) = cfc12<a name='16093'>
            cfc22vmr(icol,k) = cfc22<a name='16094'>
            ccl4vmr(icol,k) = ccl4<a name='16095'>
         enddo<a name='16096'>
<a name='16097'>
<font color=#447700>! This section is replaced with a new method to deal with model top<a name='16098'></font>
         if ( 1 == 0 ) then<a name='16099'>
<a name='16100'>
<font color=#447700>!  Define profile values for extra layer from model top to top of atmosphere. <a name='16101'></font>
<font color=#447700>!  The top layer temperature for all gridpoints is set to the top layer-1 <a name='16102'></font>
<font color=#447700>!  temperature plus a constant (0 K) that represents an isothermal layer    <a name='16103'></font>
<font color=#447700>!  above ptop.  Top layer interface temperatures are linearly interpolated <a name='16104'></font>
<font color=#447700>!  from the layer temperatures.  <a name='16105'></font>
<a name='16106'>
         play(icol,kte+1) = 0.5 * plev(icol,kte+1)<a name='16107'>
         tlay(icol,kte+1) = tlev(icol,kte+1) + 0.0<a name='16108'>
         plev(icol,kte+2) = 1.0e-5<a name='16109'>
         tlev(icol,kte+2) = tlev(icol,kte+1) + 0.0<a name='16110'>
         h2ovmr(icol,kte+1) = h2ovmr(icol,kte) <a name='16111'>
         co2vmr(icol,kte+1) = co2vmr(icol,kte) <a name='16112'>
         o2vmr(icol,kte+1) = o2vmr(icol,kte) <a name='16113'>
         ch4vmr(icol,kte+1) = ch4vmr(icol,kte) <a name='16114'>
         n2ovmr(icol,kte+1) = n2ovmr(icol,kte) <a name='16115'>
         cfc11vmr(icol,kte+1) = cfc11vmr(icol,kte) <a name='16116'>
         cfc12vmr(icol,kte+1) = cfc12vmr(icol,kte) <a name='16117'>
         cfc22vmr(icol,kte+1) = cfc22vmr(icol,kte) <a name='16118'>
         ccl4vmr(icol,kte+1) = ccl4vmr(icol,kte) <a name='16119'>
<a name='16120'>
         endif<a name='16121'>
<a name='16122'>
<font color=#447700>!  Set up values for extra layers to the top of the atmosphere.                       <a name='16123'></font>
<font color=#447700>!  Temperature is calculated based on an average temperature profile given<a name='16124'></font>
<font color=#447700>!  here in a table.  The input table data is linearly interpolated to the<a name='16125'></font>
<font color=#447700>!  column pressure.  Mixing ratios are held constant except for ozone.  <a name='16126'></font>
<font color=#447700>!  Caution should be used if model top pressure is less than 5 hPa.<a name='16127'></font>
<font color=#447700>!  Steven Cavallo, NCAR/MMM, December 2010<a name='16128'></font>
       <font color=#447700>! Calculate the column pressure buffer levels above the <a name='16129'></font>
       <font color=#447700>! model top       <a name='16130'></font>
       do L=kte+1,nlayers,1<a name='16131'>
          plev(icol,L+1) = plev(icol,L) - deltap<a name='16132'>
          play(icol,L) = 0.5*(plev(icol,L) + plev(icol,L+1))<a name='16133'>
       enddo          <a name='16134'>
       <font color=#447700>! Add zero as top level.  This gets the temperature max at the<a name='16135'></font>
       <font color=#447700>! stratopause, reducing the downward flux errors in the top <a name='16136'></font>
       <font color=#447700>! levels.  If zero happened to be the top level already,<a name='16137'></font>
       <font color=#447700>! this will add another level with zero, but will not affect<a name='16138'></font>
       <font color=#447700>! the radiative transfer calculation.<a name='16139'></font>
       plev(icol,nlayers+1) = 0.00<a name='16140'>
       play(icol,nlayers) =  0.5*(plev(icol,nlayers) + plev(icol,nlayers+1))<a name='16141'>
<a name='16142'>
       <font color=#447700>! Interpolate the table temperatures to column pressure levels    <a name='16143'></font>
       do L=1,nlayers+1,1<a name='16144'>
          if ( PPROF(nproflevs) .lt. plev(icol,L) ) then<a name='16145'>
             do LL=2,nproflevs,1       <a name='16146'>
                if ( PPROF(LL) .lt. plev(icol,L) ) then           <a name='16147'>
                   klev = LL - 1<a name='16148'>
                   exit<a name='16149'>
                endif<a name='16150'>
             enddo<a name='16151'>
          <a name='16152'>
          else<a name='16153'>
             klev = nproflevs<a name='16154'>
          endif  <a name='16155'>
  <a name='16156'>
          if (klev .ne. nproflevs ) then<a name='16157'>
             vark  = TPROF(klev) <a name='16158'>
             vark1 = TPROF(klev+1)<a name='16159'>
             wght=(plev(icol,L)-PPROF(klev) )/( PPROF(klev+1)-PPROF(klev))<a name='16160'>
          else<a name='16161'>
             vark  = TPROF(klev) <a name='16162'>
             vark1 = TPROF(klev)<a name='16163'>
             wght = 0.0<a name='16164'>
          endif<a name='16165'>
          varint(L) = wght*(vark1-vark)+vark<a name='16166'>
<a name='16167'>
       enddo                   <a name='16168'>
       <a name='16169'>
       <font color=#447700>! Match the interpolated table temperature profile to WRF column                    <a name='16170'></font>
       do L=kte+1,nlayers+1,1<a name='16171'>
          tlev(icol,L) = varint(L) + (tlev(icol,kte) - varint(kte))<a name='16172'>
          <font color=#447700>!if ( L .le. nlay ) then<a name='16173'></font>
          tlay(icol,L-1) = 0.5*(tlev(icol,L) + tlev(icol,L-1))  <a name='16174'>
          <font color=#447700>!endif<a name='16175'></font>
       enddo <a name='16176'>
<a name='16177'>
       <font color=#447700>! Now the chemical species (except for ozone)<a name='16178'></font>
       do L=kte+1,nlayers,1<a name='16179'>
          h2ovmr(icol,L) = h2ovmr(icol,kte) <a name='16180'>
          co2vmr(icol,L) = co2vmr(icol,kte) <a name='16181'>
          o2vmr(icol,L) = o2vmr(icol,kte) <a name='16182'>
          ch4vmr(icol,L) = ch4vmr(icol,kte) <a name='16183'>
          n2ovmr(icol,L) = n2ovmr(icol,kte) <a name='16184'>
          cfc11vmr(icol,L) = cfc11vmr(icol,kte) <a name='16185'>
          cfc12vmr(icol,L) = cfc12vmr(icol,kte) <a name='16186'>
          cfc22vmr(icol,L) = cfc22vmr(icol,kte) <a name='16187'>
          ccl4vmr(icol,L) = ccl4vmr(icol,kte) <a name='16188'>
       enddo     <a name='16189'>
<font color=#447700>! End top of model buffer <a name='16190'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! <a name='16191'></font>
<font color=#447700>! Get ozone profile including amount in extra layer above model top.<a name='16192'></font>
<font color=#447700>! Steven Cavallo: Must pass nlay-1 into subroutine to get nlayers <a name='16193'></font>
<font color=#447700>! dimension for o3mmr<a name='16194'></font>
<font color=#447700>!         call inirad (o3mmr,plev,kts,nlay-1)<a name='16195'></font>
         call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INIRAD'>inirad</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIRAD_4"> (o3mmr,plev(icol,:),kts,nlay-1)<a name='16196'>
<a name='16197'>
<font color=#447700>! Steven Cavallo: Changed to nlayers from kte+1<a name='16198'></font>
        if(present(o33d)) then<a name='16199'>
         do k = kts, nlayers<a name='16200'>
            o3vmr(icol,k) = o3mmr(k) * amdo<a name='16201'>
            IF ( PRESENT( O33D ) ) THEN<a name='16202'>
            if(o3input .eq. 2)then<a name='16203'>
               if(k.le.kte)then<a name='16204'>
                 o3vmr(icol,k) = o31d(k)<a name='16205'>
               else<a name='16206'>
<font color=#447700>! apply shifted climatology profile above model top<a name='16207'></font>
                 o3vmr(icol,k) = o31d(kte) - o3mmr(kte)*amdo + o3mmr(k)*amdo<a name='16208'>
                 if(o3vmr(icol,k) .le. 0.)o3vmr(icol,k) = o3mmr(k)*amdo<a name='16209'>
               endif<a name='16210'>
            endif<a name='16211'>
            ENDIF<a name='16212'>
         enddo<a name='16213'>
        else<a name='16214'>
         do k = kts, nlayers<a name='16215'>
            o3vmr(icol,k) = o3mmr(k) * amdo<a name='16216'>
         enddo<a name='16217'>
        endif<a name='16218'>
<a name='16219'>
<font color=#447700>! Set surface emissivity in each RRTMG longwave band<a name='16220'></font>
         do nb = 1, nbndlw<a name='16221'>
            emis(icol, nb) = emiss(i,j)<a name='16222'>
         enddo<a name='16223'>
<a name='16224'>
<font color=#447700>! Define cloud optical properties for radiation (inflglw = 0)<a name='16225'></font>
<font color=#447700>! This is approach used with older RRTM_LW;<a name='16226'></font>
<font color=#447700>! Cloud and precipitation paths in g/m2 <a name='16227'></font>
<font color=#447700>! qi=0 if no ice phase<a name='16228'></font>
<font color=#447700>! qs=0 if no ice phase<a name='16229'></font>
         if (inflglw .eq. 0) then<a name='16230'>
            do k = kts,kte<a name='16231'>
               ro = p1d(k) / (r * t1d(k))*100. <a name='16232'>
               dz = dz1d(k)<a name='16233'>
               clwp(k) = ro*qc1d(k)*dz*1000.         <a name='16234'>
               ciwp(k) = ro*qi1d(k)*dz*1000.         <a name='16235'>
               plwp(k) = (ro*qr1d(k))**0.75*dz*1000. <a name='16236'>
               piwp(k) = (ro*qs1d(k))**0.75*dz*1000. <a name='16237'>
            enddo<a name='16238'>
<a name='16239'>
<font color=#447700>! Cloud fraction and cloud optical depth; old approach used with RRTM_LW<a name='16240'></font>
            do k = kts, kte<a name='16241'>
               cldfrac(icol,k) = cldfra1d(k)<a name='16242'>
               do nb = 1, nbndlw<a name='16243'>
                  taucld(icol,nb,k) = abcw*clwp(k) + abice*ciwp(k) &amp; <a name='16244'>
                            +abrn*plwp(k) + absn*piwp(k) <a name='16245'>
                  if (taucld(icol,nb,k) .gt. 0.01) cldfrac(icol,k) = 1. <a name='16246'>
               enddo<a name='16247'>
            enddo<a name='16248'>
<a name='16249'>
<font color=#447700>! Zero out cloud physical property arrays; not used when passing optical properties<a name='16250'></font>
<font color=#447700>! into radiation<a name='16251'></font>
            do k = kts, kte<a name='16252'>
               clwpth(icol,k) = 0.0<a name='16253'>
               ciwpth(icol,k) = 0.0<a name='16254'>
               rel(icol,k) = 10.0<a name='16255'>
               rei(icol,k) = 10.0<a name='16256'>
            enddo<a name='16257'>
         endif<a name='16258'>
<a name='16259'>
<font color=#447700>! Define cloud physical properties for radiation (inflglw = 1 or 2)<a name='16260'></font>
<font color=#447700>! Cloud fraction<a name='16261'></font>
<font color=#447700>! Set cloud arrays if passing cloud physical properties into radiation<a name='16262'></font>
         if (inflglw .gt. 0) then <a name='16263'>
            do k = kts, kte<a name='16264'>
               cldfrac(icol,k) = cldfra1d(k)<a name='16265'>
            enddo<a name='16266'>
<a name='16267'>
<font color=#447700>! Compute cloud water/ice paths and particle sizes for input to radiation (CAM method)<a name='16268'></font>
            pcols = ncol<a name='16269'>
            pver = kte - kts + 1<a name='16270'>
            gravmks = g<a name='16271'>
            landfrac(icol) = 2.-XLAND(I,J)<a name='16272'>
            landm(icol) = landfrac(icol)<a name='16273'>
            snowh(icol) = 0.001*SNOW(I,J)<a name='16274'>
            icefrac(icol) = XICE(I,J)<a name='16275'>
<a name='16276'>
<font color=#447700>! From module_ra_cam: Convert liquid and ice mixing ratios to water paths;<a name='16277'></font>
<font color=#447700>! pdel is in mb here; convert back to Pa (*100.)<a name='16278'></font>
<font color=#447700>! Water paths are in units of g/m2<a name='16279'></font>
<font color=#447700>! snow added as ice cloud (JD 091022)<a name='16280'></font>
            do k = kts, kte<a name='16281'>
               gicewp = (qi1d(k)+qs1d(k)) * pdel(icol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box ice water path.<a name='16282'></font>
               gliqwp = qc1d(k) * pdel(icol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box liquid water path.<a name='16283'></font>
               cicewp(icol,k) = gicewp / max(0.01,cldfrac(icol,k))               <font color=#447700>! In-cloud ice water path.<a name='16284'></font>
               cliqwp(icol,k) = gliqwp / max(0.01,cldfrac(icol,k))               <font color=#447700>! In-cloud liquid water path.<a name='16285'></font>
            end do<a name='16286'>
<a name='16287'>
<a name='16288'>
<font color=#447700>! Mukul<a name='16289'></font>
<font color=#447700>!..The ice water path is already sum of cloud ice and snow, but when we have explicit<a name='16290'></font>
<font color=#447700>!.. ice effective radius, overwrite the ice path with only the cloud ice variable,<a name='16291'></font>
<font color=#447700>!.. leaving out the snow for its own effect.<a name='16292'></font>
           if(iceflglw.ge.4)then<a name='16293'>
              do k = kts, kte<a name='16294'>
                     gicewp = qi1d(k) * pdel(icol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box ice water path.<a name='16295'></font>
                     cicewp(icol,k) = gicewp / max(0.01,cldfrac(icol,k))               <font color=#447700>! In-cloud ice water path.<a name='16296'></font>
              end do<a name='16297'>
           end if<a name='16298'>
<a name='16299'>
<font color=#447700>!..Here the snow path is adjusted if (radiation) effective radius of snow is<a name='16300'></font>
<font color=#447700>!.. larger than what we currently have in the lookup tables.  Since mass goes<a name='16301'></font>
<font color=#447700>!.. rather close to diameter squared, adjust the mixing ratio of snow used<a name='16302'></font>
<font color=#447700>!.. to compute its water path in combination with the max diameter.  Not a<a name='16303'></font>
<font color=#447700>!.. perfect fix, but certainly better than using all snow mass when diameter is<a name='16304'></font>
<font color=#447700>!.. far larger than table currently contains and crystal sizes much larger than<a name='16305'></font>
<font color=#447700>!.. about 140 microns have lesser impact than those much smaller sizes.<a name='16306'></font>
<a name='16307'>
           if(iceflglw.eq.5)then<a name='16308'>
              do k = kts, kte<a name='16309'>
                 snow_mass_factor = 1.0<a name='16310'>
                 if (resnow1d(icol,k) .gt. 130.)then<a name='16311'>
                     snow_mass_factor = (130.0/resnow1d(icol,k))*(130.0/resnow1d(icol,k))<a name='16312'>
                     resnow1d(icol,k)   = 130.0<a name='16313'>
                     IF ( wrf_dm_on_monitor() ) THEN<a name='16314'>
                       WRITE(message,*)'RRTMG:  reducing snow mass (cloud path) to ', &amp;<a name='16315'>
                                       nint(snow_mass_factor*100.), ' percent of full value'<a name='16316'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_788">(150, message)<a name='16317'>
                     ENDIF<a name='16318'>
                 endif<a name='16319'>
                 gsnowp = qs1d(k) * snow_mass_factor * pdel(icol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box snow water path.<a name='16320'></font>
                 csnowp(icol,k) = gsnowp / max(0.01,cldfrac(icol,k))<a name='16321'>
              end do<a name='16322'>
           end if<a name='16323'>
<a name='16324'>
<a name='16325'>
<font color=#447700>!link the aerosol feedback to cloud  -czhao<a name='16326'></font>
  if( PRESENT( progn ) ) then<a name='16327'>
    if (progn == 1) then<a name='16328'>
<font color=#447700>!jdfcz     if(prescribe==0) then<a name='16329'></font>
<a name='16330'>
      pi = 4.*atan(1.0)<a name='16331'>
      third=1./3.<a name='16332'>
      rhoh2o=1.e3<a name='16333'>
      relconst=3/(4.*pi*rhoh2o)<a name='16334'>
<font color=#447700>!     minimun liquid water path to calculate rel<a name='16335'></font>
<font color=#447700>!     corresponds to optical depth of 1.e-3 for radius 4 microns.<a name='16336'></font>
      lwpmin=3.e-5<a name='16337'>
      do k = kts, kte<a name='16338'>
         reliq(icol,k) = 10.<a name='16339'>
         if( PRESENT( F_QNDROP ) ) then<a name='16340'>
            if( F_QNDROP ) then<a name='16341'>
              if ( qc1d(k)*pdel(icol,k).gt.lwpmin.and. &amp;<a name='16342'>
                   qndrop1d(k).gt.1000. ) then<a name='16343'>
               reliq(icol,k)=(relconst*qc1d(k)/qndrop1d(k))**third <font color=#447700>! effective radius in m<a name='16344'></font>
<font color=#447700>!           apply scaling from Martin et al., JAS 51, 1830.<a name='16345'></font>
               reliq(icol,k)=1.1*reliq(icol,k)<a name='16346'>
               reliq(icol,k)=reliq(icol,k)*1.e6 <font color=#447700>! convert from m to microns<a name='16347'></font>
               reliq(icol,k)=max(reliq(icol,k),4.)<a name='16348'>
               reliq(icol,k)=min(reliq(icol,k),20.)<a name='16349'>
              end if<a name='16350'>
            end if<a name='16351'>
         end if<a name='16352'>
      end do<a name='16353'>
<font color=#447700>!jdfcz     else ! prescribe <a name='16354'></font>
<font color=#447700>! following Kiehl<a name='16355'></font>
<font color=#447700>!      call relcalc(icol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='16356'></font>
<font color=#447700>!     write(0,*) 'lw prescribe aerosol',maxval(qndrop3d)<a name='16357'></font>
<font color=#447700>!jdfcz     endif<a name='16358'></font>
    else  <font color=#447700>! progn   <a name='16359'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RELCALC'>relcalc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELCALC_3">(icol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='16360'>
    endif<a name='16361'>
  else   <font color=#447700>!present(progn) <a name='16362'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RELCALC'>relcalc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELCALC_4">(icol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='16363'>
  endif<a name='16364'>
<a name='16365'>
<font color=#447700>! following Kristjansson and Mitchell<a name='16366'></font>
            call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REICALC'>reicalc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REICALC_2">(icol, pcols, pver, tlay, reice)<a name='16367'>
<a name='16368'>
<a name='16369'>
<font color=#447700>!..If we already have effective radius of cloud and ice, then just overwrite what<a name='16370'></font>
<font color=#447700>!.. was computed in the relcalc and reicalc subroutines above.<a name='16371'></font>
<a name='16372'>
      if (inflglw .ge. 3) then<a name='16373'>
         do k = kts, kte<a name='16374'>
            reliq(icol,k) = recloud1d(icol,k)<a name='16375'>
         end do<a name='16376'>
      endif<a name='16377'>
      if (iceflglw .ge. 4) then<a name='16378'>
         do k = kts, kte<a name='16379'>
            reice(icol,k) = reice1d(icol,k)<a name='16380'>
         end do<a name='16381'>
      endif<a name='16382'>
<a name='16383'>
<font color=#447700>! Limit upper bound of reice for Fu ice parameterization and convert<a name='16384'></font>
<font color=#447700>! from effective radius to generalized effective size (*1.0315; Fu, 1996)<a name='16385'></font>
            if (iceflglw .eq. 3) then<a name='16386'>
               do k = kts, kte<a name='16387'>
                  reice(icol,k) = reice(icol,k) * 1.0315<a name='16388'>
                  reice(icol,k) = min(140.0,reice(icol,k))<a name='16389'>
               end do<a name='16390'>
            endif<a name='16391'>
<font color=#447700>!if CAMMGMP is used, use output from CAMMGMP<a name='16392'></font>
            if(is_CAMMGMP_used) then<a name='16393'>
               do k = kts, kte<a name='16394'>
                  if ( qi1d(k) .gt. 1.e-20 .or. qs1d(k) .gt. 1.e-20) then<a name='16395'>
                     reice(icol,k) = iradius(i,k,j)<a name='16396'>
                  else<a name='16397'>
                     reice(icol,k) = 25.<a name='16398'>
                  end if<a name='16399'>
                  reice(icol,k) = max(5., min(140.0,reice(icol,k)))<a name='16400'>
                  if ( qc1d(k) .gt. 1.e-20) then<a name='16401'>
                     reliq(icol,k) = lradius(i,k,j)<a name='16402'>
                  else<a name='16403'>
                     reliq(icol,k) = 10.<a name='16404'>
                  end if<a name='16405'>
                  reliq(icol,k) = max(2.5, min(60.0,reliq(icol,k)))<a name='16406'>
               enddo<a name='16407'>
            endif<a name='16408'>
<a name='16409'>
<a name='16410'>
<font color=#447700>! Set cloud physical property arrays<a name='16411'></font>
            do k = kts, kte<a name='16412'>
               clwpth(icol,k) = cliqwp(icol,k)<a name='16413'>
               ciwpth(icol,k) = cicewp(icol,k)<a name='16414'>
               rel(icol,k) = reliq(icol,k)<a name='16415'>
               rei(icol,k) = reice(icol,k)<a name='16416'>
            enddo<a name='16417'>
<a name='16418'>
<font color=#447700>!Mukul<a name='16419'></font>
            if (inflglw .eq. 5) then<a name='16420'>
               do k = kts, kte<a name='16421'>
                  cswpth(icol,k) = csnowp(icol,k)<a name='16422'>
                  res(icol,k) = resnow1d(icol,k)<a name='16423'>
               end do<a name='16424'>
            else<a name='16425'>
               do k = kts, kte<a name='16426'>
                  cswpth(icol,k) = 0.<a name='16427'>
                  res(icol,k) = 10.<a name='16428'>
               end do<a name='16429'>
            endif<a name='16430'>
<a name='16431'>
<font color=#447700>! Zero out cloud optical properties here; not used when passing physical properties<a name='16432'></font>
<font color=#447700>! to radiation and taucld is calculated in radiation <a name='16433'></font>
            do k = kts, kte<a name='16434'>
               do nb = 1, nbndlw<a name='16435'>
                  taucld(icol,nb,k) = 0.0<a name='16436'>
               enddo<a name='16437'>
            enddo<a name='16438'>
         endif<a name='16439'>
<a name='16440'>
<font color=#447700>! No clouds are allowed in the extra layer from model top to TOA<a name='16441'></font>
         <font color=#447700>! Steven Cavallo: Edited out for buffer adjustment below<a name='16442'></font>
         if ( 1 == 0 ) then<a name='16443'>
<a name='16444'>
<a name='16445'>
         clwpth(icol,kte+1) = 0.<a name='16446'>
         ciwpth(icol,kte+1) = 0.<a name='16447'>
         cswpth(icol,kte+1) = 0.<a name='16448'>
         rel(icol,kte+1) = 10.<a name='16449'>
         rei(icol,kte+1) = 10.<a name='16450'>
         res(icol,kte+1) = 10.<a name='16451'>
         cldfrac(icol,kte+1) = 0.<a name='16452'>
         do nb = 1, nbndlw<a name='16453'>
            taucld(icol,nb,kte+1) = 0.<a name='16454'>
         enddo<a name='16455'>
<a name='16456'>
         endif<a name='16457'>
<a name='16458'>
         <font color=#447700>! Buffer adjustment. Steven Cavallo December 2010<a name='16459'></font>
         do k=kte+1,nlayers<a name='16460'>
            clwpth(icol,k) = 0.<a name='16461'>
            ciwpth(icol,k) = 0.<a name='16462'>
            cswpth(icol,k) = 0.<a name='16463'>
            rel(icol,k) = 10.<a name='16464'>
            rei(icol,k) = 10.<a name='16465'>
            res(icol,k) = 10.<a name='16466'>
            cldfrac(icol,k) = 0.<a name='16467'>
            do nb = 1,nbndlw<a name='16468'>
               taucld(icol,nb,k) = 0.<a name='16469'>
            enddo<a name='16470'>
         enddo   <a name='16471'>
<a name='16472'>
<font color=#447700>! mji - mcica sub-column generator called inside rrtmg_lw for gpu<a name='16473'></font>
<font color=#447700>!         iplon = 1<a name='16474'></font>
<font color=#447700>!         irng = 0<a name='16475'></font>
<font color=#447700>! Sub-column generator for McICA<a name='16476'></font>
<font color=#447700>!         call mcica_subcol_lw(iplon, ncol, nlay, icld, permuteseed, irng, play, &amp;<a name='16477'></font>
<font color=#447700>!                       cldfrac, ciwpth, clwpth, cswpth, rei, rel, res, taucld, cldfmcl, &amp;<a name='16478'></font>
<font color=#447700>!                       ciwpmcl, clwpmcl, cswpmcl, reicmcl, relqmcl, resnmcl, taucmcl)<a name='16479'></font>
<a name='16480'>
<font color=#447700>!--------------------------------------------------------------------------<a name='16481'></font>
<font color=#447700>! Aerosol optical depth, single scattering albedo and asymmetry parameter -czhao 03/2010<a name='16482'></font>
<font color=#447700>!--------------------------------------------------------------------------<a name='16483'></font>
<font color=#447700>! Aerosol optical depth by layer for each RRTMG longwave band<a name='16484'></font>
<font color=#447700>! No aerosols in layer above model top (kte+1)<a name='16485'></font>
<font color=#447700>! Steven Cavallo: Upper bound of loop changed to nlayers from kte+1<a name='16486'></font>
<font color=#447700>!        do nb = 1, nbndlw<a name='16487'></font>
<font color=#447700>!           do k = kts, kte+1<a name='16488'></font>
<font color=#447700>!              tauaer(ncol,k,nb) = 0.<a name='16489'></font>
<font color=#447700>!           enddo<a name='16490'></font>
<font color=#447700>!        enddo<a name='16491'></font>
<a name='16492'>
<font color=#447700>! ... Aerosol effects. Added aerosol feedbacks from Chem , 03/2010 -czhao<a name='16493'></font>
<font color=#447700>!<a name='16494'></font>
      do nb = 1, nbndlw<a name='16495'>
      do k = kts,nlayers<a name='16496'>
         tauaer(icol,k,nb) = 0.<a name='16497'>
      end do<a name='16498'>
      end do<a name='16499'>
<a name='16500'>
#if ( WRF_CHEM == 1 )<a name='16501'>
   IF ( AER_RA_FEEDBACK == 1) then<a name='16502'>
<font color=#447700>!     do nb = 1, nbndlw <a name='16503'></font>
      do k = kts,kte      <font color=#447700>!wig<a name='16504'></font>
        if(tauaerlw1(i,k,j).gt.thresh .and. tauaerlw16(i,k,j).gt.thresh) then<a name='16505'>
          tauaer(icol,k,1)=tauaerlw1(i,k,j)<a name='16506'>
          tauaer(icol,k,2)=tauaerlw2(i,k,j)<a name='16507'>
          tauaer(icol,k,3)=tauaerlw3(i,k,j)<a name='16508'>
          tauaer(icol,k,4)=tauaerlw4(i,k,j)<a name='16509'>
          tauaer(icol,k,5)=tauaerlw5(i,k,j)<a name='16510'>
          tauaer(icol,k,6)=tauaerlw6(i,k,j)<a name='16511'>
          tauaer(icol,k,7)=tauaerlw7(i,k,j)<a name='16512'>
          tauaer(icol,k,8)=tauaerlw8(i,k,j)<a name='16513'>
          tauaer(icol,k,9)=tauaerlw9(i,k,j)<a name='16514'>
          tauaer(icol,k,10)=tauaerlw10(i,k,j)<a name='16515'>
          tauaer(icol,k,11)=tauaerlw11(i,k,j)<a name='16516'>
          tauaer(icol,k,12)=tauaerlw12(i,k,j)<a name='16517'>
          tauaer(icol,k,13)=tauaerlw13(i,k,j)<a name='16518'>
          tauaer(icol,k,14)=tauaerlw14(i,k,j)<a name='16519'>
          tauaer(icol,k,15)=tauaerlw15(i,k,j)<a name='16520'>
          tauaer(icol,k,16)=tauaerlw16(i,k,j)<a name='16521'>
        endif<a name='16522'>
      enddo <font color=#447700>! k<a name='16523'></font>
<font color=#447700>!     end do ! nb<a name='16524'></font>
<a name='16525'>
<font color=#447700>!wig beg<a name='16526'></font>
      do nb = 1, nbndlw<a name='16527'>
         slope = 0.  <font color=#447700>!use slope as a sum holder<a name='16528'></font>
         do k = kts,kte<a name='16529'>
            slope = slope + tauaer(icol,k,nb)<a name='16530'>
         end do<a name='16531'>
         if( slope &lt; 0. ) then<a name='16532'>
            write(msg,'("ERROR: Negative total lw optical depth of ",f8.2," at point i,j,nb=",3i5)') slope,i,j,nb<a name='16533'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1053">(msg)<a name='16534'>
         else if( slope &gt; 5. ) then<a name='16535'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_861">("-------------------------")<a name='16536'>
            write(msg,'("WARNING: Large total lw optical depth of ",f8.2," at point i,j,nb=",3i5)') slope,i,j,nb<a name='16537'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_862">(msg)<a name='16538'>
<a name='16539'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_863">("Diagnostics 1: k, tauaerlw1, tauaerlw16")<a name='16540'>
            do k=kts,kte<a name='16541'>
               write(msg,'(i4,2f8.2)') k, tauaerlw1(i,k,j), tauaerlw16(i,k,j)<a name='16542'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_864">(msg)<a name='16543'>
            end do<a name='16544'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_865">("-------------------------")<a name='16545'>
         endif<a name='16546'>
      enddo  <font color=#447700>! nb<a name='16547'></font>
      endif  <font color=#447700>! aer_ra_feedback<a name='16548'></font>
#endif<a name='16549'>
<a name='16550'>
<font color=#447700>!<a name='16551'></font>
      end do i_loop<a name='16552'>
   end do j_loop                                           <a name='16553'>
<a name='16554'>
<font color=#447700>! Call RRTMG longwave radiation model for full grid for gpu<a name='16555'></font>
         call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW'>rrtmg_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWRAD_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_2"> &amp;<a name='16556'>
            (ncol    ,nlay    ,icld    ,idrv    , &amp;<a name='16557'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='16558'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='16559'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='16560'>
             inflglw ,iceflglw,liqflglw,cldfrac , &amp;<a name='16561'>
             taucld  ,ciwpth  ,clwpth  ,cswpth  ,rei  ,rel ,res , &amp;<a name='16562'>
             tauaer  , &amp;<a name='16563'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc,  hrc, &amp;<a name='16564'>
             duflx_dt,duflxc_dt)<a name='16565'>
<a name='16566'>
<font color=#447700>! Output downard surface flux, and outgoing longwave flux and cloud forcing <a name='16567'></font>
<font color=#447700>! at the top of atmosphere (W/m2)<a name='16568'></font>
<a name='16569'>
<font color=#447700>! latitude loop<a name='16570'></font>
   j_loop2: do j = jts,jte<a name='16571'>
<a name='16572'>
<font color=#447700>! longitude loop<a name='16573'></font>
      i_loop2: do i = its,ite<a name='16574'>
<a name='16575'>
         icol = i-its+1 + (j-jts)*(ite-its+1)<a name='16576'>
<a name='16577'>
         glw(i,j) = dflx(icol,1)<a name='16578'>
<font color=#447700>!         olr(i,j) = uflx(icol,kte+2)<a name='16579'></font>
<font color=#447700>!         lwcf(i,j) = uflxc(icol,kte+2) - uflx(icol,kte+2)<a name='16580'></font>
<font color=#447700>! Steven Cavallo: Changed OLR to be valid at the top of atmosphere instead <a name='16581'></font>
<font color=#447700>! of top of model.  Dec 2010.<a name='16582'></font>
         olr(i,j) = uflx(icol,nlayers+1)<a name='16583'>
         lwcf(i,j) = uflxc(icol,nlayers+1) - uflx(icol,nlayers+1)<a name='16584'>
<a name='16585'>
         if (present(lwupt)) then <a name='16586'>
<font color=#447700>! Output up and down toa fluxes for total and clear sky<a name='16587'></font>
            lwupt(i,j)     = uflx(icol,nlayers+1)<a name='16588'>
            lwuptc(i,j)    = uflxc(icol,nlayers+1)<a name='16589'>
            lwdnt(i,j)     = dflx(icol,nlayers+1)<a name='16590'>
            lwdntc(i,j)    = dflxc(icol,nlayers+1)<a name='16591'>
<font color=#447700>! Output up and down surface fluxes for total and clear sky<a name='16592'></font>
            lwupb(i,j)     = uflx(icol,1)<a name='16593'>
            lwupbc(i,j)    = uflxc(icol,1)<a name='16594'>
            lwdnb(i,j)     = dflx(icol,1)<a name='16595'>
            lwdnbc(i,j)    = dflxc(icol,1)<a name='16596'>
         endif<a name='16597'>
<a name='16598'>
<font color=#447700>! Output up and down layer fluxes for total and clear sky.<a name='16599'></font>
<font color=#447700>! Vertical ordering is from bottom to top in units of W m-2. <a name='16600'></font>
         if ( present (lwupflx) ) then<a name='16601'>
         do k=kts,kte+2<a name='16602'>
            lwupflx(i,k,j)  = uflx(icol,k)<a name='16603'>
            lwupflxc(i,k,j) = uflxc(icol,k)<a name='16604'>
            lwdnflx(i,k,j)  = dflx(icol,k)<a name='16605'>
            lwdnflxc(i,k,j) = dflxc(icol,k)<a name='16606'>
         enddo<a name='16607'>
         endif<a name='16608'>
<a name='16609'>
<font color=#447700>! Output heating rate tendency; convert heating rate from K/d to K/s<a name='16610'></font>
<font color=#447700>! Heating rate arrays are ordered vertically from bottom to top here. <a name='16611'></font>
         do k=kts,kte<a name='16612'>
            tten1d(k) = hr(icol,k)/86400.<a name='16613'>
            rthratenlw(i,k,j) = tten1d(k)/pi3d(i,k,j)<a name='16614'>
         enddo<a name='16615'>
<font color=#447700>!<a name='16616'></font>
      end do i_loop2<a name='16617'>
   end do j_loop2                                           <a name='16618'>
<a name='16619'>
<font color=#447700>!-------------------------------------------------------------------<a name='16620'></font>
<a name='16621'>
   END SUBROUTINE RRTMG_LWRAD_FAST<a name='16622'>
<a name='16623'>
 <a name='16624'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16625'></font>
<A NAME='INIRAD'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INIRAD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16626'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>INIRAD</font> (O3PROF,Plev, kts, kte) <A href='../../call_to/INIRAD.html' TARGET='index'>6</A>,<A href='../../call_from/INIRAD.html' TARGET='index'>3</A><a name='16627'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16628'></font>
      IMPLICIT NONE<a name='16629'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16630'></font>
   INTEGER, INTENT(IN   )                        ::    kts,kte<a name='16631'>
<a name='16632'>
   REAL, DIMENSION( kts:kte+1 ),INTENT(INOUT)    ::    O3PROF<a name='16633'>
<a name='16634'>
   REAL, DIMENSION( kts:kte+2 ),INTENT(IN   )    ::      Plev<a name='16635'>
<a name='16636'>
<font color=#447700>! LOCAL VAR<a name='16637'></font>
  <a name='16638'>
   INTEGER :: k<a name='16639'>
<a name='16640'>
<font color=#447700>!                                                                                <a name='16641'></font>
<font color=#447700>!  COMPUTE OZONE MIXING RATIO DISTRIBUTION                                       <a name='16642'></font>
<font color=#447700>!                                                                                <a name='16643'></font>
   DO K=kts,kte+1<a name='16644'>
      O3PROF(K)=0.                                                       <a name='16645'>
   ENDDO<a name='16646'>
                                                                                 <a name='16647'>
   CALL <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#O3DATA'>O3DATA</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INIRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="O3DATA_3">(O3PROF, Plev, kts, kte)<a name='16648'>
<a name='16649'>
   END SUBROUTINE INIRAD<a name='16650'>
                                                                                 <a name='16651'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16652'></font>
<A NAME='O3DATA'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#O3DATA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16653'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>O3DATA</font> (O3PROF, Plev, kts, kte) <A href='../../call_to/O3DATA.html' TARGET='index'>3</A><a name='16654'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16655'></font>
   IMPLICIT NONE<a name='16656'>
<font color=#447700>!-------------------------------------------------------------------------<a name='16657'></font>
<font color=#447700>!<a name='16658'></font>
   INTEGER, INTENT(IN   )   ::       kts, kte<a name='16659'>
<font color=#447700>!<a name='16660'></font>
   REAL, DIMENSION( kts:kte+1 ),INTENT(INOUT)    ::    O3PROF<a name='16661'>
<a name='16662'>
   REAL, DIMENSION( kts:kte+2 ),INTENT(IN   )    ::      Plev<a name='16663'>
<a name='16664'>
<font color=#447700>! LOCAL VAR<a name='16665'></font>
   INTEGER :: K, JJ<a name='16666'>
<a name='16667'>
   REAL    ::  PRLEVH(kts:kte+2),PPWRKH(32),                     &amp;<a name='16668'>
               O3WRK(31),PPWRK(31),O3SUM(31),PPSUM(31),          &amp;<a name='16669'>
               O3WIN(31),PPWIN(31),O3ANN(31),PPANN(31)                                                       <a name='16670'>
<a name='16671'>
   REAL    ::  PB1, PB2, PT1, PT2<a name='16672'>
<a name='16673'>
   DATA O3SUM  /5.297E-8,5.852E-8,6.579E-8,7.505E-8,             &amp;                    <a name='16674'>
        8.577E-8,9.895E-8,1.175E-7,1.399E-7,1.677E-7,2.003E-7,   &amp;                 <a name='16675'>
        2.571E-7,3.325E-7,4.438E-7,6.255E-7,8.168E-7,1.036E-6,   &amp;                 <a name='16676'>
        1.366E-6,1.855E-6,2.514E-6,3.240E-6,4.033E-6,4.854E-6,   &amp;                 <a name='16677'>
        5.517E-6,6.089E-6,6.689E-6,1.106E-5,1.462E-5,1.321E-5,   &amp;                 <a name='16678'>
        9.856E-6,5.960E-6,5.960E-6/                                              <a name='16679'>
<a name='16680'>
   DATA PPSUM  /955.890,850.532,754.599,667.742,589.841,         &amp;  <a name='16681'>
        519.421,455.480,398.085,347.171,301.735,261.310,225.360, &amp;               <a name='16682'>
        193.419,165.490,141.032,120.125,102.689, 87.829, 75.123, &amp;            <a name='16683'>
         64.306, 55.086, 47.209, 40.535, 34.795, 29.865, 19.122, &amp;               <a name='16684'>
          9.277,  4.660,  2.421,  1.294,  0.647/                                 <a name='16685'>
<font color=#447700>!                                                                                <a name='16686'></font>
   DATA O3WIN  /4.629E-8,4.686E-8,5.017E-8,5.613E-8,             &amp;<a name='16687'>
        6.871E-8,8.751E-8,1.138E-7,1.516E-7,2.161E-7,3.264E-7,   &amp;               <a name='16688'>
        4.968E-7,7.338E-7,1.017E-6,1.308E-6,1.625E-6,2.011E-6,   &amp;               <a name='16689'>
        2.516E-6,3.130E-6,3.840E-6,4.703E-6,5.486E-6,6.289E-6,   &amp;               <a name='16690'>
        6.993E-6,7.494E-6,8.197E-6,9.632E-6,1.113E-5,1.146E-5,   &amp;               <a name='16691'>
        9.389E-6,6.135E-6,6.135E-6/                                              <a name='16692'>
<a name='16693'>
   DATA PPWIN  /955.747,841.783,740.199,649.538,568.404,         &amp;<a name='16694'>
        495.815,431.069,373.464,322.354,277.190,237.635,203.433, &amp;               <a name='16695'>
        174.070,148.949,127.408,108.915, 93.114, 79.551, 67.940, &amp;               <a name='16696'>
         58.072, 49.593, 42.318, 36.138, 30.907, 26.362, 16.423, &amp;               <a name='16697'>
          7.583,  3.620,  1.807,  0.938,  0.469/                                 <a name='16698'>
<font color=#447700>!                                                                                <a name='16699'></font>
<a name='16700'>
   DO K=1,31                                                              <a name='16701'>
     PPANN(K)=PPSUM(K)                                                        <a name='16702'>
   ENDDO<a name='16703'>
<font color=#447700>!<a name='16704'></font>
   O3ANN(1)=0.5*(O3SUM(1)+O3WIN(1))                                           <a name='16705'>
<font color=#447700>!                                                                                <a name='16706'></font>
   DO K=2,31                                                              <a name='16707'>
      O3ANN(K)=O3WIN(K-1)+(O3WIN(K)-O3WIN(K-1))/(PPWIN(K)-PPWIN(K-1))* &amp; <a name='16708'>
               (PPSUM(K)-PPWIN(K-1))                                           <a name='16709'>
   ENDDO<a name='16710'>
<font color=#447700>!<a name='16711'></font>
   DO K=2,31                                                              <a name='16712'>
      O3ANN(K)=0.5*(O3ANN(K)+O3SUM(K))                                         <a name='16713'>
   ENDDO<a name='16714'>
<font color=#447700>!<a name='16715'></font>
   DO K=1,31                                                                <a name='16716'>
      O3WRK(K)=O3ANN(K)                                                        <a name='16717'>
      PPWRK(K)=PPANN(K)                                                        <a name='16718'>
   ENDDO<a name='16719'>
<font color=#447700>!                                                                                <a name='16720'></font>
<font color=#447700>!  CALCULATE HALF PRESSURE LEVELS FOR MODEL AND DATA LEVELS                     <a name='16721'></font>
<font color=#447700>!                                                                                <a name='16722'></font>
<a name='16723'>
<font color=#447700>! Plev is total P at model levels, from bottom to top<a name='16724'></font>
<font color=#447700>! Plev is in mb<a name='16725'></font>
<a name='16726'>
   DO K=kts,kte+2<a name='16727'>
      PRLEVH(K)=Plev(K)<a name='16728'>
   ENDDO<a name='16729'>
<font color=#447700>!                                                                                <a name='16730'></font>
   PPWRKH(1)=1100.                                                        <a name='16731'>
   DO K=2,31                                                           <a name='16732'>
      PPWRKH(K)=(PPWRK(K)+PPWRK(K-1))/2.                                   <a name='16733'>
   ENDDO<a name='16734'>
   PPWRKH(32)=0.                                                          <a name='16735'>
   DO K=kts,kte+1<a name='16736'>
      DO 25 JJ=1,31                                                        <a name='16737'>
         IF((-(PRLEVH(K)-PPWRKH(JJ))).GE.0.)THEN                            <a name='16738'>
           PB1=0.                                                           <a name='16739'>
         ELSE                                                               <a name='16740'>
           PB1=PRLEVH(K)-PPWRKH(JJ)                                         <a name='16741'>
         ENDIF                                                              <a name='16742'>
         IF((-(PRLEVH(K)-PPWRKH(JJ+1))).GE.0.)THEN                          <a name='16743'>
           PB2=0.                                                           <a name='16744'>
         ELSE                                                               <a name='16745'>
           PB2=PRLEVH(K)-PPWRKH(JJ+1)                                       <a name='16746'>
         ENDIF                                                              <a name='16747'>
         IF((-(PRLEVH(K+1)-PPWRKH(JJ))).GE.0.)THEN                          <a name='16748'>
           PT1=0.                                                           <a name='16749'>
         ELSE                                                               <a name='16750'>
           PT1=PRLEVH(K+1)-PPWRKH(JJ)                                       <a name='16751'>
         ENDIF                                                              <a name='16752'>
         IF((-(PRLEVH(K+1)-PPWRKH(JJ+1))).GE.0.)THEN                        <a name='16753'>
           PT2=0.                                                           <a name='16754'>
         ELSE                                                               <a name='16755'>
           PT2=PRLEVH(K+1)-PPWRKH(JJ+1)                                     <a name='16756'>
         ENDIF                                                              <a name='16757'>
         O3PROF(K)=O3PROF(K)+(PB2-PB1-PT2+PT1)*O3WRK(JJ)                <a name='16758'>
  25  CONTINUE                                                             <a name='16759'>
      O3PROF(K)=O3PROF(K)/(PRLEVH(K)-PRLEVH(K+1))                      <a name='16760'>
<a name='16761'>
   ENDDO<a name='16762'>
<font color=#447700>!                                                                                <a name='16763'></font>
   END SUBROUTINE O3DATA<a name='16764'>
<a name='16765'>
<font color=#447700>!------------------------------------------------------------------<a name='16766'></font>
<a name='16767'>
<font color=#447700>!====================================================================<a name='16768'></font>
<A NAME='RRTMG_LWINIT_FAST'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWINIT_FAST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16769'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>rrtmg_lwinit_fast</font>(                                         &amp; <A href='../../call_to/RRTMG_LWINIT_FAST.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LWINIT_FAST.html' TARGET='index'>2</A><a name='16770'>
                       p_top, allowed_to_read ,                     &amp;<a name='16771'>
                       ids, ide, jds, jde, kds, kde,                &amp;<a name='16772'>
                       ims, ime, jms, jme, kms, kme,                &amp;<a name='16773'>
                       its, ite, jts, jte, kts, kte                 )<a name='16774'>
<font color=#447700>!--------------------------------------------------------------------<a name='16775'></font>
   IMPLICIT NONE<a name='16776'>
<font color=#447700>!--------------------------------------------------------------------<a name='16777'></font>
<a name='16778'>
   LOGICAL , INTENT(IN)           :: allowed_to_read<a name='16779'>
   INTEGER , INTENT(IN)           :: ids, ide, jds, jde, kds, kde,  &amp;<a name='16780'>
                                     ims, ime, jms, jme, kms, kme,  &amp;<a name='16781'>
                                     its, ite, jts, jte, kts, kte<a name='16782'>
   REAL, INTENT(IN)               :: p_top <a name='16783'>
<a name='16784'>
<font color=#447700>! Steven Cavallo.  Added for buffer layer adjustment.   December 2010.<a name='16785'></font>
   NLAYERS = kme + nint(p_top*0.01/deltap)- 1 <font color=#447700>! Model levels plus new levels.<a name='16786'></font>
                                              <font color=#447700>! nlayers will subsequently <a name='16787'></font>
                                              <font color=#447700>! replace kte+1<a name='16788'></font>
<a name='16789'>
<font color=#447700>! Read in absorption coefficients and other data<a name='16790'></font>
   IF ( allowed_to_read ) THEN<a name='16791'>
     CALL <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE'>rrtmg_lwlookuptable</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWINIT_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LWLOOKUPTABLE_2"><a name='16792'>
   ENDIF<a name='16793'>
<a name='16794'>
<font color=#447700>! Perform g-point reduction and other initializations<a name='16795'></font>
<font color=#447700>! Specific heat of dry air (cp) used in flux to heating rate conversion factor.<a name='16796'></font>
   call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI'>rrtmg_lw_ini</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWINIT_FAST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_INI_2">(cp)<a name='16797'>
<a name='16798'>
   END SUBROUTINE rrtmg_lwinit_fast<a name='16799'>
<a name='16800'>
<a name='16801'>
<font color=#447700>! **************************************************************************     <a name='16802'></font>
<A NAME='RRTMG_LWLOOKUPTABLE'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16803'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>rrtmg_lwlookuptable</font> <A href='../../call_to/RRTMG_LWLOOKUPTABLE.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LWLOOKUPTABLE.html' TARGET='index'>38</A><a name='16804'>
<font color=#447700>! **************************************************************************     <a name='16805'></font>
<a name='16806'>
IMPLICIT NONE<a name='16807'>
<a name='16808'>
<font color=#447700>! Local                                    <a name='16809'></font>
      INTEGER :: i<a name='16810'>
      LOGICAL                 :: opened<a name='16811'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='16812'>
<a name='16813'>
      CHARACTER*80 errmess<a name='16814'>
      INTEGER rrtmg_unit<a name='16815'>
<a name='16816'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='16817'>
        DO i = 10,99<a name='16818'>
          INQUIRE ( i , OPENED = opened )<a name='16819'>
          IF ( .NOT. opened ) THEN<a name='16820'>
            rrtmg_unit = i<a name='16821'>
            GOTO 2010<a name='16822'>
          ENDIF<a name='16823'>
        ENDDO<a name='16824'>
        rrtmg_unit = -1<a name='16825'>
 2010   CONTINUE<a name='16826'>
      ENDIF<a name='16827'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_335"> ( rrtmg_unit , IWORDSIZE )<a name='16828'>
      IF ( rrtmg_unit &lt; 0 ) THEN<a name='16829'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1054"> ( 'module_ra_rrtmg_lwf: rrtm_lwlookuptable: Can not '// &amp;<a name='16830'>
                               'find unused fortran unit to read in lookup table.' )<a name='16831'>
      ENDIF<a name='16832'>
<a name='16833'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='16834'>
        OPEN(rrtmg_unit,FILE='RRTMG_LW_DATA',                  &amp;<a name='16835'>
             FORM='UNFORMATTED',STATUS='OLD',ERR=9009)<a name='16836'>
      ENDIF<a name='16837'>
<a name='16838'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01'>lw_kgb01</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB01_2">(rrtmg_unit)<a name='16839'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02'>lw_kgb02</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB02_2">(rrtmg_unit)<a name='16840'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03'>lw_kgb03</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB03_2">(rrtmg_unit)<a name='16841'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04'>lw_kgb04</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB04_2">(rrtmg_unit)<a name='16842'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05'>lw_kgb05</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB05_2">(rrtmg_unit)<a name='16843'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06'>lw_kgb06</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB06_2">(rrtmg_unit)<a name='16844'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07'>lw_kgb07</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB07_2">(rrtmg_unit)<a name='16845'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08'>lw_kgb08</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB08_2">(rrtmg_unit)<a name='16846'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09'>lw_kgb09</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB09_2">(rrtmg_unit)<a name='16847'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10'>lw_kgb10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB10_2">(rrtmg_unit)<a name='16848'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11'>lw_kgb11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB11_2">(rrtmg_unit)<a name='16849'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12'>lw_kgb12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB12_2">(rrtmg_unit)<a name='16850'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13'>lw_kgb13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB13_2">(rrtmg_unit)<a name='16851'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14'>lw_kgb14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB14_2">(rrtmg_unit)<a name='16852'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15'>lw_kgb15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB15_2">(rrtmg_unit)<a name='16853'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16'>lw_kgb16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB16_2">(rrtmg_unit)<a name='16854'>
<a name='16855'>
     IF ( wrf_dm_on_monitor() ) CLOSE (rrtmg_unit)<a name='16856'>
<a name='16857'>
     RETURN<a name='16858'>
9009 CONTINUE<a name='16859'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error opening RRTMG_LW_DATA on unit ',rrtmg_unit<a name='16860'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1055">(errmess)<a name='16861'>
<a name='16862'>
     END SUBROUTINE rrtmg_lwlookuptable<a name='16863'>
<a name='16864'>
<font color=#447700>! **************************************************************************     <a name='16865'></font>
<font color=#447700>!  RRTMG Longwave Radiative Transfer Model<a name='16866'></font>
<font color=#447700>!  Atmospheric and Environmental Research, Inc., Cambridge, MA<a name='16867'></font>
<font color=#447700>!<a name='16868'></font>
<font color=#447700>!  Original version:   E. J. Mlawer, et al.<a name='16869'></font>
<font color=#447700>!  Revision for GCMs:  Michael J. Iacono; October, 2002<a name='16870'></font>
<font color=#447700>!  Revision for F90 formatting:  Michael J. Iacono; June 2006<a name='16871'></font>
<font color=#447700>!<a name='16872'></font>
<font color=#447700>!  This file contains 16 READ statements that include the <a name='16873'></font>
<font color=#447700>!  absorption coefficients and other data for each of the 16 longwave<a name='16874'></font>
<font color=#447700>!  spectral bands used in RRTMG_LW.  Here, the data are defined for 16<a name='16875'></font>
<font color=#447700>!  g-points, or sub-intervals, per band.  These data are combined and<a name='16876'></font>
<font color=#447700>!  weighted using a mapping procedure in module RRTMG_LW_INIT to reduce<a name='16877'></font>
<font color=#447700>!  the total number of g-points from 256 to 140 for use in the GCM.<a name='16878'></font>
<font color=#447700>! **************************************************************************     <a name='16879'></font>
<a name='16880'>
<font color=#447700>! **************************************************************************<a name='16881'></font>
<A NAME='LW_KGB01'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16882'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb01</font>(rrtmg_unit) <A href='../../call_to/LW_KGB01.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB01.html' TARGET='index'>6</A><a name='16883'>
<font color=#447700>! **************************************************************************<a name='16884'></font>
<a name='16885'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG01_F'>rrlw_kg01_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, &amp;<a name='16886'>
                           absa, absb, &amp;<a name='16887'>
                      selfrefo, forrefo<a name='16888'>
<a name='16889'>
      implicit none<a name='16890'>
      save<a name='16891'>
<a name='16892'>
<font color=#447700>! Input<a name='16893'></font>
      integer, intent(in) :: rrtmg_unit<a name='16894'>
<a name='16895'>
<font color=#447700>! Local                                    <a name='16896'></font>
      character*80 errmess<a name='16897'>
      logical, external  :: wrf_dm_on_monitor<a name='16898'>
<a name='16899'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='16900'></font>
<font color=#447700>!     and upper atmosphere.<a name='16901'></font>
<font color=#447700>!     Planck fraction mapping levels: P = 212.7250 mbar, T = 223.06 K<a name='16902'></font>
<a name='16903'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='16904'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='16905'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='16906'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='16907'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='16908'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='16909'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='16910'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='16911'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='16912'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='16913'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='16914'></font>
<a name='16915'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='16916'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='16917'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='16918'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='16919'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='16920'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='16921'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='16922'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='16923'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='16924'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='16925'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='16926'></font>
<a name='16927'>
<font color=#447700>!     The arrays kao_mn2 and kbo_mn2 contain the coefficients of the <a name='16928'></font>
<font color=#447700>!     nitrogen continuum for the upper and lower atmosphere.<a name='16929'></font>
<font color=#447700>!     Minor gas mapping levels: <a name='16930'></font>
<font color=#447700>!     Lower - n2: P = 142.5490 mbar, T = 215.70 K<a name='16931'></font>
<font color=#447700>!     Upper - n2: P = 142.5490 mbar, T = 215.70 K<a name='16932'></font>
<a name='16933'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='16934'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='16935'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='16936'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='16937'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='16938'></font>
<a name='16939'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='16940'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='16941'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='16942'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='16943'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='16944'></font>
<a name='16945'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_336"> ( A , size ( A ) * RWORDSIZE )<a name='16946'>
<a name='16947'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='16948'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, selfrefo, forrefo<a name='16949'>
      DM_BCAST_MACRO(fracrefao)<a name='16950'>
      DM_BCAST_MACRO(fracrefbo)<a name='16951'>
      DM_BCAST_MACRO(kao)<a name='16952'>
      DM_BCAST_MACRO(kbo)<a name='16953'>
      DM_BCAST_MACRO(kao_mn2)<a name='16954'>
      DM_BCAST_MACRO(kbo_mn2)<a name='16955'>
      DM_BCAST_MACRO(selfrefo)<a name='16956'>
      DM_BCAST_MACRO(forrefo)<a name='16957'>
<a name='16958'>
     RETURN<a name='16959'>
9010 CONTINUE<a name='16960'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='16961'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1056">(errmess)<a name='16962'>
<a name='16963'>
      end subroutine lw_kgb01<a name='16964'>
<a name='16965'>
<font color=#447700>! **************************************************************************<a name='16966'></font>
<A NAME='LW_KGB02'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='16967'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb02</font>(rrtmg_unit) <A href='../../call_to/LW_KGB02.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB02.html' TARGET='index'>6</A><a name='16968'>
<font color=#447700>! **************************************************************************<a name='16969'></font>
<a name='16970'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG02_F'>rrlw_kg02_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_F_4">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='16971'>
<a name='16972'>
      implicit none<a name='16973'>
      save<a name='16974'>
<a name='16975'>
<font color=#447700>! Input<a name='16976'></font>
      integer, intent(in) :: rrtmg_unit<a name='16977'>
<a name='16978'>
<font color=#447700>! Local                                    <a name='16979'></font>
      character*80 errmess<a name='16980'>
      logical, external  :: wrf_dm_on_monitor<a name='16981'>
<a name='16982'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='16983'></font>
<font color=#447700>!     and upper atmosphere.<a name='16984'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='16985'></font>
<font color=#447700>!     Lower: P = 1053.630 mbar, T = 294.2 K<a name='16986'></font>
<font color=#447700>!     Upper: P = 3.206e-2 mb, T = 197.92 K<a name='16987'></font>
<a name='16988'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='16989'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='16990'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='16991'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='16992'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='16993'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='16994'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='16995'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='16996'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='16997'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='16998'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='16999'></font>
<a name='17000'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17001'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17002'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17003'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17004'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17005'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17006'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17007'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17008'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17009'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17010'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17011'></font>
<a name='17012'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17013'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17014'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17015'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17016'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17017'></font>
<a name='17018'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17019'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17020'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17021'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17022'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17023'></font>
<a name='17024'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_337"> ( A , size ( A ) * RWORDSIZE )<a name='17025'>
<a name='17026'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17027'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='17028'>
      DM_BCAST_MACRO(fracrefao)<a name='17029'>
      DM_BCAST_MACRO(fracrefbo)<a name='17030'>
      DM_BCAST_MACRO(kao)<a name='17031'>
      DM_BCAST_MACRO(kbo)<a name='17032'>
      DM_BCAST_MACRO(selfrefo)<a name='17033'>
      DM_BCAST_MACRO(forrefo)<a name='17034'>
<a name='17035'>
     RETURN<a name='17036'>
9010 CONTINUE<a name='17037'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17038'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1057">(errmess)<a name='17039'>
<a name='17040'>
      end subroutine lw_kgb02<a name='17041'>
<a name='17042'>
<font color=#447700>! **************************************************************************<a name='17043'></font>
<A NAME='LW_KGB03'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17044'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb03</font>(rrtmg_unit) <A href='../../call_to/LW_KGB03.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB03.html' TARGET='index'>6</A><a name='17045'>
<font color=#447700>! **************************************************************************<a name='17046'></font>
<a name='17047'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG03_F'>rrlw_kg03_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2o, &amp;<a name='17048'>
                            kbo_mn2o, selfrefo, forrefo<a name='17049'>
<a name='17050'>
      implicit none<a name='17051'>
      save<a name='17052'>
<a name='17053'>
<font color=#447700>! Input<a name='17054'></font>
      integer, intent(in) :: rrtmg_unit<a name='17055'>
<a name='17056'>
<font color=#447700>! Local                                    <a name='17057'></font>
      character*80 errmess<a name='17058'>
      logical, external  :: wrf_dm_on_monitor<a name='17059'>
<a name='17060'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17061'></font>
<font color=#447700>!     and upper atmosphere.<a name='17062'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17063'></font>
<font color=#447700>!     Lower: P = 212.7250 mbar, T = 223.06 K<a name='17064'></font>
<font color=#447700>!     Upper: P = 95.8 mbar, T = 215.7 k<a name='17065'></font>
<a name='17066'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17067'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17068'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17069'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17070'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17071'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17072'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17073'></font>
<font color=#447700>!     to that of gas2.<a name='17074'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17075'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17076'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17077'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17078'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17079'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17080'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17081'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17082'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17083'></font>
<a name='17084'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17085'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17086'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17087'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17088'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17089'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17090'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17091'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17092'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17093'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17094'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17095'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17096'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17097'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17098'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17099'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17100'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17101'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17102'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17103'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17104'></font>
<a name='17105'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17106'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17107'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='17108'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17109'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17110'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17111'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17112'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='17113'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17114'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='17115'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17116'></font>
<a name='17117'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='17118'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17119'></font>
<font color=#447700>!     level above 100~ mb.   The first index in the array, JS, runs<a name='17120'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amounts ratios,<a name='17121'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17122'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17123'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 to <a name='17124'></font>
<font color=#447700>!     that of gas2.  The second index refers to temperature <a name='17125'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17126'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='17127'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17128'></font>
<a name='17129'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17130'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17131'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17132'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17133'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17134'></font>
<a name='17135'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17136'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17137'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17138'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17139'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17140'></font>
<a name='17141'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_338"> ( A , size ( A ) * RWORDSIZE )<a name='17142'>
<a name='17143'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17144'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, selfrefo, forrefo<a name='17145'>
      DM_BCAST_MACRO(fracrefao)<a name='17146'>
      DM_BCAST_MACRO(fracrefbo)<a name='17147'>
      DM_BCAST_MACRO(kao)<a name='17148'>
      DM_BCAST_MACRO(kbo)<a name='17149'>
      DM_BCAST_MACRO(kao_mn2o)<a name='17150'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='17151'>
      DM_BCAST_MACRO(selfrefo)<a name='17152'>
      DM_BCAST_MACRO(forrefo)<a name='17153'>
<a name='17154'>
     RETURN<a name='17155'>
9010 CONTINUE<a name='17156'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17157'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1058">(errmess)<a name='17158'>
<a name='17159'>
      end subroutine lw_kgb03 <a name='17160'>
<a name='17161'>
<font color=#447700>! **************************************************************************<a name='17162'></font>
<A NAME='LW_KGB04'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17163'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb04</font>(rrtmg_unit) <A href='../../call_to/LW_KGB04.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB04.html' TARGET='index'>6</A><a name='17164'>
<font color=#447700>! **************************************************************************<a name='17165'></font>
<a name='17166'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG04_F'>rrlw_kg04_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_F_4">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='17167'>
<a name='17168'>
      implicit none<a name='17169'>
      save<a name='17170'>
<a name='17171'>
<font color=#447700>! Input<a name='17172'></font>
      integer, intent(in) :: rrtmg_unit<a name='17173'>
<a name='17174'>
<font color=#447700>! Local                                    <a name='17175'></font>
      character*80 errmess<a name='17176'>
      logical, external  :: wrf_dm_on_monitor<a name='17177'>
<a name='17178'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17179'></font>
<font color=#447700>!     and upper atmosphere.<a name='17180'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17181'></font>
<font color=#447700>!     Lower : P = 142.5940 mbar, T = 215.70 K<a name='17182'></font>
<font color=#447700>!     Upper : P = 95.58350 mb, T = 215.70 K<a name='17183'></font>
<a name='17184'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17185'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17186'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17187'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17188'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17189'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17190'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17191'></font>
<font color=#447700>!     to that of gas2.<a name='17192'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17193'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17194'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17195'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17196'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17197'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17198'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17199'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17200'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17201'></font>
<a name='17202'>
<font color=#447700>!     The array KBO contains absorption coefs for each of the 16 g-intervals<a name='17203'></font>
<font color=#447700>!     for a range of pressure levels  &lt; ~100mb, temperatures, and ratios<a name='17204'></font>
<font color=#447700>!     of H2O to CO2.  The first index in the array, JS, runs<a name='17205'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17206'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17207'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17208'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17209'></font>
<font color=#447700>!     to that of gas2.  The second index, JT, which<a name='17210'></font>
<font color=#447700>!     runs from 1 to 5, corresponds to different temperatures.  More <a name='17211'></font>
<font color=#447700>!     specifically, JT = 3 means that the data are for the corresponding <a name='17212'></font>
<font color=#447700>!     reference temperature TREF for this  pressure level, JT = 2 refers <a name='17213'></font>
<font color=#447700>!     to the TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and<a name='17214'></font>
<font color=#447700>!     JT = 5 is for TREF+30.  The third index, JP, runs from 13 to 59 and<a name='17215'></font>
<font color=#447700>!     refers to the corresponding pressure level in PREF (e.g. JP = 13 is<a name='17216'></font>
<font color=#447700>!     for a pressure of 95.5835 mb).  The fourth index, IG, goes from 1 to<a name='17217'></font>
<font color=#447700>!     16, and tells us which g-interval the absorption coefficients are for.<a name='17218'></font>
<a name='17219'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17220'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17221'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17222'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17223'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17224'></font>
<a name='17225'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17226'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17227'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17228'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17229'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17230'></font>
<a name='17231'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_339"> ( A , size ( A ) * RWORDSIZE )<a name='17232'>
<a name='17233'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17234'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='17235'>
      DM_BCAST_MACRO(fracrefao)<a name='17236'>
      DM_BCAST_MACRO(fracrefbo)<a name='17237'>
      DM_BCAST_MACRO(kao)<a name='17238'>
      DM_BCAST_MACRO(kbo)<a name='17239'>
      DM_BCAST_MACRO(selfrefo)<a name='17240'>
      DM_BCAST_MACRO(forrefo)<a name='17241'>
<a name='17242'>
     RETURN<a name='17243'>
9010 CONTINUE<a name='17244'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17245'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1059">(errmess)<a name='17246'>
<a name='17247'>
      end subroutine lw_kgb04<a name='17248'>
<a name='17249'>
<font color=#447700>! **************************************************************************<a name='17250'></font>
<A NAME='LW_KGB05'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17251'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb05</font>(rrtmg_unit) <A href='../../call_to/LW_KGB05.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB05.html' TARGET='index'>6</A><a name='17252'>
<font color=#447700>! **************************************************************************<a name='17253'></font>
<a name='17254'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG05_F'>rrlw_kg05_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mo3, &amp;<a name='17255'>
                            selfrefo, forrefo, ccl4o<a name='17256'>
<a name='17257'>
      implicit none<a name='17258'>
      save<a name='17259'>
<a name='17260'>
<font color=#447700>! Input<a name='17261'></font>
      integer, intent(in) :: rrtmg_unit<a name='17262'>
<a name='17263'>
<font color=#447700>! Local                                    <a name='17264'></font>
      character*80 errmess<a name='17265'>
      logical, external  :: wrf_dm_on_monitor<a name='17266'>
<a name='17267'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17268'></font>
<font color=#447700>!     and upper atmosphere.<a name='17269'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17270'></font>
<font color=#447700>!     Lower: P = 473.42 mb, T = 259.83<a name='17271'></font>
<font color=#447700>!     Upper: P = 0.2369280 mbar, T = 253.60 K<a name='17272'></font>
<a name='17273'>
<font color=#447700>!     The arrays kao_mo3 and ccl4o contain the coefficients for<a name='17274'></font>
<font color=#447700>!     ozone and ccl4 in the lower atmosphere.<a name='17275'></font>
<font color=#447700>!     Minor gas mapping level:<a name='17276'></font>
<font color=#447700>!     Lower - o3: P = 317.34 mbar, T = 240.77 k<a name='17277'></font>
<font color=#447700>!     Lower - ccl4:<a name='17278'></font>
<a name='17279'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17280'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17281'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17282'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17283'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17284'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17285'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17286'></font>
<font color=#447700>!     to that of gas2.<a name='17287'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17288'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17289'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17290'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17291'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17292'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17293'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17294'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17295'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17296'></font>
<a name='17297'>
<font color=#447700>!     The array KBO contains absorption coefs for each of the 16 g-intervals<a name='17298'></font>
<font color=#447700>!     for a range of pressure levels  &lt; ~100mb, temperatures, and ratios<a name='17299'></font>
<font color=#447700>!     of H2O to CO2.  The first index in the array, JS, runs<a name='17300'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17301'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17302'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17303'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17304'></font>
<font color=#447700>!     to that of gas2.  The second index, JT, which<a name='17305'></font>
<font color=#447700>!     runs from 1 to 5, corresponds to different temperatures.  More <a name='17306'></font>
<font color=#447700>!     specifically, JT = 3 means that the data are for the corresponding <a name='17307'></font>
<font color=#447700>!     reference temperature TREF for this  pressure level, JT = 2 refers <a name='17308'></font>
<font color=#447700>!     to the TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and<a name='17309'></font>
<font color=#447700>!     JT = 5 is for TREF+30.  The third index, JP, runs from 13 to 59 and<a name='17310'></font>
<font color=#447700>!     refers to the corresponding pressure level in PREF (e.g. JP = 13 is<a name='17311'></font>
<font color=#447700>!     for a pressure of 95.5835 mb).  The fourth index, IG, goes from 1 to<a name='17312'></font>
<font color=#447700>!     16, and tells us which g-interval the absorption coefficients are for.<a name='17313'></font>
<a name='17314'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17315'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17316'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='17317'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17318'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17319'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17320'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17321'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='17322'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17323'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='17324'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17325'></font>
<a name='17326'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17327'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17328'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17329'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17330'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17331'></font>
<a name='17332'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17333'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17334'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17335'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17336'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17337'></font>
<a name='17338'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_340"> ( A , size ( A ) * RWORDSIZE )<a name='17339'>
<a name='17340'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17341'>
         fracrefao, fracrefbo, kao, kbo, kao_mo3, ccl4o, selfrefo, forrefo<a name='17342'>
      DM_BCAST_MACRO(fracrefao)<a name='17343'>
      DM_BCAST_MACRO(fracrefbo)<a name='17344'>
      DM_BCAST_MACRO(kao)<a name='17345'>
      DM_BCAST_MACRO(kbo)<a name='17346'>
      DM_BCAST_MACRO(kao_mo3)<a name='17347'>
      DM_BCAST_MACRO(ccl4o)<a name='17348'>
      DM_BCAST_MACRO(selfrefo)<a name='17349'>
      DM_BCAST_MACRO(forrefo)<a name='17350'>
<a name='17351'>
     RETURN<a name='17352'>
9010 CONTINUE<a name='17353'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17354'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1060">(errmess)<a name='17355'>
<a name='17356'>
      end subroutine lw_kgb05<a name='17357'>
<a name='17358'>
<font color=#447700>! **************************************************************************<a name='17359'></font>
<A NAME='LW_KGB06'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17360'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb06</font>(rrtmg_unit) <A href='../../call_to/LW_KGB06.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB06.html' TARGET='index'>6</A><a name='17361'>
<font color=#447700>! **************************************************************************<a name='17362'></font>
<a name='17363'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG06_F'>rrlw_kg06_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_F_4">, only : fracrefao, kao, kao_mco2, selfrefo, forrefo, &amp;<a name='17364'>
                            cfc11adjo, cfc12o<a name='17365'>
<a name='17366'>
      implicit none<a name='17367'>
      save<a name='17368'>
<a name='17369'>
<font color=#447700>! Input<a name='17370'></font>
      integer, intent(in) :: rrtmg_unit<a name='17371'>
<a name='17372'>
<font color=#447700>! Local                                    <a name='17373'></font>
      character*80 errmess<a name='17374'>
      logical, external  :: wrf_dm_on_monitor<a name='17375'>
<a name='17376'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17377'></font>
<font color=#447700>!     and upper atmosphere.<a name='17378'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17379'></font>
<font color=#447700>!     Lower: : P = 473.4280 mb, T = 259.83 K<a name='17380'></font>
<a name='17381'>
<font color=#447700>!     The arrays kao_mco2, cfc11adjo and cfc12o contain the coefficients for<a name='17382'></font>
<font color=#447700>!     carbon dioxide in the lower atmosphere and cfc11 and cfc12 in the upper<a name='17383'></font>
<font color=#447700>!     atmosphere.<a name='17384'></font>
<font color=#447700>!     Original cfc11 is multiplied by 1.385 to account for the 1060-1107 cm-1 band.<a name='17385'></font>
<font color=#447700>!     Minor gas mapping level:<a name='17386'></font>
<font color=#447700>!     Lower - co2: P = 706.2720 mb, T = 294.2 k<a name='17387'></font>
<font color=#447700>!     Upper - cfc11, cfc12<a name='17388'></font>
<a name='17389'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='17390'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='17391'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17392'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17393'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='17394'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='17395'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='17396'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='17397'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='17398'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='17399'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='17400'></font>
<a name='17401'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17402'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17403'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='17404'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17405'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17406'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17407'></font>
<a name='17408'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17409'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17410'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17411'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17412'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17413'></font>
<a name='17414'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17415'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17416'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17417'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17418'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17419'></font>
<a name='17420'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_341"> ( A , size ( A ) * RWORDSIZE )<a name='17421'>
<a name='17422'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17423'>
         fracrefao, kao, kao_mco2, cfc11adjo, cfc12o, selfrefo, forrefo<a name='17424'>
      DM_BCAST_MACRO(fracrefao)<a name='17425'>
      DM_BCAST_MACRO(kao)<a name='17426'>
      DM_BCAST_MACRO(kao_mco2)<a name='17427'>
      DM_BCAST_MACRO(cfc11adjo)<a name='17428'>
      DM_BCAST_MACRO(cfc12o)<a name='17429'>
      DM_BCAST_MACRO(selfrefo)<a name='17430'>
      DM_BCAST_MACRO(forrefo)<a name='17431'>
<a name='17432'>
     RETURN<a name='17433'>
9010 CONTINUE<a name='17434'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17435'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1061">(errmess)<a name='17436'>
<a name='17437'>
      end subroutine lw_kgb06<a name='17438'>
<a name='17439'>
<font color=#447700>! **************************************************************************<a name='17440'></font>
<A NAME='LW_KGB07'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17441'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb07</font>(rrtmg_unit) <A href='../../call_to/LW_KGB07.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB07.html' TARGET='index'>6</A><a name='17442'>
<font color=#447700>! **************************************************************************<a name='17443'></font>
<a name='17444'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG07_F'>rrlw_kg07_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mco2, &amp;<a name='17445'>
                            kbo_mco2, selfrefo, forrefo<a name='17446'>
<a name='17447'>
      implicit none<a name='17448'>
      save<a name='17449'>
<a name='17450'>
<font color=#447700>! Input<a name='17451'></font>
      integer, intent(in) :: rrtmg_unit<a name='17452'>
<a name='17453'>
<font color=#447700>! Local                                    <a name='17454'></font>
      character*80 errmess<a name='17455'>
      logical, external  :: wrf_dm_on_monitor<a name='17456'>
<a name='17457'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17458'></font>
<font color=#447700>!     and upper atmosphere.<a name='17459'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17460'></font>
<font color=#447700>!     Lower : P = 706.27 mb, T = 278.94 K<a name='17461'></font>
<font color=#447700>!     Upper : P = 95.58 mbar, T= 215.70 K<a name='17462'></font>
<a name='17463'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17464'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17465'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17466'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17467'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17468'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17469'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17470'></font>
<font color=#447700>!     to that of gas2.<a name='17471'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17472'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17473'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17474'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17475'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17476'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17477'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17478'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17479'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17480'></font>
<a name='17481'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17482'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17483'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17484'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17485'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17486'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17487'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17488'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17489'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17490'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17491'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17492'></font>
<a name='17493'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17494'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17495'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='17496'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17497'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17498'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17499'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17500'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='17501'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17502'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='17503'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17504'></font>
<a name='17505'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='17506'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17507'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='17508'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17509'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17510'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17511'></font>
<a name='17512'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17513'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17514'></font>
<font color=#447700>!     index refers to reference temperature (296_rb,260_rb,224,260) and <a name='17515'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17516'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17517'></font>
<a name='17518'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17519'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17520'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17521'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17522'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17523'></font>
<a name='17524'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_342"> ( A , size ( A ) * RWORDSIZE )<a name='17525'>
<a name='17526'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17527'>
         fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, selfrefo, forrefo<a name='17528'>
      DM_BCAST_MACRO(fracrefao)<a name='17529'>
      DM_BCAST_MACRO(fracrefbo)<a name='17530'>
      DM_BCAST_MACRO(kao)<a name='17531'>
      DM_BCAST_MACRO(kbo)<a name='17532'>
      DM_BCAST_MACRO(kao_mco2)<a name='17533'>
      DM_BCAST_MACRO(kbo_mco2)<a name='17534'>
      DM_BCAST_MACRO(selfrefo)<a name='17535'>
      DM_BCAST_MACRO(forrefo)<a name='17536'>
<a name='17537'>
     RETURN<a name='17538'>
9010 CONTINUE<a name='17539'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17540'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1062">(errmess)<a name='17541'>
<a name='17542'>
      end subroutine lw_kgb07<a name='17543'>
<a name='17544'>
<font color=#447700>! **************************************************************************<a name='17545'></font>
<A NAME='LW_KGB08'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17546'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb08</font>(rrtmg_unit) <A href='../../call_to/LW_KGB08.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB08.html' TARGET='index'>6</A><a name='17547'>
<font color=#447700>! **************************************************************************<a name='17548'></font>
<a name='17549'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG08_F'>rrlw_kg08_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_F_4">, only : fracrefao, fracrefbo, kao, kao_mco2, kao_mn2o, &amp;<a name='17550'>
                            kao_mo3, kbo, kbo_mco2, kbo_mn2o, selfrefo, forrefo, &amp;<a name='17551'>
                            cfc12o, cfc22adjo<a name='17552'>
<a name='17553'>
      implicit none<a name='17554'>
      save<a name='17555'>
<a name='17556'>
<font color=#447700>! Input<a name='17557'></font>
      integer, intent(in) :: rrtmg_unit<a name='17558'>
<a name='17559'>
<font color=#447700>! Local                                    <a name='17560'></font>
      character*80 errmess<a name='17561'>
      logical, external  :: wrf_dm_on_monitor<a name='17562'>
<a name='17563'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17564'></font>
<font color=#447700>!     and upper atmosphere.<a name='17565'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17566'></font>
<font color=#447700>!     Lower: P=473.4280 mb, T = 259.83 K<a name='17567'></font>
<font color=#447700>!     Upper: P=95.5835 mb, T= 215.7 K<a name='17568'></font>
<a name='17569'>
<font color=#447700>!     The arrays kao_mco2, kbo_mco2, kao_mn2o, kbo_mn2o contain the coefficients for<a name='17570'></font>
<font color=#447700>!     carbon dioxide and n2o in the lower and upper atmosphere.<a name='17571'></font>
<font color=#447700>!     The array kao_mo3 contains the coefficients for ozone in the lower atmosphere,<a name='17572'></font>
<font color=#447700>!     and arrays cfc12o and cfc12adjo contain the coefficients for cfc12 and cfc22.<a name='17573'></font>
<font color=#447700>!     Original cfc22 is multiplied by 1.485 to account for the 780-850 cm-1 <a name='17574'></font>
<font color=#447700>!     and 1290-1335 cm-1 bands.<a name='17575'></font>
<font color=#447700>!     Minor gas mapping level:<a name='17576'></font>
<font color=#447700>!     Lower - co2: P = 1053.63 mb, T = 294.2 k<a name='17577'></font>
<font color=#447700>!     Lower - o3: P = 317.348 mb, T = 240.77 k<a name='17578'></font>
<font color=#447700>!     Lower - n2o: P = 706.2720 mb, T= 278.94 k<a name='17579'></font>
<font color=#447700>!     Lower - cfc12, cfc22<a name='17580'></font>
<font color=#447700>!     Upper - co2: P = 35.1632 mb, T = 223.28 k<a name='17581'></font>
<font color=#447700>!     Upper - n2o: P = 8.716e-2 mb, T = 226.03 k<a name='17582'></font>
<a name='17583'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='17584'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='17585'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17586'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17587'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='17588'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='17589'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='17590'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='17591'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='17592'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='17593'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='17594'></font>
<a name='17595'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17596'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17597'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17598'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17599'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17600'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17601'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17602'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17603'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17604'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17605'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17606'></font>
<a name='17607'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17608'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17609'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='17610'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17611'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17612'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17613'></font>
<a name='17614'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='17615'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17616'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='17617'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17618'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17619'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17620'></font>
<a name='17621'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17622'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17623'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17624'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17625'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17626'></font>
<a name='17627'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17628'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17629'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17630'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17631'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17632'></font>
<a name='17633'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_343"> ( A , size ( A ) * RWORDSIZE )<a name='17634'>
<a name='17635'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17636'>
         fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, kao_mn2o, &amp;<a name='17637'>
         kbo_mn2o, kao_mo3, cfc12o, cfc22adjo, selfrefo, forrefo<a name='17638'>
      DM_BCAST_MACRO(fracrefao)<a name='17639'>
      DM_BCAST_MACRO(fracrefbo)<a name='17640'>
      DM_BCAST_MACRO(kao)<a name='17641'>
      DM_BCAST_MACRO(kbo)<a name='17642'>
      DM_BCAST_MACRO(kao_mco2)<a name='17643'>
      DM_BCAST_MACRO(kbo_mco2)<a name='17644'>
      DM_BCAST_MACRO(kao_mn2o)<a name='17645'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='17646'>
      DM_BCAST_MACRO(kao_mo3)<a name='17647'>
      DM_BCAST_MACRO(cfc12o)<a name='17648'>
      DM_BCAST_MACRO(cfc22adjo)<a name='17649'>
      DM_BCAST_MACRO(selfrefo)<a name='17650'>
      DM_BCAST_MACRO(forrefo)<a name='17651'>
<a name='17652'>
     RETURN<a name='17653'>
9010 CONTINUE<a name='17654'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17655'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1063">(errmess)<a name='17656'>
<a name='17657'>
      end subroutine lw_kgb08<a name='17658'>
<a name='17659'>
<font color=#447700>! **************************************************************************<a name='17660'></font>
<A NAME='LW_KGB09'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17661'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb09</font>(rrtmg_unit) <A href='../../call_to/LW_KGB09.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB09.html' TARGET='index'>6</A><a name='17662'>
<font color=#447700>! **************************************************************************<a name='17663'></font>
<a name='17664'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG09_F'>rrlw_kg09_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2o, &amp;<a name='17665'>
                            kbo_mn2o, selfrefo, forrefo<a name='17666'>
<a name='17667'>
      implicit none<a name='17668'>
      save<a name='17669'>
<a name='17670'>
<font color=#447700>! Input<a name='17671'></font>
      integer, intent(in) :: rrtmg_unit<a name='17672'>
<a name='17673'>
<font color=#447700>! Local                                    <a name='17674'></font>
      character*80 errmess<a name='17675'>
      logical, external  :: wrf_dm_on_monitor<a name='17676'>
<a name='17677'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17678'></font>
<font color=#447700>!     and upper atmosphere.<a name='17679'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17680'></font>
<font color=#447700>!     Lower: P=212.7250 mb, T = 223.06 K<a name='17681'></font>
<font color=#447700>!     Upper: P=3.20e-2 mb, T = 197.92 k<a name='17682'></font>
<a name='17683'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17684'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17685'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17686'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17687'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17688'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17689'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17690'></font>
<font color=#447700>!     to that of gas2.<a name='17691'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17692'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17693'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17694'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17695'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17696'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17697'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17698'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17699'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17700'></font>
<a name='17701'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17702'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17703'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17704'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17705'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17706'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17707'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17708'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17709'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17710'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17711'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17712'></font>
<a name='17713'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17714'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17715'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='17716'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17717'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17718'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17719'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17720'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='17721'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17722'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='17723'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17724'></font>
<a name='17725'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='17726'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17727'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='17728'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17729'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17730'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17731'></font>
<a name='17732'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17733'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17734'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17735'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17736'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17737'></font>
<a name='17738'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17739'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17740'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17741'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17742'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17743'></font>
<a name='17744'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_344"> ( A , size ( A ) * RWORDSIZE )<a name='17745'>
<a name='17746'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17747'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, selfrefo, forrefo<a name='17748'>
      DM_BCAST_MACRO(fracrefao)<a name='17749'>
      DM_BCAST_MACRO(fracrefbo)<a name='17750'>
      DM_BCAST_MACRO(kao)<a name='17751'>
      DM_BCAST_MACRO(kbo)<a name='17752'>
      DM_BCAST_MACRO(kao_mn2o)<a name='17753'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='17754'>
      DM_BCAST_MACRO(selfrefo)<a name='17755'>
      DM_BCAST_MACRO(forrefo)<a name='17756'>
<a name='17757'>
     RETURN<a name='17758'>
9010 CONTINUE<a name='17759'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17760'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1064">(errmess)<a name='17761'>
<a name='17762'>
      end subroutine lw_kgb09<a name='17763'>
<a name='17764'>
<font color=#447700>! **************************************************************************<a name='17765'></font>
<A NAME='LW_KGB10'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17766'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb10</font>(rrtmg_unit) <A href='../../call_to/LW_KGB10.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB10.html' TARGET='index'>6</A><a name='17767'>
<font color=#447700>! **************************************************************************<a name='17768'></font>
<a name='17769'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG10_F'>rrlw_kg10_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_F_4">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='17770'>
<a name='17771'>
      implicit none<a name='17772'>
      save<a name='17773'>
<a name='17774'>
<font color=#447700>! Input<a name='17775'></font>
      integer, intent(in) :: rrtmg_unit<a name='17776'>
<a name='17777'>
<font color=#447700>! Local                                    <a name='17778'></font>
      character*80 errmess<a name='17779'>
      logical, external  :: wrf_dm_on_monitor<a name='17780'>
<a name='17781'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17782'></font>
<font color=#447700>!     and upper atmosphere.<a name='17783'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17784'></font>
<font color=#447700>!     Lower: P = 212.7250 mb, T = 223.06 K<a name='17785'></font>
<font color=#447700>!     Upper: P = 95.58350 mb, T = 215.70 K<a name='17786'></font>
<a name='17787'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='17788'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='17789'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17790'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17791'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='17792'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='17793'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='17794'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='17795'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='17796'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='17797'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='17798'></font>
<a name='17799'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17800'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17801'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17802'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17803'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17804'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17805'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17806'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17807'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17808'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17809'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17810'></font>
<a name='17811'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17812'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17813'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17814'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17815'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17816'></font>
<a name='17817'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17818'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17819'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17820'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17821'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17822'></font>
<a name='17823'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_345"> ( A , size ( A ) * RWORDSIZE )<a name='17824'>
<a name='17825'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17826'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='17827'>
      DM_BCAST_MACRO(fracrefao)<a name='17828'>
      DM_BCAST_MACRO(fracrefbo)<a name='17829'>
      DM_BCAST_MACRO(kao)<a name='17830'>
      DM_BCAST_MACRO(kbo)<a name='17831'>
      DM_BCAST_MACRO(selfrefo)<a name='17832'>
      DM_BCAST_MACRO(forrefo)<a name='17833'>
<a name='17834'>
     RETURN<a name='17835'>
9010 CONTINUE<a name='17836'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17837'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1065">(errmess)<a name='17838'>
<a name='17839'>
      end subroutine lw_kgb10<a name='17840'>
<a name='17841'>
<font color=#447700>! **************************************************************************<a name='17842'></font>
<A NAME='LW_KGB11'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17843'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb11</font>(rrtmg_unit) <A href='../../call_to/LW_KGB11.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB11.html' TARGET='index'>6</A><a name='17844'>
<font color=#447700>! **************************************************************************<a name='17845'></font>
<a name='17846'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG11_F'>rrlw_kg11_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_F_4">, only : fracrefao, fracrefbo, kao, kbo, kao_mo2, &amp;<a name='17847'>
                            kbo_mo2, selfrefo, forrefo<a name='17848'>
<a name='17849'>
      implicit none<a name='17850'>
      save<a name='17851'>
<a name='17852'>
<font color=#447700>! Input<a name='17853'></font>
      integer, intent(in) :: rrtmg_unit<a name='17854'>
<a name='17855'>
<font color=#447700>! Local                                    <a name='17856'></font>
      character*80 errmess<a name='17857'>
      logical, external  :: wrf_dm_on_monitor<a name='17858'>
<a name='17859'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17860'></font>
<font color=#447700>!     and upper atmosphere.<a name='17861'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17862'></font>
<font color=#447700>!     Lower: P=1053.63 mb, T= 294.2 K<a name='17863'></font>
<font color=#447700>!     Upper: P=0.353 mb, T = 262.11 K<a name='17864'></font>
<a name='17865'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='17866'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='17867'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17868'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17869'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='17870'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='17871'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='17872'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='17873'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='17874'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='17875'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='17876'></font>
<a name='17877'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='17878'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='17879'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='17880'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='17881'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='17882'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='17883'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='17884'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='17885'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='17886'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='17887'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17888'></font>
<a name='17889'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='17890'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17891'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='17892'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17893'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17894'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17895'></font>
<a name='17896'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='17897'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='17898'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='17899'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='17900'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='17901'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17902'></font>
<a name='17903'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17904'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17905'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17906'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17907'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17908'></font>
<a name='17909'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17910'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17911'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17912'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17913'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17914'></font>
<a name='17915'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_346"> ( A , size ( A ) * RWORDSIZE )<a name='17916'>
<a name='17917'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17918'>
         fracrefao, fracrefbo, kao, kbo, kao_mo2, kbo_mo2, selfrefo, forrefo<a name='17919'>
      DM_BCAST_MACRO(fracrefao)<a name='17920'>
      DM_BCAST_MACRO(fracrefbo)<a name='17921'>
      DM_BCAST_MACRO(kao)<a name='17922'>
      DM_BCAST_MACRO(kbo)<a name='17923'>
      DM_BCAST_MACRO(kao_mo2)<a name='17924'>
      DM_BCAST_MACRO(kbo_mo2)<a name='17925'>
      DM_BCAST_MACRO(selfrefo)<a name='17926'>
      DM_BCAST_MACRO(forrefo)<a name='17927'>
<a name='17928'>
     RETURN<a name='17929'>
9010 CONTINUE<a name='17930'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17931'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1066">(errmess)<a name='17932'>
<a name='17933'>
      end subroutine lw_kgb11<a name='17934'>
<a name='17935'>
<font color=#447700>! **************************************************************************<a name='17936'></font>
<A NAME='LW_KGB12'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17937'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb12</font>(rrtmg_unit) <A href='../../call_to/LW_KGB12.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB12.html' TARGET='index'>6</A><a name='17938'>
<font color=#447700>! **************************************************************************<a name='17939'></font>
<a name='17940'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG12_F'>rrlw_kg12_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_F_4">, only : fracrefao, kao, selfrefo, forrefo<a name='17941'>
<a name='17942'>
      implicit none<a name='17943'>
      save<a name='17944'>
<a name='17945'>
<font color=#447700>! Input<a name='17946'></font>
      integer, intent(in) :: rrtmg_unit<a name='17947'>
<a name='17948'>
<font color=#447700>! Local                                    <a name='17949'></font>
      character*80 errmess<a name='17950'>
      logical, external  :: wrf_dm_on_monitor<a name='17951'>
<a name='17952'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='17953'></font>
<font color=#447700>!     and upper atmosphere.<a name='17954'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='17955'></font>
<font color=#447700>!     Lower: P = 174.1640 mbar, T= 215.78 K<a name='17956'></font>
<a name='17957'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='17958'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='17959'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='17960'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='17961'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='17962'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='17963'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='17964'></font>
<font color=#447700>!     to that of gas2.<a name='17965'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='17966'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='17967'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='17968'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='17969'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='17970'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='17971'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='17972'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='17973'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='17974'></font>
<a name='17975'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='17976'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='17977'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='17978'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='17979'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='17980'></font>
<a name='17981'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='17982'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='17983'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='17984'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='17985'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='17986'></font>
<a name='17987'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_347"> ( A , size ( A ) * RWORDSIZE )<a name='17988'>
<a name='17989'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='17990'>
         fracrefao, kao, selfrefo, forrefo<a name='17991'>
      DM_BCAST_MACRO(fracrefao)<a name='17992'>
      DM_BCAST_MACRO(kao)<a name='17993'>
      DM_BCAST_MACRO(selfrefo)<a name='17994'>
      DM_BCAST_MACRO(forrefo)<a name='17995'>
<a name='17996'>
     RETURN<a name='17997'>
9010 CONTINUE<a name='17998'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='17999'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1067">(errmess)<a name='18000'>
<a name='18001'>
      end subroutine lw_kgb12<a name='18002'>
<a name='18003'>
<font color=#447700>! **************************************************************************<a name='18004'></font>
<A NAME='LW_KGB13'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18005'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb13</font>(rrtmg_unit) <A href='../../call_to/LW_KGB13.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB13.html' TARGET='index'>6</A><a name='18006'>
<font color=#447700>! **************************************************************************<a name='18007'></font>
<a name='18008'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG13_F'>rrlw_kg13_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_F_4">, only : fracrefao, fracrefbo, kao, kao_mco2, kao_mco, &amp;<a name='18009'>
                            kbo_mo3, selfrefo, forrefo<a name='18010'>
<a name='18011'>
      implicit none<a name='18012'>
      save<a name='18013'>
<a name='18014'>
<font color=#447700>! Input<a name='18015'></font>
      integer, intent(in) :: rrtmg_unit<a name='18016'>
<a name='18017'>
<font color=#447700>! Local                                    <a name='18018'></font>
      character*80 errmess<a name='18019'>
      logical, external  :: wrf_dm_on_monitor<a name='18020'>
<a name='18021'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='18022'></font>
<font color=#447700>!     and upper atmosphere.<a name='18023'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='18024'></font>
<font color=#447700>!     Lower: P=473.4280 mb, T = 259.83 K      <a name='18025'></font>
<font color=#447700>!     Upper: P=4.758820 mb, T = 250.85 K<a name='18026'></font>
<a name='18027'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='18028'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='18029'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='18030'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18031'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18032'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18033'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18034'></font>
<font color=#447700>!     to that of gas2.<a name='18035'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='18036'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='18037'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='18038'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='18039'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='18040'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='18041'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='18042'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='18043'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18044'></font>
<a name='18045'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='18046'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='18047'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='18048'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18049'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18050'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18051'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18052'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='18053'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='18054'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='18055'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18056'></font>
<a name='18057'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='18058'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='18059'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='18060'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='18061'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='18062'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18063'></font>
<a name='18064'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='18065'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='18066'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='18067'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='18068'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18069'></font>
<a name='18070'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='18071'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='18072'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='18073'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='18074'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='18075'></font>
<a name='18076'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_348"> ( A , size ( A ) * RWORDSIZE )<a name='18077'>
<a name='18078'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='18079'>
         fracrefao, fracrefbo, kao, kao_mco2, kao_mco, kbo_mo3, selfrefo, forrefo<a name='18080'>
      DM_BCAST_MACRO(fracrefao)<a name='18081'>
      DM_BCAST_MACRO(fracrefbo)<a name='18082'>
      DM_BCAST_MACRO(kao)<a name='18083'>
      DM_BCAST_MACRO(kao_mco2)<a name='18084'>
      DM_BCAST_MACRO(kao_mco)<a name='18085'>
      DM_BCAST_MACRO(kbo_mo3)<a name='18086'>
      DM_BCAST_MACRO(selfrefo)<a name='18087'>
      DM_BCAST_MACRO(forrefo)<a name='18088'>
<a name='18089'>
     RETURN<a name='18090'>
9010 CONTINUE<a name='18091'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='18092'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1068">(errmess)<a name='18093'>
<a name='18094'>
      end subroutine lw_kgb13<a name='18095'>
<a name='18096'>
<font color=#447700>! **************************************************************************<a name='18097'></font>
<A NAME='LW_KGB14'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18098'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb14</font>(rrtmg_unit) <A href='../../call_to/LW_KGB14.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB14.html' TARGET='index'>6</A><a name='18099'>
<font color=#447700>! **************************************************************************<a name='18100'></font>
<a name='18101'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG14_F'>rrlw_kg14_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_F_4">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='18102'>
<a name='18103'>
      implicit none<a name='18104'>
      save<a name='18105'>
<a name='18106'>
<font color=#447700>! Input<a name='18107'></font>
      integer, intent(in) :: rrtmg_unit<a name='18108'>
<a name='18109'>
<font color=#447700>! Local                                    <a name='18110'></font>
      character*80 errmess<a name='18111'>
      logical, external  :: wrf_dm_on_monitor<a name='18112'>
<a name='18113'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='18114'></font>
<font color=#447700>!     and upper atmosphere.<a name='18115'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='18116'></font>
<font color=#447700>!     Lower: P = 142.5940 mb, T = 215.70 K<a name='18117'></font>
<font color=#447700>!     Upper: P = 4.758820 mb, T = 250.85 K<a name='18118'></font>
<a name='18119'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='18120'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='18121'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='18122'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18123'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18124'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18125'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18126'></font>
<font color=#447700>!     to that of gas2.<a name='18127'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='18128'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='18129'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='18130'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='18131'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='18132'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='18133'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='18134'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='18135'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18136'></font>
<a name='18137'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='18138'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='18139'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='18140'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='18141'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='18142'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='18143'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='18144'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='18145'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='18146'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='18147'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18148'></font>
<a name='18149'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='18150'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='18151'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='18152'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='18153'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18154'></font>
<a name='18155'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='18156'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='18157'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='18158'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='18159'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='18160'></font>
<a name='18161'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_349"> ( A , size ( A ) * RWORDSIZE )<a name='18162'>
<a name='18163'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='18164'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='18165'>
      DM_BCAST_MACRO(fracrefao)<a name='18166'>
      DM_BCAST_MACRO(fracrefbo)<a name='18167'>
      DM_BCAST_MACRO(kao)<a name='18168'>
      DM_BCAST_MACRO(kbo)<a name='18169'>
      DM_BCAST_MACRO(selfrefo)<a name='18170'>
      DM_BCAST_MACRO(forrefo)<a name='18171'>
<a name='18172'>
     RETURN<a name='18173'>
9010 CONTINUE<a name='18174'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='18175'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1069">(errmess)<a name='18176'>
<a name='18177'>
      end subroutine lw_kgb14<a name='18178'>
<a name='18179'>
<font color=#447700>! **************************************************************************<a name='18180'></font>
<A NAME='LW_KGB15'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18181'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb15</font>(rrtmg_unit) <A href='../../call_to/LW_KGB15.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB15.html' TARGET='index'>6</A><a name='18182'>
<font color=#447700>! **************************************************************************<a name='18183'></font>
<a name='18184'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG15_F'>rrlw_kg15_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_F_4">, only : fracrefao, kao, kao_mn2, selfrefo, forrefo<a name='18185'>
<a name='18186'>
      implicit none<a name='18187'>
      save<a name='18188'>
<a name='18189'>
<font color=#447700>! Input<a name='18190'></font>
      integer, intent(in) :: rrtmg_unit<a name='18191'>
<a name='18192'>
<font color=#447700>! Local                                    <a name='18193'></font>
      character*80 errmess<a name='18194'>
      logical, external  :: wrf_dm_on_monitor<a name='18195'>
<a name='18196'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='18197'></font>
<font color=#447700>!     and upper atmosphere.<a name='18198'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='18199'></font>
<font color=#447700>!     Lower: P = 1053. mb, T = 294.2 K<a name='18200'></font>
<a name='18201'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='18202'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='18203'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='18204'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18205'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18206'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18207'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18208'></font>
<font color=#447700>!     to that of gas2.<a name='18209'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='18210'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='18211'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='18212'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='18213'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='18214'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='18215'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='18216'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='18217'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18218'></font>
<a name='18219'>
<font color=#447700>!     The array KA_Mxx contains the absorption coefficient for <a name='18220'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='18221'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='18222'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18223'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18224'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18225'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18226'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='18227'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='18228'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='18229'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18230'></font>
<a name='18231'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='18232'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='18233'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='18234'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='18235'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18236'></font>
<a name='18237'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='18238'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='18239'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='18240'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='18241'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='18242'></font>
<a name='18243'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_350"> ( A , size ( A ) * RWORDSIZE )<a name='18244'>
<a name='18245'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='18246'>
         fracrefao, kao, kao_mn2, selfrefo, forrefo<a name='18247'>
      DM_BCAST_MACRO(fracrefao)<a name='18248'>
      DM_BCAST_MACRO(kao)<a name='18249'>
      DM_BCAST_MACRO(kao_mn2)<a name='18250'>
      DM_BCAST_MACRO(selfrefo)<a name='18251'>
      DM_BCAST_MACRO(forrefo)<a name='18252'>
<a name='18253'>
     RETURN<a name='18254'>
9010 CONTINUE<a name='18255'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='18256'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1070">(errmess)<a name='18257'>
<a name='18258'>
      end subroutine lw_kgb15<a name='18259'>
<a name='18260'>
<font color=#447700>! **************************************************************************<a name='18261'></font>
<A NAME='LW_KGB16'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18262'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb16</font>(rrtmg_unit) <A href='../../call_to/LW_KGB16.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB16.html' TARGET='index'>6</A><a name='18263'>
<font color=#447700>! **************************************************************************<a name='18264'></font>
<a name='18265'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRLW_KG16_F'>rrlw_kg16_f</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_F_4">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='18266'>
<a name='18267'>
      implicit none<a name='18268'>
      save<a name='18269'>
<a name='18270'>
<font color=#447700>! Input<a name='18271'></font>
      integer, intent(in) :: rrtmg_unit<a name='18272'>
<a name='18273'>
<font color=#447700>! Local                                    <a name='18274'></font>
      character*80 errmess<a name='18275'>
      logical, external  :: wrf_dm_on_monitor<a name='18276'>
<a name='18277'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='18278'></font>
<font color=#447700>!     and upper atmosphere.<a name='18279'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='18280'></font>
<font color=#447700>!     Lower: P = 387.6100 mbar, T = 250.17 K<a name='18281'></font>
<font color=#447700>!     Upper: P=95.58350 mb, T = 215.70 K<a name='18282'></font>
<a name='18283'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='18284'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='18285'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='18286'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='18287'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='18288'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='18289'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='18290'></font>
<font color=#447700>!     to that of gas2.<a name='18291'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='18292'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='18293'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='18294'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='18295'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='18296'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='18297'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='18298'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='18299'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18300'></font>
<a name='18301'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='18302'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='18303'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='18304'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='18305'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='18306'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='18307'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='18308'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='18309'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='18310'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='18311'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='18312'></font>
<a name='18313'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='18314'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='18315'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='18316'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='18317'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='18318'></font>
<a name='18319'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='18320'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='18321'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='18322'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='18323'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='18324'></font>
<a name='18325'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_351"> ( A , size ( A ) * RWORDSIZE )<a name='18326'>
<a name='18327'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='18328'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='18329'>
      DM_BCAST_MACRO(fracrefao)<a name='18330'>
      DM_BCAST_MACRO(fracrefbo)<a name='18331'>
      DM_BCAST_MACRO(kao)<a name='18332'>
      DM_BCAST_MACRO(kbo)<a name='18333'>
      DM_BCAST_MACRO(selfrefo)<a name='18334'>
      DM_BCAST_MACRO(forrefo)<a name='18335'>
<a name='18336'>
     RETURN<a name='18337'>
9010 CONTINUE<a name='18338'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lwf: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='18339'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1071">(errmess)<a name='18340'>
<a name='18341'>
      end subroutine lw_kgb16<a name='18342'>
<a name='18343'>
<font color=#447700>!===============================================================================<a name='18344'></font>
<A NAME='RELCALC'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RELCALC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18345'>
  <font color=#993300>subroutine </font><font color=#cc0000>relcalc</font>(icol, pcols, pver, t, landfrac, landm, icefrac, rel, snowh) <A href='../../call_to/RELCALC.html' TARGET='index'>8</A><a name='18346'>
<font color=#447700>!----------------------------------------------------------------------- <a name='18347'></font>
<font color=#447700>! <a name='18348'></font>
<font color=#447700>! Purpose: <a name='18349'></font>
<font color=#447700>! Compute cloud water size<a name='18350'></font>
<font color=#447700>! <a name='18351'></font>
<font color=#447700>! Method: <a name='18352'></font>
<font color=#447700>! analytic formula following the formulation originally developed by J. T. Kiehl<a name='18353'></font>
<font color=#447700>! <a name='18354'></font>
<font color=#447700>! Author: Phil Rasch<a name='18355'></font>
<font color=#447700>! <a name='18356'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='18357'></font>
    implicit none<a name='18358'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='18359'></font>
<font color=#447700>!<a name='18360'></font>
<font color=#447700>! Input arguments<a name='18361'></font>
<font color=#447700>!<a name='18362'></font>
    integer, intent(in) :: icol<a name='18363'>
    integer, intent(in) :: pcols, pver<a name='18364'>
    real, intent(in) :: landfrac(pcols)      <font color=#447700>! Land fraction<a name='18365'></font>
    real, intent(in) :: icefrac(pcols)       <font color=#447700>! Ice fraction<a name='18366'></font>
    real, intent(in) :: snowh(pcols)         <font color=#447700>! Snow depth over land, water equivalent (m)<a name='18367'></font>
    real, intent(in) :: landm(pcols)         <font color=#447700>! Land fraction ramping to zero over ocean<a name='18368'></font>
    real, intent(in) :: t(pcols,pver)        <font color=#447700>! Temperature<a name='18369'></font>
<a name='18370'>
<font color=#447700>!<a name='18371'></font>
<font color=#447700>! Output arguments<a name='18372'></font>
<font color=#447700>!<a name='18373'></font>
    real, intent(out) :: rel(pcols,pver)      <font color=#447700>! Liquid effective drop size (microns)<a name='18374'></font>
<font color=#447700>!<a name='18375'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='18376'></font>
<font color=#447700>!<a name='18377'></font>
    integer i,k           <font color=#447700>! Lon, lev indices<a name='18378'></font>
    real tmelt            <font color=#447700>! freezing temperature of fresh water (K)<a name='18379'></font>
    real rliqland         <font color=#447700>! liquid drop size if over land<a name='18380'></font>
    real rliqocean        <font color=#447700>! liquid drop size if over ocean<a name='18381'></font>
    real rliqice          <font color=#447700>! liquid drop size if over sea ice<a name='18382'></font>
<font color=#447700>!<a name='18383'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='18384'></font>
<font color=#447700>!<a name='18385'></font>
    tmelt = 273.16<a name='18386'>
    rliqocean = 14.0<a name='18387'>
    rliqice   = 14.0<a name='18388'>
    rliqland  = 8.0<a name='18389'>
    do k=1,pver<a name='18390'>
<font color=#447700>!       do i=1,ncol<a name='18391'></font>
<font color=#447700>! jrm Reworked effective radius algorithm<a name='18392'></font>
          <font color=#447700>! Start with temperature-dependent value appropriate for continental air<a name='18393'></font>
          <font color=#447700>! Note: findmcnew has a pressure dependence here<a name='18394'></font>
          rel(icol,k) = rliqland + (rliqocean-rliqland) * min(1.0,max(0.0,(tmelt-t(icol,k))*0.05))<a name='18395'>
          <font color=#447700>! Modify for snow depth over land<a name='18396'></font>
          rel(icol,k) = rel(icol,k) + (rliqocean-rel(icol,k)) * min(1.0,max(0.0,snowh(icol)*10.))<a name='18397'>
          <font color=#447700>! Ramp between polluted value over land to clean value over ocean.<a name='18398'></font>
          rel(icol,k) = rel(icol,k) + (rliqocean-rel(icol,k)) * min(1.0,max(0.0,1.0-landm(icol)))<a name='18399'>
          <font color=#447700>! Ramp between the resultant value and a sea ice value in the presence of ice.<a name='18400'></font>
          rel(icol,k) = rel(icol,k) + (rliqice-rel(icol,k)) * min(1.0,max(0.0,icefrac(icol)))<a name='18401'>
<font color=#447700>! end jrm<a name='18402'></font>
<font color=#447700>!       end do<a name='18403'></font>
    end do<a name='18404'>
  end subroutine relcalc<a name='18405'>
<font color=#447700>!===============================================================================<a name='18406'></font>
<A NAME='REICALC'><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REICALC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='18407'>
  <font color=#993300>subroutine </font><font color=#cc0000>reicalc</font>(icol, pcols, pver, t, re) <A href='../../call_to/REICALC.html' TARGET='index'>4</A><a name='18408'>
    <font color=#447700>!<a name='18409'></font>
<a name='18410'>
    integer, intent(in) :: icol, pcols, pver<a name='18411'>
    real, intent(out) :: re(pcols,pver)<a name='18412'>
    real, intent(in) :: t(pcols,pver)<a name='18413'>
    real corr<a name='18414'>
    integer i<a name='18415'>
    integer k<a name='18416'>
    integer index<a name='18417'>
    <font color=#447700>!<a name='18418'></font>
    <font color=#447700>!       Tabulated values of re(T) in the temperature interval<a name='18419'></font>
    <font color=#447700>!       180 K -- 274 K; hexagonal columns assumed:<a name='18420'></font>
    <font color=#447700>!<a name='18421'></font>
    <font color=#447700>!<a name='18422'></font>
    do k=1,pver<a name='18423'>
<font color=#447700>!       do i=1,ncol<a name='18424'></font>
          index = int(t(icol,k)-179.)<a name='18425'>
          index = min(max(index,1),94)<a name='18426'>
          corr = t(icol,k) - int(t(icol,k))<a name='18427'>
          re(icol,k) = retab(index)*(1.-corr)           &amp;<a name='18428'>
               +retab(index+1)*corr<a name='18429'>
          <font color=#447700>!           re(icol,k) = amax1(amin1(re(icol,k),30.),10.)<a name='18430'></font>
<font color=#447700>!       end do<a name='18431'></font>
    end do<a name='18432'>
    <font color=#447700>!<a name='18433'></font>
    return<a name='18434'>
  end subroutine reicalc<a name='18435'>
<font color=#447700>!------------------------------------------------------------------<a name='18436'></font>
<a name='18437'>
END MODULE module_ra_rrtmg_lwf<a name='18438'>
</pre></body></html>