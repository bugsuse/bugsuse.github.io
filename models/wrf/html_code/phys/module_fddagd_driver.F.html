<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:PHYSICS<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<a name='4'>
<A NAME='MODULE_FDDAGD_DRIVER'><A href='../../html_code/phys/module_fddagd_driver.F.html#MODULE_FDDAGD_DRIVER' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='5'>
<font color=#993300>MODULE </font><font color=#cc0000>module_fddagd_driver</font> <A href='../../call_to/MODULE_FDDAGD_DRIVER.html' TARGET='index'>1</A><a name='6'>
CONTAINS<a name='7'>
<a name='8'>
<font color=#447700>!------------------------------------------------------------------<a name='9'></font>
<A NAME='FDDAGD_DRIVER'><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='10'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>fddagd_driver</font>(itimestep,dt,xtime,                   &amp; <A href='../../call_to/FDDAGD_DRIVER.html' TARGET='index'>1</A>,<A href='../../call_from/FDDAGD_DRIVER.html' TARGET='index'>37</A><a name='11'>
                  id,  &amp;<a name='12'>
                  RUNDGDTEN,RVNDGDTEN,RTHNDGDTEN,                 &amp;<a name='13'>
                  RPHNDGDTEN,RQVNDGDTEN,RMUNDGDTEN,               &amp;<a name='14'>
                  SDA_HFX, SDA_QFX,                               &amp; <font color=#447700>!fasdas<a name='15'></font>
                  HFX_FDDA,                                       &amp; <font color=#447700>!fasdas<a name='16'></font>
                  u_ndg_old,v_ndg_old,t_ndg_old,ph_ndg_old,       &amp;<a name='17'>
                  q_ndg_old,mu_ndg_old,       &amp;<a name='18'>
                  u_ndg_new,v_ndg_new,t_ndg_new,ph_ndg_new,       &amp;<a name='19'>
                  q_ndg_new,mu_ndg_new,       &amp;<a name='20'>
                  u3d,v3d,th_phy,ph,rho,moist,                    &amp;<a name='21'>
                  p_phy,pi_phy,p8w,t_phy,dz8w,z,z_at_w,           &amp;<a name='22'>
                  grid,config_flags,DX,n_moist,                   &amp;<a name='23'>
                  STEPFG,                                         &amp;<a name='24'>
                  pblh,ht,regime,znt,                             &amp;<a name='25'>
                  ids,ide, jds,jde, kds,kde,                      &amp;<a name='26'>
                  ims,ime, jms,jme, kms,kme,                      &amp;<a name='27'>
                  i_start,i_end, j_start,j_end, kts,kte, num_tiles, &amp;<a name='28'>
                  u10, v10, th2, q2, &amp;<a name='29'>
                  u10_ndg_old, v10_ndg_old, t2_ndg_old, th2_ndg_old, q2_ndg_old,  &amp;<a name='30'>
                  rh_ndg_old, psl_ndg_old, ps_ndg_old, tob_ndg_old, odis_ndg_old, &amp;<a name='31'>
                  u10_ndg_new, v10_ndg_new, t2_ndg_new, th2_ndg_new, q2_ndg_new,  &amp;<a name='32'>
                  rh_ndg_new, psl_ndg_new, ps_ndg_new, tob_ndg_new, odis_ndg_new, &amp;<a name='33'>
                  ips,ipe,jps,jpe,kps,kpe,                          &amp;<a name='34'>
                  imsx,imex,jmsx,jmex,kmsx,kmex,                    &amp;<a name='35'>
                  ipsx,ipex,jpsx,jpex,kpsx,kpex,                    &amp;<a name='36'>
                  imsy,imey,jmsy,jmey,kmsy,kmey,                    &amp;<a name='37'>
                  ipsy,ipey,jpsy,jpey,kpsy,kpey                     )<a name='38'>
<font color=#447700>!------------------------------------------------------------------<a name='39'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_148"><a name='40'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_121"><a name='41'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_62"><a name='42'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_228">, ONLY : domain<a name='43'>
<a name='44'>
<font color=#447700>! *** add new modules of schemes here<a name='45'></font>
<a name='46'>
   USE <A href='../../html_code/phys/module_fdda_psufddagd.F.html#MODULE_FDDA_PSUFDDAGD'>module_fdda_psufddagd</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FDDA_PSUFDDAGD_1"><a name='47'>
   USE <A href='../../html_code/phys/module_fdda_spnudging.F.html#MODULE_FDDA_SPNUDGING'>module_fdda_spnudging</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FDDA_SPNUDGING_1"><a name='48'>
<a name='49'>
<font color=#447700>!------------------------------------------------------------------<a name='50'></font>
   IMPLICIT NONE<a name='51'>
<font color=#447700>!======================================================================<a name='52'></font>
<font color=#447700>! Grid structure in physics part of WRF<a name='53'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='54'></font>
<font color=#447700>! The horizontal velocities used in the physics are unstaggered<a name='55'></font>
<font color=#447700>! relative to temperature/moisture variables. All predicted<a name='56'></font>
<font color=#447700>! variables are carried at half levels except w, which is at full<a name='57'></font>
<font color=#447700>! levels. Some arrays with names (*8w) are at w (full) levels.<a name='58'></font>
<font color=#447700>!<a name='59'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='60'></font>
<font color=#447700>! In WRF, kms (smallest number) is the bottom level and kme (largest<a name='61'></font>
<font color=#447700>! number) is the top level.  In your scheme, if 1 is at the top level,<a name='62'></font>
<font color=#447700>! then you have to reverse the order in the k direction.<a name='63'></font>
<font color=#447700>!<a name='64'></font>
<font color=#447700>!         kme      -   half level (no data at this level)<a name='65'></font>
<font color=#447700>!         kme    ----- full level<a name='66'></font>
<font color=#447700>!         kme-1    -   half level<a name='67'></font>
<font color=#447700>!         kme-1  ----- full level<a name='68'></font>
<font color=#447700>!         .<a name='69'></font>
<font color=#447700>!         .<a name='70'></font>
<font color=#447700>!         .<a name='71'></font>
<font color=#447700>!         kms+2    -   half level<a name='72'></font>
<font color=#447700>!         kms+2  ----- full level<a name='73'></font>
<font color=#447700>!         kms+1    -   half level<a name='74'></font>
<font color=#447700>!         kms+1  ----- full level<a name='75'></font>
<font color=#447700>!         kms      -   half level<a name='76'></font>
<font color=#447700>!         kms    ----- full level<a name='77'></font>
<font color=#447700>!<a name='78'></font>
<font color=#447700>!======================================================================<a name='79'></font>
<font color=#447700>!-- RUNDGDTEN       U tendency due to <a name='80'></font>
<font color=#447700>!                 FDDA analysis nudging (m/s^2)<a name='81'></font>
<font color=#447700>!-- RVNDGDTEN       V tendency due to <a name='82'></font>
<font color=#447700>!                 FDDA analysis nudging (m/s^2)<a name='83'></font>
<font color=#447700>!-- RTHNDGDTEN      Theta tendency due to <a name='84'></font>
<font color=#447700>!                 FDDA analysis nudging (K/s)<a name='85'></font>
<font color=#447700>!-- RPHNDGDTEN      Geopotential tendency due to<a name='86'></font>
<font color=#447700>!                 FDDA analysis nudging (m^2/s^3)<a name='87'></font>
<font color=#447700>!-- RQVNDGDTEN      Qv tendency due to <a name='88'></font>
<font color=#447700>!                 FDDA analysis nudging (kg/kg/s)<a name='89'></font>
<font color=#447700>!-- RMUNDGDTEN      mu tendency due to <a name='90'></font>
<font color=#447700>!                 FDDA analysis nudging (Pa/s)<a name='91'></font>
<font color=#447700>!-- itimestep     number of time steps<a name='92'></font>
<font color=#447700>!-- u3d           u-velocity staggered on u points (m/s)<a name='93'></font>
<font color=#447700>!-- v3d           v-velocity staggered on v points (m/s)<a name='94'></font>
<font color=#447700>!-- th_phy        potential temperature (K)<a name='95'></font>
<font color=#447700>!-- moist         moisture array (4D - last index is species) (kg/kg)<a name='96'></font>
<font color=#447700>!-- p_phy         pressure (Pa)<a name='97'></font>
<font color=#447700>!-- pi_phy        exner function (dimensionless)<a name='98'></font>
<font color=#447700>!-- p8w           pressure at full levels (Pa)<a name='99'></font>
<font color=#447700>!-- t_phy         temperature (K)<a name='100'></font>
<font color=#447700>!-- dz8w          dz between full levels (m)<a name='101'></font>
<font color=#447700>!-- z             height above sea level (m)<a name='102'></font>
<font color=#447700>!-- config_flags<a name='103'></font>
<font color=#447700>!-- DX            horizontal space interval (m)<a name='104'></font>
<font color=#447700>!-- DT            time step (second)<a name='105'></font>
<font color=#447700>!-- n_moist       number of moisture species<a name='106'></font>
<font color=#447700>!-- STEPFG        number of timesteps per FDDA re-calculation<a name='107'></font>
<font color=#447700>!-- KPBL          k-index of PBL top<a name='108'></font>
<font color=#447700>!-- ids           start index for i in domain<a name='109'></font>
<font color=#447700>!-- ide           end index for i in domain<a name='110'></font>
<font color=#447700>!-- jds           start index for j in domain<a name='111'></font>
<font color=#447700>!-- jde           end index for j in domain<a name='112'></font>
<font color=#447700>!-- kds           start index for k in domain<a name='113'></font>
<font color=#447700>!-- kde           end index for k in domain<a name='114'></font>
<font color=#447700>!-- ims           start index for i in memory<a name='115'></font>
<font color=#447700>!-- ime           end index for i in memory<a name='116'></font>
<font color=#447700>!-- jms           start index for j in memory<a name='117'></font>
<font color=#447700>!-- jme           end index for j in memory<a name='118'></font>
<font color=#447700>!-- kms           start index for k in memory<a name='119'></font>
<font color=#447700>!-- kme           end index for k in memory<a name='120'></font>
<font color=#447700>!-- jts           start index for j in tile<a name='121'></font>
<font color=#447700>!-- jte           end index for j in tile<a name='122'></font>
<font color=#447700>!-- kts           start index for k in tile<a name='123'></font>
<font color=#447700>!-- kte           end index for k in tile<a name='124'></font>
<font color=#447700>!<a name='125'></font>
<font color=#447700>!******************************************************************<a name='126'></font>
<font color=#447700>!------------------------------------------------------------------ <a name='127'></font>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='128'>
   TYPE(domain) , TARGET          :: grid<a name='129'>
<font color=#447700>!<a name='130'></font>
<a name='131'>
   INTEGER , INTENT(IN)         ::     id<a name='132'>
<a name='133'>
   INTEGER,    INTENT(IN   )    ::     ids,ide, jds,jde, kds,kde, &amp;<a name='134'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='135'>
                                       kts,kte, num_tiles,        &amp;<a name='136'>
                                       ips,ipe,jps,jpe,kps,kpe,   &amp;<a name='137'>
                                       imsx,imex,jmsx,jmex,kmsx,kmex,   &amp;<a name='138'>
                                       ipsx,ipex,jpsx,jpex,kpsx,kpex,   &amp;<a name='139'>
                                       imsy,imey,jmsy,jmey,kmsy,kmey,   &amp;<a name='140'>
                                       ipsy,ipey,jpsy,jpey,kpsy,kpey,   &amp;<a name='141'>
                                       n_moist           <a name='142'>
<a name='143'>
   INTEGER, DIMENSION(num_tiles), INTENT(IN) ::                   &amp;<a name='144'>
  &amp;                                    i_start,i_end,j_start,j_end<a name='145'>
<a name='146'>
   INTEGER,    INTENT(IN   )    ::     itimestep,STEPFG<a name='147'>
<font color=#447700>!<a name='148'></font>
   REAL,       INTENT(IN   )    ::     DT,DX,XTIME<a name='149'>
<a name='150'>
<a name='151'>
<font color=#447700>!<a name='152'></font>
   REAL,       DIMENSION( ims:ime, kms:kme, jms:jme ),            &amp;<a name='153'>
               INTENT(IN   )    ::                         p_phy, &amp;<a name='154'>
                                                          pi_phy, &amp;<a name='155'>
                                                             p8w, &amp;<a name='156'>
                                                             rho, &amp;<a name='157'>
                                                           t_phy, &amp;<a name='158'>
                                                             u3d, &amp;<a name='159'>
                                                             v3d, &amp;<a name='160'>
                                                              ph, &amp;<a name='161'>
                                                            dz8w, &amp;<a name='162'>
                                                               z, &amp;<a name='163'>
                                                          z_at_w, &amp;<a name='164'>
                                                          th_phy<a name='165'>
<font color=#447700>!<a name='166'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme, n_moist ),         &amp;<a name='167'>
         INTENT(IN ) ::                                    moist<a name='168'>
<font color=#447700>!<a name='169'></font>
<font color=#447700>!<a name='170'></font>
<font color=#447700>!<a name='171'></font>
   REAL,       DIMENSION( ims:ime, kms:kme, jms:jme ),            &amp;<a name='172'>
               INTENT(INOUT)    ::                       RUNDGDTEN, &amp;<a name='173'>
                                                         RVNDGDTEN, &amp;<a name='174'>
                                                        RTHNDGDTEN, &amp;<a name='175'>
                                                        RPHNDGDTEN, &amp;<a name='176'>
                                                        RQVNDGDTEN<a name='177'>
<font color=#447700>!<a name='178'></font>
<font color=#447700>! FASDAS<a name='179'></font>
<font color=#447700>!<a name='180'></font>
   REAL,       DIMENSION( ims:ime, jms:jme ),            &amp;<a name='181'>
               INTENT(INOUT)    ::                       SDA_HFX, &amp;<a name='182'>
                                                         SDA_QFX<a name='183'>
   REAL,       DIMENSION( ims:ime, kms:kme, jms:jme ),            &amp;<a name='184'>
               INTENT(INOUT)    ::                       HFX_FDDA<a name='185'>
<font color=#447700>!<a name='186'></font>
<font color=#447700>! END FASDAS<a name='187'></font>
<font color=#447700>!<a name='188'></font>
   REAL,       DIMENSION( ims:ime,  jms:jme ),            &amp;<a name='189'>
               INTENT(INOUT)    ::                      RMUNDGDTEN<a name='190'>
<a name='191'>
   REAL,       DIMENSION( ims:ime, kms:kme, jms:jme ),            &amp;<a name='192'>
               INTENT(INOUT)    ::                       u_ndg_old, &amp;<a name='193'>
                                                         v_ndg_old, &amp;<a name='194'>
                                                         t_ndg_old, &amp;<a name='195'>
                                                         ph_ndg_old,&amp;<a name='196'>
                                                         q_ndg_old, &amp;<a name='197'>
                                                         u_ndg_new, &amp;<a name='198'>
                                                         v_ndg_new, &amp;<a name='199'>
                                                         t_ndg_new, &amp;<a name='200'>
                                                         ph_ndg_new,&amp;<a name='201'>
                                                         q_ndg_new<a name='202'>
   REAL,       DIMENSION( ims:ime,  jms:jme ),            &amp;<a name='203'>
               INTENT(INOUT)    ::                       mu_ndg_old, &amp;<a name='204'>
                                                         mu_ndg_new<a name='205'>
<a name='206'>
<font color=#447700>!<a name='207'></font>
   REAL,    DIMENSION( ims:ime , jms:jme ),     &amp;<a name='208'>
               INTENT(IN   ) ::           pblh, &amp;<a name='209'>
                                            ht, &amp;<a name='210'>
                                           znt<a name='211'>
<a name='212'>
   REAL,    DIMENSION( ims:ime , jms:jme ), INTENT(INOUT   ) :: regime<a name='213'>
<a name='214'>
   REAL,       DIMENSION( ims:ime, jms:jme ),            &amp;<a name='215'>
               INTENT(IN   )    ::                       u10, &amp;<a name='216'>
                                                         v10, &amp;<a name='217'>
                                                         th2, &amp;<a name='218'>
                                                         q2<a name='219'>
<a name='220'>
   REAL,       DIMENSION( ims:ime, jms:jme ),            &amp;<a name='221'>
               INTENT(IN)       ::                       u10_ndg_old,  &amp;<a name='222'>
                                                         v10_ndg_old,  &amp;<a name='223'>
                                                         t2_ndg_old,   &amp;<a name='224'>
                                                         th2_ndg_old,  &amp;<a name='225'>
                                                         q2_ndg_old,   &amp;<a name='226'>
                                                         rh_ndg_old,   &amp;<a name='227'>
                                                         psl_ndg_old,  &amp;<a name='228'>
                                                         ps_ndg_old,   &amp;<a name='229'>
                                                         odis_ndg_old,  &amp;<a name='230'>
                                                         u10_ndg_new,  &amp;<a name='231'>
                                                         v10_ndg_new,  &amp;<a name='232'>
                                                         t2_ndg_new,   &amp;<a name='233'>
                                                         th2_ndg_new,  &amp;<a name='234'>
                                                         q2_ndg_new,   &amp;<a name='235'>
                                                         rh_ndg_new,   &amp;<a name='236'>
                                                         psl_ndg_new,  &amp;<a name='237'>
                                                         ps_ndg_new,   &amp;<a name='238'>
                                                         odis_ndg_new<a name='239'>
<a name='240'>
   REAL,       DIMENSION( ims:ime, jms:jme ),            &amp;<a name='241'>
               INTENT(IN)       ::                       tob_ndg_old,  &amp;<a name='242'>
                                                         tob_ndg_new<a name='243'>
<a name='244'>
<font color=#447700>!  LOCAL  VAR<a name='245'></font>
<a name='246'>
<font color=#447700>!<a name='247'></font>
   INTEGER :: i,J,K,NK,jj,ij<a name='248'>
   CHARACTER (LEN=256) :: message<a name='249'>
<a name='250'>
<font color=#447700>!------------------------------------------------------------------<a name='251'></font>
<font color=#447700>!<a name='252'></font>
#if  <font color=#447700>! ( NMM_CORE == 1 )<a name='253'></font>
  if (config_flags%grid_fdda .eq. 0 .AND. config_flags%grid_sfdda .eq. 0) return<a name='254'>
<a name='255'>
  IF (itimestep == 1) THEN<a name='256'>
<a name='257'>
   IF( config_flags%grid_fdda .eq. 1 ) THEN<a name='258'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='259'></font>
   <font color=#447700>!$OMP PRIVATE ( ij,i,j,k )<a name='260'></font>
   DO ij = 1 , num_tiles<a name='261'>
      DO j=j_start(ij),j_end(ij)<a name='262'>
      DO i=i_start(ij),i_end(ij)<a name='263'>
<a name='264'>
         DO k=kts,kte <font color=#447700>!min(kte+1,kde) !BSINGH(PNNL)- Undefined behavior at k=kte+1<a name='265'></font>
            u_ndg_old(i,k,j) = u3d(i,k,j)<a name='266'>
            v_ndg_old(i,k,j) = v3d(i,k,j)<a name='267'>
            t_ndg_old(i,k,j) = th_phy(i,k,j) - 300.0<a name='268'>
            ph_ndg_old(i,k,j) = ph(i,k,j)<a name='269'>
            q_ndg_old(i,k,j) = moist(i,k,j,P_QV)<a name='270'>
         ENDDO<a name='271'>
         mu_ndg_old(i,j) = 0.0<a name='272'>
<a name='273'>
      ENDDO<a name='274'>
      ENDDO<a name='275'>
<a name='276'>
   ENDDO<a name='277'>
<a name='278'>
<font color=#447700>!  IF( config_flags%grid_sfdda .eq. 1 ) THEN<a name='279'></font>
<font color=#447700>!    DO ij = 1 , num_tiles<a name='280'></font>
<font color=#447700>!       DO j=j_start(ij),j_end(ij)<a name='281'></font>
<font color=#447700>!       DO i=i_start(ij),i_end(ij)<a name='282'></font>
<font color=#447700>!             u10_ndg_old(i,j) = u10(i,j)<a name='283'></font>
<font color=#447700>!             v10_ndg_old(i,j) = v10(i,j)<a name='284'></font>
<font color=#447700>!             th2_ndg_old(i,j) = th2(i,j) - 300.0<a name='285'></font>
<font color=#447700>!              q2_ndg_old(i,j) = q2(i,j)<a name='286'></font>
<font color=#447700>!       ENDDO<a name='287'></font>
<font color=#447700>!       ENDDO<a name='288'></font>
<a name='289'>
<font color=#447700>!    ENDDO<a name='290'></font>
<font color=#447700>!  ENDIF<a name='291'></font>
   <font color=#447700>!$OMP END PARALLEL DO<a name='292'></font>
<a name='293'>
   ENDIF<a name='294'>
  ENDIF<a name='295'>
<a name='296'>
<font color=#447700>!GMM if fgdtzero = 1, tendencies are zero in between calls<a name='297'></font>
<a name='298'>
  IF (mod(itimestep-1,STEPFG) .eq. 0 .and. config_flags%fgdtzero .eq. 1) THEN<a name='299'>
<a name='300'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='301'></font>
   <font color=#447700>!$OMP PRIVATE ( ij,i,j,k )<a name='302'></font>
   DO ij = 1 , num_tiles<a name='303'>
      DO j=j_start(ij),j_end(ij)<a name='304'>
      DO i=i_start(ij),i_end(ij)<a name='305'>
<a name='306'>
         DO k=kts,min(kte+1,kde)<a name='307'>
            RTHNDGDTEN(I,K,J)=0.<a name='308'>
            RUNDGDTEN(I,K,J)=0.<a name='309'>
            RVNDGDTEN(I,K,J)=0.<a name='310'>
            RPHNDGDTEN(I,K,J)=0.<a name='311'>
            RQVNDGDTEN(I,K,J)=0.<a name='312'>
         ENDDO<a name='313'>
<a name='314'>
         RMUNDGDTEN(I,J)=0.<a name='315'>
<a name='316'>
      ENDDO<a name='317'>
      ENDDO<a name='318'>
<a name='319'>
   ENDDO<a name='320'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='321'></font>
<a name='322'>
   ENDIF<a name='323'>
<a name='324'>
  IF (itimestep .eq. 1 .or. mod(itimestep,STEPFG) .eq. 0) THEN<a name='325'>
<a name='326'>
   <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='327'></font>
   <font color=#447700>!$OMP PRIVATE ( ij,i,j,k )<a name='328'></font>
   DO ij = 1 , num_tiles<a name='329'>
      DO j=j_start(ij),j_end(ij)<a name='330'>
      DO i=i_start(ij),i_end(ij)<a name='331'>
<a name='332'>
         DO k=kts,min(kte+1,kde)<a name='333'>
            RTHNDGDTEN(I,K,J)=0.<a name='334'>
            RUNDGDTEN(I,K,J)=0.<a name='335'>
            RVNDGDTEN(I,K,J)=0.<a name='336'>
            RPHNDGDTEN(I,K,J)=0.<a name='337'>
            RQVNDGDTEN(I,K,J)=0.<a name='338'>
         ENDDO<a name='339'>
<a name='340'>
         RMUNDGDTEN(I,J)=0.<a name='341'>
<a name='342'>
      ENDDO<a name='343'>
      ENDDO<a name='344'>
<a name='345'>
   ENDDO<a name='346'>
   <font color=#447700>!$OMP END PARALLEL DO<a name='347'></font>
<a name='348'>
<font color=#447700>!<a name='349'></font>
   IF( config_flags%grid_fdda /= 0 ) THEN<a name='350'>
   fdda_select: SELECT CASE(config_flags%grid_fdda)<a name='351'>
<a name='352'>
      CASE (PSUFDDAGD)<a name='353'>
<a name='354'>
      <font color=#447700>!BPR BEGIN<a name='355'></font>
      <font color=#447700>!Add error checks to ensure that user does not use analysis nudging<a name='356'></font>
      <font color=#447700>!options that WRF will read in but not fully utilize<a name='357'></font>
      <font color=#447700>!3D Analysis nudging<a name='358'></font>
<a name='359'>
      <font color=#447700>!The begin time of analysis nudging must be the model start time<a name='360'></font>
      <font color=#447700>!It appears the WRF code that reads analysis nudging files respects <a name='361'></font>
      <font color=#447700>!the start time settings, but the actual nudging code does not.  This<a name='362'></font>
      <font color=#447700>!leads one to nudge towards 0 in all fields (including potential<a name='363'></font>
      <font color=#447700>!temperature [K]) since the nudging code applies analysis nudging but has<a name='364'></font>
      <font color=#447700>!no data to nudge towards<a name='365'></font>
      IF( config_flags%gfdda_begin_y /= 0 ) THEN<a name='366'>
       WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='367'>
        'start time and so analysis nudging start time cannot be specified via gfdda_begin_y'<a name='368'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_651"> ( wrf_err_message )<a name='369'>
      ENDIF<a name='370'>
      IF( config_flags%gfdda_begin_d /= 0 ) THEN<a name='371'>
       WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='372'>
        'start time and so analysis nudging start time cannot be specified via gfdda_begin_d'<a name='373'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_652"> ( wrf_err_message )<a name='374'>
      ENDIF<a name='375'>
      IF( config_flags%gfdda_begin_h /= 0 ) THEN<a name='376'>
       WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='377'>
        'start time and so analysis nudging start time cannot be specified via gfdda_begin_h'<a name='378'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_653"> ( wrf_err_message )<a name='379'>
      ENDIF<a name='380'>
      IF( config_flags%gfdda_begin_m /= 0 ) THEN<a name='381'>
       WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='382'>
        'start time and so analysis nudging start time cannot be specified via gfdda_begin_m'<a name='383'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_654"> ( wrf_err_message )<a name='384'>
      ENDIF<a name='385'>
      IF( config_flags%gfdda_begin_s /= 0 ) THEN<a name='386'>
       WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='387'>
        'start time and so analysis nudging start time cannot be specified via gfdda_begin_s'<a name='388'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_655"> ( wrf_err_message )<a name='389'>
      ENDIF<a name='390'>
       <a name='391'>
<a name='392'>
      <font color=#447700>!The end time of analysis nudging relative to the model start must be<a name='393'></font>
      <font color=#447700>!specified in hours<a name='394'></font>
      IF( config_flags%gfdda_end_y /= 0 ) THEN<a name='395'>
       WRITE( wrf_err_message , * ) 'The option gfdda_end_y is ignored, use gfdda_end_h instead'<a name='396'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_656"> ( wrf_err_message )<a name='397'>
      ENDIF<a name='398'>
      IF( config_flags%gfdda_end_d /= 0 ) THEN<a name='399'>
       WRITE( wrf_err_message , * ) 'The option gfdda_end_d is ignored, use gfdda_end_h instead'<a name='400'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_657"> ( wrf_err_message )<a name='401'>
      ENDIF<a name='402'>
      IF( config_flags%gfdda_end_m /= 0 ) THEN<a name='403'>
       WRITE( wrf_err_message , * ) 'The option gfdda_end_m is ignored, use gfdda_end_h instead'<a name='404'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_658"> ( wrf_err_message )<a name='405'>
      ENDIF<a name='406'>
      IF( config_flags%gfdda_end_s /= 0 ) THEN<a name='407'>
       WRITE( wrf_err_message , * ) 'The option gfdda_end_s is ignored, use gfdda_end_h instead'<a name='408'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_659"> ( wrf_err_message )<a name='409'>
      ENDIF<a name='410'>
<a name='411'>
      <font color=#447700>!The interval between analyses must be specified in minutes<a name='412'></font>
      IF( config_flags%gfdda_interval_y /= 0 ) THEN<a name='413'>
       WRITE( wrf_err_message , * ) 'The option gfdda_interval_y is ignored, use gfdda_interval_m instead'<a name='414'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_660"> ( wrf_err_message )<a name='415'>
      ENDIF<a name='416'>
      IF( config_flags%gfdda_interval_d /= 0 ) THEN<a name='417'>
       WRITE( wrf_err_message , * ) 'The option gfdda_interval_d is ignored, use gfdda_interval_m instead'<a name='418'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_661"> ( wrf_err_message )<a name='419'>
      ENDIF<a name='420'>
      IF( config_flags%gfdda_interval_h /= 0 ) THEN<a name='421'>
       WRITE( wrf_err_message , * ) 'The option gfdda_interval_h is ignored, use gfdda_interval_m instead'<a name='422'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_662"> ( wrf_err_message )<a name='423'>
      ENDIF<a name='424'>
      IF( config_flags%gfdda_interval_s /= 0 ) THEN<a name='425'>
       WRITE( wrf_err_message , * ) 'The option gfdda_interval_s is ignored, use gfdda_interval_m instead'<a name='426'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_663"> ( wrf_err_message )<a name='427'>
      ENDIF<a name='428'>
<a name='429'>
      <font color=#447700>!If surface analysis nudging chosen check analogous surface analysis<a name='430'></font>
      <font color=#447700>!nudging namelist options<a name='431'></font>
      IF( config_flags%grid_sfdda /= 0 ) THEN<a name='432'>
<a name='433'>
       <font color=#447700>!The begin time of analysis nudging must be the model start time<a name='434'></font>
       <font color=#447700>!It appears the WRF code that reads analysis nudging files respects <a name='435'></font>
       <font color=#447700>!the start time settings, but the actual nudging code does not.  This<a name='436'></font>
       <font color=#447700>!leads one to nudge towards 0 in all fields (including potential<a name='437'></font>
       <font color=#447700>!temperature [K]) since the nudging code applies analysis nudging but has<a name='438'></font>
       <font color=#447700>!no data to nudge towards<a name='439'></font>
       IF( config_flags%sgfdda_begin_y /= 0 ) THEN<a name='440'>
        WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='441'>
         'start time and so analysis nudging start time cannot be specified via sgfdda_begin_y'<a name='442'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_664"> ( wrf_err_message )<a name='443'>
       ENDIF<a name='444'>
       IF( config_flags%sgfdda_begin_d /= 0 ) THEN<a name='445'>
        WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='446'>
         'start time and so analysis nudging start time cannot be specified via sgfdda_begin_d'<a name='447'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_665"> ( wrf_err_message )<a name='448'>
       ENDIF<a name='449'>
       IF( config_flags%sgfdda_begin_h /= 0 ) THEN<a name='450'>
        WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='451'>
         'start time and so analysis nudging start time cannot be specified via sgfdda_begin_h'<a name='452'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_666"> ( wrf_err_message )<a name='453'>
       ENDIF<a name='454'>
       IF( config_flags%sgfdda_begin_m /= 0 ) THEN<a name='455'>
        WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='456'>
         'start time and so analysis nudging start time cannot be specified via sgfdda_begin_m'<a name='457'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_667"> ( wrf_err_message )<a name='458'>
       ENDIF<a name='459'>
       IF( config_flags%sgfdda_begin_s /= 0 ) THEN<a name='460'>
        WRITE( wrf_err_message , * ) 'WRF currently assumes analysis nudging starts at the model ',&amp;<a name='461'>
         'start time and so analysis nudging start time cannot be specified via sgfdda_begin_s'<a name='462'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_668"> ( wrf_err_message )<a name='463'>
       ENDIF<a name='464'>
        <a name='465'>
 <a name='466'>
       <font color=#447700>!The end time of analysis nudging relative to the model start must be<a name='467'></font>
       <font color=#447700>!specified in hours<a name='468'></font>
       IF( config_flags%sgfdda_end_y /= 0 ) THEN<a name='469'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_end_y is ignored, use sgfdda_end_h instead'<a name='470'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_669"> ( wrf_err_message )<a name='471'>
       ENDIF<a name='472'>
       IF( config_flags%sgfdda_end_d /= 0 ) THEN<a name='473'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_end_d is ignored, use sgfdda_end_h instead'<a name='474'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_670"> ( wrf_err_message )<a name='475'>
       ENDIF<a name='476'>
       IF( config_flags%sgfdda_end_m /= 0 ) THEN<a name='477'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_end_m is ignored, use sgfdda_end_h instead'<a name='478'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_671"> ( wrf_err_message )<a name='479'>
       ENDIF<a name='480'>
       IF( config_flags%sgfdda_end_s /= 0 ) THEN<a name='481'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_end_s is ignored, use sgfdda_end_h instead'<a name='482'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_672"> ( wrf_err_message )<a name='483'>
       ENDIF<a name='484'>
 <a name='485'>
       <font color=#447700>!The interval between analyses must be specified in minutes<a name='486'></font>
       IF( config_flags%sgfdda_interval_y /= 0 ) THEN<a name='487'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_interval_y is ignored, use sgfdda_interval_m instead'<a name='488'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_673"> ( wrf_err_message )<a name='489'>
       ENDIF<a name='490'>
       IF( config_flags%sgfdda_interval_d /= 0 ) THEN<a name='491'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_interval_d is ignored, use sgfdda_interval_m instead'<a name='492'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_674"> ( wrf_err_message )<a name='493'>
       ENDIF<a name='494'>
       IF( config_flags%sgfdda_interval_h /= 0 ) THEN<a name='495'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_interval_h is ignored, use sgfdda_interval_m instead'<a name='496'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_675"> ( wrf_err_message )<a name='497'>
       ENDIF<a name='498'>
       IF( config_flags%sgfdda_interval_s /= 0 ) THEN<a name='499'>
        WRITE( wrf_err_message , * ) 'The option sgfdda_interval_s is ignored, use sgfdda_interval_m instead'<a name='500'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_676"> ( wrf_err_message )<a name='501'>
       ENDIF<a name='502'>
<a name='503'>
      ENDIF <font color=#447700>!IF surface analysis nudging is anabled<a name='504'></font>
      <font color=#447700>!BPR END<a name='505'></font>
<a name='506'>
      <font color=#447700>!$OMP PARALLEL DO   &amp;<a name='507'></font>
      <font color=#447700>!$OMP PRIVATE ( ij, i,j,k )<a name='508'></font>
       DO ij = 1 , num_tiles<a name='509'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_608">(100,'in PSU FDDA scheme')<a name='510'>
<a name='511'>
           IF( config_flags%sf_sfclay_physics /= sfclayscheme &amp;<a name='512'>
         .AND. config_flags%sf_sfclay_physics /= mynnsfcscheme &amp;<a name='513'>
         .AND. config_flags%sf_sfclay_physics /= pxsfcscheme &amp;<a name='514'>
         .AND. config_flags%sf_sfclay_physics /= sfclayrevscheme ) THEN<a name='515'>
             DO j=MAX(j_start(ij)-1,jds),j_end(ij)<a name='516'>
             DO i=MAX(i_start(ij)-1,ids),i_end(ij)<a name='517'>
               IF( pblh(i,j) &gt; z_at_w(i,2,j)-ht(i,j) ) THEN<a name='518'>
                 regime(i,j) = 4.0<a name='519'>
               ELSE<a name='520'>
                 regime(i,j) = 1.0<a name='521'>
               ENDIF<a name='522'>
             ENDDO<a name='523'>
             ENDDO<a name='524'>
           ENDIF<a name='525'>
<a name='526'>
           CALL <A href='../../html_code/phys/module_fdda_psufddagd.F.html#FDDAGD'>FDDAGD</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FDDAGD_1">(itimestep,dx,dt,xtime, &amp;<a name='527'>
               id, &amp;<a name='528'>
               config_flags%auxinput10_interval_m, &amp;<a name='529'>
               config_flags%auxinput10_end_h, &amp;<a name='530'>
               config_flags%if_no_pbl_nudging_uv, &amp;<a name='531'>
               config_flags%if_no_pbl_nudging_t, &amp;<a name='532'>
               config_flags%if_no_pbl_nudging_q, &amp;<a name='533'>
               config_flags%if_zfac_uv, &amp;<a name='534'>
               config_flags%k_zfac_uv, &amp;<a name='535'>
               config_flags%if_zfac_t, &amp;<a name='536'>
               config_flags%k_zfac_t, &amp;<a name='537'>
               config_flags%if_zfac_q, &amp;<a name='538'>
               config_flags%k_zfac_q, &amp;<a name='539'>
               config_flags%guv, &amp;<a name='540'>
               config_flags%gt, config_flags%gq, &amp;<a name='541'>
               config_flags%if_ramping, config_flags%dtramp_min, &amp;<a name='542'>
     config_flags%grid_sfdda, &amp;<a name='543'>
     config_flags%auxinput9_interval_m, &amp;<a name='544'>
     config_flags%auxinput9_end_h, &amp;<a name='545'>
     config_flags%guv_sfc, &amp;<a name='546'>
     config_flags%gt_sfc, config_flags%gq_sfc, config_flags%rinblw, &amp;<a name='547'>
               u3d,v3d,th_phy,t_phy,                 &amp;<a name='548'>
               moist(ims,kms,jms,P_QV),     &amp;<a name='549'>
               p_phy,pi_phy,                &amp;<a name='550'>
               u_ndg_old,v_ndg_old,t_ndg_old,q_ndg_old,mu_ndg_old,       &amp;<a name='551'>
               u_ndg_new,v_ndg_new,t_ndg_new,q_ndg_new,mu_ndg_new,       &amp;<a name='552'>
     u10_ndg_old, v10_ndg_old, t2_ndg_old, th2_ndg_old, q2_ndg_old, &amp;<a name='553'>
     rh_ndg_old, psl_ndg_old, ps_ndg_old, tob_ndg_old, odis_ndg_old,  &amp;<a name='554'>
     u10_ndg_new, v10_ndg_new, t2_ndg_new, th2_ndg_new, q2_ndg_new, &amp;<a name='555'>
     rh_ndg_new, psl_ndg_new, ps_ndg_new, tob_ndg_new, odis_ndg_new,  &amp;<a name='556'>
               RUNDGDTEN,RVNDGDTEN,RTHNDGDTEN,RQVNDGDTEN,RMUNDGDTEN,&amp;<a name='557'>
<font color=#447700>!<a name='558'></font>
<font color=#447700>! FASDAS<a name='559'></font>
<font color=#447700>!<a name='560'></font>
           config_flags%fasdas, SDA_HFX, SDA_QFX,           &amp;<a name='561'>
           HFX_FDDA,dz8w,       &amp;<a name='562'>
<font color=#447700>!<a name='563'></font>
<font color=#447700>! END FASDAS<a name='564'></font>
<font color=#447700>!<a name='565'></font>
               pblh, ht, regime, znt, z, z_at_w,                             &amp;<a name='566'>
               ids,ide, jds,jde, kds,kde,                           &amp;<a name='567'>
               ims,ime, jms,jme, kms,kme,                           &amp;<a name='568'>
               i_start(ij),i_end(ij),j_start(ij),j_end(ij),kts,kte  )<a name='569'>
<a name='570'>
      ENDDO<a name='571'>
     <font color=#447700>!$OMP END PARALLEL DO<a name='572'></font>
<a name='573'>
      CASE (SPNUDGING)<a name='574'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_609">(100,'in SPECTRAL NUDGING scheme')<a name='575'>
           CALL <A href='../../html_code/phys/module_fdda_spnudging.F.html#SPECTRAL_NUDGING'>SPECTRAL_NUDGING</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SPECTRAL_NUDGING_1">(grid,itimestep,dt,xtime, &amp;<a name='576'>
               id, &amp;<a name='577'>
               config_flags%auxinput10_interval_m, &amp;<a name='578'>
               config_flags%auxinput10_end_h, &amp;<a name='579'>
               config_flags%if_no_pbl_nudging_uv, &amp;<a name='580'>
               config_flags%if_no_pbl_nudging_t, &amp;<a name='581'>
               config_flags%if_no_pbl_nudging_ph, &amp;<a name='582'>
               config_flags%if_zfac_uv, &amp;<a name='583'>
               config_flags%k_zfac_uv, &amp;<a name='584'>
               config_flags%dk_zfac_uv,  &amp;<a name='585'>
               config_flags%if_zfac_t, &amp;<a name='586'>
               config_flags%k_zfac_t, &amp;<a name='587'>
               config_flags%dk_zfac_t, &amp;<a name='588'>
               config_flags%if_zfac_ph, &amp;<a name='589'>
               config_flags%k_zfac_ph, &amp;<a name='590'>
               config_flags%dk_zfac_ph,  &amp;<a name='591'>
               config_flags%guv, &amp;<a name='592'>
               config_flags%gt,  &amp;<a name='593'>
               config_flags%gph,  &amp;<a name='594'>
               config_flags%if_ramping, config_flags%dtramp_min, &amp;<a name='595'>
               config_flags%xwavenum, config_flags%ywavenum, &amp;<a name='596'>
               u3d,v3d,th_phy,ph,                 &amp;<a name='597'>
               u_ndg_old,v_ndg_old,t_ndg_old,ph_ndg_old,       &amp;<a name='598'>
               u_ndg_new,v_ndg_new,t_ndg_new,ph_ndg_new,       &amp;<a name='599'>
               RUNDGDTEN,RVNDGDTEN,RTHNDGDTEN,RPHNDGDTEN,&amp;<a name='600'>
               pblh, ht, z, z_at_w,                             &amp;<a name='601'>
               ids,ide, jds,jde, kds,kde,                           &amp;<a name='602'>
               ims,ime, jms,jme, kms,kme,                           &amp;<a name='603'>
               i_start,i_end,j_start,j_end,kts,kte, num_tiles,      &amp;<a name='604'>
               ips,ipe,jps,jpe,kps,kpe,                       &amp;<a name='605'>
               imsx,imex,jmsx,jmex,kmsx,kmex,                       &amp;<a name='606'>
               ipsx,ipex,jpsx,jpex,kpsx,kpex,                       &amp;<a name='607'>
               imsy,imey,jmsy,jmey,kmsy,kmey,                       &amp;<a name='608'>
               ipsy,ipey,jpsy,jpey,kpsy,kpey                        )<a name='609'>
<a name='610'>
<a name='611'>
     CASE DEFAULT<a name='612'>
<a name='613'>
       WRITE( wrf_err_message , * ) 'The fdda option does not exist: grid_fdda = ', config_flags%grid_fdda<a name='614'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_fddagd_driver.F.html#FDDAGD_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_677"> ( wrf_err_message )<a name='615'>
<a name='616'>
   END SELECT fdda_select<a name='617'>
   ENDIF<a name='618'>
<a name='619'>
   ENDIF<a name='620'>
<a name='621'>
#endif<a name='622'>
<font color=#447700>!<a name='623'></font>
   END SUBROUTINE fddagd_driver<a name='624'>
END MODULE module_fddagd_driver<a name='625'>
</pre></body></html>