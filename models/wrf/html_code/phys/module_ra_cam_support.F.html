<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_RA_CAM_SUPPORT'><A href='../../html_code/phys/module_ra_cam_support.F.html#MODULE_RA_CAM_SUPPORT' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>MODULE </font><font color=#cc0000>module_ra_cam_support</font> <A href='../../call_to/MODULE_RA_CAM_SUPPORT.html' TARGET='index'>2</A><a name='3'>
  use <A href='../../html_code/phys/module_cam_support.F.html#MODULE_CAM_SUPPORT'>module_cam_support</A><A href='../../html_code/phys/module_ra_cam_support.F.html#module_ra_cam_support.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CAM_SUPPORT_51">, only: endrun<a name='4'>
  implicit none<a name='5'>
      integer, parameter :: r8 = 8<a name='6'>
      real(r8), parameter:: inf = 1.e20 <font color=#447700>! CAM sets this differently in infnan.F90<a name='7'></font>
      integer, parameter:: bigint = O'17777777777'           <font color=#447700>! largest possible 32-bit integer <a name='8'></font>
<a name='9'>
      integer :: ixcldliq <a name='10'>
      integer :: ixcldice<a name='11'>
<font color=#447700>!     integer :: levsiz    ! size of level dimension on dataset<a name='12'></font>
      integer, parameter :: nbands = 2          <font color=#447700>! Number of spectral bands<a name='13'></font>
      integer, parameter :: naer_all = 12 + 1<a name='14'>
      integer, parameter :: naer = 10 + 1<a name='15'>
      integer, parameter :: bnd_nbr_LW=7 <a name='16'>
      integer, parameter :: ndstsz = 4    <font color=#447700>! number of dust size bins<a name='17'></font>
      integer :: idxSUL<a name='18'>
      integer :: idxSSLT<a name='19'>
      integer :: idxDUSTfirst<a name='20'>
      integer :: idxCARBONfirst<a name='21'>
      integer :: idxOCPHO<a name='22'>
      integer :: idxBCPHO<a name='23'>
      integer :: idxOCPHI<a name='24'>
      integer :: idxBCPHI<a name='25'>
      integer :: idxBG  <a name='26'>
      integer :: idxVOLC<a name='27'>
      real, pointer :: ozmixin_save(:,:,:,:), lat_ozone_save(:), plev_ozone_save(:)<a name='28'>
      integer :: levsiz_ozone_save=-1<a name='29'>
      logical :: have_ozone=.false.<a name='30'>
  integer :: mxaerl                            <font color=#447700>! Maximum level of background aerosol<a name='31'></font>
<a name='32'>
<font color=#447700>! indices to sections of array that represent<a name='33'></font>
<font color=#447700>! groups of aerosols<a name='34'></font>
<a name='35'>
  integer, parameter :: &amp;<a name='36'>
      numDUST         = 4, &amp;<a name='37'>
      numCARBON      = 4<a name='38'>
<a name='39'>
<font color=#447700>! portion of each species group to use in computation<a name='40'></font>
<font color=#447700>! of relative radiative forcing.<a name='41'></font>
<a name='42'>
  real(r8) :: sulscl_rf  = 0._r8 <font color=#447700>!<a name='43'></font>
  real(r8) :: carscl_rf  = 0._r8<a name='44'>
  real(r8) :: ssltscl_rf = 0._r8<a name='45'>
  real(r8) :: dustscl_rf = 0._r8<a name='46'>
  real(r8) :: bgscl_rf   = 0._r8<a name='47'>
  real(r8) :: volcscl_rf = 0._r8<a name='48'>
<a name='49'>
<font color=#447700>! "background" aerosol species mmr.<a name='50'></font>
  real(r8) :: tauback = 0._r8<a name='51'>
<a name='52'>
<font color=#447700>! portion of each species group to use in computation<a name='53'></font>
<font color=#447700>! of aerosol forcing in driving the climate<a name='54'></font>
  real(r8) :: sulscl  = 1._r8<a name='55'>
  real(r8) :: carscl  = 1._r8<a name='56'>
  real(r8) :: ssltscl = 1._r8<a name='57'>
  real(r8) :: dustscl = 1._r8<a name='58'>
  real(r8) :: volcscl = 1._r8<a name='59'>
<a name='60'>
<font color=#447700>!From volcrad.F90 module<a name='61'></font>
     integer, parameter :: idx_LW_0500_0650=3<a name='62'>
     integer, parameter :: idx_LW_0650_0800=4<a name='63'>
     integer, parameter :: idx_LW_0800_1000=5<a name='64'>
     integer, parameter :: idx_LW_1000_1200=6<a name='65'>
     integer, parameter :: idx_LW_1200_2000=7<a name='66'>
<a name='67'>
<font color=#447700>! First two values represent the overlap of volcanics with the non-window<a name='68'></font>
<font color=#447700>! (0-800, 1200-2200 cm^-1) and window (800-1200 cm^-1) regions.|  Coefficients<a name='69'></font>
<font color=#447700>! were derived using crm_volc_minimize.pro with spectral flux optimization<a name='70'></font>
<font color=#447700>! on first iteration, total heating rate on subsequent iterations (2-9).<a name='71'></font>
<font color=#447700>! Five profiles for HLS, HLW, MLS, MLW, and TRO conditions were given equal<a name='72'></font>
<font color=#447700>! weight.  RMS heating rate errors for a visible stratospheric optical<a name='73'></font>
<font color=#447700>! depth of 1.0 are 0.02948 K/day.<a name='74'></font>
<font color=#447700>!<a name='75'></font>
      real(r8) :: abs_cff_mss_aer(bnd_nbr_LW) = &amp;<a name='76'>
         (/ 70.257384, 285.282943, &amp;<a name='77'>
         1.0273851e+02, 6.3073303e+01, 1.2039569e+02, &amp;<a name='78'>
         3.6343643e+02, 2.7138528e+02 /)<a name='79'>
<a name='80'>
<font color=#447700>!From radae.F90 module<a name='81'></font>
      real(r8), parameter:: min_tp_h2o = 160.0        <font color=#447700>! min T_p for pre-calculated abs/emis<a name='82'></font>
      real(r8), parameter:: max_tp_h2o = 349.999999   <font color=#447700>! max T_p for pre-calculated abs/emis<a name='83'></font>
      real(r8), parameter:: dtp_h2o = 21.111111111111 <font color=#447700>! difference in adjacent elements of tp_h2o<a name='84'></font>
      real(r8), parameter:: min_te_h2o = -120.0       <font color=#447700>! min T_e-T_p for pre-calculated abs/emis<a name='85'></font>
      real(r8), parameter:: max_te_h2o = 79.999999    <font color=#447700>! max T_e-T_p for pre-calculated abs/emis<a name='86'></font>
      real(r8), parameter:: dte_h2o  = 10.0           <font color=#447700>! difference in adjacent elements of te_h2o<a name='87'></font>
      real(r8), parameter:: min_rh_h2o = 0.0          <font color=#447700>! min RH for pre-calculated abs/emis<a name='88'></font>
      real(r8), parameter:: max_rh_h2o = 1.19999999   <font color=#447700>! max RH for pre-calculated abs/emis<a name='89'></font>
      real(r8), parameter:: drh_h2o = 0.2             <font color=#447700>! difference in adjacent elements of RH<a name='90'></font>
      real(r8), parameter:: min_lu_h2o = -8.0         <font color=#447700>! min log_10(U) for pre-calculated abs/emis<a name='91'></font>
      real(r8), parameter:: min_u_h2o  = 1.0e-8       <font color=#447700>! min pressure-weighted path-length<a name='92'></font>
      real(r8), parameter:: max_lu_h2o =  3.9999999   <font color=#447700>! max log_10(U) for pre-calculated abs/emis<a name='93'></font>
      real(r8), parameter:: dlu_h2o  = 0.5            <font color=#447700>! difference in adjacent elements of lu_h2o<a name='94'></font>
      real(r8), parameter:: min_lp_h2o = -3.0         <font color=#447700>! min log_10(P) for pre-calculated abs/emis<a name='95'></font>
      real(r8), parameter:: min_p_h2o = 1.0e-3        <font color=#447700>! min log_10(P) for pre-calculated abs/emis<a name='96'></font>
      real(r8), parameter:: max_lp_h2o = -0.0000001   <font color=#447700>! max log_10(P) for pre-calculated abs/emis<a name='97'></font>
      real(r8), parameter:: dlp_h2o = 0.3333333333333 <font color=#447700>! difference in adjacent elements of lp_h2o<a name='98'></font>
      integer, parameter :: n_u = 25   <font color=#447700>! Number of U in abs/emis tables<a name='99'></font>
      integer, parameter :: n_p = 10   <font color=#447700>! Number of P in abs/emis tables<a name='100'></font>
      integer, parameter :: n_tp = 10  <font color=#447700>! Number of T_p in abs/emis tables<a name='101'></font>
      integer, parameter :: n_te = 21  <font color=#447700>! Number of T_e in abs/emis tables<a name='102'></font>
      integer, parameter :: n_rh = 7   <font color=#447700>! Number of RH in abs/emis tables<a name='103'></font>
      real(r8):: c16,c17,c26,c27,c28,c29,c30,c31<a name='104'>
      real(r8):: fwcoef      <font color=#447700>! Farwing correction constant<a name='105'></font>
      real(r8):: fwc1,fwc2   <font color=#447700>! Farwing correction constants<a name='106'></font>
      real(r8):: fc1         <font color=#447700>! Farwing correction constant<a name='107'></font>
      real(r8):: amco2 <font color=#447700>! Molecular weight of co2   (g/mol)<a name='108'></font>
      real(r8):: amd   <font color=#447700>! Molecular weight of dry air (g/mol)<a name='109'></font>
      real(r8):: p0    <font color=#447700>! Standard pressure (dynes/cm**2)<a name='110'></font>
<a name='111'>
<font color=#447700>! These are now allocatable. JM 20090612<a name='112'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: ah2onw   <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)   ! absorptivity (non-window)<a name='113'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: eh2onw   <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)   ! emissivity   (non-window)<a name='114'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: ah2ow    <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)    ! absorptivity (window, for adjacent layers)<a name='115'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: cn_ah2ow <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)    ! continuum transmission for absorptivity (window)<a name='116'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: cn_eh2ow <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)    ! continuum transmission for emissivity   (window)<a name='117'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: ln_ah2ow <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)    ! line-only transmission for absorptivity (window)<a name='118'></font>
  real(r8), allocatable, dimension(:,:,:,:,:)  :: ln_eh2ow <font color=#447700>! (n_p, n_tp, n_u, n_te, n_rh)    ! line-only transmission for emissivity   (window)<a name='119'></font>
<a name='120'>
<font color=#447700>!<a name='121'></font>
<font color=#447700>! Constant coefficients for water vapor overlap with trace gases.<a name='122'></font>
<font color=#447700>! Reference: Ramanathan, V. and  P.Downey, 1986: A Nonisothermal<a name='123'></font>
<font color=#447700>!            Emissivity and Absorptivity Formulation for Water Vapor<a name='124'></font>
<font color=#447700>!            Journal of Geophysical Research, vol. 91., D8, pp 8649-8666<a name='125'></font>
<font color=#447700>!<a name='126'></font>
  real(r8):: coefh(2,4) = reshape(  &amp;<a name='127'>
         (/ (/5.46557e+01,-7.30387e-02/), &amp;<a name='128'>
            (/1.09311e+02,-1.46077e-01/), &amp;<a name='129'>
            (/5.11479e+01,-6.82615e-02/), &amp;<a name='130'>
            (/1.02296e+02,-1.36523e-01/) /), (/2,4/) )<a name='131'>
<font color=#447700>!<a name='132'></font>
  real(r8):: coefj(3,2) = reshape( &amp;<a name='133'>
            (/ (/2.82096e-02,2.47836e-04,1.16904e-06/), &amp;<a name='134'>
               (/9.27379e-02,8.04454e-04,6.88844e-06/) /), (/3,2/) )<a name='135'>
<font color=#447700>!<a name='136'></font>
  real(r8):: coefk(3,2) = reshape( &amp;<a name='137'>
            (/ (/2.48852e-01,2.09667e-03,2.60377e-06/) , &amp;<a name='138'>
               (/1.03594e+00,6.58620e-03,4.04456e-06/) /), (/3,2/) )<a name='139'>
<a name='140'>
  integer, parameter :: ntemp = 192 <font color=#447700>! Number of temperatures in H2O sat. table for Tp<a name='141'></font>
  real(r8) :: estblh2o(0:ntemp)       <font color=#447700>! saturation vapor pressure for H2O for Tp rang<a name='142'></font>
  integer, parameter :: o_fa = 6   <font color=#447700>! Degree+1 of poly of T_e for absorptivity as U-&gt;inf.<a name='143'></font>
  integer, parameter :: o_fe = 6   <font color=#447700>! Degree+1 of poly of T_e for emissivity as U-&gt;inf.<a name='144'></font>
<a name='145'>
<font color=#447700>!-----------------------------------------------------------------------------<a name='146'></font>
<font color=#447700>! Data for f in C/H/E fit -- value of A and E as U-&gt;infinity<a name='147'></font>
<font color=#447700>! New C/LT/E fit (Hitran 2K, CKD 2.4) -- no change<a name='148'></font>
<font color=#447700>!     These values are determined by integrals of Planck functions or<a name='149'></font>
<font color=#447700>!     derivatives of Planck functions only.<a name='150'></font>
<font color=#447700>!-----------------------------------------------------------------------------<a name='151'></font>
<font color=#447700>!<a name='152'></font>
<font color=#447700>! fa/fe coefficients for 2 bands (0-800 &amp; 1200-2200, 800-1200 cm^-1)<a name='153'></font>
<font color=#447700>!<a name='154'></font>
<font color=#447700>! Coefficients of polynomial for f_a in T_e<a name='155'></font>
<font color=#447700>!<a name='156'></font>
  real(r8), parameter:: fat(o_fa,nbands) = reshape( (/ &amp;<a name='157'>
       (/-1.06665373E-01,  2.90617375E-02, -2.70642049E-04,   &amp;   <font color=#447700>! 0-800&amp;1200-2200 cm^-1<a name='158'></font>
          1.07595511E-06, -1.97419681E-09,  1.37763374E-12/), &amp;   <font color=#447700>!   0-800&amp;1200-2200 cm^-1<a name='159'></font>
       (/ 1.10666537E+00, -2.90617375E-02,  2.70642049E-04,   &amp;   <font color=#447700>! 800-1200 cm^-1<a name='160'></font>
         -1.07595511E-06,  1.97419681E-09, -1.37763374E-12/) /) &amp; <font color=#447700>!   800-1200 cm^-1<a name='161'></font>
       , (/o_fa,nbands/) )<a name='162'>
<font color=#447700>!<a name='163'></font>
<font color=#447700>! Coefficients of polynomial for f_e in T_e<a name='164'></font>
<font color=#447700>!<a name='165'></font>
  real(r8), parameter:: fet(o_fe,nbands) = reshape( (/ &amp;<a name='166'>
      (/3.46148163E-01,  1.51240299E-02, -1.21846479E-04,   &amp;   <font color=#447700>! 0-800&amp;1200-2200 cm^-1<a name='167'></font>
        4.04970123E-07, -6.15368936E-10,  3.52415071E-13/), &amp;   <font color=#447700>!   0-800&amp;1200-2200 cm^-1<a name='168'></font>
      (/6.53851837E-01, -1.51240299E-02,  1.21846479E-04,   &amp;   <font color=#447700>! 800-1200 cm^-1<a name='169'></font>
       -4.04970123E-07,  6.15368936E-10, -3.52415071E-13/) /) &amp; <font color=#447700>!   800-1200 cm^-1<a name='170'></font>
      , (/o_fa,nbands/) )<a name='171'>
<a name='172'>
<a name='173'>
      real(r8) ::  gravit     <font color=#447700>! Acceleration of gravity (cgs)<a name='174'></font>
      real(r8) ::  rga        <font color=#447700>! 1./gravit<a name='175'></font>
      real(r8) ::  gravmks    <font color=#447700>! Acceleration of gravity (mks)<a name='176'></font>
      real(r8) ::  cpair      <font color=#447700>! Specific heat of dry air<a name='177'></font>
      real(r8) ::  epsilo     <font color=#447700>! Ratio of mol. wght of H2O to dry air<a name='178'></font>
      real(r8) ::  epsqs      <font color=#447700>! Ratio of mol. wght of H2O to dry air<a name='179'></font>
      real(r8) ::  sslp       <font color=#447700>! Standard sea-level pressure<a name='180'></font>
      real(r8) ::  stebol     <font color=#447700>! Stefan-Boltzmann's constant<a name='181'></font>
      real(r8) ::  rgsslp     <font color=#447700>! 0.5/(gravit*sslp)<a name='182'></font>
      real(r8) ::  dpfo3      <font color=#447700>! Voigt correction factor for O3<a name='183'></font>
      real(r8) ::  dpfco2     <font color=#447700>! Voigt correction factor for CO2<a name='184'></font>
      real(r8) ::  dayspy     <font color=#447700>! Number of days per 1 year<a name='185'></font>
      real(r8) ::  pie        <font color=#447700>! 3.14.....<a name='186'></font>
      real(r8) ::  mwdry      <font color=#447700>! molecular weight dry air ~ kg/kmole (shr_const_mwdair)<a name='187'></font>
      real(r8) ::  scon       <font color=#447700>! solar constant (not used in WRF)<a name='188'></font>
      real(r8) ::  co2mmr<a name='189'>
real(r8) ::   mwco2              <font color=#447700>! molecular weight of carbon dioxide<a name='190'></font>
real(r8) ::   mwh2o              <font color=#447700>! molecular weight water vapor (shr_const_mwwv)<a name='191'></font>
real(r8) ::   mwch4              <font color=#447700>! molecular weight ch4<a name='192'></font>
real(r8) ::   mwn2o              <font color=#447700>! molecular weight n2o<a name='193'></font>
real(r8) ::   mwf11              <font color=#447700>! molecular weight cfc11<a name='194'></font>
real(r8) ::   mwf12              <font color=#447700>! molecular weight cfc12<a name='195'></font>
real(r8) ::   cappa              <font color=#447700>! R/Cp<a name='196'></font>
real(r8) ::   rair               <font color=#447700>! Gas constant for dry air (J/K/kg)<a name='197'></font>
real(r8) ::   tmelt              <font color=#447700>! freezing T of fresh water ~ K<a name='198'></font>
real(r8) ::   r_universal        <font color=#447700>! Universal gas constant ~ J/K/kmole<a name='199'></font>
real(r8) ::   latvap             <font color=#447700>! latent heat of evaporation ~ J/kg<a name='200'></font>
real(r8) ::   latice             <font color=#447700>! latent heat of fusion ~ J/kg<a name='201'></font>
real(r8) ::   zvir               <font color=#447700>! R_V/R_D - 1.<a name='202'></font>
  integer plenest  <font color=#447700>! length of saturation vapor pressure table<a name='203'></font>
  parameter (plenest=250)<a name='204'>
<font color=#447700>! <a name='205'></font>
<font color=#447700>! Table of saturation vapor pressure values es from tmin degrees<a name='206'></font>
<font color=#447700>! to tmax+1 degrees k in one degree increments.  ttrice defines the<a name='207'></font>
<font color=#447700>! transition region where es is a combination of ice &amp; water values<a name='208'></font>
<font color=#447700>!<a name='209'></font>
real(r8) estbl(plenest)      <font color=#447700>! table values of saturation vapor pressure<a name='210'></font>
real(r8) tmin       <font color=#447700>! min temperature (K) for table<a name='211'></font>
real(r8) tmax       <font color=#447700>! max temperature (K) for table<a name='212'></font>
real(r8) pcf(6)     <font color=#447700>! polynomial coeffs -&gt; es transition water to ice<a name='213'></font>
<font color=#447700>!real(r8), allocatable :: pin(:)           ! ozone pressure level (levsiz)<a name='214'></font>
<font color=#447700>!real(r8), allocatable :: ozmix(:,:,:)     ! mixing ratio<a name='215'></font>
<font color=#447700>!real(r8), allocatable, target :: abstot_3d(:,:,:,:) ! Non-adjacent layer absorptivites<a name='216'></font>
<font color=#447700>!real(r8), allocatable, target :: absnxt_3d(:,:,:,:) ! Nearest layer absorptivities<a name='217'></font>
<font color=#447700>!real(r8), allocatable, target :: emstot_3d(:,:,:)   ! Total emissivity<a name='218'></font>
<a name='219'>
<font color=#447700>!From aer_optics.F90 module<a name='220'></font>
integer, parameter :: idxVIS = 8     <font color=#447700>! index to visible band<a name='221'></font>
integer, parameter :: nrh = 1000   <font color=#447700>! number of relative humidity values for look-up-table<a name='222'></font>
integer, parameter :: nspint = 19   <font color=#447700>! number of spectral intervals<a name='223'></font>
<a name='224'>
<font color=#447700>! These are now allocatable,  JM 20090612<a name='225'></font>
real(r8), allocatable, dimension(:,:) :: ksul    <font color=#447700>! (nrh, nspint)    ! sulfate specific extinction  ( m^2 g-1 )<a name='226'></font>
real(r8), allocatable, dimension(:,:) :: wsul    <font color=#447700>! (nrh, nspint)    ! sulfate single scattering albedo<a name='227'></font>
real(r8), allocatable, dimension(:,:) :: gsul    <font color=#447700>! (nrh, nspint)    ! sulfate asymmetry parameter<a name='228'></font>
real(r8), allocatable, dimension(:,:) :: ksslt   <font color=#447700>! (nrh, nspint)   ! sea-salt specific extinction  ( m^2 g-1 )<a name='229'></font>
real(r8), allocatable, dimension(:,:) :: wsslt   <font color=#447700>! (nrh, nspint)   ! sea-salt single scattering albedo<a name='230'></font>
real(r8), allocatable, dimension(:,:) :: gsslt   <font color=#447700>! (nrh, nspint)   ! sea-salt asymmetry parameter<a name='231'></font>
real(r8), allocatable, dimension(:,:) :: kcphil  <font color=#447700>! (nrh, nspint)  ! hydrophilic carbon specific extinction  ( m^2 g-1 )<a name='232'></font>
real(r8), allocatable, dimension(:,:) :: wcphil  <font color=#447700>! (nrh, nspint)  ! hydrophilic carbon single scattering albedo<a name='233'></font>
real(r8), allocatable, dimension(:,:) :: gcphil  <font color=#447700>! (nrh, nspint)  ! hydrophilic carbon asymmetry parameter<a name='234'></font>
<a name='235'>
real(r8) :: kbg(nspint)          <font color=#447700>! background specific extinction  ( m^2 g-1 )<a name='236'></font>
real(r8) :: wbg(nspint)          <font color=#447700>! background single scattering albedo<a name='237'></font>
real(r8) :: gbg(nspint)          <font color=#447700>! background asymmetry parameter<a name='238'></font>
real(r8) :: kcphob(nspint)       <font color=#447700>! hydrophobic carbon specific extinction  ( m^2 g-1 )<a name='239'></font>
real(r8) :: wcphob(nspint)       <font color=#447700>! hydrophobic carbon single scattering albedo<a name='240'></font>
real(r8) :: gcphob(nspint)       <font color=#447700>! hydrophobic carbon asymmetry parameter<a name='241'></font>
real(r8) :: kcb(nspint)          <font color=#447700>! black carbon specific extinction  ( m^2 g-1 )<a name='242'></font>
real(r8) :: wcb(nspint)          <font color=#447700>! black carbon single scattering albedo<a name='243'></font>
real(r8) :: gcb(nspint)          <font color=#447700>! black carbon asymmetry parameter<a name='244'></font>
real(r8) :: kvolc(nspint)        <font color=#447700>! volcanic specific extinction  ( m^2 g-1)<a name='245'></font>
real(r8) :: wvolc(nspint)        <font color=#447700>! volcanic single scattering albedo<a name='246'></font>
real(r8) :: gvolc(nspint)        <font color=#447700>! volcanic asymmetry parameter<a name='247'></font>
<a name='248'>
real(r8) :: kdst(ndstsz, nspint) <font color=#447700>! dust specific extinction  ( m^2 g-1 )<a name='249'></font>
real(r8) :: wdst(ndstsz, nspint) <font color=#447700>! dust single scattering albedo<a name='250'></font>
real(r8) :: gdst(ndstsz, nspint) <font color=#447700>! dust asymmetry parameter<a name='251'></font>
<font color=#447700>!<a name='252'></font>
<font color=#447700>!From comozp.F90 module<a name='253'></font>
      real(r8) cplos    <font color=#447700>! constant for ozone path length integral<a name='254'></font>
      real(r8) cplol    <font color=#447700>! constant for ozone path length integral<a name='255'></font>
<a name='256'>
<font color=#447700>!ccc<a name='257'></font>
#ifdef CLWRFGHG<a name='258'>
<font color=#447700>!! UC-CLWRF June.09<a name='259'></font>
   real(r8) :: co2vmr = 3.550e-4         <font color=#447700>! co2   volume mixing ratio<a name='260'></font>
   real(r8) :: n2ovmr = 0.311e-6         <font color=#447700>! n2o   volume mixing ratio<a name='261'></font>
   real(r8) :: ch4vmr = 1.714e-6         <font color=#447700>! ch4   volume mixing ratio<a name='262'></font>
   real(r8) :: f11vmr = 0.280e-9         <font color=#447700>! cfc11 volume mixing ratio<a name='263'></font>
   real(r8) :: f12vmr = 0.503e-9         <font color=#447700>! cfc12 volume mixing ratio<a name='264'></font>
<a name='265'>
   integer, parameter               :: cyr = 500     <font color=#447700>! maximum num. of lines in 'CAMtr_volume_mixing_ratio' file<a name='266'></font>
#else<a name='267'>
<font color=#447700>!ccc<a name='268'></font>
<a name='269'>
<font color=#447700>!From ghg_surfvals.F90 module<a name='270'></font>
   real(r8) :: co2vmr = 3.550e-4         <font color=#447700>! co2   volume mixing ratio<a name='271'></font>
   real(r8) :: n2ovmr = 0.311e-6         <font color=#447700>! n2o   volume mixing ratio<a name='272'></font>
   real(r8) :: ch4vmr = 1.714e-6         <font color=#447700>! ch4   volume mixing ratio<a name='273'></font>
   real(r8) :: f11vmr = 0.280e-9         <font color=#447700>! cfc11 volume mixing ratio<a name='274'></font>
   real(r8) :: f12vmr = 0.503e-9         <font color=#447700>! cfc12 volume mixing ratio<a name='275'></font>
<a name='276'>
integer, parameter :: cyr = 233  <font color=#447700>! number of years of co2 data<a name='277'></font>
<a name='278'>
   integer  :: yrdata(cyr) = &amp;<a name='279'>
 (/ 1869, 1870, 1871, 1872, 1873, 1874, 1875, &amp;<a name='280'>
    1876, 1877, 1878, 1879, 1880, 1881, 1882, &amp;<a name='281'>
    1883, 1884, 1885, 1886, 1887, 1888, 1889, &amp;<a name='282'>
    1890, 1891, 1892, 1893, 1894, 1895, 1896, &amp;<a name='283'>
    1897, 1898, 1899, 1900, 1901, 1902, 1903, &amp;<a name='284'>
    1904, 1905, 1906, 1907, 1908, 1909, 1910, &amp;<a name='285'>
    1911, 1912, 1913, 1914, 1915, 1916, 1917, &amp;<a name='286'>
    1918, 1919, 1920, 1921, 1922, 1923, 1924, &amp;<a name='287'>
    1925, 1926, 1927, 1928, 1929, 1930, 1931, &amp;<a name='288'>
    1932, 1933, 1934, 1935, 1936, 1937, 1938, &amp;<a name='289'>
    1939, 1940, 1941, 1942, 1943, 1944, 1945, &amp;<a name='290'>
    1946, 1947, 1948, 1949, 1950, 1951, 1952, &amp;<a name='291'>
    1953, 1954, 1955, 1956, 1957, 1958, 1959, &amp;<a name='292'>
    1960, 1961, 1962, 1963, 1964, 1965, 1966, &amp;<a name='293'>
    1967, 1968, 1969, 1970, 1971, 1972, 1973, &amp;<a name='294'>
    1974, 1975, 1976, 1977, 1978, 1979, 1980, &amp;<a name='295'>
    1981, 1982, 1983, 1984, 1985, 1986, 1987, &amp;<a name='296'>
    1988, 1989, 1990, 1991, 1992, 1993, 1994, &amp;<a name='297'>
    1995, 1996, 1997, 1998, 1999, 2000, 2001, &amp;<a name='298'>
    2002, 2003, 2004, 2005, 2006, 2007, 2008, &amp;<a name='299'>
    2009, 2010, 2011, 2012, 2013, 2014, 2015, &amp;<a name='300'>
    2016, 2017, 2018, 2019, 2020, 2021, 2022, &amp;<a name='301'>
    2023, 2024, 2025, 2026, 2027, 2028, 2029, &amp;<a name='302'>
    2030, 2031, 2032, 2033, 2034, 2035, 2036, &amp;<a name='303'>
    2037, 2038, 2039, 2040, 2041, 2042, 2043, &amp;<a name='304'>
    2044, 2045, 2046, 2047, 2048, 2049, 2050, &amp;<a name='305'>
    2051, 2052, 2053, 2054, 2055, 2056, 2057, &amp;<a name='306'>
    2058, 2059, 2060, 2061, 2062, 2063, 2064, &amp;<a name='307'>
    2065, 2066, 2067, 2068, 2069, 2070, 2071, &amp;<a name='308'>
    2072, 2073, 2074, 2075, 2076, 2077, 2078, &amp;<a name='309'>
    2079, 2080, 2081, 2082, 2083, 2084, 2085, &amp;<a name='310'>
    2086, 2087, 2088, 2089, 2090, 2091, 2092, &amp;<a name='311'>
    2093, 2094, 2095, 2096, 2097, 2098, 2099, &amp;<a name='312'>
    2100, 2101                               /)<a name='313'>
<a name='314'>
<font color=#447700>! A2 future scenario<a name='315'></font>
    real(r8)  :: co2(cyr) = &amp;<a name='316'>
 (/ 289.263, 289.263, 289.416, 289.577, 289.745, 289.919, 290.102, &amp;<a name='317'>
    290.293, 290.491, 290.696, 290.909, 291.129, 291.355, 291.587, 291.824, &amp;<a name='318'>
    292.066, 292.313, 292.563, 292.815, 293.071, 293.328, 293.586, 293.843, &amp;<a name='319'>
    294.098, 294.35, 294.598, 294.842, 295.082, 295.32, 295.558, 295.797,   &amp;<a name='320'>
    296.038, 296.284, 296.535, 296.794, 297.062, 297.338, 297.62, 297.91,   &amp;<a name='321'>
    298.204, 298.504, 298.806, 299.111, 299.419, 299.729, 300.04, 300.352,  &amp;<a name='322'>
    300.666, 300.98, 301.294, 301.608, 301.923, 302.237, 302.551, 302.863,  &amp;<a name='323'>
    303.172, 303.478, 303.779, 304.075, 304.366, 304.651, 304.93, 305.206,  &amp;<a name='324'>
    305.478, 305.746, 306.013, 306.28, 306.546, 306.815, 307.087, 307.365,  &amp;<a name='325'>
    307.65, 307.943, 308.246, 308.56, 308.887, 309.228, 309.584, 309.956,   &amp;<a name='326'>
    310.344, 310.749, 311.172, 311.614, 312.077, 312.561, 313.068, 313.599, &amp;<a name='327'>
    314.154, 314.737, 315.347, 315.984, 316.646, 317.328, 318.026, 318.742, &amp;<a name='328'>
    319.489, 320.282, 321.133, 322.045, 323.021, 324.06, 325.155, 326.299,  &amp;<a name='329'>
    327.484, 328.698, 329.933, 331.194, 332.499, 333.854, 335.254, 336.69,  &amp;<a name='330'>
    338.15, 339.628, 341.125, 342.65, 344.206, 345.797, 347.397, 348.98,    &amp;<a name='331'>
    350.551, 352.1, 354.3637, 355.7772, 357.1601, 358.5306, 359.9046,       &amp;<a name='332'>
    361.4157, 363.0445, 364.7761, 366.6064, 368.5322, 370.534, 372.5798,    &amp;<a name='333'>
    374.6564, 376.7656, 378.9087, 381.0864, 383.2994, 385.548, 387.8326,    &amp;<a name='334'>
    390.1536, 392.523, 394.9625, 397.4806, 400.075, 402.7444, 405.4875,     &amp;<a name='335'>
    408.3035, 411.1918, 414.1518, 417.1831, 420.2806, 423.4355, 426.6442,   &amp;<a name='336'>
    429.9076, 433.2261, 436.6002, 440.0303, 443.5168, 447.06, 450.6603,     &amp;<a name='337'>
    454.3059, 457.9756, 461.6612, 465.3649, 469.0886, 472.8335, 476.6008,   &amp;<a name='338'>
    480.3916, 484.2069, 488.0473, 491.9184, 495.8295, 499.7849, 503.7843,   &amp;<a name='339'>
    507.8278, 511.9155, 516.0476, 520.2243, 524.4459, 528.7127, 533.0213,   &amp;<a name='340'>
    537.3655, 541.7429, 546.1544, 550.6005, 555.0819, 559.5991, 564.1525,   &amp;<a name='341'>
    568.7429, 573.3701, 578.0399, 582.7611, 587.5379, 592.3701, 597.2572,   &amp;<a name='342'>
    602.1997, 607.1975, 612.2507, 617.3596, 622.524, 627.7528, 633.0616,    &amp;<a name='343'>
    638.457, 643.9384, 649.505, 655.1568, 660.8936, 666.7153, 672.6219,     &amp;<a name='344'>
    678.6133, 684.6945, 690.8745, 697.1569, 703.5416, 710.0284, 716.6172,   &amp;<a name='345'>
    723.308, 730.1008, 736.9958, 743.993, 751.0975, 758.3183, 765.6594,     &amp;<a name='346'>
    773.1207, 780.702, 788.4033, 796.2249, 804.1667, 812.2289, 820.4118,    &amp;<a name='347'>
    828.6444, 828.6444 /)<a name='348'>
#endif<a name='349'>
<font color=#447700>!ccc<a name='350'></font>
      integer  :: ntoplw      <font color=#447700>! top level to solve for longwave cooling (WRF sets this to 1 for model top below 10 mb)<a name='351'></font>
<a name='352'>
      logical :: masterproc = .true.<a name='353'>
      logical :: ozncyc            <font color=#447700>! true =&gt; cycle ozone dataset<a name='354'></font>
<font color=#447700>!     logical :: dosw              ! True =&gt; shortwave calculation this timestep<a name='355'></font>
<font color=#447700>!     logical :: dolw              ! True =&gt; longwave calculation this timestep<a name='356'></font>
      logical :: indirect          <font color=#447700>! True =&gt; include indirect radiative effects of sulfate aerosols<a name='357'></font>
<font color=#447700>!     logical :: doabsems          ! True =&gt; abs/emiss calculation this timestep<a name='358'></font>
      logical :: radforce   = .false.          <font color=#447700>! True =&gt; calculate aerosol shortwave forcing<a name='359'></font>
      logical :: trace_gas=.false.             <font color=#447700>! set true for chemistry<a name='360'></font>
      logical :: strat_volcanic   = .false.    <font color=#447700>! True =&gt; volcanic aerosol mass available<a name='361'></font>
<a name='362'>
    real(r8) retab(95)<a name='363'>
    <font color=#447700>!<a name='364'></font>
    <font color=#447700>!       Tabulated values of re(T) in the temperature interval<a name='365'></font>
    <font color=#447700>!       180 K -- 274 K; hexagonal columns assumed:<a name='366'></font>
    <font color=#447700>!<a name='367'></font>
    data retab / 						&amp;<a name='368'>
         5.92779, 6.26422, 6.61973, 6.99539, 7.39234,	&amp;<a name='369'>
         7.81177, 8.25496, 8.72323, 9.21800, 9.74075, 10.2930,	&amp;<a name='370'>
         10.8765, 11.4929, 12.1440, 12.8317, 13.5581, 14.2319, 	&amp;<a name='371'>
         15.0351, 15.8799, 16.7674, 17.6986, 18.6744, 19.6955,	&amp;<a name='372'>
         20.7623, 21.8757, 23.0364, 24.2452, 25.5034, 26.8125,	&amp;<a name='373'>
         27.7895, 28.6450, 29.4167, 30.1088, 30.7306, 31.2943, 	&amp;<a name='374'>
         31.8151, 32.3077, 32.7870, 33.2657, 33.7540, 34.2601, 	&amp;<a name='375'>
         34.7892, 35.3442, 35.9255, 36.5316, 37.1602, 37.8078,	&amp;<a name='376'>
         38.4720, 39.1508, 39.8442, 40.5552, 41.2912, 42.0635,	&amp;<a name='377'>
         42.8876, 43.7863, 44.7853, 45.9170, 47.2165, 48.7221,	&amp;<a name='378'>
         50.4710, 52.4980, 54.8315, 57.4898, 60.4785, 63.7898,	&amp;<a name='379'>
         65.5604, 71.2885, 75.4113, 79.7368, 84.2351, 88.8833,	&amp;<a name='380'>
         93.6658, 98.5739, 103.603, 108.752, 114.025, 119.424, 	&amp;<a name='381'>
         124.954, 130.630, 136.457, 142.446, 148.608, 154.956,	&amp;<a name='382'>
         161.503, 168.262, 175.248, 182.473, 189.952, 197.699,	&amp;<a name='383'>
         205.728, 214.055, 222.694, 231.661, 240.971, 250.639/	<a name='384'>
    <font color=#447700>!<a name='385'></font>
    save retab<a name='386'>
contains<a name='387'>
<a name='388'>
<a name='389'>
<a name='390'>
<A NAME='SORTARRAY'><A href='../../html_code/phys/module_ra_cam_support.F.html#SORTARRAY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='391'>
<font color=#993300>subroutine </font><font color=#cc0000>sortarray</font>(n, ain, indxa)  <A href='../../call_to/SORTARRAY.html' TARGET='index'>2</A><a name='392'>
<font color=#447700>!-----------------------------------------------<a name='393'></font>
<font color=#447700>!<a name='394'></font>
<font color=#447700>! Purpose:<a name='395'></font>
<font color=#447700>!       Sort an array<a name='396'></font>
<font color=#447700>! Alogrithm:<a name='397'></font>
<font color=#447700>!       Based on Shell's sorting method.<a name='398'></font>
<font color=#447700>!<a name='399'></font>
<font color=#447700>! Author: T. Craig<a name='400'></font>
<font color=#447700>!-----------------------------------------------<a name='401'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='402'></font>
   implicit none<a name='403'>
<font color=#447700>!<a name='404'></font>
<font color=#447700>!  Arguments<a name='405'></font>
<font color=#447700>!<a name='406'></font>
   integer , intent(in) :: n             <font color=#447700>! total number of elements<a name='407'></font>
   integer , intent(inout) :: indxa(n)   <font color=#447700>! array of integers<a name='408'></font>
   real(r8), intent(inout) :: ain(n)     <font color=#447700>! array to sort<a name='409'></font>
<font color=#447700>!<a name='410'></font>
<font color=#447700>!  local variables<a name='411'></font>
<font color=#447700>!<a name='412'></font>
   integer :: i, j                <font color=#447700>! Loop indices<a name='413'></font>
   integer :: ni                  <font color=#447700>! Starting increment<a name='414'></font>
   integer :: itmp                <font color=#447700>! Temporary index<a name='415'></font>
   real(r8):: atmp                <font color=#447700>! Temporary value to swap<a name='416'></font>
 <a name='417'>
   ni = 1 <a name='418'>
   do while(.TRUE.) <a name='419'>
      ni = 3*ni + 1 <a name='420'>
      if (ni &lt;= n) cycle  <a name='421'>
      exit  <a name='422'>
   end do <a name='423'>
 <a name='424'>
   do while(.TRUE.) <a name='425'>
      ni = ni/3 <a name='426'>
      do i = ni + 1, n <a name='427'>
         atmp = ain(i) <a name='428'>
         itmp = indxa(i) <a name='429'>
         j = i <a name='430'>
         do while(.TRUE.) <a name='431'>
            if (ain(j-ni) &lt;= atmp) exit  <a name='432'>
            ain(j) = ain(j-ni) <a name='433'>
            indxa(j) = indxa(j-ni) <a name='434'>
            j = j - ni <a name='435'>
            if (j &gt; ni) cycle  <a name='436'>
            exit  <a name='437'>
         end do <a name='438'>
         ain(j) = atmp <a name='439'>
         indxa(j) = itmp <a name='440'>
      end do <a name='441'>
      if (ni &gt; 1) cycle  <a name='442'>
      exit  <a name='443'>
   end do <a name='444'>
   return  <a name='445'>
 <a name='446'>
end subroutine sortarray<a name='447'>
<A NAME='TRCAB'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCAB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='448'>
<font color=#993300>subroutine </font><font color=#cc0000>trcab</font>(lchnk   ,ncol    ,pcols, pverp,               &amp; <A href='../../call_to/TRCAB.html' TARGET='index'>1</A><a name='449'>
                 k1      ,k2      ,ucfc11  ,ucfc12  ,un2o0   , &amp;<a name='450'>
                 un2o1   ,uch4    ,uco211  ,uco212  ,uco213  , &amp;<a name='451'>
                 uco221  ,uco222  ,uco223  ,bn2o0   ,bn2o1   , &amp;<a name='452'>
                 bch4    ,to3co2  ,pnm     ,dw      ,pnew    , &amp;<a name='453'>
                 s2c     ,uptype  ,dplh2o  ,abplnk1 ,tco2    , &amp;<a name='454'>
                 th2o    ,to3     ,abstrc  , &amp;<a name='455'>
                 aer_trn_ttl)<a name='456'>
<font color=#447700>!----------------------------------------------------------------------- <a name='457'></font>
<font color=#447700>! <a name='458'></font>
<font color=#447700>! Purpose: <a name='459'></font>
<font color=#447700>! Calculate absorptivity for non nearest layers for CH4, N2O, CFC11 and<a name='460'></font>
<font color=#447700>! CFC12.<a name='461'></font>
<font color=#447700>! <a name='462'></font>
<font color=#447700>! Method: <a name='463'></font>
<font color=#447700>! See CCM3 description for equations.<a name='464'></font>
<font color=#447700>! <a name='465'></font>
<font color=#447700>! Author: J. Kiehl<a name='466'></font>
<font color=#447700>! <a name='467'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='468'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='469'></font>
<font color=#447700>!  use ppgrid<a name='470'></font>
<font color=#447700>!  use volcrad<a name='471'></font>
<a name='472'>
   implicit none<a name='473'>
<a name='474'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='475'></font>
<font color=#447700>!<a name='476'></font>
<font color=#447700>! Input arguments<a name='477'></font>
<font color=#447700>!<a name='478'></font>
   integer, intent(in) :: lchnk                    <font color=#447700>! chunk identifier<a name='479'></font>
   integer, intent(in) :: ncol                     <font color=#447700>! number of atmospheric columns<a name='480'></font>
   integer, intent(in) :: pcols, pverp<a name='481'>
   integer, intent(in) :: k1,k2                    <font color=#447700>! level indices<a name='482'></font>
<font color=#447700>!<a name='483'></font>
   real(r8), intent(in) :: to3co2(pcols)           <font color=#447700>! pressure weighted temperature<a name='484'></font>
   real(r8), intent(in) :: pnm(pcols,pverp)        <font color=#447700>! interface pressures<a name='485'></font>
   real(r8), intent(in) :: ucfc11(pcols,pverp)     <font color=#447700>! CFC11 path length<a name='486'></font>
   real(r8), intent(in) :: ucfc12(pcols,pverp)     <font color=#447700>! CFC12 path length<a name='487'></font>
   real(r8), intent(in) :: un2o0(pcols,pverp)      <font color=#447700>! N2O path length<a name='488'></font>
<font color=#447700>!<a name='489'></font>
   real(r8), intent(in) :: un2o1(pcols,pverp)      <font color=#447700>! N2O path length (hot band)<a name='490'></font>
   real(r8), intent(in) :: uch4(pcols,pverp)       <font color=#447700>! CH4 path length<a name='491'></font>
   real(r8), intent(in) :: uco211(pcols,pverp)     <font color=#447700>! CO2 9.4 micron band path length<a name='492'></font>
   real(r8), intent(in) :: uco212(pcols,pverp)     <font color=#447700>! CO2 9.4 micron band path length<a name='493'></font>
   real(r8), intent(in) :: uco213(pcols,pverp)     <font color=#447700>! CO2 9.4 micron band path length<a name='494'></font>
<font color=#447700>!<a name='495'></font>
   real(r8), intent(in) :: uco221(pcols,pverp)     <font color=#447700>! CO2 10.4 micron band path length<a name='496'></font>
   real(r8), intent(in) :: uco222(pcols,pverp)     <font color=#447700>! CO2 10.4 micron band path length<a name='497'></font>
   real(r8), intent(in) :: uco223(pcols,pverp)     <font color=#447700>! CO2 10.4 micron band path length<a name='498'></font>
   real(r8), intent(in) :: bn2o0(pcols,pverp)      <font color=#447700>! pressure factor for n2o<a name='499'></font>
   real(r8), intent(in) :: bn2o1(pcols,pverp)      <font color=#447700>! pressure factor for n2o<a name='500'></font>
<font color=#447700>!<a name='501'></font>
   real(r8), intent(in) :: bch4(pcols,pverp)       <font color=#447700>! pressure factor for ch4<a name='502'></font>
   real(r8), intent(in) :: dw(pcols)               <font color=#447700>! h2o path length<a name='503'></font>
   real(r8), intent(in) :: pnew(pcols)             <font color=#447700>! pressure<a name='504'></font>
   real(r8), intent(in) :: s2c(pcols,pverp)        <font color=#447700>! continuum path length<a name='505'></font>
   real(r8), intent(in) :: uptype(pcols,pverp)     <font color=#447700>! p-type h2o path length<a name='506'></font>
<font color=#447700>!<a name='507'></font>
   real(r8), intent(in) :: dplh2o(pcols)           <font color=#447700>! p squared h2o path length<a name='508'></font>
   real(r8), intent(in) :: abplnk1(14,pcols,pverp) <font color=#447700>! Planck factor<a name='509'></font>
   real(r8), intent(in) :: tco2(pcols)             <font color=#447700>! co2 transmission factor<a name='510'></font>
   real(r8), intent(in) :: th2o(pcols)             <font color=#447700>! h2o transmission factor<a name='511'></font>
   real(r8), intent(in) :: to3(pcols)              <font color=#447700>! o3 transmission factor<a name='512'></font>
<a name='513'>
   real(r8), intent(in) :: aer_trn_ttl(pcols,pverp,pverp,bnd_nbr_LW) <font color=#447700>! aer trn.<a name='514'></font>
<a name='515'>
<font color=#447700>!<a name='516'></font>
<font color=#447700>!  Output Arguments<a name='517'></font>
<font color=#447700>!<a name='518'></font>
   real(r8), intent(out) :: abstrc(pcols)           <font color=#447700>! total trace gas absorptivity<a name='519'></font>
<font color=#447700>!<a name='520'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='521'></font>
<font color=#447700>!<a name='522'></font>
   integer  i,l                     <font color=#447700>! loop counters<a name='523'></font>
<a name='524'>
   real(r8) sqti(pcols)             <font color=#447700>! square root of mean temp<a name='525'></font>
   real(r8) du1                     <font color=#447700>! cfc11 path length<a name='526'></font>
   real(r8) du2                     <font color=#447700>! cfc12 path length<a name='527'></font>
   real(r8) acfc1                   <font color=#447700>! cfc11 absorptivity 798 cm-1<a name='528'></font>
   real(r8) acfc2                   <font color=#447700>! cfc11 absorptivity 846 cm-1<a name='529'></font>
<font color=#447700>!<a name='530'></font>
   real(r8) acfc3                   <font color=#447700>! cfc11 absorptivity 933 cm-1<a name='531'></font>
   real(r8) acfc4                   <font color=#447700>! cfc11 absorptivity 1085 cm-1<a name='532'></font>
   real(r8) acfc5                   <font color=#447700>! cfc12 absorptivity 889 cm-1<a name='533'></font>
   real(r8) acfc6                   <font color=#447700>! cfc12 absorptivity 923 cm-1<a name='534'></font>
   real(r8) acfc7                   <font color=#447700>! cfc12 absorptivity 1102 cm-1<a name='535'></font>
<font color=#447700>!<a name='536'></font>
   real(r8) acfc8                   <font color=#447700>! cfc12 absorptivity 1161 cm-1<a name='537'></font>
   real(r8) du01                    <font color=#447700>! n2o path length<a name='538'></font>
   real(r8) dbeta01                 <font color=#447700>! n2o pressure factor<a name='539'></font>
   real(r8) dbeta11                 <font color=#447700>!         "<a name='540'></font>
   real(r8) an2o1                   <font color=#447700>! absorptivity of 1285 cm-1 n2o band<a name='541'></font>
<font color=#447700>!<a name='542'></font>
   real(r8) du02                    <font color=#447700>! n2o path length<a name='543'></font>
   real(r8) dbeta02                 <font color=#447700>! n2o pressure factor<a name='544'></font>
   real(r8) an2o2                   <font color=#447700>! absorptivity of 589 cm-1 n2o band<a name='545'></font>
   real(r8) du03                    <font color=#447700>! n2o path length<a name='546'></font>
   real(r8) dbeta03                 <font color=#447700>! n2o pressure factor<a name='547'></font>
<font color=#447700>!<a name='548'></font>
   real(r8) an2o3                   <font color=#447700>! absorptivity of 1168 cm-1 n2o band<a name='549'></font>
   real(r8) duch4                   <font color=#447700>! ch4 path length<a name='550'></font>
   real(r8) dbetac                  <font color=#447700>! ch4 pressure factor<a name='551'></font>
   real(r8) ach4                    <font color=#447700>! absorptivity of 1306 cm-1 ch4 band<a name='552'></font>
   real(r8) du11                    <font color=#447700>! co2 path length<a name='553'></font>
<font color=#447700>!<a name='554'></font>
   real(r8) du12                    <font color=#447700>!       "<a name='555'></font>
   real(r8) du13                    <font color=#447700>!       "<a name='556'></font>
   real(r8) dbetc1                  <font color=#447700>! co2 pressure factor<a name='557'></font>
   real(r8) dbetc2                  <font color=#447700>! co2 pressure factor<a name='558'></font>
   real(r8) aco21                   <font color=#447700>! absorptivity of 1064 cm-1 band<a name='559'></font>
<font color=#447700>!<a name='560'></font>
   real(r8) du21                    <font color=#447700>! co2 path length<a name='561'></font>
   real(r8) du22                    <font color=#447700>!       "<a name='562'></font>
   real(r8) du23                    <font color=#447700>!       "<a name='563'></font>
   real(r8) aco22                   <font color=#447700>! absorptivity of 961 cm-1 band<a name='564'></font>
   real(r8) tt(pcols)               <font color=#447700>! temp. factor for h2o overlap factor<a name='565'></font>
<font color=#447700>!<a name='566'></font>
   real(r8) psi1                    <font color=#447700>!                 "<a name='567'></font>
   real(r8) phi1                    <font color=#447700>!                 "<a name='568'></font>
   real(r8) p1                      <font color=#447700>! h2o overlap factor<a name='569'></font>
   real(r8) w1                      <font color=#447700>!        "<a name='570'></font>
   real(r8) ds2c(pcols)             <font color=#447700>! continuum path length<a name='571'></font>
<font color=#447700>!<a name='572'></font>
   real(r8) duptyp(pcols)           <font color=#447700>! p-type path length<a name='573'></font>
   real(r8) tw(pcols,6)             <font color=#447700>! h2o transmission factor<a name='574'></font>
   real(r8) g1(6)                   <font color=#447700>!         "<a name='575'></font>
   real(r8) g2(6)                   <font color=#447700>!         "<a name='576'></font>
   real(r8) g3(6)                   <font color=#447700>!         "<a name='577'></font>
<font color=#447700>!<a name='578'></font>
   real(r8) g4(6)                   <font color=#447700>!         "<a name='579'></font>
   real(r8) ab(6)                   <font color=#447700>! h2o temp. factor<a name='580'></font>
   real(r8) bb(6)                   <font color=#447700>!         "<a name='581'></font>
   real(r8) abp(6)                  <font color=#447700>!         "<a name='582'></font>
   real(r8) bbp(6)                  <font color=#447700>!         "<a name='583'></font>
<font color=#447700>!<a name='584'></font>
   real(r8) tcfc3                   <font color=#447700>! transmission for cfc11 band<a name='585'></font>
   real(r8) tcfc4                   <font color=#447700>! transmission for cfc11 band<a name='586'></font>
   real(r8) tcfc6                   <font color=#447700>! transmission for cfc12 band<a name='587'></font>
   real(r8) tcfc7                   <font color=#447700>! transmission for cfc12 band<a name='588'></font>
   real(r8) tcfc8                   <font color=#447700>! transmission for cfc12 band<a name='589'></font>
<font color=#447700>!<a name='590'></font>
   real(r8) tlw                     <font color=#447700>! h2o transmission<a name='591'></font>
   real(r8) tch4                    <font color=#447700>! ch4 transmission<a name='592'></font>
<font color=#447700>!<a name='593'></font>
<font color=#447700>!--------------------------Data Statements------------------------------<a name='594'></font>
<font color=#447700>!<a name='595'></font>
   data g1 /0.0468556,0.0397454,0.0407664,0.0304380,0.0540398,0.0321962/<a name='596'>
   data g2 /14.4832,4.30242,5.23523,3.25342,0.698935,16.5599/<a name='597'>
   data g3 /26.1898,18.4476,15.3633,12.1927,9.14992,8.07092/<a name='598'>
   data g4 /0.0261782,0.0369516,0.0307266,0.0243854,0.0182932,0.0161418/<a name='599'>
   data ab /3.0857e-2,2.3524e-2,1.7310e-2,2.6661e-2,2.8074e-2,2.2915e-2/<a name='600'>
   data bb /-1.3512e-4,-6.8320e-5,-3.2609e-5,-1.0228e-5,-9.5743e-5,-1.0304e-4/<a name='601'>
   data abp/2.9129e-2,2.4101e-2,1.9821e-2,2.6904e-2,2.9458e-2,1.9892e-2/<a name='602'>
   data bbp/-1.3139e-4,-5.5688e-5,-4.6380e-5,-8.0362e-5,-1.0115e-4,-8.8061e-5/<a name='603'>
<font color=#447700>!<a name='604'></font>
<font color=#447700>!--------------------------Statement Functions--------------------------<a name='605'></font>
<font color=#447700>!<a name='606'></font>
   real(r8) func, u, b<a name='607'>
   func(u,b) = u/sqrt(4.0 + u*(1.0 + 1.0 / b))<a name='608'>
<font color=#447700>!<a name='609'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='610'></font>
<font color=#447700>!<a name='611'></font>
   do i = 1,ncol<a name='612'>
      sqti(i) = sqrt(to3co2(i))<a name='613'>
<font color=#447700>!<a name='614'></font>
<font color=#447700>! h2o transmission<a name='615'></font>
<font color=#447700>!<a name='616'></font>
      tt(i) = abs(to3co2(i) - 250.0)<a name='617'>
      ds2c(i) = abs(s2c(i,k1) - s2c(i,k2))<a name='618'>
      duptyp(i) = abs(uptype(i,k1) - uptype(i,k2))<a name='619'>
   end do<a name='620'>
<font color=#447700>!<a name='621'></font>
   do l = 1,6<a name='622'>
      do i = 1,ncol<a name='623'>
         psi1 = exp(abp(l)*tt(i) + bbp(l)*tt(i)*tt(i))<a name='624'>
         phi1 = exp(ab(l)*tt(i) + bb(l)*tt(i)*tt(i))<a name='625'>
         p1 = pnew(i)*(psi1/phi1)/sslp<a name='626'>
         w1 = dw(i)*phi1<a name='627'>
         tw(i,l) = exp(-g1(l)*p1*(sqrt(1.0 + g2(l)*(w1/p1)) - 1.0) - &amp;<a name='628'>
                   g3(l)*ds2c(i)-g4(l)*duptyp(i))<a name='629'>
      end do<a name='630'>
   end do<a name='631'>
<font color=#447700>!<a name='632'></font>
   do i=1,ncol<a name='633'>
      tw(i,1)=tw(i,1)*(0.7*aer_trn_ttl(i,k1,k2,idx_LW_0650_0800)+&amp;<font color=#447700>! l=1: 0750--0820 cm-1<a name='634'></font>
                       0.3*aer_trn_ttl(i,k1,k2,idx_LW_0800_1000)) <a name='635'>
      tw(i,2)=tw(i,2)*aer_trn_ttl(i,k1,k2,idx_LW_0800_1000) <font color=#447700>! l=2: 0820--0880 cm-1<a name='636'></font>
      tw(i,3)=tw(i,3)*aer_trn_ttl(i,k1,k2,idx_LW_0800_1000) <font color=#447700>! l=3: 0880--0900 cm-1<a name='637'></font>
      tw(i,4)=tw(i,4)*aer_trn_ttl(i,k1,k2,idx_LW_0800_1000) <font color=#447700>! l=4: 0900--1000 cm-1<a name='638'></font>
      tw(i,5)=tw(i,5)*aer_trn_ttl(i,k1,k2,idx_LW_1000_1200) <font color=#447700>! l=5: 1000--1120 cm-1<a name='639'></font>
      tw(i,6)=tw(i,6)*aer_trn_ttl(i,k1,k2,idx_LW_1000_1200) <font color=#447700>! l=6: 1120--1170 cm-1<a name='640'></font>
   end do                    <font color=#447700>! end loop over lon<a name='641'></font>
   do i = 1,ncol<a name='642'>
      du1 = abs(ucfc11(i,k1) - ucfc11(i,k2))<a name='643'>
      du2 = abs(ucfc12(i,k1) - ucfc12(i,k2))<a name='644'>
<font color=#447700>!<a name='645'></font>
<font color=#447700>! cfc transmissions<a name='646'></font>
<font color=#447700>!<a name='647'></font>
      tcfc3 = exp(-175.005*du1)<a name='648'>
      tcfc4 = exp(-1202.18*du1)<a name='649'>
      tcfc6 = exp(-5786.73*du2)<a name='650'>
      tcfc7 = exp(-2873.51*du2)<a name='651'>
      tcfc8 = exp(-2085.59*du2)<a name='652'>
<font color=#447700>!<a name='653'></font>
<font color=#447700>! Absorptivity for CFC11 bands<a name='654'></font>
<font color=#447700>!<a name='655'></font>
      acfc1 =  50.0*(1.0 - exp(-54.09*du1))*tw(i,1)*abplnk1(7,i,k2)<a name='656'>
      acfc2 =  60.0*(1.0 - exp(-5130.03*du1))*tw(i,2)*abplnk1(8,i,k2)<a name='657'>
      acfc3 =  60.0*(1.0 - tcfc3)*tw(i,4)*tcfc6*abplnk1(9,i,k2)<a name='658'>
      acfc4 = 100.0*(1.0 - tcfc4)*tw(i,5)*abplnk1(10,i,k2)<a name='659'>
<font color=#447700>!<a name='660'></font>
<font color=#447700>! Absorptivity for CFC12 bands<a name='661'></font>
<font color=#447700>!<a name='662'></font>
      acfc5 = 45.0*(1.0 - exp(-1272.35*du2))*tw(i,3)*abplnk1(11,i,k2)<a name='663'>
      acfc6 = 50.0*(1.0 - tcfc6)* tw(i,4) * abplnk1(12,i,k2)<a name='664'>
      acfc7 = 80.0*(1.0 - tcfc7)* tw(i,5) * tcfc4*abplnk1(13,i,k2)<a name='665'>
      acfc8 = 70.0*(1.0 - tcfc8)* tw(i,6) * abplnk1(14,i,k2)<a name='666'>
<font color=#447700>!<a name='667'></font>
<font color=#447700>! Emissivity for CH4 band 1306 cm-1<a name='668'></font>
<font color=#447700>!<a name='669'></font>
      tlw = exp(-1.0*sqrt(dplh2o(i)))<a name='670'>
      tlw=tlw*aer_trn_ttl(i,k1,k2,idx_LW_1200_2000)<a name='671'>
      duch4 = abs(uch4(i,k1) - uch4(i,k2))<a name='672'>
      dbetac = abs(bch4(i,k1) - bch4(i,k2))/duch4<a name='673'>
      ach4 = 6.00444*sqti(i)*log(1.0 + func(duch4,dbetac))*tlw*abplnk1(3,i,k2)<a name='674'>
      tch4 = 1.0/(1.0 + 0.02*func(duch4,dbetac))<a name='675'>
<font color=#447700>!<a name='676'></font>
<font color=#447700>! Absorptivity for N2O bands<a name='677'></font>
<font color=#447700>!<a name='678'></font>
      du01 = abs(un2o0(i,k1) - un2o0(i,k2))<a name='679'>
      du11 = abs(un2o1(i,k1) - un2o1(i,k2))<a name='680'>
      dbeta01 = abs(bn2o0(i,k1) - bn2o0(i,k2))/du01<a name='681'>
      dbeta11 = abs(bn2o1(i,k1) - bn2o1(i,k2))/du11<a name='682'>
<font color=#447700>!<a name='683'></font>
<font color=#447700>! 1285 cm-1 band<a name='684'></font>
<font color=#447700>!<a name='685'></font>
      an2o1 = 2.35558*sqti(i)*log(1.0 + func(du01,dbeta01) &amp;<a name='686'>
              + func(du11,dbeta11))*tlw*tch4*abplnk1(4,i,k2)<a name='687'>
      du02 = 0.100090*du01<a name='688'>
      du12 = 0.0992746*du11<a name='689'>
      dbeta02 = 0.964282*dbeta01<a name='690'>
<font color=#447700>!<a name='691'></font>
<font color=#447700>! 589 cm-1 band<a name='692'></font>
<font color=#447700>!<a name='693'></font>
      an2o2 = 2.65581*sqti(i)*log(1.0 + func(du02,dbeta02) + &amp;<a name='694'>
              func(du12,dbeta02))*th2o(i)*tco2(i)*abplnk1(5,i,k2)<a name='695'>
      du03 = 0.0333767*du01<a name='696'>
      dbeta03 = 0.982143*dbeta01<a name='697'>
<font color=#447700>!<a name='698'></font>
<font color=#447700>! 1168 cm-1 band<a name='699'></font>
<font color=#447700>!<a name='700'></font>
      an2o3 = 2.54034*sqti(i)*log(1.0 + func(du03,dbeta03))* &amp;<a name='701'>
              tw(i,6)*tcfc8*abplnk1(6,i,k2)<a name='702'>
<font color=#447700>!<a name='703'></font>
<font color=#447700>! Emissivity for 1064 cm-1 band of CO2<a name='704'></font>
<font color=#447700>!<a name='705'></font>
      du11 = abs(uco211(i,k1) - uco211(i,k2))<a name='706'>
      du12 = abs(uco212(i,k1) - uco212(i,k2))<a name='707'>
      du13 = abs(uco213(i,k1) - uco213(i,k2))<a name='708'>
      dbetc1 = 2.97558*abs(pnm(i,k1) + pnm(i,k2))/(2.0*sslp*sqti(i))<a name='709'>
      dbetc2 = 2.0*dbetc1<a name='710'>
      aco21 = 3.7571*sqti(i)*log(1.0 + func(du11,dbetc1) &amp;<a name='711'>
              + func(du12,dbetc2) + func(du13,dbetc2)) &amp;<a name='712'>
              *to3(i)*tw(i,5)*tcfc4*tcfc7*abplnk1(2,i,k2)<a name='713'>
<font color=#447700>!<a name='714'></font>
<font color=#447700>! Emissivity for 961 cm-1 band<a name='715'></font>
<font color=#447700>!<a name='716'></font>
      du21 = abs(uco221(i,k1) - uco221(i,k2))<a name='717'>
      du22 = abs(uco222(i,k1) - uco222(i,k2))<a name='718'>
      du23 = abs(uco223(i,k1) - uco223(i,k2))<a name='719'>
      aco22 = 3.8443*sqti(i)*log(1.0 + func(du21,dbetc1) &amp;<a name='720'>
              + func(du22,dbetc1) + func(du23,dbetc2)) &amp;<a name='721'>
              *tw(i,4)*tcfc3*tcfc6*abplnk1(1,i,k2)<a name='722'>
<font color=#447700>!<a name='723'></font>
<font color=#447700>! total trace gas absorptivity<a name='724'></font>
<font color=#447700>!<a name='725'></font>
      abstrc(i) = acfc1 + acfc2 + acfc3 + acfc4 + acfc5 + acfc6 + &amp;<a name='726'>
                  acfc7 + acfc8 + an2o1 + an2o2 + an2o3 + ach4 + &amp;<a name='727'>
                  aco21 + aco22<a name='728'>
   end do<a name='729'>
<font color=#447700>!<a name='730'></font>
   return<a name='731'>
<font color=#447700>!<a name='732'></font>
end subroutine trcab<a name='733'>
<a name='734'>
<a name='735'>
<a name='736'>
<A NAME='TRCABN'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCABN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='737'>
<font color=#993300>subroutine </font><font color=#cc0000>trcabn</font>(lchnk   ,ncol    ,pcols, pverp,               &amp; <A href='../../call_to/TRCABN.html' TARGET='index'>1</A><a name='738'>
                  k2      ,kn      ,ucfc11  ,ucfc12  ,un2o0   , &amp;<a name='739'>
                  un2o1   ,uch4    ,uco211  ,uco212  ,uco213  , &amp;<a name='740'>
                  uco221  ,uco222  ,uco223  ,tbar    ,bplnk   , &amp;<a name='741'>
                  winpl   ,pinpl   ,tco2    ,th2o    ,to3     , &amp;<a name='742'>
                  uptype  ,dw      ,s2c     ,up2     ,pnew    , &amp;<a name='743'>
                  abstrc  ,uinpl   , &amp;<a name='744'>
                  aer_trn_ngh)<a name='745'>
<font color=#447700>!----------------------------------------------------------------------- <a name='746'></font>
<font color=#447700>! <a name='747'></font>
<font color=#447700>! Purpose: <a name='748'></font>
<font color=#447700>! Calculate nearest layer absorptivity due to CH4, N2O, CFC11 and CFC12<a name='749'></font>
<font color=#447700>! <a name='750'></font>
<font color=#447700>! Method: <a name='751'></font>
<font color=#447700>! Equations in CCM3 description<a name='752'></font>
<font color=#447700>! <a name='753'></font>
<font color=#447700>! Author: J. Kiehl<a name='754'></font>
<font color=#447700>! <a name='755'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='756'></font>
<font color=#447700>!<a name='757'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='758'></font>
<font color=#447700>!  use ppgrid<a name='759'></font>
<font color=#447700>!  use volcrad<a name='760'></font>
<a name='761'>
   implicit none<a name='762'>
 <a name='763'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='764'></font>
<font color=#447700>!<a name='765'></font>
<font color=#447700>! Input arguments<a name='766'></font>
<font color=#447700>!<a name='767'></font>
   integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='768'></font>
   integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='769'></font>
   integer, intent(in) :: pcols, pverp<a name='770'>
   integer, intent(in) :: k2                    <font color=#447700>! level index<a name='771'></font>
   integer, intent(in) :: kn                    <font color=#447700>! level index<a name='772'></font>
<font color=#447700>!<a name='773'></font>
   real(r8), intent(in) :: tbar(pcols,4)        <font color=#447700>! pressure weighted temperature<a name='774'></font>
   real(r8), intent(in) :: ucfc11(pcols,pverp)  <font color=#447700>! CFC11 path length<a name='775'></font>
   real(r8), intent(in) :: ucfc12(pcols,pverp)  <font color=#447700>! CFC12 path length<a name='776'></font>
   real(r8), intent(in) :: un2o0(pcols,pverp)   <font color=#447700>! N2O path length<a name='777'></font>
   real(r8), intent(in) :: un2o1(pcols,pverp)   <font color=#447700>! N2O path length (hot band)<a name='778'></font>
<font color=#447700>!<a name='779'></font>
   real(r8), intent(in) :: uch4(pcols,pverp)    <font color=#447700>! CH4 path length<a name='780'></font>
   real(r8), intent(in) :: uco211(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='781'></font>
   real(r8), intent(in) :: uco212(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='782'></font>
   real(r8), intent(in) :: uco213(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='783'></font>
   real(r8), intent(in) :: uco221(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='784'></font>
<font color=#447700>!<a name='785'></font>
   real(r8), intent(in) :: uco222(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='786'></font>
   real(r8), intent(in) :: uco223(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='787'></font>
   real(r8), intent(in) :: bplnk(14,pcols,4)    <font color=#447700>! weighted Planck fnc. for absorptivity<a name='788'></font>
   real(r8), intent(in) :: winpl(pcols,4)       <font color=#447700>! fractional path length<a name='789'></font>
   real(r8), intent(in) :: pinpl(pcols,4)       <font color=#447700>! pressure factor for subdivided layer<a name='790'></font>
<font color=#447700>!<a name='791'></font>
   real(r8), intent(in) :: tco2(pcols)          <font color=#447700>! co2 transmission<a name='792'></font>
   real(r8), intent(in) :: th2o(pcols)          <font color=#447700>! h2o transmission<a name='793'></font>
   real(r8), intent(in) :: to3(pcols)           <font color=#447700>! o3 transmission<a name='794'></font>
   real(r8), intent(in) :: dw(pcols)            <font color=#447700>! h2o path length<a name='795'></font>
   real(r8), intent(in) :: pnew(pcols)          <font color=#447700>! pressure factor<a name='796'></font>
<font color=#447700>!<a name='797'></font>
   real(r8), intent(in) :: s2c(pcols,pverp)     <font color=#447700>! h2o continuum factor<a name='798'></font>
   real(r8), intent(in) :: uptype(pcols,pverp)  <font color=#447700>! p-type path length<a name='799'></font>
   real(r8), intent(in) :: up2(pcols)           <font color=#447700>! p squared path length<a name='800'></font>
   real(r8), intent(in) :: uinpl(pcols,4)       <font color=#447700>! Nearest layer subdivision factor<a name='801'></font>
   real(r8), intent(in) :: aer_trn_ngh(pcols,bnd_nbr_LW) <a name='802'>
                             <font color=#447700>! [fraction] Total transmission between <a name='803'></font>
                             <font color=#447700>!            nearest neighbor sub-levels<a name='804'></font>
<font color=#447700>!<a name='805'></font>
<font color=#447700>!  Output Arguments<a name='806'></font>
<font color=#447700>!<a name='807'></font>
   real(r8), intent(out) :: abstrc(pcols)        <font color=#447700>! total trace gas absorptivity<a name='808'></font>
<a name='809'>
<font color=#447700>!<a name='810'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='811'></font>
<font color=#447700>!<a name='812'></font>
   integer i,l                   <font color=#447700>! loop counters<a name='813'></font>
<font color=#447700>!<a name='814'></font>
   real(r8) sqti(pcols)          <font color=#447700>! square root of mean temp<a name='815'></font>
   real(r8) rsqti(pcols)         <font color=#447700>! reciprocal of sqti<a name='816'></font>
   real(r8) du1                  <font color=#447700>! cfc11 path length<a name='817'></font>
   real(r8) du2                  <font color=#447700>! cfc12 path length<a name='818'></font>
   real(r8) acfc1                <font color=#447700>! absorptivity of cfc11 798 cm-1 band<a name='819'></font>
<font color=#447700>!<a name='820'></font>
   real(r8) acfc2                <font color=#447700>! absorptivity of cfc11 846 cm-1 band<a name='821'></font>
   real(r8) acfc3                <font color=#447700>! absorptivity of cfc11 933 cm-1 band<a name='822'></font>
   real(r8) acfc4                <font color=#447700>! absorptivity of cfc11 1085 cm-1 band<a name='823'></font>
   real(r8) acfc5                <font color=#447700>! absorptivity of cfc11 889 cm-1 band<a name='824'></font>
   real(r8) acfc6                <font color=#447700>! absorptivity of cfc11 923 cm-1 band<a name='825'></font>
<font color=#447700>!<a name='826'></font>
   real(r8) acfc7                <font color=#447700>! absorptivity of cfc11 1102 cm-1 band<a name='827'></font>
   real(r8) acfc8                <font color=#447700>! absorptivity of cfc11 1161 cm-1 band<a name='828'></font>
   real(r8) du01                 <font color=#447700>! n2o path length<a name='829'></font>
   real(r8) dbeta01              <font color=#447700>! n2o pressure factors<a name='830'></font>
   real(r8) dbeta11              <font color=#447700>!        "<a name='831'></font>
<font color=#447700>!<a name='832'></font>
   real(r8)  an2o1               <font color=#447700>! absorptivity of the 1285 cm-1 n2o band<a name='833'></font>
   real(r8) du02                 <font color=#447700>! n2o path length<a name='834'></font>
   real(r8) dbeta02              <font color=#447700>! n2o pressure factor<a name='835'></font>
   real(r8) an2o2                <font color=#447700>! absorptivity of the 589 cm-1 n2o band<a name='836'></font>
   real(r8) du03                 <font color=#447700>! n2o path length<a name='837'></font>
<font color=#447700>!<a name='838'></font>
   real(r8) dbeta03              <font color=#447700>! n2o pressure factor<a name='839'></font>
   real(r8) an2o3                <font color=#447700>! absorptivity of the 1168 cm-1 n2o band<a name='840'></font>
   real(r8) duch4                <font color=#447700>! ch4 path length<a name='841'></font>
   real(r8) dbetac               <font color=#447700>! ch4 pressure factor<a name='842'></font>
   real(r8) ach4                 <font color=#447700>! absorptivity of the 1306 cm-1 ch4 band<a name='843'></font>
<font color=#447700>!<a name='844'></font>
   real(r8) du11                 <font color=#447700>! co2 path length<a name='845'></font>
   real(r8) du12                 <font color=#447700>!       "<a name='846'></font>
   real(r8) du13                 <font color=#447700>!       "<a name='847'></font>
   real(r8) dbetc1               <font color=#447700>! co2 pressure factor<a name='848'></font>
   real(r8) dbetc2               <font color=#447700>! co2 pressure factor<a name='849'></font>
<font color=#447700>!<a name='850'></font>
   real(r8) aco21                <font color=#447700>! absorptivity of the 1064 cm-1 co2 band<a name='851'></font>
   real(r8) du21                 <font color=#447700>! co2 path length<a name='852'></font>
   real(r8) du22                 <font color=#447700>!       "<a name='853'></font>
   real(r8) du23                 <font color=#447700>!       "<a name='854'></font>
   real(r8) aco22                <font color=#447700>! absorptivity of the 961 cm-1 co2 band<a name='855'></font>
<font color=#447700>!<a name='856'></font>
   real(r8) tt(pcols)            <font color=#447700>! temp. factor for h2o overlap<a name='857'></font>
   real(r8) psi1                 <font color=#447700>!          "<a name='858'></font>
   real(r8) phi1                 <font color=#447700>!          "<a name='859'></font>
   real(r8) p1                   <font color=#447700>! factor for h2o overlap<a name='860'></font>
   real(r8) w1                   <font color=#447700>!          "<a name='861'></font>
<font color=#447700>!<a name='862'></font>
   real(r8) ds2c(pcols)          <font color=#447700>! continuum path length<a name='863'></font>
   real(r8) duptyp(pcols)        <font color=#447700>! p-type path length<a name='864'></font>
   real(r8) tw(pcols,6)          <font color=#447700>! h2o transmission overlap<a name='865'></font>
   real(r8) g1(6)                <font color=#447700>! h2o overlap factor<a name='866'></font>
   real(r8) g2(6)                <font color=#447700>!         "<a name='867'></font>
<font color=#447700>!<a name='868'></font>
   real(r8) g3(6)                <font color=#447700>!         "<a name='869'></font>
   real(r8) g4(6)                <font color=#447700>!         "<a name='870'></font>
   real(r8) ab(6)                <font color=#447700>! h2o temp. factor<a name='871'></font>
   real(r8) bb(6)                <font color=#447700>!         "<a name='872'></font>
   real(r8) abp(6)               <font color=#447700>!         "<a name='873'></font>
<font color=#447700>!<a name='874'></font>
   real(r8) bbp(6)               <font color=#447700>!         "<a name='875'></font>
   real(r8) tcfc3                <font color=#447700>! transmission of cfc11 band<a name='876'></font>
   real(r8) tcfc4                <font color=#447700>! transmission of cfc11 band<a name='877'></font>
   real(r8) tcfc6                <font color=#447700>! transmission of cfc12 band<a name='878'></font>
   real(r8) tcfc7                <font color=#447700>!         "<a name='879'></font>
<font color=#447700>!<a name='880'></font>
   real(r8) tcfc8                <font color=#447700>!         "<a name='881'></font>
   real(r8) tlw                  <font color=#447700>! h2o transmission<a name='882'></font>
   real(r8) tch4                 <font color=#447700>! ch4 transmission<a name='883'></font>
<font color=#447700>!<a name='884'></font>
<font color=#447700>!--------------------------Data Statements------------------------------<a name='885'></font>
<font color=#447700>!<a name='886'></font>
   data g1 /0.0468556,0.0397454,0.0407664,0.0304380,0.0540398,0.0321962/<a name='887'>
   data g2 /14.4832,4.30242,5.23523,3.25342,0.698935,16.5599/<a name='888'>
   data g3 /26.1898,18.4476,15.3633,12.1927,9.14992,8.07092/<a name='889'>
   data g4 /0.0261782,0.0369516,0.0307266,0.0243854,0.0182932,0.0161418/<a name='890'>
   data ab /3.0857e-2,2.3524e-2,1.7310e-2,2.6661e-2,2.8074e-2,2.2915e-2/<a name='891'>
   data bb /-1.3512e-4,-6.8320e-5,-3.2609e-5,-1.0228e-5,-9.5743e-5,-1.0304e-4/<a name='892'>
   data abp/2.9129e-2,2.4101e-2,1.9821e-2,2.6904e-2,2.9458e-2,1.9892e-2/<a name='893'>
   data bbp/-1.3139e-4,-5.5688e-5,-4.6380e-5,-8.0362e-5,-1.0115e-4,-8.8061e-5/<a name='894'>
<font color=#447700>!<a name='895'></font>
<font color=#447700>!--------------------------Statement Functions--------------------------<a name='896'></font>
<font color=#447700>!<a name='897'></font>
   real(r8) func, u, b<a name='898'>
   func(u,b) = u/sqrt(4.0 + u*(1.0 + 1.0 / b))<a name='899'>
<font color=#447700>!<a name='900'></font>
<font color=#447700>!------------------------------------------------------------------<a name='901'></font>
<font color=#447700>!<a name='902'></font>
   do i = 1,ncol<a name='903'>
      sqti(i) = sqrt(tbar(i,kn))<a name='904'>
      rsqti(i) = 1. / sqti(i)<a name='905'>
<font color=#447700>!<a name='906'></font>
<font color=#447700>! h2o transmission<a name='907'></font>
<font color=#447700>!<a name='908'></font>
      tt(i) = abs(tbar(i,kn) - 250.0)<a name='909'>
      ds2c(i) = abs(s2c(i,k2+1) - s2c(i,k2))*uinpl(i,kn)<a name='910'>
      duptyp(i) = abs(uptype(i,k2+1) - uptype(i,k2))*uinpl(i,kn)<a name='911'>
   end do<a name='912'>
<font color=#447700>!<a name='913'></font>
   do l = 1,6<a name='914'>
      do i = 1,ncol<a name='915'>
         psi1 = exp(abp(l)*tt(i)+bbp(l)*tt(i)*tt(i))<a name='916'>
         phi1 = exp(ab(l)*tt(i)+bb(l)*tt(i)*tt(i))<a name='917'>
         p1 = pnew(i) * (psi1/phi1) / sslp<a name='918'>
         w1 = dw(i) * winpl(i,kn) * phi1<a name='919'>
         tw(i,l) = exp(- g1(l)*p1*(sqrt(1.0+g2(l)*(w1/p1))-1.0) &amp;<a name='920'>
                   - g3(l)*ds2c(i)-g4(l)*duptyp(i))<a name='921'>
      end do<a name='922'>
   end do<a name='923'>
<font color=#447700>!<a name='924'></font>
   do i=1,ncol<a name='925'>
      tw(i,1)=tw(i,1)*(0.7*aer_trn_ngh(i,idx_LW_0650_0800)+&amp;<font color=#447700>! l=1: 0750--0820 cm-1<a name='926'></font>
                       0.3*aer_trn_ngh(i,idx_LW_0800_1000))<a name='927'>
      tw(i,2)=tw(i,2)*aer_trn_ngh(i,idx_LW_0800_1000) <font color=#447700>! l=2: 0820--0880 cm-1<a name='928'></font>
      tw(i,3)=tw(i,3)*aer_trn_ngh(i,idx_LW_0800_1000) <font color=#447700>! l=3: 0880--0900 cm-1<a name='929'></font>
      tw(i,4)=tw(i,4)*aer_trn_ngh(i,idx_LW_0800_1000) <font color=#447700>! l=4: 0900--1000 cm-1<a name='930'></font>
      tw(i,5)=tw(i,5)*aer_trn_ngh(i,idx_LW_1000_1200) <font color=#447700>! l=5: 1000--1120 cm-1<a name='931'></font>
      tw(i,6)=tw(i,6)*aer_trn_ngh(i,idx_LW_1000_1200) <font color=#447700>! l=6: 1120--1170 cm-1<a name='932'></font>
   end do                    <font color=#447700>! end loop over lon<a name='933'></font>
<a name='934'>
   do i = 1,ncol<a name='935'>
<font color=#447700>!<a name='936'></font>
      du1 = abs(ucfc11(i,k2+1) - ucfc11(i,k2)) * winpl(i,kn)<a name='937'>
      du2 = abs(ucfc12(i,k2+1) - ucfc12(i,k2)) * winpl(i,kn)<a name='938'>
<font color=#447700>!<a name='939'></font>
<font color=#447700>! cfc transmissions<a name='940'></font>
<font color=#447700>!<a name='941'></font>
      tcfc3 = exp(-175.005*du1)<a name='942'>
      tcfc4 = exp(-1202.18*du1)<a name='943'>
      tcfc6 = exp(-5786.73*du2)<a name='944'>
      tcfc7 = exp(-2873.51*du2)<a name='945'>
      tcfc8 = exp(-2085.59*du2)<a name='946'>
<font color=#447700>!<a name='947'></font>
<font color=#447700>! Absorptivity for CFC11 bands<a name='948'></font>
<font color=#447700>!<a name='949'></font>
      acfc1 = 50.0*(1.0 - exp(-54.09*du1)) * tw(i,1)*bplnk(7,i,kn)<a name='950'>
      acfc2 = 60.0*(1.0 - exp(-5130.03*du1))*tw(i,2)*bplnk(8,i,kn)<a name='951'>
      acfc3 = 60.0*(1.0 - tcfc3)*tw(i,4)*tcfc6 * bplnk(9,i,kn)<a name='952'>
      acfc4 = 100.0*(1.0 - tcfc4)* tw(i,5) * bplnk(10,i,kn)<a name='953'>
<font color=#447700>!<a name='954'></font>
<font color=#447700>! Absorptivity for CFC12 bands<a name='955'></font>
<font color=#447700>!<a name='956'></font>
      acfc5 = 45.0*(1.0 - exp(-1272.35*du2))*tw(i,3)*bplnk(11,i,kn)<a name='957'>
      acfc6 = 50.0*(1.0 - tcfc6)*tw(i,4)*bplnk(12,i,kn)<a name='958'>
      acfc7 = 80.0*(1.0 - tcfc7)* tw(i,5)*tcfc4 *bplnk(13,i,kn)<a name='959'>
      acfc8 = 70.0*(1.0 - tcfc8)*tw(i,6)*bplnk(14,i,kn)<a name='960'>
<font color=#447700>!<a name='961'></font>
<font color=#447700>! Absorptivity for CH4 band 1306 cm-1<a name='962'></font>
<font color=#447700>!<a name='963'></font>
      tlw = exp(-1.0*sqrt(up2(i)))<a name='964'>
      tlw=tlw*aer_trn_ngh(i,idx_LW_1200_2000)<a name='965'>
      duch4 = abs(uch4(i,k2+1) - uch4(i,k2)) * winpl(i,kn)<a name='966'>
      dbetac = 2.94449 * pinpl(i,kn) * rsqti(i) / sslp<a name='967'>
      ach4 = 6.00444*sqti(i)*log(1.0 + func(duch4,dbetac)) * tlw * bplnk(3,i,kn)<a name='968'>
      tch4 = 1.0/(1.0 + 0.02*func(duch4,dbetac))<a name='969'>
<font color=#447700>!<a name='970'></font>
<font color=#447700>! Absorptivity for N2O bands<a name='971'></font>
<font color=#447700>!<a name='972'></font>
      du01 = abs(un2o0(i,k2+1) - un2o0(i,k2)) * winpl(i,kn)<a name='973'>
      du11 = abs(un2o1(i,k2+1) - un2o1(i,k2)) * winpl(i,kn)<a name='974'>
      dbeta01 = 19.399 *  pinpl(i,kn) * rsqti(i) / sslp<a name='975'>
      dbeta11 = dbeta01<a name='976'>
<font color=#447700>!<a name='977'></font>
<font color=#447700>! 1285 cm-1 band<a name='978'></font>
<font color=#447700>!<a name='979'></font>
      an2o1 = 2.35558*sqti(i)*log(1.0 + func(du01,dbeta01) &amp;<a name='980'>
              + func(du11,dbeta11)) * tlw * tch4 * bplnk(4,i,kn)<a name='981'>
      du02 = 0.100090*du01<a name='982'>
      du12 = 0.0992746*du11<a name='983'>
      dbeta02 = 0.964282*dbeta01<a name='984'>
<font color=#447700>!<a name='985'></font>
<font color=#447700>! 589 cm-1 band<a name='986'></font>
<font color=#447700>!<a name='987'></font>
      an2o2 = 2.65581*sqti(i)*log(1.0 + func(du02,dbeta02) &amp;<a name='988'>
              +  func(du12,dbeta02)) * tco2(i) * th2o(i) * bplnk(5,i,kn)<a name='989'>
      du03 = 0.0333767*du01<a name='990'>
      dbeta03 = 0.982143*dbeta01<a name='991'>
<font color=#447700>!<a name='992'></font>
<font color=#447700>! 1168 cm-1 band<a name='993'></font>
<font color=#447700>!<a name='994'></font>
      an2o3 = 2.54034*sqti(i)*log(1.0 + func(du03,dbeta03)) * &amp;<a name='995'>
              tw(i,6) * tcfc8 * bplnk(6,i,kn)<a name='996'>
<font color=#447700>!<a name='997'></font>
<font color=#447700>! Absorptivity for 1064 cm-1 band of CO2<a name='998'></font>
<font color=#447700>!<a name='999'></font>
      du11 = abs(uco211(i,k2+1) - uco211(i,k2)) * winpl(i,kn)<a name='1000'>
      du12 = abs(uco212(i,k2+1) - uco212(i,k2)) * winpl(i,kn)<a name='1001'>
      du13 = abs(uco213(i,k2+1) - uco213(i,k2)) * winpl(i,kn)<a name='1002'>
      dbetc1 = 2.97558 * pinpl(i,kn) * rsqti(i) / sslp<a name='1003'>
      dbetc2 = 2.0 * dbetc1<a name='1004'>
      aco21 = 3.7571*sqti(i)*log(1.0 + func(du11,dbetc1) &amp;<a name='1005'>
              + func(du12,dbetc2) + func(du13,dbetc2)) &amp;<a name='1006'>
              * to3(i) * tw(i,5) * tcfc4 * tcfc7 * bplnk(2,i,kn)<a name='1007'>
<font color=#447700>!<a name='1008'></font>
<font color=#447700>! Absorptivity for 961 cm-1 band of co2<a name='1009'></font>
<font color=#447700>!<a name='1010'></font>
      du21 = abs(uco221(i,k2+1) - uco221(i,k2)) * winpl(i,kn)<a name='1011'>
      du22 = abs(uco222(i,k2+1) - uco222(i,k2)) * winpl(i,kn)<a name='1012'>
      du23 = abs(uco223(i,k2+1) - uco223(i,k2)) * winpl(i,kn)<a name='1013'>
      aco22 = 3.8443*sqti(i)*log(1.0 + func(du21,dbetc1) &amp;<a name='1014'>
              + func(du22,dbetc1) + func(du23,dbetc2)) &amp;<a name='1015'>
              * tw(i,4) * tcfc3 * tcfc6 * bplnk(1,i,kn)<a name='1016'>
<font color=#447700>!<a name='1017'></font>
<font color=#447700>! total trace gas absorptivity<a name='1018'></font>
<font color=#447700>!<a name='1019'></font>
      abstrc(i) = acfc1 + acfc2 + acfc3 + acfc4 + acfc5 + acfc6 + &amp;<a name='1020'>
                  acfc7 + acfc8 + an2o1 + an2o2 + an2o3 + ach4 + &amp;<a name='1021'>
                  aco21 + aco22<a name='1022'>
   end do<a name='1023'>
<font color=#447700>!<a name='1024'></font>
   return<a name='1025'>
<font color=#447700>!<a name='1026'></font>
end subroutine trcabn<a name='1027'>
<a name='1028'>
<a name='1029'>
<a name='1030'>
<A NAME='TRCEMS'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCEMS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1031'>
<font color=#993300>subroutine </font><font color=#cc0000>trcems</font>(lchnk   ,ncol    ,pcols, pverp,               &amp; <A href='../../call_to/TRCEMS.html' TARGET='index'>1</A><a name='1032'>
                  k       ,co2t    ,pnm     ,ucfc11  ,ucfc12  , &amp;<a name='1033'>
                  un2o0   ,un2o1   ,bn2o0   ,bn2o1   ,uch4    , &amp;<a name='1034'>
                  bch4    ,uco211  ,uco212  ,uco213  ,uco221  , &amp;<a name='1035'>
                  uco222  ,uco223  ,uptype  ,w       ,s2c     , &amp;<a name='1036'>
                  up2     ,emplnk  ,th2o    ,tco2    ,to3     , &amp;<a name='1037'>
                  emstrc  , &amp;<a name='1038'>
                 aer_trn_ttl)<a name='1039'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1040'></font>
<font color=#447700>! <a name='1041'></font>
<font color=#447700>! Purpose: <a name='1042'></font>
<font color=#447700>!  Calculate emissivity for CH4, N2O, CFC11 and CFC12 bands.<a name='1043'></font>
<font color=#447700>! <a name='1044'></font>
<font color=#447700>! Method: <a name='1045'></font>
<font color=#447700>!  See CCM3 Description for equations.<a name='1046'></font>
<font color=#447700>! <a name='1047'></font>
<font color=#447700>! Author: J. Kiehl<a name='1048'></font>
<font color=#447700>! <a name='1049'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1050'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1051'></font>
<font color=#447700>!  use ppgrid<a name='1052'></font>
<font color=#447700>!  use volcrad<a name='1053'></font>
<a name='1054'>
   implicit none<a name='1055'>
<a name='1056'>
<font color=#447700>!<a name='1057'></font>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1058'></font>
<font color=#447700>!<a name='1059'></font>
<font color=#447700>! Input arguments<a name='1060'></font>
<font color=#447700>!<a name='1061'></font>
   integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='1062'></font>
   integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='1063'></font>
   integer, intent(in) :: pcols, pverp<a name='1064'>
<a name='1065'>
   real(r8), intent(in) :: co2t(pcols,pverp)    <font color=#447700>! pressure weighted temperature<a name='1066'></font>
   real(r8), intent(in) :: pnm(pcols,pverp)     <font color=#447700>! interface pressure<a name='1067'></font>
   real(r8), intent(in) :: ucfc11(pcols,pverp)  <font color=#447700>! CFC11 path length<a name='1068'></font>
   real(r8), intent(in) :: ucfc12(pcols,pverp)  <font color=#447700>! CFC12 path length<a name='1069'></font>
   real(r8), intent(in) :: un2o0(pcols,pverp)   <font color=#447700>! N2O path length<a name='1070'></font>
<font color=#447700>!<a name='1071'></font>
   real(r8), intent(in) :: un2o1(pcols,pverp)   <font color=#447700>! N2O path length (hot band)<a name='1072'></font>
   real(r8), intent(in) :: uch4(pcols,pverp)    <font color=#447700>! CH4 path length<a name='1073'></font>
   real(r8), intent(in) :: uco211(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1074'></font>
   real(r8), intent(in) :: uco212(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1075'></font>
   real(r8), intent(in) :: uco213(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1076'></font>
<font color=#447700>!<a name='1077'></font>
   real(r8), intent(in) :: uco221(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1078'></font>
   real(r8), intent(in) :: uco222(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1079'></font>
   real(r8), intent(in) :: uco223(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1080'></font>
   real(r8), intent(in) :: uptype(pcols,pverp)  <font color=#447700>! continuum path length<a name='1081'></font>
   real(r8), intent(in) :: bn2o0(pcols,pverp)   <font color=#447700>! pressure factor for n2o<a name='1082'></font>
<font color=#447700>!<a name='1083'></font>
   real(r8), intent(in) :: bn2o1(pcols,pverp)   <font color=#447700>! pressure factor for n2o<a name='1084'></font>
   real(r8), intent(in) :: bch4(pcols,pverp)    <font color=#447700>! pressure factor for ch4<a name='1085'></font>
   real(r8), intent(in) :: emplnk(14,pcols)     <font color=#447700>! emissivity Planck factor<a name='1086'></font>
   real(r8), intent(in) :: th2o(pcols)          <font color=#447700>! water vapor overlap factor<a name='1087'></font>
   real(r8), intent(in) :: tco2(pcols)          <font color=#447700>! co2 overlap factor<a name='1088'></font>
<font color=#447700>!<a name='1089'></font>
   real(r8), intent(in) :: to3(pcols)           <font color=#447700>! o3 overlap factor<a name='1090'></font>
   real(r8), intent(in) :: s2c(pcols,pverp)     <font color=#447700>! h2o continuum path length<a name='1091'></font>
   real(r8), intent(in) :: w(pcols,pverp)       <font color=#447700>! h2o path length<a name='1092'></font>
   real(r8), intent(in) :: up2(pcols)           <font color=#447700>! pressure squared h2o path length<a name='1093'></font>
<font color=#447700>!<a name='1094'></font>
   integer, intent(in) :: k                 <font color=#447700>! level index<a name='1095'></font>
<a name='1096'>
   real(r8), intent(in) :: aer_trn_ttl(pcols,pverp,pverp,bnd_nbr_LW) <font color=#447700>! aer trn.<a name='1097'></font>
<a name='1098'>
<font color=#447700>!<a name='1099'></font>
<font color=#447700>!  Output Arguments<a name='1100'></font>
<font color=#447700>!<a name='1101'></font>
   real(r8), intent(out) :: emstrc(pcols,pverp)  <font color=#447700>! total trace gas emissivity<a name='1102'></font>
<a name='1103'>
<font color=#447700>!<a name='1104'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='1105'></font>
<font color=#447700>!<a name='1106'></font>
   integer i,l               <font color=#447700>! loop counters<a name='1107'></font>
<font color=#447700>!<a name='1108'></font>
   real(r8) sqti(pcols)          <font color=#447700>! square root of mean temp<a name='1109'></font>
   real(r8) ecfc1                <font color=#447700>! emissivity of cfc11 798 cm-1 band<a name='1110'></font>
   real(r8) ecfc2                <font color=#447700>!     "      "    "   846 cm-1 band<a name='1111'></font>
   real(r8) ecfc3                <font color=#447700>!     "      "    "   933 cm-1 band<a name='1112'></font>
   real(r8) ecfc4                <font color=#447700>!     "      "    "   1085 cm-1 band<a name='1113'></font>
<font color=#447700>!<a name='1114'></font>
   real(r8) ecfc5                <font color=#447700>!     "      "  cfc12 889 cm-1 band<a name='1115'></font>
   real(r8) ecfc6                <font color=#447700>!     "      "    "   923 cm-1 band<a name='1116'></font>
   real(r8) ecfc7                <font color=#447700>!     "      "    "   1102 cm-1 band<a name='1117'></font>
   real(r8) ecfc8                <font color=#447700>!     "      "    "   1161 cm-1 band<a name='1118'></font>
   real(r8) u01                  <font color=#447700>! n2o path length<a name='1119'></font>
<font color=#447700>!<a name='1120'></font>
   real(r8) u11                  <font color=#447700>! n2o path length<a name='1121'></font>
   real(r8) beta01               <font color=#447700>! n2o pressure factor<a name='1122'></font>
   real(r8) beta11               <font color=#447700>! n2o pressure factor<a name='1123'></font>
   real(r8) en2o1                <font color=#447700>! emissivity of the 1285 cm-1 N2O band<a name='1124'></font>
   real(r8) u02                  <font color=#447700>! n2o path length<a name='1125'></font>
<font color=#447700>!<a name='1126'></font>
   real(r8) u12                  <font color=#447700>! n2o path length<a name='1127'></font>
   real(r8) beta02               <font color=#447700>! n2o pressure factor<a name='1128'></font>
   real(r8) en2o2                <font color=#447700>! emissivity of the 589 cm-1 N2O band<a name='1129'></font>
   real(r8) u03                  <font color=#447700>! n2o path length<a name='1130'></font>
   real(r8) beta03               <font color=#447700>! n2o pressure factor<a name='1131'></font>
<font color=#447700>!<a name='1132'></font>
   real(r8) en2o3                <font color=#447700>! emissivity of the 1168 cm-1 N2O band<a name='1133'></font>
   real(r8) betac                <font color=#447700>! ch4 pressure factor<a name='1134'></font>
   real(r8) ech4                 <font color=#447700>! emissivity of 1306 cm-1 CH4 band<a name='1135'></font>
   real(r8) betac1               <font color=#447700>! co2 pressure factor<a name='1136'></font>
   real(r8) betac2               <font color=#447700>! co2 pressure factor<a name='1137'></font>
<font color=#447700>!<a name='1138'></font>
   real(r8) eco21                <font color=#447700>! emissivity of 1064 cm-1 CO2 band<a name='1139'></font>
   real(r8) eco22                <font color=#447700>! emissivity of 961 cm-1 CO2 band<a name='1140'></font>
   real(r8) tt(pcols)            <font color=#447700>! temp. factor for h2o overlap factor<a name='1141'></font>
   real(r8) psi1                 <font color=#447700>! narrow band h2o temp. factor<a name='1142'></font>
   real(r8) phi1                 <font color=#447700>!             "<a name='1143'></font>
<font color=#447700>!<a name='1144'></font>
   real(r8) p1                   <font color=#447700>! h2o line overlap factor<a name='1145'></font>
   real(r8) w1                   <font color=#447700>!          "<a name='1146'></font>
   real(r8) tw(pcols,6)          <font color=#447700>! h2o transmission overlap<a name='1147'></font>
   real(r8) g1(6)                <font color=#447700>! h2o overlap factor<a name='1148'></font>
   real(r8) g2(6)                <font color=#447700>!          "<a name='1149'></font>
<font color=#447700>!<a name='1150'></font>
   real(r8) g3(6)                <font color=#447700>!          "<a name='1151'></font>
   real(r8) g4(6)                <font color=#447700>!          "<a name='1152'></font>
   real(r8) ab(6)                <font color=#447700>!          "<a name='1153'></font>
   real(r8) bb(6)                <font color=#447700>!          "<a name='1154'></font>
   real(r8) abp(6)               <font color=#447700>!          "<a name='1155'></font>
<font color=#447700>!<a name='1156'></font>
   real(r8) bbp(6)               <font color=#447700>!          "<a name='1157'></font>
   real(r8) tcfc3                <font color=#447700>! transmission for cfc11 band<a name='1158'></font>
   real(r8) tcfc4                <font color=#447700>!          "<a name='1159'></font>
   real(r8) tcfc6                <font color=#447700>! transmission for cfc12 band<a name='1160'></font>
   real(r8) tcfc7                <font color=#447700>!          "<a name='1161'></font>
<font color=#447700>!<a name='1162'></font>
   real(r8) tcfc8                <font color=#447700>!          "<a name='1163'></font>
   real(r8) tlw                  <font color=#447700>! h2o overlap factor<a name='1164'></font>
   real(r8) tch4                 <font color=#447700>! ch4 overlap factor<a name='1165'></font>
<font color=#447700>!<a name='1166'></font>
<font color=#447700>!--------------------------Data Statements------------------------------<a name='1167'></font>
<font color=#447700>!<a name='1168'></font>
   data g1 /0.0468556,0.0397454,0.0407664,0.0304380,0.0540398,0.0321962/<a name='1169'>
   data g2 /14.4832,4.30242,5.23523,3.25342,0.698935,16.5599/<a name='1170'>
   data g3 /26.1898,18.4476,15.3633,12.1927,9.14992,8.07092/<a name='1171'>
   data g4 /0.0261782,0.0369516,0.0307266,0.0243854,0.0182932,0.0161418/<a name='1172'>
   data ab /3.0857e-2,2.3524e-2,1.7310e-2,2.6661e-2,2.8074e-2,2.2915e-2/<a name='1173'>
   data bb /-1.3512e-4,-6.8320e-5,-3.2609e-5,-1.0228e-5,-9.5743e-5,-1.0304e-4/<a name='1174'>
   data abp/2.9129e-2,2.4101e-2,1.9821e-2,2.6904e-2,2.9458e-2,1.9892e-2/<a name='1175'>
   data bbp/-1.3139e-4,-5.5688e-5,-4.6380e-5,-8.0362e-5,-1.0115e-4,-8.8061e-5/<a name='1176'>
<font color=#447700>!<a name='1177'></font>
<font color=#447700>!--------------------------Statement Functions--------------------------<a name='1178'></font>
<font color=#447700>!<a name='1179'></font>
   real(r8) func, u, b<a name='1180'>
   func(u,b) = u/sqrt(4.0 + u*(1.0 + 1.0 / b))<a name='1181'>
<font color=#447700>!<a name='1182'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1183'></font>
<font color=#447700>!<a name='1184'></font>
   do i = 1,ncol<a name='1185'>
      sqti(i) = sqrt(co2t(i,k))<a name='1186'>
<font color=#447700>!<a name='1187'></font>
<font color=#447700>! Transmission for h2o<a name='1188'></font>
<font color=#447700>!<a name='1189'></font>
      tt(i) = abs(co2t(i,k) - 250.0)<a name='1190'>
   end do<a name='1191'>
<font color=#447700>!<a name='1192'></font>
   do l = 1,6<a name='1193'>
      do i = 1,ncol<a name='1194'>
         psi1 = exp(abp(l)*tt(i)+bbp(l)*tt(i)*tt(i))<a name='1195'>
         phi1 = exp(ab(l)*tt(i)+bb(l)*tt(i)*tt(i))<a name='1196'>
         p1 = pnm(i,k) * (psi1/phi1) / sslp<a name='1197'>
         w1 = w(i,k) * phi1<a name='1198'>
         tw(i,l) = exp(- g1(l)*p1*(sqrt(1.0+g2(l)*(w1/p1))-1.0) &amp;<a name='1199'>
                   - g3(l)*s2c(i,k)-g4(l)*uptype(i,k))<a name='1200'>
      end do<a name='1201'>
   end do<a name='1202'>
<a name='1203'>
<font color=#447700>!     Overlap H2O tranmission with STRAER continuum in 6 trace gas <a name='1204'></font>
<font color=#447700>!                 subbands<a name='1205'></font>
<a name='1206'>
      do i=1,ncol<a name='1207'>
         tw(i,1)=tw(i,1)*(0.7*aer_trn_ttl(i,k,1,idx_LW_0650_0800)+&amp;<font color=#447700>! l=1: 0750--0820 cm-1<a name='1208'></font>
                          0.3*aer_trn_ttl(i,k,1,idx_LW_0800_1000))<a name='1209'>
         tw(i,2)=tw(i,2)*aer_trn_ttl(i,k,1,idx_LW_0800_1000) <font color=#447700>! l=2: 0820--0880 cm-1<a name='1210'></font>
         tw(i,3)=tw(i,3)*aer_trn_ttl(i,k,1,idx_LW_0800_1000) <font color=#447700>! l=3: 0880--0900 cm-1<a name='1211'></font>
         tw(i,4)=tw(i,4)*aer_trn_ttl(i,k,1,idx_LW_0800_1000) <font color=#447700>! l=4: 0900--1000 cm-1<a name='1212'></font>
         tw(i,5)=tw(i,5)*aer_trn_ttl(i,k,1,idx_LW_1000_1200) <font color=#447700>! l=5: 1000--1120 cm-1<a name='1213'></font>
         tw(i,6)=tw(i,6)*aer_trn_ttl(i,k,1,idx_LW_1000_1200) <font color=#447700>! l=6: 1120--1170 cm-1<a name='1214'></font>
      end do                    <font color=#447700>! end loop over lon<a name='1215'></font>
<font color=#447700>!<a name='1216'></font>
   do i = 1,ncol<a name='1217'>
<font color=#447700>!<a name='1218'></font>
<font color=#447700>! transmission due to cfc bands<a name='1219'></font>
<font color=#447700>!<a name='1220'></font>
      tcfc3 = exp(-175.005*ucfc11(i,k))<a name='1221'>
      tcfc4 = exp(-1202.18*ucfc11(i,k))<a name='1222'>
      tcfc6 = exp(-5786.73*ucfc12(i,k))<a name='1223'>
      tcfc7 = exp(-2873.51*ucfc12(i,k))<a name='1224'>
      tcfc8 = exp(-2085.59*ucfc12(i,k))<a name='1225'>
<font color=#447700>!<a name='1226'></font>
<font color=#447700>! Emissivity for CFC11 bands<a name='1227'></font>
<font color=#447700>!<a name='1228'></font>
      ecfc1 = 50.0*(1.0 - exp(-54.09*ucfc11(i,k))) * tw(i,1) * emplnk(7,i)<a name='1229'>
      ecfc2 = 60.0*(1.0 - exp(-5130.03*ucfc11(i,k)))* tw(i,2) * emplnk(8,i)<a name='1230'>
      ecfc3 = 60.0*(1.0 - tcfc3)*tw(i,4)*tcfc6*emplnk(9,i)<a name='1231'>
      ecfc4 = 100.0*(1.0 - tcfc4)*tw(i,5)*emplnk(10,i)<a name='1232'>
<font color=#447700>!<a name='1233'></font>
<font color=#447700>! Emissivity for CFC12 bands<a name='1234'></font>
<font color=#447700>!<a name='1235'></font>
      ecfc5 = 45.0*(1.0 - exp(-1272.35*ucfc12(i,k)))*tw(i,3)*emplnk(11,i)<a name='1236'>
      ecfc6 = 50.0*(1.0 - tcfc6)*tw(i,4)*emplnk(12,i)<a name='1237'>
      ecfc7 = 80.0*(1.0 - tcfc7)*tw(i,5)* tcfc4 * emplnk(13,i)<a name='1238'>
      ecfc8 = 70.0*(1.0 - tcfc8)*tw(i,6) * emplnk(14,i)<a name='1239'>
<font color=#447700>!<a name='1240'></font>
<font color=#447700>! Emissivity for CH4 band 1306 cm-1<a name='1241'></font>
<font color=#447700>!<a name='1242'></font>
      tlw = exp(-1.0*sqrt(up2(i)))<a name='1243'>
<a name='1244'>
<font color=#447700>!     Overlap H2O vibration rotation band with STRAER continuum <a name='1245'></font>
<font color=#447700>!             for CH4 1306 cm-1 and N2O 1285 cm-1 bands<a name='1246'></font>
<a name='1247'>
            tlw=tlw*aer_trn_ttl(i,k,1,idx_LW_1200_2000)<a name='1248'>
      betac = bch4(i,k)/uch4(i,k)<a name='1249'>
      ech4 = 6.00444*sqti(i)*log(1.0 + func(uch4(i,k),betac)) *tlw * emplnk(3,i)<a name='1250'>
      tch4 = 1.0/(1.0 + 0.02*func(uch4(i,k),betac))<a name='1251'>
<font color=#447700>!<a name='1252'></font>
<font color=#447700>! Emissivity for N2O bands<a name='1253'></font>
<font color=#447700>!<a name='1254'></font>
      u01 = un2o0(i,k)<a name='1255'>
      u11 = un2o1(i,k)<a name='1256'>
      beta01 = bn2o0(i,k)/un2o0(i,k)<a name='1257'>
      beta11 = bn2o1(i,k)/un2o1(i,k)<a name='1258'>
<font color=#447700>!<a name='1259'></font>
<font color=#447700>! 1285 cm-1 band<a name='1260'></font>
<font color=#447700>!<a name='1261'></font>
      en2o1 = 2.35558*sqti(i)*log(1.0 + func(u01,beta01) + &amp;<a name='1262'>
              func(u11,beta11))*tlw*tch4*emplnk(4,i)<a name='1263'>
      u02 = 0.100090*u01<a name='1264'>
      u12 = 0.0992746*u11<a name='1265'>
      beta02 = 0.964282*beta01<a name='1266'>
<font color=#447700>!<a name='1267'></font>
<font color=#447700>! 589 cm-1 band<a name='1268'></font>
<font color=#447700>!<a name='1269'></font>
      en2o2 = 2.65581*sqti(i)*log(1.0 + func(u02,beta02) + &amp;<a name='1270'>
              func(u12,beta02)) * tco2(i) * th2o(i) * emplnk(5,i)<a name='1271'>
      u03 = 0.0333767*u01<a name='1272'>
      beta03 = 0.982143*beta01<a name='1273'>
<font color=#447700>!<a name='1274'></font>
<font color=#447700>! 1168 cm-1 band<a name='1275'></font>
<font color=#447700>!<a name='1276'></font>
      en2o3 = 2.54034*sqti(i)*log(1.0 + func(u03,beta03)) * &amp;<a name='1277'>
              tw(i,6) * tcfc8 * emplnk(6,i)<a name='1278'>
<font color=#447700>!<a name='1279'></font>
<font color=#447700>! Emissivity for 1064 cm-1 band of CO2<a name='1280'></font>
<font color=#447700>!<a name='1281'></font>
      betac1 = 2.97558*pnm(i,k) / (sslp*sqti(i))<a name='1282'>
      betac2 = 2.0 * betac1<a name='1283'>
      eco21 = 3.7571*sqti(i)*log(1.0 + func(uco211(i,k),betac1) &amp;<a name='1284'>
              + func(uco212(i,k),betac2) + func(uco213(i,k),betac2)) &amp;<a name='1285'>
              * to3(i) * tw(i,5) * tcfc4 * tcfc7 * emplnk(2,i)<a name='1286'>
<font color=#447700>!<a name='1287'></font>
<font color=#447700>! Emissivity for 961 cm-1 band<a name='1288'></font>
<font color=#447700>!<a name='1289'></font>
      eco22 = 3.8443*sqti(i)*log(1.0 + func(uco221(i,k),betac1) &amp;<a name='1290'>
              + func(uco222(i,k),betac1) + func(uco223(i,k),betac2)) &amp;<a name='1291'>
              * tw(i,4) * tcfc3 * tcfc6 * emplnk(1,i)<a name='1292'>
<font color=#447700>!<a name='1293'></font>
<font color=#447700>! total trace gas emissivity<a name='1294'></font>
<font color=#447700>!<a name='1295'></font>
      emstrc(i,k) = ecfc1 + ecfc2 + ecfc3 + ecfc4 + ecfc5 +ecfc6 + &amp;<a name='1296'>
                    ecfc7 + ecfc8 + en2o1 + en2o2 + en2o3 + ech4 + &amp;<a name='1297'>
                    eco21 + eco22<a name='1298'>
   end do<a name='1299'>
<font color=#447700>!<a name='1300'></font>
   return<a name='1301'>
<font color=#447700>!<a name='1302'></font>
end subroutine trcems<a name='1303'>
<a name='1304'>
<A NAME='TRCMIX'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCMIX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1305'>
<font color=#993300>subroutine </font><font color=#cc0000>trcmix</font>(lchnk   ,ncol     ,pcols, pver, &amp; <A href='../../call_to/TRCMIX.html' TARGET='index'>1</A><a name='1306'>
                  pmid    ,clat, n2o      ,ch4     ,          &amp;<a name='1307'>
                  cfc11   , cfc12   )<a name='1308'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1309'></font>
<font color=#447700>! <a name='1310'></font>
<font color=#447700>! Purpose: <a name='1311'></font>
<font color=#447700>! Specify zonal mean mass mixing ratios of CH4, N2O, CFC11 and<a name='1312'></font>
<font color=#447700>! CFC12<a name='1313'></font>
<font color=#447700>! <a name='1314'></font>
<font color=#447700>! Method: <a name='1315'></font>
<font color=#447700>! Distributions assume constant mixing ratio in the troposphere<a name='1316'></font>
<font color=#447700>! and a decrease of mixing ratio in the stratosphere. Tropopause<a name='1317'></font>
<font color=#447700>! defined by ptrop. The scale height of the particular trace gas<a name='1318'></font>
<font color=#447700>! depends on latitude. This assumption produces a more realistic<a name='1319'></font>
<font color=#447700>! stratospheric distribution of the various trace gases.<a name='1320'></font>
<font color=#447700>! <a name='1321'></font>
<font color=#447700>! Author: J. Kiehl<a name='1322'></font>
<font color=#447700>! <a name='1323'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1324'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1325'></font>
<font color=#447700>!  use ppgrid<a name='1326'></font>
<font color=#447700>!  use phys_grid,    only: get_rlat_all_p<a name='1327'></font>
<font color=#447700>!  use physconst,    only: mwdry, mwch4, mwn2o, mwf11, mwf12<a name='1328'></font>
<font color=#447700>!  use ghg_surfvals, only: ch4vmr, n2ovmr, f11vmr, f12vmr<a name='1329'></font>
<a name='1330'>
   implicit none<a name='1331'>
<a name='1332'>
<font color=#447700>!-----------------------------Arguments---------------------------------<a name='1333'></font>
<font color=#447700>!<a name='1334'></font>
<font color=#447700>! Input<a name='1335'></font>
<font color=#447700>!<a name='1336'></font>
   integer, intent(in) :: lchnk                    <font color=#447700>! chunk identifier<a name='1337'></font>
   integer, intent(in) :: ncol                     <font color=#447700>! number of atmospheric columns<a name='1338'></font>
   integer, intent(in) :: pcols, pver<a name='1339'>
<a name='1340'>
   real(r8), intent(in) :: pmid(pcols,pver)        <font color=#447700>! model pressures<a name='1341'></font>
   real(r8), intent(in) :: clat(pcols)             <font color=#447700>! latitude in radians for columns<a name='1342'></font>
<font color=#447700>!<a name='1343'></font>
<font color=#447700>! Output<a name='1344'></font>
<font color=#447700>!<a name='1345'></font>
   real(r8), intent(out) :: n2o(pcols,pver)         <font color=#447700>! nitrous oxide mass mixing ratio<a name='1346'></font>
   real(r8), intent(out) :: ch4(pcols,pver)         <font color=#447700>! methane mass mixing ratio<a name='1347'></font>
   real(r8), intent(out) :: cfc11(pcols,pver)       <font color=#447700>! cfc11 mass mixing ratio<a name='1348'></font>
   real(r8), intent(out) :: cfc12(pcols,pver)       <font color=#447700>! cfc12 mass mixing ratio<a name='1349'></font>
<a name='1350'>
<font color=#447700>!<a name='1351'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='1352'></font>
<a name='1353'>
   real(r8) :: rmwn2o       <font color=#447700>! ratio of molecular weight n2o   to dry air<a name='1354'></font>
   real(r8) :: rmwch4       <font color=#447700>! ratio of molecular weight ch4   to dry air<a name='1355'></font>
   real(r8) :: rmwf11       <font color=#447700>! ratio of molecular weight cfc11 to dry air<a name='1356'></font>
   real(r8) :: rmwf12       <font color=#447700>! ratio of molecular weight cfc12 to dry air<a name='1357'></font>
<font color=#447700>!<a name='1358'></font>
   integer i                <font color=#447700>! longitude loop index<a name='1359'></font>
   integer k                <font color=#447700>! level index<a name='1360'></font>
<font color=#447700>!<a name='1361'></font>
<font color=#447700>!  real(r8) clat(pcols)         ! latitude in radians for columns<a name='1362'></font>
   real(r8) coslat(pcols)       <font color=#447700>! cosine of latitude<a name='1363'></font>
   real(r8) dlat                <font color=#447700>! latitude in degrees<a name='1364'></font>
   real(r8) ptrop               <font color=#447700>! pressure level of tropopause<a name='1365'></font>
   real(r8) pratio              <font color=#447700>! pressure divided by ptrop<a name='1366'></font>
<font color=#447700>!<a name='1367'></font>
   real(r8) xn2o                <font color=#447700>! pressure scale height for n2o<a name='1368'></font>
   real(r8) xch4                <font color=#447700>! pressure scale height for ch4<a name='1369'></font>
   real(r8) xcfc11              <font color=#447700>! pressure scale height for cfc11<a name='1370'></font>
   real(r8) xcfc12              <font color=#447700>! pressure scale height for cfc12<a name='1371'></font>
<font color=#447700>!<a name='1372'></font>
   real(r8) ch40                <font color=#447700>! tropospheric mass mixing ratio for ch4<a name='1373'></font>
   real(r8) n2o0                <font color=#447700>! tropospheric mass mixing ratio for n2o<a name='1374'></font>
   real(r8) cfc110              <font color=#447700>! tropospheric mass mixing ratio for cfc11<a name='1375'></font>
   real(r8) cfc120              <font color=#447700>! tropospheric mass mixing ratio for cfc12<a name='1376'></font>
<font color=#447700>!<a name='1377'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1378'></font>
   rmwn2o = mwn2o/mwdry      <font color=#447700>! ratio of molecular weight n2o   to dry air<a name='1379'></font>
   rmwch4 = mwch4/mwdry      <font color=#447700>! ratio of molecular weight ch4   to dry air<a name='1380'></font>
   rmwf11 = mwf11/mwdry      <font color=#447700>! ratio of molecular weight cfc11 to dry air<a name='1381'></font>
   rmwf12 = mwf12/mwdry      <font color=#447700>! ratio of molecular weight cfc12 to dry air<a name='1382'></font>
<font color=#447700>!<a name='1383'></font>
<font color=#447700>! get latitudes<a name='1384'></font>
<font color=#447700>!<a name='1385'></font>
<font color=#447700>!  call get_rlat_all_p(lchnk, ncol, clat)<a name='1386'></font>
   do i = 1, ncol<a name='1387'>
      coslat(i) = cos(clat(i))<a name='1388'>
   end do<a name='1389'>
<font color=#447700>!<a name='1390'></font>
<font color=#447700>! set tropospheric mass mixing ratios<a name='1391'></font>
<font color=#447700>!<a name='1392'></font>
   ch40   = rmwch4 * ch4vmr<a name='1393'>
   n2o0   = rmwn2o * n2ovmr<a name='1394'>
   cfc110 = rmwf11 * f11vmr<a name='1395'>
   cfc120 = rmwf12 * f12vmr<a name='1396'>
<a name='1397'>
   do i = 1, ncol<a name='1398'>
      coslat(i) = cos(clat(i))<a name='1399'>
   end do<a name='1400'>
<font color=#447700>!<a name='1401'></font>
   do k = 1,pver<a name='1402'>
      do i = 1,ncol<a name='1403'>
<font color=#447700>!<a name='1404'></font>
<font color=#447700>!        set stratospheric scale height factor for gases<a name='1405'></font>
         dlat = abs(57.2958 * clat(i))<a name='1406'>
         if(dlat.le.45.0) then<a name='1407'>
            xn2o = 0.3478 + 0.00116 * dlat<a name='1408'>
            xch4 = 0.2353<a name='1409'>
            xcfc11 = 0.7273 + 0.00606 * dlat<a name='1410'>
            xcfc12 = 0.4000 + 0.00222 * dlat<a name='1411'>
         else<a name='1412'>
            xn2o = 0.4000 + 0.013333 * (dlat - 45)<a name='1413'>
            xch4 = 0.2353 + 0.0225489 * (dlat - 45)<a name='1414'>
            xcfc11 = 1.00 + 0.013333 * (dlat - 45)<a name='1415'>
            xcfc12 = 0.50 + 0.024444 * (dlat - 45)<a name='1416'>
         end if<a name='1417'>
<font color=#447700>!<a name='1418'></font>
<font color=#447700>!        pressure of tropopause<a name='1419'></font>
         ptrop = 250.0e2 - 150.0e2*coslat(i)**2.0<a name='1420'>
<font color=#447700>!<a name='1421'></font>
<font color=#447700>!        determine output mass mixing ratios<a name='1422'></font>
         if (pmid(i,k) &gt;= ptrop) then<a name='1423'>
            ch4(i,k) = ch40<a name='1424'>
            n2o(i,k) = n2o0<a name='1425'>
            cfc11(i,k) = cfc110<a name='1426'>
            cfc12(i,k) = cfc120<a name='1427'>
         else<a name='1428'>
            pratio = pmid(i,k)/ptrop<a name='1429'>
            ch4(i,k) = ch40 * (pratio)**xch4<a name='1430'>
            n2o(i,k) = n2o0 * (pratio)**xn2o<a name='1431'>
            cfc11(i,k) = cfc110 * (pratio)**xcfc11<a name='1432'>
            cfc12(i,k) = cfc120 * (pratio)**xcfc12<a name='1433'>
         end if<a name='1434'>
      end do<a name='1435'>
   end do<a name='1436'>
<font color=#447700>!<a name='1437'></font>
   return<a name='1438'>
<font color=#447700>!<a name='1439'></font>
end subroutine trcmix<a name='1440'>
<a name='1441'>
<font color=#447700>!ccc<a name='1442'></font>
#ifdef CLWRFGHG<a name='1443'>
<a name='1444'>
<A NAME='TRCMIX_CLWRF'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCMIX_CLWRF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1445'>
<font color=#993300>subroutine </font><font color=#cc0000>trcmix_clwrf</font>(lchnk   ,ncol     ,pcols, pver,       &amp; <A href='../../call_to/TRCMIX_CLWRF.html' TARGET='index'>1</A>,<A href='../../call_from/TRCMIX_CLWRF.html' TARGET='index'>3</A><a name='1446'>
                  pmid    ,clat, n2ovmr, ch4vmr, f11vmr,      &amp;<a name='1447'>
                  f12vmr, n2o      ,ch4     ,                 &amp;<a name='1448'>
                  cfc11   , cfc12   )<a name='1449'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1450'></font>
<font color=#447700>! <a name='1451'></font>
<font color=#447700>! Purpose: <a name='1452'></font>
<font color=#447700>! Specify zonal mean mass mixing ratios of CH4, N2O, CFC11 and<a name='1453'></font>
<font color=#447700>! CFC12<a name='1454'></font>
<font color=#447700>! <a name='1455'></font>
<font color=#447700>! Method: <a name='1456'></font>
<font color=#447700>! Distributions assume constant mixing ratio in the troposphere<a name='1457'></font>
<font color=#447700>! and a decrease of mixing ratio in the stratosphere. Tropopause<a name='1458'></font>
<font color=#447700>! defined by ptrop. The scale height of the particular trace gas<a name='1459'></font>
<font color=#447700>! depends on latitude. This assumption produces a more realistic<a name='1460'></font>
<font color=#447700>! stratospheric distribution of the various trace gases.<a name='1461'></font>
<font color=#447700>! <a name='1462'></font>
<font color=#447700>! Author: J. Kiehl<a name='1463'></font>
<font color=#447700>! <a name='1464'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1465'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1466'></font>
<font color=#447700>!  use ppgrid<a name='1467'></font>
<font color=#447700>!  use phys_grid,    only: get_rlat_all_p<a name='1468'></font>
<font color=#447700>!  use physconst,    only: mwdry, mwch4, mwn2o, mwf11, mwf12<a name='1469'></font>
<a name='1470'>
   implicit none<a name='1471'>
<a name='1472'>
<font color=#447700>!-----------------------------Arguments---------------------------------<a name='1473'></font>
<font color=#447700>!<a name='1474'></font>
<font color=#447700>! Input<a name='1475'></font>
<font color=#447700>!<a name='1476'></font>
   integer, intent(in) :: lchnk                    <font color=#447700>! chunk identifier<a name='1477'></font>
   integer, intent(in) :: ncol                     <font color=#447700>! number of atmospheric columns<a name='1478'></font>
   integer, intent(in) :: pcols, pver<a name='1479'>
<a name='1480'>
   real(r8), intent(in) :: pmid(pcols,pver)        <font color=#447700>! model pressures<a name='1481'></font>
   real(r8), intent(in) :: clat(pcols)             <font color=#447700>! latitude in radians for columns<a name='1482'></font>
   real(r8), intent(in) :: n2ovmr, ch4vmr, f11vmr, f12vmr<a name='1483'>
<font color=#447700>!<a name='1484'></font>
<font color=#447700>! Output<a name='1485'></font>
<font color=#447700>!<a name='1486'></font>
   real(r8), intent(out) :: n2o(pcols,pver)         <font color=#447700>! nitrous oxide mass mixing ratio<a name='1487'></font>
   real(r8), intent(out) :: ch4(pcols,pver)         <font color=#447700>! methane mass mixing ratio<a name='1488'></font>
   real(r8), intent(out) :: cfc11(pcols,pver)       <font color=#447700>! cfc11 mass mixing ratio<a name='1489'></font>
   real(r8), intent(out) :: cfc12(pcols,pver)       <font color=#447700>! cfc12 mass mixing ratio<a name='1490'></font>
<a name='1491'>
<font color=#447700>!<a name='1492'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='1493'></font>
<a name='1494'>
   real(r8) :: rmwn2o       <font color=#447700>! ratio of molecular weight n2o   to dry air<a name='1495'></font>
   real(r8) :: rmwch4       <font color=#447700>! ratio of molecular weight ch4   to dry air<a name='1496'></font>
   real(r8) :: rmwf11       <font color=#447700>! ratio of molecular weight cfc11 to dry air<a name='1497'></font>
   real(r8) :: rmwf12       <font color=#447700>! ratio of molecular weight cfc12 to dry air<a name='1498'></font>
<font color=#447700>!<a name='1499'></font>
   integer i                <font color=#447700>! longitude loop index<a name='1500'></font>
   integer k                <font color=#447700>! level index<a name='1501'></font>
<font color=#447700>!<a name='1502'></font>
<font color=#447700>!  real(r8) clat(pcols)         ! latitude in radians for columns<a name='1503'></font>
   real(r8) coslat(pcols)       <font color=#447700>! cosine of latitude<a name='1504'></font>
   real(r8) dlat                <font color=#447700>! latitude in degrees<a name='1505'></font>
   real(r8) ptrop               <font color=#447700>! pressure level of tropopause<a name='1506'></font>
   real(r8) pratio              <font color=#447700>! pressure divided by ptrop<a name='1507'></font>
<font color=#447700>!<a name='1508'></font>
   real(r8) xn2o                <font color=#447700>! pressure scale height for n2o<a name='1509'></font>
   real(r8) xch4                <font color=#447700>! pressure scale height for ch4<a name='1510'></font>
   real(r8) xcfc11              <font color=#447700>! pressure scale height for cfc11<a name='1511'></font>
   real(r8) xcfc12              <font color=#447700>! pressure scale height for cfc12<a name='1512'></font>
<font color=#447700>!<a name='1513'></font>
   real(r8) ch40                <font color=#447700>! tropospheric mass mixing ratio for ch4<a name='1514'></font>
   real(r8) n2o0                <font color=#447700>! tropospheric mass mixing ratio for n2o<a name='1515'></font>
   real(r8) cfc110              <font color=#447700>! tropospheric mass mixing ratio for cfc11<a name='1516'></font>
   real(r8) cfc120              <font color=#447700>! tropospheric mass mixing ratio for cfc12<a name='1517'></font>
  CHARACTER (LEN=256)           :: message<a name='1518'>
<font color=#447700>!<a name='1519'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1520'></font>
   rmwn2o = mwn2o/mwdry      <font color=#447700>! ratio of molecular weight n2o   to dry air<a name='1521'></font>
   rmwch4 = mwch4/mwdry      <font color=#447700>! ratio of molecular weight ch4   to dry air<a name='1522'></font>
   rmwf11 = mwf11/mwdry      <font color=#447700>! ratio of molecular weight cfc11 to dry air<a name='1523'></font>
   rmwf12 = mwf12/mwdry      <font color=#447700>! ratio of molecular weight cfc12 to dry air<a name='1524'></font>
<font color=#447700>!<a name='1525'></font>
<font color=#447700>! get latitudes<a name='1526'></font>
<font color=#447700>!<a name='1527'></font>
<font color=#447700>!  call get_rlat_all_p(lchnk, ncol, clat)<a name='1528'></font>
   do i = 1, ncol<a name='1529'>
      coslat(i) = cos(clat(i))<a name='1530'>
   end do<a name='1531'>
<font color=#447700>!<a name='1532'></font>
<font color=#447700>! set tropospheric mass mixing ratios<a name='1533'></font>
<font color=#447700>!<a name='1534'></font>
   ch40   = rmwch4 * ch4vmr<a name='1535'>
   n2o0   = rmwn2o * n2ovmr<a name='1536'>
   cfc110 = rmwf11 * f11vmr<a name='1537'>
   cfc120 = rmwf12 * f12vmr<a name='1538'>
<a name='1539'>
   do i = 1, ncol<a name='1540'>
      coslat(i) = cos(clat(i))<a name='1541'>
   end do<a name='1542'>
<font color=#447700>!<a name='1543'></font>
   do k = 1,pver<a name='1544'>
      do i = 1,ncol<a name='1545'>
<font color=#447700>!<a name='1546'></font>
<font color=#447700>!        set stratospheric scale height factor for gases<a name='1547'></font>
         dlat = abs(57.2958 * clat(i))<a name='1548'>
         if(dlat.le.45.0) then<a name='1549'>
            xn2o = 0.3478 + 0.00116 * dlat<a name='1550'>
            xch4 = 0.2353<a name='1551'>
            xcfc11 = 0.7273 + 0.00606 * dlat<a name='1552'>
            xcfc12 = 0.4000 + 0.00222 * dlat<a name='1553'>
         else<a name='1554'>
            xn2o = 0.4000 + 0.013333 * (dlat - 45)<a name='1555'>
            xch4 = 0.2353 + 0.0225489 * (dlat - 45)<a name='1556'>
            xcfc11 = 1.00 + 0.013333 * (dlat - 45)<a name='1557'>
            xcfc12 = 0.50 + 0.024444 * (dlat - 45)<a name='1558'>
         end if<a name='1559'>
<font color=#447700>!<a name='1560'></font>
<font color=#447700>!        pressure of tropopause<a name='1561'></font>
         ptrop = 250.0e2 - 150.0e2*coslat(i)**2.0<a name='1562'>
<font color=#447700>!<a name='1563'></font>
<font color=#447700>!        determine output mass mixing ratios<a name='1564'></font>
         if (pmid(i,k) &gt;= ptrop) then<a name='1565'>
            ch4(i,k) = ch40<a name='1566'>
            n2o(i,k) = n2o0<a name='1567'>
            cfc11(i,k) = cfc110<a name='1568'>
            cfc12(i,k) = cfc120<a name='1569'>
         else<a name='1570'>
            pratio = pmid(i,k)/ptrop<a name='1571'>
            ch4(i,k) = ch40 * (pratio)**xch4<a name='1572'>
            n2o(i,k) = n2o0 * (pratio)**xn2o<a name='1573'>
            cfc11(i,k) = cfc110 * (pratio)**xcfc11<a name='1574'>
            cfc12(i,k) = cfc120 * (pratio)**xcfc12<a name='1575'>
         end if<a name='1576'>
      end do<a name='1577'>
   end do<a name='1578'>
<font color=#447700>!<a name='1579'></font>
   WRITE(message,*)'CLWRF-trcmix. ch4vmr:',ch4vmr,' n2ovmr:',n2ovmr,' cfc11vmr:',f11vmr,' cfc12vmr:',f12vmr<a name='1580'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCMIX_CLWRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_760">(0, message)<a name='1581'>
   WRITE(message,*)'CLWRF-trcmix. for i= ncol/2', ncol/2,' k=pver/2',pver/2,'__________'<a name='1582'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCMIX_CLWRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_761">(0, message)<a name='1583'>
<a name='1584'>
   ptrop = 250.0e2 - 150.0e2*coslat(ncol/2)**2.0<a name='1585'>
   if (any(pmid &gt;= ptrop)) then<a name='1586'>
      WRITE(message,*)'CLWRF-trcmix. pmid: ',pmid(ncol/2,pver/2),' ch4:',ch4(ncol/2,pver/2),' n2o:',n2o(ncol/2,pver/2),                 &amp;<a name='1587'>
           ' cfc11:',cfc11(ncol/2,pver/2),' cfc12:',cfc12(ncol/2,pver/2)<a name='1588'>
   else<a name='1589'>
      WRITE(message,*)'CLWRF-trcmix. pratio: ',pmid(ncol/2,pver/2)/ptrop,' ch4:',ch4(ncol/2,pver/2),' n2o:',n2o(ncol/2,pver/2),                 &amp;<a name='1590'>
           ' cfc11:',cfc11(ncol/2,pver/2),' cfc12:',cfc12(ncol/2,pver/2)<a name='1591'>
   endif<a name='1592'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCMIX_CLWRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_762">(0, message)<a name='1593'>
   <a name='1594'>
   return<a name='1595'>
<font color=#447700>!<a name='1596'></font>
end subroutine trcmix_clwrf<a name='1597'>
<a name='1598'>
<a name='1599'>
#endif<a name='1600'>
<a name='1601'>
<font color=#447700>!ccc<a name='1602'></font>
<a name='1603'>
<A NAME='TRCPLK'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCPLK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1604'>
<font color=#993300>subroutine </font><font color=#cc0000>trcplk</font>(lchnk   ,ncol    ,pcols, pver, pverp,         &amp; <A href='../../call_to/TRCPLK.html' TARGET='index'>1</A><a name='1605'>
                  tint    ,tlayr   ,tplnke  ,emplnk  ,abplnk1 , &amp;<a name='1606'>
                  abplnk2 )<a name='1607'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1608'></font>
<font color=#447700>! <a name='1609'></font>
<font color=#447700>! Purpose: <a name='1610'></font>
<font color=#447700>!   Calculate Planck factors for absorptivity and emissivity of<a name='1611'></font>
<font color=#447700>!   CH4, N2O, CFC11 and CFC12<a name='1612'></font>
<font color=#447700>! <a name='1613'></font>
<font color=#447700>! Method: <a name='1614'></font>
<font color=#447700>!   Planck function and derivative evaluated at the band center.<a name='1615'></font>
<font color=#447700>! <a name='1616'></font>
<font color=#447700>! Author: J. Kiehl<a name='1617'></font>
<font color=#447700>! <a name='1618'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1619'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1620'></font>
<font color=#447700>!  use ppgrid<a name='1621'></font>
<a name='1622'>
   implicit none<a name='1623'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1624'></font>
<font color=#447700>!<a name='1625'></font>
<font color=#447700>! Input arguments<a name='1626'></font>
<font color=#447700>!<a name='1627'></font>
   integer, intent(in) :: lchnk                <font color=#447700>! chunk identifier<a name='1628'></font>
   integer, intent(in) :: ncol                 <font color=#447700>! number of atmospheric columns<a name='1629'></font>
   integer, intent(in) :: pcols, pver, pverp<a name='1630'>
<a name='1631'>
   real(r8), intent(in) :: tint(pcols,pverp)   <font color=#447700>! interface temperatures<a name='1632'></font>
   real(r8), intent(in) :: tlayr(pcols,pverp)  <font color=#447700>! k-1 level temperatures<a name='1633'></font>
   real(r8), intent(in) :: tplnke(pcols)       <font color=#447700>! Top Layer temperature<a name='1634'></font>
<font color=#447700>!<a name='1635'></font>
<font color=#447700>! output arguments<a name='1636'></font>
<font color=#447700>!<a name='1637'></font>
   real(r8), intent(out) :: emplnk(14,pcols)         <font color=#447700>! emissivity Planck factor<a name='1638'></font>
   real(r8), intent(out) :: abplnk1(14,pcols,pverp)  <font color=#447700>! non-nearest layer Plack factor<a name='1639'></font>
   real(r8), intent(out) :: abplnk2(14,pcols,pverp)  <font color=#447700>! nearest layer factor<a name='1640'></font>
<a name='1641'>
<font color=#447700>!<a name='1642'></font>
<font color=#447700>!--------------------------Local Variables------------------------------<a name='1643'></font>
<font color=#447700>!<a name='1644'></font>
   integer wvl                   <font color=#447700>! wavelength index<a name='1645'></font>
   integer i,k                   <font color=#447700>! loop counters<a name='1646'></font>
<font color=#447700>!<a name='1647'></font>
   real(r8) f1(14)                   <font color=#447700>! Planck function factor<a name='1648'></font>
   real(r8) f2(14)                   <font color=#447700>!        "<a name='1649'></font>
   real(r8) f3(14)                   <font color=#447700>!        "<a name='1650'></font>
<font color=#447700>!<a name='1651'></font>
<font color=#447700>!--------------------------Data Statements------------------------------<a name='1652'></font>
<font color=#447700>!<a name='1653'></font>
   data f1 /5.85713e8,7.94950e8,1.47009e9,1.40031e9,1.34853e8, &amp;<a name='1654'>
            1.05158e9,3.35370e8,3.99601e8,5.35994e8,8.42955e8, &amp;<a name='1655'>
            4.63682e8,5.18944e8,8.83202e8,1.03279e9/<a name='1656'>
   data f2 /2.02493e11,3.04286e11,6.90698e11,6.47333e11, &amp;<a name='1657'>
            2.85744e10,4.41862e11,9.62780e10,1.21618e11, &amp;<a name='1658'>
            1.79905e11,3.29029e11,1.48294e11,1.72315e11, &amp;<a name='1659'>
            3.50140e11,4.31364e11/<a name='1660'>
   data f3 /1383.0,1531.0,1879.0,1849.0,848.0,1681.0, &amp;<a name='1661'>
            1148.0,1217.0,1343.0,1561.0,1279.0,1328.0, &amp;<a name='1662'>
            1586.0,1671.0/<a name='1663'>
<font color=#447700>!<a name='1664'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1665'></font>
<font color=#447700>!<a name='1666'></font>
<font color=#447700>! Calculate emissivity Planck factor<a name='1667'></font>
<font color=#447700>!<a name='1668'></font>
   do wvl = 1,14<a name='1669'>
      do i = 1,ncol<a name='1670'>
         emplnk(wvl,i) = f1(wvl)/(tplnke(i)**4.0*(exp(f3(wvl)/tplnke(i))-1.0))<a name='1671'>
      end do<a name='1672'>
   end do<a name='1673'>
<font color=#447700>!<a name='1674'></font>
<font color=#447700>! Calculate absorptivity Planck factor for tint and tlayr temperatures<a name='1675'></font>
<font color=#447700>!<a name='1676'></font>
   do wvl = 1,14<a name='1677'>
      do k = ntoplw, pverp<a name='1678'>
         do i = 1, ncol<a name='1679'>
<font color=#447700>!<a name='1680'></font>
<font color=#447700>! non-nearlest layer function<a name='1681'></font>
<font color=#447700>!<a name='1682'></font>
            abplnk1(wvl,i,k) = (f2(wvl)*exp(f3(wvl)/tint(i,k)))  &amp;<a name='1683'>
                               /(tint(i,k)**5.0*(exp(f3(wvl)/tint(i,k))-1.0)**2.0)<a name='1684'>
<font color=#447700>!<a name='1685'></font>
<font color=#447700>! nearest layer function<a name='1686'></font>
<font color=#447700>!<a name='1687'></font>
            abplnk2(wvl,i,k) = (f2(wvl)*exp(f3(wvl)/tlayr(i,k))) &amp;<a name='1688'>
                               /(tlayr(i,k)**5.0*(exp(f3(wvl)/tlayr(i,k))-1.0)**2.0)<a name='1689'>
         end do<a name='1690'>
      end do<a name='1691'>
   end do<a name='1692'>
<font color=#447700>!<a name='1693'></font>
   return<a name='1694'>
end subroutine trcplk<a name='1695'>
<a name='1696'>
<A NAME='TRCPTH'><A href='../../html_code/phys/module_ra_cam_support.F.html#TRCPTH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1697'>
<font color=#993300>subroutine </font><font color=#cc0000>trcpth</font>(lchnk   ,ncol    ,pcols, pver, pverp,         &amp; <A href='../../call_to/TRCPTH.html' TARGET='index'>1</A><a name='1698'>
                  tnm     ,pnm     ,cfc11   ,cfc12   ,n2o     , &amp;<a name='1699'>
                  ch4     ,qnm     ,ucfc11  ,ucfc12  ,un2o0   , &amp;<a name='1700'>
                  un2o1   ,uch4    ,uco211  ,uco212  ,uco213  , &amp;<a name='1701'>
                  uco221  ,uco222  ,uco223  ,bn2o0   ,bn2o1   , &amp;<a name='1702'>
                  bch4    ,uptype  )<a name='1703'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1704'></font>
<font color=#447700>! <a name='1705'></font>
<font color=#447700>! Purpose: <a name='1706'></font>
<font color=#447700>! Calculate path lengths and pressure factors for CH4, N2O, CFC11<a name='1707'></font>
<font color=#447700>! and CFC12.<a name='1708'></font>
<font color=#447700>! <a name='1709'></font>
<font color=#447700>! Method: <a name='1710'></font>
<font color=#447700>! See CCM3 description for details<a name='1711'></font>
<font color=#447700>! <a name='1712'></font>
<font color=#447700>! Author: J. Kiehl<a name='1713'></font>
<font color=#447700>! <a name='1714'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1715'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1716'></font>
<font color=#447700>!  use ppgrid<a name='1717'></font>
<font color=#447700>!  use ghg_surfvals, only: co2mmr<a name='1718'></font>
<a name='1719'>
   implicit none<a name='1720'>
<a name='1721'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1722'></font>
<font color=#447700>!<a name='1723'></font>
<font color=#447700>! Input arguments<a name='1724'></font>
<font color=#447700>!<a name='1725'></font>
   integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='1726'></font>
   integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='1727'></font>
   integer, intent(in) :: pcols, pver, pverp<a name='1728'>
<a name='1729'>
   real(r8), intent(in) :: tnm(pcols,pver)      <font color=#447700>! Model level temperatures<a name='1730'></font>
   real(r8), intent(in) :: pnm(pcols,pverp)     <font color=#447700>! Pres. at model interfaces (dynes/cm2)<a name='1731'></font>
   real(r8), intent(in) :: qnm(pcols,pver)      <font color=#447700>! h2o specific humidity<a name='1732'></font>
   real(r8), intent(in) :: cfc11(pcols,pver)    <font color=#447700>! CFC11 mass mixing ratio<a name='1733'></font>
<font color=#447700>!<a name='1734'></font>
   real(r8), intent(in) :: cfc12(pcols,pver)    <font color=#447700>! CFC12 mass mixing ratio<a name='1735'></font>
   real(r8), intent(in) :: n2o(pcols,pver)      <font color=#447700>! N2O mass mixing ratio<a name='1736'></font>
   real(r8), intent(in) :: ch4(pcols,pver)      <font color=#447700>! CH4 mass mixing ratio<a name='1737'></font>
<a name='1738'>
<font color=#447700>!<a name='1739'></font>
<font color=#447700>! Output arguments<a name='1740'></font>
<font color=#447700>!<a name='1741'></font>
   real(r8), intent(out) :: ucfc11(pcols,pverp)  <font color=#447700>! CFC11 path length<a name='1742'></font>
   real(r8), intent(out) :: ucfc12(pcols,pverp)  <font color=#447700>! CFC12 path length<a name='1743'></font>
   real(r8), intent(out) :: un2o0(pcols,pverp)   <font color=#447700>! N2O path length<a name='1744'></font>
   real(r8), intent(out) :: un2o1(pcols,pverp)   <font color=#447700>! N2O path length (hot band)<a name='1745'></font>
   real(r8), intent(out) :: uch4(pcols,pverp)    <font color=#447700>! CH4 path length<a name='1746'></font>
<font color=#447700>!<a name='1747'></font>
   real(r8), intent(out) :: uco211(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1748'></font>
   real(r8), intent(out) :: uco212(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1749'></font>
   real(r8), intent(out) :: uco213(pcols,pverp)  <font color=#447700>! CO2 9.4 micron band path length<a name='1750'></font>
   real(r8), intent(out) :: uco221(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1751'></font>
   real(r8), intent(out) :: uco222(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1752'></font>
<font color=#447700>!<a name='1753'></font>
   real(r8), intent(out) :: uco223(pcols,pverp)  <font color=#447700>! CO2 10.4 micron band path length<a name='1754'></font>
   real(r8), intent(out) :: bn2o0(pcols,pverp)   <font color=#447700>! pressure factor for n2o<a name='1755'></font>
   real(r8), intent(out) :: bn2o1(pcols,pverp)   <font color=#447700>! pressure factor for n2o<a name='1756'></font>
   real(r8), intent(out) :: bch4(pcols,pverp)    <font color=#447700>! pressure factor for ch4<a name='1757'></font>
   real(r8), intent(out) :: uptype(pcols,pverp)  <font color=#447700>! p-type continuum path length<a name='1758'></font>
<a name='1759'>
<font color=#447700>!<a name='1760'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='1761'></font>
<font color=#447700>!<a name='1762'></font>
   integer   i               <font color=#447700>! Longitude index<a name='1763'></font>
   integer   k               <font color=#447700>! Level index<a name='1764'></font>
<font color=#447700>!<a name='1765'></font>
   real(r8) co2fac(pcols,1)      <font color=#447700>! co2 factor<a name='1766'></font>
   real(r8) alpha1(pcols)        <font color=#447700>! stimulated emission term<a name='1767'></font>
   real(r8) alpha2(pcols)        <font color=#447700>! stimulated emission term<a name='1768'></font>
   real(r8) rt(pcols)            <font color=#447700>! reciprocal of local temperature<a name='1769'></font>
   real(r8) rsqrt(pcols)         <font color=#447700>! reciprocal of sqrt of temp<a name='1770'></font>
<font color=#447700>!<a name='1771'></font>
   real(r8) pbar(pcols)          <font color=#447700>! mean pressure<a name='1772'></font>
   real(r8) dpnm(pcols)          <font color=#447700>! difference in pressure<a name='1773'></font>
   real(r8) diff                 <font color=#447700>! diffusivity factor<a name='1774'></font>
<font color=#447700>!<a name='1775'></font>
<font color=#447700>!--------------------------Data Statements------------------------------<a name='1776'></font>
<font color=#447700>!<a name='1777'></font>
   data diff /1.66/<a name='1778'>
<font color=#447700>!<a name='1779'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1780'></font>
<font color=#447700>!<a name='1781'></font>
<font color=#447700>!  Calculate path lengths for the trace gases at model top<a name='1782'></font>
<font color=#447700>!<a name='1783'></font>
   do i = 1,ncol<a name='1784'>
      ucfc11(i,ntoplw) = 1.8 * cfc11(i,ntoplw) * pnm(i,ntoplw) * rga<a name='1785'>
      ucfc12(i,ntoplw) = 1.8 * cfc12(i,ntoplw) * pnm(i,ntoplw) * rga<a name='1786'>
      un2o0(i,ntoplw) = diff * 1.02346e5 * n2o(i,ntoplw) * pnm(i,ntoplw) * rga / sqrt(tnm(i,ntoplw))<a name='1787'>
      un2o1(i,ntoplw) = diff * 2.01909 * un2o0(i,ntoplw) * exp(-847.36/tnm(i,ntoplw))<a name='1788'>
      uch4(i,ntoplw)  = diff * 8.60957e4 * ch4(i,ntoplw) * pnm(i,ntoplw) * rga / sqrt(tnm(i,ntoplw))<a name='1789'>
      co2fac(i,1)     = diff * co2mmr * pnm(i,ntoplw) * rga<a name='1790'>
      alpha1(i) = (1.0 - exp(-1540.0/tnm(i,ntoplw)))**3.0/sqrt(tnm(i,ntoplw))<a name='1791'>
      alpha2(i) = (1.0 - exp(-1360.0/tnm(i,ntoplw)))**3.0/sqrt(tnm(i,ntoplw))<a name='1792'>
      uco211(i,ntoplw) = 3.42217e3 * co2fac(i,1) * alpha1(i) * exp(-1849.7/tnm(i,ntoplw))<a name='1793'>
      uco212(i,ntoplw) = 6.02454e3 * co2fac(i,1) * alpha1(i) * exp(-2782.1/tnm(i,ntoplw))<a name='1794'>
      uco213(i,ntoplw) = 5.53143e3 * co2fac(i,1) * alpha1(i) * exp(-3723.2/tnm(i,ntoplw))<a name='1795'>
      uco221(i,ntoplw) = 3.88984e3 * co2fac(i,1) * alpha2(i) * exp(-1997.6/tnm(i,ntoplw))<a name='1796'>
      uco222(i,ntoplw) = 3.67108e3 * co2fac(i,1) * alpha2(i) * exp(-3843.8/tnm(i,ntoplw))<a name='1797'>
      uco223(i,ntoplw) = 6.50642e3 * co2fac(i,1) * alpha2(i) * exp(-2989.7/tnm(i,ntoplw))<a name='1798'>
      bn2o0(i,ntoplw) = diff * 19.399 * pnm(i,ntoplw)**2.0 * n2o(i,ntoplw) * &amp;<a name='1799'>
                   1.02346e5 * rga / (sslp*tnm(i,ntoplw))<a name='1800'>
      bn2o1(i,ntoplw) = bn2o0(i,ntoplw) * exp(-847.36/tnm(i,ntoplw)) * 2.06646e5<a name='1801'>
      bch4(i,ntoplw) = diff * 2.94449 * ch4(i,ntoplw) * pnm(i,ntoplw)**2.0 * rga * &amp;<a name='1802'>
                  8.60957e4 / (sslp*tnm(i,ntoplw))<a name='1803'>
      uptype(i,ntoplw) = diff * qnm(i,ntoplw) * pnm(i,ntoplw)**2.0 *  &amp;<a name='1804'>
                    exp(1800.0*(1.0/tnm(i,ntoplw) - 1.0/296.0)) * rga / sslp<a name='1805'>
   end do<a name='1806'>
<font color=#447700>!<a name='1807'></font>
<font color=#447700>! Calculate trace gas path lengths through model atmosphere<a name='1808'></font>
<font color=#447700>!<a name='1809'></font>
   do k = ntoplw,pver<a name='1810'>
      do i = 1,ncol<a name='1811'>
         rt(i) = 1./tnm(i,k)<a name='1812'>
         rsqrt(i) = sqrt(rt(i))<a name='1813'>
         pbar(i) = 0.5 * (pnm(i,k+1) + pnm(i,k)) / sslp<a name='1814'>
         dpnm(i) = (pnm(i,k+1) - pnm(i,k)) * rga<a name='1815'>
         alpha1(i) = diff * rsqrt(i) * (1.0 - exp(-1540.0/tnm(i,k)))**3.0<a name='1816'>
         alpha2(i) = diff * rsqrt(i) * (1.0 - exp(-1360.0/tnm(i,k)))**3.0<a name='1817'>
         ucfc11(i,k+1) = ucfc11(i,k) +  1.8 * cfc11(i,k) * dpnm(i)<a name='1818'>
         ucfc12(i,k+1) = ucfc12(i,k) +  1.8 * cfc12(i,k) * dpnm(i)<a name='1819'>
         un2o0(i,k+1) = un2o0(i,k) + diff * 1.02346e5 * n2o(i,k) * rsqrt(i) * dpnm(i)<a name='1820'>
         un2o1(i,k+1) = un2o1(i,k) + diff * 2.06646e5 * n2o(i,k) * &amp;<a name='1821'>
                        rsqrt(i) * exp(-847.36/tnm(i,k)) * dpnm(i)<a name='1822'>
         uch4(i,k+1) = uch4(i,k) + diff * 8.60957e4 * ch4(i,k) * rsqrt(i) * dpnm(i)<a name='1823'>
         uco211(i,k+1) = uco211(i,k) + 1.15*3.42217e3 * alpha1(i) * &amp;<a name='1824'>
                         co2mmr * exp(-1849.7/tnm(i,k)) * dpnm(i)<a name='1825'>
         uco212(i,k+1) = uco212(i,k) + 1.15*6.02454e3 * alpha1(i) * &amp;<a name='1826'>
                         co2mmr * exp(-2782.1/tnm(i,k)) * dpnm(i)<a name='1827'>
         uco213(i,k+1) = uco213(i,k) + 1.15*5.53143e3 * alpha1(i) * &amp;<a name='1828'>
                         co2mmr * exp(-3723.2/tnm(i,k)) * dpnm(i)<a name='1829'>
         uco221(i,k+1) = uco221(i,k) + 1.15*3.88984e3 * alpha2(i) * &amp;<a name='1830'>
                         co2mmr * exp(-1997.6/tnm(i,k)) * dpnm(i)<a name='1831'>
         uco222(i,k+1) = uco222(i,k) + 1.15*3.67108e3 * alpha2(i) * &amp;<a name='1832'>
                         co2mmr * exp(-3843.8/tnm(i,k)) * dpnm(i)<a name='1833'>
         uco223(i,k+1) = uco223(i,k) + 1.15*6.50642e3 * alpha2(i) * &amp;<a name='1834'>
                         co2mmr * exp(-2989.7/tnm(i,k)) * dpnm(i)<a name='1835'>
         bn2o0(i,k+1) = bn2o0(i,k) + diff * 19.399 * pbar(i) * rt(i) &amp;<a name='1836'>
                        * 1.02346e5 * n2o(i,k) * dpnm(i)<a name='1837'>
         bn2o1(i,k+1) = bn2o1(i,k) + diff * 19.399 * pbar(i) * rt(i) &amp;<a name='1838'>
                        * 2.06646e5 * exp(-847.36/tnm(i,k)) * n2o(i,k)*dpnm(i)<a name='1839'>
         bch4(i,k+1) = bch4(i,k) + diff * 2.94449 * rt(i) * pbar(i) &amp;<a name='1840'>
                       * 8.60957e4 * ch4(i,k) * dpnm(i)<a name='1841'>
         uptype(i,k+1) = uptype(i,k) + diff *qnm(i,k) * &amp;<a name='1842'>
                         exp(1800.0*(1.0/tnm(i,k) - 1.0/296.0)) * pbar(i) * dpnm(i)<a name='1843'>
      end do<a name='1844'>
   end do<a name='1845'>
<font color=#447700>!<a name='1846'></font>
   return<a name='1847'>
end subroutine trcpth<a name='1848'>
<a name='1849'>
<a name='1850'>
<a name='1851'>
<A NAME='AQSAT'><A href='../../html_code/phys/module_ra_cam_support.F.html#AQSAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1852'>
<font color=#993300>subroutine </font><font color=#cc0000>aqsat</font>(t       ,p       ,es      ,qs        ,ii      , &amp; <A href='../../call_to/AQSAT.html' TARGET='index'>4</A>,<A href='../../call_from/AQSAT.html' TARGET='index'>2</A><a name='1853'>
                 ilen    ,kk      ,kstart  ,kend      )<a name='1854'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1855'></font>
<font color=#447700>! <a name='1856'></font>
<font color=#447700>! Purpose: <a name='1857'></font>
<font color=#447700>! Utility procedure to look up and return saturation vapor pressure from<a name='1858'></font>
<font color=#447700>! precomputed table, calculate and return saturation specific humidity<a name='1859'></font>
<font color=#447700>! (g/g),for input arrays of temperature and pressure (dimensioned ii,kk)<a name='1860'></font>
<font color=#447700>! This routine is useful for evaluating only a selected region in the<a name='1861'></font>
<font color=#447700>! vertical.<a name='1862'></font>
<font color=#447700>! <a name='1863'></font>
<font color=#447700>! Method: <a name='1864'></font>
<font color=#447700>! &lt;Describe the algorithm(s) used in the routine.&gt; <a name='1865'></font>
<font color=#447700>! &lt;Also include any applicable external references.&gt; <a name='1866'></font>
<font color=#447700>! <a name='1867'></font>
<font color=#447700>! Author: J. Hack<a name='1868'></font>
<font color=#447700>! <a name='1869'></font>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1870'></font>
<font color=#447700>!<a name='1871'></font>
<font color=#447700>! Input arguments<a name='1872'></font>
<font color=#447700>!<a name='1873'></font>
   integer, intent(in) :: ii             <font color=#447700>! I dimension of arrays t, p, es, qs<a name='1874'></font>
   integer, intent(in) :: kk             <font color=#447700>! K dimension of arrays t, p, es, qs<a name='1875'></font>
   integer, intent(in) :: ilen           <font color=#447700>! Length of vectors in I direction which<a name='1876'></font>
   integer, intent(in) :: kstart         <font color=#447700>! Starting location in K direction<a name='1877'></font>
   integer, intent(in) :: kend           <font color=#447700>! Ending location in K direction<a name='1878'></font>
   real(r8), intent(in) :: t(ii,kk)          <font color=#447700>! Temperature<a name='1879'></font>
   real(r8), intent(in) :: p(ii,kk)          <font color=#447700>! Pressure<a name='1880'></font>
<font color=#447700>!<a name='1881'></font>
<font color=#447700>! Output arguments<a name='1882'></font>
<font color=#447700>!<a name='1883'></font>
   real(r8), intent(out) :: es(ii,kk)         <font color=#447700>! Saturation vapor pressure<a name='1884'></font>
   real(r8), intent(out) :: qs(ii,kk)         <font color=#447700>! Saturation specific humidity<a name='1885'></font>
<font color=#447700>!<a name='1886'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='1887'></font>
<font color=#447700>!<a name='1888'></font>
   real(r8) omeps             <font color=#447700>! 1 - 0.622<a name='1889'></font>
   integer i, k           <font color=#447700>! Indices<a name='1890'></font>
<font color=#447700>!<a name='1891'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1892'></font>
<font color=#447700>!<a name='1893'></font>
   omeps = 1.0 - epsqs<a name='1894'>
   do k=kstart,kend<a name='1895'>
      do i=1,ilen<a name='1896'>
         es(i,k) = <A href='../../html_code/phys/module_ra_cam_support.F.html#ESTBLF'>estblf</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AQSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ESTBLF_14">(t(i,k))<a name='1897'>
<font color=#447700>!<a name='1898'></font>
<font color=#447700>! Saturation specific humidity<a name='1899'></font>
<font color=#447700>!<a name='1900'></font>
         qs(i,k) = epsqs*es(i,k)/(p(i,k) - omeps*es(i,k))<a name='1901'>
<font color=#447700>!<a name='1902'></font>
<font color=#447700>! The following check is to avoid the generation of negative values<a name='1903'></font>
<font color=#447700>! that can occur in the upper stratosphere and mesosphere<a name='1904'></font>
<font color=#447700>!<a name='1905'></font>
         qs(i,k) = min(1.0_r8,qs(i,k))<a name='1906'>
<font color=#447700>!<a name='1907'></font>
         if (qs(i,k) &lt; 0.0) then<a name='1908'>
            qs(i,k) = 1.0<a name='1909'>
            es(i,k) = p(i,k)<a name='1910'>
         end if<a name='1911'>
      end do<a name='1912'>
   end do<a name='1913'>
<font color=#447700>!<a name='1914'></font>
   return<a name='1915'>
end subroutine aqsat<a name='1916'>
<font color=#447700>!===============================================================================<a name='1917'></font>
<A NAME='CLDEFR'><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDEFR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1918'>
  <font color=#993300>subroutine </font><font color=#cc0000>cldefr</font>(lchnk   ,ncol    ,pcols, pver, pverp, &amp; <A href='../../call_to/CLDEFR.html' TARGET='index'>1</A>,<A href='../../call_from/CLDEFR.html' TARGET='index'>2</A><a name='1919'>
       landfrac,t       ,rel     ,rei     ,ps      ,pmid    , landm, icefrac, snowh)<a name='1920'>
<font color=#447700>!----------------------------------------------------------------------- <a name='1921'></font>
<font color=#447700>! <a name='1922'></font>
<font color=#447700>! Purpose: <a name='1923'></font>
<font color=#447700>! Compute cloud water and ice particle size <a name='1924'></font>
<font color=#447700>! <a name='1925'></font>
<font color=#447700>! Method: <a name='1926'></font>
<font color=#447700>! use empirical formulas to construct effective radii<a name='1927'></font>
<font color=#447700>! <a name='1928'></font>
<font color=#447700>! Author: J.T. Kiehl, B. A. Boville, P. Rasch<a name='1929'></font>
<font color=#447700>! <a name='1930'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1931'></font>
<a name='1932'>
    implicit none<a name='1933'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1934'></font>
<font color=#447700>!<a name='1935'></font>
<font color=#447700>! Input arguments<a name='1936'></font>
<font color=#447700>!<a name='1937'></font>
    integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='1938'></font>
    integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='1939'></font>
    integer, intent(in) :: pcols, pver, pverp<a name='1940'>
<a name='1941'>
    real(r8), intent(in) :: landfrac(pcols)      <font color=#447700>! Land fraction<a name='1942'></font>
    real(r8), intent(in) :: icefrac(pcols)       <font color=#447700>! Ice fraction<a name='1943'></font>
    real(r8), intent(in) :: t(pcols,pver)        <font color=#447700>! Temperature<a name='1944'></font>
    real(r8), intent(in) :: ps(pcols)            <font color=#447700>! Surface pressure<a name='1945'></font>
    real(r8), intent(in) :: pmid(pcols,pver)     <font color=#447700>! Midpoint pressures<a name='1946'></font>
    real(r8), intent(in) :: landm(pcols)<a name='1947'>
    real(r8), intent(in) :: snowh(pcols)         <font color=#447700>! Snow depth over land, water equivalent (m)<a name='1948'></font>
<font color=#447700>!<a name='1949'></font>
<font color=#447700>! Output arguments<a name='1950'></font>
<font color=#447700>!<a name='1951'></font>
    real(r8), intent(out) :: rel(pcols,pver)      <font color=#447700>! Liquid effective drop size (microns)<a name='1952'></font>
    real(r8), intent(out) :: rei(pcols,pver)      <font color=#447700>! Ice effective drop size (microns)<a name='1953'></font>
<font color=#447700>!<a name='1954'></font>
<a name='1955'>
<font color=#447700>!++pjr<a name='1956'></font>
<font color=#447700>! following Kiehl<a name='1957'></font>
         call <A href='../../html_code/phys/module_ra_cam_support.F.html#RELTAB'>reltab</A><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDEFR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELTAB_1">(ncol, pcols, pver, t, landfrac, landm, icefrac, rel, snowh)<a name='1958'>
<a name='1959'>
<font color=#447700>! following Kristjansson and Mitchell<a name='1960'></font>
         call <A href='../../html_code/phys/module_ra_cam_support.F.html#REITAB'>reitab</A><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDEFR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REITAB_1">(ncol, pcols, pver, t, rei)<a name='1961'>
<font color=#447700>!--pjr<a name='1962'></font>
<font color=#447700>!<a name='1963'></font>
<font color=#447700>!<a name='1964'></font>
    return<a name='1965'>
  end subroutine cldefr<a name='1966'>
<a name='1967'>
<a name='1968'>
<A NAME='BACKGROUND'><A href='../../html_code/phys/module_ra_cam_support.F.html#BACKGROUND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1969'>
<font color=#993300>subroutine </font><font color=#cc0000>background</font>(lchnk, ncol, pint, pcols, pverr, pverrp, mmr) <A href='../../call_to/BACKGROUND.html' TARGET='index'>1</A><a name='1970'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1971'></font>
<font color=#447700>!<a name='1972'></font>
<font color=#447700>! Purpose:<a name='1973'></font>
<font color=#447700>! Set global mean tropospheric aerosol background (or tuning) field<a name='1974'></font>
<font color=#447700>!<a name='1975'></font>
<font color=#447700>! Method:<a name='1976'></font>
<font color=#447700>! Specify aerosol mixing ratio.<a name='1977'></font>
<font color=#447700>! Aerosol mass mixing ratio<a name='1978'></font>
<font color=#447700>! is specified so that the column visible aerosol optical depth is a<a name='1979'></font>
<font color=#447700>! specified global number (tauback). This means that the actual mixing<a name='1980'></font>
<font color=#447700>! ratio depends on pressure thickness of the lowest three atmospheric<a name='1981'></font>
<font color=#447700>! layers near the surface.<a name='1982'></font>
<font color=#447700>!<a name='1983'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1984'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='1985'></font>
<font color=#447700>!  use aer_optics, only: kbg,idxVIS<a name='1986'></font>
<font color=#447700>!  use physconst, only: gravit<a name='1987'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1988'></font>
   implicit none<a name='1989'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1990'></font>
<font color=#447700>!#include "ptrrgrid.h"<a name='1991'></font>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='1992'></font>
<font color=#447700>!<a name='1993'></font>
<font color=#447700>! Input arguments<a name='1994'></font>
<font color=#447700>!<a name='1995'></font>
   integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='1996'></font>
   integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='1997'></font>
   integer, intent(in) :: pcols,pverr,pverrp<a name='1998'>
<a name='1999'>
   real(r8), intent(in) :: pint(pcols,pverrp)   <font color=#447700>! Interface pressure (mks)<a name='2000'></font>
<font color=#447700>!<a name='2001'></font>
<font color=#447700>! Output arguments<a name='2002'></font>
<font color=#447700>!<a name='2003'></font>
   real(r8), intent(out) :: mmr(pcols,pverr)    <font color=#447700>! "background" aerosol mass mixing ratio<a name='2004'></font>
<font color=#447700>!<a name='2005'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='2006'></font>
<font color=#447700>!<a name='2007'></font>
   integer i          <font color=#447700>! Longitude index<a name='2008'></font>
   integer k          <font color=#447700>! Level index<a name='2009'></font>
<font color=#447700>!<a name='2010'></font>
   real(r8) mass2mmr  <font color=#447700>! Factor to convert mass to mass mixing ratio<a name='2011'></font>
   real(r8) mass      <font color=#447700>! Mass of "background" aerosol as specified by tauback<a name='2012'></font>
<font color=#447700>!<a name='2013'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2014'></font>
<font color=#447700>!<a name='2015'></font>
   do i=1,ncol<a name='2016'>
      mass2mmr =  gravmks / (pint(i,pverrp)-pint(i,pverrp-mxaerl))<a name='2017'>
      do k=1,pverr<a name='2018'>
<font color=#447700>!<a name='2019'></font>
<font color=#447700>! Compute aerosol mass mixing ratio for specified levels (1.e3 factor is<a name='2020'></font>
<font color=#447700>! for units conversion of the extinction coefficiant from m2/g to m2/kg)<a name='2021'></font>
<font color=#447700>!<a name='2022'></font>
        if ( k &gt;= pverrp-mxaerl ) then<a name='2023'>
<font color=#447700>! kaervs is not consistent with the values in aer_optics<a name='2024'></font>
<font color=#447700>! this ?should? be changed.<a name='2025'></font>
<font color=#447700>! rhfac is also implemented differently<a name='2026'></font>
            mass = tauback / (1.e3 * kbg(idxVIS))<a name='2027'>
            mmr(i,k) = mass2mmr*mass<a name='2028'>
         else<a name='2029'>
            mmr(i,k) = 0._r8<a name='2030'>
         endif<a name='2031'>
<font color=#447700>!<a name='2032'></font>
      enddo<a name='2033'>
   enddo<a name='2034'>
<font color=#447700>!<a name='2035'></font>
   return<a name='2036'>
end subroutine background<a name='2037'>
<a name='2038'>
<A NAME='SCALE_AEROSOLS'><A href='../../html_code/phys/module_ra_cam_support.F.html#SCALE_AEROSOLS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2039'>
<font color=#993300>subroutine </font><font color=#cc0000>scale_aerosols</font>(AEROSOLt, pcols, pver, ncol, lchnk, scale) <A href='../../call_to/SCALE_AEROSOLS.html' TARGET='index'>1</A><a name='2040'>
<font color=#447700>!-----------------------------------------------------------------<a name='2041'></font>
<font color=#447700>! scale each species as determined by scale factors<a name='2042'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='2043'></font>
  integer, intent(in) :: ncol, lchnk <font color=#447700>! number of columns and chunk index<a name='2044'></font>
  integer, intent(in) :: pcols, pver<a name='2045'>
  real(r8), intent(in) :: scale(naer_all) <font color=#447700>! scale each aerosol by this amount<a name='2046'></font>
  real(r8), intent(inout) :: AEROSOLt(pcols, pver, naer_all) <font color=#447700>! aerosols<a name='2047'></font>
  integer m<a name='2048'>
<a name='2049'>
  do m = 1, naer_all<a name='2050'>
     AEROSOLt(:ncol, :, m) = scale(m)*AEROSOLt(:ncol, :, m)<a name='2051'>
  end do<a name='2052'>
<a name='2053'>
  return<a name='2054'>
end subroutine scale_aerosols<a name='2055'>
<a name='2056'>
<A NAME='GET_INT_SCALES'><A href='../../html_code/phys/module_ra_cam_support.F.html#GET_INT_SCALES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2057'>
<font color=#993300>subroutine </font><font color=#cc0000>get_int_scales</font>(scales) <A href='../../call_to/GET_INT_SCALES.html' TARGET='index'>2</A><a name='2058'>
  real(r8), intent(out)::scales(naer_all)  <font color=#447700>! scale each aerosol by this amount<a name='2059'></font>
  integer i                                  <font color=#447700>! index through species<a name='2060'></font>
<a name='2061'>
<font color=#447700>!initialize<a name='2062'></font>
  scales = 1.<a name='2063'>
<a name='2064'>
  scales(idxBG) = 1._r8<a name='2065'>
  scales(idxSUL) = sulscl <a name='2066'>
  scales(idxSSLT) = ssltscl  <a name='2067'>
  <a name='2068'>
  do i = idxCARBONfirst, idxCARBONfirst+numCARBON-1<a name='2069'>
    scales(i) = carscl<a name='2070'>
  enddo<a name='2071'>
  <a name='2072'>
  do i = idxDUSTfirst, idxDUSTfirst+numDUST-1<a name='2073'>
    scales(i) = dustscl<a name='2074'>
  enddo<a name='2075'>
<a name='2076'>
  scales(idxVOLC) = volcscl<a name='2077'>
<a name='2078'>
  return<a name='2079'>
end subroutine get_int_scales<a name='2080'>
<a name='2081'>
<A NAME='VERT_INTERPOLATE'><A href='../../html_code/phys/module_ra_cam_support.F.html#VERT_INTERPOLATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2082'>
<font color=#993300>subroutine </font><font color=#cc0000>vert_interpolate</font> (Match_ps, aerosolc, m_hybi, paerlev, naer_c, pint, n, AEROSOL_mmr, pcols, pver, pverp, ncol, c) <A href='../../call_to/VERT_INTERPOLATE.html' TARGET='index'>2</A>,<A href='../../call_from/VERT_INTERPOLATE.html' TARGET='index'>3</A><a name='2083'>
<font color=#447700>!--------------------------------------------------------------------<a name='2084'></font>
<font color=#447700>! Input: match surface pressure, cam interface pressure,<a name='2085'></font>
<font color=#447700>!        month index, number of columns, chunk index<a name='2086'></font>
<font color=#447700>!<a name='2087'></font>
<font color=#447700>! Output: Aerosol mass mixing ratio (AEROSOL_mmr)<a name='2088'></font>
<font color=#447700>!<a name='2089'></font>
<font color=#447700>! Method:<a name='2090'></font>
<font color=#447700>!         interpolate column mass (cumulative) from match onto<a name='2091'></font>
<font color=#447700>!           cam's vertical grid (pressure coordinate)<a name='2092'></font>
<font color=#447700>!         convert back to mass mixing ratio<a name='2093'></font>
<font color=#447700>!<a name='2094'></font>
<font color=#447700>!--------------------------------------------------------------------<a name='2095'></font>
<a name='2096'>
<font color=#447700>!  use physconst,     only: gravit<a name='2097'></font>
<a name='2098'>
   integer, intent(in)  :: paerlev,naer_c,pcols,pver,pverp<a name='2099'>
   real(r8), intent(out) :: AEROSOL_mmr(pcols,pver,naer)  <font color=#447700>! aerosol mmr from MATCH<a name='2100'></font>
   real(r8), intent(in) :: Match_ps(pcols)                <font color=#447700>! surface pressure at a particular month<a name='2101'></font>
   real(r8), intent(in) :: pint(pcols,pverp)              <font color=#447700>! interface pressure from CAM<a name='2102'></font>
   real(r8), intent(in) :: aerosolc(pcols,paerlev,naer_c)<a name='2103'>
   real(r8), intent(in) :: m_hybi(paerlev)<a name='2104'>
<a name='2105'>
   integer, intent(in) :: ncol,c                          <font color=#447700>! chunk index and number of columns<a name='2106'></font>
   integer, intent(in) :: n                               <font color=#447700>! prv or nxt month index<a name='2107'></font>
<font color=#447700>!<a name='2108'></font>
<font color=#447700>! Local workspace<a name='2109'></font>
<font color=#447700>!<a name='2110'></font>
   integer m                           <font color=#447700>! index to aerosol species<a name='2111'></font>
   integer kupper(pcols)               <font color=#447700>! last upper bound for interpolation<a name='2112'></font>
   integer i, k, kk, kkstart, kount    <font color=#447700>! loop vars for interpolation<a name='2113'></font>
   integer isv, ksv, msv               <font color=#447700>! loop indices to save<a name='2114'></font>
<a name='2115'>
   logical bad                         <font color=#447700>! indicates a bad point found<a name='2116'></font>
   logical lev_interp_comp             <font color=#447700>! interpolation completed for a level<a name='2117'></font>
<a name='2118'>
   real(r8) AEROSOL(pcols,pverp,naer)  <font color=#447700>! cumulative mass of aerosol in column beneath upper<a name='2119'></font>
                                       <font color=#447700>! interface of level in column at particular month<a name='2120'></font>
   real(r8) dpl, dpu                   <font color=#447700>! lower and upper intepolation factors<a name='2121'></font>
   real(r8) v_coord                    <font color=#447700>! vertical coordinate<a name='2122'></font>
   real(r8) m_to_mmr                   <font color=#447700>! mass to mass mixing ratio conversion factor<a name='2123'></font>
   real(r8) AER_diff                   <font color=#447700>! temp var for difference between aerosol masses<a name='2124'></font>
<font color=#447700>!ccc<a name='2125'></font>
#ifdef CLWRFGHG<a name='2126'>
<font color=#447700>!CLWRF-UC July.09<a name='2127'></font>
<font color=#447700>!   LOGICAL ISNAND, EXTERNAL           ! NaN values detection<a name='2128'></font>
#endif<a name='2129'>
<font color=#447700>!ccc<a name='2130'></font>
<font color=#447700>!  call t_startf ('vert_interpolate')<a name='2131'></font>
<font color=#447700>!<a name='2132'></font>
<font color=#447700>! Initialize index array<a name='2133'></font>
<font color=#447700>!<a name='2134'></font>
   do i=1,ncol<a name='2135'>
      kupper(i) = 1<a name='2136'>
   end do<a name='2137'>
<font color=#447700>!<a name='2138'></font>
<font color=#447700>! assign total mass to topmost level<a name='2139'></font>
<font color=#447700>!<a name='2140'></font>
   <a name='2141'>
   do i=1,ncol<a name='2142'>
   do m=1,naer<a name='2143'>
   AEROSOL(i,1,m) = AEROSOLc(i,1,m)<a name='2144'>
   enddo<a name='2145'>
   enddo<a name='2146'>
<font color=#447700>!<a name='2147'></font>
<font color=#447700>! At every pressure level, interpolate onto that pressure level<a name='2148'></font>
<font color=#447700>!<a name='2149'></font>
   do k=2,pver<a name='2150'>
<font color=#447700>!<a name='2151'></font>
<font color=#447700>! Top level we need to start looking is the top level for the previous k<a name='2152'></font>
<font color=#447700>! for all longitude points<a name='2153'></font>
<font color=#447700>!<a name='2154'></font>
      kkstart = paerlev<a name='2155'>
      do i=1,ncol<a name='2156'>
         kkstart = min0(kkstart,kupper(i))<a name='2157'>
      end do<a name='2158'>
      kount = 0<a name='2159'>
<font color=#447700>!<a name='2160'></font>
<font color=#447700>! Store level indices for interpolation<a name='2161'></font>
<font color=#447700>!<a name='2162'></font>
<font color=#447700>! for the pressure interpolation should be comparing<a name='2163'></font>
<font color=#447700>! pint(column,lev) with M_hybi(lev)*M_ps_cam_col(month,column,chunk)<a name='2164'></font>
<font color=#447700>!<a name='2165'></font>
      lev_interp_comp = .false.<a name='2166'>
      do kk=kkstart,paerlev-1<a name='2167'>
         if(.not.lev_interp_comp) then<a name='2168'>
         do i=1,ncol<a name='2169'>
            v_coord = pint(i,k)<a name='2170'>
            if (M_hybi(kk)*Match_ps(i) .lt. v_coord .and. v_coord .le. M_hybi(kk+1)*Match_ps(i)) then<a name='2171'>
               kupper(i) = kk<a name='2172'>
               kount = kount + 1<a name='2173'>
            end if<a name='2174'>
         end do<a name='2175'>
<font color=#447700>!<a name='2176'></font>
<font color=#447700>! If all indices for this level have been found, do the interpolation and<a name='2177'></font>
<font color=#447700>! go to the next level<a name='2178'></font>
<font color=#447700>!<a name='2179'></font>
<font color=#447700>! Interpolate in pressure.<a name='2180'></font>
<font color=#447700>!<a name='2181'></font>
         if (kount.eq.ncol) then<a name='2182'>
            do i=1,ncol<a name='2183'>
             do m=1,naer<a name='2184'>
               dpu = pint(i,k) - M_hybi(kupper(i))*Match_ps(i)<a name='2185'>
               dpl = M_hybi(kupper(i)+1)*Match_ps(i) - pint(i,k)<a name='2186'>
               AEROSOL(i,k,m) = &amp;<a name='2187'>
                    (AEROSOLc(i,kupper(i)  ,m)*dpl + &amp;<a name='2188'>
                     AEROSOLc(i,kupper(i)+1,m)*dpu)/(dpl + dpu)<a name='2189'>
             enddo<a name='2190'>
            enddo <font color=#447700>!i<a name='2191'></font>
            lev_interp_comp = .true.<a name='2192'>
         end if<a name='2193'>
         end if<a name='2194'>
      end do<a name='2195'>
<font color=#447700>!<a name='2196'></font>
<font color=#447700>! If we've fallen through the kk=1,levsiz-1 loop, we cannot interpolate and<a name='2197'></font>
<a name='2198'>
<font color=#447700>! must extrapolate from the bottom or top pressure level for at least some<a name='2199'></font>
<font color=#447700>! of the longitude points.<a name='2200'></font>
<font color=#447700>!<a name='2201'></font>
<a name='2202'>
      if(.not.lev_interp_comp) then<a name='2203'>
         do i=1,ncol<a name='2204'>
          do m=1,naer <a name='2205'>
            if (pint(i,k) .lt. M_hybi(1)*Match_ps(i)) then<a name='2206'>
               AEROSOL(i,k,m) =  AEROSOLc(i,1,m)<a name='2207'>
            else if (pint(i,k) .gt. M_hybi(paerlev)*Match_ps(i)) then<a name='2208'>
               AEROSOL(i,k,m) = 0.0<a name='2209'>
            else<a name='2210'>
               dpu = pint(i,k) - M_hybi(kupper(i))*Match_ps(i)<a name='2211'>
               dpl = M_hybi(kupper(i)+1)*Match_ps(i) - pint(i,k)<a name='2212'>
               AEROSOL(i,k,m) = &amp;<a name='2213'>
                    (AEROSOLc(i,kupper(i)  ,m)*dpl + &amp;<a name='2214'>
                     AEROSOLc(i,kupper(i)+1,m)*dpu)/(dpl + dpu)<a name='2215'>
            end if<a name='2216'>
          enddo<a name='2217'>
         end do<a name='2218'>
<a name='2219'>
         if (kount.gt.ncol) then<a name='2220'>
            call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#VERT_INTERPOLATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_33"> ('VERT_INTERPOLATE: Bad data: non-monotonicity suspected in dependent variable')<a name='2221'>
         end if<a name='2222'>
      end if<a name='2223'>
   end do<a name='2224'>
<a name='2225'>
<font color=#447700>!  call t_startf ('vi_checks')<a name='2226'></font>
<font color=#447700>!<a name='2227'></font>
<font color=#447700>! aerosol mass beneath lowest interface (pverp) must be 0<a name='2228'></font>
<font color=#447700>!<a name='2229'></font>
   AEROSOL(1:ncol,pverp,:) = 0.<a name='2230'>
<font color=#447700>!<a name='2231'></font>
<font color=#447700>! Set mass in layer to zero whenever it is less than<a name='2232'></font>
<font color=#447700>!   1.e-40 kg/m^2 in the layer<a name='2233'></font>
<font color=#447700>!<a name='2234'></font>
   do m = 1, naer<a name='2235'>
      do k = 1, pver<a name='2236'>
         do i = 1, ncol<a name='2237'>
            if (AEROSOL(i,k,m) &lt; 1.e-40_r8) AEROSOL(i,k,m) = 0.<a name='2238'>
         end do<a name='2239'>
      end do<a name='2240'>
   end do<a name='2241'>
<font color=#447700>!<a name='2242'></font>
<font color=#447700>! Set mass in layer to zero whenever it is less than<a name='2243'></font>
<font color=#447700>!   10^-15 relative to column total mass<a name='2244'></font>
<font color=#447700>! convert back to mass mixing ratios.<a name='2245'></font>
<font color=#447700>! exit if mmr is negative<a name='2246'></font>
<font color=#447700>!<a name='2247'></font>
   do m = 1, naer<a name='2248'>
      do k = 1, pver<a name='2249'>
         do i = 1, ncol<a name='2250'>
            AER_diff = AEROSOL(i,k,m) - AEROSOL(i,k+1,m)<a name='2251'>
            if( abs(AER_diff) &lt; 1e-15*AEROSOL(i,1,m)) then<a name='2252'>
               AER_diff = 0.<a name='2253'>
            end if<a name='2254'>
            m_to_mmr = gravmks / (pint(i,k+1)-pint(i,k))<a name='2255'>
            AEROSOL_mmr(i,k,m)= AER_diff * m_to_mmr<a name='2256'>
            if (AEROSOL_mmr(i,k,m) &lt; 0) then<a name='2257'>
               write(6,*)'vert_interpolate: mmr &lt; 0, m, col, lev, mmr',m, i, k, AEROSOL_mmr(i,k,m)<a name='2258'>
               write(6,*)'vert_interpolate: aerosol(k),(k+1)',AEROSOL(i,k,m),AEROSOL(i,k+1,m)<a name='2259'>
               write(6,*)'vert_interpolate: pint(k+1),(k)',pint(i,k+1),pint(i,k)<a name='2260'>
               write(6,*)'n,c',n,c<a name='2261'>
<font color=#447700>!ccc<a name='2262'></font>
#ifdef CLWRFGHG<a name='2263'>
<font color=#447700>!CLWRF-UC July.09<a name='2264'></font>
<font color=#447700>!               IF (ISNAND(pint(i,k+1))) THEN<a name='2265'></font>
                 CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#VERT_INTERPOLATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_978">('CLWRF-module_ra_cam_support. vert_interpolate: ERROR -- error -- Error of computation pint=NaN')<a name='2266'>
<font color=#447700>!               ENDIF<a name='2267'></font>
<font color=#447700>!               IF (ISNAND(pint(i,k))) THEN<a name='2268'></font>
<font color=#447700>!                 CALL wrf_error_fatal('CLWRF-module_ra_cam_support. vert_interpolate: ERROR -- error -- Error of computation pint=NaN')<a name='2269'></font>
<font color=#447700>!               ENDIF<a name='2270'></font>
#endif<a name='2271'>
<font color=#447700>!ccc<a name='2272'></font>
               call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#VERT_INTERPOLATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_34">()<a name='2273'>
            end if<a name='2274'>
         end do<a name='2275'>
      end do<a name='2276'>
   end do<a name='2277'>
<a name='2278'>
<font color=#447700>!  call t_stopf ('vi_checks')<a name='2279'></font>
<font color=#447700>!  call t_stopf ('vert_interpolate')<a name='2280'></font>
<a name='2281'>
   return<a name='2282'>
end subroutine vert_interpolate<a name='2283'>
<a name='2284'>
<a name='2285'>
<font color=#447700>!===============================================================================<a name='2286'></font>
<A NAME='CLDEMS'><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDEMS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2287'>
  <font color=#993300>subroutine </font><font color=#cc0000>cldems</font>(lchnk   ,ncol    ,pcols, pver, pverp, clwp    ,fice    ,rei     ,emis    ) <A href='../../call_to/CLDEMS.html' TARGET='index'>1</A><a name='2288'>
<font color=#447700>!----------------------------------------------------------------------- <a name='2289'></font>
<font color=#447700>! <a name='2290'></font>
<font color=#447700>! Purpose: <a name='2291'></font>
<font color=#447700>! Compute cloud emissivity using cloud liquid water path (g/m**2)<a name='2292'></font>
<font color=#447700>! <a name='2293'></font>
<font color=#447700>! Method: <a name='2294'></font>
<font color=#447700>! &lt;Describe the algorithm(s) used in the routine.&gt; <a name='2295'></font>
<font color=#447700>! &lt;Also include any applicable external references.&gt; <a name='2296'></font>
<font color=#447700>! <a name='2297'></font>
<font color=#447700>! Author: J.T. Kiehl<a name='2298'></font>
<font color=#447700>! <a name='2299'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2300'></font>
<a name='2301'>
    implicit none<a name='2302'>
<font color=#447700>!------------------------------Parameters-------------------------------<a name='2303'></font>
<font color=#447700>!<a name='2304'></font>
    real(r8) kabsl                  <font color=#447700>! longwave liquid absorption coeff (m**2/g)<a name='2305'></font>
    parameter (kabsl = 0.090361)<a name='2306'>
<font color=#447700>!<a name='2307'></font>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='2308'></font>
<font color=#447700>!<a name='2309'></font>
<font color=#447700>! Input arguments<a name='2310'></font>
<font color=#447700>!<a name='2311'></font>
    integer, intent(in) :: lchnk                   <font color=#447700>! chunk identifier<a name='2312'></font>
    integer, intent(in) :: ncol                    <font color=#447700>! number of atmospheric columns<a name='2313'></font>
    integer, intent(in) :: pcols, pver, pverp<a name='2314'>
<a name='2315'>
    real(r8), intent(in) :: clwp(pcols,pver)       <font color=#447700>! cloud liquid water path (g/m**2)<a name='2316'></font>
    real(r8), intent(in) :: rei(pcols,pver)        <font color=#447700>! ice effective drop size (microns)<a name='2317'></font>
    real(r8), intent(in) :: fice(pcols,pver)       <font color=#447700>! fractional ice content within cloud<a name='2318'></font>
<font color=#447700>!<a name='2319'></font>
<font color=#447700>! Output arguments<a name='2320'></font>
<font color=#447700>!<a name='2321'></font>
    real(r8), intent(out) :: emis(pcols,pver)       <font color=#447700>! cloud emissivity (fraction)<a name='2322'></font>
<font color=#447700>!<a name='2323'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='2324'></font>
<font color=#447700>!<a name='2325'></font>
    integer i,k                 <font color=#447700>! longitude, level indices<a name='2326'></font>
    real(r8) kabs                   <font color=#447700>! longwave absorption coeff (m**2/g)<a name='2327'></font>
    real(r8) kabsi                  <font color=#447700>! ice absorption coefficient<a name='2328'></font>
<font color=#447700>!<a name='2329'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2330'></font>
<font color=#447700>!<a name='2331'></font>
    do k=1,pver<a name='2332'>
       do i=1,ncol<a name='2333'>
          kabsi = 0.005 + 1./rei(i,k)<a name='2334'>
          kabs = kabsl*(1.-fice(i,k)) + kabsi*fice(i,k)<a name='2335'>
          emis(i,k) = 1. - exp(-1.66*kabs*clwp(i,k))<a name='2336'>
       end do<a name='2337'>
    end do<a name='2338'>
<font color=#447700>!<a name='2339'></font>
    return<a name='2340'>
  end subroutine cldems<a name='2341'>
<a name='2342'>
<font color=#447700>!===============================================================================<a name='2343'></font>
<A NAME='CLDOVRLAP'><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDOVRLAP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2344'>
  <font color=#993300>subroutine </font><font color=#cc0000>cldovrlap</font>(lchnk   ,ncol    ,pcols, pver, pverp, pint    ,cld     ,nmxrgn  ,pmxrgn  ) <A href='../../call_to/CLDOVRLAP.html' TARGET='index'>1</A><a name='2345'>
<font color=#447700>!----------------------------------------------------------------------- <a name='2346'></font>
<font color=#447700>! <a name='2347'></font>
<font color=#447700>! Purpose: <a name='2348'></font>
<font color=#447700>! Partitions each column into regions with clouds in neighboring layers.<a name='2349'></font>
<font color=#447700>! This information is used to implement maximum overlap in these regions<a name='2350'></font>
<font color=#447700>! with random overlap between them.<a name='2351'></font>
<font color=#447700>! On output,<a name='2352'></font>
<font color=#447700>!    nmxrgn contains the number of regions in each column<a name='2353'></font>
<font color=#447700>!    pmxrgn contains the interface pressures for the lower boundaries of<a name='2354'></font>
<font color=#447700>!           each region! <a name='2355'></font>
<font color=#447700>! Method: <a name='2356'></font>
<a name='2357'>
<font color=#447700>! <a name='2358'></font>
<font color=#447700>! Author: W. Collins<a name='2359'></font>
<font color=#447700>! <a name='2360'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2361'></font>
<a name='2362'>
    implicit none<a name='2363'>
<font color=#447700>!<a name='2364'></font>
<font color=#447700>! Input arguments<a name='2365'></font>
<font color=#447700>!<a name='2366'></font>
    integer, intent(in) :: lchnk                <font color=#447700>! chunk identifier<a name='2367'></font>
    integer, intent(in) :: ncol                 <font color=#447700>! number of atmospheric columns<a name='2368'></font>
    integer, intent(in) :: pcols, pver, pverp<a name='2369'>
<a name='2370'>
    real(r8), intent(in) :: pint(pcols,pverp)   <font color=#447700>! Interface pressure<a name='2371'></font>
    real(r8), intent(in) :: cld(pcols,pver)     <font color=#447700>! Fractional cloud cover<a name='2372'></font>
<font color=#447700>!<a name='2373'></font>
<font color=#447700>! Output arguments<a name='2374'></font>
<font color=#447700>!<a name='2375'></font>
    real(r8), intent(out) :: pmxrgn(pcols,pverp)<font color=#447700>! Maximum values of pressure for each<a name='2376'></font>
<font color=#447700>!    maximally overlapped region.<a name='2377'></font>
<font color=#447700>!    0-&gt;pmxrgn(i,1) is range of pressure for<a name='2378'></font>
<font color=#447700>!    1st region,pmxrgn(i,1)-&gt;pmxrgn(i,2) for<a name='2379'></font>
<font color=#447700>!    2nd region, etc<a name='2380'></font>
    integer nmxrgn(pcols)                    <font color=#447700>! Number of maximally overlapped regions<a name='2381'></font>
<font color=#447700>!<a name='2382'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='2383'></font>
<font color=#447700>!<a name='2384'></font>
    integer i                    <font color=#447700>! Longitude index<a name='2385'></font>
    integer k                    <font color=#447700>! Level index<a name='2386'></font>
    integer n                    <font color=#447700>! Max-overlap region counter<a name='2387'></font>
<a name='2388'>
    real(r8) pnm(pcols,pverp)    <font color=#447700>! Interface pressure<a name='2389'></font>
<a name='2390'>
    logical cld_found            <font color=#447700>! Flag for detection of cloud<a name='2391'></font>
    logical cld_layer(pver)      <font color=#447700>! Flag for cloud in layer<a name='2392'></font>
<font color=#447700>!<a name='2393'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='2394'></font>
<font color=#447700>!<a name='2395'></font>
<a name='2396'>
    do i = 1, ncol<a name='2397'>
       cld_found = .false.<a name='2398'>
       cld_layer(:) = cld(i,:) &gt; 0.0_r8<a name='2399'>
       pmxrgn(i,:) = 0.0<a name='2400'>
       pnm(i,:)=pint(i,:)*10.<a name='2401'>
       n = 1<a name='2402'>
       do k = 1, pver<a name='2403'>
          if (cld_layer(k) .and.  .not. cld_found) then<a name='2404'>
             cld_found = .true.<a name='2405'>
          else if ( .not. cld_layer(k) .and. cld_found) then<a name='2406'>
             cld_found = .false.<a name='2407'>
             if (count(cld_layer(k:pver)) == 0) then<a name='2408'>
                exit<a name='2409'>
             endif<a name='2410'>
             pmxrgn(i,n) = pnm(i,k)<a name='2411'>
             n = n + 1<a name='2412'>
          endif<a name='2413'>
       end do<a name='2414'>
       pmxrgn(i,n) = pnm(i,pverp)<a name='2415'>
       nmxrgn(i) = n<a name='2416'>
    end do<a name='2417'>
<a name='2418'>
    return<a name='2419'>
  end subroutine cldovrlap<a name='2420'>
<a name='2421'>
<font color=#447700>!===============================================================================<a name='2422'></font>
<A NAME='CLDCLW'><A href='../../html_code/phys/module_ra_cam_support.F.html#CLDCLW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2423'>
  <font color=#993300>subroutine </font><font color=#cc0000>cldclw</font>(lchnk   ,ncol    ,pcols, pver, pverp, zi      ,clwp    ,tpw     ,hl      )<a name='2424'>
<font color=#447700>!----------------------------------------------------------------------- <a name='2425'></font>
<font color=#447700>! <a name='2426'></font>
<font color=#447700>! Purpose: <a name='2427'></font>
<font color=#447700>! Evaluate cloud liquid water path clwp (g/m**2)<a name='2428'></font>
<font color=#447700>! <a name='2429'></font>
<font color=#447700>! Method: <a name='2430'></font>
<font color=#447700>! &lt;Describe the algorithm(s) used in the routine.&gt; <a name='2431'></font>
<font color=#447700>! &lt;Also include any applicable external references.&gt; <a name='2432'></font>
<font color=#447700>! <a name='2433'></font>
<font color=#447700>! Author: J.T. Kiehl<a name='2434'></font>
<font color=#447700>! <a name='2435'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2436'></font>
<a name='2437'>
    implicit none<a name='2438'>
<a name='2439'>
<font color=#447700>!<a name='2440'></font>
<font color=#447700>! Input arguments<a name='2441'></font>
<font color=#447700>!<a name='2442'></font>
    integer, intent(in) :: lchnk                 <font color=#447700>! chunk identifier<a name='2443'></font>
    integer, intent(in) :: ncol                  <font color=#447700>! number of atmospheric columns<a name='2444'></font>
    integer, intent(in) :: pcols, pver, pverp<a name='2445'>
<a name='2446'>
    real(r8), intent(in) :: zi(pcols,pverp)      <font color=#447700>! height at layer interfaces(m)<a name='2447'></font>
    real(r8), intent(in) :: tpw(pcols)           <font color=#447700>! total precipitable water (mm)<a name='2448'></font>
<font color=#447700>!<a name='2449'></font>
<font color=#447700>! Output arguments<a name='2450'></font>
<font color=#447700>!<a name='2451'></font>
    real(r8) clwp(pcols,pver)     <font color=#447700>! cloud liquid water path (g/m**2)<a name='2452'></font>
    real(r8) hl(pcols)            <font color=#447700>! liquid water scale height<a name='2453'></font>
    real(r8) rhl(pcols)           <font color=#447700>! 1/hl<a name='2454'></font>
<a name='2455'>
<font color=#447700>!<a name='2456'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='2457'></font>
<font color=#447700>!<a name='2458'></font>
    integer i,k               <font color=#447700>! longitude, level indices<a name='2459'></font>
    real(r8) clwc0                <font color=#447700>! reference liquid water concentration (g/m**3)<a name='2460'></font>
    real(r8) emziohl(pcols,pverp) <font color=#447700>! exp(-zi/hl)<a name='2461'></font>
<font color=#447700>!<a name='2462'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2463'></font>
<font color=#447700>!<a name='2464'></font>
<font color=#447700>! Set reference liquid water concentration<a name='2465'></font>
<font color=#447700>!<a name='2466'></font>
    clwc0 = 0.21<a name='2467'>
<font color=#447700>!<a name='2468'></font>
<font color=#447700>! Diagnose liquid water scale height from precipitable water<a name='2469'></font>
<font color=#447700>!<a name='2470'></font>
    do i=1,ncol<a name='2471'>
       hl(i)  = 700.0*log(max(tpw(i)+1.0_r8,1.0_r8))<a name='2472'>
       rhl(i) = 1.0/hl(i)<a name='2473'>
    end do<a name='2474'>
<font color=#447700>!<a name='2475'></font>
<font color=#447700>! Evaluate cloud liquid water path (vertical integral of exponential fn)<a name='2476'></font>
<font color=#447700>!<a name='2477'></font>
    do k=1,pverp<a name='2478'>
       do i=1,ncol<a name='2479'>
          emziohl(i,k) = exp(-zi(i,k)*rhl(i))<a name='2480'>
       end do<a name='2481'>
    end do<a name='2482'>
    do k=1,pver<a name='2483'>
       do i=1,ncol<a name='2484'>
          clwp(i,k) = clwc0*hl(i)*(emziohl(i,k+1) - emziohl(i,k))<a name='2485'>
       end do<a name='2486'>
    end do<a name='2487'>
<font color=#447700>!<a name='2488'></font>
    return<a name='2489'>
  end subroutine cldclw<a name='2490'>
<a name='2491'>
<a name='2492'>
<font color=#447700>!===============================================================================<a name='2493'></font>
<A NAME='RELTAB'><A href='../../html_code/phys/module_ra_cam_support.F.html#RELTAB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2494'>
  <font color=#993300>subroutine </font><font color=#cc0000>reltab</font>(ncol, pcols, pver, t, landfrac, landm, icefrac, rel, snowh) <A href='../../call_to/RELTAB.html' TARGET='index'>1</A><a name='2495'>
<font color=#447700>!----------------------------------------------------------------------- <a name='2496'></font>
<font color=#447700>! <a name='2497'></font>
<font color=#447700>! Purpose: <a name='2498'></font>
<font color=#447700>! Compute cloud water size<a name='2499'></font>
<font color=#447700>! <a name='2500'></font>
<font color=#447700>! Method: <a name='2501'></font>
<font color=#447700>! analytic formula following the formulation originally developed by J. T. Kiehl<a name='2502'></font>
<font color=#447700>! <a name='2503'></font>
<font color=#447700>! Author: Phil Rasch<a name='2504'></font>
<font color=#447700>! <a name='2505'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2506'></font>
<font color=#447700>!   use physconst,          only: tmelt<a name='2507'></font>
    implicit none<a name='2508'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='2509'></font>
<font color=#447700>!<a name='2510'></font>
<font color=#447700>! Input arguments<a name='2511'></font>
<font color=#447700>!<a name='2512'></font>
    integer, intent(in) :: ncol<a name='2513'>
    integer, intent(in) :: pcols, pver<a name='2514'>
    real(r8), intent(in) :: landfrac(pcols)      <font color=#447700>! Land fraction<a name='2515'></font>
    real(r8), intent(in) :: icefrac(pcols)       <font color=#447700>! Ice fraction<a name='2516'></font>
    real(r8), intent(in) :: snowh(pcols)         <font color=#447700>! Snow depth over land, water equivalent (m)<a name='2517'></font>
    real(r8), intent(in) :: landm(pcols)         <font color=#447700>! Land fraction ramping to zero over ocean<a name='2518'></font>
    real(r8), intent(in) :: t(pcols,pver)        <font color=#447700>! Temperature<a name='2519'></font>
<a name='2520'>
<font color=#447700>!<a name='2521'></font>
<font color=#447700>! Output arguments<a name='2522'></font>
<font color=#447700>!<a name='2523'></font>
    real(r8), intent(out) :: rel(pcols,pver)      <font color=#447700>! Liquid effective drop size (microns)<a name='2524'></font>
<font color=#447700>!<a name='2525'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='2526'></font>
<font color=#447700>!<a name='2527'></font>
    integer i,k               <font color=#447700>! Lon, lev indices<a name='2528'></font>
    real(r8) rliqland         <font color=#447700>! liquid drop size if over land<a name='2529'></font>
    real(r8) rliqocean        <font color=#447700>! liquid drop size if over ocean<a name='2530'></font>
    real(r8) rliqice          <font color=#447700>! liquid drop size if over sea ice<a name='2531'></font>
<font color=#447700>!<a name='2532'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2533'></font>
<font color=#447700>!<a name='2534'></font>
    rliqocean = 14.0_r8<a name='2535'>
    rliqice   = 14.0_r8<a name='2536'>
    rliqland  = 8.0_r8<a name='2537'>
    do k=1,pver<a name='2538'>
       do i=1,ncol<a name='2539'>
<font color=#447700>! jrm Reworked effective radius algorithm<a name='2540'></font>
          <font color=#447700>! Start with temperature-dependent value appropriate for continental air<a name='2541'></font>
          <font color=#447700>! Note: findmcnew has a pressure dependence here<a name='2542'></font>
          rel(i,k) = rliqland + (rliqocean-rliqland) * min(1.0_r8,max(0.0_r8,(tmelt-t(i,k))*0.05))<a name='2543'>
          <font color=#447700>! Modify for snow depth over land<a name='2544'></font>
          rel(i,k) = rel(i,k) + (rliqocean-rel(i,k)) * min(1.0_r8,max(0.0_r8,snowh(i)*10.))<a name='2545'>
          <font color=#447700>! Ramp between polluted value over land to clean value over ocean.<a name='2546'></font>
          rel(i,k) = rel(i,k) + (rliqocean-rel(i,k)) * min(1.0_r8,max(0.0_r8,1.0-landm(i)))<a name='2547'>
          <font color=#447700>! Ramp between the resultant value and a sea ice value in the presence of ice.<a name='2548'></font>
          rel(i,k) = rel(i,k) + (rliqice-rel(i,k)) * min(1.0_r8,max(0.0_r8,icefrac(i)))<a name='2549'>
<font color=#447700>! end jrm<a name='2550'></font>
       end do<a name='2551'>
    end do<a name='2552'>
  end subroutine reltab<a name='2553'>
<font color=#447700>!===============================================================================<a name='2554'></font>
<A NAME='REITAB'><A href='../../html_code/phys/module_ra_cam_support.F.html#REITAB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2555'>
  <font color=#993300>subroutine </font><font color=#cc0000>reitab</font>(ncol, pcols, pver, t, re) <A href='../../call_to/REITAB.html' TARGET='index'>1</A><a name='2556'>
    <font color=#447700>!<a name='2557'></font>
<a name='2558'>
    integer, intent(in) :: ncol, pcols, pver<a name='2559'>
    real(r8), intent(out) :: re(pcols,pver)<a name='2560'>
    real(r8), intent(in) :: t(pcols,pver)<a name='2561'>
    real(r8) corr<a name='2562'>
    integer i<a name='2563'>
    integer k<a name='2564'>
    integer index<a name='2565'>
    <font color=#447700>!<a name='2566'></font>
    do k=1,pver<a name='2567'>
       do i=1,ncol<a name='2568'>
          index = int(t(i,k)-179.)<a name='2569'>
          index = min(max(index,1),94)<a name='2570'>
          corr = t(i,k) - int(t(i,k))<a name='2571'>
          re(i,k) = retab(index)*(1.-corr)		&amp;<a name='2572'>
               +retab(index+1)*corr<a name='2573'>
          <font color=#447700>!           re(i,k) = amax1(amin1(re(i,k),30.),10.)<a name='2574'></font>
       end do<a name='2575'>
    end do<a name='2576'>
    <font color=#447700>!<a name='2577'></font>
    return<a name='2578'>
  end subroutine reitab<a name='2579'>
  <a name='2580'>
<A NAME='EXP_INTERPOL'><A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2581'>
  <font color=#993300>function </font><font color=#cc0000>exp_interpol</font>(x, f, y) result(g) <A href='../../call_to/EXP_INTERPOL.html' TARGET='index'>3</A>,<A href='../../call_from/EXP_INTERPOL.html' TARGET='index'>2</A><a name='2582'>
<a name='2583'>
    <font color=#447700>! Purpose:<a name='2584'></font>
    <font color=#447700>!   interpolates f(x) to point y<a name='2585'></font>
    <font color=#447700>!   assuming f(x) = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_20">(x0) exp a(x - x0)<a name='2586'></font>
    <font color=#447700>!   where a = ( ln f(x1) - ln f(x0) ) / (x1 - x0)<a name='2587'></font>
    <font color=#447700>!   x0 &lt;= x &lt;= x1<a name='2588'></font>
    <font color=#447700>!   assumes x is monotonically increasing<a name='2589'></font>
<a name='2590'>
    <font color=#447700>! Author: D. Fillmore<a name='2591'></font>
<a name='2592'>
<font color=#447700>!   use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='2593'></font>
<a name='2594'>
    implicit none<a name='2595'>
<a name='2596'>
    real(r8), intent(in), dimension(:) :: x  <font color=#447700>! grid points<a name='2597'></font>
    real(r8), intent(in), dimension(:) :: f  <font color=#447700>! grid function values<a name='2598'></font>
    real(r8), intent(in) :: y                <font color=#447700>! interpolation point<a name='2599'></font>
    real(r8) :: g                            <font color=#447700>! interpolated function value<a name='2600'></font>
<a name='2601'>
    integer :: k  <font color=#447700>! interpolation point index<a name='2602'></font>
    integer :: n  <font color=#447700>! length of x<a name='2603'></font>
    real(r8) :: a<a name='2604'>
<a name='2605'>
    n = size(x)<a name='2606'>
<a name='2607'>
    <font color=#447700>! find k such that x(k) &lt; y =&lt; x(k+1)<a name='2608'></font>
    <font color=#447700>! set k = 1 if y &lt;= x(1)  and  k = n-1 if y &gt; x(n)<a name='2609'></font>
<a name='2610'>
    if (y &lt;= x(1)) then<a name='2611'>
      k = 1<a name='2612'>
    else if (y &gt;= x(n)) then<a name='2613'>
      k = n - 1<a name='2614'>
    else<a name='2615'>
      k = 1<a name='2616'>
      do while (y &gt; x(k+1) .and. k &lt; n)<a name='2617'>
        k = k + 1<a name='2618'>
      end do<a name='2619'>
    end if<a name='2620'>
<a name='2621'>
    <font color=#447700>! interpolate<a name='2622'></font>
    a = (  log( f(k+1) / f(k) )  ) / ( x(k+1) - x(k) )<a name='2623'>
    g = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_21">(k) * exp( a * (y - x(k)) )<a name='2624'>
<a name='2625'>
  end function exp_interpol<a name='2626'>
<a name='2627'>
<A NAME='LIN_INTERPOL'><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2628'>
  <font color=#993300>function </font><font color=#cc0000>lin_interpol</font>(x, f, y) result(g) <A href='../../call_to/LIN_INTERPOL.html' TARGET='index'>6</A>,<A href='../../call_from/LIN_INTERPOL.html' TARGET='index'>2</A><a name='2629'>
    <a name='2630'>
    <font color=#447700>! Purpose:<a name='2631'></font>
    <font color=#447700>!   interpolates f(x) to point y<a name='2632'></font>
    <font color=#447700>!   assuming f(x) = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_22">(x0) + a * (x - x0)<a name='2633'></font>
    <font color=#447700>!   where a = ( f(x1) - f(x0) ) / (x1 - x0)<a name='2634'></font>
    <font color=#447700>!   x0 &lt;= x &lt;= x1<a name='2635'></font>
    <font color=#447700>!   assumes x is monotonically increasing<a name='2636'></font>
<a name='2637'>
    <font color=#447700>! Author: D. Fillmore<a name='2638'></font>
<a name='2639'>
<font color=#447700>!   use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='2640'></font>
<a name='2641'>
    implicit none<a name='2642'>
    <a name='2643'>
    real(r8), intent(in), dimension(:) :: x  <font color=#447700>! grid points<a name='2644'></font>
    real(r8), intent(in), dimension(:) :: f  <font color=#447700>! grid function values<a name='2645'></font>
    real(r8), intent(in) :: y                <font color=#447700>! interpolation point<a name='2646'></font>
    real(r8) :: g                            <font color=#447700>! interpolated function value<a name='2647'></font>
    <a name='2648'>
    integer :: k  <font color=#447700>! interpolation point index<a name='2649'></font>
    integer :: n  <font color=#447700>! length of x<a name='2650'></font>
    real(r8) :: a<a name='2651'>
<a name='2652'>
    n = size(x)<a name='2653'>
<a name='2654'>
    <font color=#447700>! find k such that x(k) &lt; y =&lt; x(k+1)<a name='2655'></font>
    <font color=#447700>! set k = 1 if y &lt;= x(1)  and  k = n-1 if y &gt; x(n)<a name='2656'></font>
<a name='2657'>
    if (y &lt;= x(1)) then <a name='2658'>
      k = 1 <a name='2659'>
    else if (y &gt;= x(n)) then<a name='2660'>
      k = n - 1<a name='2661'>
    else <a name='2662'>
      k = 1 <a name='2663'>
      do while (y &gt; x(k+1) .and. k &lt; n)<a name='2664'>
        k = k + 1<a name='2665'>
      end do<a name='2666'>
    end if<a name='2667'>
<a name='2668'>
    <font color=#447700>! interpolate<a name='2669'></font>
    a = (  f(k+1) - f(k) ) / ( x(k+1) - x(k) )<a name='2670'>
    g = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_23">(k) + a * (y - x(k))<a name='2671'>
<a name='2672'>
  end function lin_interpol<a name='2673'>
<a name='2674'>
<A NAME='LIN_INTERPOL2'><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL2' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2675'>
  <font color=#993300>function </font><font color=#cc0000>lin_interpol2</font>(x, f, y) result(g) <A href='../../call_to/LIN_INTERPOL2.html' TARGET='index'>1</A>,<A href='../../call_from/LIN_INTERPOL2.html' TARGET='index'>2</A><a name='2676'>
<a name='2677'>
    <font color=#447700>! Purpose:<a name='2678'></font>
    <font color=#447700>!   interpolates f(x) to point y<a name='2679'></font>
    <font color=#447700>!   assuming f(x) = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_24">(x0) + a * (x - x0)<a name='2680'></font>
    <font color=#447700>!   where a = ( f(x1) - f(x0) ) / (x1 - x0)<a name='2681'></font>
    <font color=#447700>!   x0 &lt;= x &lt;= x1<a name='2682'></font>
    <font color=#447700>!   assumes x is monotonically increasing<a name='2683'></font>
<a name='2684'>
    <font color=#447700>! Author: D. Fillmore ::  J. Done changed from r8 to r4<a name='2685'></font>
<a name='2686'>
    implicit none<a name='2687'>
<a name='2688'>
    real, intent(in), dimension(:) :: x  <font color=#447700>! grid points<a name='2689'></font>
    real, intent(in), dimension(:) :: f  <font color=#447700>! grid function values<a name='2690'></font>
    real, intent(in) :: y                <font color=#447700>! interpolation point<a name='2691'></font>
    real :: g                            <font color=#447700>! interpolated function value<a name='2692'></font>
<a name='2693'>
    integer :: k  <font color=#447700>! interpolation point index<a name='2694'></font>
    integer :: n  <font color=#447700>! length of x<a name='2695'></font>
    real    :: a<a name='2696'>
<a name='2697'>
    n = size(x)<a name='2698'>
<a name='2699'>
    <font color=#447700>! find k such that x(k) &lt; y =&lt; x(k+1)<a name='2700'></font>
    <font color=#447700>! set k = 1 if y &lt;= x(1)  and  k = n-1 if y &gt; x(n)<a name='2701'></font>
<a name='2702'>
    if (y &lt;= x(1)) then<a name='2703'>
      k = 1<a name='2704'>
    else if (y &gt;= x(n)) then<a name='2705'>
      k = n - 1<a name='2706'>
    else<a name='2707'>
      k = 1<a name='2708'>
      do while (y &gt; x(k+1) .and. k &lt; n)<a name='2709'>
        k = k + 1<a name='2710'>
      end do<a name='2711'>
    end if<a name='2712'>
<a name='2713'>
    <font color=#447700>! interpolate<a name='2714'></font>
    a = (  f(k+1) - f(k) ) / ( x(k+1) - x(k) )<a name='2715'>
    g = <A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>f</A><A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_25">(k) + a * (y - x(k))<a name='2716'>
<a name='2717'>
  end function lin_interpol2    <a name='2718'>
<a name='2719'>
<a name='2720'>
<A NAME='GETFACTORS'><A href='../../html_code/phys/module_ra_cam_support.F.html#GETFACTORS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2721'>
<font color=#993300>subroutine </font><font color=#cc0000>getfactors</font> (cycflag, np1, cdayminus, cdayplus, cday, &amp; <A href='../../call_to/GETFACTORS.html' TARGET='index'>2</A>,<A href='../../call_from/GETFACTORS.html' TARGET='index'>3</A><a name='2722'>
                       fact1, fact2)<a name='2723'>
<font color=#447700>!---------------------------------------------------------------------------<a name='2724'></font>
<font color=#447700>!<a name='2725'></font>
<font color=#447700>! Purpose: Determine time interpolation factors (normally for a boundary dataset)<a name='2726'></font>
<font color=#447700>!          for linear interpolation.<a name='2727'></font>
<font color=#447700>!<a name='2728'></font>
<font color=#447700>! Method:  Assume 365 days per year.  Output variable fact1 will be the weight to<a name='2729'></font>
<font color=#447700>!          apply to data at calendar time "cdayminus", and fact2 the weight to apply<a name='2730'></font>
<font color=#447700>!          to data at time "cdayplus".  Combining these values will produce a result<a name='2731'></font>
<font color=#447700>!          valid at time "cday".  Output arguments fact1 and fact2 will be between<a name='2732'></font>
<font color=#447700>!          0 and 1, and fact1 + fact2 = 1 to roundoff.<a name='2733'></font>
<font color=#447700>!<a name='2734'></font>
<font color=#447700>! Author:  Jim Rosinski<a name='2735'></font>
<font color=#447700>!<a name='2736'></font>
<font color=#447700>!---------------------------------------------------------------------------<a name='2737'></font>
   implicit none<a name='2738'>
<font color=#447700>!<a name='2739'></font>
<font color=#447700>! Arguments<a name='2740'></font>
<font color=#447700>!<a name='2741'></font>
   logical, intent(in) :: cycflag             <font color=#447700>! flag indicates whether dataset is being cycled yearly<a name='2742'></font>
<a name='2743'>
   integer, intent(in) :: np1                 <font color=#447700>! index points to forward time slice matching cdayplus<a name='2744'></font>
<a name='2745'>
   real(r8), intent(in) :: cdayminus          <font color=#447700>! calendar day of rearward time slice<a name='2746'></font>
   real(r8), intent(in) :: cdayplus           <font color=#447700>! calendar day of forward time slice<a name='2747'></font>
   real(r8), intent(in) :: cday               <font color=#447700>! calenar day to be interpolated to<a name='2748'></font>
   real(r8), intent(out) :: fact1             <font color=#447700>! time interpolation factor to apply to rearward time slice<a name='2749'></font>
   real(r8), intent(out) :: fact2             <font color=#447700>! time interpolation factor to apply to forward time slice<a name='2750'></font>
<a name='2751'>
<font color=#447700>!  character(len=*), intent(in) :: str        ! string to be added to print in case of error (normally the callers name)<a name='2752'></font>
<font color=#447700>!<a name='2753'></font>
<font color=#447700>! Local workspace<a name='2754'></font>
<font color=#447700>!<a name='2755'></font>
   real(r8) :: deltat                         <font color=#447700>! time difference (days) between cdayminus and cdayplus<a name='2756'></font>
   real(r8), parameter :: daysperyear = 365.  <font color=#447700>! number of days in a year<a name='2757'></font>
<font color=#447700>!<a name='2758'></font>
<font color=#447700>! Initial sanity checks<a name='2759'></font>
<font color=#447700>!<a name='2760'></font>
<font color=#447700>!  if (np1 == 1 .and. .not. cycflag) then<a name='2761'></font>
<font color=#447700>!     call endrun ('GETFACTORS:'//str//' cycflag false and forward month index = Jan. not allowed')<a name='2762'></font>
<font color=#447700>!  end if<a name='2763'></font>
<a name='2764'>
<font color=#447700>!  if (np1 &lt; 1) then<a name='2765'></font>
<font color=#447700>!     call endrun ('GETFACTORS:'//str//' input arg np1 must be &gt; 0')<a name='2766'></font>
<font color=#447700>!  end if<a name='2767'></font>
<a name='2768'>
   if (cycflag) then<a name='2769'>
      if ((cday &lt; 1.) .or. (cday &gt; (daysperyear+1.))) then<a name='2770'>
         write(6,*) 'GETFACTORS:', ' bad cday=',cday<a name='2771'>
         call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GETFACTORS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_35"> ()<a name='2772'>
      end if<a name='2773'>
   else<a name='2774'>
      if (cday &lt; 1.) then<a name='2775'>
         write(6,*) 'GETFACTORS:',  ' bad cday=',cday<a name='2776'>
         call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GETFACTORS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_36"> ()<a name='2777'>
      end if<a name='2778'>
   end if<a name='2779'>
<font color=#447700>!<a name='2780'></font>
<font color=#447700>! Determine time interpolation factors.  Account for December-January<a name='2781'></font>
<font color=#447700>! interpolation if dataset is being cycled yearly.<a name='2782'></font>
<font color=#447700>!<a name='2783'></font>
   if (cycflag .and. np1 == 1) then                     <font color=#447700>! Dec-Jan interpolation<a name='2784'></font>
      deltat = cdayplus + daysperyear - cdayminus<a name='2785'>
      if (cday &gt; cdayplus) then                         <font color=#447700>! We are in December<a name='2786'></font>
         fact1 = (cdayplus + daysperyear - cday)/deltat<a name='2787'>
         fact2 = (cday - cdayminus)/deltat<a name='2788'>
      else                                              <font color=#447700>! We are in January<a name='2789'></font>
         fact1 = (cdayplus - cday)/deltat<a name='2790'>
         fact2 = (cday + daysperyear - cdayminus)/deltat<a name='2791'>
      end if<a name='2792'>
   else<a name='2793'>
      deltat = cdayplus - cdayminus<a name='2794'>
      fact1 = (cdayplus - cday)/deltat<a name='2795'>
      fact2 = (cday - cdayminus)/deltat<a name='2796'>
   end if<a name='2797'>
<a name='2798'>
   if (.not. validfactors (fact1, fact2)) then<a name='2799'>
      write(6,*) 'GETFACTORS: ', ' bad fact1 and/or fact2=', fact1, fact2<a name='2800'>
      call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GETFACTORS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_37"> ()<a name='2801'>
   end if<a name='2802'>
<a name='2803'>
   return<a name='2804'>
end subroutine getfactors<a name='2805'>
<a name='2806'>
<A NAME='VALIDFACTORS'><A href='../../html_code/phys/module_ra_cam_support.F.html#VALIDFACTORS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2807'>
logical <font color=#993300>function </font><font color=#cc0000>validfactors</font> (fact1, fact2)<a name='2808'>
<font color=#447700>!---------------------------------------------------------------------------<a name='2809'></font>
<font color=#447700>!<a name='2810'></font>
<font color=#447700>! Purpose: check sanity of time interpolation factors to within 32-bit roundoff<a name='2811'></font>
<font color=#447700>!<a name='2812'></font>
<font color=#447700>!---------------------------------------------------------------------------<a name='2813'></font>
   implicit none<a name='2814'>
<a name='2815'>
   real(r8), intent(in) :: fact1, fact2           <font color=#447700>! time interpolation factors<a name='2816'></font>
<a name='2817'>
   validfactors = .true.<a name='2818'>
   if (abs(fact1+fact2-1.) &gt; 1.e-6 .or. &amp;<a name='2819'>
       fact1 &gt; 1.000001 .or. fact1 &lt; -1.e-6 .or. &amp;<a name='2820'>
       fact2 &gt; 1.000001 .or. fact2 &lt; -1.e-6) then<a name='2821'>
<a name='2822'>
      validfactors = .false.<a name='2823'>
   end if<a name='2824'>
<a name='2825'>
   return<a name='2826'>
end function validfactors<a name='2827'>
<a name='2828'>
<A NAME='GET_RF_SCALES'><A href='../../html_code/phys/module_ra_cam_support.F.html#GET_RF_SCALES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2829'>
<font color=#993300>subroutine </font><font color=#cc0000>get_rf_scales</font>(scales) <A href='../../call_to/GET_RF_SCALES.html' TARGET='index'>1</A><a name='2830'>
<a name='2831'>
  real(r8), intent(out)::scales(naer_all)  <font color=#447700>! scale aerosols by this amount<a name='2832'></font>
<a name='2833'>
  integer i                                  <font color=#447700>! loop index<a name='2834'></font>
<a name='2835'>
  scales(idxBG) = bgscl_rf<a name='2836'>
  scales(idxSUL) = sulscl_rf<a name='2837'>
  scales(idxSSLT) = ssltscl_rf<a name='2838'>
<a name='2839'>
  do i = idxCARBONfirst, idxCARBONfirst+numCARBON-1<a name='2840'>
    scales(i) = carscl_rf<a name='2841'>
  enddo<a name='2842'>
<a name='2843'>
  do i = idxDUSTfirst, idxDUSTfirst+numDUST-1<a name='2844'>
    scales(i) = dustscl_rf<a name='2845'>
  enddo<a name='2846'>
<a name='2847'>
  scales(idxVOLC) = volcscl_rf<a name='2848'>
<a name='2849'>
end subroutine get_rf_scales<a name='2850'>
<a name='2851'>
<A NAME='PSI'><A href='../../html_code/phys/module_ra_cam_support.F.html#PSI' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2852'>
<font color=#993300>function </font><font color=#cc0000>psi</font>(tpx,iband) <A href='../../call_to/PSI.html' TARGET='index'>22</A><a name='2853'>
<font color=#447700>!    <a name='2854'></font>
<font color=#447700>! History: First version for Hitran 1996 (C/H/E)<a name='2855'></font>
<font color=#447700>!          Current version for Hitran 2000 (C/LT/E)<a name='2856'></font>
<font color=#447700>! Short function for Hulst-Curtis-Godson temperature factors for<a name='2857'></font>
<font color=#447700>!   computing effective H2O path<a name='2858'></font>
<font color=#447700>! Line data for H2O: Hitran 2000, plus H2O patches v11.0 for 1341 missing<a name='2859'></font>
<font color=#447700>!                    lines between 500 and 2820 cm^-1.<a name='2860'></font>
<font color=#447700>!                    See cfa-www.harvard.edu/HITRAN<a name='2861'></font>
<font color=#447700>! Isotopes of H2O: all<a name='2862'></font>
<font color=#447700>! Line widths: air-broadened only (self set to 0)<a name='2863'></font>
<font color=#447700>! Code for line strengths and widths: GENLN3<a name='2864'></font>
<font color=#447700>! Reference: Edwards, D.P., 1992: GENLN2, A General Line-by-Line Atmospheric<a name='2865'></font>
<font color=#447700>!                     Transmittance and Radiance Model, Version 3.0 Description<a name='2866'></font>
<font color=#447700>!                     and Users Guide, NCAR/TN-367+STR, 147 pp.<a name='2867'></font>
<font color=#447700>!     <a name='2868'></font>
<font color=#447700>! Note: functions have been normalized by dividing by their values at<a name='2869'></font>
<font color=#447700>!       a path temperature of 160K<a name='2870'></font>
<font color=#447700>!<a name='2871'></font>
<font color=#447700>! spectral intervals:     <a name='2872'></font>
<font color=#447700>!   1 = 0-800 cm^-1 and 1200-2200 cm^-1<a name='2873'></font>
<font color=#447700>!   2 = 800-1200 cm^-1      <a name='2874'></font>
<font color=#447700>!<a name='2875'></font>
<font color=#447700>! Formulae: Goody and Yung, Atmospheric Radiation: Theoretical Basis,<a name='2876'></font>
<font color=#447700>!           2nd edition, Oxford University Press, 1989.<a name='2877'></font>
<font color=#447700>! Psi: function for pressure along path<a name='2878'></font>
<font color=#447700>!      eq. 6.30, p. 228<a name='2879'></font>
<font color=#447700>!<a name='2880'></font>
   real(r8),intent(in):: tpx      <font color=#447700>! path temperature<a name='2881'></font>
   integer, intent(in):: iband    <font color=#447700>! band to process<a name='2882'></font>
   real(r8) psi                   <font color=#447700>! psi for given band<a name='2883'></font>
   real(r8),parameter ::  psi_r0(nbands) = (/ 5.65308452E-01, -7.30087891E+01/)<a name='2884'>
   real(r8),parameter ::  psi_r1(nbands) = (/ 4.07519005E-03,  1.22199547E+00/)<a name='2885'>
   real(r8),parameter ::  psi_r2(nbands) = (/-1.04347237E-05, -7.12256227E-03/)<a name='2886'>
   real(r8),parameter ::  psi_r3(nbands) = (/ 1.23765354E-08,  1.47852825E-05/)<a name='2887'>
<a name='2888'>
   psi = (((psi_r3(iband) * tpx) + psi_r2(iband)) * tpx + psi_r1(iband)) * tpx + psi_r0(iband)<a name='2889'>
end function psi<a name='2890'>
<a name='2891'>
<A NAME='PHI'><A href='../../html_code/phys/module_ra_cam_support.F.html#PHI' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2892'>
<font color=#993300>function </font><font color=#cc0000>phi</font>(tpx,iband) <A href='../../call_to/PHI.html' TARGET='index'>4</A><a name='2893'>
<font color=#447700>!<a name='2894'></font>
<font color=#447700>! History: First version for Hitran 1996 (C/H/E)<a name='2895'></font>
<font color=#447700>!          Current version for Hitran 2000 (C/LT/E)<a name='2896'></font>
<font color=#447700>! Short function for Hulst-Curtis-Godson temperature factors for<a name='2897'></font>
<font color=#447700>!   computing effective H2O path<a name='2898'></font>
<font color=#447700>! Line data for H2O: Hitran 2000, plus H2O patches v11.0 for 1341 missing<a name='2899'></font>
<font color=#447700>!                    lines between 500 and 2820 cm^-1.<a name='2900'></font>
<font color=#447700>!                    See cfa-www.harvard.edu/HITRAN<a name='2901'></font>
<font color=#447700>! Isotopes of H2O: all<a name='2902'></font>
<font color=#447700>! Line widths: air-broadened only (self set to 0)<a name='2903'></font>
<font color=#447700>! Code for line strengths and widths: GENLN3<a name='2904'></font>
<font color=#447700>! Reference: Edwards, D.P., 1992: GENLN2, A General Line-by-Line Atmospheric<a name='2905'></font>
<font color=#447700>!                     Transmittance and Radiance Model, Version 3.0 Description<a name='2906'></font>
<font color=#447700>!                     and Users Guide, NCAR/TN-367+STR, 147 pp.<a name='2907'></font>
<font color=#447700>!<a name='2908'></font>
<font color=#447700>! Note: functions have been normalized by dividing by their values at<a name='2909'></font>
<font color=#447700>!       a path temperature of 160K<a name='2910'></font>
<font color=#447700>!<a name='2911'></font>
<font color=#447700>! spectral intervals:<a name='2912'></font>
<font color=#447700>!   1 = 0-800 cm^-1 and 1200-2200 cm^-1<a name='2913'></font>
<font color=#447700>!   2 = 800-1200 cm^-1<a name='2914'></font>
<font color=#447700>!<a name='2915'></font>
<font color=#447700>! Formulae: Goody and Yung, Atmospheric Radiation: Theoretical Basis,<a name='2916'></font>
<font color=#447700>!           2nd edition, Oxford University Press, 1989.<a name='2917'></font>
<font color=#447700>! Phi: function for H2O path<a name='2918'></font>
<font color=#447700>!      eq. 6.25, p. 228<a name='2919'></font>
<font color=#447700>!<a name='2920'></font>
   real(r8),intent(in):: tpx      <font color=#447700>! path temperature<a name='2921'></font>
   integer, intent(in):: iband    <font color=#447700>! band to process<a name='2922'></font>
   real(r8) phi                   <font color=#447700>! phi for given band<a name='2923'></font>
   real(r8),parameter ::  phi_r0(nbands) = (/ 9.60917711E-01, -2.21031342E+01/)<a name='2924'>
   real(r8),parameter ::  phi_r1(nbands) = (/ 4.86076751E-04,  4.24062610E-01/)<a name='2925'>
   real(r8),parameter ::  phi_r2(nbands) = (/-1.84806265E-06, -2.95543415E-03/)<a name='2926'>
   real(r8),parameter ::  phi_r3(nbands) = (/ 2.11239959E-09,  7.52470896E-06/)<a name='2927'>
<a name='2928'>
   phi = (((phi_r3(iband) * tpx) + phi_r2(iband)) * tpx + phi_r1(iband)) &amp;<a name='2929'>
          * tpx + phi_r0(iband)<a name='2930'>
end function phi<a name='2931'>
<a name='2932'>
<A NAME='FH2OSELF'><A href='../../html_code/phys/module_ra_cam_support.F.html#FH2OSELF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2933'>
<font color=#993300>function </font><font color=#cc0000>fh2oself</font>( temp ) <A href='../../call_to/FH2OSELF.html' TARGET='index'>2</A><a name='2934'>
<font color=#447700>!<a name='2935'></font>
<font color=#447700>! Short function for H2O self-continuum temperature factor in<a name='2936'></font>
<font color=#447700>!   calculation of effective H2O self-continuum path length<a name='2937'></font>
<font color=#447700>!<a name='2938'></font>
<font color=#447700>! H2O Continuum: CKD 2.4<a name='2939'></font>
<font color=#447700>! Code for continuum: GENLN3<a name='2940'></font>
<font color=#447700>! Reference: Edwards, D.P., 1992: GENLN2, A General Line-by-Line Atmospheric<a name='2941'></font>
<font color=#447700>!                     Transmittance and Radiance Model, Version 3.0 Description<a name='2942'></font>
<font color=#447700>!                     and Users Guide, NCAR/TN-367+STR, 147 pp.<a name='2943'></font>
<font color=#447700>!<a name='2944'></font>
<font color=#447700>! In GENLN, the temperature scaling of the self-continuum is handled<a name='2945'></font>
<font color=#447700>!    by exponential interpolation/extrapolation from observations at<a name='2946'></font>
<font color=#447700>!    260K and 296K by:<a name='2947'></font>
<font color=#447700>!<a name='2948'></font>
<font color=#447700>!         TFAC =  (T(IPATH) - 296.0)/(260.0 - 296.0)<a name='2949'></font>
<font color=#447700>!         CSFFT = CSFF296*(CSFF260/CSFF296)**TFAC<a name='2950'></font>
<font color=#447700>!<a name='2951'></font>
<font color=#447700>! For 800-1200 cm^-1, (CSFF260/CSFF296) ranges from ~2.1 to ~1.9<a name='2952'></font>
<font color=#447700>!     with increasing wavenumber.  The ratio &lt;CSFF260&gt;/&lt;CSFF296&gt;,<a name='2953'></font>
<font color=#447700>!     where &lt;&gt; indicates average over wavenumber, is ~2.07<a name='2954'></font>
<font color=#447700>!<a name='2955'></font>
<font color=#447700>! fh2oself is (&lt;CSFF260&gt;/&lt;CSFF296&gt;)**TFAC<a name='2956'></font>
<font color=#447700>!<a name='2957'></font>
   real(r8),intent(in) :: temp     <font color=#447700>! path temperature<a name='2958'></font>
   real(r8) fh2oself               <font color=#447700>! mean ratio of self-continuum at temp and 296K<a name='2959'></font>
<a name='2960'>
   fh2oself = 2.0727484**((296.0 - temp) / 36.0)<a name='2961'>
end function fh2oself<a name='2962'>
<a name='2963'>
<font color=#447700>! from wv_saturation.F90<a name='2964'></font>
<a name='2965'>
<A NAME='ESINTI'><A href='../../html_code/phys/module_ra_cam_support.F.html#ESINTI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2966'>
<font color=#993300>subroutine </font><font color=#cc0000>esinti</font>(epslon  ,latvap  ,latice  ,rh2o    ,cpair   ,tmelt   ) <A href='../../call_to/ESINTI.html' TARGET='index'>2</A>,<A href='../../call_from/ESINTI.html' TARGET='index'>4</A><a name='2967'>
<font color=#447700>!----------------------------------------------------------------------- <a name='2968'></font>
<font color=#447700>! <a name='2969'></font>
<font color=#447700>! Purpose: <a name='2970'></font>
<font color=#447700>! Initialize es lookup tables<a name='2971'></font>
<font color=#447700>! <a name='2972'></font>
<font color=#447700>! Method: <a name='2973'></font>
<font color=#447700>! &lt;Describe the algorithm(s) used in the routine.&gt; <a name='2974'></font>
<font color=#447700>! &lt;Also include any applicable external references.&gt; <a name='2975'></font>
<font color=#447700>! <a name='2976'></font>
<font color=#447700>! Author: J. Hack<a name='2977'></font>
<font color=#447700>! <a name='2978'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2979'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='2980'></font>
<font color=#447700>!  use wv_saturation, only: gestbl<a name='2981'></font>
   implicit none<a name='2982'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='2983'></font>
<font color=#447700>!<a name='2984'></font>
<font color=#447700>! Input arguments<a name='2985'></font>
<font color=#447700>!<a name='2986'></font>
   real(r8), intent(in) :: epslon          <font color=#447700>! Ratio of h2o to dry air molecular weights<a name='2987'></font>
   real(r8), intent(in) :: latvap          <font color=#447700>! Latent heat of vaporization<a name='2988'></font>
   real(r8), intent(in) :: latice          <font color=#447700>! Latent heat of fusion<a name='2989'></font>
   real(r8), intent(in) :: rh2o            <font color=#447700>! Gas constant for water vapor<a name='2990'></font>
   real(r8), intent(in) :: cpair           <font color=#447700>! Specific heat of dry air<a name='2991'></font>
   real(r8), intent(in) :: tmelt           <font color=#447700>! Melting point of water (K)<a name='2992'></font>
<font color=#447700>!<a name='2993'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='2994'></font>
<font color=#447700>!<a name='2995'></font>
   real(r8) tmn             <font color=#447700>! Minimum temperature entry in table<a name='2996'></font>
   real(r8) tmx             <font color=#447700>! Maximum temperature entry in table<a name='2997'></font>
   real(r8) trice           <font color=#447700>! Trans range from es over h2o to es over ice<a name='2998'></font>
   logical ip           <font color=#447700>! Ice phase (true or false)<a name='2999'></font>
<font color=#447700>!<a name='3000'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3001'></font>
<font color=#447700>!<a name='3002'></font>
<font color=#447700>! Specify control parameters first<a name='3003'></font>
<font color=#447700>!<a name='3004'></font>
   tmn   = 173.16<a name='3005'>
   tmx   = 375.16<a name='3006'>
   trice =  20.00<a name='3007'>
   ip    = .true.<a name='3008'>
<font color=#447700>!<a name='3009'></font>
<font color=#447700>! Call gestbl to build saturation vapor pressure table.<a name='3010'></font>
<font color=#447700>!<a name='3011'></font>
   call <A href='../../html_code/phys/module_ra_cam_support.F.html#GESTBL'>gestbl</A><A href='../../html_code/phys/module_ra_cam_support.F.html#ESINTI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GESTBL_2">(tmn     ,tmx     ,trice   ,ip      ,epslon  , &amp;<a name='3012'>
               latvap  ,latice  ,rh2o    ,cpair   ,tmelt )<a name='3013'>
<font color=#447700>!<a name='3014'></font>
   return<a name='3015'>
end subroutine esinti<a name='3016'>
<a name='3017'>
<A NAME='GESTBL'><A href='../../html_code/phys/module_ra_cam_support.F.html#GESTBL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3018'>
<font color=#993300>subroutine </font><font color=#cc0000>gestbl</font>(tmn     ,tmx     ,trice   ,ip      ,epsil   , &amp; <A href='../../call_to/GESTBL.html' TARGET='index'>2</A>,<A href='../../call_from/GESTBL.html' TARGET='index'>8</A><a name='3019'>
                  latvap  ,latice  ,rh2o    ,cpair   ,tmeltx   )<a name='3020'>
<font color=#447700>!-----------------------------------------------------------------------<a name='3021'></font>
<font color=#447700>!<a name='3022'></font>
<font color=#447700>! Purpose:<a name='3023'></font>
<font color=#447700>! Builds saturation vapor pressure table for later lookup procedure.<a name='3024'></font>
<font color=#447700>!<a name='3025'></font>
<font color=#447700>! Method:<a name='3026'></font>
<font color=#447700>! Uses Goff &amp; Gratch (1946) relationships to generate the table<a name='3027'></font>
<font color=#447700>! according to a set of free parameters defined below.  Auxiliary<a name='3028'></font>
<font color=#447700>! routines are also included for making rapid estimates (well with 1%)<a name='3029'></font>
<font color=#447700>! of both es and d(es)/dt for the particular table configuration.<a name='3030'></font>
<font color=#447700>!<a name='3031'></font>
<font color=#447700>! Author: J. Hack<a name='3032'></font>
<font color=#447700>!<a name='3033'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3034'></font>
<font color=#447700>!  use pmgrid, only: masterproc<a name='3035'></font>
   implicit none<a name='3036'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='3037'></font>
<font color=#447700>!<a name='3038'></font>
<font color=#447700>! Input arguments<a name='3039'></font>
<font color=#447700>!<a name='3040'></font>
   real(r8), intent(in) :: tmn           <font color=#447700>! Minimum temperature entry in es lookup table<a name='3041'></font>
   real(r8), intent(in) :: tmx           <font color=#447700>! Maximum temperature entry in es lookup table<a name='3042'></font>
   real(r8), intent(in) :: epsil         <font color=#447700>! Ratio of h2o to dry air molecular weights<a name='3043'></font>
   real(r8), intent(in) :: trice         <font color=#447700>! Transition range from es over range to es over ice<a name='3044'></font>
   real(r8), intent(in) :: latvap        <font color=#447700>! Latent heat of vaporization<a name='3045'></font>
   real(r8), intent(in) :: latice        <font color=#447700>! Latent heat of fusion<a name='3046'></font>
   real(r8), intent(in) :: rh2o          <font color=#447700>! Gas constant for water vapor<a name='3047'></font>
   real(r8), intent(in) :: cpair         <font color=#447700>! Specific heat of dry air<a name='3048'></font>
   real(r8), intent(in) :: tmeltx        <font color=#447700>! Melting point of water (K)<a name='3049'></font>
<font color=#447700>!<a name='3050'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='3051'></font>
<font color=#447700>!<a name='3052'></font>
   real(r8) t             <font color=#447700>! Temperature<a name='3053'></font>
   real(r8) rgasv <a name='3054'>
   real(r8) cp<a name='3055'>
   real(r8) hlatf<a name='3056'>
   real(r8) ttrice<a name='3057'>
   real(r8) hlatv<a name='3058'>
   integer n          <font color=#447700>! Increment counter<a name='3059'></font>
   integer lentbl     <font color=#447700>! Calculated length of lookup table<a name='3060'></font>
   integer itype      <font color=#447700>! Ice phase: 0 -&gt; no ice phase<a name='3061'></font>
<font color=#447700>!            1 -&gt; ice phase, no transition<a name='3062'></font>
<font color=#447700>!           -x -&gt; ice phase, x degree transition<a name='3063'></font>
   logical ip         <font color=#447700>! Ice phase logical flag<a name='3064'></font>
   logical icephs<a name='3065'>
<font color=#447700>!<a name='3066'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3067'></font>
<font color=#447700>!<a name='3068'></font>
<font color=#447700>! Set es table parameters<a name='3069'></font>
<font color=#447700>!<a name='3070'></font>
   tmin   = tmn       <font color=#447700>! Minimum temperature entry in table<a name='3071'></font>
   tmax   = tmx       <font color=#447700>! Maximum temperature entry in table<a name='3072'></font>
   ttrice = trice     <font color=#447700>! Trans. range from es over h2o to es over ice<a name='3073'></font>
   icephs = ip        <font color=#447700>! Ice phase (true or false)<a name='3074'></font>
<font color=#447700>!<a name='3075'></font>
<font color=#447700>! Set physical constants required for es calculation<a name='3076'></font>
<font color=#447700>!<a name='3077'></font>
   epsqs  = epsil<a name='3078'>
   hlatv  = latvap<a name='3079'>
   hlatf  = latice<a name='3080'>
   rgasv  = rh2o<a name='3081'>
   cp     = cpair<a name='3082'>
   tmelt  = tmeltx<a name='3083'>
<font color=#447700>!<a name='3084'></font>
   lentbl = INT(tmax-tmin+2.000001)<a name='3085'>
   if (lentbl .gt. plenest) then<a name='3086'>
      write(6,9000) tmax, tmin, plenest<a name='3087'>
      call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GESTBL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_38"> ('GESTBL')    <font color=#447700>! Abnormal termination<a name='3088'></font>
   end if<a name='3089'>
<font color=#447700>!<a name='3090'></font>
<font color=#447700>! Begin building es table.<a name='3091'></font>
<font color=#447700>! Check whether ice phase requested.<a name='3092'></font>
<font color=#447700>! If so, set appropriate transition range for temperature<a name='3093'></font>
<font color=#447700>!<a name='3094'></font>
   if (icephs) then<a name='3095'>
      if (ttrice /= 0.0) then<a name='3096'>
         itype = -ttrice<a name='3097'>
      else<a name='3098'>
         itype = 1<a name='3099'>
      end if<a name='3100'>
   else<a name='3101'>
      itype = 0<a name='3102'>
   end if<a name='3103'>
<font color=#447700>!<a name='3104'></font>
   t = tmin - 1.0<a name='3105'>
   do n=1,lentbl<a name='3106'>
      t = t + 1.0<a name='3107'>
      call <A href='../../html_code/phys/module_ra_cam_support.F.html#GFFGCH'>gffgch</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GESTBL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GFFGCH_2">(t,estbl(n),itype)<a name='3108'>
   end do<a name='3109'>
<font color=#447700>!<a name='3110'></font>
   do n=lentbl+1,plenest<a name='3111'>
      estbl(n) = -99999.0<a name='3112'>
   end do<a name='3113'>
<font color=#447700>!<a name='3114'></font>
<font color=#447700>! Table complete -- Set coefficients for polynomial approximation of<a name='3115'></font>
<font color=#447700>! difference between saturation vapor press over water and saturation<a name='3116'></font>
<font color=#447700>! pressure over ice for -ttrice &lt; t &lt; 0 (degrees C). NOTE: polynomial<a name='3117'></font>
<font color=#447700>! is valid in the range -40 &lt; t &lt; 0 (degrees C).<a name='3118'></font>
<font color=#447700>!<a name='3119'></font>
<font color=#447700>!                  --- Degree 5 approximation ---<a name='3120'></font>
<font color=#447700>!<a name='3121'></font>
   pcf(1) =  5.04469588506e-01<a name='3122'>
   pcf(2) = -5.47288442819e+00<a name='3123'>
   pcf(3) = -3.67471858735e-01<a name='3124'>
   pcf(4) = -8.95963532403e-03<a name='3125'>
   pcf(5) = -7.78053686625e-05<a name='3126'>
<font color=#447700>!<a name='3127'></font>
<font color=#447700>!                  --- Degree 6 approximation ---<a name='3128'></font>
<font color=#447700>!<a name='3129'></font>
<font color=#447700>!-----pcf(1) =  7.63285250063e-02<a name='3130'></font>
<font color=#447700>!-----pcf(2) = -5.86048427932e+00<a name='3131'></font>
<font color=#447700>!-----pcf(3) = -4.38660831780e-01<a name='3132'></font>
<font color=#447700>!-----pcf(4) = -1.37898276415e-02<a name='3133'></font>
<font color=#447700>!-----pcf(5) = -2.14444472424e-04<a name='3134'></font>
<font color=#447700>!-----pcf(6) = -1.36639103771e-06<a name='3135'></font>
<font color=#447700>!<a name='3136'></font>
   if (masterproc) then<a name='3137'>
      write(6,*)' *** SATURATION VAPOR PRESSURE TABLE COMPLETED ***'<a name='3138'>
   end if<a name='3139'>
<a name='3140'>
   return<a name='3141'>
<font color=#447700>!<a name='3142'></font>
9000 format('GESTBL: FATAL ERROR *********************************',/, &amp;<a name='3143'>
            ' TMAX AND TMIN REQUIRE A LARGER DIMENSION ON THE LENGTH', &amp;<a name='3144'>
            ' OF THE SATURATION VAPOR PRESSURE TABLE ESTBL(PLENEST)',/, &amp;<a name='3145'>
            ' TMAX, TMIN, AND PLENEST =&gt; ', 2f7.2, i3)<a name='3146'>
<font color=#447700>!<a name='3147'></font>
end subroutine gestbl<a name='3148'>
<a name='3149'>
<A NAME='GFFGCH'><A href='../../html_code/phys/module_ra_cam_support.F.html#GFFGCH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3150'>
<font color=#993300>subroutine </font><font color=#cc0000>gffgch</font>(t       ,es      ,itype   ) <A href='../../call_to/GFFGCH.html' TARGET='index'>3</A>,<A href='../../call_from/GFFGCH.html' TARGET='index'>6</A><a name='3151'>
<font color=#447700>!----------------------------------------------------------------------- <a name='3152'></font>
<font color=#447700>! <a name='3153'></font>
<font color=#447700>! Purpose: <a name='3154'></font>
<font color=#447700>! Computes saturation vapor pressure over water and/or over ice using<a name='3155'></font>
<font color=#447700>! Goff &amp; Gratch (1946) relationships. <a name='3156'></font>
<font color=#447700>! &lt;Say what the routine does&gt; <a name='3157'></font>
<font color=#447700>! <a name='3158'></font>
<font color=#447700>! Method: <a name='3159'></font>
<font color=#447700>! T (temperature), and itype are input parameters, while es (saturation<a name='3160'></font>
<font color=#447700>! vapor pressure) is an output parameter.  The input parameter itype<a name='3161'></font>
<font color=#447700>! serves two purposes: a value of zero indicates that saturation vapor<a name='3162'></font>
<font color=#447700>! pressures over water are to be returned (regardless of temperature),<a name='3163'></font>
<font color=#447700>! while a value of one indicates that saturation vapor pressures over<a name='3164'></font>
<font color=#447700>! ice should be returned when t is less than freezing degrees.  If itype<a name='3165'></font>
<font color=#447700>! is negative, its absolute value is interpreted to define a temperature<a name='3166'></font>
<font color=#447700>! transition region below freezing in which the returned<a name='3167'></font>
<font color=#447700>! saturation vapor pressure is a weighted average of the respective ice<a name='3168'></font>
<font color=#447700>! and water value.  That is, in the temperature range 0 =&gt; -itype<a name='3169'></font>
<font color=#447700>! degrees c, the saturation vapor pressures are assumed to be a weighted<a name='3170'></font>
<font color=#447700>! average of the vapor pressure over supercooled water and ice (all<a name='3171'></font>
<font color=#447700>! water at 0 c; all ice at -itype c).  Maximum transition range =&gt; 40 c<a name='3172'></font>
<font color=#447700>! <a name='3173'></font>
<font color=#447700>! Author: J. Hack<a name='3174'></font>
<font color=#447700>! <a name='3175'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3176'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='3177'></font>
<font color=#447700>!  use physconst, only: tmelt<a name='3178'></font>
<font color=#447700>!  use abortutils, only: endrun<a name='3179'></font>
    <a name='3180'>
   implicit none<a name='3181'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='3182'></font>
<font color=#447700>!<a name='3183'></font>
<font color=#447700>! Input arguments<a name='3184'></font>
<font color=#447700>!<a name='3185'></font>
   real(r8), intent(in) :: t          <font color=#447700>! Temperature<a name='3186'></font>
<font color=#447700>!<a name='3187'></font>
<font color=#447700>! Output arguments<a name='3188'></font>
<font color=#447700>!<a name='3189'></font>
   integer, intent(inout) :: itype   <font color=#447700>! Flag for ice phase and associated transition<a name='3190'></font>
<a name='3191'>
   real(r8), intent(out) :: es         <font color=#447700>! Saturation vapor pressure<a name='3192'></font>
<font color=#447700>!<a name='3193'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='3194'></font>
<font color=#447700>!<a name='3195'></font>
   real(r8) e1         <font color=#447700>! Intermediate scratch variable for es over water<a name='3196'></font>
   real(r8) e2         <font color=#447700>! Intermediate scratch variable for es over water<a name='3197'></font>
   real(r8) eswtr      <font color=#447700>! Saturation vapor pressure over water<a name='3198'></font>
   real(r8) f          <font color=#447700>! Intermediate scratch variable for es over water<a name='3199'></font>
   real(r8) f1         <font color=#447700>! Intermediate scratch variable for es over water<a name='3200'></font>
   real(r8) f2         <font color=#447700>! Intermediate scratch variable for es over water<a name='3201'></font>
   real(r8) f3         <font color=#447700>! Intermediate scratch variable for es over water<a name='3202'></font>
   real(r8) f4         <font color=#447700>! Intermediate scratch variable for es over water<a name='3203'></font>
   real(r8) f5         <font color=#447700>! Intermediate scratch variable for es over water<a name='3204'></font>
   real(r8) ps         <font color=#447700>! Reference pressure (mb)<a name='3205'></font>
   real(r8) t0         <font color=#447700>! Reference temperature (freezing point of water)<a name='3206'></font>
   real(r8) term1      <font color=#447700>! Intermediate scratch variable for es over ice<a name='3207'></font>
   real(r8) term2      <font color=#447700>! Intermediate scratch variable for es over ice<a name='3208'></font>
   real(r8) term3      <font color=#447700>! Intermediate scratch variable for es over ice<a name='3209'></font>
   real(r8) tr         <font color=#447700>! Transition range for es over water to es over ice<a name='3210'></font>
   real(r8) ts         <font color=#447700>! Reference temperature (boiling point of water)<a name='3211'></font>
   real(r8) weight     <font color=#447700>! Intermediate scratch variable for es transition<a name='3212'></font>
   integer itypo   <font color=#447700>! Intermediate scratch variable for holding itype<a name='3213'></font>
<font color=#447700>!<a name='3214'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3215'></font>
<font color=#447700>!<a name='3216'></font>
<font color=#447700>! Check on whether there is to be a transition region for es<a name='3217'></font>
<font color=#447700>!<a name='3218'></font>
   if (itype &lt; 0) then<a name='3219'>
      tr    = abs(float(itype))<a name='3220'>
      itypo = itype<a name='3221'>
      itype = 1<a name='3222'>
   else<a name='3223'>
      tr    = 0.0<a name='3224'>
      itypo = itype<a name='3225'>
   end if<a name='3226'>
   if (tr &gt; 40.0) then<a name='3227'>
      write(6,900) tr<a name='3228'>
      call <A href='../../html_code/phys/module_sf_clm.F.html#ENDRUN'>endrun</A><A href='../../html_code/phys/module_ra_cam_support.F.html#GFFGCH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENDRUN_39"> ('GFFGCH')                <font color=#447700>! Abnormal termination<a name='3229'></font>
   end if<a name='3230'>
<font color=#447700>!<a name='3231'></font>
   if(t &lt; (tmelt - tr) .and. itype == 1) go to 10<a name='3232'>
<font color=#447700>!<a name='3233'></font>
<font color=#447700>! Water<a name='3234'></font>
<font color=#447700>!<a name='3235'></font>
   ps = 1013.246<a name='3236'>
   ts = 373.16<a name='3237'>
   e1 = 11.344*(1.0 - t/ts)<a name='3238'>
   e2 = -3.49149*(ts/t - 1.0)<a name='3239'>
   f1 = -7.90298*(ts/t - 1.0)<a name='3240'>
   f2 = 5.02808*log10(ts/t)<a name='3241'>
   f3 = -1.3816*(10.0**e1 - 1.0)/10000000.0<a name='3242'>
   f4 = 8.1328*(10.0**e2 - 1.0)/1000.0<a name='3243'>
   f5 = log10(ps)<a name='3244'>
   f  = f1 + f2 + f3 + f4 + f5<a name='3245'>
   es = (10.0**f)*100.0<a name='3246'>
   eswtr = es<a name='3247'>
<font color=#447700>!<a name='3248'></font>
   if(t &gt;= tmelt .or. itype == 0) go to 20<a name='3249'>
<font color=#447700>!<a name='3250'></font>
<font color=#447700>! Ice<a name='3251'></font>
<font color=#447700>!<a name='3252'></font>
10 continue<a name='3253'>
   t0    = tmelt<a name='3254'>
   term1 = 2.01889049/(t0/t)<a name='3255'>
   term2 = 3.56654*log(t0/t)<a name='3256'>
   term3 = 20.947031*(t0/t)<a name='3257'>
   es    = 575.185606e10*exp(-(term1 + term2 + term3))<a name='3258'>
<font color=#447700>!<a name='3259'></font>
   if (t &lt; (tmelt - tr)) go to 20<a name='3260'>
<font color=#447700>!<a name='3261'></font>
<font color=#447700>! Weighted transition between water and ice<a name='3262'></font>
<font color=#447700>!<a name='3263'></font>
   weight = min((tmelt - t)/tr,1.0_r8)<a name='3264'>
   es = weight*es + (1.0 - weight)*eswtr<a name='3265'>
<font color=#447700>!<a name='3266'></font>
20 continue<a name='3267'>
   itype = itypo<a name='3268'>
   return<a name='3269'>
<font color=#447700>!<a name='3270'></font>
900 format('GFFGCH: FATAL ERROR ******************************',/, &amp;<a name='3271'>
           'TRANSITION RANGE FOR WATER TO ICE SATURATION VAPOR', &amp;<a name='3272'>
           ' PRESSURE, TR, EXCEEDS MAXIMUM ALLOWABLE VALUE OF', &amp;<a name='3273'>
           ' 40.0 DEGREES C',/, ' TR = ',f7.2)<a name='3274'>
<font color=#447700>!<a name='3275'></font>
end subroutine gffgch<a name='3276'>
<a name='3277'>
<A NAME='ESTBLF'><A href='../../html_code/phys/module_ra_cam_support.F.html#ESTBLF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3278'>
   real(r8) <font color=#993300>function </font><font color=#cc0000>estblf</font>( td ) <A href='../../call_to/ESTBLF.html' TARGET='index'>18</A><a name='3279'>
<font color=#447700>!<a name='3280'></font>
<font color=#447700>! Saturation vapor pressure table lookup<a name='3281'></font>
<font color=#447700>!<a name='3282'></font>
   real(r8), intent(in) :: td         <font color=#447700>! Temperature for saturation lookup<a name='3283'></font>
<font color=#447700>!<a name='3284'></font>
   real(r8) :: e       <font color=#447700>! intermediate variable for es look-up<a name='3285'></font>
   real(r8) :: ai<a name='3286'>
   integer  :: i<a name='3287'>
<font color=#447700>!<a name='3288'></font>
   e = max(min(td,tmax),tmin)   <font color=#447700>! partial pressure<a name='3289'></font>
   i = int(e-tmin)+1<a name='3290'>
   ai = aint(e-tmin)<a name='3291'>
   estblf = (tmin+ai-e+1.)* &amp;<a name='3292'>
            estbl(i)-(tmin+ai-e)* &amp;<a name='3293'>
            estbl(i+1)<a name='3294'>
   end function estblf<a name='3295'>
<a name='3296'>
<a name='3297'>
<A NAME='FINDVALUE'><A href='../../html_code/phys/module_ra_cam_support.F.html#FINDVALUE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3298'>
<font color=#993300>function </font><font color=#cc0000>findvalue</font>(ix,n,ain,indxa) <A href='../../call_to/FINDVALUE.html' TARGET='index'>1</A><a name='3299'>
<font color=#447700>!----------------------------------------------------------------------- <a name='3300'></font>
<font color=#447700>! <a name='3301'></font>
<font color=#447700>! Purpose: <a name='3302'></font>
<font color=#447700>! Subroutine for finding ix-th smallest value in the array<a name='3303'></font>
<font color=#447700>! The elements are rearranged so that the ix-th smallest<a name='3304'></font>
<font color=#447700>! element is in the ix place and all smaller elements are<a name='3305'></font>
<font color=#447700>! moved to the elements up to ix (with random order).<a name='3306'></font>
<font color=#447700>!<a name='3307'></font>
<font color=#447700>! Algorithm: Based on the quicksort algorithm.<a name='3308'></font>
<font color=#447700>!<a name='3309'></font>
<font color=#447700>! Author:       T. Craig<a name='3310'></font>
<font color=#447700>! <a name='3311'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3312'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='3313'></font>
   implicit none<a name='3314'>
<font color=#447700>!<a name='3315'></font>
<font color=#447700>! arguments<a name='3316'></font>
<font color=#447700>!<a name='3317'></font>
   integer, intent(in) :: ix                <font color=#447700>! element to search for<a name='3318'></font>
   integer, intent(in) :: n                 <font color=#447700>! total number of elements<a name='3319'></font>
   integer, intent(inout):: indxa(n)        <font color=#447700>! array of integers<a name='3320'></font>
   real(r8), intent(in) :: ain(n)           <font color=#447700>! array to search<a name='3321'></font>
<font color=#447700>!<a name='3322'></font>
   integer findvalue                        <font color=#447700>! return value<a name='3323'></font>
<font color=#447700>!<a name='3324'></font>
<font color=#447700>! local variables<a name='3325'></font>
<font color=#447700>!<a name='3326'></font>
   integer i,j<a name='3327'>
   integer il,im,ir<a name='3328'>
<a name='3329'>
   integer ia<a name='3330'>
   integer itmp<a name='3331'>
<font color=#447700>!<a name='3332'></font>
<font color=#447700>!---------------------------Routine-----------------------------<a name='3333'></font>
<font color=#447700>!<a name='3334'></font>
   il=1<a name='3335'>
   ir=n<a name='3336'>
   do<a name='3337'>
      if (ir-il &lt;= 1) then<a name='3338'>
         if (ir-il == 1) then<a name='3339'>
            if (ain(indxa(ir)) &lt; ain(indxa(il))) then<a name='3340'>
               itmp=indxa(il)<a name='3341'>
               indxa(il)=indxa(ir)<a name='3342'>
               indxa(ir)=itmp<a name='3343'>
            endif<a name='3344'>
         endif<a name='3345'>
         findvalue=indxa(ix)<a name='3346'>
         return<a name='3347'>
      else<a name='3348'>
         im=(il+ir)/2<a name='3349'>
         itmp=indxa(im)<a name='3350'>
         indxa(im)=indxa(il+1)<a name='3351'>
         indxa(il+1)=itmp<a name='3352'>
         if (ain(indxa(il+1)) &gt; ain(indxa(ir))) then<a name='3353'>
            itmp=indxa(il+1)<a name='3354'>
            indxa(il+1)=indxa(ir)<a name='3355'>
            indxa(ir)=itmp<a name='3356'>
         endif<a name='3357'>
         if (ain(indxa(il)) &gt; ain(indxa(ir))) then<a name='3358'>
            itmp=indxa(il)<a name='3359'>
            indxa(il)=indxa(ir)<a name='3360'>
            indxa(ir)=itmp<a name='3361'>
         endif<a name='3362'>
         if (ain(indxa(il+1)) &gt; ain(indxa(il))) then<a name='3363'>
            itmp=indxa(il+1)<a name='3364'>
            indxa(il+1)=indxa(il)<a name='3365'>
            indxa(il)=itmp<a name='3366'>
         endif<a name='3367'>
         i=il+1<a name='3368'>
         j=ir<a name='3369'>
         ia=indxa(il)<a name='3370'>
         do<a name='3371'>
            do<a name='3372'>
               i=i+1<a name='3373'>
               if (ain(indxa(i)) &gt;= ain(ia)) exit<a name='3374'>
            end do<a name='3375'>
            do<a name='3376'>
               j=j-1<a name='3377'>
               if (ain(indxa(j)) &lt;= ain(ia)) exit<a name='3378'>
            end do<a name='3379'>
            if (j &lt; i) exit<a name='3380'>
            itmp=indxa(i)<a name='3381'>
            indxa(i)=indxa(j)<a name='3382'>
            indxa(j)=itmp<a name='3383'>
         end do<a name='3384'>
         indxa(il)=indxa(j)<a name='3385'>
         indxa(j)=ia<a name='3386'>
         if (j &gt;= ix)ir=j-1<a name='3387'>
         if (j &lt;= ix)il=i<a name='3388'>
      endif<a name='3389'>
   end do<a name='3390'>
end function findvalue<a name='3391'>
<a name='3392'>
<a name='3393'>
<A NAME='RADINI'><A href='../../html_code/phys/module_ra_cam_support.F.html#RADINI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3394'>
<font color=#993300>subroutine </font><font color=#cc0000>radini</font>(gravx   ,cpairx  ,epsilox ,stebolx, pstdx ) <A href='../../call_to/RADINI.html' TARGET='index'>1</A>,<A href='../../call_from/RADINI.html' TARGET='index'>1</A><a name='3395'>
<font color=#447700>!----------------------------------------------------------------------- <a name='3396'></font>
<font color=#447700>! <a name='3397'></font>
<font color=#447700>! Purpose: <a name='3398'></font>
<font color=#447700>! Initialize various constants for radiation scheme; note that<a name='3399'></font>
<font color=#447700>! the radiation scheme uses cgs units.<a name='3400'></font>
<font color=#447700>! <a name='3401'></font>
<font color=#447700>! Method: <a name='3402'></font>
<font color=#447700>! &lt;Describe the algorithm(s) used in the routine.&gt; <a name='3403'></font>
<font color=#447700>! &lt;Also include any applicable external references.&gt; <a name='3404'></font>
<font color=#447700>! <a name='3405'></font>
<font color=#447700>! Author: W. Collins (H2O parameterization) and J. Kiehl<a name='3406'></font>
<font color=#447700>! <a name='3407'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3408'></font>
<font color=#447700>!  use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='3409'></font>
<font color=#447700>!  use ppgrid,       only: pver, pverp<a name='3410'></font>
<font color=#447700>!  use comozp,       only: cplos, cplol<a name='3411'></font>
<font color=#447700>!  use pmgrid,       only: masterproc, plev, plevp<a name='3412'></font>
<font color=#447700>!  use radae,        only: radaeini<a name='3413'></font>
<font color=#447700>!  use physconst,    only: mwdry, mwco2<a name='3414'></font>
#if ( defined SPMD )<a name='3415'>
<font color=#447700>!   use mpishorthand<a name='3416'></font>
#endif<a name='3417'>
   implicit none<a name='3418'>
<a name='3419'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='3420'></font>
<font color=#447700>!<a name='3421'></font>
<font color=#447700>! Input arguments<a name='3422'></font>
<font color=#447700>!<a name='3423'></font>
   real, intent(in) :: gravx      <font color=#447700>! Acceleration of gravity (MKS)<a name='3424'></font>
   real, intent(in) :: cpairx     <font color=#447700>! Specific heat of dry air (MKS)<a name='3425'></font>
   real, intent(in) :: epsilox    <font color=#447700>! Ratio of mol. wght of H2O to dry air<a name='3426'></font>
   real, intent(in) :: stebolx    <font color=#447700>! Stefan-Boltzmann's constant (MKS)<a name='3427'></font>
   real(r8), intent(in) :: pstdx      <font color=#447700>! Standard pressure (Pascals)<a name='3428'></font>
<font color=#447700>!<a name='3429'></font>
<font color=#447700>!---------------------------Local variables-----------------------------<a name='3430'></font>
<font color=#447700>!<a name='3431'></font>
   integer k       <font color=#447700>! Loop variable<a name='3432'></font>
<a name='3433'>
   real(r8) v0         <font color=#447700>! Volume of a gas at stp (m**3/kmol)<a name='3434'></font>
   real(r8) p0         <font color=#447700>! Standard pressure (pascals)<a name='3435'></font>
   real(r8) amd        <font color=#447700>! Effective molecular weight of dry air (kg/kmol)<a name='3436'></font>
   real(r8) goz        <font color=#447700>! Acceleration of gravity (m/s**2)<a name='3437'></font>
<font color=#447700>!<a name='3438'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3439'></font>
<font color=#447700>!<a name='3440'></font>
<font color=#447700>! Set general radiation consts; convert to cgs units where appropriate:<a name='3441'></font>
<font color=#447700>!<a name='3442'></font>
   gravit  =  100.*gravx<a name='3443'>
   rga     =  1./gravit<a name='3444'>
   gravmks =  gravx<a name='3445'>
   cpair   =  1.e4*cpairx<a name='3446'>
   epsilo  =  epsilox<a name='3447'>
   sslp    =  1.013250e6<a name='3448'>
   stebol  =  1.e3*stebolx<a name='3449'>
   rgsslp  =  0.5/(gravit*sslp)<a name='3450'>
   dpfo3   =  2.5e-3<a name='3451'>
   dpfco2  =  5.0e-3<a name='3452'>
   dayspy  =  365.<a name='3453'>
   pie     =  4.*atan(1.)<a name='3454'>
<font color=#447700>!<a name='3455'></font>
<font color=#447700>! Initialize ozone data.<a name='3456'></font>
<font color=#447700>!<a name='3457'></font>
   v0  = 22.4136         <font color=#447700>! Volume of a gas at stp (m**3/kmol)<a name='3458'></font>
   p0  = 0.1*sslp        <font color=#447700>! Standard pressure (pascals)<a name='3459'></font>
   amd = 28.9644         <font color=#447700>! Molecular weight of dry air (kg/kmol)<a name='3460'></font>
   goz = gravx           <font color=#447700>! Acceleration of gravity (m/s**2)<a name='3461'></font>
<font color=#447700>!<a name='3462'></font>
<font color=#447700>! Constants for ozone path integrals (multiplication by 100 for unit<a name='3463'></font>
<font color=#447700>! conversion to cgs from mks):<a name='3464'></font>
<font color=#447700>!<a name='3465'></font>
   cplos = v0/(amd*goz)       *100.0<a name='3466'>
   cplol = v0/(amd*goz*p0)*0.5*100.0<a name='3467'>
<font color=#447700>!<a name='3468'></font>
<font color=#447700>! Derived constants<a name='3469'></font>
<font color=#447700>! If the top model level is above ~90 km (0.1 Pa), set the top level to compute<a name='3470'></font>
<font color=#447700>! longwave cooling to about 80 km (1 Pa)<a name='3471'></font>
<font color=#447700>! WRF: assume top level &gt; 0.1 mb<a name='3472'></font>
<font color=#447700>!  if (hypm(1) .lt. 0.1) then<a name='3473'></font>
<font color=#447700>!     do k = 1, pver<a name='3474'></font>
<font color=#447700>!        if (hypm(k) .lt. 1.) ntoplw  = k<a name='3475'></font>
<font color=#447700>!     end do<a name='3476'></font>
<font color=#447700>!  else<a name='3477'></font>
      ntoplw = 1<a name='3478'>
<font color=#447700>!  end if<a name='3479'></font>
<font color=#447700>!   if (masterproc) then<a name='3480'></font>
<font color=#447700>!     write (6,*) 'RADINI: ntoplw =',ntoplw, ' pressure:',hypm(ntoplw)<a name='3481'></font>
<font color=#447700>!   endif<a name='3482'></font>
<a name='3483'>
   call <A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI'>radaeini</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADAEINI_1">( pstdx, mwdry, mwco2 )<a name='3484'>
   return<a name='3485'>
end subroutine radini<a name='3486'>
<a name='3487'>
<A NAME='OZNINI'><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3488'>
<font color=#993300>subroutine </font><font color=#cc0000>oznini</font>(ozmixm,pin,levsiz,num_months,XLAT,                &amp; <A href='../../call_to/OZNINI.html' TARGET='index'>2</A>,<A href='../../call_from/OZNINI.html' TARGET='index'>8</A><a name='3489'>
                     ids, ide, jds, jde, kds, kde,                  &amp;<a name='3490'>
                     ims, ime, jms, jme, kms, kme,                  &amp;<a name='3491'>
                     its, ite, jts, jte, kts, kte)<a name='3492'>
<font color=#447700>!<a name='3493'></font>
<font color=#447700>! This subroutine assumes uniform distribution of ozone concentration.<a name='3494'></font>
<font color=#447700>! It should be replaced by monthly climatology that varies latitudinally and vertically<a name='3495'></font>
<font color=#447700>!<a name='3496'></font>
<a name='3497'>
#if ( defined( DM_PARALLEL ) &amp;&amp; ( <font color=#447700>! defined( STUBMPI ) ) )<a name='3498'></font>
  use mpi<a name='3499'>
  use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_161">, only: local_communicator<a name='3500'>
#endif<a name='3501'>
      IMPLICIT NONE<a name='3502'>
<a name='3503'>
   INTEGER,      INTENT(IN   )    ::   ids,ide, jds,jde, kds,kde, &amp;<a name='3504'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='3505'>
                                       its,ite, jts,jte, kts,kte   <a name='3506'>
<a name='3507'>
   INTEGER,      INTENT(IN   )    ::   levsiz, num_months<a name='3508'>
<a name='3509'>
   REAL,  DIMENSION( ims:ime, jms:jme ), INTENT(IN   )  ::     XLAT<a name='3510'>
<a name='3511'>
   REAL,  DIMENSION( ims:ime, levsiz, jms:jme, num_months ),      &amp;<a name='3512'>
          INTENT(OUT   ) ::                                  OZMIXM<a name='3513'>
<a name='3514'>
   REAL,  DIMENSION(levsiz), INTENT(OUT )  ::                   PIN<a name='3515'>
<a name='3516'>
<font color=#447700>! Local<a name='3517'></font>
   INTEGER, PARAMETER :: latsiz = 64<a name='3518'>
   INTEGER, PARAMETER :: lonsiz = 1<a name='3519'>
   INTEGER :: i, j, k, itf, jtf, ktf, m, pin_unit, lat_unit, oz_unit, ierr<a name='3520'>
   REAL    :: interp_pt<a name='3521'>
   CHARACTER*255 :: message<a name='3522'>
   real, pointer :: ozmixin(:,:,:,:), lat_ozone(:), plev(:)<a name='3523'>
<font color=#447700>!   REAL, DIMENSION( lonsiz, levsiz, latsiz, num_months )    ::   &amp;<a name='3524'></font>
<font color=#447700>!                                                            OZMIXIN<a name='3525'></font>
<a name='3526'>
   logical, external :: wrf_dm_on_monitor<a name='3527'>
<a name='3528'>
   jtf=min0(jte,jde-1)<a name='3529'>
   ktf=min0(kte,kde-1)<a name='3530'>
   itf=min0(ite,ide-1)<a name='3531'>
<a name='3532'>
   if_have_ozone: if(.not.have_ozone) then<a name='3533'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_763">(1,'Do not have ozone.  Must read it in.')<a name='3534'>
    <font color=#447700>! Allocate and set local aliases:<a name='3535'></font>
    levsiz_ozone_save=levsiz<a name='3536'>
    allocate(plev_ozone_save(levsiz),lat_ozone_save(latsiz))<a name='3537'>
    allocate(ozmixin_save(lonsiz, levsiz, latsiz, num_months))<a name='3538'>
    plev=&gt;plev_ozone_save<a name='3539'>
    lat_ozone=&gt;lat_ozone_save<a name='3540'>
    ozmixin=&gt;ozmixin_save<a name='3541'>
#if ( defined( DM_PARALLEL ) &amp;&amp; ( <font color=#447700>! defined( STUBMPI ) ) )<a name='3542'></font>
    if_master: if(wrf_dm_on_monitor()) then<a name='3543'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_764">(1,'Master rank reads ozone.')<a name='3544'>
#endif<a name='3545'>
<font color=#447700>!-- read in ozone pressure data<a name='3546'></font>
<a name='3547'>
     WRITE(message,*)'num_months = ',num_months<a name='3548'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_765">(50,message)<a name='3549'>
<a name='3550'>
      pin_unit = 27<a name='3551'>
        OPEN(pin_unit, FILE='ozone_plev.formatted',FORM='FORMATTED',STATUS='OLD')<a name='3552'>
        do k = 1,levsiz<a name='3553'>
        READ (pin_unit,*)plev(k)<a name='3554'>
        end do<a name='3555'>
      close(27)<a name='3556'>
<a name='3557'>
      do k=1,levsiz<a name='3558'>
         plev(k) = plev(k)*100.<a name='3559'>
      end do<a name='3560'>
      pin=plev <font color=#447700>! copy to grid array<a name='3561'></font>
<a name='3562'>
<font color=#447700>!-- read in ozone lat data<a name='3563'></font>
<a name='3564'>
      lat_unit = 28<a name='3565'>
        OPEN(lat_unit, FILE='ozone_lat.formatted',FORM='FORMATTED',STATUS='OLD')<a name='3566'>
        do j = 1,latsiz<a name='3567'>
        READ (lat_unit,*)lat_ozone(j)<a name='3568'>
        end do<a name='3569'>
      close(28)<a name='3570'>
<a name='3571'>
<a name='3572'>
<font color=#447700>!-- read in ozone data<a name='3573'></font>
<a name='3574'>
      oz_unit = 29<a name='3575'>
      OPEN(oz_unit, FILE='ozone.formatted',FORM='FORMATTED',STATUS='OLD')<a name='3576'>
<a name='3577'>
      do m=2,num_months<a name='3578'>
      do j=1,latsiz <font color=#447700>! latsiz=64<a name='3579'></font>
      do k=1,levsiz <font color=#447700>! levsiz=59<a name='3580'></font>
      do i=1,lonsiz <font color=#447700>! lonsiz=1<a name='3581'></font>
        READ (oz_unit,*)ozmixin(i,k,j,m)<a name='3582'>
      enddo<a name='3583'>
      enddo<a name='3584'>
      enddo<a name='3585'>
      enddo<a name='3586'>
      close(29)<a name='3587'>
#if ( defined( DM_PARALLEL ) &amp;&amp; ( <font color=#447700>! defined( STUBMPI ) ) )<a name='3588'></font>
     endif if_master<a name='3589'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_766">(1,"Broadcast ozone to other ranks.")<a name='3590'>
# if ( RWORDSIZE == DWORDSIZE )<a name='3591'>
     call MPI_Bcast(ozmixin,size(ozmixin),MPI_DOUBLE_PRECISION,0,local_communicator,ierr)<a name='3592'>
     call MPI_Bcast(pin,size(pin),MPI_DOUBLE_PRECISION,0,local_communicator,ierr)<a name='3593'>
     plev=pin<a name='3594'>
     call MPI_Bcast(lat_ozone,size(lat_ozone),MPI_DOUBLE_PRECISION,0,local_communicator,ierr)<a name='3595'>
# else<a name='3596'>
     call MPI_Bcast(ozmixin,size(ozmixin),MPI_REAL,0,local_communicator,ierr)<a name='3597'>
     call MPI_Bcast(pin,size(pin),MPI_REAL,0,local_communicator,ierr)<a name='3598'>
     plev=pin<a name='3599'>
     call MPI_Bcast(lat_ozone,size(lat_ozone),MPI_REAL,0,local_communicator,ierr)<a name='3600'>
# endif<a name='3601'>
#endif<a name='3602'>
   else <font color=#447700>! already read in ozone data<a name='3603'></font>
    <font color=#447700>! Make sure, first:<a name='3604'></font>
    if(levsiz/=levsiz_ozone_save) then<a name='3605'>
3081   format('Logic error in caller: levsiz=',I0,' but prior call used ',I0,'.')<a name='3606'>
       write(message,3081) levsiz,levsiz_ozone_save<a name='3607'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_979">(message)<a name='3608'>
    endif<a name='3609'>
    if(.not.(associated(plev_ozone_save) .and. &amp;<a name='3610'>
             associated(lat_ozone_save) .and. &amp;<a name='3611'>
             associated(ozmixin_save))) then<a name='3612'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_980">('Ozone save arrays are not allocated.')<a name='3613'>
    endif<a name='3614'>
    <font color=#447700>! Recover the pointers to allocated data:<a name='3615'></font>
    plev=&gt;plev_ozone_save<a name='3616'>
    lat_ozone=&gt;lat_ozone_save<a name='3617'>
    ozmixin=&gt;ozmixin_save<a name='3618'>
   endif if_have_ozone<a name='3619'>
<a name='3620'>
<font color=#447700>!-- latitudinally interpolate ozone data (and extend longitudinally)<a name='3621'></font>
<font color=#447700>!-- using function lin_interpol2(x, f, y) result(g)<a name='3622'></font>
<font color=#447700>! Purpose:<a name='3623'></font>
<font color=#447700>!   interpolates f(x) to point y<a name='3624'></font>
<font color=#447700>!   assuming f(x) = f(x0) + a * (x - x0)<a name='3625'></font>
<font color=#447700>!   where a = ( f(x1) - f(x0) ) / (x1 - x0)<a name='3626'></font>
<font color=#447700>!   x0 &lt;= x &lt;= x1<a name='3627'></font>
<font color=#447700>!   assumes x is monotonically increasing<a name='3628'></font>
<font color=#447700>!    real, intent(in), dimension(:) :: x  ! grid points<a name='3629'></font>
<font color=#447700>!    real, intent(in), dimension(:) :: f  ! grid function values<a name='3630'></font>
<font color=#447700>!    real, intent(in) :: y                ! interpolation point<a name='3631'></font>
<font color=#447700>!    real :: g                            ! interpolated function value<a name='3632'></font>
<font color=#447700>!---------------------------------------------------------------------------<a name='3633'></font>
<a name='3634'>
      do m=2,num_months<a name='3635'>
      do j=jts,jtf<a name='3636'>
      do k=1,levsiz<a name='3637'>
      do i=its,itf<a name='3638'>
         interp_pt=XLAT(i,j)<a name='3639'>
         ozmixm(i,k,j,m)=<A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL2'>lin_interpol2</A><A href='../../html_code/phys/module_ra_cam_support.F.html#OZNINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL2_1">(lat_ozone(:),ozmixin(1,k,:,m),interp_pt)<a name='3640'>
      enddo<a name='3641'>
      enddo<a name='3642'>
      enddo<a name='3643'>
      enddo<a name='3644'>
<a name='3645'>
<font color=#447700>! Old code for fixed ozone<a name='3646'></font>
<a name='3647'>
<font color=#447700>!     pin(1)=70.<a name='3648'></font>
<font color=#447700>!     DO k=2,levsiz<a name='3649'></font>
<font color=#447700>!     pin(k)=pin(k-1)+16.<a name='3650'></font>
<font color=#447700>!     ENDDO<a name='3651'></font>
<a name='3652'>
<font color=#447700>!     DO k=1,levsiz<a name='3653'></font>
<font color=#447700>!         pin(k) = pin(k)*100.<a name='3654'></font>
<font color=#447700>!     end do<a name='3655'></font>
<a name='3656'>
<font color=#447700>!     DO m=1,num_months<a name='3657'></font>
<font color=#447700>!     DO j=jts,jtf<a name='3658'></font>
<font color=#447700>!     DO i=its,itf<a name='3659'></font>
<font color=#447700>!     DO k=1,2<a name='3660'></font>
<font color=#447700>!      ozmixm(i,k,j,m)=1.e-6<a name='3661'></font>
<font color=#447700>!     ENDDO<a name='3662'></font>
<font color=#447700>!     DO k=3,levsiz<a name='3663'></font>
<font color=#447700>!      ozmixm(i,k,j,m)=1.e-7<a name='3664'></font>
<font color=#447700>!     ENDDO<a name='3665'></font>
<font color=#447700>!     ENDDO<a name='3666'></font>
<font color=#447700>!     ENDDO<a name='3667'></font>
<font color=#447700>!     ENDDO<a name='3668'></font>
<a name='3669'>
END SUBROUTINE oznini<a name='3670'>
<a name='3671'>
<a name='3672'>
<A NAME='AEROSOL_INIT'><A href='../../html_code/phys/module_ra_cam_support.F.html#AEROSOL_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3673'>
<font color=#993300>subroutine </font><font color=#cc0000>aerosol_init</font>(m_psp,m_psn,m_hybi,aerosolcp,aerosolcn,paerlev,naer_c,shalf,pptop,    &amp; <A href='../../call_to/AEROSOL_INIT.html' TARGET='index'>2</A>,<A href='../../call_from/AEROSOL_INIT.html' TARGET='index'>15</A><a name='3674'>
                     ids, ide, jds, jde, kds, kde,                  &amp;<a name='3675'>
                     ims, ime, jms, jme, kms, kme,                  &amp;<a name='3676'>
                     its, ite, jts, jte, kts, kte)<a name='3677'>
<font color=#447700>!<a name='3678'></font>
<font color=#447700>!  This subroutine assumes a uniform aerosol distribution in both time and space.<a name='3679'></font>
<font color=#447700>!  It should be modified if aerosol data are available from WRF-CHEM or other sources<a name='3680'></font>
<font color=#447700>!<a name='3681'></font>
      IMPLICIT NONE<a name='3682'>
<a name='3683'>
   INTEGER,      INTENT(IN   )    ::   ids,ide, jds,jde, kds,kde, &amp;<a name='3684'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='3685'>
                                       its,ite, jts,jte, kts,kte<a name='3686'>
<a name='3687'>
   INTEGER,      INTENT(IN   )    ::   paerlev,naer_c <a name='3688'>
<a name='3689'>
   REAL,     intent(in)                        :: pptop<a name='3690'>
   REAL,     DIMENSION( kms:kme ), intent(in)  :: shalf<a name='3691'>
<a name='3692'>
   REAL,  DIMENSION( ims:ime, paerlev, jms:jme, naer_c ),      &amp;<a name='3693'>
          INTENT(INOUT   ) ::                                  aerosolcn , aerosolcp<a name='3694'>
<a name='3695'>
   REAL,  DIMENSION(paerlev), INTENT(OUT )  ::                m_hybi<a name='3696'>
   REAL,  DIMENSION( ims:ime, jms:jme),  INTENT(OUT )  ::       m_psp,m_psn <a name='3697'>
<a name='3698'>
   REAL ::                                                      psurf<a name='3699'>
   real, dimension(29) :: hybi  <a name='3700'>
   integer k <font color=#447700>! index through vertical levels<a name='3701'></font>
<a name='3702'>
   INTEGER :: i, j, itf, jtf, ktf,m<a name='3703'>
<a name='3704'>
   data hybi/0, 0.0065700002014637, 0.0138600002974272, 0.023089999333024, &amp;<a name='3705'>
    0.0346900001168251, 0.0491999983787537, 0.0672300010919571,      &amp;<a name='3706'>
     0.0894500017166138, 0.116539999842644, 0.149159997701645,       &amp;<a name='3707'>
    0.187830001115799, 0.232859998941422, 0.284209996461868,         &amp;<a name='3708'>
    0.341369986534119, 0.403340011835098, 0.468600004911423,         &amp;<a name='3709'>
    0.535290002822876, 0.601350009441376, 0.66482001543045,          &amp;<a name='3710'>
    0.724009990692139, 0.777729988098145, 0.825269997119904,         &amp; <a name='3711'>
    0.866419970989227, 0.901350021362305, 0.930540025234222,         &amp; <a name='3712'>
    0.954590022563934, 0.974179983139038, 0.990000009536743, 1/<a name='3713'>
<a name='3714'>
   jtf=min0(jte,jde-1)<a name='3715'>
   ktf=min0(kte,kde-1)<a name='3716'>
   itf=min0(ite,ide-1)<a name='3717'>
<a name='3718'>
    do k=1,paerlev<a name='3719'>
      m_hybi(k)=hybi(k)<a name='3720'>
    enddo<a name='3721'>
<a name='3722'>
<font color=#447700>!<a name='3723'></font>
<font color=#447700>! mxaerl = max number of levels (from bottom) for background aerosol<a name='3724'></font>
<font color=#447700>! Limit background aerosol height to regions below 900 mb<a name='3725'></font>
<font color=#447700>!<a name='3726'></font>
<a name='3727'>
   psurf = 1.e05<a name='3728'>
   mxaerl = 0<a name='3729'>
<font color=#447700>!  do k=pver,1,-1<a name='3730'></font>
   do k=kms,kme-1<a name='3731'>
<font color=#447700>!     if (hypm(k) &gt;= 9.e4) mxaerl = mxaerl + 1<a name='3732'></font>
      if (shalf(k)*psurf+pptop  &gt;= 9.e4) mxaerl = mxaerl + 1<a name='3733'>
   end do<a name='3734'>
   mxaerl = max(mxaerl,1)<a name='3735'>
<font color=#447700>!  if (masterproc) then<a name='3736'></font>
      write(6,*)'AEROSOLS:  Background aerosol will be limited to ', &amp;<a name='3737'>
                'bottom ',mxaerl,' model interfaces.'<a name='3738'>
<font color=#447700>!               'bottom ',mxaerl,' model interfaces. Top interface is ', &amp;<a name='3739'></font>
<font color=#447700>!               hypi(pverp-mxaerl),' pascals'<a name='3740'></font>
<font color=#447700>!  end if<a name='3741'></font>
<a name='3742'>
     DO j=jts,jtf<a name='3743'>
     DO i=its,itf<a name='3744'>
      m_psp(i,j)=psurf<a name='3745'>
      m_psn(i,j)=psurf<a name='3746'>
     ENDDO<a name='3747'>
     ENDDO<a name='3748'>
<a name='3749'>
     DO j=jts,jtf<a name='3750'>
     DO i=its,itf<a name='3751'>
     DO k=1,paerlev<a name='3752'>
<font color=#447700>! aerosolc arrays are upward cumulative (kg/m2) at each level<a name='3753'></font>
<font color=#447700>! Here we assume uniform vertical distribution (aerosolc linear with hybi)<a name='3754'></font>
      aerosolcp(i,k,j,idxSUL)=1.e-7*(1.-hybi(k))<a name='3755'>
      aerosolcn(i,k,j,idxSUL)=1.e-7*(1.-hybi(k))<a name='3756'>
      aerosolcp(i,k,j,idxSSLT)=1.e-22*(1.-hybi(k))<a name='3757'>
      aerosolcn(i,k,j,idxSSLT)=1.e-22*(1.-hybi(k))<a name='3758'>
      aerosolcp(i,k,j,idxDUSTfirst)=1.e-7*(1.-hybi(k))<a name='3759'>
      aerosolcn(i,k,j,idxDUSTfirst)=1.e-7*(1.-hybi(k))<a name='3760'>
      aerosolcp(i,k,j,idxDUSTfirst+1)=1.e-7*(1.-hybi(k))<a name='3761'>
      aerosolcn(i,k,j,idxDUSTfirst+1)=1.e-7*(1.-hybi(k))<a name='3762'>
      aerosolcp(i,k,j,idxDUSTfirst+2)=1.e-7*(1.-hybi(k))<a name='3763'>
      aerosolcn(i,k,j,idxDUSTfirst+2)=1.e-7*(1.-hybi(k))<a name='3764'>
      aerosolcp(i,k,j,idxDUSTfirst+3)=1.e-7*(1.-hybi(k))<a name='3765'>
      aerosolcn(i,k,j,idxDUSTfirst+3)=1.e-7*(1.-hybi(k))<a name='3766'>
      aerosolcp(i,k,j,idxOCPHO)=1.e-7*(1.-hybi(k))<a name='3767'>
      aerosolcn(i,k,j,idxOCPHO)=1.e-7*(1.-hybi(k))<a name='3768'>
      aerosolcp(i,k,j,idxBCPHO)=1.e-9*(1.-hybi(k))<a name='3769'>
      aerosolcn(i,k,j,idxBCPHO)=1.e-9*(1.-hybi(k))<a name='3770'>
      aerosolcp(i,k,j,idxOCPHI)=1.e-7*(1.-hybi(k))<a name='3771'>
      aerosolcn(i,k,j,idxOCPHI)=1.e-7*(1.-hybi(k))<a name='3772'>
      aerosolcp(i,k,j,idxBCPHI)=1.e-8*(1.-hybi(k))<a name='3773'>
      aerosolcn(i,k,j,idxBCPHI)=1.e-8*(1.-hybi(k))<a name='3774'>
     ENDDO<a name='3775'>
     ENDDO<a name='3776'>
     ENDDO<a name='3777'>
<a name='3778'>
     call <A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE'>aer_optics_initialize</A><A href='../../html_code/phys/module_ra_flg.F.html#AEROSOL_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="AER_OPTICS_INITIALIZE_1"><a name='3779'>
 <a name='3780'>
<a name='3781'>
END subroutine aerosol_init<a name='3782'>
<a name='3783'>
<A NAME='AER_OPTICS_INITIALIZE'><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3784'>
  <font color=#993300>subroutine </font><font color=#cc0000>aer_optics_initialize</font> <A href='../../call_to/AER_OPTICS_INITIALIZE.html' TARGET='index'>1</A>,<A href='../../call_from/AER_OPTICS_INITIALIZE.html' TARGET='index'>15</A><a name='3785'>
<a name='3786'>
USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_74"><a name='3787'>
<a name='3788'>
<font color=#447700>!   use shr_kind_mod, only: r8 =&gt; shr_kind_r8<a name='3789'></font>
<font color=#447700>!   use pmgrid  ! masterproc is here<a name='3790'></font>
<font color=#447700>!   use ioFileMod, only: getfil<a name='3791'></font>
<a name='3792'>
<font color=#447700>!#if ( defined SPMD )<a name='3793'></font>
<font color=#447700>!    use mpishorthand<a name='3794'></font>
<font color=#447700>!#endif<a name='3795'></font>
    implicit none<a name='3796'>
<a name='3797'>
<font color=#447700>!   include 'netcdf.inc'<a name='3798'></font>
<a name='3799'>
<a name='3800'>
    integer :: nrh_opac  <font color=#447700>! number of relative humidity values for OPAC data<a name='3801'></font>
    integer :: nbnd      <font color=#447700>! number of spectral bands, should be identical to nspint<a name='3802'></font>
    real(r8), parameter :: wgt_sscm = 6.0 / 7.0<a name='3803'>
    integer :: krh_opac  <font color=#447700>! rh index for OPAC rh grid<a name='3804'></font>
    integer :: krh       <font color=#447700>! another rh index<a name='3805'></font>
    integer :: ksz       <font color=#447700>! dust size bin index<a name='3806'></font>
    integer :: kbnd      <font color=#447700>! band index<a name='3807'></font>
<a name='3808'>
    real(r8) :: rh   <font color=#447700>! local relative humidity variable<a name='3809'></font>
<a name='3810'>
    integer, parameter :: irh=8<a name='3811'>
    real(r8) :: rh_opac(irh)        <font color=#447700>! OPAC relative humidity grid<a name='3812'></font>
    real(r8) :: ksul_opac(irh,nspint)    <font color=#447700>! sulfate  extinction<a name='3813'></font>
    real(r8) :: wsul_opac(irh,nspint)    <font color=#447700>!          single scattering albedo<a name='3814'></font>
    real(r8) :: gsul_opac(irh,nspint)    <font color=#447700>!          asymmetry parameter<a name='3815'></font>
    real(r8) :: ksslt_opac(irh,nspint)   <font color=#447700>! sea-salt<a name='3816'></font>
    real(r8) :: wsslt_opac(irh,nspint)<a name='3817'>
    real(r8) :: gsslt_opac(irh,nspint)<a name='3818'>
    real(r8) :: kssam_opac(irh,nspint)   <font color=#447700>! sea-salt accumulation mode<a name='3819'></font>
    real(r8) :: wssam_opac(irh,nspint)<a name='3820'>
    real(r8) :: gssam_opac(irh,nspint)<a name='3821'>
    real(r8) :: ksscm_opac(irh,nspint)   <font color=#447700>! sea-salt coarse mode<a name='3822'></font>
    real(r8) :: wsscm_opac(irh,nspint)<a name='3823'>
    real(r8) :: gsscm_opac(irh,nspint)<a name='3824'>
    real(r8) :: kcphil_opac(irh,nspint)  <font color=#447700>! hydrophilic organic carbon<a name='3825'></font>
    real(r8) :: wcphil_opac(irh,nspint)<a name='3826'>
    real(r8) :: gcphil_opac(irh,nspint)<a name='3827'>
    real(r8) :: dummy(nspint)<a name='3828'>
<a name='3829'>
      LOGICAL                 :: opened<a name='3830'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='3831'>
<a name='3832'>
      CHARACTER*80 errmess<a name='3833'>
      INTEGER cam_aer_unit<a name='3834'>
      integer :: i<a name='3835'>
<a name='3836'>
<font color=#447700>!   read aerosol optics data<a name='3837'></font>
<a name='3838'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='3839'>
        DO i = 10,99<a name='3840'>
          INQUIRE ( i , OPENED = opened )<a name='3841'>
          IF ( .NOT. opened ) THEN<a name='3842'>
            cam_aer_unit = i<a name='3843'>
            GOTO 2010<a name='3844'>
          ENDIF<a name='3845'>
        ENDDO<a name='3846'>
        cam_aer_unit = -1<a name='3847'>
 2010   CONTINUE<a name='3848'>
      ENDIF<a name='3849'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_304"> ( cam_aer_unit , IWORDSIZE )<a name='3850'>
      IF ( cam_aer_unit &lt; 0 ) THEN<a name='3851'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_981"> ( 'module_ra_cam: aer_optics_initialize: Can not find unused fortran unit to read in lookup table.' )<a name='3852'>
      ENDIF<a name='3853'>
<a name='3854'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='3855'>
          OPEN(cam_aer_unit,FILE='CAM_AEROPT_DATA',                  &amp;<a name='3856'>
               FORM='UNFORMATTED',STATUS='OLD',ERR=9010)<a name='3857'>
          call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_767">(50,'reading CAM_AEROPT_DATA')<a name='3858'>
        ENDIF<a name='3859'>
<a name='3860'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_305"> ( A , size ( A ) * r8 )<a name='3861'>
<a name='3862'>
         IF ( wrf_dm_on_monitor() ) then<a name='3863'>
         READ (cam_aer_unit,ERR=9010) dummy<a name='3864'>
         READ (cam_aer_unit,ERR=9010) rh_opac <a name='3865'>
         READ (cam_aer_unit,ERR=9010) ksul_opac <a name='3866'>
         READ (cam_aer_unit,ERR=9010) wsul_opac <a name='3867'>
         READ (cam_aer_unit,ERR=9010) gsul_opac <a name='3868'>
         READ (cam_aer_unit,ERR=9010) kssam_opac <a name='3869'>
         READ (cam_aer_unit,ERR=9010) wssam_opac <a name='3870'>
         READ (cam_aer_unit,ERR=9010) gssam_opac <a name='3871'>
         READ (cam_aer_unit,ERR=9010) ksscm_opac <a name='3872'>
         READ (cam_aer_unit,ERR=9010) wsscm_opac <a name='3873'>
         READ (cam_aer_unit,ERR=9010) gsscm_opac<a name='3874'>
         READ (cam_aer_unit,ERR=9010) kcphil_opac <a name='3875'>
         READ (cam_aer_unit,ERR=9010) wcphil_opac <a name='3876'>
         READ (cam_aer_unit,ERR=9010) gcphil_opac <a name='3877'>
         READ (cam_aer_unit,ERR=9010) kcb <a name='3878'>
         READ (cam_aer_unit,ERR=9010) wcb <a name='3879'>
         READ (cam_aer_unit,ERR=9010) gcb <a name='3880'>
         READ (cam_aer_unit,ERR=9010) kdst <a name='3881'>
         READ (cam_aer_unit,ERR=9010) wdst <a name='3882'>
         READ (cam_aer_unit,ERR=9010) gdst <a name='3883'>
         READ (cam_aer_unit,ERR=9010) kbg <a name='3884'>
         READ (cam_aer_unit,ERR=9010) wbg <a name='3885'>
         READ (cam_aer_unit,ERR=9010) gbg<a name='3886'>
         READ (cam_aer_unit,ERR=9010) kvolc <a name='3887'>
         READ (cam_aer_unit,ERR=9010) wvolc <a name='3888'>
         READ (cam_aer_unit,ERR=9010) gvolc<a name='3889'>
         endif<a name='3890'>
<a name='3891'>
         DM_BCAST_MACRO(rh_opac)<a name='3892'>
         DM_BCAST_MACRO(ksul_opac)<a name='3893'>
         DM_BCAST_MACRO(wsul_opac)<a name='3894'>
         DM_BCAST_MACRO(gsul_opac)<a name='3895'>
         DM_BCAST_MACRO(kssam_opac)<a name='3896'>
         DM_BCAST_MACRO(wssam_opac)<a name='3897'>
         DM_BCAST_MACRO(gssam_opac)<a name='3898'>
         DM_BCAST_MACRO(ksscm_opac)<a name='3899'>
         DM_BCAST_MACRO(wsscm_opac)<a name='3900'>
         DM_BCAST_MACRO(gsscm_opac)<a name='3901'>
         DM_BCAST_MACRO(kcphil_opac)<a name='3902'>
         DM_BCAST_MACRO(wcphil_opac)<a name='3903'>
         DM_BCAST_MACRO(gcphil_opac)<a name='3904'>
         DM_BCAST_MACRO(kcb)<a name='3905'>
         DM_BCAST_MACRO(wcb)<a name='3906'>
         DM_BCAST_MACRO(gcb)<a name='3907'>
         DM_BCAST_MACRO(kvolc)<a name='3908'>
         DM_BCAST_MACRO(wvolc)<a name='3909'>
         DM_BCAST_MACRO(gvolc)<a name='3910'>
         DM_BCAST_MACRO(kdst)<a name='3911'>
         DM_BCAST_MACRO(wdst)<a name='3912'>
         DM_BCAST_MACRO(gdst)<a name='3913'>
         DM_BCAST_MACRO(kbg)<a name='3914'>
         DM_BCAST_MACRO(wbg)<a name='3915'>
         DM_BCAST_MACRO(gbg)<a name='3916'>
<a name='3917'>
         IF ( wrf_dm_on_monitor() ) CLOSE (cam_aer_unit)<a name='3918'>
<a name='3919'>
    <font color=#447700>! map OPAC aerosol species onto CAM aerosol species<a name='3920'></font>
    <font color=#447700>! CAM name             OPAC name<a name='3921'></font>
    <font color=#447700>! sul   or SO4         = suso                  sulfate soluble<a name='3922'></font>
    <font color=#447700>! sslt  or SSLT        = 1/7 ssam + 6/7 sscm   sea-salt accumulation/coagulation mode<a name='3923'></font>
    <font color=#447700>! cphil or CPHI        = waso                  water soluble (carbon)<a name='3924'></font>
    <font color=#447700>! cphob or CPHO        = waso @ rh = 0<a name='3925'></font>
    <font color=#447700>! cb    or BCPHI/BCPHO = soot<a name='3926'></font>
<a name='3927'>
    ksslt_opac(:,:) = (1.0 - wgt_sscm) * kssam_opac(:,:) + wgt_sscm * ksscm_opac(:,:)<a name='3928'>
<a name='3929'>
    wsslt_opac(:,:) = ( (1.0 - wgt_sscm) * kssam_opac(:,:) * wssam_opac(:,:) &amp;<a name='3930'>
                  + wgt_sscm * ksscm_opac(:,:) * wsscm_opac(:,:) ) &amp;<a name='3931'>
                  / ksslt_opac(:,:)<a name='3932'>
<a name='3933'>
    gsslt_opac(:,:) = ( (1.0 - wgt_sscm) * kssam_opac(:,:) * wssam_opac(:,:) * gssam_opac(:,:) &amp;<a name='3934'>
                  + wgt_sscm * ksscm_opac(:,:) * wsscm_opac(:,:) * gsscm_opac(:,:) ) &amp;<a name='3935'>
                   / ( ksslt_opac(:,:) * wsslt_opac(:,:) )<a name='3936'>
<a name='3937'>
    do i=1,nspint<a name='3938'>
    kcphob(i) = kcphil_opac(1,i)<a name='3939'>
    wcphob(i) = wcphil_opac(1,i)<a name='3940'>
    gcphob(i) = gcphil_opac(1,i)<a name='3941'>
    end do<a name='3942'>
<a name='3943'>
    <font color=#447700>! interpolate optical properties of hygrospopic aerosol species<a name='3944'></font>
    <font color=#447700>!   onto a uniform relative humidity grid<a name='3945'></font>
<a name='3946'>
    nbnd = nspint<a name='3947'>
<a name='3948'>
    do krh = 1, nrh<a name='3949'>
      rh = 1.0_r8 / nrh * (krh - 1)<a name='3950'>
      do kbnd = 1, nbnd<a name='3951'>
        ksul(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL'>exp_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXP_INTERPOL_1">( rh_opac, &amp;<a name='3952'>
          ksul_opac(:, kbnd) / ksul_opac(1, kbnd), rh ) * ksul_opac(1, kbnd)<a name='3953'>
        wsul(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_1">( rh_opac, &amp;<a name='3954'>
          wsul_opac(:, kbnd) / wsul_opac(1, kbnd), rh ) * wsul_opac(1, kbnd)<a name='3955'>
        gsul(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_2">( rh_opac, &amp;<a name='3956'>
          gsul_opac(:, kbnd) / gsul_opac(1, kbnd), rh ) * gsul_opac(1, kbnd)<a name='3957'>
        ksslt(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL'>exp_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXP_INTERPOL_2">( rh_opac, &amp;<a name='3958'>
          ksslt_opac(:, kbnd) / ksslt_opac(1, kbnd), rh ) * ksslt_opac(1, kbnd)<a name='3959'>
        wsslt(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_3">( rh_opac, &amp;<a name='3960'>
          wsslt_opac(:, kbnd) / wsslt_opac(1, kbnd), rh ) * wsslt_opac(1, kbnd)<a name='3961'>
        gsslt(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_4">( rh_opac, &amp;<a name='3962'>
          gsslt_opac(:, kbnd) / gsslt_opac(1, kbnd), rh ) * gsslt_opac(1, kbnd)<a name='3963'>
        kcphil(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#EXP_INTERPOL'>exp_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXP_INTERPOL_3">( rh_opac, &amp;<a name='3964'>
          kcphil_opac(:, kbnd) / kcphil_opac(1, kbnd), rh ) * kcphil_opac(1, kbnd)<a name='3965'>
        wcphil(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_5">( rh_opac, &amp;<a name='3966'>
          wcphil_opac(:, kbnd) / wcphil_opac(1, kbnd), rh ) * wcphil_opac(1, kbnd)<a name='3967'>
        gcphil(krh, kbnd) = <A href='../../html_code/phys/module_ra_cam_support.F.html#LIN_INTERPOL'>lin_interpol</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LIN_INTERPOL_6">( rh_opac, &amp;<a name='3968'>
          gcphil_opac(:, kbnd) / gcphil_opac(1, kbnd), rh )  * gcphil_opac(1, kbnd)<a name='3969'>
      end do<a name='3970'>
    end do<a name='3971'>
<a name='3972'>
     RETURN<a name='3973'>
9010 CONTINUE<a name='3974'>
     WRITE( errmess , '(A35,I4)' ) 'module_ra_cam: error reading unit ',cam_aer_unit<a name='3975'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#AER_OPTICS_INITIALIZE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_982">(errmess)<a name='3976'>
<a name='3977'>
END subroutine aer_optics_initialize<a name='3978'>
<a name='3979'>
<a name='3980'>
<A NAME='RADAEINI'><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3981'>
<font color=#993300>subroutine </font><font color=#cc0000>radaeini</font>( pstdx, mwdryx, mwco2x ) <A href='../../call_to/RADAEINI.html' TARGET='index'>1</A>,<A href='../../call_from/RADAEINI.html' TARGET='index'>7</A><a name='3982'>
<a name='3983'>
USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_75"><a name='3984'>
<a name='3985'>
<font color=#447700>!<a name='3986'></font>
<font color=#447700>! Initialize radae module data<a name='3987'></font>
<font color=#447700>!<a name='3988'></font>
<font color=#447700>!<a name='3989'></font>
<font color=#447700>! Input variables<a name='3990'></font>
<font color=#447700>!<a name='3991'></font>
   real(r8), intent(in) :: pstdx   <font color=#447700>! Standard pressure (dynes/cm^2)<a name='3992'></font>
   real(r8), intent(in) :: mwdryx  <font color=#447700>! Molecular weight of dry air <a name='3993'></font>
   real(r8), intent(in) :: mwco2x  <font color=#447700>! Molecular weight of carbon dioxide<a name='3994'></font>
<font color=#447700>!<a name='3995'></font>
<font color=#447700>!      Variables for loading absorptivity/emissivity<a name='3996'></font>
<font color=#447700>!<a name='3997'></font>
   integer ncid_ae                <font color=#447700>! NetCDF file id for abs/ems file<a name='3998'></font>
<a name='3999'>
   integer pdimid                 <font color=#447700>! pressure dimension id<a name='4000'></font>
   integer psize                  <font color=#447700>! pressure dimension size<a name='4001'></font>
<a name='4002'>
   integer tpdimid                <font color=#447700>! path temperature dimension id<a name='4003'></font>
   integer tpsize                 <font color=#447700>! path temperature size<a name='4004'></font>
<a name='4005'>
   integer tedimid                <font color=#447700>! emission temperature dimension id<a name='4006'></font>
   integer tesize                 <font color=#447700>! emission temperature size<a name='4007'></font>
<a name='4008'>
   integer udimid                 <font color=#447700>! u (H2O path) dimension id<a name='4009'></font>
   integer usize                  <font color=#447700>! u (H2O path) dimension size<a name='4010'></font>
<a name='4011'>
   integer rhdimid                <font color=#447700>! relative humidity dimension id<a name='4012'></font>
   integer rhsize                 <font color=#447700>! relative humidity dimension size<a name='4013'></font>
<a name='4014'>
   integer    ah2onwid            <font color=#447700>! var. id for non-wndw abs.<a name='4015'></font>
   integer    eh2onwid            <font color=#447700>! var. id for non-wndw ems.<a name='4016'></font>
   integer    ah2owid             <font color=#447700>! var. id for wndw abs. (adjacent layers)<a name='4017'></font>
   integer cn_ah2owid             <font color=#447700>! var. id for continuum trans. for wndw abs.<a name='4018'></font>
   integer cn_eh2owid             <font color=#447700>! var. id for continuum trans. for wndw ems.<a name='4019'></font>
   integer ln_ah2owid             <font color=#447700>! var. id for line trans. for wndw abs.<a name='4020'></font>
   integer ln_eh2owid             <font color=#447700>! var. id for line trans. for wndw ems.<a name='4021'></font>
   <a name='4022'>
<font color=#447700>!  character*(NF_MAX_NAME) tmpname! dummy variable for var/dim names<a name='4023'></font>
   character(len=256) locfn       <font color=#447700>! local filename<a name='4024'></font>
   integer tmptype                <font color=#447700>! dummy variable for variable type<a name='4025'></font>
   integer ndims                  <font color=#447700>! number of dimensions<a name='4026'></font>
<font color=#447700>!  integer dims(NF_MAX_VAR_DIMS)  ! vector of dimension ids<a name='4027'></font>
   integer natt                   <font color=#447700>! number of attributes<a name='4028'></font>
<font color=#447700>!<a name='4029'></font>
<font color=#447700>! Variables for setting up H2O table<a name='4030'></font>
<font color=#447700>!<a name='4031'></font>
   integer t                     <font color=#447700>! path temperature<a name='4032'></font>
   integer tmin                  <font color=#447700>! mininum path temperature<a name='4033'></font>
   integer tmax                  <font color=#447700>! maximum path temperature<a name='4034'></font>
   integer itype                 <font color=#447700>! type of sat. pressure (=0 -&gt; H2O only)<a name='4035'></font>
   integer i<a name='4036'>
   real(r8) tdbl<a name='4037'>
<a name='4038'>
      LOGICAL                 :: opened<a name='4039'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='4040'>
<a name='4041'>
      CHARACTER*80 errmess<a name='4042'>
      INTEGER cam_abs_unit<a name='4043'>
<a name='4044'>
<font color=#447700>!<a name='4045'></font>
<font color=#447700>! Constants to set<a name='4046'></font>
<font color=#447700>!<a name='4047'></font>
   p0     = pstdx<a name='4048'>
   amd    = mwdryx<a name='4049'>
   amco2  = mwco2x<a name='4050'>
<font color=#447700>!<a name='4051'></font>
<font color=#447700>! Coefficients for h2o emissivity and absorptivity for overlap of H2O <a name='4052'></font>
<font color=#447700>!    and trace gases.<a name='4053'></font>
<font color=#447700>!<a name='4054'></font>
   c16  = coefj(3,1)/coefj(2,1)<a name='4055'>
   c17  = coefk(3,1)/coefk(2,1)<a name='4056'>
   c26  = coefj(3,2)/coefj(2,2)<a name='4057'>
   c27  = coefk(3,2)/coefk(2,2)<a name='4058'>
   c28  = .5<a name='4059'>
   c29  = .002053<a name='4060'>
   c30  = .1<a name='4061'>
   c31  = 3.0e-5<a name='4062'>
<font color=#447700>!<a name='4063'></font>
<font color=#447700>! Initialize further longwave constants referring to far wing<a name='4064'></font>
<font color=#447700>! correction for overlap of H2O and trace gases; R&amp;D refers to:<a name='4065'></font>
<font color=#447700>!<a name='4066'></font>
<font color=#447700>!            Ramanathan, V. and  P.Downey, 1986: A Nonisothermal<a name='4067'></font>
<font color=#447700>!            Emissivity and Absorptivity Formulation for Water Vapor<a name='4068'></font>
<font color=#447700>!            Journal of Geophysical Research, vol. 91., D8, pp 8649-8666<a name='4069'></font>
<font color=#447700>!<a name='4070'></font>
   fwcoef = .1           <font color=#447700>! See eq(33) R&amp;D<a name='4071'></font>
   fwc1   = .30          <font color=#447700>! See eq(33) R&amp;D<a name='4072'></font>
   fwc2   = 4.5          <font color=#447700>! See eq(33) and eq(34) in R&amp;D<a name='4073'></font>
   fc1    = 2.6          <font color=#447700>! See eq(34) R&amp;D<a name='4074'></font>
<a name='4075'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='4076'>
        DO i = 10,99<a name='4077'>
          INQUIRE ( i , OPENED = opened )<a name='4078'>
          IF ( .NOT. opened ) THEN<a name='4079'>
            cam_abs_unit = i<a name='4080'>
            GOTO 2010<a name='4081'>
          ENDIF<a name='4082'>
        ENDDO<a name='4083'>
        cam_abs_unit = -1<a name='4084'>
 2010   CONTINUE<a name='4085'>
      ENDIF<a name='4086'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_306"> ( cam_abs_unit , IWORDSIZE )<a name='4087'>
      IF ( cam_abs_unit &lt; 0 ) THEN<a name='4088'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_983"> ( 'module_ra_cam: radaeinit: Can not find unused fortran unit to read in lookup table.' )<a name='4089'>
      ENDIF<a name='4090'>
<a name='4091'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='4092'>
          OPEN(cam_abs_unit,FILE='CAM_ABS_DATA',                  &amp;<a name='4093'>
               FORM='UNFORMATTED',STATUS='OLD',ERR=9010)<a name='4094'>
          call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_768">(50,'reading CAM_ABS_DATA')<a name='4095'>
        ENDIF<a name='4096'>
<a name='4097'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_307"> ( A , size ( A ) * r8 )<a name='4098'>
<a name='4099'>
         IF ( wrf_dm_on_monitor() ) then<a name='4100'>
         READ (cam_abs_unit,ERR=9010) ah2onw<a name='4101'>
         READ (cam_abs_unit,ERR=9010) eh2onw <a name='4102'>
         READ (cam_abs_unit,ERR=9010) ah2ow <a name='4103'>
         READ (cam_abs_unit,ERR=9010) cn_ah2ow <a name='4104'>
         READ (cam_abs_unit,ERR=9010) cn_eh2ow <a name='4105'>
         READ (cam_abs_unit,ERR=9010) ln_ah2ow <a name='4106'>
         READ (cam_abs_unit,ERR=9010) ln_eh2ow <a name='4107'>
<a name='4108'>
         endif<a name='4109'>
<a name='4110'>
         DM_BCAST_MACRO(ah2onw)<a name='4111'>
         DM_BCAST_MACRO(eh2onw)<a name='4112'>
         DM_BCAST_MACRO(ah2ow)<a name='4113'>
         DM_BCAST_MACRO(cn_ah2ow)<a name='4114'>
         DM_BCAST_MACRO(cn_eh2ow)<a name='4115'>
         DM_BCAST_MACRO(ln_ah2ow)<a name='4116'>
         DM_BCAST_MACRO(ln_eh2ow)<a name='4117'>
<a name='4118'>
         IF ( wrf_dm_on_monitor() ) CLOSE (cam_abs_unit)<a name='4119'>
      <a name='4120'>
<font color=#447700>! Set up table of H2O saturation vapor pressures for use in calculation<a name='4121'></font>
<font color=#447700>!     effective path RH.  Need separate table from table in wv_saturation <a name='4122'></font>
<font color=#447700>!     because:<a name='4123'></font>
<font color=#447700>!     (1. Path temperatures can fall below minimum of that table; and<a name='4124'></font>
<font color=#447700>!     (2. Abs/Emissivity tables are derived with RH for water only.<a name='4125'></font>
<font color=#447700>!<a name='4126'></font>
      tmin = nint(min_tp_h2o)<a name='4127'>
      tmax = nint(max_tp_h2o)+1<a name='4128'>
      itype = 0<a name='4129'>
      do t = tmin, tmax<a name='4130'>
<font color=#447700>!        call gffgch(dble(t),estblh2o(t-tmin),itype)<a name='4131'></font>
         tdbl = t<a name='4132'>
         call <A href='../../html_code/phys/module_ra_cam_support.F.html#GFFGCH'>gffgch</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GFFGCH_3">(tdbl,estblh2o(t-tmin),itype)<a name='4133'>
      end do<a name='4134'>
<a name='4135'>
     RETURN<a name='4136'>
9010 CONTINUE<a name='4137'>
     WRITE( errmess , '(A35,I4)' ) 'module_ra_cam: error reading unit ',cam_abs_unit<a name='4138'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_cam_support.F.html#RADAEINI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_984">(errmess)<a name='4139'>
end subroutine radaeini<a name='4140'>
<a name='4141'>
 <a name='4142'>
end MODULE module_ra_cam_support<a name='4143'>
</pre></body></html>