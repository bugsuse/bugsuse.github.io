<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_SF_SSIB'><A href='../../html_code/phys/module_sf_ssib.F.html#MODULE_SF_SSIB' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>MODULE </font><font color=#cc0000>module_sf_ssib</font> <A href='../../call_to/MODULE_SF_SSIB.html' TARGET='index'>1</A><a name='3'>
<font color=#447700>!This version of SSiB land-surface model includes a multi-layer snow scheme<a name='4'></font>
<font color=#447700>!For better results, please use the SSiB vegetation map (geog_data_res in WPS)<a name='5'></font>
<font color=#447700>!References for the SSiB:<a name='6'></font>
<font color=#447700>!Xue et al. 1991, J. Climate, 4, 345-364.<a name='7'></font>
<font color=#447700>!Sun and Xue, 2001,  Adv. in Atmos. Sci, 18, 335-354.<a name='8'></font>
<font color=#447700>!Xue et al., 2003, J. Geophy. Res. 108, D22, doi: 10.1029/2002JD003174. <a name='9'></font>
<font color=#447700>!Coding by Fernando De Sales and  Zhengxin Liu (2011)<a name='10'></font>
 <a name='11'>
  REAL, PARAMETER      ::    CPAIR    = 1004.6                  &amp;<a name='12'>
                            ,STEFAN   = 5.669 * 10E-9           &amp;<a name='13'>
                            ,GRAV     = 9.81                    &amp;<a name='14'>
                            ,VKC      = 0.4                     &amp;<a name='15'>
                            ,PIE      = 3.14159265              &amp;<a name='16'>
                            ,TIMCON   = PIE/86400.              &amp;<a name='17'>
                            ,CLAI     = 4.2 * 1000. * 0.2       &amp;<a name='18'>
                            ,CW       = 4.2 * 1000. * 1000.     &amp;<a name='19'>
                            ,TF       = 273.16                  &amp;<a name='20'>
                            ,GASR     = 287.05                  &amp;<a name='21'>
                            ,HLAT     = 2.52E6                  &amp;<a name='22'>
                            ,SNOMEL   = 370518.5 * 1000.<a name='23'>
  INTEGER, PARAMETER   ::    ITRUNK   = 3<a name='24'>
<a name='25'>
<font color=#447700>!crr snow<a name='26'></font>
  REAL, PARAMETER      ::    SSISNOW  = 0.04                    &amp;<a name='27'>
                            ,FLMIN    = 0.03                    &amp;<a name='28'>
                            ,FLMAX    = 0.10                    &amp;<a name='29'>
                            ,DZMIN    = 0.002                   &amp;<a name='30'>
                            ,WOMIN    = 0.0004                  &amp;<a name='31'>
                            ,CL       = 4212.7                  &amp;<a name='32'>
                            ,DLM      = 3.335d5                 &amp;<a name='33'>
                            ,RHOWATER = 1000.0                  &amp;<a name='34'>
                            ,DICE     = 920.0                   &amp;<a name='35'>
                            ,DKSATSNOW= 0.01                    &amp;<a name='36'>
                            ,SNODEP_CR= 0.07<a name='37'>
  INTEGER, PARAMETER   ::    N        = 3                       &amp;<a name='38'>
                            ,N1       = 4                       &amp;<a name='39'>
                            ,N2       = 4<a name='40'>
<font color=#447700>!crr snow<a name='41'></font>
<font color=#447700>!ssib vegetation parameters<a name='42'></font>
 REAL, DIMENSION (13,2,3,2) :: tran0,ref0<a name='43'>
 REAL, DIMENSION (13,12,2) :: green0,vcover0,zlt0<a name='44'>
 REAL, DIMENSION (13,2,3) :: rstpar0<a name='45'>
 REAL, DIMENSION (13,12) :: z000,d0,z20,z10,rdc0,rbc0<a name='46'>
 REAL, DIMENSION (13,3) :: depth0,soref0<a name='47'>
 REAL, DIMENSION (13,2) :: chil0,topt0,tl0,tu0,defac0,ph10,ph20,rootd0<a name='48'>
 REAL, DIMENSION (13) :: bee0,phsat0,poros0,satco0,slope0<a name='49'>
<font color=#447700>!<a name='50'></font>
      data tran0/      &amp;<a name='51'>
          0.5000000E-01,  0.5000000E-01,  0.5000000E-01,  0.5000000E-01,      &amp;<a name='52'>
          0.5000000E-01,  0.5000000E-01,  0.7000000E-01,  0.5000000E-01,      &amp;<a name='53'>
          0.5000000E-01,  0.5000000E-01,  0.1000000E-02,  0.5000000E-01,      &amp;<a name='54'>
          0.1000000E-02,      &amp;<a name='55'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='56'>
          0.1000000E-02,  0.7000000E-01,  0.1000000E-02,  0.7000000E-01,      &amp;<a name='57'>
          0.1000000E-02,  0.7000000E-01,  0.1000000E-02,  0.7000000E-01,      &amp;<a name='58'>
          0.1000000E-02,      &amp;<a name='59'>
          0.2500000E+00,  0.2500000E+00,  0.1500000E+00,  0.1000000E+00,      &amp;<a name='60'>
          0.1000000E+00,  0.2500000E+00,  0.2475000E+00,  0.2500000E+00,      &amp;<a name='61'>
          0.2500000E+00,  0.2500000E+00,  0.1000000E-02,  0.2500000E+00,      &amp;<a name='62'>
          0.1000000E-02,      &amp;<a name='63'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='64'>
          0.1000000E-02,  0.2475000E+00,  0.1000000E-02,  0.2475000E+00,      &amp;<a name='65'>
          0.1000000E-02,  0.2475000E+00,  0.1000000E-02,  0.2475000E+00,      &amp;<a name='66'>
          0.1000000E-02,      &amp;<a name='67'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='68'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='69'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='70'>
          0.0000000E+00,      &amp;<a name='71'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='72'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='73'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='74'>
          0.0000000E+00,      &amp;<a name='75'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='76'>
          0.1000000E-02,  0.1000000E-02,  0.2200000E+00,  0.1000000E-02,      &amp;<a name='77'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='78'>
          0.1000000E-02,      &amp;<a name='79'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='80'>
          0.1000000E-02,  0.2200000E+00,  0.1000000E-02,  0.2200000E+00,      &amp;<a name='81'>
          0.1000000E-02,  0.2200000E+00,  0.1000000E-02,  0.2200000E+00,      &amp;<a name='82'>
          0.1000000E-02,      &amp;<a name='83'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='84'>
          0.1000000E-02,  0.1000000E-02,  0.3750000E+00,  0.1000000E-02,      &amp;<a name='85'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='86'>
          0.1000000E-02,      &amp;<a name='87'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='88'>
          0.1000000E-02,  0.3750000E+00,  0.1000000E-02,  0.3750000E+00,      &amp;<a name='89'>
          0.1000000E-02,  0.3750000E+00,  0.1000000E-02,  0.3750000E+00,      &amp;<a name='90'>
          0.1000000E-02,      &amp;<a name='91'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='92'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='93'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='94'>
          0.0000000E+00,      &amp;<a name='95'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='96'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='97'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='98'>
          0.0000000E+00/<a name='99'>
      data ref0/      &amp;<a name='100'>
          0.1000000E+00,  0.1000000E+00,  0.7000000E-01,  0.7000000E-01,      &amp;<a name='101'>
          0.7000000E-01,  0.1000000E+00,  0.1050000E+00,  0.1000000E+00,      &amp;<a name='102'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-02,  0.1000000E+00,      &amp;<a name='103'>
          0.1000000E-02,      &amp;<a name='104'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='105'>
          0.1000000E-02,  0.1050000E+00,  0.1000000E-02,  0.1050000E+00,      &amp;<a name='106'>
          0.1000000E-02,  0.1050000E+00,  0.1000000E-02,  0.1050000E+00,      &amp;<a name='107'>
          0.1000000E-02,      &amp;<a name='108'>
          0.4500000E+00,  0.4500000E+00,  0.4000000E+00,  0.3500000E+00,      &amp;<a name='109'>
          0.3500000E+00,  0.4500000E+00,  0.5775000E+00,  0.4500000E+00,      &amp;<a name='110'>
          0.4500000E+00,  0.4500000E+00,  0.1000000E-02,  0.4500000E+00,      &amp;<a name='111'>
          0.1000000E-02,      &amp;<a name='112'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='113'>
          0.1000000E-02,  0.5775000E+00,  0.1000000E-02,  0.5775000E+00,      &amp;<a name='114'>
          0.1000000E-02,  0.5775000E+00,  0.1000000E-02,  0.5775000E+00,      &amp;<a name='115'>
          0.1000000E-02,      &amp;<a name='116'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='117'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='118'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='119'>
          0.0000000E+00,      &amp;<a name='120'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='121'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='122'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='123'>
          0.0000000E+00,      &amp;<a name='124'>
          0.1600000E+00,  0.1600000E+00,  0.1600000E+00,  0.1600000E+00,      &amp;<a name='125'>
          0.1600000E+00,  0.1600000E+00,  0.3600000E+00,  0.1600000E+00,      &amp;<a name='126'>
          0.1600000E+00,  0.1600000E+00,  0.1000000E-02,  0.1600000E+00,      &amp;<a name='127'>
          0.1000000E-02,      &amp;<a name='128'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='129'>
          0.1000000E-02,  0.3600000E+00,  0.1000000E-02,  0.3600000E+00,      &amp;<a name='130'>
          0.1000000E-02,  0.3600000E+00,  0.1000000E-02,  0.3600000E+00,      &amp;<a name='131'>
          0.1000000E-02,      &amp;<a name='132'>
          0.3900000E+00,  0.3900000E+00,  0.3900000E+00,  0.3900000E+00,      &amp;<a name='133'>
          0.3900000E+00,  0.3900000E+00,  0.5775000E+00,  0.3900000E+00,      &amp;<a name='134'>
          0.3900000E+00,  0.3900000E+00,  0.1000000E-02,  0.3900000E+00,      &amp;<a name='135'>
          0.1000000E-02,      &amp;<a name='136'>
          0.1000000E-02,  0.1000000E-02,  0.1000000E-02,  0.1000000E-02,      &amp;<a name='137'>
          0.1000000E-02,  0.5775000E+00,  0.1000000E-02,  0.5775000E+00,      &amp;<a name='138'>
          0.1000000E-02,  0.5775000E+00,  0.1000000E-02,  0.5775000E+00,      &amp;<a name='139'>
          0.1000000E-02,      &amp;<a name='140'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='141'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='142'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='143'>
          0.0000000E+00,      &amp;<a name='144'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='145'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='146'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='147'>
          0.0000000E+00/<a name='148'>
      data green0/      &amp;<a name='149'>
          0.9050000E+00,  0.2564000E-01,  0.8680600E+00,  0.9132400E+00,      &amp;<a name='150'>
          0.2475200E+00,  0.6319100E+00,  0.5681800E+00,  0.7978700E+00,      &amp;<a name='151'>
          0.8364300E+00,  0.4512600E+00,  0.1000000E-03,  0.2083300E+00,      &amp;<a name='152'>
          0.1000000E-03,      &amp;<a name='153'>
          0.9050000E+00,  0.2564000E-01,  0.8717700E+00,  0.9170300E+00,      &amp;<a name='154'>
          0.2475200E+00,  0.6566600E+00,  0.6218900E+00,  0.5319100E+00,      &amp;<a name='155'>
          0.7172100E+00,  0.4512600E+00,  0.1000000E-03,  0.2083300E+00,      &amp;<a name='156'>
          0.1000000E-03,      &amp;<a name='157'>
          0.9050000E+00,  0.4153800E+00,  0.8847300E+00,  0.9226600E+00,      &amp;<a name='158'>
          0.2475200E+00,  0.5176000E+00,  0.6637200E+00,  0.3623200E+00,      &amp;<a name='159'>
          0.2577300E+00,  0.4512600E+00,  0.1000000E-03,  0.4411800E+00,      &amp;<a name='160'>
          0.1000000E-03,      &amp;<a name='161'>
          0.9050000E+00,  0.7594900E+00,  0.9061000E+00,  0.9247000E+00,      &amp;<a name='162'>
          0.6637200E+00,  0.6527400E+00,  0.6972100E+00,  0.5681800E+00,      &amp;<a name='163'>
          0.7246400E+00,  0.4512600E+00,  0.1000000E-03,  0.7594900E+00,      &amp;<a name='164'>
          0.1000000E-03,      &amp;<a name='165'>
          0.9050000E+00,  0.8875700E+00,  0.9164200E+00,  0.9266400E+00,      &amp;<a name='166'>
          0.8104700E+00,  0.6527400E+00,  0.8104700E+00,  0.5681800E+00,      &amp;<a name='167'>
          0.1736100E+00,  0.4512600E+00,  0.1000000E-03,  0.8875700E+00,      &amp;<a name='168'>
          0.1000000E-03,      &amp;<a name='169'>
          0.9050000E+00,  0.9252000E+00,  0.9259300E+00,  0.9045800E+00,      &amp;<a name='170'>
          0.8680600E+00,  0.7246400E+00,  0.9079900E+00,  0.5681800E+00,      &amp;<a name='171'>
          0.5681800E+00,  0.6218900E+00,  0.1000000E-03,  0.9252000E+00,      &amp;<a name='172'>
          0.1000000E-03,      &amp;<a name='173'>
          0.9050000E+00,  0.8364300E+00,  0.9293700E+00,  0.9021600E+00,      &amp;<a name='174'>
          0.6040900E+00,  0.8712500E+00,  0.8132000E+00,  0.5681800E+00,      &amp;<a name='175'>
          0.5681800E+00,  0.9200800E+00,  0.1000000E-03,  0.8364300E+00,      &amp;<a name='176'>
          0.1000000E-03,      &amp;<a name='177'>
          0.9050000E+00,  0.6967200E+00,  0.8209400E+00,  0.9126500E+00,      &amp;<a name='178'>
          0.5854000E+00,  0.7966000E+00,  0.3943200E+00,  0.8680600E+00,      &amp;<a name='179'>
          0.7246400E+00,  0.6970300E+00,  0.1000000E-03,  0.6967200E+00,      &amp;<a name='180'>
          0.1000000E-03,      &amp;<a name='181'>
          0.9050000E+00,  0.3306900E+00,  0.7123000E+00,  0.8982800E+00,      &amp;<a name='182'>
          0.4990000E+00,  0.7654600E+00,  0.4434600E+00,  0.6505600E+00,      &amp;<a name='183'>
          0.8403400E+00,  0.7567000E-01,  0.1000000E-03,  0.3439200E+00,      &amp;<a name='184'>
          0.1000000E-03,      &amp;<a name='185'>
          0.9050000E+00,  0.1656400E+00,  0.6145700E+00,  0.8548200E+00,      &amp;<a name='186'>
          0.3834400E+00,  0.6146100E+00,  0.5434800E+00,  0.5154600E+00,      &amp;<a name='187'>
          0.8680600E+00,  0.4512600E+00,  0.1000000E-03,  0.1785700E+00,      &amp;<a name='188'>
          0.1000000E-03,      &amp;<a name='189'>
          0.9050000E+00,  0.1538000E-01,  0.8599500E+00,  0.8733600E+00,      &amp;<a name='190'>
          0.2487600E+00,  0.5086500E+00,  0.5531000E+00,  0.6302500E+00,      &amp;<a name='191'>
          0.8875700E+00,  0.4512600E+00,  0.1000000E-03,  0.1470600E+00,      &amp;<a name='192'>
          0.1000000E-03,      &amp;<a name='193'>
          0.9050000E+00,  0.2564000E-01,  0.8599500E+00,  0.9132400E+00,      &amp;<a name='194'>
          0.1984100E+00,  0.7898900E+00,  0.4975100E+00,  0.7978700E+00,      &amp;<a name='195'>
          0.9132400E+00,  0.4512600E+00,  0.1000000E-03,  0.2083300E+00,      &amp;<a name='196'>
          0.1000000E-03,      &amp;<a name='197'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='198'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='199'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='200'>
          0.1000000E-03,      &amp;<a name='201'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='202'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='203'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='204'>
          0.1000000E-03,      &amp;<a name='205'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='206'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='207'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='208'>
          0.1000000E-03,      &amp;<a name='209'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='210'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='211'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='212'>
          0.1000000E-03,      &amp;<a name='213'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='214'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='215'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='216'>
          0.1000000E-03,      &amp;<a name='217'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='218'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='219'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='220'>
          0.1000000E-03,      &amp;<a name='221'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='222'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='223'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='224'>
          0.1000000E-03,      &amp;<a name='225'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='226'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='227'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='228'>
          0.1000000E-03,      &amp;<a name='229'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='230'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='231'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='232'>
          0.1000000E-03,      &amp;<a name='233'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='234'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='235'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='236'>
          0.1000000E-03,      &amp;<a name='237'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='238'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='239'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='240'>
          0.1000000E-03,      &amp;<a name='241'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='242'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='243'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='244'>
          0.1000000E-03/<a name='245'>
      data vcover0/      &amp;<a name='246'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='247'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='248'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='249'>
          0.1000000E-04,      &amp;<a name='250'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='251'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='252'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='253'>
          0.1000000E-04,      &amp;<a name='254'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='255'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='256'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='257'>
          0.1000000E-04,      &amp;<a name='258'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='259'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='260'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='261'>
          0.1000000E-04,      &amp;<a name='262'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='263'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='264'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='265'>
          0.1000000E-04,      &amp;<a name='266'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='267'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='268'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='269'>
          0.1000000E-04,      &amp;<a name='270'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='271'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='272'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='273'>
          0.1000000E-04,      &amp;<a name='274'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='275'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='276'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='277'>
          0.1000000E-04,      &amp;<a name='278'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='279'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='280'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='281'>
          0.1000000E-04,      &amp;<a name='282'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='283'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='284'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='285'>
          0.1000000E-04,      &amp;<a name='286'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='287'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='288'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='289'>
          0.1000000E-04,      &amp;<a name='290'>
          0.9800000E+00,  0.7500000E+00,  0.7500000E+00,  0.7500000E+00,      &amp;<a name='291'>
          0.5000000E+00,  0.3000000E+00,  0.9000000E+00,  0.1000000E+00,      &amp;<a name='292'>
          0.1000000E+00,  0.3000000E+00,  0.1000000E-04,  0.7500000E-01,      &amp;<a name='293'>
          0.1000000E-04,      &amp;<a name='294'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='295'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='296'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='297'>
          0.1000000E-04,      &amp;<a name='298'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='299'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='300'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='301'>
          0.1000000E-04,      &amp;<a name='302'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='303'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='304'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='305'>
          0.1000000E-04,      &amp;<a name='306'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='307'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='308'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='309'>
          0.1000000E-04,      &amp;<a name='310'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='311'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='312'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='313'>
          0.1000000E-04,      &amp;<a name='314'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='315'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='316'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='317'>
          0.1000000E-04,      &amp;<a name='318'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='319'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='320'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='321'>
          0.1000000E-04,      &amp;<a name='322'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='323'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='324'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='325'>
          0.1000000E-04,      &amp;<a name='326'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='327'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='328'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='329'>
          0.1000000E-04,      &amp;<a name='330'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='331'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='332'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='333'>
          0.1000000E-04,      &amp;<a name='334'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='335'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='336'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='337'>
          0.1000000E-04,      &amp;<a name='338'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='339'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='340'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-04,  0.1000000E-03,      &amp;<a name='341'>
          0.1000000E-04/<a name='342'>
      data chil0/      &amp;<a name='343'>
          0.1000000E+00,  0.2500000E+00,  0.1300000E+00,  0.1000000E-01,      &amp;<a name='344'>
          0.1000000E-01,  0.1000000E-01, -0.3000000E+00,  0.1000000E-01,      &amp;<a name='345'>
          0.1000000E-01,  0.2000000E+00,  0.1000000E-01, -0.2000000E-01,      &amp;<a name='346'>
          0.1000000E-01,      &amp;<a name='347'>
          0.1000000E+00,  0.2500000E+00,  0.1300000E+00,  0.1000000E-01,      &amp;<a name='348'>
          0.1000000E-01, -0.3000000E+00, -0.3000000E+00, -0.3000000E+00,      &amp;<a name='349'>
          0.1000000E-01,  0.2000000E+00,  0.1000000E-01, -0.2000000E-01,      &amp;<a name='350'>
          0.1000000E-01/<a name='351'>
      data rstpar0/      &amp;<a name='352'>
          0.2335900E+04,  0.9802230E+04,  0.6335955E+04,  0.2869680E+04,      &amp;<a name='353'>
          0.2869680E+04,  0.5665121E+05,  0.2582010E+04,  0.9398942E+05,      &amp;<a name='354'>
          0.9398942E+05,  0.9802230E+04,  0.1000000E+04,  0.7459000E+04,      &amp;<a name='355'>
          0.1000000E+04,      &amp;<a name='356'>
          0.2335900E+04,  0.9802230E+04,  0.6335955E+04,  0.2869680E+04,      &amp;<a name='357'>
          0.2869680E+04,  0.2582010E+04,  0.2582010E+04,  0.2582010E+04,      &amp;<a name='358'>
          0.1000000E+01,  0.2582010E+04,  0.1000000E+04,  0.7459000E+04,      &amp;<a name='359'>
          0.1000000E+04,      &amp;<a name='360'>
          0.1450000E-01,  0.1055000E+02,  0.7120000E+01,  0.3690000E+01,      &amp;<a name='361'>
          0.3690000E+01,  0.1083000E+02,  0.1090000E+01,  0.1000000E-01,      &amp;<a name='362'>
          0.1000000E-01,  0.1055000E+02,  0.1000000E+04,  0.5700000E+01,      &amp;<a name='363'>
          0.1000000E+04,      &amp;<a name='364'>
          0.1450000E-01,  0.1055000E+02,  0.7120000E+01,  0.3690000E+01,      &amp;<a name='365'>
          0.3690000E+01,  0.1090000E+01,  0.1090000E+01,  0.1090000E+01,      &amp;<a name='366'>
          0.1000000E+01,  0.1090000E+01,  0.1000000E+04,  0.5700000E+01,      &amp;<a name='367'>
          0.1000000E+04,      &amp;<a name='368'>
          0.1534900E+03,  0.1800000E+03,  0.2065000E+03,  0.2330000E+03,      &amp;<a name='369'>
          0.2330000E+03,  0.1650000E+03,  0.1100000E+03,  0.8550000E+03,      &amp;<a name='370'>
          0.8550000E+03,  0.1800000E+03,  0.1000000E+04,  0.2520000E+02,      &amp;<a name='371'>
          0.1000000E+04,      &amp;<a name='372'>
          0.1534900E+03,  0.1800000E+03,  0.2065000E+03,  0.2330000E+03,      &amp;<a name='373'>
          0.2330000E+03,  0.1100000E+03,  0.1100000E+03,  0.1100000E+03,      &amp;<a name='374'>
          0.1000000E+01,  0.1100000E+03,  0.1000000E+04,  0.2520000E+02,      &amp;<a name='375'>
          0.1000000E+04/<a name='376'>
      data topt0/      &amp;<a name='377'>
          0.3030000E+03,  0.3000000E+03,  0.2940000E+03,  0.2880000E+03,      &amp;<a name='378'>
          0.2880000E+03,  0.2970000E+03,  0.3130000E+03,  0.3150000E+03,      &amp;<a name='379'>
          0.3150000E+03,  0.3000000E+03,  0.3100000E+03,  0.3000000E+03,      &amp;<a name='380'>
          0.3100000E+03,      &amp;<a name='381'>
          0.3030000E+03,  0.3000000E+03,  0.2940000E+03,  0.2880000E+03,      &amp;<a name='382'>
          0.2880000E+03,  0.3120000E+03,  0.3130000E+03,  0.3130000E+03,      &amp;<a name='383'>
          0.3150000E+03,  0.2890000E+03,  0.3100000E+03,  0.3000000E+03,      &amp;<a name='384'>
          0.3100000E+03/<a name='385'>
      data tl0/      &amp;<a name='386'>
          0.2730000E+03,  0.2730000E+03,  0.2700000E+03,  0.2680000E+03,      &amp;<a name='387'>
          0.2680000E+03,  0.2730000E+03,  0.2830000E+03,  0.2830000E+03,      &amp;<a name='388'>
          0.2830000E+03,  0.2730000E+03,  0.3000000E+03,  0.2730000E+03,      &amp;<a name='389'>
          0.3000000E+03,      &amp;<a name='390'>
          0.2730000E+03,  0.2730000E+03,  0.2700000E+03,  0.2680000E+03,      &amp;<a name='391'>
          0.2680000E+03,  0.2730000E+03,  0.2830000E+03,  0.2830000E+03,      &amp;<a name='392'>
          0.2830000E+03,  0.2730000E+03,  0.3000000E+03,  0.2730000E+03,      &amp;<a name='393'>
          0.3000000E+03/<a name='394'>
      data tu0/      &amp;<a name='395'>
          0.3180000E+03,  0.3180000E+03,  0.3150000E+03,  0.3130000E+03,      &amp;<a name='396'>
          0.3130000E+03,  0.3230000E+03,  0.3280000E+03,  0.3230000E+03,      &amp;<a name='397'>
          0.3230000E+03,  0.3230000E+03,  0.3200000E+03,  0.3180000E+03,      &amp;<a name='398'>
          0.3200000E+03,      &amp;<a name='399'>
          0.3180000E+03,  0.3180000E+03,  0.3150000E+03,  0.3130000E+03,      &amp;<a name='400'>
          0.3130000E+03,  0.3230000E+03,  0.3280000E+03,  0.3280000E+03,      &amp;<a name='401'>
          0.3230000E+03,  0.3090000E+03,  0.3200000E+03,  0.3150000E+03,      &amp;<a name='402'>
          0.3200000E+03/<a name='403'>
      data defac0/      &amp;<a name='404'>
          0.2730000E-01,  0.3570000E-01,  0.3400000E-01,  0.3100000E-01,      &amp;<a name='405'>
          0.3100000E-01,  0.3570000E-01,  0.2380000E-01,  0.2750000E-01,      &amp;<a name='406'>
          0.2750000E-01,  0.2750000E-01,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='407'>
          0.0000000E+00,      &amp;<a name='408'>
          0.2730000E-01,  0.3570000E-01,  0.3400000E-01,  0.3100000E-01,      &amp;<a name='409'>
          0.3100000E-01,  0.2380000E-01,  0.2380000E-01,  0.2380000E-01,      &amp;<a name='410'>
          0.2380000E-01,  0.2380000E-01,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='411'>
          0.0000000E+00/<a name='412'>
      data ph10/      &amp;<a name='413'>
          0.1200000E+01,  0.5350000E+01,  0.1920000E+01,  0.3700000E+01,      &amp;<a name='414'>
          0.7800000E+01,  0.1800000E+01,  0.1730000E+01,  0.1920000E+01,      &amp;<a name='415'>
          0.1390000E+01,  0.9600000E+00,  0.3000000E+01,  0.1800000E+01,      &amp;<a name='416'>
          0.5000000E+01,      &amp;<a name='417'>
          0.1200000E+01,  0.5350000E+01,  0.1920000E+01,  0.3700000E+01,      &amp;<a name='418'>
          0.7800000E+01,  0.1800000E+01,  0.1730000E+01,  0.1920000E+01,      &amp;<a name='419'>
          0.1390000E+01,  0.9600000E+00,  0.3000000E+01,  0.1800000E+01,      &amp;<a name='420'>
          0.5000000E+01/<a name='421'>
      data ph20/      &amp;<a name='422'>
          0.6250000E+01,  0.5570000E+01,  0.5730000E+01,  0.5530000E+01,      &amp;<a name='423'>
          0.5660000E+01,  0.5670000E+01,  0.5800000E+01,  0.5610000E+01,      &amp;<a name='424'>
          0.6370000E+01,  0.5370000E+01,  0.6000000E+01,  0.5670000E+01,      &amp;<a name='425'>
          0.6000000E+01,      &amp;<a name='426'>
          0.6250000E+01,  0.5570000E+01,  0.5730000E+01,  0.5530000E+01,      &amp;<a name='427'>
          0.5660000E+01,  0.5670000E+01,  0.5800000E+01,  0.5610000E+01,      &amp;<a name='428'>
          0.6370000E+01,  0.5370000E+01,  0.6000000E+01,  0.5670000E+01,      &amp;<a name='429'>
          0.6000000E+01/<a name='430'>
      data zlt0/      &amp;<a name='431'>
          0.5014160E+01,  0.3900000E+00,  0.3456000E+01,  0.6570000E+01,      &amp;<a name='432'>
          0.4040000E+00,  0.1766000E+01,  0.7040000E+00,  0.5780000E+00,      &amp;<a name='433'>
          0.1076000E+01,  0.3776000E+00,  0.1000000E-03,  0.4800000E-01,      &amp;<a name='434'>
          0.1000000E-03,      &amp;<a name='435'>
          0.5014160E+01,  0.3900000E+00,  0.3556000E+01,  0.6870000E+01,      &amp;<a name='436'>
          0.4040000E+00,  0.1546000E+01,  0.8040000E+00,  0.5780000E+00,      &amp;<a name='437'>
          0.9760000E+00,  0.3776000E+00,  0.1000000E-03,  0.4800000E-01,      &amp;<a name='438'>
          0.1000000E-03,      &amp;<a name='439'>
          0.5014160E+01,  0.6500000E+00,  0.3956000E+01,  0.7370000E+01,      &amp;<a name='440'>
          0.4040000E+00,  0.1416000E+01,  0.9040000E+00,  0.4480000E+00,      &amp;<a name='441'>
          0.7760000E+00,  0.3776000E+00,  0.1000000E-03,  0.6800000E-01,      &amp;<a name='442'>
          0.1000000E-03,      &amp;<a name='443'>
          0.5014160E+01,  0.1580000E+01,  0.4856000E+01,  0.7570000E+01,      &amp;<a name='444'>
          0.9040000E+00,  0.1216000E+01,  0.1004000E+01,  0.2880000E+00,      &amp;<a name='445'>
          0.2760000E+00,  0.3776000E+00,  0.1000000E-03,  0.1580000E+00,      &amp;<a name='446'>
          0.1000000E-03,      &amp;<a name='447'>
          0.5014160E+01,  0.3380000E+01,  0.5456000E+01,  0.7770000E+01,      &amp;<a name='448'>
          0.1604000E+01,  0.1186000E+01,  0.1604000E+01,  0.2580000E+00,      &amp;<a name='449'>
          0.5760000E+00,  0.3776000E+00,  0.1000000E-03,  0.3380000E+00,      &amp;<a name='450'>
          0.1000000E-03,      &amp;<a name='451'>
          0.5014160E+01,  0.5080000E+01,  0.6156000E+01,  0.8070000E+01,      &amp;<a name='452'>
          0.2304000E+01,  0.1416000E+01,  0.3304000E+01,  0.2580000E+00,      &amp;<a name='453'>
          0.1760000E+00,  0.5076000E+00,  0.1000000E-03,  0.5080000E+00,      &amp;<a name='454'>
          0.1000000E-03,      &amp;<a name='455'>
          0.5014160E+01,  0.5380000E+01,  0.6456000E+01,  0.7870000E+01,      &amp;<a name='456'>
          0.4304000E+01,  0.2606000E+01,  0.4304000E+01,  0.2580000E+00,      &amp;<a name='457'>
          0.1760000E+00,  0.1737600E+01,  0.1000000E-03,  0.5380000E+00,      &amp;<a name='458'>
          0.1000000E-03,      &amp;<a name='459'>
          0.5014160E+01,  0.4880000E+01,  0.6456000E+01,  0.7670000E+01,      &amp;<a name='460'>
          0.2904000E+01,  0.5206000E+01,  0.3804000E+01,  0.8080000E+00,      &amp;<a name='461'>
          0.2760000E+00,  0.1937600E+01,  0.1000000E-03,  0.4880000E+00,      &amp;<a name='462'>
          0.1000000E-03,      &amp;<a name='463'>
          0.5014160E+01,  0.3780000E+01,  0.5756000E+01,  0.7570000E+01,      &amp;<a name='464'>
          0.2004000E+01,  0.4556000E+01,  0.1804000E+01,  0.1508000E+01,      &amp;<a name='465'>
          0.4760000E+00,  0.1477600E+01,  0.1000000E-03,  0.3780000E+00,      &amp;<a name='466'>
          0.1000000E-03,      &amp;<a name='467'>
          0.5014160E+01,  0.1630000E+01,  0.4556000E+01,  0.7370000E+01,      &amp;<a name='468'>
          0.1304000E+01,  0.3816000E+01,  0.1104000E+01,  0.1148000E+01,      &amp;<a name='469'>
          0.5760000E+00,  0.3776000E+00,  0.1000000E-03,  0.1680000E+00,      &amp;<a name='470'>
          0.1000000E-03,      &amp;<a name='471'>
          0.5014160E+01,  0.6500000E+00,  0.3256000E+01,  0.6870000E+01,      &amp;<a name='472'>
          0.8040000E+00,  0.2806000E+01,  0.9040000E+00,  0.7480000E+00,      &amp;<a name='473'>
          0.6760000E+00,  0.3776000E+00,  0.1000000E-03,  0.6800000E-01,      &amp;<a name='474'>
          0.1000000E-03,      &amp;<a name='475'>
          0.5014160E+01,  0.3900000E+00,  0.3256000E+01,  0.6570000E+01,      &amp;<a name='476'>
          0.5040000E+00,  0.1866000E+01,  0.8040000E+00,  0.5780000E+00,      &amp;<a name='477'>
          0.8760000E+00,  0.3776000E+00,  0.1000000E-03,  0.4800000E-01,      &amp;<a name='478'>
          0.1000000E-03,      &amp;<a name='479'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='480'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='481'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='482'>
          0.1000000E-03,      &amp;<a name='483'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='484'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='485'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='486'>
          0.1000000E-03,      &amp;<a name='487'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='488'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='489'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='490'>
          0.1000000E-03,      &amp;<a name='491'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='492'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='493'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='494'>
          0.1000000E-03,      &amp;<a name='495'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='496'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='497'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='498'>
          0.1000000E-03,      &amp;<a name='499'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='500'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='501'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='502'>
          0.1000000E-03,      &amp;<a name='503'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='504'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='505'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='506'>
          0.1000000E-03,      &amp;<a name='507'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='508'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='509'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='510'>
          0.1000000E-03,      &amp;<a name='511'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='512'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='513'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='514'>
          0.1000000E-03,      &amp;<a name='515'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='516'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='517'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='518'>
          0.1000000E-03,      &amp;<a name='519'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='520'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='521'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='522'>
          0.1000000E-03,      &amp;<a name='523'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='524'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='525'>
          0.1000000E-03,  0.1000000E-03,  0.1000000E-03,  0.1000000E-03,      &amp;<a name='526'>
          0.1000000E-03/<a name='527'>
      data z000/      &amp;<a name='528'>
          0.2652970E+01,  0.5201000E+00,  0.5706300E+00,  0.1112210E+01,      &amp;<a name='529'>
          0.6414000E+00,  0.8427100E+00,  0.7771000E-01,  0.2446700E+00,      &amp;<a name='530'>
          0.6559000E-01,  0.7524000E-01,  0.1118000E-01,  0.1448500E+00,      &amp;<a name='531'>
          0.1011000E-01,      &amp;<a name='532'>
          0.2652970E+01,  0.5201000E+00,  0.5696600E+00,  0.1102780E+01,      &amp;<a name='533'>
          0.6414000E+00,  0.8087800E+00,  0.7779000E-01,  0.2446700E+00,      &amp;<a name='534'>
          0.6549000E-01,  0.7524000E-01,  0.1118000E-01,  0.1448500E+00,      &amp;<a name='535'>
          0.1011000E-01,      &amp;<a name='536'>
          0.2652970E+01,  0.6664900E+00,  0.5656600E+00,  0.1087660E+01,      &amp;<a name='537'>
          0.6414000E+00,  0.7875000E+00,  0.7785000E-01,  0.2272100E+00,      &amp;<a name='538'>
          0.6521000E-01,  0.7524000E-01,  0.1118000E-01,  0.1752100E+00,      &amp;<a name='539'>
          0.1011000E-01,      &amp;<a name='540'>
          0.2652970E+01,  0.9105300E+00,  0.5654400E+00,  0.1081830E+01,      &amp;<a name='541'>
          0.8633500E+00,  0.7284100E+00,  0.7788000E-01,  0.1998800E+00,      &amp;<a name='542'>
          0.6360000E-01,  0.7524000E-01,  0.1118000E-01,  0.2871900E+00,      &amp;<a name='543'>
          0.1011000E-01,      &amp;<a name='544'>
          0.2652970E+01,  0.1031200E+01,  0.5592300E+00,  0.1076120E+01,      &amp;<a name='545'>
          0.9728300E+00,  0.7284100E+00,  0.7779000E-01,  0.1998800E+00,      &amp;<a name='546'>
          0.6480000E-01,  0.7524000E-01,  0.1118000E-01,  0.4302000E+00,      &amp;<a name='547'>
          0.1011000E-01,      &amp;<a name='548'>
          0.2652970E+01,  0.1043680E+01,  0.5524400E+00,  0.1067790E+01,      &amp;<a name='549'>
          0.1005600E+01,  0.7875000E+00,  0.7712000E-01,  0.1998800E+00,      &amp;<a name='550'>
          0.6331000E-01,  0.7575000E-01,  0.1118000E-01,  0.5087600E+00,      &amp;<a name='551'>
          0.1011000E-01,      &amp;<a name='552'>
          0.2652970E+01,  0.1041940E+01,  0.5497000E+00,  0.1073310E+01,      &amp;<a name='553'>
          0.9967700E+00,  0.9266800E+00,  0.7594000E-01,  0.1998800E+00,      &amp;<a name='554'>
          0.6331000E-01,  0.7767000E-01,  0.1118000E-01,  0.5200300E+00,      &amp;<a name='555'>
          0.1011000E-01,      &amp;<a name='556'>
          0.2652970E+01,  0.1037530E+01,  0.5497000E+00,  0.1078960E+01,      &amp;<a name='557'>
          0.1011190E+01,  0.9715300E+00,  0.7658000E-01,  0.2674000E+00,      &amp;<a name='558'>
          0.6360000E-01,  0.7782000E-01,  0.1118000E-01,  0.5009500E+00,      &amp;<a name='559'>
          0.1011000E-01,      &amp;<a name='560'>
          0.2652970E+01,  0.1036510E+01,  0.5562600E+00,  0.1081830E+01,      &amp;<a name='561'>
          0.9965000E+00,  0.9658800E+00,  0.7776000E-01,  0.2923300E+00,      &amp;<a name='562'>
          0.6446000E-01,  0.7745000E-01,  0.1118000E-01,  0.4503800E+00,      &amp;<a name='563'>
          0.1011000E-01,      &amp;<a name='564'>
          0.2652970E+01,  0.9170700E+00,  0.5686600E+00,  0.1087660E+01,      &amp;<a name='565'>
          0.9386100E+00,  0.9555100E+00,  0.7790000E-01,  0.2803400E+00,      &amp;<a name='566'>
          0.6480000E-01,  0.7524000E-01,  0.1118000E-01,  0.2973700E+00,      &amp;<a name='567'>
          0.1011000E-01,      &amp;<a name='568'>
          0.2652970E+01,  0.6664900E+00,  0.5725100E+00,  0.1102780E+01,      &amp;<a name='569'>
          0.8346400E+00,  0.9204000E+00,  0.7785000E-01,  0.2580600E+00,      &amp;<a name='570'>
          0.6510000E-01,  0.7524000E-01,  0.1118000E-01,  0.1752100E+00,      &amp;<a name='571'>
          0.1011000E-01,      &amp;<a name='572'>
          0.2652970E+01,  0.5201000E+00,  0.5725100E+00,  0.1112210E+01,      &amp;<a name='573'>
          0.7049800E+00,  0.8427100E+00,  0.7779000E-01,  0.2446700E+00,      &amp;<a name='574'>
          0.6537000E-01,  0.7524000E-01,  0.1118000E-01,  0.1448500E+00,      &amp;<a name='575'>
          0.1011000E-01/<a name='576'>
      data d0/      &amp;<a name='577'>
          0.2737261E+02,  0.1366377E+02,  0.1813464E+02,  0.1376361E+02,      &amp;<a name='578'>
          0.9193320E+01,  0.1390777E+02,  0.2185200E+00,  0.2812600E+01,      &amp;<a name='579'>
          0.1638000E+00,  0.1062900E+00,  0.6000000E-04,  0.6314240E+01,      &amp;<a name='580'>
          0.4000000E-04,      &amp;<a name='581'>
          0.2737261E+02,  0.1366377E+02,  0.1814677E+02,  0.1380041E+02,      &amp;<a name='582'>
          0.9193320E+01,  0.1376090E+02,  0.2265800E+00,  0.2812600E+01,      &amp;<a name='583'>
          0.1548100E+00,  0.1062900E+00,  0.6000000E-04,  0.6314240E+01,      &amp;<a name='584'>
          0.4000000E-04,      &amp;<a name='585'>
          0.2737261E+02,  0.1461883E+02,  0.1819051E+02,  0.1385740E+02,      &amp;<a name='586'>
          0.9193320E+01,  0.1367074E+02,  0.2332800E+00,  0.2662290E+01,      &amp;<a name='587'>
          0.1343400E+00,  0.1062900E+00,  0.6000000E-04,  0.7639520E+01,      &amp;<a name='588'>
          0.4000000E-04,      &amp;<a name='589'>
          0.2737261E+02,  0.1569677E+02,  0.1825890E+02,  0.1387880E+02,      &amp;<a name='590'>
          0.9903400E+01,  0.1344527E+02,  0.2389500E+00,  0.2390910E+01,      &amp;<a name='591'>
          0.6191000E-01,  0.1062900E+00,  0.6000000E-04,  0.1070958E+02,      &amp;<a name='592'>
          0.4000000E-04,      &amp;<a name='593'>
          0.2737261E+02,  0.1632865E+02,  0.1829956E+02,  0.1389946E+02,      &amp;<a name='594'>
          0.1030010E+02,  0.1344527E+02,  0.2605400E+00,  0.2390910E+01,      &amp;<a name='595'>
          0.1096800E+00,  0.1062900E+00,  0.6000000E-04,  0.1278272E+02,      &amp;<a name='596'>
          0.4000000E-04,      &amp;<a name='597'>
          0.2737261E+02,  0.1662263E+02,  0.1833903E+02,  0.1392915E+02,      &amp;<a name='598'>
          0.1053455E+02,  0.1367074E+02,  0.2988000E+00,  0.2390910E+01,      &amp;<a name='599'>
          0.5103000E-01,  0.1229900E+00,  0.6000000E-04,  0.1356813E+02,      &amp;<a name='600'>
          0.4000000E-04,      &amp;<a name='601'>
          0.2737261E+02,  0.1666297E+02,  0.1835387E+02,  0.1390953E+02,      &amp;<a name='602'>
          0.1091967E+02,  0.1425275E+02,  0.3251800E+00,  0.2390910E+01,      &amp;<a name='603'>
          0.5103000E-01,  0.2152100E+00,  0.6000000E-04,  0.1366182E+02,      &amp;<a name='604'>
          0.4000000E-04,      &amp;<a name='605'>
          0.2737261E+02,  0.1660123E+02,  0.1835387E+02,  0.1388922E+02,      &amp;<a name='606'>
          0.1068047E+02,  0.1459719E+02,  0.3130700E+00,  0.2974600E+01,      &amp;<a name='607'>
          0.6191000E-01,  0.2289700E+00,  0.6000000E-04,  0.1349985E+02,      &amp;<a name='608'>
          0.4000000E-04,      &amp;<a name='609'>
          0.2737261E+02,  0.1641343E+02,  0.1831739E+02,  0.1387880E+02,      &amp;<a name='610'>
          0.1044517E+02,  0.1452246E+02,  0.2649800E+00,  0.3137710E+01,      &amp;<a name='611'>
          0.9547000E-01,  0.1996100E+00,  0.6000000E-04,  0.1301951E+02,      &amp;<a name='612'>
          0.4000000E-04,      &amp;<a name='613'>
          0.2737261E+02,  0.1572679E+02,  0.1823553E+02,  0.1385740E+02,      &amp;<a name='614'>
          0.1016423E+02,  0.1443002E+02,  0.2438100E+00,  0.3062460E+01,      &amp;<a name='615'>
          0.1096800E+00,  0.1062900E+00,  0.6000000E-04,  0.1090759E+02,      &amp;<a name='616'>
          0.4000000E-04,      &amp;<a name='617'>
          0.2737261E+02,  0.1461883E+02,  0.1810866E+02,  0.1380041E+02,      &amp;<a name='618'>
          0.9814290E+01,  0.1422050E+02,  0.2332800E+00,  0.2907360E+01,      &amp;<a name='619'>
          0.1225000E+00,  0.1062900E+00,  0.6000000E-04,  0.7639520E+01,      &amp;<a name='620'>
          0.4000000E-04,      &amp;<a name='621'>
          0.2737261E+02,  0.1366377E+02,  0.1810866E+02,  0.1376361E+02,      &amp;<a name='622'>
          0.9417390E+01,  0.1390777E+02,  0.2265800E+00,  0.2812600E+01,      &amp;<a name='623'>
          0.1450200E+00,  0.1062900E+00,  0.6000000E-04,  0.6314240E+01,      &amp;<a name='624'>
          0.4000000E-04/<a name='625'>
      data z10/      &amp;<a name='626'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='627'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='628'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='629'>
          0.1000000E-03,      &amp;<a name='630'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='631'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='632'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='633'>
          0.1000000E-03,      &amp;<a name='634'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='635'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='636'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='637'>
          0.1000000E-03,      &amp;<a name='638'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='639'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='640'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='641'>
          0.1000000E-03,      &amp;<a name='642'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='643'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='644'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='645'>
          0.1000000E-03,      &amp;<a name='646'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='647'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='648'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='649'>
          0.1000000E-03,      &amp;<a name='650'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='651'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='652'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='653'>
          0.1000000E-03,      &amp;<a name='654'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='655'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='656'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='657'>
          0.1000000E-03,      &amp;<a name='658'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='659'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='660'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='661'>
          0.1000000E-03,      &amp;<a name='662'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='663'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='664'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='665'>
          0.1000000E-03,      &amp;<a name='666'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='667'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='668'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='669'>
          0.1000000E-03,      &amp;<a name='670'>
          0.1000000E+01,  0.1150000E+02,  0.1600000E+02,  0.8500000E+01,      &amp;<a name='671'>
          0.7000000E+01,  0.1000000E+02,  0.1000000E+00,  0.2000000E+01,      &amp;<a name='672'>
          0.1000000E+00,  0.1000000E+00,  0.1000000E-01,  0.1150000E+02,      &amp;<a name='673'>
          0.1000000E-03/<a name='674'>
      data z20/      &amp;<a name='675'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='676'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='677'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='678'>
          0.1000000E+00,      &amp;<a name='679'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='680'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='681'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='682'>
          0.1000000E+00,      &amp;<a name='683'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='684'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='685'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='686'>
          0.1000000E+00,      &amp;<a name='687'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='688'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='689'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='690'>
          0.1000000E+00,      &amp;<a name='691'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='692'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='693'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='694'>
          0.1000000E+00,      &amp;<a name='695'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='696'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='697'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='698'>
          0.1000000E+00,      &amp;<a name='699'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='700'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='701'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='702'>
          0.1000000E+00,      &amp;<a name='703'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='704'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='705'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='706'>
          0.1000000E+00,      &amp;<a name='707'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='708'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='709'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='710'>
          0.1000000E+00,      &amp;<a name='711'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='712'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='713'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='714'>
          0.1000000E+00,      &amp;<a name='715'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='716'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='717'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='718'>
          0.1000000E+00,      &amp;<a name='719'>
          0.3500000E+02,  0.2000000E+02,  0.2000000E+02,  0.1700000E+02,      &amp;<a name='720'>
          0.1400000E+02,  0.1800000E+02,  0.6000000E+00,  0.5000000E+01,      &amp;<a name='721'>
          0.5000000E+00,  0.6000000E+00,  0.1000000E+00,  0.2000000E+02,      &amp;<a name='722'>
          0.1000000E+00/<a name='723'>
      data rdc0/      &amp;<a name='724'>
          0.2858700E+03,  0.2113200E+03,  0.2985200E+03,  0.5654100E+03,      &amp;<a name='725'>
          0.1852000E+03,  0.2301300E+03,  0.2443000E+02,  0.1036000E+03,      &amp;<a name='726'>
          0.2311000E+02,  0.2286000E+02,  0.2376000E+02,  0.1949000E+03,      &amp;<a name='727'>
          0.2850000E+02,      &amp;<a name='728'>
          0.2858700E+03,  0.2113200E+03,  0.3013500E+03,  0.5870500E+03,      &amp;<a name='729'>
          0.1852000E+03,  0.2244200E+03,  0.2463000E+02,  0.1036000E+03,      &amp;<a name='730'>
          0.2294000E+02,  0.2286000E+02,  0.2376000E+02,  0.1949000E+03,      &amp;<a name='731'>
          0.2850000E+02,      &amp;<a name='732'>
          0.2858700E+03,  0.2187800E+03,  0.3124600E+03,  0.6234600E+03,      &amp;<a name='733'>
          0.1852000E+03,  0.2215700E+03,  0.2480000E+02,  0.1023500E+03,      &amp;<a name='734'>
          0.2262000E+02,  0.2286000E+02,  0.2376000E+02,  0.1964400E+03,      &amp;<a name='735'>
          0.2850000E+02,      &amp;<a name='736'>
          0.2858700E+03,  0.2434000E+03,  0.3312300E+03,  0.6381300E+03,      &amp;<a name='737'>
          0.2048700E+03,  0.2164100E+03,  0.2496000E+02,  0.1007200E+03,      &amp;<a name='738'>
          0.2189000E+02,  0.2286000E+02,  0.2376000E+02,  0.2014400E+03,      &amp;<a name='739'>
          0.2850000E+02,      &amp;<a name='740'>
          0.2858700E+03,  0.2948700E+03,  0.3458300E+03,  0.6528600E+03,      &amp;<a name='741'>
          0.2330100E+03,  0.2164100E+03,  0.2572000E+02,  0.1007200E+03,      &amp;<a name='742'>
          0.2230000E+02,  0.2286000E+02,  0.2376000E+02,  0.2071300E+03,      &amp;<a name='743'>
          0.2850000E+02,      &amp;<a name='744'>
          0.2858700E+03,  0.3459000E+03,  0.3619400E+03,  0.6750500E+03,      &amp;<a name='745'>
          0.2620800E+03,  0.2215700E+03,  0.2774000E+02,  0.1007200E+03,      &amp;<a name='746'>
          0.2182000E+02,  0.2301000E+02,  0.2376000E+02,  0.2107900E+03,      &amp;<a name='747'>
          0.2850000E+02,      &amp;<a name='748'>
          0.2858700E+03,  0.3551800E+03,  0.3685400E+03,  0.6602400E+03,      &amp;<a name='749'>
          0.3443100E+03,  0.2500700E+03,  0.3006000E+02,  0.1007200E+03,      &amp;<a name='750'>
          0.2182000E+02,  0.2436000E+02,  0.2376000E+02,  0.2113100E+03,      &amp;<a name='751'>
          0.2850000E+02,      &amp;<a name='752'>
          0.2858700E+03,  0.3418400E+03,  0.3685400E+03,  0.6454900E+03,      &amp;<a name='753'>
          0.2870900E+03,  0.2885700E+03,  0.2886000E+02,  0.1053000E+03,      &amp;<a name='754'>
          0.2189000E+02,  0.2469000E+02,  0.2376000E+02,  0.2104200E+03,      &amp;<a name='755'>
          0.2850000E+02,      &amp;<a name='756'>
          0.2858700E+03,  0.3072200E+03,  0.3528500E+03,  0.6381300E+03,      &amp;<a name='757'>
          0.2495800E+03,  0.2780300E+03,  0.2590000E+02,  0.1079400E+03,      &amp;<a name='758'>
          0.2216000E+02,  0.2404000E+02,  0.2376000E+02,  0.2081500E+03,      &amp;<a name='759'>
          0.2850000E+02,      &amp;<a name='760'>
          0.2858700E+03,  0.2448400E+03,  0.3236500E+03,  0.6231300E+03,      &amp;<a name='761'>
          0.2211200E+03,  0.2668400E+03,  0.2511000E+02,  0.1065900E+03,      &amp;<a name='762'>
          0.2230000E+02,  0.2286000E+02,  0.2376000E+02,  0.2018800E+03,      &amp;<a name='763'>
          0.2850000E+02,      &amp;<a name='764'>
          0.2858700E+03,  0.2187800E+03,  0.2927900E+03,  0.5870500E+03,      &amp;<a name='765'>
          0.2008900E+03,  0.2475700E+03,  0.2480000E+02,  0.1044900E+03,      &amp;<a name='766'>
          0.2244000E+02,  0.2286000E+02,  0.2376000E+02,  0.1964400E+03,      &amp;<a name='767'>
          0.2850000E+02,      &amp;<a name='768'>
          0.2858700E+03,  0.2113200E+03,  0.2927900E+03,  0.5654100E+03,      &amp;<a name='769'>
          0.1892600E+03,  0.2301300E+03,  0.2464000E+02,  0.1036000E+03,      &amp;<a name='770'>
          0.2277000E+02,  0.2286000E+02,  0.2376000E+02,  0.1949000E+03,      &amp;<a name='771'>
          0.2850000E+02/<a name='772'>
      data rbc0/      &amp;<a name='773'>
          0.5430000E+01,  0.6936000E+02,  0.8590000E+01,  0.8800000E+00,      &amp;<a name='774'>
          0.7850000E+01,  0.2661000E+02,  0.2207000E+02,  0.2188000E+02,      &amp;<a name='775'>
          0.1761000E+02,  0.4351000E+02,  0.3592951E+05,  0.5600000E+03,      &amp;<a name='776'>
          0.3546177E+05,      &amp;<a name='777'>
          0.5430000E+01,  0.6936000E+02,  0.8450000E+01,  0.8600000E+00,      &amp;<a name='778'>
          0.7850000E+01,  0.3044000E+02,  0.2053000E+02,  0.2188000E+02,      &amp;<a name='779'>
          0.1942000E+02,  0.4351000E+02,  0.3592951E+05,  0.5600000E+03,      &amp;<a name='780'>
          0.3546177E+05,      &amp;<a name='781'>
          0.5430000E+01,  0.4257000E+02,  0.7980000E+01,  0.8400000E+00,      &amp;<a name='782'>
          0.7850000E+01,  0.3295000E+02,  0.1934000E+02,  0.2673000E+02,      &amp;<a name='783'>
          0.2446000E+02,  0.4351000E+02,  0.3592951E+05,  0.4019700E+03,      &amp;<a name='784'>
          0.3546177E+05,      &amp;<a name='785'>
          0.5430000E+01,  0.1897000E+02,  0.7180000E+01,  0.8300000E+00,      &amp;<a name='786'>
          0.3810000E+01,  0.4003000E+02,  0.1838000E+02,  0.3712000E+02,      &amp;<a name='787'>
          0.6928000E+02,  0.4351000E+02,  0.3592951E+05,  0.1855200E+03,      &amp;<a name='788'>
          0.3546177E+05,      &amp;<a name='789'>
          0.5430000E+01,  0.1035000E+02,  0.6810000E+01,  0.8200000E+00,      &amp;<a name='790'>
          0.2400000E+01,  0.4003000E+02,  0.1516000E+02,  0.3712000E+02,      &amp;<a name='791'>
          0.3303000E+02,  0.4351000E+02,  0.3592951E+05,  0.9801000E+02,      &amp;<a name='792'>
          0.3546177E+05,      &amp;<a name='793'>
          0.5430000E+01,  0.7880000E+01,  0.6480000E+01,  0.8100000E+00,      &amp;<a name='794'>
          0.1860000E+01,  0.3295000E+02,  0.1068000E+02,  0.3712000E+02,      &amp;<a name='795'>
          0.8702000E+02,  0.3568000E+02,  0.3592951E+05,  0.7224000E+02,      &amp;<a name='796'>
          0.3546177E+05,      &amp;<a name='797'>
          0.5430000E+01,  0.7610000E+01,  0.6360000E+01,  0.8200000E+00,      &amp;<a name='798'>
          0.1290000E+01,  0.1870000E+02,  0.8300000E+01,  0.3712000E+02,      &amp;<a name='799'>
          0.8702000E+02,  0.1449000E+02,  0.3592951E+05,  0.6938000E+02,      &amp;<a name='800'>
          0.3546177E+05,      &amp;<a name='801'>
          0.5430000E+01,  0.8090000E+01,  0.6360000E+01,  0.8300000E+00,      &amp;<a name='802'>
          0.1600000E+01,  0.1318000E+02,  0.9330000E+01,  0.1722000E+02,      &amp;<a name='803'>
          0.6928000E+02,  0.1281000E+02,  0.3592951E+05,  0.7434000E+02,      &amp;<a name='804'>
          0.3546177E+05,      &amp;<a name='805'>
          0.5430000E+01,  0.9570000E+01,  0.6660000E+01,  0.8300000E+00,      &amp;<a name='806'>
          0.2040000E+01,  0.1420000E+02,  0.1457000E+02,  0.1317000E+02,      &amp;<a name='807'>
          0.4003000E+02,  0.1669000E+02,  0.3592951E+05,  0.8988000E+02,      &amp;<a name='808'>
          0.3546177E+05,      &amp;<a name='809'>
          0.5430000E+01,  0.1847000E+02,  0.7400000E+01,  0.8400000E+00,      &amp;<a name='810'>
          0.2820000E+01,  0.1559000E+02,  0.1760000E+02,  0.1497000E+02,      &amp;<a name='811'>
          0.3303000E+02,  0.4351000E+02,  0.3592951E+05,  0.1757600E+03,      &amp;<a name='812'>
          0.3546177E+05,      &amp;<a name='813'>
          0.5430000E+01,  0.4257000E+02,  0.8880000E+01,  0.8600000E+00,      &amp;<a name='814'>
          0.4210000E+01,  0.1933000E+02,  0.1934000E+02,  0.1906000E+02,      &amp;<a name='815'>
          0.2810000E+02,  0.4351000E+02,  0.3592951E+05,  0.4019700E+03,      &amp;<a name='816'>
          0.3546177E+05,      &amp;<a name='817'>
          0.5430000E+01,  0.6936000E+02,  0.8880000E+01,  0.8800000E+00,      &amp;<a name='818'>
          0.6400000E+01,  0.2661000E+02,  0.2053000E+02,  0.2188000E+02,      &amp;<a name='819'>
          0.2165000E+02,  0.4351000E+02,  0.3592951E+05,  0.5600000E+03,      &amp;<a name='820'>
          0.3546177E+05/<a name='821'>
      data rootd0/      &amp;<a name='822'>
          0.1000000E+01,  0.1000000E+01,  0.1000000E+01,  0.5000000E+00,      &amp;<a name='823'>
          0.5000000E+00,  0.5000000E+00,  0.5000000E+00,  0.5000000E+00,      &amp;<a name='824'>
          0.5000000E+00,  0.2000000E+00,  0.1000000E+00,  0.1000000E+01,      &amp;<a name='825'>
          0.1000000E+01,      &amp;<a name='826'>
          0.1000000E+01,  0.1000000E+01,  0.1000000E+01,  0.5000000E+00,      &amp;<a name='827'>
          0.5000000E+00,  0.5000000E+00,  0.5000000E+00,  0.5000000E+00,      &amp;<a name='828'>
          0.5000000E+00,  0.2000000E+00,  0.1000000E+00,  0.1000000E+01,      &amp;<a name='829'>
          0.1000000E+01/<a name='830'>
      data soref0/      &amp;<a name='831'>
          0.1100000E+00,  0.1100000E+00,  0.1100000E+00,  0.1100000E+00,      &amp;<a name='832'>
          0.1100000E+00,  0.1100000E+00,  0.1000000E+00,  0.1000000E+00,      &amp;<a name='833'>
          0.3000000E+00,  0.1000000E+00,  0.3000000E+00,  0.1000000E+00,      &amp;<a name='834'>
          0.1000000E+00,      &amp;<a name='835'>
          0.2250000E+00,  0.2250000E+00,  0.2250000E+00,  0.2250000E+00,      &amp;<a name='836'>
          0.2250000E+00,  0.2250000E+00,  0.2000000E+00,  0.2000000E+00,      &amp;<a name='837'>
          0.3500000E+00,  0.2000000E+00,  0.3500000E+00,  0.1500000E+00,      &amp;<a name='838'>
          0.1500000E+00,      &amp;<a name='839'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='840'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='841'>
          0.0000000E+00,  0.0000000E+00,  0.0000000E+00,  0.0000000E+00,      &amp;<a name='842'>
          0.0000000E+00/<a name='843'>
      data bee0/      &amp;<a name='844'>
          0.7120000E+01,  0.7120000E+01,  0.7120000E+01,  0.7120000E+01,      &amp;<a name='845'>
          0.7120000E+01,  0.7120000E+01,  0.7120000E+01,  0.4050000E+01,      &amp;<a name='846'>
          0.4050000E+01,  0.7120000E+01,  0.4050000E+01,  0.7797000E+01,      &amp;<a name='847'>
          0.4804000E+01/<a name='848'>
      data phsat0/      &amp;<a name='849'>
         -0.8600000E-01, -0.8600000E-01, -0.8600000E-01, -0.8600000E-01,      &amp;<a name='850'>
         -0.8600000E-01, -0.8600000E-01, -0.8600000E-01, -0.3500000E-01,      &amp;<a name='851'>
         -0.3500000E-01, -0.8600000E-01, -0.3500000E-01, -0.1980000E+00,      &amp;<a name='852'>
         -0.1670000E+00/<a name='853'>
      data poros0/      &amp;<a name='854'>
          0.4200000E+00,  0.4200000E+00,  0.4200000E+00,  0.4200000E+00,      &amp;<a name='855'>
          0.4200000E+00,  0.4200000E+00,  0.4200000E+00,  0.4352000E+00,      &amp;<a name='856'>
          0.4352000E+00,  0.4200000E+00,  0.4352000E+00,  0.4577000E+00,      &amp;<a name='857'>
          0.4352000E+00/<a name='858'>
      data satco0/      &amp;<a name='859'>
          0.2000000E-04,  0.2000000E-04,  0.2000000E-04,  0.2000000E-04,      &amp;<a name='860'>
          0.2000000E-04,  0.2000000E-04,  0.2000000E-04,  0.1760000E-03,      &amp;<a name='861'>
          0.1760000E-03,  0.2000000E-04,  0.1760000E-03,  0.3500000E-05,      &amp;<a name='862'>
          0.7620000E-04/<a name='863'>
      data slope0/      &amp;<a name='864'>
          0.1736000E+00,  0.1736000E+00,  0.1736000E+00,  0.1736000E+00,      &amp;<a name='865'>
          0.1736000E+00,  0.1736000E+00,  0.1736000E+00,  0.8720000E-01,      &amp;<a name='866'>
          0.8720000E-01,  0.1736000E+00,  0.8720000E-01,  0.3420000E+00,      &amp;<a name='867'>
          0.8720000E-01/<a name='868'>
      data depth0/      &amp;<a name='869'>
          0.2000000E-01,  0.2000000E-01,  0.2000000E-01,  0.2000000E-01,      &amp;<a name='870'>
          0.2000000E-01,  0.2000000E-01,  0.2000000E-01,  0.2000000E-01,      &amp;<a name='871'>
          0.2000000E-01,  0.2000000E-01,  0.2000000E-01,  0.2000000E-01,      &amp;<a name='872'>
          0.1000000E+01,      &amp;<a name='873'>
          0.1480000E+01,  0.1480000E+01,  0.1480000E+01,  0.1480000E+01,      &amp;<a name='874'>
          0.1480000E+01,  0.1480000E+01,  0.4700000E+00,  0.4700000E+00,      &amp;<a name='875'>
          0.4700000E+00,  0.1700000E+00,  0.1700000E+00,  0.1480000E+01,      &amp;<a name='876'>
          0.1000000E+01,      &amp;<a name='877'>
          0.2000000E+01,  0.2000000E+01,  0.2000000E+01,  0.2000000E+01,      &amp;<a name='878'>
          0.2000000E+01,  0.2000000E+01,  0.1000000E+01,  0.1000000E+01,      &amp;<a name='879'>
          0.1000000E+01,  0.1000000E+01,  0.3000000E+00,  0.2000000E+01,      &amp;<a name='880'>
          0.1000000E+01/<a name='881'>
<font color=#447700>!------------------------------------------------------------------------<a name='882'></font>
CONTAINS<a name='883'>
<font color=#447700>!<a name='884'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='885'></font>
<font color=#447700>!**********************************************<a name='886'></font>
<A NAME='SSIB'><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='887'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SSIB</font>( IX, JX, DDTT, ITIME, ZLAT, SUNANGLE,      &amp; <A href='../../call_to/SSIB.html' TARGET='index'>1</A>,<A href='../../call_from/SSIB.html' TARGET='index'>22</A><a name='888'>
                          PPL, PPC, RLWDOWN, ZWIND2,             &amp;<a name='889'>
                          WWW1, WWW2, WWW3,                      &amp;<a name='890'>
                          TC, TGS, TD,                           &amp;<a name='891'>
                          SNOA, ROFF,                            &amp;<a name='892'>
                          UMM, VMM, QM, TM,                      &amp;<a name='893'>
                          PM, PSUR, ivgtyp,                      &amp;<a name='894'>
                          SWDOWN1, SNOB,                         &amp;<a name='895'>
                          SALB11, SALB12, SALB21, SALB22,        &amp;<a name='896'>
                     RADFRAC11, RADFRAC12, RADFRAC21, RADFRAC22, &amp; <a name='897'>
                          XHSFLX, ELATEN, GHTFLX, XHLFLX, TGEFF, &amp;<a name='898'>
                          USTAR, RIB, FM, FH, CM,                &amp;<a name='899'>
                          XLHF, XSHF, XGHF, XEGS, XECI, XECT,    &amp; <font color=#447700>! output<a name='900'></font>
                          XEGI, XEGT, XSDN, XSUP, XLDN, XLUP,    &amp; <font color=#447700>! output<a name='901'></font>
                          XWAT, XHCX, XHGX, XZLT, XVCF, XXZ0,    &amp; <font color=#447700>! output<a name='902'></font>
                          XVEG, XDD,                             &amp; <font color=#447700>! output<a name='903'></font>
   ISNOW,SWE,SNOWDEN,SNOWDEPTH,TKAIR,                            &amp; <font color=#447700>! snow<a name='904'></font>
   DZO1,WO1,TSSN1,TSSNO1,BWO1,BTO1,CTO1,FIO1,FLO1,BIO1,BLO1,HO1, &amp; <font color=#447700>! snow<a name='905'></font>
   DZO2,WO2,TSSN2,TSSNO2,BWO2,BTO2,CTO2,FIO2,FLO2,BIO2,BLO2,HO2, &amp; <font color=#447700>! snow<a name='906'></font>
   DZO3,WO3,TSSN3,TSSNO3,BWO3,BTO3,CTO3,FIO3,FLO3,BIO3,BLO3,HO3, &amp; <font color=#447700>! snow<a name='907'></font>
   DZO4,WO4,TSSN4,TSSNO4,BWO4,BTO4,CTO4,FIO4,FLO4,BIO4,BLO4,HO4, &amp; <font color=#447700>! snow<a name='908'></font>
                          DAY, CLOUD, Q2M, TA, BEDO, UV10,       &amp; <font color=#447700>! add uv10 (01/2014)<a name='909'></font>
                          sw_physics, MMINLU                     &amp;<a name='910'>
                                                   )<a name='911'>
<font color=#447700>!**********************************************<a name='912'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='913'></font>
<font color=#447700>!   THERE ARE A MAIN SSIB PROGRAM AND 12 SUBROUTINE FILES, WHICH ARE:        <a name='914'></font>
<font color=#447700>!              VEGOUT<a name='915'></font>
<font color=#447700>!              CROPS<a name='916'></font>
<font color=#447700>!              RADAB<a name='917'></font>
<font color=#447700>!              ROOT1<a name='918'></font>
<font color=#447700>!              STOMA1<a name='919'></font>
<font color=#447700>!              INTERC<a name='920'></font>
<font color=#447700>!              TEMRS1<a name='921'></font>
<font color=#447700>!              UPDAT1<a name='922'></font>
<font color=#447700>!              RASIT5<a name='923'></font>
<font color=#447700>!              STRES1<a name='924'></font>
<font color=#447700>!              NEWTON<a name='925'></font>
<font color=#447700>!                                      YONGKANG XUE                     <a name='926'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='927'></font>
<font color=#447700>!                              INPUT  <a name='928'></font>
<font color=#447700>!     DDTT:      TIME INTERVAL<a name='929'></font>
<font color=#447700>!     SUNANGLE: SOLAR ZENITH ANGLE<a name='930'></font>
<font color=#447700>!     SWDOWN:   SHORT WAVE DOWN(W/M*M);<a name='931'></font>
<font color=#447700>!     RADFRAC:  SHORT WAVE COMPONENTS (visible and near IR; direct and diffuse)<a name='932'></font>
<font color=#447700>!     RLWDOWN:   LONG WAVE DOWN(W/M*M); <a name='933'></font>
<font color=#447700>!     PPL, PPC: LARGE SCALE AND CONVECTIVE PRECIPITATIONS AT THE TIME STEP (mm)<a name='934'></font>
<font color=#447700>!     TM:       TEMPERETURE AT LOWEST MODEL LAYER (K)<a name='935'></font>
<font color=#447700>!     UMM,VMM:  ZONAL AND MERIDIONAL WINDS AT LOWEST MODEL LAYER (m/S)<a name='936'></font>
<font color=#447700>!     QM:       WATER VAPOR AT LOWEST MODEL LAYER;<a name='937'></font>
<font color=#447700>!     PSURF:    SURFACE PRESSURE (mb)<a name='938'></font>
<font color=#447700>!     ZWIND:    HEIGHT (m) OF LOWEST MODEL LAYER<a name='939'></font>
<font color=#447700>!     ITYPE:    VEGETATION TYPE<a name='940'></font>
<font color=#447700>!     ZLAT:     LATITUDE, SOUTH POLE IS -90 DEGREE AND NORTH POLE IS 90 DEGREE<a name='941'></font>
<font color=#447700>!     MONTH:    MONTH<a name='942'></font>
<font color=#447700>!     DAY:      CALENDER DATE<a name='943'></font>
<font color=#447700>!     IYEAR:    YEAR<a name='944'></font>
<font color=#447700>!                             OUTPUT<a name='945'></font>
<font color=#447700>!     ETMASS:   EVAPORATION (mm/step)<a name='946'></font>
<font color=#447700>!     ELATEN:   LATENT HEAT FLUX (w/m*m) <a name='947'></font>
<font color=#447700>!     EVAPSOIL,EVAPWC,EVAPDC,EVAPSN: LATENT HEAT FROM (SOIL, INTERCEPTION,<a name='948'></font>
<font color=#447700>!               TRANSPIRATION, AND SNOW SURFACE)                  <a name='949'></font>
<font color=#447700>!     HFLUX:    SENSIBLE HEAT FLUX(w/m*m)<a name='950'></font>
<font color=#447700>!     GHTFLX:   GROUND HEAT FLUX(w/m*m) = CHF+SHF<a name='951'></font>
<font color=#447700>!     USTAR:    FRICTION VELOCITY (m/s)<a name='952'></font>
<font color=#447700>!     DRAG:     MOMENTUM FLUX (kg/m/s**2)<a name='953'></font>
<font color=#447700>!     DRAGU:    U COMPONENT OF MOMENTUM FLUX (kg/m/s**2)<a name='954'></font>
<font color=#447700>!     DRAGV:    V COMPONENT OF MOMENTUM FLUX (kg/m/s**2)<a name='955'></font>
<font color=#447700>!     TGEFF:    RADIATIVE TEMPERATURE (K)<a name='956'></font>
<font color=#447700>!     BEDO:     TOTAL ALBEDO<a name='957'></font>
<font color=#447700>!     SALB:     ALBEDO FOR 4 COMPONENTS<a name='958'></font>
<font color=#447700>!     RADT:     NET RADIATION AT CANOPY AND GROUND LEVELS<a name='959'></font>
<font color=#447700>!     TGS:      SOIL SURFACE TEMPERATURE (K)<a name='960'></font>
<font color=#447700>!     TC:       CANOPY TEMPERATURE (K)<a name='961'></font>
<font color=#447700>!     TD:       DEEP SOIL TEMPERATURE (K)<a name='962'></font>
<font color=#447700>!     TA:       TEMPERATURE AT CANOPY AIR SPACE (K)<a name='963'></font>
<font color=#447700>!     CAPAC:    INTERCEPTION AT CANOPY (1) and SNOW DEPTH (2)<a name='964'></font>
<font color=#447700>!     WWW:      SOIL MOISTURE<a name='965'></font>
<font color=#447700>!     SOILM:    TOTAL SOIL WATER CONTENT<a name='966'></font>
<font color=#447700>!     ROFF:     RUN OFF<a name='967'></font>
<font color=#447700>!     <a name='968'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='969'></font>
<a name='970'>
 INTEGER, DIMENSION (12) :: IDAYS<a name='971'>
<a name='972'>
 REAL, DIMENSION (2)     :: CAPAC, SATCAP, GREEN, VCOVER, ZLT, CHIL, TOPT, TL, &amp;<a name='973'>
                            TU, DEFAC, PH1, PH2, RST, ROOTD, RADT, PAR, PD<a name='974'>
 REAL, DIMENSION (3)     :: WWW, SOREF, ZDEPTH, ROOTP, PHSOIL, YMATT, YMATQ<a name='975'>
 REAL, DIMENSION (2,2)   :: RADFRAC, SALB<a name='976'>
 REAL, DIMENSION (2,3)   :: RSTPAR<a name='977'>
 REAL, DIMENSION (2,4)   :: RSTFAC<a name='978'>
 REAL, DIMENSION (3,2)   :: RADN<a name='979'>
 REAL, DIMENSION (2,3,2) :: TRAN, REF, ALBEDO, EXTK<a name='980'>
 REAL, DIMENSION (2,2,2) :: RADFAC<a name='981'>
<a name='982'>
 INTEGER, DIMENSION (24) :: IVUSGS<a name='983'>
 INTEGER, DIMENSION (20) :: IVMODIS<a name='984'>
 REAL, DIMENSION (13)    :: TD_DEPTH<a name='985'>
 INTEGER :: sw_physics  <font color=#447700>!choice of SW radiation scheme<a name='986'></font>
 CHARACTER(LEN=*), INTENT(IN ) :: MMINLU  <font color=#447700>!type of landuse/vegetation map<a name='987'></font>
 CHARACTER*256 :: message<a name='988'>
<font color=#447700>!snow<a name='989'></font>
 REAL, DIMENSION (N2)     :: SS,SSO,POROSITY,H,HO,BI,BIO,DZ,DZO,BW,BWO,BL<a name='990'>
 REAL, DIMENSION (N2)     :: BLO,TSSN,TSSNO,W,WO,WF,FI,FIO, FL,FLO,DMLT<a name='991'>
 REAL, DIMENSION (N2)     :: DMLTO,BT,BTO,S,SO,CT,CTO,DLIQVOL,DICEVOL<a name='992'>
 REAL, DIMENSION (N2)     :: QK,PDZDTC,DMASS,DSOL,DHP,THK<a name='993'>
<font color=#447700>!snow<a name='994'></font>
<font color=#447700>! Julian day<a name='995'></font>
      DATA IDAYS/31,59,90,120,151,181,212,243,273,304,334,366/<a name='996'>
<font color=#447700>!<a name='997'></font>
<font color=#447700>! Deep soil temperature depth by vegetation type --------------------<a name='998'></font>
      DATA TD_DEPTH/1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.0, 1.0, 1.0     &amp;<a name='999'>
     &amp;                                     , 0.5, 0.5, 1.5, 1.5/<a name='1000'>
<font color=#447700>!<a name='1001'></font>
<font color=#447700>! Check vegetation/land use map choice<a name='1002'></font>
<font color=#447700>! USGS-SSIB vegetation type conversion<a name='1003'></font>
     DATA IVUSGS / 7, 12, 12, 12, 12, 12,  7,  9,            &amp;<a name='1004'>
                   8,  6,  2,  5,  1,  4,  3,  0,            &amp;<a name='1005'>
                  10,  3, 11, 10, 10, 10, 10, 13/<a name='1006'>
<font color=#447700>! MODIS-SSIB vegetation type conversion  (fds Jan/2015)<a name='1007'></font>
     DATA IVMODIS / 4,  1,  5,  2,  3,  8,  9,  6,           &amp;<a name='1008'>
                    6,  7,  7, 12, 11, 12, 13, 11,           &amp;<a name='1009'>
                    0, 10, 10, 10/<a name='1010'>
<font color=#447700>! Converts vegetation/land use types  <a name='1011'></font>
  IF(MMINLU.EQ.'SSIB') THEN<a name='1012'>
      ITYPE=IVGTYP<a name='1013'>
  ELSEIF(MMINLU.EQ.'USGS') THEN<a name='1014'>
      ITYPE=IVUSGS(IVGTYP)<a name='1015'>
  ELSEIF(MMINLU.EQ.'MODIS') THEN<a name='1016'>
      ITYPE=IVMODIS(IVGTYP)<a name='1017'>
  ELSE IF (MMINLU .EQ. 'MODIFIED_IGBP_MODIS_NOAH') THEN<a name='1018'>
      ITYPE=IVMODIS(IVGTYP)<a name='1019'>
  ELSE<a name='1020'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1208"> ( 'SSIB LSM only works with SSIB or USGS vegetation (landuse) map' )<a name='1021'>
  ENDIF<a name='1022'>
<a name='1023'>
<font color=#447700>! Check for error in vegetation map<a name='1024'></font>
 if(itype.le.0.or.itype.gt.13) then<a name='1025'>
   <font color=#447700>!Make sure the correct vegetation map is being used!<a name='1026'></font>
   print *,"veg type: ",itype<a name='1027'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1209"> ( 'module_sf_ssib: ERROR in vegetation/landuse map' )<a name='1028'>
 endif<a name='1029'>
<font color=#447700>!<a name='1030'></font>
      INTG=1<a name='1031'>
      XADJ=0.<a name='1032'>
      CTLPA=1.<a name='1033'>
      NROOT=1<a name='1034'>
      WFSOIL=0.<a name='1035'>
<font color=#447700>!------------------------------------------------<a name='1036'></font>
      ZWIND=ZWIND2*0.5  <font color=#447700>! TM &amp; UM are on the middle lowest model layer<a name='1037'></font>
<font color=#447700>!------------------------------------------------<a name='1038'></font>
<font color=#447700>!     set DAY in year and current month MON_COR<a name='1039'></font>
<font color=#447700>!------------------------------------------------<a name='1040'></font>
      IMONTH=1<a name='1041'>
      IDAY=INT(DAY)<a name='1042'>
      DO I=1,12<a name='1043'>
        IF(IDAY.LE.IDAYS(I)) THEN<a name='1044'>
          IMONTH=I<a name='1045'>
          EXIT<a name='1046'>
        ENDIF<a name='1047'>
      ENDDO<a name='1048'>
<font color=#447700>!crr correction for southern hemisphere (reverse months) Ratko, Oct 28, 2005<a name='1049'></font>
           IF(ZLAT.LT.0.0) THEN<a name='1050'>
             MON_COR=IMONTH+6<a name='1051'>
             IF(MON_COR.GT.12) MON_COR=MON_COR-12<a name='1052'>
           ELSE<a name='1053'>
             MON_COR=IMONTH<a name='1054'>
           ENDIF<a name='1055'>
<font color=#447700>!------------------------------------------------<a name='1056'></font>
      IF (ITIME.EQ.1) TA=TC<a name='1057'>
<font color=#447700>!<a name='1058'></font>
      PSURF=PSUR*0.01<a name='1059'>
      DTT =DDTT*FLOAT(INTG)<a name='1060'>
<font color=#447700>!------------------------------------------------<a name='1061'></font>
<font color=#447700>! **  Read in vegetation parameters<a name='1062'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#VEGOUT'>VEGOUT</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VEGOUT_1">(TRAN,REF,GREEN,VCOVER,CHIL,                    &amp;<a name='1063'>
           RSTPAR,TOPT,TL,TU,DEFAC,PH1,PH2,                      &amp;<a name='1064'>
           ZLT,Z0,XDD,Z2,Z1,RDC,RBC,ROOTD,SOREF,                 &amp;<a name='1065'>
           BEE, PHSAT, POROS, SATCO,SLOPE,                       &amp;<a name='1066'>
           ZDEPTH,MON_COR,ITYPE)<a name='1067'>
<font color=#447700>!<a name='1068'></font>
<a name='1069'>
      IF (ITYPE.EQ.12) CALL <A href='../../html_code/phys/module_sf_ssib.F.html#CROPS'>CROPS</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CROPS_1">(ZLAT,DAY,CHIL,                 &amp;<a name='1070'>
                ZLT,GREEN,VCOVER,RSTPAR,TOPT,TL,TU,DEFAC,PH2,PH1)<a name='1071'>
<font color=#447700>!<a name='1072'></font>
<font color=#447700>!crr ------------ STC initialization ------------------------------------<a name='1073'></font>
      IF (ITIME.EQ.1) THEN<a name='1074'>
          STLEV1=0.05    <font color=#447700>! half of 10cm layer<a name='1075'></font>
          STLEV2=1.05    <font color=#447700>! half of second + first layer<a name='1076'></font>
    <a name='1077'>
          DEPTH = TD_DEPTH(ITYPE)<a name='1078'>
    <a name='1079'>
            IF     (DEPTH.GT.STLEV1.AND.DEPTH.LE.STLEV2)THEN <font color=#447700>! interp.<a name='1080'></font>
            TD = ( (STLEV2-DEPTH)*TGS + (DEPTH-STLEV1)*TD )             &amp;<a name='1081'>
     &amp;                        /(STLEV2-STLEV1)<a name='1082'>
            ELSE IF(DEPTH.GT.STLEV2)THEN                     <font color=#447700>! extrap.<a name='1083'></font>
            TD = ( (DEPTH-STLEV1)*TD  - (DEPTH-STLEV2)*TGS)             &amp;<a name='1084'>
     &amp;                        /(STLEV2-STLEV1)<a name='1085'>
            ENDIF<a name='1086'>
<a name='1087'>
      ENDIF<a name='1088'>
<font color=#447700>!------------------------------------------------------------------------<a name='1089'></font>
        WWW(1)   = WWW1 / POROS<a name='1090'>
        WWW(2)   = WWW2 / POROS<a name='1091'>
        WWW(3)   = WWW3 / POROS<a name='1092'>
<font color=#447700>!------------------------------------------------<a name='1093'></font>
<font color=#447700>!cfds Convert WEASD (kg/m2) to meter<a name='1094'></font>
      SNOA = SNOA/1000.<a name='1095'>
      SNOB = SNOB/1000.<a name='1096'>
<font color=#447700>!------------------------------------------------<a name='1097'></font>
<font color=#447700>!<a name='1098'></font>
         CALL <A href='../../html_code/phys/module_sf_ssib.F.html#CONVDIM'>CONVDIM</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONVDIM_1">(0,                                         &amp;<a name='1099'>
   DZO1,WO1,TSSN1,TSSNO1,BWO1,BTO1,CTO1,FIO1,FLO1,BIO1,BLO1,HO1, &amp;<a name='1100'>
   DZO2,WO2,TSSN2,TSSNO2,BWO2,BTO2,CTO2,FIO2,FLO2,BIO2,BLO2,HO2, &amp;<a name='1101'>
   DZO3,WO3,TSSN3,TSSNO3,BWO3,BTO3,CTO3,FIO3,FLO3,BIO3,BLO3,HO3, &amp;<a name='1102'>
   DZO4,WO4,TSSN4,TSSNO4,BWO4,BTO4,CTO4,FIO4,FLO4,BIO4,BLO4,HO4, &amp;<a name='1103'>
   DZO, WO, TSSN, TSSNO, BWO, BTO, CTO, FIO, FLO, BIO, BLO, HO )<a name='1104'>
<font color=#447700>!<a name='1105'></font>
<a name='1106'>
      IF (ITIME.EQ.1) THEN<a name='1107'>
         ISNOW = 1<a name='1108'>
         SNOWDEN = 3.75<a name='1109'>
         SWE = SNOA<a name='1110'>
         SNOWDEPTH = SWE * SNOWDEN<a name='1111'>
         TGG=AMIN1(273.15,TGS)<a name='1112'>
<font color=#447700>!fds temp    IF (SNOWDEPTH.gt.SNODEP_CR) THEN<a name='1113'></font>
<font color=#447700>!fds temp    ISNOW = 0<a name='1114'></font>
<font color=#447700>!fds temp    CALL LAYERN (TGG,SWE,SNOWDEPTH,  DZO,BWO,WO,BTO,CTO     &amp;<a name='1115'></font>
<font color=#447700>!fds temp       ,FLO,FIO,HO,BLO,BIO,DLIQVOL,DICEVOL,TSSNO,DMLTO)<a name='1116'></font>
<font color=#447700>!fds temp    ENDIF<a name='1117'></font>
<a name='1118'>
      ENDIF<a name='1119'>
<font color=#447700>!<a name='1120'></font>
         CAPAC(1)=SNOB<a name='1121'>
         CAPAC(2)=SNOA<a name='1122'>
      IF (ITIME.EQ.1) THEN<a name='1123'>
         IF (SNOA.GT.0.) THEN<a name='1124'>
<font color=#447700>!cxx     IF (SNOA.GT.5.) THEN<a name='1125'></font>
           CAPAC(1) = ZLT(1)  * 0.0001<a name='1126'>
           TC  = AMIN1(TC ,TF-0.01)<a name='1127'>
           TGS = AMIN1(TGS,TF-0.01)<a name='1128'>
         ENDIF<a name='1129'>
      ENDIF<a name='1130'>
<font color=#447700>!<a name='1131'></font>
      UM=SQRT(UMM**2+VMM**2)<a name='1132'>
      RHOAIR=100./GASR*(PSURF+0.01*PM)/(TM+TA)<a name='1133'>
      AKAPPA = GASR/CPAIR<a name='1134'>
      BPS    =1.0 / EXP ( AKAPPA * ALOG (0.01*PM/PSURF) )<a name='1135'>
<font color=#447700>!      BPS0   =1.0 / EXP ( AKAPPA * ALOG (PSURF/1000.) )<a name='1136'></font>
<font color=#447700>!      BPS1   =1.0 / EXP ( AKAPPA * ALOG (0.01*PM/1000.) )<a name='1137'></font>
<font color=#447700>!Cl    2001,2,2 added the following line<a name='1138'></font>
      IF  (ISNOW.EQ.0) THEN<a name='1139'>
         TSOIL=TGS<a name='1140'>
         TGS=TSSNO(N)<a name='1141'>
         CAPAC(2)=SWE<a name='1142'>
         IPTYPE=2<a name='1143'>
           IF(TM.ge.TF) IPTYPE=1<a name='1144'>
      END IF<a name='1145'>
<font color=#447700>!C<a name='1146'></font>
<font color=#447700>!                                                                       <a name='1147'></font>
<font color=#447700>!     CONVERT TO VAPOR PRES. TO MB<a name='1148'></font>
      EM=(PSURF*QM)/0.6220<a name='1149'>
      IF (ITIME.EQ.1) EA=EM<a name='1150'>
<font color=#447700>! <a name='1151'></font>
      SUNANG=AMAX1(SUNANGLE,0.01746)<a name='1152'>
<font color=#447700>! By Zhenxin 2011-06-20<a name='1153'></font>
<font color=#447700>!      IF (sw_physics.eq.3) THEN<a name='1154'></font>
       IF (sw_physics.eq.3 .or. sw_physics.eq.4) THEN<a name='1155'>
<font color=#447700>! End By Zhenxin 2011-06-20<a name='1156'></font>
<font color=#447700>!**********************************************<a name='1157'></font>
<font color=#447700>!fds - RADFRAC from radiation scheme 3 (06/2010)<a name='1158'></font>
<font color=#447700>!fds - Otherwise use cloud cover to calculate radfrac<a name='1159'></font>
        radfrac11 = amax1(radfrac11,0.025)<a name='1160'>
        radfrac12 = amax1(radfrac12,0.025)<a name='1161'>
        radfrac21 = amax1(radfrac21,0.025)<a name='1162'>
        radfrac22 = amax1(radfrac22,0.025)<a name='1163'>
        swdown = radfrac11 + radfrac12 + radfrac21 + radfrac22<a name='1164'>
        RADFRAC(1,1) = radfrac11/swdown<a name='1165'>
        RADFRAC(1,2) = radfrac12/swdown<a name='1166'>
        RADFRAC(2,1) = radfrac21/swdown<a name='1167'>
        RADFRAC(2,2) = radfrac22/swdown<a name='1168'>
      ELSE<a name='1169'>
<font color=#447700>!**********************************************<a name='1170'></font>
<font color=#447700>! ** CALCULATE THE CLOUD COVER USING AN EMPIRICAL EQUATION<a name='1171'></font>
<font color=#447700>!    ONLY USE THIS PART WHEN IT IS NEEDED<a name='1172'></font>
<font color=#447700>!<a name='1173'></font>
       swdown = amax1(swdown1,0.1)<a name='1174'>
       CLOUD = AMAX1(CLOUD,0.0)<a name='1175'>
       CLOUD = AMIN1(CLOUD,1.0)<a name='1176'>
       CLOUD = AMAX1(0.58,CLOUD)<a name='1177'>
<font color=#447700>!<a name='1178'></font>
       DIFRAT = 0.0604 / ( SUNANG-0.0223 ) + 0.0683<a name='1179'>
       IF ( DIFRAT .LT. 0.0 ) DIFRAT = 0.0<a name='1180'>
       IF ( DIFRAT .GT. 1.0 ) DIFRAT = 1.0<a name='1181'>
<font color=#447700>!<a name='1182'></font>
       DIFRAT = DIFRAT + ( 1.0 - DIFRAT ) * CLOUD<a name='1183'>
       VNRAT = ( 580.0 - CLOUD*464.0 ) / ( ( 580.0-CLOUD*499.0) &amp;<a name='1184'>
      &amp;        + ( 580.0 - CLOUD*464.0 ) )<a name='1185'>
<font color=#447700>!<a name='1186'></font>
       RADFRAC(1,1) = (1.0-DIFRAT)*VNRAT<a name='1187'>
       RADFRAC(1,2) = DIFRAT*VNRAT<a name='1188'>
       RADFRAC(2,1) = (1.0-DIFRAT)*(1.0-VNRAT)<a name='1189'>
       RADFRAC(2,2) = DIFRAT*(1.0-VNRAT)<a name='1190'>
<font color=#447700>!**********************************************<a name='1191'></font>
     ENDIF<a name='1192'>
<font color=#447700>!<a name='1193'></font>
      RADN(1,1) = RADFRAC(1,1) * SWDOWN<a name='1194'>
      RADN(1,2) = RADFRAC(1,2) * SWDOWN<a name='1195'>
      RADN(2,1) = RADFRAC(2,1) * SWDOWN<a name='1196'>
      RADN(2,2) = RADFRAC(2,2) * SWDOWN<a name='1197'>
      RADN(3,1) = 0.<a name='1198'>
      RADN(3,2) = RLWDOWN<a name='1199'>
<font color=#447700>!                                                                       <a name='1200'></font>
<font color=#447700>!     END OF EMPIRICAL EQUATIONS<a name='1201'></font>
<font color=#447700>!     *********************************************************<a name='1202'></font>
<font color=#447700>!<a name='1203'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RADAB'>RADAB</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADAB_1"> (TRAN,REF,GREEN,VCOVER,CHIL,ZLT,Z2,Z1,SOREF,TC,          &amp;<a name='1204'>
                 TGS,SATCAP,EXTK,RADFAC,THERMK,RADT,PAR,PD,ALBEDO,SALB,   &amp;<a name='1205'>
                 TGEFF,SUNANG,XADJ,CAPAC,RADN,ZLWUP,RADFRAC,              &amp;<a name='1206'>
                 ISNOW,SNOWDEN,SNOWDEPTH,SWDOWN,BEDO,SNOCV,0,             &amp;         <a name='1207'>
                 fsdown,fldown,fsup,flup)<a name='1208'>
<font color=#447700>!<a name='1209'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#ROOT1'>ROOT1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ROOT1_1">(PHSAT,BEE,WWW,PHSOIL)<a name='1210'>
<font color=#447700>!<a name='1211'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#STOMA1'>STOMA1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STOMA1_1">(GREEN,VCOVER,CHIL,ZLT,PAR,PD,EXTK,SUNANG,RST,           &amp;<a name='1212'>
                 RSTPAR, CTLPA)<a name='1213'>
<font color=#447700>!     <a name='1214'></font>
      RSTUN = RST(1)<a name='1215'>
<a name='1216'>
<font color=#447700>!***************************************************************************************<a name='1217'></font>
<font color=#447700>! For water balance check later<a name='1218'></font>
      TOTWB = WWW(1) * POROS * ZDEPTH(1)                                  &amp;<a name='1219'>
            + WWW(2) * POROS * ZDEPTH(2)                                  &amp;<a name='1220'>
            + WWW(3) * POROS * ZDEPTH(3)                                  &amp;<a name='1221'>
            + CAPAC(1) + CAPAC(2)<a name='1222'>
<font color=#447700>!***************************************************************************************<a name='1223'></font>
<font color=#447700>!<a name='1224'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#INTERCS'>INTERCS</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERCS_1"> (DTT,VCOVER,ZLT,TM,TC,TGS,CAPAC,WWW,PPC,PPL,           &amp;<a name='1225'>
                    ROFF,ZDEPTH,POROS,CCX,CG,SATCO,SATCAP,SPWET,          &amp;<a name='1226'>
                 EXTK,ISNOW,P0,CSOIL,dzsoil,CHISL,SMELT)<a name='1227'>
<font color=#447700>!<a name='1228'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#SET0'>SET0</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET0_1">(TSSNO,BWO,BLO,BIO,HO,FLO,FIO,WO,DZO,                      &amp;<a name='1229'>
                      SSO,CTO,BTO,DMLTO,WF,DHP)<a name='1230'>
<font color=#447700>!                                                                       <a name='1231'></font>
<font color=#447700>!***************************************************************************************<a name='1232'></font>
       IF (ISNOW.EQ.0) THEN              <font color=#447700>! MULTI-LAYER SNOW<a name='1233'></font>
<font color=#447700>!***************************************************************************************<a name='1234'></font>
         PRCP=P0<a name='1235'>
         TKAIR=TM<a name='1236'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#GETMET'>GETMET</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETMET_1">(IPTYPE,PRCP,TKAIR,                                       &amp;<a name='1237'>
                  PRCPS,PRCPW,FIFALL,FLFALL,BIFALL,BLFALL)<a name='1238'>
<font color=#447700>!c ** aerodynamic resistance and flux calculations<a name='1239'></font>
        SOLAR=0.<a name='1240'>
        DO 1100 IVEG  = 2, 2<a name='1241'>
        DO 1100 IWAVE = 1, 2<a name='1242'>
        DO 1100 IRAD  = 1, 2<a name='1243'>
          SOLAR=SOLAR+RADFAC(IVEG,IWAVE,IRAD)*RADN(IWAVE,IRAD)<a name='1244'>
 1100    CONTINUE<a name='1245'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#SNOW_1ST'>SNOW_1ST</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SNOW_1ST_1"> (DTT,TM,SOLAR,PRCPW,PRCPS,BIO,BLO,DICEVOL,             &amp;<a name='1246'>
                 DLIQVOL,TSSNO,PDZDTC,POROSITY,SO,SSO,WF,DHP,DZO,WO,       &amp;<a name='1247'>
                 BWO,BTO,CTO,DMASS,DSOL,SNROFF,HROFF,SNOWDEPTH,SOLSOIL,    &amp;<a name='1248'>
                 FLO,FIO,DMLTO,HO,BIFALL,BLFALL,FLFALL)<a name='1249'>
<font color=#447700>!<a name='1250'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2'>TEMRS2</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEMRS2_1">(DTT,TC,TGS,TD,TA,TM,QM,EM,PSUR,WWW,CAPAC,SATCAP,         &amp;<a name='1251'>
         DTC,DTG,RA,RST,ZDEPTH,BEE,PHSAT,POROS,XDD,Z0,RDC,RBC,VCOVER,      &amp;<a name='1252'>
         Z2,ZLT,DEFAC,TU,TL,TOPT,RSTFAC,NROOT,ROOTD,PHSOIL,ROOTP,          &amp;<a name='1253'>
         PH1,PH2,ECT,ECI,EGT,EGI,EGS,HC,HG,EC,EG,EA,RADT,CHF,SHF,          &amp;<a name='1254'>
         ALBEDO,ZLWUP,THERMK,RHOAIR,ZWIND,UM,USTAR,DRAG,CCX,CG,            &amp;<a name='1255'>
            ISNOW,CHISL,TSOIL,SOLSOIL,CSOIL,WFSOIL,POROSITY,               &amp;<a name='1256'>
            DZ,DZO,W,WO,WF,TSSN,TSSNO,BW,BWO,CT,CTO,FI,FIO,FL,FLO,         &amp;<a name='1257'>
            BL,BLO,BI,BIO,BT,BTO,DMLT,DMLTO,H,HO,S,SO,SS,SSO,DSOL,DHP,     &amp;<a name='1258'>
            DICEVOL,DLIQVOL,THK,QK,SWE,SNOWDEN,SNOWDEPTH,TKAIR,SNROFF,     &amp;<a name='1259'>
            DZSOIL,BPS,rib,CU,XCT,flup,UV10)<a name='1260'>
<font color=#447700>!<a name='1261'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#OLD'>OLD</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OLD_1">(TSSN,BW,BL,BI,H,FL,FI,W,DZ,SS,CT,BT,DMLT,                   &amp;<a name='1262'>
                 TSSNO,BWO,BLO,BIO,HO,FLO,FIO,WO,DZO,SSO,CTO,BTO,DMLTO)<a name='1263'>
<font color=#447700>!<a name='1264'></font>
<font color=#447700>!***************************************************************************************<a name='1265'></font>
      ELSE                               <font color=#447700>! SINGLE-LAYER SNOW<a name='1266'></font>
<font color=#447700>!***************************************************************************************<a name='1267'></font>
<font color=#447700>!<a name='1268'></font>
       CALL <A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1'>TEMRS1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEMRS1_1">(DTT,TC,TGS,TD,TA,TM,QM,EM,PSUR,WWW,CAPAC,SATCAP,        &amp;<a name='1269'>
         DTC,DTG,RA,RST,ZDEPTH,BEE,PHSAT,POROS,XDD,Z0,RDC,RBC,VCOVER,Z2,   &amp;<a name='1270'>
         ZLT,DEFAC,TU,TL,TOPT,RSTFAC,NROOT,ROOTD,PHSOIL,ROOTP,PH1,PH2,     &amp;<a name='1271'>
         ECT,ECI,EGT,EGI,EGS,HC,HG,EC,EG,EA,RADT,CHF,SHF,ALBEDO,ZLWUP,     &amp;<a name='1272'>
         THERMK,RHOAIR,ZWIND,UM,USTAR,DRAG,CCX,CG, ISNOW,SNOWDEN,          &amp;<a name='1273'>
         BPS,rib,CU,XCT,flup,UV10)<a name='1274'>
<font color=#447700>!<a name='1275'></font>
      SWE=CAPAC(2)<a name='1276'>
      SNOWDEPTH=SWE*SNOWDEN<a name='1277'>
      SNROFF=0.<a name='1278'>
<font color=#447700>!<a name='1279'></font>
      END IF<a name='1280'>
<font color=#447700>!***************************************************************************************<a name='1281'></font>
<font color=#447700>!                                                                       <a name='1282'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#UPDAT1'>UPDAT1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDAT1_1">(DTT,TC,TGS,TD,CAPAC,DTC,DTG,ECT,ECI,EGT,EGI,            &amp;<a name='1283'>
         EGS,EG,HC,HG,HFLUX,ETMASS,ROFF,                                  &amp;<a name='1284'>
         1,ROOTD,ROOTP,POROS,BEE,SATCO,SLOPE,                             &amp;<a name='1285'>
         PHSAT,ZDEPTH,WWW,CCX,CG,CHF,SHF, ISNOW,WFSOIL,SWE,SNROFF,SMELT)<a name='1286'>
<font color=#447700>!<a name='1287'></font>
      IF (ISNOW.EQ.0) THEN<a name='1288'>
         CAPAC(2)=SWE<a name='1289'>
         IF (SNOWDEPTH.LT.SNODEP_CR) THEN<a name='1290'>
           ISNOW=1<a name='1291'>
           CALL <A href='../../html_code/phys/module_sf_ssib.F.html#LAYER1'>LAYER1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LAYER1_1"> (CSOIL,TGS,DZSOIL,H,W,SNOWDEPTH,SWE,STEMP,N2)<a name='1292'>
         ELSE<a name='1293'>
           ISNOW=0<a name='1294'>
           CALL <A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE'>MODNODE</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODNODE_1">(SNOWDEPTH,DZO,WO,HO,TSSNO,BWO,BIO,                &amp;<a name='1295'>
                           BLO,BTO,FIO,FLO,CTO,DLIQVOL,DICEVOL)<a name='1296'>
         END IF<a name='1297'>
      ELSE IF(ISNOW.GT.0) THEN<a name='1298'>
         IF (CAPAC(2)*SNOWDEN.GT.SNODEP_CR) THEN<a name='1299'>
           SWE=CAPAC(2)<a name='1300'>
           SNOWDEPTH=CAPAC(2)*SNOWDEN<a name='1301'>
           ISNOW=0<a name='1302'>
       CALL <A href='../../html_code/phys/module_sf_ssib.F.html#LAYERN'>LAYERN</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LAYERN_1"> (TGS,SWE,SNOWDEPTH,  DZO,BWO,WO,BTO,CTO,FLO,FIO,       &amp;<a name='1303'>
                    HO,BLO,BIO,DLIQVOL,DICEVOL,TSSNO,DMLTO)<a name='1304'>
<a name='1305'>
         ELSE<a name='1306'>
            ISNOW=1<a name='1307'>
         END IF<a name='1308'>
      END IF<a name='1309'>
      ROFF=ROFF+SNROFF<a name='1310'>
<font color=#447700>!<a name='1311'></font>
<font color=#447700>!***************************************************************************************<a name='1312'></font>
<font color=#447700>! Check water and energy balances (fds Jan/2015)<a name='1313'></font>
      ENDWB = WWW(1) * POROS * ZDEPTH(1)        &amp;<a name='1314'>
            + WWW(2) * POROS * ZDEPTH(2)        &amp;<a name='1315'>
            + WWW(3) * POROS * ZDEPTH(3)        &amp;<a name='1316'>
            + CAPAC(1) + CAPAC(2) - (PPC+PPL)/1000. + ETMASS/1000. + ROFF<a name='1317'>
      ERRW = TOTWB - ENDWB<a name='1318'>
      IF(ABS(ERRW) .GT. 0.0001) THEN<a name='1319'>
         WRITE(message,*) 'SSIB WATER BALANCE WARNING: ',ERRW<a name='1320'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1002"> ( message )<a name='1321'>
      ENDIF<a name='1322'>
<font color=#447700>!<a name='1323'></font>
      ZLHS = RADT(1) + RADT(2) - CHF - SHF<a name='1324'>
      ZRHS = HFLUX + (ECT + ECI + EGT + EGI + EGS)/DTT<a name='1325'>
      ERRH = ZLHS - ZRHS<a name='1326'>
      IF(ABS(ERRH) .GT. 1.) THEN<a name='1327'>
         WRITE(message,*) 'SSIB ENERGY BALANCE WARNING: ',ERRH<a name='1328'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1003"> ( message )<a name='1329'>
      ENDIF<a name='1330'>
<font color=#447700>!***************************************************************************************<a name='1331'></font>
<a name='1332'>
<a name='1333'>
<font color=#447700>!------------------------------------------------------------------------<a name='1334'></font>
      SOILM=(WWW(1)*ZDEPTH(1)+WWW(2)*ZDEPTH(2)+WWW(3)*ZDEPTH(3))*POROS<a name='1335'>
<font color=#447700>!------------------------------------------------------------------------<a name='1336'></font>
      UMOM=RHOAIR*CU*USTAR*UMM<a name='1337'>
      VMOM=RHOAIR*CU*USTAR*VMM<a name='1338'>
      HLFLX= ETMASS/RHOAIR/DTT<a name='1339'>
      HSFLX= HFLUX/CPAIR/RHOAIR/DTT<a name='1340'>
      ULWSF1=TGEFF*TGEFF*TGEFF*TGEFF*STEFAN<a name='1341'>
      Q2M=0.622*EA/(PSURF-EA)<a name='1342'>
      EVAP=ETMASS*HLAT<a name='1343'>
      CM=(USTAR*USTAR)/(UM*UM)<a name='1344'>
      CH=1/(UM*RA)<a name='1345'>
<font color=#447700>!<a name='1346'></font>
      FM=VKC/CU<a name='1347'>
      FH=VKC/XCT<a name='1348'>
<font color=#447700>!<a name='1349'></font>
<font color=#447700>!<a name='1350'></font>
        EVAPSOIL=EGS /DTT <a name='1351'>
        EVAPWC=ECI /DTT <a name='1352'>
        EVAPDC=ECT /DTT <a name='1353'>
        EVAPSN=EGI /DTT<a name='1354'>
        EVAPGX=EGT /DTT<a name='1355'>
        ELATEN=EVAPSOIL+EVAPWC+EVAPDC+EVAPSN+EVAPGX<a name='1356'>
        XHLFLX=ELATEN/HLAT<a name='1357'>
        GHTFLX=CHF+SHF<a name='1358'>
<font color=#447700>!=====================================================================<a name='1359'></font>
        xhsflx=(hc+hg)/dtt<a name='1360'>
<font color=#447700>!=====================================================================<a name='1361'></font>
<font color=#447700>!<a name='1362'></font>
         CALL <A href='../../html_code/phys/module_sf_ssib.F.html#CONVDIM'>CONVDIM</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONVDIM_2">(1,                                         &amp;<a name='1363'>
   DZO1,WO1,TSSN1,TSSNO1,BWO1,BTO1,CTO1,FIO1,FLO1,BIO1,BLO1,HO1, &amp;<a name='1364'>
   DZO2,WO2,TSSN2,TSSNO2,BWO2,BTO2,CTO2,FIO2,FLO2,BIO2,BLO2,HO2, &amp;<a name='1365'>
   DZO3,WO3,TSSN3,TSSNO3,BWO3,BTO3,CTO3,FIO3,FLO3,BIO3,BLO3,HO3, &amp;<a name='1366'>
   DZO4,WO4,TSSN4,TSSNO4,BWO4,BTO4,CTO4,FIO4,FLO4,BIO4,BLO4,HO4, &amp;<a name='1367'>
   DZO, WO, TSSN, TSSNO, BWO, BTO, CTO, FIO, FLO, BIO, BLO, HO )<a name='1368'>
<font color=#447700>!<a name='1369'></font>
      WWW1=WWW(1)*POROS<a name='1370'>
      WWW2=WWW(2)*POROS<a name='1371'>
      WWW3=WWW(3)*POROS<a name='1372'>
      SNOA  = CAPAC(2)<a name='1373'>
      SNOB  = CAPAC(1)<a name='1374'>
<font color=#447700>!------------------------------------------------<a name='1375'></font>
<font color=#447700>!cfds Convert WEASD back to kg/m2<a name='1376'></font>
      SNOA = SNOA*1000.<a name='1377'>
      SNOB = SNOB*1000.<a name='1378'>
<font color=#447700>!------------------------------------------------<a name='1379'></font>
      SALB11=SALB(1,1)<a name='1380'>
      SALB12=SALB(1,2)<a name='1381'>
      SALB21=SALB(2,1)<a name='1382'>
      SALB22=SALB(2,2)<a name='1383'>
<font color=#447700>!<a name='1384'></font>
<font color=#447700>! output<a name='1385'></font>
<font color=#447700>!<a name='1386'></font>
      xlhf = elaten<a name='1387'>
      xshf = xhsflx<a name='1388'>
      xghf = ghtflx<a name='1389'>
      xegs = evapsoil<a name='1390'>
      xeci = evapwc<a name='1391'>
      xect = evapdc<a name='1392'>
      xegi = evapsn<a name='1393'>
      xegt = evapgx<a name='1394'>
      xsdn = fsdown<a name='1395'>
      xsup = fsup<a name='1396'>
      xldn = fldown<a name='1397'>
      xlup = flup<a name='1398'>
      xwat = soilm<a name='1399'>
      xhcx = hc/dtt<a name='1400'>
      xhgx = hg/dtt<a name='1401'>
      xzlt = zlt(1)<a name='1402'>
      xvcf = vcover(1)<a name='1403'>
      xxz0 = z0<a name='1404'>
      xveg = float(itype)<a name='1405'>
<a name='1406'>
<font color=#447700>!------------------------------------------------------<a name='1407'></font>
        END SUBROUTINE SSIB<a name='1408'>
<font color=#447700>!------------------------------------------------------<a name='1409'></font>
<font color=#447700>!<a name='1410'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1411'></font>
<font color=#447700>!**********************************************<a name='1412'></font>
<A NAME='SSIB_SEAICE'><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1413'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SSIB_SEAICE</font>                                  &amp; <A href='../../call_to/SSIB_SEAICE.html' TARGET='index'>1</A>,<A href='../../call_from/SSIB_SEAICE.html' TARGET='index'>7</A><a name='1414'>
                     ( IX, JX, DDTT, ITIME, ZLAT, SUNANGLE,   &amp;<a name='1415'>
                       PPL, PPC, RLWDOWN, ZWIND2,             &amp;<a name='1416'>
                       WWW1, WWW2, WWW3,                      &amp;<a name='1417'>
                       TC, TGS, TD,                           &amp;<a name='1418'>
                       SNOA, ROFF, YICE,                      &amp;<a name='1419'>
                       UMM, VMM, QM, TM,                      &amp;<a name='1420'>
                       PM, PSUR,                              &amp;<a name='1421'>
                       SWDOWN1, SNOB,                         &amp;<a name='1422'>
                       SALB11, SALB12, SALB21, SALB22,        &amp;<a name='1423'>
                  RADFRAC11, RADFRAC12, RADFRAC21, RADFRAC22, &amp;<a name='1424'>
                       XHSFLX, ELATEN, GHTFLX, XHLFLX, TGEFF, &amp;<a name='1425'>
                       USTAR, RIB, FM, FH, CM,                &amp;<a name='1426'>
                       XLHF, XSHF, XGHF,                      &amp; <font color=#447700>! output<a name='1427'></font>
                                   XSDN, XSUP, XLDN, XLUP,    &amp; <font color=#447700>! output<a name='1428'></font>
                       XWAT,                         XXZ0,    &amp; <font color=#447700>! output<a name='1429'></font>
                       XVEG,                                  &amp; <font color=#447700>! output<a name='1430'></font>
                       DAY, CLOUD, Q2M, TA, BEDO, UV10,       &amp;<a name='1431'>
                       sw_physics,ice_threshold               &amp;<a name='1432'>
                                                   )<a name='1433'>
<font color=#447700>!**********************************************<a name='1434'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1435'></font>
<font color=#447700>!   THERE ARE A MAIN SSIB PROGRAM AND 12 SUBROUTINE FILES, WHICH ARE:<a name='1436'></font>
<font color=#447700>!              VEGOUT<a name='1437'></font>
<font color=#447700>!              CROPS<a name='1438'></font>
<font color=#447700>!              RADAB<a name='1439'></font>
<font color=#447700>!              ROOT1<a name='1440'></font>
<font color=#447700>!              STOMA1<a name='1441'></font>
<font color=#447700>!              INTERC<a name='1442'></font>
<font color=#447700>!              TEMRS1<a name='1443'></font>
<font color=#447700>!              UPDAT1<a name='1444'></font>
<font color=#447700>!              RASIT5<a name='1445'></font>
<font color=#447700>!              STRES1<a name='1446'></font>
<font color=#447700>!              NEWTON<a name='1447'></font>
<font color=#447700>!                                      YONGKANG XUE<a name='1448'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1449'></font>
<font color=#447700>!                              INPUT<a name='1450'></font>
<font color=#447700>!     DDTT:      TIME INTERVAL<a name='1451'></font>
<font color=#447700>!     SUNANGLE:  SOLAR ZENITH ANGLE<a name='1452'></font>
<font color=#447700>!     SWDOWN:   SHORT WAVE DOWN(W/M*M);<a name='1453'></font>
<font color=#447700>!     RADFRAC:  SHORT WAVE COMPONENTS (visible and near IR; direct and diffuse)<a name='1454'></font>
<font color=#447700>!     RLWDOWN:   LONG WAVE DOWN(W/M*M);<a name='1455'></font>
<font color=#447700>!     PPL, PPC: LARGE SCALE AND CONVECTIVE PRECIPITATIONS AT THE TIME STEP (mm)<a name='1456'></font>
<font color=#447700>!     TM:       TEMPERETURE AT LOWEST MODEL LAYER (K)<a name='1457'></font>
<font color=#447700>!     UMM,VMM:  ZONAL AND MERIDIONAL WINDS AT LOWEST MODEL LAYER (m/S)<a name='1458'></font>
<font color=#447700>!     QM:       WATER VAPOR AT LOWEST MODEL LAYER;<a name='1459'></font>
<font color=#447700>!     PSURF:    SURFACE PRESSURE (mb)<a name='1460'></font>
<font color=#447700>!     ZWIND:    HEIGHT (m) OF LOWEST MODEL LAYER<a name='1461'></font>
<font color=#447700>!     ITYPE:    VEGETATION TYPE<a name='1462'></font>
<font color=#447700>!     ZLAT:     LATITUDE, SOUTH POLE IS -90 DEGREE AND NORTH POLE IS 90 DEGREE<a name='1463'></font>
<font color=#447700>!     MONTH:    MONTH<a name='1464'></font>
<font color=#447700>!     DAY:      CALENDER DATE<a name='1465'></font>
<font color=#447700>!     IYEAR:    YEAR<a name='1466'></font>
<font color=#447700>!                             OUTPUT<a name='1467'></font>
<font color=#447700>!     ETMASS:   EVAPORATION (mm/step)<a name='1468'></font>
<font color=#447700>!     ELATEN:   LATENT HEAT FLUX (w/m*m)<a name='1469'></font>
<font color=#447700>!     EVAPSOIL,EVAPWC,EVAPDC,EVAPSN: LATENT HEAT FROM (SOIL, INTERCEPTION,<a name='1470'></font>
<font color=#447700>!               TRANSPIRATION, AND SNOW SURFACE)<a name='1471'></font>
<font color=#447700>!     HFLUX:    SENSIBLE HEAT FLUX(w/m*m)<a name='1472'></font>
<font color=#447700>!     GHTFLX:   GROUND HEAT FLUX(w/m*m) = CHF+SHF<a name='1473'></font>
<font color=#447700>!     USTAR:    FRICTION VELOCITY (m/s)<a name='1474'></font>
<font color=#447700>!     DRAG:     MOMENTUM FLUX (kg/m/s**2)<a name='1475'></font>
<font color=#447700>!     DRAGU:    U COMPONENT OF MOMENTUM FLUX (kg/m/s**2)<a name='1476'></font>
<font color=#447700>!     DRAGV:    V COMPONENT OF MOMENTUM FLUX (kg/m/s**2)<a name='1477'></font>
<font color=#447700>!     TGEFF:    RADIATIVE TEMPERATURE (K)<a name='1478'></font>
<font color=#447700>!     BEDO:     TOTAL ALBEDO<a name='1479'></font>
<font color=#447700>!     SALB:     ALBEDO FOR 4 COMPONENTS<a name='1480'></font>
<font color=#447700>!     RADT:     NET RADIATION AT CANOPY AND GROUND LEVELS<a name='1481'></font>
<font color=#447700>!     TGS:      SOIL SURFACE TEMPERATURE (K)<a name='1482'></font>
<font color=#447700>!     TC:       CANOPY TEMPERATURE (K)<a name='1483'></font>
<font color=#447700>!     TD:       DEEP SOIL TEMPERATURE (K)<a name='1484'></font>
<font color=#447700>!     TA:       TEMPERATURE AT CANOPY AIR SPACE (K)<a name='1485'></font>
<font color=#447700>!     CAPAC:    INTERCEPTION AT CANOPY (1) and SNOW DEPTH (2)<a name='1486'></font>
<font color=#447700>!     WWW:      SOIL MOISTURE<a name='1487'></font>
<font color=#447700>!     SOILM:    TOTAL SOIL WATER CONTENT<a name='1488'></font>
<font color=#447700>!     ROFF:     RUN OFF<a name='1489'></font>
<font color=#447700>!<a name='1490'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1491'></font>
<a name='1492'>
 INTEGER, DIMENSION (12) :: IDAYS<a name='1493'>
<a name='1494'>
 REAL, DIMENSION (2)     :: CAPAC, SATCAP, GREEN, VCOVER, ZLT, CHIL, TOPT, TL, &amp;<a name='1495'>
                            TU, DEFAC, PH1, PH2, RST, ROOTD, RADT, PAR, PD<a name='1496'>
 REAL, DIMENSION (3)     :: WWW, SOREF, ZDEPTH, ROOTP, PHSOIL, YMATT, YMATQ<a name='1497'>
 REAL, DIMENSION (2,2)   :: RADFRAC, SALB<a name='1498'>
 REAL, DIMENSION (2,3)   :: RSTPAR<a name='1499'>
 REAL, DIMENSION (2,4)   :: RSTFAC<a name='1500'>
 REAL, DIMENSION (3,2)   :: RADN<a name='1501'>
 REAL, DIMENSION (2,3,2) :: TRAN, REF, ALBEDO, EXTK<a name='1502'>
<a name='1503'>
 REAL, DIMENSION (13)    :: TD_DEPTH<a name='1504'>
 REAL :: ice_threshold<a name='1505'>
 INTEGER :: sw_physics  <font color=#447700>!choice of SW radiation scheme<a name='1506'></font>
<font color=#447700>!<a name='1507'></font>
      DATA IDAYS/31,59,90,120,151,181,212,243,273,304,334,366/<a name='1508'>
<font color=#447700>!<a name='1509'></font>
      DATA TD_DEPTH/1.5, 1.5, 1.5, 1.5, 1.5, 1.5, 1.0, 1.0, 1.0        &amp;<a name='1510'>
     &amp;                                     , 0.5, 0.5, 1.5, 1.5/<a name='1511'>
<font color=#447700>!**********************************************<a name='1512'></font>
<font color=#447700>!     The final albedo=original albedo+XADJ<a name='1513'></font>
      XADJ=0.<a name='1514'>
<font color=#447700>!     CTLPA controls stomatal resistance;<a name='1515'></font>
<font color=#447700>!     Final stomatal resistance=ctlpa * stomatal resistance<a name='1516'></font>
      CTLPA=1.<a name='1517'>
<font color=#447700>!     NROOT controls root distribution. nroot=1: root uniformly distributes<a name='1518'></font>
<font color=#447700>!           in the soil layer;<a name='1519'></font>
<font color=#447700>!     If NROOT not =1, root distribution is controled by rootp.<a name='1520'></font>
      NROOT=1<a name='1521'>
<font color=#447700>!     INTG=?   TIME INTEGRATION OF SURFACE PHYSICAL VARIABLE IS DONE<a name='1522'></font>
<font color=#447700>!     INTG=2:  LEAP-FROG IMPLICIT SCHEME.   INTG=1 BACKWORD IMPLICIT SCHEME<a name='1523'></font>
      INTG=1  <font color=#447700>!!!!!! in MM5 version hardwired for INTG=1 !!!!!!!!!!!!!<a name='1524'></font>
<font color=#447700>!------------------------------------------------<a name='1525'></font>
      ITYPE=13<a name='1526'>
      ZWIND=ZWIND2*0.5<a name='1527'>
<font color=#447700>!------------------------------------------------<a name='1528'></font>
<font color=#447700>!     set DAY in year and current month MON_COR<a name='1529'></font>
<font color=#447700>!------------------------------------------------<a name='1530'></font>
      IMONTH=1<a name='1531'>
      IDAY=INT(DAY)<a name='1532'>
      DO I=1,12<a name='1533'>
        IF(IDAY.LE.IDAYS(I)) THEN<a name='1534'>
          IMONTH=I<a name='1535'>
          EXIT<a name='1536'>
        ENDIF<a name='1537'>
      ENDDO<a name='1538'>
<font color=#447700>!crr correction for southern hemisphere (reverse months) Ratko, Oct 28, 2005<a name='1539'></font>
           IF(ZLAT.LT.0.0) THEN<a name='1540'>
             MON_COR=IMONTH+6<a name='1541'>
             IF(MON_COR.GT.12) MON_COR=MON_COR-12<a name='1542'>
           ELSE<a name='1543'>
             MON_COR=IMONTH<a name='1544'>
           ENDIF<a name='1545'>
<font color=#447700>!------------------------------------------------<a name='1546'></font>
      IF (ITIME.EQ.1) TA=TC<a name='1547'>
<font color=#447700>!<a name='1548'></font>
      PSURF=PSUR*0.01<a name='1549'>
      DTT =DDTT*FLOAT(INTG)<a name='1550'>
<font color=#447700>!------------------------------------------------<a name='1551'></font>
<font color=#447700>! **  Read in vegetation parameters<a name='1552'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#VEGOUT'>VEGOUT</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VEGOUT_2">(TRAN,REF,GREEN,VCOVER,CHIL,                    &amp;<a name='1553'>
           RSTPAR,TOPT,TL,TU,DEFAC,PH1,PH2,                      &amp;<a name='1554'>
           ZLT,Z0,XDD,Z2,Z1,RDC,RBC,ROOTD,SOREF,                 &amp;<a name='1555'>
           BEE, PHSAT, POROS, SATCO,SLOPE,                       &amp;<a name='1556'>
           ZDEPTH,MON_COR,ITYPE)<a name='1557'>
<font color=#447700>!<a name='1558'></font>
<font color=#447700>!crr ------------ STC initialization ------------------------------------<a name='1559'></font>
      IF (ITIME.EQ.1) THEN<a name='1560'>
          STLEV1=0.05    <font color=#447700>! half of 10cm layer<a name='1561'></font>
          STLEV2=1.05    <font color=#447700>! half of second + first layer<a name='1562'></font>
<a name='1563'>
          DEPTH = TD_DEPTH(ITYPE)<a name='1564'>
<a name='1565'>
            IF     (DEPTH.GT.STLEV1.AND.DEPTH.LE.STLEV2)THEN <font color=#447700>! interp.<a name='1566'></font>
            TD = ( (STLEV2-DEPTH)*TGS + (DEPTH-STLEV1)*TD )             &amp;<a name='1567'>
     &amp;                        /(STLEV2-STLEV1)<a name='1568'>
            ELSE IF(DEPTH.GT.STLEV2)THEN                     <font color=#447700>! extrap.<a name='1569'></font>
            TD = ( (DEPTH-STLEV1)*TD  - (DEPTH-STLEV2)*TGS)             &amp;<a name='1570'>
     &amp;                        /(STLEV2-STLEV1)<a name='1571'>
            ENDIF<a name='1572'>
      ENDIF<a name='1573'>
<font color=#447700>!------------------------------------------------------------------------<a name='1574'></font>
        WWW(1)   = 1.<a name='1575'>
        WWW(2)   = 1.<a name='1576'>
        WWW(3)   = 1.<a name='1577'>
<font color=#447700>!------------------------------------------------<a name='1578'></font>
<font color=#447700>!cfds Convert WEASD (kg/m2) to meter<a name='1579'></font>
      SNOA = SNOA/1000.<a name='1580'>
      SNOB = SNOB/1000.<a name='1581'>
<font color=#447700>!------------------------------------------------<a name='1582'></font>
         CAPAC(1)=SNOB<a name='1583'>
         CAPAC(2)=SNOA<a name='1584'>
         SNOWDEN = 3.75   <font color=#447700>! mchen add for initialization<a name='1585'></font>
         ISNOW = 1<a name='1586'>
      IF (ITIME.EQ.1) THEN<a name='1587'>
         TA=TGS<a name='1588'>
         CAPAC(1)=0.<a name='1589'>
         CAPAC(2)=0.<a name='1590'>
           IF (SNOA.GT.0.) CAPAC(1) = ZLT(1)  * 0.0001<a name='1591'>
           TC = AMIN1(TC ,273.15)<a name='1592'>
           TGS= AMIN1(TGS,273.15)<a name='1593'>
           TD = AMIN1(TD ,272.50)<a name='1594'>
      ELSE<a name='1595'>
<font color=#447700>!        IF( YICE .LT. 0.5 ) THEN     ! previous sea, now sea-ice<a name='1596'></font>
        IF( YICE .LT. ice_threshold ) THEN     <font color=#447700>! previously water, now sea-ice<a name='1597'></font>
          CAPAC(1)= 0.<a name='1598'>
          CAPAC(2)= 0.<a name='1599'>
          XADIA = EXP(GASR/CPAIR*LOG(PSUR/PM))<a name='1600'>
          XX = MIN(TM*XADIA,273.15)<a name='1601'>
          TC = MIN(TM*XADIA,273.15)<a name='1602'>
          TGS= MIN(TM*XADIA,273.15)<a name='1603'>
          IF(TD.EQ.0.) TD=272.5<a name='1604'>
          TD = MIN(TD,272.5)<a name='1605'>
        ENDIF<a name='1606'>
      ENDIF<a name='1607'>
<font color=#447700>!<a name='1608'></font>
      UM=SQRT(UMM**2+VMM**2)<a name='1609'>
      RHOAIR=100./GASR*(PSURF+0.01*PM)/(TM+TA)<a name='1610'>
      AKAPPA = GASR/CPAIR<a name='1611'>
      BPS    =1.0 / EXP ( AKAPPA * ALOG (0.01*PM/PSURF) )<a name='1612'>
<font color=#447700>!<a name='1613'></font>
<font color=#447700>!     CONVERT TO VAPOR PRES. TO MB<a name='1614'></font>
      EM=(PSURF*QM)/0.6220<a name='1615'>
      IF (ITIME.EQ.1) EA=EM<a name='1616'>
<font color=#447700>!<a name='1617'></font>
      SUNANG=AMAX1(SUNANGLE,0.01746)<a name='1618'>
<font color=#447700>!<a name='1619'></font>
<font color=#447700>! By Zhenxin 2011-06-20<a name='1620'></font>
<font color=#447700>!      IF (sw_physics.eq.3) THEN<a name='1621'></font>
       IF (sw_physics.eq.3 .or. sw_physics.eq.4) THEN<a name='1622'>
<font color=#447700>! End by Zhenxin 2011-06-20 <a name='1623'></font>
<a name='1624'>
<font color=#447700>!**********************************************<a name='1625'></font>
<font color=#447700>!fds - RADFRAC from radiation scheme 3 (06/2010)<a name='1626'></font>
<font color=#447700>!fds - Otherwise use cloud cover to calculate radfrac <a name='1627'></font>
        radfrac11 = amax1(radfrac11,0.025)<a name='1628'>
        radfrac12 = amax1(radfrac12,0.025)<a name='1629'>
        radfrac21 = amax1(radfrac21,0.025)<a name='1630'>
        radfrac22 = amax1(radfrac22,0.025)<a name='1631'>
        swdown = radfrac11 + radfrac12 + radfrac21 + radfrac22<a name='1632'>
        RADFRAC(1,1) = radfrac11/swdown<a name='1633'>
        RADFRAC(1,2) = radfrac12/swdown<a name='1634'>
        RADFRAC(2,1) = radfrac21/swdown<a name='1635'>
        RADFRAC(2,2) = radfrac22/swdown<a name='1636'>
      ELSE<a name='1637'>
<font color=#447700>! ** CALCULATE THE CLOUD COVER USING AN EMPIRICAL EQUATION<a name='1638'></font>
<font color=#447700>!    ONLY USE THIS PART WHEN IT IS NEEDED<a name='1639'></font>
<font color=#447700>!  **  ONLY USE THIS PART WHEN SW_PHYSICS = 1 IS USED ** By Zhenxin 2011-06 <a name='1640'></font>
        swdown = amax1(swdown1,0.1)<a name='1641'>
        CLOUD = AMAX1(CLOUD,0.0)<a name='1642'>
        CLOUD = AMIN1(CLOUD,1.0)<a name='1643'>
        CLOUD = AMAX1(0.58,CLOUD)<a name='1644'>
<font color=#447700>!<a name='1645'></font>
        DIFRAT = 0.0604 / ( SUNANG-0.0223 ) + 0.0683<a name='1646'>
        IF ( DIFRAT .LT. 0.0 ) DIFRAT = 0.0<a name='1647'>
        IF ( DIFRAT .GT. 1.0 ) DIFRAT = 1.0<a name='1648'>
<font color=#447700>!<a name='1649'></font>
        DIFRAT = DIFRAT + ( 1.0 - DIFRAT ) * CLOUD<a name='1650'>
        VNRAT = ( 580.0 - CLOUD*464.0 ) / ( ( 580.0-CLOUD*499.0) &amp;<a name='1651'>
       &amp;        + ( 580.0 - CLOUD*464.0 ) )<a name='1652'>
<font color=#447700>!<a name='1653'></font>
        RADFRAC(1,1) = (1.0-DIFRAT)*VNRAT<a name='1654'>
        RADFRAC(1,2) = DIFRAT*VNRAT<a name='1655'>
        RADFRAC(2,1) = (1.0-DIFRAT)*(1.0-VNRAT)<a name='1656'>
        RADFRAC(2,2) = DIFRAT*(1.0-VNRAT)<a name='1657'>
<font color=#447700>!**********************************************<a name='1658'></font>
      ENDIF<a name='1659'>
<font color=#447700>!<a name='1660'></font>
      RADN(1,1) = RADFRAC(1,1) * SWDOWN<a name='1661'>
      RADN(1,2) = RADFRAC(1,2) * SWDOWN<a name='1662'>
      RADN(2,1) = RADFRAC(2,1) * SWDOWN<a name='1663'>
      RADN(2,2) = RADFRAC(2,2) * SWDOWN<a name='1664'>
      RADN(3,1) = 0.<a name='1665'>
      RADN(3,2) = RLWDOWN<a name='1666'>
<font color=#447700>!<a name='1667'></font>
<font color=#447700>!     END OF EMPIRICAL EQUATIONS<a name='1668'></font>
<font color=#447700>!     *********************************************************<a name='1669'></font>
<font color=#447700>!<a name='1670'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RADAB_ICE'>RADAB_ICE</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADAB_ICE_1">(TRAN,REF,GREEN,VCOVER,CHIL,ZLT,Z2,Z1,SOREF,              &amp;<a name='1671'>
           TC,TGS,SATCAP,EXTK,CLOSS,GLOSS,THERMK,P1F,P2F,                 &amp;<a name='1672'>
           RADT,PAR,PD,SALB,ALBEDO,TGEFF,SUNANG,XADJ,CAPAC,               &amp;<a name='1673'>
           RADN,BEDO,ZLWUP,RADFRAC,SWDOWN,SNOCV,1,                        &amp;<a name='1674'>
           fsdown,fldown,fsup,flup)<a name='1675'>
<a name='1676'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#ROOT1'>ROOT1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ROOT1_2">(PHSAT,BEE,WWW,PHSOIL)<a name='1677'>
<a name='1678'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#STOMA1'>STOMA1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STOMA1_2">(GREEN,VCOVER,CHIL,ZLT,PAR,PD,EXTK,SUNANG,RST,           &amp;<a name='1679'>
                 RSTPAR, CTLPA)<a name='1680'>
<font color=#447700>!***<a name='1681'></font>
       POROSAVE=POROS<a name='1682'>
       POROS=0.95<a name='1683'>
<font color=#447700>!***<a name='1684'></font>
<font color=#447700>!<a name='1685'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#INTERC'>INTERC</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERC_1">(DTT ,VCOVER,ZLT,TM,TC,TGS,CAPAC,WWW,PPC,PPL,ROFF,       &amp;<a name='1686'>
            ZDEPTH,POROS,CCX,CG,SATCO,SATCAP,SPWET,EXTK,RNOFFS,FILTR,     &amp;<a name='1687'>
            SMELT)<a name='1688'>
<font color=#447700>!<a name='1689'></font>
       CALL <A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1'>TEMRS1</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEMRS1_2">(DTT,TC,TGS,TD,TA,TM,QM,EM,PSUR,WWW,CAPAC,SATCAP,        &amp;<a name='1690'>
         DTC,DTG,RA,RST,ZDEPTH,BEE,PHSAT,POROS,XDD,Z0,RDC,RBC,VCOVER,Z2,   &amp;<a name='1691'>
         ZLT,DEFAC,TU,TL,TOPT,RSTFAC,NROOT,ROOTD,PHSOIL,ROOTP,PH1,PH2,     &amp;<a name='1692'>
         ECT,ECI,EGT,EGI,EGS,HC,HG,EC,EG,EA,RADT,CHF,SHF,ALBEDO,ZLWUP,     &amp;<a name='1693'>
         THERMK,RHOAIR,ZWIND,UM,USTAR,DRAG,CCX,CG, ISNOW,SNOWDEN,          &amp;<a name='1694'>
         BPS,rib,CU,XCT,flup,UV10)<a name='1695'>
<font color=#447700>!<a name='1696'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#UPDAT1_ICE'>UPDAT1_ICE</A><A href='../../html_code/phys/module_sf_ssib.F.html#SSIB_SEAICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDAT1_ICE_1">(DTT ,TC,TGS,TD,CAPAC,DTC,DTG,ECT,ECI,EGT,EGI,           &amp;<a name='1697'>
         EGS,EG,HC,HG,HFLUX,ETMASS,FILTR,SOILDIF,SOILDRA,ROFF,            &amp;<a name='1698'>
         RNOFFB,RNOFFS,NROOT,ROOTD,ROOTP,POROS,BEE,SATCO,SLOPE,           &amp;<a name='1699'>
         PHSAT,ZDEPTH,WWW,CCX,CG,CHF,SHF,SMELT)<a name='1700'>
<font color=#447700>!***<a name='1701'></font>
       POROS=POROSAVE<a name='1702'>
       TD  = AMIN1(TD ,273.15)<a name='1703'>
       TC  = AMIN1(TC ,273.15)<a name='1704'>
       TGS = AMIN1(TGS,273.15)<a name='1705'>
<font color=#447700>!***<a name='1706'></font>
<font color=#447700>!<a name='1707'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='1708'></font>
      SOILM=(WWW(1)*ZDEPTH(1)+WWW(2)*ZDEPTH(2)+WWW(3)*ZDEPTH(3))*POROS<a name='1709'>
<font color=#447700>!------------------------------------------------------------------------<a name='1710'></font>
      UMOM=RHOAIR*CU*USTAR*UMM<a name='1711'>
      VMOM=RHOAIR*CU*USTAR*VMM<a name='1712'>
      HLFLX= ETMASS/RHOAIR/DTT<a name='1713'>
      HSFLX= HFLUX/CPAIR/RHOAIR/DTT<a name='1714'>
      ULWSF1=TGEFF*TGEFF*TGEFF*TGEFF*STEFAN<a name='1715'>
      Q2M=0.622*EA/(PSURF-EA)<a name='1716'>
      EVAP=ETMASS*HLAT<a name='1717'>
      CM=(USTAR*USTAR)/(UM*UM)<a name='1718'>
      CH=1/(UM*RA)<a name='1719'>
<font color=#447700>!<a name='1720'></font>
      FM=VKC/CU<a name='1721'>
<font color=#447700>!     FH=VKC/CT   !fds corrected (02/2012)<a name='1722'></font>
      FH=VKC/XCT<a name='1723'>
<font color=#447700>!<a name='1724'></font>
<font color=#447700>!<a name='1725'></font>
        ELATEN=EVAP/DTT<a name='1726'>
        XHLFLX=ELATEN/HLAT<a name='1727'>
        GHTFLX=CHF+SHF<a name='1728'>
<font color=#447700>!=====================================================================<a name='1729'></font>
        xhsflx=(hc+hg)/dtt<a name='1730'>
<font color=#447700>!=====================================================================<a name='1731'></font>
<font color=#447700>!<a name='1732'></font>
      WWW1=WWW(1)*POROS<a name='1733'>
      WWW2=WWW(2)*POROS<a name='1734'>
      WWW3=WWW(3)*POROS<a name='1735'>
      SNOA  = CAPAC(2)<a name='1736'>
      SNOB  = CAPAC(1)<a name='1737'>
      SALB11=SALB(1,1)<a name='1738'>
      SALB12=SALB(1,2)<a name='1739'>
      SALB21=SALB(2,1)<a name='1740'>
      SALB22=SALB(2,2)<a name='1741'>
<font color=#447700>!<a name='1742'></font>
<font color=#447700>! later for output<a name='1743'></font>
<font color=#447700>!<a name='1744'></font>
      xlhf = elaten<a name='1745'>
      xshf = xhsflx<a name='1746'>
      xghf = ghtflx<a name='1747'>
      xsdn = fsdown<a name='1748'>
      xsup = fsup<a name='1749'>
      xldn = fldown<a name='1750'>
      xlup = flup<a name='1751'>
      xwat = soilm<a name='1752'>
      xxz0 = z0<a name='1753'>
      xveg = float(itype)<a name='1754'>
<font color=#447700>!<a name='1755'></font>
<font color=#447700>!------------------------------------------------------<a name='1756'></font>
        END SUBROUTINE SSIB_SEAICE<a name='1757'>
<font color=#447700>!------------------------------------------------------<a name='1758'></font>
<a name='1759'>
<font color=#447700>!=======================================================================<a name='1760'></font>
<font color=#447700>!                                                                       <a name='1761'></font>
<A NAME='CROPS'><A href='../../html_code/phys/module_sf_ssib.F.html#CROPS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1762'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>CROPS</font>(XLAT,DAY,CHIL,ZLT,GREEN,XCOVER      &amp; <A href='../../call_to/CROPS.html' TARGET='index'>1</A><a name='1763'>
      ,RSTPAR,TOPT,TL,TU,DEFAC,PH2,PH1)<a name='1764'>
<font color=#447700>!<a name='1765'></font>
<font color=#447700>!=======================================================================<a name='1766'></font>
<font color=#447700>!<a name='1767'></font>
<font color=#447700>!     A NEW CROP VERSION BY XUE.                            AUG., 1998<a name='1768'></font>
<font color=#447700>!<a name='1769'></font>
<font color=#447700>!     XLAT IS FROM -90 TO 90 DEGREES  FROM S. TO N.<a name='1770'></font>
<font color=#447700>!<a name='1771'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1772'></font>
<a name='1773'>
 REAL, DIMENSION (2)   :: GREEN, XCOVER, CHIL, ZLT, TOPT, TL, TU, DEFAC, PH1, PH2<a name='1774'>
 REAL, DIMENSION (2,3) :: RSTPAR<a name='1775'>
 REAL, DIMENSION (9)   :: PHENST, WLAI, WGRN<a name='1776'>
<a name='1777'>
<font color=#447700>!<a name='1778'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1779'></font>
<font color=#447700>!**               E   J    H    SD   R   HRV  CUT  PRE-E   E<a name='1780'></font>
<font color=#447700>!     SAVE WLAI,WGRN,IHEAD,IEND,DEND,IWHEAT,SYR<a name='1781'></font>
      DATA WLAI/1.0, 2.0, 6.0, 4.0, 3.0, 1.0, 0.01, 0.01, 1.0/<a name='1782'>
      DATA WGRN/0.6, 0.9, 0.8, 0.5, 0.2, 0.1, 0.01, 0.01, 0.6/<a name='1783'>
      DATA IHEAD,IEND,DEND,IWHEAT/3,9,244.,12/,SYR/365.25E0/<a name='1784'>
      IF (XLAT.LT.0.) THEN<a name='1785'>
      RDAY= DAY+184<a name='1786'>
      IF (RDAY.GT.365) RDAY=RDAY-365<a name='1787'>
      ELSE<a name='1788'>
      RDAY= DAY<a name='1789'>
      END IF<a name='1790'>
      JULDAY=INT(RDAY+0.2)<a name='1791'>
      PHI=XLAT<a name='1792'>
      APHI = ABS(PHI)<a name='1793'>
      IF (APHI.GT.55.) PHI=SIGN(55.,PHI)<a name='1794'>
      IF (APHI.LT.20.) PHI=SIGN(20.,PHI)<a name='1795'>
<font color=#447700>!<a name='1796'></font>
      FLIP =   0.0<a name='1797'>
<font color=#447700>!<a name='1798'></font>
<font color=#447700>! ** DETERMINE WHEAT PHENOLOGY FOR LATITUDE AND JULIAN DAY<a name='1799'></font>
       PHENST(2) = 4.50    *ABS(PHI) - 64.0     + FLIP<a name='1800'>
       PHENST(3) = 4.74    *ABS(PHI) - 46.2     + FLIP<a name='1801'>
       PHENST(4) = 4.86    *ABS(PHI) - 30.8     + FLIP<a name='1802'>
       PHENST(5) = 4.55    *ABS(PHI) -  3.0     + FLIP<a name='1803'>
       PHENST(6) = 4.35    *ABS(PHI) + 11.5     + FLIP<a name='1804'>
       PHENST(7) = PHENST(6) + 3.0<a name='1805'>
       DEMG      = ABS( 5.21    *ABS(PHI) - 0.3    )<a name='1806'>
       PHENST(1) = PHENST(2) - DEMG<a name='1807'>
       PHENST(9) = PHENST(1)<a name='1808'>
       PHENST(8) = PHENST(9) - 5.0<a name='1809'>
<font color=#447700>!<a name='1810'></font>
       DO 10 NS = 1,9<a name='1811'>
       IF(PHENST(NS) .LT. 0.0E0)PHENST(NS) = PHENST(NS) + 365.<a name='1812'>
       IF(PHENST(NS) .GT. 365. )PHENST(NS) = PHENST(NS) - 365.<a name='1813'>
   10  CONTINUE<a name='1814'>
<font color=#447700>!<a name='1815'></font>
       ROOTGC = 1.0<a name='1816'>
       CHILW  =-0.02<a name='1817'>
       TLAI   = 0.5<a name='1818'>
       GRLF   = 0.6<a name='1819'>
<font color=#447700>!<a name='1820'></font>
<font color=#447700>! ** FIND GROWTH STAGE GIVEN LATITUDE AND DAY<a name='1821'></font>
       DO 50 NS = 1,8<a name='1822'>
       TOP = PHENST(NS+1)<a name='1823'>
       BOT = PHENST(NS)<a name='1824'>
       DIFF1 = TOP-BOT<a name='1825'>
       DIFF2 = RDAY-BOT<a name='1826'>
       IF(RDAY.GE. BOT .AND. RDAY .LE. TOP ) GO TO 40<a name='1827'>
       IF(BOT .LT. TOP ) GO TO 50<a name='1828'>
<font color=#447700>!<a name='1829'></font>
<font color=#447700>! ** PHENOLOGY STAGES OVERLAP THE END OF YEAR?<a name='1830'></font>
       ICOND = 0<a name='1831'>
       IF(RDAY .GE. BOT   .AND. RDAY .LE. 365.) ICOND = 1<a name='1832'>
       IF(RDAY .GE. 0.0   .AND. RDAY .LE. TOP ) ICOND = 2<a name='1833'>
<font color=#447700>!<a name='1834'></font>
       IF(ICOND .EQ. 0)GO TO 50<a name='1835'>
       IF(ICOND .EQ. 2)GO TO 35<a name='1836'>
           DIFF1 = 365.    - BOT + TOP<a name='1837'>
           DIFF2 = RDAY     - BOT<a name='1838'>
           GO TO 40<a name='1839'>
<font color=#447700>!<a name='1840'></font>
   35  CONTINUE<a name='1841'>
           DIFF1 = 365.   - BOT + TOP<a name='1842'>
           DIFF2 = 365.   - BOT + RDAY<a name='1843'>
<font color=#447700>!<a name='1844'></font>
<font color=#447700>! ** DATE FOUND IN PHENOLOGY STAGE<a name='1845'></font>
   40  CONTINUE<a name='1846'>
       IF ((RDAY.GT.PHENST(IHEAD)).AND.(RDAY.LE.DEND)) THEN      <a name='1847'>
           TLAI=WLAI(IHEAD)<a name='1848'>
           GRLF=WGRN(IHEAD)<a name='1849'>
           GO TO 77<a name='1850'>
       END IF<a name='1851'>
       IF ((RDAY.GT.DEND).AND.(RDAY.LE.PHENST(IEND))) THEN<a name='1852'>
          DIFF1=PHENST(IEND)-DEND<a name='1853'>
          DIFF2=RDAY-DEND<a name='1854'>
          PERC =  DIFF2/DIFF1<a name='1855'>
          TLAI =  PERC*(WLAI(IEND)-WLAI(IHEAD)) + WLAI(IHEAD)<a name='1856'>
          GRLF =  PERC*(WGRN(IEND)-WGRN(IHEAD)) + WGRN(IHEAD)<a name='1857'>
          GO TO 77<a name='1858'>
       END IF<a name='1859'>
       PERC =  DIFF2/DIFF1<a name='1860'>
       TLAI =  PERC*(WLAI(NS+1)-WLAI(NS)) + WLAI(NS)<a name='1861'>
       GRLF =  PERC*(WGRN(NS+1)-WGRN(NS)) + WGRN(NS)<a name='1862'>
   77  CONTINUE<a name='1863'>
       GO TO  95<a name='1864'>
   50  CONTINUE<a name='1865'>
   95  CONTINUE<a name='1866'>
       XCOVER(1)=0.90*(1.0 - EXP(-TLAI))<a name='1867'>
       ZLTGMX = WLAI(IHEAD)<a name='1868'>
       ROOTGC = 2910.0    * (0.5    +0.5    *TLAI/ZLTGMX * GRLF)<a name='1869'>
       IF (NS.NE.1.AND.NS.NE.2) CHILW=-0.2<a name='1870'>
<font color=#447700>!<a name='1871'></font>
       ZLT   (1) = TLAI<a name='1872'>
       GREEN (1) = GRLF<a name='1873'>
       CHIL  (1) = CHILW<a name='1874'>
<font color=#447700>!<a name='1875'></font>
<font color=#447700>!------------------------------------------------------<a name='1876'></font>
       END SUBROUTINE CROPS<a name='1877'>
<font color=#447700>!------------------------------------------------------<a name='1878'></font>
<a name='1879'>
<font color=#447700>!=======================================================================<a name='1880'></font>
<font color=#447700>!                                                                       <a name='1881'></font>
<A NAME='ROOT1'><A href='../../html_code/phys/module_sf_ssib.F.html#ROOT1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1882'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>ROOT1</font>(PHSAT,BEE,WWW,PHSOIL) <A href='../../call_to/ROOT1.html' TARGET='index'>2</A><a name='1883'>
<font color=#447700>!                                                         12 AUG 2000   <a name='1884'></font>
<font color=#447700>!=======================================================================<a name='1885'></font>
<font color=#447700>!                                                                       <a name='1886'></font>
<font color=#447700>!    CALCULATION OF SOIL MOISTURE POTENTIALS IN ROOT ZONE OF EACH       <a name='1887'></font>
<font color=#447700>!    VEGETATION LAYER AND SUMMED SOIL+ROOT RESISTANCE                   <a name='1888'></font>
<font color=#447700>!                                                                       <a name='1889'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1890'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1891'></font>
 REAL, DIMENSION (3) :: WWW, PHSOIL<a name='1892'>
<font color=#447700>!                                                                       <a name='1893'></font>
      DO 1000 IL = 1, 3                                                 <a name='1894'>
      PHSOIL(IL) = PHSAT * AMAX1( 0.05, WWW(IL) ) ** ( - BEE )          <a name='1895'>
 1000 CONTINUE                                                          <a name='1896'>
<font color=#447700>!                                                                       <a name='1897'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1898'></font>
<font color=#447700>!     AVERAGE SOIL MOISTURE POTENTIAL IN ROOT ZONE USED FOR SOURCE      <a name='1899'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1900'></font>
<font color=#447700>!                                                                       <a name='1901'></font>
<font color=#447700>!                                                                       <a name='1902'></font>
<font color=#447700>!     PHROOT(1) = PHSOIL(1)-0.01                                        <a name='1903'></font>
<font color=#447700>!                                                                       <a name='1904'></font>
<font color=#447700>!     DO 1200 I = 2 ,3                                                  <a name='1905'></font>
<font color=#447700>!1200 PHROOT(1) = AMAX1( PHROOT(1), PHSOIL(I) )                         <a name='1906'></font>
<font color=#447700>!     PHROOT(2) = PHROOT(1)                                             <a name='1907'></font>
<font color=#447700>!                                                                       <a name='1908'></font>
<font color=#447700>!                                                                       <a name='1909'></font>
<font color=#447700>!------------------------------------------------------<a name='1910'></font>
      END SUBROUTINE ROOT1<a name='1911'>
<font color=#447700>!------------------------------------------------------<a name='1912'></font>
<a name='1913'>
<font color=#447700>!=======================================================================<a name='1914'></font>
<font color=#447700>!                                                                       <a name='1915'></font>
<A NAME='STOMA1'><A href='../../html_code/phys/module_sf_ssib.F.html#STOMA1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1916'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>STOMA1</font>(GREEN,VCOVER,CHIL,ZLT,PAR,PD,EXTK,SUNANG,RST,   &amp; <A href='../../call_to/STOMA1.html' TARGET='index'>2</A><a name='1917'>
                       RSTPAR,CTLPA)<a name='1918'>
<font color=#447700>!                                                         12 AUG 2000<a name='1919'></font>
<font color=#447700>!=======================================================================<a name='1920'></font>
<font color=#447700>!                                                                       <a name='1921'></font>
<font color=#447700>!     CALCULATION OF PAR-LIMITED STOMATAL RESISTANCE                    <a name='1922'></font>
<font color=#447700>!                                                                       <a name='1923'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1924'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1925'></font>
<a name='1926'>
 REAL, DIMENSION (2)     :: GREEN, VCOVER, ZLT, CHIL, PAR, PD, RST<a name='1927'>
 REAL, DIMENSION (2,3)   :: RSTPAR<a name='1928'>
 REAL, DIMENSION (2,3,2) :: EXTK<a name='1929'>
<a name='1930'>
<font color=#447700>!                                                                       <a name='1931'></font>
      DO 1000 IVEG = 1, 2                                               <a name='1932'>
<font color=#447700>!                                                                       <a name='1933'></font>
      AT = ZLT(IVEG) / VCOVER(IVEG)                                     <a name='1934'>
<font color=#447700>!                                                                       <a name='1935'></font>
      IF (SUNANG .LE. 0.02) THEN                                        <a name='1936'>
         XABC = RSTPAR(IVEG,1) / RSTPAR(IVEG,2) + RSTPAR(IVEG,3)        <a name='1937'>
         RST(IVEG) = 0.5 / XABC * AT                                     <a name='1938'>
         IF (RST(IVEG) .LT. 0.) RST(IVEG) = 0.00001                     <a name='1939'>
         GO TO 1010                                                     <a name='1940'>
      END IF                                                            <a name='1941'>
<font color=#447700>!                                                                       <a name='1942'></font>
      GAMMA = ( RSTPAR(IVEG,1) + RSTPAR(IVEG,2) * RSTPAR(IVEG,3) ) /     &amp;<a name='1943'>
                RSTPAR(IVEG,3)                                          <a name='1944'>
<font color=#447700>!                                                                       <a name='1945'></font>
      POWER1 = AMIN1( 50., AT * EXTK(IVEG,1,1) )                        <a name='1946'>
      POWER2 = AMIN1( 50., AT * EXTK(IVEG,1,2) )                        <a name='1947'>
<font color=#447700>!                                                                       <a name='1948'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1949'></font>
<font color=#447700>!     ROSS INCLINATION FUNCTION                                         <a name='1950'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1951'></font>
<font color=#447700>!                                                                       <a name='1952'></font>
      AA = 0.5 - 0.633 * CHIL(IVEG)- 0.33 * CHIL(IVEG)* CHIL(IVEG)      <a name='1953'>
      BB = 0.877 * ( 1. - 2. * AA )                                     <a name='1954'>
<font color=#447700>!                                                                       <a name='1955'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1956'></font>
<font color=#447700>!     COMBINED ESTIMATE OF K-PAR USING WEIGHTS FOR DIFFERENT COMPONENTS <a name='1957'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1958'></font>
<font color=#447700>!                                                                       <a name='1959'></font>
      ZAT = ALOG( ( EXP(-POWER1) + 1. )/2. ) * PD(IVEG)                  &amp;<a name='1960'>
            / ( POWER1/AT )                                             <a name='1961'>
      ZAT = ZAT + ALOG( ( EXP(-POWER2) + 1. )/2. )                       &amp;<a name='1962'>
       * ( 1. - PD(IVEG) ) / ( POWER2/AT )                              <a name='1963'>
<font color=#447700>!                                                                       <a name='1964'></font>
      POW1 = AMIN1( 50., (POWER1*ZAT/AT) )                              <a name='1965'>
      POW2 = AMIN1( 50., (POWER2*ZAT/AT) )                              <a name='1966'>
<font color=#447700>!                                                                       <a name='1967'></font>
      ZK = 1. / ZAT * ALOG( PD(IVEG) * EXP ( POW1 )                      &amp;<a name='1968'>
            + ( 1. - PD(IVEG) ) * EXP ( POW2 ) )                        <a name='1969'>
<font color=#447700>!                                                                       <a name='1970'></font>
<font color=#447700>!                                                                       <a name='1971'></font>
      POW = AMIN1( 50., ZK*AT )                                         <a name='1972'>
      EKAT = EXP ( POW )                                                <a name='1973'>
<font color=#447700>!                                                                       <a name='1974'></font>
      AVFLUX = PAR(IVEG) * ( PD(IVEG) / SUNANG * ( AA + BB * SUNANG )   &amp;<a name='1975'>
            + ( 1. - PD(IVEG) )*( BB / 3. + AA * 1.5                    &amp;<a name='1976'>
            + BB / 4. * PIE ))                                          <a name='1977'>
<font color=#447700>!                                                                       <a name='1978'></font>
      RHO4 = GAMMA / AVFLUX                                             <a name='1979'>
<font color=#447700>!                                                                       <a name='1980'></font>
      RST(IVEG) = RSTPAR(IVEG,2)/GAMMA * ALOG(( RHO4 * EKAT + 1. ) /     &amp;<a name='1981'>
                    ( RHO4 + 1. ) )                                     <a name='1982'>
      RST(IVEG) = RST(IVEG) - ALOG (( RHO4 + 1. / EKAT ) /               &amp;<a name='1983'>
                    ( RHO4 + 1. ) )                                     <a name='1984'>
      RST(IVEG) = RST(IVEG) / ( ZK * RSTPAR(IVEG,3) )                   <a name='1985'>
<font color=#447700>!                                                                       <a name='1986'></font>
<font color=#447700>!---------------------------------------------------------------------- <a name='1987'></font>
<font color=#447700>!     MODIFICATIONS FOR GREEN FRACTION : RST UPRIGHT                    <a name='1988'></font>
<font color=#447700>!---------------------------------------------------------------------- <a name='1989'></font>
<font color=#447700>!                                                                       <a name='1990'></font>
1010  RST(IVEG) = 1. / ( RST(IVEG) * GREEN(IVEG) + 0.0000001)           <a name='1991'>
1000  CONTINUE                                                          <a name='1992'>
<font color=#447700>!                                                                       <a name='1993'></font>
      RST(1) = RST(1) * CTLPA<a name='1994'>
<font color=#447700>!<a name='1995'></font>
<font color=#447700>!------------------------------------------------------<a name='1996'></font>
      END SUBROUTINE STOMA1<a name='1997'>
<font color=#447700>!------------------------------------------------------<a name='1998'></font>
<a name='1999'>
<font color=#447700>!=======================================================================<a name='2000'></font>
<font color=#447700>!                                                                       <a name='2001'></font>
<A NAME='VEGOUT'><A href='../../html_code/phys/module_sf_ssib.F.html#VEGOUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2002'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>VEGOUT</font>(XTRAN,XREF,XGREEN,XVCOVER,XCHIL,             &amp; <A href='../../call_to/VEGOUT.html' TARGET='index'>2</A><a name='2003'>
           XRSTPAR,XTOPT,XTL,XTU,XDEFAC,XPH1,XPH2,                   &amp;<a name='2004'>
           XZLT,XZ0,XDD,XZ2,XZ1,XRDC,XRBC,XROOTD,XSOREF,             &amp;<a name='2005'>
           XBEE, XPHSAT, XPOROS, XSATCO,XSLOPE,                      &amp;<a name='2006'>
           XDEPTH,MONTH,ITYPE)<a name='2007'>
<font color=#447700>!                                                     12 AUGUSTY 2000 <a name='2008'></font>
<font color=#447700>!=======================================================================<a name='2009'></font>
<font color=#447700>!                                                                       <a name='2010'></font>
<font color=#447700>!     ASSIGN VEGETATION PHYSIOLOGY                                        <a name='2011'></font>
<font color=#447700>!                                                                       <a name='2012'></font>
<font color=#447700>!    SURFACE PARAMETERS ARE READ IN SAME ORDER AS IN GCM                <a name='2013'></font>
<font color=#447700>!    SUBROUTINE SIBINP. ONLY EXCEPTION IS THAT 1-D VERSION READS IN     <a name='2014'></font>
<font color=#447700>!    SITE SPECIFIC PARAMETERS CORB1 ... ZMET .                          <a name='2015'></font>
<font color=#447700>!                                                                       <a name='2016'></font>
<font color=#447700>!     VARIABLES THAT ENTER THROUGH COMSIB:                              <a name='2017'></font>
<font color=#447700>!        SUBSCRIPTS (IV, IW, IL) :                                      <a name='2018'></font>
<font color=#447700>!              IV = VEGETATION STORY; 1 = TOP AND 2 = BOTTOM            <a name='2019'></font>
<font color=#447700>!              IW = RADIATION WAVELENGTH; 1 = VISIBLE, 2 = NEAR         <a name='2020'></font>
<font color=#447700>!                   INFRARED AND 3 = THERMAL INFRARED                   <a name='2021'></font>
<font color=#447700>!              IL = VEGETATION STATE; 1 = LIVE (GREEN) AND              <a name='2022'></font>
<font color=#447700>!                   2 = DEAD (STEMS AND TRUNK)                          <a name='2023'></font>
<font color=#447700>!                                                                       <a name='2024'></font>
<font color=#447700>!   TRAN(IV,IW,IL): LEAF TRANSMITTANCE                                  <a name='2025'></font>
<font color=#447700>!   REF (IV,IW,IL): LEAF REFLECTANCE                                    <a name='2026'></font>
<font color=#447700>!   RSTPAR(IV,IW) : PAR-DEPENDENT LEAF STOMATAL RESISTANCE COEFFICIENTS <a name='2027'></font>
<font color=#447700>!                          A =(J/M**3) B = 2(W/M**2) C = 3(S/M)         <a name='2028'></font>
<font color=#447700>!   SOREF(IW)     : SOIL REFLECTANCE                                    <a name='2029'></font>
<font color=#447700>!   CHIL(IV)      : LEAF ANGLE DISTRIBUTION FACTOR                      <a name='2030'></font>
<font color=#447700>!   TOPT(IV)      : OPTIMUM TEMPERATURE FOR STOMATAL FUNCTIONING        <a name='2031'></font>
<font color=#447700>!   TL(IV)        : LOWER TEMPERATURE LIMIT FOR STOMATAL FUNCTIONING    <a name='2032'></font>
<font color=#447700>!   TU(IV)        : UPPER TEMPERATURE LIMIT FOR STOMATAL FUNCTIONING    <a name='2033'></font>
<font color=#447700>!   DEFAC(IV)     : VAPOR PRESSURE DEFICIT PARAMETER                    <a name='2034'></font>
<font color=#447700>!   PH1(IV)       :                                                     <a name='2035'></font>
<font color=#447700>!   PH2(IV)       :                                                     <a name='2036'></font>
<font color=#447700>!   ROOTD(IV)     : ROOTING DEPTH                                       <a name='2037'></font>
<font color=#447700>!   BEE           : SOIL WETNESS EXPONENT                               <a name='2038'></font>
<font color=#447700>!   PHSAT         : SOIL TENSION AT SATURATION                          <a name='2039'></font>
<font color=#447700>!   SATCO         : HYDRAULIC CONDUCTIVITY AT SATURATION                <a name='2040'></font>
<font color=#447700>!   POROS         : SOIL POROSITY                                       <a name='2041'></font>
<font color=#447700>!   ZDEPTH        : DEPTH OF 3 SOIL MOISTURE LAYERS                     <a name='2042'></font>
<font color=#447700>!   Z0            : ROUGHNESS LENGTH                                    <a name='2043'></font>
<font color=#447700>!   XDD           : ZERO PLANE DISPLACEMENT                             <a name='2044'></font>
<font color=#447700>!   ZLT(IV)       : LEAF AREA INDEX                                     <a name='2045'></font>
<font color=#447700>!   GREEN(IV)     : GREEN LEAF FRACTION                                 <a name='2046'></font>
<font color=#447700>!   VCOVER(IV)    : VEGETATION COVER FRACTION                           <a name='2047'></font>
<font color=#447700>!                                                                       <a name='2048'></font>
<font color=#447700>!     VARIABLES ( SPECIFIC TO SIB 1-D VERSION ONLY ) FROM COMSIB        <a name='2049'></font>
<font color=#447700>!                                                                       <a name='2050'></font>
<font color=#447700>!      ZWIND  : REFERENCE HEIGHT FOR WIND MEASUREMENT                   <a name='2051'></font>
<font color=#447700>!      ZMET   : REFERENCE HEIGHT FOR TEMPERATURE, HUMIDITY MEASUREMENT  <a name='2052'></font>
<font color=#447700>!        THE ABOVE ARE GENERATED FROM SIBX + MOMOPT OUTPUT              <a name='2053'></font>
<font color=#447700>!                                                                       <a name='2054'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2055'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2056'></font>
<font color=#447700>! USE module_ssib_veg<a name='2057'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2058'></font>
<font color=#447700>!<a name='2059'></font>
 REAL, DIMENSION (2)     :: XGREEN, XVCOVER, XZLT, XCHIL, XTOPT, XTL, &amp;<a name='2060'>
                            XTU, XDEFAC, XPH1, XPH2, XROOTD<a name='2061'>
 REAL, DIMENSION (3)     :: XSOREF, XDEPTH<a name='2062'>
 REAL, DIMENSION (2,3)   :: XRSTPAR<a name='2063'>
 REAL, DIMENSION (2,3,2) :: XTRAN, XREF<a name='2064'>
<a name='2065'>
<font color=#447700>!-----------------------------------------------------------------------<a name='2066'></font>
<font color=#447700>!                                                                       <a name='2067'></font>
       DO IW=1,3<a name='2068'>
       XTRAN(1,IW,1)=TRAN0(ITYPE,1,IW,1)<a name='2069'>
       XTRAN(1,IW,2)=TRAN0(ITYPE,1,IW,2)<a name='2070'>
       XTRAN(2,IW,1)=TRAN0(ITYPE,2,IW,1)<a name='2071'>
       XTRAN(2,IW,2)=TRAN0(ITYPE,2,IW,2)<a name='2072'>
       XREF (1,IW,1)= REF0(ITYPE,1,IW,1)<a name='2073'>
       XREF (1,IW,2)= REF0(ITYPE,1,IW,2)<a name='2074'>
       XREF (2,IW,1)= REF0(ITYPE,2,IW,1)<a name='2075'>
       XREF (2,IW,2)= REF0(ITYPE,2,IW,2)<a name='2076'>
       XRSTPAR(1,IW)=RSTPAR0(ITYPE,1,IW)<a name='2077'>
       XRSTPAR(2,IW)=RSTPAR0(ITYPE,2,IW)<a name='2078'>
       XSOREF  (IW) =SOREF0(ITYPE,IW)<a name='2079'>
       END DO<a name='2080'>
       DO IV=1,2<a name='2081'>
       XCHIL(IV)=CHIL0(ITYPE,IV) <a name='2082'>
       XTOPT(IV)=TOPT0(ITYPE,IV)<a name='2083'>
       XTL(IV)=TL0(ITYPE,IV)<a name='2084'>
       XTU(IV)=TU0(ITYPE,IV)<a name='2085'>
       XDEFAC(IV)=DEFAC0(ITYPE,IV)<a name='2086'>
       XPH1(IV)=PH10(ITYPE,IV)<a name='2087'>
       XPH2(IV)=PH20(ITYPE,IV)<a name='2088'>
       XROOTD(IV)=ROOTD0(ITYPE,IV)<a name='2089'>
       XZLT(IV)=ZLT0(ITYPE,MONTH,IV)<a name='2090'>
       XGREEN(IV)=GREEN0(ITYPE,MONTH,IV)<a name='2091'>
       XVCOVER(IV)=VCOVER0(ITYPE,MONTH,IV)<a name='2092'>
       END DO<a name='2093'>
       DO IDEP=1,3<a name='2094'>
       XDEPTH(IDEP)=DEPTH0(ITYPE,IDEP)<a name='2095'>
       END DO<a name='2096'>
<font color=#447700>!                   <a name='2097'></font>
       XBEE=BEE0(ITYPE)<a name='2098'>
       XPHSAT=PHSAT0(ITYPE)<a name='2099'>
       XSATCO=SATCO0(ITYPE)<a name='2100'>
       XPOROS=POROS0(ITYPE)<a name='2101'>
       XSLOPE=SLOPE0(ITYPE)<a name='2102'>
       XZ2=Z20(ITYPE,MONTH)<a name='2103'>
       XZ1=Z10(ITYPE,MONTH)<a name='2104'>
       XZ0= Z000(ITYPE,MONTH)<a name='2105'>
       XDD= D0(ITYPE,MONTH)<a name='2106'>
       XRBC=RBC0 (ITYPE,MONTH)<a name='2107'>
       XRDC=RDC0 (ITYPE,MONTH)<a name='2108'>
<font color=#447700>!<a name='2109'></font>
<font color=#447700>!------------------------------------------------------<a name='2110'></font>
      END SUBROUTINE VEGOUT<a name='2111'>
<font color=#447700>!------------------------------------------------------<a name='2112'></font>
<a name='2113'>
<font color=#447700>!=======================================================================<a name='2114'></font>
<font color=#447700>!                                                                       <a name='2115'></font>
<A NAME='COMBO'><A href='../../html_code/phys/module_sf_ssib.F.html#COMBO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2116'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>COMBO</font> (DDZ2,DZP,DZM,WP,WM,HP,HM,TP,TM,BWP,BWM,BIP,    &amp; <A href='../../call_to/COMBO.html' TARGET='index'>17</A>,<A href='../../call_from/COMBO.html' TARGET='index'>1</A><a name='2117'>
          BIM,BLP,BLM,BTP,BTM,FIP,FIM,FLP,FLM,CTP,CTM,                 &amp;<a name='2118'>
          DLIQVOLP,DLIQVOLM,DICEVOLP,DICEVOLM)<a name='2119'>
<font color=#447700>!<a name='2120'></font>
<font color=#447700>!=======================================================================<a name='2121'></font>
<font color=#447700>!<a name='2122'></font>
      RATIO= DDZ2/dzm<a name='2123'>
      dzp=dzp + RATIO*dzm<a name='2124'>
      wp = wp + RATIO*wm<a name='2125'>
      hp = hp + RATIO*hm<a name='2126'>
      bwp= wp*rhowater/dzp<a name='2127'>
      btp= bwp<a name='2128'>
      ctp= (1.9e6)*(bwp/920.0)<a name='2129'>
      dmlt=wp*rhowater*dlm<a name='2130'>
      if(hp.ge.(-1.0)*dmlt)then<a name='2131'>
         tp=273.16<a name='2132'>
         fip=(-1.0)*hp/dmlt<a name='2133'>
         flp=1.0-fip<a name='2134'>
         blp=bwp*flp<a name='2135'>
         bip=bwp*fip<a name='2136'>
         dliqvolp = blp/rhowater<a name='2137'>
         dicevolp = bip/dice<a name='2138'>
      else<a name='2139'>
         flp=0.0<a name='2140'>
         fip=1.0<a name='2141'>
         tp=(hp+dmlt)/(ctp*dzp)+273.16<a name='2142'>
         bip=bwp<a name='2143'>
         blp=0.0<a name='2144'>
         dliqvolp = 0.0<a name='2145'>
         dicevolp = bip/dice<a name='2146'>
      endif<a name='2147'>
<font color=#447700>!<a name='2148'></font>
      dzm=dzm - RATIO*dzm<a name='2149'>
      wm = wm - RATIO*wm<a name='2150'>
      hm = hm - RATIO*hm<a name='2151'>
<font color=#447700>!<a name='2152'></font>
<font color=#447700>!------------------------------------------------------<a name='2153'></font>
      END SUBROUTINE COMBO<a name='2154'>
<font color=#447700>!------------------------------------------------------<a name='2155'></font>
<a name='2156'>
<font color=#447700>!=======================================================================<a name='2157'></font>
<font color=#447700>!                                                                       <a name='2158'></font>
<A NAME='COMPACT'><A href='../../html_code/phys/module_sf_ssib.F.html#COMPACT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2159'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>COMPACT</font>(BI,T,BL,OVERBURDEN,PDZDT,SS,DICE) <A href='../../call_to/COMPACT.html' TARGET='index'>2</A><a name='2160'>
<font color=#447700>!<a name='2161'></font>
<font color=#447700>!=======================================================================<a name='2162'></font>
<font color=#447700>!clwp  12/11/2000, change the subroutine back to NO DATE form.<a name='2163'></font>
      data c2,c3,c4,c5/23d-3,2.777d-6,0.04,2.0/<a name='2164'>
      data dm/150/<a name='2165'>
      data eta0/0.9d6/<a name='2166'>
      if(bi .ge. dice .or. ss .ge. 1.) return<a name='2167'>
<a name='2168'>
      ddz1=-c3*exp(-c4*(273.15-t))<a name='2169'>
      if(bi .gt. dm)  ddz1=ddz1*exp(-46.0d-3*(bi-dm))<a name='2170'>
<a name='2171'>
      if(bl .gt. 0.01) ddz1=ddz1*c5<a name='2172'>
<font color=#447700>!cl compaction due to overburden<a name='2173'></font>
      ddz2=-overburden*exp(-0.08*(273.15-t)-c2*bi)/eta0<a name='2174'>
<font color=#447700>!cl compaction occurring during melt has been taken into account in thermal.f<a name='2175'></font>
      ddz3=0d0<a name='2176'>
      pdzdt=ddz1+ddz2+ddz3<a name='2177'>
<font color=#447700>!<a name='2178'></font>
<font color=#447700>!------------------------------------------------------<a name='2179'></font>
      END SUBROUTINE COMPACT<a name='2180'>
<font color=#447700>!------------------------------------------------------<a name='2181'></font>
<a name='2182'>
<font color=#447700>!=======================================================================<a name='2183'></font>
<font color=#447700>!                                                                       <a name='2184'></font>
<A NAME='GETMET'><A href='../../html_code/phys/module_sf_ssib.F.html#GETMET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2185'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>GETMET</font>(IPTYPE,PRCP_TOTAL,TAIR,                       &amp; <A href='../../call_to/GETMET.html' TARGET='index'>1</A><a name='2186'>
                        PRCP_S,PRCP_W,FI_FALL,FL_FALL,BI_FALL,BL_FALL)<a name='2187'>
<font color=#447700>!<a name='2188'></font>
<font color=#447700>!=======================================================================<a name='2189'></font>
       IF (PRCP_TOTAL.gt.0.) THEN<a name='2190'>
          IF(IPTYPE.EQ.2)THEN<a name='2191'>
            PRCP_S=PRCP_TOTAL<a name='2192'>
            PRCP_W=0.0<a name='2193'>
          ELSE IF(IPTYPE.EQ.1)THEN<a name='2194'>
            PRCP_W=PRCP_TOTAL<a name='2195'>
            PRCP_S=0.0<a name='2196'>
            FL_FALL=1.0<a name='2197'>
            FI_FALL=0.<a name='2198'>
            BL_FALL=1000.0<a name='2199'>
            BI_FALL=0.0<a name='2200'>
          ENDIF<a name='2201'>
       ELSE<a name='2202'>
           PRCP_W=0.0<a name='2203'>
           PRCP_S=0.0<a name='2204'>
           IPTYPE = 0<a name='2205'>
           RETURN<a name='2206'>
       END IF<a name='2207'>
         IF (IPTYPE.NE.1) THEN<a name='2208'>
            IF (TAIR .GT. 275.15) THEN<a name='2209'>
              BI_FALL =189<a name='2210'>
            ELSE IF (TAIR.GT.258.16)THEN<a name='2211'>
              BI_FALL=50+1.7*(TAIR-258.16)**1.5d0<a name='2212'>
            ELSE<a name='2213'>
              BI_FALL=50<a name='2214'>
            ENDIF<a name='2215'>
<a name='2216'>
            FL_FALL = 0<a name='2217'>
            FI_FALL=1.0<a name='2218'>
            BL_FALL=0.0<a name='2219'>
         ENDIF<a name='2220'>
<font color=#447700>!<a name='2221'></font>
<font color=#447700>!------------------------------------------------------<a name='2222'></font>
      END SUBROUTINE GETMET<a name='2223'>
<font color=#447700>!------------------------------------------------------<a name='2224'></font>
<a name='2225'>
<font color=#447700>!=======================================================================<a name='2226'></font>
<font color=#447700>!                                                                       <a name='2227'></font>
<A NAME='INTERCS'><A href='../../html_code/phys/module_sf_ssib.F.html#INTERCS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2228'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>INTERCS</font> (DTT,VCOVER,ZLAI,TM,TC,TGS,CAPAC,WWW,PPC,PPL, &amp; <A href='../../call_to/INTERCS.html' TARGET='index'>1</A><a name='2229'>
                         ROFF,ZDEPTH,POROS,CCX,CG,SATCO,SATCAP,SPWET,  &amp;<a name='2230'>
                         EXTK,ISNOW,P0,CSOIL,DZSOIL,                   &amp;<a name='2231'>
                         CHISL,SMELT)<a name='2232'>
<font color=#447700>!                                                         1 AUGUST 1988<a name='2233'></font>
<font color=#447700>!=======================================================================<a name='2234'></font>
<font color=#447700>!<a name='2235'></font>
<font color=#447700>!     CALCULATION OF (1) INTERCEPTION AND DRAINAGE OF RAINFALL AND SNOW<a name='2236'></font>
<font color=#447700>!                    (2) SPECIFIC HEAT TERMS FIXED FOR TIME STEP<a name='2237'></font>
<font color=#447700>!<a name='2238'></font>
<font color=#447700>!     MODIFICATION 30 DEC 1985 : NON-UNIFORM PRECIPITATION<a name='2239'></font>
<font color=#447700>!     ------------      CONVECTIVE PPN. IS DESCRIBED BY AREA-INTENSITY<a name='2240'></font>
<font color=#447700>!                       RELATIONSHIP :-<a name='2241'></font>
<font color=#447700>!<a name='2242'></font>
<font color=#447700>!                                        F(X) = A*EXP(-B*X)+C<a name='2243'></font>
<font color=#447700>!<a name='2244'></font>
<font color=#447700>!                       THROUGHFALL, INTERCEPTION AND INFILTRATION<a name='2245'></font>
<font color=#447700>!                       EXCESS ARE FUNCTIONAL ON THIS RELATIONSHIP<a name='2246'></font>
<font color=#447700>!                       AND PROPORTION OF LARGE-SCALE PPN.<a name='2247'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2248'></font>
<font color=#447700>!<a name='2249'></font>
      DIMENSION CAPACP(2), SNOWP(2), PCOEFS(2,2)<a name='2250'>
      DATA PCOEFS(1,1)/ 20. /, PCOEFS(1,2)/ .206E-8 /,                 &amp;<a name='2251'>
           PCOEFS(2,1)/ 0.0001 /, PCOEFS(2,2)/ 0.9999 /, BP /20. /<a name='2252'>
      DIMENSION VCOVER(2),ZLAI(2),WWW(3),CAPAC(2),SATCAP(2),EXTK(2,3,2)<a name='2253'>
      DIMENSION ZDEPTH(3),SNOWW(2)<a name='2254'>
<font color=#447700>!<a name='2255'></font>
      AP = PCOEFS(2,1)<a name='2256'>
      CP = PCOEFS(2,2)<a name='2257'>
      TOTALP = PPC + PPL<a name='2258'>
      IF(TOTALP.LT.1.E-8)GO TO 6000<a name='2259'>
      AP = PPC/TOTALP * PCOEFS(1,1) + PPL/TOTALP * PCOEFS(2,1)<a name='2260'>
      CP = PPC/TOTALP * PCOEFS(1,2) + PPL/TOTALP * PCOEFS(2,2)<a name='2261'>
 6000 CONTINUE<a name='2262'>
      ROFF = 0.<a name='2263'>
      THRU = 0.<a name='2264'>
      FPI  = 0.<a name='2265'>
<font color=#447700>!<a name='2266'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2267'></font>
<font color=#447700>!     THERMAL CONDUCTIVITY OF THE SOIL, TAKING INTO ACCOUNT POROSITY<a name='2268'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2269'></font>
<font color=#447700>!<a name='2270'></font>
      THETA=WWW(1)*POROS<a name='2271'>
      CHISL=( 9.8E-4+1.2E-3*THETA )/( 1.1-0.4*THETA )<a name='2272'>
      CHISL=CHISL*4.186E2<a name='2273'>
<font color=#447700>!<a name='2274'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2275'></font>
<font color=#447700>!     THERMAL DIFFUSIVITY AND HEAT CAPACITY OF THE SOIL<a name='2276'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2277'></font>
<font color=#447700>!<a name='2278'></font>
      DIFSL=5.E-7<a name='2279'>
<font color=#447700>!<a name='2280'></font>
      ROCS =CHISL/DIFSL<a name='2281'>
      D1   =SQRT(DIFSL*86400.0)<a name='2282'>
      CSOIL=ROCS*D1/SQRT(PIE)/2.0<a name='2283'>
<font color=#447700>!     YX2002 (test2)<a name='2284'></font>
      dzsoil=D1/SQRT(PIE)/2.0<a name='2285'>
      THALAS=0.<a name='2286'>
      OCEANS=0.<a name='2287'>
      POLAR=0.<a name='2288'>
      CSOIL=CSOIL*(1.0-THALAS)+10.E10*OCEANS+POLAR*3.6*4.2E4<a name='2289'>
<font color=#447700>!<a name='2290'></font>
      P0 = TOTALP * 0.001<a name='2291'>
<font color=#447700>!<a name='2292'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2293'></font>
<font color=#447700>!     INPUT PRECIPITATION IS GIVEN IN MM, CONVERTED TO M TO GIVE P0.<a name='2294'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2295'></font>
<font color=#447700>!<a name='2296'></font>
      DO 1000 IVEG = 1, 2<a name='2297'>
<font color=#447700>!<a name='2298'></font>
      SPWET1 = AMIN1 ( 0.05, CAPAC(IVEG))*CW<a name='2299'>
<font color=#447700>!<a name='2300'></font>
      TS = TC<a name='2301'>
      SPECHT = ZLAI(1) * CLAI<a name='2302'>
      IF ( IVEG .EQ. 1 ) GO TO 1100<a name='2303'>
      TS = TGS<a name='2304'>
      SPECHT = CSOIL<a name='2305'>
1100  CONTINUE<a name='2306'>
<font color=#447700>!<a name='2307'></font>
      XSC = AMAX1(0., CAPAC(IVEG) - SATCAP(IVEG) )<a name='2308'>
      IF(IVEG.EQ.2 .AND. TS.LE.TF )GO TO 1170<a name='2309'>
      CAPAC(IVEG) = CAPAC(IVEG) - XSC<a name='2310'>
      ROFF = ROFF + XSC<a name='2311'>
1170  CONTINUE<a name='2312'>
      CAPACP(IVEG) = 0.<a name='2313'>
      SNOWP(IVEG) = 0.<a name='2314'>
<font color=#447700>!<a name='2315'></font>
      IF( TS .GT. TF ) CAPACP(IVEG) = CAPAC(IVEG)<a name='2316'>
      IF( TS .LE. TF ) SNOWP(IVEG) = CAPAC(IVEG)<a name='2317'>
      CAPAC(IVEG) = CAPACP(IVEG)<a name='2318'>
      SNOWW(IVEG) = SNOWP(IVEG)<a name='2319'>
      ZLOAD = CAPAC(IVEG) + SNOWW(IVEG)<a name='2320'>
<font color=#447700>!<a name='2321'></font>
      FPI = ( 1.-EXP( - EXTK(IVEG,3,1) * ZLAI(IVEG)/VCOVER(IVEG) ) )   &amp;<a name='2322'>
            * VCOVER(IVEG)<a name='2323'>
      TTI = P0 * ( 1.-FPI )<a name='2324'>
<font color=#447700>!<a name='2325'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2326'></font>
<font color=#447700>!    PROPORTIONAL SATURATED AREA (XS) AND LEAF DRAINAGE(TEX)<a name='2327'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2328'></font>
<font color=#447700>!<a name='2329'></font>
      XS = 1.<a name='2330'>
      IF ( P0 .LT. 1.E-9 ) GO TO 1150<a name='2331'>
      ARG =  ( SATCAP(IVEG)-ZLOAD )/( P0*FPI*AP ) -CP/AP<a name='2332'>
      IF ( ARG .LT. 1.E-9 ) GO TO 1150<a name='2333'>
      XS = -1./BP * ALOG( ARG )<a name='2334'>
      XS = AMIN1( XS, 1. )<a name='2335'>
      XS = AMAX1( XS, 0. )<a name='2336'>
1150  TEX = P0*FPI * ( AP/BP*( 1.- EXP( -BP*XS )) + CP*XS ) -   &amp;<a name='2337'>
            ( SATCAP(IVEG) - ZLOAD ) * XS<a name='2338'>
      TEX = AMAX1( TEX, 0. )<a name='2339'>
<font color=#447700>!<a name='2340'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2341'></font>
<font color=#447700>!    TOTAL THROUGHFALL (THRU) AND STORE AUGMENTATION<a name='2342'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2343'></font>
<font color=#447700>!<a name='2344'></font>
      THRU = TTI + TEX<a name='2345'>
      IF(IVEG.EQ.2.AND.TGS.LE.TF)THRU = 0.<a name='2346'>
<font color=#447700>!<a name='2347'></font>
      PINF = P0 - THRU<a name='2348'>
      IF( TM .GT. TF ) CAPAC(IVEG) = CAPAC(IVEG) + PINF<a name='2349'>
      IF( TM .LE. TF ) SNOWW(IVEG) = SNOWW(IVEG) + PINF<a name='2350'>
<font color=#447700>!<a name='2351'></font>
      IF( IVEG .EQ. 1 ) GO TO 1300<a name='2352'>
      IF( TM .GT. TF ) GO TO 1200<a name='2353'>
      SNOWW(IVEG) = SNOWP(IVEG) + P0<a name='2354'>
      THRU = 0.<a name='2355'>
      GO TO 1300<a name='2356'>
<font color=#447700>!<a name='2357'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2358'></font>
<font color=#447700>!    INSTANTANEOUS OVERLAND FLOW CONTRIBUTION ( ROFF )<a name='2359'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2360'></font>
<font color=#447700>!<a name='2361'></font>
1200  EQUDEP = SATCO * DTT<a name='2362'>
<font color=#447700>!<a name='2363'></font>
      XS = 1.<a name='2364'>
      IF ( THRU .LT. 1.E-9 ) GO TO 1250<a name='2365'>
      ARG = EQUDEP / ( THRU * AP ) -CP/AP<a name='2366'>
      IF ( ARG .LT. 1.E-9 ) GO TO 1250<a name='2367'>
      XS = -1./BP * ALOG( ARG )<a name='2368'>
      XS = AMIN1( XS, 1. )<a name='2369'>
      XS = AMAX1( XS, 0. )<a name='2370'>
1250  ROFFO = THRU * ( AP/BP * ( 1.-EXP( -BP*XS )) + CP*XS )  &amp;<a name='2371'>
             -EQUDEP*XS<a name='2372'>
      ROFFO = AMAX1 ( ROFFO, 0. )<a name='2373'>
      ROFF = ROFF + ROFFO<a name='2374'>
      WWW(1) = WWW(1) + (THRU - ROFFO) / ( POROS*ZDEPTH(1) )<a name='2375'>
1300  CONTINUE<a name='2376'>
<font color=#447700>!<a name='2377'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2378'></font>
<font color=#447700>!    TEMPERATURE CHANGE DUE TO ADDITION OF PRECIPITATION<a name='2379'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2380'></font>
<font color=#447700>!<a name='2381'></font>
      DIFF = ( CAPAC(IVEG)+SNOWW(IVEG) - CAPACP(IVEG)-SNOWP(IVEG) )*CW<a name='2382'>
      CCP = SPECHT + SPWET1<a name='2383'>
      CCT = SPECHT + SPWET1 + DIFF<a name='2384'>
<font color=#447700>!<a name='2385'></font>
      TSD = ( TS * CCP + TM * DIFF ) / CCT<a name='2386'>
<font color=#447700>!<a name='2387'></font>
      FREEZE = 0.<a name='2388'>
      IF ( TS .GT. TF .AND. TM .GT. TF ) GO TO 2000<a name='2389'>
      IF ( TS .LE. TF .AND. TM .LE. TF ) GO TO 2000<a name='2390'>
<font color=#447700>!<a name='2391'></font>
      TTA = TS<a name='2392'>
      TTB = TM<a name='2393'>
      CCA = CCP<a name='2394'>
      CCB = DIFF<a name='2395'>
      IF ( TSD .GT. TF ) GO TO 2100<a name='2396'>
<font color=#447700>!<a name='2397'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2398'></font>
<font color=#447700>!    FREEZING OF WATER ON CANOPY OR GROUND<a name='2399'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2400'></font>
<font color=#447700>!<a name='2401'></font>
      CCC = CAPACP(IVEG) * SNOMEL<a name='2402'>
      IF ( TS .LT. TM ) CCC = DIFF * SNOMEL / CW<a name='2403'>
      TSD = ( TTA * CCA + TTB * CCB + CCC ) / CCT<a name='2404'>
<font color=#447700>!<a name='2405'></font>
      FREEZE = ( TF * CCT - ( TTA * CCA + TTB * CCB ) )<a name='2406'>
      FREEZE = (AMIN1 ( CCC, FREEZE )) / SNOMEL<a name='2407'>
      IF(TSD .GT. TF)TSD = TF - 0.1<a name='2408'>
<font color=#447700>!<a name='2409'></font>
      GO TO 2000<a name='2410'>
<font color=#447700>!<a name='2411'></font>
2100  CONTINUE<a name='2412'>
<font color=#447700>!<a name='2413'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2414'></font>
<font color=#447700>!    MELTING OF SNOW ON CANOPY OR GROUND<a name='2415'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2416'></font>
<font color=#447700>!<a name='2417'></font>
      CCC = - SNOWW(IVEG) * SNOMEL<a name='2418'>
      IF ( TS .GT. TM ) CCC = - DIFF * SNOMEL / CW<a name='2419'>
<font color=#447700>!<a name='2420'></font>
      TSD = ( TTA * CCA + TTB * CCB + CCC ) / CCT<a name='2421'>
<font color=#447700>!<a name='2422'></font>
      FREEZE = ( TF * CCT - ( TTA * CCA + TTB * CCB ) )<a name='2423'>
      FREEZE = (AMAX1( CCC, FREEZE )) / SNOMEL<a name='2424'>
      IF(TSD .LE. TF)TSD = TF - 0.1<a name='2425'>
<font color=#447700>!<a name='2426'></font>
2000  CONTINUE<a name='2427'>
<font color=#447700>!crr<a name='2428'></font>
      SMELT = FREEZE<a name='2429'>
<font color=#447700>!crr<a name='2430'></font>
      SNOWW(IVEG) = SNOWW(IVEG) + FREEZE<a name='2431'>
      CAPAC(IVEG) = CAPAC(IVEG) - FREEZE<a name='2432'>
<font color=#447700>!<a name='2433'></font>
      IF( IVEG .EQ. 1 ) TC = TSD<a name='2434'>
      IF( IVEG .EQ. 2 ) TGS = TSD<a name='2435'>
      IF( SNOWW(IVEG) .LT. 0.0000001 ) GO TO 3000<a name='2436'>
<font color=#447700>!     modeified to force water into soil Xue Feb. 1994<a name='2437'></font>
<font color=#447700>!     ZMELT = 0.<a name='2438'></font>
<font color=#447700>!     IF ( TD .GT. TF ) ZMELT = CAPAC(IVEG)<a name='2439'></font>
<font color=#447700>!     IF ( TD .LE. TF ) ROFF = ROFF + CAPAC(IVEG)<a name='2440'></font>
      ZMELT = CAPAC(IVEG)<a name='2441'>
      CAPAC(IVEG) = 0.<a name='2442'>
      WWW(1) = WWW(1) + ZMELT / ( POROS * ZDEPTH(1) )<a name='2443'>
<font color=#447700>!<a name='2444'></font>
3000  CONTINUE<a name='2445'>
<font color=#447700>!<a name='2446'></font>
      CAPAC(IVEG) = CAPAC(IVEG) + SNOWW(IVEG)<a name='2447'>
      SNOWW(IVEG) = 0.<a name='2448'>
<font color=#447700>!<a name='2449'></font>
      P0 = THRU<a name='2450'>
      IF (ISNOW.eq.0) go to 1001<a name='2451'>
1000  CONTINUE<a name='2452'>
<font color=#447700>!<a name='2453'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2454'></font>
<font color=#447700>!    CALCULATION OF CANOPY AND GROUND HEAT CAPACITIES.<a name='2455'></font>
<font color=#447700>!    N.B. THIS SPECIFICATION DOES NOT NECESSARILY CONSERVE ENERGY WHEN<a name='2456'></font>
<font color=#447700>!    DEALING WITH VERY LATGE SNOWPACKS.<a name='2457'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2458'></font>
<font color=#447700>!<a name='2459'></font>
1001  CCX = ZLAI(1) * CLAI + CAPAC(1) * CW<a name='2460'>
      SPWET = AMIN1 ( 0.05, CAPAC(2)) * CW<a name='2461'>
      CG = (CSOIL + SPWET)<a name='2462'>
<font color=#447700>!<a name='2463'></font>
<font color=#447700>!------------------------------------------------------<a name='2464'></font>
      END SUBROUTINE INTERCS<a name='2465'>
<font color=#447700>!------------------------------------------------------<a name='2466'></font>
<font color=#447700>!=======================================================================<a name='2467'></font>
<font color=#447700>!<a name='2468'></font>
<A NAME='INTERC'><A href='../../html_code/phys/module_sf_ssib.F.html#INTERC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2469'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>INTERC</font>(DTT,VCOVER,ZLT,TM,TC,TGS,CAPAC,WWW,PPC,PPL,ROFF,  &amp; <A href='../../call_to/INTERC.html' TARGET='index'>1</A><a name='2470'>
          ZDEPTH,POROS,CCX,CG,SATCO,SATCAP,SPWET,EXTK,RNOFFS,FILTR,SMELT)<a name='2471'>
<font color=#447700>!                                                         12 AUGUST 2000<a name='2472'></font>
<font color=#447700>!=======================================================================<a name='2473'></font>
<font color=#447700>!<a name='2474'></font>
<font color=#447700>!     CALCULATION OF (1) INTERCEPTION AND DRAINAGE OF RAINFALL AND SNOW<a name='2475'></font>
<font color=#447700>!                    (2) SPECIFIC HEAT TERMS FIXED FOR TIME STEP<a name='2476'></font>
<font color=#447700>!<a name='2477'></font>
<font color=#447700>!     MODIFICATION 30 DEC 1985 : NON-UNIFORM PRECIPITATION<a name='2478'></font>
<font color=#447700>!     ------------      CONVECTIVE PPN. IS DESCRIBED BY AREA-INTENSITY<a name='2479'></font>
<font color=#447700>!                       RELATIONSHIP :-<a name='2480'></font>
<font color=#447700>!<a name='2481'></font>
<font color=#447700>!                                        F(X) = A*EXP(-B*X)+C<a name='2482'></font>
<font color=#447700>!<a name='2483'></font>
<font color=#447700>!                       THROUGHFALL, INTERCEPTION AND INFILTRATION<a name='2484'></font>
<font color=#447700>!                       EXCESS ARE FUNCTIONAL ON THIS RELATIONSHIP<a name='2485'></font>
<font color=#447700>!                       AND PROPORTION OF LARGE-SCALE PPN.<a name='2486'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2487'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2488'></font>
<font color=#447700>!<a name='2489'></font>
 REAL, DIMENSION (2)     :: VCOVER, ZLT, CAPAC, SATCAP, SNOWW, CAPACP, SNOWP<a name='2490'>
 REAL, DIMENSION (3)     :: WWW, ZDEPTH<a name='2491'>
 REAL, DIMENSION (2,2)   :: PCOEFS<a name='2492'>
 REAL, DIMENSION (2,3,2) :: EXTK<a name='2493'>
<a name='2494'>
      DATA PCOEFS(1,1)/ 20. /, PCOEFS(1,2)/ .206E-8 /,                   &amp;<a name='2495'>
          PCOEFS(2,1)/ 0.0001 /, PCOEFS(2,2)/ 0.9999 /, BP /20. /<a name='2496'>
<font color=#447700>!<a name='2497'></font>
      AP = PCOEFS(2,1)<a name='2498'>
      CP = PCOEFS(2,2)<a name='2499'>
      TOTALP = PPC + PPL<a name='2500'>
      IF(TOTALP.LT.1.E-8)GO TO 6000<a name='2501'>
      AP = PPC/TOTALP * PCOEFS(1,1) + PPL/TOTALP * PCOEFS(2,1)<a name='2502'>
      CP = PPC/TOTALP * PCOEFS(1,2) + PPL/TOTALP * PCOEFS(2,2)<a name='2503'>
 6000 CONTINUE<a name='2504'>
<font color=#447700>!<a name='2505'></font>
      ROFF = 0.<a name='2506'>
      THRU = 0.<a name='2507'>
      FPI  = 0.<a name='2508'>
<font color=#447700>!<a name='2509'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2510'></font>
<font color=#447700>!     THERMAL CONDUCTIVITY OF THE SOIL, TAKING INTO ACCOUNT POROSITY<a name='2511'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2512'></font>
<font color=#447700>!<a name='2513'></font>
      THETA=WWW(1)*POROS<a name='2514'>
      CHISL=( 9.8E-4+1.2E-3*THETA )/( 1.1-0.4*THETA )<a name='2515'>
      CHISL=CHISL*4.186E2<a name='2516'>
<font color=#447700>!<a name='2517'></font>
<font color=#447700>!<a name='2518'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2519'></font>
<font color=#447700>!     THERMAL DIFFUSIVITY AND HEAT CAPACITYOF THE SOIL<a name='2520'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2521'></font>
<font color=#447700>!<a name='2522'></font>
      DIFSL=5.E-7<a name='2523'>
<font color=#447700>!<a name='2524'></font>
      ROCS =CHISL/DIFSL<a name='2525'>
      D1   =SQRT(DIFSL*86400.0)<a name='2526'>
      CSOIL=ROCS*D1/SQRT(PIE)/2.0<a name='2527'>
      THALAS=0.<a name='2528'>
      OCEANS=0.<a name='2529'>
      POLAR=0.<a name='2530'>
      CSOIL=CSOIL*(1.0-THALAS)+10.E10*OCEANS+POLAR*3.6*4.2E4<a name='2531'>
<font color=#447700>!<a name='2532'></font>
      P0 = TOTALP * 0.001<a name='2533'>
<font color=#447700>!<a name='2534'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2535'></font>
<font color=#447700>!     INPUT PRECIPITATION IS GIVEN IN MM, CONVERTED TO M TO GIVE P0.<a name='2536'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2537'></font>
<font color=#447700>!<a name='2538'></font>
      DO 1000 IVEG = 1, 2<a name='2539'>
<font color=#447700>!<a name='2540'></font>
      SPWET1 = AMIN1 ( 0.05, CAPAC(IVEG))*CW<a name='2541'>
<font color=#447700>!<a name='2542'></font>
      TS = TC<a name='2543'>
      SPECHT = ZLT(1) * CLAI<a name='2544'>
      IF ( IVEG .EQ. 1 ) GO TO 1100<a name='2545'>
      TS = TGS<a name='2546'>
      SPECHT = CSOIL<a name='2547'>
1100  CONTINUE<a name='2548'>
<font color=#447700>!<a name='2549'></font>
      XSC = AMAX1(0., CAPAC(IVEG) - SATCAP(IVEG) )<a name='2550'>
      IF(IVEG.EQ.2 .AND. TS.LE.TF )GO TO 1170<a name='2551'>
      CAPAC(IVEG) = CAPAC(IVEG) - XSC<a name='2552'>
      ROFF = ROFF + XSC<a name='2553'>
      RNOFFS = XSC*1000. + RNOFFS<a name='2554'>
1170  CONTINUE<a name='2555'>
      CAPACP(IVEG) = 0.<a name='2556'>
      SNOWP(IVEG) = 0.<a name='2557'>
<font color=#447700>!<a name='2558'></font>
      IF( TS .GT. TF ) CAPACP(IVEG) = CAPAC(IVEG)<a name='2559'>
      IF( TS .LE. TF ) SNOWP(IVEG) = CAPAC(IVEG)<a name='2560'>
      CAPAC(IVEG) = CAPACP(IVEG)<a name='2561'>
      SNOWW(IVEG) = SNOWP(IVEG)<a name='2562'>
      ZLOAD = CAPAC(IVEG) + SNOWW(IVEG)<a name='2563'>
<font color=#447700>!<a name='2564'></font>
      FPI = ( 1.-EXP( - EXTK(IVEG,3,1) * ZLT(IVEG)/VCOVER(IVEG) ) )        &amp;<a name='2565'>
           * VCOVER(IVEG)<a name='2566'>
      TTI = P0 * ( 1.-FPI )<a name='2567'>
<font color=#447700>!<a name='2568'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2569'></font>
<font color=#447700>!    PROPORTIONAL SATURATED AREA (XS) AND LEAF DRAINAGE(TEX)<a name='2570'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2571'></font>
<font color=#447700>!<a name='2572'></font>
      XS = 1.<a name='2573'>
      IF ( P0 .LT. 1.E-9 ) GO TO 1150<a name='2574'>
      ARG =  ( SATCAP(IVEG)-ZLOAD )/( P0*FPI*AP ) -CP/AP<a name='2575'>
      IF ( ARG .LT. 1.E-9 ) GO TO 1150<a name='2576'>
      XS = -1./BP * ALOG( ARG )<a name='2577'>
      XS = AMIN1( XS, 1. )<a name='2578'>
      XS = AMAX1( XS, 0. )<a name='2579'>
1150  TEX = P0*FPI * ( AP/BP*( 1.- EXP( -BP*XS )) + CP*XS ) -           &amp;<a name='2580'>
          ( SATCAP(IVEG) - ZLOAD ) * XS<a name='2581'>
      TEX = AMAX1( TEX, 0. )<a name='2582'>
<font color=#447700>!<a name='2583'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2584'></font>
<font color=#447700>!    TOTAL THROUGHFALL (THRU) AND STORE AUGMENTATION<a name='2585'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2586'></font>
<font color=#447700>!<a name='2587'></font>
      THRU = TTI + TEX<a name='2588'>
      IF(IVEG.EQ.2.AND.TGS.LE.TF)THRU = 0.<a name='2589'>
<font color=#447700>!<a name='2590'></font>
      PINF = P0 - THRU<a name='2591'>
      IF( TM .GT. TF ) CAPAC(IVEG) = CAPAC(IVEG) + PINF<a name='2592'>
      IF( TM .LE. TF ) SNOWW(IVEG) = SNOWW(IVEG) + PINF<a name='2593'>
<font color=#447700>!<a name='2594'></font>
      IF( IVEG .EQ. 1 ) GO TO 1300<a name='2595'>
      IF( TM .GT. TF ) GO TO 1200<a name='2596'>
      SNOWW(IVEG) = SNOWP(IVEG) + P0<a name='2597'>
      THRU = 0.<a name='2598'>
      GO TO 1300<a name='2599'>
<font color=#447700>!<a name='2600'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2601'></font>
<font color=#447700>!    INSTANTANEOUS OVERLAND FLOW CONTRIBUTION ( ROFF )<a name='2602'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2603'></font>
<font color=#447700>!<a name='2604'></font>
1200  EQUDEP = SATCO * DTT<a name='2605'>
<font color=#447700>!<a name='2606'></font>
      XS = 1.<a name='2607'>
      IF ( THRU .LT. 1.E-9 ) GO TO 1250<a name='2608'>
      ARG = EQUDEP / ( THRU * AP ) -CP/AP<a name='2609'>
      IF ( ARG .LT. 1.E-9 ) GO TO 1250<a name='2610'>
      XS = -1./BP * ALOG( ARG )<a name='2611'>
      XS = AMIN1( XS, 1. )<a name='2612'>
      XS = AMAX1( XS, 0. )<a name='2613'>
1250  ROFFO = THRU * ( AP/BP * ( 1.-EXP( -BP*XS )) + CP*XS )             &amp;<a name='2614'>
            -EQUDEP*XS<a name='2615'>
      ROFFO = AMAX1 ( ROFFO, 0. )<a name='2616'>
      ROFF = ROFF + ROFFO<a name='2617'>
      RNOFFS = RNOFFS + ROFFO*1000.<a name='2618'>
      FILTR =  FILTR + (THRU - ROFFO)<a name='2619'>
      WWW(1) = WWW(1) + (THRU - ROFFO) / ( POROS*ZDEPTH(1) )<a name='2620'>
1300  CONTINUE<a name='2621'>
<font color=#447700>!<a name='2622'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2623'></font>
<font color=#447700>!    TEMPERATURE CHANGE DUE TO ADDITION OF PRECIPITATION<a name='2624'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2625'></font>
<font color=#447700>!<a name='2626'></font>
      DIFF = ( CAPAC(IVEG)+SNOWW(IVEG) - CAPACP(IVEG)-SNOWP(IVEG) )*CW<a name='2627'>
      CCP = SPECHT + SPWET1<a name='2628'>
      CCT = SPECHT + SPWET1 + DIFF<a name='2629'>
<font color=#447700>!<a name='2630'></font>
      TSD = ( TS * CCP + TM * DIFF ) / CCT<a name='2631'>
<font color=#447700>!<a name='2632'></font>
      FREEZE = 0.<a name='2633'>
      IF ( TS .GT. TF .AND. TM .GT. TF ) GO TO 2000<a name='2634'>
      IF ( TS .LE. TF .AND. TM .LE. TF ) GO TO 2000<a name='2635'>
<font color=#447700>!<a name='2636'></font>
      TTA = TS<a name='2637'>
      TTB = TM<a name='2638'>
      CCA = CCP<a name='2639'>
      CCB = DIFF<a name='2640'>
      IF ( TSD .GT. TF ) GO TO 2100<a name='2641'>
<font color=#447700>!<a name='2642'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2643'></font>
<font color=#447700>!    FREEZING OF WATER ON CANOPY OR GROUND<a name='2644'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2645'></font>
<font color=#447700>!<a name='2646'></font>
      CCC = CAPACP(IVEG) * SNOMEL<a name='2647'>
      IF ( TS .LT. TM ) CCC = DIFF * SNOMEL / CW<a name='2648'>
      TSD = ( TTA * CCA + TTB * CCB + CCC ) / CCT<a name='2649'>
<font color=#447700>!<a name='2650'></font>
      FREEZE = ( TF * CCT - ( TTA * CCA + TTB * CCB ) )<a name='2651'>
      FREEZE = (AMIN1 ( CCC, FREEZE )) / SNOMEL<a name='2652'>
      IF(TSD .GT. TF)TSD = TF - 0.1<a name='2653'>
<font color=#447700>!<a name='2654'></font>
      GO TO 2000<a name='2655'>
<font color=#447700>!<a name='2656'></font>
2100  CONTINUE<a name='2657'>
<font color=#447700>!<a name='2658'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2659'></font>
<font color=#447700>!    MELTING OF SNOW ON CANOPY OR GROUND<a name='2660'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2661'></font>
<font color=#447700>!<a name='2662'></font>
      CCC = - SNOWW(IVEG) * SNOMEL<a name='2663'>
      IF ( TS .GT. TM ) CCC = - DIFF * SNOMEL / CW<a name='2664'>
<font color=#447700>!<a name='2665'></font>
      TSD = ( TTA * CCA + TTB * CCB + CCC ) / CCT<a name='2666'>
<font color=#447700>!<a name='2667'></font>
      FREEZE = ( TF * CCT - ( TTA * CCA + TTB * CCB ) )<a name='2668'>
      FREEZE = (AMAX1( CCC, FREEZE )) / SNOMEL<a name='2669'>
      IF(TSD .LE. TF)TSD = TF - 0.1<a name='2670'>
<font color=#447700>!<a name='2671'></font>
2000  CONTINUE<a name='2672'>
      SMELT = FREEZE<a name='2673'>
      SNOWW(IVEG) = SNOWW(IVEG) + FREEZE<a name='2674'>
      CAPAC(IVEG) = CAPAC(IVEG) - FREEZE<a name='2675'>
<font color=#447700>!<a name='2676'></font>
      IF( IVEG .EQ. 1 ) TC = TSD<a name='2677'>
      IF( IVEG .EQ. 2 ) TGS = TSD<a name='2678'>
      IF( SNOWW(IVEG) .LT. 0.0000001 ) GO TO 3000<a name='2679'>
      ZMELT = 0.<a name='2680'>
<font color=#447700>!     modified to force water into soil. Xue Feb. 1994<a name='2681'></font>
      ZMELT = CAPAC(IVEG)<a name='2682'>
<font color=#447700>!     IF ( TD .GT. TF ) ZMELT = CAPAC(IVEG)<a name='2683'></font>
<font color=#447700>!     IF ( TD .LE. TF ) ROFF = ROFF + CAPAC(IVEG)<a name='2684'></font>
      CAPAC(IVEG) = 0.<a name='2685'>
      WWW(1) = WWW(1) + ZMELT / ( POROS * ZDEPTH(1) )<a name='2686'>
      FILTR = FILTR + ZMELT<a name='2687'>
<font color=#447700>!<a name='2688'></font>
3000  CONTINUE<a name='2689'>
<font color=#447700>!<a name='2690'></font>
      CAPAC(IVEG) = CAPAC(IVEG) + SNOWW(IVEG)<a name='2691'>
      SNOWW(IVEG) = 0.<a name='2692'>
<font color=#447700>!<a name='2693'></font>
<font color=#447700>!     **** LOAD PILPS PARAMETER<a name='2694'></font>
<font color=#447700>!<a name='2695'></font>
<font color=#447700>!     if (freeze.lt.0) snm(istat)=snm(istat)-freeze<a name='2696'></font>
      freeze=0.0<a name='2697'>
<font color=#447700>!<a name='2698'></font>
      P0 = THRU<a name='2699'>
<font color=#447700>!<a name='2700'></font>
1000  CONTINUE<a name='2701'>
<font color=#447700>!<a name='2702'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2703'></font>
<font color=#447700>!    CALCULATION OF CANOPY AND GROUND HEAT CAPACITIES.<a name='2704'></font>
<font color=#447700>!    N.B. THIS SPECIFICATION DOES NOT NECESSARILY CONSERVE ENERGY WHEN<a name='2705'></font>
<font color=#447700>!    DEALING WITH VERY LATGE SNOWPACKS.<a name='2706'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2707'></font>
<font color=#447700>!<a name='2708'></font>
      CCX = ZLT(1) * CLAI + CAPAC(1) * CW<a name='2709'>
      SPWET = AMIN1 ( 0.05, CAPAC(2))*CW<a name='2710'>
      CG = (CSOIL + SPWET)<a name='2711'>
<font color=#447700>!<a name='2712'></font>
<font color=#447700>!------------------------------------------------------<a name='2713'></font>
      END SUBROUTINE INTERC<a name='2714'>
<font color=#447700>!------------------------------------------------------<a name='2715'></font>
<font color=#447700>!=======================================================================<a name='2716'></font>
<font color=#447700>!                                                                       <a name='2717'></font>
<A NAME='LAYER1'><A href='../../html_code/phys/module_sf_ssib.F.html#LAYER1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2718'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>LAYER1</font> (CSOIL,TGS,DZSOIL,H,W,SNOWDEPTH,SWE,STEMP,ND) <A href='../../call_to/LAYER1.html' TARGET='index'>1</A><a name='2719'>
<font color=#447700>!<a name='2720'></font>
<font color=#447700>!=======================================================================<a name='2721'></font>
       parameter (dice=920.0, rhowater=1000.0,dlm=3.335d5)<a name='2722'>
       dimension h(nd),w(nd)<a name='2723'>
       swe=w(1)+w(2)+w(3)<a name='2724'>
<font color=#447700>!      YX2002 (test2)<a name='2725'></font>
       snh=h(1)+h(2)+h(3)+csoil*(tgs-273.16)<a name='2726'>
<font color=#447700>!      snh=h(1)+h(2)+h(3)+csoil*(tgs-273.16)*dzsoil<a name='2727'></font>
       dmlto=swe*dlm*rhowater<a name='2728'>
       scv=1.9e+6*(swe/snowdepth)/dice<a name='2729'>
       if (snh.gt.0.0) then<a name='2730'>
<font color=#447700>!      YX2002 (test2)<a name='2731'></font>
          stemp=snh/(swe*4.18*10**6.+csoil)+273.16<a name='2732'>
<font color=#447700>!         stemp=snh/(swe*4.18*10**6.+csoil*dzsoil)+273.16<a name='2733'></font>
       else if (snh.gt.-dmlto) then<a name='2734'>
          stemp=273.16<a name='2735'>
       else<a name='2736'>
<font color=#447700>!      YX2002 (test2)<a name='2737'></font>
          stemp=(snh+dmlto)/(scv*snowdepth+csoil)+273.16<a name='2738'>
<font color=#447700>!         stemp=(snh+dmlto)/(scv*snowdepth+csoil*dzsoil)+273.16<a name='2739'></font>
       end if<a name='2740'>
<font color=#447700>!<a name='2741'></font>
<font color=#447700>!------------------------------------------------------<a name='2742'></font>
      END SUBROUTINE LAYER1<a name='2743'>
<font color=#447700>!------------------------------------------------------<a name='2744'></font>
<a name='2745'>
<font color=#447700>!=======================================================================<a name='2746'></font>
<font color=#447700>!                                                                       <a name='2747'></font>
<A NAME='LAYERN'><A href='../../html_code/phys/module_sf_ssib.F.html#LAYERN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2748'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>LAYERN</font> (TG,SNOW_WE,SNOW_DEPTH,  DZ0,BW0,W0,BT0,CT0,  &amp; <A href='../../call_to/LAYERN.html' TARGET='index'>1</A><a name='2749'>
                  FL0,FI0,H0,BL0,BI0,DLIQV0,DICEV0,TSSN0,DMLT0)<a name='2750'>
<font color=#447700>!<a name='2751'></font>
<font color=#447700>!=======================================================================<a name='2752'></font>
       DIMENSION DZ0(4),W0(4),BW0(4),BT0(4),CT0(4),FL0(4),FI0(4),H0(4), &amp;<a name='2753'>
                 BL0(4),BI0(4),DLIQV0(4),DICEV0(4),TSSN0(4),DMLT0(4)<a name='2754'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='2755'></font>
          IF(SNOW_DEPTH.GT.0.05.AND.SNOW_DEPTH.LE.0.06) THEN<a name='2756'>
           DZ0(1)=0.02<a name='2757'>
           DZ0(2)=0.02<a name='2758'>
           DZ0(3)=SNOW_DEPTH- DZ0(1)- DZ0(2)<a name='2759'>
          ELSE IF ( SNOW_DEPTH.GT.0.06.AND.SNOW_DEPTH.LE.0.08) THEN<a name='2760'>
             DZ0(3)=0.02<a name='2761'>
             DZ0(2)=0.02<a name='2762'>
             DZ0(1)=SNOW_DEPTH- DZ0(3)- DZ0(2)<a name='2763'>
          ELSE IF ( SNOW_DEPTH.GT.0.08.AND.SNOW_DEPTH.LE.0.62) THEN<a name='2764'>
             DZ0(3)=0.02<a name='2765'>
             DZ0(2)=(SNOW_DEPTH- DZ0(3))*0.33333333<a name='2766'>
             DZ0(1)=(SNOW_DEPTH- DZ0(3))*0.66666667<a name='2767'>
          ELSE IF ( SNOW_DEPTH.GT.0.62) THEN<a name='2768'>
             DZ0(3)=0.02<a name='2769'>
             DZ0(2)=0.20<a name='2770'>
             DZ0(1)=SNOW_DEPTH- DZ0(3)- DZ0(2)<a name='2771'>
         End IF<a name='2772'>
          do  777 i=1,N<a name='2773'>
             TSSN0(I)=TG<a name='2774'>
             BW0(I)=SNOW_WE*RHOWATER/SNOW_DEPTH<a name='2775'>
 777      continue<a name='2776'>
<font color=#447700>!---------------------------------------------------------------------<a name='2777'></font>
<font color=#447700>!  Next we will calculate the initial variables for time step going on<a name='2778'></font>
<font color=#447700>!---------------------------------------------------------------------<a name='2779'></font>
          do 666 i=1,N<a name='2780'>
          W0(I)=(BW0(I)*DZ0(I))/RHOWATER<a name='2781'>
          BT0(I)=BW0(I)<a name='2782'>
          CT0(I)=(BW0(I)/920.0)*1.9e+6<a name='2783'>
          IF (TSSN0(I).EQ.273.16)THEN<a name='2784'>
              FL0(I)= FLMIN<a name='2785'>
              FI0(I)=1.0- FLMIN<a name='2786'>
              H0(I)=(-1.0)*W0(I)*FI0(I)*DLM*RHOWATER<a name='2787'>
              BL0(I)=BW0(I)*FL0(I)<a name='2788'>
              BI0(I)=BW0(I)*FI0(I)<a name='2789'>
              DLIQV0(I) = BL0(I)/RHOWATER<a name='2790'>
              DICEV0(I) = BI0(I)/DICE<a name='2791'>
          ELSE IF(TSSN0(I).LT.273.16) THEN<a name='2792'>
              FL0(I)=0.0<a name='2793'>
              FI0(I)=1.0<a name='2794'>
              DMLT0(I)=W0(I)*DLM*RHOWATER<a name='2795'>
              H0(I)=(TSSN0(I)-273.16)*CT0(I)*DZ0(I)-DMLT0(I)<a name='2796'>
              BL0(I)=0.0<a name='2797'>
              BI0(I)=BW0(I)<a name='2798'>
              DLIQV0(I)=0.0<a name='2799'>
              DICEV0(I) = BI0(I)/DICE<a name='2800'>
          ENDIF<a name='2801'>
666     continue<a name='2802'>
<font color=#447700>!<a name='2803'></font>
<font color=#447700>!------------------------------------------------------<a name='2804'></font>
      END SUBROUTINE LAYERN<a name='2805'>
<font color=#447700>!------------------------------------------------------<a name='2806'></font>
<a name='2807'>
<font color=#447700>!=======================================================================<a name='2808'></font>
<font color=#447700>!                                                                       <a name='2809'></font>
<A NAME='MODNODE'><A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2810'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>MODNODE</font>(SNOWDEPTH,DZO,WO,HO,TSSNO,BWO,BIO,       &amp; <A href='../../call_to/MODNODE.html' TARGET='index'>1</A>,<A href='../../call_from/MODNODE.html' TARGET='index'>4</A><a name='2811'>
                         BLO,BTO,FIO,FLO,CTO,DLIQVOL,DICEVOL)<a name='2812'>
<font color=#447700>!<a name='2813'></font>
<font color=#447700>!=======================================================================<a name='2814'></font>
      DIMENSION DZO(N1),WO(N1),HO(N1),TSSNO(N1),BWO(N1),BIO(N1),BLO(N1),  &amp;<a name='2815'>
          BTO(N1),FIO(N1),FLO(N1),CTO(N1),DLIQVOL(N1),DICEVOL(N1)<a name='2816'>
<a name='2817'>
<font color=#447700>!clwp  10/30/2000, for the adjustment of layers 2,3<a name='2818'></font>
       IF (SNOWDEPTH.le.0.06) then<a name='2819'>
         DZ1=0.02<a name='2820'>
         DZ2=0.02<a name='2821'>
         DZ3=SNOWDEPTH-( DZ2+DZ1)<a name='2822'>
       ELSE IF (SNOWDEPTH.gt.0.06) then<a name='2823'>
         DZ3=0.02<a name='2824'>
       ENDIF<a name='2825'>
<font color=#447700>!     to get the expected change of top layer of snow<a name='2826'></font>
         DDZ3=DZ3-dzo(3)<a name='2827'>
<font color=#447700>!     to get the expected change of top layer of snow<a name='2828'></font>
      IF (DDZ3.GT.0.0) THEN<a name='2829'>
          DDZ3=MIN(DDZ3,dzo(2))<a name='2830'>
          CALL <A href='../../html_code/phys/module_sf_ssib.F.html#COMBO'>COMBO</A><A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMBO_14"> (DDZ3,dzo(3),dzo(2),wo(3),wo(2),ho(3),ho(2),         &amp;<a name='2831'>
          tssno(3),tssno(2),bwo(3),bwo(2),bio(3),bio(2),blo(3),blo(2),    &amp;<a name='2832'>
          bto(3),bto(2),fio(3),fio(2),flo(3),flo(2),cto(3),cto(2),        &amp;<a name='2833'>
          dliqvol(3),dliqvol(2),dicevol(3),dicevol(2))<a name='2834'>
      ELSE<a name='2835'>
          DDZ3=-DDZ3<a name='2836'>
           CALL <A href='../../html_code/phys/module_sf_ssib.F.html#COMBO'>COMBO</A><A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMBO_15"> (DDZ3,dzo(2),dzo(3),wo(2),wo(3),ho(2),ho(3),        &amp;<a name='2837'>
          tssno(2),tssno(3),bwo(2),bwo(3),bio(2),bio(3),blo(2),blo(3),    &amp;<a name='2838'>
          bto(2),bto(3),fio(2),fio(3),flo(2),flo(3),cto(2),cto(3),        &amp;<a name='2839'>
          dliqvol(2),dliqvol(3),dicevol(2),dicevol(3))<a name='2840'>
      END IF<a name='2841'>
<font color=#447700>!clwp  10/30/2000, for the adjustment of layers 1,2<a name='2842'></font>
      SUM12=dzo(1)+dzo(2)<a name='2843'>
      IF (SNOWDEPTH.le.0.06) THEN<a name='2844'>
      DZ2=0.5*SUM12<a name='2845'>
        ELSE IF (SNOWDEPTH.gt.0.06.and.SNOWDEPTH.le.0.08) THEN<a name='2846'>
        DZ2=0.02<a name='2847'>
          ELSE IF (SNOWDEPTH.gt.0.08.and.SNOWDEPTH.le.0.62) THEN<a name='2848'>
          DZ2=0.33333333*SUM12<a name='2849'>
            ELSE IF (SNOWDEPTH.gt.0.62) THEN<a name='2850'>
            DZ2=0.20<a name='2851'>
      ENDIF<a name='2852'>
<font color=#447700>!     to get the expected change of middle layer of snow<a name='2853'></font>
         DDZ2=DZ2-dzo(2)<a name='2854'>
<font color=#447700>!     to get the expected change of middle layer of snow<a name='2855'></font>
      IF (DDZ2.GT.0.0) THEN<a name='2856'>
          CALL <A href='../../html_code/phys/module_sf_ssib.F.html#COMBO'>COMBO</A><A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMBO_16"> (DDZ2,dzo(2),dzo(1),wo(2),wo(1),ho(2),ho(1),         &amp;<a name='2857'>
          tssno(2),tssno(1),bwo(2),bwo(1),bio(2),bio(1),blo(2),blo(1),    &amp;<a name='2858'>
          bto(2),bto(1),fio(2),fio(1),flo(2),flo(1),cto(2),cto(1),        &amp;<a name='2859'>
          dliqvol(2),dliqvol(1),dicevol(2),dicevol(1))<a name='2860'>
      ELSE<a name='2861'>
          DDZ2=-DDZ2<a name='2862'>
          CALL <A href='../../html_code/phys/module_sf_ssib.F.html#COMBO'>COMBO</A><A href='../../html_code/phys/module_sf_ssib.F.html#MODNODE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMBO_17"> (DDZ2,dzo(1),dzo(2),wo(1),wo(2),ho(1),ho(2),         &amp;<a name='2863'>
          tssno(1),tssno(2),bwo(1),bwo(2),bio(1),bio(2),blo(1),blo(2),    &amp;<a name='2864'>
          bto(1),bto(2),fio(1),fio(2),flo(1),flo(2),cto(1),cto(2),        &amp;<a name='2865'>
          dliqvol(1),dliqvol(2),dicevol(1),dicevol(2))<a name='2866'>
      END IF<a name='2867'>
      SNOWDEPTH=dzo(1)+dzo(2)+dzo(3)<a name='2868'>
<font color=#447700>!<a name='2869'></font>
<font color=#447700>!------------------------------------------------------<a name='2870'></font>
      END SUBROUTINE MODNODE<a name='2871'>
<font color=#447700>!------------------------------------------------------<a name='2872'></font>
<a name='2873'>
<font color=#447700>!=======================================================================<a name='2874'></font>
<font color=#447700>!                                                                       <a name='2875'></font>
<A NAME='NEWSNOW'><A href='../../html_code/phys/module_sf_ssib.F.html#NEWSNOW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2876'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>NEWSNOW</font>(PRCP,BIFALL,BLFALL,FLFALL,TKAIR,               &amp; <A href='../../call_to/NEWSNOW.html' TARGET='index'>1</A><a name='2877'>
       DZO,WO,BWO,CTO,HO,DMLTO,FIO,FLO,BIO,BLO,DLIQVOL,DICEVOL,TSSNO,WF)<a name='2878'>
<font color=#447700>!<a name='2879'></font>
<font color=#447700>!=======================================================================<a name='2880'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='2881'></font>
<font color=#447700>!! calculate rate of change in element thickness due to snow falling<a name='2882'></font>
<font color=#447700>!! Precip has just started or previous top node is full. Initiate a<a name='2883'></font>
<font color=#447700>!! new node.<a name='2884'></font>
<font color=#447700>!clwp  12/08/2000, since this subroutine only deals with the top layer,<a name='2885'></font>
<font color=#447700>!clwp  change the original AA(n) to AA, in other words replace arrays.<a name='2886'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='2887'></font>
      dzfall=prcp*rhowater/bifall<a name='2888'>
      dzo=dzo+dzfall<a name='2889'>
      wo=wo+prcp<a name='2890'>
      bwo=(wo*rhowater)/dzo<a name='2891'>
      cto=1.9e+6*(bwo/920.0)<a name='2892'>
      dum=(tkair-273.16)*cto*dzfall                       &amp;<a name='2893'>
              -(1.0-flfall)*(blfall+bifall)*dlm*dzfall<a name='2894'>
      ho=ho+dum<a name='2895'>
      dmlto=wo*rhowater*dlm<a name='2896'>
      if (ho.ge.-dmlto) then<a name='2897'>
	tssno=273.16<a name='2898'>
	fio=-ho/dmlto<a name='2899'>
	flo=1.0-fio<a name='2900'>
	blo=bwo*flo<a name='2901'>
	bio=bwo*fio<a name='2902'>
	dliqvol=blo/rhowater<a name='2903'>
	dicevol=bio/dice<a name='2904'>
      else<a name='2905'>
<font color=#447700>!!!!! when snow temperature is below 273.16<a name='2906'></font>
	fio=1.0<a name='2907'>
	flo=0.0<a name='2908'>
	bio=bwo<a name='2909'>
	blo=0.0<a name='2910'>
	dliqvol=0.0<a name='2911'>
        dicevol=bio/dice<a name='2912'>
	wf=0.0<a name='2913'>
	tssno=(ho+dmlto)/(cto*dzo)+273.16<a name='2914'>
      end if<a name='2915'>
<font color=#447700>!<a name='2916'></font>
<font color=#447700>!------------------------------------------------------<a name='2917'></font>
      END SUBROUTINE NEWSNOW<a name='2918'>
<font color=#447700>!------------------------------------------------------<a name='2919'></font>
<a name='2920'>
<font color=#447700>!=======================================================================<a name='2921'></font>
<font color=#447700>!                                                                       <a name='2922'></font>
<A NAME='NEWTON'><A href='../../html_code/phys/module_sf_ssib.F.html#NEWTON' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2923'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>NEWTON</font>(A1,Y,FINC,NOX,NONPOS,IWOLK,L,ZINC,A2,Y1,ITER) <A href='../../call_to/NEWTON.html' TARGET='index'>2</A><a name='2924'>
<font color=#447700>!<a name='2925'></font>
<font color=#447700>!=======================================================================<a name='2926'></font>
<font color=#447700>!<a name='2927'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2928'></font>
<font color=#447700>! ** VERSION ACQUIRED FROM EROS 2/19/86.<a name='2929'></font>
<font color=#447700>!<a name='2930'></font>
<font color=#447700>! ** THE NEWTON RAPHSON ITERATIVE ROUTINE WILL BE USED TO GENERATE NEW<a name='2931'></font>
<font color=#447700>! ** VALUES OF A1 IF DABSOLUTE VALUE OF Y IS GREATER THAN ERTOL;<a name='2932'></font>
<font color=#447700>! ** A1 IS ESTIMATE, Y IS RESULTANT ERROR<a name='2933'></font>
<font color=#447700>! ** NEX IS EXIT CONDITION  (0=NO EXIT) OR (1 WHEN DABS(Y) LT ERTOL)<a name='2934'></font>
<font color=#447700>! ** ERTOL IS THE DABSOLUTE VALUE OF Y NECESSARY TO OBTAIN AN EXIT<a name='2935'></font>
<font color=#447700>! ** FINC IS INITIAL INCREMENT SIZE FOR SECOND ESTIMATE OF A1<a name='2936'></font>
<font color=#447700>! ** NONPOS=0 IF QUANTITY TO BE MINIMIZED CAN BE LESS THAN ZERO;<a name='2937'></font>
<font color=#447700>! ** NONPOS=1 IF QUANTITY CAN ONLY BE POSITIVE<a name='2938'></font>
<font color=#447700>! ** L IDENTIFIES WHICH QUANTITY IS BEING CALCULATED.<a name='2939'></font>
<font color=#447700>!<a name='2940'></font>
<font color=#447700>! ** CONTROL VALUES: FINC,ERTOL,NOX,NONPOS,L:MUST BE SET BY USER<a name='2941'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2942'></font>
<font color=#447700>!<a name='2943'></font>
<font color=#447700>!fds Changes according to Jack (Feb/2008)<a name='2944'></font>
 REAL, DIMENSION (3) ::  IWALK, NEX, ITER<a name='2945'>
 REAL, DIMENSION (3) :: ZINC, A2, Y1<a name='2946'>
<a name='2947'>
<font color=#447700>!fds  DIMENSION  IWALK(3), NEX(3)<a name='2948'></font>
<font color=#447700>!fds  DIMENSION  ZINC(3), A2(3), Y1(3),ITER3(3)<a name='2949'></font>
       DATA CONS/1.0/<a name='2950'>
<font color=#447700>!<a name='2951'></font>
       ERTOL = 0.05 * FINC<a name='2952'>
       IWALK(L) = IWOLK<a name='2953'>
       NEX(L)=NOX<a name='2954'>
<font color=#447700>!<a name='2955'></font>
       IF ( ITER(L) .GE. 490 ) GO TO 160<a name='2956'>
       IF (ERTOL .LT. 0.00000001) ERTOL=0.000001<a name='2957'>
       IF (ABS(Y) .LE. ERTOL) GO TO 150<a name='2958'>
       IF((ABS(Y-Y1(L))).LE.0.01*ERTOL .AND. IWALK(L).EQ.0 ) GO TO 8<a name='2959'>
<font color=#447700>!<a name='2960'></font>
       IF(ABS(Y1(L)).GT.ERTOL) GO TO 1<a name='2961'>
       A2(L)=A1<a name='2962'>
       A1=A1-Y<a name='2963'>
       NEX(L)=0<a name='2964'>
       Y1(L)=Y<a name='2965'>
       ITER(L)=1<a name='2966'>
       IF (IWALK(L) .EQ. 3) GO TO 101<a name='2967'>
       IWALK(L)=0<a name='2968'>
       GO TO 101<a name='2969'>
   1   ITER(L)=ITER(L)+1<a name='2970'>
       IF(ITER(L) .EQ. 10) IWALK(L)=1<a name='2971'>
       IF(IWALK(L) .NE. 0) GO TO 2<a name='2972'>
       IF(ABS(Y) .GT. ERTOL) GO TO 3<a name='2973'>
       NEX(L)=1<a name='2974'>
       GO TO 150<a name='2975'>
   3   A=A1-Y*(A1-A2(L))/(Y-Y1(L))<a name='2976'>
       IF(ABS(A-A1).GT.(10.0*FINC))                   &amp;<a name='2977'>
                  A=A1+10.0*FINC*SIGN(CONS,(A-A1))<a name='2978'>
       A2(L)=A1<a name='2979'>
       A1=A<a name='2980'>
       Y1(L)=Y<a name='2981'>
       GO TO 101<a name='2982'>
   2   IF(IWALK(L).EQ.2)GO TO 4<a name='2983'>
       IF(IWALK(L).EQ.3) GO TO 6<a name='2984'>
       IF(SIGN(CONS,Y).EQ.SIGN(CONS,Y1(L))) GO TO  3<a name='2985'>
       ZINC(L)=(A1-A2(L))/4.0<a name='2986'>
       A1=A2(L)+ZINC(L)<a name='2987'>
       IWALK(L)=2<a name='2988'>
       NEX(L)=0<a name='2989'>
       GO TO 101<a name='2990'>
   4   IF(SIGN(CONS,Y) .EQ.SIGN(CONS,Y1(L))) GO TO 5<a name='2991'>
       ZINC(L)=-ZINC(L)/4.0<a name='2992'>
       A2(L)=A1<a name='2993'>
       A1=A1+ZINC(L)<a name='2994'>
       NEX(L)=0<a name='2995'>
       Y1(L)=Y<a name='2996'>
       GO TO 101<a name='2997'>
   5   A2(L)=A1<a name='2998'>
       A1=A1+ZINC(L)<a name='2999'>
       Y1(L)=Y<a name='3000'>
       NEX(L)=0<a name='3001'>
       GO TO 101<a name='3002'>
   6   IF(SIGN(CONS,Y).EQ.SIGN(CONS,Y1(L))) GO TO 7<a name='3003'>
       IWALK(L)=1<a name='3004'>
       GO TO 2<a name='3005'>
   7   A2(L) = A1<a name='3006'>
       A1 = A1+FINC<a name='3007'>
       Y1(L)=Y<a name='3008'>
       NEX(L) = 0<a name='3009'>
       GO TO 101<a name='3010'>
   8   A1 = A1 + FINC*2.0<a name='3011'>
       NEX(L)=0<a name='3012'>
       GO TO 101<a name='3013'>
 160   CONTINUE<a name='3014'>
 900   FORMAT ( 3X,' FAILURE TO CONVERGE AFTER 490 ITERATIONS',      &amp;<a name='3015'>
       /, 3X,' Y = ',2G12.5,2X,I14)<a name='3016'>
 150   NEX(L) = 1<a name='3017'>
       ZINC(L)=0.0<a name='3018'>
       ITER(L) = 0<a name='3019'>
       IWALK(L)=0<a name='3020'>
       Y1(L)=0.0<a name='3021'>
       Y=0.0<a name='3022'>
       A2(L)=0.0<a name='3023'>
 101   CONTINUE<a name='3024'>
       IF(NONPOS.EQ.1.AND.A1.LT.0.0) A1=A2(L)/2.0<a name='3025'>
       NOX = NEX(L)<a name='3026'>
       IWOLK = IWALK(L)<a name='3027'>
<font color=#447700>!<a name='3028'></font>
<font color=#447700>!------------------------------------------------------<a name='3029'></font>
      END SUBROUTINE NEWTON<a name='3030'>
<font color=#447700>!------------------------------------------------------<a name='3031'></font>
<a name='3032'>
<font color=#447700>!=======================================================================<a name='3033'></font>
<font color=#447700>!                                                                       <a name='3034'></font>
<A NAME='OLD'><A href='../../html_code/phys/module_sf_ssib.F.html#OLD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3035'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>OLD</font>(TSSN,BW,BL,BI,H,FL,FI,W,DZ,SS,CT,BT,DMLT,           &amp; <A href='../../call_to/OLD.html' TARGET='index'>1</A><a name='3036'>
                  TSSNO,BWO,BLO,BIO,HO,FLO,FIO,WO,DZO,SSO,CTO,BTO,DMLTO)<a name='3037'>
<font color=#447700>!<a name='3038'></font>
<font color=#447700>!=======================================================================<a name='3039'></font>
      DIMENSION TSSN(N1),BW(N1),BL(N1),BI(N1),H(N1),FL(N1),FI(N1),       &amp;<a name='3040'>
                W(N1),DZ(N1),SS(N1),CT(N1),BT(N1),DMLT(N1),  TSSNO(N1),  &amp;<a name='3041'>
                BWO(N1),BLO(N1),BIO(N1),HO(N1),FLO(N1),FIO(N1),          &amp;<a name='3042'>
                WO(N1),DZO(N1),SSO(N1),CTO(N1),BTO(N1),DMLTO(N1)<a name='3043'>
      DO 20 I=1,N<a name='3044'>
            TSSNO(I)=TSSN(I)<a name='3045'>
            BWO(I)=BW(I)<a name='3046'>
            BLO(I)=BL(I)<a name='3047'>
            BIO(I)=BI(I)<a name='3048'>
            HO(I)=H(I)<a name='3049'>
            FLO(I)=FL(I)<a name='3050'>
            FIO(I)=FI(I)<a name='3051'>
            WO(I)=W(I)<a name='3052'>
            DZO(I)=DZ(I)<a name='3053'>
            SSO(I)=SS(I)<a name='3054'>
            CTO(I)=CT(I)<a name='3055'>
            BTO(I)=BT(I)<a name='3056'>
            DMLTO(I)=DMLT(I)<a name='3057'>
 20   CONTINUE<a name='3058'>
<font color=#447700>!<a name='3059'></font>
<font color=#447700>!------------------------------------------------------<a name='3060'></font>
      END SUBROUTINE OLD<a name='3061'>
<font color=#447700>!------------------------------------------------------<a name='3062'></font>
<a name='3063'>
<font color=#447700>!=======================================================================<a name='3064'></font>
<font color=#447700>!                                                                       <a name='3065'></font>
<A NAME='RADAB'><A href='../../html_code/phys/module_sf_ssib.F.html#RADAB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3066'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>RADAB</font> (TRAN,REF,GREEN,VCOVER,CHIL,ZLAI,Z2,Z1,SOREF,TC,  &amp; <A href='../../call_to/RADAB.html' TARGET='index'>1</A><a name='3067'>
                 TGS,SATCAP,EXTK,RADFAC,THERMK,RADT,PAR,PD,ALBEDO,SALB,  &amp;<a name='3068'>
                 TGEFF,SUNANG,XADJ,CAPAC,RADN,ZLWUP,FRAC,                &amp;<a name='3069'>
                 ISNOW,SNOWDEN,SNOWDEPTH,SWDOWN,XALBEDO,SCOV2,ISICE,     &amp;<a name='3070'>
                 fsdown,fldown,fsup,flup)<a name='3071'>
<font color=#447700>!                                                          1 AUGUST 1988<a name='3072'></font>
<font color=#447700>!=======================================================================<a name='3073'></font>
<font color=#447700>!<a name='3074'></font>
<font color=#447700>!     CALCULATION OF ALBEDOS VIA TWO STREAM APPROXIMATION( DIRECT<a name='3075'></font>
<font color=#447700>!     AND DIFFUSE ) AND PARTITION OF RADIANT ENERGY<a name='3076'></font>
<font color=#447700>!<a name='3077'></font>
<font color=#447700>!cl  CLOSS=2.*VCOVER(1)*(1.-THERMK)*STEFAN*TC**4<a name='3078'></font>
<font color=#447700>!cl          -VCOVER(1)*(1.-THERMK)*STEFAN*TGS**4<a name='3079'></font>
<font color=#447700>!cl  GLOSS=STEFAN*TGS**4 - VCOVER(1)*(1.-THERMK)*STEFAN*TC**4<a name='3080'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3081'></font>
      DIMENSION TRANC1(2), TRANC2(2), TRANC3(2)<a name='3082'>
      DIMENSION CAPAC(2), SATCAP(2), TRAN(2,3,2), REF(2,3,2), SOREF(3)<a name='3083'>
      DIMENSION GREEN(2), VCOVER(2), ZLAI(2), CHIL(2), RADN(3,2),RADT(2)<a name='3084'>
      DIMENSION RADFAC(2,2,2), RADSAV(12), PAR(2), PD(2), ALBEDO(2,3,2)<a name='3085'>
      DIMENSION SALB(2,2), EXTK(2,3,2), FRAC(2,2)<a name='3086'>
      DIMENSION sr(2)<a name='3087'>
      data sr/0.85,0.65/<a name='3088'>
<font color=#447700>!     dimension sibalbedo(12,31,24),sibswup(12,31,24)<a name='3089'></font>
<font color=#447700>!<a name='3090'></font>
<font color=#447700>!crr   F = SUNANG<a name='3091'></font>
      f=max(sunang,0.01746)<a name='3092'>
<font color=#447700>!crr   ratko, 08/03/2004<a name='3093'></font>
<font color=#447700>!crr   xref1=1.20<a name='3094'></font>
<font color=#447700>!crr   xref2=0.40<a name='3095'></font>
      xref1=1.05<a name='3096'>
      xref2=0.20<a name='3097'>
<font color=#447700>!<a name='3098'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3099'></font>
<font color=#447700>!     CALCULATION OF MAXIMUM WATER STORAGE VALUES.<a name='3100'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3101'></font>
<font color=#447700>!<a name='3102'></font>
      FMELT = 1.<a name='3103'>
      IF ( ABS(TF-TGS) .LT. 0.5 ) FMELT = 0.6<a name='3104'>
      SATCAP(1) =  ZLAI(1) * 0.0001<a name='3105'>
      SATCAP(2) =  ZLAI(2) * 0.0001<a name='3106'>
<font color=#447700>!CS-------------------------  Sun change following DEPCOV     10/13/98<a name='3107'></font>
      IF (ISNOW.eq.0) THEN<a name='3108'>
         DEPCOV = AMAX1( 0., (SNOWDEPTH-Z1))<a name='3109'>
      ELSE<a name='3110'>
         DEPCOV = AMAX1( 0., (CAPAC(2)*SNOWDEN-Z1))<a name='3111'>
      END IF<a name='3112'>
<font color=#447700>!CS-----------------------------------------------------------10/13/98<a name='3113'></font>
      DEPCOV = AMIN1( DEPCOV, (Z2-Z1)*0.95 )<a name='3114'>
      SATCAP(1) = SATCAP(1) * ( 1. - DEPCOV / ( Z2 - Z1 ) )<a name='3115'>
<font color=#447700>!crr - thermal part is in use in temrs1 &amp; temrs2<a name='3116'></font>
      do 202 iveg  = 1, 2<a name='3117'>
      do 202 iwave = 1, 3<a name='3118'>
      do 202 irad  = 1, 2<a name='3119'>
      albedo(iveg,iwave,irad)=0.<a name='3120'>
 202  continue<a name='3121'>
<font color=#447700>!crr<a name='3122'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3123'></font>
<font color=#447700>!<a name='3124'></font>
      DO 1000 IWAVE = 1, 2<a name='3125'>
<font color=#447700>!<a name='3126'></font>
      DO 2000 IVEG  = 2, 1,-1<a name='3127'>
<font color=#447700>!----------------------------------------------------------------------<a name='3128'></font>
<font color=#447700>!     MODIFICATION FOR EFFECT OF SNOW ON UPPER STOREY ALBEDO<a name='3129'></font>
<font color=#447700>!         SNOW REFLECTANCE   = 0.80, 0.40 . MULTIPLY BY 0.6 IF MELTING<a name='3130'></font>
<font color=#447700>!         SNOW TRANSMITTANCE = 0.20, 0.54<a name='3131'></font>
<font color=#447700>!crr  snow reflectance now 0.85, 0.65 (see xref1, xref2)<a name='3132'></font>
<font color=#447700>!<a name='3133'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3134'></font>
      SCOV = 0.<a name='3135'>
      IF( IVEG .EQ. 2 ) GO TO 100<a name='3136'>
      IF( TC .LE. TF ) SCOV =  AMIN1( 0.5, CAPAC(1) / SATCAP(1) )<a name='3137'>
100   CONTINUE<a name='3138'>
      REFF1 = ( 1. - SCOV ) * REF(IVEG,IWAVE,1) + SCOV * ( xref1 -      &amp;<a name='3139'>
              IWAVE * xref2 ) * FMELT<a name='3140'>
      REFF2 = ( 1. - SCOV ) * REF(IVEG,IWAVE,2) + SCOV * ( xref1 -      &amp;<a name='3141'>
              IWAVE * xref2 ) * FMELT<a name='3142'>
      TRAN1 = TRAN(IVEG,IWAVE,1) * ( 1. - SCOV )                        &amp;<a name='3143'>
              + SCOV * ( 1.- ( xref1 - IWAVE * xref2 ) * FMELT )        &amp;<a name='3144'>
              * TRAN(IVEG,IWAVE,1)<a name='3145'>
      TRAN2 = TRAN(IVEG,IWAVE,2) * ( 1. - SCOV )                        &amp;<a name='3146'>
              + SCOV * ( 1.- ( xref1 - IWAVE * xref2 ) * FMELT ) * 0.9  &amp;<a name='3147'>
              * TRAN(IVEG,IWAVE,2)<a name='3148'>
<font color=#447700>!<a name='3149'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3150'></font>
<font color=#447700>!<a name='3151'></font>
      SCAT = GREEN(IVEG)*( TRAN1 + REFF1 ) +( 1. - GREEN(IVEG) ) *      &amp;<a name='3152'>
             ( TRAN2 + REFF2)<a name='3153'>
      CHIV = CHIL(IVEG)<a name='3154'>
<font color=#447700>!<a name='3155'></font>
      IF ( ABS(CHIV) .LE. 0.01 ) CHIV = 0.01<a name='3156'>
      AA = 0.5 - 0.633 * CHIV - 0.33 * CHIV * CHIV<a name='3157'>
      BB = 0.877 * ( 1. - 2. * AA )<a name='3158'>
<font color=#447700>!<a name='3159'></font>
      PROJ = AA + BB * F<a name='3160'>
      EXTKB = ( AA + BB * F ) / F<a name='3161'>
      ZMEW = 1. / BB * ( 1. - AA / BB * ALOG ( ( AA + BB ) / AA ) )<a name='3162'>
      ACSS = SCAT / 2. * PROJ / ( PROJ + F * BB )<a name='3163'>
      ACSS = ACSS * ( 1. - F * AA / ( PROJ + F * BB ) * ALOG ( ( PROJ   &amp;<a name='3164'>
             +   F * BB + F * AA ) / ( F * AA ) ) )<a name='3165'>
<font color=#447700>!<a name='3166'></font>
      EXTK( IVEG, IWAVE, 1 ) = PROJ / F * SQRT( 1.-SCAT )<a name='3167'>
      EXTK( IVEG, IWAVE, 2 ) = 1. / ZMEW * SQRT( 1.-SCAT )<a name='3168'>
      EXTK( IVEG, 3, 1 ) = AA + BB<a name='3169'>
      EXTK( IVEG, 3, 2 ) = 1./ZMEW<a name='3170'>
<font color=#447700>!<a name='3171'></font>
      UPSCAT = GREEN(IVEG) * TRAN1 + ( 1. - GREEN(IVEG) ) * TRAN2<a name='3172'>
      UPSCAT = 0.5 * ( SCAT + ( SCAT - 2. * UPSCAT ) *         &amp;<a name='3173'>
               (( 1. - CHIV ) / 2. ) ** 2 )<a name='3174'>
<font color=#447700>!<a name='3175'></font>
      BETAO = ( 1. + ZMEW * EXTKB ) / ( SCAT * ZMEW * EXTKB ) * ACSS<a name='3176'>
<font color=#447700>!<a name='3177'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3178'></font>
<font color=#447700>!<a name='3179'></font>
<font color=#447700>!     DICKINSON'S VALUES<a name='3180'></font>
<font color=#447700>!<a name='3181'></font>
      BE = 1. - SCAT + UPSCAT<a name='3182'>
      CE = UPSCAT<a name='3183'>
      BOT = ( ZMEW * EXTKB ) ** 2 + ( CE**2 - BE**2 )<a name='3184'>
      IF ( ABS(BOT) .GT. 1.E-10) GO TO 200<a name='3185'>
      SCAT = SCAT* 0.98<a name='3186'>
      BE = 1. - SCAT + UPSCAT<a name='3187'>
      BOT = ( ZMEW * EXTKB ) ** 2 + ( CE**2 - BE**2 )<a name='3188'>
200   CONTINUE<a name='3189'>
      DE = SCAT * ZMEW * EXTKB * BETAO<a name='3190'>
      FE = SCAT * ZMEW * EXTKB * ( 1. - BETAO )<a name='3191'>
<font color=#447700>!----------------------------------------------------------------------<a name='3192'></font>
<font color=#447700>!<a name='3193'></font>
      CCE = DE * BE - ZMEW * DE * EXTKB + CE * FE<a name='3194'>
      FFE = BE * FE + ZMEW * FE * EXTKB + CE * DE<a name='3195'>
<font color=#447700>!<a name='3196'></font>
      TORE = -CCE / BOT<a name='3197'>
      SIGE = -FFE / BOT<a name='3198'>
<font color=#447700>!<a name='3199'></font>
      PSI = SQRT(BE**2 - CE**2)/ZMEW<a name='3200'>
<font color=#447700>!<a name='3201'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3202'></font>
<font color=#447700>!     REDUCTION IN EXPOSED HEIGHT OF UPPER STOREY AS SNOW ACCUMULATES<a name='3203'></font>
<font color=#447700>!<a name='3204'></font>
<font color=#447700>!CS Sun Change following SDEP to SDEP=snowdepth on 10/13/98<a name='3205'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='3206'></font>
      IF (ISNOW.eq.0) THEN<a name='3207'>
          SDEP=SNOWDEPTH<a name='3208'>
      ELSE<a name='3209'>
          SDEP = CAPAC(2) *SNOWDEN<a name='3210'>
      END IF<a name='3211'>
<font color=#447700>!CS<a name='3212'></font>
      FAC = ( SDEP - Z1 ) / ( Z2 - Z1 )<a name='3213'>
      FAC = AMAX1( 0., FAC )<a name='3214'>
      FAC = AMIN1( 0.99, FAC )<a name='3215'>
<font color=#447700>!<a name='3216'></font>
      ZAT = ZLAI(IVEG) / VCOVER(IVEG)<a name='3217'>
      IF ( IVEG .EQ. 1 ) ZAT = ZAT * (1.-FAC)<a name='3218'>
<font color=#447700>!<a name='3219'></font>
      POWER1 = AMIN1( PSI*ZAT, 50. )<a name='3220'>
      POWER2 = AMIN1( EXTKB*ZAT, 50. )<a name='3221'>
      EPSI = EXP( - POWER1 )<a name='3222'>
      EK = EXP ( - POWER2 )<a name='3223'>
<font color=#447700>!<a name='3224'></font>
          ROSB = SOREF(IWAVE)<a name='3225'>
          ROSD = SOREF(IWAVE)<a name='3226'>
      IF ( IVEG .EQ. 2 ) GO TO 300<a name='3227'>
      ROSB = ALBEDO(2,IWAVE,1)<a name='3228'>
      ROSD = ALBEDO(2,IWAVE,2)<a name='3229'>
300   CONTINUE<a name='3230'>
<font color=#447700>!<a name='3231'></font>
      GE = ROSB / ROSD<a name='3232'>
<font color=#447700>!<a name='3233'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3234'></font>
<font color=#447700>!     CALCULATION OF DIFFUSE ALBEDOS<a name='3235'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3236'></font>
<font color=#447700>!<a name='3237'></font>
      F1 = BE - CE / ROSD<a name='3238'>
      ZP = ZMEW * PSI<a name='3239'>
<font color=#447700>!<a name='3240'></font>
      DEN = ( BE + ZP ) * ( F1 - ZP ) / EPSI -  &amp;<a name='3241'>
            ( BE - ZP ) * ( F1 + ZP ) * EPSI<a name='3242'>
      ALPHA = CE * ( F1 - ZP ) / EPSI / DEN<a name='3243'>
      BETA = -CE * ( F1 + ZP ) * EPSI / DEN<a name='3244'>
      F1 = BE - CE * ROSD<a name='3245'>
      DEN = ( F1 + ZP ) / EPSI - ( F1 - ZP ) * EPSI<a name='3246'>
<font color=#447700>!<a name='3247'></font>
      GAMMA = ( F1 + ZP ) / EPSI / DEN<a name='3248'>
      DELTA = - ( F1 - ZP ) * EPSI / DEN<a name='3249'>
<font color=#447700>!<a name='3250'></font>
      ALBEDO(IVEG,IWAVE,2) =  ALPHA + BETA<a name='3251'>
<font color=#447700>!     XQQ(IVEG,IWAVE,2) = ALBEDO(IVEG, IWAVE, 2)<a name='3252'></font>
<font color=#447700>!<a name='3253'></font>
      IF ( IVEG .EQ. 1 ) GO TO 400<a name='3254'>
      SCOV2 = 0.<a name='3255'>
      IF ( TGS .LE. TF ) SCOV2 = AMIN1( 1., CAPAC(2) / 0.004 )<a name='3256'>
<font color=#447700>!crr   CORRECTION FOR KEEPING ALBEDO HIGH OVER SNOW<a name='3257'></font>
      IF (ISICE.EQ.1) SCOV2=1.<a name='3258'>
<font color=#447700>!crr<a name='3259'></font>
      ALBEDO(2,IWAVE,2) =                                            &amp;<a name='3260'>
       ROSD * ( 1. - VCOVER(2) ) + ALBEDO(2,IWAVE,2) * VCOVER(2)<a name='3261'>
      ALBEDO(2,IWAVE,2) =                                            &amp;<a name='3262'>
       ( 1. - SCOV2 ) * ALBEDO(2,IWAVE,2) + SCOV2 *                  &amp;<a name='3263'>
       ( xref1-IWAVE*xref2 ) *                                       &amp;<a name='3264'>
       FMELT<a name='3265'>
400   CONTINUE<a name='3266'>
<font color=#447700>!<a name='3267'></font>
      TRANC2(IWAVE) = GAMMA * EPSI + DELTA / EPSI<a name='3268'>
<font color=#447700>!<a name='3269'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3270'></font>
<font color=#447700>!     CALCULATION OF DIRECT ALBEDOS<a name='3271'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3272'></font>
<font color=#447700>!<a name='3273'></font>
      F1 = BE - CE / ROSD<a name='3274'>
      ZMK = ZMEW * EXTKB<a name='3275'>
<font color=#447700>!<a name='3276'></font>
      DEN = ( BE + ZP ) * ( F1 - ZP ) / EPSI -                        &amp;<a name='3277'>
            ( BE - ZP ) * ( F1 + ZP ) * EPSI<a name='3278'>
      ALPHA = ( DE - TORE * ( BE + ZMK ) ) * ( F1 - ZP ) / EPSI -     &amp;<a name='3279'>
              ( BE - ZP ) * ( DE - CE*GE - TORE * ( F1 + ZMK ) ) * EK<a name='3280'>
      ALPHA = ALPHA / DEN<a name='3281'>
      BETA = ( BE + ZP ) * (DE - CE*GE - TORE * ( F1 + ZMK ))* EK -   &amp;<a name='3282'>
             ( DE - TORE * ( BE + ZMK ) ) * ( F1 + ZP ) * EPSI<a name='3283'>
      BETA = BETA / DEN<a name='3284'>
      F1 = BE - CE * ROSD<a name='3285'>
      DEN = ( F1 + ZP ) / EPSI - ( F1 - ZP ) * EPSI<a name='3286'>
      GAMMA = - SIGE * ( F1 + ZP ) / EPSI -                           &amp;<a name='3287'>
              ( FE + CE * GE * ROSD + SIGE * ( ZMK - F1 ) ) * EK<a name='3288'>
      GAMMA = GAMMA / DEN<a name='3289'>
      DELTA = ( CE * GE * ROSD + FE + SIGE * ( ZMK - F1 ) ) * EK      &amp;<a name='3290'>
              + SIGE * ( F1 - ZP ) * EPSI<a name='3291'>
      DELTA = DELTA / DEN<a name='3292'>
<font color=#447700>!<a name='3293'></font>
      ALBEDO(IVEG,IWAVE,1) = TORE + ALPHA + BETA<a name='3294'>
<font color=#447700>!     XQQ(IVEG,IWAVE,1) = ALBEDO(IVEG, IWAVE, 1)<a name='3295'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3296'></font>
<font color=#447700>!<a name='3297'></font>
      IF( IVEG .EQ. 1 ) GO TO 500<a name='3298'>
      ALBEDO(2,IWAVE,1) = ROSB * ( 1. - VCOVER(2) )                   &amp;<a name='3299'>
                          + ALBEDO(2,IWAVE,1) * VCOVER(2)<a name='3300'>
      ALBEDO(2,IWAVE,1) = ( 1. - SCOV2 ) * ALBEDO(2,IWAVE,1) +        &amp;<a name='3301'>
                          SCOV2 * ( xref1-IWAVE*xref2 ) * FMELT<a name='3302'>
<font color=#447700>!<a name='3303'></font>
500   CONTINUE<a name='3304'>
<font color=#447700>!<a name='3305'></font>
      TRANC1(IWAVE) = EK<a name='3306'>
      TRANC3(IWAVE) = SIGE * EK + GAMMA * EPSI + DELTA / EPSI<a name='3307'>
<font color=#447700>!<a name='3308'></font>
2000  CONTINUE<a name='3309'>
<font color=#447700>!----------------------------------------------------------------------<a name='3310'></font>
<font color=#447700>!     CALCULATION OF TERMS WHICH MULTIPLY INCOMING SHORT WAVE FLUXES<a name='3311'></font>
<font color=#447700>!     TO GIVE ABSORPTION OF RADIATION BY CANOPY AND GROUND<a name='3312'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3313'></font>
<font color=#447700>!<a name='3314'></font>
      RADFAC(2,IWAVE,1) = ( 1.-VCOVER(1) ) * ( 1.-ALBEDO(2,IWAVE,1) )  &amp;<a name='3315'>
             + VCOVER(1) * ( TRANC1(IWAVE) * ( 1.-ALBEDO(2,IWAVE,1) )  &amp;<a name='3316'>
             + TRANC3(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3317'>
<font color=#447700>!<a name='3318'></font>
      RADFAC(2,IWAVE,2) = ( 1.-VCOVER(1) ) * ( 1.-ALBEDO(2,IWAVE,2) )  &amp;<a name='3319'>
             + VCOVER(1) *  TRANC2(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) )<a name='3320'>
<font color=#447700>!<a name='3321'></font>
      RADFAC(1,IWAVE,1) = VCOVER(1) * ( ( 1.-ALBEDO(1,IWAVE,1) )       &amp;<a name='3322'>
             - TRANC1(IWAVE) * ( 1.-ALBEDO(2,IWAVE,1) )                &amp;<a name='3323'>
             - TRANC3(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3324'>
<font color=#447700>!<a name='3325'></font>
      RADFAC(1,IWAVE,2) = VCOVER(1) * ( ( 1.-ALBEDO(1,IWAVE,2) )       &amp;<a name='3326'>
             - TRANC2(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3327'>
<font color=#447700>!<a name='3328'></font>
<font color=#447700>!     XQQ(1,IWAVE,1) = RADFAC(1,IWAVE,1)<a name='3329'></font>
<font color=#447700>!     XQQ(1,IWAVE,2) = RADFAC(1,IWAVE,2)<a name='3330'></font>
<font color=#447700>!     XQQ(2,IWAVE,1) = RADFAC(2,IWAVE,1)<a name='3331'></font>
<font color=#447700>!     XQQ(2,IWAVE,2) = RADFAC(2,IWAVE,2)<a name='3332'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3333'></font>
<font color=#447700>!     CALCULATION OF TOTAL SURFACE ALBEDOS ( SALB )<a name='3334'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3335'></font>
<font color=#447700>!<a name='3336'></font>
      DO 3000 IRAD = 1, 2<a name='3337'>
      SALB(IWAVE,IRAD) = ( 1.-VCOVER(1) ) * ALBEDO(2,IWAVE,IRAD) +   &amp;<a name='3338'>
                         VCOVER(1) * ALBEDO(1,IWAVE,IRAD)<a name='3339'>
3000  CONTINUE<a name='3340'>
<font color=#447700>!----------------------------------------------------------------------<a name='3341'></font>
<font color=#447700>!     SAVING OF EXTINCTION COEFFICIENTS ( PAR ) FOR STOMAT CALCULATION<a name='3342'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3343'></font>
      IF ( IWAVE .EQ. 2 ) GO TO 600<a name='3344'>
      RADSAV(1) = 1. - VCOVER(1)                                     &amp;<a name='3345'>
                + VCOVER(1) * ( TRANC1(IWAVE) + TRANC3(IWAVE) )<a name='3346'>
      RADSAV(2) = 1. - VCOVER(1) + VCOVER(1) * TRANC2(IWAVE)<a name='3347'>
<font color=#447700>!     XQQ(1,1,1) = RADSAV(1)<a name='3348'></font>
<font color=#447700>!     XQQ(1,2,1) = RADSAV(2)<a name='3349'></font>
600   CONTINUE<a name='3350'>
<font color=#447700>!<a name='3351'></font>
1000  CONTINUE<a name='3352'>
<font color=#447700>!<a name='3353'></font>
<font color=#447700>!     albedo adjustment ==============================================<a name='3354'></font>
      if (xadj.eq.0.) go to 730<a name='3355'>
      xx = radfac(1,1,2) + radsav(2)<a name='3356'>
      xy = radfac(1,1,1) + radsav(1)<a name='3357'>
      ssum = salb(1,1)*frac(1,1) + salb(1,2)*frac(1,2)+             &amp;<a name='3358'>
             salb(2,1)*frac(2,1) + salb(2,2)*frac(2,2)<a name='3359'>
<font color=#447700>!     for diffuse albedo<a name='3360'></font>
      do 650 iwave = 1, 2<a name='3361'>
      salb(iwave,2) = salb(iwave,2) + xadj * salb(iwave,2) / ssum<a name='3362'>
      x0 = 1. - salb(iwave,2)<a name='3363'>
      x1 = radfac(1,iwave,2) + radfac(2,iwave,2)<a name='3364'>
      x2 = radfac(1,iwave,2) / x1<a name='3365'>
      x3 = radfac(2,iwave,2) / x1<a name='3366'>
      radfac(1,iwave,2) = x0 * x2<a name='3367'>
      radfac(2,iwave,2) = x0 * x3<a name='3368'>
 650  continue<a name='3369'>
 640  format(1x,'unrealistic value, dif',2i12,4e11.4)<a name='3370'>
<font color=#447700>!     for direct albedo<a name='3371'></font>
      do 750 iwave = 1, 2<a name='3372'>
      salb(iwave,1) = salb(iwave,1) + xadj * salb(iwave,1) / ssum<a name='3373'>
      x0 = 1. - salb(iwave,1)<a name='3374'>
      x1 = radfac(1,iwave,1) + radfac(2,iwave,1)<a name='3375'>
      x2 = radfac(1,iwave,1) / x1<a name='3376'>
      x3 = radfac(2,iwave,1) / x1<a name='3377'>
      radfac(1,iwave,1) = x0 * x2<a name='3378'>
      radfac(2,iwave,1) = x0 * x3<a name='3379'>
      radsav(1) =  xy - radfac(1,1,1)<a name='3380'>
      radsav(2) =  xx - radfac(1,1,2)<a name='3381'>
 750  continue<a name='3382'>
 740  format(1x,'unrealistic value',2i12,4e11.4)<a name='3383'>
 730  continue<a name='3384'>
<font color=#447700>!--------------- end adjustment ------------------------------<a name='3385'></font>
<font color=#447700>!cl  2001,1,26  remove the following lines<a name='3386'></font>
<font color=#447700>!     sibswup(nmm,ndd,nhh) = radn(1,1)*salb(1,1) + radn(1,2)*salb(1,2)<a name='3387'></font>
<font color=#447700>!    &amp;                     + radn(2,1)*salb(2,1) + radn(2,2)*salb(2,2)<a name='3388'></font>
<font color=#447700>!     if ((swdown.gt.0.1).and.(sibswup(nmm,ndd,nhh).gt.0.1)) then<a name='3389'></font>
<font color=#447700>!        sibalbedo(nmm,ndd,nhh) = sibswup(nmm,ndd,nhh) / swdown<a name='3390'></font>
<font color=#447700>!        if (sibalbedo(nmm,ndd,nhh).gt.1.) then<a name='3391'></font>
<font color=#447700>!           sibswup(nmm,ndd,nhh) =  0.<a name='3392'></font>
<font color=#447700>!           sibalbedo(nmm,ndd,nhh) = 999.<a name='3393'></font>
<font color=#447700>!         write (6, *) 'albebo incorrect',nymdh,sibalbedo(nmm,ndd,nhh)<a name='3394'></font>
<font color=#447700>!        endif<a name='3395'></font>
<font color=#447700>!     else<a name='3396'></font>
<font color=#447700>!        sibswup(nmm,ndd,nhh) = 0.0<a name='3397'></font>
<font color=#447700>!        sibalbedo(nmm,ndd,nhh) = 999.<a name='3398'></font>
<font color=#447700>!     endif<a name='3399'></font>
       swup = radn(1,1)*salb(1,1) + radn(1,2)*salb(1,2)             &amp;<a name='3400'>
            + radn(2,1)*salb(2,1) + radn(2,2)*salb(2,2)<a name='3401'>
      if ((swdown.gt.0.01).and.(swup.gt.0.01)) then<a name='3402'>
         xalbedo = swup / swdown<a name='3403'>
         if (xalbedo.gt.1.) then<a name='3404'>
            swup =  0.<a name='3405'>
            xalbedo = 999.<a name='3406'>
          write (6, *) 'albebo incorrect',xalbedo<a name='3407'>
         endif<a name='3408'>
      else<a name='3409'>
         swup = 0.0<a name='3410'>
         xalbedo = .1<a name='3411'>
      endif<a name='3412'>
<font color=#447700>!----------------------------------------------------------------------<a name='3413'></font>
<font color=#447700>!     CALCULATION OF LONG-WAVE FLUX TERMS FROM CANOPY AND GROUND<a name='3414'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3415'></font>
<font color=#447700>!<a name='3416'></font>
      TC4 = TC * TC * TC * TC<a name='3417'>
      TG4 = TGS * TGS * TGS * TGS<a name='3418'>
<font color=#447700>!<a name='3419'></font>
      ZKAT = EXTK(1,3,2) * ZLAI(1) / VCOVER(1)<a name='3420'>
      ZKAT = AMIN1( 50. , ZKAT )<a name='3421'>
      ZKAT = AMAX1( 1.E-5, ZKAT )<a name='3422'>
      THERMK = EXP(-ZKAT)<a name='3423'>
<font color=#447700>!<a name='3424'></font>
      FAC1 =  VCOVER(1) * ( 1.-THERMK )<a name='3425'>
      FAC2 =  1.<a name='3426'>
      CLOSS =  2. * FAC1 * STEFAN * TC4<a name='3427'>
      CLOSS =  CLOSS - FAC2 * FAC1 * STEFAN * TG4<a name='3428'>
      GLOSS =  FAC2 * STEFAN * TG4<a name='3429'>
      GLOSS =  GLOSS - FAC1 * FAC2 * STEFAN * TC4<a name='3430'>
<font color=#447700>!<a name='3431'></font>
      ZLWUP =  FAC1 * STEFAN * TC4 + (1. - FAC1 ) * FAC2 * STEFAN * TG4<a name='3432'>
      TGEFF = SQRT( SQRT ( ( ZLWUP / STEFAN ) ) )<a name='3433'>
<font color=#447700>!<a name='3434'></font>
      RADSAV(3) = EXTK(1,1,1)<a name='3435'>
      RADSAV(4) = EXTK(1,1,2)<a name='3436'>
      RADSAV(5) = EXTK(2,1,1)<a name='3437'>
      RADSAV(6) = EXTK(2,1,2)<a name='3438'>
      RADSAV(7) = THERMK<a name='3439'>
      RADSAV(8) = EXTK(1,3,1)<a name='3440'>
      RADSAV(9) = EXTK(2,3,1)<a name='3441'>
      RADSAV(10)= CLOSS<a name='3442'>
      RADSAV(11)= GLOSS<a name='3443'>
      RADSAV(12)= TGEFF<a name='3444'>
<font color=#447700>!-----------------------------------------------------------------------<a name='3445'></font>
<font color=#447700>!<a name='3446'></font>
<font color=#447700>!cl    CALL LONGRN( TRANC1, TRANC2, TRANC3)<a name='3447'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3448'></font>
<font color=#447700>!<a name='3449'></font>
<font color=#447700>!cl    CALL RADUSE<a name='3450'></font>
<font color=#447700>!---------------------------- subroutine RADUSE -----------------------<a name='3451'></font>
<font color=#447700>!<a name='3452'></font>
<font color=#447700>!     CALCULATION OF ABSORPTION OF RADIATION BY SURFACE<a name='3453'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3454'></font>
      P1F         = RADSAV(1)<a name='3455'>
      P2F         = RADSAV(2)<a name='3456'>
<font color=#447700>!cl 2001,1,26, redundant to the above lines<a name='3457'></font>
<font color=#447700>!cl   EXTK(1,1,1) = RADSAV(3)<a name='3458'></font>
<font color=#447700>!     EXTK(1,1,2) = RADSAV(4)<a name='3459'></font>
<font color=#447700>!     EXTK(2,1,1) = RADSAV(5)<a name='3460'></font>
<font color=#447700>!     EXTK(2,1,2) = RADSAV(6)<a name='3461'></font>
<font color=#447700>!     THERMK      = RADSAV(7)<a name='3462'></font>
<font color=#447700>!     EXTK(1,3,1) = RADSAV(8)<a name='3463'></font>
<font color=#447700>!     EXTK(2,3,1) = RADSAV(9)<a name='3464'></font>
<font color=#447700>!     CLOSS       = RADSAV(10)<a name='3465'></font>
<font color=#447700>!     GLOSS       = RADSAV(11)<a name='3466'></font>
<font color=#447700>!cl   TGEFF       = RADSAV(12)<a name='3467'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3468'></font>
<font color=#447700>!<a name='3469'></font>
<font color=#447700>!     SUMMATION OF SHORT-WAVE RADIATION ABSORBED BY CANOPY AND GROUND<a name='3470'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3471'></font>
      RADT(1) = 0.<a name='3472'>
      RADT(2) = 0.<a name='3473'>
<font color=#447700>!<a name='3474'></font>
      DO 7000 IVEG  = 1, 2<a name='3475'>
      DO 7000 IWAVE = 1, 2<a name='3476'>
      DO 7000 IRAD  = 1, 2<a name='3477'>
<font color=#447700>!<a name='3478'></font>
      RADT(IVEG) = RADT(IVEG)+RADFAC(IVEG,IWAVE,IRAD)*RADN(IWAVE,IRAD)<a name='3479'>
<font color=#447700>!<a name='3480'></font>
7000  CONTINUE<a name='3481'>
<font color=#447700>!=========================================================================<a name='3482'></font>
      fsdown = radn(1,1)+radn(1,2)+radn(2,1)+radn(2,2)<a name='3483'>
      fsup   = fsdown-radt(1)-radt(2)<a name='3484'>
<font color=#447700>!=========================================================================<a name='3485'></font>
<font color=#447700>!<a name='3486'></font>
      SWCAN=RADT(1)<a name='3487'>
      SWGND=RADT(2)<a name='3488'>
      RADT(1) = RADT(1) + RADN(3,2)*VCOVER(1)*(1.- THERMK)             &amp;<a name='3489'>
              - CLOSS<a name='3490'>
      RADT(2) = RADT(2) + RADN(3,2)*( 1.-VCOVER(1)*(1-THERMK) )        &amp;<a name='3491'>
              - GLOSS<a name='3492'>
<font color=#447700>!=========================================================================<a name='3493'></font>
      fldown = radn(3,2)<a name='3494'>
      flup   = closs+gloss<a name='3495'>
<font color=#447700>!=========================================================================<a name='3496'></font>
<font color=#447700>!<a name='3497'></font>
      PAR(1) = RADN(1,1) + RADN(1,2) + 0.001<a name='3498'>
      PD(1) = ( RADN(1,1) + 0.001 ) / PAR(1)<a name='3499'>
      P1 = P1F * RADN(1,1) + 0.001<a name='3500'>
      P2 = P2F * RADN(1,2)<a name='3501'>
      PAR(2) = P1 + P2<a name='3502'>
      PD(2) = P1 / PAR(2)<a name='3503'>
<font color=#447700>!<a name='3504'></font>
<font color=#447700>!------------------------------------------------------<a name='3505'></font>
      END SUBROUTINE RADAB<a name='3506'>
<font color=#447700>!------------------------------------------------------<a name='3507'></font>
<font color=#447700>!=======================================================================<a name='3508'></font>
<font color=#447700>!<a name='3509'></font>
<A NAME='RADAB_ICE'><A href='../../html_code/phys/module_sf_ssib.F.html#RADAB_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3510'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>RADAB_ICE</font>(TRAN,REF,GREEN,VCOVER,CHIL,ZLT,Z2,Z1,SOREF, &amp; <A href='../../call_to/RADAB_ICE.html' TARGET='index'>1</A><a name='3511'>
           TC,TGS,SATCAP,EXTK,CLOSS,GLOSS,THERMK,P1F,P2F,          &amp;<a name='3512'>
           RADT,PAR,PD,SALB,ALBEDO,TGEFF,SUNANG,XADJ,CAPAC,        &amp;<a name='3513'>
           RADN,bedo,ZLWUP,RADFRAC,SWDOWN,SCOV2,ISICE,             &amp;<a name='3514'>
           fsdown,fldown,fsup,flup)<a name='3515'>
<font color=#447700>!                                                         11 AUGUST 2000<a name='3516'></font>
<font color=#447700>!=======================================================================<a name='3517'></font>
<font color=#447700>!<a name='3518'></font>
<font color=#447700>!     CALCULATION OF ALBEDOS VIA TWO STREAM APPROXIMATION( DIRECT<a name='3519'></font>
<font color=#447700>!     AND DIFFUSE ) AND PARTITION OF RADIANT ENERGY<a name='3520'></font>
<font color=#447700>!<a name='3521'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3522'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3523'></font>
<a name='3524'>
 REAL, DIMENSION (2)     :: TRANC1, TRANC2, TRANC3, CAPAC, SATCAP, &amp;<a name='3525'>
                            GREEN, VCOVER, ZLT, CHIL, RADT, PAR, PD<a name='3526'>
 REAL, DIMENSION (3)     :: SOREF<a name='3527'>
 REAL, DIMENSION (2,2)   :: RADFRAC, SALB<a name='3528'>
 REAL, DIMENSION (3,2)   :: RADN<a name='3529'>
 REAL, DIMENSION (2,2,2) :: RADFAC<a name='3530'>
 REAL, DIMENSION (2,3,2) :: TRAN, REF, ALBEDO, EXTK<a name='3531'>
 REAL, DIMENSION (12)    :: RADSAV<a name='3532'>
<font color=#447700>!<a name='3533'></font>
      f=max(sunang,0.01746)<a name='3534'>
<font color=#447700>!<a name='3535'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3536'></font>
<font color=#447700>!     CALCULATION OF MAXIMUM WATER STORAGE VALUES.<a name='3537'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3538'></font>
<font color=#447700>!<a name='3539'></font>
      FMELT = 1.<a name='3540'>
      IF ( ABS(TF-TGS) .LT. 0.5 ) FMELT = 0.6<a name='3541'>
      SATCAP(1) =  ZLT(1) * 0.0001<a name='3542'>
      SATCAP(2) =  ZLT(2) * 0.0001<a name='3543'>
      DEPCOV = AMAX1( 0., (CAPAC(2)*5.-Z1) )<a name='3544'>
      DEPCOV = AMIN1( DEPCOV, (Z2-Z1)*0.95 )<a name='3545'>
      SATCAP(1) = SATCAP(1) * ( 1. - DEPCOV / ( Z2 - Z1 ) )<a name='3546'>
<font color=#447700>!----------------------------------------------------------------------<a name='3547'></font>
      do 202 iveg  = 1, 2<a name='3548'>
      do 202 iwave = 1, 3<a name='3549'>
      do 202 irad  = 1, 2<a name='3550'>
      albedo(iveg,iwave,irad)=0.<a name='3551'>
 202  continue<a name='3552'>
<font color=#447700>!----------------------------------------------------------------------<a name='3553'></font>
      DO 1000 IWAVE = 1,2<a name='3554'>
<font color=#447700>!<a name='3555'></font>
      DO 2000 IVDUM = 1,2<a name='3556'>
      IF ( IVDUM .EQ. 1 ) IVEG = 2<a name='3557'>
      IF ( IVDUM .EQ. 2 ) IVEG = 1<a name='3558'>
<font color=#447700>!----------------------------------------------------------------------<a name='3559'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3560'></font>
<font color=#447700>!     MODIFICATION FOR EFFECT OF SNOW ON UPPER STOREY ALBEDO<a name='3561'></font>
<font color=#447700>!         SNOW REFLECTANCE   = 0.80, 0.40 . MULTIPLY BY 0.6 IF MELTING<a name='3562'></font>
<font color=#447700>!         SNOW TRANSMITTANCE = 0.20, 0.54<a name='3563'></font>
<font color=#447700>!         SNOW REFLECTANCE   = 0.85, 0.65 . MULTIPLY BY 0.6 IF MELTING<a name='3564'></font>
<font color=#447700>!<a name='3565'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3566'></font>
      SCOV = 0.<a name='3567'>
      IF( IVEG .EQ. 2 ) GO TO 100<a name='3568'>
      IF( TC .LE. TF ) SCOV =  AMIN1( 0.5, CAPAC(1) / SATCAP(1) )<a name='3569'>
100   CONTINUE<a name='3570'>
      REFF1 = ( 1. - SCOV ) * REF(IVEG,IWAVE,1) + SCOV * ( 1.2 -        &amp;<a name='3571'>
              IWAVE * 0.4 ) * FMELT<a name='3572'>
      REFF2 = ( 1. - SCOV ) * REF(IVEG,IWAVE,2) + SCOV * ( 1.2 -        &amp;<a name='3573'>
              IWAVE * 0.4 ) * FMELT<a name='3574'>
      TRAN1 = TRAN(IVEG,IWAVE,1) * ( 1. - SCOV )                        &amp;<a name='3575'>
              + SCOV * ( 1.- ( 1.2 - IWAVE * 0.4 ) * FMELT )            &amp;<a name='3576'>
              * TRAN(IVEG,IWAVE,1)<a name='3577'>
      TRAN2 = TRAN(IVEG,IWAVE,2) * ( 1. - SCOV )                        &amp;<a name='3578'>
              + SCOV * ( 1.- ( 1.2 - IWAVE * 0.4 ) * FMELT ) * 0.9      &amp;<a name='3579'>
              * TRAN(IVEG,IWAVE,2)<a name='3580'>
<a name='3581'>
<font color=#447700>!----------------------------------------------------------------------<a name='3582'></font>
<font color=#447700>!<a name='3583'></font>
      SCAT = GREEN(IVEG)*( TRAN1 + REFF1 ) +( 1. - GREEN(IVEG) ) *      &amp;<a name='3584'>
             ( TRAN2 + REFF2)<a name='3585'>
      CHIV = CHIL(IVEG)<a name='3586'>
<font color=#447700>!<a name='3587'></font>
      IF ( ABS(CHIV) .LE. 0.01 ) CHIV = 0.01<a name='3588'>
      AA = 0.5 - 0.633 * CHIV - 0.33 * CHIV * CHIV<a name='3589'>
      BB = 0.877 * ( 1. - 2. * AA )<a name='3590'>
<font color=#447700>!<a name='3591'></font>
      PROJ = AA + BB * F<a name='3592'>
      EXTKB = ( AA + BB * F ) / F<a name='3593'>
      ZMEW = 1. / BB * ( 1. - AA / BB * ALOG ( ( AA + BB ) / AA ) )<a name='3594'>
      ACSS = SCAT / 2. * PROJ / ( PROJ + F * BB )<a name='3595'>
      ACSS = ACSS * ( 1. - F * AA / ( PROJ + F * BB ) * ALOG ( ( PROJ   &amp;<a name='3596'>
             +   F * BB + F * AA ) / ( F * AA ) ) )<a name='3597'>
<font color=#447700>!<a name='3598'></font>
      EXTK( IVEG, IWAVE, 1 ) = PROJ / F * SQRT( 1.-SCAT )<a name='3599'>
      EXTK( IVEG, IWAVE, 2 ) = 1. / ZMEW * SQRT( 1.-SCAT )<a name='3600'>
      EXTK( IVEG, 3, 1 ) = AA + BB<a name='3601'>
      EXTK( IVEG, 3, 2 ) = 1./ZMEW<a name='3602'>
<font color=#447700>!<a name='3603'></font>
      UPSCAT = GREEN(IVEG) * TRAN1 + ( 1. - GREEN(IVEG) ) * TRAN2<a name='3604'>
      UPSCAT = 0.5 * ( SCAT + ( SCAT - 2. * UPSCAT ) *                  &amp;<a name='3605'>
               (( 1. - CHIV ) / 2. ) ** 2 )<a name='3606'>
<font color=#447700>!<a name='3607'></font>
      BETAO = ( 1. + ZMEW * EXTKB ) / ( SCAT * ZMEW * EXTKB ) * ACSS<a name='3608'>
<font color=#447700>!<a name='3609'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3610'></font>
<font color=#447700>!<a name='3611'></font>
<font color=#447700>!     DICKINSON'S VALUES<a name='3612'></font>
<font color=#447700>!<a name='3613'></font>
      BE = 1. - SCAT + UPSCAT<a name='3614'>
      CE = UPSCAT<a name='3615'>
      BOT = ( ZMEW * EXTKB ) ** 2 + ( CE**2 - BE**2 )<a name='3616'>
      IF ( ABS(BOT) .GT. 1.E-10) GO TO 200<a name='3617'>
      SCAT = SCAT* 0.98<a name='3618'>
      BE = 1. - SCAT + UPSCAT<a name='3619'>
      BOT = ( ZMEW * EXTKB ) ** 2 + ( CE**2 - BE**2 )<a name='3620'>
200   CONTINUE<a name='3621'>
      DE = SCAT * ZMEW * EXTKB * BETAO<a name='3622'>
      FE = SCAT * ZMEW * EXTKB * ( 1. - BETAO )<a name='3623'>
<font color=#447700>!----------------------------------------------------------------------<a name='3624'></font>
<font color=#447700>!<a name='3625'></font>
      CCE = DE * BE - ZMEW * DE * EXTKB + CE * FE<a name='3626'>
      FFE = BE * FE + ZMEW * FE * EXTKB + CE * DE<a name='3627'>
<font color=#447700>!<a name='3628'></font>
      TORE = -CCE / BOT<a name='3629'>
      SIGE = -FFE / BOT<a name='3630'>
<font color=#447700>!<a name='3631'></font>
      PSI = SQRT(BE**2 - CE**2)/ZMEW<a name='3632'>
<font color=#447700>!<a name='3633'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3634'></font>
<font color=#447700>!     REDUCTION IN EXPOSED HEIGHT OF UPPER STOREY AS SNOW ACCUMULATES<a name='3635'></font>
<font color=#447700>!<a name='3636'></font>
      SDEP = CAPAC(2) * 5.<a name='3637'>
      FAC = ( SDEP - Z1 ) / ( Z2 - Z1 )<a name='3638'>
      FAC = AMAX1( 0., FAC )<a name='3639'>
      FAC = AMIN1( 0.99, FAC )<a name='3640'>
<font color=#447700>!<a name='3641'></font>
      ZAT = ZLT(IVEG) / VCOVER(IVEG)<a name='3642'>
      IF ( IVEG .EQ. 1 ) ZAT = ZAT * (1.-FAC)<a name='3643'>
<font color=#447700>!<a name='3644'></font>
      POWER1 = AMIN1( PSI*ZAT, 50. )<a name='3645'>
      POWER2 = AMIN1( EXTKB*ZAT, 50. )<a name='3646'>
      EPSI = EXP( - POWER1 )<a name='3647'>
      EK = EXP ( - POWER2 )<a name='3648'>
<font color=#447700>!<a name='3649'></font>
      ROSB = SOREF(IWAVE)<a name='3650'>
      ROSD = SOREF(IWAVE)<a name='3651'>
      IF ( IVEG .EQ. 2 ) GO TO 300<a name='3652'>
      ROSB = ALBEDO(2,IWAVE,1)<a name='3653'>
      ROSD = ALBEDO(2,IWAVE,2)<a name='3654'>
300   CONTINUE<a name='3655'>
<font color=#447700>!<a name='3656'></font>
      GE = ROSB / ROSD<a name='3657'>
<font color=#447700>!<a name='3658'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3659'></font>
<font color=#447700>!     CALCULATION OF DIFFUSE ALBEDOS<a name='3660'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3661'></font>
<font color=#447700>!<a name='3662'></font>
      F1 = BE - CE / ROSD<a name='3663'>
      ZP = ZMEW * PSI<a name='3664'>
<font color=#447700>!<a name='3665'></font>
      DEN = ( BE + ZP ) * ( F1 - ZP ) / EPSI -                          &amp;<a name='3666'>
            ( BE - ZP ) * ( F1 + ZP ) * EPSI<a name='3667'>
      ALPHA = CE * ( F1 - ZP ) / EPSI / DEN<a name='3668'>
      BETA = -CE * ( F1 + ZP ) * EPSI / DEN<a name='3669'>
      F1 = BE - CE * ROSD<a name='3670'>
      DEN = ( F1 + ZP ) / EPSI - ( F1 - ZP ) * EPSI<a name='3671'>
<font color=#447700>!<a name='3672'></font>
      GAMMA = ( F1 + ZP ) / EPSI / DEN<a name='3673'>
      DELTA = - ( F1 - ZP ) * EPSI / DEN<a name='3674'>
<font color=#447700>!<a name='3675'></font>
      ALBEDO(IVEG,IWAVE,2) =  ALPHA + BETA<a name='3676'>
<font color=#447700>!<a name='3677'></font>
      IF ( IVEG .EQ. 1 ) GO TO 400<a name='3678'>
      SCOV2 = 0.<a name='3679'>
<font color=#447700>!crr   CORRECTION FOR KEEPING ALBEDO HIGH OVER SNOW<a name='3680'></font>
      IF (ISICE.EQ.1) SCOV2=1.<a name='3681'>
<font color=#447700>!<a name='3682'></font>
      IF ( TGS .LE. TF ) SCOV2 = AMIN1( 1., CAPAC(2) / 0.004 )<a name='3683'>
      ALBEDO(2,IWAVE,2)= ROSD * ( 1. - VCOVER(2) ) + ALBEDO(2,IWAVE,2) * VCOVER(2)<a name='3684'>
      ALBEDO(2,IWAVE,2) =                                               &amp;<a name='3685'>
       ( 1. - SCOV2 ) * ALBEDO(2,IWAVE,2) + SCOV2 *                     &amp;<a name='3686'>
       ( 1.2-IWAVE*0.4 ) * FMELT<a name='3687'>
400   CONTINUE<a name='3688'>
<font color=#447700>!<a name='3689'></font>
      TRANC2(IWAVE) = GAMMA * EPSI + DELTA / EPSI<a name='3690'>
<font color=#447700>!<a name='3691'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3692'></font>
<font color=#447700>!     CALCULATION OF DIRECT ALBEDOS<a name='3693'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3694'></font>
<font color=#447700>!<a name='3695'></font>
      F1 = BE - CE / ROSD<a name='3696'>
      ZMK = ZMEW * EXTKB<a name='3697'>
<font color=#447700>!<a name='3698'></font>
      DEN = ( BE + ZP ) * ( F1 - ZP ) / EPSI -                          &amp;<a name='3699'>
            ( BE - ZP ) * ( F1 + ZP ) * EPSI<a name='3700'>
      ALPHA = ( DE - TORE * ( BE + ZMK ) ) * ( F1 - ZP ) / EPSI -       &amp;<a name='3701'>
              ( BE - ZP ) * ( DE - CE*GE - TORE * ( F1 + ZMK ) ) * EK<a name='3702'>
      ALPHA = ALPHA / DEN<a name='3703'>
      BETA = ( BE + ZP ) * (DE - CE*GE - TORE * ( F1 + ZMK ))* EK -     &amp;<a name='3704'>
             ( DE - TORE * ( BE + ZMK ) ) * ( F1 + ZP ) * EPSI<a name='3705'>
      BETA = BETA / DEN<a name='3706'>
      F1 = BE - CE * ROSD<a name='3707'>
      DEN = ( F1 + ZP ) / EPSI - ( F1 - ZP ) * EPSI<a name='3708'>
      GAMMA = - SIGE * ( F1 + ZP ) / EPSI -                             &amp;<a name='3709'>
              ( FE + CE * GE * ROSD + SIGE * ( ZMK - F1 ) ) * EK<a name='3710'>
      GAMMA = GAMMA / DEN<a name='3711'>
      DELTA = ( CE * GE * ROSD + FE + SIGE * ( ZMK - F1 ) ) * EK        &amp;<a name='3712'>
              + SIGE * ( F1 - ZP ) * EPSI<a name='3713'>
      DELTA = DELTA / DEN<a name='3714'>
<font color=#447700>!<a name='3715'></font>
      ALBEDO(IVEG,IWAVE,1) = TORE + ALPHA + BETA<a name='3716'>
<font color=#447700>!<a name='3717'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3718'></font>
<font color=#447700>!<a name='3719'></font>
      IF( IVEG .EQ. 1 ) GO TO 500<a name='3720'>
      ALBEDO(2,IWAVE,1) = ROSB * ( 1. - VCOVER(2) )                     &amp;<a name='3721'>
                          + ALBEDO(2,IWAVE,1) * VCOVER(2)<a name='3722'>
      ALBEDO(2,IWAVE,1) = ( 1. - SCOV2 ) * ALBEDO(2,IWAVE,1) +          &amp;<a name='3723'>
                          SCOV2 * ( 1.2-IWAVE*0.4 ) * FMELT<a name='3724'>
<font color=#447700>!<a name='3725'></font>
500   CONTINUE<a name='3726'>
<font color=#447700>!<a name='3727'></font>
      TRANC1(IWAVE) = EK<a name='3728'>
      TRANC3(IWAVE) = SIGE * EK + GAMMA * EPSI + DELTA / EPSI<a name='3729'>
<font color=#447700>!<a name='3730'></font>
2000  CONTINUE<a name='3731'>
<font color=#447700>!<a name='3732'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3733'></font>
<font color=#447700>!     CALCULATION OF TERMS WHICH MULTIPLY INCOMING SHORT WAVE FLUXES<a name='3734'></font>
<font color=#447700>!     TO GIVE ABSORPTION OF RADIATION BY CANOPY AND GROUND<a name='3735'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3736'></font>
<font color=#447700>!<a name='3737'></font>
      RADFAC(2,IWAVE,1) = ( 1.-VCOVER(1) ) * ( 1.-ALBEDO(2,IWAVE,1) )   &amp;<a name='3738'>
             + VCOVER(1) * ( TRANC1(IWAVE) * ( 1.-ALBEDO(2,IWAVE,1) )   &amp;<a name='3739'>
             + TRANC3(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3740'>
<font color=#447700>!<a name='3741'></font>
      RADFAC(2,IWAVE,2) = ( 1.-VCOVER(1) ) * ( 1.-ALBEDO(2,IWAVE,2) )   &amp;<a name='3742'>
             + VCOVER(1) *  TRANC2(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) )<a name='3743'>
<font color=#447700>!<a name='3744'></font>
      RADFAC(1,IWAVE,1) = VCOVER(1) * ( ( 1.-ALBEDO(1,IWAVE,1) )        &amp;<a name='3745'>
             - TRANC1(IWAVE) * ( 1.-ALBEDO(2,IWAVE,1) )                 &amp;<a name='3746'>
             - TRANC3(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3747'>
<font color=#447700>!<a name='3748'></font>
      RADFAC(1,IWAVE,2) = VCOVER(1) * ( ( 1.-ALBEDO(1,IWAVE,2) )        &amp;<a name='3749'>
             - TRANC2(IWAVE) * ( 1.-ALBEDO(2,IWAVE,2) ) )<a name='3750'>
<font color=#447700>!<a name='3751'></font>
<font color=#447700>!     XQQ(1,IWAVE,1) = RADFAC(1,IWAVE,1)<a name='3752'></font>
<font color=#447700>!     XQQ(1,IWAVE,2) = RADFAC(1,IWAVE,2)<a name='3753'></font>
<font color=#447700>!     XQQ(2,IWAVE,1) = RADFAC(2,IWAVE,1)<a name='3754'></font>
<font color=#447700>!     XQQ(2,IWAVE,2) = RADFAC(2,IWAVE,2)<a name='3755'></font>
<font color=#447700>!<a name='3756'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3757'></font>
<font color=#447700>!     CALCULATION OF TOTAL SURFACE ALBEDOS ( SALB )<a name='3758'></font>
<font color=#447700>!<a name='3759'></font>
      DO 3000 IRAD = 1, 2<a name='3760'>
      SALB(IWAVE,IRAD) = ( 1.-VCOVER(1) ) * ALBEDO(2,IWAVE,IRAD) +      &amp;<a name='3761'>
                         VCOVER(1) * ALBEDO(1,IWAVE,IRAD)<a name='3762'>
3000  CONTINUE<a name='3763'>
<font color=#447700>!<a name='3764'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3765'></font>
<font color=#447700>!     SAVING OF EXTINCTION COEFFICIENTS ( PAR ) FOR STOMAT CALCULATION<a name='3766'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3767'></font>
      IF ( IWAVE .EQ. 2 ) GO TO 600<a name='3768'>
      RADSAV(1) = 1. - VCOVER(1)                                        &amp;<a name='3769'>
                + VCOVER(1) * ( TRANC1(IWAVE) + TRANC3(IWAVE) )<a name='3770'>
      RADSAV(2) = 1. - VCOVER(1) + VCOVER(1) * TRANC2(IWAVE)<a name='3771'>
600   CONTINUE<a name='3772'>
<font color=#447700>!<a name='3773'></font>
1000  CONTINUE<a name='3774'>
<font color=#447700>!<a name='3775'></font>
<font color=#447700>!     albedo adjustment ==============================================<a name='3776'></font>
<font color=#447700>!<a name='3777'></font>
      if (xadj.eq.0.) go to 730<a name='3778'>
      xx = radfac(1,1,2) + radsav(2)<a name='3779'>
      xy = radfac(1,1,1) + radsav(1)<a name='3780'>
      ssum = salb(1,1)*radfrac(1,1) + salb(1,2)*radfrac(1,2)+           &amp;<a name='3781'>
             salb(2,1)*radfrac(2,1) + salb(2,2)*radfrac(2,2)<a name='3782'>
<font color=#447700>!     for diffuse albedo<a name='3783'></font>
      do 650 iwave = 1, 2<a name='3784'>
      salb(iwave,2) = salb(iwave,2) + xadj * salb(iwave,2) / ssum<a name='3785'>
      x0 = 1. - salb(iwave,2)<a name='3786'>
      x1 = radfac(1,iwave,2) + radfac(2,iwave,2)<a name='3787'>
      x2 = radfac(1,iwave,2) / x1<a name='3788'>
      x3 = radfac(2,iwave,2) / x1<a name='3789'>
      radfac(1,iwave,2) = x0 * x2<a name='3790'>
      radfac(2,iwave,2) = x0 * x3<a name='3791'>
      if (salb(iwave,2).gt.1..or.radfac(1,iwave,2).gt.1..or.            &amp;<a name='3792'>
          radfac(2,iwave,2).gt.1..or.salb(iwave,2).lt.0..or.            &amp;<a name='3793'>
          radfac(1,iwave,2).lt.0..or.radfac(2,iwave,2).lt.0.) then<a name='3794'>
          stop 999<a name='3795'>
      end if<a name='3796'>
 650  continue<a name='3797'>
 640  format(1x,'unrealistic value, dif',2i12,4e11.4)<a name='3798'>
<font color=#447700>!     for direct albedo<a name='3799'></font>
      do 750 iwave = 1, 2<a name='3800'>
      salb(iwave,1) = salb(iwave,1) + xadj * salb(iwave,1) / ssum<a name='3801'>
      x0 = 1. - salb(iwave,1)<a name='3802'>
      x1 = radfac(1,iwave,1) + radfac(2,iwave,1)<a name='3803'>
      x2 = radfac(1,iwave,1) / x1<a name='3804'>
      x3 = radfac(2,iwave,1) / x1<a name='3805'>
      radfac(1,iwave,1) = x0 * x2<a name='3806'>
      radfac(2,iwave,1) = x0 * x3<a name='3807'>
      radsav(1) =  xy - radfac(1,1,1)<a name='3808'>
      radsav(2) =  xx - radfac(1,1,2)<a name='3809'>
      if (salb(iwave,1).gt.1..or.radfac(1,iwave,1).gt.1..or.             &amp;<a name='3810'>
          radfac(2,iwave,1).gt.1..or.salb(iwave,1).lt.0..or.             &amp;<a name='3811'>
          radfac(1,iwave,1).lt.0..or.radfac(2,iwave,1).lt.0.) then<a name='3812'>
          write(7,740) nymdh,iwave,salb(iwave,1),radfac(1,iwave,1),      &amp;<a name='3813'>
                        radfac(2,iwave,1)<a name='3814'>
          stop 999<a name='3815'>
      end if<a name='3816'>
 750  continue<a name='3817'>
 740  format(1x,'unrealistic value',2i12,4e11.4)<a name='3818'>
 730  continue<a name='3819'>
<font color=#447700>!***************** end adjustment *******************************<a name='3820'></font>
      sibsu = radn(1,1)*salb(1,1) + radn(1,2)*salb(1,2)                   &amp;<a name='3821'>
            + radn(2,1)*salb(2,1) + radn(2,2)*salb(2,2)<a name='3822'>
      if ((swdown.gt.0.01).and.(sibsu.gt.0.01)) then<a name='3823'>
         bedo = sibsu / swdown<a name='3824'>
         if (bedo.gt.1.) then<a name='3825'>
            sibsu =  0.<a name='3826'>
            bedo = .1<a name='3827'>
<font color=#447700>! print*,'albebo incorrect',ix,jx,bedo,sibsu,swdown, &amp;<a name='3828'></font>
<font color=#447700>!           radn(1,1),radn(1,2),radn(2,1),radn(2,2)<a name='3829'></font>
         endif<a name='3830'>
      else<a name='3831'>
         sibsu = 0.0<a name='3832'>
         bedo = .1<a name='3833'>
      endif<a name='3834'>
<font color=#447700>!--------------------------------------------------------------------<a name='3835'></font>
<font color=#447700>!     bedo = sibsu/swdown<a name='3836'></font>
<font color=#447700>!     bedo = min(max(bedo,0.001),1.0)<a name='3837'></font>
<font color=#447700>!--------------------------------------------------------------------<a name='3838'></font>
<font color=#447700>!<a name='3839'></font>
<font color=#447700>!     CALCULATION OF LONG-WAVE FLUX TERMS FROM CANOPY AND GROUND<a name='3840'></font>
<font color=#447700>!<a name='3841'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3842'></font>
<font color=#447700>!<a name='3843'></font>
      TC4 = TC * TC * TC * TC<a name='3844'>
      TG4 = TGS * TGS * TGS * TGS<a name='3845'>
<font color=#447700>!<a name='3846'></font>
      ZKAT = EXTK(1,3,2) * ZLT(1) / VCOVER(1)<a name='3847'>
      ZKAT = AMIN1( 50. , ZKAT )<a name='3848'>
      ZKAT = AMAX1( 1.E-5, ZKAT )<a name='3849'>
      THERMK = EXP(-ZKAT)<a name='3850'>
<font color=#447700>!<a name='3851'></font>
      FAC1 =  VCOVER(1) * ( 1.-THERMK )<a name='3852'>
      FAC2 =  1.<a name='3853'>
      CLOSS =  2. * FAC1 * STEFAN * TC4<a name='3854'>
      CLOSS =  CLOSS - FAC2 * FAC1 * STEFAN * TG4<a name='3855'>
      GLOSS =  FAC2 * STEFAN * TG4<a name='3856'>
      GLOSS =  GLOSS - FAC1 * FAC2 * STEFAN * TC4<a name='3857'>
<font color=#447700>!<a name='3858'></font>
      ZLWUP =  FAC1 * STEFAN * TC4 + (1. - FAC1 ) * FAC2 * STEFAN * TG4<a name='3859'>
      TGEFF = SQRT( SQRT ( ( ZLWUP / STEFAN ) ) )<a name='3860'>
<font color=#447700>!<a name='3861'></font>
      RADSAV(3) = EXTK(1,1,1)<a name='3862'>
      RADSAV(4) = EXTK(1,1,2)<a name='3863'>
      RADSAV(5) = EXTK(2,1,1)<a name='3864'>
      RADSAV(6) = EXTK(2,1,2)<a name='3865'>
      RADSAV(7) = THERMK<a name='3866'>
      RADSAV(8) = EXTK(1,3,1)<a name='3867'>
      RADSAV(9) = EXTK(2,3,1)<a name='3868'>
      RADSAV(10)= CLOSS<a name='3869'>
      RADSAV(11)= GLOSS<a name='3870'>
      RADSAV(12)= TGEFF<a name='3871'>
<font color=#447700>!<a name='3872'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3873'></font>
<font color=#447700>!<a name='3874'></font>
<font color=#447700>!     CALCULATION OF ABSORPTION OF RADIATION BY SURFACE<a name='3875'></font>
<font color=#447700>!<a name='3876'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='3877'></font>
<font color=#447700>!<a name='3878'></font>
      P1F         = RADSAV(1)<a name='3879'>
      P2F         = RADSAV(2)<a name='3880'>
      EXTK(1,1,1) = RADSAV(3)<a name='3881'>
      EXTK(1,1,2) = RADSAV(4)<a name='3882'>
      EXTK(2,1,1) = RADSAV(5)<a name='3883'>
      EXTK(2,1,2) = RADSAV(6)<a name='3884'>
      THERMK      = RADSAV(7)<a name='3885'>
      EXTK(1,3,1) = RADSAV(8)<a name='3886'>
      EXTK(2,3,1) = RADSAV(9)<a name='3887'>
      CLOSS       = RADSAV(10)<a name='3888'>
      GLOSS       = RADSAV(11)<a name='3889'>
      TGEFF       = RADSAV(12)<a name='3890'>
<font color=#447700>!<a name='3891'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3892'></font>
<font color=#447700>!     SUMMATION OF SHORT-WAVE RADIATION ABSORBED BY CANOPY AND GROUND<a name='3893'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='3894'></font>
<font color=#447700>!<a name='3895'></font>
      RADT(1) = 0.<a name='3896'>
      RADT(2) = 0.<a name='3897'>
<font color=#447700>!<a name='3898'></font>
      DO 7000 IVEG  = 1, 2<a name='3899'>
      DO 7000 IWAVE = 1, 2<a name='3900'>
      DO 7000 IRAD  = 1, 2<a name='3901'>
<font color=#447700>!<a name='3902'></font>
      RADT(IVEG) = RADT(IVEG)+RADFAC(IVEG,IWAVE,IRAD)*RADN(IWAVE,IRAD)<a name='3903'>
<font color=#447700>!<a name='3904'></font>
7000  CONTINUE<a name='3905'>
<font color=#447700>!=========================================================================<a name='3906'></font>
      fsdown = radn(1,1)+radn(1,2)+radn(2,1)+radn(2,2)<a name='3907'>
      fsup   = fsdown-radt(1)-radt(2)<a name='3908'>
<font color=#447700>!=========================================================================<a name='3909'></font>
<font color=#447700>!<a name='3910'></font>
      SWCAN=RADT(1)<a name='3911'>
      SWGND=RADT(2)<a name='3912'>
<font color=#447700>!<a name='3913'></font>
      RADT(1) = RADT(1) + RADN(3,2)*VCOVER(1)*(1.- THERMK)              &amp;<a name='3914'>
              - CLOSS<a name='3915'>
      RADT(2) = RADT(2) + RADN(3,2)*( 1.-VCOVER(1)*(1-THERMK) )         &amp;<a name='3916'>
              - GLOSS<a name='3917'>
<font color=#447700>!=========================================================================<a name='3918'></font>
      fldown = radn(3,2)<a name='3919'>
      flup   = closs+gloss<a name='3920'>
<font color=#447700>!=========================================================================<a name='3921'></font>
<font color=#447700>!<a name='3922'></font>
      PAR(1) = RADN(1,1) + RADN(1,2) + 0.001<a name='3923'>
      PD(1) = ( RADN(1,1) + 0.001 ) / PAR(1)<a name='3924'>
      P1 = P1F * RADN(1,1) + 0.001<a name='3925'>
      P2 = P2F * RADN(1,2)<a name='3926'>
      PAR(2) = P1 + P2<a name='3927'>
      PD(2) = P1 / PAR(2)<a name='3928'>
<font color=#447700>!<a name='3929'></font>
<font color=#447700>!------------------------------------------------------<a name='3930'></font>
      END SUBROUTINE RADAB_ICE<a name='3931'>
<font color=#447700>!------------------------------------------------------<a name='3932'></font>
<font color=#447700>!=======================================================================<a name='3933'></font>
<font color=#447700>!                                                                       <a name='3934'></font>
<A NAME='RASIT5'><A href='../../html_code/phys/module_sf_ssib.F.html#RASIT5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3935'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>RASIT5</font>(TRIB,CTNI,CUNI,RA,Z2,Z0,D,ZZWIND,UMM1,        &amp; <A href='../../call_to/RASIT5.html' TARGET='index'>4</A><a name='3936'>
                 RHOA,TMM,U2,USTAR,DRAG,TA,bps,rib,CU,CT,UV10)<a name='3937'>
<font color=#447700>!                                                      2001,1,11<a name='3938'></font>
<font color=#447700>!=======================================================================<a name='3939'></font>
<font color=#447700>!<a name='3940'></font>
<font color=#447700>!     CUU AND CTT ARE LINEAR  (A SIMPLIFIED VERSION, XUE ET AL. 1991)<a name='3941'></font>
<font color=#447700>!<a name='3942'></font>
      FS(X) = 66.85 * X<a name='3943'>
      FT(X) = 0.904 * X<a name='3944'>
      FV(X) = 0.315 * X<a name='3945'>
<font color=#447700>!<a name='3946'></font>
<font color=#447700>!     CU AND CT ARE THE FRICTION AND HEAT TRANSFER COEFFICIENTS.<a name='3947'></font>
<font color=#447700>!     CUN AND CTN ARE THE NEUTRAL FRICTION AND HEAT TRANSFER<a name='3948'></font>
<font color=#447700>!     COEFFICIENTS.<a name='3949'></font>
<font color=#447700>!<a name='3950'></font>
      G2= 0.75<a name='3951'>
      G3= 0.75<a name='3952'>
      Z22 = Z2<a name='3953'>
      ZL = Z2 + 11.785 * Z0<a name='3954'>
<font color=#447700>!crr<a name='3955'></font>
      ZWIND = ZZWIND<a name='3956'>
      TM    = TMM<a name='3957'>
      UMM   = UMM1<a name='3958'>
<font color=#447700>!cxx  IF(ZWIND.LE.Z2) THEN<a name='3959'></font>
<font color=#447700>!cxx     ZWIND=Z2+20.0     ! if trees are higher than model level<a name='3960'></font>
<font color=#447700>!cxx                       ! increase model level by 10m<a name='3961'></font>
<font color=#447700>!cxx     TM  = TMM  - (ZWIND - ZZWIND)*0.0065        ! adjust temp (lin.)<a name='3962'></font>
<font color=#447700>!cxx     UMM = UMM1 + USTAR/VKC * ALOG(ZWIND/ZZWIND) ! adjust wind (log.)<a name='3963'></font>
<font color=#447700>!cxx  ENDIF<a name='3964'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='3965'></font>
      if(zwind.le.d.or.zl.le.d) d=min(zwind,zl)-0.1<a name='3966'>
<font color=#447700>!crr<a name='3967'></font>
      Z2 = D + Z0<a name='3968'>
      CUNI = ALOG((ZWIND-D)/Z0)/VKC<a name='3969'>
      IF (ZL.LT.ZWIND) THEN<a name='3970'>
         XCT1 = ALOG((ZWIND-D)/(ZL-D))<a name='3971'>
         XCT2 = ALOG((ZL-D)/(Z2-D))<a name='3972'>
         XCTU2 = ALOG((ZL-D)/(Z22-D))<a name='3973'>
         CTNI = (XCT1 + G3 * XCT2) / VKC<a name='3974'>
      ELSE<a name='3975'>
         XCT2 =  ALOG((ZWIND-D)/(Z2-D))<a name='3976'>
         XCTU2 =  ALOG((ZWIND-D)/(Z22-D))<a name='3977'>
         CTNI = G3 * XCT2 /VKC<a name='3978'>
      END IF<a name='3979'>
<font color=#447700>!  --------------- NEUTRAL VALUES OF USTAR AND VENTMF ------------<a name='3980'></font>
<font color=#447700>!<a name='3981'></font>
         UM=AMAX1(UMM,2.)<a name='3982'>
         USTARN=UM/CUNI<a name='3983'>
         VENTN =RHOA /CTNI*USTARN<a name='3984'>
      IF (ZL.LT.ZWIND) THEN<a name='3985'>
         U2 = UM - 1. / VKC * USTARN * (XCT1 + G2 * XCTU2)<a name='3986'>
      ELSE<a name='3987'>
         U2 = UM - 1. / VKC * USTARN * G2 * XCTU2<a name='3988'>
      END IF<a name='3989'>
<font color=#447700>!crr<a name='3990'></font>
      if(u2.lt.0.01) u2=0.01<a name='3991'>
<font color=#447700>!crr<a name='3992'></font>
<font color=#447700>!<a name='3993'></font>
<font color=#447700>!     STABILITY BRANCH BASED ON BULK RICHARDSON NUMBER.<a name='3994'></font>
<font color=#447700>!<a name='3995'></font>
<font color=#447700>!      THM=TM*bps1<a name='3996'></font>
<font color=#447700>!      THVGM= TRIB*bps0-THM<a name='3997'></font>
      THM=TM*bps <font color=#447700>!fds (06/2010)<a name='3998'></font>
      THVGM=TRIB-THM<a name='3999'>
      IF (TA.EQ.0.) THVGM = 0.<a name='4000'>
      RIB  = -THVGM*GRAV*(ZWIND-D) / (THM*(UM-U2)**2)<a name='4001'>
      RIB  = MAX(-10.E0,RIB)<a name='4002'>
      RIB  = MIN(0.1643E0,RIB)<a name='4003'>
<font color=#447700>!<a name='4004'></font>
<font color=#447700>!     NON-NEUTRON CORRECTION  (SEE XUE ET AL(1991))<a name='4005'></font>
      IF(RIB.LT.0.0)THEN<a name='4006'>
         GRIB = +RIB<a name='4007'>
         GRZL = +RIB*(ZL-D)/(ZWIND-D)<a name='4008'>
         GRZ2 = +RIB*(Z2-D)/(ZWIND-D)<a name='4009'>
         FVV =  FV(GRIB)<a name='4010'>
         IF (ZL.LT.ZWIND) THEN<a name='4011'>
             FTT = FT(GRIB) + (G3-1.) * FT(GRZL) - G3 * FT(GRZ2)<a name='4012'>
         ELSE<a name='4013'>
             FTT = G3*(FT(GRIB) - FT(GRZ2))<a name='4014'>
         END IF<a name='4015'>
         CUI = CUNI + FVV<a name='4016'>
         CTI = CTNI + FTT<a name='4017'>
      ELSE<a name='4018'>
         RZL = RIB/(ZWIND-D)*(ZL-D)<a name='4019'>
         RZ2 = RIB/(ZWIND-D)*(Z2-D)<a name='4020'>
         FVV = FS(RIB)<a name='4021'>
         IF (ZL.LT.ZWIND) THEN<a name='4022'>
             FTT = FS(RIB) + (G3-1) * FS(RZL) - G3 * FS(RZ2)<a name='4023'>
         ELSE<a name='4024'>
             FTT = G3 * (FS(RIB) - FS(RZ2))<a name='4025'>
         END IF<a name='4026'>
 312     CUI = CUNI + FVV<a name='4027'>
         CTI = CTNI + FTT<a name='4028'>
      ENDIF<a name='4029'>
 310  CONTINUE<a name='4030'>
<font color=#447700>!<a name='4031'></font>
      CU=1./CUI<a name='4032'>
<font color=#447700>!     CT=1./CTI   !Correction 3/8/16<a name='4033'></font>
      USTAR =UM*CU<a name='4034'>
      RAF = CTI / USTAR<a name='4035'>
      IF (RAF.LT.0.80) THEN<a name='4036'>
         RAF = 0.80<a name='4037'>
         CTI = RAF*USTAR<a name='4038'>
      ENDIF<a name='4039'>
      CT = 1./CTI <font color=#447700>!Correction 3/8/16<a name='4040'></font>
<font color=#447700>!<a name='4041'></font>
      RA  = RAF<a name='4042'>
<font color=#447700>!<a name='4043'></font>
      UEST  = USTAR<a name='4044'>
      DRAG = RHOA * UEST*UEST<a name='4045'>
      Z2 = Z22<a name='4046'>
<font color=#447700>!<a name='4047'></font>
<font color=#447700>!fds Calculate 10m wind intensity (Jan/2014)<a name='4048'></font>
     CUNI10 = ALOG((z2+10-D)/Z0)/VKC<a name='4049'>
     UV10 = USTAR * (CUNI10+FVV)<a name='4050'>
<font color=#447700>!<a name='4051'></font>
<font color=#447700>!------------------------------------------------------<a name='4052'></font>
      END SUBROUTINE RASIT5<a name='4053'>
<font color=#447700>!------------------------------------------------------<a name='4054'></font>
<a name='4055'>
<font color=#447700>!=======================================================================<a name='4056'></font>
<font color=#447700>!                                                                       <a name='4057'></font>
<A NAME='SDSOL'><A href='../../html_code/phys/module_sf_ssib.F.html#SDSOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4058'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SDSOL</font>(DSOL,DMASS,N,SOLAR,SOLSOIL) <A href='../../call_to/SDSOL.html' TARGET='index'>1</A><a name='4059'>
<font color=#447700>!<a name='4060'></font>
<font color=#447700>!=======================================================================<a name='4061'></font>
      parameter(nd = 4)<a name='4062'>
<font color=#447700>!clwp  12/08/2000, to change nd=20 to nd=4 to keep consistent<a name='4063'></font>
<font color=#447700>!cl    parameter(nd = 20)<a name='4064'></font>
      integer n<a name='4065'>
      real dsol(nd),dmass(nd),fext(nd)<a name='4066'>
<font color=#447700>!<a name='4067'></font>
      gsize   = 5.d-4<a name='4068'>
      bext    = 400.0<a name='4069'>
      cv      = 3.795d-3<a name='4070'>
      depth   = 30<a name='4071'>
      do i=1,n<a name='4072'>
         fext(i) = 0.0<a name='4073'>
      enddo<a name='4074'>
<font color=#447700>!<a name='4075'></font>
      tmass = 0.0<a name='4076'>
      do 10 i=1,n<a name='4077'>
         j=n+1-i<a name='4078'>
         tmass=tmass+dmass(j)<a name='4079'>
         if(tmass.gt.depth) goto 30<a name='4080'>
         fext(j)=exp(-cv*dmass(j)/sqrt(gsize))<a name='4081'>
         if(j .eq. n) fext(n)=exp(-bext*2d-3)*fext(n)<a name='4082'>
 10   continue<a name='4083'>
 30   tsolt = solar<a name='4084'>
      do 20 i=1,n<a name='4085'>
      j=n+1-i<a name='4086'>
         if(tsolt .le. 0d0)then<a name='4087'>
            dsol(j)=0d0<a name='4088'>
            tsolb=0.0<a name='4089'>
         else<a name='4090'>
            tsolb=tsolt*fext(j)<a name='4091'>
            dsol(j)=tsolt-tsolb<a name='4092'>
            tsolt=tsolb<a name='4093'>
         end if<a name='4094'>
 20   continue<a name='4095'>
      solsoil = tsolb<a name='4096'>
<font color=#447700>!                                                                       <a name='4097'></font>
<font color=#447700>!------------------------------------------------------<a name='4098'></font>
      END SUBROUTINE SDSOL<a name='4099'>
<font color=#447700>!------------------------------------------------------<a name='4100'></font>
<a name='4101'>
<font color=#447700>!=======================================================================<a name='4102'></font>
<font color=#447700>!                                                                       <a name='4103'></font>
<A NAME='SET0'><A href='../../html_code/phys/module_sf_ssib.F.html#SET0' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4104'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SET0</font>(TSSNO,BWO,BLO,BIO,HO,FLO,FIO,WO,DZO,    &amp; <A href='../../call_to/SET0.html' TARGET='index'>1</A><a name='4105'>
                      SSO,CTO,BTO,DMLTO,WF,DHP)<a name='4106'>
<font color=#447700>!<a name='4107'></font>
<font color=#447700>!=======================================================================<a name='4108'></font>
<font color=#447700>!cl<a name='4109'></font>
      DIMENSION WF(N1),DHP(N1),TSSNO(N1),BWO(N1),BLO(N1),BIO(N1),HO(N1),  &amp;<a name='4110'>
        FLO(N1),FIO(N1),WO(N1),DZO(N1),SSO(N1),CTO(N1),BTO(N1),DMLTO(N1)<a name='4111'>
<font color=#447700>!clwp  do 100 i=n+1,nd<a name='4112'></font>
      DO 100 I=N+1,N1<a name='4113'>
            TSSNO(I)=0.0<a name='4114'>
            BWO(I)=0.0<a name='4115'>
            BLO(I)=0.0<a name='4116'>
            BIO(I)=0.0<a name='4117'>
	    HO(I)=0.0<a name='4118'>
	    FLO(I)=0.0<a name='4119'>
	    FIO(I)=0.0<a name='4120'>
	    WO(I)=0.0<a name='4121'>
            DZO(I)=0.0<a name='4122'>
            SSO(I)=0.0<a name='4123'>
	    CTO(I)=0.0<a name='4124'>
	    BTO(I)=0.0<a name='4125'>
	    DMLTO(I)=0.0<a name='4126'>
100   CONTINUE<a name='4127'>
<font color=#447700>!clwp  DO 200 I=1,Nd<a name='4128'></font>
      DO 200 I=1,N1<a name='4129'>
           WF(I)=0.0<a name='4130'>
           DHP(I)=0.0<a name='4131'>
200   CONTINUE<a name='4132'>
<font color=#447700>!------------------------------------------------------<a name='4133'></font>
      END SUBROUTINE SET0<a name='4134'>
<font color=#447700>!------------------------------------------------------<a name='4135'></font>
<a name='4136'>
<font color=#447700>!=======================================================================<a name='4137'></font>
<font color=#447700>!                                                                       <a name='4138'></font>
<A NAME='SNOW_1ST'><A href='../../html_code/phys/module_sf_ssib.F.html#SNOW_1ST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4139'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SNOW_1ST</font> (DTT,TM,SOLAR,PRCPW,PRCPS,BIO,BLO,DICEVOL,      &amp; <A href='../../call_to/SNOW_1ST.html' TARGET='index'>1</A>,<A href='../../call_from/SNOW_1ST.html' TARGET='index'>3</A><a name='4140'>
                  DLIQVOL,TSSNO,PDZDTC,POROSITY,SO,SSO,WF,DHP,DZO,WO,     &amp;<a name='4141'>
                  BWO,BTO,CTO,DMASS,DSOL,SNROFF,HROFF,SNOWDEPTH,SOLSOIL,  &amp;<a name='4142'>
                  FLO,FIO,DMLTO,HO,BIFALL,BLFALL,FLFALL)<a name='4143'>
<font color=#447700>!<a name='4144'></font>
<font color=#447700>!=======================================================================<a name='4145'></font>
<font color=#447700>!cl<a name='4146'></font>
      DIMENSION BIO(N1),BLO(N1),DICEVOL(N1),DLIQVOL(N1),TSSNO(N1),      &amp;<a name='4147'>
                PDZDTC(N1),POROSITY(N1),SO(N1),SSO(N1),WF(N1),DHP(N1),  &amp;<a name='4148'>
                DZO(N1),WO(N1),BWO(N1),BTO(N1),CTO(N1),DMASS(N1),       &amp;<a name='4149'>
                DSOL(N1),FLO(N1),FIO(N1),DMLTO(N1),HO(N1)<a name='4150'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='4151'></font>
      tkair  = TM<a name='4152'>
      prcp   = prcpw+prcps<a name='4153'>
      snroff = 0.0<a name='4154'>
      hroff  = 0.0<a name='4155'>
<font color=#447700>!     dksatsnow=0.01<a name='4156'></font>
<font color=#447700>!.......................  rain<a name='4157'></font>
	if(prcpw.gt.0.0)then<a name='4158'>
	   wf(n+1)=amin1(prcpw, dksatsnow*dtt)<a name='4159'>
           dhp(n+1)=(wf(n+1)/dtt)*cl*rhowater*(tkair-273.16)<a name='4160'>
	   snroff =snroff+(prcpw-wf(n+1))<a name='4161'>
      hroff=hroff+(prcpw-wf(n+1))*cl*rhowater*(tkair-273.16)<a name='4162'>
        else if(prcps.gt.0.0)then<a name='4163'>
<font color=#447700>!......................  snow, add new nodes<a name='4164'></font>
           wf(n+1)=0.0<a name='4165'>
           dhp(n+1)=0.0<a name='4166'>
<font color=#447700>!cl 12/08/2000, the following subroutine just deals with top snow layer.<a name='4167'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#NEWSNOW'>NEWSNOW</A><A href='../../html_code/phys/module_sf_ssib.F.html#SNOW_1ST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEWSNOW_1">(PRCP,BIFALL,BLFALL,FLFALL,TKAIR,                       &amp;<a name='4168'>
               DZO(N),WO(N),BWO(N),CTO(N),HO(N),DMLTO(N),FIO(N),FLO(N),   &amp;<a name='4169'>
               BIO(N),BLO(N),DLIQVOL(N),DICEVOL(N),TSSNO(N),WF(N))<a name='4170'>
        endif<a name='4171'>
<font color=#447700>!---------------------------------<a name='4172'></font>
<font color=#447700>!     Compaction rate for snow<a name='4173'></font>
<font color=#447700>!---------------------------------<a name='4174'></font>
      do 277 i=n,1,-1<a name='4175'>
      dicevol(i) = bio(i)/dice<a name='4176'>
      dliqvol(i) = blo(i)/rhowater<a name='4177'>
      porosity(i)=1.0-dicevol(i)<a name='4178'>
      porosity(i)=amin1(porosity(i),1.0)<a name='4179'>
      porosity(i)=amax1(porosity(i),0.0)<a name='4180'>
      so(i)=ssisnow<a name='4181'>
      if(porosity(i).ne.0.0) so(i)=dliqvol(i)/porosity(i)<a name='4182'>
      sso(i)=(so(i)-ssisnow)/(1.0-ssisnow)<a name='4183'>
277   continue<a name='4184'>
      overburden=0.0<a name='4185'>
      do 377 i=n,1,-1<a name='4186'>
      overburden=overburden+ wo(i)*rhowater<a name='4187'>
      call <A href='../../html_code/phys/module_sf_ssib.F.html#COMPACT'>COMPACT</A><A href='../../html_code/phys/module_sf_ssib.F.html#SNOW_1ST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPACT_2">(BIO(I),TSSNO(I),BLO(I),OVERBURDEN,PDZDTC(I),   &amp;<a name='4188'>
           SSO(I),DICE)<a name='4189'>
 377  continue<a name='4190'>
<font color=#447700>!<a name='4191'></font>
<font color=#447700>!---------------------------------------------**<a name='4192'></font>
<font color=#447700>!    Calculate some variables after new snowfall<a name='4193'></font>
<font color=#447700>!---------------------------------------------**<a name='4194'></font>
       do 390 i = 1,n<a name='4195'>
         if((sso(i).lt.1.0.and.porosity(i).gt.0.0))then<a name='4196'>
           dzot=dzo(i)*(1d0+pdzdtc(i)*dtt)<a name='4197'>
           dzo(i)=amax1(dzot,dzmin)<a name='4198'>
<font color=#447700>!<a name='4199'></font>
	    if(wo(i).gt.womin)then<a name='4200'>
               bwo(i)=(wo(i)*rhowater)/dzo(i)<a name='4201'>
               if (bwo(i).gt.920.0) then<a name='4202'>
                   bwo(i)=920.0<a name='4203'>
                   dzo(i)=(wo(i)*rhowater)/bwo(i)<a name='4204'>
               end if<a name='4205'>
            endif<a name='4206'>
<font color=#447700>!<a name='4207'></font>
	    blo(i)=bwo(i)*flo(i)<a name='4208'>
	    bio(i)=bwo(i)*fio(i)<a name='4209'>
	    bto(i)=bwo(i)<a name='4210'>
        end if<a name='4211'>
<font color=#447700>!<a name='4212'></font>
	dicevol(i) = bio(i)/dice<a name='4213'>
	dliqvol(i) = blo(i)/rhowater<a name='4214'>
        dummy = dliqvol(i) + dicevol(i)<a name='4215'>
	if(dummy.gt.1.0)then<a name='4216'>
	dliqvol(i) = 1.0 - dicevol(i)<a name='4217'>
	blo(i) = dliqvol(i)*rhowater<a name='4218'>
	bwo(i) = blo(i) + bio(i)<a name='4219'>
        dzo(i)=(wo(i)*rhowater)/bwo(i)<a name='4220'>
	endif<a name='4221'>
        cto(i)=(bwo(i)/920.0)*1.9e+6<a name='4222'>
<font color=#447700>!<a name='4223'></font>
         porosity(i)=1.0-dicevol(i)<a name='4224'>
         if(porosity(i) .gt. 1.0)porosity(i)=1.0<a name='4225'>
         if(porosity(i) .lt. 0.0)porosity(i)=0.0<a name='4226'>
<font color=#447700>!<a name='4227'></font>
         if(porosity(i).gt.0.0)then<a name='4228'>
           so(i)=dliqvol(i)/porosity(i)<a name='4229'>
         else<a name='4230'>
           so(i)=ssisnow<a name='4231'>
         endif<a name='4232'>
<font color=#447700>!<a name='4233'></font>
        if(so(i).gt.ssisnow)then<a name='4234'>
          sso(i)=(so(i)-ssisnow)/(1.0-ssisnow)<a name='4235'>
        else<a name='4236'>
          sso(i)=0.0<a name='4237'>
        endif<a name='4238'>
<font color=#447700>!!!!!!  dmass is for using to calculate dsol in sdsol.f<a name='4239'></font>
	dmass(i)=bto(i)*dzo(i)<a name='4240'>
 390  continue<a name='4241'>
      SNOWDEPTH=dzo(1)+dzo(2)+dzo(3)<a name='4242'>
<font color=#447700>!---------------------------------------------<a name='4243'></font>
<font color=#447700>!     Optical parameters and solar extinction<a name='4244'></font>
<font color=#447700>!---------------------------------------------<a name='4245'></font>
      IF (solar .gt. 0d0 ) THEN<a name='4246'>
         call <A href='../../html_code/phys/module_sf_ssib.F.html#SDSOL'>sdsol</A><A href='../../html_code/phys/module_sf_ssib.F.html#SNOW_1ST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SDSOL_1">(dsol,dmass,n,solar,solsoil)<a name='4247'>
      ELSE<a name='4248'>
        do 112 i=1,n<a name='4249'>
           dsol(i)=0d0<a name='4250'>
112     continue<a name='4251'>
        solsoil=0.0<a name='4252'>
      END IF<a name='4253'>
<font color=#447700>!                                                                       <a name='4254'></font>
<font color=#447700>!------------------------------------------------------<a name='4255'></font>
      END SUBROUTINE SNOW_1ST<a name='4256'>
<font color=#447700>!------------------------------------------------------<a name='4257'></font>
<a name='4258'>
<font color=#447700>!=======================================================================<a name='4259'></font>
<font color=#447700>!                                                                       <a name='4260'></font>
<A NAME='SNRESULT'><A href='../../html_code/phys/module_sf_ssib.F.html#SNRESULT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4261'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SNRESULT</font>(DTT,I,ICASE,WFSOIL,TSOIL,B1,B2,FFF,DELTH,WWW,   &amp; <A href='../../call_to/SNRESULT.html' TARGET='index'>1</A>,<A href='../../call_from/SNRESULT.html' TARGET='index'>1</A><a name='4262'>
                   ZDEPTH,POROS,BI,BIO,DZ,DZO,W,BW,BWO,H,HO,QK,BL,BT,CT,  &amp;<a name='4263'>
                   FI,FL,WF,TSSN,DLIQVOL,DICEVOL,SNROFF,HROFF,QSOIL)<a name='4264'>
<font color=#447700>!<a name='4265'></font>
<font color=#447700>!=======================================================================<a name='4266'></font>
<font color=#447700>!cl<a name='4267'></font>
      DIMENSION BIO(N1),DZO(N1),W(N1),BWO(N1),HO(N1),                     &amp;<a name='4268'>
                DZ(N1),BI(N1),BW(N1),BL(N1),BT(N1),CT(N1),FI(N1),FL(N1),  &amp;<a name='4269'>
                WF(N1),H(N1),TSSN(N1),DLIQVOL(N1),DICEVOL(N1),QK(N1),     &amp;<a name='4270'>
                WWW(3),ZDEPTH(3)<a name='4271'>
      DIMENSION DELTH(20)<a name='4272'>
      DATA BWE/200.0/<a name='4273'>
          hx=0.0<a name='4274'>
          IF (ICASE.EQ.1)   THEN<a name='4275'>
	     fi(i)=1.0<a name='4276'>
	     fl(i)=0.0<a name='4277'>
	     dz(i)=dzo(i)<a name='4278'>
	     bw(i)=(w(i)*rhowater)/dz(i)<a name='4279'>
            if((w(i)/dz(i)).lt.0.05.or.(w(i)/dz(i))  &amp;<a name='4280'>
             .gt.(dice/1000.0))then<a name='4281'>
              bw(i) = bwo(i)<a name='4282'>
              dz(i) = (w(i)*rhowater)/bw(i)<a name='4283'>
             endif<a name='4284'>
	     bi(i)=bw(i)<a name='4285'>
	     bl(i)=0.0<a name='4286'>
	     bt(i)=bw(i)<a name='4287'>
	     wf(i)=0.0<a name='4288'>
             if (i.eq.1) wfsoil=0.0<a name='4289'>
	     dliqvol(i)=0.0<a name='4290'>
             dicevol(i)=bi(i)/dice<a name='4291'>
	     ct(i)=(bw(i)/920.0)*1.9e+6<a name='4292'>
             if  (i.eq.n)  then<a name='4293'>
         h(i)=ct(i)*dz(i)*(tssn(i)-273.16)-rhowater*dlm*w(n)*fi(n)<a name='4294'>
             else<a name='4295'>
               tssn(i) = ( ho(i) + ct(i)*dz(i)*273.16 + b1*dtt    &amp;<a name='4296'>
                  + rhowater*dlm*w(i) )                           &amp;<a name='4297'>
                  / ( ct(i)*dz(i) - b2*dtt )<a name='4298'>
               h(i) = ho(i) + (b1+b2*tssn(i))*dtt<a name='4299'>
             end if<a name='4300'>
             if(tssn(i).gt.273.16) then<a name='4301'>
               WRITE( message,* ) 'Warning: Snow Temp above freezing',i,tssn(i)<a name='4302'>
               tssn(i)=273.16<a name='4303'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_sf_ssib.F.html#SNRESULT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1004"> ( message )<a name='4304'>
             endif<a name='4305'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='4306'></font>
        ELSE IF   (ICASE.EQ.2)  THEN<a name='4307'>
<font color=#447700>! when snow temperature equals 273.16<a name='4308'></font>
	     fl(i)=1.0-fi(i)<a name='4309'>
	     tssn(i)=273.16<a name='4310'>
	     wf(i)=0.0<a name='4311'>
          If(bwo(i).ge.bwe) Then<a name='4312'>
	     if(fl(i).gt.flmin)then<a name='4313'>
                wf(i) = w(i)-(fi(i)/(1.0-flmin))*w(i)<a name='4314'>
                w(i)  = (fi(i)/(1.0-flmin))*w(i)<a name='4315'>
                dum   = wf(i)<a name='4316'>
	        fl(i)=flmin<a name='4317'>
	        fi(i)=1.0-fl(i)<a name='4318'>
	     endif<a name='4319'>
          Else<a name='4320'>
<font color=#447700>!.................................................<a name='4321'></font>
             flm = flmin+(flmax-flmin)*((bwe-bwo(i))/bwe)<a name='4322'>
             if(fl(i).gt.flm)then<a name='4323'>
               wf(i) = w(i)-(fi(i)/(1.0-flm))*w(i)<a name='4324'>
               w(i)  = (fi(i)/(1.0-flm))*w(i)<a name='4325'>
               dum   = wf(i)<a name='4326'>
	       fl(i)=flm<a name='4327'>
	       fi(i)=1.0-fl(i)<a name='4328'>
             endif<a name='4329'>
          Endif<a name='4330'>
<font color=#447700>!.................................................<a name='4331'></font>
          If( wf(i).gt.0.0) Then<a name='4332'>
             if(i.ne.1)then<a name='4333'>
               wf(i)=amin1(dum, dksatsnow*dtt)<a name='4334'>
	       snroff = snroff + (dum - wf(i))<a name='4335'>
               hroff=hroff+(dum-wf(i))*cl*rhowater*(tssn(i)-273.16)<a name='4336'>
             else<a name='4337'>
<font color=#447700>!ctest2<a name='4338'></font>
                if(www(1).ge.1.0) then<a name='4339'>
                    snroff = snroff + wf(i)<a name='4340'>
                    wfsoil=0.0<a name='4341'>
                else<a name='4342'>
                   slwet=www(1)*poros*zdepth(1)<a name='4343'>
                   www(1)=(slwet+wf(i))/(poros*zdepth(1))<a name='4344'>
                   if(www(1).gt.1.0) then<a name='4345'>
                     snroff = snroff + (www(1)-1.0)*poros*zdepth(1)<a name='4346'>
                     www(1)=1.0<a name='4347'>
                   endif<a name='4348'>
                wfsoil=0.0<a name='4349'>
                endif<a name='4350'>
                hroff=hroff + wf(i)*cl*rhowater*(tssn(i)-273.16)<a name='4351'>
             endif<a name='4352'>
	  Endif<a name='4353'>
<font color=#447700>!cccccc next concerning compaction occurring during melt<a name='4354'></font>
             xnodalmelt=bio(i)*dzo(i)-w(i)*rhowater*fi(i)<a name='4355'>
          If(xnodalmelt.gt.0.0.and.bio(i)*dzo(i).gt.0.0     &amp;<a name='4356'>
             .and.(bio(i).lt.250.0.or.(i.eq.n.and.          &amp;<a name='4357'>
              bio(i).lt.400.0))) Then<a name='4358'>
              ddz3=-xnodalmelt/(bio(i)*dzo(i))<a name='4359'>
              dz(i)=dzo(i)*(1.0+ddz3)<a name='4360'>
          Else<a name='4361'>
              dz(i)=dzo(i)<a name='4362'>
          Endif<a name='4363'>
              bw(i)=(w(i)*rhowater)/dz(i)<a name='4364'>
<font color=#447700>!.............................................<a name='4365'></font>
        If((w(i)/dz(i)).lt.0.05.or.(w(i)/dz(i))        &amp;<a name='4366'>
              .gt.(dice/1000.0)) Then<a name='4367'>
          bw(i) = bwo(i)<a name='4368'>
          dz(i) = (w(i)*rhowater)/bw(i)<a name='4369'>
        Endif<a name='4370'>
              bi(i)=bw(i)*fi(i)<a name='4371'>
              bl(i)=bw(i)-bi(i)<a name='4372'>
	      bt(i)=bw(i)<a name='4373'>
	      ct(i)=(bw(i)/920.0)*1.9e+6<a name='4374'>
	      dliqvol(i)=bl(i)/rhowater<a name='4375'>
              dicevol(i)=bi(i)/dice<a name='4376'>
              h(i)=(-1.0)*w(i)*fi(i)*dlm*rhowater<a name='4377'>
<font color=#447700>!cc---------------------------------------------**<a name='4378'></font>
        ELSE IF (ICASE.EQ.3) THEN<a name='4379'>
<font color=#447700>!            i=n<a name='4380'></font>
<font color=#447700>!           else if(fff.le.0.0) then<a name='4381'></font>
<font color=#447700>!cccccc next calculate ponding condition.<a name='4382'></font>
            fl(i) = 1.0<a name='4383'>
	    fi(i) = 0.0<a name='4384'>
<font color=#447700>!	    dz(i) = w(i)<a name='4385'></font>
            wf(i) = w(i)<a name='4386'>
            dum=  wf(i)<a name='4387'>
	    dz(i) = 10e-15<a name='4388'>
            w(i) = 10e-15<a name='4389'>
	    bw(i) =rhowater<a name='4390'>
	    bl(i)=bw(i)<a name='4391'>
	    bi(i)=0.0<a name='4392'>
            dliqvol(i) = 1.0<a name='4393'>
            dicevol(i) = 0.0<a name='4394'>
	    ct(i)=(bw(i)/920.0)*1.9e+6<a name='4395'>
	    tssn(i) = 273.16<a name='4396'>
            h(i) = 0.0<a name='4397'>
<font color=#447700>!<a name='4398'></font>
            If (i.eq.n) Then<a name='4399'>
               if (i.eq.1) then<a name='4400'>
                  hx=(-1.0)*w(i)*fff*dlm*rhowater/dtt<a name='4401'>
                  snroff=wf(1)+snroff<a name='4402'>
                  wfsoil=0.0<a name='4403'>
               else<a name='4404'>
                  wf(i)=amin1(dum, dksatsnow*dtt)<a name='4405'>
                  snroff = snroff + (dum - wf(i))<a name='4406'>
           hroff=hroff+(dum-wf(i))*cl*rhowater*(tssn(i)-273.16)<a name='4407'>
                  delth(n-1) = (-1.0)*w(i)*fff*dlm*rhowater/dtt<a name='4408'>
               end if<a name='4409'>
	    Else<a name='4410'>
              if(i.eq.1)then<a name='4411'>
                 hx         = ho(i)/dtt + b1+b2*tssn(i)<a name='4412'>
<font color=#447700>!ctest2<a name='4413'></font>
                if(www(1).ge.1.0) then<a name='4414'>
                    snroff = snroff + wf(i)<a name='4415'>
                    wfsoil=0.0<a name='4416'>
                else<a name='4417'>
                   slwet=www(1)*poros*zdepth(1)<a name='4418'>
                   www(1)=(slwet+wf(i))/(poros*zdepth(1))<a name='4419'>
                   if(www(1).gt.1.0) then<a name='4420'>
                    snroff = snroff + (www(1)-1.0)*poros*zdepth(1)<a name='4421'>
                    www(1)=1.0<a name='4422'>
                   endif<a name='4423'>
                wfsoil=0.0<a name='4424'>
                endif<a name='4425'>
              else<a name='4426'>
                 wf(i)=amin1(dum, dksatsnow*dtt)<a name='4427'>
                 snroff = snroff + (dum - wf(i))<a name='4428'>
      hroff=hroff+(dum-wf(i))*cl*rhowater*(tssn(i)-273.16)<a name='4429'>
                delth(i-1) = ho(i)/dtt + b1+b2*tssn(i)<a name='4430'>
              endif<a name='4431'>
            End if<a name='4432'>
        END IF<a name='4433'>
<font color=#447700>!cS  Calculate the heat flux into  the soil: qsoil     on 10/13/98.<a name='4434'></font>
<font color=#447700>!cS  qsoil : downward is positive [ W/m**2]<a name='4435'></font>
        if (i.eq.1) qsoil =  qk(1)*(tssn(1) - tsoil) + hx<a name='4436'>
<font color=#447700>!cs                                                       10/13/98<a name='4437'></font>
<font color=#447700>!                                                                       <a name='4438'></font>
<font color=#447700>!------------------------------------------------------<a name='4439'></font>
      END SUBROUTINE SNRESULT<a name='4440'>
<font color=#447700>!------------------------------------------------------<a name='4441'></font>
<a name='4442'>
<font color=#447700>!=======================================================================<a name='4443'></font>
<font color=#447700>!                                                                       <a name='4444'></font>
<A NAME='STRES1'><A href='../../html_code/phys/module_sf_ssib.F.html#STRES1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4445'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>STRES1</font> (IFIRST,RSTM,ROOTP,                          &amp; <A href='../../call_to/STRES1.html' TARGET='index'>2</A><a name='4446'>
           RSTFAC,RST,TC,ETC,RB,TGS,ETGS,RD,TU,TL,TOPT,EA,           &amp;<a name='4447'>
           DEFAC,PH1,PH2,NROOT,ZDEPTH,PHSOIL,ROOTD,VCOVER,DROP)<a name='4448'>
<font color=#447700>!<a name='4449'></font>
<font color=#447700>!=======================================================================<a name='4450'></font>
<font color=#447700>!<a name='4451'></font>
<font color=#447700>!======================================================================<a name='4452'></font>
<font color=#447700>!<a name='4453'></font>
<font color=#447700>!     CALCULATION OF ADJUSTMENT TO LIGHT DEPENDENT STOMATAL RESISTANCE<a name='4454'></font>
<font color=#447700>!     BY TEMPERATURE, HUMIDITY AND STRESS FACTORS<a name='4455'></font>
<font color=#447700>!     SIMPLIFIED SEE XUE ET AL(1991)<a name='4456'></font>
<font color=#447700>!<a name='4457'></font>
<font color=#447700>!         RSTFAC(IVEG,1) = FD<a name='4458'></font>
<font color=#447700>!         RSTFAC(IVEG,2) = FP<a name='4459'></font>
<font color=#447700>!         RSTFAC(IVEG,3) = FT<a name='4460'></font>
<font color=#447700>!         RSTFAC(IVEG,4) = FTPD<a name='4461'></font>
<font color=#447700>!<a name='4462'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4463'></font>
      DIMENSION TOPT(2), TL(2), TU(2), DEFAC(2), VCOVER(2)<a name='4464'>
      DIMENSION PH1(2), PH2(2), RST(2), RSTFAC(2,4),XDRR(3)<a name='4465'>
      DIMENSION ROOTD(2),ROOTP(3),ZDEPTH(3),PHSOIL(3), RSTM(2), DEP(3)<a name='4466'>
<font color=#447700>!----------------------------------------------------------------------<a name='4467'></font>
<font color=#447700>!     HUMIDITY, TEMPERATURE AND TRANSPIRATION FACTORS<a name='4468'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4469'></font>
<font color=#447700>!<a name='4470'></font>
      DO 1000 IVEG = 1, 2<a name='4471'>
<font color=#447700>!<a name='4472'></font>
      TV = TC<a name='4473'>
      ETV = ETC<a name='4474'>
      RAIR = RB * 2.<a name='4475'>
      IF ( IVEG .EQ. 1 ) GO TO 100<a name='4476'>
      TV = TGS<a name='4477'>
      ETV = ETGS<a name='4478'>
      RAIR = RD<a name='4479'>
100   CONTINUE<a name='4480'>
<font color=#447700>!<a name='4481'></font>
      TV = AMIN1 ( ( TU(IVEG) - 0.1 ), TV )<a name='4482'>
      TV = AMAX1 ( ( TL(IVEG) + 0.1 ), TV )<a name='4483'>
<font color=#447700>!<a name='4484'></font>
      IF( IFIRST .EQ. 0 ) GO TO 200<a name='4485'>
      RSTM(IVEG) = RST(IVEG)<a name='4486'>
      D2 = ( TU(IVEG) - TOPT(IVEG) ) / ( TOPT(IVEG) - TL(IVEG) )<a name='4487'>
      D1 = 1. /(( TOPT(IVEG) - TL(IVEG) )*                  &amp;<a name='4488'>
              EXP( ALOG( TU(IVEG) - TOPT(IVEG))*D2))<a name='4489'>
      RSTFAC(IVEG,3) = D1*( TV-TL(IVEG)) * EXP(ALOG(TU(IVEG)-TV)*D2)<a name='4490'>
<font color=#447700>!<a name='4491'></font>
      IF (RSTFAC(IVEG,3).LT.0.) RSTFAC(IVEG,3) = 0.<a name='4492'>
      IF (RSTFAC(IVEG,3).GT.1.) RSTFAC(IVEG,3) = 1.<a name='4493'>
<font color=#447700>!<a name='4494'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4495'></font>
<font color=#447700>!      SIMPLIFIED CALCULATION OF LEAF WATER POTENTIAL FACTOR , FP<a name='4496'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4497'></font>
<font color=#447700>!<a name='4498'></font>
<font color=#447700>!---------new add------------<a name='4499'></font>
  XDRR(1)=-PHSOIL(1)<a name='4500'>
  XDRR(2)=-PHSOIL(2)<a name='4501'>
  XDRR(3)=-PHSOIL(3)<a name='4502'>
  IF(XDRR(1).le.0.001) XDRR(1)=0.001<a name='4503'>
  IF(XDRR(2).le.0.001) XDRR(2)=0.001<a name='4504'>
  IF(XDRR(3).le.0.001) XDRR(3)=0.001<a name='4505'>
  XDRR(1)=ALOG(XDRR(1))<a name='4506'>
  XDRR(2)=ALOG(XDRR(2))<a name='4507'>
  XDRR(3)=ALOG(XDRR(3))<a name='4508'>
<font color=#447700>!------------------------------<a name='4509'></font>
<a name='4510'>
      IF (NROOT.EQ.1) THEN<a name='4511'>
      XROT = ROOTD(1)<a name='4512'>
      DO 7400 I = 1, 3<a name='4513'>
 7400 DEP(I) = 0.<a name='4514'>
      DO 7500 I = 1, 3<a name='4515'>
      DEP(I) = AMIN1(ZDEPTH(I), XROT)<a name='4516'>
      XROT = XROT - ZDEPTH(I)<a name='4517'>
      IF (XROT.LE.0.) GO TO 7410<a name='4518'>
 7500 CONTINUE<a name='4519'>
 7410 CONTINUE<a name='4520'>
<font color=#447700>!      XDR = (PHSOIL(1) * DEP(1) + PHSOIL(2) * DEP(2)         &amp;<a name='4521'></font>
<font color=#447700>!            +PHSOIL(3) * DEP(3)) /ROOTD(1)<a name='4522'></font>
       XDR=(XDRR(1)*DEP(1)+XDRR(2)*DEP(2)+XDRR(3)*DEP(3))/ROOTD(1)<a name='4523'>
<a name='4524'>
      ELSE<a name='4525'>
<font color=#447700>!      XDR = PHSOIL(1) * ROOTP(1) + PHSOIL(2) * ROOTP(2)      &amp;<a name='4526'></font>
<font color=#447700>!            +PHSOIL(3) * ROOTP(3)<a name='4527'></font>
       XDR=XDRR(1)*ROOTP(1)+XDRR(2)*ROOTP(2)+XDRR(3)*ROOTP(3)<a name='4528'>
      END IF<a name='4529'>
<font color=#447700>!      XDR = - XDR<a name='4530'></font>
<font color=#447700>!      IF (XDR .LE. 0.001) XDR = 0.001<a name='4531'></font>
<font color=#447700>!      XDR = ALOG (XDR)<a name='4532'></font>
<font color=#447700>!cl    2001,1,09 changed the following two lines back to the original ones.<a name='4533'></font>
<font color=#447700>!cl    EXPONENT = AMAX1(-86.0, (- PH1(IVEG) * (PH2(IVEG) - XDR)) )<a name='4534'></font>
<font color=#447700>!cl    RSTFAC(IVEG,2) = 1. - EXP(EXPONENT)<a name='4535'></font>
      RSTFAC(IVEG,2) = 1. - EXP(- PH1(IVEG) * (PH2(IVEG) - XDR))<a name='4536'>
      IF (RSTFAC(IVEG,2).GT.1.) RSTFAC(IVEG,2) = 1.<a name='4537'>
      IF (RSTFAC(IVEG,2).LT.0.) RSTFAC(IVEG,2) = 0.<a name='4538'>
<font color=#447700>!<a name='4539'></font>
200   RST(IVEG) = RSTM(IVEG)<a name='4540'>
<font color=#447700>!<a name='4541'></font>
      EPOT = ETV - EA<a name='4542'>
      EPOT = AMAX1(0.0001,(ETV-EA))<a name='4543'>
<font color=#447700>!<a name='4544'></font>
<font color=#447700>!               ---** PJS mod 10/9/92 ---**<a name='4545'></font>
<font color=#447700>! ---** based on Verma FIFE-87 function for C4 grasses ---**<a name='4546'></font>
<font color=#447700>!<a name='4547'></font>
      RSTFAC(IVEG,1) = 1./ ( 1 + DEFAC(IVEG)*DROP )<a name='4548'>
<font color=#447700>!<a name='4549'></font>
      IF (RSTFAC(IVEG,1).LT.0.) RSTFAC(IVEG,1) = 0.<a name='4550'>
      IF (RSTFAC(IVEG,1).GT.1.) RSTFAC(IVEG,1) = 1.<a name='4551'>
<font color=#447700>!----------------------------------------------------------------------<a name='4552'></font>
<font color=#447700>!     VALUE OF FP FOUND<a name='4553'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4554'></font>
<font color=#447700>!<a name='4555'></font>
300   FTPD = RSTFAC(IVEG,1) * RSTFAC(IVEG,2) * RSTFAC(IVEG,3)<a name='4556'>
      RSTFAC(IVEG,4) = AMAX1( FTPD, 0.00001 )<a name='4557'>
<font color=#447700>!----------------------------------------------------------------------<a name='4558'></font>
<font color=#447700>!<a name='4559'></font>
      RST(IVEG) = RST(IVEG) / RSTFAC(IVEG,4) / VCOVER(IVEG)<a name='4560'>
<font color=#447700>!<a name='4561'></font>
      RST(IVEG) = AMIN1( RST(IVEG), 100000. )<a name='4562'>
1000  CONTINUE<a name='4563'>
<font color=#447700>!                                                                       <a name='4564'></font>
<font color=#447700>!------------------------------------------------------<a name='4565'></font>
      END SUBROUTINE STRES1<a name='4566'>
<font color=#447700>!------------------------------------------------------<a name='4567'></font>
<a name='4568'>
<font color=#447700>!=======================================================================<a name='4569'></font>
<font color=#447700>!                                                                       <a name='4570'></font>
<A NAME='TEMRS1'><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4571'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>TEMRS1</font>                                                 &amp; <A href='../../call_to/TEMRS1.html' TARGET='index'>2</A>,<A href='../../call_from/TEMRS1.html' TARGET='index'>4</A><a name='4572'>
        (DTT,TC,TGS,TD,TA,TM,QM,EM,PSURF,WWW,CAPAC,SATCAP,              &amp;<a name='4573'>
         DTC,DTG,RA,RST,ZDEPTH,BEE,PHSAT,POROS,D,Z0,RDC,RBC,VCOVER,Z2,  &amp;<a name='4574'>
         ZLAI,DEFAC,TU,TL,TOPT,RSTFAC,NROOT,ROOTD,PHSOIL,ROOTP,PH1,PH2, &amp;<a name='4575'>
         ECT,ECI,EGT,EGI,EGS,HC,HG,EC,EG,EA,RADT,CHF,SHF,ALBEDO,ZLWUP,  &amp;<a name='4576'>
         THERMK,RHOAIR,ZWIND,UM,USTAR,DRAG,CCX,CG, ISNOW,SNOWDEN,       &amp;<a name='4577'>
         BPS,rib,CU,XCT,flup,UV10)<a name='4578'>
<font color=#447700>!<a name='4579'></font>
<font color=#447700>!=======================================================================<a name='4580'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='4581'></font>
<font color=#447700>!     A SIMPLIFIED VERSION (XUE ET AL. 1991)<a name='4582'></font>
<font color=#447700>!     CORE ROUTINE: CALCULATION OF CANOPY AND GROUND TEMPERATURE<a name='4583'></font>
<font color=#447700>!     INCREMENTS OVER TIME STEP, FLUXES DERIVED.<a name='4584'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='4585'></font>
<font color=#447700>!     SUBROUTINES IN THIS BLOCK : TEMRS1,DELRN,DELHF,DELEF,STRES1<a name='4586'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='4587'></font>
      REAL ZINC(3), A2(3), Y1(3), ITEX(3),RSTM(2)<a name='4588'>
<font color=#447700>!cl    add the following arrays after common block "comsib3" was removed<a name='4589'></font>
      DIMENSION WWW(3), CAPAC(2), SATCAP(2), ZDEPTH(3)<a name='4590'>
      DIMENSION VCOVER(2), ZLAI(2), RADT(2),ALBEDO(2,3,2)<a name='4591'>
      DIMENSION TOPT(2), TL(2), TU(2), DEFAC(2)<a name='4592'>
      DIMENSION PH1(2), PH2(2), RST(2), RSTFAC(2,4)<a name='4593'>
      DIMENSION ROOTD(2), ROOTP(3), PHSOIL(3)<a name='4594'>
<font color=#447700>!<a name='4595'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4596'></font>
<font color=#447700>!     E(X) IS VAPOUR PRESSURE IN MBARS AS A FUNCTION OF TEMPERATURE<a name='4597'></font>
<font color=#447700>!     GE(X) IS D E(X) / D ( TEMP )<a name='4598'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4599'></font>
<font color=#447700>!<a name='4600'></font>
      E(X) = EXP( 21.18123 - 5418. / X ) / .622<a name='4601'>
      GE(X) = EXP( 21.18123 - 5418. / X ) * 5418.  &amp;<a name='4602'>
              / (X*X) / .622<a name='4603'>
<font color=#447700>!<a name='4604'></font>
      ETC   = E(TC)<a name='4605'>
      ETGS  = E(TGS)<a name='4606'>
      GETC  = GE(TC)<a name='4607'>
      GETGS = GE(TGS)<a name='4608'>
<font color=#447700>!crr   HLAT     = ( 3150.19 - 2.378 * TM ) * 1000.<a name='4609'></font>
<font color=#447700>!crr   PSY      = CPAIR / HLAT * PSUR / .622<a name='4610'></font>
      PSY      = CPAIR / HLAT * PSURF/100. / .622<a name='4611'>
      RCP = RHOAIR * CPAIR<a name='4612'>
<font color=#447700>!     RADD = 44.<a name='4613'></font>
      WC = AMIN1( 1., CAPAC(1)/SATCAP(1) )<a name='4614'>
      WG = AMIN1( 1., CAPAC(2)/SATCAP(2) )<a name='4615'>
<font color=#447700>!----------------------------------------------------------------------<a name='4616'></font>
<font color=#447700>!      RSOIL FUNCTION FROM FIT TO CAMILLO AND GURNEY (1984) DATA.<a name='4617'></font>
<font color=#447700>!      WETNESS OF UPPER 0.5 CM OF SOIL CALCULATED FROM APPROXIMATION<a name='4618'></font>
<font color=#447700>!      TO MILLY FLOW EQUATION WITH REDUCED (1/50 ) CONDUCTIVITY IN<a name='4619'></font>
<font color=#447700>!      TOP LAYER.<a name='4620'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4621'></font>
<font color=#447700>!<a name='4622'></font>
<font color=#447700>!     WT = WWW(1) + 0.75 * ZDEPTH(1) / ( ZDEPTH(1) + ZDEPTH(2) )<a name='4623'></font>
<font color=#447700>!    &amp;     * (WWW(1) - (WWW(2)**2)/WWW(1) ) / 2. * 50.<a name='4624'></font>
<font color=#447700>!     FAC = AMIN1( WT, 0.99 )<a name='4625'></font>
<font color=#447700>!     FAC = AMAX1( FAC, WWW(1) * 0.1 )<a name='4626'></font>
<font color=#447700>!<a name='4627'></font>
<font color=#447700>!------------------------------------------------------------<a name='4628'></font>
<font color=#447700>! --- soil resistance calculation alteration Y.K. Xue Feb. 1994**<a name='4629'></font>
<font color=#447700>!------------------------------------------------------------<a name='4630'></font>
      FAC = AMIN1( www(1), 0.99 )<a name='4631'>
      FAC = AMAX1( FAC, 0.02 )<a name='4632'>
      RSOIL =  101840. * (1. - FAC ** 0.0027)<a name='4633'>
<font color=#447700>!<a name='4634'></font>
      PSIT = PHSAT * FAC ** (- BEE )<a name='4635'>
      ARGG = AMAX1(-10.,(PSIT*GRAV/461.5/TGS))<a name='4636'>
      HR = EXP(ARGG)<a name='4637'>
<font color=#447700>!cl    2001,1,10 added the following line according to Xue, 2000 August<a name='4638'></font>
      PILPHR = HR<a name='4639'>
<font color=#447700>!----------------------------------------------------------------------<a name='4640'></font>
<font color=#447700>!     ALTERATION OF AERODYNAMIC TRANSFER PROPERTIES IN CASE OF SNOW<a name='4641'></font>
<font color=#447700>!     ACCUMULATION.<a name='4642'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4643'></font>
<font color=#447700>!<a name='4644'></font>
      RESD = D<a name='4645'>
      RESZ0 = Z0<a name='4646'>
      RESRDC = RDC<a name='4647'>
      RESRBC = RBC<a name='4648'>
      RESV2 = VCOVER(2)<a name='4649'>
<font color=#447700>!<a name='4650'></font>
      IF ( TGS .GT. TF ) GO TO 100<a name='4651'>
<font color=#447700>!<a name='4652'></font>
      SDEP = CAPAC(2) *SNOWDEN<a name='4653'>
      SDEP = AMIN1( SDEP, (Z2*0.95) )<a name='4654'>
      D = Z2 - ( Z2-D ) / Z2 * ( Z2 - SDEP )<a name='4655'>
      Z0 = Z0 / ( Z2-RESD ) * ( Z2-D )<a name='4656'>
      RDC = RDC * ( Z2-SDEP ) / Z2<a name='4657'>
      RBC = RBC * Z2 / ( Z2-SDEP )<a name='4658'>
      VCOVER(2) = 1.<a name='4659'>
      WG = AMIN1( 1., CAPAC(2) / 0.004 )<a name='4660'>
      RST(2) = RSOIL<a name='4661'>
100   CONTINUE<a name='4662'>
<font color=#447700>!----------------------------------------------------------------------<a name='4663'></font>
<font color=#447700>!<a name='4664'></font>
<font color=#447700>!      CALCULATION OF EA, TA, RA, RB, RD AND SOIL MOISTURE STRESS<a name='4665'></font>
<font color=#447700>!      FOR THE BEGINNING OF THE TIME STEP<a name='4666'></font>
<font color=#447700>!<a name='4667'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4668'></font>
      IFIRST = 1<a name='4669'>
      ICOUNT = 0<a name='4670'>
      TGEN = TGS<a name='4671'>
      TCEN = TC<a name='4672'>
      FC = 1.<a name='4673'>
      FG = 1.<a name='4674'>
<font color=#447700>!-- 2001,1,11 changed the following line according to Xue,August,2000(TA=TM)<a name='4675'></font>
<font color=#447700>!cl    TA = TM<a name='4676'></font>
      TRIB = TA<a name='4677'>
      EA = EM<a name='4678'>
      HT = 0.<a name='4679'>
      IONCE = 0<a name='4680'>
1000  CONTINUE<a name='4681'>
      ICOUNT = ICOUNT + 1<a name='4682'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RASIT5'>RASIT5</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RASIT5_1">(TRIB,CTNI,CUNI,RA,Z2,Z0,D,ZWIND,UM,                  &amp;<a name='4683'>
                  RHOAIR,TM,U2,USTAR,DRAG,TA,bps,rib,CU,XCT,UV10)<a name='4684'>
<font color=#447700>!cl    ------------IF ( IFIRST .EQ. 1 ) CALL RBRD1 ------------<a name='4685'></font>
        IF ( IFIRST .EQ. 1 ) THEN<a name='4686'>
<font color=#447700>!cl      TCTA = TC - TA<a name='4687'></font>
        RB  = 1.0/(SQRT(U2)/RBC+ZLAI(1)*.004)<a name='4688'>
<font color=#447700>!cl      X1 = TEMDIF<a name='4689'></font>
        TGTA = TGS- TA<a name='4690'>
        TEMDIF = ( TGTA + SQRT(TGTA*TGTA) ) / 2. + 0.1<a name='4691'>
        FIH = SQRT( 1. + 9. * GRAV *TEMDIF * Z2 / TGS / ( U2*U2) )<a name='4692'>
        RD  = RDC / U2 / FIH<a name='4693'>
        ENDIF<a name='4694'>
<font color=#447700>!cl    ------------ END OF RBRD1 ---------------<a name='4695'></font>
      D1 = 1./RA + 1./RB + 1./RD<a name='4696'>
      TA = ( TGS/RD + TC/RB + TM/RA *bps) / D1<a name='4697'>
      HT = ( TA - TM ) * RCP / RA<a name='4698'>
      RCC = RST(1)*FC + 2. * RB<a name='4699'>
      COC = (1.-WC)/RCC + WC/(2.*RB)<a name='4700'>
      RG = RST(2)*FG<a name='4701'>
      RSURF = RSOIL*FG<a name='4702'>
      COG1 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)*HR    &amp;<a name='4703'>
             + VCOVER(2)/(RSURF+RD+44.)*HR<a name='4704'>
      COG2 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)       &amp;<a name='4705'>
             + VCOVER(2)/(RSURF+RD+44.)<a name='4706'>
      COG1 = COG1 + WG/RD * VCOVER(2)<a name='4707'>
      COG2 = COG2 + WG/RD * VCOVER(2)<a name='4708'>
      D2 = 1./RA + COC + COG2<a name='4709'>
      TOP = COC * ETC + COG1 * ETGS + EM / RA<a name='4710'>
      EA = TOP / D2<a name='4711'>
      DROP = AMAX1( 0., (E(TA)-EA) )<a name='4712'>
<font color=#447700>!----------------------------------------------------------------------<a name='4713'></font>
<font color=#447700>!cl    CALL STRES1 ( IFIRST , RSTM)<a name='4714'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#STRES1'>STRES1</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STRES1_1"> (IFIRST, RSTM,ROOTP,                               &amp;<a name='4715'>
           RSTFAC,RST,TC,ETC,RB,TGS,ETGS,RD,TU,TL,TOPT,EA,           &amp;<a name='4716'>
           DEFAC,PH1,PH2,NROOT,ZDEPTH,PHSOIL,ROOTD,VCOVER,DROP)<a name='4717'>
<font color=#447700>!----------------------------------------------------------------------<a name='4718'></font>
      IFIRST = 0<a name='4719'>
      ERIB = EA<a name='4720'>
      TRIB = TA<a name='4721'>
<font color=#447700>!!!<a name='4722'></font>
      IF ( ICOUNT .LE. 4 ) GO TO 1000<a name='4723'>
<font color=#447700>!======================================================================<a name='4724'></font>
<font color=#447700>!cl    CALL DELRN ( RNCDTC, RNCDTG, RNGDTG, RNGDTC )<a name='4725'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF RADIATIVE AND SENSIBLE HEAT FLUXES<a name='4726'></font>
      TC3 = TC * TC * TC<a name='4727'>
      TG3 = TGS * TGS * TGS<a name='4728'>
      FAC1 = ( 1. - ALBEDO(1,3,2) ) * ( 1.-THERMK ) * VCOVER(1)<a name='4729'>
      FAC2 =   1. - ALBEDO(2,3,2)<a name='4730'>
      RNCDTC = - 2. * 4. * FAC1 * STEFAN * TC3<a name='4731'>
      RNCDTG = 4. * FAC1 * FAC2 * STEFAN * TG3<a name='4732'>
      RNGDTG = - 4. * FAC2 * STEFAN * TG3<a name='4733'>
      RNGDTC = 4. * FAC1 * FAC2 * STEFAN * TC3<a name='4734'>
<font color=#447700>!----------------------------------------------------------------------<a name='4735'></font>
<font color=#447700>!<a name='4736'></font>
<font color=#447700>!     DEW CALCULATION : DEW CONDITION IS SET AT BEGINNING OF TIME STEP.<a name='4737'></font>
<font color=#447700>!     IF SURFACE CHANGES STATE DURING TIME STEP, LATENT HEAT FLUX IS<a name='4738'></font>
<font color=#447700>!     SET TO ZERO.<a name='4739'></font>
<font color=#447700>!<a name='4740'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4741'></font>
      IF ( EA .GT. ETC ) FC = 0.<a name='4742'>
      IF ( EA .GT. ETGS) FG = 0.<a name='4743'>
<font color=#447700>!<a name='4744'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4745'></font>
<font color=#447700>!<a name='4746'></font>
<font color=#447700>!     WET FRACTION EXHAUSTION TEST : IF CAPAC(X) IS EXHAUSTED IN<a name='4747'></font>
<font color=#447700>!     A TIME STEP, INTERCEPTION LOSS IS LIMITED TO CAPAC(X).<a name='4748'></font>
<font color=#447700>!<a name='4749'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4750'></font>
<font color=#447700>!     START OF NON-NEUTRAL RESISTANCE CALCULATION LOOP<a name='4751'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4752'></font>
      I = 0<a name='4753'>
<font color=#447700>!    ----- INITIALIZE NEWTON-RAPHSON ITERATIVE ROUTINE FOR RASIT 3,5,8<a name='4754'></font>
                    NOX = 0<a name='4755'>
                 NONPOS = 1<a name='4756'>
                  IWALK = 0<a name='4757'>
                     LX = 2<a name='4758'>
                   FINC = 1.<a name='4759'>
                   ITEX(LX) = 0.<a name='4760'>
                   ZINC(LX) = 0.<a name='4761'>
                   A2(LX)   = 0.<a name='4762'>
                   Y1(LX)   = 0.<a name='4763'>
2000  CONTINUE<a name='4764'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RASIT5'>RASIT5</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RASIT5_2">(TRIB,CTNI,CUNI,RA,Z2,Z0,D,ZWIND,UM,                 &amp;<a name='4765'>
                  RHOAIR,TM,U2,USTAR,DRAG,TA,bps,rib,CU,XCT,UV10)<a name='4766'>
<font color=#447700>!======================================================================<a name='4767'></font>
<font color=#447700>!cl    CALL DELHF ( HCDTC, HCDTG, HGDTG, HGDTC )<a name='4768'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF SENSIBLE HEAT FLUXES<a name='4769'></font>
<font color=#447700>!<a name='4770'></font>
      RCP = RHOAIR * CPAIR<a name='4771'>
      D1 = 1./RA + 1./RB + 1./RD<a name='4772'>
      TA = ( TGS/RD + TC/RB + TM/RA *bps) / D1<a name='4773'>
<font color=#447700>!<a name='4774'></font>
      HC = RCP * ( TC - TA ) / RB * DTT<a name='4775'>
      HG = RCP * ( TGS - TA ) / RD * DTT<a name='4776'>
<font color=#447700>!----------------------------------------------------------------------<a name='4777'></font>
<font color=#447700>!     N.B. FLUXES EXPRESSED IN JOULES M-2<a name='4778'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4779'></font>
<font color=#447700>!<a name='4780'></font>
      HCDTC = RCP / RB * ( 1./RA + 1./RD ) / D1<a name='4781'>
      HCDTG = - RCP / ( RB * RD ) / D1<a name='4782'>
<font color=#447700>! FOR TM<a name='4783'></font>
      HCDTM = - RCP / ( RB * RA ) / D1 * BPS<a name='4784'>
<font color=#447700>!<a name='4785'></font>
      HGDTG = RCP / RD * ( 1./RA + 1./RB ) / D1<a name='4786'>
      HGDTC = - RCP / ( RD * RB ) / D1<a name='4787'>
<font color=#447700>! FOR TM<a name='4788'></font>
      HGDTM = - RCP / ( RD * RA ) / D1 *BPS<a name='4789'>
<font color=#447700>!======================================================================<a name='4790'></font>
<font color=#447700>!     CALL DELEF ( ECDTC, ECDTG, EGDTG, EGDTC, DEADTC, DEADTG, EC, EG ,<a name='4791'></font>
<font color=#447700>!    &amp;             WC, WG, FC, FG, HR,MDLSNO,ISNOW )<a name='4792'></font>
<font color=#447700>!======================================================================<a name='4793'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF LATENT HEAT FLUXES<a name='4794'></font>
<font color=#447700>!     MODIFICATION FOR SOIL DRYNESS : HR = REL. HUMIDITY IN TOP LAYER<a name='4795'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4796'></font>
<font color=#447700>!<a name='4797'></font>
      HRR = HR<a name='4798'>
      IF ( FG .LT. .5 ) HRR = 1.<a name='4799'>
<font color=#447700>!<a name='4800'></font>
      RCC = RST(1)*FC + 2. * RB<a name='4801'>
      COC = (1.-WC)/RCC + WC/(2.*RB)<a name='4802'>
      RG = RST(2)*FG<a name='4803'>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='4804'></font>
      IF (ISNOW.eq.0) THEN<a name='4805'>
         RSURF=RSOIL<a name='4806'>
      ELSE<a name='4807'>
         RSURF = RSOIL*FG<a name='4808'>
      END IF<a name='4809'>
      COG1 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)*HRR   &amp;<a name='4810'>
           + VCOVER(2)/(RSURF+RD+44.)*HRR<a name='4811'>
      COG2 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)       &amp;<a name='4812'>
           + VCOVER(2)/(RSURF+RD+44.)<a name='4813'>
      COG1 = COG1 + WG/RD * VCOVER(2)<a name='4814'>
      COG2 = COG2 + WG/RD * VCOVER(2)<a name='4815'>
<font color=#447700>!<a name='4816'></font>
      D2 = 1./RA + COC + COG2<a name='4817'>
      TOP = COC * ETC + COG1 * ETGS + EM/RA<a name='4818'>
      EA = TOP / D2<a name='4819'>
      EC = ( ETC - EA ) * COC * RCP/PSY * DTT<a name='4820'>
      EG = ( ETGS*COG1 - EA*COG2 ) * RCP/PSY * DTT<a name='4821'>
      DEADTC = GETC * COC / D2<a name='4822'>
      DEADTG = GETGS * COG1 / D2<a name='4823'>
<font color=#447700>!<a name='4824'></font>
      ECDTC = ( GETC - DEADTC ) * COC * RCP / PSY<a name='4825'>
      ECDTG = - DEADTG * COC * RCP / PSY<a name='4826'>
<font color=#447700>!<a name='4827'></font>
      EGDTG = ( GETGS*COG1 - DEADTG*COG2 ) * RCP / PSY<a name='4828'>
      EGDTC = - DEADTC * COG2 * RCP / PSY<a name='4829'>
<font color=#447700>!crr<a name='4830'></font>
<font color=#447700>!   FOR QM<a name='4831'></font>
      DEADQM = 0.622 * PSURF /( (0.622+QM)**2 * RA * D2 )<a name='4832'>
      ECDQM =        -DEADQM * COC * RCP / PSY<a name='4833'>
      EGDQM =        -DEADQM * COG2 * RCP / PSY<a name='4834'>
<font color=#447700>!   FOR YPDATING TM AND QM<a name='4835'></font>
      AK = 1/ RCP / BPS<a name='4836'>
      AH = 1/ (HLAT*RHOAIR)<a name='4837'>
<font color=#447700>!crr<a name='4838'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4839'></font>
<font color=#447700>!     CALCULATION OF COEFFICIENTS OF TEMPERATURE TENDENCY EQUATIONS<a name='4840'></font>
<font color=#447700>!        C - CANOPY<a name='4841'></font>
<font color=#447700>!        G - GROUND<a name='4842'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4843'></font>
<font color=#447700>!<a name='4844'></font>
      CCODTC = CCX / DTT - RNCDTC + HCDTC + ECDTC<a name='4845'>
      CCODTG = - RNCDTG + HCDTG + ECDTG<a name='4846'>
      CCORHS = RADT(1) - ( HC + EC ) / DTT<a name='4847'>
<font color=#447700>!----------------------------------------------------------------------<a name='4848'></font>
<font color=#447700>!<a name='4849'></font>
      GCODTG = CG / DTT + TIMCON*CG*2. - RNGDTG + HGDTG + EGDTG<a name='4850'>
      GCODTC = - RNGDTC + HGDTC + EGDTC<a name='4851'>
      GCORHS = RADT(2) - TIMCON*CG*2. * ( TGS -TD ) - ( HG + EG ) / DTT<a name='4852'>
<font color=#447700>!<a name='4853'></font>
      DENOM = CCODTC * GCODTG - CCODTG * GCODTC<a name='4854'>
      DTC = ( CCORHS * GCODTG - CCODTG * GCORHS ) / DENOM<a name='4855'>
      DTG = ( CCODTC * GCORHS - CCORHS * GCODTC ) / DENOM<a name='4856'>
<font color=#447700>!----------------------------------------------------------------------<a name='4857'></font>
<font color=#447700>!     CHECK IF INTERCEPTION LOSS TERM HAS EXCEEDED CANOPY STORAGE<a name='4858'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4859'></font>
<font color=#447700>!<a name='4860'></font>
      ECPOT = ( (ETC - EA) + (GETC - DEADTC)*DTC - DEADTG*DTG )<a name='4861'>
      ECI = ECPOT * WC /(2.*RB) * RCP/PSY * DTT<a name='4862'>
      ECIDIF=AMAX1(0.0,(ECI-CAPAC(1)*1.E3*HLAT))<a name='4863'>
      ECI   =AMIN1(ECI,(    CAPAC(1)*1.E3*HLAT))<a name='4864'>
<font color=#447700>!<a name='4865'></font>
      EGPOT = ( (ETGS - EA) + (GETGS - DEADTG)*DTG - DEADTC*DTC )<a name='4866'>
      EGI = EGPOT * VCOVER(2) * WG/RD * RCP/PSY * DTT<a name='4867'>
      EGIDIF=AMAX1(0.0,(EGI-CAPAC(2)*1.E3*HLAT))<a name='4868'>
      EGI   =AMIN1(EGI,(    CAPAC(2)*1.E3*HLAT))<a name='4869'>
<font color=#447700>!----------------------------------------------------------------------<a name='4870'></font>
      TGEN = TGS + DTG<a name='4871'>
      TCEN = TC + DTC<a name='4872'>
      D1 = 1./RA + 1./RB + 1./RD<a name='4873'>
      TAEN = ( TGEN / RD + TCEN / RB + TM / RA *bps) / D1<a name='4874'>
<font color=#447700>!<a name='4875'></font>
      HEND = ( TAEN - TM ) * RCP / RA + (ECIDIF + EGIDIF)/DTT<a name='4876'>
      Y= TRIB - TAEN<a name='4877'>
      I = I + 1<a name='4878'>
      HT   = HEND<a name='4879'>
      IF ( I .GT. 20 ) GO TO 200<a name='4880'>
<font color=#447700>!cl    IF ( I .GT. ITRUNK ) GO TO 200<a name='4881'></font>
<font color=#447700>!<a name='4882'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#NEWTON'>NEWTON</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEWTON_1">(TRIB,Y,FINC,NOX,NONPOS,IWALK,LX,ZINC,A2,Y1,ITEX)<a name='4883'>
      IF(NOX.NE.1)GO TO 2000<a name='4884'>
200   CONTINUE<a name='4885'>
<font color=#447700>!     IQIN = IQIN + I<a name='4886'></font>
<font color=#447700>!     IF (I.GT.10) IQIN1 = IQIN1 + 1<a name='4887'></font>
<font color=#447700>!<a name='4888'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4889'></font>
<font color=#447700>!     EXIT FROM NON-NEUTRAL CALCULATION<a name='4890'></font>
<font color=#447700>!     EVAPOTRANSPIRATION FLUXES CALCULATED FIRST ( J M-2 )<a name='4891'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4892'></font>
      HRR = HR<a name='4893'>
      IF ( FG .LT. .5 ) HRR = 1.<a name='4894'>
      RSURF = RSOIL*FG<a name='4895'>
<font color=#447700>!<a name='4896'></font>
      COCT = (1.-WC)/RCC<a name='4897'>
      COGT = VCOVER(2) * (1.-WG)/( RG + RD )<a name='4898'>
      COGS1 = (1.-VCOVER(2)) / ( RD + RSURF ) * HRR       &amp;<a name='4899'>
              + VCOVER(2) / ( RD + RSURF + 44.) * HRR<a name='4900'>
      COGS2 = COGS1 / HRR<a name='4901'>
<font color=#447700>!<a name='4902'></font>
      ECT = ECPOT * COCT * RCP/PSY * DTT<a name='4903'>
<font color=#447700>!<a name='4904'></font>
      EGT = EGPOT * COGT * RCP/PSY * DTT<a name='4905'>
      EGS = (ETGS + GETGS*DTG ) * COGS1                   &amp;<a name='4906'>
            - ( EA + DEADTG*DTG + DEADTC*DTC ) * COGS2<a name='4907'>
      EGS = EGS * RCP/PSY * DTT<a name='4908'>
      EGSMAX = WWW(1) / 2. * ZDEPTH(1) * POROS * HLAT * 1000.<a name='4909'>
      EGIADD = AMAX1( 0., EGS - EGSMAX )<a name='4910'>
      EGS = AMIN1 ( EGS, EGSMAX )<a name='4911'>
      EGIDIF = EGIDIF + EGIADD<a name='4912'>
<font color=#447700>!<a name='4913'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4914'></font>
<font color=#447700>!     SENSIBLE HEAT FLUX CALCULATED WITH LATENT HEAT FLUX CORRECTION<a name='4915'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4916'></font>
      HC = HC + (HCDTC*DTC + HCDTG*DTG)*DTT + ECIDIF<a name='4917'>
      HG = HG + (HGDTC*DTC + HGDTG*DTG)*DTT + EGIDIF<a name='4918'>
<font color=#447700>!----------------------------------------------------------------------<a name='4919'></font>
<font color=#447700>!     TEST OF DEW CONDITION. LATENT HEAT FLUXES SET TO ZERO IF SIGN<a name='4920'></font>
<font color=#447700>!     OF FLUX CHANGES OVER TIME STEP.EXCESS ENERGY DONATED TO SENSIBLE<a name='4921'></font>
<font color=#447700>!     HEAT FLUX.<a name='4922'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4923'></font>
      ECF = SIGN( 1., ECPOT )<a name='4924'>
      EGF = SIGN( 1., EGPOT )<a name='4925'>
      DEWC = FC * 2. - 1.<a name='4926'>
      DEWG = FG * 2. - 1.<a name='4927'>
<font color=#447700>!<a name='4928'></font>
      IF(DEWC*ECF.GT.0.0) GO TO 300<a name='4929'>
      HC = HC + ECI + ECT<a name='4930'>
      ECI = 0.<a name='4931'>
      ECT = 0.<a name='4932'>
300   IF(DEWG*EGF.GT.0.0) GO TO 400<a name='4933'>
      HG = HG + EGS + EGI + EGT<a name='4934'>
      EGS = 0.<a name='4935'>
      EGI = 0.<a name='4936'>
      EGT = 0.<a name='4937'>
400   CONTINUE<a name='4938'>
<font color=#447700>!<a name='4939'></font>
      EC = ECI + ECT<a name='4940'>
      EG = EGT + EGS + EGI<a name='4941'>
<font color=#447700>!<a name='4942'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4943'></font>
<font color=#447700>!     ADJUSTMENT OF TEMPERATURES AND VAPOR PRESSURE , CALCULATION OF<a name='4944'></font>
<font color=#447700>!     SENSIBLE HEAT FLUXES.<a name='4945'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='4946'></font>
<font color=#447700>!<a name='4947'></font>
      TC  = TCEN<a name='4948'>
      TGS = TGEN<a name='4949'>
      TA  = TAEN<a name='4950'>
      EA = EA + DEADTC*DTC + DEADTG*DTG<a name='4951'>
<font color=#447700>!<a name='4952'></font>
      RADT(1) = RADT(1) + RNCDTC*DTC + RNCDTG*DTG<a name='4953'>
      RADT(2) = RADT(2) + RNGDTC*DTC + RNGDTG*DTG<a name='4954'>
<font color=#447700>!========================================================================<a name='4955'></font>
      FLUP = FLUP - (RNCDTC+RNGDTC)*DTC - (RNCDTG+RNGDTG)*DTG<a name='4956'>
<font color=#447700>!========================================================================<a name='4957'></font>
<font color=#447700>!<a name='4958'></font>
<font color=#447700>! ** simulated net all-wave radiation **<a name='4959'></font>
<font color=#447700>!     sibnet(nmm,ndd,nhh) = RADT(1) + RADT(2)<a name='4960'></font>
<font color=#447700>!<a name='4961'></font>
      CHF = CCX / DTT * DTC<a name='4962'>
      SHF = CG / DTT * DTG + TIMCON*CG*2. * ( TGS - TD )<a name='4963'>
<font color=#447700>!<a name='4964'></font>
      ZLWUP = ZLWUP - RNCDTC * DTC / 2.                             &amp;<a name='4965'>
                    - RNGDTG * DTG * (1.-VCOVER(1)*(1.-THERMK) )<a name='4966'>
<font color=#447700>!<a name='4967'></font>
      IF ( TGS .GT. TF ) GO TO 500<a name='4968'>
      EGS = EG - EGI<a name='4969'>
      EGT = 0.<a name='4970'>
500   CONTINUE<a name='4971'>
      VCOVER(2) = RESV2<a name='4972'>
      D = RESD<a name='4973'>
      Z0 = RESZ0<a name='4974'>
      RDC = RESRDC<a name='4975'>
      RBC = RESRBC<a name='4976'>
<font color=#447700>!------------------------------------------------------<a name='4977'></font>
      END SUBROUTINE TEMRS1<a name='4978'>
<font color=#447700>!------------------------------------------------------<a name='4979'></font>
<a name='4980'>
<font color=#447700>!=======================================================================<a name='4981'></font>
<font color=#447700>!                                                                       <a name='4982'></font>
<A NAME='TEMRS2'><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4983'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>TEMRS2</font>                                                 &amp; <A href='../../call_to/TEMRS2.html' TARGET='index'>1</A>,<A href='../../call_from/TEMRS2.html' TARGET='index'>6</A><a name='4984'>
        (DTT,TC,TGS,TD,TA,TM,QM,EM,PSURF,WWW,CAPAC,SATCAP,              &amp;<a name='4985'>
         DTC,DTG,RA,RST,ZDEPTH,BEE,PHSAT,POROS,D,Z0,RDC,RBC,VCOVER,     &amp;<a name='4986'>
         Z2,ZLAI,DEFAC,TU,TL,TOPT,RSTFAC,NROOT,ROOTD,PHSOIL,ROOTP,      &amp;<a name='4987'>
         PH1,PH2,ECT,ECI,EGT,EGI,EGS,HC,HG,EC,EG,EA,RADT,CHF,SHF,       &amp;<a name='4988'>
         ALBEDO,ZLWUP,THERMK,RHOAIR,ZWIND,UM,USTAR,DRAG,CCX,CG,         &amp;<a name='4989'>
            ISNOW,CHISL,TSOIL,SOLSOIL,CSOIL,WFSOIL,POROSITY,            &amp;<a name='4990'>
            DZ,DZO,W,WO,WF,TSSN,TSSNO,BW,BWO,CT,CTO,FI,FIO,FL,FLO,      &amp;<a name='4991'>
            BL,BLO,BI,BIO,BT,BTO,DMLT,DMLTO,H,HO,S,SO,SS,SSO,DSOL,DHP,  &amp;<a name='4992'>
            DICEVOL,DLIQVOL,THK,QK,SWE,SNOWDEN,SNOWDEPTH,TKAIR,SNROFF,  &amp;<a name='4993'>
            DZSOIL,BPS,rib,CU,XCT,flup,UV10)<a name='4994'>
<font color=#447700>!<a name='4995'></font>
<font color=#447700>!=======================================================================<a name='4996'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='4997'></font>
<font color=#447700>!     SUBROUTINES IN THIS BLOCK : RASIT5(RBRD1), STRES1,DELRN,TPROPTY,<a name='4998'></font>
<font color=#447700>!     -------------------------   DELHF,DELEF,NEWTON,SNRESULT<a name='4999'></font>
<font color=#447700>!CS------------------ sun Adds Local variables 10/13/98 ----------------<a name='5000'></font>
<font color=#447700>!clwp  12/13/2000, change the dimensions of delth to a certain number &gt; N<a name='5001'></font>
      REAL WORK(N1),WORK1(N1),DELTH(20)<a name='5002'>
      data DELTH/20*0.0/<a name='5003'>
      REAL ZINC(3), A2(3), Y1(3), ITEX(3),RSTM(2)<a name='5004'>
      DIMENSION SSO(N1),POROSITY(N1),H(N1),HO(N1),DZ(N1),DZO(N1),CT(N1),  &amp;<a name='5005'>
                BI(N1),BIO(N1),BW(N1),BWO(N1),BL(N1),BLO(N1),CTO(N1),     &amp;<a name='5006'>
                TSSN(N1),TSSNO(N1),DLIQVOL(N1),DICEVOL(N1),DSOL(N1),      &amp;<a name='5007'>
                W(N1),WO(N1),WF(N1),FI(N1),FIO(N1),FL(N1),FLO(N1),        &amp;<a name='5008'>
                DMLT(N1),DMLTO(N1),BT(N1),BTO(N1),S(N1),SO(N1),SS(N1),    &amp;<a name='5009'>
                PDZDTC(N1),DMASS(N1),THK(N1),DHP(N1),QK(N1)<a name='5010'>
      DIMENSION WWW(3),CAPAC(2),SATCAP(2),ZDEPTH(3),VCOVER(2),ZLAI(2),    &amp;<a name='5011'>
                RADT(2),ALBEDO(2,3,2),TOPT(2),TL(2),TU(2),DEFAC(2),       &amp;<a name='5012'>
                PH1(2),PH2(2),RST(2),RSTFAC(2,4),                         &amp;<a name='5013'>
                ROOTD(2),ROOTP(3),PHSOIL(3)<a name='5014'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='5015'></font>
<font color=#447700>!     E(X) IS VAPOUR PRESSURE IN MBARS AS A FUNCTION OF TEMPERATURE<a name='5016'></font>
<font color=#447700>!     GE(X) IS D E(X) / D ( TEMP )<a name='5017'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='5018'></font>
<font color=#447700>!<a name='5019'></font>
      E(X) = EXP( 21.18123 - 5418. / X ) / .622<a name='5020'>
      GE(X) = EXP( 21.18123 - 5418. / X ) * 5418.       &amp;<a name='5021'>
              / (X*X) / .622<a name='5022'>
<font color=#447700>!<a name='5023'></font>
      ETC   = E(TC)<a name='5024'>
      ETGS  = E(TGS)<a name='5025'>
      GETC  = GE(TC)<a name='5026'>
      GETGS = GE(TGS)<a name='5027'>
<font color=#447700>!crr   HLAT     = ( 3150.19 - 2.378 * TM ) * 1000.<a name='5028'></font>
      PSY      = CPAIR / HLAT * PSURF/ 100. / .622<a name='5029'>
      RCP = RHOAIR   * CPAIR<a name='5030'>
<font color=#447700>!     RADD = 44.<a name='5031'></font>
      WC = AMIN1( 1., CAPAC(1)/SATCAP(1) )<a name='5032'>
<font color=#447700>!CS  SUN CHANGE foolowing  statement to one new 10/13/98<a name='5033'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5034'></font>
      IF (ISNOW.eq.0) THEN<a name='5035'>
        WG=1.0<a name='5036'>
      ELSE<a name='5037'>
        WG = AMIN1( 1., CAPAC(2)/SATCAP(2) )<a name='5038'>
      END IF<a name='5039'>
<font color=#447700>!CS    on 10/13/98<a name='5040'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5041'></font>
<font color=#447700>!      RSOIL FUNCTION FROM FIT TO CAMILLO AND GURNEY (1984) DATA.<a name='5042'></font>
<font color=#447700>!      WETNESS OF UPPER 0.5 CM OF SOIL CALCULATED FROM APPROXIMATION<a name='5043'></font>
<font color=#447700>!      TO MILLY FLOW EQUATION WITH REDUCED (1/50 ) CONDUCTIVITY IN<a name='5044'></font>
<font color=#447700>!      TOP LAYER.<a name='5045'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5046'></font>
<font color=#447700>!<a name='5047'></font>
<font color=#447700>!     WT = WWW(1) + 0.75 * ZDEPTH(1) / ( ZDEPTH(1) + ZDEPTH(2) )<a name='5048'></font>
<font color=#447700>!    &amp;     * (WWW(1) - (WWW(2)**2)/WWW(1) ) / 2. * 50.<a name='5049'></font>
<font color=#447700>!     FAC = AMIN1( WT, 0.99 )<a name='5050'></font>
<font color=#447700>!     FAC = AMAX1( FAC, WWW(1) * 0.1 )<a name='5051'></font>
<font color=#447700>!<a name='5052'></font>
<font color=#447700>!------------------------------------------------------------<a name='5053'></font>
<font color=#447700>! --- soil resistance calculation alteration Y.K. Xue Feb. 1994**<a name='5054'></font>
<font color=#447700>!------------------------------------------------------------<a name='5055'></font>
      FAC = AMIN1( www(1), 0.99 )<a name='5056'>
      FAC = AMAX1( FAC, 0.02 )<a name='5057'>
<font color=#447700>!CS Sun fixed following RSOIL equation as equal to     10/13/98<a name='5058'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5059'></font>
      IF (ISNOW.eq.0) THEN<a name='5060'>
        RSOIL=10000000000.<a name='5061'>
      ELSE<a name='5062'>
        RSOIL =  101840. * (1. - FAC ** 0.0027)<a name='5063'>
      END IF<a name='5064'>
<font color=#447700>!CS                                                   10/13/98<a name='5065'></font>
<font color=#447700>!------------------------------------------------------------<a name='5066'></font>
<font color=#447700>!<a name='5067'></font>
      PSIT = PHSAT * FAC ** (- BEE )<a name='5068'>
      ARGG = AMAX1(-10.,(PSIT*GRAV/461.5/TGS))<a name='5069'>
      HR = EXP(ARGG)<a name='5070'>
<font color=#447700>!CL   2001,1,10 added the following line according to Xue, August 2000<a name='5071'></font>
      PILPHR = HR<a name='5072'>
<font color=#447700>!----------------------------------------------------------------------<a name='5073'></font>
<font color=#447700>!     ALTERATION OF AERODYNAMIC TRANSFER PROPERTIES IN CASE OF SNOW<a name='5074'></font>
<font color=#447700>!     ACCUMULATION.<a name='5075'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5076'></font>
      RESD = D<a name='5077'>
      RESZ0 = Z0<a name='5078'>
      RESRDC = RDC<a name='5079'>
      RESRBC = RBC<a name='5080'>
      RESV2 = VCOVER(2)<a name='5081'>
<font color=#447700>!<a name='5082'></font>
      IF ( TGS .GT. TF ) GO TO 100<a name='5083'>
<font color=#447700>!CS Sun Change following statement into another one: SDEP=snowdepth  10/13/98<a name='5084'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5085'></font>
      IF (ISNOW.eq.0) THEN<a name='5086'>
         SDEP = SNOWDEPTH<a name='5087'>
      ELSE<a name='5088'>
         SDEP = CAPAC(2) * SNOWDEN<a name='5089'>
      END IF<a name='5090'>
<font color=#447700>!CS                                    10/13/98<a name='5091'></font>
      SDEP = AMIN1( SDEP, (Z2*0.95) )<a name='5092'>
      D = Z2 - ( Z2-D ) / Z2 * ( Z2 - SDEP )<a name='5093'>
      Z0 = Z0 / ( Z2-RESD ) * ( Z2-D )<a name='5094'>
      RDC = RDC * ( Z2-SDEP ) / Z2<a name='5095'>
      RBC = RBC * Z2 / ( Z2-SDEP )<a name='5096'>
      VCOVER(2) = 1.<a name='5097'>
<font color=#447700>!CS  Sun added the following IF,change the WG to WG=1.0   10/13/98<a name='5098'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5099'></font>
      IF (ISNOW.eq.0) THEN<a name='5100'>
        WG=1.0<a name='5101'>
      ELSE<a name='5102'>
        WG = AMIN1( 1., CAPAC(2) / 0.004 )<a name='5103'>
      END IF<a name='5104'>
      RST(2) = RSOIL<a name='5105'>
100   CONTINUE<a name='5106'>
<font color=#447700>!----------------------------------------------------------------------<a name='5107'></font>
<font color=#447700>!<a name='5108'></font>
<font color=#447700>!      CALCULATION OF EA, TA, RA, RB, RD AND SOIL MOISTURE STRESS<a name='5109'></font>
<font color=#447700>!      FOR THE BEGINNING OF THE TIME STEP<a name='5110'></font>
<font color=#447700>!<a name='5111'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5112'></font>
      IFIRST = 1<a name='5113'>
      ICOUNT = 0<a name='5114'>
      TGEN = TGS<a name='5115'>
      TCEN = TC<a name='5116'>
      FC = 1.<a name='5117'>
      FG = 1.<a name='5118'>
      TRIB = TA<a name='5119'>
      EA = EM<a name='5120'>
<font color=#447700>!cl    TA = TM<a name='5121'></font>
      HT = 0.<a name='5122'>
      IONCE = 0<a name='5123'>
1000  CONTINUE<a name='5124'>
      ICOUNT = ICOUNT + 1<a name='5125'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RASIT5'>RASIT5</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RASIT5_3">(TRIB,CTNI,CUNI,RA,Z2,Z0,D,ZWIND,UM,                 &amp;<a name='5126'>
                  RHOAIR,TM,U2,USTAR,DRAG,TA,bps,rib,CU,XCT,UV10)<a name='5127'>
<font color=#447700>!cl    ------------IF ( IFIRST .EQ. 1 ) CALL RBRD1 ------------<a name='5128'></font>
        IF ( IFIRST .EQ. 1 ) THEN<a name='5129'>
<font color=#447700>!cl      TCTA = TC - TA<a name='5130'></font>
        RB  = 1.0/(SQRT(U2)/RBC+ZLAI(1)*.004)<a name='5131'>
<font color=#447700>!cl      X1 = TEMDIF<a name='5132'></font>
        TGTA = TGS- TA<a name='5133'>
        TEMDIF = ( TGTA + SQRT(TGTA*TGTA) ) / 2. + 0.1<a name='5134'>
        FIH = SQRT( 1. + 9. * GRAV *TEMDIF * Z2 / TGS / ( U2*U2) )<a name='5135'>
        RD  = RDC / U2 / FIH<a name='5136'>
        ENDIF<a name='5137'>
<font color=#447700>!cl    ------------ END OF RBRD1 ---------------<a name='5138'></font>
      D1 = 1./RA + 1./RB + 1./RD<a name='5139'>
      TA = ( TGS/RD + TC/RB + TM/RA *bps) / D1<a name='5140'>
      HT = ( TA - TM ) * RCP / RA<a name='5141'>
      RCC = RST(1)*FC + 2. * RB<a name='5142'>
      COC = (1.-WC)/RCC + WC/(2.*RB)<a name='5143'>
      RG = RST(2)*FG<a name='5144'>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5145'></font>
      IF (ISNOW.eq.0) THEN<a name='5146'>
           RSURF = RSOIL<a name='5147'>
      ELSE<a name='5148'>
           RSURF = RSOIL*FG<a name='5149'>
      END IF<a name='5150'>
      COG1 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)*HR     &amp;<a name='5151'>
             + VCOVER(2)/(RSURF+RD+44.)*HR<a name='5152'>
      COG2 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)        &amp;<a name='5153'>
             + VCOVER(2)/(RSURF+RD+44.)<a name='5154'>
      COG1 = COG1 + WG/RD * VCOVER(2)<a name='5155'>
      COG2 = COG2 + WG/RD * VCOVER(2)<a name='5156'>
      D2 = 1./RA + COC + COG2<a name='5157'>
      TOP = COC * ETC + COG1 * ETGS + EM / RA<a name='5158'>
      EA = TOP / D2<a name='5159'>
      DROP = AMAX1( 0., (E(TA)-EA) )<a name='5160'>
<font color=#447700>!<a name='5161'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5162'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#STRES1'>STRES1</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STRES1_2"> (IFIRST, RSTM,ROOTP,                             &amp;<a name='5163'>
           RSTFAC,RST,TC,ETC,RB,TGS,ETGS,RD,TU,TL,TOPT,EA,         &amp;<a name='5164'>
           DEFAC,PH1,PH2,NROOT,ZDEPTH,PHSOIL,ROOTD,VCOVER,DROP)<a name='5165'>
<font color=#447700>!----------------------------------------------------------------------<a name='5166'></font>
<font color=#447700>!<a name='5167'></font>
      IFIRST = 0<a name='5168'>
      ERIB = EA<a name='5169'>
      TRIB = TA<a name='5170'>
<font color=#447700>!!!<a name='5171'></font>
      IF ( ICOUNT .LE. 4 ) GO TO 1000<a name='5172'>
<font color=#447700>!======================================================================<a name='5173'></font>
<font color=#447700>!cl    CALL DELRN ( RNCDTC, RNCDTG, RNGDTG, RNGDTC )<a name='5174'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF RADIATIVE AND SENSIBLE HEAT FLUXES<a name='5175'></font>
      TC3 = TC * TC * TC<a name='5176'>
      TG3 = TGS * TGS * TGS<a name='5177'>
      FAC1 = ( 1. - ALBEDO(1,3,2) ) * ( 1.-THERMK ) * VCOVER(1)<a name='5178'>
      FAC2 =   1. - ALBEDO(2,3,2)<a name='5179'>
      RNCDTC = - 2. * 4. * FAC1 * STEFAN * TC3<a name='5180'>
      RNCDTG = 4. * FAC1 * FAC2 * STEFAN * TG3<a name='5181'>
      RNGDTG = - 4. * FAC2 * STEFAN * TG3<a name='5182'>
      RNGDTC = 4. * FAC1 * FAC2 * STEFAN * TC3<a name='5183'>
<font color=#447700>!----------------------------------------------------------------------<a name='5184'></font>
<font color=#447700>!<a name='5185'></font>
<font color=#447700>!     DEW CALCULATION : DEW CONDITION IS SET AT BEGINNING OF TIME STEP.<a name='5186'></font>
<font color=#447700>!     IF SURFACE CHANGES STATE DURING TIME STEP, LATENT HEAT FLUX IS<a name='5187'></font>
<font color=#447700>!     SET TO ZERO.<a name='5188'></font>
<font color=#447700>!<a name='5189'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5190'></font>
<font color=#447700>!<a name='5191'></font>
      IF ( EA .GT. ETC ) FC = 0.<a name='5192'>
      IF ( EA .GT. ETGS) FG = 0.<a name='5193'>
<font color=#447700>!<a name='5194'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5195'></font>
<font color=#447700>!<a name='5196'></font>
<font color=#447700>!     WET FRACTION EXHAUSTION TEST : IF CAPAC(X) IS EXHAUSTED IN<a name='5197'></font>
<font color=#447700>!     A TIME STEP, INTERCEPTION LOSS IS LIMITED TO CAPAC(X).<a name='5198'></font>
<font color=#447700>!<a name='5199'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5200'></font>
<font color=#447700>!     START OF NON-NEUTRAL RESISTANCE CALCULATION LOOP<a name='5201'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5202'></font>
<font color=#447700>!<a name='5203'></font>
      II = 0<a name='5204'>
<font color=#447700>!<a name='5205'></font>
<font color=#447700>!    ----- INITIALIZE NEWTON-RAPHSON ITERATIVE ROUTINE FOR RASIT 3,5,8<a name='5206'></font>
                    NOX = 0<a name='5207'>
                 NONPOS = 1<a name='5208'>
                  IWALK = 0<a name='5209'>
                     LX = 2<a name='5210'>
                   FINC = 1.<a name='5211'>
                   ITEX(LX) = 0.<a name='5212'>
                   ZINC(LX) = 0.<a name='5213'>
                   A2(LX)   = 0.<a name='5214'>
                   Y1(LX)   = 0.<a name='5215'>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5216'></font>
      IF (ISNOW.eq.0) THEN<a name='5217'>
<font color=#447700>!---------------------------------------------------------<a name='5218'></font>
<font color=#447700>! Next loop, we calculate the thermal conductivities<a name='5219'></font>
<font color=#447700>! and specific heat<a name='5220'></font>
<font color=#447700>!---------------------------------------------------------<a name='5221'></font>
         CALL  <A href='../../html_code/phys/module_sf_ssib.F.html#TPROPTY'>TPROPTY</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TPROPTY_1">(CHISL,BWO,DZO,TKAIR,DZSOIL,  THK,QK)<a name='5222'>
<font color=#447700>!------------------------------------------------------------<a name='5223'></font>
<font color=#447700>! Next we calculate the balances of energy and water<a name='5224'></font>
<font color=#447700>!------------------------------------------------------------<a name='5225'></font>
         tssn(n+1) = tkair<a name='5226'>
<font color=#447700>!------------------------------------------------------------<a name='5227'></font>
         icount = 0<a name='5228'>
         do i=1,n<a name='5229'>
           work(i)   = tssno(i)<a name='5230'>
           work1(i)  = dliqvol(i)<a name='5231'>
         end do<a name='5232'>
         hx    = 0.0<a name='5233'>
         NK=n<a name='5234'>
      ELSE<a name='5235'>
         NK=1<a name='5236'>
      END IF<a name='5237'>
         RADDWN=solsoil<a name='5238'>
         RADDWN=RADDWN+dsol(1)+dsol(2)<a name='5239'>
         RNG = RADT(2) - RADDWN<a name='5240'>
         RADT(2)=RNG<a name='5241'>
      do 57 ik = NK , 1 , -1<a name='5242'>
<font color=#447700>!cccc Next calculate snow layers temperatures and densities<a name='5243'></font>
       IF (ISNOW.ne.0) go to 2000<a name='5244'>
         If((sso(ik).lt.1d0.and.porosity(ik).gt.0d0))then<a name='5245'>
	    udum0 = dzo(ik)*(porosity(ik) -work1(ik))<a name='5246'>
	    if(udum0.lt.0.0) then<a name='5247'>
            print*,' udum0 is WRONG in thermal.f'<a name='5248'>
            STOP<a name='5249'>
            endif<a name='5250'>
	    if(wf(ik+1).gt.udum0)then<a name='5251'>
	       uuu=udum0<a name='5252'>
	       snroff = snroff + (wf(ik+1)-udum0)<a name='5253'>
      hroff=hroff+(wf(ik+1)-udum0)*cl*rhowater*(tssn(ik+1)-273.16)<a name='5254'>
	    else<a name='5255'>
	       uuu=wf(ik+1)<a name='5256'>
	    endif<a name='5257'>
            dhp(ik+1)=(uuu*cl*rhowater*(tssn(ik+1)-273.16))/dtt<a name='5258'>
	    w(ik)=wo(ik)+ uuu<a name='5259'>
            bwo(ik)=rhowater*w(ik)/dzo(ik)<a name='5260'>
            cto(ik)=(bwo(ik)/920.0)*1.9e+6<a name='5261'>
            dmlto(ik)=w(ik)*dlm*rhowater<a name='5262'>
            if (ho(ik).lt.-dmlto(ik)) then<a name='5263'>
             fio(ik)=1.0<a name='5264'>
             flo(ik)=0.0<a name='5265'>
             tssno(ik)=( ho(ik)+dmlto(ik))/(cto(ik)*dzo(ik))+273.16<a name='5266'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='5267'></font>
            else<a name='5268'>
               tssno(ik)=273.16<a name='5269'>
               fio(ik)=-ho(ik)/dmlto(ik)<a name='5270'>
               flo(ik)=1.0-fio(ik)<a name='5271'>
            end if<a name='5272'>
            blo(ik)=bwo(ik)*flo(ik)<a name='5273'>
            bio(ik)=bwo(ik)*fio(ik)<a name='5274'>
            dliqvol(ik)=blo(ik)/rhowater<a name='5275'>
            dicevol(ik)=bio(ik)/dice<a name='5276'>
         Else<a name='5277'>
	    w(ik)=wo(ik)<a name='5278'>
            snroff = snroff +wf(ik+1)<a name='5279'>
      hroff=hroff+wf(ik+1)*cl*rhowater*(tssn(ik+1)-273.16)<a name='5280'>
            dhp(ik+1) = 0.0<a name='5281'>
         End if<a name='5282'>
<font color=#447700>!cs  Sun add. It is important because tssno(n) is changed here on 1/25/99 .<a name='5283'></font>
         TGS=tssno(NK)<a name='5284'>
<font color=#447700>!cs  0n 1/25/99<a name='5285'></font>
<font color=#447700>!------------------------------------------------------------*<a name='5286'></font>
         If (ik.lt.Nk) Then<a name='5287'>
<font color=#447700>! Next:  ik &lt; n<a name='5288'></font>
           if(ik.ne.1) then<a name='5289'>
	     b1 = dsol(ik) + delth(ik)       &amp;<a name='5290'>
                + qk(ik+1)*(tssn(ik+1)-tssno(ik)) + qk(ik)*work(ik-1)<a name='5291'>
           else<a name='5292'>
	     b1 = dsol(ik) + delth(ik)       &amp;<a name='5293'>
                + qk(ik+1)*(tssn(ik+1)-tssno(ik)) + qk(ik)*tsoil<a name='5294'>
           endif<a name='5295'>
<font color=#447700>!<a name='5296'></font>
	   b2 = - qk(ik)<a name='5297'>
<font color=#447700>! Important: delth(ik) must be initialized after using.<a name='5298'></font>
           delth(ik) = 0.0<a name='5299'>
         End if<a name='5300'>
         dmlt(ik)=w(ik)*dlm*rhowater<a name='5301'>
         If (ik.lt.NK.and.ik.ge.1) Then<a name='5302'>
            fff = -( ho(ik) + (b1+b2*273.16)*dtt )     &amp;<a name='5303'>
      	          / ( rhowater*dlm*w(ik) )<a name='5304'>
<font color=#447700>! when snow temperature equals 273.16<a name='5305'></font>
<font color=#447700>!!<a name='5306'></font>
            if(fff.gt.0.0.and.fff.le.1.0) then<a name='5307'>
                 ICASE=2<a name='5308'>
                 fi(ik)=fff<a name='5309'>
            else if (fff.gt.1.0) then<a name='5310'>
                 ICASE=1<a name='5311'>
            else if (fff.le.0.0) then<a name='5312'>
                 ICASE=3<a name='5313'>
            end if<a name='5314'>
        End if<a name='5315'>
        If (ik.lt.NK) go to 3000<a name='5316'>
<font color=#447700>!<a name='5317'></font>
<font color=#447700>!CS     Sun add  above paragraph        on 10/13/98<a name='5318'></font>
2000  CONTINUE<a name='5319'>
<font color=#447700>!<a name='5320'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#RASIT5'>RASIT5</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RASIT5_4">(TRIB,CTNI,CUNI,RA,Z2,Z0,D,ZWIND,UM,                 &amp;<a name='5321'>
                  RHOAIR,TM,U2,USTAR,DRAG,TA,bps,rib,CU,XCT,UV10)<a name='5322'>
<font color=#447700>!----------------------------------------------------------------------<a name='5323'></font>
<font color=#447700>!cl    CALL DELHF ( HCDTC, HCDTG, HGDTG, HGDTC )<a name='5324'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF SENSIBLE HEAT FLUXES<a name='5325'></font>
<font color=#447700>!<a name='5326'></font>
      RCP = RHOAIR * CPAIR<a name='5327'>
      D1 = 1./RA + 1./RB + 1./RD<a name='5328'>
      TA = ( TGS/RD + TC/RB + TM/RA *bps) / D1<a name='5329'>
<font color=#447700>!<a name='5330'></font>
      HC = RCP * ( TC - TA ) / RB * DTT<a name='5331'>
      HG = RCP * ( TGS - TA ) / RD * DTT<a name='5332'>
<font color=#447700>!----------------------------------------------------------------------<a name='5333'></font>
<font color=#447700>!     N.B. FLUXES EXPRESSED IN JOULES M-2<a name='5334'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5335'></font>
<font color=#447700>!<a name='5336'></font>
      HCDTC = RCP / RB * ( 1./RA + 1./RD ) / D1<a name='5337'>
      HCDTG = - RCP / ( RB * RD ) / D1<a name='5338'>
<font color=#447700>! FOR TM<a name='5339'></font>
      HCDTM = - RCP / ( RB * RA ) / D1 * BPS<a name='5340'>
<font color=#447700>!<a name='5341'></font>
      HGDTG = RCP / RD * ( 1./RA + 1./RB ) / D1<a name='5342'>
      HGDTC = - RCP / ( RD * RB ) / D1<a name='5343'>
<font color=#447700>! FOR TM<a name='5344'></font>
      HGDTM = - RCP / ( RD * RA ) / D1 *BPS<a name='5345'>
<font color=#447700>!======================================================================<a name='5346'></font>
<font color=#447700>!     CALL DELEF ( ECDTC, ECDTG, EGDTG, EGDTC, DEADTC, DEADTG, EC, EG ,<a name='5347'></font>
<font color=#447700>!    &amp;             WC, WG, FC, FG, HR,MDLSNO,ISNOW )<a name='5348'></font>
<font color=#447700>!<a name='5349'></font>
<font color=#447700>!     PARTIAL DERIVATIVES OF LATENT HEAT FLUXES<a name='5350'></font>
<font color=#447700>!     MODIFICATION FOR SOIL DRYNESS : HR = REL. HUMIDITY IN TOP LAYER<a name='5351'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5352'></font>
<font color=#447700>!<a name='5353'></font>
      HRR = HR<a name='5354'>
      IF ( FG .LT. .5 ) HRR = 1.<a name='5355'>
<font color=#447700>!<a name='5356'></font>
      RCC = RST(1)*FC + 2. * RB<a name='5357'>
      COC = (1.-WC)/RCC + WC/(2.*RB)<a name='5358'>
      RG = RST(2)*FG<a name='5359'>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5360'></font>
      IF (ISNOW.eq.0) THEN<a name='5361'>
         RSURF=RSOIL<a name='5362'>
      ELSE<a name='5363'>
         RSURF = RSOIL*FG<a name='5364'>
      END IF<a name='5365'>
      COG1 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)*HRR      &amp;<a name='5366'>
           + VCOVER(2)/(RSURF+RD+44.)*HRR<a name='5367'>
      COG2 = VCOVER(2)*(1.-WG)/(RG+RD)+(1.-VCOVER(2))/(RSURF+RD)          &amp;<a name='5368'>
           + VCOVER(2)/(RSURF+RD+44.)<a name='5369'>
      COG1 = COG1 + WG/RD * VCOVER(2)<a name='5370'>
      COG2 = COG2 + WG/RD * VCOVER(2)<a name='5371'>
<font color=#447700>!<a name='5372'></font>
      D2 = 1./RA + COC + COG2<a name='5373'>
      TOP = COC * ETC + COG1 * ETGS + EM/RA<a name='5374'>
      EA = TOP / D2<a name='5375'>
      EC = ( ETC - EA ) * COC * RCP/PSY * DTT<a name='5376'>
      EG = ( ETGS*COG1 - EA*COG2 ) * RCP/PSY * DTT<a name='5377'>
      DEADTC = GETC * COC / D2<a name='5378'>
      DEADTG = GETGS * COG1 / D2<a name='5379'>
<font color=#447700>!<a name='5380'></font>
      ECDTC = ( GETC - DEADTC ) * COC * RCP / PSY<a name='5381'>
      ECDTG = - DEADTG * COC * RCP / PSY<a name='5382'>
<font color=#447700>!<a name='5383'></font>
      EGDTG = ( GETGS*COG1 - DEADTG*COG2 ) * RCP / PSY<a name='5384'>
      EGDTC = - DEADTC * COG2 * RCP / PSY<a name='5385'>
<font color=#447700>!crr<a name='5386'></font>
<font color=#447700>!   FOR QM<a name='5387'></font>
      DEADQM = 0.622 * PSURF /( (0.622+QM)**2 * RA * D2 )<a name='5388'>
      ECDQM =        -DEADQM * COC * RCP / PSY<a name='5389'>
      EGDQM =        -DEADQM * COG2 * RCP / PSY<a name='5390'>
<font color=#447700>!   FOR YPDATING TM AND QM<a name='5391'></font>
      AK = 1/ RCP / BPS<a name='5392'>
      AH = 1/ (HLAT*RHOAIR)<a name='5393'>
<font color=#447700>!crr<a name='5394'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5395'></font>
<font color=#447700>!<a name='5396'></font>
<font color=#447700>!     CALCULATION OF COEFFICIENTS OF TEMPERATURE TENDENCY EQUATIONS<a name='5397'></font>
<font color=#447700>!        C - CANOPY,    G - GROUND<a name='5398'></font>
<font color=#447700>!<a name='5399'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5400'></font>
<font color=#447700>!<a name='5401'></font>
      CCODTC = CCX / DTT - RNCDTC + HCDTC + ECDTC<a name='5402'>
      CCODTG = - RNCDTG + HCDTG + ECDTG<a name='5403'>
      CCORHS = RADT(1) - ( HC + EC ) / DTT<a name='5404'>
<font color=#447700>!<a name='5405'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5406'></font>
<font color=#447700>!CS Sun Change following original GCODCG into new one     10/13/98<a name='5407'></font>
      IF (ISNOW.eq.0) THEN<a name='5408'>
          GCODTG= cto(n)*dzo(n)/DTT - RNGDTG + HGDTG + EGDTG + qk(n)<a name='5409'>
      ELSE<a name='5410'>
          GCODTG = CG / DTT + TIMCON*CG*2. - RNGDTG + HGDTG + EGDTG<a name='5411'>
      END IF<a name='5412'>
      GCODTC = - RNGDTC + HGDTC + EGDTC<a name='5413'>
<font color=#447700>!CS  From NOW ON WE REALLY GET INTO SNOW PART    !!!!. ON 10/13/98<a name='5414'></font>
<font color=#447700>!cl    IF (MDLSNO.ne.0.or.ISNOW.ne.0) THEN<a name='5415'></font>
      IF (ISNOW.ne.0) THEN<a name='5416'>
        GCORHS = RADT(2)-TIMCON*CG*2.*( TGS -TD )-( HG + EG )/ DTT<a name='5417'>
      ELSE<a name='5418'>
         fi(n)=1.0<a name='5419'>
         GCORHS1 = ho(n)/DTT+RNG - ( HG + EG ) / DTT +dhp(n+1)            &amp;<a name='5420'>
         - qk(n)*(TGS     -tssno(n-1))-cto(n)*dzo(n)*(tssno(n)-273.16)/DTT<a name='5421'>
         GCORHS = GCORHS1+ rhowater*dlm*w(n)*fi(n)/DTT<a name='5422'>
      END IF<a name='5423'>
<font color=#447700>!<a name='5424'></font>
      DENOM = CCODTC * GCODTG - CCODTG * GCODTC<a name='5425'>
<font color=#447700>!<a name='5426'></font>
      DTC = ( CCORHS * GCODTG - CCODTG * GCORHS ) / DENOM<a name='5427'>
      DTG = ( CCODTC * GCORHS - CCORHS * GCODTC ) / DENOM<a name='5428'>
<font color=#447700>!CS  Sun add following part here for inserting snow routing on 10/13/98<a name='5429'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5430'></font>
      IF (ISNOW.eq.0) THEN<a name='5431'>
        If ((TGS+DTG).le.273.16) Then<a name='5432'>
         TGSNEW=(TGS+DTG)<a name='5433'>
         ICASE=1<a name='5434'>
<font color=#447700>!cs Sun debug on 1998/12/14  end<a name='5435'></font>
<font color=#447700>! ------------------------------------------------------------------7272<a name='5436'></font>
         h(NK)=( TGSNEW-273.16)*cto(n)*dzo(n)-fi(NK)*w(NK)*dlm*rhowater<a name='5437'>
         Dh_DTT_DTG=(h(NK)-ho(NK))/DTT<a name='5438'>
         tonm1=tssno(NK-1)<a name='5439'>
         qkn=qk(n)<a name='5440'>
        Else<a name='5441'>
          DTG=273.16-TGS<a name='5442'>
          DTC= (CCORHS - CCODTG*DTG)/CCODTC<a name='5443'>
      fi(NK)=(GCODTC*DTC+GCODTG*DTG-GCORHS1)/(rhowater*dlm*w(n))*DTT<a name='5444'>
          if (fi(NK).ge.0.0.and.fi(NK).le.1.0) then<a name='5445'>
             h(NK)=-fi(n)*w(n)*dlm*rhowater<a name='5446'>
             Dh_DTT_DTG=(h(NK)-ho(NK))/DTT<a name='5447'>
             ICASE=2<a name='5448'>
             tonm1=tssno(NK-1)<a name='5449'>
             qkn=qk(n)<a name='5450'>
          else if (fi(NK).lt.0.)then<a name='5451'>
             h(NK)= -fi(NK)*w(NK)*dlm*rhowater<a name='5452'>
             Dh_DTT_DTG=(h(NK)-ho(NK))/DTT<a name='5453'>
             ICASE=3<a name='5454'>
             tonm1=tssno(NK-1)<a name='5455'>
             qkn=qk(n)<a name='5456'>
             fff=fi(NK)<a name='5457'>
             fi(NK)=0.0<a name='5458'>
          end if<a name='5459'>
        End if<a name='5460'>
      END IF<a name='5461'>
<font color=#447700>!----------------------------------------------------------------------<a name='5462'></font>
<font color=#447700>!     CHECK IF INTERCEPTION LOSS TERM HAS EXCEEDED CANOPY STORAGE<a name='5463'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5464'></font>
<font color=#447700>!<a name='5465'></font>
      ECPOT = ( (ETC - EA) + (GETC - DEADTC)*DTC - DEADTG*DTG )<a name='5466'>
      ECI = ECPOT * WC /(2.*RB) * RCP/PSY * DTT<a name='5467'>
      ECIDIF=AMAX1(0.0,(ECI-CAPAC(1)*1.E3*HLAT))<a name='5468'>
      ECI   =AMIN1(ECI,(    CAPAC(1)*1.E3*HLAT))<a name='5469'>
<font color=#447700>!<a name='5470'></font>
      EGPOT = ( (ETGS - EA) + (GETGS - DEADTG)*DTG - DEADTC*DTC )<a name='5471'>
      EGI = EGPOT * VCOVER(2) * WG/RD * RCP/PSY * DTT<a name='5472'>
      EGIDIF=AMAX1(0.0,(EGI-CAPAC(2)*1.E3*HLAT))<a name='5473'>
      EGI   =AMIN1(EGI,(    CAPAC(2)*1.E3*HLAT))<a name='5474'>
<font color=#447700>!<a name='5475'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5476'></font>
      TGEN = TGS + DTG<a name='5477'>
      TCEN = TC + DTC<a name='5478'>
      D1 = 1./RA + 1./RB + 1./RD<a name='5479'>
      TAEN = ( TGEN / RD + TCEN / RB + TM / RA *bps) / D1<a name='5480'>
<font color=#447700>!<a name='5481'></font>
      HEND = ( TAEN - TM ) * RCP / RA + (ECIDIF + EGIDIF)/DTT<a name='5482'>
      Y= TRIB - TAEN<a name='5483'>
      II = II + 1<a name='5484'>
      HT   = HEND<a name='5485'>
      IF ( II .GT. 20 ) GO TO 200<a name='5486'>
<font color=#447700>!CL    IF ( II .GT. ITRUNK ) GO TO 200<a name='5487'></font>
<font color=#447700>!<a name='5488'></font>
<font color=#447700>!CL    CALL NEWTON(TRIB,Y,FINC,NOX,NONPOS,IWALK,LX)<a name='5489'></font>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#NEWTON'>NEWTON</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEWTON_2">(TRIB,Y,FINC,NOX,NONPOS,IWALK,LX,ZINC,A2,Y1,ITEX)<a name='5490'>
<font color=#447700>!<a name='5491'></font>
      IF(NOX.NE.1)GO TO 2000<a name='5492'>
200   CONTINUE<a name='5493'>
<font color=#447700>!CS  Sun add following part here for inserting snow routing on 10/13/98<a name='5494'></font>
<font color=#447700>!cl 3000  IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5495'></font>
 3000  IF (ISNOW.eq.0) THEN<a name='5496'>
         IF (ICASE.eq.1.and.ik.eq.NK) THEN<a name='5497'>
            tssn(NK)=TGS+DTG<a name='5498'>
         END IF<a name='5499'>
         If (ik.eq.NK) then<a name='5500'>
            SNOFAC = HLAT / (HLAT + SNOMEL /1000.)<a name='5501'>
            egidw = EGI*SNOFAC /HLAT/1000.<a name='5502'>
<font color=#447700>!           egidw= EGI/HLAT/1000.<a name='5503'></font>
            w(n)=w(n)-egidw<a name='5504'>
            swe=swe-egidw<a name='5505'>
            dzold=dzo(n)<a name='5506'>
            dzo(n)=dzo(n)-egidw*rhowater/bwo(n)<a name='5507'>
<font color=#447700>!cs sun: following way to correct h(n) may lead to unballance of energy.<a name='5508'></font>
             ho(n)=ho(n)*dzo(n)/dzold<a name='5509'>
             capac(2)=swe<a name='5510'>
         End if<a name='5511'>
      CALL <A href='../../html_code/phys/module_sf_ssib.F.html#SNRESULT'>SNRESULT</A><A href='../../html_code/phys/module_sf_ssib.F.html#TEMRS2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SNRESULT_1">(DTT,IK,ICASE,WFSOIL,TSOIL,B1,B2,FFF,DELTH,WWW,         &amp;<a name='5512'>
                   ZDEPTH,POROS,BI,BIO,DZ,DZO,W,BW,BWO,H,HO,QK,BL,BT,CT,   &amp;<a name='5513'>
                   FI,FL,WF,TSSN,DLIQVOL,DICEVOL,SNROFF,HROFF,QSOIL)<a name='5514'>
      END IF<a name='5515'>
 57   CONTINUE<a name='5516'>
<font color=#447700>! ------------------------------------------------------------------7272<a name='5517'></font>
<font color=#447700>!clwp  11/17/2000, Li add following sentence to recalculate the snowdepth<a name='5518'></font>
        SNOWDEPTH=DZO(1)+DZO(2)+DZO(3)<a name='5519'>
<font color=#447700>!clwp  11/17/2000, Li add above sentence to recalculate the snowdepth<a name='5520'></font>
<font color=#447700>!CS sun add following parts on 12/5/98   start<a name='5521'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5522'></font>
      IF (ISNOW.eq.0) THEN<a name='5523'>
        SWE=W(1)+W(2)+W(3)<a name='5524'>
        CAPAC(2)=SWE<a name='5525'>
        IF((DZ(1)+DZ(2)+DZ(3)).NE.0.0) THEN<a name='5526'>
        SNOWDEN=(BW(1)*DZ(1)+BW(2)*DZ(2)+BW(3)*DZ(3))        &amp;<a name='5527'>
                     /(DZ(1)+DZ(2)+DZ(3))<a name='5528'>
        SNOWDEN=1000./SNOWDEN<a name='5529'>
        ENDIF<a name='5530'>
      ENDIF<a name='5531'>
<font color=#447700>!CS sun add above  parts on 12/5/98  end<a name='5532'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5533'></font>
<font color=#447700>!     EXIT FROM NON-NEUTRAL CALCULATION<a name='5534'></font>
<font color=#447700>!<a name='5535'></font>
<font color=#447700>!     EVAPOTRANSPIRATION FLUXES CALCULATED FIRST ( J M-2 )<a name='5536'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5537'></font>
      HRR = HR<a name='5538'>
      IF ( FG .LT. .5 ) HRR = 1.<a name='5539'>
<font color=#447700>!cs SUn change RSURF = RSOIL*FG into followings: 02/03/99 start<a name='5540'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5541'></font>
      IF (ISNOW.eq.0) THEN<a name='5542'>
           RSURF = RSOIL<a name='5543'>
      ELSE<a name='5544'>
           RSURF = RSOIL*FG<a name='5545'>
      END IF<a name='5546'>
<font color=#447700>!cs sun 03/02/99  end<a name='5547'></font>
<font color=#447700>!<a name='5548'></font>
      COCT = (1.-WC)/RCC<a name='5549'>
      COGT = VCOVER(2) * (1.-WG)/( RG + RD )<a name='5550'>
      COGS1 = (1.-VCOVER(2)) / ( RD + RSURF ) * HRR         &amp;<a name='5551'>
              + VCOVER(2) / ( RD + RSURF + 44.) * HRR<a name='5552'>
      COGS2 = COGS1 / HRR<a name='5553'>
<font color=#447700>!<a name='5554'></font>
      ECT = ECPOT * COCT * RCP/PSY * DTT<a name='5555'>
<font color=#447700>!<a name='5556'></font>
      EGT = EGPOT * COGT * RCP/PSY * DTT<a name='5557'>
      EGS = (ETGS + GETGS*DTG ) * COGS1         &amp;<a name='5558'>
            - ( EA + DEADTG*DTG + DEADTC*DTC ) * COGS2<a name='5559'>
      EGS = EGS * RCP/PSY * DTT<a name='5560'>
<font color=#447700>!CS  Sun add following IF statement on 10/13/98<a name='5561'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) EGS=0.0<a name='5562'></font>
      IF (ISNOW.eq.0) EGS=0.0<a name='5563'>
      EGSMAX = WWW(1) / 2. * ZDEPTH(1) * POROS * HLAT * 1000.<a name='5564'>
      EGIADD = AMAX1( 0., EGS - EGSMAX )<a name='5565'>
      EGS = AMIN1 ( EGS, EGSMAX )<a name='5566'>
      EGIDIF = EGIDIF + EGIADD<a name='5567'>
<font color=#447700>!<a name='5568'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5569'></font>
<font color=#447700>!     SENSIBLE HEAT FLUX CALCULATED WITH LATENT HEAT FLUX CORRECTION<a name='5570'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5571'></font>
      HC = HC + (HCDTC*DTC + HCDTG*DTG)*DTT + ECIDIF<a name='5572'>
      HG = HG + (HGDTC*DTC + HGDTG*DTG)*DTT + EGIDIF<a name='5573'>
<font color=#447700>!----------------------------------------------------------------------<a name='5574'></font>
<font color=#447700>!<a name='5575'></font>
<font color=#447700>!     TEST OF DEW CONDITION. LATENT HEAT FLUXES SET TO ZERO IF SIGN<a name='5576'></font>
<font color=#447700>!     OF FLUX CHANGES OVER TIME STEP.EXCESS ENERGY DONATED TO SENSIBLE<a name='5577'></font>
<font color=#447700>!     HEAT FLUX.<a name='5578'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5579'></font>
<font color=#447700>!<a name='5580'></font>
<font color=#447700>!cs Sun add following one statement IF (ISNOW.eq.0.and.MDLSNO.eq.0) go to<a name='5581'></font>
<font color=#447700>!cs 401  CONTINUE  to skip folloing statements from<a name='5582'></font>
<font color=#447700>!CS  ECF = SIGN( 1., ECPOT ) to 400   CONTINUE<a name='5583'></font>
<font color=#447700>!cl    IF (ISNOW.eq.0.and.MDLSNO.eq.0) go to 401<a name='5584'></font>
      IF (ISNOW.eq.0) go to 401<a name='5585'>
      ECF = SIGN( 1., ECPOT )<a name='5586'>
      EGF = SIGN( 1., EGPOT )<a name='5587'>
      DEWC = FC * 2. - 1.<a name='5588'>
      DEWG = FG * 2. - 1.<a name='5589'>
<font color=#447700>!<a name='5590'></font>
      IF(DEWC*ECF.GT.0.0) GO TO 300<a name='5591'>
      HC = HC + ECI + ECT<a name='5592'>
      ECI = 0.<a name='5593'>
      ECT = 0.<a name='5594'>
300   IF(DEWG*EGF.GT.0.0) GO TO 400<a name='5595'>
      HG = HG + EGS + EGI + EGT<a name='5596'>
      EGS = 0.<a name='5597'>
      EGI = 0.<a name='5598'>
      EGT = 0.<a name='5599'>
400   CONTINUE<a name='5600'>
401   CONTINUE<a name='5601'>
<font color=#447700>!<a name='5602'></font>
      EC = ECI + ECT<a name='5603'>
      EG = EGT + EGS + EGI<a name='5604'>
<font color=#447700>!<a name='5605'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5606'></font>
<font color=#447700>!     ADJUSTMENT OF TEMPERATURES AND VAPOR PRESSURE , CALCULATION OF<a name='5607'></font>
<font color=#447700>!     SENSIBLE HEAT FLUXES.<a name='5608'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5609'></font>
<font color=#447700>!<a name='5610'></font>
<font color=#447700>!cs sun add following new statement 02/04/99<a name='5611'></font>
      TGSOLD=TGS<a name='5612'>
<font color=#447700>!cs sun end<a name='5613'></font>
      TC  = TCEN<a name='5614'>
      TGS = TGEN<a name='5615'>
<font color=#447700>!CS Sun add following statement: 10/13/98<a name='5616'></font>
      IF (ISNOW.eq.0) tssn(n)=TGS<a name='5617'>
<font color=#447700>!CS                              10/13/98<a name='5618'></font>
      TA  = TAEN<a name='5619'>
      EA = EA + DEADTC*DTC + DEADTG*DTG<a name='5620'>
<font color=#447700>!<a name='5621'></font>
      RADT(1) = RADT(1) + RNCDTC*DTC + RNCDTG*DTG<a name='5622'>
      RADT(2) = RADT(2) + RNGDTC*DTC + RNGDTG*DTG<a name='5623'>
<font color=#447700>!========================================================================<a name='5624'></font>
      FLUP = FLUP - (RNCDTC+RNGDTC)*DTC - (RNCDTG+RNGDTG)*DTG<a name='5625'>
<font color=#447700>!========================================================================<a name='5626'></font>
<font color=#447700>!<a name='5627'></font>
<font color=#447700>! ** simulated net all-wave radiation **<a name='5628'></font>
<font color=#447700>!     sibnet(nmm,ndd,nhh) = RADT(1) + RADT(2)<a name='5629'></font>
<font color=#447700>!<a name='5630'></font>
      CHF = CCX / DTT * DTC<a name='5631'>
<font color=#447700>!cs  sun change the original statement:   on 12/14/98<a name='5632'></font>
<font color=#447700>!cs  SHF = CG / DTT * DTG + TIMCON*CG*2. * ( TGS - TD)<a name='5633'></font>
<font color=#447700>!cs into following part where CG / DTT * DTG is replaced by Dh_DTT_DTG<a name='5634'></font>
      IF (ISNOW.eq.0) THEN<a name='5635'>
        SHF=  Dh_DTT_DTG - dhp(n+1)+ qkn*(TGSOLD-tonm1) &amp;<a name='5636'>
        +qkn*DTG<a name='5637'>
      ELSE<a name='5638'>
        SHF = CG / DTT * DTG + TIMCON*CG*2. * ( TGS - TD )<a name='5639'>
      END IF<a name='5640'>
<font color=#447700>!<a name='5641'></font>
      ZLWUP = ZLWUP - RNCDTC * DTC / 2.        &amp;<a name='5642'>
                    - RNGDTG * DTG * (1.-VCOVER(1)*(1.-THERMK) )<a name='5643'>
<font color=#447700>!<a name='5644'></font>
      IF ( TGS .GT. TF ) GO TO 500<a name='5645'>
      EGS = EG - EGI<a name='5646'>
      EGT = 0.<a name='5647'>
500   CONTINUE<a name='5648'>
<font color=#447700>!<a name='5649'></font>
      VCOVER(2) = RESV2<a name='5650'>
      D = RESD<a name='5651'>
      Z0 = RESZ0<a name='5652'>
      RDC = RESRDC<a name='5653'>
      RBC = RESRBC<a name='5654'>
<font color=#447700>!CS   Sun add next paragrapg to get soil surface temperature TGS  10/13/98<a name='5655'></font>
<font color=#447700>!cl    IF (MDLSNO.eq.0.and.ISNOW.eq.0) THEN<a name='5656'></font>
      IF (ISNOW.eq.0) THEN<a name='5657'>
         TGS=TSOIL<a name='5658'>
         ATMP= (QSOIL+SOLSOIL)/CSOIL<a name='5659'>
         BTMP=2.*3.1416/86400.<a name='5660'>
         CTMP=CSOIL*BTMP/CSOIL/(365.*3.1416)**0.5<a name='5661'>
         TGS=(TSOIL+ATMP*DTT+BTMP*DTT*TD/(1.+CTMP*DTT))/  &amp;<a name='5662'>
             (1.+BTMP*DTT*(1.-CTMP*DTT/(1.+CTMP*DTT)))<a name='5663'>
         TD=(CTMP*DTT*TGS+TD)/(1.+CTMP*DTT)<a name='5664'>
      END IF<a name='5665'>
<font color=#447700>!------------------------------------------------------<a name='5666'></font>
      END SUBROUTINE TEMRS2<a name='5667'>
<font color=#447700>!------------------------------------------------------<a name='5668'></font>
<a name='5669'>
<font color=#447700>!=======================================================================<a name='5670'></font>
<font color=#447700>!                                                                       <a name='5671'></font>
<A NAME='TPROPTY'><A href='../../html_code/phys/module_sf_ssib.F.html#TPROPTY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5672'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>TPROPTY</font>(THKSOIL,BWO,DZO,TKAIR,DZSOIL,  THK,QK) <A href='../../call_to/TPROPTY.html' TARGET='index'>1</A><a name='5673'>
<font color=#447700>!<a name='5674'></font>
<font color=#447700>!=======================================================================<a name='5675'></font>
      DIMENSION BWO(N1),DZO(N1),THK(N1),QK(N1)<a name='5676'>
<font color=#447700>!!!!! this is thermal conductivity for snow from R.Jordan(1991)(2.4)<a name='5677'></font>
      do 37 i=1,n<a name='5678'>
         thkice=2.290d0<a name='5679'>
	 thkair=2.30d-2<a name='5680'>
         thk(i) = thkair+(7.75d-5 *bwo(i)+ 1.105d-6*          &amp;<a name='5681'>
                  bwo(i)*bwo(i))*(thkice -thkair)+0.1<a name='5682'>
 37   continue<a name='5683'>
<font color=#447700>!!!!! calculate the ratio of thermal conductivity<a name='5684'></font>
<font color=#447700>!!!!! at the ineterface between two layers(2.7)<a name='5685'></font>
      do 47 i=2,n<a name='5686'>
      qk(i)=2.0*thk(i)*thk(i-1)/(thk(i)*dzo(i-1)+thk(i-1)*dzo(i))<a name='5687'>
47    continue<a name='5688'>
<font color=#447700>!     YX2002 (test2) but do nothing at this stage<a name='5689'></font>
      qk(1)= 2.0*thk(1)*thksoil/(thk(1)*dzsoil+thksoil*dzo(1))<a name='5690'>
<font color=#447700>!                                                                       <a name='5691'></font>
<font color=#447700>!------------------------------------------------------<a name='5692'></font>
      END SUBROUTINE TPROPTY<a name='5693'>
<font color=#447700>!------------------------------------------------------<a name='5694'></font>
<a name='5695'>
<font color=#447700>!=======================================================================<a name='5696'></font>
<font color=#447700>!                                                                       <a name='5697'></font>
<A NAME='UPDAT1'><A href='../../html_code/phys/module_sf_ssib.F.html#UPDAT1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5698'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>UPDAT1</font>(DTT,TC,TGS,TD,CAPAC,DTC,DTG,ECT,ECI,EGT,EGI,   &amp; <A href='../../call_to/UPDAT1.html' TARGET='index'>1</A><a name='5699'>
         EGS,EG,HC,HG,HFLUX,ETMASS,ROFF,                               &amp;<a name='5700'>
         NROOT,ROOTD,ROOTP,POROS,BEE,SATCO,SLOPE,                      &amp;<a name='5701'>
         PHSAT,ZDEPTH,WWW,CCX,CG,CHF,SHF,ISNOW,WFSOIL,SWE,SNROFF,smelt)<a name='5702'>
<font color=#447700>!<a name='5703'></font>
<font color=#447700>!=======================================================================<a name='5704'></font>
<font color=#447700>!CS ------------------------------------------------------------------**<a name='5705'></font>
<font color=#447700>!<a name='5706'></font>
<font color=#447700>!     UPDATING OF SOIL MOISTURE STORES AND INTERCEPTION CAPACITY<a name='5707'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='5708'></font>
      DIMENSION EF(3)<a name='5709'>
<font color=#447700>!cl 2001,1,09 the following array were added after common blocks removed<a name='5710'></font>
      DIMENSION WWW(3), CAPAC(2),SNOWW(2),ROOTD(2), ZDEPTH(3), ROOTP(3)<a name='5711'>
      DIMENSION TEMW(3),TEMWP(3),TEMWPP(3),AAA(2),BBB(2),CCC(2),QQQ(2)<a name='5712'>
<font color=#447700>!<a name='5713'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5714'></font>
<font color=#447700>!     EVAPORATION LOSSES ARE EXPRESSED IN J M-2 : WHEN DIVIDED BY<a name='5715'></font>
<font color=#447700>!     ( HLAT*1000.) LOSS IS IN M M-2<a name='5716'></font>
<font color=#447700>!     MASS TERMS ARE IN KG M-2 DT-1<a name='5717'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5718'></font>
<font color=#447700>!<a name='5719'></font>
      SNOFAC = HLAT / ( HLAT + SNOMEL /1000. )<a name='5720'>
      FACKS = 1.<a name='5721'>
      IF ( (TC-DTC) .LE. TF ) FACKS = SNOFAC<a name='5722'>
      IF ( (ECT+ECI) .GT. 0.) GO TO 100<a name='5723'>
      ECI = ECT + ECI<a name='5724'>
      ECT = 0.<a name='5725'>
      FACKS = 1. / FACKS<a name='5726'>
100   CAPAC(1)=CAPAC(1) - ECI*FACKS/HLAT/1000.<a name='5727'>
<font color=#447700>!<a name='5728'></font>
      ECMASS = ( ECT + ECI * FACKS ) / HLAT<a name='5729'>
<font color=#447700>!<a name='5730'></font>
<font color=#447700>!cs Sun add following statement  IF (ISNOW.EQ.0)  go to 201 on 12/5/98<a name='5731'></font>
      IF (ISNOW.eq.0) FACKS = SNOFAC<a name='5732'>
      IF (ISNOW.EQ.0)  go to 201<a name='5733'>
      FACKS = 1.<a name='5734'>
      IF ( (TGS-DTG) .LE. TF ) FACKS = SNOFAC<a name='5735'>
      IF ( (EGT+EGI) .GT. 0. ) GO TO 200<a name='5736'>
      EGI = EGT + EGI<a name='5737'>
      EGT = 0.<a name='5738'>
      FACKS = 1. / FACKS<a name='5739'>
200   CAPAC(2)=CAPAC(2) - EGI*FACKS/HLAT/1000.<a name='5740'>
<font color=#447700>!<a name='5741'></font>
201   EGMASS = ( EGT + EGS + EGI * FACKS ) / HLAT<a name='5742'>
<font color=#447700>!<a name='5743'></font>
      ETMASS = ECMASS + EGMASS<a name='5744'>
<font color=#447700>!<a name='5745'></font>
      HFLUX = ( HC + HG ) / DTT<a name='5746'>
<font color=#447700>!----------------------------------------------------------------------<a name='5747'></font>
<font color=#447700>!      DUMPING OF SMALL CAPAC VALUES ONTO SOIL SURFACE STORE<a name='5748'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5749'></font>
<font color=#447700>!<a name='5750'></font>
      DO 1000 IVEG = 1, 2<a name='5751'>
      IF ( CAPAC(IVEG) .GT. 0.000001 ) GO TO 1000<a name='5752'>
<font color=#447700>!cl    Xue added the following line in August,2000<a name='5753'></font>
<font color=#447700>!cl    FILTR  = FILTR  + CAPAC(IVEG)<a name='5754'></font>
      WWW(1) = WWW(1) + CAPAC(IVEG) / ( POROS*ZDEPTH(1) )<a name='5755'>
      CAPAC(IVEG) = 0.<a name='5756'>
1000  CONTINUE<a name='5757'>
<font color=#447700>!----------------------------------------------------------------------<a name='5758'></font>
<font color=#447700>!     SNOWMELT / REFREEZE CALCULATION<a name='5759'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5760'></font>
<font color=#447700>!CS  Sun Change following  CALL SNOWM to  SNOWM (ISNOW,wfsoil,swe)<a name='5761'></font>
<font color=#447700>!CS   10/13/98<a name='5762'></font>
<font color=#447700>!cl    CALL SNOWM (MDLSNO,ISNOW,WFSOIL,SWE)<a name='5763'></font>
<font color=#447700>!CS   10/13/98<a name='5764'></font>
<font color=#447700>!=======================================================================<a name='5765'></font>
<font color=#447700>!<a name='5766'></font>
<font color=#447700>!     CALCULATION OF SNOWMELT AND MODIFICATION OF TEMPERATURES<a name='5767'></font>
<font color=#447700>!     N.B. THIS VERSION DEALS WITH REFREEZING OF WATER<a name='5768'></font>
<font color=#447700>!<a name='5769'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='5770'></font>
<font color=#447700>!<a name='5771'></font>
      DO 6000 IVEG = 1, 2<a name='5772'>
<font color=#447700>!<a name='5773'></font>
<font color=#447700>!CS Sun Add following part for snow melting and water flux to soil(wfsoil)<a name='5774'></font>
<font color=#447700>!CS is  greater zero                                  10/13/98<a name='5775'></font>
      IF (ISNOW.EQ.0.and.IVEG.EQ.2) THEN<a name='5776'>
          ZMELT= WFSOIL<a name='5777'>
          WWW(1) = WWW(1) + ZMELT / ( POROS * ZDEPTH(1) )<a name='5778'>
          CAPAC(2)= SWE<a name='5779'>
          GO TO 6000<a name='5780'>
      END IF<a name='5781'>
<font color=#447700>!CS                                                   10/13/98<a name='5782'></font>
      CCT = CCX<a name='5783'>
      TS = TC<a name='5784'>
      DTS = DTC<a name='5785'>
      FLUX = CHF<a name='5786'>
      IF ( IVEG .EQ. 1 ) GO TO 110<a name='5787'>
      CCT = CG<a name='5788'>
      TS = TGS<a name='5789'>
      DTS = DTG<a name='5790'>
      FLUX = CCT * DTG / DTT<a name='5791'>
110   CONTINUE<a name='5792'>
<font color=#447700>!<a name='5793'></font>
      TTA = TS - DTS<a name='5794'>
      TTB = TS<a name='5795'>
      SNOWW(IVEG) = 0.<a name='5796'>
      IF ( TTA .LE. TF ) SNOWW(IVEG) = CAPAC(IVEG)<a name='5797'>
      CAPAC(IVEG) = CAPAC(IVEG) - SNOWW(IVEG)<a name='5798'>
      IF ( TTA .GT. TF .AND. TTB .GT. TF ) GO TO 120<a name='5799'>
      IF ( TTA .LE. TF .AND. TTB .LE. TF ) GO TO 120<a name='5800'>
<font color=#447700>!<a name='5801'></font>
      DTF = TF - TTA<a name='5802'>
      DTIME1 = CCT * DTF /  FLUX<a name='5803'>
      HF = FLUX*(DTT-DTIME1)<a name='5804'>
      FCAP = - CAPAC(IVEG)  * SNOMEL<a name='5805'>
      SPWET = AMIN1( 5. , SNOWW(IVEG) )<a name='5806'>
      IF ( DTS .GT. 0. ) FCAP =  SPWET * SNOMEL<a name='5807'>
      DTIME2 = FCAP / FLUX<a name='5808'>
      DTF2 =   FLUX * (DTT-DTIME1-DTIME2)/CCT<a name='5809'>
      TN = TF + DTF2<a name='5810'>
      TS = TF - 0.1<a name='5811'>
      IF (ABS(HF) .GE.ABS(FCAP) ) TS = TN<a name='5812'>
      CHANGE = HF<a name='5813'>
      IF (ABS(CHANGE) .GE.ABS(FCAP) ) CHANGE = FCAP<a name='5814'>
<font color=#447700>!<a name='5815'></font>
      CHANGE = CHANGE / SNOMEL<a name='5816'>
<font color=#447700>!crr<a name='5817'></font>
      IF (CHANGE.GT.0.0) SMELT=CHANGE+SMELT<a name='5818'>
<font color=#447700>!crr<a name='5819'></font>
      SNOWW(IVEG) = SNOWW(IVEG) - CHANGE<a name='5820'>
      CAPAC(IVEG) = CAPAC(IVEG) + CHANGE<a name='5821'>
<font color=#447700>!<a name='5822'></font>
      IF ( IVEG .EQ. 1 ) TC = TS<a name='5823'>
      IF ( IVEG .EQ. 2 ) TGS = TS<a name='5824'>
      IF ( SNOWW(IVEG) .LT. 0.00001 ) GO TO 120<a name='5825'>
<font color=#447700>!cl    ZMELT = 0.<a name='5826'></font>
<font color=#447700>!     modified to force water into soil. Xue Feb. 1994<a name='5827'></font>
      ZMELT = CAPAC(IVEG)<a name='5828'>
<font color=#447700>!     IF ( TD .GT. TF ) ZMELT = CAPAC(IVEG)<a name='5829'></font>
<font color=#447700>!crr   FILTR =  FILTR+ ZMELT<a name='5830'></font>
      WWW(1) = WWW(1) + ZMELT / ( POROS * ZDEPTH(1) )<a name='5831'>
<font color=#447700>!     IF ( TD .LE. TF )  ROFF = ROFF + CAPAC(IVEG)<a name='5832'></font>
      CAPAC(IVEG) = 0.<a name='5833'>
120    CONTINUE<a name='5834'>
<font color=#447700>!<a name='5835'></font>
      CAPAC(IVEG) = CAPAC(IVEG) + SNOWW(IVEG)<a name='5836'>
6000  CONTINUE<a name='5837'>
<font color=#447700>!     ------------------------------------------------------------<a name='5838'></font>
<font color=#447700>!CS   Sun changes  following statatement which is alwayes functioned<a name='5839'></font>
<font color=#447700>!CS   in Xue's code            10/13/98<a name='5840'></font>
      IF (ISNOW.NE.0) THEN<a name='5841'>
         FLUXEF = SHF - CCT*DTG/DTT<a name='5842'>
         TD = TD + FLUXEF / ( CG * 2. * SQRT ( PIE*365. ) ) * DTT<a name='5843'>
      END IF<a name='5844'>
<font color=#447700>!CS    ------------------------------------------------------------<a name='5845'></font>
<font color=#447700>!<a name='5846'></font>
<font color=#447700>!       --- LOAD PILPS DATA<a name='5847'></font>
<font color=#447700>!<a name='5848'></font>
<font color=#447700>!     if (change .gt. 0) snm(istat)=snm(istat)+(change*1000.)<a name='5849'></font>
      change=0.0<a name='5850'>
<font color=#447700>!----------------------------------------------------------------------<a name='5851'></font>
<font color=#447700>!     BARE SOIL EVAPORATION LOSS<a name='5852'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5853'></font>
<font color=#447700>!cl    2001,1,11 added the following line according to Xue, August 2000<a name='5854'></font>
<font color=#447700>!cl    FILTR  = FILTR  - EGS / HLAT / 1000.<a name='5855'></font>
      WWW(1) = WWW(1) - EGS / HLAT / 1000. / ( POROS * ZDEPTH(1) )<a name='5856'>
<font color=#447700>!<a name='5857'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5858'></font>
<font color=#447700>!   EXTRACTION OF TRANSPIRATION LOSS FROM ROOT ZONE<a name='5859'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5860'></font>
<font color=#447700>!<a name='5861'></font>
      DO 2000 IVEG = 1, 2<a name='5862'>
<font color=#447700>!<a name='5863'></font>
      IF ( IVEG .EQ. 1 ) ABSOIL = ECT / HLAT / 1000.<a name='5864'>
      IF ( IVEG .EQ. 2 ) ABSOIL = EGT / HLAT / 1000.<a name='5865'>
<font color=#447700>!cl    2001,1,09 added the following IF according to Xue, Aug 2000<a name='5866'></font>
                      IF (NROOT.EQ.1) THEN<a name='5867'>
      EF(2) = 0.<a name='5868'>
      EF(3) = 0.<a name='5869'>
      TOTDEP = ZDEPTH(1)<a name='5870'>
<font color=#447700>!<a name='5871'></font>
      DO 3000 IL = 2, 3<a name='5872'>
      TOTDEP = TOTDEP + ZDEPTH(IL)<a name='5873'>
<font color=#447700>!<a name='5874'></font>
<font color=#447700>!     DIV = AMAX1 ( 1., ( PHSOIL(IL) - PHL(IVEG) ) )<a name='5875'></font>
<font color=#447700>!<a name='5876'></font>
      IF ( ROOTD(IVEG) .LT. TOTDEP ) GO TO 400<a name='5877'>
<font color=#447700>!<a name='5878'></font>
      EF(IL) = ZDEPTH(IL) / ROOTD(IVEG)<a name='5879'>
      GO TO 500<a name='5880'>
<font color=#447700>!<a name='5881'></font>
400   CONTINUE<a name='5882'>
      EF(IL) = ROOTD(IVEG) - TOTDEP + ZDEPTH(IL)<a name='5883'>
      EF(IL) = EF(IL) / ROOTD(IVEG)<a name='5884'>
      GO TO 600<a name='5885'>
500   CONTINUE<a name='5886'>
3000  CONTINUE<a name='5887'>
<font color=#447700>!<a name='5888'></font>
600   EFT = EF(2) + EF(3)<a name='5889'>
      EFT = MAX(EFT,0.1E-5)<a name='5890'>
      EF(2) = EF(2) / EFT<a name='5891'>
      EF(3) = EF(3) / EFT<a name='5892'>
       DO 4000 IL = 2, 3<a name='5893'>
       WWW(IL) = WWW(IL) - ABSOIL * EF(IL) / ( POROS * ZDEPTH(IL) )<a name='5894'>
4000   CONTINUE<a name='5895'>
                      ELSE<a name='5896'>
      EF(1) = ROOTP(1)<a name='5897'>
      EF(2) = ROOTP(2)<a name='5898'>
      EF(3) = ROOTP(3)<a name='5899'>
      DO 4004 IL = 1, 3<a name='5900'>
      WWW(IL) = WWW(IL) - ABSOIL * EF(IL) / ( POROS * ZDEPTH(IL) )<a name='5901'>
4004  CONTINUE<a name='5902'>
        END IF<a name='5903'>
2000  CONTINUE<a name='5904'>
<font color=#447700>!<a name='5905'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5906'></font>
<font color=#447700>!<a name='5907'></font>
<font color=#447700>!     CALCULATION OF INTERFLOW, INFILTRATION EXCESS AND LOSS TO<a name='5908'></font>
<font color=#447700>!     GROUNDWATER .  ALL LOSSES ARE ASSIGNED TO VARIABLE 'ROFF' .<a name='5909'></font>
<font color=#447700>!<a name='5910'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5911'></font>
<font color=#447700>!<a name='5912'></font>
      DO 5000 IL = 1, 2<a name='5913'>
      IF ( WWW(IL) .GT. 0. ) GO TO 5000<a name='5914'>
      WWW(IL+1) = WWW(IL+1) + WWW(IL) * ZDEPTH(IL)/ZDEPTH(IL+1)<a name='5915'>
      WWW(IL) = 0.<a name='5916'>
5000  CONTINUE<a name='5917'>
<font color=#447700>!     IF ( TD .LT. TF ) GO TO 800<a name='5918'></font>
<font color=#447700>!=======================================================================<a name='5919'></font>
<font color=#447700>!cl    CALL RUN2<a name='5920'></font>
<font color=#447700>!cl    2001,1,09 substitute subroutine RUN2 by its full code<a name='5921'></font>
<font color=#447700>!    calculation of interflow, infiltration excess and loss to<a name='5922'></font>
<font color=#447700>!    groundwater .  all losses are assigned to variable 'roff' .<a name='5923'></font>
<font color=#447700>!=======================================================================<a name='5924'></font>
      do 8000 i = 1, 3<a name='5925'>
      TEMW(I)   = AMAX1( 0.03, WWW(I) )<a name='5926'>
      TEMWP(I)  = TEMW(I) ** ( -BEE )<a name='5927'>
      TEMWPP(I) = AMIN1( 1., TEMW(I)) ** ( 2.*BEE+ 3. )<a name='5928'>
8000  CONTINUE<a name='5929'>
<font color=#447700>!-----------------------------------------------------------------------<a name='5930'></font>
<font color=#447700>!<a name='5931'></font>
<font color=#447700>!    calculation of gravitationally driven drainage from w(3) : taken<a name='5932'></font>
<font color=#447700>!    as an integral of time varying conductivity.addition of liston<a name='5933'></font>
<font color=#447700>!    baseflow term to original q3g to insure flow in<a name='5934'></font>
<font color=#447700>!    dry season. modified liston baseflow constant scaled<a name='5935'></font>
<font color=#447700>!    by available water.<a name='5936'></font>
<font color=#447700>!<a name='5937'></font>
<font color=#447700>!     q3g (q3) : equation (62) , SE-86<a name='5938'></font>
<font color=#447700>!<a name='5939'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='5940'></font>
      POWS = 2.*BEE+2.<a name='5941'>
      Q3G = TEMW(3)**(-POWS) + SATCO/ZDEPTH(3)/POROS*SLOPE*POWS*DTT<a name='5942'>
      Q3G = Q3G ** ( 1. / POWS )<a name='5943'>
      Q3G = - ( 1. / Q3G - WWW(3) ) * POROS * ZDEPTH(3) / DTT<a name='5944'>
      Q3G = AMAX1( 0., Q3G )<a name='5945'>
      Q3G = AMIN1( Q3G, WWW(3)*POROS*ZDEPTH(3)/DTT )<a name='5946'>
<font color=#447700>!<a name='5947'></font>
      Q3G = Q3G + 0.002*POROS*ZDEPTH(3)*0.5 / 86400. * WWW(3)<a name='5948'>
<font color=#447700>!<a name='5949'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5950'></font>
<font color=#447700>!<a name='5951'></font>
<font color=#447700>!    calculation of inter-layer exchanges of water due to gravitation<a name='5952'></font>
<font color=#447700>!    and hydraulic gradient. the values of w(x) + dw(x) are used to<a name='5953'></font>
<font color=#447700>!    calculate the potential gradients between layers.<a name='5954'></font>
<font color=#447700>!    modified calculation of mean conductivities follows ME-82 ),<a name='5955'></font>
<font color=#447700>!    reduces recharge flux to top layer.<a name='5956'></font>
<font color=#447700>!<a name='5957'></font>
<font color=#447700>!      dpdw           : estimated derivative of soil moisture potential<a name='5958'></font>
<font color=#447700>!                       with respect to soil wetness. assumption of<a name='5959'></font>
<font color=#447700>!                       gravitational drainage used to estimate likely<a name='5960'></font>
<font color=#447700>!                       minimum wetness over the time step.<a name='5961'></font>
<font color=#447700>!<a name='5962'></font>
<font color=#447700>!      qqq  (q     )  : equation (61) , SE-86<a name='5963'></font>
<font color=#447700>!             i,i+1<a name='5964'></font>
<font color=#447700>!            -<a name='5965'></font>
<font color=#447700>!      avk  (k     )  : equation (4.14) , ME-82<a name='5966'></font>
<font color=#447700>!             i,i+1<a name='5967'></font>
<font color=#447700>!<a name='5968'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5969'></font>
<font color=#447700>!<a name='5970'></font>
      WMAX = AMAX1( WWW(1), WWW(2), WWW(3), 0.05 )<a name='5971'>
      WMAX = AMIN1( WMAX, 1. )<a name='5972'>
      PMAX = WMAX**(-BEE)<a name='5973'>
      WMIN = (PMAX-2./( PHSAT*(ZDEPTH(1)+2.*ZDEPTH(2)+ZDEPTH(3))))    &amp;<a name='5974'>
              **(-1./BEE)<a name='5975'>
      WMIN = AMIN1( WWW(1), WWW(2), WWW(3), WMIN )<a name='5976'>
      WMIN = AMAX1( WMIN, 0.02 )<a name='5977'>
      PMIN = WMIN**(-BEE)<a name='5978'>
      DPDW = PHSAT*( PMAX-PMIN )/( WMAX-WMIN )<a name='5979'>
<font color=#447700>!<a name='5980'></font>
      do 8200 i = 1, 2<a name='5981'>
<font color=#447700>!<a name='5982'></font>
      RSAME = 0.<a name='5983'>
      AVK  = TEMWP(I)*TEMWPP(I) - TEMWP(I+1)*TEMWPP(I+1)<a name='5984'>
      DIV  = TEMWP(I+1) - TEMWP(I)<a name='5985'>
      IF ( ABS(DIV) .LT. 1.E-6 ) RSAME = 1.<a name='5986'>
      AVK = SATCO*AVK / ( ( 1. + 3./BEE ) * DIV + RSAME )<a name='5987'>
      AVKMIN = SATCO * AMIN1( TEMWPP(I), TEMWPP(I+1) )<a name='5988'>
      AVKMAX = SATCO * AMAX1( TEMWPP(I), TEMWPP(I+1) )*1.01<a name='5989'>
      AVK = AMAX1( AVK, AVKMIN )<a name='5990'>
      AVK = AMIN1( AVK, AVKMAX )<a name='5991'>
<font color=#447700>!-----------------------------------------------------------------------<a name='5992'></font>
<font color=#447700>!     conductivities and base flow reduced when temperature drops below<a name='5993'></font>
<font color=#447700>!     freezing.<a name='5994'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='5995'></font>
<font color=#447700>!<a name='5996'></font>
      TSNOW = AMIN1 ( TF-0.01, TGS )<a name='5997'>
      AREAS = AMIN1 (0.999,13.2*SNOWW(2))<a name='5998'>
      TGG = TSNOW*AREAS + TGS*(1.-AREAS)<a name='5999'>
      TS    = TGG*(2-I) + TD*(I-1)<a name='6000'>
      PROPS = ( TS-(TF-10.) ) / 10.<a name='6001'>
<font color=#447700>!     props = 1.+5*(ts-tf)<a name='6002'></font>
      PROPS = AMAX1( 0.05, AMIN1( 1.0, PROPS ) )<a name='6003'>
      AVK  = AVK * PROPS<a name='6004'>
      Q3G  = Q3G * PROPS<a name='6005'>
<font color=#447700>!<a name='6006'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6007'></font>
<font color=#447700>!     backward implicit calculation of flows between soil layers.<a name='6008'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6009'></font>
<font color=#447700>!<a name='6010'></font>
      DPDWDZ = DPDW * 2./( ZDEPTH(I) + ZDEPTH(I+1) )<a name='6011'>
      AAA(I) = 1. + AVK*DPDWDZ*( 1./ZDEPTH(I)+1./ZDEPTH(I+1) )    &amp;<a name='6012'>
                  *DTT/POROS<a name='6013'>
      BBB(I) =-AVK *   DPDWDZ * 1./ZDEPTH(2)*DTT/POROS<a name='6014'>
      CCC(I) = AVK * ( DPDWDZ * ( WWW(I)-WWW(I+1) ) + 1. +        &amp;<a name='6015'>
                 (I-1)*DPDWDZ*Q3G*1./ZDEPTH(3)*DTT/POROS )<a name='6016'>
8200  CONTINUE<a name='6017'>
<font color=#447700>!<a name='6018'></font>
      DENOM  = ( AAA(1)*AAA(2) - BBB(1)*BBB(2) )<a name='6019'>
      RDENOM = 0.<a name='6020'>
      IF ( ABS(DENOM) .LT. 1.E-6 ) RDENOM = 1.<a name='6021'>
      RDENOM = ( 1.-RDENOM)/( DENOM + RDENOM )<a name='6022'>
      QQQ(1)   = ( AAA(2)*CCC(1) - BBB(1)*CCC(2) ) * RDENOM<a name='6023'>
      QQQ(2)   = ( AAA(1)*CCC(2) - BBB(2)*CCC(1) ) * RDENOM<a name='6024'>
<font color=#447700>!<a name='6025'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6026'></font>
<font color=#447700>!     update wetness of each soil moisture layer due to layer interflow<a name='6027'></font>
<font color=#447700>!        and base flow.<a name='6028'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6029'></font>
<font color=#447700>!<a name='6030'></font>
      WWW(3) = WWW(3) - Q3G*DTT/(POROS*ZDEPTH(3))<a name='6031'>
      ROFF = ROFF + Q3G * DTT<a name='6032'>
<font color=#447700>!<a name='6033'></font>
      do 8300 i = 1, 2<a name='6034'>
<font color=#447700>!<a name='6035'></font>
      QMAX   =  WWW(I)   * (POROS*ZDEPTH(I)  /DTT)<a name='6036'>
      QMIN   = -WWW(I+1) * (POROS*ZDEPTH(I+1)/DTT)<a name='6037'>
      QQQ(I) = AMIN1( QQQ(I),QMAX)<a name='6038'>
      QQQ(I) = AMAX1( QQQ(I),QMIN)<a name='6039'>
      WWW(I)   =   WWW(I)   - QQQ(I)/(POROS*ZDEPTH(I)  /DTT)<a name='6040'>
      WWW(I+1) =   WWW(I+1) + QQQ(I)/(POROS*ZDEPTH(I+1)/DTT)<a name='6041'>
8300  continue<a name='6042'>
<font color=#447700>!<a name='6043'></font>
<font color=#447700>!       --- LOAD water flow &amp; root-zone drainage PILPS DATA<a name='6044'></font>
<font color=#447700>!crr   SOILDIF=SOILDIF+ QQQ(1)* DTT *1000.<a name='6045'></font>
<font color=#447700>!crr   SOILDRA=SOILDRA+ Q3G* DTT *1000.<a name='6046'></font>
<font color=#447700>!<a name='6047'></font>
      do 8400 i = 1, 3<a name='6048'>
      EXCESS = AMAX1(0.,(WWW(I) - 1.))<a name='6049'>
      WWW(I) = WWW(I) - EXCESS<a name='6050'>
      ROFF   = ROFF   + EXCESS * POROS*ZDEPTH(I)<a name='6051'>
<font color=#447700>!<a name='6052'></font>
<font color=#447700>!       --- LOAD IN as root-drainage for PILPS<a name='6053'></font>
<font color=#447700>!crr   IF (I.LT.2) THEN<a name='6054'></font>
<font color=#447700>!crr     RNOFFS= RNOFFS+ 1000.*EXCESS*POROS*ZDEPTH(I)<a name='6055'></font>
<font color=#447700>!crr   ELSE<a name='6056'></font>
<font color=#447700>!crr     RNOFFB= RNOFFB+ 1000.*EXCESS*POROS*ZDEPTH(I)<a name='6057'></font>
<font color=#447700>!crr   ENDIF<a name='6058'></font>
8400  continue<a name='6059'>
<font color=#447700>!-----------------------------------------------------------------------<a name='6060'></font>
<font color=#447700>!     prevent negative values of www(i)<a name='6061'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6062'></font>
<font color=#447700>!<a name='6063'></font>
      do 8402 i = 1,2<a name='6064'>
      DEFICIT   = AMAX1 (0.,(1.E-12 - WWW(I)))<a name='6065'>
<font color=#447700>!crr   IF (I.EQ.1) SOILDIF=SOILDIF-DEFICIT * ZDEPTH(1) * POROS<a name='6066'></font>
      WWW (I)   = WWW(I) + DEFICIT<a name='6067'>
      WWW (I+1) = WWW(I+1) - DEFICIT * ZDEPTH(I) / ZDEPTH (I+1)<a name='6068'>
 8402 CONTINUE<a name='6069'>
      WWW(3)    = AMAX1 (WWW(3),1.E-12)<a name='6070'>
<font color=#447700>!     --------------------------------- end of subroutine RUN2 ------<a name='6071'></font>
800   CONTINUE<a name='6072'>
<font color=#447700>!<a name='6073'></font>
      IF (WWW(1) .GT.1.) THEN<a name='6074'>
          WWW(2) = WWW(2) + (WWW(1)-1.) * ZDEPTH(1) / ZDEPTH(2)<a name='6075'>
<font color=#447700>!crr       SOILDIF=SOILDIF+(WWW(1)-1.)* ZDEPTH(1) * POROS *1000.<a name='6076'></font>
          WWW(1) = 1.<a name='6077'>
      END IF<a name='6078'>
        If (WWW(2) .GT.1.) THEN<a name='6079'>
          WWW(3) = WWW(3) + (WWW(2)-1.) * ZDEPTH(2) / ZDEPTH(3)<a name='6080'>
<font color=#447700>!<a name='6081'></font>
<font color=#447700>!       --- LOAD IN AS PILP ROOT DRAINAGE<a name='6082'></font>
          WWW(2) = 1.<a name='6083'>
        END IF<a name='6084'>
      IF (WWW(3) .GT.1.) THEN<a name='6085'>
          ROFF   = ROFF + (WWW(3)-1.)* ZDEPTH(3) * POROS<a name='6086'>
<font color=#447700>!crr       RNOFFB=RNOFFB + (WWW(3)-1.)* ZDEPTH(3) * POROS *1000.<a name='6087'></font>
          WWW(3) = 1.<a name='6088'>
      END IF<a name='6089'>
<font color=#447700>!                                                                       <a name='6090'></font>
<font color=#447700>!------------------------------------------------------<a name='6091'></font>
      END SUBROUTINE UPDAT1<a name='6092'>
<font color=#447700>!------------------------------------------------------<a name='6093'></font>
<a name='6094'>
<font color=#447700>!=======================================================================<a name='6095'></font>
<font color=#447700>!<a name='6096'></font>
<A NAME='UPDAT1_ICE'><A href='../../html_code/phys/module_sf_ssib.F.html#UPDAT1_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6097'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>UPDAT1_ICE</font>(DTT,TC,TGS,TD,CAPAC,DTC,DTG,ECT,ECI,EGT,EGI,   &amp; <A href='../../call_to/UPDAT1_ICE.html' TARGET='index'>1</A><a name='6098'>
         EGS,EG,HC,HG,HFLUX,ETMASS,FILTR,SOILDIF,SOILDRA,ROFF,         &amp;<a name='6099'>
         RNOFFB,RNOFFS,NROOT,ROOTD,ROOTP,POROS,BEE,SATCO,SLOPE,        &amp;<a name='6100'>
         PHSAT,ZDEPTH,WWW,CCX,CG,CHF,SHF,SMELT)<a name='6101'>
<font color=#447700>!                                                         12 AUGUST 2000<a name='6102'></font>
<font color=#447700>!=======================================================================<a name='6103'></font>
<font color=#447700>!<a name='6104'></font>
<font color=#447700>!     UPDATING OF SOIL MOISTURE STORES AND INTERCEPTION CAPACITY<a name='6105'></font>
<font color=#447700>!<a name='6106'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6107'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6108'></font>
<a name='6109'>
 REAL, DIMENSION (2) :: CAPAC, SNOWW, ROOTD, aaa, bbb, ccc, qqq<a name='6110'>
 REAL, DIMENSION (3) :: WWW, EF, ZDEPTH, ROOTP, temw, temwp, temwpp<a name='6111'>
<a name='6112'>
<font color=#447700>!<a name='6113'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6114'></font>
<font color=#447700>!     EVAPORATION LOSSES ARE EXPRESSED IN J M-2 : WHEN DIVIDED BY<a name='6115'></font>
<font color=#447700>!     ( HLAT*1000.) LOSS IS IN M M-2<a name='6116'></font>
<font color=#447700>!     MASS TERMS ARE IN KG M-2 DT-1<a name='6117'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6118'></font>
<font color=#447700>!<a name='6119'></font>
      SNOFAC = HLAT / ( HLAT + SNOMEL /1000. )<a name='6120'>
      FACKS = 1.<a name='6121'>
      IF ( (TC-DTC) .LE. TF ) FACKS = SNOFAC<a name='6122'>
      IF ( (ECT+ECI) .GT. 0.) GO TO 100<a name='6123'>
      ECI = ECT + ECI<a name='6124'>
      ECT = 0.<a name='6125'>
      FACKS = 1. / FACKS<a name='6126'>
100   CAPAC(1)=CAPAC(1) - ECI*FACKS/HLAT/1000.<a name='6127'>
<font color=#447700>!<a name='6128'></font>
      ECMASS = ( ECT + ECI * FACKS ) / HLAT<a name='6129'>
<font color=#447700>!<a name='6130'></font>
      FACKS = 1.<a name='6131'>
      IF ( (TGS-DTG) .LE. TF ) FACKS = SNOFAC<a name='6132'>
      IF ( (EGT+EGI) .GT. 0. ) GO TO 200<a name='6133'>
      EGI = EGT + EGI<a name='6134'>
      EGT = 0.<a name='6135'>
      FACKS = 1. / FACKS<a name='6136'>
200   CAPAC(2)=CAPAC(2) - EGI*FACKS/HLAT/1000.<a name='6137'>
<font color=#447700>!<a name='6138'></font>
      EGMASS = ( EGT + EGS + EGI * FACKS ) / HLAT<a name='6139'>
<font color=#447700>!<a name='6140'></font>
      ETMASS = ECMASS + EGMASS<a name='6141'>
<font color=#447700>!<a name='6142'></font>
      HFLUX = ( HC + HG )<a name='6143'>
<font color=#447700>!<a name='6144'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6145'></font>
<font color=#447700>!      DUMPING OF SMALL CAPAC VALUES ONTO SOIL SURFACE STORE<a name='6146'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6147'></font>
<font color=#447700>!<a name='6148'></font>
      DO 1000 IVEG = 1, 2<a name='6149'>
      IF ( CAPAC(IVEG) .GT. 0.000001 ) GO TO 300<a name='6150'>
      FILTR = FILTR + CAPAC(IVEG)<a name='6151'>
      WWW(1) = WWW(1) + CAPAC(IVEG) / ( POROS*ZDEPTH(1) )<a name='6152'>
      CAPAC(IVEG) = 0.<a name='6153'>
300   CONTINUE<a name='6154'>
1000  CONTINUE<a name='6155'>
<font color=#447700>!----------------------------------------------------------------------<a name='6156'></font>
<font color=#447700>!     SNOWMELT / REFREEZE CALCULATION<a name='6157'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6158'></font>
<font color=#447700>!<a name='6159'></font>
<font color=#447700>!     CALCULATION OF SNOWMELT AND MODIFICATION OF TEMPERATURES<a name='6160'></font>
<font color=#447700>!     N.B. THIS VERSION DEALS WITH REFREEZING OF WATER<a name='6161'></font>
<font color=#447700>!<a name='6162'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6163'></font>
<font color=#447700>!<a name='6164'></font>
      DO 7000 IVEG = 1, 2<a name='6165'>
<font color=#447700>!<a name='6166'></font>
      CCT = CCX<a name='6167'>
      TS = TC<a name='6168'>
      DTS = DTC<a name='6169'>
      FLUX = CHF<a name='6170'>
      IF ( IVEG .EQ. 1 ) GO TO 7100<a name='6171'>
      CCT = CG<a name='6172'>
      TS = TGS<a name='6173'>
      DTS = DTG<a name='6174'>
      FLUX = CCT * DTG / DTT<a name='6175'>
<a name='6176'>
7100  CONTINUE<a name='6177'>
<font color=#447700>!<a name='6178'></font>
      TTA = TS - DTS<a name='6179'>
      TTB = TS<a name='6180'>
      SNOWW(IVEG) = 0.<a name='6181'>
      IF ( TTA .LE. TF ) SNOWW(IVEG) = CAPAC(IVEG)<a name='6182'>
      CAPAC(IVEG) = CAPAC(IVEG) - SNOWW(IVEG)<a name='6183'>
      IF ( TTA .GT. TF .AND. TTB .GT. TF ) GO TO 7200<a name='6184'>
      IF ( TTA .LE. TF .AND. TTB .LE. TF ) GO TO 7200<a name='6185'>
<font color=#447700>!<a name='6186'></font>
      DTF = TF - TTA<a name='6187'>
      DTIME1 = CCT * DTF /  FLUX<a name='6188'>
      HF = FLUX*(DTT-DTIME1)<a name='6189'>
      FCAP = - CAPAC(IVEG)  * SNOMEL<a name='6190'>
      SPWET = AMIN1( 5. , SNOWW(IVEG) )<a name='6191'>
      IF ( DTS .GT. 0. ) FCAP =  SPWET * SNOMEL<a name='6192'>
      DTIME2 = FCAP / FLUX<a name='6193'>
      DTF2 =   FLUX * (DTT-DTIME1-DTIME2)/CCT<a name='6194'>
      TN = TF + DTF2<a name='6195'>
      TS = TF - 0.1<a name='6196'>
      IF (ABS(HF) .GE.ABS(FCAP) ) TS = TN<a name='6197'>
      CHANGE = HF<a name='6198'>
      IF (ABS(CHANGE) .GE.ABS(FCAP) ) CHANGE = FCAP<a name='6199'>
<font color=#447700>!<a name='6200'></font>
      CHANGE = CHANGE / SNOMEL<a name='6201'>
<font color=#447700>!<a name='6202'></font>
      IF (CHANGE.GT.0.0) SMELT=CHANGE+SMELT<a name='6203'>
<font color=#447700>!<a name='6204'></font>
      SNOWW(IVEG) = SNOWW(IVEG) - CHANGE<a name='6205'>
      CAPAC(IVEG) = CAPAC(IVEG) + CHANGE<a name='6206'>
<font color=#447700>!<a name='6207'></font>
      IF ( IVEG .EQ. 1 ) TC = TS<a name='6208'>
      IF ( IVEG .EQ. 2 ) TGS = TS<a name='6209'>
      IF ( SNOWW(IVEG) .LT. 0.00001 ) GO TO 7200<a name='6210'>
      ZMELT = 0.<a name='6211'>
<font color=#447700>!     modified to force water into soil. Xue Feb. 1994<a name='6212'></font>
      ZMELT = CAPAC(IVEG)<a name='6213'>
      FILTR =  FILTR+ ZMELT<a name='6214'>
      WWW(1) = WWW(1) + ZMELT / ( POROS * ZDEPTH(1) )<a name='6215'>
      CAPAC(IVEG) = 0.<a name='6216'>
7200   CONTINUE<a name='6217'>
<font color=#447700>!<a name='6218'></font>
      CAPAC(IVEG) = CAPAC(IVEG) + SNOWW(IVEG)<a name='6219'>
<font color=#447700>!<a name='6220'></font>
7000  CONTINUE<a name='6221'>
<font color=#447700>!<a name='6222'></font>
      FLUXEF = SHF - CCT*DTG/DTT<a name='6223'>
      TD = TD + FLUXEF / ( CG * 2. * SQRT ( PIE*365. ) ) * DTT<a name='6224'>
<font color=#447700>!<a name='6225'></font>
      change=0.0<a name='6226'>
<font color=#447700>!<a name='6227'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6228'></font>
<font color=#447700>!     BARE SOIL EVAPORATION LOSS<a name='6229'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6230'></font>
<font color=#447700>!<a name='6231'></font>
      FILTR = FILTR - EGS / HLAT / 1000.<a name='6232'>
      WWW(1) = WWW(1) - EGS / HLAT / 1000. / ( POROS * ZDEPTH(1) )<a name='6233'>
<font color=#447700>!<a name='6234'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6235'></font>
<font color=#447700>!   EXTRACTION OF TRANSPIRATION LOSS FROM ROOT ZONE<a name='6236'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6237'></font>
<font color=#447700>!<a name='6238'></font>
      DO 2000 IVEG = 1, 2<a name='6239'>
<font color=#447700>!<a name='6240'></font>
      IF ( IVEG .EQ. 1 ) ABSOIL = ECT / HLAT / 1000.<a name='6241'>
      IF ( IVEG .EQ. 2 ) ABSOIL = EGT / HLAT / 1000.<a name='6242'>
<font color=#447700>!<a name='6243'></font>
      IF (NROOT.EQ.1) THEN<a name='6244'>
      EF(2) = 0.<a name='6245'>
      EF(3) = 0.<a name='6246'>
      TOTDEP = ZDEPTH(1)<a name='6247'>
<font color=#447700>!<a name='6248'></font>
      DO 3000 IL = 2, 3<a name='6249'>
      TOTDEP = TOTDEP + ZDEPTH(IL)<a name='6250'>
<font color=#447700>!<a name='6251'></font>
      IF ( ROOTD(IVEG) .LT. TOTDEP ) GO TO 400<a name='6252'>
<font color=#447700>!<a name='6253'></font>
      EF(IL) = ZDEPTH(IL) / ROOTD(IVEG)<a name='6254'>
      GO TO 500<a name='6255'>
<font color=#447700>!<a name='6256'></font>
400   CONTINUE<a name='6257'>
      EF(IL) = ROOTD(IVEG) - TOTDEP + ZDEPTH(IL)<a name='6258'>
      EF(IL) = EF(IL) / ROOTD(IVEG)<a name='6259'>
      GO TO 600<a name='6260'>
<font color=#447700>!<a name='6261'></font>
500   CONTINUE<a name='6262'>
3000  CONTINUE<a name='6263'>
<font color=#447700>!<a name='6264'></font>
600   EFT = EF(2) + EF(3)<a name='6265'>
<font color=#447700>!<a name='6266'></font>
      EFT = MAX(EFT,0.1E-5)<a name='6267'>
<font color=#447700>!<a name='6268'></font>
      EF(2) = EF(2) / EFT<a name='6269'>
      EF(3) = EF(3) / EFT<a name='6270'>
<font color=#447700>!<a name='6271'></font>
      DO 4000 IL = 2, 3<a name='6272'>
      WWW(IL) = WWW(IL) - ABSOIL * EF(IL) / ( POROS * ZDEPTH(IL) )<a name='6273'>
4000  CONTINUE<a name='6274'>
      ELSE<a name='6275'>
      EF(1) = ROOTP(1)<a name='6276'>
      EF(2) = ROOTP(2)<a name='6277'>
      EF(3) = ROOTP(3)<a name='6278'>
      DO 4004 IL = 1, 3<a name='6279'>
      WWW(IL) = WWW(IL) - ABSOIL * EF(IL) / ( POROS * ZDEPTH(IL) )<a name='6280'>
4004  CONTINUE<a name='6281'>
      END IF<a name='6282'>
<font color=#447700>!<a name='6283'></font>
2000  CONTINUE<a name='6284'>
<font color=#447700>!<a name='6285'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6286'></font>
<font color=#447700>!<a name='6287'></font>
<font color=#447700>!     CALCULATION OF INTERFLOW, INFILTRATION EXCESS AND LOSS TO<a name='6288'></font>
<font color=#447700>!     GROUNDWATER .  ALL LOSSES ARE ASSIGNED TO VARIABLE 'ROFF' .<a name='6289'></font>
<font color=#447700>!<a name='6290'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6291'></font>
<font color=#447700>!<a name='6292'></font>
      DO 5000 IL = 1, 2<a name='6293'>
      IF ( WWW(IL) .GT. 0. ) GO TO 700<a name='6294'>
      WWW(IL+1) = WWW(IL+1) + WWW(IL) * ZDEPTH(IL)/ZDEPTH(IL+1)<a name='6295'>
      WWW(IL) = 0.<a name='6296'>
700   CONTINUE<a name='6297'>
5000  CONTINUE<a name='6298'>
<font color=#447700>!<a name='6299'></font>
<font color=#447700>!=======================================================================<a name='6300'></font>
<font color=#447700>!    calculation of interflow, infiltration excess and loss to<a name='6301'></font>
<font color=#447700>!    groundwater .  all losses are assigned to variable 'roff' .<a name='6302'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6303'></font>
<font color=#447700>!<a name='6304'></font>
      do 8000 i = 1, 3<a name='6305'>
<font color=#447700>!<a name='6306'></font>
      TEMW(I)   = AMAX1( 0.03, WWW(I) )<a name='6307'>
      TEMWP(I)  = TEMW(I) ** ( -BEE )<a name='6308'>
      TEMWPP(I) = AMIN1( 1., TEMW(I)) ** ( 2.*BEE+ 3. )<a name='6309'>
8000  CONTINUE<a name='6310'>
<font color=#447700>!<a name='6311'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6312'></font>
<font color=#447700>!<a name='6313'></font>
<font color=#447700>!    calculation of gravitationally driven drainage from w(3) : taken<a name='6314'></font>
<font color=#447700>!    as an integral of time varying conductivity.addition of liston<a name='6315'></font>
<font color=#447700>!    baseflow term to original q3g to insure flow in<a name='6316'></font>
<font color=#447700>!    dry season. modified liston baseflow constant scaled<a name='6317'></font>
<font color=#447700>!    by available water.<a name='6318'></font>
<font color=#447700>!<a name='6319'></font>
<font color=#447700>!     q3g (q3) : equation (62) , SE-86<a name='6320'></font>
<font color=#447700>!<a name='6321'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6322'></font>
<font color=#447700>!<a name='6323'></font>
      POWS = 2.*BEE+2.<a name='6324'>
      Q3G = TEMW(3)**(-POWS) + SATCO/ZDEPTH(3)/POROS*SLOPE*POWS*DTT<a name='6325'>
      Q3G = Q3G ** ( 1. / POWS )<a name='6326'>
      Q3G = - ( 1. / Q3G - WWW(3) ) * POROS * ZDEPTH(3) / DTT<a name='6327'>
      Q3G = AMAX1( 0., Q3G )<a name='6328'>
      Q3G = AMIN1( Q3G, WWW(3)*POROS*ZDEPTH(3)/DTT )<a name='6329'>
<font color=#447700>!<a name='6330'></font>
      Q3G = Q3G + 0.002*POROS*ZDEPTH(3)*0.5 / 86400. * WWW(3)<a name='6331'>
<font color=#447700>!<a name='6332'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6333'></font>
<font color=#447700>!<a name='6334'></font>
<font color=#447700>!    calculation of inter-layer exchanges of water due to gravitation<a name='6335'></font>
<font color=#447700>!    and hydraulic gradient. the values of w(x) + dw(x) are used to<a name='6336'></font>
<font color=#447700>!    calculate the potential gradients between layers.<a name='6337'></font>
<font color=#447700>!    modified calculation of mean conductivities follows ME-82 ),<a name='6338'></font>
<font color=#447700>!    reduces recharge flux to top layer.<a name='6339'></font>
<font color=#447700>!<a name='6340'></font>
<font color=#447700>!      dpdw           : estimated derivative of soil moisture potential<a name='6341'></font>
<font color=#447700>!                       with respect to soil wetness. assumption of<a name='6342'></font>
<font color=#447700>!                       gravitational drainage used to estimate likely<a name='6343'></font>
<font color=#447700>!                       minimum wetness over the time step.<a name='6344'></font>
<font color=#447700>!<a name='6345'></font>
<font color=#447700>!      qqq  (q     )  : equation (61) , SE-86<a name='6346'></font>
<font color=#447700>!             i,i+1<a name='6347'></font>
<font color=#447700>!            -<a name='6348'></font>
<font color=#447700>!      avk  (k     )  : equation (4.14) , ME-82<a name='6349'></font>
<font color=#447700>!             i,i+1<a name='6350'></font>
<font color=#447700>!<a name='6351'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6352'></font>
<font color=#447700>!<a name='6353'></font>
      WMAX = AMAX1( WWW(1), WWW(2), WWW(3), 0.05 )<a name='6354'>
      WMAX = AMIN1( WMAX, 1. )<a name='6355'>
      PMAX = WMAX**(-BEE)<a name='6356'>
      WMIN = (PMAX-2./( PHSAT*(ZDEPTH(1)+2.*ZDEPTH(2)+ZDEPTH(3))))    &amp;<a name='6357'>
              **(-1./BEE)<a name='6358'>
      WMIN = AMIN1( WWW(1), WWW(2), WWW(3), WMIN )<a name='6359'>
      WMIN = AMAX1( WMIN, 0.02 )<a name='6360'>
      PMIN = WMIN**(-BEE)<a name='6361'>
      DPDW = PHSAT*( PMAX-PMIN )/( WMAX-WMIN )<a name='6362'>
<font color=#447700>!<a name='6363'></font>
      DO 8200 I = 1, 2<a name='6364'>
<font color=#447700>!<a name='6365'></font>
      RSAME = 0.<a name='6366'>
      AVK  = TEMWP(I)*TEMWPP(I) - TEMWP(I+1)*TEMWPP(I+1)<a name='6367'>
      DIV  = TEMWP(I+1) - TEMWP(I)<a name='6368'>
      IF ( ABS(DIV) .LT. 1.E-6 ) RSAME = 1.<a name='6369'>
      AVK = SATCO*AVK / ( ( 1. + 3./BEE ) * DIV + RSAME )<a name='6370'>
      AVKMIN = SATCO * AMIN1( TEMWPP(I), TEMWPP(I+1) )<a name='6371'>
      AVKMAX = SATCO * AMAX1( TEMWPP(I), TEMWPP(I+1) )*1.01<a name='6372'>
      AVK = AMAX1( AVK, AVKMIN )<a name='6373'>
      AVK = AMIN1( AVK, AVKMAX )<a name='6374'>
<font color=#447700>!<a name='6375'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6376'></font>
<font color=#447700>!     conductivities and base flow reduced when temperature drops below<a name='6377'></font>
<font color=#447700>!     freezing.<a name='6378'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6379'></font>
<font color=#447700>!<a name='6380'></font>
      TSNOW = AMIN1 ( TF-0.01, TGS )<a name='6381'>
      AREAS = AMIN1 (0.999,13.2*SNOWW(2))<a name='6382'>
      TGG = TSNOW*AREAS + TGS*(1.-AREAS)<a name='6383'>
      TS    = TGG*(2-I) + TD*(I-1)<a name='6384'>
      PROPS = ( TS-(TF-10.) ) / 10.<a name='6385'>
      PROPS = AMAX1( 0.05, AMIN1( 1.0, PROPS ) )<a name='6386'>
      AVK  = AVK * PROPS<a name='6387'>
      Q3G  = Q3G * PROPS<a name='6388'>
<font color=#447700>!<a name='6389'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6390'></font>
<font color=#447700>!     backward implicit calculation of flows between soil layers.<a name='6391'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6392'></font>
<font color=#447700>!<a name='6393'></font>
      DPDWDZ = DPDW * 2./( ZDEPTH(I) + ZDEPTH(I+1) )<a name='6394'>
      AAA(I) = 1. + AVK*DPDWDZ*( 1./ZDEPTH(I)+1./ZDEPTH(I+1) )         &amp;<a name='6395'>
                  *DTT/POROS<a name='6396'>
      BBB(I) =-AVK *   DPDWDZ * 1./ZDEPTH(2)*DTT/POROS<a name='6397'>
      CCC(I) = AVK * ( DPDWDZ * ( WWW(I)-WWW(I+1) ) + 1. +             &amp;<a name='6398'>
                 (I-1)*DPDWDZ*Q3G*1./ZDEPTH(3)*DTT/POROS )<a name='6399'>
8200  CONTINUE<a name='6400'>
<font color=#447700>!<a name='6401'></font>
      DENOM  = ( AAA(1)*AAA(2) - BBB(1)*BBB(2) )<a name='6402'>
      RDENOM = 0.<a name='6403'>
      IF ( ABS(DENOM) .LT. 1.E-6 ) RDENOM = 1.<a name='6404'>
      RDENOM = ( 1.-RDENOM)/( DENOM + RDENOM )<a name='6405'>
      QQQ(1)   = ( AAA(2)*CCC(1) - BBB(1)*CCC(2) ) * RDENOM<a name='6406'>
      QQQ(2)   = ( AAA(1)*CCC(2) - BBB(2)*CCC(1) ) * RDENOM<a name='6407'>
<font color=#447700>!<a name='6408'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6409'></font>
<font color=#447700>!     update wetness of each soil moisture layer due to layer interflow<a name='6410'></font>
<font color=#447700>!        and base flow.<a name='6411'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6412'></font>
<font color=#447700>!<a name='6413'></font>
      WWW(3) = WWW(3) - Q3G*DTT/(POROS*ZDEPTH(3))<a name='6414'>
      ROFF = ROFF + Q3G * DTT<a name='6415'>
<font color=#447700>!<a name='6416'></font>
      DO 8300 I = 1, 2<a name='6417'>
<font color=#447700>!<a name='6418'></font>
      QMAX   =  WWW(I)   * (POROS*ZDEPTH(I)  /DTT)<a name='6419'>
      QMIN   = -WWW(I+1) * (POROS*ZDEPTH(I+1)/DTT)<a name='6420'>
      QQQ(I) = AMIN1( QQQ(I),QMAX)<a name='6421'>
      QQQ(I) = AMAX1( QQQ(I),QMIN)<a name='6422'>
      WWW(I)   =   WWW(I)   - QQQ(I)/(POROS*ZDEPTH(I)  /DTT)<a name='6423'>
      WWW(I+1) =   WWW(I+1) + QQQ(I)/(POROS*ZDEPTH(I+1)/DTT)<a name='6424'>
8300  CONTINUE<a name='6425'>
<font color=#447700>!<a name='6426'></font>
<font color=#447700>!       *** LOAD water flow &amp; root-zone drainage PILPS DATA<a name='6427'></font>
      SOILDIF=SOILDIF+QQQ(1)*DTT*1000.<a name='6428'>
      SOILDRA=SOILDRA+Q3G*DTT*1000.<a name='6429'>
<font color=#447700>!<a name='6430'></font>
      DO 8400 I = 1, 3<a name='6431'>
      EXCESS = AMAX1(0.,(WWW(I) - 1.))<a name='6432'>
      WWW(I) = WWW(I) - EXCESS<a name='6433'>
      ROFF   = ROFF   + EXCESS * POROS*ZDEPTH(I)<a name='6434'>
<font color=#447700>!<a name='6435'></font>
<font color=#447700>!       *** LOAD IN as root-drainage for PILPS<a name='6436'></font>
      IF (I.LT.2) THEN<a name='6437'>
        RNOFFS= RNOFFS+ 1000.*EXCESS*POROS*ZDEPTH(I)<a name='6438'>
      ELSE<a name='6439'>
        RNOFFB= RNOFFB+ 1000.*EXCESS*POROS*ZDEPTH(I)<a name='6440'>
      ENDIF<a name='6441'>
8400  CONTINUE<a name='6442'>
<font color=#447700>!<a name='6443'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6444'></font>
<font color=#447700>!     prevent negative values of www(i)<a name='6445'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6446'></font>
<font color=#447700>!<a name='6447'></font>
      DO 8402 I = 1,2<a name='6448'>
      DEFICIT   = AMAX1 (0.,(1.E-12 - WWW(I)))<a name='6449'>
      IF (I.EQ.1) SOILDIF=SOILDIF-DEFICIT*                            &amp;<a name='6450'>
                  ZDEPTH(1)*POROS<a name='6451'>
      WWW (I)   = WWW(I) + DEFICIT<a name='6452'>
      WWW (I+1) = WWW(I+1) - DEFICIT * ZDEPTH(I) / ZDEPTH (I+1)<a name='6453'>
 8402 CONTINUE<a name='6454'>
      WWW(3)    = AMAX1 (WWW(3),1.E-12)<a name='6455'>
<font color=#447700>!<a name='6456'></font>
800   CONTINUE<a name='6457'>
<font color=#447700>!<a name='6458'></font>
      IF (WWW(1) .GT.1.) THEN<a name='6459'>
          WWW(2) = WWW(2) + (WWW(1)-1.) * ZDEPTH(1)/                   &amp;<a name='6460'>
                                   ZDEPTH(2)<a name='6461'>
          SOILDIF=SOILDIF+(WWW(1)-1.)*ZDEPTH(1)                        &amp;<a name='6462'>
                         *POROS*1000.<a name='6463'>
          WWW(1) = 1.<a name='6464'>
      END IF<a name='6465'>
      If (WWW(2) .GT.1.) WWW(3) = WWW(3) + (WWW(2)-1.) *               &amp;<a name='6466'>
                                  ZDEPTH(2) / ZDEPTH(3)<a name='6467'>
<font color=#447700>!<a name='6468'></font>
<font color=#447700>!       *** LOAD IN AS PILP ROOT DRAINAGE<a name='6469'></font>
      IF (WWW(2) .GT.1.) WWW(2) = 1.<a name='6470'>
      IF (WWW(3) .GT.1.) THEN<a name='6471'>
          ROFF   = ROFF + (WWW(3)-1.)*POROS*ZDEPTH(3)<a name='6472'>
          RNOFFB=RNOFFB+((WWW(3)-1.)*ZDEPTH(3)*                        &amp;<a name='6473'>
                 POROS*1000.)<a name='6474'>
          WWW(3) = 1.<a name='6475'>
      END IF<a name='6476'>
<font color=#447700>!<a name='6477'></font>
<font color=#447700>!------------------------------------------------------<a name='6478'></font>
      END SUBROUTINE UPDAT1_ICE<a name='6479'>
<font color=#447700>!------------------------------------------------------<a name='6480'></font>
<a name='6481'>
<font color=#447700>!=======================================================================<a name='6482'></font>
<font color=#447700>!                                                                       <a name='6483'></font>
<A NAME='CONVDIM'><A href='../../html_code/phys/module_sf_ssib.F.html#CONVDIM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6484'>
         <font color=#993300>SUBROUTINE </font><font color=#cc0000>CONVDIM</font>(IOFLAG,                              &amp; <A href='../../call_to/CONVDIM.html' TARGET='index'>2</A><a name='6485'>
   DZO1,WO1,TSSN1,TSSNO1,BWO1,BTO1,CTO1,FIO1,FLO1,BIO1,BLO1,HO1, &amp;<a name='6486'>
   DZO2,WO2,TSSN2,TSSNO2,BWO2,BTO2,CTO2,FIO2,FLO2,BIO2,BLO2,HO2, &amp;<a name='6487'>
   DZO3,WO3,TSSN3,TSSNO3,BWO3,BTO3,CTO3,FIO3,FLO3,BIO3,BLO3,HO3, &amp;<a name='6488'>
   DZO4,WO4,TSSN4,TSSNO4,BWO4,BTO4,CTO4,FIO4,FLO4,BIO4,BLO4,HO4, &amp;<a name='6489'>
   DZO, WO, TSSN, TSSNO, BWO, BTO, CTO, FIO, FLO, BIO, BLO, HO )<a name='6490'>
<font color=#447700>!<a name='6491'></font>
<font color=#447700>!=======================================================================<a name='6492'></font>
<font color=#447700>!     Ratko                                                 Oct., 2007<a name='6493'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='6494'></font>
<a name='6495'>
 REAL, DIMENSION (4) :: DZO,WO,TSSN,TSSNO,BWO,BTO,CTO,FIO,FLO,BIO,BLO,HO<a name='6496'>
<a name='6497'>
       IF     (IOFLAG.EQ.0) THEN  <font color=#447700>! variable to array<a name='6498'></font>
<a name='6499'>
         DZO (1) = DZO1<a name='6500'>
          WO (1) = WO1<a name='6501'>
        TSSN (1) = TSSN1<a name='6502'>
       TSSNO (1) = TSSNO1<a name='6503'>
         BWO (1) = BWO1<a name='6504'>
         BTO (1) = BTO1<a name='6505'>
         CTO (1) = CTO1<a name='6506'>
         FIO (1) = FIO1<a name='6507'>
         FLO (1) = FLO1<a name='6508'>
         BIO (1) = BIO1<a name='6509'>
         BLO (1) = BLO1<a name='6510'>
          HO (1) = HO1<a name='6511'>
<a name='6512'>
         DZO (2) = DZO2<a name='6513'>
          WO (2) = WO2<a name='6514'>
        TSSN (2) = TSSN2<a name='6515'>
       TSSNO (2) = TSSNO2<a name='6516'>
         BWO (2) = BWO2<a name='6517'>
         BTO (2) = BTO2<a name='6518'>
         CTO (2) = CTO2<a name='6519'>
         FIO (2) = FIO2<a name='6520'>
         FLO (2) = FLO2<a name='6521'>
         BIO (2) = BIO2<a name='6522'>
         BLO (2) = BLO2<a name='6523'>
          HO (2) = HO2<a name='6524'>
<a name='6525'>
         DZO (3) = DZO3<a name='6526'>
          WO (3) = WO3<a name='6527'>
        TSSN (3) = TSSN3<a name='6528'>
       TSSNO (3) = TSSNO3<a name='6529'>
         BWO (3) = BWO3<a name='6530'>
         BTO (3) = BTO3<a name='6531'>
         CTO (3) = CTO3<a name='6532'>
         FIO (3) = FIO3<a name='6533'>
         FLO (3) = FLO3<a name='6534'>
         BIO (3) = BIO3<a name='6535'>
         BLO (3) = BLO3<a name='6536'>
          HO (3) = HO3<a name='6537'>
<a name='6538'>
         DZO (4) = DZO4<a name='6539'>
          WO (4) = WO4<a name='6540'>
        TSSN (4) = TSSN4<a name='6541'>
       TSSNO (4) = TSSNO4<a name='6542'>
         BWO (4) = BWO4<a name='6543'>
         BTO (4) = BTO4<a name='6544'>
         CTO (4) = CTO4<a name='6545'>
         FIO (4) = FIO4<a name='6546'>
         FLO (4) = FLO4<a name='6547'>
         BIO (4) = BIO4<a name='6548'>
         BLO (4) = BLO4<a name='6549'>
          HO (4) = HO4<a name='6550'>
<a name='6551'>
       ELSEIF (IOFLAG.EQ.1) THEN  <font color=#447700>! array to variable<a name='6552'></font>
<a name='6553'>
            DZO1 = DZO(1)<a name='6554'>
             WO1 = WO(1)<a name='6555'>
           TSSN1 = TSSN(1)<a name='6556'>
          TSSNO1 = TSSNO(1)<a name='6557'>
            BWO1 = BWO(1)<a name='6558'>
            BTO1 = BTO(1)<a name='6559'>
            CTO1 = CTO(1)<a name='6560'>
            FIO1 = FIO(1)<a name='6561'>
            FLO1 = FLO(1)<a name='6562'>
            BIO1 = BIO(1)<a name='6563'>
            BLO1 = BLO(1)<a name='6564'>
             HO1 = HO(1)<a name='6565'>
<a name='6566'>
            DZO2 = DZO(2)<a name='6567'>
             WO2 = WO(2)<a name='6568'>
           TSSN2 = TSSN(2)<a name='6569'>
          TSSNO2 = TSSNO(2)<a name='6570'>
            BWO2 = BWO(2)<a name='6571'>
            BTO2 = BTO(2)<a name='6572'>
            CTO2 = CTO(2)<a name='6573'>
            FIO2 = FIO(2)<a name='6574'>
            FLO2 = FLO(2)<a name='6575'>
            BIO2 = BIO(2)<a name='6576'>
            BLO2 = BLO(2)<a name='6577'>
             HO2 = HO(2)<a name='6578'>
<a name='6579'>
            DZO3 = DZO(3)<a name='6580'>
             WO3 = WO(3)<a name='6581'>
           TSSN3 = TSSN(3)<a name='6582'>
          TSSNO3 = TSSNO(3)<a name='6583'>
            BWO3 = BWO(3)<a name='6584'>
            BTO3 = BTO(3)<a name='6585'>
            CTO3 = CTO(3)<a name='6586'>
            FIO3 = FIO(3)<a name='6587'>
            FLO3 = FLO(3)<a name='6588'>
            BIO3 = BIO(3)<a name='6589'>
            BLO3 = BLO(3)<a name='6590'>
             HO3 = HO(3)<a name='6591'>
<a name='6592'>
            DZO4 = DZO(4)<a name='6593'>
             WO4 = WO(4)<a name='6594'>
           TSSN4 = TSSN(4)<a name='6595'>
          TSSNO4 = TSSNO(4)<a name='6596'>
            BWO4 = BWO(4)<a name='6597'>
            BTO4 = BTO(4)<a name='6598'>
            CTO4 = CTO(4)<a name='6599'>
            FIO4 = FIO(4)<a name='6600'>
            FLO4 = FLO(4)<a name='6601'>
            BIO4 = BIO(4)<a name='6602'>
            BLO4 = BLO(4)<a name='6603'>
             HO4 = HO(4)<a name='6604'>
<a name='6605'>
       ELSE<a name='6606'>
          print*,'something wrong in CONVDIM',IOFLAG<a name='6607'>
          STOP<a name='6608'>
       ENDIF<a name='6609'>
<font color=#447700>!------------------------------------------------------<a name='6610'></font>
       END SUBROUTINE CONVDIM<a name='6611'>
<font color=#447700>!------------------------------------------------------<a name='6612'></font>
<a name='6613'>
END MODULE module_sf_ssib<a name='6614'>
</pre></body></html>