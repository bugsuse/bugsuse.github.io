<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>! WRF:MEDIATION_LAYER:FIRE_MODEL<a name='2'></font>
<a name='3'>
<a name='4'>
#define DEBUG_OUT<a name='5'>
<a name='6'>
<A NAME='MODULE_FR_FIRE_DRIVER_WRF'><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#MODULE_FR_FIRE_DRIVER_WRF' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='7'>
<font color=#993300>module </font><font color=#cc0000>module_fr_fire_driver_wrf</font> <A href='../../call_to/MODULE_FR_FIRE_DRIVER_WRF.html' TARGET='index'>2</A><a name='8'>
<font color=#447700>! wrf-specific driver<a name='9'></font>
<a name='10'>
use <A href='../../html_code/phys/module_fr_fire_driver.F.html#MODULE_FR_FIRE_DRIVER'>module_fr_fire_driver</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#module_fr_fire_driver_wrf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FR_FIRE_DRIVER_1"><a name='11'>
use <A href='../../html_code/phys/module_fr_fire_atm.F.html#MODULE_FR_FIRE_ATM'>module_fr_fire_atm</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#module_fr_fire_driver_wrf.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FR_FIRE_ATM_1"><a name='12'>
implicit none<a name='13'>
<a name='14'>
contains<a name='15'>
<a name='16'>
<A NAME='FIRE_DRIVER_EM_INIT'><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='17'>
<font color=#993300>subroutine </font><font color=#cc0000>fire_driver_em_init</font> (grid , config_flags               &amp;  <A href='../../call_to/FIRE_DRIVER_EM_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/FIRE_DRIVER_EM_INIT.html' TARGET='index'>6</A><a name='18'>
            ,ids,ide, kds,kde, jds,jde                              &amp;<a name='19'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='20'>
            ,ips,ipe, kps,kpe, jps,jpe)<a name='21'>
<a name='22'>
    <font color=#447700>! stub to call fire_driver_em with irun=0 and omit last 3 args<a name='23'></font>
<a name='24'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_233"> , only: domain , get_ijk_from_subgrid<a name='25'>
    USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_151"> , only : grid_config_rec_type<a name='26'>
    implicit none<a name='27'>
<a name='28'>
    TYPE(domain) , TARGET          :: grid   <font color=#447700>! data<a name='29'></font>
    TYPE (grid_config_rec_type) , INTENT(IN)          :: config_flags<a name='30'>
    integer, intent(in):: &amp;<a name='31'>
             ids,ide, kds,kde, jds,jde                              &amp;<a name='32'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='33'>
            ,ips,ipe, kps,kpe, jps,jpe<a name='34'>
<a name='35'>
    <font color=#447700>! local<a name='36'></font>
    integer :: &amp;  <font color=#447700>! fire mesh sizes<a name='37'></font>
             ifds,ifde, kfds,kfde, jfds,jfde,                              &amp;<a name='38'>
             ifms,ifme, kfms,kfme, jfms,jfme,                              &amp;<a name='39'>
             ifps,ifpe, kfps,kfpe, jfps,jfpe                              <a name='40'>
    <font color=#447700>! dummies<a name='41'></font>
<a name='42'>
    real,dimension(1,1,1)::rho,z_at_w,dz8w<a name='43'>
<a name='44'>
    call <A href='../../html_code/phys/module_fr_fire_util.F.html#MESSAGE'>message</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MESSAGE_53">('fire_driver_em_init: FIRE initialization start')<a name='45'>
<a name='46'>
    <font color=#447700>! get fire mesh dimensions<a name='47'></font>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID'>get_ijk_from_subgrid</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_SUBGRID_3"> (  grid ,                   &amp;<a name='48'>
                            ifds,ifde, jfds,jfde,kfds,kfde,                        &amp;<a name='49'>
                            ifms,ifme, jfms,jfme,kfms,kfme,                        &amp;<a name='50'>
                            ifps,ifpe, jfps,jfpe,kfps,kfpe) <a name='51'>
<a name='52'>
    call <A href='../../html_code/phys/module_fr_fire_driver.F.html#FIRE_DRIVER_EM'>fire_driver_em</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIRE_DRIVER_EM_1"> ( grid , config_flags               &amp; <a name='53'>
            ,1,3,0                        &amp; <font color=#447700>! ifun start, end, test steps<a name='54'></font>
            ,ids,ide, kds,kde, jds,jde                              &amp;<a name='55'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='56'>
            ,ips,ipe, kps,kpe, jps,jpe                              &amp;<a name='57'>
            ,ifds,ifde, jfds,jfde                                   &amp;<a name='58'>
            ,ifms,ifme, jfms,jfme                                   &amp;<a name='59'>
            ,ifps,ifpe, jfps,jfpe                                   &amp;<a name='60'>
            ) <a name='61'>
<a name='62'>
    call <A href='../../html_code/phys/module_fr_fire_util.F.html#MESSAGE'>message</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MESSAGE_54">('fire_driver_em_init: FIRE initialization complete')<a name='63'>
<a name='64'>
end subroutine fire_driver_em_init<a name='65'>
<a name='66'>
<font color=#447700>!<a name='67'></font>
<font color=#447700>!***<a name='68'></font>
<font color=#447700>!<a name='69'></font>
<a name='70'>
<A NAME='FIRE_DRIVER_EM_STEP'><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='71'>
<font color=#993300>subroutine </font><font color=#cc0000>fire_driver_em_step</font> (grid , config_flags               &amp;  <A href='../../call_to/FIRE_DRIVER_EM_STEP.html' TARGET='index'>1</A>,<A href='../../call_from/FIRE_DRIVER_EM_STEP.html' TARGET='index'>10</A><a name='72'>
            ,ids,ide, kds,kde, jds,jde                              &amp;<a name='73'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='74'>
            ,ips,ipe, kps,kpe, jps,jpe                              &amp;<a name='75'>
            ,rho,z_at_w,dz8w ) <a name='76'>
<a name='77'>
    <font color=#447700>! stub to call fire_driver_em <a name='78'></font>
<a name='79'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_234">, only: domain , get_ijk_from_subgrid<a name='80'>
    USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_152"> , only : grid_config_rec_type<a name='81'>
    USE <A href='../../html_code/phys/module_fr_fire_util.F.html#MODULE_FR_FIRE_UTIL'>module_fr_fire_util</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_FR_FIRE_UTIL_4">, only : fire_test_steps<a name='82'>
    implicit none<a name='83'>
<a name='84'>
    TYPE(domain) , TARGET          :: grid   <font color=#447700>! data<a name='85'></font>
    TYPE (grid_config_rec_type) , INTENT(IN)          :: config_flags<a name='86'>
    integer, intent(in):: &amp;<a name='87'>
             ids,ide, kds,kde, jds,jde                              &amp;<a name='88'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='89'>
            ,ips,ipe, kps,kpe, jps,jpe<a name='90'>
    real,dimension(ims:ime, kms:kme, jms:jme),intent(in)::rho,z_at_w,dz8w<a name='91'>
<a name='92'>
    <font color=#447700>! local<a name='93'></font>
    integer :: &amp;  <font color=#447700>! fire mesh sizes<a name='94'></font>
             ifds,ifde, kfds,kfde, jfds,jfde,                              &amp;<a name='95'>
             ifms,ifme, kfms,kfme, jfms,jfme,                              &amp;<a name='96'>
             ifps,ifpe, kfps,kfpe, jfps,jfpe                              <a name='97'>
    integer :: its,ite,jts,jte,kts,kte            <font color=#447700>! atm tile<a name='98'></font>
    integer:: ij <a name='99'>
<a name='100'>
    call <A href='../../html_code/phys/module_fr_fire_util.F.html#MESSAGE'>message</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MESSAGE_55">('fire_driver_em_step: FIRE step start')<a name='101'>
<a name='102'>
    <font color=#447700>! get fire mesh dimensions<a name='103'></font>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID'>get_ijk_from_subgrid</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_SUBGRID_4"> (  grid ,                   &amp;<a name='104'>
                            ifds,ifde, jfds,jfde,kfds,kfde,                        &amp;<a name='105'>
                            ifms,ifme, jfms,jfme,kfms,kfme,                        &amp;<a name='106'>
                            ifps,ifpe, jfps,jfpe,kfps,kfpe) <a name='107'>
<a name='108'>
    call <A href='../../html_code/phys/module_fr_fire_driver.F.html#FIRE_DRIVER_EM'>fire_driver_em</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIRE_DRIVER_EM_2"> ( grid , config_flags               &amp; <a name='109'>
            ,3,6,fire_test_steps                                &amp;<a name='110'>
            ,ids,ide, kds,kde, jds,jde                              &amp;<a name='111'>
            ,ims,ime, kms,kme, jms,jme                              &amp;<a name='112'>
            ,ips,ipe, kps,kpe, jps,jpe                              &amp;<a name='113'>
            ,ifds,ifde, jfds,jfde                                   &amp;<a name='114'>
            ,ifms,ifme, jfms,jfme                                   &amp;<a name='115'>
            ,ifps,ifpe, jfps,jfpe                                   &amp;<a name='116'>
            ) <a name='117'>
<a name='118'>
    <font color=#447700>! --- add heat and moisture fluxes to tendency variables by postulated decay<a name='119'></font>
    do ij=1,grid%num_tiles<a name='120'>
       <font color=#447700>! FIRE works on domain by 1 smaller, in last row&amp;col winds are not set properly<a name='121'></font>
       its = grid%i_start(ij)             <font color=#447700>! start atmospheric tile in i<a name='122'></font>
       ite = min(grid%i_end(ij),ide-1)    <font color=#447700>! end atmospheric tile in i<a name='123'></font>
       jts = grid%j_start(ij)             <font color=#447700>! start atmospheric tile in j<a name='124'></font>
       jte = min(grid%j_end(ij),jde-1)    <font color=#447700>! end atmospheric tile in j<a name='125'></font>
       kts=kds<a name='126'>
       kte=kde<a name='127'>
<a name='128'>
       call <A href='../../html_code/phys/module_fr_fire_atm.F.html#FIRE_TENDENCY'>fire_tendency</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIRE_TENDENCY_1">(                 &amp;<a name='129'>
            ids,ide-1, kds,kde, jds,jde-1, &amp; <font color=#447700>! domain dimensions<a name='130'></font>
            ims,ime, kms,kme, jms,jme,      &amp;<a name='131'>
            its,ite, kts,kte, jts,jte,      &amp; <font color=#447700>! <a name='132'></font>
            grid%grnhfx,grid%grnqfx,grid%canhfx,grid%canqfx,        &amp; <font color=#447700>! fluxes on atm grid <a name='133'></font>
            config_flags%fire_ext_grnd,config_flags%fire_ext_crwn,config_flags%fire_crwn_hgt,                &amp;<a name='134'>
            grid%ht,z_at_w,dz8w,grid%mut,grid%c1h,grid%c2h,rho,          &amp;<a name='135'>
            grid%rthfrten,grid%rqvfrten)                <font color=#447700>! out<a name='136'></font>
<a name='137'>
     enddo<a name='138'>
<a name='139'>
       <font color=#447700>! debug print to compare<a name='140'></font>
<a name='141'>
       call <A href='../../html_code/phys/module_fr_fire_util.F.html#PRINT_3D_STATS'>print_3d_stats</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PRINT_3D_STATS_5">(its,ite,kts,kte,jts,jte,ims,ime,kms,kme,jms,jme,grid%rthfrten,'fire_driver_phys:rthfrten')<a name='142'>
       call <A href='../../html_code/phys/module_fr_fire_util.F.html#PRINT_3D_STATS'>print_3d_stats</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PRINT_3D_STATS_6">(its,ite,kts,kte,jts,jte,ims,ime,kms,kme,jms,jme,grid%rqvfrten,'fire_driver_phys:rqvfrten')<a name='143'>
<a name='144'>
    call <A href='../../html_code/phys/module_fr_fire_util.F.html#MESSAGE'>message</A><A href='../../html_code/phys/module_fr_fire_driver_wrf.F.html#FIRE_DRIVER_EM_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MESSAGE_56">('fire_driver_em_step: FIRE step complete')<a name='145'>
            <a name='146'>
end subroutine fire_driver_em_step<a name='147'>
<a name='148'>
end module module_fr_fire_driver_wrf<a name='149'>
<a name='150'>
</pre></body></html>