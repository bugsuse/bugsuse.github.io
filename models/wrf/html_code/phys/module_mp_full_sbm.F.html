<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MODEL_MP:PHYSICS<a name='2'></font>
<font color=#447700>! The FULL version calculates hydrometeor distributions for qc,qr,qs,qg. and qh, and three ice types,<a name='3'></font>
<font color=#447700>! and their number concentrations (and aerosol concentrations).<a name='4'></font>
<font color=#447700>! To use the FULL version of SBM, please do the following.<a name='5'></font>
<font color=#447700>! Set DX_BOUND to some value larger than the first inner nest, but smaller than the outer domain in meters<a name='6'></font>
<font color=#447700>! Set the aerosol concentration with the variables FCCNR_MAR, and FCCNR_CON, FCCNR_MIX.  <a name='7'></font>
<font color=#447700>! Each of the aerosol distributions are set with ACCN (concentration of ccn particles at 1% saturation), and<a name='8'></font>
<font color=#447700>! BCCN (the "k" coefficient; for example: FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN). <a name='9'></font>
<font color=#447700>! Questions: contact barry.h.lynn@gmail.com (Barry Lynn)<a name='10'></font>
<a name='11'>
<font color=#447700>!<a name='12'></font>
<A NAME='MODULE_MP_FULL_SBM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#MODULE_MP_FULL_SBM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='13'>
<font color=#993300>MODULE </font><font color=#cc0000>module_mp_full_sbm</font> <A href='../../call_to/MODULE_MP_FULL_SBM.html' TARGET='index'>2</A><a name='14'>
USE <A href='../../html_code/phys/module_mp_radar.F.html#MODULE_MP_RADAR'>module_mp_radar</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#module_mp_full_sbm.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_RADAR_2"><a name='15'>
<font color=#447700>!<a name='16'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='17'></font>
<font color=#447700>! BARRY<a name='18'></font>
      INTEGER,PRIVATE,PARAMETER :: REMSAT = 0<a name='19'>
      INTEGER, PRIVATE,PARAMETER :: IBREAKUP=1<a name='20'>
      LOGICAL, PRIVATE,PARAMETER :: CONSERV=.TRUE.<a name='21'>
<font color=#447700>! SET ONE = TRUE<a name='22'></font>
      LOGICAL, PRIVATE,PARAMETER :: ORIGINAL_MELT=.FALSE.<a name='23'>
      LOGICAL, PRIVATE,PARAMETER :: JIWEN_FAN_MELT=.TRUE.<a name='24'>
<font color=#447700>!     LOGICAL, PRIVATE,PARAMETER :: ORIGINAL_MELT=.TRUE.<a name='25'></font>
<font color=#447700>!     LOGICAL, PRIVATE,PARAMETER :: JIWEN_FAN_MELT=.FALSE.<a name='26'></font>
      INTEGER, PRIVATE,PARAMETER :: p_ff1i01=2, p_ff1i33=34,p_ff5i01=35,p_ff5i33=67,p_ff6i01=68,&amp;<a name='27'>
     &amp; p_ff6i33=100,p_ff8i01=101,p_ff8i33=133,p_ff2i01=134,p_ff2i33=166,p_ff3i01=167,p_ff3i33=199,&amp;<a name='28'>
     &amp; p_ff4i01=200,p_ff4i33=232,p_ff7i01=233,p_ff7i33=265<a name='29'>
<font color=#447700>!p_ff1i01 =            2<a name='30'></font>
<font color=#447700>!p_ff1i33 =           34<a name='31'></font>
<font color=#447700>!p_ff5i01 =           35<a name='32'></font>
<font color=#447700>!p_ff5i33 =           67<a name='33'></font>
<font color=#447700>!p_ff6i01 =           68<a name='34'></font>
<font color=#447700>!p_ff6i33 =          100<a name='35'></font>
<font color=#447700>!p_ff8i01 =          101<a name='36'></font>
<font color=#447700>!p_ff8i33 =          133<a name='37'></font>
<font color=#447700>!p_ff2i01 =          134<a name='38'></font>
<font color=#447700>!p_ff2i33 =          166<a name='39'></font>
<font color=#447700>!p_ff3i01 =          167<a name='40'></font>
<font color=#447700>!p_ff3i33 =          199<a name='41'></font>
<font color=#447700>!p_ff4i01 =          200<a name='42'></font>
<font color=#447700>!p_ff4i33 =          232<a name='43'></font>
<font color=#447700>!p_ff7i01 =          233<a name='44'></font>
<font color=#447700>!p_ff7i33 =          265<a name='45'></font>
<a name='46'>
<a name='47'>
<font color=#447700>!     100<a name='48'></font>
<font color=#447700>!     REAL,PRIVATE,PARAMETER :: F_AMOUNT=0.1<a name='49'></font>
<font color=#447700>!     TEN <a name='50'></font>
<font color=#447700>!     REAL,PRIVATE,PARAMETER :: F_AMOUNT=0.01<a name='51'></font>
<font color=#447700>!     ONE<a name='52'></font>
      REAL, PRIVATE,PARAMETER :: PI_MORR = 3.1415926535897932384626434<a name='53'>
      REAL, PRIVATE,PARAMETER ::  R_MORR = 287.15<a name='54'>
      REAL,PRIVATE,PARAMETER :: F_AMOUNT=0.001<a name='55'>
      REAL,PRIVATE,PARAMETER :: DX_BOUND=7500<a name='56'>
      REAL ACCN,BCCN<a name='57'>
      REAL,PRIVATE,PARAMETER :: ACCN_MAR=1.0000E02, BCCN_MAR=0.900E00,ROCCN0=0.1000E01<a name='58'>
      REAL,PRIVATE,PARAMETER :: ACCN_CON=2.00000E03, BCCN_CON=0.400E00,ROCCN03=0.1000E01<a name='59'>
      REAL,PRIVATE,PARAMETER :: I3POINT=1<a name='60'>
      INTEGER,PRIVATE,PARAMETER :: ICCN = 1<a name='61'>
       DOUBLE PRECISION, PRIVATE, PARAMETER ::  SCAL=1.d0<a name='62'>
       INTEGER, PRIVATE,PARAMETER :: ICEPROCS=1,BULKNUC=0 <a name='63'>
       INTEGER, PRIVATE,PARAMETER :: ICETURB=0,LIQTURB=0<a name='64'>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: RAIN_INIT=1,GRAUPEL_INIT=1<a name='65'></font>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: ICE_INIT=0,SNOW_INIT=1<a name='66'></font>
<a name='67'>
       INTEGER, PRIVATE,PARAMETER :: ICEMAX=3,NCD=33,NHYDR=5,NHYDRO=7  &amp;<a name='68'>
     &amp;        ,ifreez_down1=0,ifreez_down2=1,ifreez_top=1              &amp;<a name='69'>
     &amp;        ,K0_LL=8,KRMIN_LL=1,KRMAX_LL=19,L0_LL=6                  &amp;<a name='70'>
     &amp;        , IEPS_400=1,IEPS_800=0,IEPS_1600=0                      &amp;<a name='71'>
     &amp;        ,K0L_GL=16,K0G_GL=16                                     &amp;<a name='72'>
     &amp;        ,KRMINL_GL=1,KRMAXL_GL=24                                &amp;<a name='73'>
     &amp;        ,KRMING_GL=1,KRMAXG_GL=33                                &amp;<a name='74'>
     &amp;        ,KRDROP=18,KRBREAK=17,KRICE=18                           &amp;<a name='75'>
     &amp;        ,NKR=33,JMAX=33,NRG=2,JBREAK = 18 <a name='76'>
       REAL dt_coll<a name='77'>
<font color=#447700>!      REAL, PRIVATE,PARAMETER ::C1_MEY=0.0033,C2_MEY=0.              &amp;<a name='78'></font>
       REAL, PRIVATE,PARAMETER ::C1_MEY=0.00033,C2_MEY=0.              &amp;<a name='79'>
<font color=#447700>! New CONTINENTAL<a name='80'></font>
<font color=#447700>!      REAL, PRIVATE,PARAMETER ::C1_MEY=0.0033,C2_MEY=0.              &amp;<a name='81'></font>
     &amp;        ,an0_freez=10.,COL=0.23105                                <a name='82'>
       REAL, PRIVATE,PARAMETER :: p1=1000000.0,p2=750000.0,p3=500000.0                     <a name='83'>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: NCOND=3<a name='84'></font>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: NCOND=6<a name='85'></font>
       INTEGER, PRIVATE :: NCOND<a name='86'>
       INTEGER, PRIVATE,PARAMETER :: kr_icempl=9<a name='87'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 1.0<a name='88'></font>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 2.0<a name='89'></font>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 1.5<a name='90'></font>
       REAL, PRIVATE, PARAMETER :: ALCR = 2.25<a name='91'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 3.0<a name='92'></font>
       REAL, PRIVATE, PARAMETER :: ALCR_G = 3.0<a name='93'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR_G = 1.0<a name='94'></font>
       INTEGER,PRIVATE,PARAMETER :: icempl=1<a name='95'>
       REAL, PRIVATE, PARAMETER :: COEFREFLL=1.E6*36.E6*COL/3.1453/3.1453 <a name='96'>
       REAL, PRIVATE, PARAMETER :: COEFREFLI=1.E9*36.E3*COL/3.1453/3.1453/5.<a name='97'>
       REAL, PRIVATE, PARAMETER :: COEFREF00=1.E9*36.E3*COL/3.1453/3.1453       <a name='98'>
       REAL, PRIVATE,DIMENSION(NKR) ::COLREFLL,COLREFLI,COLREFLS,COLREFLG,COLREFLH<a name='99'>
<a name='100'>
<a name='101'>
<font color=#447700>! YWLL_1000MB(nkr,nkr) - input array of kernels for pressure 1000mb<a name='102'></font>
<font color=#447700>! YWLL_750MB(nkr,nkr) - input array of kernels for pressure 750mb<a name='103'></font>
<font color=#447700>! YWLL_500MB(nkr,nkr) - input array of kernels for pressure 500mb<a name='104'></font>
       REAL, PRIVATE, SAVE :: &amp;<a name='105'>
<font color=#447700>! CRYSTALS <a name='106'></font>
     &amp;YWLI(NKR,NKR,ICEMAX) &amp;<a name='107'>
<font color=#447700>! MIXTURES<a name='108'></font>
     &amp;,YWIL(NKR,NKR,ICEMAX),YWII(NKR,NKR,ICEMAX,ICEMAX) &amp;<a name='109'>
     &amp;,YWIS(NKR,NKR,ICEMAX),YWIG(NKR,NKR,ICEMAX) &amp;<a name='110'>
     &amp;,YWIH(NKR,NKR,ICEMAX),YWSI(NKR,NKR,ICEMAX) &amp;<a name='111'>
     &amp;,YWGI(NKR,NKR,ICEMAX),YWHI(NKR,NKR,ICEMAX)<a name='112'>
<font color=#447700>!<a name='113'></font>
      REAL,PRIVATE,DIMENSION(NKR,NKR),SAVE :: &amp;<a name='114'>
     &amp; YWLL_1000MB,YWLL_750MB,YWLL_500MB,YWLL,YWLS,YWLG,YWLH &amp;<a name='115'>
<font color=#447700>! SNOW :<a name='116'></font>
     &amp;,YWSL,YWSS,YWSG,YWSH &amp;<a name='117'>
<font color=#447700>! GRAUPELS :<a name='118'></font>
     &amp;,YWGL,YWGS,YWGG,YWGH &amp;<a name='119'>
<font color=#447700>! HAIL :<a name='120'></font>
     &amp;,YWHL,YWHS,YWHG,YWHH<a name='121'>
       REAL, PRIVATE, SAVE :: &amp;<a name='122'>
     &amp;  XI(NKR,ICEMAX) &amp;<a name='123'>
     &amp; ,RADXX(NKR,NHYDR-1),MASSXX(NKR,NHYDR-1),DENXX(NKR,NHYDR-1) &amp;<a name='124'>
     &amp; ,RADXXO(NKR,NHYDRO),MASSXXO(NKR,NHYDRO),DENXXO(NKR,NHYDRO) &amp;<a name='125'>
     &amp; ,RIEC(NKR,ICEMAX),COEFIN(NKR),SLIC(NKR,6),TLIC(NKR,2) &amp;<a name='126'>
     &amp; ,RO2BL(NKR,ICEMAX)<a name='127'>
       REAL, PRIVATE, SAVE :: VR1(NKR),VR2(NKR,ICEMAX),VR3(NKR) &amp;<a name='128'>
     &amp; ,VR4(NKR),VR5(NKR),VRX(NKR),VRI(NKR)<a name='129'>
      REAL,PRIVATE,DIMENSION(NKR),SAVE ::  &amp;<a name='130'>
     &amp;  XL,RLEC,XX,XCCN,XS,RSEC &amp;<a name='131'>
     &amp; ,XG,RGEC,XH,RHEC,RO1BL,RO3BL,RO4BL,RO5BL &amp;<a name='132'>
     &amp; ,ROCCN,RCCN,DROPRADII<a name='133'>
  <a name='134'>
      REAL, PRIVATE,SAVE ::  FCCNR_MAR(NKR),FCCNR_CON(NKR)<a name='135'>
      REAL, PRIVATE,SAVE ::  FCCNR_MIX(NKR)<a name='136'>
      REAL, PRIVATE,SAVE ::  FCCNR(NKR)<a name='137'>
<a name='138'>
<a name='139'>
        REAL, PRIVATE :: C2,C3,C4<a name='140'>
      double precision,private,save ::  cwll(nkr,nkr)<a name='141'>
      double precision,private,save::  &amp;<a name='142'>
     &amp; xl_mg(0:nkr),xs_mg(0:nkr),xg_mg(0:nkr),xh_mg(0:nkr) &amp;<a name='143'>
     &amp;,xi1_mg(0:nkr),xi2_mg(0:nkr),xi3_mg(0:nkr) &amp;<a name='144'>
     &amp;,chucm(nkr,nkr),ima(nkr,nkr) &amp;<a name='145'>
     &amp;,cwll_1000mb(nkr,nkr),cwll_750mb(nkr,nkr),cwll_500mb(nkr,nkr) &amp;<a name='146'>
     &amp;,cwli_1(nkr,nkr),cwli_2(nkr,nkr),cwli_3(nkr,nkr) &amp;<a name='147'>
     &amp;,cwls(nkr,nkr),cwlg(nkr,nkr),cwlh(nkr,nkr) &amp;<a name='148'>
<a name='149'>
     &amp;,cwil_1(nkr,nkr),cwil_2(nkr,nkr),cwil_3(nkr,nkr) &amp;<a name='150'>
<a name='151'>
     &amp;,cwii_1_1(nkr,nkr),cwii_1_2(nkr,nkr),cwii_1_3(nkr,nkr) &amp;<a name='152'>
     &amp;,cwii_2_1(nkr,nkr),cwii_2_2(nkr,nkr),cwii_2_3(nkr,nkr) &amp;<a name='153'>
     &amp;,cwii_3_1(nkr,nkr),cwii_3_2(nkr,nkr),cwii_3_3(nkr,nkr) &amp;<a name='154'>
<a name='155'>
     &amp;,cwis_1(nkr,nkr),cwis_2(nkr,nkr),cwis_3(nkr,nkr) &amp;<a name='156'>
     &amp;,cwig_1(nkr,nkr),cwig_2(nkr,nkr),cwig_3(nkr,nkr) &amp;<a name='157'>
     &amp;,cwih_1(nkr,nkr),cwih_2(nkr,nkr),cwih_3(nkr,nkr) &amp;<a name='158'>
<a name='159'>
     &amp;,cwsl(nkr,nkr) &amp;<a name='160'>
     &amp;,cwsi_1(nkr,nkr),cwsi_2(nkr,nkr),cwsi_3(nkr,nkr)&amp;<a name='161'>
     &amp;,cwss(nkr,nkr),cwsg(nkr,nkr),cwsh(nkr,nkr) &amp;<a name='162'>
     &amp;,cwgl(nkr,nkr)&amp;<a name='163'>
     &amp;,cwgi_1(nkr,nkr),cwgi_2(nkr,nkr),cwgi_3(nkr,nkr)&amp;<a name='164'>
     &amp;,cwgs(nkr,nkr),cwgg(nkr,nkr),cwgh(nkr,nkr) &amp;<a name='165'>
<a name='166'>
     &amp;,cwhl(nkr,nkr) &amp;<a name='167'>
     &amp;,cwhi_1(nkr,nkr),cwhi_2(nkr,nkr),cwhi_3(nkr,nkr) &amp;<a name='168'>
     &amp;,cwhs(nkr,nkr),cwhg(nkr,nkr),cwhh(nkr,nkr) &amp;<a name='169'>
     &amp;,dlnr &amp;<a name='170'>
     &amp;,CTURBLL(KRMAX_LL,KRMAX_LL)&amp;<a name='171'>
     &amp;,CTURB_LL(K0_LL,K0_LL)&amp;<a name='172'>
     &amp;,CTURBGL(KRMAXG_GL,KRMAXL_GL)&amp;<a name='173'>
     &amp;,CTURB_GL(K0G_GL,K0L_GL)<a name='174'>
<a name='175'>
      DOUBLE PRECISION,private, save :: &amp;<a name='176'>
     &amp;   BRKWEIGHT(JBREAK),PKIJ(JBREAK,JBREAK,JBREAK), &amp;<a name='177'>
     &amp;   QKJ(JBREAK,JBREAK),ECOALMASSM(NKR,NKR)<a name='178'>
<a name='179'>
 <a name='180'>
<a name='181'>
<a name='182'>
<a name='183'>
<font color=#447700>!<a name='184'></font>
<font color=#447700>!<a name='185'></font>
      CONTAINS<a name='186'>
<a name='187'>
<font color=#447700>!-----------------------------------------------------------------------<a name='188'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='189'></font>
<A NAME='SBM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='190'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>SBM</font> (w,u,v,th_old,                                &amp; <A href='../../call_to/SBM.html' TARGET='index'>1</A>,<A href='../../call_from/SBM.html' TARGET='index'>22</A><a name='191'>
     &amp;                      chem_new,n_chem,                              &amp;<a name='192'>
     &amp;                      itimestep,DT,DX,DY,                         &amp;<a name='193'>
     &amp;                      dz8w,rho_phy,p_phy,pi_phy,th_phy,           &amp;<a name='194'>
     &amp;                      xland,ivgtyp,xlat,xlong,                           &amp;<a name='195'>
     &amp;                      QV,QC,QR,QIP,QIC,QID,QS,QG,QH,QV_OLD,                   &amp;<a name='196'>
     &amp;                      QNC,QNR,QNIP,QNIC,QNID,QNS,QNG,QNH,QNA,EFFR,ICE_EFFR,TOT_EFFR,       &amp;<a name='197'>
     &amp;                      QIC_EFFR,QIP_EFFR,QID_EFFR,       &amp;<a name='198'>
     &amp;                      height,tempc,&amp;<a name='199'>
<font color=#447700>!    &amp;                      QRRAD,QSRAD,QGRAD,QTIRAD,QTOTRAD,           &amp;<a name='200'></font>
<font color=#447700>!    &amp;                      QRRAD,QSRAD,QGRAD,                          &amp;<a name='201'></font>
     &amp;                      kext_ql,kext_qs,kext_qg,kext_qh,kext_qa,    &amp;<a name='202'>
     &amp;                      kext_qic,kext_qip,kext_qid,                 &amp;<a name='203'>
     &amp;                      kext_ft_qic,kext_ft_qip,kext_ft_qid,                 &amp;<a name='204'>
     &amp;                      kext_ft_qs,kext_ft_qg,                 &amp;<a name='205'>
     &amp;                      ids,ide, jds,jde, kds,kde,		        &amp;<a name='206'>
     &amp;                      ims,ime, jms,jme, kms,kme,		        &amp;<a name='207'>
     &amp;                      its,ite, jts,jte, kts,kte,                  &amp;<a name='208'>
     &amp;                      refl_10cm, diagflag, do_radar_ref,      &amp; <font color=#447700>! MO added for reflectivity calcs<a name='209'></font>
     &amp;                      RAINNC,RAINNCV,SNOWNC,SNOWNCV,GRAUPELNC,GRAUPELNCV,HAILNC,HAILNCV,SR )<a name='210'>
<font color=#447700>!-----------------------------------------------------------------------<a name='211'></font>
      IMPLICIT NONE<a name='212'>
<font color=#447700>!-----------------------------------------------------------------------<a name='213'></font>
      INTEGER, PARAMETER :: ITLO=-60, ITHI=40<a name='214'>
      INTEGER NKRO,NKRE<a name='215'>
      INTEGER KR,IKL,ICE<a name='216'>
<a name='217'>
      INTEGER,INTENT(IN) :: IDS,IDE,JDS,JDE,KDS,KDE                     &amp;<a name='218'>
     &amp;                     ,IMS,IME,JMS,JME,KMS,KME                     &amp;<a name='219'>
     &amp;                     ,ITS,ITE,JTS,JTE,KTS,KTE                     &amp;<a name='220'>
     &amp;                     ,ITIMESTEP,N_CHEM<a name='221'>
<a name='222'>
      REAL, INTENT(IN) 	    :: DT,DX,DY<a name='223'>
   REAL,  DIMENSION( ims:ime , kms:kme , jms:jme )         , &amp;<a name='224'>
          INTENT(IN   ) ::                                   &amp;<a name='225'>
                                                          U, &amp;<a name='226'>
                                                          V, &amp;<a name='227'>
                                                          W   <a name='228'>
<font color=#447700>!                                                        pi<a name='229'></font>
  REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,n_chem),INTENT(INOUT)   :: chem_new<a name='230'>
  REAL, DIMENSION( ims:ime , kms:kme , jms:jme ),                 &amp;<a name='231'>
        INTENT(INOUT) ::                                          &amp;<a name='232'>
                                                              qv, &amp;<a name='233'>
                                                          qv_old, &amp;<a name='234'>
                                                          th_old, &amp;<a name='235'>
                                                              qc, &amp;<a name='236'>
                                                              qr, &amp;<a name='237'>
                                                              qip, &amp;<a name='238'>
                                                              qic, &amp;<a name='239'>
                                                              qid, &amp;<a name='240'>
                                                              qs, &amp;<a name='241'>
                                                              qg, &amp;<a name='242'>
                                                              qh, &amp;<a name='243'>
                                                              qnc, &amp;<a name='244'>
                                                              qnr, &amp;<a name='245'>
                                                              qns, &amp;<a name='246'>
                                                              qnip, &amp;<a name='247'>
                                                              qnic, &amp;<a name='248'>
                                                              qnid, &amp;<a name='249'>
                                                              qng, &amp;<a name='250'>
                                                              qnh, &amp;<a name='251'>
                                                              qna, &amp;<a name='252'>
                                                              kext_ql, &amp;<a name='253'>
                                                              kext_qs, &amp;<a name='254'>
                                                              kext_qg, &amp;<a name='255'>
                                                              kext_qh, &amp;<a name='256'>
                                                              kext_qa, &amp;<a name='257'>
                                                              kext_qic, &amp;<a name='258'>
                                                              kext_qip, &amp;<a name='259'>
                                                              kext_qid, &amp;<a name='260'>
                                                              kext_ft_qic, &amp;<a name='261'>
                                                              kext_ft_qip, &amp;<a name='262'>
                                                              kext_ft_qid, &amp;<a name='263'>
                                                              kext_ft_qs, &amp;<a name='264'>
                                                              kext_ft_qg, &amp;<a name='265'>
                                                              effr, &amp;<a name='266'>
                                                              ice_effr,&amp;<a name='267'>
                                                              tot_effr,&amp;<a name='268'>
                                                              qic_effr,&amp;<a name='269'>
                                                              qip_effr,&amp;<a name='270'>
                                                              qid_effr,&amp;<a name='271'>
                                                              height,  &amp;<a name='272'>
                                                              tempc    <a name='273'>
<font color=#447700>!                                                             effr, &amp;<a name='274'></font>
<font color=#447700>!                                                            qtirad, &amp;<a name='275'></font>
<font color=#447700>!                                                             qtotrad<a name='276'></font>
<a name='277'>
<a name='278'>
<a name='279'>
      REAL , DIMENSION( ims:ime , jms:jme ) , INTENT(IN)   :: XLAND<a name='280'>
      LOGICAL, OPTIONAL, INTENT(IN) :: diagflag<a name='281'>
      INTEGER, OPTIONAL, INTENT(IN) :: do_radar_ref<a name='282'>
<a name='283'>
      REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(INOUT)::       &amp;  <font color=#447700>! GT<a name='284'></font>
                          refl_10cm<a name='285'>
<a name='286'>
      INTEGER, DIMENSION( ims:ime , jms:jme ), INTENT(IN)::   IVGTYP<a name='287'>
      REAL, DIMENSION( ims:ime, jms:jme ), INTENT(IN   )    :: XLAT, XLONG<a name='288'>
      REAL, INTENT(IN),     DIMENSION(ims:ime, kms:kme, jms:jme)::      &amp;<a name='289'>
     &amp;                      dz8w,p_phy,pi_phy,rho_phy<a name='290'>
      REAL, INTENT(INOUT),  DIMENSION(ims:ime, kms:kme, jms:jme)::      &amp;<a name='291'>
     &amp;                      th_phy<a name='292'>
      REAL, INTENT(INOUT),  DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='293'>
     &amp;     RAINNC,RAINNCV,SNOWNC,SNOWNCV,GRAUPELNC,GRAUPELNCV,HAILNC,HAILNCV,SR<a name='294'>
<font color=#447700>!     REAL, INTENT(INOUT),  DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='295'></font>
<font color=#447700>!     REAL,                 DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='296'></font>
<font color=#447700>!    &amp;              LIQUEXP,ICEEXP,SNOWEXP,GRAUEXP,HAILEXP<a name='297'></font>
<font color=#447700>!<a name='298'></font>
<a name='299'>
<font color=#447700>!-----------------------------------------------------------------------<a name='300'></font>
<font color=#447700>!     LOCAL VARS<a name='301'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='302'></font>
<a name='303'>
<font color=#447700>!     NSTATS,QMAX,QTOT are diagnostic vars<a name='304'></font>
<a name='305'>
      INTEGER,DIMENSION(ITLO:ITHI,4) :: NSTATS<a name='306'>
<font color=#447700>!     REAL,   DIMENSION(ITLO:ITHI,5) :: QMAX<a name='307'></font>
      REAL,   DIMENSION(ITLO:ITHI,22):: QTOT<a name='308'>
<a name='309'>
<font color=#447700>!     SOME VARS WILL BE USED FOR DATA ASSIMILATION (DON'T NEED THEM NOW). <a name='310'></font>
<font color=#447700>!     THEY ARE TREATED AS LOCAL VARS, BUT WILL BECOME STATE VARS IN THE <a name='311'></font>
<font color=#447700>!     FUTURE. SO, WE DECLARED THEM AS MEMORY SIZES FOR THE FUTURE USE<a name='312'></font>
<a name='313'>
<font color=#447700>!     TLATGS_PHY,TRAIN_PHY,APREC,PREC,ACPREC,SR are not directly related <a name='314'></font>
<font color=#447700>!     the microphysics scheme. Instead, they will be used by Eta precip <a name='315'></font>
<font color=#447700>!     assimilation.<a name='316'></font>
<a name='317'>
      REAL,  DIMENSION( ims:ime, kms:kme, jms:jme ) ::                  &amp;<a name='318'>
     &amp;       TLATGS_PHY,TRAIN_PHY<a name='319'>
      REAL,  DIMENSION(ims:ime,jms:jme):: APREC,PREC,ACPREC<a name='320'>
      REAL,  DIMENSION(its-1:ite+1, kts:kte, jts-1:jte+1):: t_new,t_old,   &amp;<a name='321'>
     &amp;                                      zcgs,       rhocgs,pcgs<a name='322'>
<a name='323'>
      INTEGER :: I,J,K,KFLIP<a name='324'>
<font color=#447700>! BARRY<a name='325'></font>
      INTEGER :: KRFREEZ<a name='326'>
<font color=#447700>! DATA<a name='327'></font>
       REAL Z0IN,ZMIN<a name='328'>
       DATA  ZMIN/2.0E5/<a name='329'>
       DATA  Z0IN/2.0E5 /<a name='330'>
<a name='331'>
<font color=#447700>!      REAL,DIMENSION(1) :: EPSF2D, &amp;<a name='332'></font>
       REAL EPSF2D, &amp;<a name='333'>
     &amp;        TAUR1,TAUR2,EPS_R1,EPS_R2,ANC1IN, &amp;<a name='334'>
     &amp;        PEPL,PEPI,PERL,PERI,ANC1,ANC2,PARSP, &amp;<a name='335'>
     &amp;        AFREEZMY,BFREEZMY,BFREEZMAX, &amp;<a name='336'>
     &amp;        TCRIT,TTCOAL, &amp;<a name='337'>
     &amp;        EPSF1,EPSF3,EPSF4, &amp;<a name='338'>
     &amp;        SUP2_OLD, DSUPICEXZ,TFREEZ_OLD,DTFREEZXZ, &amp;<a name='339'>
     &amp;        AA1_MY,BB1_MY,AA2_MY,BB2_MY, &amp;<a name='340'>
     &amp;        DTIME,DTCOND, &amp;<a name='341'>
     &amp;        A1_MYN, BB1_MYN, A2_MYN, BB2_MYN<a name='342'>
        DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN  &amp;<a name='343'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='344'>
        DATA AA1_MY,BB1_MY,AA2_MY,BB2_MY/2.53E12,5.42E3,3.41E13,6.13E3/<a name='345'>
<font color=#447700>!            QSUM,ISUM,QSUM1,QSUM2,CCNSUM1,CCNSUM2<a name='346'></font>
        DATA KRFREEZ,BFREEZMAX,ANC1,ANC2,PARSP,PEPL,PEPI,PERL,PERI, &amp;<a name='347'>
     &amp;  TAUR1,TAUR2,EPS_R1,EPS_R2,TTCOAL,AFREEZMY,&amp;<a name='348'>
     &amp;  BFREEZMY,EPSF1,EPSF3,EPSF4,TCRIT/21,&amp;<a name='349'>
     &amp;  0.6600E00, &amp;<a name='350'>
     &amp;  1.0000E02,1.0000E02,0.9000E02, &amp;<a name='351'>
     &amp;  0.6000E00,0.6000E00,1.0000E-03,1.0000E-03, &amp;<a name='352'>
     &amp;  0.5000E00,0.8000E00,0.1500E09,0.1500E09, &amp;<a name='353'>
     &amp;  2.3315E02,0.3333E-04,0.6600E00, &amp;<a name='354'>
     &amp;  0.1000E-02,0.1000E-05,0.1000E-05, &amp;<a name='355'>
     &amp;  2.7015E02/<a name='356'>
<font color=#447700>! JIMY: N_CHEM,variables read in as data<a name='357'></font>
<font color=#447700>! SBM VARIABLES<a name='358'></font>
      REAL,DIMENSION (nkr) :: FF1IN,FF3IN,FF4IN,FF5IN,&amp;<a name='359'>
     &amp;              FF1R,FF3R,FF4R,FF5R,FCCN<a name='360'>
      REAL,DIMENSION (nkr,icemax) :: FF2IN,FF2R<a name='361'>
<font color=#447700>!!!! NOTE: ZCGS AND OTHER VARIABLES ARE ALSO DIMENSIONED IN FALFLUXHUCM<a name='362'></font>
      DOUBLE PRECISION DEL1NR,DEL2NR,DEL12R,DEL12RD,ES1N,ES2N,EW1N,EW1PN<a name='363'>
      DOUBLE PRECISION DELSUP1,DELSUP2,DELDIV1,DELDIV2<a name='364'>
      DOUBLE PRECISION TT,QQ,TTA,QQA,PP,DPSA,DELTATEMP,DELTAQ<a name='365'>
      DOUBLE PRECISION DIV1,DIV2,DIV3,DIV4,DEL1IN,DEL2IN,DEL1AD,DEL2AD<a name='366'>
      REAL DEL_BB,DEL_BBN,DEL_BBR<a name='367'>
      REAL FACTZ,CONCCCN_XZ,CONCDROP<a name='368'>
       REAL SUPICE(KTE),AR1,AR2, &amp;<a name='369'>
     &amp; DERIVT_X,DERIVT_Y,DERIVT_Z,DERIVS_X,DERIVS_Y,DERIVS_Z, &amp;<a name='370'>
     &amp; ES2NPLSX,ES2NPLSY,EW1NPLSX,EW1NPLSY,UX,VX, &amp;<a name='371'>
     &amp; DEL2INPLSX,DEL2INPLSY,DZZ(KTE)<a name='372'>
       INTEGER KRR,I_START,I_END,J_START,J_END<a name='373'>
   <a name='374'>
       REAL DTFREEZ_XYZ(ITE,KTE,JTE),DSUPICE_XYZ(ITE,KTE,JTE)<a name='375'>
<a name='376'>
       REAL DXHUCM,DYHUCM<a name='377'>
       REAL FMAX1,FMAX2,FMAX3,FMAX4,FMAX5<a name='378'>
       INTEGER ISYM1,ISYM2,ISYM3,ISYM4,ISYM5<a name='379'>
       INTEGER DIFFU<a name='380'>
       REAL DELTAW<a name='381'>
       real zcgs_z(kts:kte),pcgs_z(kts:kte),rhocgs_z(kts:kte),ffx_z(kts:kte,nkr)<a name='382'>
       real z_full<a name='383'>
<font color=#447700>! SLOPE INTERCEPT FOR RAIN, SNOW, AND GRAUPEL                                    PARAMR.32<a name='384'></font>
<font color=#447700>!     RON=8.E6                                                                   PARAMR.33<a name='385'></font>
<font color=#447700>!     RON2=1.E10                                                                 23DEC04.211<a name='386'></font>
<font color=#447700>!     RON2=1.E9                                                                  23DEC04.212<a name='387'></font>
<font color=#447700>!     SON=2.E7                                                                   PARAMR.36<a name='388'></font>
<font color=#447700>!     GON=5.E7                                                                   23DEC04.213<a name='389'></font>
<font color=#447700>!     GON=4.E6<a name='390'></font>
       REAL, PARAMETER :: RON=8.E6, GON=5.E7,PI=3.14159265359<a name='391'>
       REAL EFF_N,EFF_D<a name='392'>
       REAL EFF_NI(its:ite,kts:kte,jts:jte),eff_di(its:ite,kts:kte,jts:jte)<a name='393'>
       REAL EFF_NQIC,eff_DQIC<a name='394'>
       REAL EFF_NQIP,eff_DQIP<a name='395'>
       REAL EFF_NQID,eff_DQID<a name='396'>
       real lambda,chi0,xi1,xi2,xi3,xi4,xi5,r_e,chi_3,f1,f2,volume,surface_area,xi6,ft,chi_e<a name='397'>
       real ft_bin<a name='398'>
      REAL, DIMENSION(kts:kte)::                            &amp;<a name='399'>
                      qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, t1d, p1d<a name='400'>
      REAL, DIMENSION(kts:kte):: dBZ<a name='401'>
      <a name='402'>
<a name='403'>
       real nzero,son,nzero_less<a name='404'>
       parameter (son=2.E7)<a name='405'>
       real raddumb(nkr),massdumb(nkr)<a name='406'>
       real hydrosum<a name='407'>
<a name='408'>
       integer imax,kmax,jmax<a name='409'>
       real gmax<a name='410'>
       real tmax,qmax,divmax,rainmax<a name='411'>
       real qnmax,inmax,knmax<a name='412'>
       real hydro<a name='413'>
       real difmax,tdif,tt_old,w_stag,qq_old<a name='414'>
       real teten,es<a name='415'>
       integer  print_int<a name='416'>
       parameter (print_int=300)<a name='417'>
       real ft_liq(nkr)<a name='418'>
       data ft_liq/ 6.254894e-01,6.615571e-01,6.922125e-01,7.514451e-01,7.391191e-01,7.592261e-01,7.417122e-01&amp;<a name='419'>
     &amp;             ,7.388885e-01,7.430871e-01,7.570534e-01,7.584263e-01,7.735341e-01,7.721352e-01,7.724897e-01&amp;<a name='420'>
     &amp;             ,7.744899e-01,7.745646e-01,7.768777e-01,7.776348e-01, 7.788586e-01,7.774171e-01,7.789876e-01 &amp;<a name='421'>
     &amp;             ,7.801301e-01,7.806936e-01,7.801274e-01,7.821974e-01,7.815210e-01,7.822269e-01,7.822353e-01 &amp;<a name='422'>
     &amp;             ,7.808765e-01,7.824246e-01,7.814153e-01,7.818192e-01, 7.818231e-01/<a name='423'>
<font color=#447700>!<a name='424'></font>
<font color=#447700>!<a name='425'></font>
<font color=#447700>! GUY'S Variables<a name='426'></font>
       real geo_cs<a name='427'>
       integer t_print<a name='428'>
       t_print=print_int/dt<a name='429'>
<a name='430'>
<font color=#447700>!      print*,'n_chem = ',n_chem<a name='431'></font>
       difmax = 0<a name='432'>
<font color=#447700>!      print*,'itimestep = ',itimestep<a name='433'></font>
<font color=#447700>!        if (itimestep.gt.150)return<a name='434'></font>
       if (itimestep.eq.1)then<a name='435'>
        if (iceprocs.eq.1) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_814">(" FULL SBM: ICE PROCESES ACTIVE ")<a name='436'>
        if (iceprocs.eq.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_815">(" FULL SBM: LIQUID PROCESES ONLY")<a name='437'>
       end if<a name='438'>
       tmax = 0<a name='439'>
<font color=#447700>! COAL BOTT IS EITHER CALLED EVERY TIME STEP OR TWICE<a name='440'></font>
       NCOND = 0<a name='441'>
<font color=#447700>!       if (mod(dx,1000.).eq.0)then<a name='442'></font>
<font color=#447700>!       NCOND=dx/1000<a name='443'></font>
<font color=#447700>!       else if (mod(dx,2000.).eq.0)then<a name='444'></font>
<font color=#447700>!       NCOND=dx/500<a name='445'></font>
<font color=#447700>!       else if (mod(dx,3000.).eq.0)then<a name='446'></font>
<font color=#447700>!       NCOND=dx/1000<a name='447'></font>
<font color=#447700>!       else if (mod(dx,4000.).eq.0)then<a name='448'></font>
<font color=#447700>!       NCOND=dx/1000<a name='449'></font>
<font color=#447700>!       else if (mod(dx,1333.).eq.0)then<a name='450'></font>
<font color=#447700>!       NCOND=dx/1.3333<a name='451'></font>
<font color=#447700>!       end if<a name='452'></font>
         NCOND=nint(dx/1000)<a name='453'>
<a name='454'>
<font color=#447700>!       IF (NCOND.EQ.0)NCOND=3<a name='455'></font>
       NCOND=max(NCOND,1)<a name='456'>
       DTCOND=DT/REAL(NCOND)<a name='457'>
       dt_coll=dt<a name='458'>
       call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_4">(dt)<a name='459'>
<font color=#447700>!      if (itimestep.eq.1.or.itimestep.eq.3)then<a name='460'></font>
<font color=#447700>!            do kr = 1,nkr<a name='461'></font>
<font color=#447700>!             print*,'xl = ',xl(kr),vr1(kr),RLEC(kr),RO1BL(kr)<a name='462'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,1),vr2(kr,1),RIEC(KR,1),RO2BL(KR,1)<a name='463'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,2),vr2(kr,2),RIEC(KR,2),RO2BL(KR,2)<a name='464'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,3),vr2(kr,3),RIEC(KR,3),RO2BL(KR,3)<a name='465'></font>
<font color=#447700>!             print*,'xs = ',xs(kr),vr3(kr),RSEC(kr),RO3BL(kr)<a name='466'></font>
<font color=#447700>!             print*,'xg = ',xg(kr),vr4(kr),RGEC(kr),RO4BL(kr)<a name='467'></font>
<font color=#447700>!             print*,'xh = ',xh(kr),vr5(kr),RHEC(kr),RO5BL(kr)<a name='468'></font>
<font color=#447700>!            end do<a name='469'></font>
<font color=#447700>!       end if<a name='470'></font>
<a name='471'>
<font color=#447700>!<a name='472'></font>
      DEL_BB=BB2_MY-BB1_MY<a name='473'>
      DEL_BBN=BB2_MYN-BB1_MYN<a name='474'>
      DEL_BBR=BB1_MYN/DEL_BBN<a name='475'>
<font color=#447700>!<a name='476'></font>
      if (conserv)then<a name='477'>
      DO j = jts,jte<a name='478'>
      DO i = its,ite<a name='479'>
      DO k = kts,kte<a name='480'>
      rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='481'>
      KRR=0<a name='482'>
      DO KR=p_ff1i01,p_ff1i33<a name='483'>
        KRR=KRR+1<a name='484'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XL(KRR)/XL(KRR)/3.0<a name='485'>
      END DO<a name='486'>
      KRR=0<a name='487'>
      DO KR=p_ff5i01,p_ff5i33<a name='488'>
        KRR=KRR+1<a name='489'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XS(KRR)/XS(KRR)/3.0<a name='490'>
      END DO<a name='491'>
      KRR=0<a name='492'>
      DO KR=p_ff6i01,p_ff6i33<a name='493'>
        KRR=KRR+1<a name='494'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XG(KRR)/XG(KRR)/3.0<a name='495'>
      END DO<a name='496'>
<font color=#447700>!      if (i.eq.100.and.j.eq.100)then<a name='497'></font>
<font color=#447700>!       print*,'qna  1 = ', k,FACTZ,qna(i,k,j)<a name='498'></font>
<font color=#447700>!      end if<a name='499'></font>
      KRR=0<a name='500'>
      DO KR=p_ff8i01,p_ff8i33<a name='501'>
        KRR=KRR+1<a name='502'>
<font color=#447700>! change by J. Fan<a name='503'></font>
<font color=#447700>!        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/XCCN(KRR)<a name='504'></font>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/1000.   <font color=#447700>! chem_new (input) is #/kg<a name='505'></font>
      END DO<a name='506'>
<font color=#447700>! Columns<a name='507'></font>
      KRR=0<a name='508'>
      DO KR=p_ff2i01,p_ff2i33<a name='509'>
        KRR=KRR+1<a name='510'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XI(KRR,1)/XI(KRR,1)/3.0<a name='511'>
<font color=#447700>!         if (i.eq.230.and.j.eq.146.and.k.eq.13)then<a name='512'></font>
      END DO<a name='513'>
<font color=#447700>! Plates <a name='514'></font>
      KRR=0<a name='515'>
      DO KR=p_ff3i01,p_ff3i33<a name='516'>
        KRR=KRR+1<a name='517'>
<font color=#447700>!         if (i.eq.230.and.j.eq.146.and.k.eq.13)then<a name='518'></font>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XI(KRR,2)/XI(KRR,2)/3.0<a name='519'>
      END DO<a name='520'>
<font color=#447700>! Dendrites<a name='521'></font>
      KRR=0<a name='522'>
      DO KR=p_ff4i01,p_ff4i33<a name='523'>
        KRR=KRR+1<a name='524'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XI(KRR,3)/XI(KRR,3)/3.0<a name='525'>
      END DO<a name='526'>
      KRR=0<a name='527'>
      DO KR=p_ff7i01,p_ff7i33<a name='528'>
        KRR=KRR+1<a name='529'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XH(KRR)/XH(KRR)/3.0<a name='530'>
      END DO<a name='531'>
      END DO<a name='532'>
      END DO<a name='533'>
      END DO<a name='534'>
      end if<a name='535'>
<a name='536'>
      call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_5">(dt)<a name='537'>
<a name='538'>
      DXHUCM=100.*DX<a name='539'>
      DYHUCM=100.*DY<a name='540'>
<font color=#447700>!     print*,'dxhucm = ',dxhucm<a name='541'></font>
<font color=#447700>!     print*,'dyhucm = ',dyhucm<a name='542'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='543'></font>
<font color=#447700>!**********************************************************************<a name='544'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='545'></font>
<font color=#447700>!<a name='546'></font>
<font color=#447700>!<a name='547'></font>
<font color=#447700>! JIMY<a name='548'></font>
      I_START=MAX(1,ITS-1)<a name='549'>
      J_START=MAX(1,JTS-1)<a name='550'>
      I_END=MIN(IDE-1,ITE+1)<a name='551'>
      J_END=MIN(JDE-1,JTE+1)<a name='552'>
<font color=#447700>!     print*,'ide-1 = ',ide-1<a name='553'></font>
<font color=#447700>!     print*,'jde-1 = ',jde-1<a name='554'></font>
<font color=#447700>!     print*,'kte = ',kte<a name='555'></font>
<font color=#447700>!     print*,'i_start,i_end = ',i_start,i_end<a name='556'></font>
<font color=#447700>!     print*,'j_start,j_end = ',j_start,j_end<a name='557'></font>
<font color=#447700>!     print*,'its,ite = ',its,ite<a name='558'></font>
<font color=#447700>!     print*,'jts,jte = ',jts,jte<a name='559'></font>
      DO j = j_start,j_end<a name='560'>
      DO i = i_start,i_end<a name='561'>
      z_full=0.<a name='562'>
      DO k = kts,kte<a name='563'>
          pcgs(I,K,J)=P_PHY(I,K,J)*10.<a name='564'>
          rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='565'>
          zcgs(I,K,J)=z_full+0.5*dz8w(I,K,J)*100<a name='566'>
          z_full=z_full+dz8w(i,k,j)*100.<a name='567'>
      ENDDO<a name='568'>
      ENDDO<a name='569'>
      ENDDO<a name='570'>
<font color=#447700>!!!!!<a name='571'></font>
         if (itimestep.eq.1)then<a name='572'>
       DO j = jts,jte<a name='573'>
       DO i = its,ite<a name='574'>
       DO k = kts,kte<a name='575'>
         IF (zcgs(I,K,J).LE.ZMIN)THEN<a name='576'>
            FACTZ=1.<a name='577'>
         ELSE<a name='578'>
            FACTZ=EXP(-(zcgs(I,K,J)-ZMIN)/Z0IN)<a name='579'>
         END IF<a name='580'>
<font color=#447700>!        FACTZ = 1<a name='581'></font>
         KRR=0<a name='582'>
         DO KR=p_ff8i01,p_ff8i33<a name='583'>
          KRR=KRR+1<a name='584'>
          if (xland(i,j).lt.1.5)then<a name='585'>
             chem_new(I,K,J,KR)=FCCNR_CON(KRR)*FACTZ<a name='586'>
          else<a name='587'>
             chem_new(I,K,J,KR)=FCCNR_MAR(KRR)*FACTZ<a name='588'>
          end if<a name='589'>
<font color=#447700>!         if (xlat(i,j).ge.10.and.xlat(i,j).le.30.and.zcgs(i,k,j).le.300000)then<a name='590'></font>
<font color=#447700>!            if (zcgs(i,k,j).le.25000)then<a name='591'></font>
<font color=#447700>!             chem_new(I,K,J,KR)=FCCNR0(KRR)+FCCNR3(KRR)<a name='592'></font>
<font color=#447700>!            else<a name='593'></font>
<font color=#447700>!             chem_new(I,K,J,KR)=FCCNR3(KRR)<a name='594'></font>
<font color=#447700>!            end if<a name='595'></font>
<font color=#447700>!         end if<a name='596'></font>
<a name='597'>
         END DO<a name='598'>
       end do<a name='599'>
       end do<a name='600'>
       end do<a name='601'>
       end if<a name='602'>
       if (itimestep.ne.1.and.dx.gt.dx_bound)then<a name='603'>
       DO j = jts,jte<a name='604'>
       DO k = kts,kte<a name='605'>
       DO i = its,ite<a name='606'>
        if (i.le.5.or.i.ge.IDE-5.OR. &amp;<a name='607'>
     &amp;       j.le.5.or.j.ge.JDE-5)THEN<a name='608'>
         IF (zcgs(I,K,J).LE.ZMIN)THEN<a name='609'>
            FACTZ=1.<a name='610'>
         ELSE<a name='611'>
            FACTZ=EXP(-(zcgs(I,K,J)-ZMIN)/Z0IN)<a name='612'>
         END IF<a name='613'>
         KRR=0<a name='614'>
         DO kr=p_ff8i01,p_ff8i33<a name='615'>
          KRR=KRR+1<a name='616'>
          if (xland(i,j).lt.1.5)then<a name='617'>
             chem_new(I,K,J,KR)=FCCNR_CON(KRR)*FACTZ<a name='618'>
          else<a name='619'>
             chem_new(I,K,J,KR)=FCCNR_MAR(KRR)*FACTZ<a name='620'>
          end if<a name='621'>
<font color=#447700>!         if (xlat(i,j).ge.10.and.xlat(i,j).le.30.and.zcgs(i,k,j).le.300000)then<a name='622'></font>
<font color=#447700>!            if (zcgs(i,k,j).le.25000)then<a name='623'></font>
<font color=#447700>!             chem_new(I,K,J,KR)=FCCNR0(KRR)+FCCNR3(KRR)<a name='624'></font>
<font color=#447700>!            else<a name='625'></font>
<font color=#447700>!             chem_new(I,K,J,KR)=FCCNR3(KRR)<a name='626'></font>
<font color=#447700>!            end if<a name='627'></font>
<font color=#447700>!         end if<a name='628'></font>
         End do<a name='629'>
        end if<a name='630'>
       end do<a name='631'>
       end do<a name='632'>
       end do<a name='633'>
       end if<a name='634'>
      if (itimestep.eq.1)then<a name='635'>
      DO j = j_start,j_end<a name='636'>
      DO k = kts,kte<a name='637'>
      DO i = i_start,i_end<a name='638'>
         th_old(i,k,j)=th_phy(i,k,j)<a name='639'>
         qv_old(i,k,j)=qv(i,k,j)<a name='640'>
      END DO<a name='641'>
      END DO<a name='642'>
      END DO<a name='643'>
      end if<a name='644'>
      DO j = j_start,j_end<a name='645'>
      DO k = kts,kte<a name='646'>
      DO i = i_start,i_end<a name='647'>
        t_new(i,k,j) = th_phy(i,k,j)*pi_phy(i,k,j)<a name='648'>
        tempc(i,k,j)=t_new(i,k,j)-273.16<a name='649'>
        t_old(i,k,j) = th_old(i,k,j)*pi_phy(i,k,j)<a name='650'>
      ENDDO<a name='651'>
      ENDDO<a name='652'>
      ENDDO<a name='653'>
<a name='654'>
<a name='655'>
<a name='656'>
<a name='657'>
<font color=#447700>!1         172           1           1<a name='658'></font>
<a name='659'>
<font color=#447700>!     print*,'here at 1'<a name='660'></font>
      DO j = jts,jte<a name='661'>
      DO i = its,ite<a name='662'>
      DO k = kts,kte<a name='663'>
       IF(K.EQ.KTE)THEN<a name='664'>
        DZZ(K)=(zcgs(I,K,J)-zcgs(I,K-1,J))<a name='665'>
       ELSE IF(K.EQ.1)THEN<a name='666'>
        DZZ(K)=(zcgs(I,K+1,J)-zcgs(I,K,J))<a name='667'>
       ELSE<a name='668'>
        DZZ(K)=(zcgs(I,K+1,J)-zcgs(I,K-1,J))<a name='669'>
       END IF<a name='670'>
       ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='671'>
       EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='672'>
       SUPICE(K)=EW1N/ES2N-1.<a name='673'>
       IF(SUPICE(K).GT.0.5) SUPICE(K)=.5<a name='674'>
 <a name='675'>
      END DO<a name='676'>
      DO k = kts,kte<a name='677'>
       IF(T_OLD(I,K,J).GE.238.15.AND.T_OLD(I,K,J).LT.274.15) THEN<a name='678'>
       if (k.lt.kte)then       <a name='679'>
        w_stag=50.*(w(i,k,j)+w(i,k+1,j)) <a name='680'>
       else<a name='681'>
        w_stag=100*w(i,k,j)<a name='682'>
       end if<a name='683'>
             IF (I.LT.IDE-1.AND.J.LT.JDE-1)THEN<a name='684'>
              UX=25.*(U(I,K,J)+U(I+1,K,J)+U(I,K,J+1)+U(I+1,K,J+1))<a name='685'>
              VX=25.*(V(I,K,J)+V(I+1,K,J)+V(I,K,J+1)+V(I+1,K,J+1))<a name='686'>
             ELSE<a name='687'>
              UX=U(I,K,J)*100.<a name='688'>
              VX=V(I,K,J)*100.<a name='689'>
             END IF  <a name='690'>
             IF(K.EQ.1) DERIVT_Z=(T_OLD(I,K+1,J)-T_OLD(I,K,J))/DZZ(K)<a name='691'>
             IF(K.EQ.KTE) DERIVT_Z=(T_OLD(I,K,J)-T_OLD(I,K-1,J))/DZZ(K)<a name='692'>
             IF(K.GT.1.AND.K.LT.KTE) DERIVT_Z= &amp;<a name='693'>
     &amp;        (T_OLD(I,K+1,J)-T_OLD(I,K-1,J))/DZZ(K)<a name='694'>
             IF (I.EQ.1)THEN<a name='695'>
              DERIVT_X=(T_OLD(I+1,K,J)-T_OLD(I,K,J))/(DXHUCM)<a name='696'>
             ELSE IF (I.EQ.IDE-1)THEN<a name='697'>
              DERIVT_X=(T_OLD(I,K,J)-T_OLD(I-1,K,J))/(DXHUCM)<a name='698'>
             ELSE<a name='699'>
              DERIVT_X=(T_OLD(I+1,K,J)-T_OLD(I-1,K,J))/(2.*DXHUCM)<a name='700'>
             END IF<a name='701'>
             IF (J.EQ.1)THEN<a name='702'>
              DERIVT_Y=(T_OLD(I,K,J+1)-T_OLD(I,K,J))/(DYHUCM)<a name='703'>
             ELSE IF (J.EQ.JDE-1)THEN<a name='704'>
              DERIVT_Y=(T_OLD(I,K,J)-T_OLD(I,K,J-1))/(DYHUCM)<a name='705'>
             ELSE<a name='706'>
              DERIVT_Y=(T_OLD(I,K,J+1)-T_OLD(I,K,J-1))/(2.*DYHUCM)<a name='707'>
             END IF<a name='708'>
             DTFREEZ_XYZ(I,K,J)=DT*(VX*DERIVT_Y+ &amp;<a name='709'>
     &amp;            UX*DERIVT_X+w_stag*DERIVT_Z)<a name='710'>
          ELSE<a name='711'>
             DTFREEZ_XYZ(I,K,J)=0.<a name='712'>
          ENDIF<a name='713'>
          IF(SUPICE(K).GE.0.02.AND.T_OLD(I,K,J).LT.268.15) THEN<a name='714'>
            IF (I.LT.IDE-1)THEN<a name='715'>
             ES2NPLSX=AA2_MY*EXP(-BB2_MY/T_OLD(I+1,K,J))<a name='716'>
             EW1NPLSX=QV_OLD(I+1,K,J)*pcgs(I+1,K,J)/ &amp;<a name='717'>
     &amp;               (0.622+0.378*QV_OLD(I+1,K,J))<a name='718'>
            ELSE<a name='719'>
             ES2NPLSX=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='720'>
             EW1NPLSX=QV_OLD(I,K,J)*pcgs(I,K,J)/ &amp;<a name='721'>
     &amp;               (0.622+0.378*QV_OLD(I,K,J))<a name='722'>
            END IF<a name='723'>
            IF (ES2NPLSX.EQ.0)THEN<a name='724'>
             DEL2INPLSX=0.5<a name='725'>
            ELSE<a name='726'>
             DEL2INPLSX=EW1NPLSX/ES2NPLSX-1.<a name='727'>
            END IF<a name='728'>
            IF(DEL2INPLSX.GT.0.5) DEL2INPLSX=.5<a name='729'>
            IF (I.GT.1)THEN<a name='730'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I-1,K,J))<a name='731'>
             EW1N=QV_OLD(I-1,K,J)*pcgs(I-1,K,J)/(0.622+0.378*QV_OLD(I-1,K,J))<a name='732'>
            ELSE<a name='733'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='734'>
             EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='735'>
            END IF<a name='736'>
            DEL2IN=EW1N/ES2N-1.<a name='737'>
            IF(DEL2IN.GT.0.5) DEL2IN=.5<a name='738'>
            IF (I.GT.1.AND.I.LT.IDE-1)THEN<a name='739'>
             DERIVS_X=(DEL2INPLSX-DEL2IN)/(2.*DXHUCM)<a name='740'>
            ELSE<a name='741'>
             DERIVS_X=(DEL2INPLSX-DEL2IN)/(DXHUCM)<a name='742'>
            END IF<a name='743'>
            IF (J.LT.JDE-1)THEN<a name='744'>
             ES2NPLSY=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J+1))<a name='745'>
             EW1NPLSY=QV_OLD(I,K,J+1)*pcgs(I,K,J+1)/(0.622+0.378*QV_OLD(I,K,J+1))<a name='746'>
            ELSE<a name='747'>
             ES2NPLSY=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='748'>
             EW1NPLSY=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='749'>
            END IF<a name='750'>
            DEL2INPLSY=EW1NPLSY/ES2NPLSY-1.<a name='751'>
            IF(DEL2INPLSY.GT.0.5) DEL2INPLSY=.5<a name='752'>
            IF (J.GT.1)THEN<a name='753'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J-1))<a name='754'>
             EW1N=QV_OLD(I,K,J-1)*pcgs(I,K,J-1)/(0.622+0.378*QV_OLD(I,K,J-1))<a name='755'>
            ELSE<a name='756'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='757'>
             EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='758'>
            END IF<a name='759'>
             DEL2IN=EW1N/ES2N-1.<a name='760'>
            IF(DEL2IN.GT.0.5) DEL2IN=.5<a name='761'>
            IF (J.GT.1.AND.J.LT.JDE-1)THEN<a name='762'>
             DERIVS_Y=(DEL2INPLSY-DEL2IN)/(2.*DYHUCM)<a name='763'>
            ELSE<a name='764'>
             DERIVS_Y=(DEL2INPLSY-DEL2IN)/(DYHUCM)<a name='765'>
            END IF<a name='766'>
<font color=#447700>!<a name='767'></font>
            IF (K.EQ.1)DERIVS_Z=(SUPICE(K+1)-SUPICE(K))/DZZ(K)<a name='768'>
            IF (K.EQ.KTE)DERIVS_Z=(SUPICE(K)-SUPICE(K-1))/DZZ(K)<a name='769'>
            IF(K.GT.1.and.K.LT.KTE) DERIVS_Z=(SUPICE(K+1)-SUPICE(K-1))/DZZ(K)<a name='770'>
            IF (I.LT.IDE-1.AND.J.LT.JDE-1)THEN<a name='771'>
             UX=25.*(U(I,K,J)+U(I+1,K,J)+U(I,K,J+1)+U(I+1,K,J+1))<a name='772'>
             VX=25.*(V(I,K,J)+V(I+1,K,J)+V(I,K,J+1)+V(I+1,K,J+1))<a name='773'>
            ELSE<a name='774'>
             UX=U(I,K,J)*100.<a name='775'>
             VX=V(I,K,J)*100.<a name='776'>
            END IF  <a name='777'>
            DSUPICE_XYZ(I,K,J)=(UX*DERIVS_X+VX*DERIVS_Y+ &amp;<a name='778'>
      &amp;                        w_stag*DERIVS_Z)*DTCOND<a name='779'>
          ELSE<a name='780'>
            DSUPICE_XYZ(I,K,J)=0.0<a name='781'>
          END IF<a name='782'>
         END DO<a name='783'>
         END DO<a name='784'>
         END DO<a name='785'>
     <a name='786'>
<a name='787'>
      do j = jts,jte<a name='788'>
      do k = kts,kte<a name='789'>
      do i = its,ite<a name='790'>
<font color=#447700>!     print*,'i,j,k = ',i,j,k<a name='791'></font>
<font color=#447700>! LIQUID<a name='792'></font>
<font color=#447700>!      do kr=1,nkr<a name='793'></font>
<font color=#447700>!       if (ff4r(kr).lt.0)then<a name='794'></font>
<font color=#447700>!        print*,'i,k,j = ',i,k,j<a name='795'></font>
<font color=#447700>!        print*,'ff4r 0 = ',kr,ff4r(kr)<a name='796'></font>
<font color=#447700>!       end if<a name='797'></font>
<font color=#447700>!      end do<a name='798'></font>
          KRR=0<a name='799'>
          DO kr=p_ff1i01,p_ff1i33<a name='800'>
           KRR=KRR+1<a name='801'>
           FF1R(KRR)=chem_new(I,K,J,KR)<a name='802'>
           IF (FF1R(KRR).LT.0)FF1R(KRR)=0.<a name='803'>
          END DO<a name='804'>
<font color=#447700>! CCN<a name='805'></font>
        KRR=0<a name='806'>
        DO kr=p_ff8i01,p_ff8i33<a name='807'>
          KRR=KRR+1<a name='808'>
          FCCN(KRR)=chem_new(I,K,J,KR)<a name='809'>
          if (fccn(krr).lt.0)fccn(krr)=0.<a name='810'>
        END DO<a name='811'>
        IF (ICEPROCS.EQ.1)THEN<a name='812'>
<font color=#447700>! COLUMNS!<a name='813'></font>
         KRR=0<a name='814'>
         DO kr=p_ff2i01,p_ff2i33<a name='815'>
          KRR=KRR+1<a name='816'>
          FF2R(KRR,1)=chem_new(I,K,J,KR)<a name='817'>
          if (ff2r(krr,1).lt.0)ff2r(krr,1)=0<a name='818'>
         END DO<a name='819'>
<font color=#447700>! PLATES!<a name='820'></font>
         KRR=0<a name='821'>
         DO kr=p_ff3i01,p_ff3i33<a name='822'>
          KRR=KRR+1<a name='823'>
          FF2R(KRR,2)=chem_new(I,K,J,KR)<a name='824'>
<font color=#447700>!i,j,k =          230         146          13<a name='825'></font>
          if (ff2r(krr,2).lt.0)ff2r(krr,2)=0<a name='826'>
          <a name='827'>
         END DO<a name='828'>
<a name='829'>
<font color=#447700>! DENDRITES!<a name='830'></font>
         KRR=0<a name='831'>
         DO KR=p_ff4i01,p_ff4i33<a name='832'>
          KRR=KRR+1<a name='833'>
          FF2R(KRR,3)=chem_new(I,K,J,KR)<a name='834'>
          if (ff2r(krr,3).lt.0)ff2r(krr,3)=0<a name='835'>
         END DO<a name='836'>
<font color=#447700>! SNOW<a name='837'></font>
           KRR=0<a name='838'>
           DO kr=p_ff5i01,p_ff5i33<a name='839'>
            KRR=KRR+1<a name='840'>
            FF3R(KRR)=chem_new(I,K,J,KR)<a name='841'>
            if (ff3r(krr).lt.0)ff3r(krr)=0.<a name='842'>
           END DO<a name='843'>
<a name='844'>
<font color=#447700>! Graupel<a name='845'></font>
           KRR=0<a name='846'>
           DO kr=p_ff6i01,p_ff6i33<a name='847'>
            KRR=KRR+1<a name='848'>
            FF4R(KRR)=chem_new(I,K,J,KR)<a name='849'>
            IF (FF4R(KRR).LT.0)FF4R(KRR)=0.<a name='850'>
           END DO<a name='851'>
<a name='852'>
<font color=#447700>! Hail<a name='853'></font>
         KRR=0<a name='854'>
         DO kr=p_ff7i01,p_ff7i33<a name='855'>
          KRR=KRR+1<a name='856'>
          FF5R(KRR)=chem_new(I,K,J,KR)<a name='857'>
          if (ff5r(krr).lt.0)ff5r(krr)=0.<a name='858'>
         END DO<a name='859'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FREEZ'>FREEZ</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FREEZ_2"> &amp;<a name='860'>
     &amp;     (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='861'>
     &amp;      T_NEW(I,K,J),DT,rhocgs(I,K,J), &amp;<a name='862'>
     &amp;      COL,AFREEZMY,BFREEZMY,BFREEZMAX, &amp;<a name='863'>
     &amp;      KRFREEZ,ICEMAX,NKR)<a name='864'>
         IF (ORIGINAL_MELT)THEN<a name='865'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ORIG_MELT'>ORIG_MELT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ORIG_MELT_2">  &amp;<a name='866'>
     &amp;    (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='867'>
     &amp;     T_NEW(I,K,J),DT,rhocgs(I,K,J),COL,ICEMAX,NKR)<a name='868'>
         END IF<a name='869'>
         IF (JIWEN_FAN_MELT) THEN<a name='870'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#J_W_MELT'>J_W_MELT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="J_W_MELT_2"> &amp;<a name='871'>
     &amp;    (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='872'>
     &amp;     T_NEW(I,K,J),DT,rhocgs(I,K,J),COL,ICEMAX,NKR)<a name='873'>
         END IF<a name='874'>
        ENDIF<a name='875'>
<font color=#447700>!       IF (T_OLD(I,K,J).GT.223)THEN     <a name='876'></font>
        IF (T_OLD(I,K,J).GT.213)THEN     <a name='877'>
         TT=T_OLD(I,K,J)<a name='878'>
         QQ=QV_OLD(I,K,J)<a name='879'>
 <font color=#447700>!        IF (QQ.LE.0)print*,'QQ &lt; 0'<a name='880'></font>
         IF (QQ.LE.0)QQ=1.D-10<a name='881'>
         PP=pcgs(I,K,J)<a name='882'>
         TTA=T_NEW(I,K,J)<a name='883'>
         QQA=QV(I,K,J)<a name='884'>
         IF (QQA.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_816">("WARNING: FULL SBM, QQA &lt; 0   ")<a name='885'>
 <font color=#447700>!        IF (QQA.LE.0)print*,'QQA = ',qqa<a name='886'></font>
 <font color=#447700>!        IF (QQA.LE.0)print*,'i,k,j = ',i,k,j<a name='887'></font>
 <font color=#447700>!        IF (QQA.LE.0)print*,'tta = ',tta<a name='888'></font>
 <font color=#447700>!        IF (QQA.LE.0)print*,'tt = ',tt<a name='889'></font>
 <font color=#447700>!        IF (QQA.LE.0)print*,'qq = ',qq<a name='890'></font>
          IF (QQA.LE.0)QQA=1.D-10<a name='891'>
         ES1N=AA1_MY*DEXP(-BB1_MY/TT)<a name='892'>
         ES2N=AA2_MY*DEXP(-BB2_MY/TT)<a name='893'>
         EW1N=QQ*PP/(0.622+0.378*QQ)<a name='894'>
         DIV1=EW1N/ES1N<a name='895'>
         DEL1IN=EW1N/ES1N-1.<a name='896'>
         DIV2=EW1N/ES2N<a name='897'>
         DEL2IN=EW1N/ES2N-1.<a name='898'>
         ES1N=AA1_MY*DEXP(-BB1_MY/TTA)<a name='899'>
         ES2N=AA2_MY*DEXP(-BB2_MY/TTA)<a name='900'>
         EW1N=QQA*PP/(0.622+0.378*QQA)<a name='901'>
         DIV3=EW1N/ES1N<a name='902'>
         DEL1AD=EW1N/ES1N-1.<a name='903'>
         DIV4=EW1N/ES2N<a name='904'>
         DEL2AD=EW1N/ES2N-1.<a name='905'>
         SUP2_OLD=DEL2IN<a name='906'>
         DELSUP1=(DEL1AD-DEL1IN)/NCOND<a name='907'>
         DELSUP2=(DEL2AD-DEL2IN)/NCOND<a name='908'>
         DELDIV1=(DIV3-DIV1)/NCOND<a name='909'>
         DELDIV2=(DIV4-DIV2)/NCOND<a name='910'>
         DELTATEMP=0<a name='911'>
         DELTAQ=0<a name='912'>
         tt_old = TT<a name='913'>
         qq_old = qq<a name='914'>
         DIFFU=1<a name='915'>
         DO IKL=1,NCOND<a name='916'>
          IF (DIFFU.NE.0)THEN<a name='917'>
          DEL1IN=DEL1IN+DELSUP1<a name='918'>
          DEL2IN=DEL2IN+DELSUP2<a name='919'>
          DIV1=DIV1+DELDIV1<a name='920'>
          DIV2=DIV2+DELDIV2<a name='921'>
          END IF<a name='922'>
<font color=#447700>!959       format (' ',i3,1x,f7.1,1x,f6.1,1x,f6.4,1x,f6.2,1x,f6.3)<a name='923'></font>
<font color=#447700>!         IF (DIV1.GT.DIV2.AND.TT.LE.265)THEN<a name='924'></font>
<font color=#447700>! Jin-Fang Yin<a name='925'></font>
          IF ((DIV1 - DIV2) .GE. 1.0*10e-24 .AND.TT.LE.265)THEN<a name='926'>
<font color=#447700>!          print*,'div1 &gt; div2',div1,div2<a name='927'></font>
<font color=#447700>!          print*,'delsup1, delsup2 = ',delsup1,delsup2<a name='928'></font>
<font color=#447700>!          print*,'del1in, del2in = ',del1in,del2in<a name='929'></font>
<font color=#447700>!          print*,'STOP'<a name='930'></font>
<font color=#447700>!          print*,'RESET'<a name='931'></font>
<font color=#447700>!          print*,'ikl,i,j,k = ',ikl,i,j,k<a name='932'></font>
<font color=#447700>!          print*,'zcgs = ',zcgs(i,k,j)<a name='933'></font>
<font color=#447700>!          print*,'tt,qq = ',tt,qq<a name='934'></font>
<font color=#447700>!          DIV1=0.99999*DIV2<a name='935'></font>
<font color=#447700>!          DEL1IN=0.99999*DEL2IN<a name='936'></font>
<font color=#447700>!          STOP<a name='937'></font>
           DIFFU=0<a name='938'>
          END IF<a name='939'>
          IF (DIFFU.NE.0)THEN<a name='940'>
          DEL1NR=A1_MYN*(100.*DIV1)<a name='941'>
          DEL2NR=A2_MYN*(100.*DIV2)<a name='942'>
     <font color=#447700>!     IF (DEL2NR.EQ.0)PRINT*,'DEL2NR = 0'<a name='943'></font>
     <font color=#447700>!     IF (DEL2NR.EQ.0)PRINT*,'DEL2NR = 0'<a name='944'></font>
     <font color=#447700>!     IF (DEL2NR.EQ.0)PRINT*,'DELDIV2 = ',DELDIV2<a name='945'></font>
     <font color=#447700>!     IF (DEL2NR.EQ.0)PRINT*,'DIV1 = ',DIV1<a name='946'></font>
     <font color=#447700>!     IF (DEL2NR.EQ.0)PRINT*,'DIV2 = ',DIV2<a name='947'></font>
          IF (DEL2NR.EQ.0)call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_773">("fatal error in module_mp_full_sbm (DEL2NR.EQ.0) , model stop ")<a name='948'>
          DEL12R=DEL1NR/DEL2NR<a name='949'>
          DEL12RD=DEL12R**DEL_BBR<a name='950'>
          EW1PN=AA1_MY*100.*DIV1*DEL12RD/100.<a name='951'>
          TT=-DEL_BB/DLOG(DEL12R)<a name='952'>
          QQ=0.622*EW1PN/(PP-0.378*EW1PN)<a name='953'>
<a name='954'>
          DO KR=1,NKR<a name='955'>
            FF1IN(KR)=FF1R(KR)<a name='956'>
            DO ICE=1,ICEMAX<a name='957'>
             FF2IN(KR,ICE)=FF2R(KR,ICE)<a name='958'>
            ENDDO<a name='959'>
          ENDDO<a name='960'>
          IF (BULKNUC.eq.1)THEN<a name='961'>
            IF (DEL1IN.GT.0)THEN<a name='962'>
              IF (zcgs(I,K,J).LE.500.E2)THEN<a name='963'>
                FACTZ=0.<a name='964'>
              ELSE<a name='965'>
                FACTZ=1<a name='966'>
<font color=#447700>!               FACTZ=EXP(-(zcgs(I,K,J)-2.E5)/Z0IN)<a name='967'></font>
              END IF<a name='968'>
             CONCCCN_XZ=FACTZ*ACCN*(100.*DEL1IN)**BCCN<a name='969'>
<a name='970'>
             CONCDROP=0.D0<a name='971'>
<a name='972'>
             DO KR=1,NKR<a name='973'>
               CONCDROP=CONCDROP+FF1IN(KR)*XL(KR)<a name='974'>
             ENDDO<a name='975'>
<a name='976'>
             CONCDROP=CONCDROP*3.D0*COL<a name='977'>
             IF(CONCCCN_XZ.GT.CONCDROP) &amp;<a name='978'>
     &amp;       FF1IN(1)=FF1IN(1)+(CONCCCN_XZ-CONCDROP)/(3.D0*COL*XL(1))<a name='979'>
            END IF<a name='980'>
          ELSE<a name='981'>
            IF(DEL1IN.GT.0.OR.DEL2IN.GT.0)THEN<a name='982'>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01'>JERNUCL01</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNUCL01_2">(FF1IN,FF2IN,FCCN &amp;<a name='983'>
     &amp;       ,XL,XI,TT,QQ &amp;<a name='984'>
     &amp;       ,rhocgs(I,K,J),pcgs(I,K,J) &amp;<a name='985'>
     &amp;       ,DEL1IN,DEL2IN &amp;<a name='986'>
     &amp;       ,COL,AA1_MY, BB1_MY, AA2_MY,BB2_MY &amp;<a name='987'>
     &amp;       ,C1_MEY,C2_MEY,SUP2_OLD,DSUPICE_XYZ(I,K,J) &amp;<a name='988'>
     &amp;       ,RCCN,DROPRADII,NKR,ICEMAX,ICEPROCS)<a name='989'>
             IF (T_OLD(I,K,J).GT.220.AND.T_OLD(I,K,J).LE.233)THEN<a name='990'>
              DO KR=1,NKR<a name='991'>
               FF2IN(KR,2)=FF2IN(KR,2)+FF1IN(KR)<a name='992'>
               FF1IN(KR)=0.<a name='993'>
              END DO<a name='994'>
             END IF<a name='995'>
            END IF<a name='996'>
 <a name='997'>
          END IF<a name='998'>
<font color=#447700>!  <a name='999'></font>
          DO KR=1,NKR<a name='1000'>
            FF1R(KR)=FF1IN(KR)<a name='1001'>
            DO ICE=1,ICEMAX<a name='1002'>
             FF2R(KR,ICE)=FF2IN(KR,ICE)<a name='1003'>
            ENDDO<a name='1004'>
          ENDDO<a name='1005'>
          FMAX1=0.<a name='1006'>
          FMAX2=0.<a name='1007'>
          FMAX3=0.<a name='1008'>
          FMAX4=0.<a name='1009'>
          FMAX5=0.<a name='1010'>
          DO KR=1,NKR<a name='1011'>
            FF1IN(KR)=FF1R(KR)<a name='1012'>
            FMAX1=AMAX1(FF1R(KR),FMAX1)<a name='1013'>
            FF3IN(KR)=FF3R(KR)<a name='1014'>
            FMAX3=AMAX1(FF3R(KR),FMAX3)<a name='1015'>
            FF4IN(KR)=FF4R(KR)<a name='1016'>
            FMAX4=AMAX1(FF4R(KR),FMAX4)<a name='1017'>
            FF5IN(KR)=FF5R(KR)<a name='1018'>
            FMAX5=AMAX1(FF5R(KR),FMAX5)<a name='1019'>
            DO ICE=1,ICEMAX<a name='1020'>
             FF2IN(KR,ICE)=FF2R(KR,ICE)<a name='1021'>
             FMAX2=AMAX1(FF2R(KR,ICE),FMAX2)<a name='1022'>
            END DO<a name='1023'>
          END DO<a name='1024'>
          ISYM1=0<a name='1025'>
          ISYM2=0<a name='1026'>
          ISYM3=0<a name='1027'>
          ISYM4=0<a name='1028'>
          ISYM5=0<a name='1029'>
          IF(FMAX1.GT.0)ISYM1=1<a name='1030'>
          IF (ICEPROCS.EQ.1)THEN<a name='1031'>
           IF(FMAX2.GT.1.E-4)ISYM2=1<a name='1032'>
           IF(FMAX3.GT.1.E-4)ISYM3=1<a name='1033'>
           IF(FMAX4.GT.1.E-4)ISYM4=1<a name='1034'>
           IF(FMAX5.GT.1.E-4)ISYM5=1<a name='1035'>
          END IF<a name='1036'>
<font color=#447700>! Avoid Diffusional Growth<a name='1037'></font>
<font color=#447700>!         IF (T_OLD(I,K,J).GE.237)THEN     <a name='1038'></font>
<font color=#447700>! Same temperature range as above.<a name='1039'></font>
          IF (T_OLD(I,K,J).GT.233)THEN<a name='1040'>
          IF(ISYM1.EQ.1.AND.((TT-273.15).GT.-0.187.OR. &amp;<a name='1041'>
     &amp;     (ISYM2.EQ.0.AND. &amp;<a name='1042'>
     &amp;     ISYM3.EQ.0.AND.ISYM4.EQ.0.AND.ISYM5.EQ.0)))THEN<a name='1043'>
           IF (T_OLD(I,K,J).GT.233)THEN     <a name='1044'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1'>ONECOND1</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND1_2">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='1045'>
     &amp;      ,VR1,pcgs(I,K,J) &amp;<a name='1046'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='1047'>
     &amp;      ,FF1R,FF1IN,XL,RLEC,RO1BL &amp;<a name='1048'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='1049'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='1050'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR)<a name='1051'>
           END IF<a name='1052'>
          ELSE IF(ISYM1.EQ.0.AND.(TT-273.15).LE.-0.187.AND. &amp;<a name='1053'>
     &amp;     (ISYM2.EQ.1.OR.ISYM3.EQ.1.OR.ISYM4.EQ.1.OR.ISYM5.EQ.1))THEN<a name='1054'>
           IF (T_OLD(I,K,J).GT.233)THEN     <a name='1055'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2'>ONECOND2</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND2_2">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='1056'>
     &amp;      ,VR2,VR3,VR4,VR5,pcgs(I,K,J) &amp;<a name='1057'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='1058'>
     &amp;      ,FF2R,FF2IN,XI,RIEC,RO2BL &amp;<a name='1059'>
     &amp;      ,FF3R,FF3IN,XS,RSEC,RO3BL &amp;<a name='1060'>
     &amp;      ,FF4R,FF4IN,XG,RGEC,RO4BL &amp;<a name='1061'>
     &amp;      ,FF5R,FF5IN,XH,RHEC,RO5BL &amp;<a name='1062'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='1063'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='1064'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR &amp;<a name='1065'>
     &amp;      ,ISYM2,ISYM3,ISYM4,ISYM5)<a name='1066'>
           END IF<a name='1067'>
          ELSE IF(ISYM1.EQ.1.AND.(TT-273.15).LE.-0.187.AND. &amp;<a name='1068'>
     &amp;     (ISYM2.EQ.1.OR.ISYM3.EQ.1.OR.ISYM4.EQ.1 &amp;<a name='1069'>
     &amp;     .OR.ISYM5.EQ.1))THEN<a name='1070'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3'>ONECOND3</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND3_2">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='1071'>
     &amp;      ,VR1,VR2,VR3,VR4,VR5,pcgs(I,K,J) &amp;<a name='1072'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='1073'>
     &amp;      ,FF1R,FF1IN,XL,RLEC,RO1BL &amp;<a name='1074'>
     &amp;      ,FF2R,FF2IN,XI,RIEC,RO2BL &amp;<a name='1075'>
     &amp;      ,FF3R,FF3IN,XS,RSEC,RO3BL &amp;<a name='1076'>
     &amp;      ,FF4R,FF4IN,XG,RGEC,RO4BL &amp;<a name='1077'>
     &amp;      ,FF5R,FF5IN,XH,RHEC,RO5BL &amp;<a name='1078'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='1079'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='1080'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR &amp;<a name='1081'>
     &amp;      ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5)<a name='1082'>
          END IF<a name='1083'>
          END IF<a name='1084'>
          END IF<a name='1085'>
             IF (IKL.EQ.NCOND)CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW'>COAL_BOTT_NEW</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COAL_BOTT_NEW_2">(FF1R,FF2R,FF3R, &amp;<a name='1086'>
     &amp;       FF4R,FF5R,TT,QQ,PP,rhocgs(I,K,J),dt_coll,TCRIT,TTCOAL)<a name='1087'>
         END DO<a name='1088'>
         IF (DIFFU.EQ.0)THEN<a name='1089'>
         th_phy(i,k,j) = tt_old/pi_phy(i,k,j)<a name='1090'>
         qv(i,k,j)=qq_old<a name='1091'>
<font color=#447700>!        print*,'problem calculating diffusion in sbm'<a name='1092'></font>
<font color=#447700>!        print*,'tt_old = ',tt_old<a name='1093'></font>
<font color=#447700>!        print*,'qq_old = ',qq_old<a name='1094'></font>
         ELSE<a name='1095'>
         th_phy(i,k,j) = tt/pi_phy(i,k,j)<a name='1096'>
         qv(i,k,j)=qq<a name='1097'>
         END IF<a name='1098'>
        END IF<a name='1099'>
<font color=#447700>! LIQIUD<a name='1100'></font>
        IF (REMSAT.EQ.1)THEN<a name='1101'>
        DO KR=1,NKR<a name='1102'>
         FF1R(KR)=0.<a name='1103'>
         FCCN(KR)=0<a name='1104'>
         IF (ICEPROCS.EQ.1)THEN<a name='1105'>
          FF2R(KR,1)=0.<a name='1106'>
          FF2R(KR,2)=0.<a name='1107'>
          FF2R(KR,3)=0.<a name='1108'>
          FF3R(KR)=0.<a name='1109'>
          FF4R(KR)=0.<a name='1110'>
          FF5R(KR)=0.<a name='1111'>
         END IF<a name='1112'>
        END DO<a name='1113'>
        END IF<a name='1114'>
<font color=#447700>!Liquid Water<a name='1115'></font>
<font color=#447700>!Alex is not responsible the "2" below.<a name='1116'></font>
<font color=#447700>!Alex is responsible fo rthe geo_cs formulas.<a name='1117'></font>
        kext_ql(i,k,j)=0.<a name='1118'>
        krr=0<a name='1119'>
        DO kr=p_ff1i01,p_ff1i33<a name='1120'>
          KRR=KRR+1<a name='1121'>
          chem_new(I,K,J,KR)=FF1R(KRR)<a name='1122'>
          geo_cs=3.1415*(3.*xl(krr)/(4.*3.1415*1.))**(2./3.)<a name='1123'>
          ft=0.<a name='1124'>
          kext_ql(i,k,j)=kext_ql(i,k,j)+(1.-ft_liq(krr))*2.*geo_cs*(100.*col*3.*xl(krr))*ff1r(krr)<a name='1125'>
<font color=#447700>!         if (i.eq.ime/2.and.j.eq.jme/2.and.k.eq.10)then<a name='1126'></font>
<font color=#447700>!         if (krr.eq.1)write(6,*)'ft_bin_water information'<a name='1127'></font>
<font color=#447700>!            geo_cs=3.1415*(3.*xl(krr)/(4.*3.1415*1.))**(2./3.)<a name='1128'></font>
<font color=#447700>!           write(6,901)krr,xl(krr),ro1bl(krr),RADXXO(krr,1),geo_cs<a name='1129'></font>
<font color=#447700>!         end if<a name='1130'></font>
<a name='1131'>
        END DO   <a name='1132'>
<font color=#447700>! He wants per meter, so we multiply by 100 above<a name='1133'></font>
<font color=#447700>! CCN<a name='1134'></font>
        KRR=0<a name='1135'>
        kext_qa(i,k,j)=0.<a name='1136'>
        DO kr=p_ff8i01,p_ff8i33<a name='1137'>
          KRR=KRR+1<a name='1138'>
          chem_new(I,K,J,KR)=FCCN(KRR)<a name='1139'>
           geo_cs=3.1415*(3*XCCN(krr)/(4*3.1415*0.4))**(2./3.)<a name='1140'>
           kext_qa(i,k,j)=kext_qa(i,k,j)+2.*geo_cs*fccn(krr)<a name='1141'>
<a name='1142'>
        END DO<a name='1143'>
        IF (ICEPROCS.EQ.1)THEN<a name='1144'>
<font color=#447700>!SNOW<a name='1145'></font>
         EFF_NI(i,k,j)=0.<a name='1146'>
         eff_di(i,k,j)=0.<a name='1147'>
         EFF_NQIC=0<a name='1148'>
         EFF_DQIC=0<a name='1149'>
         EFF_NQIP=0<a name='1150'>
         EFF_DQIP=0<a name='1151'>
         EFF_NQID=0<a name='1152'>
         EFF_DQID=0<a name='1153'>
         KRR=0<a name='1154'>
         kext_qs(i,k,j)=0.<a name='1155'>
         kext_ft_qs(i,k,j)=0.<a name='1156'>
         lambda = 0.55<a name='1157'>
         chi0 = 0.00000<a name='1158'>
         xi1 = 0.12534e-2<a name='1159'>
         xi2 = 0.38929e-2<a name='1160'>
         xi3 = 0.36593<a name='1161'>
         xi4 = 0.38827e-1<a name='1162'>
         xi5 = 0.87616<a name='1163'>
         DO kr=p_ff5i01,p_ff5i33<a name='1164'>
          KRR=KRR+1<a name='1165'>
          chem_new(I,K,J,KR)=FF3R(KRR)<a name='1166'>
          geo_cs=3.1415*(xs(krr)/(1.2*3.1415*ro3bl(krr)))**(2./3.)<a name='1167'>
          volume=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XS(KRR)<a name='1168'>
          surface_area=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XS(KRR)<a name='1169'>
          if (surface_area.ne.0.and.volume.ne.0)then<a name='1170'>
          r_e = 3.0/4.0*volume/surface_area<a name='1171'>
          chi_e = 2.0*pi*(r_e*1.E4)/lambda<a name='1172'>
<a name='1173'>
          f1 = (1.0 - xi1)* &amp;<a name='1174'>
     &amp;         (1.0 - (1.0 - exp(-xi2*(chi_e - chi0)))/xi2/(chi_e - chi0))<a name='1175'>
          f2 = (1.0 - xi3)* &amp;<a name='1176'>
     &amp;         (1.0 - exp(-xi4*(chi_e - chi0)))<a name='1177'>
          if(chi_e.le.chi0) then <a name='1178'>
             ft = 0<a name='1179'>
          else <a name='1180'>
           ft = (1.0 - xi5)*f1 + xi5*f2<a name='1181'>
          end if<a name='1182'>
          else <a name='1183'>
          ft=0.<a name='1184'>
          end if<a name='1185'>
          ft=0.<a name='1186'>
          kext_qs(i,k,j)=kext_qs(i,k,j)+(1.-ft)*2.*geo_cs*(100.*col*3.*xs(krr))*ff3r(krr)<a name='1187'>
         END DO<a name='1188'>
<a name='1189'>
<font color=#447700>! HERE<a name='1190'></font>
<font color=#447700>! Graupel<a name='1191'></font>
         KRR=0<a name='1192'>
         kext_qg(i,k,j)=0.<a name='1193'>
         kext_ft_qg(i,k,j)=0.<a name='1194'>
       lambda = 0.55<a name='1195'>
       chi0 = 0.00000<a name='1196'>
       xi1 = 0.39026e-1<a name='1197'>
       xi2 = 0.94264e-5<a name='1198'>
       xi3 = 0.11281e-2<a name='1199'>
       xi4 = 0.35218e-1<a name='1200'>
       xi5 = 0.51453<a name='1201'>
         DO kr=p_ff6i01,p_ff6i33<a name='1202'>
          KRR=KRR+1<a name='1203'>
          chem_new(I,K,J,KR)=FF4R(KRR)<a name='1204'>
          geo_cs=3.1415*(3.*xg(krr)/(4.*3.1415*0.4))**(2./3.)<a name='1205'>
          volume=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XG(KRR)<a name='1206'>
          surface_area=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XG(KRR)<a name='1207'>
          if (surface_area.ne.0.and.volume.ne.0)then<a name='1208'>
          r_e = 3.0/4.0*volume/surface_area<a name='1209'>
          chi_e = 2.0*pi*(r_e*1.E4)/lambda<a name='1210'>
<a name='1211'>
          f1 = (1.0 - xi1)* &amp;<a name='1212'>
     &amp;         (1.0 - (1.0 - exp(-xi2*(chi_e - chi0)))/xi2/(chi_e - chi0))<a name='1213'>
          f2 = (1.0 - xi3)* &amp;<a name='1214'>
     &amp;         (1.0 - exp(-xi4*(chi_e - chi0)))<a name='1215'>
          if(chi_e.le.chi0) then <a name='1216'>
             ft = 0<a name='1217'>
          else <a name='1218'>
           ft = (1.0 - xi5)*f1 + xi5*f2<a name='1219'>
          end if<a name='1220'>
          else <a name='1221'>
          ft=0.<a name='1222'>
          end if<a name='1223'>
          ft=0.<a name='1224'>
          kext_qg(i,k,j)=kext_qg(i,k,j)+(1.-ft)*2.*geo_cs*(100.*col*3.*xg(krr))*ff4r(krr)<a name='1225'>
         END DO<a name='1226'>
<a name='1227'>
<font color=#447700>! Columns<a name='1228'></font>
         KRR=0<a name='1229'>
         kext_qic(i,k,j)=0.<a name='1230'>
         kext_ft_qic(i,k,j)=0.<a name='1231'>
       lambda = 0.55<a name='1232'>
       chi0 = 0.00000<a name='1233'>
       xi1 = 0.60202<a name='1234'>
       xi2 = 0.85513e-3<a name='1235'>
       xi3 = 0.97065e-1<a name='1236'>
       xi4 = 0.21320e-1<a name='1237'>
       xi5 = 0.66985<a name='1238'>
         DO kr=p_ff2i01,p_ff2i33<a name='1239'>
          KRR=KRR+1<a name='1240'>
          chem_new(I,K,J,KR)=FF2R(KRR,1)<a name='1241'>
          geo_cs=0.26*(xi(krr,1)/(ro2bl(krr,1)*0.2))**1.28<a name='1242'>
          volume=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,1)<a name='1243'>
          surface_area=sqrt(geo_cs/3.1415)**2.*chem_new(i,k,j,KR)*XI(KRR,1)<a name='1244'>
          if (surface_area.ne.0.and.volume.ne.0)then<a name='1245'>
          r_e = 3.0/4.0*volume/surface_area<a name='1246'>
          chi_e = 2.0*pi*(r_e*1.E4)/lambda<a name='1247'>
<a name='1248'>
          f1 = (1.0 - xi1)* &amp;<a name='1249'>
     &amp;         (1.0 - (1.0 - exp(-xi2*(chi_e - chi0)))/xi2/(chi_e - chi0))<a name='1250'>
          f2 = (1.0 - xi3)* &amp;<a name='1251'>
     &amp;         (1.0 - exp(-xi4*(chi_e - chi0)))<a name='1252'>
          if(chi_e.le.chi0) then <a name='1253'>
             ft = 0<a name='1254'>
          else <a name='1255'>
           ft = (1.0 - xi5)*f1 + xi5*f2<a name='1256'>
          end if<a name='1257'>
          else<a name='1258'>
          ft=0.<a name='1259'>
          end if<a name='1260'>
          ft=0.<a name='1261'>
          kext_qic(i,k,j)=kext_qic(i,k,j)+(1.-ft)*2.*geo_cs*(100.*col*3.*xi(krr,1))*ff2r(krr,1)<a name='1262'>
          EFF_NI(i,k,j)=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,1)+EFF_NI(i,k,j)<a name='1263'>
          eff_di(i,k,j)=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,1)+eff_di(i,k,j)<a name='1264'>
          EFF_NQIC=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,1)+EFF_NQIC<a name='1265'>
          eff_dqic=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,1)+eff_dqic<a name='1266'>
         END DO<a name='1267'>
         IF (EFF_DQIC.NE.0)THEN<a name='1268'>
         QIC_EFFR(I,K,J)=EFF_NQIC/EFF_DQIC<a name='1269'>
         ELSE<a name='1270'>
         QIC_EFFR(I,K,J)=0.<a name='1271'>
         END IF<a name='1272'>
         krr=0<a name='1273'>
<a name='1274'>
901      format(' ',i3,1x,f12.9,1x,3(f12.9,1x),f12.6,f12.3,1x,10(f12.8,1x))<a name='1275'>
<a name='1276'>
<font color=#447700>! Plates<a name='1277'></font>
         KRR=0<a name='1278'>
         kext_qip(i,k,j)=0.<a name='1279'>
       lambda = 0.55<a name='1280'>
       chi0 = 0.00000<a name='1281'>
       xi1 = 0.23397e-2<a name='1282'>
       xi2 = 0.19513e-2<a name='1283'>
       xi3 = 0.51912e-4<a name='1284'>
       xi4 = 0.15159e-1<a name='1285'>
       xi5 = 0.81012<a name='1286'>
         DO kr=p_ff3i01,p_ff3i33<a name='1287'>
          KRR=KRR+1<a name='1288'>
          chem_new(I,K,J,KR)=FF2R(KRR,2)<a name='1289'>
          geo_cs=(3.1415/4)*(xi(krr,2)/(ro2bl(krr,2)*0.108))**0.72<a name='1290'>
          volume=sqrt(geo_cs/3.1415)**3.*chem_new(i,k,j,KR)*XI(KRR,2)<a name='1291'>
          surface_area=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,2)<a name='1292'>
          if (surface_area.ne.0.and.volume.ne.0)then<a name='1293'>
          r_e = 3.0/4.0*volume/surface_area<a name='1294'>
          chi_e = 2.0*pi*(r_e*1.E4)/lambda<a name='1295'>
<a name='1296'>
          f1 = (1.0 - xi1)* &amp;<a name='1297'>
     &amp;         (1.0 - (1.0 - exp(-xi2*(chi_e - chi0)))/xi2/(chi_e - chi0))<a name='1298'>
          f2 = (1.0 - xi3)* &amp;<a name='1299'>
     &amp;         (1.0 - exp(-xi4*(chi_e - chi0)))<a name='1300'>
          if(chi_e.le.chi0) then <a name='1301'>
             ft = 0<a name='1302'>
          else <a name='1303'>
           ft = (1.0 - xi5)*f1 + xi5*f2<a name='1304'>
          end if<a name='1305'>
          else <a name='1306'>
           ft=0.<a name='1307'>
          end if<a name='1308'>
          ft=0.<a name='1309'>
          kext_qip(i,k,j)=kext_qip(i,k,j)+(1.-ft)*2.*geo_cs*(100.*col*3*xi(krr,2))*ff2r(krr,2)<a name='1310'>
          EFF_NI(i,k,j)=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,2)+EFF_NI(i,k,j)<a name='1311'>
          eff_di(i,k,j)=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,2)+eff_di(i,k,j)<a name='1312'>
          EFF_NQIP=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,2)+EFF_NQIP<a name='1313'>
          eff_dqiP=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,2)+eff_dqip<a name='1314'>
         END DO<a name='1315'>
         IF (EFF_DQIP.NE.0)THEN<a name='1316'>
         QIP_EFFR(I,K,J)=EFF_NQIP/EFF_DQIP<a name='1317'>
         ELSE<a name='1318'>
         QIP_EFFR(I,K,J)=0.<a name='1319'>
         END IF<a name='1320'>
<a name='1321'>
<a name='1322'>
<a name='1323'>
<font color=#447700>!             s=(3.1415/4)*0.097**(-0.72)*(m(nkr))**0.72^M<a name='1324'></font>
<font color=#447700>! Dendrites<a name='1325'></font>
         KRR=0<a name='1326'>
         kext_qid(i,k,j)=0.<a name='1327'>
         lambda = 0.55<a name='1328'>
         chi0 = 0.00000<a name='1329'>
         xi1 = 0.14875<a name='1330'>
         xi2 = 0.49514e-2<a name='1331'>
         xi3 = 0.36201<a name='1332'>
         xi4 = 0.36993e-1<a name='1333'>
         xi5 = 0.87020<a name='1334'>
         DO KR=p_ff4i01,p_ff4i33<a name='1335'>
          KRR=KRR+1<a name='1336'>
          chem_new(I,K,J,KR)=FF2R(KRR,3)<a name='1337'>
          geo_cs=(3.1415/4)*(xi(krr,3)/(ro2bl(krr,3)*7.8E-3))**0.828<a name='1338'>
          volume=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,3)<a name='1339'>
          surface_area=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,3)<a name='1340'>
          if (surface_area.ne.0.and.volume.ne.0)then<a name='1341'>
          r_e = 3.0/4.0*volume/surface_area<a name='1342'>
          chi_e = 2.0*pi*(r_e*1.E4)/lambda<a name='1343'>
<a name='1344'>
          f1 = (1.0 - xi1)* &amp;<a name='1345'>
     &amp;         (1.0 - (1.0 - exp(-xi2*(chi_e - chi0)))/xi2/(chi_e - chi0))<a name='1346'>
          f2 = (1.0 - xi3)* &amp;<a name='1347'>
     &amp;         (1.0 - exp(-xi4*(chi_e - chi0)))<a name='1348'>
          if(chi_e.le.chi0) then <a name='1349'>
             ft = 0<a name='1350'>
          else <a name='1351'>
           ft = (1.0 - xi5)*f1 + xi5*f2<a name='1352'>
          end if<a name='1353'>
          else<a name='1354'>
           ft=0.<a name='1355'>
          end if<a name='1356'>
          ft=0.<a name='1357'>
          kext_qid(i,k,j)=kext_qid(i,k,j)+(1.-ft)*2.*geo_cs*(100.*col*3*xi(krr,3))*ff2r(krr,3)<a name='1358'>
          EFF_NI(i,k,j)=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,3)+EFF_NI(i,k,j)<a name='1359'>
          eff_di(i,k,j)=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,3)+eff_di(i,k,j)<a name='1360'>
          EFF_NQID=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XI(KRR,3)+EFF_NQID<a name='1361'>
          eff_dqiD=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XI(KRR,3)+eff_dqiD<a name='1362'>
         END DO<a name='1363'>
         IF (EFF_DQID.NE.0)THEN<a name='1364'>
         QID_EFFR(I,K,J)=EFF_NQID/EFF_DQID<a name='1365'>
         ELSE<a name='1366'>
         QID_EFFR(I,K,J)=0.<a name='1367'>
         END IF<a name='1368'>
<a name='1369'>
<font color=#447700>!s=(3.1415/4)*(4.6*(10**(-3.377)))**(-0.98)*(m(nkr))**0.98<a name='1370'></font>
<font color=#447700>! HAIL<a name='1371'></font>
         KRR=0<a name='1372'>
         kext_qh(i,k,j)=0.<a name='1373'>
         DO KR=p_ff7i01,p_ff7i33<a name='1374'>
          KRR=KRR+1<a name='1375'>
          chem_new(I,K,J,KR)=FF5R(KRR)<a name='1376'>
          geo_cs=3.1415*(3*xh(krr)/(4*3.1415*0.9))**(2./3.)<a name='1377'>
          kext_qh(i,k,j)=kext_qh(i,k,j)+2.*geo_cs*(100.*col*3*xh(krr))*ff5r(krr)<a name='1378'>
          EFF_NI(i,k,j)=sqrt(geo_cs/3.1415)**3*chem_new(i,k,j,KR)*XH(KRR)+EFF_NI(i,k,j)<a name='1379'>
          eff_di(i,k,j)=sqrt(geo_cs/3.1415)**2*chem_new(i,k,j,KR)*XH(KRR)+eff_di(i,k,j)<a name='1380'>
         END DO<a name='1381'>
<a name='1382'>
        END IF<a name='1383'>
      END DO<a name='1384'>
      END DO<a name='1385'>
      END DO<a name='1386'>
<a name='1387'>
      NKRO=1<a name='1388'>
      NKRE=NKR<a name='1389'>
      DO j = jts,jte<a name='1390'>
      DO i = its,ite<a name='1391'>
      DO k = kts,kte<a name='1392'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1393'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1394'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1395'>
      krr=0<a name='1396'>
      do kr=p_ff1i01,p_ff1i33<a name='1397'>
       krr=krr+1<a name='1398'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1399'>
      end do<a name='1400'>
      end do<a name='1401'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_4">(ffx_z,VR1,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1402'>
      DO k = kts,kte<a name='1403'>
      krr=0<a name='1404'>
      do kr=p_ff1i01,p_ff1i33<a name='1405'>
       krr=krr+1<a name='1406'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1407'>
      end do<a name='1408'>
      end do<a name='1409'>
      if (iceprocs.eq.1)then<a name='1410'>
      DO k = kts,kte<a name='1411'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1412'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1413'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1414'>
      krr=0<a name='1415'>
      do kr=p_ff5i01,p_ff5i33<a name='1416'>
       krr=krr+1<a name='1417'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1418'>
      end do<a name='1419'>
      end do<a name='1420'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_5">(ffx_z,VR3,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1421'>
      DO k = kts,kte<a name='1422'>
      krr=0<a name='1423'>
      do kr=p_ff5i01,p_ff5i33<a name='1424'>
       krr=krr+1<a name='1425'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1426'>
      end do<a name='1427'>
      end do<a name='1428'>
      DO k = kts,kte<a name='1429'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1430'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1431'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1432'>
      krr=0<a name='1433'>
      do kr=p_ff6i01,p_ff6i33<a name='1434'>
       krr=krr+1<a name='1435'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1436'>
      end do<a name='1437'>
      end do<a name='1438'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_6">(ffx_z,VR4,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1439'>
      DO k = kts,kte<a name='1440'>
      krr=0<a name='1441'>
      do kr=p_ff6i01,p_ff6i33<a name='1442'>
       krr=krr+1<a name='1443'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1444'>
      end do<a name='1445'>
      end do<a name='1446'>
<font color=#447700>!    &amp;     ims,ime,jms,jme,kms,kme)<a name='1447'></font>
      DO k = kts,kte<a name='1448'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1449'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1450'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1451'>
      krr=0<a name='1452'>
      do kr=p_ff2i01,p_ff2i33<a name='1453'>
       krr=krr+1<a name='1454'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1455'>
       vri(krr)=vr2(krr,1)<a name='1456'>
      end do<a name='1457'>
      end do<a name='1458'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_7">(ffx_z,VRI,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1459'>
      DO k = kts,kte<a name='1460'>
      krr=0<a name='1461'>
      do kr=p_ff2i01,p_ff2i33<a name='1462'>
       krr=krr+1<a name='1463'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1464'>
      end do<a name='1465'>
      end do<a name='1466'>
      DO k = kts,kte<a name='1467'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1468'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1469'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1470'>
      krr=0<a name='1471'>
      do kr=p_ff3i01,p_ff3i33<a name='1472'>
       krr=krr+1<a name='1473'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1474'>
       vri(krr)=vr2(krr,2)<a name='1475'>
      end do<a name='1476'>
      end do<a name='1477'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_8">(ffx_z,VRI,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1478'>
      DO k = kts,kte<a name='1479'>
      krr=0<a name='1480'>
      do kr=p_ff3i01,p_ff3i33<a name='1481'>
       krr=krr+1<a name='1482'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1483'>
      end do<a name='1484'>
      end do<a name='1485'>
      DO k = kts,kte<a name='1486'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1487'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1488'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1489'>
      krr=0<a name='1490'>
      do kr=p_ff4i01,p_ff4i33<a name='1491'>
       krr=krr+1<a name='1492'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1493'>
       vri(krr)=vr2(krr,3)<a name='1494'>
      end do<a name='1495'>
      end do<a name='1496'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_9">(ffx_z,VRI,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1497'>
      DO k = kts,kte<a name='1498'>
      krr=0<a name='1499'>
      do kr=p_ff4i01,p_ff4i33<a name='1500'>
       krr=krr+1<a name='1501'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1502'>
      end do<a name='1503'>
      end do<a name='1504'>
      DO k = kts,kte<a name='1505'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1506'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1507'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1508'>
      krr=0<a name='1509'>
      do kr=p_ff7i01,p_ff7i33<a name='1510'>
       krr=krr+1<a name='1511'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1512'>
      end do<a name='1513'>
      end do<a name='1514'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_10">(ffx_z,VR5,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1515'>
      DO k = kts,kte<a name='1516'>
      krr=0<a name='1517'>
      do kr=p_ff7i01,p_ff7i33<a name='1518'>
       krr=krr+1<a name='1519'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1520'>
      end do<a name='1521'>
      end do<a name='1522'>
      end if<a name='1523'>
      end do <a name='1524'>
      end do <a name='1525'>
<a name='1526'>
      gmax=0<a name='1527'>
      qmax=0<a name='1528'>
      imax=0<a name='1529'>
      kmax=0<a name='1530'>
      qnmax=0<a name='1531'>
      inmax=0<a name='1532'>
      knmax=0<a name='1533'>
      DO j = jts,jte<a name='1534'>
      DO k = kts,kte<a name='1535'>
      DO i = its,ite<a name='1536'>
      QC(I,K,J)=0<a name='1537'>
      QR(I,K,J)=0<a name='1538'>
      QIC(I,K,J)=0<a name='1539'>
      QIP(I,K,J)=0<a name='1540'>
      QID(I,K,J)=0<a name='1541'>
      QS(I,K,J)=0<a name='1542'>
      QG(I,K,J)=0<a name='1543'>
      QH(I,K,J)=0<a name='1544'>
      QNC(I,K,J)=0<a name='1545'>
      QNR(I,K,J)=0<a name='1546'>
      QNIP(I,K,J)=0<a name='1547'>
      QNIC(I,K,J)=0<a name='1548'>
      QNID(I,K,J)=0<a name='1549'>
      QNS(I,K,J)=0<a name='1550'>
      QNG(I,K,J)=0<a name='1551'>
      QNH(I,K,J)=0<a name='1552'>
      QNA(I,K,J)=0<a name='1553'>
      tt= th_phy(i,k,j)*pi_phy(i,k,j)<a name='1554'>
      DO KR=1,NKR<a name='1555'>
      COLREFLL(KR)=COEFREFLL<a name='1556'>
      COLREFLI(KR)=COEFREFLI<a name='1557'>
        IF(TT.GE.271.15.AND.TT.LE.273.15) THEN<a name='1558'>
               COLREFLS(KR)=COEFREF00/0.09<a name='1559'>
               COLREFLG(KR)=COEFREF00/RO4BL(KR)/RO4BL(KR)<a name='1560'>
               COLREFLH(KR)=COEFREF00/RO5BL(KR)/RO5BL(KR)<a name='1561'>
        ELSE<a name='1562'>
               COLREFLS(KR)=COEFREFLI<a name='1563'>
               COLREFLG(KR)=COEFREFLI<a name='1564'>
               COLREFLH(KR)=COEFREFLI<a name='1565'>
        ENDIF<a name='1566'>
      END DO<a name='1567'>
<font color=#447700>!     END IF<a name='1568'></font>
      EFF_N=0.<a name='1569'>
      EFF_D=0.<a name='1570'>
      KRR=0<a name='1571'>
      DO KR = p_ff1i01,p_ff1i33<a name='1572'>
        KRR=KRR+1<a name='1573'>
        IF (KRR.LT.KRDROP)THEN<a name='1574'>
          EFF_N=DROPRADII(KRR)**3*chem_new(i,k,j,KR)*XL(KRR)+EFF_N<a name='1575'>
          EFF_D=DROPRADII(KRR)**2*chem_new(i,k,j,KR)*XL(KRR)+EFF_D<a name='1576'>
          QC(I,K,J)=QC(I,K,J) &amp;<a name='1577'>
     &amp;      +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XL(KRR)*XL(KRR)*3<a name='1578'>
<font color=#447700>!          QNC(I,K,J)=QNC(I,K,J) &amp;<a name='1579'></font>
<font color=#447700>! J. Fan<a name='1580'></font>
<font color=#447700>!     &amp;      +COL*chem_new(I,K,J,KR)*XL(KR)*3<a name='1581'></font>
           QNC(I,K,J)=QNC(I,K,J) &amp;<a name='1582'>
    &amp;       +COL*chem_new(I,K,J,KR)*XL(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg<a name='1583'></font>
        ELSE<a name='1584'>
          QR(I,K,J)=QR(I,K,J) &amp;<a name='1585'>
     &amp;      +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XL(KRR)*XL(KRR)*3<a name='1586'>
          QNR(I,K,J)=QNR(I,K,J) &amp;<a name='1587'>
<font color=#447700>!     &amp;      +COL*chem_new(I,K,J,KR)*XL(KR)*3<a name='1588'></font>
     &amp;      +COL*chem_new(I,K,J,KR)*XL(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1589'></font>
        END IF<a name='1590'>
      END DO<a name='1591'>
      IF(QC(I,K,J).GT.1.E-6.and.EFF_D.GT.0)THEN<a name='1592'>
          EFFR(I,K,J)=EFF_N/EFF_D<a name='1593'>
      ELSE<a name='1594'>
          EFFR(I,K,J)=0.<a name='1595'>
      END IF<a name='1596'>
      KRR=0<a name='1597'>
      IF (ICEPROCS.EQ.1)THEN<a name='1598'>
       KRR=0<a name='1599'>
       DO  KR=p_ff5i01,p_ff5i33<a name='1600'>
        KRR=KRR+1<a name='1601'>
<font color=#447700>!       if (KRR.LE.KRICE)THEN<a name='1602'></font>
<font color=#447700>!       QI(I,K,J)=QI(I,K,J) &amp;<a name='1603'></font>
<font color=#447700>!    &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XS(KRR)*XS(KRR)*3<a name='1604'></font>
<font color=#447700>!       ELSE<a name='1605'></font>
        QS(I,K,J)=QS(I,K,J) &amp;<a name='1606'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XS(KRR)*XS(KRR)*3<a name='1607'>
<font color=#447700>!       END IF<a name='1608'></font>
        QNS(I,K,J)=QNS(I,K,J) &amp;<a name='1609'>
     &amp;   +COL*chem_new(I,K,J,KR)*XS(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1610'></font>
       END DO<a name='1611'>
       KRR=0<a name='1612'>
       DO  KR=p_ff6i01,p_ff6i33<a name='1613'>
        KRR=KRR+1<a name='1614'>
        QG(I,K,J)=QG(I,K,J) &amp;<a name='1615'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XG(KRR)*XG(KRR)*3<a name='1616'>
        QNG(I,K,J)=QNG(I,K,J) &amp;<a name='1617'>
<font color=#447700>!     &amp;   +1000*COL*chem_new(I,K,J,KR)*XG(KRR)*3<a name='1618'></font>
     &amp;   +COL*chem_new(I,K,J,KR)*XG(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1619'></font>
       END DO<a name='1620'>
       KRR=0<a name='1621'>
       DO  KR=p_ff2i01,p_ff2i33<a name='1622'>
        KRR=KRR+1<a name='1623'>
        QIC(I,K,J)=QIC(I,K,J) &amp;<a name='1624'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XI(KRR,1)*XI(KRR,1)*3<a name='1625'>
        QNIC(I,K,J)=QNIC(I,K,J) &amp;<a name='1626'>
     &amp;   +COL*chem_new(I,K,J,KR)*XI(KRR,1)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1627'></font>
       END DO<a name='1628'>
       KRR=0<a name='1629'>
       DO  KR=p_ff3i01,p_ff3i33<a name='1630'>
        KRR=KRR+1<a name='1631'>
        QIP(I,K,J)=QIP(I,K,J) &amp;<a name='1632'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XI(KRR,2)*XI(KRR,2)*3<a name='1633'>
        QNIP(I,K,J)=QNIP(I,K,J) &amp;<a name='1634'>
     &amp;   +COL*chem_new(I,K,J,KR)*XI(KRR,2)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1635'></font>
       END DO<a name='1636'>
       KRR=0<a name='1637'>
       DO  KR=p_ff4i01,p_ff4i33<a name='1638'>
        KRR=KRR+1<a name='1639'>
        QID(I,K,J)=QID(I,K,J) &amp;<a name='1640'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XI(KRR,3)*XI(KRR,3)*3<a name='1641'>
        QNID(I,K,J)=QNID(I,K,J) &amp;<a name='1642'>
     &amp;   +COL*chem_new(I,K,J,KR)*XI(KRR,3)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1643'></font>
       END DO<a name='1644'>
         IF((QIP(I,K,J).GT.1.E-6.OR.QIC(I,K,J).GT.1.E-6.OR.QID(I,K,J).GT.1.E-6)&amp;<a name='1645'>
     &amp;   .and.eff_di(i,k,j).GT.0)THEN<a name='1646'>
          ICE_EFFR(I,K,J)=EFF_NI(i,k,j)/eff_di(i,k,j)<a name='1647'>
         ELSE<a name='1648'>
          ICE_EFFR(I,K,J)=0.<a name='1649'>
         END IF<a name='1650'>
      END IF<a name='1651'>
       KRR=0<a name='1652'>
       DO  KR=p_ff8i01,p_ff8i33<a name='1653'>
        KRR=KRR+1<a name='1654'>
        QNA(I,K,J)=QNA(I,K,J) &amp;<a name='1655'>
<font color=#447700>!     &amp;   +COL*chem_new(I,K,J,KR)*3<a name='1656'></font>
<font color=#447700>!  change by J.Fan<a name='1657'></font>
     &amp;   +COL*chem_new(I,K,J,KR)/rhocgs(I,K,J)*1000.   <font color=#447700>! #/kg<a name='1658'></font>
       END DO<a name='1659'>
<font color=#447700>!       if (i.eq.100.and.j.eq.100)then<a name='1660'></font>
<font color=#447700>!       print*,'qna = ', k,qna(i,k,j)<a name='1661'></font>
<font color=#447700>!       end if<a name='1662'></font>
       KRR=0<a name='1663'>
       DO  KR=p_ff7i01,p_ff7i33<a name='1664'>
        KRR=KRR+1<a name='1665'>
        QH(I,K,J)=QH(I,K,J) &amp;<a name='1666'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XH(KRR)*XH(KRR)*3<a name='1667'>
        QNH(I,K,J)=QNH(I,K,J) &amp;<a name='1668'>
     &amp;   +COL*chem_new(I,K,J,KR)*XH(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1669'></font>
       END DO<a name='1670'>
      END DO<a name='1671'>
      END DO<a name='1672'>
      END DO<a name='1673'>
<a name='1674'>
<a name='1675'>
<a name='1676'>
<a name='1677'>
998   format(' ',10(f10.1,1x))<a name='1678'>
      DO j = jts,jte<a name='1679'>
      DO i = its,ite<a name='1680'>
       krr=0<a name='1681'>
       RAINNCV(I,J)=0.<a name='1682'>
       SNOWNCV(I,J)=0.<a name='1683'>
       GRAUPELNCV(I,J)=0.<a name='1684'>
       HAILNCV(I,J)=0.<a name='1685'>
       DO KR=p_ff1i01,p_ff1i33<a name='1686'>
        krr=krr+1<a name='1687'>
        DELTAW=VR1(KRR)<a name='1688'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1689'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1690'>
     &amp;           chem_new(I,1,J,KR)*XL(KRR)*XL(KRR)<a name='1691'>
        RAINNCV(I,J)= RAINNCV(I,J) &amp;<a name='1692'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1693'>
     &amp;           chem_new(I,1,J,KR)*XL(KRR)*XL(KRR)<a name='1694'>
       END DO<a name='1695'>
       KRR=0<a name='1696'>
       DO KR=p_ff5i01,p_ff5i33<a name='1697'>
        KRR=KRR+1<a name='1698'>
        DELTAW=VR3(KRR)<a name='1699'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1700'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1701'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1702'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1703'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1704'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1705'>
        SNOWNC(I,J)=SNOWNC(I,J) &amp;<a name='1706'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1707'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1708'>
        SNOWNCV(I,J)= SNOWNCV(I,J) &amp;<a name='1709'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1710'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1711'>
       END DO<a name='1712'>
       KRR=0<a name='1713'>
       DO KR=p_ff6i01,p_ff6i33<a name='1714'>
        KRR=KRR+1<a name='1715'>
        DELTAW=VR4(KRR)<a name='1716'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1717'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1718'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1719'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1720'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1721'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1722'>
        GRAUPELNC(I,J)=GRAUPELNC(I,J) &amp;<a name='1723'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1724'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1725'>
        GRAUPELNCV(I,J)=  GRAUPELNCV(I,J) &amp;<a name='1726'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1727'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1728'>
       END DO<a name='1729'>
       KRR=0<a name='1730'>
       DO KR=p_ff2i01,p_ff2i33<a name='1731'>
        KRR=KRR+1<a name='1732'>
        DELTAW=VR2(KRR,1)<a name='1733'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1734'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1735'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,1)*XI(KRR,1)<a name='1736'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1737'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1738'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,1)*XI(KRR,1)<a name='1739'>
        SNOWNC(I,J)=SNOWNC(I,J) &amp;<a name='1740'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1741'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,1)*XI(KRR,1)<a name='1742'>
        SNOWNCV(I,J)=SNOWNCV(I,J) &amp;<a name='1743'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1744'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,1)*XI(KRR,1)<a name='1745'>
       END DO<a name='1746'>
       KRR=0<a name='1747'>
       DO KR=p_ff3i01,p_ff3i33<a name='1748'>
        KRR=KRR+1<a name='1749'>
        DELTAW=VR2(KRR,2)<a name='1750'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1751'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1752'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,2)*XI(KRR,2)<a name='1753'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1754'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1755'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,2)*XI(KRR,2)<a name='1756'>
        SNOWNC(I,J)=SNOWNC(I,J) &amp;<a name='1757'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1758'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,2)*XI(KRR,2)<a name='1759'>
        SNOWNCV(I,J)=SNOWNCV(I,J) &amp;<a name='1760'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1761'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,2)*XI(KRR,2)<a name='1762'>
       END DO<a name='1763'>
       KRR=0<a name='1764'>
       DO KR=p_ff4i01,p_ff4i33<a name='1765'>
        KRR=KRR+1<a name='1766'>
        DELTAW=VR2(KRR,3)<a name='1767'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1768'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1769'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,3)*XI(KRR,3)<a name='1770'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1771'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1772'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,3)*XI(KRR,3)<a name='1773'>
        SNOWNC(I,J)=SNOWNC(I,J) &amp;<a name='1774'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1775'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,3)*XI(KRR,3)<a name='1776'>
        SNOWNCV(I,J)=SNOWNCV(I,J) &amp;<a name='1777'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1778'>
     &amp;           chem_new(I,1,J,KR)*XI(KRR,3)*XI(KRR,3)<a name='1779'>
       END DO<a name='1780'>
       KRR=0<a name='1781'>
       DO KR=p_ff7i01,p_ff7i33<a name='1782'>
        KRR=KRR+1<a name='1783'>
        DELTAW=VR5(KRR)<a name='1784'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1785'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1786'>
     &amp;           chem_new(I,1,J,KR)*XH(KRR)*XH(KRR)<a name='1787'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1788'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1789'>
     &amp;           chem_new(I,1,J,KR)*XH(KRR)*XH(KRR)<a name='1790'>
        HAILNC(I,J)=HAILNC(I,J) &amp;<a name='1791'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1792'>
     &amp;           chem_new(I,1,J,KR)*XH(KRR)*XH(KRR)<a name='1793'>
        HAILNCV(I,J)= HAILNCV(I,J) &amp;<a name='1794'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1795'>
     &amp;           chem_new(I,1,J,KR)*XH(KRR)*XH(KRR)<a name='1796'>
       END DO<a name='1797'>
<font color=#447700>!     print*, i,j,rainnc(i,j)<a name='1798'></font>
  <font color=#447700>! Transfer 1D arrays back into 3D arrays<a name='1799'></font>
   <font color=#447700>!<a name='1800'></font>
      do k=kts,kte<a name='1801'>
<a name='1802'>
<a name='1803'>
          qv1d(k)=qv(i,k,j)<a name='1804'>
          qr1d(k)=qr(i,k,j)<a name='1805'>
          nr1d(k)=qnr(i,k,j)<a name='1806'>
          qs1d(k)=qs(i,k,j)<a name='1807'>
          ns1d(k)=qns(i,k,j)<a name='1808'>
          qg1d(k)=qg(i,k,j)+qh(i,k,j)<a name='1809'>
          ng1d(k)=qng(i,k,j)+qnh(i,k,j)<a name='1810'>
          t1d(k)=th_phy(i,k,j)*pi_phy(i,k,j)<a name='1811'>
          p1d(k)=P_PHY(I,K,J)<a name='1812'>
       end do<a name='1813'>
<font color=#447700>! wrf-chem<a name='1814'></font>
<a name='1815'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='1816'></font>
         IF ( PRESENT (diagflag) ) THEN<a name='1817'>
         if (diagflag .and. do_radar_ref == 1) then<a name='1818'>
          call <A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM'>refl10cm_hm</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REFL10CM_HM_2"> (qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d,   &amp;<a name='1819'>
                      t1d, p1d, dBZ, kts, kte, i, j)<a name='1820'>
          do k = kts, kte<a name='1821'>
             refl_10cm(i,k,j) = MAX(-35., dBZ(k))<a name='1822'>
          enddo<a name='1823'>
         endif<a name='1824'>
         ENDIF<a name='1825'>
         SR(I,J) = (SNOWNCV(I,J)+GRAUPELNCV(I,J)+HAILNCV(I,J))/(RAINNCV(I,J)+1.e-12)<a name='1826'>
<a name='1827'>
      END DO<a name='1828'>
      END DO<a name='1829'>
<a name='1830'>
<a name='1831'>
<font color=#447700>!     print*,'here 7'<a name='1832'></font>
      do j=jts,jte<a name='1833'>
      do k=kts,kte<a name='1834'>
      do i=its,ite<a name='1835'>
<font color=#447700>!        th_old_2(i,k,j)=th_phy(i,k,j)<a name='1836'></font>
<font color=#447700>!        qv_old_2(i,k,j)=qv(i,k,j)<a name='1837'></font>
         th_old(i,k,j)=th_phy(i,k,j)<a name='1838'>
         qv_old(i,k,j)=qv(i,k,j)<a name='1839'>
<font color=#447700>!     if(i.eq.64.and.j.eq.2.and.k.eq.16)then<a name='1840'></font>
<font color=#447700>!        print*,'th_phy(I,K,J),tt = ',th_phy(I,K,J),tt<a name='1841'></font>
<font color=#447700>!        print*,'qv(I,K,J) = ',qv(I,K,J)<a name='1842'></font>
<font color=#447700>!     end if<a name='1843'></font>
      end do<a name='1844'>
      end do<a name='1845'>
      end do<a name='1846'>
<font color=#447700>!     stop<a name='1847'></font>
<font color=#447700>!     print*,'here 8'<a name='1848'></font>
      if (conserv)then<a name='1849'>
      DO j = jts,jte<a name='1850'>
      DO i = its,ite<a name='1851'>
      DO k = kts,kte<a name='1852'>
      rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='1853'>
      krr=0<a name='1854'>
      DO KR=p_ff1i01,p_ff1i33<a name='1855'>
        krr=krr+1<a name='1856'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XL(KRR)*XL(KRR)*3.0<a name='1857'>
       if (qc(i,k,j)+qr(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1858'>
      END DO<a name='1859'>
      KRR=0<a name='1860'>
      DO KR=p_ff5i01,p_ff5i33<a name='1861'>
       KRR=KRR+1<a name='1862'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XS(KRR)*XS(KRR)*3.0<a name='1863'>
       if (qs(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1864'>
      END DO<a name='1865'>
      KRR=0<a name='1866'>
      DO KR=p_ff6i01,p_ff6i33<a name='1867'>
       KRR=KRR+1<a name='1868'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XG(KRR)*XG(KRR)*3.0<a name='1869'>
       if (qg(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1870'>
      END DO<a name='1871'>
      KRR=0<a name='1872'>
<font color=#447700>!      if (i.eq.100.and.j.eq.100)then<a name='1873'></font>
<font color=#447700>!       print*,'qna 3 = ', k,qna(i,k,j)<a name='1874'></font>
<font color=#447700>!      end if<a name='1875'></font>
      DO KR=p_ff8i01,p_ff8i33<a name='1876'>
       KRR=KRR+1<a name='1877'>
<font color=#447700>! change by Fan<a name='1878'></font>
<font color=#447700>!       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*XCCN(KRR)<a name='1879'></font>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*1000.          <font color=#447700>! #/kg; remember chem_new for CCN is #/cm3, not #/(gcm-3)<a name='1880'></font>
      END DO<a name='1881'>
<font color=#447700>!      if (i.eq.100.and.j.eq.100)then<a name='1882'></font>
<font color=#447700>!       print*,'qna  4 = ', k,qna(i,k,j)<a name='1883'></font>
<font color=#447700>!      end if<a name='1884'></font>
      KRR=0<a name='1885'>
      DO KR=p_ff2i01,p_ff2i33<a name='1886'>
       KRR=KRR+1<a name='1887'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XI(KRR,1)*XI(KRR,1)*3.0<a name='1888'>
       if (qic(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1889'>
      END DO<a name='1890'>
      KRR=0<a name='1891'>
      DO KR=p_ff3i01,p_ff3i33<a name='1892'>
       KRR=KRR+1<a name='1893'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XI(KRR,2)*XI(KRR,2)*3.0<a name='1894'>
       if (qip(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1895'>
      END DO<a name='1896'>
      KRR=0<a name='1897'>
      DO KR=p_ff4i01,p_ff4i33<a name='1898'>
       KRR=KRR+1<a name='1899'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XI(KRR,3)*XI(KRR,3)*3.0<a name='1900'>
       if (qid(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1901'>
      END DO<a name='1902'>
      KRR=0<a name='1903'>
      DO KR=p_ff7i01,p_ff7i33<a name='1904'>
       KRR=KRR+1<a name='1905'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XH(KRR)*XH(KRR)*3.0<a name='1906'>
       if (qh(i,k,j).lt.1.e-13)chem_new(I,K,J,KR)=0.<a name='1907'>
      END DO<a name='1908'>
      END DO<a name='1909'>
      END DO<a name='1910'>
      END DO<a name='1911'>
      END IF<a name='1912'>
     <a name='1913'>
<font color=#447700>!     print*,'here 9'<a name='1914'></font>
      RETURN<a name='1915'>
  END SUBROUTINE SBM<a name='1916'>
<A NAME='FALFLUXHUCM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1917'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>FALFLUXHUCM</font>(chem_new,VR1,RHOCGS,PCGS,ZCGS,DT, &amp; <A href='../../call_to/FALFLUXHUCM.html' TARGET='index'>10</A>,<A href='../../call_from/FALFLUXHUCM.html' TARGET='index'>2</A><a name='1918'>
     &amp;     kts,kte,nkr)<a name='1919'>
      IMPLICIT NONE<a name='1920'>
      INTEGER I,J,K,KR<a name='1921'>
      INTEGER    kts,kte,nkr<a name='1922'>
      REAL TFALL,DTFALL,VFALL(KTE),DWFLUX(KTE)<a name='1923'>
      REAL DT<a name='1924'>
      INTEGER IFALL,N,NSUB<a name='1925'>
      REAL, DIMENSION( kts:kte,nkr ) :: chem_new <a name='1926'>
      REAL,  DIMENSION(kts:kte) :: rhocgs,pcgs,zcgs<a name='1927'>
      REAL VR1(NKR)<a name='1928'>
<a name='1929'>
<font color=#447700>! FALLING FLUXES FOR EACH KIND OF CLOUD PARTICLES: C.G.S. UNIT<a name='1930'></font>
<font color=#447700>! ADAPTED FROM GSFC CODE FOR HUCM<a name='1931'></font>
<font color=#447700>!  The flux at k=1 is assumed to be the ground so FLUX(1) is the<a name='1932'></font>
<font color=#447700>! flux into the ground. DWFLUX(1) is at the lowest half level where<a name='1933'></font>
<font color=#447700>! Q(1) etc are defined. The formula for FLUX(1) uses Q(1) etc which<a name='1934'></font>
<font color=#447700>! is actually half a grid level above it. This is what is meant by<a name='1935'></font>
<font color=#447700>! an upstream method. Upstream in this case is above because the<a name='1936'></font>
<font color=#447700>! velocity is downwards.      <a name='1937'></font>
<font color=#447700>! USE UPSTREAM METHOD (VFALL IS POSITIVE)                 <a name='1938'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',pcgs(100,10,1)<a name='1939'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',pcgs(100,1,1)<a name='1940'></font>
<font color=#447700>!      read(5,*)<a name='1941'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',zcgs(100,10,1)<a name='1942'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',zcgs(100,1,1)<a name='1943'></font>
<font color=#447700>!      read(5,*)<a name='1944'></font>
      DO KR=1,NKR<a name='1945'>
       IFALL=0<a name='1946'>
       DO k = kts,kte<a name='1947'>
          IF(chem_new(K,KR).GE.1.E-10)IFALL=1<a name='1948'>
       END DO <a name='1949'>
       IF (IFALL.EQ.1)THEN<a name='1950'>
        TFALL=1.E10                <a name='1951'>
        DO K=kts,kte<a name='1952'>
         VFALL(K) = VR1(KR)*SQRT(1.E6/PCGS(K))<a name='1953'>
<font color=#447700>!        if (krr.eq.20.or.krr.eq.33)then<a name='1954'></font>
<font color=#447700>!        if (k.eq.5.or.k.eq.10.or.k.eq.20)then<a name='1955'></font>
<font color=#447700>!        print*,'vr1(krr) = ',krr,vr1(krr)<a name='1956'></font>
<font color=#447700>!        print*, 'SQRT(1.E6/PCGS(I,K,J)) = ',i,k,SQRT(1.E6/PCGS(I,K,J))<a name='1957'></font>
<font color=#447700>!        print*,'vfall(k) = ',i,k,vfall(k)<a name='1958'></font>
<font color=#447700>!        print*,'zcgs(k) = ',i,k,zcgs(i,k,j)<a name='1959'></font>
<font color=#447700>!        read(5,*)<a name='1960'></font>
<font color=#447700>!        end if<a name='1961'></font>
<font color=#447700>!        end if<a name='1962'></font>
         TFALL=AMIN1(TFALL,ZCGS(K)/(VFALL(K)+1.E-20))    <a name='1963'>
<font color=#447700>!        print*,'tfall = ',i,k,tfall<a name='1964'></font>
<font color=#447700>!        if (krr.eq.5.or.krr.eq.10.or.krr.eq.20.or.krr.eq.33)read(5,*)<a name='1965'></font>
        END DO                                                 <a name='1966'>
        IF(TFALL.GE.1.E10) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_774">("fatal error in module_mp_full_sbm (TFALL.GE.1.E10), model stop")<a name='1967'>
        NSUB=(INT(2.0*DT/TFALL)+1)                           <a name='1968'>
        DTFALL=DT/NSUB                                      <a name='1969'>
<a name='1970'>
        DO N=1,NSUB                                    <a name='1971'>
          DO K=KTS,KTE-1                               <a name='1972'>
           DWFLUX(K)=-(RHOCGS(K)*VFALL(K)*chem_new(k,kr)- &amp;<a name='1973'>
     &amp;     RHOCGS(K+1)* &amp;<a name='1974'>
     &amp;     VFALL(K+1)*chem_new(K+1,KR))/(RHOCGS(K)*(ZCGS(K+1)- &amp;<a name='1975'>
     &amp;      ZCGS(K)))    <a name='1976'>
          END DO    <a name='1977'>
<font color=#447700>! NO Z ABOVE TOP, SO USE THE SAME DELTAZ<a name='1978'></font>
          DWFLUX(KTE)=-(RHOCGS(KTE)*VFALL(KTE)* &amp; <a name='1979'>
     &amp;       chem_new(kte,kr))/(RHOCGS(KTE)*(ZCGS(KTE)-ZCGS(KTE-1)))         <a name='1980'>
          DO K=kts,kte                                         <a name='1981'>
           chem_new(k,kr)=chem_new(k,kr)+DWFLUX(K)*DTFALL<a name='1982'>
          END DO  <a name='1983'>
        END DO  <a name='1984'>
       END IF<a name='1985'>
      END DO  <a name='1986'>
      RETURN                                                                  <a name='1987'>
      END SUBROUTINE FALFLUXHUCM                                                                    <a name='1988'>
<A NAME='FULL_HUCMINIT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1989'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>FULL_HUCMINIT</font>(DT) <A href='../../call_to/FULL_HUCMINIT.html' TARGET='index'>1</A>,<A href='../../call_from/FULL_HUCMINIT.html' TARGET='index'>81</A><a name='1990'>
      IMPLICIT NONE<a name='1991'>
      INTEGER IKERN_0,IKERN_Z,L0_REAL,L0_INTEGER,INEWMEY,INEST<a name='1992'>
      INTEGER I,J,K,KR<a name='1993'>
      REAL DT<a name='1994'>
      INTEGER :: hujisbm_unit1<a name='1995'>
      LOGICAL, PARAMETER :: PRINT_diag=.FALSE.<a name='1996'>
      LOGICAL :: opened <a name='1997'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='1998'>
      CHARACTER*80 errmess<a name='1999'>
      REAL PI<a name='2000'>
      double precision ax<a name='2001'>
      data pi/3.141592654/<a name='2002'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='2003'></font>
<font color=#447700>! ax - coefficient used for masses calculation <a name='2004'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='2005'></font>
<a name='2006'>
        REAL C1(NKR,NKR)<a name='2007'>
<font color=#447700>! DON'T NEED ALL THESE VARIABLES: STILL NEED EDITING<a name='2008'></font>
       INTEGER ICE,KGRAN,IPRINT01<a name='2009'>
       REAL TWSIN,TWCIN,TWNUC,XF5,XF4,XF3,CONCHIN,CONCGIN,CONCSIN, &amp;<a name='2010'>
     &amp; CONCCLIN,TWHIN,RADH,RADS,RADG,RADL,CONCLIN,A1_MY,A2,A2_MY,XLK, &amp;<a name='2011'>
     &amp; A1N,A3_MY,A3,A1_MYN,R0CCN,X0DROP,DEG01,CONTCCNIN,CONCCCNIN, &amp;<a name='2012'>
     &amp; A,B,X0CCN,S_KR,RCCNKR,R0,X0,TWCALLIN,A1,RCCNKR_CM,SUMIIN,TWGIN, &amp;<a name='2013'>
     &amp; XF1N,XF1,WC1N,RF1N,WNUC,RNUC,WC5,RF5, &amp;<a name='2014'>
     &amp; WC4,RF4,WC3,RF3,WC1,RF1,SMAX<a name='2015'>
       REAL TWIIN(ICEMAX)<a name='2016'>
       REAL RO_SOLUTE      <a name='2017'>
       REAL A_FALL,B_FALL<a name='2018'>
       real graupel_fall(nkr)<a name='2019'>
       data graupel_fall/0.36840E-01,0.57471E-01,0.88417E-01,0.13999E+00,&amp;<a name='2020'>
     &amp;  0.22841E+00,0.36104E+00,0.56734E+00, 0.88417E+00, 0.13999E+01,&amp;<a name='2021'>
     &amp;  0.22104E+01, 0.35367E+01, 0.54524E+01, 0.81049E+01,0.12526E+02,&amp;<a name='2022'>
     &amp;  0.19157E+02, 0.27262E+02, 0.34627E+02, 0.39776E+02,0.45690E+02,&amp; <a name='2023'>
     &amp;  0.52485E+02, 0.60289E+02, 0.69254E+02, 0.10000E+03, 0.15429E+03,&amp;<a name='2024'>
     &amp;  0.18561E+03, 0.22329E+03, 0.26863E+03,  0.32316E+03,0.38877E+03,&amp; <a name='2025'>
     &amp;  0.46770E+03, 0.56266E+03, 0.67690E+03,  0.81432E+03/<a name='2026'>
<a name='2027'>
       INTEGER  KZ_MIN,KZ_MAX<a name='2028'>
       PARAMETER (RO_SOLUTE=2.16)<a name='2029'>
       INTEGER KR_MIN,KR_MIN1,KR_MAX<a name='2030'>
       REAL RADCCN_MIN,RADCCN_MIN1,RADCCN_MAX<a name='2031'>
       REAL FR_CON,FR_MAR<a name='2032'>
     REAL  ::      RHOSU       <font color=#447700>! STANDARD AIR DENSITY AT 850 MB<a name='2033'></font>
     REAL ::      RHOW        <font color=#447700>! DENSITY OF LIQUID WATER<a name='2034'></font>
     REAL ::      RHOI        <font color=#447700>! BULK DENSITY OF CLOUD ICE<a name='2035'></font>
     REAL ::      RHOSN       <font color=#447700>! BULK DENSITY OF SNOW<a name='2036'></font>
     REAL ::      RHOG        <font color=#447700>! BULK DENSITY OF GRAUPEL<a name='2037'></font>
     REAL ::      CI,DI,CS,DS,CG,DG <font color=#447700>! SIZE DISTRIBUTION PARAMETERS FOR CLOUD ICE, SNOW, GRAUPE<a name='2038'></font>
       FR_MAR=1.0<a name='2039'>
<font color=#447700>!      FR_CON=1-FR_MAR<a name='2040'></font>
       FR_CON=1.0<a name='2041'>
<a name='2042'>
<font color=#447700>!      KZ_MIN=16<a name='2043'></font>
<font color=#447700>!      KZ_MAX=21<a name='2044'></font>
<a name='2045'>
<a name='2046'>
<a name='2047'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_817">(" FULL SBM: INITIALIZING HUCM ")<a name='2048'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_818">(" FULL SBM: ****** HUCM ******* ")<a name='2049'>
<font color=#447700>!        PRINT*, 'INITIALIZING HUCM'  <a name='2050'></font>
<font color=#447700>!	print *, ' ****** HUCM *******'<a name='2051'></font>
<a name='2052'>
<font color=#447700>! INPUT :<a name='2053'></font>
        dlnr=dlog(2.d0)/(3.d0*scal)<a name='2054'>
<font color=#447700>!     print*,'here in hucmint 1'<a name='2055'></font>
<font color=#447700>!<a name='2056'></font>
<font color=#447700>!--- Read in various lookup tables<a name='2057'></font>
<font color=#447700>!<a name='2058'></font>
<font color=#447700>!        print*,'wrf_dm_on_monitor() =',wrf_dm_on_monitor() <a name='2059'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2060'>
          DO i = 31,99<a name='2061'>
            INQUIRE ( i , OPENED = opened )<a name='2062'>
            IF ( .NOT. opened ) THEN<a name='2063'>
              hujisbm_unit1 = i<a name='2064'>
              GOTO 2061<a name='2065'>
            ENDIF<a name='2066'>
          ENDDO<a name='2067'>
          hujisbm_unit1 = -1<a name='2068'>
 2061     CONTINUE<a name='2069'>
        ENDIF<a name='2070'>
<font color=#447700>!<a name='2071'></font>
<font color=#447700>!     print*,'here in hucmint 2',hujisbm_unit1<a name='2072'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_212"> ( hujisbm_unit1 , IWORDSIZE )<a name='2073'>
<font color=#447700>!     print*,'here in hucmint 3',hujisbm_unit1<a name='2074'></font>
<font color=#447700>!<a name='2075'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2076'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_775"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2077'>
        ENDIF<a name='2078'>
<font color=#447700>!<a name='2079'></font>
<font color=#447700>!       print*,'here at 1'<a name='2080'></font>
<font color=#447700>!      print*,'here in hucmint 4'<a name='2081'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2082'>
          OPEN(UNIT=hujisbm_unit1,FILE="capacity.asc",                  &amp;<a name='2083'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2084'>
<a name='2085'>
  900	FORMAT(6E13.5)<a name='2086'>
	READ(hujisbm_unit1,900) RLEC,RIEC,RSEC,RGEC,RHEC<a name='2087'>
	CLOSE(hujisbm_unit1)<a name='2088'>
<font color=#447700>!     print*,'here in hucmint 5'<a name='2089'></font>
        END IF<a name='2090'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_213"> ( RLEC , size ( RLEC ) * RWORDSIZE )<a name='2091'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_214"> ( RIEC , size ( RIEC ) * RWORDSIZE )<a name='2092'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_215"> ( RSEC , size ( RSEC ) * RWORDSIZE )<a name='2093'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_216"> ( RGEC , size ( RGEC ) * RWORDSIZE )<a name='2094'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_217"> ( RHEC , size ( RHEC ) * RWORDSIZE )<a name='2095'>
<font color=#447700>! MASSES :<a name='2096'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2097'>
          DO i = 31,99<a name='2098'>
            INQUIRE ( i , OPENED = opened )<a name='2099'>
            IF ( .NOT. opened ) THEN<a name='2100'>
              hujisbm_unit1 = i<a name='2101'>
              GOTO 2062<a name='2102'>
            ENDIF<a name='2103'>
          ENDDO<a name='2104'>
          hujisbm_unit1 = -1<a name='2105'>
 2062     CONTINUE<a name='2106'>
        ENDIF<a name='2107'>
<font color=#447700>!<a name='2108'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_218"> ( hujisbm_unit1 , IWORDSIZE )<a name='2109'>
<font color=#447700>!<a name='2110'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2111'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_776"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2112'>
        ENDIF<a name='2113'>
<font color=#447700>!<a name='2114'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2115'>
          OPEN(UNIT=hujisbm_unit1,FILE="masses.asc",                  &amp;<a name='2116'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2117'>
	READ(hujisbm_unit1,900) XL,XI,XS,XG,XH          <a name='2118'>
	CLOSE(hujisbm_unit1)<a name='2119'>
<font color=#447700>!	print *, ' ***** file2: succesfull *******'<a name='2120'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_819">(" FULL SBM: ****** file2: succesfull  ******* ")<a name='2121'>
        ENDIF<a name='2122'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_219"> ( XL , size ( XL ) * RWORDSIZE )<a name='2123'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_220"> ( XI , size ( XI ) * RWORDSIZE )<a name='2124'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_221"> ( XS , size ( XS ) * RWORDSIZE )<a name='2125'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_222"> ( XG , size ( XG ) * RWORDSIZE )<a name='2126'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_223"> ( XH , size ( XH ) * RWORDSIZE )<a name='2127'>
<font color=#447700>! TERMINAL VELOSITY :<a name='2128'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2129'>
          DO i = 31,99<a name='2130'>
            INQUIRE ( i , OPENED = opened )<a name='2131'>
            IF ( .NOT. opened ) THEN<a name='2132'>
              hujisbm_unit1 = i<a name='2133'>
              GOTO 2063<a name='2134'>
            ENDIF<a name='2135'>
          ENDDO<a name='2136'>
          hujisbm_unit1 = -1<a name='2137'>
 2063     CONTINUE<a name='2138'>
        ENDIF<a name='2139'>
<font color=#447700>!<a name='2140'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_224"> ( hujisbm_unit1 , IWORDSIZE )<a name='2141'>
<font color=#447700>!<a name='2142'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2143'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_777"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2144'>
        ENDIF<a name='2145'>
<font color=#447700>!<a name='2146'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2147'>
          OPEN(UNIT=hujisbm_unit1,FILE="termvels.asc",                  &amp;<a name='2148'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2149'>
	READ(hujisbm_unit1,900) VR1,VR2,VR3,VR4,VR5     <a name='2150'>
	CLOSE(hujisbm_unit1)<a name='2151'>
<font color=#447700>!	print *, ' ***** file3: succesfull *******'<a name='2152'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_820">(" FULL SBM: ****** file3: succesfull  ******* ")<a name='2153'>
        ENDIF<a name='2154'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_225"> ( VR1 , size ( VR1 ) * RWORDSIZE )<a name='2155'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_226"> ( VR2 , size ( VR2 ) * RWORDSIZE )<a name='2156'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_227"> ( VR3 , size ( VR3 ) * RWORDSIZE )<a name='2157'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_228"> ( VR4 , size ( VR4 ) * RWORDSIZE )<a name='2158'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_229"> ( VR5 , size ( VR5 ) * RWORDSIZE )<a name='2159'>
<font color=#447700>! CHANGE FALL VELOCITY OF GRAUPEL<a name='2160'></font>
        DO KR=1,NKR<a name='2161'>
<font color=#447700>!        A=RADXXO(KR,6)<a name='2162'></font>
<font color=#447700>!        B=RADXXO(KR,7)<a name='2163'></font>
         if (kr.le.17)then<a name='2164'>
          A_FALL=1<a name='2165'>
          B_FALL=0<a name='2166'>
         else<a name='2167'>
          B_FALL=1<a name='2168'>
          A_FALL=0<a name='2169'>
         end if<a name='2170'>
  <a name='2171'>
<font color=#447700>!        VR4(KR)=A_FALL*VR4(KR)+B_FALL*VR5(KR)<a name='2172'></font>
<font color=#447700>!        print*,'vr4,vr5,graupel_fall=',vr3(kr),vr5(kr),graupel_fall(kr)<a name='2173'></font>
<font color=#447700>!        VR4(KR)=graupel_fall(kr)<a name='2174'></font>
        END DO<a name='2175'>
 <a name='2176'>
<font color=#447700>! CONSTANTS :<a name='2177'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2178'>
          DO i = 31,99<a name='2179'>
            INQUIRE ( i , OPENED = opened )<a name='2180'>
            IF ( .NOT. opened ) THEN<a name='2181'>
              hujisbm_unit1 = i<a name='2182'>
              GOTO 2065<a name='2183'>
            ENDIF<a name='2184'>
          ENDDO<a name='2185'>
          hujisbm_unit1 = -1<a name='2186'>
 2065     CONTINUE<a name='2187'>
        ENDIF<a name='2188'>
<font color=#447700>!<a name='2189'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_230"> ( hujisbm_unit1 , IWORDSIZE )<a name='2190'>
<font color=#447700>!<a name='2191'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2192'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_778"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2193'>
        ENDIF<a name='2194'>
<font color=#447700>!<a name='2195'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2196'>
          OPEN(UNIT=hujisbm_unit1,FILE="constants.asc",                  &amp;<a name='2197'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2198'>
	READ(hujisbm_unit1,900) SLIC,TLIC,COEFIN,C2,C3,C4<a name='2199'>
	CLOSE(hujisbm_unit1)<a name='2200'>
<font color=#447700>!	print *, ' ***** file4: succesfull *******'<a name='2201'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_821">(" FULL SBM: ****** file4: succesfull  ******* ")<a name='2202'>
        END IF<a name='2203'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_231"> ( SLIC , size ( SLIC ) * RWORDSIZE )<a name='2204'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_232"> ( TLIC , size ( TLIC ) * RWORDSIZE )<a name='2205'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_233"> ( COEFIN , size ( COEFIN ) * RWORDSIZE )<a name='2206'>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C2 , size ( C2 ) * RWORDSIZE )<a name='2207'></font>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C3 , size ( C3 ) * RWORDSIZE )<a name='2208'></font>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C4 , size ( C4 ) * RWORDSIZE )<a name='2209'></font>
<font color=#447700>! CONSTANTS :<a name='2210'></font>
<font color=#447700>! KERNELS DEPENDING ON PRESSURE :<a name='2211'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2212'>
          DO i = 31,99<a name='2213'>
            INQUIRE ( i , OPENED = opened )<a name='2214'>
            IF ( .NOT. opened ) THEN<a name='2215'>
              hujisbm_unit1 = i<a name='2216'>
              GOTO 2066<a name='2217'>
            ENDIF<a name='2218'>
          ENDDO<a name='2219'>
          hujisbm_unit1 = -1<a name='2220'>
 2066     CONTINUE<a name='2221'>
        ENDIF<a name='2222'>
<font color=#447700>!<a name='2223'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_234"> ( hujisbm_unit1 , IWORDSIZE )<a name='2224'>
<font color=#447700>!<a name='2225'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2226'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_779"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2227'>
        ENDIF<a name='2228'>
<font color=#447700>!<a name='2229'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2230'>
          OPEN(UNIT=hujisbm_unit1,FILE="kernels_z.asc",                  &amp;<a name='2231'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2232'>
        READ(hujisbm_unit1,900)  &amp;<a name='2233'>
     &amp;  YWLL_1000MB,YWLL_750MB,YWLL_500MB<a name='2234'>
	CLOSE(hujisbm_unit1)<a name='2235'>
        END IF<a name='2236'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_235"> ( YWLL_1000MB , size ( YWLL_1000MB ) * RWORDSIZE )<a name='2237'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_236"> ( YWLL_750MB , size ( YWLL_750MB ) * RWORDSIZE )<a name='2238'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_237"> ( YWLL_500MB , size ( YWLL_500MB ) * RWORDSIZE )<a name='2239'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2240'>
          DO i = 31,99<a name='2241'>
            INQUIRE ( i , OPENED = opened )<a name='2242'>
            IF ( .NOT. opened ) THEN<a name='2243'>
              hujisbm_unit1 = i<a name='2244'>
              GOTO 2067<a name='2245'>
            ENDIF<a name='2246'>
          ENDDO<a name='2247'>
          hujisbm_unit1 = -1<a name='2248'>
 2067     CONTINUE<a name='2249'>
        ENDIF<a name='2250'>
<font color=#447700>!<a name='2251'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_238"> ( hujisbm_unit1 , IWORDSIZE )<a name='2252'>
<font color=#447700>!<a name='2253'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2254'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_780"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2255'>
        ENDIF<a name='2256'>
<font color=#447700>!<a name='2257'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2258'>
          OPEN(UNIT=hujisbm_unit1,FILE="kernels.asc_s_0_03_0_9",                  &amp;<a name='2259'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2260'>
<font color=#447700>! KERNELS NOT DEPENDING ON PRESSURE :<a name='2261'></font>
	READ(hujisbm_unit1,900) &amp;<a name='2262'>
     &amp;  YWLL,YWLI,YWLS,YWLG,YWLH, &amp;<a name='2263'>
     &amp;  YWIL,YWII,YWIS,YWIG,YWIH, &amp;<a name='2264'>
     &amp;  YWSL,YWSI,YWSS,YWSG,YWSH, &amp;<a name='2265'>
     &amp;  YWGL,YWGI,YWGS,YWGG,YWGH, &amp;<a name='2266'>
     &amp;  YWHL,YWHI,YWHS,YWHG,YWHH<a name='2267'>
       close (hujisbm_unit1)<a name='2268'>
        END IF<a name='2269'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_239"> ( YWLL , size ( YWLL ) * RWORDSIZE )<a name='2270'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_240"> ( YWLI , size ( YWLI ) * RWORDSIZE )<a name='2271'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_241"> ( YWLS , size ( YWLS ) * RWORDSIZE )<a name='2272'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_242"> ( YWLG , size ( YWLG ) * RWORDSIZE )<a name='2273'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_243"> ( YWLH , size ( YWLH ) * RWORDSIZE )<a name='2274'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_244"> ( YWIL , size ( YWIL ) * RWORDSIZE )<a name='2275'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_245"> ( YWII , size ( YWII ) * RWORDSIZE )<a name='2276'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_246"> ( YWIS , size ( YWIS ) * RWORDSIZE )<a name='2277'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_247"> ( YWIG , size ( YWIG ) * RWORDSIZE )<a name='2278'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_248"> ( YWIH , size ( YWIH ) * RWORDSIZE )<a name='2279'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_249"> ( YWSL , size ( YWSL ) * RWORDSIZE )<a name='2280'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_250"> ( YWSI , size ( YWSI ) * RWORDSIZE )<a name='2281'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_251"> ( YWSS , size ( YWSS ) * RWORDSIZE )<a name='2282'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_252"> ( YWSG , size ( YWSG ) * RWORDSIZE )<a name='2283'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_253"> ( YWSH , size ( YWSH ) * RWORDSIZE )<a name='2284'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_254"> ( YWGL , size ( YWGL ) * RWORDSIZE )<a name='2285'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_255"> ( YWGI , size ( YWGI ) * RWORDSIZE )<a name='2286'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_256"> ( YWGS , size ( YWGS ) * RWORDSIZE )<a name='2287'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_257"> ( YWGG , size ( YWGG ) * RWORDSIZE )<a name='2288'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_258"> ( YWGH , size ( YWGH ) * RWORDSIZE )<a name='2289'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_259"> ( YWHL , size ( YWHL ) * RWORDSIZE )<a name='2290'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_260"> ( YWHI , size ( YWHI ) * RWORDSIZE )<a name='2291'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_261"> ( YWHS , size ( YWHS ) * RWORDSIZE )<a name='2292'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_262"> ( YWHG , size ( YWHG ) * RWORDSIZE )<a name='2293'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_263"> ( YWHH , size ( YWHH ) * RWORDSIZE )<a name='2294'>
<font color=#447700>! BULKDENSITY :<a name='2295'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2296'>
          DO i = 31,99<a name='2297'>
            INQUIRE ( i , OPENED = opened )<a name='2298'>
            IF ( .NOT. opened ) THEN<a name='2299'>
              hujisbm_unit1 = i<a name='2300'>
              GOTO 2068<a name='2301'>
            ENDIF<a name='2302'>
          ENDDO<a name='2303'>
          hujisbm_unit1 = -1<a name='2304'>
 2068     CONTINUE<a name='2305'>
        ENDIF<a name='2306'>
<font color=#447700>!<a name='2307'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_264"> ( hujisbm_unit1 , IWORDSIZE )<a name='2308'>
<font color=#447700>!<a name='2309'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2310'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_781"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2311'>
        ENDIF<a name='2312'>
<font color=#447700>!<a name='2313'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2314'>
          OPEN(UNIT=hujisbm_unit1,FILE="bulkdens.asc_s_0_03_0_9",         &amp; <a name='2315'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2316'>
	READ(hujisbm_unit1,900) RO1BL,RO2BL,RO3BL,RO4BL,RO5BL<a name='2317'>
	CLOSE(hujisbm_unit1)<a name='2318'>
<font color=#447700>!	print *, ' ***** file6: succesfull *******'<a name='2319'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_822">(" FULL SBM: ****** file6: succesfull  ******* ")<a name='2320'>
        END IF<a name='2321'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_265"> (RO1BL  , size ( RO1BL ) * RWORDSIZE )<a name='2322'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_266"> (RO2BL  , size ( RO2BL ) * RWORDSIZE )<a name='2323'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_267"> (RO3BL  , size ( RO3BL ) * RWORDSIZE )<a name='2324'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_268"> (RO4BL  , size ( RO4BL ) * RWORDSIZE )<a name='2325'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_269"> (RO5BL  , size ( RO5BL ) * RWORDSIZE )<a name='2326'>
<font color=#447700>! BULKRADIUS<a name='2327'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2328'>
          DO i = 31,99<a name='2329'>
            INQUIRE ( i , OPENED = opened )<a name='2330'>
            IF ( .NOT. opened ) THEN<a name='2331'>
              hujisbm_unit1 = i<a name='2332'>
              GOTO 2069<a name='2333'>
            ENDIF<a name='2334'>
          ENDDO<a name='2335'>
          hujisbm_unit1 = -1<a name='2336'>
 2069     CONTINUE<a name='2337'>
        ENDIF<a name='2338'>
<font color=#447700>!<a name='2339'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_270"> ( hujisbm_unit1 , IWORDSIZE )<a name='2340'>
<font color=#447700>!<a name='2341'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2342'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_782"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2343'>
        ENDIF<a name='2344'>
<font color=#447700>!<a name='2345'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2346'>
          OPEN(UNIT=hujisbm_unit1,FILE="bulkradii.asc_s_0_03_0_9",         &amp; <a name='2347'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2348'>
	READ(hujisbm_unit1,*) RADXXO<a name='2349'>
	CLOSE(hujisbm_unit1)<a name='2350'>
<font color=#447700>!	print *, ' ***** file7: succesfull *******'<a name='2351'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_823">(" FULL SBM: ****** file7: succesfull  ******* ")<a name='2352'>
<font color=#447700>!	PRINT *, '******* Hebrew Univ Cloud model-HUCM *******'<a name='2353'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_824">(" FULL SBM: Hebrew Univ Cloud model-HUCM ")<a name='2354'>
<a name='2355'>
        END IF<a name='2356'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_271"> (RADXXO  , size ( RADXXO ) * RWORDSIZE )<a name='2357'>
<font color=#447700>! calculation of the mass(in mg) for categories boundaries :<a name='2358'></font>
        ax=2.d0**(1.0/scal)<a name='2359'>
        xl_mg(1)=0.3351d-7<a name='2360'>
	do i=2,nkr<a name='2361'>
           xl_mg(i)=ax*xl_mg(i-1)<a name='2362'>
<font color=#447700>!        if (i.eq.22)print*,'printing xl_mg = ',xl_mg(22)<a name='2363'></font>
        enddo<a name='2364'>
	do i=1,nkr<a name='2365'>
           xs_mg(i)=xs(i)*1.e3<a name='2366'>
           xg_mg(i)=xg(i)*1.e3<a name='2367'>
           xh_mg(i)=xh(i)*1.e3<a name='2368'>
           xi1_mg(i)=xi(i,1)*1.e3<a name='2369'>
           xi2_mg(i)=xi(i,2)*1.e3<a name='2370'>
           xi3_mg(i)=xi(i,3)*1.e3<a name='2371'>
        enddo<a name='2372'>
<font color=#447700>! calculation of c(i,j) and ima(i,j) :<a name='2373'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='2374'></font>
<font color=#447700>!       print*, 'calling courant_bott'<a name='2375'></font>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COURANT_BOTT'>courant_bott</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COURANT_BOTT_2"><a name='2376'>
<font color=#447700>!       print*, 'called courant_bott'<a name='2377'></font>
 <a name='2378'>
<a name='2379'>
	DEG01=1./3.<a name='2380'>
<a name='2381'>
<font color=#447700>!------------------------------------------------------------------<a name='2382'></font>
<a name='2383'>
<font color=#447700>!       print*,'XL(ICCN) = ',ICCN,XL<a name='2384'></font>
	X0DROP=XL(ICCN)<a name='2385'>
<font color=#447700>!       print*,'X0DROP = ',X0DROP<a name='2386'></font>
	X0CCN =X0DROP/(2.**(NKR-1))<a name='2387'>
	R0CCN =(3.*X0CCN/4./3.141593/ROCCN0)**DEG01<a name='2388'>
<font color=#447700>!------------------------------------------------------------------<a name='2389'></font>
<font color=#447700>! THIS TEXT FROM TWOINITM.F_203<a name='2390'></font>
<font color=#447700>!------------------------------------------------------------------<a name='2391'></font>
<font color=#447700>! TEMPERATURA IN SURFACE LAYER EQUAL 15 Celsius(288.15 K)  <a name='2392'></font>
        A=3.3E-05/288.15<a name='2393'>
        B=2.*4.3/(22.9+35.5)<a name='2394'>
        B=B*(4./3.)*3.14*RO_SOLUTE<a name='2395'>
        A1=2.*(A/3.)**1.5/SQRT(B)<a name='2396'>
        A2=A1*100.<a name='2397'>
<font color=#447700>!------------------------------------------------------------------<a name='2398'></font>
	CONCCCNIN=0.<a name='2399'>
	CONTCCNIN=0.<a name='2400'>
	DO KR=1,NKR<a name='2401'>
           DROPRADII(KR)=(3.*XL(KR)/4./3.141593/1.)**DEG01<a name='2402'>
        ENDDO<a name='2403'>
	DO KR=1,NKR<a name='2404'>
<font color=#447700>!          print*,'ROCCN0 = ',ROCCN0<a name='2405'></font>
<font color=#447700>!          print*, 'X0CCN = ',X0CCN <a name='2406'></font>
<font color=#447700>!          print*, 'DEG01 = ',DEG01<a name='2407'></font>
	   ROCCN(KR)=ROCCN0<a name='2408'>
	   X0=X0CCN*2.**(KR-1)<a name='2409'>
	   R0=(3.*X0/4./3.141593/ROCCN(KR))**DEG01<a name='2410'>
	   XCCN(KR)=X0<a name='2411'>
	   RCCN(KR)=R0<a name='2412'>
<font color=#447700>!          print*,'RCCN(KR)= ', KR,RCCN(KR)<a name='2413'></font>
           RCCNKR_CM=R0<a name='2414'>
<font color=#447700>! CCN SPECTRUM <a name='2415'></font>
<a name='2416'>
           S_KR=A2/RCCNKR_CM**1.5<a name='2417'>
           ACCN=ACCN_CON<a name='2418'>
           BCCN=BCCN_CON<a name='2419'>
<font color=#447700>!          print*,'accn, bccn,S_KR = ',accn,bccn,S_KR<a name='2420'></font>
<font color=#447700>!  CONTINENTAL<a name='2421'></font>
           FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN<a name='2422'>
           FCCNR_CON(KR)=FCCNR(KR)<a name='2423'>
<font color=#447700>!  MARITIME<a name='2424'></font>
           ACCN=ACCN_MAR<a name='2425'>
           BCCN=BCCN_MAR<a name='2426'>
           FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN<a name='2427'>
           FCCNR_MAR(KR)=FCCNR(KR)<a name='2428'>
<a name='2429'>
	     CONTCCNIN=CONTCCNIN+COL*FCCNR(KR)*R0*R0*R0<a name='2430'>
             CONCCCNIN=CONCCCNIN+COL*FCCNR(KR)<a name='2431'>
	ENDDO<a name='2432'>
<font color=#447700>!	PRINT *, '********* MAR CCN CONCENTRATION &amp; MASS *******'<a name='2433'></font>
<font color=#447700>!        call wrf_message(" FULL SBM: MAR CCN CONCENTRATION &amp; MASS ")<a name='2434'></font>
<font color=#447700>!	PRINT 200, CONCCCNIN,CONTCCNIN<a name='2435'></font>
<font color=#447700>! CALCULATION OF FINAL MARITIME<a name='2436'></font>
<font color=#447700>!RCCN(KR)=            1  1.2303877E-07<a name='2437'></font>
<font color=#447700>!RCCN(KR)=            2  1.5501914E-07<a name='2438'></font>
<font color=#447700>!RCCN(KR)=            3  1.9531187E-07<a name='2439'></font>
<font color=#447700>!RCCN(KR)=           16  3.9372408E-06<a name='2440'></font>
<font color=#447700>!RCCN(KR)=           21  1.2499960E-05<a name='2441'></font>
<font color=#447700>!RCCN(KR)=           33  1.9999935E-04<a name='2442'></font>
        RADCCN_MAX=RCCN(NKR)<a name='2443'>
        RADCCN_MIN=0.005E-4         <a name='2444'>
        RADCCN_MIN1=0.02E-4         <a name='2445'>
<font color=#447700>!       print*,'ALOG(RADCCN_MIN) = ',ALOG(RADCCN_MIN)<a name='2446'></font>
<font color=#447700>!       print*,'ALOG(RCCN(1) = ',ALOG(RCCN(1))<a name='2447'></font>
<font color=#447700>!       print*,'ALOG(RADCCN_MAX) = ',ALOG(RADCCN_MAX)<a name='2448'></font>
<font color=#447700>!       KR_MIN=(ALOG(RADCCN_MIN)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2449'></font>
<font color=#447700>!       KR_MIN1=(ALOG(RADCCN_MIN1)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2450'></font>
        KR_MIN=1.+ 3*(ALOG(RADCCN_MIN)- ALOG(R0CCN))/ALOG(2.)<a name='2451'>
        KR_MIN1=1.+3*(ALOG(RADCCN_MIN1)- ALOG(R0CCN))/ALOG(2.)<a name='2452'>
<font color=#447700>!       KR_MAX=(ALOG(RADCCN_MAX)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2453'></font>
        KR_MAX=1.+3.*(ALOG(RADCCN_MAX)- ALOG(R0CCN))/ALOG(2.)<a name='2454'>
        KR_MIN=MAX(KR_MIN,1)<a name='2455'>
        KR_MIN1=MAX(KR_MIN,KR_MIN1)<a name='2456'>
        KR_MAX=MIN(NKR,KR_MAX)<a name='2457'>
<font color=#447700>!       print*,'kr_min,kr_min1 = ',kr_min,kr_min1<a name='2458'></font>
<font color=#447700>!       print*,'kr_max = ',kr_max<a name='2459'></font>
<font color=#447700>! Interpolation<a name='2460'></font>
        DO KR=1,NKR<a name='2461'>
        IF (kr.ge.kr_min.and.kr.lt.kr_min1)then<a name='2462'>
           FCCNR_MAR(KR)=FCCNR_MAR(KR_MIN1)* &amp;<a name='2463'>
     &amp;      (ALOG(RCCN(KR))-ALOG(RCCN(KR_MIN)))/ &amp;<a name='2464'>
     &amp;      (ALOG(RCCN(KR_MIN1))-ALOG(RCCN(KR_MIN)))<a name='2465'>
<a name='2466'>
        END IF<a name='2467'>
        IF (KR.GT.KR_MAX.OR.KR.LT.KR_MIN)FCCNR_MAR(KR)=0<a name='2468'>
<font color=#447700>!          print*,'FCCNR_MAR(KR) = ',KR,FCCNR_MAR(KR)<a name='2469'></font>
        END DO<a name='2470'>
<font color=#447700>! CALCULATION OF FINAL CONTINENTAL<a name='2471'></font>
        RADCCN_MAX=0.6E-4<a name='2472'>
        RADCCN_MIN=0.005E-4         <a name='2473'>
        RADCCN_MIN1=0.02E-4         <a name='2474'>
<font color=#447700>!       KR_MIN=(ALOG(RADCCN_MIN)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2475'></font>
<font color=#447700>!       KR_MIN1=(ALOG(RADCCN_MIN1)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2476'></font>
        KR_MIN=1.+ 3*(ALOG(RADCCN_MIN)- ALOG(R0CCN))/ALOG(2.)<a name='2477'>
        KR_MIN1=1.+3*(ALOG(RADCCN_MIN1)- ALOG(R0CCN))/ALOG(2.)<a name='2478'>
<font color=#447700>!       KR_MAX=(ALOG(RADCCN_MAX)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='2479'></font>
        KR_MAX=1.+3.*(ALOG(RADCCN_MAX)- ALOG(R0CCN))/ALOG(2.)<a name='2480'>
        KR_MIN=MAX(KR_MIN,1)<a name='2481'>
        KR_MIN1=MAX(KR_MIN,KR_MIN1)<a name='2482'>
        KR_MAX=MIN(NKR,KR_MAX)<a name='2483'>
<font color=#447700>!       print*,'contin kr_min,kr_min1 = ',kr_min,kr_min1<a name='2484'></font>
<font color=#447700>!       print*,'kr_max = ',kr_max<a name='2485'></font>
<font color=#447700>! Interpolation<a name='2486'></font>
        DO KR=1,NKR<a name='2487'>
        IF (kr.ge.kr_min.and.kr.lt.kr_min1)then<a name='2488'>
           FCCNR_CON(KR)=FCCNR_CON(KR_MIN1)* &amp;<a name='2489'>
     &amp;      (ALOG(RCCN(KR))-ALOG(RCCN(KR_MIN)))/ &amp;<a name='2490'>
     &amp;      (ALOG(RCCN(KR_MIN1))-ALOG(RCCN(KR_MIN)))<a name='2491'>
        END IF<a name='2492'>
        IF (KR.GT.KR_MAX.OR.KR.LT.KR_MIN)FCCNR_CON(KR)=0<a name='2493'>
<font color=#447700>!          print*,'FCCNR_CON(KR) = ',KR,FCCNR_CON(KR)<a name='2494'></font>
        END DO<a name='2495'>
<font color=#447700>! CALCULATION OF MIXTURE<a name='2496'></font>
        DO KR=1,NKR<a name='2497'>
         FCCNR_MIX(KR)=FR_CON*FCCNR_CON(KR)+FR_MAR*FCCNR_MAR(KR)<a name='2498'>
<font color=#447700>!        print*,'FCCNR_MIX(KR) = ',FCCNR_MIX(KR)<a name='2499'></font>
        END DO<a name='2500'>
<font color=#447700>!        STOP<a name='2501'></font>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT'>BREAKINIT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BREAKINIT_2"><a name='2502'>
<font color=#447700>!        CALL TWOINITMXVAR<a name='2503'></font>
<a name='2504'>
<font color=#447700>! IN CASE : IPRINT01.NE.0<a name='2505'></font>
<a name='2506'>
<a name='2507'>
  100	FORMAT(10I4)<a name='2508'>
  101   FORMAT(3X,F7.5,E13.5)<a name='2509'>
  102	FORMAT(4E12.4)<a name='2510'>
  105	FORMAT(A48)<a name='2511'>
  106	FORMAT(A80)<a name='2512'>
  123	FORMAT(3E12.4,3I4)<a name='2513'>
  200	FORMAT(6E13.5)<a name='2514'>
  201   FORMAT(6D13.5)<a name='2515'>
  300	FORMAT(8E14.6) <a name='2516'>
  301   FORMAT(3X,F8.3,3X,E13.5)<a name='2517'>
  302   FORMAT(5E13.5)<a name='2518'>
<font color=#447700>!       if (IFREST)THEN<a name='2519'></font>
<font color=#447700>!       dtime=dt*0.5<a name='2520'></font>
<font color=#447700>!       else<a name='2521'></font>
<font color=#447700>!       END IF<a name='2522'></font>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_6">(dt)<a name='2523'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='2524'></font>
<font color=#447700>! from morr_two_moment<a name='2525'></font>
<font color=#447700>!..Set these variables needed for computing radar reflectivity.  These<a name='2526'></font>
<font color=#447700>!.. get used within radar_init to create other variables used in the<a name='2527'></font>
<font color=#447700>!.. radar module.<a name='2528'></font>
<font color=#447700>! SIZE DISTRIBUTION PARAMETERS<a name='2529'></font>
         RHOW = 997.<a name='2530'>
         RHOI = 500.<a name='2531'>
         RHOSN = 100.<a name='2532'>
<font color=#447700>!        IF (IHAIL.EQ.0) THEN<a name='2533'></font>
<font color=#447700>!        RHOG = 400.<a name='2534'></font>
<font color=#447700>!        ELSE<a name='2535'></font>
<font color=#447700>!        RHOG = 900.<a name='2536'></font>
<font color=#447700>!        END IF<a name='2537'></font>
         RHOG=450<a name='2538'>
<a name='2539'>
<a name='2540'>
         CI = RHOI*PI_MORR/6.<a name='2541'>
         DI = 3.<a name='2542'>
         CS = RHOSN*PI_MORR/6.<a name='2543'>
         DS = 3.<a name='2544'>
         CG = RHOG*PI_MORR/6.<a name='2545'>
         DG = 3.<a name='2546'>
<a name='2547'>
<a name='2548'>
         xam_r = PI_MORR*RHOW/6.<a name='2549'>
         xbm_r = 3.<a name='2550'>
         xmu_r = 0.<a name='2551'>
         xam_s = CS<a name='2552'>
         xbm_s = DS<a name='2553'>
         xmu_s = 0.<a name='2554'>
         xam_g = CG<a name='2555'>
         xbm_g = DG<a name='2556'>
         xmu_g = 0.<a name='2557'>
<a name='2558'>
         call <A href='../../html_code/phys/module_mp_radar.F.html#RADAR_INIT'>radar_init</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADAR_INIT_2"><a name='2559'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='2560'></font>
<a name='2561'>
        return<a name='2562'>
2070  continue<a name='2563'>
      WRITE( errmess , '(A,I4)' )                                        &amp;<a name='2564'>
       'module_mp_full_sbm: error opening hujisbm_DATA on unit '          &amp;<a name='2565'>
     &amp;, hujisbm_unit1<a name='2566'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FULL_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_783">(errmess)<a name='2567'>
        end  subroutine full_hucminit<a name='2568'>
<A NAME='BREAKINIT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2569'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BREAKINIT</font> <A href='../../call_to/BREAKINIT.html' TARGET='index'>2</A>,<A href='../../call_from/BREAKINIT.html' TARGET='index'>16</A><a name='2570'>
      IMPLICIT NONE<a name='2571'>
      INTEGER :: hujisbm_unit1<a name='2572'>
      LOGICAL, PARAMETER :: PRINT_diag=.FALSE.<a name='2573'>
      LOGICAL :: opened <a name='2574'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='2575'>
      CHARACTER*80 errmess<a name='2576'>
<font color=#447700>!.....INPUT VARIABLES<a name='2577'></font>
<font color=#447700>!<a name='2578'></font>
<font color=#447700>!     GT    : MASS DISTRIBUTION FUNCTION<a name='2579'></font>
<font color=#447700>!     XT_MG : MASS OF BIN IN MG<a name='2580'></font>
<font color=#447700>!     JMAX  : NUMBER OF BINS<a name='2581'></font>
<a name='2582'>
<a name='2583'>
<font color=#447700>!.....LOCAL VARIABLES<a name='2584'></font>
<a name='2585'>
      INTEGER AP,IE,JE,KE<a name='2586'>
<a name='2587'>
      PARAMETER (AP = 1)<a name='2588'>
<a name='2589'>
      INTEGER I,J,K,JDIFF<a name='2590'>
      REAL  RPKIJ(JBREAK,JBREAK,JBREAK),RQKJ(JBREAK,JBREAK)<a name='2591'>
<a name='2592'>
<a name='2593'>
      REAL PI,D0,HLP<a name='2594'>
      DOUBLE PRECISION M(0:JBREAK),ALM<a name='2595'>
      REAL DBREAK(JBREAK),GAIN,LOSS<a name='2596'>
<font color=#447700>!     REAL ECOALMASS<a name='2597'></font>
<font color=#447700>!     REAL XL(JMAX)<a name='2598'></font>
<a name='2599'>
<a name='2600'>
<font color=#447700>!.....DECLARATIONS FOR INIT<a name='2601'></font>
<a name='2602'>
      INTEGER IP,KP,JP,KQ,JQ<a name='2603'>
      REAL XTJ<a name='2604'>
<a name='2605'>
      CHARACTER*20 FILENAME_P,FILENAME_Q<a name='2606'>
<a name='2607'>
      FILENAME_P = 'coeff_p.asc'<a name='2608'>
      FILENAME_Q = 'coeff_q.asc'<a name='2609'>
<a name='2610'>
      IE = JBREAK<a name='2611'>
      JE = JBREAK<a name='2612'>
      KE = JBREAK<a name='2613'>
      PI    = 3.1415927<a name='2614'>
      D0    = 0.0101593<a name='2615'>
      M(1)  = PI/6.0 * D0**3<a name='2616'>
<a name='2617'>
<font color=#447700>!.....IN CGS<a name='2618'></font>
<a name='2619'>
<a name='2620'>
<font color=#447700>!.....SHIFT BETWEEN COAGULATION AND BREAKUP GRID<a name='2621'></font>
<a name='2622'>
      JDIFF = JMAX - JBREAK<a name='2623'>
<a name='2624'>
<font color=#447700>!.....INITIALIZATION<a name='2625'></font>
<a name='2626'>
<font color=#447700>!     IF (FIRSTCALL.NE.1) THEN<a name='2627'></font>
<a name='2628'>
<font color=#447700>!........CALCULATING THE BREAKUP GRID<a name='2629'></font>
<font color=#447700>!        ALM  = 2.**(1./FLOAT(AP))<a name='2630'></font>
         ALM  = 2.d0<a name='2631'>
         M(0)  = M(1)/ALM<a name='2632'>
         DO K=1,KE-1<a name='2633'>
            M(K+1) = M(K)*ALM<a name='2634'>
         ENDDO<a name='2635'>
         DO K=1,KE<a name='2636'>
            BRKWEIGHT(K) = 2./(M(K)**2 - M(K-1)**2)<a name='2637'>
<font color=#447700>!           print*,'m(k) = ',m(k)<a name='2638'></font>
<font color=#447700>!           print*,'m(k-1) = ',m(k-1)<a name='2639'></font>
<font color=#447700>!           print*, 'MWEIGHT = ',BRKWEIGHT(K)<a name='2640'></font>
         ENDDO<a name='2641'>
<a name='2642'>
<font color=#447700>!........OUTPUT<a name='2643'></font>
<a name='2644'>
         WRITE (*,*) 'COLL_BREAKUP_INI: COAGULATION AND BREAKUP GRID'<a name='2645'>
         WRITE (*,'(2A5,5A15)') 'ICOAG','IBREAK', &amp;<a name='2646'>
     &amp;        'XCOAG','DCOAG', &amp;<a name='2647'>
     &amp;        'XBREAK','DBREAK','MWEIGHT'<a name='2648'>
<a name='2649'>
<font color=#447700>!........READ DER BREAKUP COEFFICIENTS FROM INPUT FILE<a name='2650'></font>
<a name='2651'>
<font color=#447700>!        WRITE (*,*) 'COLL_BREAKUP: READ THE BREAKUP COEFFS'<a name='2652'></font>
<font color=#447700>!        WRITE (*,*) '              FILE PKIJ: ', FILENAME_P<a name='2653'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2654'>
          DO i = 31,99<a name='2655'>
            INQUIRE ( i , OPENED = opened )<a name='2656'>
            IF ( .NOT. opened ) THEN<a name='2657'>
              hujisbm_unit1 = i<a name='2658'>
              GOTO 2061<a name='2659'>
            ENDIF<a name='2660'>
          ENDDO<a name='2661'>
          hujisbm_unit1 = -1<a name='2662'>
 2061     CONTINUE<a name='2663'>
        ENDIF<a name='2664'>
<font color=#447700>!<a name='2665'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_272"> ( hujisbm_unit1 , IWORDSIZE )<a name='2666'>
<font color=#447700>!<a name='2667'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2668'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_784"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2669'>
        ENDIF<a name='2670'>
<font color=#447700>!<a name='2671'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2672'>
          OPEN(UNIT=hujisbm_unit1,FILE="coeff_p.asc",                  &amp;<a name='2673'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2674'>
<a name='2675'>
<font color=#447700>!         print*,'here at 3'<a name='2676'></font>
         DO K=1,KE<a name='2677'>
            DO I=1,IE<a name='2678'>
               DO J=1,I<a name='2679'>
                  READ(hujisbm_unit1,'(3I6,1E16.8)') KP,IP,JP,PKIJ(KP,IP,JP)<a name='2680'>
<font color=#447700>!                 WRITE(6,*)'PKIJ(KP,IP,JP) =', &amp;<a name='2681'></font>
<font color=#447700>!    &amp;               KP,IP,JP,PKIJ(KP,IP,JP)<a name='2682'></font>
<font color=#447700>!                 IF(RPKIJ(KP,IP,JP).EQ.0) THEN<a name='2683'></font>
<font color=#447700>!    *             PKIJ(KP,IP,JP)=INT(RPKIJ(KP,IP,JP))<a name='2684'></font>
<font color=#447700>!                 ELSE<a name='2685'></font>
<font color=#447700>!                  PKIJ(KP,IP,JP)=RPKIJ(KP,IP,JP)<a name='2686'></font>
<font color=#447700>!                 END IF<a name='2687'></font>
<font color=#447700>!                 WRITE(6,*)'RPKIJ(KP,IP,JP) =',<a name='2688'></font>
<font color=#447700>!    *               KP,IP,JP,RPKIJ(KP,IP,JP),<a name='2689'></font>
<font color=#447700>!    *               PKIJ(KP,IP,JP)<a name='2690'></font>
               ENDDO<a name='2691'>
            ENDDO<a name='2692'>
<font color=#447700>!           READ(6,*)<a name='2693'></font>
         ENDDO<a name='2694'>
	CLOSE(hujisbm_unit1)<a name='2695'>
<font color=#447700>!        WRITE (*,*) '              FILE QKJ:  ', FILENAME_Q<a name='2696'></font>
        END IF<a name='2697'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_273"> (PKIJ  , size ( PKIJ ) * DWORDSIZE )<a name='2698'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2699'>
          DO i = 31,99<a name='2700'>
            INQUIRE ( i , OPENED = opened )<a name='2701'>
            IF ( .NOT. opened ) THEN<a name='2702'>
              hujisbm_unit1 = i<a name='2703'>
              GOTO 2062<a name='2704'>
            ENDIF<a name='2705'>
          ENDDO<a name='2706'>
          hujisbm_unit1 = -1<a name='2707'>
 2062     CONTINUE<a name='2708'>
        ENDIF<a name='2709'>
<font color=#447700>!<a name='2710'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_274"> ( hujisbm_unit1 , IWORDSIZE )<a name='2711'>
<font color=#447700>!<a name='2712'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2713'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_785"> ( 'module_mp_full: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2714'>
        ENDIF<a name='2715'>
<font color=#447700>!<a name='2716'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2717'>
          OPEN(UNIT=hujisbm_unit1,FILE="coeff_q.asc",                  &amp;<a name='2718'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2719'>
<a name='2720'>
         DO K=1,KE<a name='2721'>
            DO J=1,JE<a name='2722'>
               READ(hujisbm_unit1,'(2I6,1E16.8)') KQ,JQ,QKJ(KQ,JQ)<a name='2723'>
<font color=#447700>!              WRITE(6,*) KQ,JQ,QKJ(KQ,JQ)<a name='2724'></font>
<font color=#447700>!              QKJ(KQ,JQ) = RQKJ(KQ,JQ)<a name='2725'></font>
<font color=#447700>!              IF(QKJ(KQ,JQ).LE.1E-35)QKJ(KQ,JQ)=0.D0<a name='2726'></font>
            ENDDO<a name='2727'>
         ENDDO<a name='2728'>
         CLOSE(hujisbm_unit1)<a name='2729'>
<a name='2730'>
         WRITE (*,*) 'COLL_BREAKUP READ: ... OK'<a name='2731'>
         END IF<a name='2732'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_275"> (QKJ  , size ( QKJ ) * DWORDSIZE )<a name='2733'>
<font color=#447700>!     ENDIF<a name='2734'></font>
<font color=#447700>!        DO K=1,KE<a name='2735'></font>
<font color=#447700>!           DO J=1,JE<a name='2736'></font>
<font color=#447700>!              WRITE(6,*) 'After Broadcast, QKJ = ',K,J,QKJ(K,J)<a name='2737'></font>
<font color=#447700>!           ENDDO<a name='2738'></font>
<font color=#447700>!        ENDDO<a name='2739'></font>
<font color=#447700>!        DO K=1,KE<a name='2740'></font>
<font color=#447700>!           DO I=1,IE<a name='2741'></font>
<font color=#447700>!              DO J=1,I<a name='2742'></font>
<font color=#447700>!                 WRITE(6,*)'After Broadcast PKIJ(K,I,J) =', &amp;<a name='2743'></font>
<font color=#447700>!    &amp;               K,I,J,PKIJ(K,I,J)<a name='2744'></font>
<font color=#447700>!              ENDDO<a name='2745'></font>
<font color=#447700>!           ENDDO<a name='2746'></font>
<font color=#447700>!        ENDDO<a name='2747'></font>
      DO I=1,JMAX<a name='2748'>
         DO J=1,JMAX<a name='2749'>
              ECOALMASSM(I,J)=1.0D0<a name='2750'>
         ENDDO<a name='2751'>
      ENDDO<a name='2752'>
<a name='2753'>
      DO I=1,JMAX<a name='2754'>
         DO J=1,JMAX<a name='2755'>
           ECOALMASSM(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALMASS'>ECOALMASS</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALMASS_2">(XL(I),XL(J))<a name='2756'>
         ENDDO<a name='2757'>
      ENDDO<a name='2758'>
      RETURN<a name='2759'>
2070  continue<a name='2760'>
      WRITE( errmess , '(A,I4)' )                                        &amp;<a name='2761'>
       'module_mp_full: error opening hujisbm_DATA on unit '          &amp;<a name='2762'>
     &amp;, hujisbm_unit1<a name='2763'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_786">(errmess)<a name='2764'>
      END SUBROUTINE BREAKINIT<a name='2765'>
<a name='2766'>
<A NAME='ECOALMASS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALMASS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2767'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALMASS</font>(ETA,KSI) <A href='../../call_to/ECOALMASS.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALMASS.html' TARGET='index'>2</A><a name='2768'>
      IMPLICIT NONE<a name='2769'>
<font color=#447700>!     REAL ECOALMASS<a name='2770'></font>
      REAL PI<a name='2771'>
      PARAMETER (PI = 3.1415927)<a name='2772'>
<a name='2773'>
      REAL ETA,KSI<a name='2774'>
      REAL KPI,RHO<a name='2775'>
      REAL DETA,DKSI<a name='2776'>
<a name='2777'>
      PARAMETER (RHO  = 1.0)<a name='2778'>
<a name='2779'>
<font color=#447700>!     REAL ECOALDIAM<a name='2780'></font>
<font color=#447700>!     EXTERNAL ECOALDIAM<a name='2781'></font>
<a name='2782'>
      KPI = 6./PI<a name='2783'>
<a name='2784'>
      DETA = (KPI*ETA/RHO)**(1./3.)<a name='2785'>
      DKSI = (KPI*KSI/RHO)**(1./3.)<a name='2786'>
<a name='2787'>
      ECOALMASS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALDIAM'>ECOALDIAM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALMASS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALDIAM_2">(DETA,DKSI)<a name='2788'>
<a name='2789'>
      RETURN<a name='2790'>
      END FUNCTION ECOALMASS<a name='2791'>
<a name='2792'>
<a name='2793'>
<font color=#447700>!------------------------------------------------<a name='2794'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY AS FUNC OF DIAMETERS<a name='2795'></font>
<font color=#447700>!------------------------------------------------<a name='2796'></font>
<a name='2797'>
<A NAME='ECOALDIAM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALDIAM' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2798'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALDIAM</font>(DETA,DKSI) <A href='../../call_to/ECOALDIAM.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALDIAM.html' TARGET='index'>2</A><a name='2799'>
<font color=#447700>!     IMPLICIT NONE<a name='2800'></font>
<a name='2801'>
      INTEGER N<a name='2802'>
      REAL DETA,DKSI<a name='2803'>
      REAL DGR,DKL,RGR,RKL,P,Q,E,X,Y,QMIN,QMAX<a name='2804'>
      REAL ZERO,ONE,EPS,PI<a name='2805'>
<a name='2806'>
      PARAMETER (ZERO = 0.0)<a name='2807'>
      PARAMETER (ONE  = 1.0)<a name='2808'>
      PARAMETER (EPS  = 1.0E-30)<a name='2809'>
      PARAMETER (PI   = 3.1415927)<a name='2810'>
<a name='2811'>
<font color=#447700>!     REAL   ECOALLOWLIST,ECOALOCHS<a name='2812'></font>
<font color=#447700>!     EXTERNAL ECOALLOWLIST,ECOALOCHS<a name='2813'></font>
<a name='2814'>
      DGR = MAX(DETA,DKSI)<a name='2815'>
      DKL = MIN(DETA,DKSI)<a name='2816'>
<a name='2817'>
      RGR = 0.5*DGR<a name='2818'>
      RKL = 0.5*DKL<a name='2819'>
<a name='2820'>
      P = (RKL / RGR)<a name='2821'>
      Q = (RKL * RGR)**0.5<a name='2822'>
      Q = 0.5 * (RKL + RGR)<a name='2823'>
<a name='2824'>
      qmin = 250e-4<a name='2825'>
      qmax = 400e-4        <a name='2826'>
      if (q.lt.qmin) then<a name='2827'>
         e = max(ecoalOchs(Dgr,Dkl),ecoalBeard(Dgr,Dkl)) <a name='2828'>
      elseif (q.ge.qmin.and.q.lt.qmax) then<a name='2829'>
         x = (q - qmin) / (qmax - qmin)<a name='2830'>
         e = sin(pi/2.0*x)**2 * ecoalLowList(Dgr,Dkl) &amp;<a name='2831'>
     &amp;     + sin(pi/2.0*(1 - x))**2 * ecoalOchs(Dgr,Dkl)<a name='2832'>
      elseif (q.ge.qmax) then<a name='2833'>
         e = <A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALLOWLIST'>ecoalLowList</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALDIAM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALLOWLIST_2">(Dgr,Dkl)<a name='2834'>
      else<a name='2835'>
         e  = 1.0<a name='2836'>
      endif<a name='2837'>
<a name='2838'>
      ECOALDIAM  = MAX(MIN(ONE,E),EPS)<a name='2839'>
<a name='2840'>
      RETURN<a name='2841'>
      END FUNCTION  ECOALDIAM<a name='2842'>
<a name='2843'>
<font color=#447700>!--------------------------------------------------<a name='2844'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY (LOW&amp;LIST)<a name='2845'></font>
<font color=#447700>!--------------------------------------------------<a name='2846'></font>
<a name='2847'>
<A NAME='ECOALLOWLIST'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALLOWLIST' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2848'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALLOWLIST</font>(DGR,DKL) <A href='../../call_to/ECOALLOWLIST.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALLOWLIST.html' TARGET='index'>2</A><a name='2849'>
      IMPLICIT NONE<a name='2850'>
<font color=#447700>!     REAL ecoallowlist<a name='2851'></font>
      REAL PI,SIGMA,KA,KB,EPSI<a name='2852'>
      REAL DGR,DKL,RGR,RKL,X<a name='2853'>
      REAL ST,SC,ET,DSTSC,CKE,W1,W2,DC,ECL<a name='2854'>
      REAL QQ0,QQ1,QQ2<a name='2855'>
<a name='2856'>
      PARAMETER (EPSI=1.E-20)<a name='2857'>
<a name='2858'>
      PI = 3.1415927<a name='2859'>
      SIGMA = 72.8<a name='2860'>
      KA = 0.778<a name='2861'>
      KB = 2.61E-4<a name='2862'>
<a name='2863'>
      RGR = 0.5*DGR<a name='2864'>
      RKL = 0.5*DKL<a name='2865'>
<a name='2866'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY'>COLLENERGY</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALLOWLIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLENERGY_2">(DGR,DKL,CKE,ST,SC,W1,W2,DC)<a name='2867'>
<a name='2868'>
      DSTSC = ST-SC<a name='2869'>
      ET = CKE+DSTSC<a name='2870'>
      IF (ET .LT. 50.0) THEN<a name='2871'>
         QQ0=1.0+(DKL/DGR)<a name='2872'>
         QQ1=KA/QQ0**2<a name='2873'>
         QQ2=KB*SIGMA*(ET**2)/(SC+EPSI)<a name='2874'>
         ECL=QQ1*EXP(-QQ2)<a name='2875'>
      ELSE<a name='2876'>
         ECL=0.0<a name='2877'>
      ENDIF<a name='2878'>
<a name='2879'>
      ECOALLOWLIST = ECL<a name='2880'>
<a name='2881'>
      RETURN<a name='2882'>
      END FUNCTION ECOALLOWLIST<a name='2883'>
<a name='2884'>
<font color=#447700>!--------------------------------------------------<a name='2885'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY (BEARD AND OCHS)<a name='2886'></font>
<font color=#447700>!--------------------------------------------------<a name='2887'></font>
<a name='2888'>
<A NAME='ECOALOCHS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALOCHS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2889'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALOCHS</font>(D_L,D_S)<a name='2890'>
      IMPLICIT NONE<a name='2891'>
<font color=#447700>!     real ecoalochs<a name='2892'></font>
      REAL D_L,D_S<a name='2893'>
      REAL PI,SIGMA,N_W,R_S,R_L,DV,P,G,X,E<a name='2894'>
<font color=#447700>!      REAL VTBEARD,EPSF,FPMIN<a name='2895'></font>
      REAL EPSF,FPMIN<a name='2896'>
<a name='2897'>
<font color=#447700>!     EXTERNAL VTBEARD<a name='2898'></font>
      PARAMETER (EPSF  = 1.E-30)<a name='2899'>
      PARAMETER (FPMIN = 1.E-30)<a name='2900'>
<a name='2901'>
      PI = 3.1415927<a name='2902'>
      SIGMA = 72.8<a name='2903'>
<a name='2904'>
      R_S = 0.5 * D_S<a name='2905'>
      R_L = 0.5 * D_L<a name='2906'>
      P   = R_S / R_L<a name='2907'>
<a name='2908'>
      DV  = ABS(VTBEARD(D_L) - VTBEARD(D_S))<a name='2909'>
      IF (DV.LT.FPMIN) DV = FPMIN<a name='2910'>
      N_W = R_S * DV**2 / SIGMA<a name='2911'>
      G   = 2**(3./2.)/(6.*PI) * P**4 * (1.+ P) / ((1.+P**2)*(1.+P**3))<a name='2912'>
      X   = N_W**(0.5) * G<a name='2913'>
      E   = 0.767 - 10.14 * X<a name='2914'>
<a name='2915'>
      ECOALOCHS = E<a name='2916'>
<a name='2917'>
      RETURN<a name='2918'>
      END FUNCTION ECOALOCHS<a name='2919'>
<a name='2920'>
<font color=#447700>!-----------------------------------------<a name='2921'></font>
<font color=#447700>!     CALCULATING THE COLLISION ENERGY<a name='2922'></font>
<font color=#447700>!-----------------------------------------<a name='2923'></font>
<a name='2924'>
<A NAME='COLLENERGY'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2925'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>COLLENERGY</font>(DGR,DKL,CKE,ST,SC,W1,W2,DC) <A href='../../call_to/COLLENERGY.html' TARGET='index'>2</A>,<A href='../../call_from/COLLENERGY.html' TARGET='index'>4</A><a name='2926'>
<font color=#447700>!     IMPLICIT NONE<a name='2927'></font>
<a name='2928'>
      REAL DGR,DKL,DC<a name='2929'>
      REAL K10,PI,SIGMA,RHO<a name='2930'>
      REAL CKE,W1,W2,ST,SC<a name='2931'>
      REAL DGKA3,DGKB3,DGKA2<a name='2932'>
      REAL V1,V2,DV<a name='2933'>
<font color=#447700>!     REAL VTBEARD,EPSF,FPMIN<a name='2934'></font>
      REAL EPSF,FPMIN<a name='2935'>
<a name='2936'>
<font color=#447700>!     EXTERNAL VTBEARD<a name='2937'></font>
      PARAMETER (EPSF  = 1.E-30)<a name='2938'>
      PARAMETER (FPMIN = 1.E-30)<a name='2939'>
<a name='2940'>
      PI    = 3.1415927<a name='2941'>
      RHO   = 1.0<a name='2942'>
      SIGMA = 72.8<a name='2943'>
<a name='2944'>
      K10=RHO*PI/12.0D0<a name='2945'>
<a name='2946'>
      DGR = MAX(DGR,EPSF)<a name='2947'>
      DKL = MAX(DKL,EPSF)<a name='2948'>
<a name='2949'>
      DGKA2=(DGR**2)+(DKL**2)<a name='2950'>
<a name='2951'>
      DGKA3=(DGR**3)+(DKL**3)<a name='2952'>
<a name='2953'>
      IF (DGR.NE.DKL) THEN<a name='2954'>
         V1 = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VTBEARD'>VTBEARD</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VTBEARD_3">(DGR)<a name='2955'>
         V2 = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VTBEARD'>VTBEARD</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VTBEARD_4">(DKL)<a name='2956'>
         DV = (V1-V2)<a name='2957'>
         IF (DV.LT.FPMIN) DV = FPMIN<a name='2958'>
         DV = DV**2<a name='2959'>
         IF (DV.LT.FPMIN) DV = FPMIN<a name='2960'>
         DGKB3=(DGR**3)*(DKL**3)<a name='2961'>
         CKE = K10 * DV * DGKB3/DGKA3<a name='2962'>
      ELSE<a name='2963'>
         CKE = 0.0D0<a name='2964'>
      ENDIF<a name='2965'>
      ST = PI*SIGMA*DGKA2<a name='2966'>
      SC = PI*SIGMA*DGKA3**(2./3.)<a name='2967'>
<a name='2968'>
      W1=CKE/(SC+EPSF)<a name='2969'>
      W2=CKE/(ST+EPSF)<a name='2970'>
<a name='2971'>
      DC=DGKA3**(1./3.)<a name='2972'>
<a name='2973'>
      RETURN<a name='2974'>
      END SUBROUTINE COLLENERGY<a name='2975'>
<a name='2976'>
<font color=#447700>!--------------------------------------------------<a name='2977'></font>
<font color=#447700>!     CALCULATING TERMINAL VELOCITY (BEARD-FORMULA)<a name='2978'></font>
<font color=#447700>!--------------------------------------------------<a name='2979'></font>
<a name='2980'>
<A NAME='VTBEARD'><A href='../../html_code/phys/module_mp_full_sbm.F.html#VTBEARD' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2981'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>VTBEARD</font>(DIAM) <A href='../../call_to/VTBEARD.html' TARGET='index'>4</A><a name='2982'>
      IMPLICIT NONE<a name='2983'>
<font color=#447700>!     REAL VTBEARD<a name='2984'></font>
<a name='2985'>
      REAL DIAM,AA<a name='2986'>
      REAL ROP,RU,AMT,PP,RL,TT,ETA,DENS,CD,D,A<a name='2987'>
      REAL ALA,GR,SI,BOND,PART,XX,YY,RE,VT<a name='2988'>
      REAL B00,B11,B22,B33,B44,B55,B0,B1,B2,B3,B4,B5,B6<a name='2989'>
      INTEGER ID<a name='2990'>
<a name='2991'>
      DATA B00,B11,B22,B33,B44,B55,B0,B1,B2,B3,B4,B5,B6/-5.00015, &amp;<a name='2992'>
     &amp;5.23778,-2.04914,.475294,-.0542819,.00238449,-3.18657,.992696, &amp;<a name='2993'>
     &amp;-.153193E-2,-.987059E-3,-.578878E-3,.855176E-4,-.327815E-5/<a name='2994'>
<a name='2995'>
      AA   = DIAM/2.0<a name='2996'>
      ROP  = 1.0<a name='2997'>
      RU   = 8.3144E+7<a name='2998'>
      AMT  = 28.9644<a name='2999'>
      ID   = 10000<a name='3000'>
      PP   = FLOAT(ID)*100.<a name='3001'>
      RL   = RU/AMT<a name='3002'>
      TT   = 283.15<a name='3003'>
      ETA  = (1.718+.0049*(TT-273.15))*1.E-4<a name='3004'>
      DENS = PP/TT/RL<a name='3005'>
      ALA  = 6.6E-6*1.01325E+6/PP*TT/293.15<a name='3006'>
      GR   = 979.69<a name='3007'>
      SI   = 76.1-.155*(TT-273.15)<a name='3008'>
<a name='3009'>
      IF (AA.GT.500.E-4) THEN<a name='3010'>
         BOND = GR*(ROP-DENS)*AA*AA/SI<a name='3011'>
         PART = (SI**3*DENS*DENS/(ETA**4*GR*(ROP-DENS)))**(1./6.)<a name='3012'>
         XX = LOG(16./3.*BOND*PART)<a name='3013'>
         YY = B00+B11*XX+B22*XX*XX+B33*XX**3+B44*XX**4+B55*XX**5<a name='3014'>
         RE = PART*EXP(YY)<a name='3015'>
         VT = ETA*RE/2./DENS/AA<a name='3016'>
      ELSEIF (AA.GT.1.E-3) THEN<a name='3017'>
         CD = 32.*AA*AA*AA*(ROP-DENS)*DENS*GR/3./ETA/ETA<a name='3018'>
         XX = LOG(CD)<a name='3019'>
         RE = EXP(B0+B1*XX+B2*XX*XX+B3*XX**3+B4*XX**4+B5*XX**5+B6*XX**6)<a name='3020'>
         D  = CD/RE/24.-1.<a name='3021'>
         VT = ETA*RE/2./DENS/AA<a name='3022'>
      ELSE<a name='3023'>
         A  = 1.+1.26*ALA/AA<a name='3024'>
         A  = A*2.*AA*AA*GR*(ROP-DENS)/9./ETA<a name='3025'>
         CD = 12*ETA/A/AA/DENS<a name='3026'>
         VT = A<a name='3027'>
      ENDIF<a name='3028'>
<a name='3029'>
      VTBEARD = VT<a name='3030'>
<a name='3031'>
      RETURN<a name='3032'>
      END FUNCTION VTBEARD<a name='3033'>
<a name='3034'>
<a name='3035'>
      <a name='3036'>
<font color=#447700>!-------------------------------------------------- <a name='3037'></font>
<font color=#447700>!     Function f. Coalescence-Efficiency <a name='3038'></font>
<font color=#447700>!     Eq. (7) of Beard and Ochs (1995)<a name='3039'></font>
<font color=#447700>!--------------------------------------------------      <a name='3040'></font>
 <a name='3041'>
<A NAME='ECOALBEARD'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALBEARD' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3042'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ecoalBeard</font>(D_l,D_s) ,<A href='../../call_from/ECOALBEARD.html' TARGET='index'>2</A><a name='3043'>
       <a name='3044'>
      IMPLICIT NONE <a name='3045'>
<font color=#447700>!     REAL ecoalBeard<a name='3046'></font>
<font color=#447700>!     REAL ECOALMASS<a name='3047'></font>
      REAL            D_l,D_s<a name='3048'>
      REAL            R_s,R_l<a name='3049'>
      REAL            rcoeff<a name='3050'>
      REAL epsf<a name='3051'>
      PARAMETER (epsf  = 1.e-30) <a name='3052'>
<a name='3053'>
      INTEGER its<a name='3054'>
      COMPLEX acoeff(4),x<a name='3055'>
<a name='3056'>
      R_s = 0.5 * D_s<a name='3057'>
      R_l = 0.5 * D_l      <a name='3058'>
<a name='3059'>
      rcoeff = 5.07 - log(R_s*1e4) - log(R_l*1e4/200.0)<a name='3060'>
<a name='3061'>
      acoeff(1) = CMPLX(rcoeff)<a name='3062'>
      acoeff(2) = CMPLX(-5.94)<a name='3063'>
      acoeff(3) = CMPLX(+7.27)<a name='3064'>
      acoeff(4) = CMPLX(-5.29)<a name='3065'>
<a name='3066'>
      x = (0.50,0)<a name='3067'>
<a name='3068'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#LAGUER'>LAGUER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALBEARD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LAGUER_2">(acoeff,3,x,its)<a name='3069'>
<a name='3070'>
      EcoalBeard = REAL(x)<a name='3071'>
<a name='3072'>
      RETURN <a name='3073'>
      END FUNCTION ecoalBeard <a name='3074'>
<a name='3075'>
<font color=#447700>!--------------------------------------------------       <a name='3076'></font>
<a name='3077'>
<A NAME='LAGUER'><A href='../../html_code/phys/module_mp_full_sbm.F.html#LAGUER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3078'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>laguer</font>(a,m,x,its) <A href='../../call_to/LAGUER.html' TARGET='index'>2</A><a name='3079'>
      INTEGER m,its,MAXIT,MR,MT<a name='3080'>
      REAL EPSS<a name='3081'>
      COMPLEX a(m+1),x<a name='3082'>
      PARAMETER (EPSS=2.e-7,MR=8,MT=10,MAXIT=MT*MR)<a name='3083'>
      INTEGER iter,j<a name='3084'>
      REAL abx,abp,abm,err,frac(MR)<a name='3085'>
      COMPLEX dx,x1,b,d,f,g,h,sq,gp,gm,g2<a name='3086'>
      SAVE frac<a name='3087'>
      DATA frac /.5,.25,.75,.13,.38,.62,.88,1./<a name='3088'>
      do 12 iter=1,MAXIT<a name='3089'>
        its=iter<a name='3090'>
        b=a(m+1)<a name='3091'>
        err=abs(b)<a name='3092'>
        d=cmplx(0.,0.)<a name='3093'>
        f=cmplx(0.,0.)<a name='3094'>
        abx=abs(x)<a name='3095'>
        do 11 j=m,1,-1<a name='3096'>
          f=x*f+d<a name='3097'>
          d=x*d+b<a name='3098'>
          b=x*b+a(j)<a name='3099'>
          err=abs(b)+abx*err<a name='3100'>
11      continue<a name='3101'>
        err=EPSS*err<a name='3102'>
        if(abs(b).le.err) then<a name='3103'>
          return<a name='3104'>
        else<a name='3105'>
          g=d/b<a name='3106'>
          g2=g*g<a name='3107'>
          h=g2-2.*f/b<a name='3108'>
          sq=sqrt((m-1)*(m*h-g2))<a name='3109'>
          gp=g+sq<a name='3110'>
          gm=g-sq<a name='3111'>
          abp=abs(gp)<a name='3112'>
          abm=abs(gm)<a name='3113'>
          if(abp.lt.abm) gp=gm<a name='3114'>
          if (max(abp,abm).gt.0.) then<a name='3115'>
            dx=m/gp<a name='3116'>
          else<a name='3117'>
            dx=exp(cmplx(log(1.+abx),float(iter)))<a name='3118'>
          endif<a name='3119'>
        endif<a name='3120'>
        x1=x-dx<a name='3121'>
        if(x.eq.x1)return<a name='3122'>
        if (mod(iter,MT).ne.0) then<a name='3123'>
          x=x1<a name='3124'>
        else<a name='3125'>
          x=x-dx*frac(iter/MT)<a name='3126'>
        endif<a name='3127'>
12    continue<a name='3128'>
      pause 'too many iterations in laguer'<a name='3129'>
      return<a name='3130'>
      END SUBROUTINE laguer<a name='3131'>
<a name='3132'>
<a name='3133'>
<a name='3134'>
<a name='3135'>
<A NAME='COURANT_BOTT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COURANT_BOTT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3136'>
      <font color=#993300>subroutine </font><font color=#cc0000>courant_bott</font> <A href='../../call_to/COURANT_BOTT.html' TARGET='index'>2</A><a name='3137'>
      implicit none<a name='3138'>
      integer k,kk,j,i<a name='3139'>
      double precision x0<a name='3140'>
<font color=#447700>! ima(i,j) - k-category number,<a name='3141'></font>
<font color=#447700>! chucm(i,j)   - courant number :<a name='3142'></font>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='3143'></font>
<a name='3144'>
<a name='3145'>
<font color=#447700>!================================================================<a name='3146'></font>
<font color=#447700>! BARRY     <a name='3147'></font>
<font color=#447700>!     print*,'dlnr in courant_bott = ',dlnr<a name='3148'></font>
      xl_mg(0)=xl_mg(1)/2<a name='3149'>
<font color=#447700>! BARRY<a name='3150'></font>
      do i=1,nkr<a name='3151'>
         do j=i,nkr<a name='3152'>
            x0=xl_mg(i)+xl_mg(j)<a name='3153'>
            do k=j,nkr<a name='3154'>
               kk=k<a name='3155'>
<font color=#447700>!              if (k.eq.1)then<a name='3156'></font>
<font color=#447700>!                  print*,'xl_mg(k) = ',xl_mg(k)<a name='3157'></font>
<font color=#447700>!                  print*,'x0 = ',x0<a name='3158'></font>
<font color=#447700>! xl_mg(k) =   3.351000000000000E-008<a name='3159'></font>
<font color=#447700>!  x0 =   6.702000000000000E-008<a name='3160'></font>
<font color=#447700>!		   read (6,*)<a name='3161'></font>
<font color=#447700>!              end if<a name='3162'></font>
               if(xl_mg(k).ge.x0.and.xl_mg(k-1).lt.x0) then<a name='3163'>
                 chucm(i,j)=dlog(x0/xl_mg(k-1))/(3.d0*dlnr)<a name='3164'>
 102             continue<a name='3165'>
                 if(chucm(i,j).gt.1.-1.d-08) then<a name='3166'>
                   chucm(i,j)=0.<a name='3167'>
                   kk=kk+1<a name='3168'>
                 endif<a name='3169'>
                 ima(i,j)=min(nkr-1,kk-1)<a name='3170'>
<a name='3171'>
                 goto 2000<a name='3172'>
               endif<a name='3173'>
            enddo<a name='3174'>
 2000       continue<a name='3175'>
<font color=#447700>!            if(i.eq.nkr.or.j.eq.nkr) ima(i,j)=nkr<a name='3176'></font>
            chucm(j,i)=chucm(i,j)<a name='3177'>
            ima(j,i)=ima(i,j)<a name='3178'>
         enddo<a name='3179'>
      enddo<a name='3180'>
      return<a name='3181'>
      end subroutine courant_bott<a name='3182'>
<a name='3183'>
<a name='3184'>
<A NAME='KERNALS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3185'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>KERNALS</font>(DTIME) <A href='../../call_to/KERNALS.html' TARGET='index'>6</A>,<A href='../../call_from/KERNALS.html' TARGET='index'>2</A><a name='3186'>
<font color=#447700>! KHAIN30/07/99<a name='3187'></font>
      IMPLICIT NONE<a name='3188'>
      INTEGER I,J<a name='3189'>
      REAL PI<a name='3190'>
<font color=#447700>!******************************************************************<a name='3191'></font>
      data pi/3.141592654/<a name='3192'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='3193'></font>
<font color=#447700>! dlnr - logarithmic grid distance<a name='3194'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='3195'></font>
<font color=#447700>! cw*(i,j) (in cm**3) - multiply help kernel with constant <a name='3196'></font>
<font color=#447700>! timestep(dt) and logarithmic grid distance(dlnr) :<a name='3197'></font>
        REAL DTIME<a name='3198'>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='3199'></font>
<font color=#447700>!       dlnr=dlog(2.d0)/(3.d0*scal)<a name='3200'></font>
<font color=#447700>! scal is micro.prm file parameter(scal=1.d0 for x(k+1)=x(k)*2)<a name='3201'></font>
<font color=#447700>! calculation of cw*(i,j) (in cm**3) - multiply help kernel <a name='3202'></font>
<font color=#447700>! with constant timestep(dtime) and logarithmic grid distance(dlnr) :<a name='3203'></font>
<font color=#447700>!     print*,'dlnr in kernal = ',dlnr,dtime<a name='3204'></font>
        DO I=1,NKR<a name='3205'>
           DO J=1,NKR<a name='3206'>
              CWLL_1000MB(I,J)=DTIME*DLNR*YWLL_1000MB(I,J)<a name='3207'>
              CWLL_750MB(I,J)=DTIME*DLNR*YWLL_750MB(I,J)<a name='3208'>
              CWLL_500MB(I,J)=DTIME*DLNR*YWLL_500MB(I,J)<a name='3209'>
<a name='3210'>
              CWLL(I,J)=DTIME*DLNR*YWLL(I,J)<a name='3211'>
              CWLG(I,J)=DTIME*DLNR*YWLG(I,J)<a name='3212'>
              CWLH(I,J)=DTIME*DLNR*YWLH(I,J)<a name='3213'>
<a name='3214'>
<font color=#447700>! barry<a name='3215'></font>
              if (i.le.16.and.j.le.16)then<a name='3216'>
              CWSL(I,J)=0.d0<a name='3217'>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='3218'></font>
              CWSL(i,j)=DTIME*DLNR*YWIL(I,J,2)<a name='3219'>
              CWLS(I,J)=0.d0<a name='3220'>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3221'></font>
              CWLS(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3222'>
              else<a name='3223'>
              CWSL(I,J)=DTIME*DLNR*YWSL(I,J)<a name='3224'>
              CWLS(I,J)=DTIME*DLNR*YWLS(I,J)<a name='3225'>
              end if<a name='3226'>
              CWSS(I,J)=DTIME*DLNR*YWSS(I,J)<a name='3227'>
              CWSG(I,J)=DTIME*DLNR*YWSG(I,J)<a name='3228'>
              CWSH(I,J)=DTIME*DLNR*YWSH(I,J)<a name='3229'>
<a name='3230'>
              CWGL(I,J)=0.8*DTIME*DLNR*YWGL(I,J)<a name='3231'>
              IF(RADXXO(I,6).LT.2.0D-2) THEN<a name='3232'>
                IF(RADXXO(J,1).LT.1.0D-3) THEN<a name='3233'>
                  IF(RADXXO(J,1).GE.7.0D-4) THEN<a name='3234'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/1.5D0<a name='3235'>
                  ELSE<a name='3236'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/3.0D0<a name='3237'>
                  ENDIF<a name='3238'>
                ENDIF<a name='3239'>
              ENDIF<a name='3240'>
              IF(I.LE.14.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='3241'>
<font color=#447700>!             IF(I.LE.17.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='3242'></font>
<font color=#447700>!             IF(I.LE.14.AND.J.LE.14) CWGL(I,J)=0.0D0<a name='3243'></font>
              CWGS(I,J)=DTIME*DLNR*YWGS(I,J)<a name='3244'>
              CWGG(I,J)=DTIME*DLNR*YWGG(I,J)<a name='3245'>
              CWGH(I,J)=DTIME*DLNR*YWGH(I,J)<a name='3246'>
<a name='3247'>
              CWHL(I,J)=DTIME*DLNR*YWHL(I,J)<a name='3248'>
              CWHS(I,J)=DTIME*DLNR*YWHS(I,J)<a name='3249'>
              CWHG(I,J)=DTIME*DLNR*YWHG(I,J)<a name='3250'>
              CWHH(I,J)=DTIME*DLNR*YWHH(I,J)<a name='3251'>
<a name='3252'>
              CWLI_1(I,J)=DTIME*DLNR*YWLI(I,J,1)<a name='3253'>
              CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3254'>
              CWLI_3(I,J)=DTIME*DLNR*YWLI(I,J,3)<a name='3255'>
              <a name='3256'>
              CWIL_1(I,J)=DTIME*DLNR*YWIL(I,J,1)<a name='3257'>
              CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='3258'>
              CWIL_3(I,J)=DTIME*DLNR*YWIL(I,J,3)<a name='3259'>
<a name='3260'>
              CWIS_1(I,J)=DTIME*DLNR*YWIS(I,J,1)<a name='3261'>
              CWIS_2(I,J)=DTIME*DLNR*YWIS(I,J,2)<a name='3262'>
              CWIS_3(I,J)=DTIME*DLNR*YWIS(I,J,3)<a name='3263'>
<a name='3264'>
              CWSI_1(I,J)=DTIME*DLNR*YWSI(I,J,1)<a name='3265'>
              CWSI_2(I,J)=DTIME*DLNR*YWSI(I,J,2)<a name='3266'>
              CWSI_3(I,J)=DTIME*DLNR*YWSI(I,J,3)<a name='3267'>
<a name='3268'>
              CWIG_1(I,J)=DTIME*DLNR*YWIG(I,J,1)<a name='3269'>
              CWIG_2(I,J)=DTIME*DLNR*YWIG(I,J,2)<a name='3270'>
              CWIG_3(I,J)=DTIME*DLNR*YWIG(I,J,3)<a name='3271'>
<a name='3272'>
              CWGI_1(I,J)=DTIME*DLNR*YWGI(I,J,1)<a name='3273'>
              CWGI_2(I,J)=DTIME*DLNR*YWGI(I,J,2)<a name='3274'>
              CWGI_3(I,J)=DTIME*DLNR*YWGI(I,J,3)<a name='3275'>
<a name='3276'>
              CWIH_1(I,J)=DTIME*DLNR*YWIH(I,J,1)<a name='3277'>
              CWIH_2(I,J)=DTIME*DLNR*YWIH(I,J,2)<a name='3278'>
              CWIH_3(I,J)=DTIME*DLNR*YWIH(I,J,3)<a name='3279'>
<a name='3280'>
              CWHI_1(I,J)=DTIME*DLNR*YWHI(I,J,1)<a name='3281'>
              CWHI_2(I,J)=DTIME*DLNR*YWHI(I,J,2)<a name='3282'>
              CWHI_3(I,J)=DTIME*DLNR*YWHI(I,J,3)<a name='3283'>
<font color=#447700>! barry<a name='3284'></font>
              if (i.lt.12.and.j.lt.12)then<a name='3285'>
<a name='3286'>
               CWII_1_1(I,J)=0.D0<a name='3287'>
               CWII_1_2(I,J)=0.D0<a name='3288'>
               CWII_1_3(I,J)=0.D0<a name='3289'>
<a name='3290'>
               CWII_2_1(I,J)=0.D0<a name='3291'>
               CWII_2_2(I,J)=0.D0<a name='3292'>
               CWII_2_3(I,J)=0.D0<a name='3293'>
<a name='3294'>
               CWII_3_1(I,J)=0.D0<a name='3295'>
               CWII_3_2(I,J)=0.D0<a name='3296'>
               CWII_3_3(I,J)=0.D0<a name='3297'>
<font color=#447700>!barry<a name='3298'></font>
              else<a name='3299'>
               CWII_1_1(I,J)=DTIME*DLNR*YWII(I,J,1,1)<a name='3300'>
               CWII_1_2(I,J)=DTIME*DLNR*YWII(I,J,1,2)<a name='3301'>
               CWII_1_3(I,J)=DTIME*DLNR*YWII(I,J,1,3)<a name='3302'>
<a name='3303'>
               CWII_2_1(I,J)=DTIME*DLNR*YWII(I,J,2,1)<a name='3304'>
               CWII_2_2(I,J)=DTIME*DLNR*YWII(I,J,2,2)<a name='3305'>
               CWII_2_3(I,J)=DTIME*DLNR*YWII(I,J,2,3)<a name='3306'>
<a name='3307'>
               CWII_3_1(I,J)=DTIME*DLNR*YWII(I,J,3,1)<a name='3308'>
               CWII_3_2(I,J)=DTIME*DLNR*YWII(I,J,3,2)<a name='3309'>
               CWII_3_3(I,J)=DTIME*DLNR*YWII(I,J,3,3)<a name='3310'>
              end if<a name='3311'>
           ENDDO<a name='3312'>
        ENDDO<a name='3313'>
<font color=#447700>!       GO TO 88<a name='3314'></font>
<font color=#447700>! NEW CHANGES 2.06.01 (BEGIN)<a name='3315'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF'>TURBCOEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TURBCOEF_3"><a name='3316'>
        DO J=1,7<a name='3317'>
           DO I=15,24-J<a name='3318'>
              CWGL(I,J)=0.0D0<a name='3319'>
           ENDDO<a name='3320'>
        ENDDO<a name='3321'>
<font color=#447700>! NEW CHANGES 2.06.01 (END)<a name='3322'></font>
<font color=#447700>! NEW CHANGES 3.02.01 (BEGIN)<a name='3323'></font>
        DO I=1,NKR<a name='3324'>
           DO J=1,NKR<a name='3325'>
              CWLG(J,I)=CWGL(I,J)<a name='3326'>
           ENDDO<a name='3327'>
        ENDDO<a name='3328'>
<font color=#447700>!       print*, 'ICETURB = ',ICETURB<a name='3329'></font>
          DO I=KRMING_GL,KRMAXG_GL<a name='3330'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3331'>
               IF (ICETURB.EQ.1)THEN<a name='3332'>
                CWGL(I,J)=CTURBGL(I,J)*CWGL(I,J)<a name='3333'>
               ELSE<a name='3334'>
                CWGL(I,J)=CWGL(I,J)<a name='3335'>
               END IF<a name='3336'>
             ENDDO<a name='3337'>
          ENDDO<a name='3338'>
          DO I=KRMING_GL,KRMAXG_GL<a name='3339'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3340'>
                CWLG(J,I)=CWGL(I,J)<a name='3341'>
             ENDDO<a name='3342'>
          ENDDO<a name='3343'>
<a name='3344'>
88     CONTINUE<a name='3345'>
	RETURN<a name='3346'>
	END SUBROUTINE KERNALS<a name='3347'>
<a name='3348'>
<A NAME='KERNALS_IN'><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3349'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>KERNALS_IN</font>(DTIME),<A href='../../call_from/KERNALS_IN.html' TARGET='index'>2</A><a name='3350'>
<font color=#447700>! KHAIN30/07/99<a name='3351'></font>
      IMPLICIT NONE<a name='3352'>
      INTEGER I,J<a name='3353'>
      REAL PI<a name='3354'>
<font color=#447700>!******************************************************************<a name='3355'></font>
      data pi/3.141592654/<a name='3356'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='3357'></font>
<font color=#447700>! dlnr - logarithmic grid distance<a name='3358'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='3359'></font>
<font color=#447700>! cw*(i,j) (in cm**3) - multiply help kernel with constant <a name='3360'></font>
<font color=#447700>! timestep(dt) and logarithmic grid distance(dlnr) :<a name='3361'></font>
        REAL DTIME<a name='3362'>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='3363'></font>
<font color=#447700>!       dlnr=dlog(2.d0)/(3.d0*scal)<a name='3364'></font>
<font color=#447700>! scal is micro.prm file parameter(scal=1.d0 for x(k+1)=x(k)*2)<a name='3365'></font>
<font color=#447700>! calculation of cw*(i,j) (in cm**3) - multiply help kernel <a name='3366'></font>
<font color=#447700>! with constant timestep(dtime) and logarithmic grid distance(dlnr) :<a name='3367'></font>
<font color=#447700>!     print*,'dlnr in kernal = ',dlnr,dtime<a name='3368'></font>
        DO I=1,NKR<a name='3369'>
           DO J=1,NKR<a name='3370'>
              CWLL_1000MB(I,J)=DTIME*DLNR*YWLL_1000MB(I,J)<a name='3371'>
              CWLL_750MB(I,J)=DTIME*DLNR*YWLL_750MB(I,J)<a name='3372'>
              CWLL_500MB(I,J)=DTIME*DLNR*YWLL_500MB(I,J)<a name='3373'>
<a name='3374'>
              CWLL(I,J)=DTIME*DLNR*YWLL(I,J)<a name='3375'>
              CWLG(I,J)=DTIME*DLNR*YWLG(I,J)<a name='3376'>
<font color=#447700>!             CWLH(I,J)=DTIME*DLNR*YWLH(I,J)<a name='3377'></font>
<a name='3378'>
<font color=#447700>! barry<a name='3379'></font>
              if (i.le.16.and.j.le.16)then<a name='3380'>
              CWSL(I,J)=0.d0<a name='3381'>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='3382'></font>
              CWSL(i,j)=DTIME*DLNR*YWIL(I,J,2)<a name='3383'>
              CWLS(I,J)=0.d0<a name='3384'>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3385'></font>
              CWLS(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3386'>
              else<a name='3387'>
              CWSL(I,J)=DTIME*DLNR*YWSL(I,J)<a name='3388'>
              CWLS(I,J)=DTIME*DLNR*YWLS(I,J)<a name='3389'>
              end if<a name='3390'>
              CWSS(I,J)=DTIME*DLNR*YWSS(I,J)<a name='3391'>
              CWSG(I,J)=DTIME*DLNR*YWSG(I,J)<a name='3392'>
<font color=#447700>!             CWSH(I,J)=DTIME*DLNR*YWSH(I,J)<a name='3393'></font>
<a name='3394'>
              CWGL(I,J)=0.8*DTIME*DLNR*YWGL(I,J)<a name='3395'>
              IF(RADXXO(I,6).LT.2.0D-2) THEN<a name='3396'>
                IF(RADXXO(J,1).LT.1.0D-3) THEN<a name='3397'>
                  IF(RADXXO(J,1).GE.7.0D-4) THEN<a name='3398'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/1.5D0<a name='3399'>
                  ELSE<a name='3400'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/3.0D0<a name='3401'>
                  ENDIF<a name='3402'>
                ENDIF<a name='3403'>
              ENDIF<a name='3404'>
              IF(I.LE.14.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='3405'>
<font color=#447700>!             IF(I.LE.17.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='3406'></font>
<font color=#447700>!             IF(I.LE.14.AND.J.LE.14) CWGL(I,J)=0.0D0<a name='3407'></font>
              CWGS(I,J)=DTIME*DLNR*YWGS(I,J)<a name='3408'>
              CWGG(I,J)=DTIME*DLNR*YWGG(I,J)<a name='3409'>
<font color=#447700>!             CWGH(I,J)=DTIME*DLNR*YWGH(I,J)<a name='3410'></font>
<a name='3411'>
<font color=#447700>!             CWHL(I,J)=DTIME*DLNR*YWHL(I,J)<a name='3412'></font>
<font color=#447700>!             CWHS(I,J)=DTIME*DLNR*YWHS(I,J)<a name='3413'></font>
<font color=#447700>!             CWHG(I,J)=DTIME*DLNR*YWHG(I,J)<a name='3414'></font>
<font color=#447700>!             CWHH(I,J)=DTIME*DLNR*YWHH(I,J)<a name='3415'></font>
<a name='3416'>
<font color=#447700>!             CWLI_1(I,J)=DTIME*DLNR*YWLI(I,J,1)<a name='3417'></font>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='3418'></font>
<font color=#447700>!             CWLI_3(I,J)=DTIME*DLNR*YWLI(I,J,3)<a name='3419'></font>
              <a name='3420'>
<font color=#447700>!             CWIL_1(I,J)=DTIME*DLNR*YWIL(I,J,1)<a name='3421'></font>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='3422'></font>
<font color=#447700>!             CWIL_3(I,J)=DTIME*DLNR*YWIL(I,J,3)<a name='3423'></font>
<a name='3424'>
<font color=#447700>!             CWIS_1(I,J)=DTIME*DLNR*YWIS(I,J,1)<a name='3425'></font>
<font color=#447700>!             CWIS_2(I,J)=DTIME*DLNR*YWIS(I,J,2)<a name='3426'></font>
<font color=#447700>!             CWIS_3(I,J)=DTIME*DLNR*YWIS(I,J,3)<a name='3427'></font>
<a name='3428'>
<font color=#447700>!             CWSI_1(I,J)=DTIME*DLNR*YWSI(I,J,1)<a name='3429'></font>
<font color=#447700>!             CWSI_2(I,J)=DTIME*DLNR*YWSI(I,J,2)<a name='3430'></font>
<font color=#447700>!             CWSI_3(I,J)=DTIME*DLNR*YWSI(I,J,3)<a name='3431'></font>
<a name='3432'>
<font color=#447700>!             CWIG_1(I,J)=DTIME*DLNR*YWIG(I,J,1)<a name='3433'></font>
<font color=#447700>!             CWIG_2(I,J)=DTIME*DLNR*YWIG(I,J,2)<a name='3434'></font>
<font color=#447700>!             CWIG_3(I,J)=DTIME*DLNR*YWIG(I,J,3)<a name='3435'></font>
<a name='3436'>
<font color=#447700>!             CWGI_1(I,J)=DTIME*DLNR*YWGI(I,J,1)<a name='3437'></font>
<font color=#447700>!             CWGI_2(I,J)=DTIME*DLNR*YWGI(I,J,2)<a name='3438'></font>
<font color=#447700>!             CWGI_3(I,J)=DTIME*DLNR*YWGI(I,J,3)<a name='3439'></font>
<a name='3440'>
<font color=#447700>!             CWIH_1(I,J)=DTIME*DLNR*YWIH(I,J,1)<a name='3441'></font>
<font color=#447700>!             CWIH_2(I,J)=DTIME*DLNR*YWIH(I,J,2)<a name='3442'></font>
<font color=#447700>!             CWIH_3(I,J)=DTIME*DLNR*YWIH(I,J,3)<a name='3443'></font>
<a name='3444'>
<font color=#447700>!             CWHI_1(I,J)=DTIME*DLNR*YWHI(I,J,1)<a name='3445'></font>
<font color=#447700>!             CWHI_2(I,J)=DTIME*DLNR*YWHI(I,J,2)<a name='3446'></font>
<font color=#447700>!             CWHI_3(I,J)=DTIME*DLNR*YWHI(I,J,3)<a name='3447'></font>
<font color=#447700>! barry<a name='3448'></font>
              if (i.lt.12.and.j.lt.12)then<a name='3449'>
<a name='3450'>
<font color=#447700>!              CWII_1_1(I,J)=0.D0<a name='3451'></font>
<font color=#447700>!              CWII_1_2(I,J)=0.D0<a name='3452'></font>
<font color=#447700>!              CWII_1_3(I,J)=0.D0<a name='3453'></font>
<a name='3454'>
<font color=#447700>!              CWII_2_1(I,J)=0.D0<a name='3455'></font>
<font color=#447700>!              CWII_2_2(I,J)=0.D0<a name='3456'></font>
<font color=#447700>!              CWII_2_3(I,J)=0.D0<a name='3457'></font>
<a name='3458'>
<font color=#447700>!              CWII_3_1(I,J)=0.D0<a name='3459'></font>
<font color=#447700>!              CWII_3_2(I,J)=0.D0<a name='3460'></font>
<font color=#447700>!              CWII_3_3(I,J)=0.D0<a name='3461'></font>
<font color=#447700>!barry<a name='3462'></font>
              else<a name='3463'>
<font color=#447700>!              CWII_1_1(I,J)=DTIME*DLNR*YWII(I,J,1,1)<a name='3464'></font>
<font color=#447700>!              CWII_1_2(I,J)=DTIME*DLNR*YWII(I,J,1,2)<a name='3465'></font>
<font color=#447700>!              CWII_1_3(I,J)=DTIME*DLNR*YWII(I,J,1,3)<a name='3466'></font>
<a name='3467'>
<font color=#447700>!              CWII_2_1(I,J)=DTIME*DLNR*YWII(I,J,2,1)<a name='3468'></font>
<font color=#447700>!              CWII_2_2(I,J)=DTIME*DLNR*YWII(I,J,2,2)<a name='3469'></font>
<font color=#447700>!              CWII_2_3(I,J)=DTIME*DLNR*YWII(I,J,2,3)<a name='3470'></font>
<a name='3471'>
<font color=#447700>!              CWII_3_1(I,J)=DTIME*DLNR*YWII(I,J,3,1)<a name='3472'></font>
<font color=#447700>!              CWII_3_2(I,J)=DTIME*DLNR*YWII(I,J,3,2)<a name='3473'></font>
<font color=#447700>!              CWII_3_3(I,J)=DTIME*DLNR*YWII(I,J,3,3)<a name='3474'></font>
              end if<a name='3475'>
           ENDDO<a name='3476'>
        ENDDO<a name='3477'>
<font color=#447700>!       GO TO 88<a name='3478'></font>
<font color=#447700>! NEW CHANGES 2.06.01 (BEGIN)<a name='3479'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF'>TURBCOEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TURBCOEF_4"><a name='3480'>
        DO J=1,7<a name='3481'>
           DO I=15,24-J<a name='3482'>
              CWGL(I,J)=0.0D0<a name='3483'>
           ENDDO<a name='3484'>
        ENDDO<a name='3485'>
<font color=#447700>! NEW CHANGES 2.06.01 (END)<a name='3486'></font>
<font color=#447700>! NEW CHANGES 3.02.01 (BEGIN)<a name='3487'></font>
        DO I=1,NKR<a name='3488'>
           DO J=1,NKR<a name='3489'>
              CWLG(J,I)=CWGL(I,J)<a name='3490'>
           ENDDO<a name='3491'>
        ENDDO<a name='3492'>
<font color=#447700>!       print*, 'ICETURB = ',ICETURB<a name='3493'></font>
          DO I=KRMING_GL,KRMAXG_GL<a name='3494'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3495'>
               IF (ICETURB.EQ.1)THEN<a name='3496'>
                CWGL(I,J)=CTURBGL(I,J)*CWGL(I,J)<a name='3497'>
               ELSE<a name='3498'>
                CWGL(I,J)=CWGL(I,J)<a name='3499'>
               END IF<a name='3500'>
             ENDDO<a name='3501'>
          ENDDO<a name='3502'>
          DO I=KRMING_GL,KRMAXG_GL<a name='3503'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3504'>
                CWLG(J,I)=CWGL(I,J)<a name='3505'>
             ENDDO<a name='3506'>
          ENDDO<a name='3507'>
<a name='3508'>
88     CONTINUE<a name='3509'>
	RETURN<a name='3510'>
	END SUBROUTINE KERNALS_IN<a name='3511'>
<A NAME='TURBCOEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3512'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>TURBCOEF</font> <A href='../../call_to/TURBCOEF.html' TARGET='index'>4</A>,<A href='../../call_from/TURBCOEF.html' TARGET='index'>4</A><a name='3513'>
        IMPLICIT NONE<a name='3514'>
        INTEGER I,J<a name='3515'>
<font color=#447700>!       DOUBLE PRECISION X_KERN,Y_KERN,F<a name='3516'></font>
        DOUBLE PRECISION X_KERN,Y_KERN<a name='3517'>
	DOUBLE PRECISION RL_LL(K0_LL),RL_GL(K0L_GL),RG_GL(K0G_GL)<a name='3518'>
          RL_LL(1)=RADXXO(KRMIN_LL,1)*1.E4<a name='3519'>
          RL_LL(2)=10.0D0<a name='3520'>
          RL_LL(3)=20.0D0<a name='3521'>
          RL_LL(4)=30.0D0<a name='3522'>
          RL_LL(5)=40.0D0<a name='3523'>
          RL_LL(6)=50.0D0<a name='3524'>
          RL_LL(7)=60.0D0<a name='3525'>
          RL_LL(8)=RADXXO(KRMAX_LL,1)*1.E4<a name='3526'>
          DO J=1,K0_LL<a name='3527'>
             DO I=1,K0_LL<a name='3528'>
                CTURB_LL(I,J)=1.0D0<a name='3529'>
             ENDDO<a name='3530'>
          ENDDO <a name='3531'>
	  CTURB_LL(1,1)=4.50D0<a name='3532'>
	  CTURB_LL(1,2)=4.50D0<a name='3533'>
	  CTURB_LL(1,3)=3.00D0<a name='3534'>
	  CTURB_LL(1,4)=2.25D0<a name='3535'>
	  CTURB_LL(1,5)=1.95D0<a name='3536'>
	  CTURB_LL(1,6)=1.40D0<a name='3537'>
	  CTURB_LL(1,7)=1.40D0<a name='3538'>
	  CTURB_LL(1,8)=1.40D0<a name='3539'>
<a name='3540'>
	  CTURB_LL(2,1)=4.50D0<a name='3541'>
	  CTURB_LL(2,2)=4.50D0<a name='3542'>
	  CTURB_LL(2,3)=3.00D0<a name='3543'>
	  CTURB_LL(2,4)=2.25D0<a name='3544'>
	  CTURB_LL(2,5)=1.95D0<a name='3545'>
	  CTURB_LL(2,6)=1.40D0<a name='3546'>
	  CTURB_LL(2,7)=1.40D0<a name='3547'>
	  CTURB_LL(2,8)=1.40D0<a name='3548'>
<a name='3549'>
	  CTURB_LL(3,1)=3.00D0<a name='3550'>
	  CTURB_LL(3,2)=3.00D0<a name='3551'>
	  CTURB_LL(3,3)=2.70D0<a name='3552'>
	  CTURB_LL(3,4)=2.25D0<a name='3553'>
	  CTURB_LL(3,5)=1.65D0<a name='3554'>
	  CTURB_LL(3,6)=1.40D0<a name='3555'>
	  CTURB_LL(3,7)=1.40D0<a name='3556'>
	  CTURB_LL(3,8)=1.40D0<a name='3557'>
<a name='3558'>
	  CTURB_LL(4,1)=2.25D0<a name='3559'>
	  CTURB_LL(4,2)=2.25D0<a name='3560'>
	  CTURB_LL(4,3)=2.25D0<a name='3561'>
	  CTURB_LL(4,4)=1.95D0<a name='3562'>
	  CTURB_LL(4,5)=1.65D0<a name='3563'>
	  CTURB_LL(4,6)=1.40D0<a name='3564'>
	  CTURB_LL(4,7)=1.40D0<a name='3565'>
	  CTURB_LL(4,8)=1.40D0<a name='3566'>
<a name='3567'>
	  CTURB_LL(5,1)=1.95D0<a name='3568'>
	  CTURB_LL(5,2)=1.95D0<a name='3569'>
	  CTURB_LL(5,3)=1.65D0<a name='3570'>
	  CTURB_LL(5,4)=1.65D0<a name='3571'>
	  CTURB_LL(5,5)=1.65D0<a name='3572'>
	  CTURB_LL(5,6)=1.40D0<a name='3573'>
	  CTURB_LL(5,7)=1.40D0<a name='3574'>
	  CTURB_LL(5,8)=1.40D0<a name='3575'>
<a name='3576'>
	  CTURB_LL(6,1)=1.40D0<a name='3577'>
	  CTURB_LL(6,2)=1.40D0<a name='3578'>
	  CTURB_LL(6,3)=1.40D0<a name='3579'>
	  CTURB_LL(6,4)=1.40D0<a name='3580'>
	  CTURB_LL(6,5)=1.40D0<a name='3581'>
	  CTURB_LL(6,6)=1.40D0<a name='3582'>
	  CTURB_LL(6,7)=1.40D0<a name='3583'>
	  CTURB_LL(6,8)=1.40D0<a name='3584'>
<a name='3585'>
	  CTURB_LL(7,1)=1.40D0<a name='3586'>
	  CTURB_LL(7,2)=1.40D0<a name='3587'>
	  CTURB_LL(7,3)=1.40D0<a name='3588'>
	  CTURB_LL(7,4)=1.40D0<a name='3589'>
	  CTURB_LL(7,5)=1.40D0<a name='3590'>
	  CTURB_LL(7,6)=1.40D0<a name='3591'>
	  CTURB_LL(7,7)=1.40D0<a name='3592'>
	  CTURB_LL(7,8)=1.40D0<a name='3593'>
<a name='3594'>
	  CTURB_LL(8,1)=1.40D0<a name='3595'>
	  CTURB_LL(8,2)=1.40D0<a name='3596'>
	  CTURB_LL(8,3)=1.40D0<a name='3597'>
	  CTURB_LL(8,4)=1.40D0<a name='3598'>
	  CTURB_LL(8,5)=1.40D0<a name='3599'>
	  CTURB_LL(8,6)=1.40D0<a name='3600'>
	  CTURB_LL(8,7)=1.40D0<a name='3601'>
	  CTURB_LL(8,8)=1.40D0<a name='3602'>
          DO J=1,K0_LL<a name='3603'>
             DO I=1,K0_LL<a name='3604'>
                CTURB_LL(I,J)=(CTURB_LL(I,J)-1.0D0)/1.5D0+1.0D0<a name='3605'>
             ENDDO<a name='3606'>
          ENDDO<a name='3607'>
	  DO I=KRMIN_LL,KRMAX_LL<a name='3608'>
             DO J=KRMIN_LL,KRMAX_LL<a name='3609'>
                CTURBLL(I,J)=1.0D0<a name='3610'>
             ENDDO<a name='3611'>
          ENDDO<a name='3612'>
          DO I=KRMIN_LL,KRMAX_LL<a name='3613'>
             X_KERN=RADXXO(I,1)*1.0D4<a name='3614'>
             IF(X_KERN.LT.RL_LL(1)) X_KERN=RL_LL(1)<a name='3615'>
             IF(X_KERN.GT.RL_LL(K0_LL)) X_KERN=RL_LL(K0_LL) <a name='3616'>
             DO J=KRMIN_LL,KRMAX_LL<a name='3617'>
                Y_KERN=RADXXO(J,1)*1.0D4<a name='3618'>
                IF(Y_KERN.LT.RL_LL(1)) Y_KERN=RL_LL(1)<a name='3619'>
                IF(Y_KERN.GT.RL_LL(K0_LL)) Y_KERN=RL_LL(K0_LL)<a name='3620'>
                CTURBLL(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>F</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_16">(X_KERN,Y_KERN,RL_LL,RL_LL,CTURB_LL &amp;<a name='3621'>
     &amp;                      ,K0_LL,K0_LL)	                         <a name='3622'>
             ENDDO<a name='3623'>
          ENDDO<a name='3624'>
          RL_GL(1) = RADXXO(1,1)*1.E4 <a name='3625'>
          RL_GL(2) = 8.0D0<a name='3626'>
          RL_GL(3) = 10.0D0<a name='3627'>
	  RL_GL(4) = 16.0D0<a name='3628'>
          RL_GL(5) = 20.0D0<a name='3629'>
          RL_GL(6) = 30.0D0<a name='3630'>
          RL_GL(7) = 40.0D0<a name='3631'>
          RL_GL(8) = 50.0D0<a name='3632'>
          RL_GL(9) = 60.0D0<a name='3633'>
          RL_GL(10)= 70.0D0<a name='3634'>
          RL_GL(11)= 80.0D0<a name='3635'>
	  RL_GL(12)= 90.0D0<a name='3636'>
	  RL_GL(13)=100.0D0<a name='3637'>
	  RL_GL(14)=200.0D0<a name='3638'>
	  RL_GL(15)=300.0D0<a name='3639'>
	  RL_GL(16)=RADXXO(24,1)*1.0D4<a name='3640'>
<font color=#447700>! TURBULENCE GRAUPEL BULK RADII IN MKM<a name='3641'></font>
          RG_GL(1) = RADXXO(1,6)*1.0D4 <a name='3642'>
          RG_GL(2) = 30.0D0  <a name='3643'>
          RG_GL(3) = 60.0D0 <a name='3644'>
          RG_GL(4) = 100.0D0 <a name='3645'>
          RG_GL(5) = 200.0D0 <a name='3646'>
	  RG_GL(6) = 300.0D0<a name='3647'>
	  RG_GL(7) = 400.0D0<a name='3648'>
	  RG_GL(8) = 500.0D0<a name='3649'>
	  RG_GL(9) = 600.0D0<a name='3650'>
	  RG_GL(10)= 700.0D0<a name='3651'>
	  RG_GL(11)= 800.0D0<a name='3652'>
	  RG_GL(12)= 900.0D0<a name='3653'>
	  RG_GL(13)=1000.0D0<a name='3654'>
	  RG_GL(14)=2000.0D0<a name='3655'>
	  RG_GL(15)=3000.0D0<a name='3656'>
	  RG_GL(16)=RADXXO(33,6)*1.0D4<a name='3657'>
	  DO I=KRMING_GL,KRMAXG_GL<a name='3658'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3659'>
                CTURBGL(I,J)=1.0D0<a name='3660'>
             ENDDO<a name='3661'>
          ENDDO<a name='3662'>
          DO I=1,K0G_GL<a name='3663'>
             DO J=1,K0L_GL<a name='3664'>
                CTURB_GL(I,J)=1.0D0<a name='3665'>
             ENDDO<a name='3666'>
          ENDDO <a name='3667'>
          IF(IEPS_400.EQ.1) THEN<a name='3668'>
	    CTURB_GL(1,1)=0.0D0<a name='3669'>
	    CTURB_GL(1,2)=0.0D0<a name='3670'>
	    CTURB_GL(1,3)=1.2D0<a name='3671'>
	    CTURB_GL(1,4)=1.3D0<a name='3672'>
	    CTURB_GL(1,5)=1.4D0<a name='3673'>
	    CTURB_GL(1,6)=1.5D0<a name='3674'>
	    CTURB_GL(1,7)=1.5D0<a name='3675'>
	    CTURB_GL(1,8)=1.5D0<a name='3676'>
	    CTURB_GL(1,9)=1.5D0<a name='3677'>
	    CTURB_GL(1,10)=1.5D0<a name='3678'>
	    CTURB_GL(1,11)=1.5D0<a name='3679'>
	    CTURB_GL(1,12)=1.0D0<a name='3680'>
	    CTURB_GL(1,13)=1.0D0<a name='3681'>
	    CTURB_GL(1,14)=1.0D0<a name='3682'>
	    CTURB_GL(1,15)=1.0D0<a name='3683'>
	<a name='3684'>
	    CTURB_GL(2,1)=1.0D0<a name='3685'>
	    CTURB_GL(2,2)=1.4D0<a name='3686'>
	    CTURB_GL(2,3)=1.8D0<a name='3687'>
	    CTURB_GL(2,4)=2.2D0<a name='3688'>
	    CTURB_GL(2,5)=2.6D0<a name='3689'>
	    CTURB_GL(2,6)=3.0D0<a name='3690'>
	    CTURB_GL(2,7)=2.85D0<a name='3691'>
	    CTURB_GL(2,8)=2.7D0<a name='3692'>
	    CTURB_GL(2,9)=2.55D0<a name='3693'>
	    CTURB_GL(2,10)=2.4D0<a name='3694'>
	    CTURB_GL(2,11)=2.25D0<a name='3695'>
	    CTURB_GL(2,12)=1.0D0<a name='3696'>
	    CTURB_GL(2,13)=1.0D0<a name='3697'>
	    CTURB_GL(2,14)=1.0D0<a name='3698'>
<a name='3699'>
	    CTURB_GL(3,1)=7.5D0<a name='3700'>
	    CTURB_GL(3,2)=7.5D0<a name='3701'>
	    CTURB_GL(3,3)=4.5D0	<a name='3702'>
	    CTURB_GL(3,4)=4.5D0	<a name='3703'>
	    CTURB_GL(3,5)=4.65D0	<a name='3704'>
	    CTURB_GL(3,6)=4.65D0	<a name='3705'>
	    CTURB_GL(3,7)=4.5D0	<a name='3706'>
	    CTURB_GL(3,8)=4.5D0	<a name='3707'>
	    CTURB_GL(3,9)=4.0D0	<a name='3708'>
	    CTURB_GL(3,10)=3.0D0	<a name='3709'>
	    CTURB_GL(3,11)=2.0D0	<a name='3710'>
	    CTURB_GL(3,12)=1.5D0	<a name='3711'>
	    CTURB_GL(3,13)=1.3D0	<a name='3712'>
	    CTURB_GL(3,14)=1.0D0	<a name='3713'>
    <a name='3714'>
	    CTURB_GL(4,1)=5.5D0<a name='3715'>
	    CTURB_GL(4,2)=5.5D0<a name='3716'>
	    CTURB_GL(4,3)=4.5D0<a name='3717'>
	    CTURB_GL(4,4)=4.5D0<a name='3718'>
	    CTURB_GL(4,5)=4.65D0<a name='3719'>
	    CTURB_GL(4,6)=4.65D0<a name='3720'>
	    CTURB_GL(4,7)=4.5D0<a name='3721'>
	    CTURB_GL(4,8)=4.5D0<a name='3722'>
	    CTURB_GL(4,9)=4.0D0<a name='3723'>
	    CTURB_GL(4,10)=3.0D0<a name='3724'>
	    CTURB_GL(4,11)=2.0D0<a name='3725'>
	    CTURB_GL(4,12)=1.5D0<a name='3726'>
	    CTURB_GL(4,13)=1.35D0<a name='3727'>
	    CTURB_GL(4,14)=1.0D0<a name='3728'>
	 <a name='3729'>
	    CTURB_GL(5,1)=4.5D0<a name='3730'>
	    CTURB_GL(5,2)=4.5D0<a name='3731'>
	    CTURB_GL(5,3)=3.3D0	<a name='3732'>
	    CTURB_GL(5,4)=3.3D0	<a name='3733'>
	    CTURB_GL(5,5)=3.3D0	<a name='3734'>
	    CTURB_GL(5,6)=3.4D0	<a name='3735'>
	    CTURB_GL(5,7)=3.8D0	<a name='3736'>
	    CTURB_GL(5,8)=3.8D0	<a name='3737'>
	    CTURB_GL(5,9)=3.8D0	<a name='3738'>
	    CTURB_GL(5,10)=3.6D0<a name='3739'>
	    CTURB_GL(5,11)=2.5D0	<a name='3740'>
	    CTURB_GL(5,12)=2.0D0	<a name='3741'>
	    CTURB_GL(5,13)=1.4D0	<a name='3742'>
	    CTURB_GL(5,14)=1.0D0	<a name='3743'>
			 		<a name='3744'>
	    CTURB_GL(6,1)=4.0D0<a name='3745'>
	    CTURB_GL(6,2)=4.0D0<a name='3746'>
	    CTURB_GL(6,3)=2.8D0<a name='3747'>
	    CTURB_GL(6,4)=2.8D0<a name='3748'>
	    CTURB_GL(6,5)=2.85D0<a name='3749'>
	    CTURB_GL(6,6)=2.9D0<a name='3750'>
	    CTURB_GL(6,7)=3.0D0<a name='3751'>
	    CTURB_GL(6,8)=3.1D0<a name='3752'>
	    CTURB_GL(6,9)=2.9D0<a name='3753'>
	    CTURB_GL(6,10)=2.6D0<a name='3754'>
	    CTURB_GL(6,11)=2.5D0<a name='3755'>
	    CTURB_GL(6,12)=2.0D0<a name='3756'>
	    CTURB_GL(6,13)=1.3D0<a name='3757'>
	    CTURB_GL(6,14)=1.1D0<a name='3758'>
<a name='3759'>
	    CTURB_GL(7,1)=3.5D0<a name='3760'>
	    CTURB_GL(7,2)=3.5D0<a name='3761'>
	    CTURB_GL(7,3)=2.5D0<a name='3762'>
	    CTURB_GL(7,4)=2.5D0<a name='3763'>
	    CTURB_GL(7,5)=2.6D0<a name='3764'>
	    CTURB_GL(7,6)=2.7D0<a name='3765'>
	    CTURB_GL(7,7)=2.8D0<a name='3766'>
	    CTURB_GL(7,8)=2.8D0<a name='3767'>
	    CTURB_GL(7,9)=2.8D0<a name='3768'>
	    CTURB_GL(7,10)=2.6D0<a name='3769'>
	    CTURB_GL(7,11)=2.3D0<a name='3770'>
	    CTURB_GL(7,12)=2.0D0<a name='3771'>
	    CTURB_GL(7,13)=1.3D0<a name='3772'>
	    CTURB_GL(7,14)=1.1D0<a name='3773'>
<a name='3774'>
	    CTURB_GL(8,1)=3.25D0<a name='3775'>
	    CTURB_GL(8,2)=3.25D0<a name='3776'>
	    CTURB_GL(8,3)=2.3D0<a name='3777'>
	    CTURB_GL(8,4)=2.3D0<a name='3778'>
	    CTURB_GL(8,5)=2.35D0<a name='3779'>
	    CTURB_GL(8,6)=2.37D0<a name='3780'>
	    CTURB_GL(8,7)=2.55D0<a name='3781'>
	    CTURB_GL(8,8)=2.55D0<a name='3782'>
	    CTURB_GL(8,9)=2.55D0<a name='3783'>
	    CTURB_GL(8,10)=2.3D0<a name='3784'>
	    CTURB_GL(8,11)=2.1D0<a name='3785'>
	    CTURB_GL(8,12)=1.9D0<a name='3786'>
	    CTURB_GL(8,13)=1.3D0<a name='3787'>
	    CTURB_GL(8,14)=1.1D0<a name='3788'>
<a name='3789'>
	    CTURB_GL(9,1)=3.0D0<a name='3790'>
	    CTURB_GL(9,2)=3.0D0<a name='3791'>
	    CTURB_GL(9,3)=3.1D0<a name='3792'>
	    CTURB_GL(9,4)=2.2D0<a name='3793'>
	    CTURB_GL(9,5)=2.2D0<a name='3794'>
	    CTURB_GL(9,6)=2.2D0<a name='3795'>
	    CTURB_GL(9,7)=2.3D0<a name='3796'>
	    CTURB_GL(9,8)=2.3D0<a name='3797'>
	    CTURB_GL(9,9)=2.5D0<a name='3798'>
	    CTURB_GL(9,10)=2.5D0<a name='3799'>
	    CTURB_GL(9,11)=2.2D0<a name='3800'>
	    CTURB_GL(9,12)=1.8D0<a name='3801'>
	    CTURB_GL(9,13)=1.25D0<a name='3802'>
	    CTURB_GL(9,14)=1.1D0<a name='3803'>
<a name='3804'>
	    CTURB_GL(10,1)=2.75D0<a name='3805'>
	    CTURB_GL(10,2)=2.75D0<a name='3806'>
	    CTURB_GL(10,3)=2.0D0<a name='3807'>
	    CTURB_GL(10,4)=2.0D0<a name='3808'>
	    CTURB_GL(10,5)=2.0D0<a name='3809'>
	    CTURB_GL(10,6)=2.1D0<a name='3810'>
	    CTURB_GL(10,7)=2.2D0<a name='3811'>
	    CTURB_GL(10,8)=2.2D0<a name='3812'>
	    CTURB_GL(10,9)=2.3D0<a name='3813'>
	    CTURB_GL(10,10)=2.3D0<a name='3814'>
	    CTURB_GL(10,11)=2.3D0<a name='3815'>
	    CTURB_GL(10,12)=1.8D0<a name='3816'>
	    CTURB_GL(10,13)=1.2D0<a name='3817'>
	    CTURB_GL(10,14)=1.1D0<a name='3818'>
<a name='3819'>
	    CTURB_GL(11,1)=2.6D0<a name='3820'>
	    CTURB_GL(11,2)=2.6D0<a name='3821'>
	    CTURB_GL(11,3)=1.95D0<a name='3822'>
	    CTURB_GL(11,4)=1.95D0<a name='3823'>
	    CTURB_GL(11,5)=1.95D0<a name='3824'>
	    CTURB_GL(11,6)=2.05D0<a name='3825'>
	    CTURB_GL(11,7)=2.15D0<a name='3826'>
	    CTURB_GL(11,8)=2.15D0<a name='3827'>
	    CTURB_GL(11,9)=2.25D0<a name='3828'>
	    CTURB_GL(11,10)=2.25D0<a name='3829'>
	    CTURB_GL(11,11)=1.9D0<a name='3830'>
	    CTURB_GL(11,12)=1.8D0<a name='3831'>
	    CTURB_GL(11,13)=1.2D0<a name='3832'>
	    CTURB_GL(11,14)=1.1D0<a name='3833'>
<a name='3834'>
	    CTURB_GL(12,1)=2.4D0<a name='3835'>
	    CTURB_GL(12,2)=2.4D0<a name='3836'>
	    CTURB_GL(12,3)=1.85D0<a name='3837'>
	    CTURB_GL(12,4)=1.85D0<a name='3838'>
	    CTURB_GL(12,5)=1.85D0<a name='3839'>
	    CTURB_GL(12,6)=1.75D0<a name='3840'>
	    CTURB_GL(12,7)=1.85D0<a name='3841'>
	    CTURB_GL(12,8)=1.85D0<a name='3842'>
	    CTURB_GL(12,9)=2.1D0<a name='3843'>
	    CTURB_GL(12,10)=2.1D0<a name='3844'>
	    CTURB_GL(12,11)=1.9D0<a name='3845'>
	    CTURB_GL(12,12)=1.8D0 <a name='3846'>
	    CTURB_GL(12,13)=1.3D0<a name='3847'>
	    CTURB_GL(12,14)=1.1D0<a name='3848'>
<a name='3849'>
	    CTURB_GL(13,1)=1.67D0<a name='3850'>
	    CTURB_GL(13,2)=1.67D0<a name='3851'>
	    CTURB_GL(13,3)=1.75D0<a name='3852'>
	    CTURB_GL(13,4)=1.83D0<a name='3853'>
	    CTURB_GL(13,5)=1.87D0<a name='3854'>
	    CTURB_GL(13,6)=2.0D0<a name='3855'>
	    CTURB_GL(13,7)=2.1D0<a name='3856'>
	    CTURB_GL(13,8)=2.12D0<a name='3857'>
	    CTURB_GL(13,9)=2.15D0<a name='3858'>
	    CTURB_GL(13,10)=2.18D0<a name='3859'>
	    CTURB_GL(13,11)=2.19D0<a name='3860'>
	    CTURB_GL(13,12)=1.67D0<a name='3861'>
	    CTURB_GL(13,13)=1.28D0<a name='3862'>
	    CTURB_GL(13,14)=1.0D0<a name='3863'>
<a name='3864'>
	    CTURB_GL(14,1)=1.3D0<a name='3865'>
	    CTURB_GL(14,2)=1.3D0<a name='3866'>
	    CTURB_GL(14,3)=1.35D0<a name='3867'>
	    CTURB_GL(14,4)=1.4D0<a name='3868'>
	    CTURB_GL(14,5)=1.6D0<a name='3869'>
	    CTURB_GL(14,6)=1.7D0<a name='3870'>
	    CTURB_GL(14,7)=1.7D0<a name='3871'>
	    CTURB_GL(14,8)=1.7D0<a name='3872'>
	    CTURB_GL(14,9)=1.7D0<a name='3873'>
	    CTURB_GL(14,10)=1.7D0<a name='3874'>
	    CTURB_GL(14,11)=1.7D0<a name='3875'>
	    CTURB_GL(14,12)=1.4D0<a name='3876'>
	    CTURB_GL(14,13)=1.25D0<a name='3877'>
	    CTURB_GL(14,14)=1.0D0<a name='3878'>
<a name='3879'>
	    CTURB_GL(15,1)=1.17D0<a name='3880'>
	    CTURB_GL(15,2)=1.17D0<a name='3881'>
	    CTURB_GL(15,3)=1.17D0<a name='3882'>
	    CTURB_GL(15,4)=1.25D0<a name='3883'>
	    CTURB_GL(15,5)=1.3D0<a name='3884'>
	    CTURB_GL(15,6)=1.35D0<a name='3885'>
	    CTURB_GL(15,7)=1.4D0<a name='3886'>
	    CTURB_GL(15,8)=1.4D0<a name='3887'>
	    CTURB_GL(15,9)=1.45D0<a name='3888'>
	    CTURB_GL(15,10)=1.47D0<a name='3889'>
	    CTURB_GL(15,11)=1.44D0<a name='3890'>
	    CTURB_GL(15,12)=1.3D0<a name='3891'>
	    CTURB_GL(15,13)=1.12D0<a name='3892'>
	    CTURB_GL(15,14)=1.0D0<a name='3893'>
<a name='3894'>
	    CTURB_GL(16,1)=1.17D0<a name='3895'>
	    CTURB_GL(16,2)=1.17D0<a name='3896'>
	    CTURB_GL(16,3)=1.17D0<a name='3897'>
	    CTURB_GL(16,4)=1.25D0<a name='3898'>
	    CTURB_GL(16,5)=1.3D0<a name='3899'>
	    CTURB_GL(16,6)=1.35D0<a name='3900'>
	    CTURB_GL(16,7)=1.4D0<a name='3901'>
	    CTURB_GL(16,8)=1.45D0<a name='3902'>
	    CTURB_GL(16,9)=1.45D0<a name='3903'>
	    CTURB_GL(16,10)=1.47D0<a name='3904'>
	    CTURB_GL(16,11)=1.44D0<a name='3905'>
	    CTURB_GL(16,12)=1.3D0<a name='3906'>
	    CTURB_GL(16,13)=1.12D0<a name='3907'>
	    CTURB_GL(16,14)=1.0D0<a name='3908'>
          ENDIF<a name='3909'>
          IF(IEPS_800.EQ.1) THEN<a name='3910'>
	    CTURB_GL(1,1) =0.00D0<a name='3911'>
	    CTURB_GL(1,2) =0.00D0<a name='3912'>
	    CTURB_GL(1,3) =1.00D0<a name='3913'>
            CTURB_GL(1,4) =1.50D0<a name='3914'>
	    CTURB_GL(1,5) =1.40D0<a name='3915'>
	    CTURB_GL(1,6) =1.30D0<a name='3916'>
	    CTURB_GL(1,7) =1.20D0<a name='3917'>
	    CTURB_GL(1,8) =1.10D0<a name='3918'>
	    CTURB_GL(1,9) =1.00D0<a name='3919'>
	    CTURB_GL(1,10)=1.00D0<a name='3920'>
	    CTURB_GL(1,11)=1.00D0<a name='3921'>
	    CTURB_GL(1,12)=1.00D0<a name='3922'>
	    CTURB_GL(1,13)=1.00D0<a name='3923'>
	    CTURB_GL(1,14)=1.00D0<a name='3924'>
	    CTURB_GL(1,15)=1.00D0<a name='3925'>
	    CTURB_GL(1,16)=1.00D0<a name='3926'>
<a name='3927'>
	    CTURB_GL(2,1) =0.00D0<a name='3928'>
	    CTURB_GL(2,2) =0.00D0<a name='3929'>
	    CTURB_GL(2,3) =1.00D0<a name='3930'>
	    CTURB_GL(2,4) =2.00D0<a name='3931'>
	    CTURB_GL(2,5) =1.80D0<a name='3932'>
	    CTURB_GL(2,6) =1.70D0<a name='3933'>
	    CTURB_GL(2,7) =1.60D0<a name='3934'>
	    CTURB_GL(2,8) =1.50D0<a name='3935'>
	    CTURB_GL(2,9) =1.50D0<a name='3936'>
	    CTURB_GL(2,10)=1.50D0<a name='3937'>
	    CTURB_GL(2,11)=1.50D0<a name='3938'>
	    CTURB_GL(2,12)=1.50D0<a name='3939'>
	    CTURB_GL(2,13)=1.50D0<a name='3940'>
	    CTURB_GL(2,14)=1.00D0<a name='3941'>
	    CTURB_GL(2,15)=1.00D0<a name='3942'>
	    CTURB_GL(2,16)=1.00D0<a name='3943'>
<a name='3944'>
	    CTURB_GL(3,1) =0.00D0<a name='3945'>
	    CTURB_GL(3,2) =0.00D0<a name='3946'>
	    CTURB_GL(3,3) =4.00D0<a name='3947'>
	    CTURB_GL(3,4) =7.65D0<a name='3948'>
	    CTURB_GL(3,5) =7.65D0<a name='3949'>
	    CTURB_GL(3,6) =8.00D0<a name='3950'>
	    CTURB_GL(3,7) =8.00D0<a name='3951'>
	    CTURB_GL(3,8) =7.50D0<a name='3952'>
	    CTURB_GL(3,9) =6.50D0<a name='3953'>
	    CTURB_GL(3,10)=6.00D0<a name='3954'>
	    CTURB_GL(3,11)=5.00D0<a name='3955'>
	    CTURB_GL(3,12)=4.50D0<a name='3956'>
	    CTURB_GL(3,13)=4.00D0<a name='3957'>
	    CTURB_GL(3,14)=2.00D0<a name='3958'>
	    CTURB_GL(3,15)=1.30D0<a name='3959'>
	    CTURB_GL(3,16)=1.00D0<a name='3960'>
<a name='3961'>
	    CTURB_GL(4,1) =7.50D0<a name='3962'>
	    CTURB_GL(4,2) =7.50D0<a name='3963'>
	    CTURB_GL(4,3) =7.50D0<a name='3964'>
	    CTURB_GL(4,4) =7.65D0	<a name='3965'>
	    CTURB_GL(4,5) =7.65D0	<a name='3966'>
	    CTURB_GL(4,6) =8.00D0	<a name='3967'>
	    CTURB_GL(4,7) =8.00D0	<a name='3968'>
	    CTURB_GL(4,8) =7.50D0	<a name='3969'>
	    CTURB_GL(4,9) =6.50D0	<a name='3970'>
	    CTURB_GL(4,10)=6.00D0	<a name='3971'>
	    CTURB_GL(4,11)=5.00D0	<a name='3972'>
	    CTURB_GL(4,12)=4.50D0	<a name='3973'>
	    CTURB_GL(4,13)=4.00D0	<a name='3974'>
	    CTURB_GL(4,14)=2.00D0	<a name='3975'>
	    CTURB_GL(4,15)=1.30D0	<a name='3976'>
	    CTURB_GL(4,16)=1.00D0	<a name='3977'>
    <a name='3978'>
	    CTURB_GL(5,1) =5.50D0<a name='3979'>
	    CTURB_GL(5,2) =5.50D0<a name='3980'>
	    CTURB_GL(5,3) =5.50D0<a name='3981'>
	    CTURB_GL(5,4) =5.75D0<a name='3982'>
	    CTURB_GL(5,5) =5.75D0<a name='3983'>
	    CTURB_GL(5,6) =6.00D0<a name='3984'>
	    CTURB_GL(5,7) =6.25D0<a name='3985'>
	    CTURB_GL(5,8) =6.17D0<a name='3986'>
	    CTURB_GL(5,9) =5.75D0<a name='3987'>
	    CTURB_GL(5,10)=5.25D0<a name='3988'>
	    CTURB_GL(5,11)=4.75D0<a name='3989'>
	    CTURB_GL(5,12)=4.25D0<a name='3990'>
	    CTURB_GL(5,13)=4.00D0<a name='3991'>
	    CTURB_GL(5,14)=2.00D0<a name='3992'>
	    CTURB_GL(5,15)=1.35D0<a name='3993'>
	    CTURB_GL(5,16)=1.00D0<a name='3994'>
	 <a name='3995'>
	    CTURB_GL(6,1) =4.50D0<a name='3996'>
	    CTURB_GL(6,2) =4.50D0<a name='3997'>
	    CTURB_GL(6,3) =4.50D0<a name='3998'>
	    CTURB_GL(6,4) =4.75D0	<a name='3999'>
	    CTURB_GL(6,5) =4.75D0	<a name='4000'>
	    CTURB_GL(6,6) =5.00D0	<a name='4001'>
	    CTURB_GL(6,7) =5.25D0	<a name='4002'>
	    CTURB_GL(6,8) =5.25D0	<a name='4003'>
	    CTURB_GL(6,9) =5.00D0	<a name='4004'>
	    CTURB_GL(6,10)=4.75D0	<a name='4005'>
	    CTURB_GL(6,11)=4.50D0	<a name='4006'>
	    CTURB_GL(6,12)=4.00D0	<a name='4007'>
	    CTURB_GL(6,13)=3.75D0	<a name='4008'>
	    CTURB_GL(6,14)=2.00D0	<a name='4009'>
	    CTURB_GL(6,15)=1.40D0	<a name='4010'>
	    CTURB_GL(6,16)=1.00D0	<a name='4011'>
			 		<a name='4012'>
	    CTURB_GL(7,1) =4.00D0<a name='4013'>
	    CTURB_GL(7,2) =4.00D0<a name='4014'>
	    CTURB_GL(7,3) =4.00D0<a name='4015'>
	    CTURB_GL(7,4) =4.00D0<a name='4016'>
	    CTURB_GL(7,5) =4.00D0<a name='4017'>
	    CTURB_GL(7,6) =4.25D0<a name='4018'>
	    CTURB_GL(7,7) =4.50D0<a name='4019'>
	    CTURB_GL(7,8) =4.67D0<a name='4020'>
	    CTURB_GL(7,9) =4.50D0<a name='4021'>
	    CTURB_GL(7,10)=4.30D0<a name='4022'>
	    CTURB_GL(7,11)=4.10D0<a name='4023'>
	    CTURB_GL(7,12)=3.80D0<a name='4024'>
	    CTURB_GL(7,13)=3.50D0<a name='4025'>
	    CTURB_GL(7,14)=2.00D0<a name='4026'>
	    CTURB_GL(7,15)=1.30D0<a name='4027'>
	    CTURB_GL(7,16)=1.10D0<a name='4028'>
<a name='4029'>
	    CTURB_GL(8,1) =3.50D0<a name='4030'>
	    CTURB_GL(8,2) =3.50D0<a name='4031'>
	    CTURB_GL(8,3) =3.50D0<a name='4032'>
	    CTURB_GL(8,4) =3.65D0<a name='4033'>
	    CTURB_GL(8,5) =3.65D0<a name='4034'>
	    CTURB_GL(8,6) =3.80D0<a name='4035'>
	    CTURB_GL(8,7) =4.1D02<a name='4036'>
	    CTURB_GL(8,8) =4.17D0<a name='4037'>
	    CTURB_GL(8,9) =4.17D0<a name='4038'>
	    CTURB_GL(8,10)=4.00D0<a name='4039'>
	    CTURB_GL(8,11)=3.80D0<a name='4040'>
	    CTURB_GL(8,12)=3.67D0<a name='4041'>
	    CTURB_GL(8,13)=3.40D0<a name='4042'>
	    CTURB_GL(8,14)=2.00D0<a name='4043'>
	    CTURB_GL(8,15)=1.30D0<a name='4044'>
	    CTURB_GL(8,16)=1.10D0<a name='4045'>
<a name='4046'>
	    CTURB_GL(9,1) =3.25D0<a name='4047'>
	    CTURB_GL(9,2) =3.25D0<a name='4048'>
	    CTURB_GL(9,3) =3.25D0<a name='4049'>
	    CTURB_GL(9,4) =3.25D0<a name='4050'>
	    CTURB_GL(9,5) =3.25D0<a name='4051'>
	    CTURB_GL(9,6) =3.50D0<a name='4052'>
	    CTURB_GL(9,7) =3.75D0<a name='4053'>
	    CTURB_GL(9,8) =3.75D0<a name='4054'>
	    CTURB_GL(9,9) =3.75D0<a name='4055'>
	    CTURB_GL(9,10)=3.75D0<a name='4056'>
	    CTURB_GL(9,11)=3.60D0<a name='4057'>
	    CTURB_GL(9,12)=3.40D0<a name='4058'>
	    CTURB_GL(9,13)=3.25D0<a name='4059'>
	    CTURB_GL(9,14)=2.00D0<a name='4060'>
	    CTURB_GL(9,15)=1.30D0<a name='4061'>
	    CTURB_GL(9,16)=1.10D0<a name='4062'>
	    <a name='4063'>
	    CTURB_GL(10,1) =3.00D0<a name='4064'>
	    CTURB_GL(10,2) =3.00D0<a name='4065'>
	    CTURB_GL(10,3) =3.00D0<a name='4066'>
	    CTURB_GL(10,4) =3.10D0<a name='4067'>
	    CTURB_GL(10,5) =3.10D0<a name='4068'>
	    CTURB_GL(10,6) =3.25D0<a name='4069'>
	    CTURB_GL(10,7) =3.40D0<a name='4070'>
	    CTURB_GL(10,8) =3.50D0<a name='4071'>
	    CTURB_GL(10,9) =3.50D0<a name='4072'>
	    CTURB_GL(10,10)=3.50D0<a name='4073'>
	    CTURB_GL(10,11)=3.40D0<a name='4074'>
	    CTURB_GL(10,12)=3.25D0<a name='4075'>
	    CTURB_GL(10,13)=3.15D0<a name='4076'>
	    CTURB_GL(10,14)=1.90D0<a name='4077'>
	    CTURB_GL(10,15)=1.30D0<a name='4078'>
	    CTURB_GL(10,16)=1.10D0<a name='4079'>
<a name='4080'>
	    CTURB_GL(11,1) =2.75D0<a name='4081'>
	    CTURB_GL(11,2) =2.75D0<a name='4082'>
	    CTURB_GL(11,3) =2.75D0<a name='4083'>
	    CTURB_GL(11,4) =2.75D0<a name='4084'>
	    CTURB_GL(11,5) =2.75D0<a name='4085'>
	    CTURB_GL(11,6) =3.00D0<a name='4086'>
	    CTURB_GL(11,7) =3.25D0<a name='4087'>
	    CTURB_GL(11,8) =3.25D0<a name='4088'>
	    CTURB_GL(11,9) =3.25D0<a name='4089'>
	    CTURB_GL(11,10)=3.25D0<a name='4090'>
	    CTURB_GL(11,11)=3.25D0<a name='4091'>
	    CTURB_GL(11,12)=3.15D0<a name='4092'>
	    CTURB_GL(11,13)=3.00D0<a name='4093'>
	    CTURB_GL(11,14)=1.80D0<a name='4094'>
	    CTURB_GL(11,15)=1.30D0<a name='4095'>
	    CTURB_GL(11,16)=1.10D0<a name='4096'>
<a name='4097'>
	    CTURB_GL(12,1) =2.60D0<a name='4098'>
	    CTURB_GL(12,2) =2.60D0<a name='4099'>
	    CTURB_GL(12,3) =2.60D0<a name='4100'>
	    CTURB_GL(12,4) =2.67D0<a name='4101'>
	    CTURB_GL(12,5) =2.67D0<a name='4102'>
	    CTURB_GL(12,6) =2.75D0<a name='4103'>
	    CTURB_GL(12,7) =3.00D0<a name='4104'>
	    CTURB_GL(12,8) =3.17D0<a name='4105'>
	    CTURB_GL(12,9) =3.17D0<a name='4106'>
	    CTURB_GL(12,10)=3.17D0<a name='4107'>
	    CTURB_GL(12,11)=3.10D0<a name='4108'>
	    CTURB_GL(12,12)=2.90D0<a name='4109'>
	    CTURB_GL(12,13)=2.80D0<a name='4110'>
	    CTURB_GL(12,14)=1.87D0<a name='4111'>
	    CTURB_GL(12,15)=1.37D0<a name='4112'>
	    CTURB_GL(12,16)=1.10D0<a name='4113'>
<a name='4114'>
	    CTURB_GL(13,1) =2.40D0<a name='4115'>
	    CTURB_GL(13,2) =2.40D0<a name='4116'>
	    CTURB_GL(13,3) =2.40D0<a name='4117'>
	    CTURB_GL(13,4) =2.50D0<a name='4118'>
	    CTURB_GL(13,5) =2.50D0<a name='4119'>
	    CTURB_GL(13,6) =2.67D0<a name='4120'>
	    CTURB_GL(13,7) =2.83D0<a name='4121'>
	    CTURB_GL(13,8) =2.90D0<a name='4122'>
	    CTURB_GL(13,9) =3.00D0<a name='4123'>
	    CTURB_GL(13,10)=2.90D0<a name='4124'>
	    CTURB_GL(13,11)=2.85D0<a name='4125'>
	    CTURB_GL(13,12)=2.80D0<a name='4126'>
	    CTURB_GL(13,13)=2.75D0<a name='4127'>
	    CTURB_GL(13,14)=1.83D0<a name='4128'>
	    CTURB_GL(13,15)=1.30D0<a name='4129'>
	    CTURB_GL(13,16)=1.10D0<a name='4130'>
<a name='4131'>
	    CTURB_GL(14,1) =1.67D0<a name='4132'>
	    CTURB_GL(14,2) =1.67D0<a name='4133'>
	    CTURB_GL(14,3) =1.67D0<a name='4134'>
	    CTURB_GL(14,4) =1.75D0<a name='4135'>
	    CTURB_GL(14,5) =1.75D0<a name='4136'>
	    CTURB_GL(14,6) =1.83D0<a name='4137'>
	    CTURB_GL(14,7) =1.87D0<a name='4138'>
	    CTURB_GL(14,8) =2.00D0<a name='4139'>
	    CTURB_GL(14,9) =2.10D0<a name='4140'>
	    CTURB_GL(14,10)=2.12D0<a name='4141'>
	    CTURB_GL(14,11)=2.15D0<a name='4142'>
	    CTURB_GL(14,12)=2.18D0<a name='4143'>
	    CTURB_GL(14,13)=2.19D0<a name='4144'>
	    CTURB_GL(14,14)=1.67D0<a name='4145'>
	    CTURB_GL(14,15)=1.28D0<a name='4146'>
	    CTURB_GL(14,16)=1.00D0<a name='4147'>
<a name='4148'>
	    CTURB_GL(15,1) =1.30D0<a name='4149'>
	    CTURB_GL(15,2) =1.30D0<a name='4150'>
	    CTURB_GL(15,3) =1.30D0<a name='4151'>
	    CTURB_GL(15,4) =1.35D0<a name='4152'>
	    CTURB_GL(15,5) =1.35D0<a name='4153'>
	    CTURB_GL(15,6) =1.40D0<a name='4154'>
	    CTURB_GL(15,7) =1.60D0<a name='4155'>
	    CTURB_GL(15,8) =1.70D0<a name='4156'>
	    CTURB_GL(15,9) =1.70D0<a name='4157'>
	    CTURB_GL(15,10)=1.70D0<a name='4158'>
	    CTURB_GL(15,11)=1.70D0<a name='4159'>
	    CTURB_GL(15,12)=1.70D0<a name='4160'>
	    CTURB_GL(15,13)=1.70D0<a name='4161'>
	    CTURB_GL(15,14)=1.40D0<a name='4162'>
	    CTURB_GL(15,15)=1.25D0<a name='4163'>
	    CTURB_GL(15,16)=1.00D0<a name='4164'>
<a name='4165'>
	    CTURB_GL(16,1) =1.17D0<a name='4166'>
	    CTURB_GL(16,2) =1.17D0<a name='4167'>
	    CTURB_GL(16,3) =1.17D0<a name='4168'>
	    CTURB_GL(16,4) =1.17D0<a name='4169'>
	    CTURB_GL(16,5) =1.17D0<a name='4170'>
	    CTURB_GL(16,6) =1.25D0<a name='4171'>
	    CTURB_GL(16,7) =1.30D0<a name='4172'>
	    CTURB_GL(16,8) =1.35D0<a name='4173'>
	    CTURB_GL(16,9) =1.40D0<a name='4174'>
	    CTURB_GL(16,10)=1.45D0<a name='4175'>
	    CTURB_GL(16,11)=1.45D0<a name='4176'>
	    CTURB_GL(16,12)=1.47D0<a name='4177'>
	    CTURB_GL(16,13)=1.44D0<a name='4178'>
	    CTURB_GL(16,14)=1.30D0<a name='4179'>
	    CTURB_GL(16,15)=1.12D0<a name='4180'>
	    CTURB_GL(16,16)=1.00D0<a name='4181'>
          ENDIF<a name='4182'>
          IF(IEPS_800.EQ.1.AND.IEPS_1600.EQ.1) THEN<a name='4183'>
            DO I=1,K0G_GL<a name='4184'>
               DO J=1,K0L_GL<a name='4185'>
                  CTURB_GL(I,J)=CTURB_GL(I,J)*1.7D0<a name='4186'>
               ENDDO<a name='4187'>
            ENDDO <a name='4188'>
          ENDIF<a name='4189'>
          DO J=1,K0L_GL<a name='4190'>
             DO I=1,K0G_GL<a name='4191'>
                CTURB_GL(I,J)=(CTURB_GL(I,J)-1.0D0)/1.5D0+1.0D0<a name='4192'>
             ENDDO<a name='4193'>
          ENDDO<a name='4194'>
	  DO I=KRMING_GL,KRMAXG_GL<a name='4195'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='4196'>
                CTURBGL(I,J)=1.<a name='4197'>
             ENDDO<a name='4198'>
          ENDDO<a name='4199'>
          DO I=KRMING_GL,KRMAXG_GL                   <a name='4200'>
             X_KERN=RADXXO(I,6)*1.0D4<a name='4201'>
             IF(X_KERN.LT.RG_GL(1)) X_KERN=RG_GL(1)<a name='4202'>
             IF(X_KERN.GT.RG_GL(K0G_GL)) X_KERN=RG_GL(K0G_GL) <a name='4203'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='4204'>
                Y_KERN=RADXXO(J,1)*1.0D4<a name='4205'>
                IF(Y_KERN.LT.RL_GL(1)) Y_KERN=RL_GL(1)<a name='4206'>
                IF(Y_KERN.GT.RL_GL(K0L_GL)) Y_KERN=RL_GL(K0L_GL)<a name='4207'>
                CTURBGL(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>F</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_17">(X_KERN,Y_KERN,RG_GL,RL_GL,CTURB_GL &amp;<a name='4208'>
     &amp;                      ,K0G_GL,K0L_GL)	      <a name='4209'>
             ENDDO<a name='4210'>
          ENDDO<a name='4211'>
          IF(IEPS_800.EQ.1) THEN<a name='4212'>
            DO I=KRMING_GL,15<a name='4213'>
               DO J=KRMINL_GL,13<a name='4214'>
                  IF(CTURBGL(I,J).LT.3.0D0) CTURBGL(I,J)=3.0D0<a name='4215'>
               ENDDO<a name='4216'>
            ENDDO<a name='4217'>
          ENDIF<a name='4218'>
          IF(IEPS_1600.EQ.1) THEN<a name='4219'>
            DO I=KRMING_GL,15<a name='4220'>
               DO J=KRMINL_GL,13<a name='4221'>
                  IF(CTURBGL(I,J).LT.5.1D0) CTURBGL(I,J)=5.1D0<a name='4222'>
               ENDDO<a name='4223'>
            ENDDO<a name='4224'>
          ENDIF<a name='4225'>
	  DO I=1,33<a name='4226'>
             DO J=1,24<a name='4227'>
                IF(I.LE.14.AND.J.EQ.8) CTURBGL(I,J)=1.0D0<a name='4228'>
                IF(I.GT.14.AND.J.LE.8) CTURBGL(I,J)=1.2D0<a name='4229'>
	     ENDDO<a name='4230'>
          ENDDO                       <a name='4231'>
	RETURN<a name='4232'>
	END SUBROUTINE TURBCOEF<a name='4233'>
<font color=#447700>!===================================================================<a name='4234'></font>
<font color=#447700>! QUESTION<a name='4235'></font>
<A NAME='F'><A href='../../html_code/phys/module_mp_full_sbm.F.html#F' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='4236'>
        real * 8 <font color=#993300>function </font><font color=#cc0000>f</font>(x,y,x0,y0,table,k0,kk0) <A href='../../call_to/F.html' TARGET='index'>33</A><a name='4237'>
<font color=#447700>! two-dimensional linear interpolation of the collision efficiency<a name='4238'></font>
<font color=#447700>! with help table(k0,kk0)<a name='4239'></font>
<a name='4240'>
       implicit none<a name='4241'>
       integer k0,kk0,k,ir,kk,iq<a name='4242'>
       double precision x,y,p,q,ec,ek<a name='4243'>
<font color=#447700>!      double precision x,y,p,q,ec,ek,f<a name='4244'></font>
       double precision x0(k0),y0(kk0),table(k0,kk0)<a name='4245'>
<a name='4246'>
<a name='4247'>
        do k=2,k0<a name='4248'>
           if(x.le.x0(k).and.x.ge.x0(k-1)) then<a name='4249'>
             ir=k     <a name='4250'>
           elseif(x.gt.x0(k0)) then<a name='4251'>
             ir=k0+1<a name='4252'>
           elseif(x.lt.x0(1)) then<a name='4253'>
             ir=1<a name='4254'>
           endif<a name='4255'>
        enddo<a name='4256'>
        do kk=2,kk0<a name='4257'>
           if(y.le.y0(kk).and.y.ge.y0(kk-1)) iq=kk<a name='4258'>
        enddo<a name='4259'>
        if(ir.lt.k0+1) then<a name='4260'>
          if(ir.ge.2) then<a name='4261'>
            p =(x-x0(ir-1))/(x0(ir)-x0(ir-1))<a name='4262'>
            q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='4263'>
            ec=(1.d0-p)*(1.d0-q)*table(ir-1,iq-1)+ &amp;<a name='4264'>
     &amp;              p*(1.d0-q)*table(ir,iq-1)+ &amp;<a name='4265'>
     &amp;              q*(1.d0-p)*table(ir-1,iq)+ &amp;<a name='4266'>
     &amp;                   p*q*table(ir,iq)    <a name='4267'>
          else<a name='4268'>
            q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='4269'>
            ec=(1.d0-q)*table(1,iq-1)+q*table(1,iq)    <a name='4270'>
          endif<a name='4271'>
        else<a name='4272'>
          q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='4273'>
          ek=(1.d0-q)*table(k0,iq-1)+q*table(k0,iq)<a name='4274'>
          ec=min(ek,1.d0) <a name='4275'>
        endif<a name='4276'>
        f=ec<a name='4277'>
        return<a name='4278'>
        end function f<a name='4279'>
<font color=#447700>! function f<a name='4280'></font>
                                                                            <a name='4281'>
<a name='4282'>
                                                                            <a name='4283'>
<a name='4284'>
<font color=#447700>!======================================================================<a name='4285'></font>
<A NAME='FREEZ'><A href='../../html_code/phys/module_mp_full_sbm.F.html#FREEZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4286'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>FREEZ</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/FREEZ.html' TARGET='index'>2</A><a name='4287'>
     &amp;,TIN,DT,RO,COL,AFREEZMY,BFREEZMY,BFREEZMAX,KRFREEZ,ICEMAX,NKR)       <a name='4288'>
      IMPLICIT NONE <a name='4289'>
      INTEGER KR,ICE,ICE_TYPE<a name='4290'>
      REAL COL,AFREEZMY,BFREEZMY,BFREEZMAX<a name='4291'>
      INTEGER KRFREEZ,ICEMAX,NKR<a name='4292'>
      REAL DT,RO,YKK,PF,PF_1,DEL_T,TT_DROP,ARG_1,YK2,DF1,BF,ARG_M, &amp; <a name='4293'>
     &amp; TT_DROP_AFTER_FREEZ,CFREEZ,SUM_ICE,TIN,TTIN,AF,FF_MAX,F1_MAX, &amp;<a name='4294'>
     &amp; F2_MAX,F3_MAX,F4_MAX,F5_MAX<a name='4295'>
<a name='4296'>
<a name='4297'>
	REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX) &amp;<a name='4298'>
     &amp;           ,XI(NKR,ICEMAX),FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='4299'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='4300'>
<a name='4301'>
<a name='4302'>
<a name='4303'>
	TTIN=TIN<a name='4304'>
        DEL_T	=TTIN-273.15<a name='4305'>
	ICE_TYPE=2<a name='4306'>
	F1_MAX=0.<a name='4307'>
	F2_MAX=0.<a name='4308'>
	F3_MAX=0.<a name='4309'>
	F4_MAX=0.<a name='4310'>
	F5_MAX=0.<a name='4311'>
	DO 1 KR=1,NKR<a name='4312'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='4313'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='4314'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='4315'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='4316'>
	DO 1 ICE=1,ICEMAX<a name='4317'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='4318'>
    1   CONTINUE<a name='4319'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='4320'>
<font color=#447700>!<a name='4321'></font>
<font color=#447700>!******************************* FREEZING ****************************<a name='4322'></font>
<font color=#447700>!<a name='4323'></font>
        IF(DEL_T.LT.0.AND.F1_MAX.NE.0) THEN<a name='4324'>
	SUM_ICE=0.<a name='4325'>
	AF	=AFREEZMY<a name='4326'>
	CFREEZ	=(BFREEZMAX-BFREEZMY)/XL(NKR)<a name='4327'>
<font color=#447700>!<a name='4328'></font>
<font color=#447700>!***************************** MASS LOOP **************************<a name='4329'></font>
<font color=#447700>!<a name='4330'></font>
         DO  KR	=1,NKR<a name='4331'>
	 ARG_M	=XL(KR)<a name='4332'>
	 BF	=BFREEZMY+CFREEZ*ARG_M<a name='4333'>
         PF_1	=AF*EXP(-BF*DEL_T)<a name='4334'>
         PF	=ARG_M*PF_1<a name='4335'>
	 YKK	=EXP(-PF*DT)<a name='4336'>
         DF1	=FF1(KR)*(1.-YKK)<a name='4337'>
	 YK2	=DF1<a name='4338'>
         FF1(KR)=FF1(KR)*YKK<a name='4339'>
	 IF(KR.LE.KRFREEZ)  THEN<a name='4340'>
	 FF2(KR,ICE_TYPE)=FF2(KR,ICE_TYPE)+YK2<a name='4341'>
			    ELSE<a name='4342'>
	  FF5(KR)	=FF5(KR)+YK2<a name='4343'>
	 ENDIF<a name='4344'>
         SUM_ICE=SUM_ICE+YK2*3.*XL(KR)*XL(KR)*COL<a name='4345'>
<font color=#447700>!<a name='4346'></font>
<font color=#447700>!************************ END OF "MASS LOOP" **************************<a name='4347'></font>
<font color=#447700>!<a name='4348'></font>
	 ENDDO<a name='4349'>
<font color=#447700>!<a name='4350'></font>
<font color=#447700>!************************** NEW TEMPERATURE *************************<a name='4351'></font>
<font color=#447700>!	<a name='4352'></font>
	ARG_1	=333.*SUM_ICE/RO<a name='4353'>
      	TT_DROP_AFTER_FREEZ=TTIN+ARG_1<a name='4354'>
	TIN	=TT_DROP_AFTER_FREEZ<a name='4355'>
<font color=#447700>!<a name='4356'></font>
<font color=#447700>!************************** END OF "FREEZING" ****************************<a name='4357'></font>
<font color=#447700>!<a name='4358'></font>
	ENDIF<a name='4359'>
<font color=#447700>!<a name='4360'></font>
   	RETURN                                                           <a name='4361'>
      	END SUBROUTINE FREEZ                                                             <a name='4362'>
<a name='4363'>
<A NAME='ORIG_MELT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ORIG_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4364'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ORIG_MELT</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/ORIG_MELT.html' TARGET='index'>2</A><a name='4365'>
     &amp;                           ,TIN,DT,RO,COL,ICEMAX,NKR)<a name='4366'>
      IMPLICIT NONE<a name='4367'>
      INTEGER KR,ICE,ICE_TYPE<a name='4368'>
      INTEGER ICEMAX,NKR<a name='4369'>
      REAL COL<a name='4370'>
      REAL ARG_M,TT_DROP,ARG_1,TT_DROP_AFTER_FREEZ,DT,DF1,DN,DN0, &amp;<a name='4371'>
     &amp; RO,A,B,DTFREEZ,SUM_ICE,FF_MAX,F1_MAX,F2_MAX,F3_MAX,F4_MAX,F5_MAX, &amp;<a name='4372'>
     &amp; DEL_T,TIN<a name='4373'>
        REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX),XI(NKR,ICEMAX) &amp;<a name='4374'>
     &amp;           ,FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='4375'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='4376'>
<a name='4377'>
<a name='4378'>
<font color=#447700>!       gamma=4.4<a name='4379'></font>
        DEL_T	=TIN-273.15<a name='4380'>
	ICE_TYPE=2<a name='4381'>
	F1_MAX=0.<a name='4382'>
	F2_MAX=0.<a name='4383'>
	F3_MAX=0.<a name='4384'>
	F4_MAX=0.<a name='4385'>
	F5_MAX=0.<a name='4386'>
	DO 1 KR=1,NKR<a name='4387'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='4388'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='4389'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='4390'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='4391'>
	DO 1 ICE=1,ICEMAX<a name='4392'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='4393'>
    1	CONTINUE<a name='4394'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='4395'>
<font color=#447700>! MELTING :<a name='4396'></font>
	IF(DEL_T.GE.0.AND.FF_MAX.NE.0) THEN<a name='4397'>
	  SUM_ICE=0.<a name='4398'>
<font color=#447700>! MASS LOOP :<a name='4399'></font>
  	  DO KR=1,NKR<a name='4400'>
	     ARG_M=FF3(KR)+FF4(KR)+FF5(KR)<a name='4401'>
	     DO ICE=1,ICEMAX<a name='4402'>
	        ARG_M=ARG_M+FF2(KR,ICE)<a name='4403'>
      	        FF2(KR,ICE)=0.<a name='4404'>
 	     ENDDO<a name='4405'>
      	     FF1(KR)=FF1(KR)+ARG_M<a name='4406'>
      	     FF3(KR)=0.<a name='4407'>
             FF4(KR)=0.<a name='4408'>
      	     FF5(KR)=0.<a name='4409'>
	     SUM_ICE=SUM_ICE+ARG_M*3.*XL(KR)*XL(KR)*COL<a name='4410'>
<font color=#447700>! END OF "MASS LOOP"<a name='4411'></font>
	  ENDDO<a name='4412'>
<font color=#447700>! CYCLE BY KR<a name='4413'></font>
<font color=#447700>! NEW TEMPERATURE :<a name='4414'></font>
	  ARG_1=333.*SUM_ICE/RO	<a name='4415'>
	  TIN=TIN-ARG_1<a name='4416'>
<font color=#447700>! END OF MELTING<a name='4417'></font>
<font color=#447700>! IN CASE DEL_T.GE.0.AND.FF_MAX.NE.0<a name='4418'></font>
	ENDIF<a name='4419'>
   	RETURN                                                           <a name='4420'>
      	END SUBROUTINE ORIG_MELT                                                             <a name='4421'>
<font color=#447700>!===========================<a name='4422'></font>
<A NAME='J_W_MELT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#J_W_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4423'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>J_W_MELT</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/J_W_MELT.html' TARGET='index'>2</A><a name='4424'>
     &amp;                           ,TIN,DT,RO,COL,ICEMAX,NKR)<a name='4425'>
      IMPLICIT NONE<a name='4426'>
      INTEGER KR,ICE,ICE_TYPE<a name='4427'>
      INTEGER ICEMAX,NKR<a name='4428'>
      REAL COL<a name='4429'>
      REAL ARG_M,TT_DROP,ARG_1,TT_DROP_AFTER_FREEZ,DT,DF1,DN,DN0, &amp;<a name='4430'>
     &amp; RO,A,B,DTFREEZ,SUM_ICE,FF_MAX,F1_MAX,F2_MAX,F3_MAX,F4_MAX,F5_MAX, &amp;<a name='4431'>
     &amp; DEL_T,TIN,meltrate<a name='4432'>
        REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX),XI(NKR,ICEMAX) &amp;<a name='4433'>
     &amp;           ,FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='4434'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='4435'>
<a name='4436'>
<a name='4437'>
<font color=#447700>!       gamma=4.4<a name='4438'></font>
        DEL_T	=TIN-273.15<a name='4439'>
	F1_MAX=0.<a name='4440'>
	F2_MAX=0.<a name='4441'>
	F3_MAX=0.<a name='4442'>
	F4_MAX=0.<a name='4443'>
	F5_MAX=0.<a name='4444'>
	DO 1 KR=1,NKR<a name='4445'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='4446'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='4447'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='4448'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='4449'>
	DO 1 ICE=1,ICEMAX<a name='4450'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='4451'>
    1	CONTINUE<a name='4452'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='4453'>
<font color=#447700>! MELTING :<a name='4454'></font>
	SUM_ICE=0.<a name='4455'>
	IF(DEL_T.GE.0.AND.FF_MAX.NE.0) THEN<a name='4456'>
<font color=#447700>! Fan's "MASS LOOP"<a name='4457'></font>
          DO KR = 1,NKR<a name='4458'>
          ARG_M = 0.<a name='4459'>
            DO ICE = 1,ICEMAX<a name='4460'>
             IF (ICE ==1) THEN<a name='4461'>
                 IF (KR .le. 10) THEN<a name='4462'>
                     ARG_M = ARG_M+FF2(KR,ICE)<a name='4463'>
                     FF2(KR,ICE)=0.<a name='4464'>
                 ELSEIF (KR .gt. 10 .and. KR .lt. 18) THEN<a name='4465'>
                     meltrate = 0.5/50.<a name='4466'>
                     ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='4467'>
                     FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='4468'>
                 ELSE<a name='4469'>
                     meltrate = 0.683/120.<a name='4470'>
                     ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='4471'>
                     FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='4472'>
                 ENDIF<a name='4473'>
             ENDIF<a name='4474'>
             IF (ICE ==2 .or. ICE ==3) THEN<a name='4475'>
                IF (kr .le. 12) THEN<a name='4476'>
                    ARG_M = ARG_M+FF2(KR,ICE)<a name='4477'>
                    FF2(KR,ICE)=0.<a name='4478'>
                ELSEIF (kr .gt. 12 .and. kr .lt. 20) THEN<a name='4479'>
                    meltrate = 0.5/50.<a name='4480'>
                    ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='4481'>
                    FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='4482'>
                 ELSE<a name='4483'>
                    meltrate = 0.683/120.<a name='4484'>
                    ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='4485'>
                    FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='4486'>
                 ENDIF<a name='4487'>
             ENDIF<a name='4488'>
            ENDDO  <font color=#447700>! Do ice<a name='4489'></font>
<font color=#447700>! snow<a name='4490'></font>
                 IF (kr .le. 14) THEN<a name='4491'>
                    ARG_M = ARG_M+FF3(KR)<a name='4492'>
                    FF3(KR)=0.<a name='4493'>
                 ELSEIF (kr .gt. 14 .and. kr .lt. 22) THEN<a name='4494'>
                    meltrate = 0.5/50.<a name='4495'>
                    ARG_M=ARG_M+FF3(KR)*(meltrate*dt)<a name='4496'>
                    FF3(KR)=FF3(KR)-FF3(KR)*(meltrate*dt)<a name='4497'>
                 ELSE<a name='4498'>
                    meltrate = 0.683/120.<a name='4499'>
                    ARG_M=ARG_M+FF3(KR)*(meltrate*dt)<a name='4500'>
                    FF3(KR)=FF3(KR)-FF3(KR)*(meltrate*dt)<a name='4501'>
                 ENDIF<a name='4502'>
<font color=#447700>! graupel/hail<a name='4503'></font>
                 IF (kr .le. 13) then<a name='4504'>
                     ARG_M = ARG_M+FF4(KR)+FF5(KR)<a name='4505'>
                     FF4(KR)=0.<a name='4506'>
                     FF5(KR)=0.<a name='4507'>
                 ELSEIF (kr .gt. 13 .and. kr .lt. 23) THEN<a name='4508'>
                     meltrate = 0.5/50.<a name='4509'>
                     ARG_M=ARG_M+(FF4(KR)+FF5(KR))*(meltrate*dt)<a name='4510'>
                     FF4(KR)=FF4(KR)-FF4(KR)*(meltrate*dt)<a name='4511'>
                     FF5(KR)=FF5(KR)-FF5(KR)*(meltrate*dt)<a name='4512'>
                 ELSE<a name='4513'>
                    meltrate = 0.683/120.<a name='4514'>
                    ARG_M=ARG_M+(FF4(KR)+FF5(KR))*(meltrate*dt)<a name='4515'>
                    FF4(KR)=FF4(KR)-FF4(KR)*(meltrate*dt)<a name='4516'>
                    FF5(KR)=FF5(KR)-FF5(KR)*(meltrate*dt)<a name='4517'>
                 ENDIF<a name='4518'>
<a name='4519'>
                   FF1(KR)=FF1(KR)+ARG_M<a name='4520'>
<a name='4521'>
                   SUM_ICE=SUM_ICE+ARG_M*3.*XL(KR)*XL(KR)*COL<a name='4522'>
<font color=#447700>! END OF Fan'a "MASS LOOP"<a name='4523'></font>
       ENDDO<a name='4524'>
<font color=#447700>! CYCLE BY KR<a name='4525'></font>
<font color=#447700>! NEW TEMPERATURE :<a name='4526'></font>
        ARG_1=333.*SUM_ICE/RO<a name='4527'>
        TIN=TIN-ARG_1<a name='4528'>
<font color=#447700>! END OF MELTING<a name='4529'></font>
<a name='4530'>
	ENDIF<a name='4531'>
   	RETURN                                                           <a name='4532'>
      	END SUBROUTINE J_W_MELT                                                             <a name='4533'>
<font color=#447700>!===================================================================<a name='4534'></font>
<A NAME='JERNUCL01'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4535'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERNUCL01</font>(PSI1,PSI2,FCCNR &amp; <A href='../../call_to/JERNUCL01.html' TARGET='index'>2</A>,<A href='../../call_from/JERNUCL01.html' TARGET='index'>4</A><a name='4536'>
     &amp;                    ,X1,X2,DTT,DQQ,ROR,PP,DSUP1,DSUP2 &amp;<a name='4537'>
     &amp;  ,COL,AA1_MY, BB1_MY, AA2_MY, BB2_MY &amp;<a name='4538'>
     &amp;  ,C1_MEY,C2_MEY,SUP2_OLD,DSUPICEXZ &amp;<a name='4539'>
     &amp;  ,RCCN,DROPRADII,NKR,ICEMAX,ICEPROCS)<a name='4540'>
      IMPLICIT NONE <a name='4541'>
<font color=#447700>!<a name='4542'></font>
      INTEGER ICEMAX,NKR<a name='4543'>
      INTEGER ICEPROCS<a name='4544'>
      REAL COL,AA1_MY, BB1_MY, AA2_MY, BB2_MY, &amp;<a name='4545'>
     &amp;  C1_MEY,C2_MEY,SUP2_OLD,DSUPICEXZ, &amp;<a name='4546'>
     &amp;  RCCN(NKR),DROPRADII(NKR),FCCNR(NKR)<a name='4547'>
<font color=#447700>!<a name='4548'></font>
      INTEGER KR,ICE,ITYPE,NRGI,ICORR,II,JJ,KK,NKRDROP,NCRITI<a name='4549'>
       DOUBLE PRECISION DTT,DQQ,DSUP1,DSUP2<a name='4550'>
       REAL TT,QQ,              &amp;<a name='4551'>
     &amp; DX,BMASS,CONCD,C2,CONCDF,DELTACD,CONCDIN,ROR, &amp;<a name='4552'>
     &amp; DELTAF,DELMASSL,FMASS,HELEK1,DEL2NN,FF1BN, &amp;<a name='4553'>
     &amp; HELEK2,TPCC,PP,ADDF,DSUP2N,FACT,EW1N,ES2N,ES1N,FNEW, &amp;<a name='4554'>
     &amp; C1,SUP1N,SUP2N,QPN,TPN,TPC,SUP1,SUP2,DEL1N,DEL2N,AL1,AL2, &amp;<a name='4555'>
     &amp; TEMP1,TEMP2,TEMP3,A1,B1,A2,B2 <a name='4556'>
<font color=#447700>!<a name='4557'></font>
<a name='4558'>
<font color=#447700>!********************************************************************<a name='4559'></font>
<a name='4560'>
<font color=#447700>! NEW MEYERS IN JERNUCL01 SUBROUTINE <a name='4561'></font>
<a name='4562'>
<a name='4563'>
<a name='4564'>
<font color=#447700>!********************************************************************<a name='4565'></font>
<a name='4566'>
<a name='4567'>
<a name='4568'>
      REAL PSI1(NKR),X1(NKR),DROPCONCN(NKR) &amp;<a name='4569'>
     &amp;     ,PSI2(NKR,ICEMAX),X2(NKR,ICEMAX)<a name='4570'>
      <a name='4571'>
<a name='4572'>
      DATA A1,B1,A2,B2/-0.639,0.1296,-2.8,0.262/<a name='4573'>
      DATA TEMP1,TEMP2,TEMP3/-5.,-2.,-20./<a name='4574'>
      DATA AL1/2500./,AL2/2834./<a name='4575'>
      SUP1=DSUP1<a name='4576'>
      SUP2=DSUP2<a name='4577'>
<a name='4578'>
<a name='4579'>
      TT=DTT<a name='4580'>
      QQ=DQQ<a name='4581'>
<font color=#447700>! DROPLETS NUCLEATION (BEGIN)<a name='4582'></font>
<a name='4583'>
        TPN=TT<a name='4584'>
        QPN=QQ<a name='4585'>
<a name='4586'>
        DEL1N=100.*SUP1<a name='4587'>
        TPC=TT-273.15<a name='4588'>
<a name='4589'>
        IF(DEL1N.GT.0.AND.TPC.GT.-73.16) THEN<a name='4590'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#WATER_NUCL'>WATER_NUCL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WATER_NUCL_2"> (PSI1,FCCNR,X1,TT,SUP1  &amp;<a name='4591'>
     &amp;        ,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4592'>
        ENDIF<a name='4593'>
<font color=#447700>! DROPLETS NUCLEATION (END)<a name='4594'></font>
<font color=#447700>! drop nucleation                                               (end)<a name='4595'></font>
<font color=#447700>! nucleation of crystals                                      (begin)<a name='4596'></font>
<a name='4597'>
       IF (ICEPROCS.EQ.1)THEN<a name='4598'>
        DEL2N=100.*SUP2<a name='4599'>
        IF(TPC.LT.0..AND.TPC.GE.-73.16.AND.DEL2N.GT.0.) THEN<a name='4600'>
<a name='4601'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ICE_NUCL'>ICE_NUCL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ICE_NUCL_2"> (PSI2,X2,TT,ROR,SUP2,SUP2_OLD &amp;<a name='4602'>
     &amp;                      ,C1_MEY,C2_MEY,COL,DSUPICEXZ &amp;<a name='4603'>
     &amp;                      ,NKR,ICEMAX)<a name='4604'>
        ENDIF<a name='4605'>
       ENDIF<a name='4606'>
<font color=#447700>! nucleation of crystals                                        (end)<a name='4607'></font>
<font color=#447700>! new change in drop nucleation                               (begin)<a name='4608'></font>
<font color=#447700>! no sink of water vapour by nucleation<a name='4609'></font>
      RETURN<a name='4610'>
      END SUBROUTINE JERNUCL01<a name='4611'>
<a name='4612'>
<font color=#447700>! SUBROUTINE JERNUCL01<a name='4613'></font>
<font color=#447700>!======================================================================      <a name='4614'></font>
<A NAME='WATER_NUCL'><A href='../../html_code/phys/module_mp_full_sbm.F.html#WATER_NUCL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4615'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>WATER_NUCL</font> (PSI1,FCCNR,X1,TT,SUP1 &amp; <A href='../../call_to/WATER_NUCL.html' TARGET='index'>2</A>,<A href='../../call_from/WATER_NUCL.html' TARGET='index'>2</A><a name='4616'>
     &amp;,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4617'>
      IMPLICIT NONE<a name='4618'>
      INTEGER NDROPMAX,KR,ICEMAX,NKR<a name='4619'>
      REAL PSI1(NKR),FCCNR(NKR),X1(NKR)<a name='4620'>
      REAL DROPCONCN(NKR)<a name='4621'>
      REAL RCCN(NKR),DROPRADII(NKR)<a name='4622'>
      REAL TT,SUP1,DX,COL<a name='4623'>
<a name='4624'>
<a name='4625'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION'>NUCLEATION</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#WATER_NUCL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NUCLEATION_2"> (SUP1,TT,FCCNR,DROPCONCN  &amp;<a name='4626'>
     &amp;,NDROPMAX,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4627'>
<a name='4628'>
<font color=#447700>! NEW WATER SIZE DISTRIBUTION FUNCTION (BEGIN)<a name='4629'></font>
        DO KR=1,NDROPMAX<a name='4630'>
           DX=3.*COL*X1(KR)<a name='4631'>
<font color=#447700>! new changes 25.06.01                                        (begin)<a name='4632'></font>
           PSI1(KR)=PSI1(KR)+DROPCONCN(KR)/DX<a name='4633'>
<font color=#447700>! new changes 25.06.01                                          (end)<a name='4634'></font>
        ENDDO<a name='4635'>
<a name='4636'>
      RETURN<a name='4637'>
      END SUBROUTINE WATER_NUCL<a name='4638'>
<A NAME='ICE_NUCL'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ICE_NUCL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4639'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>ICE_NUCL</font> (PSI2,X2,TT,ROR,SUP2,SUP2_OLD &amp; <A href='../../call_to/ICE_NUCL.html' TARGET='index'>2</A><a name='4640'>
     &amp;                      ,C1_MEY,C2_MEY,COL,DSUPICEXZ &amp;<a name='4641'>
     &amp;                      ,NKR,ICEMAX)<a name='4642'>
        IMPLICIT NONE<a name='4643'>
        INTEGER ITYPE,KR,ICE,NRGI,ICEMAX,NKR<a name='4644'>
        REAL DEL2N,SUP2,C1,C2,C1_MEY,C2_MEY,TPC,TT,ROR<a name='4645'>
        REAL DX,COL,BMASS,BFMASS,FMASS<a name='4646'>
        REAL HELEK1,HELEK2,TPCC,DEL2NN,FF1BN,DSUPICEXZ<a name='4647'>
        REAL FACT,DSUP2N,SUP2_OLD,DELTACD,DELTAF,ADDF,FNEW<a name='4648'>
        REAL X2(NKR,ICEMAX),PSI2(NKR,ICEMAX)<a name='4649'>
<a name='4650'>
        REAL A1,B1,A2,B2<a name='4651'>
        DATA A1,B1,A2,B2/-0.639,0.1296,-2.8,0.262/<a name='4652'>
<font color=#447700>!       DATA A1,B1,A2,B2/-0.639,0.15,-2.8,0.262/<a name='4653'></font>
        REAL TEMP1,TEMP2,TEMP3<a name='4654'>
        DATA TEMP1,TEMP2,TEMP3/-5.,-2.,-20./<a name='4655'>
        REAL ICE_CON<a name='4656'>
<a name='4657'>
        C1=C1_MEY<a name='4658'>
        C2=C2_MEY<a name='4659'>
<font color=#447700>! TYPE OF ICE WITH NUCLEATION (BEGIN)<a name='4660'></font>
<a name='4661'>
        TPC=TT-273.15<a name='4662'>
        ITYPE=0<a name='4663'>
<a name='4664'>
        IF((TPC.GT.-4.0).OR.(TPC.LE.-8.1.AND.TPC.GT.-12.7).OR.&amp;<a name='4665'>
     &amp;  (TPC.LE.-17.8.AND.TPC.GT.-22.4)) THEN<a name='4666'>
          ITYPE=2<a name='4667'>
        ELSE<a name='4668'>
          IF((TPC.LE.-4.0.AND.TPC.GT.-8.1).OR.(TPC.LE.-22.4)) THEN<a name='4669'>
            ITYPE=1<a name='4670'>
          ELSE<a name='4671'>
            ITYPE=3<a name='4672'>
          ENDIF<a name='4673'>
        ENDIF<a name='4674'>
<a name='4675'>
<a name='4676'>
<a name='4677'>
<font color=#447700>! NEW CRYSTAL SIZE DISTRIBUTION FUNCTION                      (BEGIN)<a name='4678'></font>
<a name='4679'>
        ICE=ITYPE<a name='4680'>
<a name='4681'>
        NRGI=2<a name='4682'>
        IF(TPC.LT.TEMP1) THEN<a name='4683'>
          DEL2N=100.*SUP2<a name='4684'>
          DEL2NN=DEL2N<a name='4685'>
          IF(DEL2N.GT.50.0) DEL2NN=50.<a name='4686'>
          HELEK1=C1*EXP(A1+B1*DEL2NN)<a name='4687'>
        ELSE<a name='4688'>
          HELEK1=0.<a name='4689'>
        ENDIF<a name='4690'>
<a name='4691'>
        IF(TPC.LT.TEMP2) THEN<a name='4692'>
          TPCC=TPC<a name='4693'>
          IF(TPCC.LT.TEMP3) TPCC=TEMP3<a name='4694'>
          HELEK2=C2*EXP(A2-B2*TPCC)<a name='4695'>
        ELSE<a name='4696'>
          HELEK2=0.<a name='4697'>
        ENDIF<a name='4698'>
<a name='4699'>
        FF1BN=HELEK1+HELEK2<a name='4700'>
<a name='4701'>
        FACT=1.<a name='4702'>
        DSUP2N=(SUP2-SUP2_OLD+DSUPICEXZ)*100.<a name='4703'>
<a name='4704'>
        SUP2_OLD=SUP2<a name='4705'>
<a name='4706'>
        IF(DSUP2N.GT.50.) DSUP2N=50.<a name='4707'>
<a name='4708'>
        DELTACD=FF1BN*B1*DSUP2N<a name='4709'>
<a name='4710'>
        IF(DELTACD.GE.FF1BN) DELTACD=FF1BN<a name='4711'>
<a name='4712'>
        IF(DELTACD.GT.0.) THEN<a name='4713'>
          ICE_CON=0.<a name='4714'>
          DO KR=1,NRGI-1<a name='4715'>
             DX=3.*X2(KR,ICE)*COL<a name='4716'>
             ICE_CON=ICE_CON+DX*PSI2(KR,ICE)<a name='4717'>
          ENDDO<a name='4718'>
          IF(ICE_CON.GT.HELEK1)THEN<a name='4719'>
<font color=#447700>!           CONTINUE<a name='4720'></font>
          ELSE <a name='4721'>
           DELTAF=DELTACD*FACT<a name='4722'>
           DO KR=1,NRGI-1<a name='4723'>
             DX=3.*X2(KR,ICE)*COL<a name='4724'>
             ADDF=DELTAF/DX<a name='4725'>
             PSI2(KR,ICE)=PSI2(KR,ICE)+ADDF<a name='4726'>
           ENDDO<a name='4727'>
          END IF<a name='4728'>
        ENDIF<a name='4729'>
<font color=#447700>! NEW CRYSTAL SIZE DISTRIBUTION FUNCTION                        (END)<a name='4730'></font>
       RETURN<a name='4731'>
       END SUBROUTINE ICE_NUCL<a name='4732'>
<a name='4733'>
<a name='4734'>
<a name='4735'>
<a name='4736'>
<a name='4737'>
<A NAME='NUCLEATION'><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4738'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>NUCLEATION</font> (SUP1,TT,FCCNR,DROPCONCN  &amp; <A href='../../call_to/NUCLEATION.html' TARGET='index'>2</A>,<A href='../../call_from/NUCLEATION.html' TARGET='index'>14</A><a name='4739'>
     &amp;,NDROPMAX,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4740'>
<font color=#447700>! DROPCONCN(KR), 1/cm^3 - drop bin concentrations, KR=1,...,NKR<a name='4741'></font>
<a name='4742'>
<font color=#447700>! determination of new size spectra due to drop nucleation<a name='4743'></font>
<a name='4744'>
      IMPLICIT NONE<a name='4745'>
      INTEGER NDROPMAX,IDROP,ICCN,INEXT,ISMALL,KR,NCRITI<a name='4746'>
      INTEGER ICEMAX,IMIN,IMAX,NKR,I,II,I0,I1<a name='4747'>
      REAL &amp;<a name='4748'>
     &amp;  SUP1,TT,RACTMAX,XKOE,R03,SUPCRITI,AKOE23,RCRITI,BKOE, &amp;<a name='4749'>
     &amp;  AKOE,CONCCCNIN,DEG01,ALN_IP<a name='4750'>
      REAL CCNCONC(NKR)<a name='4751'>
      REAL CCNCONC_BFNUCL<a name='4752'>
<a name='4753'>
<a name='4754'>
      REAL COL<a name='4755'>
      REAL RCCN(NKR),DROPRADII(NKR),FCCNR(NKR)<a name='4756'>
      REAL RACT(NKR),DROPCONC(NKR),DROPCONCN(NKR)<a name='4757'>
      REAL DLN1,DLN2,FOLD_IP<a name='4758'>
<a name='4759'>
<a name='4760'>
<a name='4761'>
        DEG01=1./3.<a name='4762'>
<a name='4763'>
<a name='4764'>
<font color=#447700>! calculation initial value of NDROPMAX - maximal number of drop bin<a name='4765'></font>
<font color=#447700>! which is activated<a name='4766'></font>
<a name='4767'>
<font color=#447700>! initial value of NDROPMAX<a name='4768'></font>
<a name='4769'>
        NDROPMAX=0<a name='4770'>
<a name='4771'>
        DO KR=1,NKR<a name='4772'>
<font color=#447700>! initialization of bin radii of activated drops<a name='4773'></font>
           RACT(KR)=0.<a name='4774'>
<font color=#447700>! initialization of aerosol(CCN) bin concentrations<a name='4775'></font>
           CCNCONC(KR)=0.<a name='4776'>
<font color=#447700>! initialization of drop bin concentrations<a name='4777'></font>
           DROPCONCN(KR)=0.<a name='4778'>
        ENDDO<a name='4779'>
<a name='4780'>
<a name='4781'>
<font color=#447700>! CCNCONC_BFNUCL - concentration of aerosol particles before<a name='4782'></font>
<font color=#447700>!                  nucleation<a name='4783'></font>
<a name='4784'>
        CCNCONC_BFNUCL=0.<a name='4785'>
        DO I=1,NKR<a name='4786'>
           CCNCONC_BFNUCL=CCNCONC_BFNUCL+FCCNR(I)<a name='4787'>
        ENDDO<a name='4788'>
<a name='4789'>
        CCNCONC_BFNUCL=CCNCONC_BFNUCL*COL<a name='4790'>
<a name='4791'>
        IF(CCNCONC_BFNUCL.EQ.0.) THEN<a name='4792'>
           RETURN    <a name='4793'>
        ELSE<a name='4794'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDARY'>BOUNDARY</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BOUNDARY_2">(IMIN,IMAX,FCCNR,NKR)<a name='4795'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CRITICAL'>CRITICAL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CRITICAL_2"> (AKOE,BKOE,TT,RCRITI,SUP1,DEG01)<a name='4796'>
           IF(RCRITI.GE.RCCN(IMAX))  RETURN<a name='4797'>
        END IF<a name='4798'>
<a name='4799'>
<font color=#447700>! calculation of CCNCONC(I) - aerosol(CCN) bin concentrations;<a name='4800'></font>
<font color=#447700>!                             I=IMIN,...,IMAX<a name='4801'></font>
<font color=#447700>! determination of NCRITI - number bin in which is located RCRITI<a name='4802'></font>
        IF (IMIN.EQ.1)THEN<a name='4803'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNIMIN'>CCNIMIN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNIMIN_2">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4804'>
     &amp;       FCCNR,NKR)<a name='4805'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNLOOP'>CCNLOOP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNLOOP_3">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4806'>
     &amp;       FCCNR,NKR)<a name='4807'>
        ELSE<a name='4808'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNLOOP'>CCNLOOP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNLOOP_4">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4809'>
     &amp;       FCCNR,NKR)<a name='4810'>
        END IF<a name='4811'>
<a name='4812'>
<a name='4813'>
<font color=#447700>! calculation CCNCONC_AFNUCL - ccn concentration after nucleation<a name='4814'></font>
<a name='4815'>
<font color=#447700>!       CCNCONC_AFNUCL=0.<a name='4816'></font>
<a name='4817'>
<font color=#447700>!       DO I=IMIN,IMAX<a name='4818'></font>
<font color=#447700>!          CCNCONC_AFNUCL=CCNCONC_AFNUCL+FCCNR(I)<a name='4819'></font>
<font color=#447700>!       ENDDO<a name='4820'></font>
<a name='4821'>
<font color=#447700>!       CCNCONC_AFNUCL=CCNCONC_AFNUCL*COL<a name='4822'></font>
<a name='4823'>
<font color=#447700>! calculation DEL_CCNCONC<a name='4824'></font>
<a name='4825'>
<font color=#447700>!       DEL_CCNCONC=CCNCONC_BFNUCL-CCNCONC_AFNUCL<a name='4826'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ACTIVATE'>ACTIVATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ACTIVATE_6">(IMIN,IMAX,AKOE,BKOE,RCCN,RACT,RACTMAX,NKR)<a name='4827'>
<a name='4828'>
<a name='4829'>
<a name='4830'>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#DROPMAX'>DROPMAX</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DROPMAX_2">(DROPRADII,RACTMAX,NDROPMAX,NKR)<a name='4831'>
<font color=#447700>! put nucleated droplets into the drop bin according to radius<a name='4832'></font>
<font color=#447700>! change in drop concentration due to activation DROPCONCN(IDROP)<a name='4833'></font>
        ISMALL=NCRITI<a name='4834'>
<a name='4835'>
        INEXT=ISMALL<a name='4836'>
<font color=#447700>!       ISMALL=1<a name='4837'></font>
<a name='4838'>
<font color=#447700>!       INEXT=ISMALL<a name='4839'></font>
<a name='4840'>
        DO IDROP=1,NDROPMAX<a name='4841'>
           DROPCONCN(IDROP)=0.<a name='4842'>
           DO I=ISMALL,IMAX<a name='4843'>
              IF(RACT(I).LE.DROPRADII(IDROP)) THEN<a name='4844'>
                DROPCONCN(IDROP)=DROPCONCN(IDROP)+CCNCONC(I)<a name='4845'>
                INEXT=I+1<a name='4846'>
              ENDIF<a name='4847'>
           ENDDO<a name='4848'>
           ISMALL=INEXT<a name='4849'>
        ENDDO<a name='4850'>
<a name='4851'>
<font color=#447700>!999    CONTINUE<a name='4852'></font>
<a name='4853'>
<a name='4854'>
        RETURN<a name='4855'>
        END SUBROUTINE NUCLEATION<a name='4856'>
<a name='4857'>
<a name='4858'>
<a name='4859'>
<A NAME='BOUNDARY'><A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4860'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>BOUNDARY</font>(IMIN,IMAX,FCCNR,NKR) <A href='../../call_to/BOUNDARY.html' TARGET='index'>2</A><a name='4861'>
<font color=#447700>! IMIN - left CCN spectrum boundary<a name='4862'></font>
        IMPLICIT NONE<a name='4863'>
        INTEGER I,IMIN,IMAX,NKR<a name='4864'>
        REAL FCCNR(NKR)<a name='4865'>
<a name='4866'>
        IMIN=0<a name='4867'>
<a name='4868'>
        DO I=1,NKR<a name='4869'>
           IF(FCCNR(I).NE.0.) THEN<a name='4870'>
             IMIN=I<a name='4871'>
             GOTO 40<a name='4872'>
           ENDIF<a name='4873'>
        ENDDO<a name='4874'>
<a name='4875'>
 40     CONTINUE<a name='4876'>
<a name='4877'>
<font color=#447700>! IMAX - right CCN spectrum boundary<a name='4878'></font>
<a name='4879'>
        IMAX=0<a name='4880'>
<a name='4881'>
        DO I=NKR,1,-1<a name='4882'>
           IF(FCCNR(I).NE.0.) THEN<a name='4883'>
             IMAX=I<a name='4884'>
             GOTO 41<a name='4885'>
           ENDIF<a name='4886'>
        ENDDO<a name='4887'>
<a name='4888'>
 41     CONTINUE<a name='4889'>
        RETURN<a name='4890'>
        END  SUBROUTINE BOUNDARY<a name='4891'>
<a name='4892'>
<A NAME='CRITICAL'><A href='../../html_code/phys/module_mp_full_sbm.F.html#CRITICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4893'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CRITICAL</font> (AKOE,BKOE,TT,RCRITI,SUP1,DEG01) <A href='../../call_to/CRITICAL.html' TARGET='index'>2</A><a name='4894'>
<font color=#447700>! AKOE &amp; BKOE - constants in Koehler equation<a name='4895'></font>
        IMPLICIT NONE<a name='4896'>
        REAL AKOE,BKOE,TT,RCRITI,SUP1,DEG01<a name='4897'>
        REAL RO_SOLUTE<a name='4898'>
        PARAMETER (RO_SOLUTE=2.16)<a name='4899'>
<a name='4900'>
         <a name='4901'>
<a name='4902'>
        AKOE=3.3E-05/TT<a name='4903'>
        BKOE=2.*4.3/(22.9+35.5)<a name='4904'>
<font color=#447700>! new change 21.07.02                                         (begin)<a name='4905'></font>
        BKOE=BKOE*(4./3.)*3.141593*RO_SOLUTE                  <a name='4906'>
<font color=#447700>! new change 21.07.02                                           (end)<a name='4907'></font>
        <a name='4908'>
<a name='4909'>
<font color=#447700>! table of critical aerosol radii<a name='4910'></font>
<a name='4911'>
<font color=#447700>!	GOTO 992<a name='4912'></font>
<a name='4913'>
<font color=#447700>! SUP1_TEST(I), %<a name='4914'></font>
<font color=#447700>!       SUP1_TEST(1)=0.01<a name='4915'></font>
<font color=#447700>!       DO I=1,99<a name='4916'></font>
<font color=#447700>!          SUP1_TEST(I+1)=SUP1_TEST(I)+0.01<a name='4917'></font>
<font color=#447700>!          SUP1_I=SUP1_TEST(I)*0.01<a name='4918'></font>
<font color=#447700>!          RCRITI_TEST(I)=(AKOE/3.)*(4./BKOE/SUP1_I/SUP1_I)**DEG01<a name='4919'></font>
<font color=#447700>!       ENDDO<a name='4920'></font>
<a name='4921'>
<font color=#447700>! RCRITI, cm - critical radius of "dry" aerosol<a name='4922'></font>
<a name='4923'>
        RCRITI=(AKOE/3.)*(4./BKOE/SUP1/SUP1)**DEG01<a name='4924'>
        RETURN<a name='4925'>
        END  SUBROUTINE CRITICAL<a name='4926'>
            <a name='4927'>
<A NAME='CCNIMIN'><A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNIMIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4928'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CCNIMIN</font>(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp; <A href='../../call_to/CCNIMIN.html' TARGET='index'>2</A><a name='4929'>
     &amp;       FCCNR,NKR)<a name='4930'>
<font color=#447700>! FOR    IMIN=1<a name='4931'></font>
        IMPLICIT NONE<a name='4932'>
        INTEGER IMIN,II,IMAX,NCRITI,NKR<a name='4933'>
        REAL RCRITI,COL<a name='4934'>
        REAL RCCN(NKR),FCCNR(NKR),CCNCONC(NKR)<a name='4935'>
        REAL RCCN_MIN<a name='4936'>
        REAL DLN1,DLN2,FOLD_IP<a name='4937'>
<font color=#447700>! rccn_min - minimum aerosol(ccn) radius<a name='4938'></font>
        RCCN_MIN=RCCN(1)/10000.<a name='4939'>
<font color=#447700>! calculation of ccnconc(ii)=fccnr(ii)*col - aerosol(ccn) bin<a name='4940'></font>
<font color=#447700>!                                            concentrations,<a name='4941'></font>
<font color=#447700>!                                            ii=imin,...,imax<a name='4942'></font>
<font color=#447700>! determination of ncriti   - number bin in which is located rcriti<a name='4943'></font>
<font color=#447700>! calculation of ccnconc(ncriti)=fccnr(ncriti)*dln1/(dln1+dln2),<a name='4944'></font>
<font color=#447700>! where,    <a name='4945'></font>
<font color=#447700>! dln1=Ln(rcriti)-Ln(rccn_min)<a name='4946'></font>
<font color=#447700>! dln2=Ln(rccn(1)-Ln(rcriti)<a name='4947'></font>
<font color=#447700>! calculation of new value of fccnr(ncriti)<a name='4948'></font>
<a name='4949'>
<font color=#447700>!       IF(IMIN.EQ.1) THEN<a name='4950'></font>
          IF(RCRITI.LE.RCCN_MIN) THEN<a name='4951'>
            NCRITI=1<a name='4952'>
            DO II=NCRITI+1,IMAX<a name='4953'>
               CCNCONC(II)=COL*FCCNR(II)     <a name='4954'>
               FCCNR(II)=0.                  <a name='4955'>
            ENDDO<a name='4956'>
            GOTO 42<a name='4957'>
          ENDIF<a name='4958'>
          IF(RCRITI.GT.RCCN_MIN.AND.RCRITI.LT.RCCN(IMIN)) THEN<a name='4959'>
            NCRITI=1<a name='4960'>
            DO II=NCRITI+1,IMAX<a name='4961'>
               CCNCONC(II)=COL*FCCNR(II)<a name='4962'>
               FCCNR(II)=0.<a name='4963'>
            ENDDO<a name='4964'>
            DLN1=ALOG(RCRITI)-ALOG(RCCN_MIN)<a name='4965'>
            DLN2=ALOG(RCCN(1))-ALOG(RCRITI)<a name='4966'>
            CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='4967'>
            FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/(DLN1+DLN2)<a name='4968'>
            GOTO 42<a name='4969'>
<font color=#447700>! in case RCRITI.GT.RCCN_MIN.AND.RCRITI.LT.RCCN(IMIN)<a name='4970'></font>
          ENDIF<a name='4971'>
<font color=#447700>! in case IMIN.EQ.1<a name='4972'></font>
42       CONTINUE<a name='4973'>
     <a name='4974'>
         RETURN<a name='4975'>
         END SUBROUTINE CCNIMIN<a name='4976'>
<A NAME='CCNLOOP'><A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNLOOP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4977'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CCNLOOP</font>(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp; <A href='../../call_to/CCNLOOP.html' TARGET='index'>4</A><a name='4978'>
     &amp;       FCCNR,NKR)<a name='4979'>
        IMPLICIT NONE<a name='4980'>
         INTEGER I,IMIN,IMAX,NKR,II,NCRITI<a name='4981'>
         REAL COL<a name='4982'>
         REAL RCRITI,RCCN(NKR),CCNCONC(NKR),FCCNR(NKR)<a name='4983'>
         REAL DLN1,DLN2,FOLD_IP<a name='4984'>
        IF(IMIN.GT.1) THEN<a name='4985'>
          IF(RCRITI.LE.RCCN(IMIN-1)) THEN<a name='4986'>
            NCRITI=IMIN<a name='4987'>
            DO II=NCRITI,IMAX<a name='4988'>
               CCNCONC(II)=COL*FCCNR(II)<a name='4989'>
               FCCNR(II)=0.<a name='4990'>
            ENDDO<a name='4991'>
            GOTO 42<a name='4992'>
          ENDIF<a name='4993'>
          IF(RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)) &amp;<a name='4994'>
     &amp;    THEN<a name='4995'>
<font color=#447700>! this line eliminates bug you found (when IMIN=IMAX)<a name='4996'></font>
            NCRITI=IMIN<a name='4997'>
            <a name='4998'>
            DO II=NCRITI+1,IMAX<a name='4999'>
               CCNCONC(II)=COL*FCCNR(II)<a name='5000'>
               FCCNR(II)=0.<a name='5001'>
            ENDDO<a name='5002'>
            DLN1=ALOG(RCRITI)-ALOG(RCCN(IMIN-1))<a name='5003'>
            DLN2=COL-DLN1<a name='5004'>
            CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='5005'>
            FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/COL<a name='5006'>
            GOTO 42<a name='5007'>
<font color=#447700>! in case RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)<a name='5008'></font>
          ENDIF<a name='5009'>
<font color=#447700>! in case IMIN.GT.1<a name='5010'></font>
        ENDIF<a name='5011'>
        <a name='5012'>
<font color=#447700>! END of part of interest. so in case<a name='5013'></font>
<font color=#447700>!RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)<a name='5014'></font>
<font color=#447700>!we go to 42 and avoid the next loop<a name='5015'></font>
<a name='5016'>
      <a name='5017'>
<a name='5018'>
         DO I=IMIN,IMAX-1<a name='5019'>
           IF(RCRITI.EQ.RCCN(I)) THEN<a name='5020'>
             NCRITI=I+1<a name='5021'>
             DO II=I+1,IMAX<a name='5022'>
                CCNCONC(II)=COL*FCCNR(II)<a name='5023'>
                FCCNR(II)=0.<a name='5024'>
             ENDDO<a name='5025'>
             GOTO 42<a name='5026'>
           ENDIF<a name='5027'>
           IF(RCRITI.GT.RCCN(I).AND.RCRITI.LT.RCCN(I+1)) THEN<a name='5028'>
             NCRITI=I+1<a name='5029'>
             IF(I.NE.IMAX-1) THEN<a name='5030'>
               DO II=NCRITI+1,IMAX<a name='5031'>
                  CCNCONC(II)=COL*FCCNR(II)<a name='5032'>
                  FCCNR(II)=0.<a name='5033'>
               ENDDO<a name='5034'>
             ENDIF<a name='5035'>
             DLN1=ALOG(RCRITI)-ALOG(RCCN(I))<a name='5036'>
             DLN2=COL-DLN1<a name='5037'>
             CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='5038'>
             FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/COL<a name='5039'>
             GOTO 42<a name='5040'>
<font color=#447700>! in case RCRITI.GT.RCCN(I).AND.RCRITI.LT.RCCN(I+1)<a name='5041'></font>
           END IF<a name='5042'>
      <a name='5043'>
<a name='5044'>
         ENDDO<a name='5045'>
<font color=#447700>! cycle by I, I=IMIN,...,IMAX-1<a name='5046'></font>
<a name='5047'>
  42    CONTINUE<a name='5048'>
        RETURN<a name='5049'>
        END  SUBROUTINE CCNLOOP<a name='5050'>
<A NAME='ACTIVATE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ACTIVATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5051'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>ACTIVATE</font>(IMIN,IMAX,AKOE,BKOE,RCCN,RACT,RACTMAX,NKR) <A href='../../call_to/ACTIVATE.html' TARGET='index'>6</A>,<A href='../../call_from/ACTIVATE.html' TARGET='index'>14</A><a name='5052'>
       IMPLICIT NONE<a name='5053'>
<a name='5054'>
       INTEGER IMIN,IMAX,NKR<a name='5055'>
       INTEGER I,I0,I1<a name='5056'>
       REAL RCCN(NKR)<a name='5057'>
        REAL  R03,SUPCRITI,RACT(NKR),XKOE<a name='5058'>
        REAL AKOE,BKOE,AKOE23,RACTMAX<a name='5059'>
<font color=#447700>! Spectrum of activated drops                                 (begin) <a name='5060'></font>
        DO I=IMIN,IMAX<a name='5061'>
<a name='5062'>
<font color=#447700>! critical water supersaturations appropriating CCN radii<a name='5063'></font>
<a name='5064'>
           XKOE=(4./27.)*(AKOE**3/BKOE)<a name='5065'>
           AKOE23=AKOE*2./3.<a name='5066'>
           R03=RCCN(I)**3<a name='5067'>
           SUPCRITI=SQRT(XKOE/R03)<a name='5068'>
<a name='5069'>
<font color=#447700>! RACT(I) - radii of activated drops, I=IMIN,...,IMAX<a name='5070'></font>
<a name='5071'>
           IF(RCCN(I).LE.(0.3E-5)) &amp;<a name='5072'>
     &amp;     RACT(I)=AKOE23/SUPCRITI<a name='5073'>
           IF(RCCN(I).GT.(0.3E-5))&amp;<a name='5074'>
     &amp;     RACT(I)=5.*RCCN(I)<a name='5075'>
        ENDDO<a name='5076'>
<font color=#447700>! cycle by I<a name='5077'></font>
<a name='5078'>
<font color=#447700>! calculation of I0<a name='5079'></font>
<a name='5080'>
        I0=IMIN<a name='5081'>
<a name='5082'>
        DO I=IMIN,IMAX-1<a name='5083'>
           IF(RACT(I+1).LT.RACT(I)) THEN<a name='5084'>
             I0=I+1<a name='5085'>
             GOTO 45<a name='5086'>
           ENDIF<a name='5087'>
        ENDDO<a name='5088'>
<a name='5089'>
 45     CONTINUE<a name='5090'>
<font color=#447700>! new changes 9.04.02                                         (begin)<a name='5091'></font>
        I1=I0-1<a name='5092'>
<font color=#447700>! new changes 9.04.02                                           (end)<a name='5093'></font>
<a name='5094'>
        IF(I0.EQ.IMIN) GOTO 47<a name='5095'>
<a name='5096'>
<font color=#447700>! new changes 9.04.02                                         (begin)<a name='5097'></font>
<a name='5098'>
        IF(I0.EQ.IMAX) THEN<a name='5099'>
          RACT(IMAX)=RACT(IMAX-1)<a name='5100'>
          GOTO 47<a name='5101'>
        ENDIF<a name='5102'>
<a name='5103'>
        IF(RACT(IMAX).LE.RACT(I0-1)) THEN<a name='5104'>
          DO I=I0,IMAX<a name='5105'>
             RACT(I)=RACT(I0-1)<a name='5106'>
          ENDDO<a name='5107'>
          GOTO 47<a name='5108'>
        ENDIF<a name='5109'>
<a name='5110'>
<font color=#447700>! new changes 9.04.02                                           (end)<a name='5111'></font>
<a name='5112'>
<a name='5113'>
<a name='5114'>
<font color=#447700>! calculation of I1<a name='5115'></font>
<a name='5116'>
        DO I=I0+1,IMAX<a name='5117'>
           IF(RACT(I).GE.RACT(I0-1)) THEN<a name='5118'>
             I1=I<a name='5119'>
             GOTO 46<a name='5120'>
           ENDIF<a name='5121'>
        ENDDO<a name='5122'>
 46     CONTINUE<a name='5123'>
<a name='5124'>
<font color=#447700>! spectrum of activated drops                                   (end)<a name='5125'></font>
<a name='5126'>
<a name='5127'>
<font color=#447700>! line interpolation RACT(I) for I=I0,...,I1<a name='5128'></font>
<a name='5129'>
        DO I=I0,I1<a name='5130'>
           RACT(I)=RACT(I0-1)+(I-I0+1)*(RACT(I1)-RACT(I0-1)) &amp;<a name='5131'>
     &amp;                       /(I1-I0+1)<a name='5132'>
        ENDDO<a name='5133'>
<a name='5134'>
<a name='5135'>
  47    CONTINUE<a name='5136'>
<a name='5137'>
<a name='5138'>
<a name='5139'>
        RACTMAX=0.<a name='5140'>
<a name='5141'>
        DO I=IMIN,IMAX<a name='5142'>
           RACTMAX=AMAX1(RACTMAX,RACT(I))<a name='5143'>
	ENDDO<a name='5144'>
        RETURN<a name='5145'>
<a name='5146'>
        END SUBROUTINE ACTIVATE<a name='5147'>
<A NAME='DROPMAX'><A href='../../html_code/phys/module_mp_full_sbm.F.html#DROPMAX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5148'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>DROPMAX</font>(DROPRADII,RACTMAX,NDROPMAX,NKR) <A href='../../call_to/DROPMAX.html' TARGET='index'>2</A><a name='5149'>
        IMPLICIT NONE<a name='5150'>
        INTEGER IDROP,NKR,NDROPMAX<a name='5151'>
        REAL RACTMAX,DROPRADII(NKR)<a name='5152'>
<font color=#447700>! calculation of NDROPMAX - maximal number of drop bin which<a name='5153'></font>
<font color=#447700>! is activated<a name='5154'></font>
<a name='5155'>
        NDROPMAX=1<a name='5156'>
<a name='5157'>
        DO IDROP=1,NKR<a name='5158'>
           IF(RACTMAX.LE.DROPRADII(IDROP)) THEN<a name='5159'>
             NDROPMAX=IDROP<a name='5160'>
             GOTO 44<a name='5161'>
           ENDIF<a name='5162'>
        ENDDO<a name='5163'>
 44     CONTINUE<a name='5164'>
        RETURN<a name='5165'>
        END  SUBROUTINE DROPMAX<a name='5166'>
<a name='5167'>
<a name='5168'>
<A NAME='ONECOND1'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5169'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND1</font> &amp; <A href='../../call_to/ONECOND1.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND1.html' TARGET='index'>26</A><a name='5170'>
     &amp; (TT,QQ,PP,ROR &amp;<a name='5171'>
     &amp; ,VR1,PSINGLE &amp;<a name='5172'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='5173'>
     &amp; ,FF1,PSI1,R1,RLEC,RO1BL &amp;<a name='5174'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='5175'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='5176'>
     &amp; ,COL,DTCOND,ICEMAX,NKR)<a name='5177'>
<a name='5178'>
       IMPLICIT NONE<a name='5179'>
<a name='5180'>
<a name='5181'>
      INTEGER NKR,ICEMAX<a name='5182'>
      REAL    COL,VR1(NKR),PSINGLE &amp;<a name='5183'>
     &amp;       ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='5184'>
     &amp;       ,DTCOND<a name='5185'>
<a name='5186'>
      REAL C1_MEY,C2_MEY<a name='5187'>
      INTEGER I_ABERGERON,I_BERGERON, &amp;<a name='5188'>
     &amp; KR,ICE,ITIME,KCOND,NR,NRM, &amp;<a name='5189'>
     &amp; KLIMIT, &amp;<a name='5190'>
     &amp; KM,KLIMITL  <a name='5191'>
      REAL AL1,AL2,D,GAM,POD, &amp;<a name='5192'>
     &amp; RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY,ALC,DT0LREF,DTLREF, &amp;<a name='5193'>
     &amp; A1_MYN, BB1_MYN, A2_MYN, BB2_MYN,DT,DTT,XRAD, &amp;<a name='5194'>
     &amp; TPC1, TPC2, TPC3, TPC4, TPC5, &amp;<a name='5195'>
     &amp; EPSDEL, EPSDEL2,DT0L, DT0I,&amp;<a name='5196'>
     &amp; ROR, &amp;<a name='5197'>
     &amp; CWHUCM,B6,B8L,B8I, &amp;<a name='5198'>
     &amp; DEL1,DEL2,DEL1S,DEL2S, &amp;<a name='5199'>
     &amp; TIMENEW,TIMEREV,SFN11,SFN12, &amp;<a name='5200'>
     &amp; SFNL,SFNI,B5L,B5I,B7L,B7I,DOPL,DOPI,RW,RI,QW,PW, &amp;<a name='5201'>
     &amp; PI,QI,DEL1N0,DEL2N0,D1N0,D2N0,DTNEWL,DTNEWL1,D1N,D2N, &amp;<a name='5202'>
     &amp; DEL_R1,DT0L0,DT0I0, &amp;<a name='5203'>
     &amp; DTNEWL0, &amp;<a name='5204'>
     &amp; DTNEWL2 <a name='5205'>
       REAL DT_WATER_COND,DT_WATER_EVAP<a name='5206'>
<a name='5207'>
       INTEGER K<a name='5208'>
<font color=#447700>! NEW ALGORITHM OF CONDENSATION (12.01.00)<a name='5209'></font>
<a name='5210'>
      REAL  FF1_OLD(NKR),SUPINTW(NKR)<a name='5211'>
      DOUBLE PRECISION DSUPINTW(NKR),DD1N,DB11_MY,DAL1,DAL2<a name='5212'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='5213'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='5214'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='5215'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='5216'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='5217'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='5218'>
     &amp;                  ,TT,QQ,PP &amp;<a name='5219'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='5220'>
     &amp;                  ,OPER2,OPER3,AR1,AR2<a name='5221'>
<a name='5222'>
       DOUBLE PRECISION DELMASSL1<a name='5223'>
<a name='5224'>
<font color=#447700>! DROPLETS <a name='5225'></font>
                                                                       <a name='5226'>
        REAL R1(NKR) &amp;<a name='5227'>
     &amp;           ,RLEC(NKR),RO1BL(NKR) &amp;<a name='5228'>
     &amp;           ,FI1(NKR),FF1(NKR),PSI1(NKR) &amp;<a name='5229'>
     &amp;           ,B11_MY(NKR),B12_MY(NKR)<a name='5230'>
<a name='5231'>
<font color=#447700>! WORK ARRAYS <a name='5232'></font>
<a name='5233'>
<font color=#447700>! NEW ALGORITHM OF MIXED PHASE FOR EVAPORATION<a name='5234'></font>
<a name='5235'>
       <a name='5236'>
	REAL DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='5237'>
     &amp;           ,TIMESTEPD(NKR)<a name='5238'>
<a name='5239'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='5240'></font>
<a name='5241'>
<a name='5242'>
<a name='5243'>
	OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='5244'>
	OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='5245'>
<a name='5246'>
        DATA AL1 /2500./, AL2 /2834./, D /0.211/ &amp;<a name='5247'>
     &amp;      ,GAM /1.E-4/, POD /10./ <a name='5248'>
           <a name='5249'>
	DATA RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY &amp;<a name='5250'>
     &amp;      /461.5,0.24E-1,0.211E-4,2.5E6,2.834E6/<a name='5251'>
<a name='5252'>
	DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='5253'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='5254'>
<a name='5255'>
	DATA TPC1, TPC2, TPC3, TPC4, TPC5 &amp;<a name='5256'>
     &amp;      /-4.0,-8.1,-12.7,-17.8,-22.4/ <a name='5257'>
<a name='5258'>
<a name='5259'>
        DATA EPSDEL, EPSDEL2 /0.1E-03,0.1E-03/  <a name='5260'>
    <a name='5261'>
	DATA DT0L, DT0I /1.E20,1.E20/<a name='5262'>
<a name='5263'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='5264'></font>
<a name='5265'>
<a name='5266'>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS IN MIXED PHASE: EVAPORATION<a name='5267'></font>
        <a name='5268'>
        I_ABERGERON=0<a name='5269'>
        I_BERGERON=0<a name='5270'>
        COL3=3.0*COL<a name='5271'>
        ITIME=0<a name='5272'>
        KCOND=0<a name='5273'>
        DT_WATER_COND=0.4<a name='5274'>
        DT_WATER_EVAP=0.4<a name='5275'>
	ITIME=0<a name='5276'>
	KCOND=0<a name='5277'>
        DT0LREF=0.2<a name='5278'>
        DTLREF=0.4<a name='5279'>
<a name='5280'>
	NR=NKR<a name='5281'>
	NRM=NKR-1<a name='5282'>
	DT=DTCOND<a name='5283'>
	DTT=DTCOND<a name='5284'>
	XRAD=0.<a name='5285'>
<a name='5286'>
<font color=#447700>!     BARRY<a name='5287'></font>
	CWHUCM=0.<a name='5288'>
	XRAD=0.<a name='5289'>
	B6=CWHUCM*GAM-XRAD<a name='5290'>
	B8L=1./ROR<a name='5291'>
	B8I=1./ROR<a name='5292'>
        RORI=1./ROR<a name='5293'>
<a name='5294'>
<font color=#447700>! INITIALIZATION OF SOME ARRAYS<a name='5295'></font>
<font color=#447700>!       print*, 'got to here 0'<a name='5296'></font>
<a name='5297'>
<font color=#447700>!       BARRY: REMOVE RS2 LOOP<a name='5298'></font>
        DO KR=1,NKR<a name='5299'>
           FF1_OLD(KR)=FF1(KR)<a name='5300'>
           SUPINTW(KR)=0.<a name='5301'>
           DSUPINTW(KR)=0.<a name='5302'>
        ENDDO<a name='5303'>
<font color=#447700>! OLD TREATMENT OF "T" &amp; "Q" <a name='5304'></font>
<font color=#447700>!DEL12RD=DEL12R**DEL_BBR<a name='5305'></font>
<font color=#447700>! BARRY<a name='5306'></font>
<font color=#447700>!       EW1PN=AA1_MY*(100.+DEL1IN*100.)*DEL12RD/100.<a name='5307'></font>
<font color=#447700>! 	QQIN=OPER4(EW1PN,PP)<a name='5308'></font>
        TPN=TT<a name='5309'>
        QPN=QQ<a name='5310'>
        DO 19 KR=1,NKR<a name='5311'>
              FI1(KR)=FF1(KR)<a name='5312'>
19     CONTINUE<a name='5313'>
<font color=#447700>! WARM OR NO ICE (BEGIN)<a name='5314'></font>
<font color=#447700>! ONLY WATER (CONDENSATION OR EVAPORATION) (BEGIN)<a name='5315'></font>
              TIMENEW=0.<a name='5316'>
              ITIME=0<a name='5317'>
<font color=#447700>! NEW CHANGES 10.01.01 (BEGIN)<a name='5318'></font>
              TOLD=TPN<a name='5319'>
              QOLD=QPN<a name='5320'>
<font color=#447700>! NEW CHANGES 10.01.01 (END)<a name='5321'></font>
   56         ITIME=ITIME+1<a name='5322'>
              TIMEREV=DT-TIMENEW<a name='5323'>
              TIMEREV=DT-TIMENEW<a name='5324'>
              DEL1=DEL1N<a name='5325'>
              DEL2=DEL2N<a name='5326'>
              DEL1S=DEL1N<a name='5327'>
              DEL2S=DEL2N<a name='5328'>
              TPS=TPN<a name='5329'>
              QPS=QPN<a name='5330'>
<font color=#447700>! NO QPS IN JERRATE<a name='5331'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_11">(R1,TPS,PP,ROR,VR1,PSINGLE &amp;<a name='5332'>
     &amp;                    ,RLEC,RO1BL,B11_MY,B12_MY,1,1,ICEMAX,NKR)<a name='5333'>
<a name='5334'>
<font color=#447700>! INTEGRALS IN DELTA EQUATION (ONLY WATER)<a name='5335'></font>
<a name='5336'>
<font color=#447700>! CONTROL OF DROP SPECRUM IN SUBROUTINE ONECOND<a name='5337'></font>
<a name='5338'>
<a name='5339'>
<font color=#447700>! CALL JERTIMESC WATER - 1 (ONLY WATER)<a name='5340'></font>
<a name='5341'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_9">(FI1,R1,SFN11,SFN12 &amp;<a name='5342'>
     &amp;                      ,B11_MY,B12_MY,RLEC,B8L,1,COL,NKR)        <a name='5343'>
<a name='5344'>
<a name='5345'>
	      SFNL=SFN11+SFN12<a name='5346'>
	      SFNI=0.       <a name='5347'>
<a name='5348'>
<font color=#447700>! SOME CONSTANTS <a name='5349'></font>
	      B5L=BB1_MY/TPS/TPS<a name='5350'>
	      B5I=BB2_MY/TPS/TPS<a name='5351'>
              B7L=B5L*B6                                                     <a name='5352'>
              B7I=B5I*B6<a name='5353'>
	      DOPL=1.+DEL1S                                                     <a name='5354'>
	      DOPI=1.+DEL2S                                                     <a name='5355'>
              RW=(OPER2(QPS)+B5L*AL1)*DOPL*SFNL                                                 <a name='5356'>
              RI=(OPER2(QPS)+B5L*AL2)*DOPL*SFNI<a name='5357'>
	      QW=B7L*DOPL<a name='5358'>
	      PW=(OPER2(QPS)+B5I*AL1)*DOPI*SFNL<a name='5359'>
              PI=(OPER2(QPS)+B5I*AL2)*DOPI*SFNI<a name='5360'>
              QI=B7I*DOPI<a name='5361'>
<a name='5362'>
<font color=#447700>! SOLVING FOR TIMEZERO<a name='5363'></font>
<a name='5364'>
<a name='5365'>
<a name='5366'>
	      KCOND=10<a name='5367'>
<a name='5368'>
	      IF(DEL1.GT.0) KCOND=11<a name='5369'>
<a name='5370'>
<font color=#447700>! PROCESS'S TYPE <a name='5371'></font>
<a name='5372'>
	      IF(KCOND.EQ.11) THEN<a name='5373'>
<font color=#447700>! NEW TIME STEP IN CONDENSATION (ONLY WATER) (BEGIN)<a name='5374'></font>
                IF (DEL1N.EQ.0)THEN<a name='5375'>
	           DTNEWL=DT<a name='5376'>
                ELSE<a name='5377'>
                 DTNEWL=ABS(R1(ITIME)/(B11_MY(ITIME)*DEL1N &amp;<a name='5378'>
     &amp;                               -B12_MY(ITIME)))<a name='5379'>
	         IF(DTNEWL.GT.DT) DTNEWL=DT<a name='5380'>
                END IF<a name='5381'>
                IF(ITIME.GE.NKR) THEN<a name='5382'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_787">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='5383'>
                ENDIF<a name='5384'>
                TIMESTEPD(ITIME)=DTNEWL<a name='5385'>
<a name='5386'>
<font color=#447700>! NEW TIME STEP (ONLY WATER: CONDENSATION)<a name='5387'></font>
<a name='5388'>
<a name='5389'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp; <a name='5390'>
     &amp;          DTNEWL=DT-TIMENEW<a name='5391'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='5392'>
<a name='5393'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='5394'>
<a name='5395'>
	        TIMENEW=TIMENEW+DTNEWL<a name='5396'>
<a name='5397'>
	        DTT=DTNEWL<a name='5398'>
<a name='5399'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='5400'></font>
<a name='5401'>
<font color=#447700>! CALL JERSUPSAT - 2 (NEW TIMESTEP - ONLY WATER)<a name='5402'></font>
<a name='5403'>
<a name='5404'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_7">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='5405'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='5406'>
     &amp;                        ,DTT,D1N,D2N,DT0L,DT0I)<a name='5407'>
<a name='5408'>
<font color=#447700>! END OF "NEW SUPERSATURATION"<a name='5409'></font>
<a name='5410'>
<font color=#447700>! DROPLETS <a name='5411'></font>
<a name='5412'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION <a name='5413'></font>
                                                         <a name='5414'>
<font color=#447700>! CALL JERDFUN WATER - 1 (ONLY WATER: CONDENSATION)<a name='5415'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_22">(R1,B11_MY,B12_MY &amp;<a name='5416'>
     &amp;                        ,FI1,PSI1,D1N &amp;<a name='5417'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='5418'>
<a name='5419'>
	        IF((DEL1.GT.0.AND.DEL1N.LT.0) &amp;<a name='5420'>
     &amp;         .AND.ABS(DEL1N).GT.EPSDEL) THEN<a name='5421'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_788">("fatal error in module_mp_full_sbm (DEL1.GT.0.AND.DEL1N.LT.0), model stop")<a name='5422'>
	        ENDIF<a name='5423'>
<a name='5424'>
<font color=#447700>! IN CASE : KCOND.EQ.11<a name='5425'></font>
<a name='5426'>
	      ELSE<a name='5427'>
<a name='5428'>
<font color=#447700>! EVAPORATION - ONLY WATER <a name='5429'></font>
<a name='5430'>
<font color=#447700>! IN CASE : KCOND.NE.11<a name='5431'></font>
               IF (DEL1N.EQ.0)THEN<a name='5432'>
                DTIMEO(1)=DT<a name='5433'>
	        DO KR=2,NKR<a name='5434'>
	           DTIMEO(KR)=DT<a name='5435'>
	        ENDDO<a name='5436'>
               ELSE<a name='5437'>
	        DTIMEO(1)=-R1(1)/(B11_MY(1)*DEL1N-B12_MY(1))<a name='5438'>
<a name='5439'>
	        DO KR=2,NKR<a name='5440'>
	           KM=KR-1<a name='5441'>
	           DTIMEO(KR)=(R1(KM)-R1(KR))/(B11_MY(KR)*DEL1N &amp;<a name='5442'>
     &amp;                                       -B12_MY(KR))<a name='5443'>
	        ENDDO<a name='5444'>
               END IF<a name='5445'>
<a name='5446'>
	        KLIMIT=1<a name='5447'>
<a name='5448'>
	        DO KR=1,NKR<a name='5449'>
	           IF(DTIMEO(KR).GT.TIMEREV) GOTO 55<a name='5450'>
	           KLIMIT=KR<a name='5451'>
	        ENDDO<a name='5452'>
<a name='5453'>
   55           KLIMIT=KLIMIT-1<a name='5454'>
<a name='5455'>
	        IF(KLIMIT.LT.1) KLIMIT=1<a name='5456'>
<a name='5457'>
<font color=#447700>! BARRY THIS LINE CAUSED A PROBLEM BECAUSE DTNEWL GOES FROM<a name='5458'></font>
<font color=#447700>! LARGE TO SMALL<a name='5459'></font>
  	        DTNEWL1=AMIN1(DTIMEO(3),TIMEREV)<a name='5460'>
                IF(DTNEWL1.LT.DTLREF) DTNEWL1=AMIN1(DTLREF,TIMEREV)<a name='5461'>
	        DTNEWL=DTNEWL1<a name='5462'>
	        IF(ITIME.GE.NKR) THEN<a name='5463'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_789">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='5464'>
	        ENDIF<a name='5465'>
<a name='5466'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='5467'>
<a name='5468'>
<font color=#447700>! NEW TIME STEP (ONLY_WATER: EVAPORATION)<a name='5469'></font>
<a name='5470'>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='5471'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='5472'>
     &amp;          DTNEWL=DT-TIMENEW<a name='5473'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='5474'>
<a name='5475'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='5476'>
<a name='5477'>
	        TIMENEW=TIMENEW+DTNEWL<a name='5478'>
<a name='5479'>
	        DTT=DTNEWL<a name='5480'>
<a name='5481'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='5482'></font>
<a name='5483'>
<a name='5484'>
<font color=#447700>! CALL JERSUPSAT - 3 (ONLY_WATER: EVAPORATION)<a name='5485'></font>
<a name='5486'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_8">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='5487'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='5488'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='5489'>
<font color=#447700>! END OF "NEW SUPERSATURATION"<a name='5490'></font>
<a name='5491'>
<a name='5492'>
<font color=#447700>! DROPLETS <a name='5493'></font>
<a name='5494'>
<a name='5495'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION (ONLY_WATER: EVAPORATION)<a name='5496'></font>
                                                         <a name='5497'>
<font color=#447700>! CALL JERDFUN WATER - 2 (ONLY_WATER: EVAPORATION)<a name='5498'></font>
             <a name='5499'>
 	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_23">(R1,B11_MY,B12_MY &amp;<a name='5500'>
     &amp;                        ,FI1,PSI1,D1N &amp;<a name='5501'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='5502'>
<a name='5503'>
<font color=#447700>! IN CASE : ISYML.NE.0 (ENDING OF <a name='5504'></font>
<font color=#447700>! "DROPLET DISTRIBUTION FUNCTION" (ONLY WATER: EVAPORATION)<a name='5505'></font>
<a name='5506'>
<font color=#447700>!        ENDIF<a name='5507'></font>
<a name='5508'>
	        IF((DEL1.LT.0.AND.DEL1N.GT.0) &amp;<a name='5509'>
     &amp;         .AND.ABS(DEL1N).GT.EPSDEL) THEN<a name='5510'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_790">("fatal error in module_mp_full_sbm (DEL1.LT.0.AND.DEL1N.GT.0), model stop")<a name='5511'>
	        ENDIF<a name='5512'>
<a name='5513'>
<font color=#447700>! END OF "PROCESS'S TYPE" <a name='5514'></font>
<a name='5515'>
<font color=#447700>! IN CASE : KCOND.NE.11 (ONLY WATER: EVAPORATION)<a name='5516'></font>
<a name='5517'>
              ENDIF<a name='5518'>
<a name='5519'>
<font color=#447700>! IN CASES : KCOND.EQ.11 OR KCOND.NE.11 (BOTH CONDENSATION AND<a name='5520'></font>
<font color=#447700>! EVAPORATION : ONLY WATER)<a name='5521'></font>
<a name='5522'>
<font color=#447700>! CONCENTRATION &amp; MASS (ONLY WATER) <a name='5523'></font>
<a name='5524'>
      RMASSLBB=0.<a name='5525'>
      RMASSLAA=0.<a name='5526'>
<a name='5527'>
<font color=#447700>! BEFORE JERNEWF (ONLY WATER) <a name='5528'></font>
<a name='5529'>
              DO K=1,NKR<a name='5530'>
                 FI1_K=FI1(K)<a name='5531'>
                 R1_K=R1(K)<a name='5532'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5533'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='5534'>
              ENDDO<a name='5535'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='5536'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='5537'></font>
              IF(RMASSLBB.LE.0.) RMASSLBB=0.<a name='5538'>
              DO K=1,NKR<a name='5539'>
                 FI1_K=PSI1(K)<a name='5540'>
                 R1_K=R1(K)<a name='5541'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5542'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='5543'>
              ENDDO<a name='5544'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='5545'>
              IF(RMASSLAA.LE.0.) RMASSLAA=0.<a name='5546'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q" (ONLY WATER)<a name='5547'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='5548'>
              QPN=QPS-DELMASSL1<a name='5549'>
              DAL1=AL1<a name='5550'>
              TPN=TPS+DAL1*DELMASSL1<a name='5551'>
<font color=#447700>! SUPERSATURATION (ONLY WATER)<a name='5552'></font>
              ARGEXP=-BB1_MY/TPN<a name='5553'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='5554'>
              ARGEXP=-BB2_MY/TPN<a name='5555'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='5556'>
              EW1N=OPER3(QPN,PP)<a name='5557'>
              IF(ES1N.EQ.0)THEN<a name='5558'>
               DEL1N=0.5<a name='5559'>
               DIV1=1.5<a name='5560'>
              ELSE<a name='5561'>
               DIV1=EW1N/ES1N<a name='5562'>
               DEL1N=EW1N/ES1N-1.<a name='5563'>
              END IF<a name='5564'>
              IF(ES2N.EQ.0)THEN<a name='5565'>
               DEL2N=0.5<a name='5566'>
               DIV2=1.5<a name='5567'>
              ELSE<a name='5568'>
               DEL2N=EW1N/ES2N-1.<a name='5569'>
               DIV2=EW1N/ES2N<a name='5570'>
              END IF<a name='5571'>
              DO KR=1,NKR<a name='5572'>
                SUPINTW(KR)=SUPINTW(KR)+B11_MY(KR)*D1N<a name='5573'>
                DD1N=D1N<a name='5574'>
                DB11_MY=B11_MY(KR)<a name='5575'>
                DSUPINTW(KR)=DSUPINTW(KR)+DB11_MY*DD1N<a name='5576'>
              ENDDO<a name='5577'>
<font color=#447700>! REPEATE TIME STEP (ONLY WATER: CONDENSATION OR EVAPORATION) <a name='5578'></font>
	      IF(TIMENEW.LT.DT) GOTO 56<a name='5579'>
57            CONTINUE<a name='5580'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_NEW'>JERDFUN_NEW</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_NEW_2">(R1,DSUPINTW &amp;<a name='5581'>
     &amp;                        ,FF1_OLD,PSI1,D1N &amp;<a name='5582'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='5583'>
              RMASSLAA=0.0<a name='5584'>
              RMASSLBB=0.0<a name='5585'>
<font color=#447700>! BEFORE JERNEWF<a name='5586'></font>
              DO K=1,NKR<a name='5587'>
                 FI1_K=FF1_OLD(K)<a name='5588'>
                 R1_K=R1(K)<a name='5589'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5590'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='5591'>
              ENDDO<a name='5592'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='5593'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='5594'></font>
              IF(RMASSLBB.LT.0.0) RMASSLBB=0.0<a name='5595'>
<font color=#447700>! AFTER  JERNEWF<a name='5596'></font>
              DO K=1,NKR<a name='5597'>
                 FI1_K=PSI1(K)<a name='5598'>
                 R1_K=R1(K)<a name='5599'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5600'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='5601'>
              ENDDO<a name='5602'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='5603'>
<font color=#447700>! NEW CHANGE RMASSLAA<a name='5604'></font>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='5605'>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='5606'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='5607'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='5608'>
<font color=#447700>! NEW CHANGES 10.01.01 (BEGIN)<a name='5609'></font>
              QPN=QOLD-DELMASSL1<a name='5610'>
              DAL1 = AL1<a name='5611'>
              TPN=TOLD+DAL1*DELMASSL1<a name='5612'>
<font color=#447700>! NEW CHANGES 10.01.01 (END)<a name='5613'></font>
<font color=#447700>! SUPERSATURATION<a name='5614'></font>
              ARGEXP=-BB1_MY/TPN<a name='5615'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='5616'>
              ARGEXP=-BB2_MY/TPN<a name='5617'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='5618'>
              EW1N=OPER3(QPN,PP)<a name='5619'>
              IF(ES1N.EQ.0)THEN<a name='5620'>
               DEL1N=0.5<a name='5621'>
               DIV1=1.5<a name='5622'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_791">("fatal error in module_mp_full_sbm (ES1N.EQ.0), model stop")<a name='5623'>
              ELSE<a name='5624'>
               DIV1=EW1N/ES1N<a name='5625'>
               DEL1N=EW1N/ES1N-1.<a name='5626'>
              END IF<a name='5627'>
              IF(ES2N.EQ.0)THEN<a name='5628'>
               DEL2N=0.5<a name='5629'>
               DIV2=1.5<a name='5630'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_792">("fatal error in module_mp_full_sbm (ES2N.EQ.0), model stop")<a name='5631'>
              ELSE<a name='5632'>
               DEL2N=EW1N/ES2N-1.<a name='5633'>
               DIV2=EW1N/ES2N<a name='5634'>
              END IF<a name='5635'>
        TT=TPN<a name='5636'>
        QQ=QPN<a name='5637'>
	DO KR=1,NKR<a name='5638'>
	   FF1(KR)=PSI1(KR)<a name='5639'>
	ENDDO<a name='5640'>
<a name='5641'>
<a name='5642'>
<a name='5643'>
<a name='5644'>
       RETURN<a name='5645'>
<font color=#447700>!      END <a name='5646'></font>
<a name='5647'>
  END SUBROUTINE ONECOND1<a name='5648'>
<font color=#447700>!==================================================================<a name='5649'></font>
<a name='5650'>
<a name='5651'>
<a name='5652'>
<font color=#447700>!BARRY<a name='5653'></font>
<A NAME='JERDFUN'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5654'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERDFUN</font>(R2,B21_MY,B22_MY &amp; <A href='../../call_to/JERDFUN.html' TARGET='index'>42</A>,<A href='../../call_from/JERDFUN.html' TARGET='index'>4</A><a name='5655'>
     &amp;                    ,FI2,PSI2,DEL2N &amp;<a name='5656'>
     &amp;                    ,IND,ITYPE,COL,NKR,TPN)<a name='5657'>
       IMPLICIT NONE<a name='5658'>
<a name='5659'>
<font color=#447700>! CRYSTALS <a name='5660'></font>
       REAL COL,DEL2N<a name='5661'>
                                                                       <a name='5662'>
      INTEGER IND,ITYPE,KR,ICE,ITYP,NRM,NR,NKR,IDROP<a name='5663'>
       REAL &amp;<a name='5664'>
     &amp;       R2(NKR,IND),R2N(NKR,IND) &amp;<a name='5665'>
     &amp;      ,FI2(NKR,IND),PSI2(NKR,IND) &amp;<a name='5666'>
     &amp;      ,B21_MY(NKR,IND),B22_MY(NKR,IND) &amp;<a name='5667'>
     &amp;      ,DEL_R2M(NKR,IND)<a name='5668'>
        DOUBLE PRECISION R2R(NKR),R2NR(NKR),FI2R(NKR),PSI2R(NKR)<a name='5669'>
        DOUBLE PRECISION DR2(NKR,IND),DR2N(NKR,IND),DDEL2N, &amp;<a name='5670'>
     &amp;     DB21_MY(NKR,IND)<a name='5671'>
       DOUBLE PRECISION CHECK,TPN<a name='5672'>
          CHECK=0.D0<a name='5673'>
           DO KR=1,NKR<a name='5674'>
             CHECK=B21_MY(1,1)*B21_MY(KR,1)<a name='5675'>
             IF (CHECK.LT.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_793">("fatal error in module_mp_full_sbm (CHECK.LT.0), model stop")<a name='5676'>
           END DO<a name='5677'>
<a name='5678'>
	IF(IND.NE.1) THEN<a name='5679'>
	  ITYP=ITYPE<a name='5680'>
        ELSE<a name='5681'>
	  ITYP=1<a name='5682'>
	ENDIF<a name='5683'>
<a name='5684'>
           DDEL2N=DEL2N<a name='5685'>
	DO KR=1,NKR<a name='5686'>
	   PSI2R(KR)=FI2(KR,ITYP)<a name='5687'>
	   FI2R(KR)=FI2(KR,ITYP)<a name='5688'>
           DR2(KR,ITYP)=R2(KR,ITYP)<a name='5689'>
           DB21_MY(KR,ITYP)=B21_MY(KR,ITYP)<a name='5690'>
	ENDDO<a name='5691'>
<font color=#447700>!<a name='5692'></font>
<font color=#447700>!Q2=0.<a name='5693'></font>
	NR=NKR<a name='5694'>
	NRM=NKR-1<a name='5695'>
<a name='5696'>
<font color=#447700>! NEW DISTRIBUTION FUNCTION <a name='5697'></font>
<a name='5698'>
	  DO 8 ICE=1,IND<a name='5699'>
	       IF(ITYP.EQ.ICE) THEN<a name='5700'>
	          DO KR=1,NKR<a name='5701'>
                    DR2N(KR,ICE)=DR2(KR,ICE)+DDEL2N*DB21_MY(KR,ICE)<a name='5702'>
                    R2N(KR,ICE)=DR2N(KR,ICE)<a name='5703'>
<font color=#447700>!                   IF (D1N.LT.0)THEN<a name='5704'></font>
<font color=#447700>!	             if (DR2N(KR,ICE).EQ.DR2(KR,ICE))THEN<a name='5705'></font>
<font color=#447700>!		        KK=NKR-KR+1<a name='5706'></font>
<font color=#447700>!	       		DR2N(KR,ICE)=R2N(KR,ICE)-2.E-15/2**KK<a name='5707'></font>
<font color=#447700>!                    end if<a name='5708'></font>
<font color=#447700>!                   END IF<a name='5709'></font>
<a name='5710'>
	          ENDDO<a name='5711'>
	        ENDIF<a name='5712'>
    8	  CONTINUE<a name='5713'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='5714'></font>
                                                          <a name='5715'>
	  DO ICE=1,IND<a name='5716'>
<a name='5717'>
<font color=#447700>! ICE_TYPE <a name='5718'></font>
	     IF(ITYP.EQ.ICE) THEN<a name='5719'>
<font color=#447700>!       Q2=20.*ITYPE+ICE<a name='5720'></font>
               DO 5 KR=1,NKR<a name='5721'>
	            R2R(KR)=DR2(KR,ICE)<a name='5722'>
	            R2NR(KR)=DR2N(KR,ICE)               <a name='5723'>
    5         continue<a name='5724'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5725'></font>
<font color=#447700>!            IDROP=1<a name='5726'></font>
<font color=#447700>!            IDROP=0<a name='5727'></font>
             IF(IND.EQ.1.AND.ITYPE.EQ.1) IDROP=1<a name='5728'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5729'></font>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF'>JERNEWF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNEWF_3">(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR &amp;<a name='5730'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5731'></font>
     &amp;                   ,IDROP,TPN)<a name='5732'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5733'></font>
<a name='5734'>
<a name='5735'>
<a name='5736'>
<font color=#447700>!              CALL JERNEWF(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR)<a name='5737'></font>
	       DO KR=1,NKR                              <a name='5738'>
	          PSI2(KR,ICE)=PSI2R(KR)<a name='5739'>
	       ENDDO<a name='5740'>
<a name='5741'>
<a name='5742'>
<font color=#447700>! END OF "ICE_TYPE" <a name='5743'></font>
<a name='5744'>
	     ENDIF<a name='5745'>
<a name='5746'>
<font color=#447700>! END OF "CRYSTAL DISTRIBUTION FUNCTION" <a name='5747'></font>
                                                          <a name='5748'>
	  ENDDO<a name='5749'>
<a name='5750'>
<font color=#447700>! END OF "NEW DISTRIBUTION FUNCTION"<a name='5751'></font>
<a name='5752'>
<a name='5753'>
	RETURN<a name='5754'>
	END SUBROUTINE JERDFUN<a name='5755'>
<font color=#447700>!===================================================================<a name='5756'></font>
<A NAME='JERDFUN_NEW'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5757'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERDFUN_NEW</font>(R2,B21_MY &amp; <A href='../../call_to/JERDFUN_NEW.html' TARGET='index'>2</A>,<A href='../../call_from/JERDFUN_NEW.html' TARGET='index'>2</A><a name='5758'>
     &amp;                    ,FI2,PSI2,DEL2N &amp;<a name='5759'>
     &amp;                    ,IND,ITYPE,COL,NKR,TPN)<a name='5760'>
       IMPLICIT NONE<a name='5761'>
<a name='5762'>
<font color=#447700>! CRYSTALS <a name='5763'></font>
       REAL COL,DEL2N<a name='5764'>
                                                                       <a name='5765'>
      INTEGER IND,ITYPE,KR,ICE,ITYP,NRM,NR,KK,NKR,IDROP<a name='5766'>
       REAL &amp;<a name='5767'>
     &amp;       R2(NKR,IND),R2N(NKR,IND) &amp;<a name='5768'>
     &amp;      ,FI2(NKR,IND),PSI2(NKR,IND)<a name='5769'>
       DOUBLE PRECISION TPN<a name='5770'>
       DOUBLE PRECISION  B21_MY(NKR,IND)<a name='5771'>
        DOUBLE PRECISION R2R(NKR),R2NR(NKR),FI2R(NKR),PSI2R(NKR)<a name='5772'>
        DOUBLE PRECISION DR2(NKR,IND),DR2N(NKR,IND),DDEL2N, &amp;<a name='5773'>
     &amp;     DB21_MY(NKR,IND)<a name='5774'>
	IF(IND.NE.1) THEN<a name='5775'>
	  ITYP=ITYPE<a name='5776'>
        ELSE<a name='5777'>
	  ITYP=1<a name='5778'>
	ENDIF<a name='5779'>
<a name='5780'>
           DDEL2N=DEL2N<a name='5781'>
	DO KR=1,NKR<a name='5782'>
	   PSI2R(KR)=FI2(KR,ITYP)<a name='5783'>
	   FI2R(KR)=FI2(KR,ITYP)<a name='5784'>
           DR2(KR,ITYP)=R2(KR,ITYP)<a name='5785'>
	ENDDO<a name='5786'>
<font color=#447700>!<a name='5787'></font>
<font color=#447700>!Q2=0.<a name='5788'></font>
	NR=NKR<a name='5789'>
	NRM=NKR-1<a name='5790'>
<a name='5791'>
<font color=#447700>! NEW DISTRIBUTION FUNCTION <a name='5792'></font>
<a name='5793'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='5794'></font>
	  DO ICE=1,IND<a name='5795'>
<font color=#447700>! ICE_TYPE <a name='5796'></font>
	     IF(ITYP.EQ.ICE) THEN<a name='5797'>
               DO 5 KR=1,NKR<a name='5798'>
	            R2R(KR)=DR2(KR,ICE)<a name='5799'>
	            R2NR(KR)=DR2(KR,ICE)+B21_MY(KR,ICE)<a name='5800'>
                    R2N(KR,ICE)=R2NR(KR)<a name='5801'>
<font color=#447700>!                   IF (D1N.LT.0)THEN<a name='5802'></font>
<font color=#447700>!	            	 if (R2NR(KR).EQ.R2R(KR))THEN<a name='5803'></font>
<font color=#447700>!	       		 KK=NKR-KR+1<a name='5804'></font>
<font color=#447700>!		        R2NR(KR)=R2R(KR)-2.E-15/2**KK<a name='5805'></font>
<font color=#447700>!		      end if<a name='5806'></font>
<font color=#447700>!	            END IF<a name='5807'></font>
    5         continue<a name='5808'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5809'></font>
             IDROP=1<a name='5810'>
<font color=#447700>!            IDROP=0<a name='5811'></font>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF'>JERNEWF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNEWF_4">(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR &amp;<a name='5812'>
     &amp;                   ,IDROP,TPN)<a name='5813'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5814'></font>
<a name='5815'>
<a name='5816'>
<font color=#447700>!              CALL JERNEWF(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR)<a name='5817'></font>
	       DO KR=1,NKR                              <a name='5818'>
	          PSI2(KR,ICE)=PSI2R(KR)<a name='5819'>
	       ENDDO<a name='5820'>
<a name='5821'>
<font color=#447700>! END OF "ICE_TYPE" <a name='5822'></font>
<a name='5823'>
	     ENDIF<a name='5824'>
<a name='5825'>
<font color=#447700>! END OF "CRYSTAL DISTRIBUTION FUNCTION" <a name='5826'></font>
                                                          <a name='5827'>
	  ENDDO<a name='5828'>
<a name='5829'>
<font color=#447700>! END OF "NEW DISTRIBUTION FUNCTION"<a name='5830'></font>
<a name='5831'>
<a name='5832'>
	RETURN<a name='5833'>
	END SUBROUTINE JERDFUN_NEW<a name='5834'>
<font color=#447700>! SUBROUTINE JERDFUN_NEW (NEW ALGORITHM OF CONDENSATION, 12.01.00)<a name='5835'></font>
<a name='5836'>
<font color=#447700>! new change 30.01.06                                         (start)<a name='5837'></font>
<font color=#447700>!       SUBROUTINE JERNEWF(NRX,NRM,RR,FI,PSI,RN,COL,NKR)<a name='5838'></font>
<a name='5839'>
<A NAME='JERNEWF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5840'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERNEWF</font> &amp; <A href='../../call_to/JERNEWF.html' TARGET='index'>4</A>,<A href='../../call_from/JERNEWF.html' TARGET='index'>12</A><a name='5841'>
       (NRX,NRM,RR,FI_OLD,PSI,RN,COL,NKR, &amp;<a name='5842'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5843'></font>
        IDROP,TPN)<a name='5844'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)	<a name='5845'></font>
 <a name='5846'>
        IMPLICIT NONE<a name='5847'>
	<a name='5848'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5849'></font>
<a name='5850'>
        INTEGER &amp;<a name='5851'>
	KRDROP_REMAP_MIN,KRDROP_REMAP_MAX,IDROP,KMAX<a name='5852'>
        INTEGER NRX<a name='5853'>
	<a name='5854'>
        DOUBLE PRECISION &amp;<a name='5855'>
	COEFF_REMAP,TPN<a name='5856'>
	<a name='5857'>
        DOUBLE PRECISION &amp; <a name='5858'>
        CDROP(NRX),DELTA_CDROP(NRX)<a name='5859'>
		<a name='5860'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      	<a name='5861'></font>
<a name='5862'>
        INTEGER  &amp; <a name='5863'>
        I,K,KM,NRXP,IM,IP,IFIN,IIN,ISYM,NKR<a name='5864'>
 <a name='5865'>
        REAL &amp; <a name='5866'>
        COL<a name='5867'>
<a name='5868'>
        DOUBLE PRECISION &amp;<a name='5869'>
	AOLDCON,ANEWCON,AOLDMASS,ANEWMASS<a name='5870'>
<a name='5871'>
        DOUBLE PRECISION &amp;<a name='5872'>
        RNTMP,RRTMP,RRP,RRM,RNTMP2,RRTMP2,RRP2,RRM2, &amp;<a name='5873'>
        GN1,GN1P,GN2,GN3,GMAT2<a name='5874'>
<a name='5875'>
        DOUBLE PRECISION &amp;<a name='5876'>
        DRP,FNEW,FIK,PSINEW,DRM,GMAT,R1,R2,R3,DMASS,CONCL,RRI,RNK<a name='5877'>
<a name='5878'>
        INTEGER NRM<a name='5879'>
<a name='5880'>
        DOUBLE PRECISION &amp; <a name='5881'>
        RR(NRX),FI(NRX),PSI(NRX),RN(NRX) &amp;<a name='5882'>
       ,RRS(NKR+1),RNS(NKR+1),PSIN(NKR+1),FIN(NKR+1)<a name='5883'>
<a name='5884'>
        DOUBLE PRECISION &amp; <a name='5885'>
        FI_OLD(NRX)<a name='5886'>
<font color=#447700>! ANDREI                                                      (start) <a name='5887'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5888'></font>
        DOUBLE PRECISION &amp; <a name='5889'>
        PSI_IM,PSI_I,PSI_IP<a name='5890'>
<font color=#447700>! ANDREI                                                        (end) <a name='5891'></font>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5892'></font>
<a name='5893'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5894'></font>
<a name='5895'>
       IF(TPN.LT.273.15-7.0D0) IDROP=0<a name='5896'>
<font color=#447700>! LEAVE REMAPPING ON<a name='5897'></font>
<font color=#447700>!      IDROP=0<a name='5898'></font>
 <a name='5899'>
<font color=#447700>! VALUES FOR SOME REMAPING VARIABLES<a name='5900'></font>
<a name='5901'>
        KRDROP_REMAP_MIN=8<a name='5902'>
	KRDROP_REMAP_MAX=13 <a name='5903'>
	<a name='5904'>
        COEFF_REMAP=1.0D0/150.0D0 <a name='5905'>
	       	<a name='5906'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      <a name='5907'></font>
	<a name='5908'>
<font color=#447700>! INITIAL VALUES FOR SOME VARIABLES<a name='5909'></font>
<a name='5910'>
	NRXP=NRX+1<a name='5911'>
<a name='5912'>
	DO K=1,NRX<a name='5913'>
	   FI(K)=FI_OLD(K)<a name='5914'>
        ENDDO<a name='5915'>
 <a name='5916'>
	DO K=1,NRX<a name='5917'>
	   PSI(K)=0.0D0<a name='5918'>
        ENDDO<a name='5919'>
<font color=#447700>! ANDREI                                                      (start) <a name='5920'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5921'></font>
<a name='5922'>
	IF(RN(NRX).NE.RR(NRX)) THEN<a name='5923'>
<a name='5924'>
<font color=#447700>! Kovetz-Olund method                                         (start)<a name='5925'></font>
<a name='5926'>
<font color=#447700>! ANDREI                                                        (end) <a name='5927'></font>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5928'></font>
<a name='5929'>
	  ISYM=1<a name='5930'>
<a name='5931'>
	  IF(RN(1).LT.RR(1)) ISYM=-1<a name='5932'>
<a name='5933'>
<font color=#447700>! CALCULATION OF DISTRIBUTION FUNCTION <a name='5934'></font>
<a name='5935'>
	  IF(ISYM.GT.0) THEN<a name='5936'>
	<a name='5937'>
<font color=#447700>! CONDENSATION <a name='5938'></font>
<a name='5939'>
	    RNS(NRXP)=1024.0D0*RR(NRX)<a name='5940'>
	    RRS(NRXP)=1024.0D0*RR(NRX)<a name='5941'>
<a name='5942'>
  	    PSIN(NRXP)=0.0D0<a name='5943'>
	    FIN(NRXP)=0.0D0<a name='5944'>
<a name='5945'>
	    DO K=1,NRX<a name='5946'>
	       RNS(K)=RN(K)<a name='5947'>
	       RRS(K)=RR(K)<a name='5948'>
	       PSIN(K)=0.0D0<a name='5949'>
<font color=#447700>! FIN(K) - initial(before condensation) concentration of hydrometeors<a name='5950'></font>
	       FIN(K)=3.0D0*FI(K)*RR(K)*COL<a name='5951'>
	    ENDDO<a name='5952'>
<a name='5953'>
<font color=#447700>! NUMBER OF NEW RADII POSITION IN REGULAR GRID <a name='5954'></font>
<a name='5955'>
<font color=#447700>! RNK - new first bin mass(after condensation)<a name='5956'></font>
<a name='5957'>
	    RNK=RNS(1)<a name='5958'>
<a name='5959'>
	    DO I=1,NRX<a name='5960'>
	       RRI=RRS(I)<a name='5961'>
	       IF(RRI.GT.RNK) GOTO 3<a name='5962'>
            ENDDO<a name='5963'>
<a name='5964'>
    3	    IIN=I-1<a name='5965'>
<a name='5966'>
	    IFIN=NRX<a name='5967'>
<a name='5968'>
	    CONCL=0.0D0<a name='5969'>
            DMASS=0.0D0<a name='5970'>
                        <a name='5971'>
            DO 6 I=IIN,IFIN<a name='5972'>
<a name='5973'>
                 IP=I+1<a name='5974'>
                                                                                <a name='5975'>
                 IM=MAX(1,I-1)<a name='5976'>
<a name='5977'>
	         R1=RRS(IM)<a name='5978'>
	         R2=RRS(I)<a name='5979'>
	         R3=RRS(IP)<a name='5980'>
<a name='5981'>
	         DRM=R2-R1<a name='5982'>
	         DRP=R3-R2<a name='5983'>
<a name='5984'>
	         FNEW=0.0D0<a name='5985'>
<a name='5986'>
	         DO 7 K=1,I<a name='5987'>
                 <a name='5988'>
	              FIK=FIN(K)<a name='5989'>
<a name='5990'>
	              IF(FIK.NE.0.0D0) THEN<a name='5991'>
<a name='5992'>
	                KM=K-1<a name='5993'>
<a name='5994'>
<font color=#447700>! RNK - new bin mass(after condensation)<a name='5995'></font>
<a name='5996'>
	                RNK=RNS(K)<a name='5997'>
<a name='5998'>
	                IF(RNK.NE.R2) THEN<a name='5999'>
	                  GMAT=0.0D0<a name='6000'>
	                  IF(RNK.GT.R1.AND.RNK.LT.R3) THEN<a name='6001'>
	                    IF(RNK.LT.R2) THEN<a name='6002'>
	                      GMAT=(RNK-R1)/DRM<a name='6003'>
		            ELSE<a name='6004'>
	                      GMAT=(R3-RNK)/DRP<a name='6005'>
	                    ENDIF<a name='6006'>
	                  ENDIF<a name='6007'>
	                ELSE<a name='6008'>
	                  GMAT=1.0D0<a name='6009'>
	                ENDIF<a name='6010'>
<a name='6011'>
                        FNEW=FNEW+FIK*GMAT<a name='6012'>
<font color=#447700>! in case FIK.NE.0.0D0<a name='6013'></font>
	              ENDIF<a name='6014'>
                 <a name='6015'>
   7	         CONTINUE<a name='6016'>
<a name='6017'>
	         CONCL=CONCL+FNEW<a name='6018'>
<a name='6019'>
	         DMASS=DMASS+FNEW*R2<a name='6020'>
<a name='6021'>
<font color=#447700>! PSIN(I)) - new concentration of hydrometeors after condensation<a name='6022'></font>
<a name='6023'>
    	         PSIN(I)=FNEW<a name='6024'>
                        	<a name='6025'>
   6        CONTINUE<a name='6026'>
<a name='6027'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION<a name='6028'></font>
 <a name='6029'>
<font color=#447700>! PSI(K) - new size distribution function of hydrometeors after <a name='6030'></font>
<font color=#447700>!          condensation, K=1,...,NRX=NKR<a name='6031'></font>
<a name='6032'>
	    DO K=1,NRX<a name='6033'>
	       PSI(K)=PSIN(K)/3./RR(K)/COL<a name='6034'>
	    ENDDO<a name='6035'>
<a name='6036'>
<font color=#447700>! IN CASE: ISYM.GT.0 (CONDENSATION)<a name='6037'></font>
	<a name='6038'>
          ELSE<a name='6039'>
<a name='6040'>
<font color=#447700>! IN CASE: ISYM.LE.0 (EVAPORATION)<a name='6041'></font>
<a name='6042'>
	    RNS(1)=0.0D0<a name='6043'>
	    RRS(1)=0.0D0<a name='6044'>
	    FIN(1)=0.0D0<a name='6045'>
	    PSIN(1)=0.0D0<a name='6046'>
<a name='6047'>
<font color=#447700>! FIN(K) - initial(before evaporation) concentration of hydrometeors<a name='6048'></font>
<a name='6049'>
	    DO K=2,NRXP<a name='6050'>
	       KM=K-1<a name='6051'>
	       RNS(K)=RN(KM)<a name='6052'>
	       RRS(K)=RR(KM)<a name='6053'>
	       PSIN(K)=0.0D0<a name='6054'>
	       FIN(K)=3.0D0*FI(KM)*RR(KM)*COL<a name='6055'>
	    ENDDO<a name='6056'>
<a name='6057'>
	    DO I=1,NRXP<a name='6058'>
<a name='6059'>
               IM=MAX(I-1,1)<a name='6060'>
               IP=MIN(I+1,NRXP)<a name='6061'>
<a name='6062'>
   	       R1=RRS(IP)<a name='6063'>
	       R2=RRS(I)<a name='6064'>
	       R3=RRS(IM)<a name='6065'>
<a name='6066'>
               DRM=R1-R2<a name='6067'>
               DRP=R2-R3<a name='6068'>
<a name='6069'>
	       FNEW=0.0D0<a name='6070'>
<a name='6071'>
	       DO K=I,NRXP<a name='6072'>
	          RNK=RNS(K)<a name='6073'>
                  IF(RNK.GE.R1) GOTO 4321<a name='6074'>
                  IF(RNK.GT.R3)THEN<a name='6075'>
                    IF(RNK.GT.R2) THEN<a name='6076'>
                      FNEW=FNEW+FIN(K)*(R1-RNK)/DRM<a name='6077'>
                    ELSE<a name='6078'>
                      FNEW=FNEW+FIN(K)*(RNK-R3)/DRP<a name='6079'>
	            ENDIF<a name='6080'>
	          ENDIF<a name='6081'>
               ENDDO<a name='6082'>
<a name='6083'>
 4321          CONTINUE<a name='6084'>
<a name='6085'>
<font color=#447700>! PSIN(I) - new concentration of hydrometeors after evaporation<a name='6086'></font>
<a name='6087'>
    	       PSIN(I)=FNEW<a name='6088'>
	<a name='6089'>
            ENDDO<a name='6090'>
<font color=#447700>! cycle by I<a name='6091'></font>
<a name='6092'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION                         (start)<a name='6093'></font>
<a name='6094'>
<font color=#447700>! PSI(K), 1/g/cm^3 - new size distribution function of hydrometeors <a name='6095'></font>
<font color=#447700>!                    after evaporation, K=1,...,NRX<a name='6096'></font>
	    DO K=2,NRXP<a name='6097'>
	       KM=K-1<a name='6098'>
	       R1=PSIN(K)*RR(KM)<a name='6099'>
	       PSINEW=PSIN(K)/3.0D0/RR(KM)/COL<a name='6100'>
	       IF(R1.LT.1.0D-20) PSINEW=0.0D0<a name='6101'>
	       PSI(KM)=PSINEW<a name='6102'>
	    ENDDO<a name='6103'>
<a name='6104'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION                           (end)<a name='6105'></font>
<a name='6106'>
<font color=#447700>! IN CASE: ISYM.LE.0 (EVAPORATION)<a name='6107'></font>
<a name='6108'>
	  ENDIF<a name='6109'>
	<a name='6110'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='6111'></font>
          IF(I3POINT.NE.0.AND.ISYM.GT.0) THEN<a name='6112'>
<font color=#447700>! DIFFERENCE<a name='6113'></font>
<font color=#447700>!         IF(I3POINT.NE.0) THEN<a name='6114'></font>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      <a name='6115'></font>
<a name='6116'>
	    DO K=1,NKR<a name='6117'>
	       RRS(K)=RR(K)<a name='6118'>
	    ENDDO<a name='6119'>
<a name='6120'>
            RRS(NKR+1)=RRS(NKR)*1024.0D0<a name='6121'>
<a name='6122'>
	    DO I=1,NKR<a name='6123'>
 <a name='6124'>
               PSI(I)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_12">(I)*RR(I)<a name='6125'>
<a name='6126'>
<font color=#447700>! PSI(I) - concenration hydrometeors after KO divided on COL*3.0D0<a name='6127'></font>
<font color=#447700>! RN(I), g - new masses after condensation or evaporation<a name='6128'></font>
<a name='6129'>
               IF(RN(I).LT.0.0D0) THEN <a name='6130'>
                 RN(I)=1.0D-50<a name='6131'>
	         FI(I)=0.0D0<a name='6132'>
               ENDIF<a name='6133'>
<a name='6134'>
            ENDDO<a name='6135'>
 <a name='6136'>
	    DO K=1,NKR<a name='6137'>
<a name='6138'>
               IF(FI(K).NE.0.0D0) THEN<a name='6139'>
<a name='6140'>
                 IF(RRS(2).LT.RN(K)) THEN<a name='6141'>
 <a name='6142'>
                   I=2<a name='6143'>
<a name='6144'>
                   DO  WHILE &amp;<a name='6145'>
                     (.NOT.(RRS(I).LT.RN(K).AND.RRS(I+1).GT.RN(K)) &amp;<a name='6146'>
                      .AND.I.LT.NKR)<a name='6147'>
                       I=I+1<a name='6148'>
	           ENDDO<a name='6149'>
<font color=#447700>! ANDREI                                                      (start) <a name='6150'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='6151'></font>
                   IF(I.LT.NKR-2) THEN<a name='6152'>
<font color=#447700>! new change 7.02.06                                            (end)<a name='6153'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='6154'></font>
                     RNTMP=RN(K)<a name='6155'>
<a name='6156'>
                     RRTMP=RRS(I)<a name='6157'>
                     RRP=RRS(I+1)<a name='6158'>
                     RRM=RRS(I-1)<a name='6159'>
 <a name='6160'>
                     RNTMP2=RN(K+1)<a name='6161'>
<a name='6162'>
                     RRTMP2=RRS(I+1)<a name='6163'>
                     RRP2=RRS(I+2)<a name='6164'>
                     RRM2=RRS(I)<a name='6165'>
 <a name='6166'>
                     GN1=(RRP-RNTMP)*(RRTMP-RNTMP)/(RRP-RRM)/ &amp;<a name='6167'>
                       (RRTMP-RRM)<a name='6168'>
<a name='6169'>
                     GN1P=(RRP2-RNTMP2)*(RRTMP2-RNTMP2)/ &amp;<a name='6170'>
                        (RRP2-RRM2)/(RRTMP2-RRM2)<a name='6171'>
<a name='6172'>
                     GN2=(RRP-RNTMP)*(RNTMP-RRM)/(RRP-RRTMP)/ &amp;<a name='6173'>
                       (RRTMP-RRM)<a name='6174'>
 <a name='6175'>
	             GMAT=(RRP-RNTMP)/(RRP-RRTMP)<a name='6176'>
<font color=#447700>! ANDREI                                                      (start) <a name='6177'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='6178'></font>
                     GN3=(RRTMP-RNTMP)*(RRM-RNTMP)/(RRP-RRM)/ &amp;<a name='6179'>
                                                 (RRP-RRTMP)<a name='6180'>
	             GMAT2=(RNTMP-RRTMP)/(RRP-RRTMP)<a name='6181'>
<a name='6182'>
                     PSI_IM=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_13">(I-1)+GN1*FI(K)*RR(K)<a name='6183'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='6184'></font>
<font color=#447700>!                    PSI_I=PSI(I)+(GN1P+GN2-GMAT)*FI(K+1)*RR(K+1)<a name='6185'></font>
<a name='6186'>
                     PSI_I=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_14">(I)+GN1P*FI(K+1)*RR(K+1)+&amp;<a name='6187'>
	                         (GN2-GMAT)*FI(K)*RR(K)<a name='6188'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)           <a name='6189'></font>
                     PSI_IP=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_15">(I+1)+(GN3-GMAT2)*FI(K)*RR(K)<a name='6190'>
                    <a name='6191'>
                     IF(PSI_IM.GT.0.0D0) THEN<a name='6192'>
<a name='6193'>
                       IF(PSI_IP.GT.0.0D0) THEN<a name='6194'>
<a name='6195'>
                         IF(I.GT.2) THEN<a name='6196'>
<font color=#447700>! smoothing criteria<a name='6197'></font>
                           IF(PSI_IM.GT.PSI(I-2).AND.PSI_IM.LT.PSI_I &amp;<a name='6198'>
                          .AND.PSI(I-2).LT.PSI(I).OR.PSI(I-2) &amp;<a name='6199'>
                          .GE.PSI(I)) THEN<a name='6200'>
<a name='6201'>
                             PSI(I-1)=PSI_IM<a name='6202'>
<a name='6203'>
                             PSI(I)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_16">(I)+FI(K)*RR(K)*(GN2-GMAT)<a name='6204'>
<a name='6205'>
                             PSI(I+1)=PSI_IP<a name='6206'>
<a name='6207'>
<font color=#447700>! in case smoothing criteria<a name='6208'></font>
<a name='6209'>
                           ENDIF <a name='6210'>
<font color=#447700>! in case I.GT.2<a name='6211'></font>
                         ENDIF<a name='6212'>
<a name='6213'>
<font color=#447700>! in case PSI_IP.GT.0.0D0<a name='6214'></font>
<a name='6215'>
	               ENDIF<a name='6216'>
<a name='6217'>
<font color=#447700>! in case PSI_IM.GT.0.0D0<a name='6218'></font>
<a name='6219'>
	             ENDIF<a name='6220'>
<a name='6221'>
<font color=#447700>! in case I.LT.NKR-2<a name='6222'></font>
<a name='6223'>
                   ENDIF<a name='6224'>
<font color=#447700>! new change 7.02.06                                            (end)<a name='6225'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='6226'></font>
<font color=#447700>! in case RRS(2).LT.RN(K)<a name='6227'></font>
<a name='6228'>
                 ENDIF<a name='6229'>
 <a name='6230'>
<font color=#447700>! in case FI(K).NE.0.0D0<a name='6231'></font>
<a name='6232'>
               ENDIF<a name='6233'>
<a name='6234'>
 1000          CONTINUE<a name='6235'>
<a name='6236'>
	    ENDDO<a name='6237'>
<font color=#447700>! cycle by K<a name='6238'></font>
	    AOLDCON=0.0D0<a name='6239'>
	    ANEWCON=0.0D0<a name='6240'>
	    AOLDMASS=0.0D0<a name='6241'>
	    ANEWMASS=0.0D0<a name='6242'>
<a name='6243'>
	    DO K=1,NKR<a name='6244'>
	       AOLDCON=AOLDCON+FI(K)*RR(K)<a name='6245'>
	       ANEWCON=ANEWCON+PSI(K)<a name='6246'>
	       AOLDMASS=AOLDMASS+FI(K)*RR(K)*RN(K)<a name='6247'>
	       ANEWMASS=ANEWMASS+PSI(K)*RR(K)<a name='6248'>
	    ENDDO<a name='6249'>
<a name='6250'>
<font color=#447700>! new change 8.02.06                                          (start)<a name='6251'></font>
<font color=#447700>! ANDREI                                                      (start)<a name='6252'></font>
<a name='6253'>
<font color=#447700>! PSI(K) - new hydrometeor size distribution function(sdf)<a name='6254'></font>
<a name='6255'>
	    DO K=1,NKR<a name='6256'>
	       PSI(K)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_17">(K)/RR(K)<a name='6257'>
            ENDDO<a name='6258'>
	  <a name='6259'>
<font color=#447700>! new change 8.02.06                                            (end)	       <a name='6260'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='6261'></font>
<a name='6262'>
<font color=#447700>! 3 point method                                                (end)	       <a name='6263'></font>
								     	       <a name='6264'>
<font color=#447700>! in case I3POINT.NE.0.AND.ISYM.GT.0						     		 <a name='6265'></font>
								     		    <a name='6266'>
	  ENDIF<a name='6267'>
<a name='6268'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='6269'></font>
<a name='6270'>
          IF(IDROP.NE.0.AND.ISYM.GT.0) THEN<a name='6271'>
	  <a name='6272'>
	    DO K=KRDROP_REMAP_MIN,KRDROP_REMAP_MAX<a name='6273'>
	       CDROP(K)=3.0D0*COL*PSI(K)*RR(K)<a name='6274'>
	    ENDDO<a name='6275'>
								     		 <a name='6276'>
<font color=#447700>! KMAX - right boundary of drop sdf spectrum<a name='6277'></font>
<font color=#447700>!(KRDROP_REMAP_MIN =&lt; KMAX =&lt; KRDROP_REMAP_MAX)<a name='6278'></font>
<a name='6279'>
            DO K=KRDROP_REMAP_MAX,KRDROP_REMAP_MIN,-1<a name='6280'>
               KMAX=K<a name='6281'>
               IF(PSI(K).GT.0.0D0) GOTO 2011<a name='6282'>
            ENDDO<a name='6283'>
<a name='6284'>
 2011       CONTINUE<a name='6285'>
 <a name='6286'>
<font color=#447700>! Andrei start<a name='6287'></font>
<font color=#447700>!           DO K=KMAX-1,1,-1<a name='6288'></font>
<font color=#447700>! Andre end<a name='6289'></font>
<font color=#447700>!Alex, Andrei, Barry<a name='6290'></font>
            DO K=KMAX-1,KRDROP_REMAP_MIN,-1<a name='6291'>
<font color=#447700>!Alex, Andrei, Barry<a name='6292'></font>
	       IF(CDROP(K).GT.1.d-20) THEN<a name='6293'>
                 DELTA_CDROP(K)=CDROP(K+1)/CDROP(K)<a name='6294'>
	         IF(DELTA_CDROP(K).LT.COEFF_REMAP) THEN<a name='6295'>
	           CDROP(K)=CDROP(K)+CDROP(K+1)<a name='6296'>
		   CDROP(K+1)=0.0D0<a name='6297'>
	         ENDIF<a name='6298'>
	       ENDIF<a name='6299'>
            ENDDO<a name='6300'>
	    <a name='6301'>
	    DO K=KRDROP_REMAP_MIN,KMAX<a name='6302'>
	       PSI(K)=CDROP(K)/(3.0D0*COL*RR(K))<a name='6303'>
	    ENDDO<a name='6304'>
	    <a name='6305'>
<font color=#447700>! in case IDROP.NE.0.AND.ISYM.GT.0<a name='6306'></font>
		      <a name='6307'>
	  ENDIF<a name='6308'>
	    	  <a name='6309'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)           <a name='6310'></font>
<font color=#447700>! ANDREI                                                      (start) <a name='6311'></font>
<font color=#447700>! new change 8.02.06                                          (start)<a name='6312'></font>
<a name='6313'>
<font color=#447700>! in case RN(NRX).NE.RR(NRX)<a name='6314'></font>
<a name='6315'>
        ELSE<a name='6316'>
<a name='6317'>
<font color=#447700>! in case RN(NRX).EQ.RR(NRX)<a name='6318'></font>
<a name='6319'>
	  DO K=1,NKR<a name='6320'>
	     PSI(K)=FI(K)<a name='6321'>
	  ENDDO<a name='6322'>
<a name='6323'>
        ENDIF<a name='6324'>
<a name='6325'>
<font color=#447700>! new change 8.02.06                                            (end)           <a name='6326'></font>
<font color=#447700>! ANDREI                                            <a name='6327'></font>
<a name='6328'>
        RETURN <a name='6329'>
<a name='6330'>
<font color=#447700>! SUBROUTINE JERNEWF<a name='6331'></font>
        END SUBROUTINE JERNEWF<a name='6332'>
<a name='6333'>
<font color=#447700>! BARRY REMOVED QP,ROR<a name='6334'></font>
<A NAME='JERRATEOLD'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATEOLD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6335'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERRATEOLD</font>(R1S,TP,PP,ROR,VR1,PSINGLE,RIEC,RO1BL &amp;<a name='6336'>
     &amp;                    ,B11_MY,B12_MY,ID,IN,ICEMAX,NKR)<a name='6337'>
       IMPLICIT NONE<a name='6338'>
       INTEGER ID,IN,KR,ICE,NRM,ICEMAX,NKR<a name='6339'>
      DOUBLE PRECISION TP,PP<a name='6340'>
      REAL DETL,FACTPL,VENTPL,VR1K,CONSTL,RO1,RVT,D_MY, &amp;<a name='6341'>
     &amp; CONST<a name='6342'>
       REAL VR1(NKR,ID),PSINGLE,ROR<a name='6343'>
        REAL       &amp;<a name='6344'>
     &amp; R1S(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6345'>
     &amp;,RO1BL(NKR,ID),RIEC(NKR,ID) &amp;<a name='6346'>
     &amp;,VR1KL(NKR,ICEMAX),VENTRL(NKR,ICEMAX) &amp;<a name='6347'>
     &amp;,FD1(NKR,ICEMAX),FK1(NKR,ICEMAX),FACTRL(NKR,ICEMAX) &amp;<a name='6348'>
     &amp;,R11_MY(NKR,ICEMAX),R12_MY(NKR,ICEMAX) &amp;<a name='6349'>
     &amp;,R1_MY1(NKR,ICEMAX),R1_MY2(NKR,ICEMAX),R1_MY3(NKR,ICEMAX) &amp;<a name='6350'>
     &amp;,AL1(2),AL1_MY(2),A1_MY(2),BB1_MY(2),ESAT1(2),CONSTLI(ICEMAX)<a name='6351'>
      DOUBLE PRECISION TZERO<a name='6352'>
      REAL PZERO,CF_MY,D_MYIN,RV_MY<a name='6353'>
      PARAMETER (TZERO=273.150,PZERO=1.013E6)<a name='6354'>
      DATA AL1/2500.,2833./<a name='6355'>
	CONST=12.566372<a name='6356'>
        AL1_MY(1)=2.5E10<a name='6357'>
        AL1_MY(2)=2.834E10<a name='6358'>
        A1_MY(1)=2.53E12<a name='6359'>
        A1_MY(2)=3.41E13<a name='6360'>
        BB1_MY(1)=5.42E3<a name='6361'>
        BB1_MY(2)=6.13E3<a name='6362'>
        CF_MY=2.4E3<a name='6363'>
        D_MYIN=0.221<a name='6364'>
        RV_MY=461.5E4<a name='6365'>
	NRM=NKR-1<a name='6366'>
<a name='6367'>
<font color=#447700>! RHS FOR "MAXWELL" EQUATION <a name='6368'></font>
<a name='6369'>
	D_MY=D_MYIN*(PZERO/PP)*(TP/TZERO)**1.94<a name='6370'>
	RVT=RV_MY*TP<a name='6371'>
	ESAT1(IN)=A1_MY(IN)*EXP(-BB1_MY(IN)/TP)<a name='6372'>
<a name='6373'>
	DO 1 ICE=1,ID<a name='6374'>
	     DO 1 KR=1,NKR<a name='6375'>
	     RO1=RO1BL(KR,ICE)<a name='6376'>
	     CONSTL=CONST*RIEC(KR,ICE)<a name='6377'>
	     CONSTLI(ICE)=CONSTL<a name='6378'>
	     VR1K=0.<a name='6379'>
	     VR1KL(KR,ICE)=VR1K<a name='6380'>
	     VENTPL=1.<a name='6381'>
	     VENTRL(KR,ICE)=VENTPL<a name='6382'>
	     FACTPL=1.<a name='6383'>
	     FACTRL(KR,ICE)=FACTPL<a name='6384'>
	     FD1(KR,ICE)=RVT/D_MY/ESAT1(IN)/FACTPL<a name='6385'>
	     FK1(KR,ICE)=(AL1_MY(IN)/RVT-1.)*AL1_MY(IN)/CF_MY/TP<a name='6386'>
	     R1_MY1(KR,ICE)=VENTPL*CONSTL<a name='6387'>
	     R11_MY(KR,ICE)=R1_MY1(KR,ICE)<a name='6388'>
<font color=#447700>!BARRY<a name='6389'></font>
<font color=#447700>!     R1_MY2(KR,ICE)=VENTPL*CONSTL*0.<a name='6390'></font>
<font color=#447700>!     R1_MY3(KR,ICE)=VENTPL*CONSTL*0.<a name='6391'></font>
<font color=#447700>!     R12_MY(KR,ICE)=R1_MY2(KR,ICE)-R1_MY3(KR,ICE)<a name='6392'></font>
<font color=#447700>!BARRY<a name='6393'></font>
<font color=#447700>! GROWTH RATE<a name='6394'></font>
<a name='6395'>
	     DETL=FK1(KR,ICE)+FD1(KR,ICE)<a name='6396'>
	     B11_MY(KR,ICE)=R11_MY(KR,ICE)/DETL<a name='6397'>
<font color=#447700>!BARRY     B12_MY(KR,ICE)=R12_MY(KR,ICE)/DETL<a name='6398'></font>
           B12_MY(KR,ICE)=0                       <a name='6399'>
    1	CONTINUE<a name='6400'>
<a name='6401'>
	RETURN<a name='6402'>
	END SUBROUTINE JERRATEOLD<a name='6403'>
<a name='6404'>
<font color=#447700>! SUBROUTINE JERRATE<a name='6405'></font>
<font color=#447700>!========================================================================<a name='6406'></font>
<font color=#447700>!BARRY    CALL JERSUPSAT(DEL1,DEL2,DEL1N,DEL2N<a name='6407'></font>
<font color=#447700>!    *                        ,RW,PW,RI,PI,QW,QI<a name='6408'></font>
<font color=#447700>! SUBROUTINE JERNEWF<a name='6409'></font>
<font color=#447700>!=========================================================================<a name='6410'></font>
<font color=#447700>! BARRY REMOVED QP<a name='6411'></font>
<A NAME='JERRATE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6412'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERRATE</font>(R1S,TP,PP,ROR,VR1,PSINGLE,RIEC,RO1BL &amp; <A href='../../call_to/JERRATE.html' TARGET='index'>20</A><a name='6413'>
     &amp;                    ,B11_MY,B12_MY,ID,IN,ICEMAX,NKR)<a name='6414'>
       IMPLICIT NONE<a name='6415'>
       INTEGER ID,IN,KR,ICE,NRM,ICEMAX,NKR<a name='6416'>
      DOUBLE PRECISION TP,PP<a name='6417'>
      REAL DETL,FACTPL,VENTPL,VR1K,CONSTL,RO1,RVT,D_MY, &amp;<a name='6418'>
     &amp; CONST<a name='6419'>
        REAL VR1(NKR,ID),PSINGLE &amp;<a name='6420'>
     &amp;,R1S(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6421'>
     &amp;,RO1BL(NKR,ID),RIEC(NKR,ID) &amp;<a name='6422'>
     &amp;,VR1KL(NKR,ICEMAX),VENTRL(NKR,ICEMAX) &amp;<a name='6423'>
     &amp;,FD1(NKR,ICEMAX),FK1(NKR,ICEMAX),FACTRL(NKR,ICEMAX) &amp;<a name='6424'>
     &amp;,R11_MY(NKR,ICEMAX),R12_MY(NKR,ICEMAX) &amp;<a name='6425'>
     &amp;,R1_MY1(NKR,ICEMAX),R1_MY2(NKR,ICEMAX),R1_MY3(NKR,ICEMAX) &amp;<a name='6426'>
     &amp;,AL1(2),AL1_MY(2),A1_MY(2),BB1_MY(2),ESAT1(2),CONSTLI(ICEMAX)<a name='6427'>
      DOUBLE PRECISION TZERO<a name='6428'>
      REAL PZERO,CF_MY,D_MYIN,RV_MY,DEG01,DEG03<a name='6429'>
      REAL COEFF_VISCOUS,SHMIDT_NUMBER,A,B<a name='6430'>
      REAL REINOLDS_NUMBER,RESHM,ROR<a name='6431'>
      PARAMETER (TZERO=273.150,PZERO=1.013E6)<a name='6432'>
      DATA AL1/2500.,2833./<a name='6433'>
        DEG01=1./3.     <a name='6434'>
        DEG03=1./3.     <a name='6435'>
	CONST=12.566372<a name='6436'>
        AL1_MY(1)=2.5E10<a name='6437'>
        AL1_MY(2)=2.834E10<a name='6438'>
        A1_MY(1)=2.53E12<a name='6439'>
        A1_MY(2)=3.41E13<a name='6440'>
        BB1_MY(1)=5.42E3<a name='6441'>
        BB1_MY(2)=6.13E3<a name='6442'>
        CF_MY=2.4E3<a name='6443'>
        D_MYIN=0.221<a name='6444'>
        RV_MY=461.5E4<a name='6445'>
	NRM=NKR-1<a name='6446'>
<font color=#447700>! rhs for "maxwell" equation<a name='6447'></font>
<font color=#447700>! coefficient of diffusion<a name='6448'></font>
        D_MY=D_MYIN*(PZERO/PP)*(TP/TZERO)**1.94<a name='6449'>
<font color=#447700>! new change 20.04.02<a name='6450'></font>
<font color=#447700>! coefficient of viscousity<a name='6451'></font>
        COEFF_VISCOUS=1.72E-2*SQRT(TP/273.)*393./(TP-120.)/ROR<a name='6452'>
<font color=#447700>! Shmidt number<a name='6453'></font>
        SHMIDT_NUMBER=COEFF_VISCOUS/D_MY<a name='6454'>
<font color=#447700>! Constants used for calculation of Reinolds number<a name='6455'></font>
        A=2.*(3./4./3.141593)**DEG01<a name='6456'>
        B=A/COEFF_VISCOUS<a name='6457'>
        <a name='6458'>
        RVT=RV_MY*TP<a name='6459'>
        ESAT1(IN)=A1_MY(IN)*EXP(-BB1_MY(IN)/TP)<a name='6460'>
        DO ICE=1,ID<a name='6461'>
           DO KR=1,NKR<a name='6462'>
<font color=#447700>! Reinolds numbers<a name='6463'></font>
              REINOLDS_NUMBER= &amp;<a name='6464'>
     &amp;        B*VR1(KR,ICE)*SQRT(1.E6/PSINGLE)* &amp;<a name='6465'>
     &amp;        (R1S(KR,ICE)/RO1BL(KR,ICE))**DEG03<a name='6466'>
              RESHM=SQRT(REINOLDS_NUMBER)*SHMIDT_NUMBER**DEG03<a name='6467'>
              IF(REINOLDS_NUMBER.LT.2.5) THEN<a name='6468'>
                VENTPL=1.+0.108*RESHM*RESHM<a name='6469'>
              ELSE<a name='6470'>
                VENTPL=0.78+0.308*RESHM<a name='6471'>
              ENDIF<a name='6472'>
<font color=#447700>! new change 20.04.02                                           (end)<a name='6473'></font>
              CONSTL=CONST*RIEC(KR,ICE)                         <a name='6474'>
              CONSTLI(ICE)=CONSTL<a name='6475'>
<font color=#447700>!             VR1K=0.<a name='6476'></font>
<font color=#447700>!             VR1KL(KR,ICE)=VR1K<a name='6477'></font>
<font color=#447700>! new change 20.04.02                                         (begin)<a name='6478'></font>
<font color=#447700>!             VENTPL=1.                                       <a name='6479'></font>
<font color=#447700>!             VENTRL(KR,ICE)=VENTPL                           <a name='6480'></font>
<font color=#447700>! new change 20.04.02                                           (end)<a name='6481'></font>
              FACTPL=1.                                         <a name='6482'>
              FACTRL(KR,ICE)=FACTPL                             <a name='6483'>
              FD1(KR,ICE)=RVT/D_MY/ESAT1(IN)/FACTPL             <a name='6484'>
              FK1(KR,ICE)=(AL1_MY(IN)/RVT-1.)*AL1_MY(IN)/CF_MY/TP<a name='6485'>
              R1_MY1(KR,ICE)=VENTPL*CONSTL<a name='6486'>
<font color=#447700>!             R1_MY2(KR,ICE)=VENTPL*CONSTL*0.<a name='6487'></font>
<font color=#447700>!             R1_MY3(KR,ICE)=VENTPL*CONSTL*0.<a name='6488'></font>
              R11_MY(KR,ICE)=R1_MY1(KR,ICE)<a name='6489'>
<font color=#447700>!BARRY        R12_MY(KR,ICE)=R1_MY2(KR,ICE)-R1_MY3(KR,ICE)<a name='6490'></font>
<font color=#447700>! growth rate <a name='6491'></font>
              DETL=FK1(KR,ICE)+FD1(KR,ICE)<a name='6492'>
              B11_MY(KR,ICE)=R11_MY(KR,ICE)/DETL<a name='6493'>
<font color=#447700>!BARRY        B12_MY(KR,ICE)=R12_MY(KR,ICE)/DETL<a name='6494'></font>
              B12_MY(KR,ICE)=0.<a name='6495'>
           ENDDO<a name='6496'>
        ENDDO<a name='6497'>
<a name='6498'>
<a name='6499'>
	RETURN<a name='6500'>
	END SUBROUTINE JERRATE<a name='6501'>
<a name='6502'>
<font color=#447700>! SUBROUTINE JERRATE<a name='6503'></font>
<font color=#447700>!========================================================================<a name='6504'></font>
<font color=#447700>!BARRY    CALL JERSUPSAT(DEL1,DEL2,DEL1N,DEL2N<a name='6505'></font>
<font color=#447700>!    *                        ,RW,PW,RI,PI,QW,QI<a name='6506'></font>
<font color=#447700>!    *                        ,DTT,D1N,D2N,DT0L,DT0I)<a name='6507'></font>
<A NAME='JERSUPSAT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6508'>
	<font color=#993300>SUBROUTINE </font><font color=#cc0000>JERSUPSAT</font>(DEL1,DEL2,DEL1N,DEL2N &amp; <A href='../../call_to/JERSUPSAT.html' TARGET='index'>12</A>,<A href='../../call_from/JERSUPSAT.html' TARGET='index'>10</A><a name='6509'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='6510'>
     &amp;                      ,DT,DEL1INT,DEL2INT,DT0L,DT0I)<a name='6511'>
      IMPLICIT NONE<a name='6512'>
   <a name='6513'>
      INTEGER ITYPE<a name='6514'>
      REAL DEL1,DEL2,RW,PW,RI,PI,QW,QI, &amp;<a name='6515'>
     &amp;  DT,DEL1INT,DEL2INT,DT0L,DT0I,DTLIN,DTIIN<a name='6516'>
      REAL DETER,DBLRW,DBLPW,DBLPI,DBLRI, &amp;<a name='6517'>
     &amp;  DBLDEL1,DBLDEL2,DBLDEL1INT,DBLDTLIN,DBLDTIIN, &amp;<a name='6518'>
     &amp;  EXPM,EXPP,ALFAMX,ALFAPX,X,ALFA,DELX,DBLDEL2INT, &amp;<a name='6519'>
     &amp;  R1RES,R2RES,R1,R2,R3,R4,R21,R11,R10,R41,R31,R30,DBLDT, &amp;<a name='6520'>
     &amp;  DBLDEL1N,DBLDEL2N<a name='6521'>
      DOUBLE PRECISION DEL1N,DEL2N<a name='6522'>
<a name='6523'>
        DOUBLE PRECISION DEL1N_2P,DEL1INT_2P,DEL2N_2P,DEL2INT_2P <a name='6524'>
        DOUBLE PRECISION EXPP_2P,EXPM_2P,ARGEXP     <a name='6525'>
<font color=#447700>! BARRY<a name='6526'></font>
      DOUBLE PRECISION RW_DP,PW_DP,PI_DP,RI_DP,X_DP,ALFA_DP<a name='6527'>
<font color=#447700>!    * ,ALFAPX_DP<a name='6528'></font>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6529'></font>
      DOUBLE PRECISION  EXPM1<a name='6530'>
      EXPM1(x_dp)= &amp;<a name='6531'>
     &amp;x_dp+x_dp*x_dp/2.0D0+x_dp*x_dp*x_dp/6.0D0+x_dp*x_dp*x_dp*x_dp/24.0D0+x_dp*x_dp*x_dp*x_dp*x_dp/120.0D0<a name='6532'>
      DOUBLE PRECISION  DETER_MIN<a name='6533'>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6534'></font>
<a name='6535'>
      DOUBLE PRECISION EXP1, EXP2<a name='6536'>
<a name='6537'>
<font color=#447700>! Andrei's new change 9.03.10                                   (end)<a name='6538'></font>
	DTLIN=1000.E17<a name='6539'>
	DTIIN=1000.E17<a name='6540'>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6541'></font>
      DETER=RW*PI-PW*RI<a name='6542'>
<font color=#447700>!     DETER_MIN=1.0D-20<a name='6543'></font>
<font color=#447700>! Andrei's new change 9.03.10                                 (end)<a name='6544'></font>
<font color=#447700>! SOLUTION  <a name='6545'></font>
<font color=#447700>!IF(DETER.EQ.0)  THEN<a name='6546'></font>
       IF(RW.EQ.0.AND.RI.EQ.0) THEN<a name='6547'>
<font color=#447700>! NO CLOUD: WITHOUT WATER &amp; ICE<a name='6548'></font>
	    DEL1N_2P=DEL1<a name='6549'>
	    DEL2N_2P=DEL2<a name='6550'>
	    DEL1INT_2P=DEL1*DT<a name='6551'>
	    DEL2INT_2P=DEL2*DT<a name='6552'>
<font color=#447700>! IN CASE: RW.NE.0 OR RI.NE.0 (WATER OR ICE) <a name='6553'></font>
       ELSE IF(RW.NE.0.AND.RI*1.E5.LT.RW) THEN<a name='6554'>
<font color=#447700>! ONLY WATER<a name='6555'></font>
              ARGEXP=-RW*DT<a name='6556'>
<a name='6557'>
	      DEL1N_2P=DEL1*DEXP(ARGEXP)+QW*(1.-DEXP(ARGEXP))<a name='6558'>
	      DEL1INT_2P=(DEL1-DEL1N_2P)/RW<a name='6559'>
	      DEL2N_2P=DEL2-PW*DEL1INT_2P<a name='6560'>
	      DEL2INT_2P= &amp;<a name='6561'>
     &amp;       (DEL2N_2P-PW*DEL1N_2P/RW)*DT+PW*DEL1INT_2P/RW<a name='6562'>
	ELSE IF(RI.NE.0.AND.RW*1.E5.LT.RI) THEN<a name='6563'>
<font color=#447700>! IN CASE: RW.EQ.0<a name='6564'></font>
<font color=#447700>! ONLY ICE <a name='6565'></font>
              ARGEXP=-PI*DT<a name='6566'>
<a name='6567'>
	      DEL2N_2P=DEL2*DEXP(ARGEXP)+QI*(1.-DEXP(ARGEXP))<a name='6568'>
	      DEL2INT_2P=(DEL2-DEL2N_2P)/PI<a name='6569'>
	      DEL1N_2P=DEL1-RI*DEL2INT_2P<a name='6570'>
	      DEL1INT_2P= &amp;<a name='6571'>
     &amp;       (DEL1N_2P-RI*DEL2N_2P/PI)*DT+RI*DEL2INT_2P/PI<a name='6572'>
<font color=#447700>!             GOTO 100<a name='6573'></font>
<font color=#447700>! IN CASE: RW.NE.0 OR RI.NE.0 (WATER OR ICE)<a name='6574'></font>
<font color=#447700>! IN CASE: DETER.EQ.0<a name='6575'></font>
        ELSE<a name='6576'>
<font color=#447700>! IN CASE: DETER.NE.0<a name='6577'></font>
<font color=#447700>! COMPLETE SOLUTION <a name='6578'></font>
<font color=#447700>!  ALFA=SQRT((RW-PI)*(RW-PI)+4.*PW*RI)<a name='6579'></font>
<font color=#447700>!  X=RW+PI<a name='6580'></font>
<font color=#447700>!  ALFAPX=.5*(ALFA+X)<a name='6581'></font>
<font color=#447700>! BARRY <a name='6582'></font>
          RW_DP=RW<a name='6583'>
          RI_DP=RI<a name='6584'>
          PI_DP=PI<a name='6585'>
          PW_DP=PW<a name='6586'>
          IF (RW.LE.0)PRINT*,'RW = ',RW<a name='6587'>
          IF (PW.LE.0)PRINT*,'PW = ',PW<a name='6588'>
          IF (RI.LE.0)PRINT*,'RI = ',RI<a name='6589'>
          IF (PI.LE.0)PRINT*,'PI = ',PI<a name='6590'>
          IF (RW.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_794">("fatal error in module_mp_full_sbm (RW.LE.0), model stop")<a name='6591'>
          IF (PW.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_795">("fatal error in module_mp_full_sbm (PW.LE.0), model stop")<a name='6592'>
          IF (RI.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_796">("fatal error in module_mp_full_sbm (RI.LE.0), model stop")<a name='6593'>
          IF (PI.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_797">("fatal error in module_mp_full_sbm (PI.LE.0), model stop")<a name='6594'>
          ALFA_DP=SQRT((RW_DP-PI_DP)*(RW_DP-PI_DP)+4.*PW_DP*RI_DP) <a name='6595'>
	  X_DP=RW_DP+PI_DP<a name='6596'>
	  ALFAPX=.5*(ALFA_DP+X_DP)<a name='6597'>
          IF (ALFAPX.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_798">("fatal error in module_mp_full_sbm (ALFAPX.LE.0), model stop") <a name='6598'>
	  ALFAMX=.5*(ALFA_DP-X_DP)<a name='6599'>
<font color=#447700>!<a name='6600'></font>
<font color=#447700>! <a name='6601'></font>
          ARGEXP=-ALFAPX*DT<a name='6602'>
<font color=#447700>! Andrei 11/04/10<a name='6603'></font>
	  EXPP_2P=DEXP(ARGEXP)<a name='6604'>
          IF(DABS(ARGEXP).LE.1.0E-6) THEN<a name='6605'>
               EXP1=EXPM1(ARGEXP)<a name='6606'>
          ELSE<a name='6607'>
               EXP1=EXPP_2P-1.0D0<a name='6608'>
          ENDIF<a name='6609'>
<font color=#447700>!<a name='6610'></font>
          ARGEXP=ALFAMX*DT<a name='6611'>
<font color=#447700>!Andre 11/04/10<a name='6612'></font>
	  EXPM_2P=DEXP(ARGEXP)<a name='6613'>
              IF(DABS(ARGEXP).LE.1.0E-6) THEN<a name='6614'>
                EXP2=EXPM1(ARGEXP)<a name='6615'>
              ELSE<a name='6616'>
                EXP2=EXPM_2P-1.0D0<a name='6617'>
              ENDIF<a name='6618'>
<font color=#447700>!<a name='6619'></font>
<font color=#447700>! DROPLETS <a name='6620'></font>
	  R10=RW*DEL1+RI*DEL2<a name='6621'>
	  R11=R10-ALFAPX*DEL1<a name='6622'>
	  R21=R10+ALFAMX*DEL1<a name='6623'>
	  DEL1N_2P=(R21*EXPP_2P-R11*EXPM_2P)/ALFA_DP<a name='6624'>
<font color=#447700>! BARRY<a name='6625'></font>
	  IF(ALFAMX.NE.0) THEN<a name='6626'>
	    R1=-R11/ALFAMX<a name='6627'>
	    R2=R21/ALFAPX<a name='6628'>
<font color=#447700>!    DEL1INT_2P=(R1*(EXPM_2P-1.)-R2*(EXPP_2P-1.))/ALFA_DP<a name='6629'></font>
            DEL1INT_2P=(R1*EXP2-R2*EXP1)/ALFA_DP<a name='6630'>
	  ELSE<a name='6631'>
            DEL1INT_2P = 0.<a name='6632'>
	  ENDIF<a name='6633'>
<font color=#447700>! BARRY<a name='6634'></font>
	  R1RES=0.<a name='6635'>
	  IF(R11.NE.0) R1RES=R21/R11<a name='6636'>
	  IF(R1RES.GT.0) DTLIN=ALOG(R1RES)/ALFA_DP<a name='6637'>
<font color=#447700>! ICE <a name='6638'></font>
	  R30=PW*DEL1+PI*DEL2<a name='6639'>
	  R31=R30-ALFAPX*DEL2<a name='6640'>
	  R41=R30+ALFAMX*DEL2<a name='6641'>
<font color=#447700>! BARRY<a name='6642'></font>
	  DEL2N_2P=(R41*EXPP_2P-R31*EXPM_2P)/ALFA_DP<a name='6643'>
	  IF(ALFAMX.NE.0.AND.ALFAPX.NE.0) THEN<a name='6644'>
	    R3=-R31/ALFAMX<a name='6645'>
	    R4=R41/ALFAPX<a name='6646'>
<font color=#447700>!           DEL2INT_2P=(R3*(EXPM_2P-1.)-R4*(EXPP_2P-1.))/ALFA_DP<a name='6647'></font>
            DEL2INT_2P=(R3*EXP2-R4*EXP1)/ALFA_DP<a name='6648'>
          ELSE<a name='6649'>
	    DEL2INT_2P=0.<a name='6650'>
	  ENDIF<a name='6651'>
	  R2RES=0.<a name='6652'>
	  IF(R31.NE.0) R2RES=R41/R31<a name='6653'>
	  IF(R2RES.GT.0) DTIIN=ALOG(R2RES)/ALFA_DP<a name='6654'>
<font color=#447700>! IN CASE: DETER.NE.0<a name='6655'></font>
<font color=#447700>! END OF COMPLETE SOLUTION<a name='6656'></font>
	ENDIF<a name='6657'>
<font color=#447700>! IN CASES: DETER.EQ.0 OR DETER.NE.0<a name='6658'></font>
 100    CONTINUE<a name='6659'>
        DEL1N=DEL1N_2P<a name='6660'>
        DEL2N=DEL2N_2P<a name='6661'>
       <a name='6662'>
<font color=#447700>! BARRY<a name='6663'></font>
        DEL1INT=DEL1INT_2P<a name='6664'>
        DEL2INT=DEL2INT_2P<a name='6665'>
	DT0L=DTLIN<a name='6666'>
	IF(DT0L.LT.0) DT0L=1.E20<a name='6667'>
	DT0I=DTIIN<a name='6668'>
	IF(DT0I.LT.0) DT0I=1.E20<a name='6669'>
	RETURN<a name='6670'>
	END SUBROUTINE JERSUPSAT<a name='6671'>
<font color=#447700>!==========================================================================<a name='6672'></font>
<A NAME='JERTIMESC'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6673'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERTIMESC</font>(FI1,X1,SFN11,SFN12 &amp; <A href='../../call_to/JERTIMESC.html' TARGET='index'>16</A><a name='6674'>
     &amp;                      ,B11_MY,B12_MY,RIEC,CF,ID,COL,NKR)        <a name='6675'>
      IMPLICIT NONE<a name='6676'>
       INTEGER NRM,KR,ICE,ID,NKR<a name='6677'>
      REAL B12,B11,FUN,DELM,FK,CF,SFN12S,SFN11S<a name='6678'>
	REAL  COL, &amp;<a name='6679'>
     &amp; X1(NKR,ID),FI1(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6680'>
     &amp;,RIEC(NKR,ID),SFN11,SFN12<a name='6681'>
<a name='6682'>
	NRM=NKR-1<a name='6683'>
	DO 1 ICE=1,ID  <a name='6684'>
             SFN11S=0.                              <a name='6685'>
             SFN12S=0.<a name='6686'>
	     SFN11=CF*SFN11S	<a name='6687'>
	     SFN12=CF*SFN12S<a name='6688'>
             DO KR=1,NRM<a name='6689'>
<font color=#447700>! VALUE OF DISTRIBUTION FUNCTION<a name='6690'></font>
	        FK=FI1(KR,ICE)<a name='6691'>
<font color=#447700>! DELTA-M <a name='6692'></font>
	        DELM=X1(KR,ICE)*3.*COL<a name='6693'>
<font color=#447700>! INTEGRAL'S EXPRESSION <a name='6694'></font>
	        FUN=FK*DELM<a name='6695'>
<font color=#447700>! VALUES OF INTEGRALS<a name='6696'></font>
	        B11=B11_MY(KR,ICE)<a name='6697'>
        	B12=B12_MY(KR,ICE)<a name='6698'>
                SFN11S=SFN11S+FUN*B11                               <a name='6699'>
                SFN12S=SFN12S+FUN*B12<a name='6700'>
	     ENDDO<a name='6701'>
<font color=#447700>! CORRECTION <a name='6702'></font>
	     SFN11=CF*SFN11S<a name='6703'>
             SFN12=CF*SFN12S<a name='6704'>
    1   CONTINUE<a name='6705'>
<font color=#447700>! END <a name='6706'></font>
	RETURN<a name='6707'>
	END SUBROUTINE JERTIMESC<a name='6708'>
<font color=#447700>!<a name='6709'></font>
<A NAME='JERTIMESC_ICE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6710'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERTIMESC_ICE</font>(FI1,X1,SFN11,SFN12 &amp; <A href='../../call_to/JERTIMESC_ICE.html' TARGET='index'>4</A><a name='6711'>
     &amp;                      ,B11_MY,B12_MY,RIEC,CF,ID,COL,NKR)        <a name='6712'>
      IMPLICIT NONE<a name='6713'>
       INTEGER NRM,KR,ICE,ID,NKR<a name='6714'>
      REAL B12,B11,FUN,DELM,FK,CF,SFN12S,SFN11S<a name='6715'>
	REAL  COL, &amp;<a name='6716'>
     &amp; X1(NKR,ID),FI1(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6717'>
     &amp;,RIEC(NKR,ID),SFN11(ID),SFN12(ID)<a name='6718'>
<a name='6719'>
	NRM=NKR-1<a name='6720'>
	DO 1 ICE=1,ID  <a name='6721'>
             SFN11S=0.                              <a name='6722'>
             SFN12S=0.<a name='6723'>
	     SFN11(ICE)=CF*SFN11S	<a name='6724'>
	     SFN12(ICE)=CF*SFN12S<a name='6725'>
             DO KR=1,NRM<a name='6726'>
<font color=#447700>! VALUE OF DISTRIBUTION FUNCTION<a name='6727'></font>
	        FK=FI1(KR,ICE)<a name='6728'>
<font color=#447700>! DELTA-M <a name='6729'></font>
	        DELM=X1(KR,ICE)*3.*COL<a name='6730'>
<font color=#447700>! INTEGRAL'S EXPRESSION <a name='6731'></font>
	        FUN=FK*DELM<a name='6732'>
<font color=#447700>! VALUES OF INTEGRALS<a name='6733'></font>
	        B11=B11_MY(KR,ICE)<a name='6734'>
        	B12=B12_MY(KR,ICE)<a name='6735'>
                SFN11S=SFN11S+FUN*B11                               <a name='6736'>
                SFN12S=SFN12S+FUN*B12<a name='6737'>
	     ENDDO<a name='6738'>
<font color=#447700>! CORRECTION <a name='6739'></font>
	     SFN11(ICE)=CF*SFN11S<a name='6740'>
             SFN12(ICE)=CF*SFN12S<a name='6741'>
    1   CONTINUE<a name='6742'>
<font color=#447700>! END <a name='6743'></font>
	RETURN<a name='6744'>
	END SUBROUTINE JERTIMESC_ICE<a name='6745'>
<a name='6746'>
<a name='6747'>
<A NAME='ONECOND2'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6748'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND2</font> &amp; <A href='../../call_to/ONECOND2.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND2.html' TARGET='index'>56</A><a name='6749'>
     &amp; (TT,QQ,PP,ROR  &amp;<a name='6750'>
     &amp; ,VR2,VR3,VR4,VR5,PSINGLE &amp;<a name='6751'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6752'>
     &amp; ,FF2,PSI2,R2,RIEC,RO2BL &amp;<a name='6753'>
     &amp; ,FF3,PSI3,R3,RSEC,RO3BL &amp;<a name='6754'>
     &amp; ,FF4,PSI4,R4,RGEC,RO4BL &amp;<a name='6755'>
     &amp; ,FF5,PSI5,R5,RHEC,RO5BL &amp;<a name='6756'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6757'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='6758'>
     &amp; ,COL,DTCOND,ICEMAX,NKR &amp;<a name='6759'>
     &amp; ,ISYM2,ISYM3,ISYM4,ISYM5)<a name='6760'>
<a name='6761'>
       IMPLICIT NONE<a name='6762'>
<a name='6763'>
      INTEGER NKR,ICEMAX<a name='6764'>
      REAL    COL,VR2(NKR,ICEMAX),VR3(NKR),VR4(NKR) &amp;<a name='6765'>
     &amp;           ,VR5(NKR),PSINGLE &amp;<a name='6766'>
     &amp;       ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6767'>
     &amp;       ,DTCOND<a name='6768'>
<a name='6769'>
      REAL C1_MEY,C2_MEY<a name='6770'>
      INTEGER I_MIXCOND,I_MIXEVAP,I_ABERGERON,I_BERGERON, &amp;<a name='6771'>
     &amp; KR,ICE,ITIME,ICM,KCOND,NR,NRM,INUC, &amp;<a name='6772'>
     &amp; ISYM2,ISYM3,ISYM4,ISYM5,KP,KLIMIT, &amp;<a name='6773'>
     &amp; KM,ITER,KLIMITL,KLIMITG,KLIMITH,KLIMITI_1,KLIMITI_2,KLIMITI_3, &amp;<a name='6774'>
     &amp; NCRITI<a name='6775'>
      REAL AL1,AL2,D,GAM,POD, &amp;<a name='6776'>
     &amp; RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY,ALC,DT0LREF,DTLREF, &amp;<a name='6777'>
     &amp; A1_MYN, BB1_MYN, A2_MYN, BB2_MYN,DT,DTT,XRAD, &amp;<a name='6778'>
     &amp; TPC1, TPC2, TPC3, TPC4, TPC5, &amp;<a name='6779'>
     &amp; EPSDEL, DT0L, DT0I, &amp;<a name='6780'>
     &amp; ROR, &amp;<a name='6781'>
     &amp; DEL1NUC,DEL2NUC, &amp;<a name='6782'>
     &amp; CWHUCM,B6,B8L,B8I,RMASSGL,RMASSGI, &amp;<a name='6783'>
     &amp; DEL1,DEL2,DEL1S,DEL2S, &amp;<a name='6784'>
     &amp; TIMENEW,TIMEREV,SFN11,SFN12, &amp;<a name='6785'>
     &amp; SFNL,SFNI,B5L,B5I,B7L,B7I,DOPL,DOPI,OPERQ,RW,RI,QW,PW, &amp;<a name='6786'>
     &amp; PI,QI,D1N0,D2N0,DTNEWL,DTNEWL1,D1N,D2N, &amp;<a name='6787'>
     &amp; DEL_R1,DT0L0,DT0I0,SFN31,SFN32,SFN52, &amp;<a name='6788'>
     &amp; SFNII1,SFN21,SFN22,DTNEWI3,DTNEWI4,DTNEWI5,DTNEWI2_1, &amp;<a name='6789'>
     &amp; DTNEWI2_2,DTNEWI1,DEL_R2,DEL_R4,DEL_R5,SFN41,SFN42, &amp;<a name='6790'>
     &amp; SNF51,DTNEWI2_3,DTNEWI2,DTNEWI_1,DTNEWI_2, &amp;<a name='6791'>
     &amp; DTNEWL0,DTNEWG1,DTNEWH1,DTNEWI_3, &amp;<a name='6792'>
     &amp; DTNEWL2,SFN51,SFNII2,DEL_R3,DTNEWI  <a name='6793'>
       REAL DT_WATER_COND,DT_WATER_EVAP,DT_ICE_COND,DT_ICE_EVAP, &amp;<a name='6794'>
     &amp;  DT_MIX_COND,DT_MIX_EVAP,DT_MIX_BERGERON,DT_MIX_ANTIBERGERON<a name='6795'>
<a name='6796'>
       INTEGER K<a name='6797'>
<a name='6798'>
<font color=#447700>! NEW ALGORITHM OF CONDENSATION (12.01.00)<a name='6799'></font>
<a name='6800'>
      DOUBLE PRECISION DD1N,DB11_MY,DAL1,DAL2<a name='6801'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='6802'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='6803'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='6804'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='6805'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='6806'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='6807'>
     &amp;                  ,TT,QQ,PP &amp;<a name='6808'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6809'>
     &amp;                  ,OPER2,OPER3,AR1,AR2  <a name='6810'>
<a name='6811'>
       DOUBLE PRECISION DELTAQ1,DELMASSI1,DELMASSL1<a name='6812'>
<a name='6813'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='6814'></font>
<a name='6815'>
        CHARACTER*70 CPRINT<a name='6816'>
<a name='6817'>
<a name='6818'>
<a name='6819'>
<a name='6820'>
<a name='6821'>
<a name='6822'>
<a name='6823'>
<font color=#447700>! CRYSTALS<a name='6824'></font>
                                                                       <a name='6825'>
	REAL R2(NKR,ICEMAX) &amp;<a name='6826'>
     &amp;           ,RIEC(NKR,ICEMAX) &amp;<a name='6827'>
     &amp;           ,RO2BL(NKR,ICEMAX) &amp;<a name='6828'>
     &amp;           ,FI2(NKR,ICEMAX),PSI2(NKR,ICEMAX) &amp;<a name='6829'>
     &amp;           ,FF2(NKR,ICEMAX) &amp;<a name='6830'>
     &amp;           ,B21_MY(NKR,ICEMAX),B22_MY(NKR,ICEMAX)<a name='6831'>
<a name='6832'>
<font color=#447700>! SNOW                                                                          <a name='6833'></font>
        REAL R3(NKR) &amp;<a name='6834'>
     &amp;           ,RSEC(NKR),RO3BL(NKR) &amp;<a name='6835'>
     &amp;           ,FI3(NKR),FF3(NKR),PSI3(NKR) &amp;<a name='6836'>
     &amp;           ,B31_MY(NKR),B32_MY(NKR)<a name='6837'>
<a name='6838'>
<font color=#447700>! GRAUPELS <a name='6839'></font>
                                                                       <a name='6840'>
        REAL R4(NKR) &amp;<a name='6841'>
     &amp;           ,RGEC(NKR),RO4BL(NKR) &amp;<a name='6842'>
     &amp;           ,FI4(NKR),FF4(NKR),PSI4(NKR) &amp;<a name='6843'>
     &amp;           ,B41_MY(NKR),B42_MY(NKR)  <a name='6844'>
<a name='6845'>
<font color=#447700>! HAIL                                                                          <a name='6846'></font>
        REAL R5(NKR) &amp;<a name='6847'>
     &amp;           ,RHEC(NKR),RO5BL(NKR) &amp;<a name='6848'>
     &amp;           ,FI5(NKR),FF5(NKR),PSI5(NKR) &amp;<a name='6849'>
     &amp;           ,B51_MY(NKR),B52_MY(NKR)  <a name='6850'>
<a name='6851'>
<font color=#447700>! CCN                                                                       <a name='6852'></font>
<a name='6853'>
<font color=#447700>! WORK ARRAYS <a name='6854'></font>
<a name='6855'>
<font color=#447700>! NEW ALGORITHM OF MIXED PHASE FOR EVAPORATION<a name='6856'></font>
<a name='6857'>
	REAL DTIMEG(NKR),DTIMEH(NKR) <a name='6858'>
       <a name='6859'>
	REAL DEL2D(ICEMAX),DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='6860'>
<a name='6861'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='6862'></font>
<a name='6863'>
     &amp;           ,DTIMEI_1(NKR),DTIMEI_2(NKR),DTIMEI_3(NKR) &amp;<a name='6864'>
     &amp;           ,SFNI1(ICEMAX),SFNI2(ICEMAX) &amp;<a name='6865'>
     &amp;           ,TIMESTEPD(NKR) &amp;<a name='6866'>
     &amp;           ,FI1REF(NKR),PSI1REF(NKR) &amp;<a name='6867'>
     &amp;           ,FI2REF(NKR,ICEMAX),PSI2REF(NKR,ICEMAX)&amp;<a name='6868'>
     &amp;           ,FCCNRREF(NKR)<a name='6869'>
<a name='6870'>
<a name='6871'>
	OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='6872'>
	OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='6873'>
<a name='6874'>
        DATA AL1 /2500./, AL2 /2834./, D /0.211/ &amp;<a name='6875'>
     &amp;      ,GAM /1.E-4/, POD /10./ <a name='6876'>
           <a name='6877'>
	DATA RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY &amp;<a name='6878'>
     &amp;      /461.5,0.24E-1,0.211E-4,2.5E6,2.834E6/<a name='6879'>
<a name='6880'>
	DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='6881'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='6882'>
<a name='6883'>
	DATA TPC1, TPC2, TPC3, TPC4, TPC5 &amp;<a name='6884'>
     &amp;      /-4.0,-8.1,-12.7,-17.8,-22.4/ <a name='6885'>
<a name='6886'>
<a name='6887'>
        DATA EPSDEL/0.1E-03/<a name='6888'>
    <a name='6889'>
	DATA DT0L, DT0I /1.E20,1.E20/<a name='6890'>
<a name='6891'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='6892'></font>
<a name='6893'>
<a name='6894'>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS IN MIXED PHASE: EVAPORATION<a name='6895'></font>
        <a name='6896'>
        I_MIXCOND=0<a name='6897'>
        I_MIXEVAP=0<a name='6898'>
        I_ABERGERON=0<a name='6899'>
        I_BERGERON=0<a name='6900'>
<font color=#447700>! SOME CONSTANTS <a name='6901'></font>
        COL3=3.0*COL<a name='6902'>
        ICM=ICEMAX<a name='6903'>
        ITIME=0<a name='6904'>
        KCOND=0<a name='6905'>
        DT_WATER_COND=0.4<a name='6906'>
        DT_WATER_EVAP=0.4<a name='6907'>
        DT_ICE_COND=0.4<a name='6908'>
        DT_ICE_EVAP=0.4<a name='6909'>
        DT_MIX_COND=0.4<a name='6910'>
        DT_MIX_EVAP=0.4<a name='6911'>
        DT_MIX_BERGERON=0.4<a name='6912'>
        DT_MIX_ANTIBERGERON=0.4<a name='6913'>
	ICM=ICEMAX<a name='6914'>
	ITIME=0<a name='6915'>
	KCOND=0<a name='6916'>
        DT0LREF=0.2<a name='6917'>
        DTLREF=0.4<a name='6918'>
<a name='6919'>
	NR=NKR<a name='6920'>
	NRM=NKR-1<a name='6921'>
	DT=DTCOND<a name='6922'>
	DTT=DTCOND<a name='6923'>
	XRAD=0.<a name='6924'>
<a name='6925'>
<font color=#447700>!     BARRY<a name='6926'></font>
	CWHUCM=0.<a name='6927'>
	XRAD=0.<a name='6928'>
	B6=CWHUCM*GAM-XRAD<a name='6929'>
	B8L=1./ROR<a name='6930'>
	B8I=1./ROR<a name='6931'>
        RORI=1./ROR<a name='6932'>
<a name='6933'>
<font color=#447700>! INITIALIZATION OF SOME ARRAYS<a name='6934'></font>
<a name='6935'>
<font color=#447700>!       BARRY<a name='6936'></font>
        TPN=TT<a name='6937'>
        QPN=QQ<a name='6938'>
<a name='6939'>
<a name='6940'>
<font color=#447700>! TYPE OF ICE IN DIFFUSIONAL GROWTH <a name='6941'></font>
<a name='6942'>
	      DO ICE=1,ICEMAX<a name='6943'>
	         SFNI1(ICE)=0.<a name='6944'>
	         SFNI2(ICE)=0.<a name='6945'>
	         DEL2D(ICE)=0.<a name='6946'>
	      ENDDO<a name='6947'>
<a name='6948'>
<font color=#447700>! TIME SPLITTING <a name='6949'></font>
<a name='6950'>
	      TIMENEW=0.<a name='6951'>
	      ITIME=0<a name='6952'>
<a name='6953'>
<font color=#447700>! ONLY ICE (CONDENSATION OR EVAPORATION) :<a name='6954'></font>
<a name='6955'>
   46         ITIME=ITIME+1<a name='6956'>
<a name='6957'>
	      TIMEREV=DT-TIMENEW<a name='6958'>
<a name='6959'>
	      DEL1=DEL1N<a name='6960'>
	      DEL2=DEL2N<a name='6961'>
	      DEL1S=DEL1N<a name='6962'>
	      DEL2S=DEL2N<a name='6963'>
	      DEL2D(1)=DEL2N<a name='6964'>
	      DEL2D(2)=DEL2N<a name='6965'>
	      DEL2D(3)=DEL2N<a name='6966'>
	      TPS=TPN<a name='6967'>
	      QPS=QPN<a name='6968'>
              DO KR=1,NKR<a name='6969'>
                 FI3(KR)=PSI3(KR)<a name='6970'>
                 FI4(KR)=PSI4(KR)<a name='6971'>
                 FI5(KR)=PSI5(KR)<a name='6972'>
                 DO ICE=1,ICEMAX<a name='6973'>
                    FI2(KR,ICE)=PSI2(KR,ICE)<a name='6974'>
                 ENDDO<a name='6975'>
              ENDDO<a name='6976'>
<font color=#447700>! TIME-STEP GROWTH RATE: <a name='6977'></font>
<font color=#447700>! ONLY ICE (CONDENSATION OR EVAPORATION)<a name='6978'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_12">(R2,TPS,PP,ROR,VR2,PSINGLE &amp;<a name='6979'>
     &amp;                    ,RIEC,RO2BL,B21_MY,B22_MY,3,2,ICEMAX,NKR)   <a name='6980'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_13">(R3,TPS,PP,ROR,VR3,PSINGLE &amp;<a name='6981'>
     &amp;                    ,RSEC,RO3BL,B31_MY,B32_MY,1,2,ICEMAX,NKR)<a name='6982'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_14">(R4,TPS,PP,ROR,VR4,PSINGLE &amp;<a name='6983'>
     &amp;                    ,RGEC,RO4BL,B41_MY,B42_MY,1,2,ICEMAX,NKR)<a name='6984'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_15">(R5,TPS,PP,ROR,VR5,PSINGLE &amp;<a name='6985'>
     &amp;                    ,RHEC,RO5BL,B51_MY,B52_MY,1,2,ICEMAX,NKR)<a name='6986'>
<a name='6987'>
<a name='6988'>
<font color=#447700>! INTEGRALS IN DELTA EQUATION<a name='6989'></font>
<a name='6990'>
<font color=#447700>! CALL JERTIMESC CRYSTAL - 1 (ONLY ICE)<a name='6991'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC_ICE'>JERTIMESC_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_ICE_3">  &amp;<a name='6992'>
     &amp;       (FI2,R2,SFNI1,SFNI2,B21_MY,B22_MY,RIEC,B8I,ICM,COL,NKR) <a name='6993'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_10"> &amp;<a name='6994'>
     &amp;       (FI3,R3,SFN31,SFN32,B31_MY,B32_MY,RSEC,B8I,1,COL,NKR)  <a name='6995'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_11"> &amp;<a name='6996'>
     &amp;       (FI4,R4,SFN41,SFN42,B41_MY,B42_MY,RGEC,B8I,1,COL,NKR) <a name='6997'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_12"> &amp;<a name='6998'>
     &amp;       (FI5,R5,SFN51,SFN52,B51_MY,B52_MY,RHEC,B8I,1,COL,NKR)<a name='6999'>
	      SFNII1=SFNI1(1)+SFNI1(2)+SFNI1(3)<a name='7000'>
	      SFNII2=SFNI2(1)+SFNI2(2)+SFNI2(3)<a name='7001'>
	      SFN21=SFNII1+SFN31+SFN41+SFN51        <a name='7002'>
	      SFN22=SFNII2+SFN32+SFN42+SFN52 <a name='7003'>
	      SFNL=0.<a name='7004'>
	      SFNI=SFN21+SFN22       <a name='7005'>
<font color=#447700>! SOME CONSTANTS <a name='7006'></font>
	      B5L=BB1_MY/TPS/TPS<a name='7007'>
	      B5I=BB2_MY/TPS/TPS<a name='7008'>
              B7L=B5L*B6                                                     <a name='7009'>
              B7I=B5I*B6<a name='7010'>
	      DOPL=1.+DEL1S                                                     <a name='7011'>
	      DOPI=1.+DEL2S                                                     <a name='7012'>
	      OPERQ=OPER2(QPS)  <a name='7013'>
              RW=(OPERQ+B5L*AL1)*DOPL*SFNL                                      <a name='7014'>
              QW=B7L*DOPL<a name='7015'>
              PW=(OPERQ+B5I*AL1)*DOPI*SFNL<a name='7016'>
              RI=(OPERQ+B5L*AL2)*DOPL*SFNI<a name='7017'>
              PI=(OPERQ+B5I*AL2)*DOPI*SFNI<a name='7018'>
              QI=B7I*DOPI<a name='7019'>
	      KCOND=20<a name='7020'>
	      IF(DEL2.GT.0) KCOND=21<a name='7021'>
<a name='7022'>
<font color=#447700>! PROCESS'S TYPE (ONLY ICE) <a name='7023'></font>
<a name='7024'>
	      IF(KCOND.EQ.21)  THEN<a name='7025'>
<a name='7026'>
<font color=#447700>! ONLY_ICE: CONDENSATION<a name='7027'></font>
<a name='7028'>
	      <a name='7029'>
                DT0I=1.E20<a name='7030'>
	        DTNEWI1=DTCOND<a name='7031'>
	        DTNEWL=DTNEWI1<a name='7032'>
	        IF(ITIME.GE.NKR) THEN<a name='7033'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_799">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='7034'>
	        ENDIF<a name='7035'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='7036'>
<font color=#447700>! NEW TIME STEP (ONLY_ICE: CONDENSATION)<a name='7037'></font>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7038'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='7039'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7040'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7041'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='7042'>
	        TIMENEW=TIMENEW+DTNEWL<a name='7043'>
	        DTT=DTNEWL<a name='7044'>
<font color=#447700>! SOLVING FOR SUPERSATURATION (ONLY ICE: CONDENSATION) <a name='7045'></font>
<a name='7046'>
<font color=#447700>! CALL JERSUPSAT - 4 (ONLY ICE: CONDENSATION)<a name='7047'></font>
<a name='7048'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_9">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='7049'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='7050'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='7051'>
<a name='7052'>
<font color=#447700>! END OF "NEW SUPERSATURATION" (ONLY ICE: CONDENSATION)<a name='7053'></font>
<a name='7054'>
<a name='7055'>
<font color=#447700>! CRYSTALS (ONLY ICE: CONDENSATION) <a name='7056'></font>
<a name='7057'>
	        IF(ISYM2.NE.0) THEN<a name='7058'>
<a name='7059'>
<font color=#447700>! CRYSTAL DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='7060'></font>
 <a name='7061'>
<font color=#447700>! CALL JERDFUN CRYSTAL - 1 (ONLY ICE: CONDENSATION)<a name='7062'></font>
<a name='7063'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7064'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_24">(R2,B21_MY,B22_MY &amp;<a name='7065'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='7066'>
     &amp;                        ,ICM,1,COL,NKR,TPN)<a name='7067'>
<a name='7068'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_25">(R2,B21_MY,B22_MY &amp;<a name='7069'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='7070'>
     &amp;                        ,ICM,2,COL,NKR,TPN)<a name='7071'>
<a name='7072'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_26">(R2,B21_MY,B22_MY &amp;<a name='7073'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='7074'>
     &amp;                        ,ICM,3,COL,NKR,TPN)<a name='7075'>
<font color=#447700>! IN CASE : ISYM2.NE.0<a name='7076'></font>
<a name='7077'>
	        ENDIF<a name='7078'>
<font color=#447700>! SNOW <a name='7079'></font>
	        IF(ISYM3.NE.0) THEN<a name='7080'>
<a name='7081'>
<font color=#447700>! SNOW DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='7082'></font>
                                                         <a name='7083'>
<a name='7084'>
<font color=#447700>! CALL JERDFUN SNOW - 1 (ONLY ICE: CONDENSATION)<a name='7085'></font>
                  CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_27">(R3,B31_MY,B32_MY &amp;<a name='7086'>
     &amp;                        ,FI3,PSI3,D2N &amp;<a name='7087'>
     &amp;                        ,1,3,COL,NKR,TPN)<a name='7088'>
<a name='7089'>
	        ENDIF<a name='7090'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='7091'></font>
<font color=#447700>! GRAUPELS (ONLY_ICE: EVAPORATION)<a name='7092'></font>
<a name='7093'>
                IF(ISYM4.NE.0) THEN<a name='7094'>
<a name='7095'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION)<a name='7096'></font>
<a name='7097'>
                  CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_28">(R4,B41_MY,B42_MY &amp;<a name='7098'>
     &amp;                        ,FI4,PSI4,D2N &amp;<a name='7099'>
     &amp;                        ,1,4,COL,NKR,TPN)<a name='7100'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='7101'></font>
<a name='7102'>
                ENDIF<a name='7103'>
<a name='7104'>
<a name='7105'>
<a name='7106'>
<font color=#447700>! HAIL (ONLY ICE: CONDENSATION) <a name='7107'></font>
<a name='7108'>
	        IF(ISYM5.NE.0) THEN<a name='7109'>
<a name='7110'>
<font color=#447700>! HAIL DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='7111'></font>
                                                         <a name='7112'>
<font color=#447700>! CALL JERDFUN HAIL - 1 (ONLY ICE: CONDENSATION) <a name='7113'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_29">(R5,B51_MY,B52_MY &amp;<a name='7114'>
     &amp;                        ,FI5,PSI5,D2N &amp;<a name='7115'>
     &amp;                        ,1,5,COL,NKR,TPN)<a name='7116'>
<font color=#447700>! IN CASE : ISYM5.NE.0<a name='7117'></font>
<a name='7118'>
	        ENDIF<a name='7119'>
<a name='7120'>
	        IF((DEL2.GT.0.AND.DEL2N.LT.0) &amp;<a name='7121'>
     &amp;         .AND.ABS(DEL2N).GT.EPSDEL) THEN<a name='7122'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_800">("fatal error in module_mp_full_sbm (DEL2.GT.0.AND.DEL2N.LT.0), model stop")<a name='7123'>
                ENDIF<a name='7124'>
<a name='7125'>
	      ELSE<a name='7126'>
<a name='7127'>
<font color=#447700>! IN CASE KCOND.NE.21 <a name='7128'></font>
<a name='7129'>
<font color=#447700>! ONLY ICE: EVAPORATION  <a name='7130'></font>
<a name='7131'>
<font color=#447700>! NEW TREATMENT OF TIME STEP (ONLY ICE: EVAPORATION) <a name='7132'></font>
<a name='7133'>
	        DT0I=1.E20<a name='7134'>
                IF (DEL2N.EQ.0)THEN<a name='7135'>
	          DTNEWL=DT<a name='7136'>
                ELSE<a name='7137'>
	         DTNEWI3=-R3(3)/(B31_MY(3)*DEL2N-B32_MY(3))<a name='7138'>
	         DTNEWI4=-R4(3)/(B41_MY(3)*DEL2N-B42_MY(3))<a name='7139'>
	         DTNEWI5=-R5(3)/(B51_MY(3)*DEL2N-B52_MY(3))<a name='7140'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='7141'></font>
	         DTNEWI2_1=-R2(3,1)/(B21_MY(1,1)*DEL2N-B22_MY(1,1))<a name='7142'>
	         DTNEWI2_2=-R2(3,2)/(B21_MY(1,2)*DEL2N-B22_MY(1,2))<a name='7143'>
	         DTNEWI2_3=-R2(3,3)/(B21_MY(1,3)*DEL2N-B22_MY(1,3))<a name='7144'>
                 DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7145'>
	         DTNEWI1=AMIN1(DTNEWI2,DTNEWI3,DTNEWI4 &amp;<a name='7146'>
     &amp;                       ,DTNEWI5,DT0I,TIMEREV)<a name='7147'>
	         DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I,TIMEREV)<a name='7148'>
	         DTNEWL=DTNEWI1<a name='7149'>
	         IF(DTNEWL.LT.DTLREF) DTNEWL=AMIN1(DTLREF,TIMEREV)<a name='7150'>
                END IF<a name='7151'>
	        IF(ITIME.GE.NKR) THEN<a name='7152'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_801">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='7153'>
                ENDIF<a name='7154'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='7155'>
<a name='7156'>
<font color=#447700>! NEW TIME STEP (ONLY_ICE: EVAPORATION)<a name='7157'></font>
<a name='7158'>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7159'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='7160'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7161'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7162'>
	        TIMENEW=TIMENEW+DTNEWL<a name='7163'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='7164'>
	        DTT=DTNEWL<a name='7165'>
<font color=#447700>! SOLVING FOR SUPERSATURATION (ONLY_ICE: EVAPORATION) <a name='7166'></font>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_10">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='7167'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='7168'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='7169'>
<font color=#447700>! END OF "NEW SUPERSATURATION" (ONLY_ICE: EVAPORATION) <a name='7170'></font>
<a name='7171'>
<font color=#447700>! CRYSTALS<a name='7172'></font>
	        IF(ISYM2.NE.0) THEN<a name='7173'>
<a name='7174'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='7175'></font>
<a name='7176'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE) <a name='7177'></font>
<a name='7178'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_30">(R2,B21_MY,B22_MY &amp;<a name='7179'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='7180'>
     &amp;                         ,ICM,1,COL,NKR,TPN)<a name='7181'>
<a name='7182'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_31">(R2,B21_MY,B22_MY &amp;<a name='7183'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='7184'>
     &amp;                         ,ICM,2,COL,NKR,TPN)<a name='7185'>
<a name='7186'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_32">(R2,B21_MY,B22_MY &amp;<a name='7187'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='7188'>
     &amp;                         ,ICM,3,COL,NKR,TPN)<a name='7189'>
	        ENDIF<a name='7190'>
<font color=#447700>! SNOW <a name='7191'></font>
	        IF(ISYM3.NE.0) THEN<a name='7192'>
<a name='7193'>
<font color=#447700>! SNOW DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='7194'></font>
                                                         <a name='7195'>
<a name='7196'>
<font color=#447700>! CALL JERDFUN - SNOW - 2 (ONLY_ICE: EVAPORATION)<a name='7197'></font>
<a name='7198'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_33">(R3,B31_MY,B32_MY &amp;<a name='7199'>
     &amp;                        ,FI3,PSI3,D2N &amp;<a name='7200'>
     &amp;                        ,1,3,COL,NKR,TPN)<a name='7201'>
<a name='7202'>
<a name='7203'>
<a name='7204'>
<a name='7205'>
<a name='7206'>
<font color=#447700>! IN CASE : ISYM3.NE.0<a name='7207'></font>
<a name='7208'>
	        ENDIF<a name='7209'>
<a name='7210'>
<font color=#447700>! GRAUPELS (ONLY_ICE: EVAPORATION) <a name='7211'></font>
<a name='7212'>
	        IF(ISYM4.NE.0) THEN<a name='7213'>
<a name='7214'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='7215'></font>
                                                         <a name='7216'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_34">(R4,B41_MY,B42_MY &amp;<a name='7217'>
     &amp;                        ,FI4,PSI4,D2N &amp;<a name='7218'>
     &amp;                        ,1,4,COL,NKR,TPN)<a name='7219'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='7220'></font>
<a name='7221'>
	        ENDIF<a name='7222'>
<a name='7223'>
<font color=#447700>! HAIL (ONLY_ICE: EVAPORATION) <a name='7224'></font>
<a name='7225'>
	        IF(ISYM5.NE.0) THEN<a name='7226'>
<a name='7227'>
<font color=#447700>! HAIL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='7228'></font>
                                                         <a name='7229'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_35">(R5,B51_MY,B52_MY &amp;<a name='7230'>
     &amp;                        ,FI5,PSI5,D2N &amp;<a name='7231'>
     &amp;                        ,1,5,COL,NKR,TPN)<a name='7232'>
<font color=#447700>! IN CASE : ISYM5.NE.0<a name='7233'></font>
<a name='7234'>
	        ENDIF<a name='7235'>
<a name='7236'>
	        IF((DEL2.LT.0.AND.DEL2N.GT.0) &amp;<a name='7237'>
     &amp;         .AND.ABS(DEL2N).GT.EPSDEL) THEN<a name='7238'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_802">("fatal error in module_mp_full_sbm (DEL2.LT.0.AND.DEL2N.GT.0), model stop")<a name='7239'>
	        ENDIF<a name='7240'>
<a name='7241'>
<font color=#447700>! IN CASE : KCOND.NE.21<a name='7242'></font>
 <a name='7243'>
	      ENDIF<a name='7244'>
<a name='7245'>
<font color=#447700>! IN CASES : KCOND = 21 OR KCOND.NE.21<a name='7246'></font>
<a name='7247'>
<font color=#447700>! END OF "PROCESS'S TYPE" <a name='7248'></font>
<font color=#447700>!<a name='7249'></font>
<font color=#447700>! MASSES<a name='7250'></font>
              RMASSIBB=0.0<a name='7251'>
              RMASSIAA=0.0<a name='7252'>
<font color=#447700>! BEFORE JERNEWF<a name='7253'></font>
              DO K=1,NKR<a name='7254'>
                 DO ICE =1,ICEMAX<a name='7255'>
                    FI2_K=FI2(K,ICE)<a name='7256'>
                    R2_K=R2(K,ICE)<a name='7257'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7258'>
                    RMASSIBB=RMASSIBB+FI2R2<a name='7259'>
                 ENDDO<a name='7260'>
                 FI3_K=FI3(K)<a name='7261'>
                 FI4_K=FI4(K)<a name='7262'>
                 FI5_K=FI5(K)<a name='7263'>
                 R3_K=R3(K)<a name='7264'>
                 R4_K=R4(K)<a name='7265'>
                 R5_K=R5(K)<a name='7266'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7267'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7268'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7269'>
                 RMASSIBB=RMASSIBB+FI3R3<a name='7270'>
                 RMASSIBB=RMASSIBB+FI4R4<a name='7271'>
                 RMASSIBB=RMASSIBB+FI5R5<a name='7272'>
              ENDDO<a name='7273'>
              RMASSIBB=RMASSIBB*COL3*RORI<a name='7274'>
<font color=#447700>! NEW CHANGE RMASSIBB<a name='7275'></font>
              IF(RMASSIBB.LT.0.0) RMASSIBB=0.0<a name='7276'>
<font color=#447700>! AFTER JERNEWF<a name='7277'></font>
              DO K=1,NKR<a name='7278'>
                 DO ICE =1,ICEMAX<a name='7279'>
                    FI2_K=PSI2(K,ICE)<a name='7280'>
                    R2_K=R2(K,ICE)<a name='7281'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7282'>
                    RMASSIAA=RMASSIAA+FI2R2<a name='7283'>
                 ENDDO<a name='7284'>
                 FI3_K=PSI3(K)<a name='7285'>
                 FI4_K=PSI4(K)<a name='7286'>
                 FI5_K=PSI5(K)<a name='7287'>
                 R3_K=R3(K)<a name='7288'>
                 R4_K=R4(K)<a name='7289'>
                 R5_K=R5(K)<a name='7290'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7291'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7292'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7293'>
                 RMASSIAA=RMASSIAA+FI3R3<a name='7294'>
                 RMASSIAA=RMASSIAA+FI4R4<a name='7295'>
                 RMASSIAA=RMASSIAA+FI5R5<a name='7296'>
              ENDDO<a name='7297'>
              RMASSIAA=RMASSIAA*COL3*RORI<a name='7298'>
<font color=#447700>! NEW CHANGE RMASSIAA<a name='7299'></font>
              IF(RMASSIAA.LT.0.0) RMASSIAA=0.0<a name='7300'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='7301'></font>
              DELMASSI1=RMASSIAA-RMASSIBB<a name='7302'>
              QPN=QPS-DELMASSI1<a name='7303'>
              DAL2=AL2<a name='7304'>
              TPN=TPS+DAL2*DELMASSI1<a name='7305'>
<font color=#447700>! SUPERSATURATION<a name='7306'></font>
              ARGEXP=-BB1_MY/TPN<a name='7307'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='7308'>
              ARGEXP=-BB2_MY/TPN<a name='7309'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='7310'>
              EW1N=OPER3(QPN,PP)<a name='7311'>
              IF(ES1N.EQ.0)THEN<a name='7312'>
               DEL1N=0.5<a name='7313'>
               DIV1=1.5<a name='7314'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_803">("fatal error in module_mp_full_sbm (ES1N.EQ.0), model stop")<a name='7315'>
              ELSE<a name='7316'>
               DIV1=EW1N/ES1N<a name='7317'>
               DEL1N=EW1N/ES1N-1.<a name='7318'>
              END IF<a name='7319'>
              IF(ES2N.EQ.0)THEN<a name='7320'>
               DEL2N=0.5<a name='7321'>
               DIV2=1.5<a name='7322'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_804">("fatal error in module_mp_full_sbm (ES2N.EQ.0), model stop")<a name='7323'>
              ELSE<a name='7324'>
               DEL2N=EW1N/ES2N-1.<a name='7325'>
               DIV2=EW1N/ES2N<a name='7326'>
              END IF<a name='7327'>
<a name='7328'>
<font color=#447700>!  END OF TIME SPLITTING <a name='7329'></font>
<font color=#447700>! (ONLY ICE: CONDENSATION OR EVAPORATION) <a name='7330'></font>
	      IF(TIMENEW.LT.DT) GOTO 46<a name='7331'>
        TT=TPN<a name='7332'>
        QQ=QPN<a name='7333'>
	DO KR=1,NKR<a name='7334'>
	   DO ICE=1,ICEMAX<a name='7335'>
	      FF2(KR,ICE)=PSI2(KR,ICE)<a name='7336'>
	   ENDDO<a name='7337'>
	   FF3(KR)=PSI3(KR)<a name='7338'>
	   FF4(KR)=PSI4(KR)<a name='7339'>
	   FF5(KR)=PSI5(KR)<a name='7340'>
	ENDDO<a name='7341'>
<a name='7342'>
<a name='7343'>
<font color=#447700>! GO TO "CONDENSATION AND VAPORATION"<a name='7344'></font>
<a name='7345'>
<a name='7346'>
        RETURN                                          <a name='7347'>
        END SUBROUTINE ONECOND2<a name='7348'>
<font color=#447700>!==================================================================<a name='7349'></font>
<a name='7350'>
<A NAME='ONECOND3'><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7351'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND3</font> &amp; <A href='../../call_to/ONECOND3.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND3.html' TARGET='index'>44</A><a name='7352'>
     &amp; (TT,QQ,PP,ROR &amp;<a name='7353'>
     &amp; ,VR1,VR2,VR3,VR4,VR5,PSINGLE &amp;<a name='7354'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='7355'>
     &amp; ,FF1,PSI1,R1,RLEC,RO1BL &amp;<a name='7356'>
     &amp; ,FF2,PSI2,R2,RIEC,RO2BL &amp;<a name='7357'>
     &amp; ,FF3,PSI3,R3,RSEC,RO3BL &amp;<a name='7358'>
     &amp; ,FF4,PSI4,R4,RGEC,RO4BL &amp;<a name='7359'>
     &amp; ,FF5,PSI5,R5,RHEC,RO5BL &amp;<a name='7360'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='7361'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='7362'>
     &amp; ,COL,DTCOND,ICEMAX,NKR &amp;<a name='7363'>
     &amp; ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5)<a name='7364'>
       IMPLICIT NONE<a name='7365'>
       INTEGER ICEMAX,NKR,KR,ITIME,ICE,KCOND,K &amp;<a name='7366'>
     &amp;           ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5<a name='7367'>
       INTEGER KLIMITL,KLIMITG,KLIMITH,KLIMITI_1, &amp;<a name='7368'>
     &amp;  KLIMITI_2,KLIMITI_3<a name='7369'>
       INTEGER I_MIXCOND,I_MIXEVAP,I_ABERGERON,I_BERGERON  <a name='7370'>
       REAL ROR,VR1(NKR),VR2(NKR,ICEMAX),VR3(NKR),VR4(NKR) &amp;<a name='7371'>
     &amp;           ,VR5(NKR),PSINGLE &amp;<a name='7372'>
     &amp;           ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='7373'>
     &amp;           ,C1_MEY,C2_MEY &amp;<a name='7374'>
     &amp;           ,COL,DTCOND<a name='7375'>
<a name='7376'>
<font color=#447700>! DROPLETS <a name='7377'></font>
                                                                       <a name='7378'>
        REAL R1(NKR)&amp;<a name='7379'>
     &amp;           ,RLEC(NKR),RO1BL(NKR) &amp;<a name='7380'>
     &amp;           ,FI1(NKR),FF1(NKR),PSI1(NKR) &amp;<a name='7381'>
     &amp;           ,B11_MY(NKR),B12_MY(NKR)<a name='7382'>
<a name='7383'>
<font color=#447700>! CRYSTALS<a name='7384'></font>
                                                                       <a name='7385'>
	REAL R2(NKR,ICEMAX) &amp;<a name='7386'>
     &amp;           ,RIEC(NKR,ICEMAX) &amp;<a name='7387'>
     &amp;           ,RO2BL(NKR,ICEMAX) &amp;<a name='7388'>
     &amp;           ,FI2(NKR,ICEMAX),PSI2(NKR,ICEMAX) &amp;<a name='7389'>
     &amp;           ,FF2(NKR,ICEMAX) &amp;<a name='7390'>
     &amp;           ,B21_MY(NKR,ICEMAX),B22_MY(NKR,ICEMAX) &amp;<a name='7391'>
     &amp;           ,RATE2(NKR,ICEMAX),DEL_R2M(NKR,ICEMAX)<a name='7392'>
<a name='7393'>
<font color=#447700>! SNOW                                                                          <a name='7394'></font>
        REAL R3(NKR) &amp;<a name='7395'>
     &amp;           ,RSEC(NKR),RO3BL(NKR) &amp;<a name='7396'>
     &amp;           ,FI3(NKR),FF3(NKR),PSI3(NKR) &amp;<a name='7397'>
     &amp;           ,B31_MY(NKR),B32_MY(NKR) &amp;<a name='7398'>
     &amp;           ,DEL_R3M(NKR)  <a name='7399'>
<a name='7400'>
<font color=#447700>! GRAUPELS <a name='7401'></font>
                                                                       <a name='7402'>
        REAL R4(NKR),R4N(NKR) &amp;<a name='7403'>
     &amp;           ,RGEC(NKR),RO4BL(NKR) &amp;<a name='7404'>
     &amp;           ,FI4(NKR),FF4(NKR),PSI4(NKR) &amp;<a name='7405'>
     &amp;           ,B41_MY(NKR),B42_MY(NKR) &amp;<a name='7406'>
     &amp;           ,DEL_R4M(NKR)<a name='7407'>
<a name='7408'>
<font color=#447700>! HAIL                                                                          <a name='7409'></font>
        REAL R5(NKR),R5N(NKR) &amp;<a name='7410'>
     &amp;           ,RHEC(NKR),RO5BL(NKR) &amp;<a name='7411'>
     &amp;           ,FI5(NKR),FF5(NKR),PSI5(NKR) &amp;<a name='7412'>
     &amp;           ,B51_MY(NKR),B52_MY(NKR) &amp;<a name='7413'>
     &amp;           ,DEL_R5M(NKR)<a name='7414'>
<a name='7415'>
      DOUBLE PRECISION DD1N,DB11_MY,DAL1,DAL2<a name='7416'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='7417'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='7418'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='7419'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='7420'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='7421'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='7422'>
     &amp;                  ,TT,QQ,PP,DEL1N0,DEL2N0 &amp;<a name='7423'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='7424'>
     &amp;                  ,OPER2,OPER3,AR1,AR2<a name='7425'>
<a name='7426'>
       DOUBLE PRECISION DELTAQ1,DELMASSI1,DELMASSL1<a name='7427'>
<a name='7428'>
       REAL A1_MYN, BB1_MYN, A2_MYN, BB2_MYN<a name='7429'>
        DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='7430'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='7431'>
       REAL B8L,B8I,SFN11,SFN12,SFNL,SFNI<a name='7432'>
       REAL B5L,B5I,B7L,B7I,B6,DOPL,DEL1S,DEL2S,DOPI,RW,QW,PW, &amp;<a name='7433'>
     &amp;  RI,PI,QI,SFNI1(ICEMAX),SFNI2(ICEMAX),AL1,AL2<a name='7434'>
       REAL D1N,D2N,DT0L, DT0I,D1N0,D2N0<a name='7435'>
       REAL SFN21,SFN22,SFNII1,SFNII2,SFN31,SFN32,SFN41,SFN42,SFN51, &amp;<a name='7436'>
     &amp;  SFN52<a name='7437'>
       REAL DEL1,DEL2<a name='7438'>
       REAL  TIMEREV,DT,DTT,TIMENEW<a name='7439'>
       REAL DTIMEG(NKR),DTIMEH(NKR)<a name='7440'>
<a name='7441'>
       REAL DEL2D(ICEMAX),DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='7442'>
     &amp;           ,DTIMEI_1(NKR),DTIMEI_2(NKR),DTIMEI_3(NKR)<a name='7443'>
       REAL DT_WATER_COND,DT_WATER_EVAP,DT_ICE_COND,DT_ICE_EVAP, &amp;<a name='7444'>
     &amp;  DT_MIX_COND,DT_MIX_EVAP,DT_MIX_BERGERON,DT_MIX_ANTIBERGERON<a name='7445'>
       REAL DTNEWL0,DTNEWL1,DTNEWI1,DTNEWI2_1,DTNEWI2_2,DTNEWI2_3, &amp;<a name='7446'>
     &amp; DTNEWI2,DTNEWI_1,DTNEWI_2,DTNEWI3,DTNEWI4,DTNEWI5, &amp;<a name='7447'>
     &amp; DTNEWL,DTNEWL2,DTNEWG1,DTNEWH1<a name='7448'>
       REAL TIMESTEPD(NKR)<a name='7449'>
<a name='7450'>
       DATA AL1 /2500./, AL2 /2834./<a name='7451'>
       REAL EPSDEL,EPSDEL2<a name='7452'>
       DATA EPSDEL, EPSDEL2 /0.1E-03,0.1E-03/<a name='7453'>
       OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='7454'>
       OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='7455'>
      <a name='7456'>
<font color=#447700>! BELOW<a name='7457'></font>
<font color=#447700>!<a name='7458'></font>
        DT_WATER_COND=0.4<a name='7459'>
        DT_WATER_EVAP=0.4<a name='7460'>
        DT_ICE_COND=0.4<a name='7461'>
        DT_ICE_EVAP=0.4<a name='7462'>
        DT_MIX_COND=0.4<a name='7463'>
        DT_MIX_EVAP=0.4<a name='7464'>
        DT_MIX_BERGERON=0.4<a name='7465'>
        DT_MIX_ANTIBERGERON=0.4<a name='7466'>
<a name='7467'>
        I_MIXCOND=0<a name='7468'>
        I_MIXEVAP=0<a name='7469'>
        I_ABERGERON=0<a name='7470'>
        I_BERGERON=0<a name='7471'>
<a name='7472'>
       ITIME = 0<a name='7473'>
       TIMENEW=0.<a name='7474'>
       DT=DTCOND<a name='7475'>
       DTT=DTCOND<a name='7476'>
<a name='7477'>
       B6=0.<a name='7478'>
       B8L=1./ROR<a name='7479'>
       B8I=1./ROR<a name='7480'>
<font color=#447700>! NEW CHANGES 19.04.01 (BEGIN)<a name='7481'></font>
        RORI=1.D0/ROR<a name='7482'>
<font color=#447700>! NEW CHANGES 19.04.01 (END)<a name='7483'></font>
<font color=#447700>! NEW CHANGES 19.04.01 (BEGIN)<a name='7484'></font>
        COL3=3.D0*COL<a name='7485'>
<font color=#447700>! NEW CHANGES 19.04.01 (END)<a name='7486'></font>
<a name='7487'>
<a name='7488'>
<a name='7489'>
<font color=#447700>! BARRY:DIV<a name='7490'></font>
        TPN=TT<a name='7491'>
        QPN=QQ<a name='7492'>
<font color=#447700>! HERE<a name='7493'></font>
   16         ITIME=ITIME+1<a name='7494'>
<font color=#447700>! BARRY<a name='7495'></font>
<font color=#447700>!             TPC_NEW=TPN-273.15<a name='7496'></font>
              IF((TPN-273.15).GE.-0.187) GO TO 17<a name='7497'>
              TIMEREV=DT-TIMENEW<a name='7498'>
              DEL1=DEL1N<a name='7499'>
              DEL2=DEL2N<a name='7500'>
              DEL1S=DEL1N<a name='7501'>
              DEL2S=DEL2N<a name='7502'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7503'></font>
              DEL2D(1)=DEL2N<a name='7504'>
              DEL2D(2)=DEL2N<a name='7505'>
              DEL2D(3)=DEL2N<a name='7506'>
              TPS=TPN<a name='7507'>
              QPS=QPN<a name='7508'>
              DO KR=1,NKR<a name='7509'>
                 FI1(KR)=PSI1(KR)<a name='7510'>
                 FI3(KR)=PSI3(KR)<a name='7511'>
                 FI4(KR)=PSI4(KR)<a name='7512'>
                 FI5(KR)=PSI5(KR)<a name='7513'>
                 DO ICE=1,ICEMAX<a name='7514'>
                    FI2(KR,ICE)=PSI2(KR,ICE)<a name='7515'>
                 ENDDO<a name='7516'>
              ENDDO<a name='7517'>
<font color=#447700>! TIME-STEP GROWTH RATE<a name='7518'></font>
<font color=#447700>! HERE<a name='7519'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_16">(R1,TPS,PP,ROR,VR1,PSINGLE &amp;<a name='7520'>
     &amp;                    ,RLEC,RO1BL,B11_MY,B12_MY,1,1,ICEMAX,NKR)<a name='7521'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_17">(R2,TPS,PP,ROR,VR2,PSINGLE &amp;<a name='7522'>
     &amp;                    ,RIEC,RO2BL,B21_MY,B22_MY,3,2,ICEMAX,NKR)<a name='7523'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_18">(R3,TPS,PP,ROR,VR3,PSINGLE &amp;<a name='7524'>
     &amp;                    ,RSEC,RO3BL,B31_MY,B32_MY,1,2,ICEMAX,NKR)<a name='7525'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_19">(R4,TPS,PP,ROR,VR4,PSINGLE &amp;<a name='7526'>
     &amp;                    ,RGEC,RO4BL,B41_MY,B42_MY,1,2,ICEMAX,NKR)<a name='7527'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_20">(R5,TPS,PP,ROR,VR5,PSINGLE &amp;<a name='7528'>
     &amp;                    ,RHEC,RO5BL,B51_MY,B52_MY,1,2,ICEMAX,NKR)<a name='7529'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_13">(FI1,R1,SFN11,SFN12 &amp;<a name='7530'>
     &amp;                      ,B11_MY,B12_MY,RLEC,B8L,1,COL,NKR)<a name='7531'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC_ICE'>JERTIMESC_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_ICE_4">(FI2,R2,SFNI1,SFNI2 &amp;<a name='7532'>
     &amp;                      ,B21_MY,B22_MY,RIEC,B8I,ICEMAX,COL,NKR)<a name='7533'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_14">(FI3,R3,SFN31,SFN32 &amp;<a name='7534'>
     &amp;                      ,B31_MY,B32_MY,RSEC,B8I,1,COL,NKR)<a name='7535'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_15">(FI4,R4,SFN41,SFN42 &amp;<a name='7536'>
     &amp;                      ,B41_MY,B42_MY,RGEC,B8I,1,COL,NKR)<a name='7537'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_16">(FI5,R5,SFN51,SFN52 &amp;<a name='7538'>
     &amp;                      ,B51_MY,B52_MY,RHEC,B8I,1,COL,NKR)<a name='7539'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7540'></font>
              SFNII1=SFNI1(1)+SFNI1(2)+SFNI1(3)<a name='7541'>
              SFNII2=SFNI2(1)+SFNI2(2)+SFNI2(3)<a name='7542'>
              SFN21=SFNII1+SFN31+SFN41+SFN51<a name='7543'>
              SFN22=SFNII2+SFN32+SFN42+SFN52<a name='7544'>
              SFNL=SFN11+SFN12<a name='7545'>
              SFNI=SFN21+SFN22<a name='7546'>
<font color=#447700>! SOME CONSTANTS (QW,QI=0,since B6=0.)<a name='7547'></font>
              B5L=BB1_MY/TPS/TPS<a name='7548'>
              B5I=BB2_MY/TPS/TPS<a name='7549'>
              B7L=B5L*B6<a name='7550'>
              B7I=B5I*B6<a name='7551'>
              DOPL=1.+DEL1S<a name='7552'>
              DOPI=1.+DEL2S<a name='7553'>
              RW=(OPER2(QPS)+B5L*AL1)*DOPL*SFNL<a name='7554'>
              QW=B7L*DOPL<a name='7555'>
              PW=(OPER2(QPS)+B5I*AL1)*DOPI*SFNL<a name='7556'>
              RI=(OPER2(QPS)+B5L*AL2)*DOPL*SFNI<a name='7557'>
              PI=(OPER2(QPS)+B5I*AL2)*DOPI*SFNI<a name='7558'>
              QI=B7I*DOPI<a name='7559'>
<font color=#447700>! SOLVING FOR TIMEZERO<a name='7560'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_11">(DEL1,DEL2,DEL1N0,DEL2N0 &amp;<a name='7561'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='7562'>
     &amp;                      ,DTT,D1N0,D2N0,DT0L,DT0I)<a name='7563'>
<font color=#447700>! DEL1 &gt; 0, DEL2 &lt; 0    (ANTIBERGERON MIXED PHASE - KCOND=50)<a name='7564'></font>
<font color=#447700>! DEL1 &lt; 0 AND DEL2 &lt; 0 (EVAPORATION MIXED_PHASE - KCOND=30)<a name='7565'></font>
<font color=#447700>! DEL1 &gt; 0 AND DEL2 &gt; 0 (CONDENSATION MIXED PHASE - KCOND=31)<a name='7566'></font>
<font color=#447700>! DEL1 &lt; 0, DEL2 &gt; 0    (BERGERON MIXED PHASE - KCOND=32)<a name='7567'></font>
              KCOND=50<a name='7568'>
<a name='7569'>
              IF(DEL1.LT.0.AND.DEL2.LT.0) KCOND=30<a name='7570'>
              IF(DEL1.GT.0.AND.DEL2.GT.0) KCOND=31<a name='7571'>
              IF(DEL1.LT.0.AND.DEL2.GT.0) KCOND=32<a name='7572'>
              IF(KCOND.EQ.50) THEN <a name='7573'>
                I_ABERGERON=I_ABERGERON+1<a name='7574'>
                IF(DT0L.EQ.0) THEN<a name='7575'>
                  DTNEWL=DT<a name='7576'>
                ELSE<a name='7577'>
                  DTNEWL=AMIN1(DT,DT0L)<a name='7578'>
                ENDIF<a name='7579'>
<font color=#447700>! NEW TIME STEP (ANTIBERGERON MIXED PHASE)<a name='7580'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7581'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7582'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7583'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7584'>
                TIMENEW=TIMENEW+DTNEWL<a name='7585'>
                DTT=DTNEWL<a name='7586'>
                IF(ITIME.GE.NKR) THEN<a name='7587'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_805">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='7588'>
                ENDIF<a name='7589'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7590'>
<font color=#447700>! ANTIBERGERON MIXED PHASE (BEGIN)<a name='7591'></font>
<font color=#447700>! IN CASE : KCOND = 50<a name='7592'></font>
              ENDIF<a name='7593'>
              IF(KCOND.EQ.31) THEN<a name='7594'>
<font color=#447700>! CONDENSATION MIXED PHASE (BEGIN)<a name='7595'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7596'></font>
                I_MIXCOND=I_MIXCOND+1<a name='7597'>
               IF (DEL1N.EQ.0)THEN<a name='7598'>
                DTNEWL0=DT<a name='7599'>
               ELSE<a name='7600'>
                DTNEWL0=ABS(R1(ITIME)/(B11_MY(ITIME)*DEL1N- &amp;<a name='7601'>
     &amp;                                 B12_MY(ITIME)))<a name='7602'>
               END IF<a name='7603'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='7604'></font>
<a name='7605'>
               IF (DEL2N.EQ.0)THEN<a name='7606'>
                DTNEWI2_1=DT<a name='7607'>
                DTNEWI2_2=DT<a name='7608'>
                DTNEWI2_3=DT<a name='7609'>
                DTNEWI3=DT<a name='7610'>
                DTNEWI4=DT<a name='7611'>
                DTNEWI5=DT<a name='7612'>
               ELSE<a name='7613'>
                DTNEWI2_1=ABS(R2(ITIME,1)/ &amp;<a name='7614'>
     &amp;         (B21_MY(ITIME,1)*DEL2N-B22_MY(ITIME,1)))<a name='7615'>
                DTNEWI2_2=ABS(R2(ITIME,2)/ &amp;<a name='7616'>
     &amp;         (B21_MY(ITIME,2)*DEL2N-B22_MY(ITIME,2))) <a name='7617'>
                DTNEWI2_3=ABS(R2(ITIME,3)/ &amp;<a name='7618'>
     &amp;         (B21_MY(ITIME,3)*DEL2N-B22_MY(ITIME,3)))  <a name='7619'>
                DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7620'>
<a name='7621'>
                DTNEWI3=ABS(R3(ITIME)/(B31_MY(ITIME)*DEL2N- &amp;<a name='7622'>
     &amp;                                 B32_MY(ITIME)))<a name='7623'>
                DTNEWI4=ABS(R4(ITIME)/(B41_MY(ITIME)*DEL2N- &amp;<a name='7624'>
     &amp;                                 B42_MY(ITIME)))<a name='7625'>
                DTNEWI5=ABS(R5(ITIME)/(B51_MY(ITIME)*DEL2N- &amp;<a name='7626'>
     &amp;                                 B52_MY(ITIME)))<a name='7627'>
               END IF<a name='7628'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I)<a name='7629'>
                IF(DT0L.NE.0) THEN<a name='7630'>
                  IF(ABS(DT0L).LT.DT_MIX_COND) THEN<a name='7631'>
                    DTNEWL1=AMIN1(DT_MIX_COND,DTNEWL0)<a name='7632'>
                  ELSE<a name='7633'>
                    DTNEWL1=AMIN1(DT0L,DTNEWL0)<a name='7634'>
                  ENDIF<a name='7635'>
                ELSE<a name='7636'>
                  DTNEWL1=DTNEWL0<a name='7637'>
                ENDIF<a name='7638'>
                DTNEWL=AMIN1(DTNEWL1,DTNEWI1)<a name='7639'>
                IF(ITIME.GE.NKR) THEN<a name='7640'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_806">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='7641'>
                ENDIF<a name='7642'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7643'>
<font color=#447700>! NEW TIME STEP (CONDENSATION MIXED PHASE)<a name='7644'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7645'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7646'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7647'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7648'>
                TIMENEW=TIMENEW+DTNEWL<a name='7649'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7650'>
                DTT=DTNEWL<a name='7651'>
<font color=#447700>! CONDENSATION MIXED PHASE (END)<a name='7652'></font>
<font color=#447700>! IN CASE : KCOND = 31<a name='7653'></font>
              ENDIF<a name='7654'>
              IF(KCOND.EQ.30) THEN<a name='7655'>
<font color=#447700>! EVAPORATION MIXED PHASE (BEGIN)<a name='7656'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7657'></font>
                I_MIXEVAP=I_MIXEVAP+1<a name='7658'>
                DO KR=1,NKR<a name='7659'>
                   DTIMEL(KR)=0.<a name='7660'>
                   DTIMEG(KR)=0.<a name='7661'>
                   DTIMEH(KR)=0.<a name='7662'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7663'></font>
                   DTIMEI_1(KR)=0.<a name='7664'>
                   DTIMEI_2(KR)=0.<a name='7665'>
                   DTIMEI_3(KR)=0.<a name='7666'>
                ENDDO<a name='7667'>
                DO KR=1,NKR<a name='7668'>
                 IF (DEL1N.EQ.0) THEN<a name='7669'>
                   DTIMEL(KR)=DT<a name='7670'>
                   DTIMEG(KR)=DT<a name='7671'>
                   DTIMEH(KR)=DT<a name='7672'>
                 ELSE<a name='7673'>
                   DTIMEL(KR)=-R1(KR)/(B11_MY(KR)*DEL1N- &amp;<a name='7674'>
     &amp;                                 B12_MY(KR))<a name='7675'>
                   DTIMEG(KR)=-R4(KR)/(B41_MY(KR)*DEL1N- &amp;<a name='7676'>
     &amp;                                 B42_MY(KR))<a name='7677'>
                   DTIMEH(KR)=-R5(KR)/(B51_MY(KR)*DEL1N- &amp;<a name='7678'>
     &amp;                             B52_MY(KR))<a name='7679'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='7680'></font>
                 END IF<a name='7681'>
                 IF (DEL2N.EQ.0) THEN<a name='7682'>
                   DTIMEI_1(KR)=DT<a name='7683'>
                   DTIMEI_2(KR)=DT<a name='7684'>
                   DTIMEI_3(KR)=DT<a name='7685'>
                 ELSE<a name='7686'>
                   DTIMEI_1(KR)=-R2(KR,1)/ &amp;<a name='7687'>
     &amp;               (B21_MY(KR,1)*DEL2N-B22_MY(KR,1))<a name='7688'>
                   DTIMEI_2(KR)=-R2(KR,2)/ &amp;<a name='7689'>
     &amp;               (B21_MY(KR,2)*DEL2N-B22_MY(KR,2))<a name='7690'>
                   DTIMEI_3(KR)=-R2(KR,3)/ &amp;<a name='7691'>
     &amp;               (B21_MY(KR,3)*DEL2N-B22_MY(KR,3))<a name='7692'>
                 END IF<a name='7693'>
                ENDDO<a name='7694'>
<font color=#447700>! WATER<a name='7695'></font>
                KLIMITL=1<a name='7696'>
                DO KR=1,NKR<a name='7697'>
                   IF(DTIMEL(KR).GT.TIMEREV) GOTO 355<a name='7698'>
                   KLIMITL=KR<a name='7699'>
                ENDDO<a name='7700'>
  355           KLIMITL=KLIMITL-1<a name='7701'>
                IF(KLIMITL.LT.1) KLIMITL=1<a name='7702'>
                DTNEWL1=AMIN1(DTIMEL(KLIMITL),DT0L,TIMEREV)<a name='7703'>
<font color=#447700>! GRAUPELS<a name='7704'></font>
                KLIMITG=1<a name='7705'>
                DO KR=1,NKR<a name='7706'>
                   IF(DTIMEG(KR).GT.TIMEREV) GOTO 455<a name='7707'>
                   KLIMITG=KR<a name='7708'>
                ENDDO<a name='7709'>
  455           KLIMITG=KLIMITG-1<a name='7710'>
                IF(KLIMITG.LT.1) KLIMITG=1<a name='7711'>
                DTNEWG1=AMIN1(DTIMEG(KLIMITG),TIMEREV)<a name='7712'>
<font color=#447700>! HAIL<a name='7713'></font>
                KLIMITH=1<a name='7714'>
                DO KR=1,NKR<a name='7715'>
                   IF(DTIMEH(KR).GT.TIMEREV) GOTO 555<a name='7716'>
                   KLIMITH=KR<a name='7717'>
                ENDDO<a name='7718'>
  555           KLIMITH=KLIMITH-1<a name='7719'>
                IF(KLIMITH.LT.1) KLIMITH=1<a name='7720'>
                DTNEWH1=AMIN1(DTIMEH(KLIMITH),TIMEREV)<a name='7721'>
<font color=#447700>! ICE CRYSTALS<a name='7722'></font>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE) (BEGIN)<a name='7723'></font>
                KLIMITI_1=1<a name='7724'>
                KLIMITI_2=1<a name='7725'>
                KLIMITI_3=1<a name='7726'>
                DO KR=1,NKR<a name='7727'>
                   IF(DTIMEI_1(KR).GT.TIMEREV) GOTO 655<a name='7728'>
                   KLIMITI_1=KR<a name='7729'>
                ENDDO<a name='7730'>
  655           CONTINUE<a name='7731'>
                DO KR=1,NKR<a name='7732'>
                   IF(DTIMEI_2(KR).GT.TIMEREV) GOTO 656<a name='7733'>
                   KLIMITI_2=KR<a name='7734'>
                ENDDO<a name='7735'>
  656           CONTINUE<a name='7736'>
                DO KR=1,NKR<a name='7737'>
                   IF(DTIMEI_3(KR).GT.TIMEREV) GOTO 657<a name='7738'>
                   KLIMITI_3=KR<a name='7739'>
                ENDDO<a name='7740'>
  657           CONTINUE<a name='7741'>
                KLIMITI_1=KLIMITI_1-1<a name='7742'>
                IF(KLIMITI_1.LT.1) KLIMITI_1=1<a name='7743'>
                DTNEWI2_1=AMIN1(DTIMEI_1(KLIMITI_1),TIMEREV)<a name='7744'>
                KLIMITI_2=KLIMITI_2-1<a name='7745'>
                IF(KLIMITI_2.LT.1) KLIMITI_2=1<a name='7746'>
                DTNEWI2_2=AMIN1(DTIMEI_2(KLIMITI_2),TIMEREV)<a name='7747'>
                KLIMITI_3=KLIMITI_3-1<a name='7748'>
                IF(KLIMITI_3.LT.1) KLIMITI_3=1<a name='7749'>
                DTNEWI2_3=AMIN1(DTIMEI_3(KLIMITI_3),TIMEREV)<a name='7750'>
                DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7751'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE) (END)<a name='7752'></font>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWG1,DTNEWH1,DT0I)<a name='7753'>
                IF(ABS(DEL2N).LT.EPSDEL2) &amp;<a name='7754'>
     &amp;          DTNEWI1=AMIN1(DTNEWI2,DTNEWG1,DTNEWH1)<a name='7755'>
                DTNEWL2=AMIN1(DTNEWL1,DTNEWI1)<a name='7756'>
                DTNEWL=DTNEWL2<a name='7757'>
                IF(DTNEWL.LT.DT_MIX_EVAP) &amp;<a name='7758'>
     &amp;          DTNEWL=AMIN1(DT_MIX_EVAP,TIMEREV)  <a name='7759'>
                IF(ITIME.GE.NKR) THEN<a name='7760'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_807">("fatal error in module_mp_full_sbm (ITIME.GE.NKR), model stop")<a name='7761'>
                ENDIF<a name='7762'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7763'>
<font color=#447700>! NEW TIME STEP (EVAPORATION MIXED PHASE)<a name='7764'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7765'>
                IF((TIMENEW+DTNEWL).GT.DT &amp;<a name='7766'>
     &amp;         .AND.ITIME.LT.(NKR-1)) &amp;<a name='7767'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7768'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7769'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7770'>
                TIMENEW=TIMENEW+DTNEWL<a name='7771'>
                DTT=DTNEWL<a name='7772'>
<font color=#447700>! EVAPORATION MIXED PHASE (END)<a name='7773'></font>
<font color=#447700>! IN CASE : KCOND = 30<a name='7774'></font>
              ENDIF<a name='7775'>
              IF(KCOND.EQ.32) THEN<a name='7776'>
<font color=#447700>! BERGERON MIXED PHASE (BEGIN)<a name='7777'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7778'></font>
                I_BERGERON=I_BERGERON+1<a name='7779'>
<font color=#447700>! NEW TREATMENT OF TIME STEP (BERGERON MIXED PHASE)<a name='7780'></font>
               IF (DEL1N.EQ.0)THEN<a name='7781'>
                DTNEWL0=DT<a name='7782'>
               ELSE<a name='7783'>
                DTNEWL0=-R1(1)/(B11_MY(1)*DEL1N-B12_MY(1))<a name='7784'>
               END IF<a name='7785'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7786'></font>
               IF (DEL2N.EQ.0)THEN<a name='7787'>
                DTNEWI2_1=DT<a name='7788'>
                DTNEWI2_2=DT<a name='7789'>
                DTNEWI2_3=DT<a name='7790'>
               ELSE<a name='7791'>
                DTNEWI2_1=R2(1,1)/(B21_MY(1,1)*DEL2N-B22_MY(1,1))<a name='7792'>
                DTNEWI2_2=R2(1,2)/(B21_MY(1,2)*DEL2N-B22_MY(1,2))<a name='7793'>
                DTNEWI2_3=R2(1,3)/(B21_MY(1,3)*DEL2N-B22_MY(1,3))<a name='7794'>
               END IF<a name='7795'>
               DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7796'>
               IF (DEL2N.EQ.0)THEN<a name='7797'>
                DTNEWI3=DT<a name='7798'>
                DTNEWI4=DT<a name='7799'>
                DTNEWI5=DT<a name='7800'>
               ELSE<a name='7801'>
                DTNEWI3=R3(1)/(B31_MY(1)*DEL2N-B32_MY(1))<a name='7802'>
                DTNEWI4=R4(1)/(B41_MY(1)*DEL2N-B42_MY(1))<a name='7803'>
                DTNEWI5=R5(1)/(B51_MY(1)*DEL2N-B52_MY(1))<a name='7804'>
               END IF<a name='7805'>
                DTNEWL1=AMIN1(DTNEWL0,DT0L,TIMEREV)<a name='7806'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI3,DTNEWI4 &amp;<a name='7807'>
     &amp;                       ,DTNEWI5,DT0I,TIMEREV)<a name='7808'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I,TIMEREV)<a name='7809'>
                DTNEWL=AMIN1(DTNEWL1,DTNEWI1)<a name='7810'>
<font color=#447700>! NEW CHANGES 23.04.01 (BEGIN)<a name='7811'></font>
                IF(DTNEWL.LT.DT_MIX_BERGERON) &amp;<a name='7812'>
     &amp;          DTNEWL=AMIN1(DT_MIX_BERGERON,TIMEREV)<a name='7813'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7814'>
<font color=#447700>! NEW TIME STEP (BERGERON MIXED PHASE)<a name='7815'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7816'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7817'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7818'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7819'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7820'>
                TIMENEW=TIMENEW+DTNEWL<a name='7821'>
                DTT=DTNEWL<a name='7822'>
<font color=#447700>! BERGERON MIXED PHASE (END)<a name='7823'></font>
<font color=#447700>! IN CASE : KCOND = 32<a name='7824'></font>
              ENDIF<a name='7825'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='7826'></font>
<font color=#447700>! CALL JERSUPSAT - 7 (MIXED_PHASE)<a name='7827'></font>
         <a name='7828'>
	      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_12">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='7829'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='7830'>
     &amp;                      ,DTT,D1N,D2N,DT0L,DT0I)<a name='7831'>
<font color=#447700>! END OF "NEW SUPERSATURATION" <a name='7832'></font>
<a name='7833'>
<font color=#447700>! DROPLETS <a name='7834'></font>
	      IF(ISYM1.NE.0) THEN<a name='7835'>
<a name='7836'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION <a name='7837'></font>
<a name='7838'>
                                                         <a name='7839'>
<font color=#447700>! CALL JERDFUN - 3<a name='7840'></font>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_36">(R1,B11_MY,B12_MY &amp;<a name='7841'>
     &amp;                      ,FI1,PSI1,D1N &amp;<a name='7842'>
     &amp;                      ,1,1,COL,NKR,TPN)<a name='7843'>
<font color=#447700>! END OF "DROPLET DISTRIBUTION FUNCTION" <a name='7844'></font>
 <a name='7845'>
<font color=#447700>! IN CASE ISYM1.NE.0<a name='7846'></font>
<a name='7847'>
 	      ENDIF                     <a name='7848'>
<font color=#447700>! CRYSTALS <a name='7849'></font>
	      IF(ISYM2.NE.0) THEN<a name='7850'>
<a name='7851'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='7852'></font>
 <a name='7853'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_37">(R2,B21_MY,B22_MY &amp;<a name='7854'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7855'>
     &amp;                      ,ICEMAX,1,COL,NKR,TPN)<a name='7856'>
<a name='7857'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_38">(R2,B21_MY,B22_MY &amp;<a name='7858'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7859'>
     &amp;                      ,ICEMAX,2,COL,NKR,TPN)<a name='7860'>
<a name='7861'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_39">(R2,B21_MY,B22_MY &amp;<a name='7862'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7863'>
     &amp;                      ,ICEMAX,3,COL,NKR,TPN)<a name='7864'>
<font color=#447700>! IN CASE ISYM2.NE.0<a name='7865'></font>
<a name='7866'>
	      ENDIF<a name='7867'>
<font color=#447700>! SNOW <a name='7868'></font>
	      IF(ISYM3.NE.0) THEN<a name='7869'>
<a name='7870'>
<font color=#447700>! SNOW DISTRIBUTION FUNCTION <a name='7871'></font>
                                                         <a name='7872'>
<a name='7873'>
<font color=#447700>! CALL JERDFUN - SNOW - 3<a name='7874'></font>
<a name='7875'>
 	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_40">(R3,B31_MY,B32_MY &amp;<a name='7876'>
     &amp;                      ,FI3,PSI3,D2N &amp;<a name='7877'>
     &amp;                      ,1,3,COL,NKR,TPN)<a name='7878'>
<a name='7879'>
<a name='7880'>
<font color=#447700>! IN CASE ISYM3.NE.0<a name='7881'></font>
<a name='7882'>
  	      ENDIF<a name='7883'>
<a name='7884'>
<font color=#447700>! GRAUPELS <a name='7885'></font>
<a name='7886'>
	      IF(ISYM4.NE.0) THEN<a name='7887'>
<a name='7888'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION<a name='7889'></font>
                                                         <a name='7890'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_41">(R4,B41_MY,B42_MY &amp;<a name='7891'>
     &amp;                      ,FI4,PSI4,D2N &amp;<a name='7892'>
     &amp;                      ,1,4,COL,NKR,TPN)<a name='7893'>
<font color=#447700>! IN CASE ISYM4.NE.0<a name='7894'></font>
<a name='7895'>
	      ENDIF<a name='7896'>
<font color=#447700>! HAIL <a name='7897'></font>
	      IF(ISYM5.NE.0) THEN<a name='7898'>
<a name='7899'>
<font color=#447700>! HAIL DISTRIBUTION FUNCTION <a name='7900'></font>
                                                         <a name='7901'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_42">(R5,B51_MY,B52_MY &amp;<a name='7902'>
     &amp;                      ,FI5,PSI5,D2N &amp;<a name='7903'>
     &amp;                      ,1,5,COL,NKR,TPN)<a name='7904'>
<font color=#447700>! IN CASE ISYM5.NE.0<a name='7905'></font>
<a name='7906'>
	      ENDIF<a name='7907'>
<font color=#447700>! MASSES<a name='7908'></font>
              RMASSLBB=0.D0<a name='7909'>
              RMASSIBB=0.D0<a name='7910'>
              RMASSLAA=0.D0<a name='7911'>
              RMASSIAA=0.D0<a name='7912'>
<font color=#447700>! BEFORE JERNEWF<a name='7913'></font>
              DO K=1,NKR<a name='7914'>
                 FI1_K=FI1(K)<a name='7915'>
                 R1_K=R1(K)<a name='7916'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='7917'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='7918'>
                 DO ICE =1,ICEMAX<a name='7919'>
                    FI2_K=FI2(K,ICE)<a name='7920'>
                    R2_K=R2(K,ICE)<a name='7921'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7922'>
                    RMASSIBB=RMASSIBB+FI2R2<a name='7923'>
                 ENDDO<a name='7924'>
                 FI3_K=FI3(K)<a name='7925'>
                 FI4_K=FI4(K)<a name='7926'>
                 FI5_K=FI5(K)<a name='7927'>
                 R3_K=R3(K)<a name='7928'>
                 R4_K=R4(K)<a name='7929'>
                 R5_K=R5(K)<a name='7930'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7931'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7932'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7933'>
                 RMASSIBB=RMASSIBB+FI3R3<a name='7934'>
                 RMASSIBB=RMASSIBB+FI4R4<a name='7935'>
                 RMASSIBB=RMASSIBB+FI5R5<a name='7936'>
              ENDDO<a name='7937'>
              RMASSIBB=RMASSIBB*COL3*RORI<a name='7938'>
<font color=#447700>! NEW CHANGE RMASSIBB<a name='7939'></font>
              IF(RMASSIBB.LT.0.0) RMASSIBB=0.0<a name='7940'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='7941'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='7942'></font>
              IF(RMASSLBB.LT.0.0) RMASSLBB=0.0<a name='7943'>
<font color=#447700>! AFTER  JERNEWF<a name='7944'></font>
              DO K=1,NKR<a name='7945'>
                 FI1_K=PSI1(K)<a name='7946'>
                 R1_K=R1(K)<a name='7947'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='7948'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='7949'>
                 DO ICE =1,ICEMAX<a name='7950'>
                    FI2(K,ICE)=PSI2(K,ICE)<a name='7951'>
                    FI2_K=FI2(K,ICE)<a name='7952'>
                    R2_K=R2(K,ICE)<a name='7953'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7954'>
                    RMASSIAA=RMASSIAA+FI2R2<a name='7955'>
                 ENDDO<a name='7956'>
                 FI3_K=PSI3(K)<a name='7957'>
                 FI4_K=PSI4(K)<a name='7958'>
                 FI5_K=PSI5(K)<a name='7959'>
                 R3_K=R3(K)<a name='7960'>
                 R4_K=R4(K)<a name='7961'>
                 R5_K=R5(K)<a name='7962'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7963'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7964'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7965'>
                 RMASSIAA=RMASSIAA+FI3R3<a name='7966'>
                 RMASSIAA=RMASSIAA+FI4R4<a name='7967'>
                 RMASSIAA=RMASSIAA+FI5R5<a name='7968'>
              ENDDO<a name='7969'>
              RMASSIAA=RMASSIAA*COL3*RORI<a name='7970'>
<font color=#447700>! NEW CHANGE RMASSIAA<a name='7971'></font>
              IF(RMASSIAA.LE.0.0) RMASSIAA=0.0<a name='7972'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='7973'>
<font color=#447700>! NEW CHANGE RMASSLAA<a name='7974'></font>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='7975'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='7976'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='7977'>
              DELMASSI1=RMASSIAA-RMASSIBB<a name='7978'>
              DELTAQ1=DELMASSL1+DELMASSI1<a name='7979'>
<font color=#447700>!             QPN=QPS-DELTAQ1-CWQ*DTT<a name='7980'></font>
              QPN=QPS-DELTAQ1<a name='7981'>
              DAL1=AL1<a name='7982'>
              DAL2=AL2<a name='7983'>
<font color=#447700>!             TPN=TPS+DAL1*DELMASSL1+AL2*DELMASSI1-CWQ*DTT<a name='7984'></font>
              TPN=TPS+DAL1*DELMASSL1+DAL2*DELMASSI1<a name='7985'>
<font color=#447700>! SUPERSATURATION<a name='7986'></font>
              ARGEXP=-BB1_MY/TPN<a name='7987'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='7988'>
              ARGEXP=-BB2_MY/TPN<a name='7989'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='7990'>
              EW1N=OPER3(QPN,PP)<a name='7991'>
              IF(ES1N.EQ.0)THEN<a name='7992'>
               DEL1N=0.5<a name='7993'>
               DIV1=1.5<a name='7994'>
               print*,'es1n onecond3 = 0'<a name='7995'>
<font color=#447700>!              stop<a name='7996'></font>
              ELSE<a name='7997'>
               DIV1=EW1N/ES1N<a name='7998'>
               DEL1N=EW1N/ES1N-1.<a name='7999'>
              END IF<a name='8000'>
              IF(ES2N.EQ.0)THEN<a name='8001'>
               DEL2N=0.5<a name='8002'>
               DIV2=1.5<a name='8003'>
               print*,'es2n onecond3 = 0'<a name='8004'>
<font color=#447700>!              stop<a name='8005'></font>
              ELSE<a name='8006'>
               DEL2N=EW1N/ES2N-1.<a name='8007'>
               DIV2=EW1N/ES2N<a name='8008'>
              END IF<a name='8009'>
<font color=#447700>! END OF TIME SPLITTING<a name='8010'></font>
<a name='8011'>
<font color=#447700>! HERE<a name='8012'></font>
<a name='8013'>
        IF(TIMENEW.LT.DT) GOTO 16<a name='8014'>
17      CONTINUE<a name='8015'>
<a name='8016'>
        TT=TPN<a name='8017'>
        QQ=QPN<a name='8018'>
        DO KR=1,NKR<a name='8019'>
           FF1(KR)=PSI1(KR)<a name='8020'>
           DO ICE=1,ICEMAX<a name='8021'>
              FF2(KR,ICE)=PSI2(KR,ICE)<a name='8022'>
           ENDDO<a name='8023'>
           FF3(KR)=PSI3(KR)<a name='8024'>
           FF4(KR)=PSI4(KR)<a name='8025'>
           FF5(KR)=PSI5(KR)<a name='8026'>
        ENDDO<a name='8027'>
<a name='8028'>
<a name='8029'>
        RETURN                                          <a name='8030'>
        END SUBROUTINE ONECOND3<a name='8031'>
<a name='8032'>
<A NAME='COAL_BOTT_NEW'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8033'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>COAL_BOTT_NEW</font>(FF1R,FF2R,FF3R, &amp; <A href='../../call_to/COAL_BOTT_NEW.html' TARGET='index'>2</A>,<A href='../../call_from/COAL_BOTT_NEW.html' TARGET='index'>56</A><a name='8034'>
     &amp;   FF4R,FF5R,TT,QQ,PP,RHO,dt_coll,TCRIT,TTCOAL)<a name='8035'>
       implicit none<a name='8036'>
       INTEGER KR,ICE<a name='8037'>
       INTEGER icol_drop,icol_snow,icol_graupel,icol_hail, &amp;<a name='8038'>
     &amp; icol_column,icol_plate,icol_dendrite,icol_drop_brk<a name='8039'>
       double precision  g1(nkr),g2(nkr,icemax),g3(nkr),g4(nkr),g5(nkr)<a name='8040'>
       double precision gdumb(JMAX),xl_dumb(0:nkr),g_orig(nkr)<a name='8041'>
       double precision g2_1(nkr),g2_2(nkr),g2_3(nkr)<a name='8042'>
       real cont_fin_drop,dconc,conc_icempl,deldrop,t_new, &amp;<a name='8043'>
     &amp; delt_new,cont_fin_ice,conc_old,conc_new,cont_init_ice, &amp;<a name='8044'>
     &amp; cont_init_drop,ALWC<a name='8045'>
       REAL    FF1R(NKR),FF2R(NKR,ICEMAX),FF3R(NKR),FF4R(NKR),FF5R(NKR)<a name='8046'>
       REAL dt_coll<a name='8047'>
       REAL TCRIT,TTCOAL<a name='8048'>
       real tt_no_coll<a name='8049'>
       parameter (tt_no_coll=273.16)<a name='8050'>
<a name='8051'>
<a name='8052'>
       <a name='8053'>
   <a name='8054'>
<font color=#447700>! SHARED<a name='8055'></font>
       INTEGER I,J,IT,NDIV<a name='8056'>
       REAL RHO<a name='8057'>
       DOUBLE PRECISION break_drop_bef,break_drop_aft,dtbreakup<a name='8058'>
       DOUBLE PRECISION break_drop_per<a name='8059'>
       DOUBLE PRECISION TT,QQ,PP,prdkrn,prdkrn1<a name='8060'>
       parameter (prdkrn1=1.d0)<a name='8061'>
<font color=#447700>!     print*,'tcrit = ',tcrit<a name='8062'></font>
<font color=#447700>!     print*,'ttcoal = ',ttcoal<a name='8063'></font>
<font color=#447700>!     print*,'col = ',col<a name='8064'></font>
<font color=#447700>!     print*,'p1,p2,p3 = ',p1,p2,p3<a name='8065'></font>
<font color=#447700>!     print*,'icempl,kr_icempl  = ',icempl,kr_icempl<a name='8066'></font>
<font color=#447700>!     print*,'dt_coll = ',dt_coll<a name='8067'></font>
      icol_drop_brk=0<a name='8068'>
      icol_drop=0<a name='8069'>
      icol_snow=0<a name='8070'>
      icol_graupel=0<a name='8071'>
      icol_hail=0<a name='8072'>
      icol_column=0<a name='8073'>
      icol_plate=0<a name='8074'>
      icol_dendrite=0<a name='8075'>
<a name='8076'>
<a name='8077'>
       t_new=tt<a name='8078'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#MISC1'>MISC1</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MISC1_2">(PP,cwll_1000mb,cwll_750mb,cwll_500mb, &amp;<a name='8079'>
     &amp;    cwll,nkr)<a name='8080'>
<font color=#447700>! THIS IS FOR BREAKUP<a name='8081'></font>
         DO I=1,NKR<a name='8082'>
            DO J=1,NKR<a name='8083'>
               CWLL(I,J)=ECOALMASSM(I,J)*CWLL(I,J)<a name='8084'>
            ENDDO<a name='8085'>
         ENDDO<a name='8086'>
<font color=#447700>!<a name='8087'></font>
<font color=#447700>! THIS IS FOR TURBULENCE<a name='8088'></font>
        IF (LIQTURB.EQ.1)THEN<a name='8089'>
         DO I=1,KRMAX_LL<a name='8090'>
           DO J=1,KRMAX_LL<a name='8091'>
               CWLL(I,J)=CTURBLL(I,J)*CWLL(I,J)<a name='8092'>
           END DO<a name='8093'>
         END DO<a name='8094'>
        END IF<a name='8095'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#MODKRN'>MODKRN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODKRN_2">(TT,QQ,PP,PRDKRN,TTCOAL)<a name='8096'>
        DO 13 KR=1,NKR<a name='8097'>
         G1(KR)=FF1R(KR)*3.*XL(KR)*XL(KR)*1.E3<a name='8098'>
         G2(KR,1)=FF2R(KR,1)*3*xi(KR,1)*XI(KR,1)*1.e3<a name='8099'>
         G2(KR,2)=FF2R(KR,2)*3.*xi(KR,2)*XI(KR,2)*1.e3<a name='8100'>
         G2(KR,3)=FF2R(KR,3)*3.*xi(KR,3)*XI(KR,3)*1.e3<a name='8101'>
         G3(KR)=FF3R(KR)*3.*xs(kr)*xs(kr)*1.e3<a name='8102'>
         G4(KR)=FF4R(KR)*3.*xg(kr)*xg(kr)*1.e3<a name='8103'>
         G5(KR)=FF5R(KR)*3.*xh(kr)*xh(kr)*1.e3<a name='8104'>
         g2_1(kr)=g2(KR,1)<a name='8105'>
         g2_2(KR)=g2(KR,2)<a name='8106'>
         g2_3(KR)=g2(KR,3)<a name='8107'>
         if(kr.gt.(nkr-jbreak).and.g1(kr).gt.1.e-17)icol_drop_brk=1<a name='8108'>
<font color=#447700>!        icol_drop_brk=0<a name='8109'></font>
         IF (IBREAKUP.NE.1)icol_drop_brk=0 <a name='8110'>
         if(g1(kr).gt.1.e-10)icol_drop=1<a name='8111'>
         if (tt.le.tt_no_coll)then<a name='8112'>
         if(g2_1(kr).gt.1.e-10)icol_column=1<a name='8113'>
         if(g2_2(kr).gt.1.e-10)icol_plate=1<a name='8114'>
         if(g2_3(kr).gt.1.e-10)icol_dendrite=1<a name='8115'>
         if(g3(kr).gt.1.e-10)icol_snow=1<a name='8116'>
         if(g4(kr).gt.1.e-10)icol_graupel=1<a name='8117'>
         if(g5(kr).gt.1.e-10)icol_hail=1<a name='8118'>
         end if<a name='8119'>
13     CONTINUE <a name='8120'>
<font color=#447700>! calculation of initial hydromteors content in g/cm**3 :<a name='8121'></font>
      cont_init_drop=0.<a name='8122'>
      cont_init_ice=0.<a name='8123'>
      do kr=1,nkr<a name='8124'>
         cont_init_drop=cont_init_drop+g1(kr)<a name='8125'>
         cont_init_ice=cont_init_ice+g3(kr)+g4(kr)+g5(kr)<a name='8126'>
         do ice=1,icemax<a name='8127'>
            cont_init_ice=cont_init_ice+g2(kr,ice)<a name='8128'>
         enddo<a name='8129'>
      enddo<a name='8130'>
      cont_init_drop=col*cont_init_drop*1.e-3<a name='8131'>
      cont_init_ice=col*cont_init_ice*1.e-3<a name='8132'>
<font color=#447700>! calculation of alwc in g/m**3<a name='8133'></font>
      alwc=cont_init_drop*1.e6<a name='8134'>
<font color=#447700>! calculation interactions :<a name='8135'></font>
<font color=#447700>! droplets - droplets and droplets - ice :<a name='8136'></font>
<font color=#447700>! water-water = water<a name='8137'></font>
<a name='8138'>
      if (icol_drop.eq.1)then <a name='8139'>
<font color=#447700>! break-up<a name='8140'></font>
<a name='8141'>
       call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX'>coll_xxx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXX_2"> (G1,CWLL,XL_MG,CHUCM,IMA,NKR)<a name='8142'>
<font color=#447700>! breakup!<a name='8143'></font>
       if(icol_drop_brk.eq.1)then<a name='8144'>
       ndiv=1<a name='8145'>
10     continue<a name='8146'>
       do it = 1,ndiv<a name='8147'>
         if (ndiv.gt.1024)print*,'ndiv in coal_bott_new = ',ndiv<a name='8148'>
         if (ndiv.gt.10000) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_808">("fatal error in module_mp_full_sbm (ndiv.gt.10000), model stop")<a name='8149'>
         dtbreakup = dt_coll/ndiv<a name='8150'>
         if (it.eq.1)then<a name='8151'>
<font color=#447700>!         do kr=1,nkr<a name='8152'></font>
          do kr=1,JMAX<a name='8153'>
           gdumb(kr)= g1(kr)*1.D-3<a name='8154'>
           xl_dumb(kr)=xl_mg(KR)*1.D-3<a name='8155'>
          end do<a name='8156'>
          break_drop_bef=0.d0<a name='8157'>
<font color=#447700>!         do kr=1,nkr<a name='8158'></font>
          do kr=1,JMAX<a name='8159'>
            break_drop_bef=break_drop_bef+g1(kr)*1.D-3<a name='8160'>
          enddo<a name='8161'>
         end if<a name='8162'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKUP'>breakup</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BREAKUP_3">(gdumb,xl_dumb,dtbreakup,brkweight, &amp;<a name='8163'>
     &amp;        pkij,qkj,JMAX,jbreak)<a name='8164'>
       end do<a name='8165'>
       break_drop_aft=0.0d0<a name='8166'>
       do kr=1,JMAX<a name='8167'>
           break_drop_aft=break_drop_aft+gdumb(kr)<a name='8168'>
       enddo<a name='8169'>
       break_drop_per=break_drop_aft/break_drop_bef<a name='8170'>
       if (break_drop_per.gt.1.001)then<a name='8171'>
           ndiv=ndiv*2<a name='8172'>
           GO TO 10<a name='8173'>
       else<a name='8174'>
           do kr=1,JMAX<a name='8175'>
            g1(kr)=gdumb(kr)*1.D3<a name='8176'>
           end do<a name='8177'>
       end if<a name='8178'>
       end if<a name='8179'>
      end if<a name='8180'>
       if (icol_snow.eq.1)then <a name='8181'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_2"> (g1,g3,g4,cwls,xl_mg,xs_mg, &amp;<a name='8182'>
     &amp;                chucm,ima,prdkrn1,nkr,0)<a name='8183'>
         if(alwc.lt.alcr) then<a name='8184'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_3"> (g3,g1,cwsl,xs_mg,xl_mg, &amp;<a name='8185'>
     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='8186'>
         endif<a name='8187'>
         if(alwc.ge.alcr) then<a name='8188'>
<font color=#447700>!        call coll_xyz (g3,g1,g4,cwsl,xs_mg,xl_mg, &amp;<a name='8189'></font>
<font color=#447700>!    &amp;                chucm,ima,prdkrn1,nkr,1)<a name='8190'></font>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ_H'>coll_xyxz_h</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_H_2"> (g3,g1,g4,cwsl,xs_mg,xl_mg, &amp;<a name='8191'>
     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='8192'>
         endif<a name='8193'>
<font color=#447700>! in case : icolxz_snow.ne.0<a name='8194'></font>
       end if<a name='8195'>
<font color=#447700>! interactions between water and  graupel (begin)<a name='8196'></font>
<font color=#447700>! water - graupel = graupel (t &lt; tcrit ; xl_mg ge xg_mg)<a name='8197'></font>
<font color=#447700>! graupel - water = graupel (t &lt; tcrit ; xg_mg &gt; xl_mg)<a name='8198'></font>
<font color=#447700>! water - graupel = hail (t ge tcrit ; xl_mg ge xg_mg)<a name='8199'></font>
<font color=#447700>! graupel - water = hail (t ge tcrit ; xg_mg &gt; xl_mg)<a name='8200'></font>
       if (icol_graupel.eq.1)then <a name='8201'>
<font color=#447700>! water-graupel<a name='8202'></font>
<font color=#447700>! included kp_bound = 25<a name='8203'></font>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYYZ_H'>coll_xyyz_h</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYYZ_H_1"> (g1,g4,g5,cwlg,xl_mg,xg_mg, &amp;<a name='8204'>
       &amp;                chucm,ima,prdkrn1,nkr,1)<a name='8205'>
<font color=#447700>! for ice multiplication<a name='8206'></font>
          conc_old=0.<a name='8207'>
          conc_new=0.<a name='8208'>
          do kr=kr_icempl,nkr<a name='8209'>
               conc_old=conc_old+col*g1(kr)/xl_mg(kr)<a name='8210'>
          enddo<a name='8211'>
<font color=#447700>! graupel-water<a name='8212'></font>
           if(alwc.lt.alcr_g) then<a name='8213'>
<font color=#447700>! water-graupel<a name='8214'></font>
<font color=#447700>! TEST<a name='8215'></font>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_2"> (g1,g4,cwlg,xl_mg,xg_mg, &amp;<a name='8216'>
     &amp;               chucm,ima,prdkrn1,nkr,0)<a name='8217'>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_4"> (g4,g1,cwgl,xg_mg,xl_mg, &amp;<a name='8218'>
     &amp;          chucm,ima,prdkrn1,nkr,1)<a name='8219'>
<font color=#447700>! TEST<a name='8220'></font>
           else<a name='8221'>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ_H'>coll_xyxz_h</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_H_3"> (g4,g1,g5,cwgl,xg_mg,xl_mg, &amp;<a name='8222'>
     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='8223'>
           end if<a name='8224'>
<font color=#447700>! interactions between water and  graupels (end)<a name='8225'></font>
<a name='8226'>
         if(icempl.eq.1) then<a name='8227'>
          if(tt.ge.265.15.and.tt.le.tcrit) then<a name='8228'>
<font color=#447700>! ice-multiplication :<a name='8229'></font>
            do kr=kr_icempl,nkr<a name='8230'>
               conc_new=conc_new+col*g1(kr)/xl_mg(kr)<a name='8231'>
            enddo<a name='8232'>
            dconc=conc_old-conc_new<a name='8233'>
            if(tt.le.268.15) then<a name='8234'>
              conc_icempl=dconc*4.e-3*(265.15-tt)/(265.15-268.15)<a name='8235'>
            endif<a name='8236'>
            if(tt.gt.268.15) then<a name='8237'>
             conc_icempl=dconc*4.e-3*(tcrit-tt)/(tcrit-268.15)<a name='8238'>
            endif<a name='8239'>
<font color=#447700>!CHANGE FOR FOUR BIN SCHEME           g2_2(1)=g2_2(1)+conc_icempl*xi2_mg(1)/col<a name='8240'></font>
            g2_2(1)=g2_2(1)+conc_icempl*xi2_mg(1)/col<a name='8241'>
<font color=#447700>!           g3(1)=g3(1)+conc_icempl*xs_mg(1)/col<a name='8242'></font>
<font color=#447700>! in case t.ge.265.15 :<a name='8243'></font>
          endif<a name='8244'>
<font color=#447700>! in case icempl=1<a name='8245'></font>
         endif<a name='8246'>
<font color=#447700>! interactions between water and  graupels (end)<a name='8247'></font>
<font color=#447700>! in case icolxz_graup.ne.0<a name='8248'></font>
       endif<a name='8249'>
<font color=#447700>! water - hail = hail (xl_mg ge xh_mg)                      (kxyy=2)<a name='8250'></font>
<font color=#447700>! hail - water = hail (xh_mg &gt; xl_mg)                       (kxyx=3)<a name='8251'></font>
       if(icol_hail.eq.1) then<a name='8252'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_3"> (g1,g5,cwlh,xl_mg,xh_mg, &amp;<a name='8253'>
     &amp;               chucm,ima,prdkrn1,nkr,0)<a name='8254'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_5"> (g5,g1,cwhl,xh_mg,xl_mg, &amp;<a name='8255'>
     &amp;               chucm,ima,prdkrn1,nkr,1)<a name='8256'>
<font color=#447700>! in case icolxz_hail.ne.0<a name='8257'></font>
       endif<a name='8258'>
<font color=#447700>! interactions between water and hail (end)<a name='8259'></font>
<font color=#447700>! interactions between water and crystals :<a name='8260'></font>
<font color=#447700>! interactions between water and columns :<a name='8261'></font>
<font color=#447700>! water - columns = graupel (t &lt; tcrit ; xl_mg ge xi_mg)    (kxyz=6)<a name='8262'></font>
<font color=#447700>! water - columns = hail (t ge tcrit ; xl_mg ge xi_mg)      (kxyz=7)<a name='8263'></font>
<font color=#447700>! columns - water = columns/graupel (xi_mg &gt; xl_mg)             (kxyx=4); kxyxz=2)<a name='8264'></font>
<font color=#447700>! now: columns - water = columns (xi_mg &gt; xl_mg)             (kxyx=4); kxyxz=2)<a name='8265'></font>
       if(icol_column.eq.1) then<a name='8266'>
        if(tt.lt.tcrit) then<a name='8267'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_3"> (g1,g2_1,g4,cwli_1,xl_mg,xi1_mg, &amp;<a name='8268'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8269'>
        endif<a name='8270'>
        if(tt.ge.tcrit) then<a name='8271'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_4"> (g1,g2_1,g5,cwli_1,xl_mg,xi1_mg, &amp;<a name='8272'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8273'>
        endif<a name='8274'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ'>coll_xyxz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_1"> (g2_1,g1,g4,cwil_1,xi1_mg,xl_mg, &amp;<a name='8275'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8276'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_6"> (g2_1,g1,cwil_1,xi1_mg,xl_mg, &amp;<a name='8277'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8278'>
<font color=#447700>! in case icolxz_column.ne.0<a name='8279'></font>
       endif<a name='8280'>
<a name='8281'>
<font color=#447700>!     if(icolxz_plate.ne.0) then<a name='8282'></font>
<font color=#447700>! interactions between water and plates :<a name='8283'></font>
<font color=#447700>! water - plates = graupel (t &lt; tcrit ; xl_mg ge xi2_mg)    (kxyz=8)<a name='8284'></font>
<font color=#447700>! water - plates = hail (t ge tcrit ; xl_mg ge xi2_mg)      (kxyz=9)<a name='8285'></font>
<font color=#447700>! plates - water = plates/graupel (xi2_mg &gt; xl_mg)              (kxyx=5; kxyxz=3)<a name='8286'></font>
<font color=#447700>!now: plates - water = plates (xi2_mg &gt; xl_mg)              (kxyx=5; kxyxz=3)<a name='8287'></font>
       if(icol_plate.eq.1) then<a name='8288'>
        if(tt.lt.tcrit) then<a name='8289'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_5"> (g1,g2_2,g4,cwli_2,xl_mg,xi2_mg, &amp;<a name='8290'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8291'>
        endif<a name='8292'>
        if(tt.ge.tcrit) then<a name='8293'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_6"> (g1,g2_2,g5,cwli_2,xl_mg,xi2_mg, &amp;<a name='8294'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8295'>
        endif<a name='8296'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ'>coll_xyxz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_2"> (g2_2,g1,g4,cwil_2,xi2_mg,xl_mg, &amp;<a name='8297'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8298'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_7"> (g2_2,g1,cwil_2,xi2_mg,xl_mg, &amp;<a name='8299'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8300'>
<font color=#447700>! in case icolxz_plate.ne.0<a name='8301'></font>
       endif<a name='8302'>
<a name='8303'>
<font color=#447700>! interactions between water and dendrites :<a name='8304'></font>
<font color=#447700>! water - dendrites = graupel (t &lt; tcrit ; xl_mg ge xi3_mg) (kxyz=10)<a name='8305'></font>
<font color=#447700>! water - dendrites = hail (t ge tcrit ; xl_mg ge xi3_mg)   (kxyz=11)<a name='8306'></font>
<font color=#447700>! dendrites - water = dendrites/graupel (xi3_mg &gt; xl_mg)         (kxyx=6; kxyxz=4)<a name='8307'></font>
<font color=#447700>!now dendrites - water = dendrites (xi3_mg &gt; xl_mg)         (kxyx=6; kxyxz=4)<a name='8308'></font>
       if(icol_dendrite.eq.1) then<a name='8309'>
        if(tt.lt.tcrit) then<a name='8310'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_7"> (g1,g2_3,g4,cwli_3,xl_mg,xi3_mg, &amp;<a name='8311'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8312'>
        endif<a name='8313'>
        if(tt.ge.tcrit) then<a name='8314'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_8"> (g1,g2_3,g5,cwli_3,xl_mg,xi3_mg, &amp;<a name='8315'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8316'>
        endif<a name='8317'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ'>coll_xyxz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_3"> (g2_3,g1,g4,cwil_3,xi3_mg,xl_mg, &amp;<a name='8318'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8319'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_8"> (g2_3,g1,cwil_3,xi3_mg,xl_mg, &amp;<a name='8320'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8321'>
<font color=#447700>! in case icolxz_dendr.ne.0<a name='8322'></font>
       endif<a name='8323'>
<font color=#447700>! interactions between water and dendrites (end)<a name='8324'></font>
<font color=#447700>! in case icolxz_drop.ne.0<a name='8325'></font>
<font color=#447700>!     endif<a name='8326'></font>
<font color=#447700>! interactions between water and crystals (end)<a name='8327'></font>
<a name='8328'>
<font color=#447700>! interactions between crystals :<a name='8329'></font>
<font color=#447700>! if(t.le.TTCOAL) - no interactions between crystals<a name='8330'></font>
      if(tt.gt.TTCOAL) then<a name='8331'>
<font color=#447700>! interactions between columns and other particles (begin)<a name='8332'></font>
       if(icol_column.eq.1) then<a name='8333'>
<font color=#447700>! columns - columns = snow<a name='8334'></font>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXY'>coll_xxy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXY_1"> (g2_1,g3,cwii_1_1,xi1_mg, &amp;<a name='8335'>
     &amp;                 chucm,ima,prdkrn,nkr)<a name='8336'>
<font color=#447700>! interactions between columns and plates :<a name='8337'></font>
<font color=#447700>! columns - plates = snow (xi1_mg ge xi2_mg)                (kxyz=12)<a name='8338'></font>
<font color=#447700>! plates - columns = snow (xi2_mg &gt; xi1_mg)                 (kxyz=13)<a name='8339'></font>
        if(icol_plate.eq.1) then     <a name='8340'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_9"> (g2_1,g2_2,g3,cwii_1_2,xi1_mg,xi2_mg, &amp;<a name='8341'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8342'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_10"> (g2_2,g2_1,g3,cwii_2_1,xi2_mg,xi1_mg, &amp;<a name='8343'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8344'>
        end if<a name='8345'>
<font color=#447700>! interactions between columns and dendrites :<a name='8346'></font>
<font color=#447700>! columns - dendrites = snow (xi1_mg ge xi3_mg)             (kxyz=14)<a name='8347'></font>
<font color=#447700>! dendrites - columns = snow (xi3_mg &gt; xi1_mg)              (kxyz=15)<a name='8348'></font>
        if(icol_dendrite.eq.1) then<a name='8349'>
           call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_11"> (g2_1,g2_3,g3,cwii_1_3,xi1_mg,xi3_mg, &amp;<a name='8350'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8351'>
           call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_12"> (g2_3,g2_1,g3,cwii_3_1,xi3_mg,xi1_mg, &amp;<a name='8352'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8353'>
        end if<a name='8354'>
<font color=#447700>! interactions between columns and snow :<a name='8355'></font>
<font color=#447700>! columns - snow = snow (xi1_mg ge xs_mg)                   (kxyy=3)<a name='8356'></font>
<font color=#447700>! snow - columns = snow (xs_mg &gt; xi1_mg)                    (kxyx=7)<a name='8357'></font>
<font color=#447700>! ALEX?<a name='8358'></font>
        if(icol_snow.eq.1) then<a name='8359'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_4"> (g2_1,g3,cwis_1,xi1_mg,xs_mg, &amp;<a name='8360'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8361'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_9"> (g3,g2_1,cwsi_1,xs_mg,xi1_mg, &amp;<a name='8362'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8363'>
        endif          <a name='8364'>
<font color=#447700>! in case icolxz_column.ne.0<a name='8365'></font>
       endif<a name='8366'>
<font color=#447700>! interactions between columns and other particles (end)<a name='8367'></font>
<font color=#447700>! interactions between plates and other particles (begin)<a name='8368'></font>
<font color=#447700>! plates - plates = snow<a name='8369'></font>
       if(icol_plate.eq.1) then<a name='8370'>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXY'>coll_xxy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXY_2"> (g2_2,g3,cwii_2_2,xi2_mg, &amp;<a name='8371'>
     &amp;                 chucm,ima,prdkrn,nkr)<a name='8372'>
<font color=#447700>! interactions between plates and dendrites :<a name='8373'></font>
<font color=#447700>! plates - dendrites = snow (xi2_mg ge xi3_mg)              (kxyz=17)<a name='8374'></font>
<font color=#447700>! dendrites - plates = snow (xi3_mg &gt; xi2_mg)               (kxyz=18)<a name='8375'></font>
        if(icol_dendrite.eq.1) then<a name='8376'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_13"> (g2_2,g2_3,g3,cwii_2_3,xi2_mg,xi3_mg, &amp;<a name='8377'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8378'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_14"> (g2_3,g2_2,g3,cwii_3_2,xi3_mg,xi2_mg, &amp;<a name='8379'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8380'>
        end if<a name='8381'>
<font color=#447700>! interactions between plates and snow :<a name='8382'></font>
<font color=#447700>! plates - snow = snow (xi2_mg ge xs_mg)                    (kxyy=4)<a name='8383'></font>
<font color=#447700>! snow - plates = snow (xs_mg &gt; xi2_mg)                     (kxyx=12)<a name='8384'></font>
        if(icol_snow.eq.1) then<a name='8385'>
<font color=#447700>! ALEX<a name='8386'></font>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_5"> (g2_2,g3,cwis_2,xi2_mg,xs_mg, &amp;<a name='8387'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8388'>
          call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_10"> (g3,g2_2,cwsi_2,xs_mg,xi2_mg, &amp;<a name='8389'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8390'>
         end if<a name='8391'>
<font color=#447700>! in case icolxz_plate.ne.0<a name='8392'></font>
       endif<a name='8393'>
<font color=#447700>! interactions between plates and others particles (end)<a name='8394'></font>
<font color=#447700>! interactions between dendrites and other hydrometeors (begin)<a name='8395'></font>
<font color=#447700>! dendrites - dendrites = snow<a name='8396'></font>
       if(icol_dendrite.eq.1) then<a name='8397'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXY'>coll_xxy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXY_3"> (g2_3,g3,cwii_3_3,xi3_mg, &amp;<a name='8398'>
      &amp;                  chucm,ima,prdkrn,nkr)<a name='8399'>
<font color=#447700>! interactions between dendrites and snow :<a name='8400'></font>
<font color=#447700>! dendrites - snow = snow (xi3_mg ge xs_mg)                 (kxyy=5)<a name='8401'></font>
<font color=#447700>! snow - dendrites = snow (xs_mg &gt; xi3_mg)                  (kxyx=17)<a name='8402'></font>
        if(icol_snow.eq.1) then<a name='8403'>
<font color=#447700>! ALEX<a name='8404'></font>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_6"> (g2_3,g3,cwis_3,xi3_mg,xs_mg,  &amp;<a name='8405'>
     &amp;                 chucm,ima,prdkrn,nkr,0)<a name='8406'>
          call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_11"> (g3,g2_3,cwsi_3,xs_mg,xi3_mg, &amp;<a name='8407'>
     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='8408'>
        end if<a name='8409'>
<font color=#447700>! in case icolxz_dendr.ne.0<a name='8410'></font>
       endif<a name='8411'>
<font color=#447700>! interactions between dendrites and other hydrometeors (end)<a name='8412'></font>
<font color=#447700>! interactions between snowflakes and other hydromteors (begin)<a name='8413'></font>
        if(icol_snow.ne.0) then<a name='8414'>
<font color=#447700>! interactions between snowflakes<a name='8415'></font>
<font color=#447700>! snow - snow = snow<a name='8416'></font>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX_PRD'>coll_xxx_prd</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXX_PRD_2"> (g3,cwss,xs_mg,chucm,ima,prdkrn,nkr)<a name='8417'>
<font color=#447700>! interactions between snowflakes and graupels :<a name='8418'></font>
<font color=#447700>! snow - graupel = snow (xs_mg &gt; xg_mg)                     (kxyx=22)<a name='8419'></font>
<font color=#447700>! graupel - snow = graupel (xg_mg ge xs_mg)                 (kxyx=23)<a name='8420'></font>
         if(icol_graupel.eq.1) then<a name='8421'>
           call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_12"> (g3,g4,cwsg,xs_mg,xg_mg, &amp;<a name='8422'>
     &amp;                chucm,ima,prdkrn,nkr,1)<a name='8423'>
<font color=#447700>! in case icolxz_graup.ne.0<a name='8424'></font>
         endif<a name='8425'>
<font color=#447700>! in case icolxz_snow.ne.0<a name='8426'></font>
        endif<a name='8427'>
<font color=#447700>! interactions between snowflakes and other hydromteors (end)<a name='8428'></font>
<font color=#447700>! in case : t &gt; TTCOAL<a name='8429'></font>
      endif<a name='8430'>
<font color=#447700>! in case : t &gt; TTCOAL or t.le.TTCOAL<a name='8431'></font>
<font color=#447700>! calculation of finish hydrometeors contents in g/cm**3 :<a name='8432'></font>
      cont_fin_drop=0.<a name='8433'>
      cont_fin_ice=0.<a name='8434'>
      do kr=1,nkr<a name='8435'>
         g2(kr,1)=g2_1(kr)<a name='8436'>
         g2(kr,2)=g2_2(kr)<a name='8437'>
         g2(kr,3)=g2_3(kr)<a name='8438'>
         cont_fin_drop=cont_fin_drop+g1(kr)<a name='8439'>
         cont_fin_ice=cont_fin_ice+g3(kr)+g4(kr)+g5(kr)<a name='8440'>
<font color=#447700>!        cont_fin_ice=cont_fin_ice+g3(kr)+g4(kr)<a name='8441'></font>
         do ice=1,icemax<a name='8442'>
            cont_fin_ice=cont_fin_ice+g2(kr,ice)<a name='8443'>
         enddo<a name='8444'>
      enddo<a name='8445'>
      cont_fin_drop=col*cont_fin_drop*1.e-3<a name='8446'>
      cont_fin_ice=col*cont_fin_ice*1.e-3<a name='8447'>
      deldrop=cont_init_drop-cont_fin_drop<a name='8448'>
<font color=#447700>! deldrop in g/cm**3<a name='8449'></font>
<font color=#447700>! resulted value of temperature (rob in g/cm**3) :<a name='8450'></font>
      if(t_new.le.273.15) then<a name='8451'>
        if(deldrop.ge.0.) then<a name='8452'>
          t_new=t_new+320.*deldrop/rho<a name='8453'>
        else<a name='8454'>
<font color=#447700>! if deldrop &lt; 0<a name='8455'></font>
          if(abs(deldrop).gt.cont_init_drop*0.05) then<a name='8456'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_809">("fatal error in module_mp_full_sbm (abs(deldrop).gt.cont_init_drop), model stop")<a name='8457'>
          endif<a name='8458'>
        endif<a name='8459'>
       endif<a name='8460'>
<a name='8461'>
61    continue<a name='8462'>
<font color=#447700>! recalculation of density function f1,f2,f3,f4,f5 in 1/(g*cm**3) :  <a name='8463'></font>
        DO 15 KR=1,NKR<a name='8464'>
         FF1R(KR)=G1(KR)/(3.*XL(KR)*XL(KR)*1.E3)<a name='8465'>
         FF2R(KR,1)=G2(KR,1)/(3*xi(KR,1)*XI(KR,1)*1.e3)<a name='8466'>
         FF2R(KR,2)=G2(KR,2)/(3.*xi(KR,2)*XI(KR,2)*1.e3)<a name='8467'>
         FF2R(KR,3)=G2(KR,3)/(3.*xi(KR,3)*XI(KR,3)*1.e3)<a name='8468'>
         FF3R(KR)=G3(KR)/(3.*xs(kr)*xs(kr)*1.e3)<a name='8469'>
         FF4R(KR)=G4(KR)/(3.*xg(kr)*xg(kr)*1.e3)<a name='8470'>
         FF5R(KR)=G5(KR)/(3.*xh(kr)*xh(kr)*1.e3)<a name='8471'>
15     CONTINUE <a name='8472'>
      tt=t_new<a name='8473'>
      RETURN<a name='8474'>
      END SUBROUTINE COAL_BOTT_NEW<a name='8475'>
<A NAME='MISC1'><A href='../../html_code/phys/module_mp_full_sbm.F.html#MISC1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8476'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>MISC1</font>(PP,cwll_1000mb,cwll_750mb,cwll_500mb, &amp; <A href='../../call_to/MISC1.html' TARGET='index'>2</A><a name='8477'>
     &amp;      cwll,nkr)<a name='8478'>
      IMPLICIT NONE<a name='8479'>
      INTEGER kr1,kr2,NKR<a name='8480'>
      DOUBLE PRECISION PP<a name='8481'>
      REAL P_Z<a name='8482'>
      double precision cwll(nkr,nkr),cwll_1,cwll_2,cwll_3 &amp;<a name='8483'>
     &amp;,cwll_1000mb(nkr,nkr),cwll_750mb(nkr,nkr),cwll_500mb(nkr,nkr)<a name='8484'>
      P_Z=PP<a name='8485'>
              do 12 kr1=1,nkr<a name='8486'>
              do 12 kr2=1,nkr<a name='8487'>
               cwll_1=cwll_1000mb(kr1,kr2)<a name='8488'>
               cwll_2=cwll_750mb(kr1,kr2)<a name='8489'>
               cwll_3=cwll_500mb(kr1,kr2)<a name='8490'>
               if(p_z.ge.p1) cwll(kr1,kr2)=cwll_1<a name='8491'>
               if(p_z.eq.p2) cwll(kr1,kr2)=cwll_2<a name='8492'>
               if(p_z.eq.p3) cwll(kr1,kr2)=cwll_3<a name='8493'>
               if(p_z.lt.p1.and.p_z.gt.p2) &amp;<a name='8494'>
     &amp;         cwll(kr1,kr2)=cwll_2+ &amp;<a name='8495'>
     &amp;         (cwll_1-cwll_2)*(p_z-p2)/(p1-p2) <a name='8496'>
               if(p_z.lt.p2.and.p_z.gt.p3) &amp;<a name='8497'>
     &amp;         cwll(kr1,kr2)=cwll_3+ &amp;<a name='8498'>
     &amp;         (cwll_2-cwll_3)*(p_z-p3)/(p2-p3)<a name='8499'>
               if(p_z.lt.p3) cwll(kr1,kr2)=cwll_3<a name='8500'>
12            CONTINUE <a name='8501'>
      RETURN<a name='8502'>
      END SUBROUTINE  MISC1<a name='8503'>
<a name='8504'>
<A NAME='COLL_XXX'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8505'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxx</font> (g,ckxx,x,chucm,ima,nkr) <A href='../../call_to/COLL_XXX.html' TARGET='index'>2</A><a name='8506'>
        implicit double precision (a-h,o-z)<a name='8507'>
        dimension g(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='8508'>
        dimension chucm(nkr,nkr)<a name='8509'>
        double precision ima(nkr,nkr)<a name='8510'>
        gmin=1.d-60<a name='8511'>
<font color=#447700>!       gmin=1.d-15<a name='8512'></font>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8513'></font>
        do i=1,nkr-1<a name='8514'>
           ix0=i<a name='8515'>
           if(g(i).gt.gmin) goto 2000<a name='8516'>
        enddo<a name='8517'>
 2000   continue<a name='8518'>
        if(ix0.eq.nkr-1) goto 2020<a name='8519'>
        do i=nkr-1,1,-1<a name='8520'>
           ix1=i<a name='8521'>
           if(g(i).gt.gmin) goto 2010<a name='8522'>
        enddo<a name='8523'>
 2010   continue<a name='8524'>
<font color=#447700>! J. Dudhia gave reasons why this can't be looped with a<a name='8525'></font>
<font color=#447700>! multiprocessor.<a name='8526'></font>
<font color=#447700>! BARRY<a name='8527'></font>
<font color=#447700>!       do i=ix0,ix1<a name='8528'></font>
<font color=#447700>!          do j=i,ix1<a name='8529'></font>
        do i=ix0,ix1-1<a name='8530'>
           do j=i+1,ix1<a name='8531'>
<a name='8532'>
              k=ima(i,j)<a name='8533'>
              kp=k+1<a name='8534'>
              x0=ckxx(i,j)*g(i)*g(j)<a name='8535'>
              x0=min(x0,g(i)*x(j))<a name='8536'>
              if(j.ne.k) then<a name='8537'>
                x0=min(x0,g(j)*x(i))<a name='8538'>
              endif<a name='8539'>
              gsi=x0/x(j)<a name='8540'>
              gsj=x0/x(i)<a name='8541'>
              gsk=gsi+gsj<a name='8542'>
              g(i)=g(i)-gsi<a name='8543'>
              if(g(i).lt.0.d0) g(i)=0.d0<a name='8544'>
              g(j)=g(j)-gsj<a name='8545'>
              gk=g(k)+gsk<a name='8546'>
              if(g(j).lt.0.d0.and.gk.lt.gmin) then<a name='8547'>
                g(j)=0.d0<a name='8548'>
                g(k)=g(k)+gsi<a name='8549'>
              endif<a name='8550'>
              flux=0.d0<a name='8551'>
<font color=#447700>!<a name='8552'></font>
<font color=#447700>! BARRY<a name='8553'></font>
              if(gk.gt.gmin) then<a name='8554'>
                x1=dlog(g(kp)/gk+1.d-15)<a name='8555'>
               if (x1.eq.0)then<a name='8556'>
                flux=0  <a name='8557'>
               else<a name='8558'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8559'>
                flux=min(flux,gsk)<a name='8560'>
               end if<a name='8561'>
<a name='8562'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8563'></font>
                g(k)=gk-flux<a name='8564'>
                if(g(k).lt.0.d0) g(k)=0.d0<a name='8565'>
                g(kp)=g(kp)+flux<a name='8566'>
<font color=#447700>! in case gk &gt; gmin :<a name='8567'></font>
              endif<a name='8568'>
            end do<a name='8569'>
        end do<a name='8570'>
 2020   continue<a name='8571'>
        return<a name='8572'>
        end subroutine coll_xxx<a name='8573'>
<A NAME='COLL_XXX_PRD'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX_PRD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8574'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxx_prd</font> (g,ckxx,x,chucm,ima,prdkrn,nkr) <A href='../../call_to/COLL_XXX_PRD.html' TARGET='index'>2</A><a name='8575'>
        implicit double precision (a-h,o-z)<a name='8576'>
        dimension g(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='8577'>
        dimension chucm(nkr,nkr)<a name='8578'>
        double precision ima(nkr,nkr)<a name='8579'>
<font color=#447700>! this is character values containes adresses of temporary files      <a name='8580'></font>
        gmin=1.d-60<a name='8581'>
<font color=#447700>!       gmin=1.d-15<a name='8582'></font>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8583'></font>
        do i=1,nkr-1<a name='8584'>
           ix0=i<a name='8585'>
           if(g(i).gt.gmin) goto 2000<a name='8586'>
        enddo<a name='8587'>
 2000   continue<a name='8588'>
        if(ix0.eq.nkr-1) goto 2020<a name='8589'>
        do i=nkr-1,1,-1<a name='8590'>
           ix1=i<a name='8591'>
           if(g(i).gt.gmin) goto 2010<a name='8592'>
        enddo<a name='8593'>
 2010   continue<a name='8594'>
<font color=#447700>! J. Dudhia gave reasons why this can't be looped with a<a name='8595'></font>
<font color=#447700>! multiprocessor.<a name='8596'></font>
<font color=#447700>! BARRY<a name='8597'></font>
<font color=#447700>!       do i=ix0,ix1<a name='8598'></font>
<font color=#447700>!          do j=i,ix1<a name='8599'></font>
        do i=ix0,ix1-1<a name='8600'>
           do j=i+1,ix1<a name='8601'>
<a name='8602'>
              k=ima(i,j)<a name='8603'>
              kp=k+1<a name='8604'>
              x0=ckxx(i,j)*g(i)*g(j)*prdkrn<a name='8605'>
              x0=min(x0,g(i)*x(j))<a name='8606'>
              if(j.ne.k) then<a name='8607'>
                x0=min(x0,g(j)*x(i))<a name='8608'>
              endif<a name='8609'>
              gsi=x0/x(j)<a name='8610'>
              gsj=x0/x(i)<a name='8611'>
              gsk=gsi+gsj<a name='8612'>
              g(i)=g(i)-gsi<a name='8613'>
              if(g(i).lt.0.d0) g(i)=0.d0<a name='8614'>
              g(j)=g(j)-gsj<a name='8615'>
              gk=g(k)+gsk<a name='8616'>
              if(g(j).lt.0.d0.and.gk.lt.gmin) then<a name='8617'>
                g(j)=0.d0<a name='8618'>
                g(k)=g(k)+gsi<a name='8619'>
              endif<a name='8620'>
              flux=0.d0<a name='8621'>
<font color=#447700>!<a name='8622'></font>
<font color=#447700>! BARRY<a name='8623'></font>
              if(gk.gt.gmin) then<a name='8624'>
                x1=dlog(g(kp)/gk+1.d-15)<a name='8625'>
               if (x1.eq.0)then<a name='8626'>
                flux=0  <a name='8627'>
               else<a name='8628'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8629'>
                flux=min(flux,gsk)<a name='8630'>
               end if<a name='8631'>
<a name='8632'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8633'></font>
                g(k)=gk-flux<a name='8634'>
                if(g(k).lt.0.d0) g(k)=0.d0<a name='8635'>
                g(kp)=g(kp)+flux<a name='8636'>
<font color=#447700>! in case gk &gt; gmin :<a name='8637'></font>
              endif<a name='8638'>
            end do<a name='8639'>
        end do<a name='8640'>
 2020   continue<a name='8641'>
        return<a name='8642'>
        end subroutine coll_xxx_prd <a name='8643'>
<A NAME='MODKRN'><A href='../../html_code/phys/module_mp_full_sbm.F.html#MODKRN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8644'>
      <font color=#993300>subroutine </font><font color=#cc0000>modkrn</font>(TT,QQ,PP,PRDKRN,TTCOAL) <A href='../../call_to/MODKRN.html' TARGET='index'>2</A><a name='8645'>
      implicit none<a name='8646'>
      real epsf,tc,ttt1,ttt,factor,qs2,qq1,dele,f,factor_t<a name='8647'>
      double precision TT,QQ,PP,satq2,t,p<a name='8648'>
      double precision prdkrn<a name='8649'>
      REAL at,bt,ct,dt,temp,a,b,c,d,tc_min,tc_max<a name='8650'>
       real factor_max,factor_min<a name='8651'>
      REAL TTCOAL<a name='8652'>
	data at,bt,ct,dt/0.88333,0.0931878,0.0034793,4.5185186e-05/<a name='8653'>
        satq2(t,p)=3.80e3*(10**(9.76421-2667.1/t))/p<a name='8654'>
        temp(a,b,c,d,tc)=d*tc*tc*tc+c*tc*tc+b*tc+a<a name='8655'>
        IF (QQ.LE.0)QQ=1.E-12<a name='8656'>
        epsf    =.5<a name='8657'>
        tc      =tt-273.15<a name='8658'>
        factor=1  <font color=#447700>!mchen add <a name='8659'></font>
        if(tc.le.0) then<a name='8660'>
<font color=#447700>! in case tc.le.0<a name='8661'></font>
          ttt1  =temp(at,bt,ct,dt,tc)<a name='8662'>
          ttt   =ttt1<a name='8663'>
          qs2   =satq2(tt,pp)<a name='8664'>
          qq1   =qq*(0.622+0.378*qs2)/(0.622+0.378*qq)/qs2<a name='8665'>
          dele  =ttt*qq1<a name='8666'>
<font color=#447700>! new change 27.06.00<a name='8667'></font>
          if(tc.ge.-6.) then<a name='8668'>
            factor = dele<a name='8669'>
            if(factor.lt.epsf) factor=epsf<a name='8670'>
            if(factor.gt.1.) factor=1.<a name='8671'>
<font color=#447700>! in case : tc.ge.-6.<a name='8672'></font>
          endif                        <a name='8673'>
          factor_t=factor<a name='8674'>
          if(tc.ge.-12.5.and.tc.lt.-6.) factor_t=0.5<a name='8675'>
          if(tc.ge.-17.0.and.tc.lt.-12.5) factor_t=1.<a name='8676'>
          if(tc.ge.-20.0.and.tc.lt.-17.) factor_t=0.4<a name='8677'>
          if(tc.lt.-20.) then<a name='8678'>
            tc_min=ttcoal-273.15<a name='8679'>
            tc_max=-20.<a name='8680'>
            factor_max=0.25<a name='8681'>
            factor_min=0.<a name='8682'>
            f=factor_min+(tc-tc_min)*(factor_max-factor_min)/  &amp;<a name='8683'>
     &amp;                               (tc_max-tc_min)<a name='8684'>
            factor_t=f<a name='8685'>
          endif<a name='8686'>
<font color=#447700>! BARRY<a name='8687'></font>
          if (factor_t.lt.0)factor_t=0.01<a name='8688'>
          prdkrn=factor_t<a name='8689'>
      else<a name='8690'>
          prdkrn=1.d0<a name='8691'>
      end if<a name='8692'>
      RETURN<a name='8693'>
      END SUBROUTINE modkrn <a name='8694'>
           <a name='8695'>
<a name='8696'>
<a name='8697'>
<A NAME='COLL_XXY'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8698'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxy</font>(gx,gy,ckxx,x,chucm,ima,prdkrn,nkr) <A href='../../call_to/COLL_XXY.html' TARGET='index'>3</A><a name='8699'>
        implicit double precision (a-h,o-z)<a name='8700'>
        dimension chucm(nkr,nkr)<a name='8701'>
        double precision ima(nkr,nkr)<a name='8702'>
        dimension  &amp;<a name='8703'>
     &amp;  gx(nkr),gy(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='8704'>
        gmin=1.d-60<a name='8705'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8706'></font>
        do i=1,nkr-1<a name='8707'>
           ix0=i<a name='8708'>
           if(gx(i).gt.gmin) goto 2000<a name='8709'>
        enddo<a name='8710'>
        if(ix0.eq.nkr-1) goto 2020<a name='8711'>
 2000   continue<a name='8712'>
        do i=nkr-1,1,-1<a name='8713'>
           ix1=i<a name='8714'>
           if(gx(i).gt.gmin) goto 2010<a name='8715'>
        enddo<a name='8716'>
 2010   continue<a name='8717'>
<font color=#447700>! collisions<a name='8718'></font>
        do i=ix0,ix1<a name='8719'>
           do j=i,ix1<a name='8720'>
              k=ima(i,j)<a name='8721'>
              kp=k+1<a name='8722'>
              x0=ckxx(i,j)*gx(i)*gx(j)*prdkrn<a name='8723'>
              x0=min(x0,gx(i)*x(j))<a name='8724'>
              x0=min(x0,gx(j)*x(i))<a name='8725'>
              gsi=x0/x(j)<a name='8726'>
              gsj=x0/x(i)<a name='8727'>
              gsk=gsi+gsj<a name='8728'>
              gx(i)=gx(i)-gsi<a name='8729'>
              if(gx(i).lt.0.d0) gx(i)=0.d0<a name='8730'>
              gx(j)=gx(j)-gsj<a name='8731'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='8732'>
              gk=gy(k)+gsk<a name='8733'>
              flux=0.d0<a name='8734'>
<font color=#447700>! BARRY<a name='8735'></font>
              if(gk.gt.gmin) then<a name='8736'>
<font color=#447700>! new changes 13.01.01 (begin)<a name='8737'></font>
                x1=dlog(gy(kp)/gk+1.d-15)<a name='8738'>
<font color=#447700>! BARRY<a name='8739'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8740'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8741'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8742'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8743'></font>
<font color=#447700>! new changes 23.01.01 (end)<a name='8744'></font>
<font color=#447700>! new changes 13.01.01 (end)<a name='8745'></font>
<font color=#447700>! BARRY<a name='8746'></font>
               if (x1.eq.0)then<a name='8747'>
                flux=0  <a name='8748'>
               else<a name='8749'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8750'>
                flux=min(flux,gsk)<a name='8751'>
               end if<a name='8752'>
                gy(k)=gk-flux<a name='8753'>
                if(gy(k).lt.0.d0) gy(k)=0.d0<a name='8754'>
                gy(kp)=gy(kp)+flux<a name='8755'>
<font color=#447700>! in case gk &gt; gmin :<a name='8756'></font>
              endif<a name='8757'>
           enddo<a name='8758'>
        enddo<a name='8759'>
 2020   continue<a name='8760'>
        return<a name='8761'>
        end subroutine coll_xxy<a name='8762'>
<font color=#447700>!====================================================================<a name='8763'></font>
<A NAME='COLL_XYY'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8764'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyy</font>(gx,gy,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYY.html' TARGET='index'>6</A><a name='8765'>
     &amp;     prdkrn,nkr,indc)<a name='8766'>
        implicit double precision (a-h,o-z)<a name='8767'>
        dimension  &amp;<a name='8768'>
     &amp;  gy(nkr),gx(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8769'>
        dimension chucm(nkr,nkr)<a name='8770'>
        double precision ima(nkr,nkr)<a name='8771'>
        gmin=1.d-60<a name='8772'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8773'></font>
        do i=1,nkr-1<a name='8774'>
           ix0=i<a name='8775'>
           if(gx(i).gt.gmin) go to 2000<a name='8776'>
        enddo<a name='8777'>
 2000   continue<a name='8778'>
        if(ix0.eq.nkr-1) goto 2020<a name='8779'>
        do i=nkr-1,1,-1<a name='8780'>
           ix1=i<a name='8781'>
           if(gx(i).gt.gmin) go to 2010<a name='8782'>
        enddo<a name='8783'>
 2010   continue<a name='8784'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8785'></font>
        do i=1,nkr-1<a name='8786'>
           iy0=i<a name='8787'>
           if(gy(i).gt.gmin) go to 2001<a name='8788'>
        enddo<a name='8789'>
 2001   continue<a name='8790'>
        if(iy0.eq.nkr-1) goto 2020<a name='8791'>
        do i=nkr-1,1,-1<a name='8792'>
           iy1=i<a name='8793'>
           if(gy(i).gt.gmin) go to 2011<a name='8794'>
        enddo<a name='8795'>
 2011   continue<a name='8796'>
<font color=#447700>! collisions :<a name='8797'></font>
        do i=iy0,iy1<a name='8798'>
           jmin=i<a name='8799'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8800'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8801'>
	   do j=jmin+indc,ix1         <a name='8802'>
              k=ima(i,j)<a name='8803'>
              kp=k+1<a name='8804'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8805'>
              x0=min(x0,gy(i)*x(j))<a name='8806'>
              x0=min(x0,gx(j)*y(i))<a name='8807'>
              gsi=x0/x(j)<a name='8808'>
              gsj=x0/y(i)<a name='8809'>
              gsk=gsi+gsj<a name='8810'>
              gy(i)=gy(i)-gsi<a name='8811'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8812'>
              gx(j)=gx(j)-gsj<a name='8813'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='8814'>
              gk=gy(k)+gsk<a name='8815'>
              flux=0.d0<a name='8816'>
<font color=#447700>! BARRY<a name='8817'></font>
              if(gk.gt.gmin) then<a name='8818'>
                x1=dlog(gy(kp)/gk+1.d-15)<a name='8819'>
<font color=#447700>! BARRY<a name='8820'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8821'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8822'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8823'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8824'></font>
<font color=#447700>! BARRY<a name='8825'></font>
               if (x1.eq.0)then<a name='8826'>
                flux=0  <a name='8827'>
               else<a name='8828'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8829'>
                flux=min(flux,gsk)<a name='8830'>
               end if<a name='8831'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8832'></font>
                gy(k)=gk-flux<a name='8833'>
                if(gy(k).lt.0.d0) gy(k)=0.d0<a name='8834'>
                gy(kp)=gy(kp)+flux<a name='8835'>
<font color=#447700>! in case gk &gt; gmin :<a name='8836'></font>
              endif<a name='8837'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8838'></font>
           enddo<a name='8839'>
        enddo<a name='8840'>
 2020   continue<a name='8841'>
        return<a name='8842'>
        end subroutine coll_xyy<a name='8843'>
<font color=#447700>!=================================================================<a name='8844'></font>
<A NAME='COLL_XYX'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8845'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyx</font>(gx,gy,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYX.html' TARGET='index'>12</A><a name='8846'>
     &amp;    prdkrn,nkr,indc)<a name='8847'>
        implicit double precision (a-h,o-z)<a name='8848'>
        dimension gy(nkr),gx(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8849'>
        dimension chucm(nkr,nkr)<a name='8850'>
        double precision ima(nkr,nkr)<a name='8851'>
        gmin=1.d-60<a name='8852'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8853'></font>
        do i=1,nkr-1<a name='8854'>
           ix0=i<a name='8855'>
           if(gx(i).gt.gmin) go to 2000<a name='8856'>
        enddo<a name='8857'>
 2000   continue<a name='8858'>
        if(ix0.eq.nkr-1) goto 2020<a name='8859'>
        do i=nkr-1,1,-1<a name='8860'>
           ix1=i<a name='8861'>
           if(gx(i).gt.gmin) go to 2010<a name='8862'>
        enddo<a name='8863'>
 2010   continue<a name='8864'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8865'></font>
        do i=1,nkr-1<a name='8866'>
           iy0=i<a name='8867'>
           if(gy(i).gt.gmin) go to 2001<a name='8868'>
        enddo<a name='8869'>
 2001   continue<a name='8870'>
        if(iy0.eq.nkr-1) goto 2020<a name='8871'>
        do i=nkr-1,1,-1<a name='8872'>
           iy1=i<a name='8873'>
           if(gy(i).gt.gmin) go to 2011<a name='8874'>
        enddo<a name='8875'>
 2011   continue<a name='8876'>
<font color=#447700>! collisions :<a name='8877'></font>
        do i=iy0,iy1<a name='8878'>
           jmin=i<a name='8879'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8880'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8881'>
	   do j=jmin+indc,ix1<a name='8882'>
              k=ima(i,j)<a name='8883'>
              kp=k+1<a name='8884'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8885'>
              x0=min(x0,gy(i)*x(j))<a name='8886'>
              if(j.ne.k) then<a name='8887'>
                x0=min(x0,gx(j)*y(i))<a name='8888'>
              endif<a name='8889'>
              gsi=x0/x(j)<a name='8890'>
              gsj=x0/y(i)<a name='8891'>
              gsk=gsi+gsj<a name='8892'>
              gy(i)=gy(i)-gsi<a name='8893'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8894'>
              gx(j)=gx(j)-gsj<a name='8895'>
              gk=gx(k)+gsk<a name='8896'>
<font color=#447700>! BARRY<a name='8897'></font>
<font color=#447700>!             if(gx(j).lt.0.d0)then<a name='8898'></font>
<font color=#447700>!                gy(i)=gy(i)+gsi<a name='8899'></font>
<font color=#447700>!                gx(j)=gx(j)+gsj<a name='8900'></font>
<font color=#447700>!                go to 10<a name='8901'></font>
<font color=#447700>!             end if<a name='8902'></font>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='8903'>
                gx(j)=0.d0<a name='8904'>
                gx(k)=gx(k)+gsi<a name='8905'>
              endif<a name='8906'>
              flux=0.d0            <a name='8907'>
<font color=#447700>! BARRY<a name='8908'></font>
              if(gk.gt.gmin) then<a name='8909'>
                x1=dlog(gx(kp)/gk+1.d-15)<a name='8910'>
<font color=#447700>! BARRY<a name='8911'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8912'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8913'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8914'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8915'></font>
<font color=#447700>! BARRY<a name='8916'></font>
               if (x1.eq.0)then<a name='8917'>
                flux=0  <a name='8918'>
               else<a name='8919'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8920'>
                flux=min(flux,gsk)<a name='8921'>
               end if<a name='8922'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8923'></font>
                gx(k)=gk-flux<a name='8924'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='8925'>
                gx(kp)=gx(kp)+flux<a name='8926'>
<font color=#447700>! in case gk &gt; gmin :<a name='8927'></font>
              endif<a name='8928'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8929'></font>
<font color=#447700>! BARRY<a name='8930'></font>
10         continue<a name='8931'>
           enddo<a name='8932'>
        enddo<a name='8933'>
 2020   continue<a name='8934'>
        return<a name='8935'>
        end subroutine coll_xyx<a name='8936'>
<font color=#447700>!=====================================================================<a name='8937'></font>
<A NAME='COLL_XYXZ'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8938'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyxz</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYXZ.html' TARGET='index'>3</A><a name='8939'>
     &amp;    prdkrn,nkr,indc)<a name='8940'>
        implicit double precision (a-h,o-z)<a name='8941'>
      dimension gy(nkr),gx(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8942'>
        dimension chucm(nkr,nkr)<a name='8943'>
        double precision ima(nkr,nkr)<a name='8944'>
        gmin=1.d-60<a name='8945'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8946'></font>
        do i=1,nkr-1<a name='8947'>
           ix0=i<a name='8948'>
           if(gx(i).gt.gmin) go to 2000<a name='8949'>
        enddo<a name='8950'>
 2000   continue<a name='8951'>
        if(ix0.eq.nkr-1) goto 2020<a name='8952'>
        do i=nkr-1,1,-1<a name='8953'>
           ix1=i<a name='8954'>
           if(gx(i).gt.gmin) go to 2010<a name='8955'>
        enddo<a name='8956'>
 2010   continue<a name='8957'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8958'></font>
        do i=1,nkr-1<a name='8959'>
           iy0=i<a name='8960'>
           if(gy(i).gt.gmin) go to 2001<a name='8961'>
        enddo<a name='8962'>
 2001   continue<a name='8963'>
        if(iy0.eq.nkr-1) goto 2020<a name='8964'>
        do i=nkr-1,1,-1<a name='8965'>
           iy1=i<a name='8966'>
           if(gy(i).gt.gmin) go to 2011<a name='8967'>
        enddo<a name='8968'>
 2011   continue<a name='8969'>
<font color=#447700>! collisions :<a name='8970'></font>
        do i=iy0,iy1<a name='8971'>
           jmin=i<a name='8972'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8973'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8974'>
	   do j=jmin+indc,ix1<a name='8975'>
              k=ima(i,j)<a name='8976'>
              kp=k+1<a name='8977'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8978'>
              x0=min(x0,gy(i)*x(j))<a name='8979'>
              if(j.ne.k) then<a name='8980'>
                x0=min(x0,gx(j)*y(i))<a name='8981'>
              endif<a name='8982'>
              gsi=x0/x(j)<a name='8983'>
              gsj=x0/y(i)<a name='8984'>
              gsk=gsi+gsj<a name='8985'>
              gy(i)=gy(i)-gsi<a name='8986'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8987'>
              gx(j)=gx(j)-gsj<a name='8988'>
              gk=gx(k)+gsk<a name='8989'>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='8990'>
                gx(j)=0.d0<a name='8991'>
                gx(k)=gx(k)+gsi<a name='8992'>
              endif<a name='8993'>
              flux=0.d0<a name='8994'>
<font color=#447700>! BARRY<a name='8995'></font>
              if(kp.lt.17) gkp=gx(kp)<a name='8996'>
              if(kp.ge.17) gkp=gz(kp)<a name='8997'>
              if(gk.gt.gmin) then<a name='8998'>
                x1=dlog(gkp/gk+1.d-15)<a name='8999'>
<font color=#447700>! BARRY<a name='9000'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9001'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='9002'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='9003'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='9004'></font>
<font color=#447700>! BARRY<a name='9005'></font>
               if (x1.eq.0)then<a name='9006'>
                flux=0  <a name='9007'>
               else<a name='9008'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9009'>
                flux=min(flux,gsk)<a name='9010'>
               end if<a name='9011'>
<font color=#447700>! new changes 23.01.01 (end)<a name='9012'></font>
                gx(k)=gk-flux<a name='9013'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='9014'>
                if(kp.lt.17) gx(kp)=gkp+flux<a name='9015'>
                if(kp.ge.17) gz(kp)=gkp+flux<a name='9016'>
<font color=#447700>! ALEX 15 11 2005<a name='9017'></font>
<font color=#447700>!               if(kp.ge.17) gx(kp)=gkp+flux<a name='9018'></font>
<font color=#447700>! in case gk &gt; gmin :<a name='9019'></font>
              endif<a name='9020'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='9021'></font>
           enddo<a name='9022'>
        enddo<a name='9023'>
 2020   continue<a name='9024'>
        return<a name='9025'>
        end subroutine coll_xyxz<a name='9026'>
<font color=#447700>!=====================================================================<a name='9027'></font>
<A NAME='COLL_XYXZ_H'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ_H' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9028'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyxz_h</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYXZ_H.html' TARGET='index'>3</A><a name='9029'>
     &amp;    prdkrn,nkr,indc)<a name='9030'>
        implicit double precision (a-h,o-z)<a name='9031'>
      dimension gy(nkr),gx(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='9032'>
        dimension chucm(nkr,nkr)<a name='9033'>
        double precision ima(nkr,nkr)<a name='9034'>
        gmin=1.d-60<a name='9035'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='9036'></font>
        do i=1,nkr-1<a name='9037'>
           ix0=i<a name='9038'>
           if(gx(i).gt.gmin) go to 2000<a name='9039'>
        enddo<a name='9040'>
 2000   continue<a name='9041'>
        if(ix0.eq.nkr-1) goto 2020<a name='9042'>
        do i=nkr-1,1,-1<a name='9043'>
           ix1=i<a name='9044'>
           if(gx(i).gt.gmin) go to 2010<a name='9045'>
        enddo<a name='9046'>
 2010   continue<a name='9047'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='9048'></font>
        do i=1,nkr-1<a name='9049'>
           iy0=i<a name='9050'>
           if(gy(i).gt.gmin) go to 2001<a name='9051'>
        enddo<a name='9052'>
 2001   continue<a name='9053'>
        if(iy0.eq.nkr-1) goto 2020<a name='9054'>
        do i=nkr-1,1,-1<a name='9055'>
           iy1=i<a name='9056'>
           if(gy(i).gt.gmin) go to 2011<a name='9057'>
        enddo<a name='9058'>
 2011   continue<a name='9059'>
<font color=#447700>! collisions :<a name='9060'></font>
        do i=iy0,iy1<a name='9061'>
           jmin=i<a name='9062'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='9063'>
           if(i.lt.ix0) jmin=ix0-indc<a name='9064'>
	   do j=jmin+indc,ix1<a name='9065'>
              k=ima(i,j)<a name='9066'>
              kp=k+1<a name='9067'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='9068'>
              x0=min(x0,gy(i)*x(j))<a name='9069'>
              if(j.ne.k) then<a name='9070'>
                x0=min(x0,gx(j)*y(i))<a name='9071'>
              endif<a name='9072'>
              gsi=x0/x(j)<a name='9073'>
              gsj=x0/y(i)<a name='9074'>
              gsk=gsi+gsj<a name='9075'>
              gy(i)=gy(i)-gsi<a name='9076'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='9077'>
              gx(j)=gx(j)-gsj<a name='9078'>
              gk=gx(k)+gsk<a name='9079'>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='9080'>
                gx(j)=0.d0<a name='9081'>
                gx(k)=gx(k)+gsi<a name='9082'>
              endif<a name='9083'>
              flux=0.d0<a name='9084'>
<font color=#447700>! BARRY<a name='9085'></font>
              if(kp.lt.22) gkp=gx(kp)<a name='9086'>
              if(kp.ge.22) gkp=gz(kp)<a name='9087'>
              if(gk.gt.gmin) then<a name='9088'>
                x1=dlog(gkp/gk+1.d-15)<a name='9089'>
<font color=#447700>! BARRY<a name='9090'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9091'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='9092'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='9093'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='9094'></font>
<font color=#447700>! BARRY<a name='9095'></font>
               if (x1.eq.0)then<a name='9096'>
                flux=0  <a name='9097'>
               else<a name='9098'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9099'>
                flux=min(flux,gsk)<a name='9100'>
               end if<a name='9101'>
<font color=#447700>! new changes 23.01.01 (end)<a name='9102'></font>
                gx(k)=gk-flux<a name='9103'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='9104'>
                if(kp.lt.22) gx(kp)=gkp+flux<a name='9105'>
                if(kp.ge.22) gz(kp)=gkp+flux<a name='9106'>
<font color=#447700>! ALEX 15 11 2005<a name='9107'></font>
<font color=#447700>!               if(kp.ge.25) gx(kp)=gkp+flux<a name='9108'></font>
<font color=#447700>! in case gk &gt; gmin :<a name='9109'></font>
              endif<a name='9110'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='9111'></font>
           enddo<a name='9112'>
        enddo<a name='9113'>
 2020   continue<a name='9114'>
        return<a name='9115'>
        end subroutine coll_xyxz_h<a name='9116'>
<font color=#447700>!=====================================================================<a name='9117'></font>
<A NAME='COLL_XYZ'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9118'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyz</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYZ.html' TARGET='index'>14</A><a name='9119'>
     &amp;                      prdkrn,nkr,indc)<a name='9120'>
        implicit double precision (a-h,o-z)<a name='9121'>
      dimension gx(nkr),gy(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='9122'>
        dimension chucm(nkr,nkr)<a name='9123'>
        double precision ima(nkr,nkr)<a name='9124'>
        gmin=1.d-60<a name='9125'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='9126'></font>
        do i=1,nkr-1<a name='9127'>
           ix0=i<a name='9128'>
           if(gx(i).gt.gmin) go to 2000<a name='9129'>
        enddo<a name='9130'>
 2000   continue<a name='9131'>
        if(ix0.eq.nkr-1) goto 2020<a name='9132'>
        do i=nkr-1,1,-1<a name='9133'>
           ix1=i<a name='9134'>
           if(gx(i).gt.gmin) go to 2010<a name='9135'>
        enddo<a name='9136'>
 2010   continue<a name='9137'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='9138'></font>
        do i=1,nkr-1<a name='9139'>
           iy0=i<a name='9140'>
           if(gy(i).gt.gmin) go to 2001<a name='9141'>
        enddo<a name='9142'>
 2001   continue<a name='9143'>
        if(iy0.eq.nkr-1) goto 2020<a name='9144'>
        do i=nkr-1,1,-1<a name='9145'>
           iy1=i<a name='9146'>
           if(gy(i).gt.gmin) go to 2011<a name='9147'>
        enddo<a name='9148'>
 2011   continue<a name='9149'>
<font color=#447700>! collisions :<a name='9150'></font>
        do i=iy0,iy1<a name='9151'>
           jmin=i<a name='9152'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='9153'>
           if(i.lt.ix0) jmin=ix0-indc<a name='9154'>
	   do j=jmin+indc,ix1         <a name='9155'>
              k=ima(i,j)<a name='9156'>
              kp=k+1<a name='9157'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='9158'>
              x0=min(x0,gy(i)*x(j))<a name='9159'>
              x0=min(x0,gx(j)*y(i))<a name='9160'>
              gsi=x0/x(j)<a name='9161'>
              gsj=x0/y(i)<a name='9162'>
              gsk=gsi+gsj<a name='9163'>
              gy(i)=gy(i)-gsi<a name='9164'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='9165'>
              gx(j)=gx(j)-gsj<a name='9166'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='9167'>
              gk=gz(k)+gsk<a name='9168'>
              flux=0.d0<a name='9169'>
<font color=#447700>! BARRY<a name='9170'></font>
              if(gk.gt.gmin) then<a name='9171'>
                x1=dlog(gz(kp)/gk+1.d-15)<a name='9172'>
<font color=#447700>! BARRY<a name='9173'></font>
               if (x1.eq.0)then<a name='9174'>
                flux=0  <a name='9175'>
               else<a name='9176'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9177'>
                flux=min(flux,gsk)<a name='9178'>
               end if<a name='9179'>
<font color=#447700>! new changes 23.01.01 (end)<a name='9180'></font>
                gz(k)=gk-flux<a name='9181'>
                if(gz(k).lt.0.d0) gz(k)=0.d0<a name='9182'>
                gz(kp)=gz(kp)+flux<a name='9183'>
<font color=#447700>! in case gk &gt; gmin :<a name='9184'></font>
              endif<a name='9185'>
           enddo<a name='9186'>
        enddo<a name='9187'>
 2020   continue<a name='9188'>
        return<a name='9189'>
        end subroutine coll_xyz<a name='9190'>
<a name='9191'>
<A NAME='COLL_XYYZ_H'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYYZ_H' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9192'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyyz_h</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYYZ_H.html' TARGET='index'>1</A><a name='9193'>
     &amp;    prdkrn,nkr,indc)<a name='9194'>
        implicit double precision (a-h,o-z)<a name='9195'>
      dimension gy(nkr),gx(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='9196'>
        dimension chucm(nkr,nkr)<a name='9197'>
        double precision ima(nkr,nkr)<a name='9198'>
        gmin=1.d-60<a name='9199'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='9200'></font>
        do i=1,nkr-1<a name='9201'>
           ix0=i<a name='9202'>
           if(gx(i).gt.gmin) go to 2000<a name='9203'>
        enddo<a name='9204'>
 2000   continue<a name='9205'>
        if(ix0.eq.nkr-1) goto 2020<a name='9206'>
        do i=nkr-1,1,-1<a name='9207'>
           ix1=i<a name='9208'>
           if(gx(i).gt.gmin) go to 2010<a name='9209'>
        enddo<a name='9210'>
 2010   continue<a name='9211'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='9212'></font>
        do i=1,nkr-1<a name='9213'>
           iy0=i<a name='9214'>
           if(gy(i).gt.gmin) go to 2001<a name='9215'>
        enddo<a name='9216'>
 2001   continue<a name='9217'>
        if(iy0.eq.nkr-1) goto 2020<a name='9218'>
        do i=nkr-1,1,-1<a name='9219'>
           iy1=i<a name='9220'>
           if(gy(i).gt.gmin) go to 2011<a name='9221'>
        enddo<a name='9222'>
 2011   continue<a name='9223'>
<font color=#447700>! collisions :<a name='9224'></font>
        do i=iy0,iy1<a name='9225'>
           jmin=i<a name='9226'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='9227'>
           if(i.lt.ix0) jmin=ix0-indc<a name='9228'>
           do j=jmin+indc,ix1<a name='9229'>
              k=ima(i,j)<a name='9230'>
              kp=k+1<a name='9231'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='9232'>
              x0=min(x0,gy(i)*x(j))<a name='9233'>
              if(j.ne.k) then<a name='9234'>
                x0=min(x0,gx(j)*y(i))<a name='9235'>
              endif<a name='9236'>
              gsi=x0/x(j)<a name='9237'>
              gsj=x0/y(i)<a name='9238'>
              gsk=gsi+gsj<a name='9239'>
              gy(i)=gy(i)-gsi<a name='9240'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='9241'>
              gx(j)=gx(j)-gsj<a name='9242'>
              gk=gx(k)+gsk<a name='9243'>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='9244'>
                gx(j)=0.d0<a name='9245'>
                gx(k)=gx(k)+gsi<a name='9246'>
              endif<a name='9247'>
              flux=0.d0<a name='9248'>
<font color=#447700>! BARRY<a name='9249'></font>
              if(kp.lt.25) gkp=gy(kp)<a name='9250'>
              if(kp.ge.25) gkp=gz(kp)<a name='9251'>
              if(gk.gt.gmin) then<a name='9252'>
                x1=dlog(gkp/gk+1.d-15)<a name='9253'>
<font color=#447700>! BARRY<a name='9254'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9255'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='9256'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='9257'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='9258'></font>
<font color=#447700>! BARRY<a name='9259'></font>
               if (x1.eq.0)then<a name='9260'>
                flux=0<a name='9261'>
               else<a name='9262'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='9263'>
                flux=min(flux,gsk)<a name='9264'>
               end if<a name='9265'>
<font color=#447700>! new changes 23.01.01 (end)<a name='9266'></font>
                gx(k)=gk-flux<a name='9267'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='9268'>
                if(kp.lt.25) gy(kp)=gkp+flux<a name='9269'>
                if(kp.ge.25) gz(kp)=gkp+flux<a name='9270'>
<font color=#447700>! ALEX 15 11 2005<a name='9271'></font>
<font color=#447700>!               if(kp.ge.25) gx(kp)=gkp+flux<a name='9272'></font>
<font color=#447700>! in case gk &gt; gmin :<a name='9273'></font>
              endif<a name='9274'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='9275'></font>
           enddo<a name='9276'>
        enddo<a name='9277'>
 2020   continue<a name='9278'>
        return<a name='9279'>
        end subroutine coll_xyyz_h<a name='9280'>
<font color=#447700>!===============================================================<a name='9281'></font>
<font color=#447700>!****************************************************************<a name='9282'></font>
<font color=#447700>! SEE /include/microhucm.incl for setting of krdrop and krbreak<a name='9283'></font>
<font color=#447700>!****************************************************************<a name='9284'></font>
<A NAME='BREAKUP'><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKUP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9285'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BREAKUP</font>(GT_MG,XT_MG,DT,BRKWEIGHT, &amp; <A href='../../call_to/BREAKUP.html' TARGET='index'>3</A><a name='9286'>
     &amp;           PKIJ,QKJ,JMAX,JBREAK)<a name='9287'>
<font color=#447700>!     SUBROUTINE BREAKUP(GT_MG,DT,JMAX,JBREAK)<a name='9288'></font>
<font color=#447700>!     implicit double precision (a-h,o-z)<a name='9289'></font>
<a name='9290'>
<font color=#447700>!.....INPUT VARIABLES<a name='9291'></font>
<font color=#447700>!<a name='9292'></font>
<font color=#447700>!     GT    : MASS DISTRIBUTION FUNCTION<a name='9293'></font>
<font color=#447700>!     XT_MG : MASS OF BIN IN MG<a name='9294'></font>
<font color=#447700>!     JMAX  : NUMBER OF BINS<a name='9295'></font>
<font color=#447700>!     DT    : TIMESTEP IN S<a name='9296'></font>
<a name='9297'>
      INTEGER JMAX<a name='9298'>
<a name='9299'>
<font color=#447700>!.....LOCAL VARIABLES<a name='9300'></font>
<a name='9301'>
      LOGICAL LTHAN<a name='9302'>
      INTEGER JBREAK,AP,IA,JA,KA,IE,JE,KE<a name='9303'>
      DOUBLE PRECISION EPS,NEGSUM<a name='9304'>
<a name='9305'>
      PARAMETER (AP = 1)<a name='9306'>
      PARAMETER (IA = 1)<a name='9307'>
      PARAMETER (JA = 1)<a name='9308'>
      PARAMETER (KA = 1)<a name='9309'>
      PARAMETER (EPS = 1.D-20)<a name='9310'>
<a name='9311'>
      INTEGER I,J,K,JJ,JDIFF<a name='9312'>
      DOUBLE PRECISION GT_MG(JMAX),XT_MG(0:JMAX),DT<a name='9313'>
<font color=#447700>!     xl_mg(0:nkr)<a name='9314'></font>
      DOUBLE PRECISION BRKWEIGHT(JBREAK),PKIJ(JBREAK,JBREAK,JBREAK), &amp;<a name='9315'>
     &amp;    QKJ(JBREAK,JBREAK)<a name='9316'>
      DOUBLE PRECISION D0,ALM,HLP(JMAX)<a name='9317'>
      DOUBLE PRECISION FT(JMAX),FA(JMAX)<a name='9318'>
      DOUBLE PRECISION DG(JMAX),DF(JMAX),DBREAK(JBREAK),GAIN,LOSS<a name='9319'>
      REAL PI<a name='9320'>
      PARAMETER (PI = 3.1415927)<a name='9321'>
      INTEGER IP,KP,JP,KQ,JQ<a name='9322'>
      IE = JBREAK<a name='9323'>
      JE = JBREAK<a name='9324'>
      KE = JBREAK<a name='9325'>
<a name='9326'>
<a name='9327'>
<a name='9328'>
<a name='9329'>
<a name='9330'>
<a name='9331'>
<a name='9332'>
<font color=#447700>!.....IN CGS<a name='9333'></font>
<a name='9334'>
<font color=#447700>!     DO J=1,JMAX<a name='9335'></font>
<font color=#447700>!        XT(J) = XT_MG(J) * 1E-3<a name='9336'></font>
<font color=#447700>!        GT_MG(J) = GT_MG(J)* 1E-3<a name='9337'></font>
<font color=#447700>!     ENDDO<a name='9338'></font>
<a name='9339'>
<font color=#447700>!.....SHIFT BETWEEN COAGULATION AND BREAKUP GRID<a name='9340'></font>
<a name='9341'>
      JDIFF = JMAX - JBREAK<a name='9342'>
<font color=#447700>!       14  =  33  - 19<a name='9343'></font>
<a name='9344'>
<font color=#447700>!.....INITIALIZATION<a name='9345'></font>
<a name='9346'>
<font color=#447700>!.....TRANSFORMATION FROM G(LN X) = X**2 F(X) TO F(X)<a name='9347'></font>
      DO J=1,JMAX<a name='9348'>
         FT(J) = GT_MG(J) / XT_MG(J)**2<a name='9349'>
      ENDDO<a name='9350'>
<a name='9351'>
<font color=#447700>!.....SHIFT TO BREAKUP GRID<a name='9352'></font>
<a name='9353'>
      DO K=1,KE<a name='9354'>
         FA(K) = FT(K+JDIFF)<a name='9355'>
      ENDDO<a name='9356'>
<a name='9357'>
<font color=#447700>!.....BREAKUP: BLECK'S FIRST ORDER METHOD<a name='9358'></font>
<font color=#447700>!<a name='9359'></font>
<font color=#447700>!     PKIJ: GAIN COEFFICIENTS<a name='9360'></font>
<font color=#447700>!     QKJ : LOSS COEFFICIENTS<a name='9361'></font>
<font color=#447700>!<a name='9362'></font>
<a name='9363'>
      DO K=1,KE<a name='9364'>
         GAIN = 0.0<a name='9365'>
         DO I=1,IE<a name='9366'>
            DO J=1,I<a name='9367'>
               GAIN = GAIN + FA(I)*FA(J)*PKIJ(K,I,J)<a name='9368'>
            ENDDO<a name='9369'>
         ENDDO<a name='9370'>
         LOSS = 0.0<a name='9371'>
         DO J=1,JE<a name='9372'>
            LOSS = LOSS + FA(J)*QKJ(K,J)<a name='9373'>
         ENDDO<a name='9374'>
         DBREAK(K) = BRKWEIGHT(K) * (GAIN - FA(K)*LOSS)<a name='9375'>
      ENDDO<a name='9376'>
<a name='9377'>
<font color=#447700>!.....SHIFT RATE TO COAGULATION GRID<a name='9378'></font>
<a name='9379'>
      DO J=1,JDIFF<a name='9380'>
         DF(J) = 0.0<a name='9381'>
      ENDDO<a name='9382'>
      DO J=1,KE<a name='9383'>
         DF(J+JDIFF) = DBREAK(J)<a name='9384'>
      ENDDO<a name='9385'>
<font color=#447700>!.....TRANSFORMATION TO MASS DISTRIBUTION FUNCTION G(LN X)<a name='9386'></font>
<a name='9387'>
      DO J=1,JMAX<a name='9388'>
         DG(J) = DF(J) * XT_MG(J)**2<a name='9389'>
      ENDDO<a name='9390'>
<a name='9391'>
<font color=#447700>!.....TIME INTEGRATION<a name='9392'></font>
<a name='9393'>
      DO J=1,JMAX<a name='9394'>
      HLP(J) = 0.0<a name='9395'>
      NEGSUM = 0.0<a name='9396'>
         GT_MG(J) = GT_MG(J) + DG(J) * DT<a name='9397'>
         IF (GT_MG(J).LT.0) THEN<a name='9398'>
            HLP(J) = MIN(GT_MG(J),HLP(J))<a name='9399'>
            GT_MG(J) = EPS<a name='9400'>
<font color=#447700>!           NEGSUM = NEGSUM+GT_MG(J)<a name='9401'></font>
<font color=#447700>!           GT_MG(J) = 0.D0<a name='9402'></font>
         ENDIF<a name='9403'>
      ENDDO<a name='9404'>
<font color=#447700>!     DO J=1,JMAX<a name='9405'></font>
<font color=#447700>!      IF (HLP(J).LT.0.) THEN<a name='9406'></font>
<font color=#447700>!        GT_MG(J-1)=GT_MG(J-1)-NEGSUM -EPS<a name='9407'></font>
<font color=#447700>!      END IF<a name='9408'></font>
<font color=#447700>!      GO TO 10<a name='9409'></font>
<font color=#447700>!     END DO<a name='9410'></font>
<font color=#447700>!10    CONTINUE<a name='9411'></font>
<font color=#447700>!     IF (HLP.LT.-1E-7) THEN<a name='9412'></font>
<font color=#447700>! BARRY<a name='9413'></font>
<font color=#447700>!     LTHAN=.FALSE.<a name='9414'></font>
<font color=#447700>!     DO J=1,JMAX<a name='9415'></font>
<font color=#447700>!      IF (HLP(J).LT.0.OR.LTHAN) THEN<a name='9416'></font>
<font color=#447700>!        WRITE (*,'(1X,A,E10.4)')<a name='9417'></font>
<font color=#447700>!    F        'COLL_BREAKUP: WARNING! G(J) &lt; 0, MIN = ' <a name='9418'></font>
<font color=#447700>!        IF(HLP(J).LT.0.OR.LTHAN)WRITE(6,*)<a name='9419'></font>
<font color=#447700>!    F      'J,G(J)  = ',J,HLP(J),GT_MG(J)<a name='9420'></font>
<font color=#447700>!        LTHAN=.TRUE.  C     ENDIF<a name='9421'></font>
<font color=#447700>!     END DO<a name='9422'></font>
<a name='9423'>
<font color=#447700>!     DO J=1,JMAX<a name='9424'></font>
<font color=#447700>!        GT_MG(J) = GT_MG(J) * 1E3<a name='9425'></font>
<font color=#447700>!     ENDDO<a name='9426'></font>
<a name='9427'>
<font color=#447700>!.....THAT'S IT<a name='9428'></font>
      RETURN<a name='9429'>
<a name='9430'>
      END SUBROUTINE BREAKUP<a name='9431'>
<a name='9432'>
<A NAME='BOUNDNUM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDNUM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9433'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BOUNDNUM</font>(MASSMM5,FCONC,RHOX,COL,NZERO, &amp;,<A href='../../call_from/BOUNDNUM.html' TARGET='index'>2</A><a name='9434'>
     &amp;       RADXX,MASSXX,HYDROSUM, &amp;<a name='9435'>
     &amp;       NKR)<a name='9436'>
      IMPLICIT NONE<a name='9437'>
     <a name='9438'>
      INTEGER NKR,NKRI,KRBEG,KREND,IP,IPCNT<a name='9439'>
      REAL NZERO,LAMBDAHYD,MASSMM5,RHOX,HYDROMASS,COL<a name='9440'>
      REAL RADXX(NKR),MASSXX(NKR)<a name='9441'>
      REAL TERM1,TERM2A,TERM2B,TERM2C<a name='9442'>
      REAL FCONC(NKR),HYDROSUM <a name='9443'>
      DOUBLE PRECISION D1,D2,D3,D4,D5,D6,D7A,D7B <a name='9444'>
      DOUBLE PRECISION VAR1,VAR2,VAR3,VAR4,VAR5,VAR6<a name='9445'>
<font color=#447700>!     HYDROMASS IN kg/kg<a name='9446'></font>
<font color=#447700>!     VAR1=NZERO           <a name='9447'></font>
<font color=#447700>!     VAR2=RHOX            <a name='9448'></font>
<font color=#447700>!     VAR3=MASSXX(1,IHYDR)<a name='9449'></font>
<font color=#447700>!     VAR4=RADXX(1,IHYDR)<a name='9450'></font>
<font color=#447700>!     VAR5=MASSMM5       <a name='9451'></font>
<font color=#447700>!     VAR6=(6.*VAR1/VAR2)*VAR3/(8.*VAR4**3)*(1./VAR5)<a name='9452'></font>
<font color=#447700>!     var6 =sqrt(sqrt(var6))<a name='9453'></font>
<font color=#447700>!     print*,'radxx(1) = ',RADXX(1)<a name='9454'></font>
<font color=#447700>!     print*,'rhox = ',rhox<a name='9455'></font>
<font color=#447700>!     print*,'massmm5 = ',massmm5<a name='9456'></font>
<font color=#447700>!     print*,'nzero = ',nzerO<a name='9457'></font>
<font color=#447700>!     print*,'massxx = ',MASSXX(1)<a name='9458'></font>
      LAMBDAHYD=(6.*NZERO/RHOX)*MASSXX(1)/(8.*RADXX(1)**3) &amp;<a name='9459'>
     &amp;     *(1./MASSMM5)<a name='9460'>
      LAMBDAHYD=SQRT(SQRT(LAMBDAHYD))<a name='9461'>
      HYDROSUM  =0<a name='9462'>
      TERM1=(NZERO/RHOX)*(MASSXX(1)/(8.*RADXX(1)**3))<a name='9463'>
      DO NKRI=1,NKR<a name='9464'>
       IF(NKRI.EQ.1)THEN<a name='9465'>
        D1=LAMBDAHYD*2.*RADXX(NKRI)<a name='9466'>
        D2=0<a name='9467'>
       ELSE<a name='9468'>
        D1=LAMBDAHYD*2.*RADXX(NKRI)<a name='9469'>
        D2=LAMBDAHYD*2.*RADXX(NKRI-1)<a name='9470'>
       END IF<a name='9471'>
       D3=DEXP(-D1)<a name='9472'>
       D4=DEXP(-D2)<a name='9473'>
       D5 = (1./LAMBDAHYD**4)<a name='9474'>
       D6=TERM1<a name='9475'>
       IF (NKRI.EQ.1)THEN<a name='9476'>
        D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='9477'>
        D7B=-6.*D5<a name='9478'>
       ELSE<a name='9479'>
        D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='9480'>
        D7B= -D5*D4*(D2**3+3.*D2**2+6.*D2+6)<a name='9481'>
       END IF<a name='9482'>
       HYDROMASS= D6*(D7A-D7B)<a name='9483'>
       HYDROSUM=HYDROSUM+HYDROMASS   <a name='9484'>
       FCONC(NKRI)=HYDROMASS*RHOX/(COL  &amp;<a name='9485'>
     &amp;          *MASSXX(NKRI)*MASSXX(NKRI)*3)<a name='9486'>
        IF (HYDROMASS .LT.0)THEN<a name='9487'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDNUM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_810">("fatal error in module_mp_full_sbm (HYDROMASS.LT.0), model stop")<a name='9488'>
        END IF<a name='9489'>
      END DO<a name='9490'>
<font color=#447700>!     print*, 'massmm5,hydrosum  =',massmm5,hydrosum  <a name='9491'></font>
      IF (HYDROSUM.LT.MASSMM5)THEN<a name='9492'>
       D1=LAMBDAHYD*2.*RADXX(NKR)<a name='9493'>
       D2=LAMBDAHYD*2.*RADXX(NKR-1)<a name='9494'>
       D3=DEXP(-D1)<a name='9495'>
       D4=DEXP(-D2)<a name='9496'>
       D5 = (1./LAMBDAHYD**4)<a name='9497'>
       D6=TERM1<a name='9498'>
       D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='9499'>
       D7B= -D5*D4*(D2**3+3.*D2**2+6.*D2+6)<a name='9500'>
       HYDROMASS= D6*(D7A-D7B)+(MASSMM5-HYDROSUM)<a name='9501'>
       FCONC(NKR)=HYDROMASS*RHOX/(COL &amp;<a name='9502'>
     &amp;          *MASSXX(NKR)*MASSXX(NKR)*3)<a name='9503'>
       HYDROSUM=HYDROSUM+(MASSMM5-HYDROSUM)<a name='9504'>
      END IF<a name='9505'>
<font color=#447700>!     print*, 'massmm5,hydrosum adj  =',massmm5,hydrosum  <a name='9506'></font>
      RETURN<a name='9507'>
      END SUBROUTINE BOUNDNUM<a name='9508'>
<font color=#447700>! NEW (OLD) MELTING CODE<a name='9509'></font>
<font color=#447700>!====================================================================<a name='9510'></font>
<font color=#447700>! Version of 23.08.04 <a name='9511'></font>
<a name='9512'>
<A NAME='MELTING'><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9513'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>MELTING</font> &amp;,<A href='../../call_from/MELTING.html' TARGET='index'>71</A><a name='9514'>
<a name='9515'>
(ihucm_flag &amp;<a name='9516'>
<a name='9517'>
,FF1,XL,VTL &amp;<a name='9518'>
,FF2,XI,V2,VTC,FLIQFR_I,RHO_I &amp;<a name='9519'>
,FF3,XS,V3,VTS,FLIQFR_S,RHO_S &amp;<a name='9520'>
,FF4,XG,V4,VTG,FLIQFR_G,RHO_G &amp;<a name='9521'>
,FF5,XH,V5,VTH,FLIQFR_H,RHO_H &amp;<a name='9522'>
,XI_MELT,XS_MELT,XG_MELT,XH_MELT &amp;<a name='9523'>
,TIN,rhoa,pres,DT,QQV)<a name='9524'>
<a name='9525'>
<font color=#447700>!===============================================!<a name='9526'></font>
<font color=#447700>! EXPLICIT MELTING SCHEME                       !<a name='9527'></font>
<font color=#447700>! Author: Vaughan T.J. PHILLIPS, August 2004    !<a name='9528'></font>
<font color=#447700>! at Princeton University (AOS program)         !<a name='9529'></font>
<font color=#447700>! and GFDL, NOAA/OAR, USA                       !<a name='9530'></font>
<font color=#447700>!===============================================!<a name='9531'></font>
<a name='9532'>
implicit double precision (a-h,o-z)<a name='9533'>
<a name='9534'>
<font color=#447700>! new change 27.03.07                                         (start)<a name='9535'></font>
<a name='9536'>
<font color=#447700>!PARAMETER(NKR=33, NK=129, ICEMAX=3)<a name='9537'></font>
<a name='9538'>
<font color=#447700>! new change 27.03.07                                           (end)<a name='9539'></font>
<a name='9540'>
<font color=#447700>! new change 12.02.07                                         (start)<a name='9541'></font>
<a name='9542'>
PARAMETER(CP=1004.7D0, RV=461.51D0, RD=287.039D0, &amp;<a name='9543'>
          EPS=RD/RV, FJOULES_IN_A_CAL=4.187D0, PI=3.141592654D0, &amp;<a name='9544'>
          AR_LIM=2.D0, GRAV=9.8D0, RHO_ICE=920.D0, &amp;<a name='9545'>
          RHO_WATER=1000.D0, FLIQFRAC_LIM=0.9D0, &amp;<a name='9546'>
          PETIT_PARAMETRE=1.D-10)<a name='9547'>
PARAMETER (ivt_G_H_interpol=0)<a name='9548'>
<a name='9549'>
<font color=#447700>! new change 12.02.07                                           (end)<a name='9550'></font>
<a name='9551'>
<font color=#447700>! new change 12.02.07                                         (start)<a name='9552'></font>
<a name='9553'>
PARAMETER(ISHEDDING_ON=1, IVT_ADJUST=1, IPRINTING=0, &amp;<a name='9554'>
          ITEMP_ADJUST=1, IEVAP_ADJUST=1, ISUBLIME_ADJUST=1)<a name='9555'>
<a name='9556'>
<font color=#447700>! new change 12.02.07                                           (end)<a name='9557'></font>
<a name='9558'>
<font color=#447700>! control in main program &amp; others subroutines<a name='9559'></font>
<a name='9560'>
<a name='9561'>
<font color=#447700>! new change 29.10.08                                         (start)           <a name='9562'></font>
<a name='9563'>
<a name='9564'>
<font color=#447700>! new change 29.10.08                                           (end)<a name='9565'></font>
<a name='9566'>
<a name='9567'>
<a name='9568'>
<a name='9569'>
DIMENSION FF1(NKR), XL(NKR), VTL(NKR)<a name='9570'>
<a name='9571'>
DIMENSION FF2(NKR,ICEMAX),XI(NKR,ICEMAX),V2(NKR,ICEMAX), &amp;<a name='9572'>
          VTC(NKR,ICEMAX),FLIQFR_I(NKR,ICEMAX),RHO_I(NKR,ICEMAX)<a name='9573'>
<a name='9574'>
DIMENSION FF3(NKR),XS(NKR),V3(NKR), &amp;<a name='9575'>
          VTS(NKR),FLIQFR_S(NKR),RHO_S(NKR)<a name='9576'>
<a name='9577'>
DIMENSION FF4(NKR),XG(NKR),V4(NKR), &amp;<a name='9578'>
          VTG(NKR),FLIQFR_G(NKR),RHO_G(NKR)<a name='9579'>
<a name='9580'>
DIMENSION FF5(NKR),XH(NKR),V5(NKR), &amp;<a name='9581'>
          VTH(NKR),FLIQFR_H(NKR),RHO_H(NKR)<a name='9582'>
<a name='9583'>
DIMENSION FF1_SI(NKR), XL_SI(NKR), VTL_SI(NKR)<a name='9584'>
<a name='9585'>
DIMENSION FF2_SI(NKR,ICEMAX),XI_SI(NKR,ICEMAX),V2_SI(NKR,ICEMAX), &amp;<a name='9586'>
          VTC_SI(NKR,ICEMAX),RHO_I_SI(NKR,ICEMAX)<a name='9587'>
<a name='9588'>
DIMENSION FF3_SI(NKR),XS_SI(NKR),V3_SI(NKR), &amp;<a name='9589'>
          VTS_SI(NKR), RHO_S_SI(NKR)<a name='9590'>
	  <a name='9591'>
DIMENSION FF4_SI(NKR),XG_SI(NKR),V4_SI(NKR), &amp;<a name='9592'>
          VTG_SI(NKR), RHO_G_SI(NKR)<a name='9593'>
<a name='9594'>
DIMENSION FF5_SI(NKR),XH_SI(NKR),V5_SI(NKR), &amp;<a name='9595'>
          VTH_SI(NKR), RHO_H_SI(NKR)<a name='9596'>
DIMENSION &amp;<a name='9597'>
XI_MELT(NKR,ICEMAX),XS_MELT(NKR),XG_MELT(NKR),XH_MELT(NKR)<a name='9598'>
<a name='9599'>
DIMENSION &amp;<a name='9600'>
XI_MELT_SI(NKR,ICEMAX),XS_MELT_SI(NKR),XG_MELT_SI(NKR),XH_MELT_SI(NKR)<a name='9601'>
<a name='9602'>
INTRINSIC SUM<a name='9603'>
<a name='9604'>
If(TIN &lt;= 273.15D0) then<a name='9605'>
  RETURN<a name='9606'>
ENDIF<a name='9607'>
<a name='9608'>
if(SUM(FF2) &lt;= 0.D0.and.SUM(FF3) &lt;= 0.D0.and.SUM(FF4) &lt;= 0.D0.and. &amp;<a name='9609'>
SUM(FF5) &lt;= 0.D0) then<a name='9610'>
  return<a name='9611'>
endif<a name='9612'>
<a name='9613'>
<font color=#447700>!=============================================================<a name='9614'></font>
<font color=#447700>!       UNIT CONVERSION OF ALL INPUTS to SI<a name='9615'></font>
<font color=#447700>!=============================================================<a name='9616'></font>
<a name='9617'>
if(ihucm_flag == 1) then<a name='9618'>
<a name='9619'>
RHO_I_SI = RHO_I*1000.D0<a name='9620'>
RHO_S_SI = RHO_S*1000.D0<a name='9621'>
RHO_G_SI = RHO_G*1000.D0<a name='9622'>
RHO_H_SI = RHO_H*1000.D0<a name='9623'>
<a name='9624'>
XL_SI = XL/1000.D0<a name='9625'>
XI_SI = XI/1000.D0<a name='9626'>
XS_SI = XS/1000.D0<a name='9627'>
XG_SI = XG/1000.D0<a name='9628'>
XH_SI = XH/1000.D0<a name='9629'>
<a name='9630'>
XI_MELT_SI = XI_SI<a name='9631'>
XS_MELT_SI = XS_SI<a name='9632'>
XG_MELT_SI = XG_SI<a name='9633'>
XH_MELT_SI = XH_SI<a name='9634'>
<a name='9635'>
VTL_SI = VTL/100.D0<a name='9636'>
VTC_SI = VTC/100.D0<a name='9637'>
VTS_SI = VTS/100.D0<a name='9638'>
<font color=#447700>!do kr=1,nkr<a name='9639'></font>
<font color=#447700>! print*,'vts within = ',vts(kr)<a name='9640'></font>
<font color=#447700>!end do<a name='9641'></font>
VTG_SI = VTG/100.D0<a name='9642'>
VTH_SI = VTH/100.D0<a name='9643'>
<a name='9644'>
V2_SI = V2/100.D0<a name='9645'>
V3_SI = V3/100.D0<a name='9646'>
V4_SI = V4/100.D0<a name='9647'>
V5_SI = V5/100.D0<a name='9648'>
<a name='9649'>
FF1_SI = 1.E9*FF1<a name='9650'>
FF2_SI = 1.E9*FF2<a name='9651'>
FF3_SI = 1.E9*FF3<a name='9652'>
FF4_SI = 1.E9*FF4<a name='9653'>
FF5_SI = 1.E9*FF5<a name='9654'>
<a name='9655'>
pres_SI = pres/10.D0<a name='9656'>
rhoa_SI = rhoa*1000.D0<a name='9657'>
<a name='9658'>
<font color=#447700>! in case ihucm_flag == 1<a name='9659'></font>
<a name='9660'>
else<a name='9661'>
<a name='9662'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='9663'></font>
<a name='9664'>
RHO_I_SI = RHO_I<a name='9665'>
RHO_S_SI = RHO_S<a name='9666'>
RHO_G_SI = RHO_G<a name='9667'>
RHO_H_SI = RHO_H<a name='9668'>
<a name='9669'>
XL_SI = XL<a name='9670'>
XI_SI = XI<a name='9671'>
XS_SI = XS<a name='9672'>
XG_SI = XG<a name='9673'>
XH_SI = XH<a name='9674'>
<a name='9675'>
XI_MELT_SI = XI_SI<a name='9676'>
XS_MELT_SI = XS_SI<a name='9677'>
XG_MELT_SI = XG_SI<a name='9678'>
XH_MELT_SI = XH_SI<a name='9679'>
<a name='9680'>
VTL_SI = VTL<a name='9681'>
VTC_SI = VTC<a name='9682'>
VTS_SI = VTS<a name='9683'>
VTG_SI = VTG<a name='9684'>
VTH_SI = VTH<a name='9685'>
<a name='9686'>
V2_SI = V2<a name='9687'>
V3_SI = V3<a name='9688'>
V4_SI = V4<a name='9689'>
V5_SI = V5<a name='9690'>
<a name='9691'>
FF1_SI = FF1<a name='9692'>
FF2_SI = FF2<a name='9693'>
FF3_SI = FF3<a name='9694'>
FF4_SI = FF4<a name='9695'>
FF5_SI = FF5<a name='9696'>
<a name='9697'>
pres_SI = pres<a name='9698'>
rhoa_SI = rhoa<a name='9699'>
<a name='9700'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='9701'></font>
endif<a name='9702'>
<a name='9703'>
<a name='9704'>
<font color=#447700>!=============================================================<a name='9705'></font>
<font color=#447700>!       INITIALISATION<a name='9706'></font>
<font color=#447700>!=============================================================<a name='9707'></font>
<font color=#447700>!<a name='9708'></font>
V2_SI(:,:) = VTC_SI(:,:)<a name='9709'>
V3_SI(:) = VTS_SI(:)<a name='9710'>
V4_SI(:) = VTG_SI(:)<a name='9711'>
V5_SI(:) = VTH_SI(:)<a name='9712'>
<a name='9713'>
ee = QQV*pres_SI/(EPS + QQV)<a name='9714'>
<a name='9715'>
es_zero = 611.21D0<a name='9716'>
<a name='9717'>
if(pres_SI &gt; 200000.D0.or.pres_SI &lt; 10000.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_811">("fatal error in module_mp_full_sbm (PSI is wrong), model stop")<a name='9718'>
<a name='9719'>
D_V=0.211D0*((TIN/273.15D0)**1.94D0)*(101325.D0/pres_SI)/1.D4<a name='9720'>
<a name='9721'>
<font color=#447700>! D_V = 2.21D-5<a name='9722'></font>
<font color=#447700>! FK_a = 2.40D-2<a name='9723'></font>
<a name='9724'>
FK_a =(5.69D0+0.017D0*(TIN-273.15D0))*1.0D-3*4.187D0<a name='9725'>
<a name='9726'>
<font color=#447700>! XLV = 2.50D6<a name='9727'></font>
<font color=#447700>! XLF = 2.83D6 - XLV<a name='9728'></font>
<a name='9729'>
<font color=#447700>! The expressions for latent heats used by R&amp;H, 1987,<a name='9730'></font>
<font color=#447700>! seem more applicable to<a name='9731'></font>
<font color=#447700>! T &gt; 0degC than<a name='9732'></font>
<font color=#447700>! those by P &amp; K 1997, and more modern<a name='9733'></font>
<a name='9734'>
<font color=#447700>! XLV=597.3D0*((273.15D0/TIN)**(0.167D0+3.67D-4*TIN))<a name='9735'></font>
<a name='9736'>
XLV = 597.3D0<a name='9737'>
XLV = XLV*FJOULES_IN_A_CAL*1000.D0<a name='9738'>
XLS = 2.83D6<a name='9739'>
<a name='9740'>
<font color=#447700>!XLF=79.7+0.485D0*(TIN-273.15D0)-2.5D-3*(TIN-273.15D0)*(TIN-273.15D0)<a name='9741'></font>
<a name='9742'>
XLF = 79.7D0<a name='9743'>
XLF = XLF*FJOULES_IN_A_CAL*1000.D0<a name='9744'>
<a name='9745'>
<font color=#447700>! FNSC=0.632D0<a name='9746'></font>
<a name='9747'>
etaa = (1.718D0 + 0.0049D0*(TIN-273.15D0) - &amp;<a name='9748'>
        1.2D-5*(TIN-273.15D0)*(TIN-273.15D0))*1.D-5<a name='9749'>
<a name='9750'>
<font color=#447700>! etaa/rhoa_SI = kinematic viscosity<a name='9751'></font>
<a name='9752'>
FNSC = etaa/(rhoa_SI*D_V)<a name='9753'>
<a name='9754'>
<font color=#447700>! FNPR=0.71D0<a name='9755'></font>
<a name='9756'>
ALPHA_H = FK_a/(CP*rhoa_SI)<a name='9757'>
FNPR = etaa/(rhoa_SI*ALPHA_H)<a name='9758'>
RHO_CRIT = 910.D0<a name='9759'>
<a name='9760'>
<font color=#447700>!if(IPRINTING==1) print *, &amp;<a name='9761'></font>
<font color=#447700>!                'FNSC,FNPR,XLF,XLV = ', FNSC, FNPR, XLF, XLV<a name='9762'></font>
<a name='9763'>
if(rhoa_SI &gt; 2.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_812">("fatal error in module_mp_full_sbm (rhoa_SI&gt;2), model stop 111")<a name='9764'>
<a name='9765'>
if(rhoa_SI &lt; 0.1D0) then<a name='9766'>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_813">("fatal error in module_mp_full_sbm (rhoa_SI&lt;0.1), model stop 112")<a name='9767'>
endif<a name='9768'>
<a name='9769'>
if(RHO_H_SI(1) &lt; 1.D0) then<a name='9770'>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_814">("fatal error in module_mp_full_sbm (RHO_H_SI(1) &lt; 1.D0kg/m3), model stop 113")<a name='9771'>
endif<a name='9772'>
<a name='9773'>
<a name='9774'>
<font color=#447700>! new changes 23.08.04                                        (start)<a name='9775'></font>
<a name='9776'>
TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_1">(ee, TIN, XLS*D_V/(FK_a*RV), 1.D0, XLS, RV)<a name='9777'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='9778'>
<a name='9779'>
<font color=#447700>! new changes 23.08.04                                          (end)<a name='9780'></font>
      <a name='9781'>
<font color=#447700>!=============================================================<a name='9782'></font>
<font color=#447700>!       CRYSTALS<a name='9783'></font>
<font color=#447700>!=============================================================<a name='9784'></font>
<a name='9785'>
<a name='9786'>
DO I = 1, ICEMAX<a name='9787'>
<a name='9788'>
   I_MELT=I<a name='9789'>
<a name='9790'>
DO IK = 1, NKR<a name='9791'>
<a name='9792'>
   IK_MELT=IK<a name='9793'>
<a name='9794'>
if(TIN &gt; 273.15D0) then<a name='9795'>
<a name='9796'>
IF(FLIQFR_I(IK,I).GE.1.D0.OR.FF2_SI(IK,I).LE.PETIT_PARAMETRE.OR. &amp;<a name='9797'>
TIN &lt;= 273.15D0) THEN<a name='9798'>
  IF(FLIQFR_I(IK,I) &gt; 1.D0) FLIQFR_I(IK,I) = 1.D0<a name='9799'>
  CYCLE<a name='9800'>
ENDIF<a name='9801'>
<a name='9802'>
rho_p=RHO_I_SI(IK,I)+FLIQFR_I(IK,I)*(RHO_WATER-RHO_I_SI(IK,I))<a name='9803'>
fm_i = XI_SI(IK,I)*(1.D0 - FLIQFR_I(IK,I))<a name='9804'>
fm_w = XI_SI(IK,I)*FLIQFR_I(IK,I)<a name='9805'>
V_p = (fm_i+fm_w)/rho_p<a name='9806'>
V_i = V_p<a name='9807'>
rhoi = fm_i/V_i<a name='9808'>
<a name='9809'>
<font color=#447700>! COLUMN (Heymsfield 1972) AR = 2 to 5<a name='9810'></font>
<a name='9811'>
IF(I.eq.1) then<a name='9812'>
<a name='9813'>
  AR_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_AR'>column_AR</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLUMN_AR_1">(XI_SI(IK,I), RHO_I_SI(IK,I))<a name='9814'>
  AR_i = AR_izero + FLIQFR_I(IK,I)*(1.D0 - AR_izero)<a name='9815'>
  if(AR_i &lt; AR_LIM) AR_i = AR_LIM<a name='9816'>
  CAP_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_CAP_ZERO'>COLUMN_CAP_ZERO</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLUMN_CAP_ZERO_1">(fm_i, AR_i, rhoi, FL_star)<a name='9817'>
<a name='9818'>
  vt_R = VTL_SI(IK)<a name='9819'>
  vt_start = VTC_SI(IK,I)<a name='9820'>
  vt = vt_start + (vt_R - vt_start) * chi_fra(fm_w/(fm_i+fm_w))<a name='9821'>
<a name='9822'>
  fnre = vt *FL_star*rhoa_SI/etaa<a name='9823'>
  fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_VENTILATION_COEF'>COLUMN_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLUMN_VENTILATION_COEF_1">(fnre, FNSC)<a name='9824'>
<a name='9825'>
<font color=#447700>! in case I.eq.1<a name='9826'></font>
endif<a name='9827'>
<a name='9828'>
<font color=#447700>! PLATE C1g type (see P1a in p52 in P&amp;K)<a name='9829'></font>
<a name='9830'>
IF(I.eq.2) then<a name='9831'>
<a name='9832'>
  AR_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#PLATE_AR'>PLATE_AR</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PLATE_AR_1">(XI_SI(IK,I))<a name='9833'>
  AR_i = AR_izero + FLIQFR_I(IK,I)*(1.D0 - AR_izero)<a name='9834'>
  if(AR_i &gt; 1.D0/AR_LIM) AR_i = 1.D0/AR_LIM<a name='9835'>
<a name='9836'>
  CAP_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO'>PLANAR_CAP_ZERO</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PLANAR_CAP_ZERO_1">(fm_i, AR_i, rhoi, FL_star)<a name='9837'>
<a name='9838'>
  vt_R = VTL_SI(IK)<a name='9839'>
  vt_start = VTC_SI(IK,I)<a name='9840'>
  vt = vt_start + (vt_R - vt_start) * chi_fra(fm_w/(fm_i+fm_w))<a name='9841'>
<a name='9842'>
  fnre = vt * FL_star*rhoa_SI/etaa<a name='9843'>
  fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#PLATE_VENTILATION_COEF'>PLATE_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PLATE_VENTILATION_COEF_1">(fnre, FNSC)<a name='9844'>
<a name='9845'>
<font color=#447700>! in case I.eq.2<a name='9846'></font>
endif<a name='9847'>
<a name='9848'>
<font color=#447700>! DENDRITES P1c type (see P1c in p52 in P&amp;K)<a name='9849'></font>
<a name='9850'>
IF(I.eq.3) then<a name='9851'>
<a name='9852'>
  AR_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#DENDRITE_AR'>DENDRITE_AR</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DENDRITE_AR_1">(XI_SI(IK,I))<a name='9853'>
  AR_i = AR_izero + FLIQFR_I(IK,I)*(1.D0 - AR_izero)<a name='9854'>
  if(AR_i &gt; 1./AR_LIM) AR_i = 1.D0/AR_LIM<a name='9855'>
<a name='9856'>
  CAP_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO'>PLANAR_CAP_ZERO</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PLANAR_CAP_ZERO_2">(fm_i, AR_i, rhoi, FL_star)<a name='9857'>
<a name='9858'>
        vt_R = VTL_SI(IK)<a name='9859'>
        vt_start = VTC_SI(IK,I)<a name='9860'>
        vt = vt_start + (vt_R - vt_start) * chi_fra(fm_w/(fm_i+fm_w))<a name='9861'>
<a name='9862'>
        fnre = vt * FL_star*rhoa_SI/etaa<a name='9863'>
        fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#DENDRITE_VENTILATION_COEF'>DENDRITE_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DENDRITE_VENTILATION_COEF_1">(fnre, FNSC)<a name='9864'>
<a name='9865'>
<font color=#447700>! in case I.eq.3<a name='9866'></font>
endif<a name='9867'>
<a name='9868'>
<font color=#447700>! CAP = V**(1./3.)<a name='9869'></font>
<a name='9870'>
V2_SI(IK,I) = vt<a name='9871'>
CAP = CAP_izero*(0.8D0 + FLIQFR_I(IK,I)*0.2D0)<a name='9872'>
<a name='9873'>
FICEMASS = XI_SI(IK,I) * (1.D0 - FLIQFR_I(IK,I))<a name='9874'>
DMELT = DT * ( 4.D0*PI*CAP*fv/XLF) * &amp;<a name='9875'>
(FK_a*(TIN - 273.15D0) + (D_V*XLV/RV) * &amp;<a name='9876'>
(ee/TIN - es_zero/273.15D0))<a name='9877'>
<a name='9878'>
<font color=#447700>! new changes 23.08.04                                        (start)<a name='9879'></font>
<a name='9880'>
if(TS &lt; 273.15D0 .and. FLIQFR_I(IK,I) &lt;= 0.D0) DMELT = 0.D0<a name='9881'>
<a name='9882'>
<font color=#447700>! new changes 23.08.04                                          (end)<a name='9883'></font>
<a name='9884'>
call <A href='../../html_code/phys/module_mp_full_sbm.F.html#FMASS_LIMITS'>fmass_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FMASS_LIMITS_1">(DMELT, FICEMASS, fm_w, XI_SI(IK,I))<a name='9885'>
<a name='9886'>
if(ITEMP_ADJUST == 1) then<a name='9887'>
<a name='9888'>
  call <A href='../../html_code/phys/module_mp_full_sbm.F.html#THERMODYNAMICAL_LIMITS'>thermodynamical_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="THERMODYNAMICAL_LIMITS_1"> &amp;<a name='9889'>
 (FF2_SI(IK,I), XI_SI(IK,I), rhoa_SI, XLF/CP, TIN, DMELT)<a name='9890'>
<a name='9891'>
<a name='9892'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='9893'></font>
<a name='9894'>
endif<a name='9895'>
<a name='9896'>
FICEMASS = FICEMASS - DMELT<a name='9897'>
<a name='9898'>
<font color=#447700>! DMELT &gt; 0 for melting<a name='9899'></font>
<a name='9900'>
FLIQFR_I(IK,I) = (XI_SI(IK,I) - FICEMASS)/XI_SI(IK,I)<a name='9901'>
<a name='9902'>
if(FLIQFR_I(IK,I) &lt; 0.D0) FLIQFR_I(IK,I) = 0.D0<a name='9903'>
<a name='9904'>
if(FLIQFR_I(IK,I) &gt; 0.D0) then<a name='9905'>
<a name='9906'>
  if(IEVAP_ADJUST == 1 ) then<a name='9907'>
<a name='9908'>
    if(FLIQFR_I(IK,I) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_815">("fatal error in module_mp_full_sbm (FLIQFR_I &gt; 1), model stop 114")<a name='9909'>
<a name='9910'>
<font color=#447700>! HEAT_EVAP = Joules of latent heat absorbed (released) <a name='9911'></font>
<font color=#447700>! by FMASS_EVAP, kg<a name='9912'></font>
<font color=#447700>! of water evaporating (condensation)<a name='9913'></font>
<font color=#447700>! Q_EVAP = the gain of vapour mixing ratio (kg/kg) from evaporation<a name='9914'></font>
<a name='9915'>
    HEAT_EVAP=-DMELT*XLF+DT*(4.D0*PI*CAP*fv)*FK_a*(TIN-273.15D0)<a name='9916'>
<a name='9917'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='9918'></font>
<a name='9919'>
    IF(HEAT_EVAP.LT.0.D0) THEN<a name='9920'>
<a name='9921'>
<font color=#447700>!      PRINT*, 'HEAT_EVAP &lt; 0'<a name='9922'></font>
<a name='9923'>
<font color=#447700>!      PRINT*, 'CRYSTAL'<a name='9924'></font>
<a name='9925'>
<font color=#447700>!      PRINT*, 'I_MELT' <a name='9926'></font>
<font color=#447700>!      PRINT*,  I_MELT <a name='9927'></font>
      <a name='9928'>
<font color=#447700>!      PRINT*, 'IJK,KX,KZ,IK'<a name='9929'></font>
<font color=#447700>!      PRINT*,  IJK,KX,KZ,IK_MELT<a name='9930'></font>
<a name='9931'>
<font color=#447700>!      HEAT_EVAP=0.D0<a name='9932'></font>
<a name='9933'>
<a name='9934'>
<font color=#447700>! in case HEAT_EVAP.LT.0.D0<a name='9935'></font>
<a name='9936'>
    ENDIF<a name='9937'>
    <a name='9938'>
<font color=#447700>! new changes 24.08.04                                          (end)<a name='9939'></font>
<a name='9940'>
    FMASS_EVAP = HEAT_EVAP/XLV<a name='9941'>
<a name='9942'>
    if(FMASS_EVAP &gt; FLIQFR_I(IK,I) * XI_SI(IK,I)) then<a name='9943'>
      FMASS_EVAP = FLIQFR_I(IK,I) * XI_SI(IK,I)<a name='9944'>
    endif<a name='9945'>
<a name='9946'>
    Q_EVAP=FMASS_EVAP*FF2_SI(IK,I)*XI_SI(IK,I)*3.D0*COL/rhoa_SI<a name='9947'>
<a name='9948'>
<a name='9949'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER'>EVAP_MELTWATER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EVAP_MELTWATER_1"> &amp;<a name='9950'>
   (XI_SI(IK,I),rhoa_SI,Q_EVAP,FLIQFR_I(IK,I),FF2_SI(IK,I))<a name='9951'>
<a name='9952'>
   XI_MELT_SI(IK,I)=XX_MELT<a name='9953'>
<a name='9954'>
<font color=#447700>! I assume that, during the period before the RH-dependent onset<a name='9955'></font>
<font color=#447700>! of melting is reached, the loss of mass of water<a name='9956'></font>
<font color=#447700>! by evaporation is as negligible as the source of mass<a name='9957'></font>
<font color=#447700>! of meltwater from melting itself<a name='9958'></font>
<font color=#447700>!(see Rasmussen and Pruppacher 1982; P &amp; K 1997)<a name='9959'></font>
<a name='9960'>
    TIN=TIN-XLV/CP*Q_EVAP<a name='9961'>
<a name='9962'>
    QQV=QQV+Q_EVAP<a name='9963'>
<a name='9964'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='9965'></font>
<a name='9966'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='9967'>
<a name='9968'>
<font color=#447700>! new changes 24.08.04                                          (end)<a name='9969'></font>
<a name='9970'>
    if(QQV &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_816">("fatal error in module_mp_full_sbm , model stop 135")<a name='9971'>
    if(TIN &lt; 150.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_817">("fatal error in module_mp_full_sbm , model stop 138")<a name='9972'>
<a name='9973'>
<font color=#447700>! in case IEVAP_ADJUST == 1<a name='9974'></font>
  endif<a name='9975'>
<a name='9976'>
<font color=#447700>! in case FLIQFR_I(IK,I) &gt; 0.D0<a name='9977'></font>
<a name='9978'>
else<a name='9979'>
<a name='9980'>
<font color=#447700>! in case FLIQFR_I(IK,I).LE.0.D0<a name='9981'></font>
<a name='9982'>
  if(ISUBLIME_ADJUST == 1 ) then<a name='9983'>
<a name='9984'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='9985'></font>
<a name='9986'>
    if(TS &gt; 273.16) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_818">("fatal error in module_mp_full_sbm , model stop 13655")<a name='9987'>
    sub_fac = (XLS/(RV*TIN) - 1.D0)*XLS/(FK_a * TIN)<a name='9988'>
    sub_fac = sub_fac + RV*TIN/((100.D0*GGESI(TS))*D_V)<a name='9989'>
    DSUB = -DT*4.D0*PI*CAP*fv*(ee/(100.D0*GGESI(TS)) - 1.D0)/sub_fac<a name='9990'>
<a name='9991'>
<font color=#447700>! new changes 24.08.04                                          (end)<a name='9992'></font>
<a name='9993'>
    if(DSUB &gt;  XI_SI(IK,I)) then<a name='9994'>
      DSUB = XI_SI(IK,I)<a name='9995'>
    endif<a name='9996'>
<a name='9997'>
    Q_SUBL = DSUB*FF2_SI(IK,I)*XI_SI(IK,I)*3.D0*COL/rhoa_SI<a name='9998'>
<a name='9999'>
<a name='10000'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE'>SUBLIME_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUBLIME_ICE_1"> &amp;<a name='10001'>
   (XI_SI(IK,I),rhoa_SI,Q_SUBL,FF2_SI(IK,I))<a name='10002'>
<a name='10003'>
    XI_MELT_SI(IK,I)=XX_MELT<a name='10004'>
<a name='10005'>
    TIN=TIN-XLS/CP*Q_SUBL<a name='10006'>
    QQV=QQV+Q_SUBL<a name='10007'>
<a name='10008'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='10009'></font>
<a name='10010'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10011'>
<a name='10012'>
<font color=#447700>! new changes 24.08.04                                          (end)<a name='10013'></font>
<a name='10014'>
    if(QQV &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_819">("fatal error in module_mp_full_sbm (QQV &lt; 0), model stop ")<a name='10015'>
    if(TIN &lt; 150.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_820">("fatal error in module_mp_full_sbm ( TIN &lt; 150) , model stop ")<a name='10016'>
<a name='10017'>
<a name='10018'>
<font color=#447700>! in case ISUBLIME_ADJUST == 1<a name='10019'></font>
  endif<a name='10020'>
<a name='10021'>
<font color=#447700>! in case FLIQFR_I(IK,I).LE.0.D0<a name='10022'></font>
endif<a name='10023'>
<a name='10024'>
if(FLIQFR_I(IK,I) &lt; 0.D0) then<a name='10025'>
  FLIQFR_I(IK,I) = 0.D0<a name='10026'>
endif<a name='10027'>
<a name='10028'>
IF(FLIQFR_I(IK,I) &gt; FLIQFRAC_LIM) then<a name='10029'>
<a name='10030'>
  if(XL_SI(IK).NE.XI_SI(IK,I)) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_821">("fatal error in module_mp_full_sbm (QQV &lt; 0), model stop 7011")<a name='10031'>
<a name='10032'>
  if(ITEMP_ADJUST == 1) then<a name='10033'>
<a name='10034'>
<a name='10035'>
    Q_ICE_MELTED= &amp;<a name='10036'>
    FICEMASS*FF2_SI(IK,I)*XI_SI(IK,I)*3.D0*COL/rhoa_SI<a name='10037'>
<a name='10038'>
    TIN=TIN-XLF/CP*Q_ICE_MELTED<a name='10039'>
<a name='10040'>
<a name='10041'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10042'></font>
  endif<a name='10043'>
<a name='10044'>
  FF1_SI(IK) = FF1_SI(IK) + FF2_SI(IK,I)<a name='10045'>
<a name='10046'>
<font color=#447700>!  FLIQFR_I(IK,I) = 0.<a name='10047'></font>
<a name='10048'>
  FLIQFR_I(IK,I) = 1.D0<a name='10049'>
<a name='10050'>
  FF2_SI(IK,I) = 0.D0<a name='10051'>
<a name='10052'>
<font color=#447700>! in case FLIQFR_I(IK,I) &gt; FLIQFRAC_LIM<a name='10053'></font>
<a name='10054'>
ENDIF<a name='10055'>
<a name='10056'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='10057'></font>
<a name='10058'>
endif<a name='10059'>
<a name='10060'>
ENDDO<a name='10061'>
<font color=#447700>! cycle by IK<a name='10062'></font>
<a name='10063'>
ENDDO<a name='10064'>
<font color=#447700>! cycle by I<a name='10065'></font>
<a name='10066'>
<font color=#447700>!=============================================================<a name='10067'></font>
<font color=#447700>!       SNOW<a name='10068'></font>
<font color=#447700>!=============================================================<a name='10069'></font>
<a name='10070'>
<a name='10071'>
DO IK = 1, NKR<a name='10072'>
<a name='10073'>
   IK_MELT=IK<a name='10074'>
   I_MELT=0<a name='10075'>
<a name='10076'>
if(TIN &gt; 273.15D0) then<a name='10077'>
<a name='10078'>
IF(FLIQFR_S(IK).GE.1.D0.OR.FF3_SI(IK).LE.PETIT_PARAMETRE.OR. &amp;<a name='10079'>
TIN &lt;= 273.15D0) THEN<a name='10080'>
  IF(FLIQFR_S(IK) &gt; 1.D0) FLIQFR_S(IK) = 1.D0<a name='10081'>
CYCLE<a name='10082'>
ENDIF<a name='10083'>
<a name='10084'>
rho_p = RHO_S_SI(IK) + FLIQFR_S(IK)* &amp;<a name='10085'>
       (RHO_WATER - RHO_S_SI(IK))<a name='10086'>
<a name='10087'>
fm_i = XS_SI(IK)*(1.D0 - FLIQFR_S(IK))<a name='10088'>
fm_w = XS_SI(IK)*FLIQFR_S(IK)<a name='10089'>
V_p = (fm_i + fm_w)/rho_p<a name='10090'>
V_i = V_p<a name='10091'>
rhoi = fm_i/V_i<a name='10092'>
<font color=#447700>!<a name='10093'></font>
<font color=#447700>! Based on Mitra et al. (1990)/Matsuo and Sasyo (1981)<a name='10094'></font>
<font color=#447700>! V_p = (4/3) PI AR a_i**3<a name='10095'></font>
<font color=#447700>!<a name='10096'></font>
<font color=#447700>! ASSUME:- (1) snowflakes have an ice skeleton structure that<a name='10097'></font>
<font color=#447700>! is incollapsable,<a name='10098'></font>
<font color=#447700>! but of varing AR, until completion of melting;<a name='10099'></font>
<font color=#447700>! (2) melting occurs only at snowflake exterior surface and water<a name='10100'></font>
<font color=#447700>! then penetrates inside<a name='10101'></font>
<font color=#447700>!<a name='10102'></font>
<font color=#447700>! fm_i in the text of Mitra et al is the mass of the ice component<a name='10103'></font>
<font color=#447700>! a_i (b_i) are the major (minor) axes of the ice skeleton<a name='10104'></font>
<font color=#447700>! AR = b_i/a_i<a name='10105'></font>
<a name='10106'>
AR_p = 0.3D0 + 0.7D0 * FLIQFR_S(IK)<a name='10107'>
<a name='10108'>
<font color=#447700>! new change 26.07.04                                         (start)<a name='10109'></font>
<a name='10110'>
<font color=#447700>! the rest of the HUCM seems to assume that snow is spherical <a name='10111'></font>
<font color=#447700>!(see JERRATE)<a name='10112'></font>
<font color=#447700>! AR_p = 1.<a name='10113'></font>
<a name='10114'>
<font color=#447700>! new change 26.07.04                                           (end)<a name='10115'></font>
<a name='10116'>
AR_i = AR_p<a name='10117'>
<a name='10118'>
CAP_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO'>PLANAR_CAP_ZERO</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PLANAR_CAP_ZERO_3">(fm_i, AR_i, rhoi, FL_star)<a name='10119'>
CAP = CAP_izero*(0.8D0 + FLIQFR_S(IK)*0.2D0)<a name='10120'>
<a name='10121'>
vt_R = VTL_SI(IK)<a name='10122'>
vt_start = VTS_SI(IK)<a name='10123'>
vt = vt_start + (vt_R - vt_start) * chi_fra(fm_w/(fm_i+fm_w))<a name='10124'>
fnre = FL_star * vt*rhoa_SI/etaa<a name='10125'>
<a name='10126'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10127'></font>
<a name='10128'>
fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SNOW_VENTILATION_COEF'>SNOW_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SNOW_VENTILATION_COEF_1">(fnre, FNSC, AR_i)<a name='10129'>
<a name='10130'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10131'></font>
<a name='10132'>
V3_SI(IK) = vt<a name='10133'>
<a name='10134'>
FICEMASS = XS_SI(IK) * (1.D0 - FLIQFR_S(IK))<a name='10135'>
<a name='10136'>
DMELT = DT * ( 4.D0*PI*CAP*fv/XLF) * &amp;<a name='10137'>
(FK_a*(TIN - 273.15D0) + (D_V*XLV/RV) * &amp;<a name='10138'>
(ee/TIN - es_zero/273.15D0))<a name='10139'>
<a name='10140'>
<font color=#447700>! new change 24.08.04                                         (start) <a name='10141'></font>
<a name='10142'>
if(TS &lt; 273.15D0 .and. FLIQFR_S(IK) &lt;= 0.D0) DMELT = 0.D0<a name='10143'>
<a name='10144'>
<font color=#447700>! new change 24.08.04                                           (end) <a name='10145'></font>
<a name='10146'>
call <A href='../../html_code/phys/module_mp_full_sbm.F.html#FMASS_LIMITS'>fmass_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FMASS_LIMITS_2">(DMELT, FICEMASS, fm_w, XS_SI(IK))<a name='10147'>
<a name='10148'>
if(ITEMP_ADJUST == 1) then<a name='10149'>
<a name='10150'>
<a name='10151'>
  call <A href='../../html_code/phys/module_mp_full_sbm.F.html#THERMODYNAMICAL_LIMITS'>thermodynamical_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="THERMODYNAMICAL_LIMITS_2"> &amp;<a name='10152'>
 (FF3_SI(IK), XS_SI(IK), rhoa_SI, XLF/CP, TIN, DMELT)<a name='10153'>
<a name='10154'>
<a name='10155'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10156'></font>
endif<a name='10157'>
<a name='10158'>
FICEMASS = FICEMASS - DMELT<a name='10159'>
<a name='10160'>
FLIQFR_S(IK) = (XS_SI(IK) - FICEMASS)/XS_SI(IK)<a name='10161'>
<a name='10162'>
if(FLIQFR_S(IK) &lt; 0.D0) then<a name='10163'>
  FLIQFR_S(IK) = 0.D0<a name='10164'>
endif<a name='10165'>
<a name='10166'>
if(FLIQFR_S(IK) &gt; 0.D0) then<a name='10167'>
<a name='10168'>
  if(IEVAP_ADJUST == 1) then<a name='10169'>
<a name='10170'>
    if(FLIQFR_S(IK) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_822">("fatal error in module_mp_full_sbm , model stop 905")<a name='10171'>
<a name='10172'>
<font color=#447700>! HEAT_EVAP = Joules of latent heat absorbed by FMASS_EVAP kg<a name='10173'></font>
<font color=#447700>! of water evaporating<a name='10174'></font>
<font color=#447700>! Q_EVAP = the gain of vapour mixing ratio (kg/kg) from evaporation<a name='10175'></font>
<a name='10176'>
    HEAT_EVAP=-DMELT*XLF+ DT*(4.D0*PI*CAP*fv)*FK_a*(TIN-273.15D0)<a name='10177'>
<a name='10178'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10179'></font>
<a name='10180'>
    IF(HEAT_EVAP.LT.0.D0) THEN<a name='10181'>
      <a name='10182'>
<font color=#447700>!      PRINT*, 'HEAT_EVAP &lt; 0'<a name='10183'></font>
<a name='10184'>
<font color=#447700>!      PRINT*, 'SNOW'<a name='10185'></font>
<a name='10186'>
<font color=#447700>!      PRINT*, 'IJK,KX,KZ,IK'<a name='10187'></font>
<font color=#447700>!      PRINT*,  IJK,KX,KZ,IK_MELT<a name='10188'></font>
 <a name='10189'>
<font color=#447700>!      HEAT_EVAP=0.D0<a name='10190'></font>
<a name='10191'>
<a name='10192'>
    ENDIF<a name='10193'>
    <a name='10194'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10195'></font>
<a name='10196'>
    FMASS_EVAP = HEAT_EVAP/XLV<a name='10197'>
<a name='10198'>
    if(FMASS_EVAP &gt; FLIQFR_S(IK) * XS_SI(IK)) then<a name='10199'>
      FMASS_EVAP = FLIQFR_S(IK) * XS_SI(IK)<a name='10200'>
    endif<a name='10201'>
<a name='10202'>
    Q_EVAP= FMASS_EVAP*FF3_SI(IK)*XS_SI(IK)*3.D0*COL/rhoa_SI<a name='10203'>
<a name='10204'>
<a name='10205'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER'>EVAP_MELTWATER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EVAP_MELTWATER_2"> &amp;<a name='10206'>
   (XS_SI(IK),rhoa_SI,Q_EVAP,FLIQFR_S(IK),FF3_SI(IK))<a name='10207'>
<a name='10208'>
    XS_MELT_SI(IK)=XX_MELT<a name='10209'>
<a name='10210'>
    TIN=TIN-XLV/CP*Q_EVAP<a name='10211'>
    QQV=QQV+Q_EVAP<a name='10212'>
<a name='10213'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10214'></font>
<a name='10215'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10216'>
<a name='10217'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10218'></font>
<a name='10219'>
    if(QQV &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_823">("fatal error in module_mp_full_sbm , model stop 915")<a name='10220'>
    if(TIN &lt; 150.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_824">("fatal error in module_mp_full_sbm , model stop 916")<a name='10221'>
<a name='10222'>
<a name='10223'>
<font color=#447700>! in case IEVAP_ADJUST == 1<a name='10224'></font>
  endif<a name='10225'>
<a name='10226'>
<font color=#447700>! in case FLIQFR_S(IK) &gt; 0.D0<a name='10227'></font>
<a name='10228'>
else<a name='10229'>
<a name='10230'>
<font color=#447700>! in case FLIQFR_S(IK).LE.0.D0<a name='10231'></font>
<a name='10232'>
  if(ISUBLIME_ADJUST == 1) then<a name='10233'>
<a name='10234'>
    sub_fac = (XLS/(RV*TIN) - 1.D0)*XLS/(FK_a * TIN)<a name='10235'>
<a name='10236'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10237'></font>
<a name='10238'>
    sub_fac = sub_fac + RV* TIN/((100.D0*GGESI(TS)) * D_V)<a name='10239'>
<a name='10240'>
    DSUB = -DT*4.D0*PI*CAP*fv*(ee/(100.D0*GGESI(TS)) - 1.D0)/sub_fac<a name='10241'>
<a name='10242'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10243'></font>
<a name='10244'>
    if(DSUB &gt;  XS_SI(IK)) then<a name='10245'>
      DSUB = XS_SI(IK)<a name='10246'>
    endif<a name='10247'>
<a name='10248'>
    Q_SUBL = DSUB*FF3_SI(IK)*XS_SI(IK)*3.D0*COL/rhoa_SI<a name='10249'>
<a name='10250'>
<a name='10251'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE'>SUBLIME_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUBLIME_ICE_2">(XS_SI(IK),rhoa_SI,Q_SUBL,FF3_SI(IK))<a name='10252'>
<a name='10253'>
    XS_MELT_SI(IK)=XX_MELT<a name='10254'>
<a name='10255'>
    TIN=TIN-XLS/CP*Q_SUBL<a name='10256'>
    QQV=QQV+Q_SUBL<a name='10257'>
<a name='10258'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10259'></font>
<a name='10260'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10261'>
<a name='10262'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10263'></font>
<a name='10264'>
    if(QQV &lt; 0.) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_825">("fatal error in module_mp_full_sbm , model stop 135")<a name='10265'>
    if(TIN &lt; 150.) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_826">("fatal error in module_mp_full_sbm , model stop 138")<a name='10266'>
<a name='10267'>
<a name='10268'>
<font color=#447700>! in case ISUBLIME_ADJUST == 1<a name='10269'></font>
  endif<a name='10270'>
<a name='10271'>
<font color=#447700>! in case FLIQFR_S(IK).LE.0.D0<a name='10272'></font>
endif<a name='10273'>
<a name='10274'>
if(FLIQFR_S(IK) &lt; 0.D0) then<a name='10275'>
        FLIQFR_S(IK) = 0.D0<a name='10276'>
endif<a name='10277'>
<a name='10278'>
IF(FLIQFR_S(IK) &gt; FLIQFRAC_LIM) then<a name='10279'>
<a name='10280'>
  if(XL_SI(IK).NE.XS_SI(IK)) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_827">("fatal error in module_mp_full_sbm , model stop 7012")<a name='10281'>
<a name='10282'>
  if(ITEMP_ADJUST == 1) then<a name='10283'>
<a name='10284'>
<a name='10285'>
    Q_ICE_MELTED=FICEMASS*FF3_SI(IK)*XS_SI(IK)*3.D0*COL/rhoa_SI<a name='10286'>
<a name='10287'>
    TIN=TIN-XLF/CP*Q_ICE_MELTED<a name='10288'>
<a name='10289'>
<a name='10290'>
<a name='10291'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10292'></font>
<a name='10293'>
  endif<a name='10294'>
<a name='10295'>
  FF1_SI(IK) = FF1_SI(IK) + FF3_SI(IK)<a name='10296'>
<a name='10297'>
<font color=#447700>!  FLIQFR_S(IK) = 0.D0<a name='10298'></font>
<a name='10299'>
  FLIQFR_S(IK) = 1.D0<a name='10300'>
<a name='10301'>
  FF3_SI(IK) = 0.D0<a name='10302'>
<a name='10303'>
<font color=#447700>! in case FLIQFR_S(IK) &gt; FLIQFRAC_LIM<a name='10304'></font>
ENDIF<a name='10305'>
<a name='10306'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='10307'></font>
endif<a name='10308'>
<a name='10309'>
ENDDO<a name='10310'>
<font color=#447700>! cycle by IK<a name='10311'></font>
<font color=#447700>!<a name='10312'></font>
<font color=#447700>!=============================================================<a name='10313'></font>
<font color=#447700>!               GRAUPEL (assumed to be spheres)<a name='10314'></font>
<font color=#447700>!=============================================================<a name='10315'></font>
<a name='10316'>
<a name='10317'>
DO IK = 1, NKR<a name='10318'>
<a name='10319'>
   IK_MELT=IK<a name='10320'>
   I_MELT=0<a name='10321'>
<a name='10322'>
if(TIN &gt; 273.15D0) then<a name='10323'>
<a name='10324'>
IF(FLIQFR_G(IK).GE.1.D0.OR.FF4_SI(IK).LE.PETIT_PARAMETRE.OR. &amp;<a name='10325'>
TIN &lt;= 273.15D0) THEN<a name='10326'>
  IF(FLIQFR_G(IK) &gt; 1.D0) FLIQFR_G(IK) = 1.D0<a name='10327'>
CYCLE<a name='10328'>
ENDIF<a name='10329'>
<font color=#447700>!<a name='10330'></font>
vt_start = 0.D0<a name='10331'>
vt_end = 0.D0<a name='10332'>
<font color=#447700>!<a name='10333'></font>
rhoi = RHO_G_SI(IK)<a name='10334'>
fm_i = XG_SI(IK)*(1.D0 - FLIQFR_G(IK))<a name='10335'>
V_i = fm_i/rhoi<a name='10336'>
fm_w = XG_SI(IK)*FLIQFR_G(IK)<a name='10337'>
V_w = fm_w/RHO_WATER<a name='10338'>
<a name='10339'>
if(rhoi &lt; RHO_CRIT) then<a name='10340'>
  V_soakable = V_i - fm_i/RHO_ICE<a name='10341'>
else<a name='10342'>
  V_soakable = 0.D0<a name='10343'>
endif<a name='10344'>
<a name='10345'>
a_i = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_1">(V_i)<a name='10346'>
a_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_2">(XG_SI(IK)/rhoi)<a name='10347'>
fnre_dry = VTG_SI(IK) * 2.D0*rhoa_SI*a_izero/etaa<a name='10348'>
<a name='10349'>
<font color=#447700>! FIND RE (ie. CD) OF SMOOTH SPHERE OF SAME MASS<a name='10350'></font>
<font color=#447700>!(fnre_smooth is invariant during melting)<a name='10351'></font>
<a name='10352'>
X_Best = 8.D0 * XG_SI(IK) * rhoa_SI * GRAV / (PI * etaa * etaa)<a name='10353'>
fnre_smooth = <A href='../../html_code/phys/module_mp_full_sbm.F.html#FNRE_SPHERE'>fnre_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FNRE_SPHERE_1">(X_Best)<a name='10354'>
<a name='10355'>
if(V_w &lt; V_soakable) then<a name='10356'>
<a name='10357'>
  a_d = a_i<a name='10358'>
  vt=VT_LOW_DENSITY_SOAKING &amp;<a name='10359'>
    (fnre_dry,fnre_smooth,VTG_SI(IK),a_i,a_izero,etaa,rhoa_SI)<a name='10360'>
<a name='10361'>
<font color=#447700>! in case V_w &lt; V_soakable<a name='10362'></font>
<a name='10363'>
else<a name='10364'>
<a name='10365'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='10366'></font>
<a name='10367'>
  a_d = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_3">(V_i + (V_w - V_soakable))<a name='10368'>
  fm_w_soaked = RHO_WATER* V_soakable<a name='10369'>
  fm_w_crit = (0.268D0 + (fm_i + fm_w_soaked) * 1.D3 * 0.1389D0)<a name='10370'>
  fm_w_crit = fm_w_crit* 1.D-3<a name='10371'>
  a_crit = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_4">(V_i + fm_w_crit/RHO_WATER)<a name='10372'>
<a name='10373'>
  if(rhoi &lt; RHO_CRIT) then<a name='10374'>
    vt_start = VT_LOW_DENSITY_TRANS &amp;<a name='10375'>
              (fnre_dry, fnre_smooth, &amp;<a name='10376'>
               VTG_SI(IK),a_izero,etaa,rhoa_SI,rhoi,XG_SI(IK))<a name='10377'>
  else<a name='10378'>
    vt_start=VT_HIGH_DENSITY_TRANS &amp;<a name='10379'>
            (fnre_dry,fnre_smooth,VTG_SI(IK),a_izero,etaa,rhoa_SI)<a name='10380'>
  endif<a name='10381'>
<a name='10382'>
  vt_end=equilibrium_fallspeed &amp;<a name='10383'>
        (fm_i+fm_w_soaked,fm_w_crit, &amp;<a name='10384'>
         XG(:),VTL_SI(:),rhoa_SI,etaa,a_crit)<a name='10385'>
<a name='10386'>
  frac_eqm=(fm_w-fm_w_soaked)/fm_w_crit<a name='10387'>
<a name='10388'>
  if(frac_eqm &lt; 0.D0) frac_eqm = 0.D0<a name='10389'>
  if(frac_eqm &gt; 1.D0) frac_eqm = 1.D0<a name='10390'>
<a name='10391'>
  vt = vt_start + (vt_end - vt_start) * frac_eqm<a name='10392'>
<a name='10393'>
  if(vt &lt; 0.D0) vt = 0.D0<a name='10394'>
<a name='10395'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='10396'></font>
<a name='10397'>
endif<a name='10398'>
<a name='10399'>
<font color=#447700>! new changes 23.01.08                                        (start)<a name='10400'></font>
<a name='10401'>
<font color=#447700>! new changes 3.02.08                                         (start)<a name='10402'></font>
<a name='10403'>
if(ivt_G_H_interpol.ne.0) then<a name='10404'>
<a name='10405'>
  vt=VTG_SI(IK)+FLIQFR_G(IK)*(VTL_SI(IK) - VTG_SI(IK))<a name='10406'>
<a name='10407'>
endif<a name='10408'>
<a name='10409'>
<font color=#447700>! new changes 3.02.08                                          (end)<a name='10410'></font>
<a name='10411'>
<font color=#447700>! new changes 23.01.08                                          (end)<a name='10412'></font>
<a name='10413'>
V4_SI(IK) = vt<a name='10414'>
<a name='10415'>
fnre = vt * (2.D0 * a_d * rhoa_SI)/etaa<a name='10416'>
<a name='10417'>
<font color=#447700>! new change 5.02.07                                          (start)<a name='10418'></font>
<a name='10419'>
fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_1">(fnre,FNSC,IK)<a name='10420'>
fh = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_2">(fnre,FNPR,IK)<a name='10421'>
<a name='10422'>
<font color=#447700>! new change 5.02.07                                            (end)<a name='10423'></font>
<a name='10424'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10425'></font>
<a name='10426'>
if(FLIQFR_G(IK) &lt;= 0.D0) then<a name='10427'>
  TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_2">(ee, TIN, XLS*D_V/(FK_a*RV), fv/fh, XLS, RV)<a name='10428'>
else<a name='10429'>
  TS = 273.15D0<a name='10430'>
endif<a name='10431'>
<a name='10432'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='10433'>
<a name='10434'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10435'></font>
<a name='10436'>
if(fnre &lt; 6000.D0) then<a name='10437'>
  CAP = a_d<a name='10438'>
else<a name='10439'>
  CAP = a_i<a name='10440'>
endif<a name='10441'>
<a name='10442'>
FICEMASS = XG_SI(IK) * (1.D0 - FLIQFR_G(IK))<a name='10443'>
<a name='10444'>
DMELT = DT*(4.D0*PI*CAP/XLF) * &amp;<a name='10445'>
(FK_a*(TIN-273.15D0)*fh+(D_V*XLV/RV)*fv*(ee/TIN - es_zero/273.15D0))<a name='10446'>
<a name='10447'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10448'></font>
<a name='10449'>
if(TS &lt; 273.15D0 .and. FLIQFR_G(IK) &lt;= 0.) DMELT = 0.D0<a name='10450'>
<a name='10451'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10452'></font>
<a name='10453'>
<a name='10454'>
call <A href='../../html_code/phys/module_mp_full_sbm.F.html#FMASS_LIMITS'>fmass_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FMASS_LIMITS_3">(DMELT, FICEMASS, fm_w, XG_SI(IK))<a name='10455'>
<a name='10456'>
if(ITEMP_ADJUST == 1) then<a name='10457'>
<a name='10458'>
<a name='10459'>
  call <A href='../../html_code/phys/module_mp_full_sbm.F.html#THERMODYNAMICAL_LIMITS'>thermodynamical_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="THERMODYNAMICAL_LIMITS_3"> &amp;<a name='10460'>
 (FF4_SI(IK), XG_SI(IK), rhoa_SI, XLF/CP, TIN, DMELT)<a name='10461'>
<a name='10462'>
<a name='10463'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10464'></font>
<a name='10465'>
endif<a name='10466'>
<a name='10467'>
FICEMASS = FICEMASS - DMELT<a name='10468'>
<a name='10469'>
FLIQFR_G(IK) = (XG_SI(IK) - FICEMASS)/XG_SI(IK)<a name='10470'>
<a name='10471'>
if(FLIQFR_G(IK) &lt; 0.D0) then<a name='10472'>
  FLIQFR_G(IK) = 0.D0<a name='10473'>
endif<a name='10474'>
<a name='10475'>
if(FLIQFR_G(IK) &gt; 0.D0) then<a name='10476'>
<a name='10477'>
  if(IEVAP_ADJUST == 1) then<a name='10478'>
<a name='10479'>
    if(FLIQFR_G(IK) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_828">("fatal error in module_mp_full_sbm , model stop 901")<a name='10480'>
<a name='10481'>
<font color=#447700>! HEAT_EVAP = Joules of latent heat absorbed by FMASS_EVAP kg<a name='10482'></font>
<font color=#447700>! of water evaporating<a name='10483'></font>
<font color=#447700>! Q_EVAP = the gain of vapour mixing ratio (kg/kg) from evaporation<a name='10484'></font>
<a name='10485'>
    HEAT_EVAP=-DMELT*XLF+ DT*(4.D0*PI*CAP)*FK_a*(TIN-273.15D0)*fh<a name='10486'>
<a name='10487'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='10488'></font>
<a name='10489'>
    IF(HEAT_EVAP.LT.0.D0) THEN<a name='10490'>
      <a name='10491'>
<font color=#447700>!      PRINT*, 'HEAT_EVAP &lt; 0'<a name='10492'></font>
<a name='10493'>
<font color=#447700>!      PRINT*, 'GRAUPEL'<a name='10494'></font>
<a name='10495'>
<font color=#447700>!      PRINT*, 'IJK,KX,KZ,IK'<a name='10496'></font>
<font color=#447700>!      PRINT*,  IJK,KX,KZ,IK_MELT<a name='10497'></font>
 <a name='10498'>
<font color=#447700>!      HEAT_EVAP=0.D0<a name='10499'></font>
<a name='10500'>
<a name='10501'>
    ENDIF<a name='10502'>
<a name='10503'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10504'></font>
<a name='10505'>
    FMASS_EVAP=HEAT_EVAP/XLV<a name='10506'>
<a name='10507'>
    if(FMASS_EVAP &gt; FLIQFR_G(IK)*XG_SI(IK)) then<a name='10508'>
      FMASS_EVAP = FLIQFR_G(IK)*XG_SI(IK)<a name='10509'>
    endif<a name='10510'>
<a name='10511'>
    Q_EVAP =  FMASS_EVAP * FF4_SI(IK)*XG_SI(IK)*3.D0*COL/rhoa_SI<a name='10512'>
<a name='10513'>
<a name='10514'>
<font color=#447700>! in case IEVAP_ADJUST == 1<a name='10515'></font>
  endif<a name='10516'>
<a name='10517'>
<font color=#447700>! in case FLIQFR_G(IK) &gt; 0.D0<a name='10518'></font>
<a name='10519'>
else<a name='10520'>
<a name='10521'>
<font color=#447700>! in case FLIQFR_G(IK) &lt;= 0.D0<a name='10522'></font>
<a name='10523'>
  if(ISUBLIME_ADJUST == 1)then<a name='10524'>
<a name='10525'>
    sub_fac = (XLS/(RV*TIN) - 1.D0)*XLS/(FK_a * TIN)<a name='10526'>
<a name='10527'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10528'></font>
<a name='10529'>
    sub_fac = sub_fac + RV* TIN/((100.D0*GGESI(TS)) * D_V)<a name='10530'>
<a name='10531'>
    DSUB = -DT*4.D0*PI*CAP*fv*(ee/(100.D0*GGESI(TS)) - 1.D0)/sub_fac<a name='10532'>
    <a name='10533'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10534'></font>
<a name='10535'>
    if(DSUB &gt;  XG_SI(IK)) then<a name='10536'>
      DSUB = XG_SI(IK)<a name='10537'>
    endif<a name='10538'>
<a name='10539'>
    Q_SUBL = DSUB*FF4_SI(IK)*XG_SI(IK)*3.D0*COL/rhoa_SI<a name='10540'>
<a name='10541'>
<a name='10542'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE'>SUBLIME_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUBLIME_ICE_3">( XG_SI(IK), rhoa_SI, Q_SUBL, FF4_SI(IK))<a name='10543'>
<a name='10544'>
    XG_MELT_SI(IK)=XX_MELT<a name='10545'>
<font color=#447700>!<a name='10546'></font>
    TIN = TIN - XLS/CP*Q_SUBL<a name='10547'>
    QQV = QQV + Q_SUBL<a name='10548'>
<a name='10549'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10550'></font>
<a name='10551'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10552'>
<a name='10553'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10554'></font>
<a name='10555'>
    if(QQV &lt; 0.D0)  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_829">("fatal error in module_mp_full_sbm , model stop 135")<a name='10556'>
    if(TIN &lt; 150.D0)   call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_830">("fatal error in module_mp_full_sbm , model stop 138")<a name='10557'>
<a name='10558'>
<a name='10559'>
<font color=#447700>! in case ISUBLIME_ADJUST == 1<a name='10560'></font>
<a name='10561'>
  endif<a name='10562'>
<a name='10563'>
<font color=#447700>! in case FLIQFR_G(IK) &lt;= 0.D0<a name='10564'></font>
<a name='10565'>
endif<a name='10566'>
<a name='10567'>
IF(FLIQFR_G(IK) &gt; FLIQFRAC_LIM) then<a name='10568'>
<a name='10569'>
  if(XL_SI(IK).NE.XG_SI(IK)) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_831">("fatal error in module_mp_full_sbm , model stop 7013")<a name='10570'>
<a name='10571'>
  if(ITEMP_ADJUST == 1) then<a name='10572'>
<a name='10573'>
<a name='10574'>
    Q_ICE_MELTED = FICEMASS *FF4_SI(IK)*XG_SI(IK)*3.D0*COL/rhoa_SI<a name='10575'>
<a name='10576'>
    TIN = TIN - XLF/CP*Q_ICE_MELTED<a name='10577'>
<a name='10578'>
<a name='10579'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10580'></font>
<a name='10581'>
  endif<a name='10582'>
<a name='10583'>
  FF1_SI(IK) = FF1_SI(IK) + FF4_SI(IK)<a name='10584'>
<a name='10585'>
<font color=#447700>!  FLIQFR_G(IK) = 0.D0<a name='10586'></font>
<a name='10587'>
  FLIQFR_G(IK) = 1.D0<a name='10588'>
<a name='10589'>
  FF4_SI(IK) = 0.D0<a name='10590'>
<a name='10591'>
<font color=#447700>! in case FLIQFR_G(IK) &gt; FLIQFRAC_LIM<a name='10592'></font>
<a name='10593'>
ENDIF<a name='10594'>
<a name='10595'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='10596'></font>
<a name='10597'>
endif<a name='10598'>
<a name='10599'>
ENDDO<a name='10600'>
<font color=#447700>! cycle by IK<a name='10601'></font>
<font color=#447700>!<a name='10602'></font>
<font color=#447700>!=============================================================<a name='10603'></font>
<font color=#447700>!               HAIL (assumed to be spheres)<a name='10604'></font>
<font color=#447700>!=============================================================<a name='10605'></font>
<a name='10606'>
<a name='10607'>
DO IK = 1, NKR<a name='10608'>
<a name='10609'>
   IK_MELT=IK<a name='10610'>
   I_MELT=0<a name='10611'>
<a name='10612'>
if(TIN &gt; 273.15D0) then<a name='10613'>
<a name='10614'>
IF(FLIQFR_H(IK).GE.1.D0.OR.FF5_SI(IK).LE.PETIT_PARAMETRE.OR. &amp;<a name='10615'>
TIN &lt;= 273.15D0) THEN<a name='10616'>
  IF(FLIQFR_H(IK) &gt; 1.D0) FLIQFR_H(IK) = 1.D0<a name='10617'>
CYCLE<a name='10618'>
ENDIF<a name='10619'>
<a name='10620'>
vt_start = 0.D0<a name='10621'>
vt_end = 0.D0<a name='10622'>
<a name='10623'>
rhoi  = RHO_H_SI(IK)<a name='10624'>
fm_i = XH_SI(IK)*(1.D0 - FLIQFR_H(IK))<a name='10625'>
V_i = fm_i/rhoi<a name='10626'>
fm_w = XH_SI(IK)*FLIQFR_H(IK)<a name='10627'>
V_w = fm_w/RHO_WATER<a name='10628'>
<a name='10629'>
if(rhoi &lt; RHO_CRIT) then<a name='10630'>
  V_soakable = V_i - fm_i/RHO_ICE<a name='10631'>
else<a name='10632'>
  V_soakable = 0.D0<a name='10633'>
endif<a name='10634'>
<a name='10635'>
a_i = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_5">(V_i)<a name='10636'>
a_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_6">(XH_SI(IK)/rhoi)<a name='10637'>
<a name='10638'>
<font color=#447700>! FIND RE OF SMOOTH SPHERE OF SAME MASS<a name='10639'></font>
<font color=#447700>! (fnre_smooth is invariant during melting)<a name='10640'></font>
<a name='10641'>
if(IPRINTING == 1) print *, 'fnre_dry = ', fnre_dry<a name='10642'>
<a name='10643'>
fnre_dry=VTH_SI(IK)*2.D0*rhoa_SI*a_izero/etaa<a name='10644'>
X_Best=8.D0*XH_SI(IK)*rhoa_SI*GRAV/(PI * etaa * etaa)<a name='10645'>
fnre_smooth=<A href='../../html_code/phys/module_mp_full_sbm.F.html#FNRE_SPHERE'>fnre_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FNRE_SPHERE_2">(X_Best)<a name='10646'>
<a name='10647'>
vt_justwet = 0.D0<a name='10648'>
vt_justsoaked = 0.D0<a name='10649'>
<a name='10650'>
if(V_w &lt; V_soakable) then<a name='10651'>
<a name='10652'>
<font color=#447700>! SOAKING OF WATER<a name='10653'></font>
<a name='10654'>
  a_d = a_i<a name='10655'>
  vt=VT_LOW_DENSITY_SOAKING &amp;<a name='10656'>
    (fnre_dry,fnre_smooth,VTH_SI(IK),a_i,a_izero,etaa,rhoa_SI)<a name='10657'>
<a name='10658'>
<font color=#447700>! in case V_w &lt; V_soakable<a name='10659'></font>
<a name='10660'>
else<a name='10661'>
<a name='10662'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='10663'></font>
<a name='10664'>
  a_d = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_7">(V_i + (V_w - V_soakable))<a name='10665'>
  fm_w_soaked = RHO_WATER* V_soakable<a name='10666'>
  fm_w_crit=(0.268D0+(fm_i+fm_w_soaked)*1.D3*0.1389D0)<a name='10667'>
  fm_w_crit = fm_w_crit* 1.D-3<a name='10668'>
  a_crit = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_8">(V_i + fm_w_crit/RHO_WATER)<a name='10669'>
<a name='10670'>
<font color=#447700>!RH87: Just-wet terminal velocity - look at history<a name='10671'></font>
<font color=#447700>!of same particle passing 0oC<a name='10672'></font>
<font color=#447700>!(ie. 'just-wet' means when 0degC is just reached<a name='10673'></font>
<font color=#447700>!by surface and melting commences):<a name='10674'></font>
<a name='10675'>
  if(rhoi &lt; RHO_CRIT) then<a name='10676'>
<a name='10677'>
    vt_start = VT_LOW_DENSITY_TRANS &amp;<a name='10678'>
              (fnre_dry,fnre_smooth, &amp;<a name='10679'>
               VTH_SI(IK),a_izero,etaa,rhoa_SI,rhoi,XH_SI(IK))<a name='10680'>
  else<a name='10681'>
<a name='10682'>
    vt_start = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_HIGH_DENSITY_TRANS'>VT_HIGH_DENSITY_TRANS</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VT_HIGH_DENSITY_TRANS_1">(fnre_dry, fnre_smooth, &amp;<a name='10683'>
    VTH_SI(IK), a_izero, etaa, rhoa_SI)<a name='10684'>
<a name='10685'>
  endif<a name='10686'>
<a name='10687'>
    vt_end=equilibrium_fallspeed &amp;<a name='10688'>
          (fm_i + fm_w_soaked, fm_w_crit, XH(:), &amp;<a name='10689'>
           VTL_SI(:), rhoa_SI, etaa, a_crit)<a name='10690'>
<a name='10691'>
<font color=#447700>! RH87: Interpolation based on fraction of equilibrium water<a name='10692'></font>
<font color=#447700>! on surface<a name='10693'></font>
<a name='10694'>
    frac_eqm = (fm_w - fm_w_soaked)/fm_w_crit<a name='10695'>
    if(frac_eqm &lt; 0.D0) frac_eqm = 0.D0<a name='10696'>
    if(frac_eqm &gt; 1.D0) frac_eqm = 1.D0<a name='10697'>
<a name='10698'>
    vt = vt_start + (vt_end - vt_start) * frac_eqm<a name='10699'>
<a name='10700'>
    if(vt &lt; 0.D0) then<a name='10701'>
      if(IPRINTING == 1) print *, 'WARNING: vt &lt; 0', vt<a name='10702'>
      vt = 0.D0<a name='10703'>
    endif<a name='10704'>
<a name='10705'>
    if(IPRINTING == 1) print *, &amp;<a name='10706'>
   'HERE 2:: vt_start,vt_end,a_izero/a_i= ', &amp;<a name='10707'>
             vt_start,vt_end,a_izero/a_i<a name='10708'>
<a name='10709'>
    if(IPRINTING == 1) print *, &amp;<a name='10710'>
   'HERE 2:: fnre_dry,fnre_smooth,vt_justsoaked,vt_justwet', &amp;<a name='10711'>
             fnre_dry,fnre_smooth,vt_justsoaked,vt_justwet<a name='10712'>
<a name='10713'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='10714'></font>
<a name='10715'>
endif<a name='10716'>
<a name='10717'>
<font color=#447700>! new changes 23.01.08                                      (start)<a name='10718'></font>
<a name='10719'>
<font color=#447700>! new changes 3.02.08                                       (start)<a name='10720'></font>
<a name='10721'>
if(ivt_G_H_interpol.ne.0) then<a name='10722'>
<a name='10723'>
  vt=VTH_SI(IK)+FLIQFR_H(IK)*(VTL_SI(IK) - VTH_SI(IK))<a name='10724'>
  <a name='10725'>
endif<a name='10726'>
<a name='10727'>
<font color=#447700>! new changes 3.02.08                                         (end)<a name='10728'></font>
  <a name='10729'>
<font color=#447700>! new changes 23.01.08                                        (end)<a name='10730'></font>
<a name='10731'>
V5_SI(IK) = vt<a name='10732'>
<a name='10733'>
if(IPRINTING == 1) print *, 'HERE 2: VT,LIQUID FRACTION,IK', &amp;<a name='10734'>
                                     V5_SI(IK),FLIQFR_H(IK),IK<a name='10735'>
fnre = vt * (2.D0 * a_d * rhoa_SI)/etaa<a name='10736'>
<a name='10737'>
<font color=#447700>! new change 5.02.07                                          (start)<a name='10738'></font>
<a name='10739'>
fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_3">(fnre,FNSC,IK)<a name='10740'>
fh = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_4">(fnre,FNPR,IK)<a name='10741'>
<a name='10742'>
<font color=#447700>! new change 5.02.07                                            (end)<a name='10743'></font>
<a name='10744'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10745'></font>
<a name='10746'>
if(FLIQFR_H(IK) &lt;= 0.D0) then<a name='10747'>
  TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_3">(ee, TIN, XLS*D_V/(FK_a*RV), fv/fh, XLS, RV)<a name='10748'>
else<a name='10749'>
  TS = 273.15D0<a name='10750'>
endif<a name='10751'>
<a name='10752'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='10753'>
<a name='10754'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10755'></font>
<a name='10756'>
<a name='10757'>
if(fnre &lt; 6000.D0) then<a name='10758'>
  CAP = a_d<a name='10759'>
else<a name='10760'>
  CAP = a_i<a name='10761'>
endif<a name='10762'>
<a name='10763'>
<a name='10764'>
FICEMASS = XH_SI(IK) * (1.D0 - FLIQFR_H(IK))<a name='10765'>
<a name='10766'>
DMELT = DT*4.D0*PI*CAP/XLF* &amp;<a name='10767'>
(FK_a*(TIN-273.15D0)*fh+D_V*XLV/RV*fv*(ee/TIN-es_zero/273.15D0))<a name='10768'>
<a name='10769'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10770'></font>
<a name='10771'>
if(TS &lt; 273.15D0 .and. FLIQFR_H(IK) &lt;= 0.) DMELT = 0.D0<a name='10772'>
<a name='10773'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10774'></font>
<a name='10775'>
<a name='10776'>
<font color=#447700>!<a name='10777'></font>
call <A href='../../html_code/phys/module_mp_full_sbm.F.html#FMASS_LIMITS'>fmass_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FMASS_LIMITS_4"> (DMELT,FICEMASS,fm_w,XH_SI(IK))<a name='10778'>
<a name='10779'>
<font color=#447700>!<a name='10780'></font>
if(ITEMP_ADJUST == 1) then<a name='10781'>
<a name='10782'>
<a name='10783'>
  call <A href='../../html_code/phys/module_mp_full_sbm.F.html#THERMODYNAMICAL_LIMITS'>thermodynamical_limits</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="THERMODYNAMICAL_LIMITS_4"> &amp;<a name='10784'>
 (FF5_SI(IK),XH_SI(IK),rhoa_SI,XLF/CP,TIN,DMELT)<a name='10785'>
<a name='10786'>
<a name='10787'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10788'></font>
<a name='10789'>
endif<a name='10790'>
<a name='10791'>
FICEMASS = FICEMASS - DMELT<a name='10792'>
<a name='10793'>
FLIQFR_H(IK) = (XH_SI(IK) - FICEMASS)/XH_SI(IK)<a name='10794'>
<a name='10795'>
<a name='10796'>
<a name='10797'>
if(FLIQFR_H(IK) &lt; 0.D0) then<a name='10798'>
  FLIQFR_H(IK) = 0.D0<a name='10799'>
endif<a name='10800'>
<a name='10801'>
if(FLIQFR_H(IK) &gt; 0.D0) then<a name='10802'>
<a name='10803'>
  if(IEVAP_ADJUST == 1) then<a name='10804'>
<a name='10805'>
    if( FLIQFR_H(IK) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_832">("fatal error in module_mp_full_sbm , model stop 906")<a name='10806'>
<a name='10807'>
<font color=#447700>! HEAT_EVAP = Joules of latent heat absorbed by FMASS_EVAP kg<a name='10808'></font>
<font color=#447700>! of water evaporating<a name='10809'></font>
<a name='10810'>
<font color=#447700>! Q_EVAP = the gain of vapour mixing ratio (kg/kg) from evaporation<a name='10811'></font>
<a name='10812'>
    HEAT_EVAP=-DMELT*XLF+DT*(4.D0*PI*CAP)*FK_a*(TIN-273.15D0)*fh<a name='10813'>
<a name='10814'>
<font color=#447700>! new changes 24.08.04                                        (start)<a name='10815'></font>
<a name='10816'>
    IF(HEAT_EVAP.LT.0.D0) THEN<a name='10817'>
      <a name='10818'>
<font color=#447700>!      PRINT*, 'HEAT_EVAP &lt; 0'<a name='10819'></font>
<a name='10820'>
<font color=#447700>!      PRINT*, 'GRAUPEL'<a name='10821'></font>
<a name='10822'>
<font color=#447700>!      PRINT*, 'IJK,KX,KZ,IK'<a name='10823'></font>
<font color=#447700>!      PRINT*,  IJK,KX,KZ,IK_MELT<a name='10824'></font>
 <a name='10825'>
<font color=#447700>!      HEAT_EVAP=0.D0<a name='10826'></font>
<a name='10827'>
<a name='10828'>
    ENDIF<a name='10829'>
<a name='10830'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10831'></font>
<a name='10832'>
    FMASS_EVAP = HEAT_EVAP/XLV<a name='10833'>
<a name='10834'>
    if(FMASS_EVAP &gt; FLIQFR_H(IK) * XH_SI(IK)) then<a name='10835'>
      FMASS_EVAP = FLIQFR_H(IK) * XH_SI(IK)<a name='10836'>
    endif<a name='10837'>
<a name='10838'>
    Q_EVAP=FMASS_EVAP*FF5_SI(IK)*XH_SI(IK)*3.D0*COL/rhoa_SI<a name='10839'>
<a name='10840'>
<a name='10841'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER'>EVAP_MELTWATER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EVAP_MELTWATER_3"> &amp;<a name='10842'>
   (XH_SI(IK),rhoa_SI,Q_EVAP,FLIQFR_H(IK),FF5_SI(IK))<a name='10843'>
<a name='10844'>
    XH_MELT_SI(IK)=XX_MELT<a name='10845'>
<a name='10846'>
    TIN = TIN - XLV/CP*Q_EVAP<a name='10847'>
    QQV = QQV + Q_EVAP<a name='10848'>
<a name='10849'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10850'></font>
<a name='10851'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10852'>
<a name='10853'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10854'></font>
<a name='10855'>
    if(QQV &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_833">("fatal error in module_mp_full_sbm , model stop 135")<a name='10856'>
    if(TIN &lt; 150.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_834">("fatal error in module_mp_full_sbm , model stop 138")<a name='10857'>
<a name='10858'>
<a name='10859'>
<font color=#447700>! in case IEVAP_ADJUST == 1<a name='10860'></font>
<a name='10861'>
  endif<a name='10862'>
<a name='10863'>
<font color=#447700>! in case FLIQFR_H(IK) &gt; 0.D0<a name='10864'></font>
<a name='10865'>
else<a name='10866'>
<a name='10867'>
<font color=#447700>! in case FLIQFR_H(IK) &lt;= 0.D0<a name='10868'></font>
<a name='10869'>
  if(ISUBLIME_ADJUST == 1) then<a name='10870'>
<a name='10871'>
    sub_fac = (XLS/(RV*TIN) - 1.D0)*XLS/(FK_a * TIN)<a name='10872'>
<a name='10873'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10874'></font>
<a name='10875'>
    sub_fac = sub_fac + RV* TIN/((100.D0*GGESI(TS)) * D_V)<a name='10876'>
<a name='10877'>
    DSUB = -DT*4.D0*PI*CAP*fv*(ee/(100.D0*GGESI(TS)) - 1.D0)/sub_fac<a name='10878'>
<a name='10879'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10880'></font>
<a name='10881'>
    if(DSUB &gt; XH_SI(IK)) then<a name='10882'>
      DSUB = XH_SI(IK)<a name='10883'>
    endif<a name='10884'>
<a name='10885'>
    Q_SUBL = DSUB*FF5_SI(IK)*XH_SI(IK)*3.D0*COL/rhoa_SI<a name='10886'>
<a name='10887'>
<a name='10888'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE'>SUBLIME_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SUBLIME_ICE_4">(XH_SI(IK),rhoa_SI,Q_SUBL,FF5_SI(IK))<a name='10889'>
<a name='10890'>
    XH_MELT_SI(IK)=XX_MELT<a name='10891'>
<a name='10892'>
    TIN = TIN - XLS/CP*Q_SUBL<a name='10893'>
    QQV = QQV + Q_SUBL<a name='10894'>
<a name='10895'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='10896'></font>
<a name='10897'>
    ee = QQV*pres_SI/(EPS + QQV)<a name='10898'>
<a name='10899'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='10900'></font>
<a name='10901'>
    if(QQV &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_835">("fatal error in module_mp_full_sbm , model stop 135")<a name='10902'>
    if(TIN &lt; 150.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_836">("fatal error in module_mp_full_sbm , model stop 138")<a name='10903'>
<a name='10904'>
<a name='10905'>
<font color=#447700>! in case ISUBLIME_ADJUST == 1<a name='10906'></font>
  endif<a name='10907'>
<a name='10908'>
<font color=#447700>! in case FLIQFR_H(IK) &lt;= 0.D0<a name='10909'></font>
<a name='10910'>
endif<a name='10911'>
<a name='10912'>
if(FLIQFR_H(IK) &lt; 0.D0) then<a name='10913'>
  FLIQFR_H(IK) = 0.D0<a name='10914'>
endif<a name='10915'>
<a name='10916'>
IF(FLIQFR_H(IK) &gt; FLIQFRAC_LIM) then<a name='10917'>
<a name='10918'>
  if(XL_SI(IK).NE.XH_SI(IK)) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#MELTING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_837">("fatal error in module_mp_full_sbm , model stop 7014")<a name='10919'>
<a name='10920'>
  if(ITEMP_ADJUST == 1) then<a name='10921'>
<a name='10922'>
<a name='10923'>
    Q_ICE_MELTED = FICEMASS *FF5_SI(IK)*XH_SI(IK)*3.D0*COL/rhoa_SI<a name='10924'>
<a name='10925'>
    TIN = TIN - XLF/CP*Q_ICE_MELTED<a name='10926'>
    <a name='10927'>
<a name='10928'>
<font color=#447700>! in case ITEMP_ADJUST == 1<a name='10929'></font>
<a name='10930'>
  endif<a name='10931'>
<a name='10932'>
  FF1_SI(IK) = FF1_SI(IK) + FF5_SI(IK)<a name='10933'>
<a name='10934'>
<font color=#447700>!  FLIQFR_H(IK) = 0.D0<a name='10935'></font>
<a name='10936'>
  FLIQFR_H(IK) = 1.D0<a name='10937'>
<a name='10938'>
  FF5_SI(IK) = 0.D0<a name='10939'>
<a name='10940'>
<font color=#447700>! in case FLIQFR_H(IK) &gt; FLIQFRAC_LIM<a name='10941'></font>
<a name='10942'>
ENDIF<a name='10943'>
<a name='10944'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='10945'></font>
<a name='10946'>
endif<a name='10947'>
<a name='10948'>
ENDDO<a name='10949'>
<font color=#447700>! cycle by IK<a name='10950'></font>
<a name='10951'>
<font color=#447700>!=============================================================<a name='10952'></font>
<font color=#447700>!       UNIT CONVERSION OF ALL OUTPUTS from SI<a name='10953'></font>
<font color=#447700>!=============================================================<a name='10954'></font>
<font color=#447700>!<a name='10955'></font>
if(ihucm_flag == 1) then<a name='10956'>
<a name='10957'>
  if(IVT_ADJUST == 1) then<a name='10958'>
    V2 = 100.D0 * V2_SI<a name='10959'>
    V3 = 100.D0 * V3_SI<a name='10960'>
    V4 = 100.D0 * V4_SI<a name='10961'>
    V5 = 100.D0 * V5_SI<a name='10962'>
  endif<a name='10963'>
<a name='10964'>
  FF1 = 1.D-9*FF1_SI<a name='10965'>
  FF2 = 1.D-9*FF2_SI<a name='10966'>
  FF3 = 1.D-9*FF3_SI<a name='10967'>
  FF4 = 1.D-9*FF4_SI<a name='10968'>
  FF5 = 1.D-9*FF5_SI<a name='10969'>
<a name='10970'>
  XI_MELT = XI_MELT_SI*1000.D0<a name='10971'>
  XS_MELT = XS_MELT_SI*1000.D0<a name='10972'>
  XG_MELT = XG_MELT_SI*1000.D0<a name='10973'>
  XH_MELT = XH_MELT_SI*1000.D0<a name='10974'>
<a name='10975'>
<font color=#447700>! in case ihucm_flag == 1<a name='10976'></font>
<a name='10977'>
else<a name='10978'>
<a name='10979'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='10980'></font>
<a name='10981'>
  if(IVT_ADJUST == 1) then<a name='10982'>
    V2 = V2_SI<a name='10983'>
    V3 = V3_SI<a name='10984'>
    V4 = V4_SI<a name='10985'>
    V5 = V5_SI<a name='10986'>
  endif<a name='10987'>
  <a name='10988'>
  FF1 = FF1_SI<a name='10989'>
  FF2 = FF2_SI<a name='10990'>
  FF3 = FF3_SI<a name='10991'>
  FF4 = FF4_SI<a name='10992'>
  FF5 = FF5_SI<a name='10993'>
<a name='10994'>
  XI_MELT = XI_MELT_SI<a name='10995'>
  XS_MELT = XS_MELT_SI<a name='10996'>
  XG_MELT = XG_MELT_SI<a name='10997'>
  XH_MELT = XH_MELT_SI<a name='10998'>
<a name='10999'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='11000'></font>
<a name='11001'>
endif<a name='11002'>
<a name='11003'>
 101 FORMAT(1X,D13.5)<a name='11004'>
 102 FORMAT(1X,2D13.5)<a name='11005'>
 103 FORMAT(1X,3D13.5)<a name='11006'>
 104 FORMAT(1X,4D13.5)<a name='11007'>
 105 FORMAT(1X,5D13.5)<a name='11008'>
 106 FORMAT(1X,6D13.5)<a name='11009'>
 107 FORMAT(1X,7D13.5)<a name='11010'>
 201 FORMAT(1X,I2,D13.5)<a name='11011'>
 202 FORMAT(1X,I2,2D13.5)<a name='11012'>
 203 FORMAT(1X,I2,3D13.5)<a name='11013'>
 204 FORMAT(1X,I2,4D13.5)<a name='11014'>
<a name='11015'>
END SUBROUTINE MELTING<a name='11016'>
<a name='11017'>
<font color=#447700>! end of melting subroutine<a name='11018'></font>
<A NAME='EVAP_MELTWATER'><A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11019'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>EVAP_MELTWATER</font>(XX,rhoax,Q_EVAPX,FLIQFRX,FFX) <A href='../../call_to/EVAP_MELTWATER.html' TARGET='index'>3</A>,<A href='../../call_from/EVAP_MELTWATER.html' TARGET='index'>4</A><a name='11020'>
<a name='11021'>
implicit double precision (a-h,o-z)<a name='11022'>
<a name='11023'>
PARAMETER(COL=0.23105D0)<a name='11024'>
<a name='11025'>
<font color=#447700>! control in main program &amp; others subroutines<a name='11026'></font>
<a name='11027'>
<font color=#447700>! new change 29.10.08                                         (start)           <a name='11028'></font>
<a name='11029'>
<a name='11030'>
<font color=#447700>! new change 29.10.08                                           (end)<a name='11031'></font>
<a name='11032'>
<a name='11033'>
<a name='11034'>
<a name='11035'>
total_mass= XX*FFX*XX*3.D0*COL/rhoax<a name='11036'>
total_mass_ice=(1.D0-FLIQFRX)*total_mass<a name='11037'>
total_mass_liq=FLIQFRX*total_mass<a name='11038'>
<a name='11039'>
<a name='11040'>
if(Q_EVAPX &gt; total_mass_liq) Q_EVAPX = total_mass_liq<a name='11041'>
if(Q_EVAPX &gt; total_mass) Q_EVAPX = total_mass<a name='11042'>
<a name='11043'>
total_mass_liq = total_mass_liq - Q_EVAPX<a name='11044'>
total_mass = total_mass - Q_EVAPX<a name='11045'>
<a name='11046'>
XX_MELT=total_mass*rhoax/(3.D0*XX*FFX*COL)<a name='11047'>
<a name='11048'>
FFX = total_mass/(XX*XX*3.D0*COL/rhoax)<a name='11049'>
<a name='11050'>
if(FFX &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_838">("fatal error in module_mp_full_sbm , model stop 136")<a name='11051'>
<a name='11052'>
if(total_mass_liq &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_839">("fatal error in module_mp_full_sbm , model stop 137")<a name='11053'>
if(total_mass_ice &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_840">("fatal error in module_mp_full_sbm , model stop 140")<a name='11054'>
if(total_mass &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#EVAP_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_841">("fatal error in module_mp_full_sbm , model stop 141")<a name='11055'>
<a name='11056'>
IF(total_mass.EQ.0.D0) THEN<a name='11057'>
  FLIQFRX =1.D0<a name='11058'>
ELSE<a name='11059'>
  FLIQFRX = (total_mass - total_mass_ice)/total_mass<a name='11060'>
ENDIF<a name='11061'>
<a name='11062'>
if(FLIQFRX &lt; 0.D0) FLIQFRX = 0.D0<a name='11063'>
if(FLIQFRX &gt; 1.D0) FLIQFRX = 1.D0<a name='11064'>
<a name='11065'>
101 FORMAT(1X,D13.5)<a name='11066'>
102 FORMAT(1X,2D13.5)<a name='11067'>
103 FORMAT(1X,3D13.5)<a name='11068'>
104 FORMAT(1X,4D13.5)<a name='11069'>
105 FORMAT(1X,5D13.5)<a name='11070'>
106 FORMAT(1X,6D13.5)<a name='11071'>
<a name='11072'>
END SUBROUTINE evap_meltwater<a name='11073'>
<a name='11074'>
<font color=#447700>! end of evap_meltwater subroutine<a name='11075'></font>
<font color=#447700>!====================================================================<a name='11076'></font>
<A NAME='SUBLIME_ICE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11077'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>SUBLIME_ICE</font> (XX,rhoax,Q_SUBLX,FFX) <A href='../../call_to/SUBLIME_ICE.html' TARGET='index'>4</A>,<A href='../../call_from/SUBLIME_ICE.html' TARGET='index'>2</A><a name='11078'>
<a name='11079'>
implicit double precision (a-h,o-z)<a name='11080'>
<a name='11081'>
PARAMETER(COL = 0.23105D0)<a name='11082'>
<a name='11083'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11084'></font>
<a name='11085'>
<a name='11086'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11087'></font>
<a name='11088'>
total_mass =  XX*FFX*XX*3.D0*COL/rhoax<a name='11089'>
<a name='11090'>
if(Q_SUBLX &gt; total_mass) Q_SUBLX = total_mass<a name='11091'>
<a name='11092'>
total_mass = total_mass - Q_SUBLX<a name='11093'>
<a name='11094'>
<font color=#447700>! new change 20.06.04                                         (start)<a name='11095'></font>
<a name='11096'>
XX_MELT=total_mass*rhoax/(3.D0*FFX*XX*COL)<a name='11097'>
<a name='11098'>
<font color=#447700>! new change 20.06.04                                           (end)<a name='11099'></font>
<a name='11100'>
FFX = total_mass/(XX*XX*3.D0*COL/rhoax)<a name='11101'>
<a name='11102'>
if(FFX &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_842">("fatal error in module_mp_full_sbm , model stop 140")<a name='11103'>
<a name='11104'>
if(total_mass &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SUBLIME_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_843">("fatal error in module_mp_full_sbm , model stop 141")<a name='11105'>
<a name='11106'>
END SUBROUTINE sublime_ice<a name='11107'>
<a name='11108'>
<font color=#447700>! end of sublime_ice subroutine<a name='11109'></font>
<font color=#447700>!====================================================================<a name='11110'></font>
<A NAME='VT_LOW_DENSITY_SOAKING'><A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_LOW_DENSITY_SOAKING' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11111'>
<font color=#993300>FUNCTION </font><font color=#cc0000>VT_LOW_DENSITY_SOAKING</font> &amp;<a name='11112'>
(fnre_dryx,fnre_smoothx,vt_dryx,a_ix,a_izerox,etaax,rhoax)<a name='11113'>
<a name='11114'>
implicit double precision (a-h,o-z)<a name='11115'>
<a name='11116'>
<a name='11117'>
<font color=#447700>! During melting, Re is constant (see RH87, Appendix B)<a name='11118'></font>
<font color=#447700>! but size changes<a name='11119'></font>
<a name='11120'>
<font color=#447700>! Same as for just-wet case, except we use the current ice size<a name='11121'></font>
<a name='11122'>
if(fnre_dryx &gt; 4000.D0) then<a name='11123'>
<a name='11124'>
  vtx = vt_dryx * a_izerox/a_ix<a name='11125'>
<a name='11126'>
<a name='11127'>
<font color=#447700>! in case fnre_dryx &gt; 4000.D0<a name='11128'></font>
<a name='11129'>
else<a name='11130'>
<a name='11131'>
<font color=#447700>! in case fnre_dryx &lt;= 4000.D0<a name='11132'></font>
<a name='11133'>
  vtx = fnre_smoothx * etaax/(2.D0 * a_ix * rhoax)<a name='11134'>
<a name='11135'>
<a name='11136'>
<font color=#447700>! in case fnre_dryx &lt;= 4000.D0<a name='11137'></font>
endif<a name='11138'>
<a name='11139'>
VT_LOW_DENSITY_SOAKING = vtx<a name='11140'>
<a name='11141'>
RETURN<a name='11142'>
END FUNCTION VT_LOW_DENSITY_SOAKING <a name='11143'>
<a name='11144'>
<font color=#447700>! end of vt_low_density_soaking function<a name='11145'></font>
<font color=#447700>!====================================================================<a name='11146'></font>
<A NAME='VT_LOW_DENSITY_TRANS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_LOW_DENSITY_TRANS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11147'>
<font color=#993300>FUNCTION </font><font color=#cc0000>VT_LOW_DENSITY_TRANS</font> &amp;,<A href='../../call_from/VT_LOW_DENSITY_TRANS.html' TARGET='index'>1</A><a name='11148'>
(fnre_dryx,fnre_smoothx,vt_dryx,a_izerox,etaax,rhoax,rhoix,fm_tot)<a name='11149'>
<a name='11150'>
implicit double precision (a-h,o-z)<a name='11151'>
<a name='11152'>
PARAMETER(RHO_WATER=1000.D0, RHO_ICE=920.D0, PI = 3.141592654D0)<a name='11153'>
<a name='11154'>
fm_ijustsoaked=fm_tot/(1.D0+RHO_WATER/rhoix-RHO_WATER/RHO_ICE)<a name='11155'>
a_ijustsoaked=<A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_LOW_DENSITY_TRANS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_9">(fm_ijustsoaked/rhoix)<a name='11156'>
<a name='11157'>
if(fnre_dryx &lt;=  4000.D0.or.rhoix &lt; 800.D0) then<a name='11158'>
  vt_justsoaked=fnre_smoothx*etaax/(2.D0*a_ijustsoaked*rhoax)<a name='11159'>
else<a name='11160'>
  vt_justsoaked=vt_dryx*a_izerox/a_ijustsoaked<a name='11161'>
endif<a name='11162'>
<a name='11163'>
vtx = vt_justsoaked<a name='11164'>
<a name='11165'>
VT_LOW_DENSITY_TRANS = vtx<a name='11166'>
<a name='11167'>
RETURN<a name='11168'>
END FUNCTION VT_LOW_DENSITY_TRANS<a name='11169'>
<a name='11170'>
<font color=#447700>! end of function vt_low_density_trans<a name='11171'></font>
<font color=#447700>!====================================================================<a name='11172'></font>
<A NAME='VT_HIGH_DENSITY_TRANS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_HIGH_DENSITY_TRANS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11173'>
<font color=#993300>FUNCTION </font><font color=#cc0000>VT_HIGH_DENSITY_TRANS</font> &amp; <A href='../../call_to/VT_HIGH_DENSITY_TRANS.html' TARGET='index'>2</A><a name='11174'>
(fnre_dryx,fnre_smoothx,vt_dryx,a_izerox,etaax,rhoax)<a name='11175'>
<a name='11176'>
implicit double precision (a-h,o-z)<a name='11177'>
<a name='11178'>
PARAMETER(RHO_WATER=1000.D0, RHO_ICE=920.D0, PI = 3.141592654D0)<a name='11179'>
<a name='11180'>
<font color=#447700>! Just-wet size = a_izero<a name='11181'></font>
<a name='11182'>
if(fnre_dryx &gt; 4000.D0) then<a name='11183'>
  vt_justwet=vt_dryx<a name='11184'>
else<a name='11185'>
  vt_justwet=fnre_smoothx*etaax/(2.D0*a_izerox*rhoax)<a name='11186'>
endif<a name='11187'>
<a name='11188'>
vtx = vt_justwet<a name='11189'>
<a name='11190'>
VT_HIGH_DENSITY_TRANS = vtx<a name='11191'>
<a name='11192'>
RETURN<a name='11193'>
END FUNCTION VT_HIGH_DENSITY_TRANS<a name='11194'>
<a name='11195'>
<font color=#447700>! end of function vt_high_density_trans<a name='11196'></font>
<font color=#447700>!====================================================================<a name='11197'></font>
<font color=#447700>! new change 5.02.07                                          (start)<a name='11198'></font>
<a name='11199'>
<A NAME='HAIL_VENTILATION_COEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11200'>
<font color=#993300>FUNCTION </font><font color=#cc0000>HAIL_VENTILATION_COEF</font> (fnrex, fnumber, KR) <A href='../../call_to/HAIL_VENTILATION_COEF.html' TARGET='index'>8</A><a name='11201'>
<a name='11202'>
<font color=#447700>! new change 5.02.07                                            (end)<a name='11203'></font>
<a name='11204'>
implicit double precision (a-h,o-z)<a name='11205'>
<a name='11206'>
<font color=#447700>! new change 29.10.08                                         (start)           <a name='11207'></font>
<a name='11208'>
<a name='11209'>
<font color=#447700>! new change 29.10.08                                           (end)<a name='11210'></font>
<a name='11211'>
if(fnrex &lt; 6000.D0) then<a name='11212'>
<a name='11213'>
  X_F = (fnrex**0.5D0)*(fnumber**(1.D0/3.D0))<a name='11214'>
<a name='11215'>
  IF(X_F &lt; 1.4D0) then<a name='11216'>
    fx = 1.D0 + 0.108D0*X_F*X_F<a name='11217'>
  ELSE<a name='11218'>
    fx = 0.78D0 + 0.308D0*X_F<a name='11219'>
  ENDIF<a name='11220'>
<a name='11221'>
  if(fnrex &lt; 250.D0) then<a name='11222'>
    fx = fx*2.D0<a name='11223'>
  endif<a name='11224'>
<a name='11225'>
<font color=#447700>! in case fnrex &lt; 6000.D0<a name='11226'></font>
<a name='11227'>
else<a name='11228'>
<a name='11229'>
<font color=#447700>! in case fnrex &gt;= 6000.D0<a name='11230'></font>
<a name='11231'>
  if(fnrex &lt; 20000.D0) then<a name='11232'>
    chi_fr = 0.76D0<a name='11233'>
  else<a name='11234'>
    chi_fr = 0.57 + fnrex*9.D-6<a name='11235'>
  endif<a name='11236'>
<a name='11237'>
  fx = chi_fr*(fnrex**0.5D0)*(fnumber**(1.D0/3.D0))/2.D0<a name='11238'>
<a name='11239'>
<font color=#447700>! in case fnrex &gt;= 6000.D0<a name='11240'></font>
<a name='11241'>
endif<a name='11242'>
<a name='11243'>
if(fx &lt; 1.D0) then<a name='11244'>
  fx = 1.D0<a name='11245'>
endif<a name='11246'>
<a name='11247'>
<font color=#447700>! new change 5.02.07                                          (start)<a name='11248'></font>
<a name='11249'>
<font color=#447700>!if(fx &gt; 100.D0) stop 99991<a name='11250'></font>
if(fx &gt; 100.D0) then<a name='11251'>
<font color=#447700>!  print*,   'IJK,KX,KZ,KR'<a name='11252'></font>
<font color=#447700>!  print*,    IJK,KX,KZ,KR<a name='11253'></font>
<font color=#447700>!  print*,   'chi_fr,fnrex,fnumber,fx'<a name='11254'></font>
<font color=#447700>!  print 204, chi_fr,fnrex,fnumber,fx<a name='11255'></font>
<font color=#447700>!  print*,   'stop 99991 : fx &gt; 100.D0'<a name='11256'></font>
<font color=#447700>! stop 99991<a name='11257'></font>
  fx=100.D0<a name='11258'>
endif<a name='11259'>
<a name='11260'>
<font color=#447700>! new change 5.02.07                                            (end)<a name='11261'></font>
<a name='11262'>
HAIL_VENTILATION_COEF = fx<a name='11263'>
<a name='11264'>
  201   FORMAT(E13.5)<a name='11265'>
  202   FORMAT(2E13.5)<a name='11266'>
  203   FORMAT(3E13.5)<a name='11267'>
  204   FORMAT(4E13.5)<a name='11268'>
  205   FORMAT(5E13.5)<a name='11269'>
  206   FORMAT(6E13.5)<a name='11270'>
  207   FORMAT(7E13.5)<a name='11271'>
<a name='11272'>
return<a name='11273'>
end function HAIL_VENTILATION_COEF<a name='11274'>
<a name='11275'>
<font color=#447700>! end of hail_ventilation_coef function<a name='11276'></font>
<font color=#447700>!====================================================================<a name='11277'></font>
<font color=#447700>! new change 24.08.04                                          (start)<a name='11278'></font>
<a name='11279'>
<A NAME='GGESI'><A href='../../html_code/phys/module_mp_full_sbm.F.html#GGESI' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11280'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>GGESI</font>(T)<a name='11281'>
<a name='11282'>
implicit double precision (a-h,o-z)<a name='11283'>
<a name='11284'>
intrinsic DLOG10<a name='11285'>
<font color=#447700>!<a name='11286'></font>
<font color=#447700>!     SATURATION VAPOR PRESSURE OVER ICE<a name='11287'></font>
<font color=#447700>!      (GOFF AND GRATCH)<a name='11288'></font>
<font color=#447700>!<a name='11289'></font>
<font color=#447700>!     ESI     SATURATION VAPOR PRESSURE  (MB)<a name='11290'></font>
<font color=#447700>!     T       TEMP  (KELVIN)<a name='11291'></font>
<font color=#447700>!<a name='11292'></font>
      DATA C1_MELT/-9.09718D0/C2_MELT/-3.56654D0/C3_MELT/0.876793D0/C4_MELT/0.78583503D0/<a name='11293'>
<font color=#447700>!<a name='11294'></font>
      A = 273.16D0/T<a name='11295'>
      B = C1_MELT*(A-1.0D0)+C2_MELT*DLOG10(A)+C3_MELT*(1.0D0-1.0D0/A)+C4_MELT<a name='11296'>
      GGESI = 10.0D0**B<a name='11297'>
<a name='11298'>
      RETURN<a name='11299'>
      END FUNCTION GGESI<a name='11300'>
<a name='11301'>
<font color=#447700>! ending of GGESI function<a name='11302'></font>
<a name='11303'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11304'></font>
<font color=#447700>!====================================================================<a name='11305'></font>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11306'></font>
<a name='11307'>
<A NAME='SNOW_VENTILATION_COEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SNOW_VENTILATION_COEF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11308'>
<font color=#993300>FUNCTION </font><font color=#cc0000>SNOW_VENTILATION_COEF</font>(fnrex,fnumber, ARx) <A href='../../call_to/SNOW_VENTILATION_COEF.html' TARGET='index'>1</A><a name='11309'>
<a name='11310'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11311'></font>
<a name='11312'>
implicit double precision (a-h,o-z)<a name='11313'>
<a name='11314'>
X_F = (fnrex**0.5D0) * (fnumber**(1.D0/3.D0))<a name='11315'>
<a name='11316'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11317'></font>
<a name='11318'>
if(ARx == 1.D0) then<a name='11319'>
<a name='11320'>
<font color=#447700>! real snow is not spherical, so this should not be used<a name='11321'></font>
<a name='11322'>
  IF(X_F &lt; 1.4D0) then<a name='11323'>
    fx = 1.D0 + 0.108D0*X_F*X_F<a name='11324'>
  ELSE<a name='11325'>
    fx = 0.78D0 + 0.308D0*X_F<a name='11326'>
  ENDIF<a name='11327'>
<a name='11328'>
else<a name='11329'>
<a name='11330'>
<font color=#447700>! this is the correct formula for real snow<a name='11331'></font>
<a name='11332'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11333'></font>
<a name='11334'>
if(X_F.le.1.D0) then<a name='11335'>
  fx=1.D0 + 0.14D0*X_F*X_F<a name='11336'>
else<a name='11337'>
  fx = 0.86D0 + 0.28D0*X_F<a name='11338'>
endif<a name='11339'>
<a name='11340'>
endif<a name='11341'>
<a name='11342'>
if(fx &lt; 1.D0) then<a name='11343'>
  fx = 1.D0<a name='11344'>
endif<a name='11345'>
<a name='11346'>
if(fx &gt; 100.D0) then<a name='11347'>
<a name='11348'>
print *,'99992 stop:',fx,X_F,fnrex,fnumber, ARx<a name='11349'>
fx = 100.D0<a name='11350'>
<font color=#447700>!stop 99992<a name='11351'></font>
endif<a name='11352'>
<a name='11353'>
SNOW_VENTILATION_COEF = fx<a name='11354'>
<a name='11355'>
return<a name='11356'>
end function SNOW_VENTILATION_COEF<a name='11357'>
<a name='11358'>
<font color=#447700>! ending of SNOW_VENTILATION_COEF function<a name='11359'></font>
<font color=#447700>!====================================================================<a name='11360'></font>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11361'></font>
<a name='11362'>
<font color=#447700>!REAL FUNCTION SURFACE_TEMP(eex, tempK, factor_vap, fvofh, XLS, RV)<a name='11363'></font>
<a name='11364'>
<A NAME='SURFACE_TEMP'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11365'>
<font color=#993300>FUNCTION </font><font color=#cc0000>SURFACE_TEMP</font>(eex, tempK, factor_vap, fvofh, XLS, RV) <A href='../../call_to/SURFACE_TEMP.html' TARGET='index'>6</A><a name='11366'>
<a name='11367'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11368'></font>
 <a name='11369'>
implicit double precision (a-h,o-z)<a name='11370'>
<a name='11371'>
intrinsic  DEXP, DABS<a name='11372'>
<a name='11373'>
tsxold = 269.D0<a name='11374'>
<a name='11375'>
tsx = 270.D0<a name='11376'>
<a name='11377'>
tdiff = 1.D0<a name='11378'>
<a name='11379'>
ilj = 0<a name='11380'>
<a name='11381'>
alpha_ts = factor_vap*fvofh<a name='11382'>
<a name='11383'>
beta_ts = alpha_ts*eex/tempK<a name='11384'>
<a name='11385'>
do while(tdiff &gt; 1.D-6)<a name='11386'>
<a name='11387'>
<font color=#447700>! esix_check=611.21D0*(DEXP((tsx-273.15)*XLS /(RV * tsx * 273.15)))<a name='11388'></font>
<a name='11389'>
   esix = 100.D0*GGESI(tsx)<a name='11390'>
<a name='11391'>
<font color=#447700>! print *, 'E_si = ', esix, ' Pa', ilj, esix_check<a name='11392'></font>
<a name='11393'>
  f_tsx = tempK - tsx - alpha_ts*esix/tsx + beta_ts<a name='11394'>
<a name='11395'>
  f_tsxold= &amp;<a name='11396'>
  tempK-tsxold-alpha_ts*100.D0*GGESI(tsxold)/tsxold+beta_ts<a name='11397'>
<a name='11398'>
  tsxnew = tsx - f_tsx*(tsx - tsxold)/(f_tsx - f_tsxold)<a name='11399'>
<a name='11400'>
  tsxold = tsx<a name='11401'>
  tsx = tsxnew<a name='11402'>
<a name='11403'>
  tdiff = DABS(tsx - tsxold)<a name='11404'>
<a name='11405'>
  ilj = ilj + 1<a name='11406'>
<a name='11407'>
  if(ilj &gt; 1e6) then<a name='11408'>
    print *, &amp;<a name='11409'>
   'SURFACE_TEMP not converging', tsx,tempK,tdiff,fvofh,eex,esix<a name='11410'>
    tsx = tempK<a name='11411'>
    exit<a name='11412'>
  endif<a name='11413'>
<a name='11414'>
enddo<a name='11415'>
<a name='11416'>
SURFACE_TEMP = tsx<a name='11417'>
<a name='11418'>
return<a name='11419'>
END FUNCTION SURFACE_TEMP<a name='11420'>
<a name='11421'>
<font color=#447700>! ending of SURFACE_TEMP function<a name='11422'></font>
<a name='11423'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11424'></font>
<font color=#447700>!====================================================================<a name='11425'></font>
<A NAME='COLUMN_VENTILATION_COEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_VENTILATION_COEF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11426'>
<font color=#993300>FUNCTION </font><font color=#cc0000>COLUMN_VENTILATION_COEF</font>(fnrex, fnumber) <A href='../../call_to/COLUMN_VENTILATION_COEF.html' TARGET='index'>1</A>,<A href='../../call_from/COLUMN_VENTILATION_COEF.html' TARGET='index'>1</A><a name='11427'>
<a name='11428'>
implicit double precision (a-h,o-z)<a name='11429'>
<a name='11430'>
if(fnrex &lt; 50.D0) then<a name='11431'>
  X_F = (fnrex**0.5D0) * (fnumber**(1.D0/3.D0))<a name='11432'>
else<a name='11433'>
  X_F = (50.D0**0.5D0) * (fnumber**(1.D0/3.D0))<a name='11434'>
endif<a name='11435'>
<a name='11436'>
fx=1.D0-0.00668D0*X_F/4.D0+2.39402D0*((X_F/4.D0)**2.D0)+ &amp;<a name='11437'>
   0.73409D0*((X_F/4.D0)**3.D0)-0.73911D0*((X_F/4.D0)**4.D0)<a name='11438'>
<a name='11439'>
if(fx &lt; 1.D0) then<a name='11440'>
  fx = 1.D0<a name='11441'>
endif<a name='11442'>
<a name='11443'>
if(fx &gt; 100.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_VENTILATION_COEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_844">("fatal error in module_mp_full_sbm , model stop 99993")<a name='11444'>
<a name='11445'>
COLUMN_VENTILATION_COEF = fx<a name='11446'>
<a name='11447'>
return<a name='11448'>
end function COLUMN_VENTILATION_COEF<a name='11449'>
<a name='11450'>
<font color=#447700>! end of column_ventilation_coef function<a name='11451'></font>
<font color=#447700>!====================================================================<a name='11452'></font>
<A NAME='PLATE_VENTILATION_COEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLATE_VENTILATION_COEF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11453'>
<font color=#993300>FUNCTION </font><font color=#cc0000>PLATE_VENTILATION_COEF</font>(fnrex, fnumber) <A href='../../call_to/PLATE_VENTILATION_COEF.html' TARGET='index'>1</A>,<A href='../../call_from/PLATE_VENTILATION_COEF.html' TARGET='index'>1</A><a name='11454'>
<a name='11455'>
implicit double precision (a-h,o-z)<a name='11456'>
<a name='11457'>
if(fnrex &lt; 150.D0) then<a name='11458'>
  X_F = fnrex**0.5D0 * fnumber**(1.D0/3.D0)<a name='11459'>
else<a name='11460'>
  X_F = 150.D0**0.5D0 * fnumber**(1.D0/3.D0)<a name='11461'>
endif<a name='11462'>
<a name='11463'>
fx=1.D0-0.06042D0*X_F/10.D0+2.79820D0*((X_F/10.D0)**2.D0) - &amp;<a name='11464'>
   0.31933D0*((X_F/10.D0)**3.D0)-0.06247D0*((X_F/10.D0)**4.D0)<a name='11465'>
<a name='11466'>
if(fx &lt; 1.D0) then<a name='11467'>
  fx = 1.D0<a name='11468'>
endif<a name='11469'>
<a name='11470'>
if(fx &gt; 100.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLATE_VENTILATION_COEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_845">("fatal error in module_mp_full_sbm , model stop 99994")<a name='11471'>
<a name='11472'>
PLATE_VENTILATION_COEF = fx<a name='11473'>
<a name='11474'>
return<a name='11475'>
end function PLATE_VENTILATION_COEF<a name='11476'>
<a name='11477'>
<font color=#447700>! end of plate_ventilation_coef function<a name='11478'></font>
<font color=#447700>!====================================================================<a name='11479'></font>
<A NAME='DENDRITE_VENTILATION_COEF'><A href='../../html_code/phys/module_mp_full_sbm.F.html#DENDRITE_VENTILATION_COEF' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11480'>
<font color=#993300>FUNCTION </font><font color=#cc0000>DENDRITE_VENTILATION_COEF</font>(fnrex, fnumber) <A href='../../call_to/DENDRITE_VENTILATION_COEF.html' TARGET='index'>1</A>,<A href='../../call_from/DENDRITE_VENTILATION_COEF.html' TARGET='index'>1</A><a name='11481'>
<a name='11482'>
implicit double precision (a-h,o-z)<a name='11483'>
<a name='11484'>
if(fnrex &lt; 150.D0) then<a name='11485'>
  X_F = (fnrex**0.5D0) * (fnumber**(1.D0/3.D0))<a name='11486'>
else<a name='11487'>
  X_F = (150.D0**0.5D0) * (fnumber**(1.D0/3.D0))<a name='11488'>
endif<a name='11489'>
<a name='11490'>
fx=1.D0+0.35463D0*X_F/10.D0+3.55338D0*((X_F/10.D0)**2.D0)<a name='11491'>
<a name='11492'>
if(fx &lt; 1.D0) then<a name='11493'>
  fx = 1.D0<a name='11494'>
endif<a name='11495'>
<a name='11496'>
if(fx &gt; 100.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#DENDRITE_VENTILATION_COEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_846">("fatal error in module_mp_full_sbm , model stop 99995")<a name='11497'>
<a name='11498'>
DENDRITE_VENTILATION_COEF = fx<a name='11499'>
<a name='11500'>
return<a name='11501'>
end function DENDRITE_VENTILATION_COEF<a name='11502'>
<a name='11503'>
<font color=#447700>! end of dendrite_ventilation_coef function<a name='11504'></font>
<font color=#447700>!====================================================================<a name='11505'></font>
<A NAME='CHI_FRA'><A href='../../html_code/phys/module_mp_full_sbm.F.html#CHI_FRA' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11506'>
<font color=#993300>FUNCTION </font><font color=#cc0000>chi_fra</font>(fra),<A href='../../call_from/CHI_FRA.html' TARGET='index'>4</A><a name='11507'>
<a name='11508'>
implicit double precision (a-h,o-z)<a name='11509'>
<a name='11510'>
DIMENSION xxa(14), yya(14)<a name='11511'>
<a name='11512'>
pc = 100.D0 * fra<a name='11513'>
<a name='11514'>
if(pc.le.0.D0) then<a name='11515'>
  chi_fra = 0.D0<a name='11516'>
  return<a name='11517'>
endif<a name='11518'>
<a name='11519'>
if(pc.ge.100.D0) then<a name='11520'>
  chi_fra = 1.D0<a name='11521'>
  return<a name='11522'>
endif<a name='11523'>
<a name='11524'>
xxa(1) = 0.D0<a name='11525'>
yya(1) = 0.D0<a name='11526'>
xxa(2) = 10.D0<a name='11527'>
yya(2) = 1.25D0<a name='11528'>
xxa(3) = 20.D0<a name='11529'>
yya(3) = 3.12D0<a name='11530'>
xxa(4) = 30.D0<a name='11531'>
yya(4) = 5.D0<a name='11532'>
xxa(5) = 40.D0<a name='11533'>
yya(5) = 8.12D0<a name='11534'>
xxa(6) = 50.D0<a name='11535'>
yya(6) = 11.87D0<a name='11536'>
xxa(7) = 60.D0<a name='11537'>
yya(7) = 17.49D0<a name='11538'>
xxa(8) = 70.D0<a name='11539'>
yya(8) = 24.36D0<a name='11540'>
xxa(9) = 75.D0<a name='11541'>
yya(9) = 28.73D0<a name='11542'>
xxa(10) = 80.D0<a name='11543'>
yya(10) = 34.98D0<a name='11544'>
xxa(11) = 85.D0<a name='11545'>
yya(11) = 43.72D0<a name='11546'>
xxa(12) = 90.D0<a name='11547'>
yya(12) = 56.84D0<a name='11548'>
xxa(13) = 95.D0<a name='11549'>
yya(13) = 73.08D0<a name='11550'>
xxa(14) = 100.D0<a name='11551'>
yya(14) = 100.D0<a name='11552'>
<a name='11553'>
ix_max = 14<a name='11554'>
<a name='11555'>
ix = 0<a name='11556'>
<a name='11557'>
pc_hi = 0.D0<a name='11558'>
<a name='11559'>
DO WHILE(pc_hi &lt; pc)<a name='11560'>
<a name='11561'>
ix = ix + 1<a name='11562'>
<a name='11563'>
if(ix &gt; ix_max) then<a name='11564'>
ix = ix - 1<a name='11565'>
exit<a name='11566'>
endif<a name='11567'>
<a name='11568'>
pc_hi = xxa(ix)<a name='11569'>
<a name='11570'>
ENDDO<a name='11571'>
<a name='11572'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11573'></font>
<a name='11574'>
if(ix -1 &lt; 1) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#CHI_FRA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_847">("fatal error in module_mp_full_sbm , model stop 42567")<a name='11575'>
if(ix  &gt; ix_max) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#CHI_FRA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_848">("fatal error in module_mp_full_sbm , model stop 42568")<a name='11576'>
<a name='11577'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11578'></font>
<a name='11579'>
chi_fra=yya(ix-1)+ &amp;<a name='11580'>
(pc-xxa(ix-1))*(yya(ix)-yya(ix-1))/(xxa(ix)-xxa(ix-1))<a name='11581'>
<a name='11582'>
chi_fra = chi_fra/100.D0<a name='11583'>
<a name='11584'>
if(chi_fra  &lt; 0.D0) chi_fra  = 0.D0<a name='11585'>
if(chi_fra  &gt; 1.D0) chi_fra  = 1.D0<a name='11586'>
<a name='11587'>
<font color=#447700>! new change 24.08.04                                         (start)<a name='11588'></font>
<a name='11589'>
if(chi_fra &gt; 0.3D0 .and. pc &lt; 75.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#CHI_FRA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_849">("fatal error in module_mp_full_sbm , model stop 1478")<a name='11590'>
if(chi_fra &gt; 0.6D0 .and. pc &lt; 90.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#CHI_FRA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_850">("fatal error in module_mp_full_sbm , model stop 1477")<a name='11591'>
<a name='11592'>
<font color=#447700>! new change 24.08.04                                           (end)<a name='11593'></font>
<a name='11594'>
RETURN<a name='11595'>
END FUNCTION chi_fra<a name='11596'>
<a name='11597'>
<font color=#447700>! end of chi_fra function<a name='11598'></font>
<font color=#447700>!====================================================================<a name='11599'></font>
<A NAME='FNRE_SPHERE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#FNRE_SPHERE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11600'>
<font color=#993300>function </font><font color=#cc0000>fnre_sphere</font>(xd) <A href='../../call_to/FNRE_SPHERE.html' TARGET='index'>4</A><a name='11601'>
<a name='11602'>
implicit double precision (a-h,o-z)<a name='11603'>
<a name='11604'>
INTRINSIC DLOG10<a name='11605'>
<a name='11606'>
ww1 = dlog10(xd)<a name='11607'>
<a name='11608'>
ww2 = ww1 * ww1<a name='11609'>
ww3 = ww1 * ww1* ww1<a name='11610'>
<a name='11611'>
fnre_sphere = 0.d0<a name='11612'>
<a name='11613'>
if(xd &lt; 73.D0) then<a name='11614'>
  fnre_sphere = xd/24.D0<a name='11615'>
endif<a name='11616'>
<a name='11617'>
if(xd &lt; 562.D0.and.xd &gt;= 73.D0) then<a name='11618'>
  fnre_sphere = - 1.7095D0 + 1.33438D0*ww1 - 0.11591D0*ww2<a name='11619'>
  fnre_sphere = 10.D0**fnre_sphere<a name='11620'>
endif<a name='11621'>
<a name='11622'>
if(xd &lt; 1.83D3.and.xd &gt;= 562.D0) then<a name='11623'>
  fnre_sphere= &amp;<a name='11624'>
  -1.81391D0 + 1.34671D0*ww1 - 0.12427D0*ww2 + 0.0063D0*ww3<a name='11625'>
  fnre_sphere = 10.D0**fnre_sphere<a name='11626'>
endif<a name='11627'>
<a name='11628'>
if(xd &lt; 5.4D10.and.xd &gt;= 1.83D3) then<a name='11629'>
  fnre_sphere= &amp;<a name='11630'>
  0.003567D0*ww3 - 0.089620D0*ww2 + 1.225713D0*ww1 - 1.706026D0<a name='11631'>
  fnre_sphere = 10.D0**fnre_sphere<a name='11632'>
endif<a name='11633'>
<a name='11634'>
if(xd &gt;= 5.4D10) then<a name='11635'>
  fnre_sphere = (xd/0.1D0)**0.5D0<a name='11636'>
endif<a name='11637'>
<a name='11638'>
end function fnre_sphere<a name='11639'>
<a name='11640'>
<font color=#447700>! end of fnre_sphere function<a name='11641'></font>
<font color=#447700>!====================================================================<a name='11642'></font>
<A NAME='EQUILIBRIUM_FALLSPEED'><A href='../../html_code/phys/module_mp_full_sbm.F.html#EQUILIBRIUM_FALLSPEED' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11643'>
<font color=#993300>function </font><font color=#cc0000>equilibrium_fallspeed</font> (fm_s, fm_w_critx, XXL, vt_rain, &amp;,<A href='../../call_from/EQUILIBRIUM_FALLSPEED.html' TARGET='index'>1</A><a name='11644'>
                                rhoax, etaax, a_eqm)<a name='11645'>
implicit double precision (a-h,o-z)<a name='11646'>
<a name='11647'>
<font color=#447700>!PARAMETER(PI = 3.141592654D0, NKR = 43, GRAV = 9.8D0)<a name='11648'></font>
PARAMETER(PI = 3.141592654D0, GRAV = 9.8D0)<a name='11649'>
<a name='11650'>
DIMENSION XXL(NKR), vt_rain(NKR)<a name='11651'>
<a name='11652'>
fnre_shed = 4800.D0 + 4831.5D0*1000.D0*fm_s<a name='11653'>
<a name='11654'>
if(fnre_shed &gt;= 5000.D0.and.fnre_shed &lt;= 2.5D4) then<a name='11655'>
<a name='11656'>
<font color=#447700>! a_d or a_eqm here?<a name='11657'></font>
<a name='11658'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='11659'></font>
<a name='11660'>
  vt_eqm = 1.5D-5* fnre_shed/(2.D0*a_eqm)<a name='11661'>
  <a name='11662'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='11663'></font>
<a name='11664'>
  vt_eqm = vt_eqm* ((1.20D0/rhoax)**0.5D0)<a name='11665'>
<a name='11666'>
  if(vt_eqm &gt; 100.D0) then<a name='11667'>
  <font color=#447700>!  print *, 'WARNING: vt_eqm exceeding 100 m/s', vt_eqm<a name='11668'></font>
  <font color=#447700>!  print *, 'fnre_shed, etaax, rhoax, a_eqm ::', &amp;<a name='11669'></font>
  <font color=#447700>!  fnre_shed, etaax, rhoax, a_eqm<a name='11670'></font>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#EQUILIBRIUM_FALLSPEED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_851">("fatal error in module_mp_full_sbm , model stop 9999")<a name='11671'>
  endif<a name='11672'>
<a name='11673'>
<font color=#447700>! in case fnre_shed &gt;= 5000.D0.and.fnre_shed &lt;= 2.5D4<a name='11674'></font>
<a name='11675'>
else<a name='11676'>
<a name='11677'>
<font color=#447700>! in case fnre_shed &lt; 5000.D0.or.fnre_shed &gt; 2.5D4<a name='11678'></font>
<a name='11679'>
  if(fnre_shed &gt; 2.5D4) then<a name='11680'>
<a name='11681'>
    X_Best_crit=8.D0*(fm_s+fm_w_critx)*rhoax*GRAV/(PI*etaax*etaax)<a name='11682'>
    fnre_fast=(X_Best_crit/0.6D0)**0.5D0<a name='11683'>
    vt_eqm=fnre_fast*etaax/(2.D0*a_eqm*rhoax)<a name='11684'>
<a name='11685'>
<font color=#447700>! in case fnre_shed &gt; 2.5D4<a name='11686'></font>
<a name='11687'>
  else<a name='11688'>
<a name='11689'>
<font color=#447700>! in case fnre_shed &lt; 5000.D0<a name='11690'></font>
<a name='11691'>
    ILIQ = IFIND_IK (fm_s + fm_w_critx, XXL, finter_frac)<a name='11692'>
<a name='11693'>
    if(ILIQ &lt; NKR ) then<a name='11694'>
      vt_eqm = &amp;<a name='11695'>
      vt_rain(ILIQ)+finter_frac*(vt_rain(ILIQ+1)-vt_rain(ILIQ))<a name='11696'>
    else<a name='11697'>
      vt_eqm = vt_rain(NKR)<a name='11698'>
    endif<a name='11699'>
<a name='11700'>
<font color=#447700>! in case fnre_shed &lt; 5000.D0<a name='11701'></font>
  endif<a name='11702'>
<a name='11703'>
<font color=#447700>! in case fnre_shed &lt; 5000.D0.or.fnre_shed &gt; 2.5D4<a name='11704'></font>
endif<a name='11705'>
<a name='11706'>
equilibrium_fallspeed = vt_eqm<a name='11707'>
<a name='11708'>
end function equilibrium_fallspeed<a name='11709'>
<a name='11710'>
<font color=#447700>! end of equilibrium_fallspeed function<a name='11711'></font>
<font color=#447700>!====================================================================<a name='11712'></font>
<A NAME='IFIND_IK'><A href='../../html_code/phys/module_mp_full_sbm.F.html#IFIND_IK' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11713'>
<font color=#993300>FUNCTION </font><font color=#cc0000>IFIND_IK</font> (fmass_target, fmass_array, fraction) <A href='../../call_to/IFIND_IK.html' TARGET='index'>2</A>,<A href='../../call_from/IFIND_IK.html' TARGET='index'>1</A><a name='11714'>
<a name='11715'>
implicit double precision (a-h,o-z)<a name='11716'>
<a name='11717'>
<font color=#447700>!PARAMETER(NKR = 43)<a name='11718'></font>
<a name='11719'>
DIMENSION fmass_array(NKR)<a name='11720'>
<a name='11721'>
IKX = 2<a name='11722'>
<a name='11723'>
DO WHILE(fmass_array(IKX) &lt; fmass_target)<a name='11724'>
   if(IKX &gt; NKR - 1) exit<a name='11725'>
   IKX = IKX + 1<a name='11726'>
ENDDO<a name='11727'>
<a name='11728'>
IKX = IKX - 1<a name='11729'>
<a name='11730'>
fraction= &amp;<a name='11731'>
(fmass_target-fmass_array(IKX))/(fmass_array(IKX+1)-fmass_array(IKX))<a name='11732'>
if(fraction &lt; 0.D0) fraction = 0.D0<a name='11733'>
if(fraction &gt; 1.D0) fraction = 1.D0<a name='11734'>
<a name='11735'>
if(IKX &gt; NKR.or.IKX &lt; 1) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#IFIND_IK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_852">("fatal error in module_mp_full_sbm , model stop 99999")<a name='11736'>
<a name='11737'>
IFIND_IK = IKX<a name='11738'>
<a name='11739'>
END FUNCTION IFIND_IK<a name='11740'>
<a name='11741'>
<font color=#447700>! end of ifind_ik function<a name='11742'></font>
<font color=#447700>!====================================================================<a name='11743'></font>
<A NAME='COLUMN_AR'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_AR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11744'>
<font color=#993300>FUNCTION </font><font color=#cc0000>COLUMN_AR</font> (fmassx, rhoix) <A href='../../call_to/COLUMN_AR.html' TARGET='index'>1</A><a name='11745'>
<a name='11746'>
implicit double precision (a-h,o-z)<a name='11747'>
<a name='11748'>
parameter (PI = 3.141592654D0)<a name='11749'>
<a name='11750'>
<font color=#447700>! estimate equivalent diameter (mm)<a name='11751'></font>
<a name='11752'>
d_equiv = (fmassx/rhoix)/(4.D0*PI/3.D0)<a name='11753'>
d_equiv = d_equiv**(1.D0/3.D0)<a name='11754'>
d_equiv = 2.D0*d_equiv*1000.D0<a name='11755'>
<a name='11756'>
<font color=#447700>! apply Table 1 from Heymsfield (1972)<a name='11757'></font>
<a name='11758'>
if(d_equiv &lt; 0.3D0) then<a name='11759'>
  shape = 2.D0<a name='11760'>
else<a name='11761'>
  shape = d_equiv/(0.1973D0*(d_equiv**0.414D0))<a name='11762'>
endif<a name='11763'>
<a name='11764'>
<font color=#447700>! Now improve the estimate of AR<a name='11765'></font>
<a name='11766'>
FL_i = 4.D0*shape*shape*(fmassx/rhoix)/PI<a name='11767'>
FL_i = FL_i**(1.D0/3.D0)<a name='11768'>
FL_i = FL_i* 1000.D0<a name='11769'>
<a name='11770'>
if(FL_i &lt; 0.3D0) then<a name='11771'>
  COLUMN_AR = 2.D0<a name='11772'>
else<a name='11773'>
  COLUMN_AR = FL_i/(0.1973D0*(FL_i**0.414D0))<a name='11774'>
endif<a name='11775'>
<a name='11776'>
if(COLUMN_AR &gt; 5.D0) COLUMN_AR = 5.D0<a name='11777'>
<a name='11778'>
return<a name='11779'>
end function COLUMN_AR<a name='11780'>
<a name='11781'>
<font color=#447700>! end of COLUMN_AR function<a name='11782'></font>
<font color=#447700>!====================================================================<a name='11783'></font>
<A NAME='PLATE_AR'><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLATE_AR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11784'>
<font color=#993300>FUNCTION </font><font color=#cc0000>PLATE_AR</font> (fmassx) <A href='../../call_to/PLATE_AR.html' TARGET='index'>1</A><a name='11785'>
<a name='11786'>
implicit double precision (a-h,o-z)<a name='11787'>
<a name='11788'>
d_i = (fmassx/1.d-3)/0.03760d0<a name='11789'>
d_i = d_i**(1.d0/3.31d0)<a name='11790'>
d_i = d_i/100.d0<a name='11791'>
h_i = 0.0141d0*( (d_i*100.d0)**0.474d0)<a name='11792'>
h_i = h_i/100.d0<a name='11793'>
<a name='11794'>
PLATE_AR = h_i/d_i<a name='11795'>
<a name='11796'>
return<a name='11797'>
end function  PLATE_AR<a name='11798'>
<a name='11799'>
<font color=#447700>! end of plate_ar function<a name='11800'></font>
<font color=#447700>!====================================================================<a name='11801'></font>
<A NAME='DENDRITE_AR'><A href='../../html_code/phys/module_mp_full_sbm.F.html#DENDRITE_AR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11802'>
<font color=#993300>FUNCTION </font><font color=#cc0000>DENDRITE_AR</font>(fmassx) <A href='../../call_to/DENDRITE_AR.html' TARGET='index'>1</A><a name='11803'>
<a name='11804'>
implicit double precision (a-h,o-z)<a name='11805'>
<a name='11806'>
d_i = (fmassx/1.d-3)/0.00376D0<a name='11807'>
d_i = d_i**(1.D0/2.79D0)<a name='11808'>
d_i = d_i/100.D0<a name='11809'>
h_i = 0.00996D0*((d_i*100.D0)** 0.415D0)<a name='11810'>
h_i = h_i/100.D0<a name='11811'>
<a name='11812'>
DENDRITE_AR = h_i/d_i<a name='11813'>
<a name='11814'>
return<a name='11815'>
end function DENDRITE_AR<a name='11816'>
<a name='11817'>
<font color=#447700>! end of dendrite_ar function<a name='11818'></font>
<font color=#447700>!====================================================================<a name='11819'></font>
<A NAME='COLUMN_CAP_ZERO'><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_CAP_ZERO' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11820'>
<font color=#993300>FUNCTION </font><font color=#cc0000>COLUMN_CAP_ZERO</font> (fm_ice, AR_ice, rho_ice, FLstar) <A href='../../call_to/COLUMN_CAP_ZERO.html' TARGET='index'>1</A>,<A href='../../call_from/COLUMN_CAP_ZERO.html' TARGET='index'>2</A><a name='11821'>
<a name='11822'>
implicit double precision (a-h,o-z)<a name='11823'>
<a name='11824'>
PARAMETER(PI = 3.141592654D0)<a name='11825'>
<a name='11826'>
INTRINSIC DLOG<a name='11827'>
<a name='11828'>
a_ix = (fm_ice/rho_ice)/(4.D0*PI*AR_ice/3.D0)<a name='11829'>
a_ix = a_ix**(1.D0/3.D0)<a name='11830'>
b_i = AR_ice*a_ix<a name='11831'>
<a name='11832'>
if(AR_ice &lt; 0.D0.or.AR_ice &lt; 1.D0) then<a name='11833'>
call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_CAP_ZERO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_853">("fatal error in module_mp_full_sbm , model stop 9011")<a name='11834'>
endif<a name='11835'>
<a name='11836'>
epsil_i = b_i*b_i - a_ix*a_ix<a name='11837'>
<a name='11838'>
if(epsil_i.le.0.D0) then<a name='11839'>
<font color=#447700>!  print*, a_ix, b_i , fm_ice, AR_ice<a name='11840'></font>
call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLUMN_CAP_ZERO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_854">("fatal error in module_mp_full_sbm , model stop 9044")<a name='11841'>
endif<a name='11842'>
<a name='11843'>
epsil_i = epsil_i**0.5D0<a name='11844'>
<a name='11845'>
COLUMN_CAP_ZERO= (b_i+epsil_i)/a_ix<a name='11846'>
COLUMN_CAP_ZERO = epsil_i /(DLOG(COLUMN_CAP_ZERO))<a name='11847'>
<a name='11848'>
omega_i = 2.D0*(PI*a_ix*a_ix) + 4.D0*b_i*a_ix<a name='11849'>
<a name='11850'>
P_i = 2.D0*PI*a_ix<a name='11851'>
<a name='11852'>
FLstar = omega_i/P_i<a name='11853'>
<a name='11854'>
return<a name='11855'>
end function COLUMN_CAP_ZERO<a name='11856'>
<a name='11857'>
<font color=#447700>! end of column_cap_zero function<a name='11858'></font>
<font color=#447700>!====================================================================<a name='11859'></font>
<A NAME='PLANAR_CAP_ZERO'><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11860'>
<font color=#993300>FUNCTION </font><font color=#cc0000>PLANAR_CAP_ZERO</font> (fm_ice, AR_ice, rho_ice, FLstar) <A href='../../call_to/PLANAR_CAP_ZERO.html' TARGET='index'>3</A>,<A href='../../call_from/PLANAR_CAP_ZERO.html' TARGET='index'>3</A><a name='11861'>
<a name='11862'>
implicit double precision (a-h,o-z)<a name='11863'>
<a name='11864'>
PARAMETER(PI = 3.141592654D0)<a name='11865'>
<a name='11866'>
<font color=#447700>! new change 29.06.04                                         (start)<a name='11867'></font>
<a name='11868'>
<font color=#447700>!INTRINSIC DLOG, DSIN<a name='11869'></font>
INTRINSIC DLOG, DASIN<a name='11870'>
<a name='11871'>
<font color=#447700>! new change 29.06.04                                           (end)<a name='11872'></font>
<a name='11873'>
a_ix = (fm_ice/rho_ice)/(4.D0*PI*AR_ice/3.D0)<a name='11874'>
a_ix = a_ix**(1.D0/3.D0)<a name='11875'>
<a name='11876'>
if(AR_ice &lt; 0.D0.or.AR_ice &gt; 1.D0) then<a name='11877'>
 call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_855">("fatal error in module_mp_full_sbm , model stop 9022")<a name='11878'>
endif<a name='11879'>
<a name='11880'>
epsil_i = 1.D0 - AR_ice*AR_ice<a name='11881'>
<a name='11882'>
if( epsil_i &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_856">("fatal error in module_mp_full_sbm , model stop 9086")<a name='11883'>
<a name='11884'>
epsil_i = epsil_i**0.5D0<a name='11885'>
<a name='11886'>
if(epsil_i &gt; 0.D0) then<a name='11887'>
<a name='11888'>
<font color=#447700>! new change 29.06.04                                         (start)<a name='11889'></font>
<a name='11890'>
<font color=#447700>!  PLANAR_CAP_ZERO = a_ix*epsil_i/DSIN(epsil_i)<a name='11891'></font>
  PLANAR_CAP_ZERO = a_ix*epsil_i/DASIN(epsil_i)<a name='11892'>
<a name='11893'>
<font color=#447700>! new change 29.06.04                                           (end)<a name='11894'></font>
<a name='11895'>
  if((1.D0+epsil_i)/(1.D0-epsil_i).le.0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#PLANAR_CAP_ZERO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_857">("fatal error in module_mp_full_sbm , model stop 9054")<a name='11896'>
<a name='11897'>
  omega_i = DLOG((1.D0+ epsil_i)/( 1.D0- epsil_i))<a name='11898'>
  omega_i = 2.D0 + PI*AR_ice*(1.D0/epsil_i)*omega_i<a name='11899'>
  omega_i = PI*a_ix*a_ix*omega_i<a name='11900'>
<a name='11901'>
  P_i = 2.D0*PI*a_ix<a name='11902'>
  FLstar = omega_i/P_i<a name='11903'>
<a name='11904'>
else<a name='11905'>
<a name='11906'>
  PLANAR_CAP_ZERO = a_ix<a name='11907'>
  FLstar = 2.D0*a_ix<a name='11908'>
<a name='11909'>
endif<a name='11910'>
<a name='11911'>
return<a name='11912'>
end function PLANAR_CAP_ZERO<a name='11913'>
<a name='11914'>
<font color=#447700>! end of planar_cap_zero function<a name='11915'></font>
<font color=#447700>!====================================================================<a name='11916'></font>
<A NAME='RAD_SPHERE'><A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='11917'>
<font color=#993300>FUNCTION </font><font color=#cc0000>rad_sphere</font> (volume) <A href='../../call_to/RAD_SPHERE.html' TARGET='index'>17</A><a name='11918'>
<a name='11919'>
implicit double precision (a-h,o-z)<a name='11920'>
<a name='11921'>
PARAMETER(PI = 3.141592654D0)<a name='11922'>
<a name='11923'>
rad_sphere = volume/(4.D0*PI/3.D0)<a name='11924'>
rad_sphere = rad_sphere**(1.D0/3.D0)<a name='11925'>
<a name='11926'>
return<a name='11927'>
end FUNCTION rad_sphere<a name='11928'>
<a name='11929'>
<font color=#447700>! end of rad_sphere function<a name='11930'></font>
<font color=#447700>!====================================================================<a name='11931'></font>
<A NAME='THERMODYNAMICAL_LIMITS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#THERMODYNAMICAL_LIMITS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11932'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>thermodynamical_limits</font> &amp; <A href='../../call_to/THERMODYNAMICAL_LIMITS.html' TARGET='index'>4</A><a name='11933'>
(FFX, fm_tot, rhoax, XLFOCP, tempx, dmeltx)<a name='11934'>
<a name='11935'>
implicit double precision (a-h,o-z)<a name='11936'>
<a name='11937'>
PARAMETER (COL=0.23105D0)<a name='11938'>
<a name='11939'>
<font color=#447700>! control in main program &amp; others subroutines<a name='11940'></font>
<a name='11941'>
<font color=#447700>! new change 29.10.08                                         (start)           <a name='11942'></font>
<a name='11943'>
<a name='11944'>
<font color=#447700>! new change 29.10.08                                           (end)<a name='11945'></font>
<a name='11946'>
<a name='11947'>
<a name='11948'>
<font color=#447700>! PROBLEMS HERE: is "fnumber_MR" correct<a name='11949'></font>
<font color=#447700>! for the particle number mixing ratio ( /m3) ?<a name='11950'></font>
<a name='11951'>
<a name='11952'>
<a name='11953'>
fnumber_MR = 3.D0*FFX*fm_tot*COL/rhoax<a name='11954'>
<a name='11955'>
Q_ICE_MELTED = dmeltx*fnumber_MR<a name='11956'>
<a name='11957'>
temp_star = tempx - XLFOCP*Q_ICE_MELTED<a name='11958'>
<a name='11959'>
if(temp_star &lt; 273.15D0) then<a name='11960'>
<a name='11961'>
  Q_ICE_MELTED = (tempx - 273.15D0)/XLFOCP<a name='11962'>
  dmeltx = Q_ICE_MELTED / fnumber_MR<a name='11963'>
  tempx = 273.15D0<a name='11964'>
<a name='11965'>
<font color=#447700>! in case temp_star &lt; 273.15D0<a name='11966'></font>
<a name='11967'>
else<a name='11968'>
<a name='11969'>
<font color=#447700>! in case temp_star &gt;= 273.15D0<a name='11970'></font>
<a name='11971'>
  tempx = temp_star<a name='11972'>
<a name='11973'>
<a name='11974'>
endif<a name='11975'>
<a name='11976'>
101 FORMAT(1X,D13.5)<a name='11977'>
102 FORMAT(1X,2D13.5)<a name='11978'>
103 FORMAT(1X,3D13.5)<a name='11979'>
104 FORMAT(1X,4D13.5)<a name='11980'>
105 FORMAT(1X,5D13.5)<a name='11981'>
106 FORMAT(1X,6D13.5)<a name='11982'>
<a name='11983'>
END SUBROUTINE thermodynamical_limits<a name='11984'>
<a name='11985'>
<font color=#447700>! end of thermodynamical_limits subroutine<a name='11986'></font>
<font color=#447700>!====================================================================<a name='11987'></font>
<A NAME='FMASS_LIMITS'><A href='../../html_code/phys/module_mp_full_sbm.F.html#FMASS_LIMITS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11988'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>fmass_limits</font> (dmeltx, ficemassx, fm_water, fm_tot) <A href='../../call_to/FMASS_LIMITS.html' TARGET='index'>4</A><a name='11989'>
<a name='11990'>
implicit double precision (a-h,o-z)<a name='11991'>
<a name='11992'>
INTRINSIC DABS<a name='11993'>
<a name='11994'>
<font color=#447700>! new change 29.10.08                                         (start)           <a name='11995'></font>
<a name='11996'>
<a name='11997'>
<font color=#447700>! new change 29.10.08                                           (end)<a name='11998'></font>
<a name='11999'>
if(dmeltx &gt; ficemassx) then<a name='12000'>
  dmeltx = ficemassx<a name='12001'>
endif<a name='12002'>
<a name='12003'>
if(dmeltx &lt; 0.D0.and.DABS(dmeltx) &gt; fm_water) then<a name='12004'>
        dmeltx = - fm_water<a name='12005'>
endif<a name='12006'>
<a name='12007'>
if(ficemassx - dmeltx &gt; fm_tot) then<a name='12008'>
  dmeltx = ficemassx - fm_tot<a name='12009'>
endif<a name='12010'>
<a name='12011'>
<a name='12012'>
101 FORMAT(1X,D13.5)<a name='12013'>
102 FORMAT(1X,2D13.5)<a name='12014'>
103 FORMAT(1X,3D13.5)<a name='12015'>
104 FORMAT(1X,4D13.5)<a name='12016'>
105 FORMAT(1X,5D13.5)<a name='12017'>
106 FORMAT(1X,6D13.5)<a name='12018'>
<a name='12019'>
end subroutine fmass_limits<a name='12020'>
<a name='12021'>
<font color=#447700>! end of fmass_limits subroutine<a name='12022'></font>
<font color=#447700>! Version of 3.06.04<a name='12023'></font>
<a name='12024'>
<font color=#447700>! new size distribution functions after evaporation<a name='12025'></font>
<a name='12026'>
<A NAME='JERDFUN_MELT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12027'>
	<font color=#993300>SUBROUTINE </font><font color=#cc0000>JERDFUN_MELT</font> &amp;,<A href='../../call_from/JERDFUN_MELT.html' TARGET='index'>1</A><a name='12028'>
<a name='12029'>
     &amp; (R2,R2N&amp;<a name='12030'>
     &amp; ,FI2,PSI2&amp;<a name='12031'>
     &amp; ,FL2_OLD,FL2_NEW&amp;<a name='12032'>
     &amp; ,IND,ITYPE)<a name='12033'>
<font color=#447700>! new change 29.09.10                                          (end)<a name='12034'></font>
       implicit none     <a name='12035'>
<font color=#447700>!       implicit double precision (a-h,o-z)<a name='12036'></font>
       REAL DEL2N<a name='12037'>
<a name='12038'>
      INTEGER IND,ITYPE,KR,ICE,ITYP,NRM,NR,IDROP<a name='12039'>
      INTEGER NRX,I_3POINT,ICE_TYPE<a name='12040'>
     <a name='12041'>
<a name='12042'>
<font color=#447700>! include file<a name='12043'></font>
<a name='12044'>
<font color=#447700>!INCLUDE 'MICRO.PRM'<a name='12045'></font>
<a name='12046'>
 REAL &amp;<a name='12047'>
     &amp;  R2(NKR,IND),R2N(NKR,IND) &amp;<a name='12048'>
     &amp; ,FI2(NKR,IND),PSI2(NKR,IND) &amp;<a name='12049'>
     &amp; ,FL2_OLD(NKR,IND),FL2_NEW(NKR,IND)<a name='12050'>
<a name='12051'>
<font color=#447700>! work arrays<a name='12052'></font>
<font color=#447700>!      DOUBLE PRECISION TPN<a name='12053'></font>
<font color=#447700>!      DOUBLE PRECISION  B21_MY(NKR,IND)<a name='12054'></font>
        DOUBLE PRECISION R2R(NKR),R2NR(NKR),FI2R(NKR),PSI2R(NKR)<a name='12055'>
        DOUBLE PRECISION DR2(NKR,IND),DR2N(NKR,IND)<a name='12056'>
<a name='12057'>
	DOUBLE PRECISION FL2R_OLD(NKR),FL2R_NEW(NKR)<a name='12058'>
<a name='12059'>
        NRX=NKR<a name='12060'>
<a name='12061'>
	IF(IND.NE.1) THEN<a name='12062'>
	  ITYP=ITYPE<a name='12063'>
        ELSE<a name='12064'>
	  ITYP=1<a name='12065'>
	ENDIF<a name='12066'>
<a name='12067'>
<font color=#447700>! recalculation of size distribution functions                (start)<a name='12068'></font>
<a name='12069'>
	DO ICE_TYPE=1,IND<a name='12070'>
<a name='12071'>
	   IF(ITYP.EQ.ICE_TYPE) THEN<a name='12072'>
<a name='12073'>
             DO KR=1,NKR<a name='12074'>
<a name='12075'>
	        R2R(KR)=R2(KR,ICE_TYPE)<a name='12076'>
	        R2NR(KR)=R2N(KR,ICE_TYPE)               <a name='12077'>
                FI2R(KR)=FI2(KR,ICE_TYPE)<a name='12078'>
                PSI2R(KR)=FI2R(KR)<a name='12079'>
                FL2R_OLD(KR)=FL2_OLD(KR,ICE_TYPE)<a name='12080'>
                FL2R_NEW(KR)=FL2R_OLD(KR)<a name='12081'>
                <a name='12082'>
             ENDDO<a name='12083'>
<a name='12084'>
<a name='12085'>
<font color=#447700>! new size distribution functions after evaporatiion          (start)<a name='12086'></font>
<a name='12087'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12088'></font>
             I_3POINT=0<a name='12089'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12090'></font>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT'>JERNEWF_MELT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNEWF_MELT_1">(NRX,R2R,R2NR,FI2R,PSI2R,FL2R_OLD,FL2R_NEW,I_3POINT)<a name='12091'>
<a name='12092'>
	     DO KR=1,NKR                              <a name='12093'>
	        PSI2(KR,ICE_TYPE)=PSI2R(KR)<a name='12094'>
                FL2_NEW(KR,ICE_TYPE)=FL2R_NEW(KR)<a name='12095'>
	     ENDDO<a name='12096'>
<a name='12097'>
<a name='12098'>
<font color=#447700>! in case ITYP.EQ.ICE_TYPE<a name='12099'></font>
<a name='12100'>
	   ENDIF<a name='12101'>
<a name='12102'>
        ENDDO<a name='12103'>
<a name='12104'>
<font color=#447700>! cycle by ICE_TYPE<a name='12105'></font>
<a name='12106'>
<font color=#447700>! recalculation of size distribution functions                  (end)<a name='12107'></font>
<a name='12108'>
<font color=#447700>! new size distribution functions                               (end)<a name='12109'></font>
<a name='12110'>
 128    FORMAT(1X,I2,2D13.5) <a name='12111'>
<a name='12112'>
	RETURN<a name='12113'>
	END SUBROUTINE JERDFUN_MELT<a name='12114'>
<a name='12115'>
<font color=#447700>! end of SUBROUTINE JERDFUN_MELT<a name='12116'></font>
<A NAME='JERNEWF_MELT'><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12117'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERNEWF_MELT</font> &amp; <A href='../../call_to/JERNEWF_MELT.html' TARGET='index'>1</A>,<A href='../../call_from/JERNEWF_MELT.html' TARGET='index'>5</A><a name='12118'>
<font color=#447700>! new change 27.10.08                                         (start)<a name='12119'></font>
       (NRX,RR,RN,FI,PSI,FL_OLD,FL_NEW,I3POINT)<a name='12120'>
 <a name='12121'>
        IMPLICIT NONE<a name='12122'>
<a name='12123'>
        INTEGER &amp; <a name='12124'>
        KR<a name='12125'>
<a name='12126'>
<a name='12127'>
        INTEGER &amp; <a name='12128'>
        I,K,NRXP,I3POINT<a name='12129'>
<a name='12130'>
<font color=#447700>! new change 10.06.06                                         (start)<a name='12131'></font>
        INTEGER &amp; <a name='12132'>
        ISIGN_DIFFUSIONAL_GROWTH<a name='12133'>
<font color=#447700>! new change 10.06.06                                           (end)<a name='12134'></font>
 <a name='12135'>
        DOUBLE PRECISION &amp;<a name='12136'>
	AOLDCON,ANEWCON,AOLDMASS,ANEWMASS<a name='12137'>
<a name='12138'>
        DOUBLE PRECISION &amp;<a name='12139'>
        RNTMP,RRTMP,RRP,RRM,RNTMP2,RRTMP2,RRP2,RRM2, &amp;<a name='12140'>
        GN1,GN2,GN3,GN1P,GMAT,GMAT2<a name='12141'>
<a name='12142'>
        INTEGER &amp; <a name='12143'>
        NRX<a name='12144'>
<a name='12145'>
        DOUBLE PRECISION &amp; <a name='12146'>
        RR(NRX),FI(NRX),PSI(NRX),RN(NRX) &amp;<a name='12147'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12148'></font>
       ,RRS(NRX+1),PSINEW(NRX+1)<a name='12149'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12150'></font>
<a name='12151'>
        DOUBLE PRECISION &amp; <a name='12152'>
        FL_OLD(NRX),FL_NEW(NRX)<a name='12153'>
<a name='12154'>
        DOUBLE PRECISION &amp; <a name='12155'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12156'></font>
        DROPMASS(NRX+1)<a name='12157'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12158'></font>
<a name='12159'>
        DOUBLE PRECISION &amp; <a name='12160'>
        PSI_IM,PSI_I,PSI_IP<a name='12161'>
<a name='12162'>
<font color=#447700>! INITIAL VALUES FOR SOME VARIABLES<a name='12163'></font>
 <a name='12164'>
	NRXP=NRX+1<a name='12165'>
<a name='12166'>
        DO I=1,NRX<a name='12167'>
<a name='12168'>
<font color=#447700>! RN(I), g - new masses after condensation or evaporation<a name='12169'></font>
<a name='12170'>
           IF(RN(I).LT.0.0D0) THEN <a name='12171'>
             RN(I)=1.0D-50<a name='12172'>
	     FI(I)=0.0D0<a name='12173'>
           ENDIF<a name='12174'>
<a name='12175'>
        ENDDO<a name='12176'>
<a name='12177'>
	DO K=1,NRX<a name='12178'>
	   PSI(K)=0.0D0<a name='12179'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12180'></font>
	   PSINEW(K)=0.0D0<a name='12181'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12182'></font>
	   RRS(K)=RR(K)<a name='12183'>
           DROPMASS(K)=0.0D0<a name='12184'>
	ENDDO<a name='12185'>
	<a name='12186'>
        RRS(NRXP)=RRS(NRX)*1024.0D0<a name='12187'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12188'></font>
        PSINEW(NRXP)=0.0D0<a name='12189'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12190'></font>
<a name='12191'>
<font color=#447700>! new change 7.05.07                                         (start)<a name='12192'></font>
        DROPMASS(NRXP)=0.0D0<a name='12193'>
<font color=#447700>! new change 7.05.07                                           (end)<a name='12194'></font>
 <a name='12195'>
<font color=#447700>! new change 10.06.06                                         (start)<a name='12196'></font>
<a name='12197'>
        ISIGN_DIFFUSIONAL_GROWTH=0<a name='12198'>
<a name='12199'>
	DO K=1,NRX<a name='12200'>
           IF(RN(K).NE.RR(K)) THEN<a name='12201'>
              ISIGN_DIFFUSIONAL_GROWTH=1<a name='12202'>
              GOTO 2000<a name='12203'>
           ENDIF<a name='12204'>
        ENDDO<a name='12205'>
<a name='12206'>
 2000   CONTINUE<a name='12207'>
       <a name='12208'>
        IF(ISIGN_DIFFUSIONAL_GROWTH.NE.0) THEN<a name='12209'>
<a name='12210'>
<font color=#447700>! new change 10.06.06                                           (end)<a name='12211'></font>
<a name='12212'>
<font color=#447700>! Kovetz-Olund method                                         (start)<a name='12213'></font>
<a name='12214'>
	  DO K=1,NRX<a name='12215'>
<a name='12216'>
             IF(FI(K).NE.0.0D0) THEN<a name='12217'>
<a name='12218'>
               I=1<a name='12219'>
<a name='12220'>
               DO WHILE &amp;<a name='12221'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12222'></font>
                (.NOT.(RRS(I).LE.RN(K).AND.RRS(I+1).GT.RN(K)) &amp;<a name='12223'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12224'></font>
                 .AND.I.LT.NRX)<a name='12225'>
                  I=I+1<a name='12226'>
	       ENDDO<a name='12227'>
<a name='12228'>
	       IF(RN(K).LT.RRS(1)) THEN<a name='12229'>
<a name='12230'>
                 RNTMP=RN(K)<a name='12231'>
                 RRTMP=0.0D0<a name='12232'>
                 RRP=RRS(1)<a name='12233'>
    	         GMAT2=(RNTMP-RRTMP)/(RRP-RRTMP)<a name='12234'>
<font color=#447700>! new change 13.06.06                                         (start)<a name='12235'></font>
                 PSINEW(1)=PSINEW(1)+FI(K)*RR(K)*GMAT2<a name='12236'>
                 DROPMASS(1)= &amp;<a name='12237'>
                 DROPMASS(1)+FL_OLD(K)*RR(1)*FI(K)*RR(K)*GMAT2<a name='12238'>
<font color=#447700>! new change 13.06.06                                           (end)<a name='12239'></font>
<a name='12240'>
               ELSE<a name='12241'>
<a name='12242'>
                 RNTMP=RN(K)<a name='12243'>
                 RRTMP=RRS(I)<a name='12244'>
                 RRP=RRS(I+1)<a name='12245'>
	         GMAT2=(RNTMP-RRTMP)/(RRP-RRTMP)<a name='12246'>
	         GMAT=(RRP-RNTMP)/(RRP-RRTMP)<a name='12247'>
<font color=#447700>! new change 13.06.06                                         (start)<a name='12248'></font>
                 PSINEW(I)=PSINEW(I)+FI(K)*RR(K)*GMAT<a name='12249'>
                 PSINEW(I+1)=PSINEW(I+1)+FI(K)*RR(K)*GMAT2<a name='12250'>
<a name='12251'>
                 DROPMASS(I)= &amp;<a name='12252'>
                 DROPMASS(I)+FL_OLD(K)*RR(I)*FI(K)*RR(K)*GMAT<a name='12253'>
<font color=#447700>! new change 7.05.07                                         (start)<a name='12254'></font>
<font color=#447700>!                 DROPMASS(I+1)= &amp;<a name='12255'></font>
<font color=#447700>!                 DROPMASS(I+1)+FL_OLD(K)*RR(I+1)*FI(K)*RR(K)*GMAT2<a name='12256'></font>
                 DROPMASS(I+1)= &amp;<a name='12257'>
                 DROPMASS(I+1)+FL_OLD(K)*RRS(I+1)*FI(K)*RR(K)*GMAT2<a name='12258'>
<font color=#447700>! new change 7.05.07                                         (start)<a name='12259'></font>
<font color=#447700>! new change 13.06.06                                           (end)<a name='12260'></font>
<a name='12261'>
               ENDIF<a name='12262'>
<a name='12263'>
<font color=#447700>! in case FI(K).NE.0.0D0<a name='12264'></font>
<a name='12265'>
             ENDIF<a name='12266'>
<a name='12267'>
	  ENDDO<a name='12268'>
<a name='12269'>
<font color=#447700>! cycle by K<a name='12270'></font>
<a name='12271'>
          DO I=1,NRX<a name='12272'>
<font color=#447700>! new change 12.06.06                                         (start)<a name='12273'></font>
             PSI(I)=PSINEW(I)<a name='12274'>
<font color=#447700>! new change 12.06.06                                           (end)<a name='12275'></font>
             IF(PSI(I).NE.0.D0) THEN<a name='12276'>
               FL_NEW(I)=DROPMASS(I)/RR(I)/PSI(I)<a name='12277'>
             ELSE<a name='12278'>
<font color=#447700>! new change 19.03.08                                         (start)<a name='12279'></font>
<font color=#447700>!               FL_NEW(I)=1.0D0<a name='12280'></font>
               FL_NEW(I)=0.0D0<a name='12281'>
<font color=#447700>! new change 19.03.08                                           (end)<a name='12282'></font>
             ENDIF<a name='12283'>
          ENDDO<a name='12284'>
               <a name='12285'>
<font color=#447700>! Kovetz-Olund method                                           (end)<a name='12286'></font>
<a name='12287'>
<font color=#447700>! calculation both new total drop concentrations(after KO) and new <a name='12288'></font>
<font color=#447700>! total drop masses (after KO)<a name='12289'></font>
<a name='12290'>
	  AOLDCON=0.0D0<a name='12291'>
	  ANEWCON=0.0D0<a name='12292'>
	  AOLDMASS=0.0D0<a name='12293'>
	  ANEWMASS=0.0D0<a name='12294'>
	<a name='12295'>
	  DO K=1,NRX<a name='12296'>
	     AOLDCON=AOLDCON+FI(K)*RR(K)<a name='12297'>
	     ANEWCON=ANEWCON+PSI(K)<a name='12298'>
	     AOLDMASS=AOLDMASS+FI(K)*RR(K)*RN(K)<a name='12299'>
	     ANEWMASS=ANEWMASS+PSI(K)*RR(K)<a name='12300'>
	  ENDDO<a name='12301'>
	  <a name='12302'>
<font color=#447700>! new change 29.04.08                                         (start)                     <a name='12303'></font>
<font color=#447700>!          IF(I3POINT.NE.0) THEN<a name='12304'></font>
          IF(I3POINT.NE.0) GOTO 2001<a name='12305'>
<font color=#447700>! new change 29.04.08                                           (end)<a name='12306'></font>
 <a name='12307'>
	    DO K=1,NRX<a name='12308'>
<a name='12309'>
               IF(FI(K).NE.0.0D0) THEN<a name='12310'>
<a name='12311'>
                 IF(RRS(2).LT.RN(K)) THEN<a name='12312'>
 <a name='12313'>
                   I=2<a name='12314'>
<a name='12315'>
                   DO  WHILE &amp;<a name='12316'>
                     (.NOT.(RRS(I).LT.RN(K).AND.RRS(I+1).GT.RN(K)) &amp;<a name='12317'>
                      .AND.I.LT.NRX)<a name='12318'>
                       I=I+1<a name='12319'>
	           ENDDO<a name='12320'>
<a name='12321'>
                   IF(I.LT.NRX-2) THEN<a name='12322'>
<a name='12323'>
                     RNTMP=RN(K)<a name='12324'>
<a name='12325'>
                     RRTMP=RRS(I)<a name='12326'>
                     RRP=RRS(I+1)<a name='12327'>
                     RRM=RRS(I-1)<a name='12328'>
 <a name='12329'>
                     RNTMP2=RN(K+1)<a name='12330'>
<a name='12331'>
                     RRTMP2=RRS(I+1)<a name='12332'>
                     RRP2=RRS(I+2)<a name='12333'>
                     RRM2=RRS(I)<a name='12334'>
 <a name='12335'>
                     GN1=(RRP-RNTMP)*(RRTMP-RNTMP)/(RRP-RRM)/ &amp;<a name='12336'>
                         (RRTMP-RRM)<a name='12337'>
<a name='12338'>
                     GN1P=(RRP2-RNTMP2)*(RRTMP2-RNTMP2)/ &amp;<a name='12339'>
                          (RRP2-RRM2)/(RRTMP2-RRM2)<a name='12340'>
<a name='12341'>
                     GN2=(RRP-RNTMP)*(RNTMP-RRM)/(RRP-RRTMP)/ &amp;<a name='12342'>
                         (RRTMP-RRM)<a name='12343'>
 <a name='12344'>
	             GMAT=(RRP-RNTMP)/(RRP-RRTMP)<a name='12345'>
<a name='12346'>
                     GN3=(RRTMP-RNTMP)*(RRM-RNTMP)/(RRP-RRM)/ &amp;<a name='12347'>
                                                 (RRP-RRTMP)<a name='12348'>
	             GMAT2=(RNTMP-RRTMP)/(RRP-RRTMP)<a name='12349'>
<a name='12350'>
                     PSI_IM=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_18">(I-1)+GN1*FI(K)*RR(K)<a name='12351'>
                     PSI_I=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_19">(I)+(GN1P+GN2-GMAT)*FI(K+1)*RR(K+1)<a name='12352'>
                     PSI_IP=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_20">(I+1)+(GN3-GMAT2)*FI(K)*RR(K)<a name='12353'>
                    <a name='12354'>
                     IF(PSI_IM.GT.0.0D0) THEN<a name='12355'>
<a name='12356'>
                       IF(PSI_IP.GT.0.0D0) THEN<a name='12357'>
<a name='12358'>
                         IF(I.GT.2) THEN<a name='12359'>
<font color=#447700>! smoothing criteria<a name='12360'></font>
                           IF(PSI_IM.GT.PSI(I-2) &amp;<a name='12361'>
                          .AND.PSI_IM.LT.PSI_I &amp;<a name='12362'>
                          .AND.PSI(I-2).LT.PSI(I) &amp;<a name='12363'>
                          .OR.PSI(I-2).GE.PSI(I)) THEN<a name='12364'>
<a name='12365'>
                             PSI(I-1)=PSI_IM<a name='12366'>
<a name='12367'>
                             PSI(I)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_21">(I)+FI(K)*RR(K)*(GN2-GMAT)<a name='12368'>
<a name='12369'>
                             PSI(I+1)=PSI_IP<a name='12370'>
<font color=#447700>! in case smoothing criteria<a name='12371'></font>
                           ENDIF <a name='12372'>
<font color=#447700>! in case I.GT.2<a name='12373'></font>
                         ENDIF<a name='12374'>
<a name='12375'>
<font color=#447700>! in case PSI_IP.GT.0.0D0<a name='12376'></font>
<a name='12377'>
	               ENDIF<a name='12378'>
<a name='12379'>
<font color=#447700>! in case PSI_IM.GT.0.0D0<a name='12380'></font>
<a name='12381'>
	             ENDIF<a name='12382'>
<font color=#447700>! in case I.LT.NRX-2<a name='12383'></font>
                   ENDIF<a name='12384'>
<a name='12385'>
<font color=#447700>! in case RRS(2).LT.RN(K)<a name='12386'></font>
<a name='12387'>
                 ENDIF<a name='12388'>
 <a name='12389'>
<font color=#447700>! in case FI(K).NE.0.0D0<a name='12390'></font>
<a name='12391'>
               ENDIF<a name='12392'>
<a name='12393'>
 1000          CONTINUE<a name='12394'>
<a name='12395'>
	    ENDDO<a name='12396'>
<font color=#447700>! cycle by K<a name='12397'></font>
	    AOLDCON=0.0D0<a name='12398'>
	    ANEWCON=0.0D0<a name='12399'>
	    AOLDMASS=0.0D0<a name='12400'>
	    ANEWMASS=0.0D0<a name='12401'>
<a name='12402'>
	    DO K=1,NRX<a name='12403'>
	       AOLDCON=AOLDCON+FI(K)*RR(K)<a name='12404'>
	       ANEWCON=ANEWCON+PSI(K)<a name='12405'>
	       AOLDMASS=AOLDMASS+FI(K)*RR(K)*RN(K)<a name='12406'>
	       ANEWMASS=ANEWMASS+PSI(K)*RR(K)<a name='12407'>
	    ENDDO<a name='12408'>
<a name='12409'>
<font color=#447700>! 3 point method                                                (end)<a name='12410'></font>
<a name='12411'>
<font color=#447700>! new change 29.04.08                                         (start)                     <a name='12412'></font>
<a name='12413'>
<font color=#447700>! in case I3POINT.NE.0<a name='12414'></font>
<a name='12415'>
<font color=#447700>!	  ENDIF<a name='12416'></font>
<a name='12417'>
 2001     CONTINUE<a name='12418'>
<a name='12419'>
<font color=#447700>! new change 29.04.08                                           (end)<a name='12420'></font>
<a name='12421'>
<font color=#447700>! PSI(K) - new hydrometeor size distribution function<a name='12422'></font>
<a name='12423'>
	  DO K=1,NRX<a name='12424'>
	     PSI(K)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF_MELT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_22">(K)/RR(K)<a name='12425'>
	  ENDDO<a name='12426'>
<a name='12427'>
<font color=#447700>! new change 10.06.06                                         (start)<a name='12428'></font>
<a name='12429'>
<font color=#447700>! in case ISIGN_DIFFUSIONAL_GROWTH.NE.0<a name='12430'></font>
<a name='12431'>
        ELSE<a name='12432'>
<a name='12433'>
<font color=#447700>! in case ISIGN_DIFFUSIONAL_GROWTH.EQ.0<a name='12434'></font>
<a name='12435'>
<font color=#447700>! new change 10.06.06                                           (end)<a name='12436'></font>
<a name='12437'>
	  DO K=1,NRX<a name='12438'>
	     PSI(K)=FI(K)<a name='12439'>
	  ENDDO<a name='12440'>
<a name='12441'>
        ENDIF<a name='12442'>
<a name='12443'>
<a name='12444'>
  201	FORMAT(1X,D13.5)<a name='12445'>
  202	FORMAT(1X,2D13.5)<a name='12446'>
  203	FORMAT(1X,3D13.5)<a name='12447'>
  204	FORMAT(1X,4D13.5)<a name='12448'>
  205	FORMAT(1X,5D13.5)<a name='12449'>
  206	FORMAT(1X,6D13.5)<a name='12450'>
  301   FORMAT(1X,I2,2X,D13.5)<a name='12451'>
  302   FORMAT(1X,I2,2X,2D13.5)<a name='12452'>
  303   FORMAT(1X,I2,2X,3D13.5)<a name='12453'>
  304   FORMAT(1X,I2,2X,4D13.5)<a name='12454'>
  305   FORMAT(1X,I2,2X,5D13.5)<a name='12455'>
  306   FORMAT(1X,I2,2X,6D13.5)<a name='12456'>
<a name='12457'>
        RETURN <a name='12458'>
        END SUBROUTINE JERNEWF_MELT<a name='12459'>
<a name='12460'>
<font color=#447700>! SUBROUTINE JERNEWF_MELT<a name='12461'></font>
<font color=#447700>! Version of 10.02.08 <a name='12462'></font>
<a name='12463'>
<font color=#447700>! new changes 10.02.08                                       (start)<a name='12464'></font>
<a name='12465'>
<A NAME='SHEDDING'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12466'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>SHEDDING</font> &amp;,<A href='../../call_from/SHEDDING.html' TARGET='index'>24</A><a name='12467'>
<a name='12468'>
(ihucm_flag&amp;<a name='12469'>
<a name='12470'>
,FF1,XL,VTL &amp;<a name='12471'>
,FF4,XG,V4,VTG,FLIQFR_G,RHO_G &amp;<a name='12472'>
,FF5,XH,V5,VTH,FLIQFR_H,RHO_H &amp;<a name='12473'>
,TIN,rhoa,pres,DT,QQV)<a name='12474'>
<font color=#447700>! new changes 25.01.08                                         (end)<a name='12475'></font>
<a name='12476'>
<font color=#447700>! new changes 10.02.08                                         (end)<a name='12477'></font>
<a name='12478'>
<font color=#447700>!===============================================!<a name='12479'></font>
<font color=#447700>! EXPLICIT MELTING SCHEME                       !<a name='12480'></font>
<font color=#447700>! Author: Vaughan T.J. PHILLIPS, August 2004    !<a name='12481'></font>
<font color=#447700>! at Princeton University (AOS program)         !<a name='12482'></font>
<font color=#447700>! and GFDL, NOAA/OAR, USA                       !<a name='12483'></font>
<font color=#447700>!===============================================!<a name='12484'></font>
<a name='12485'>
implicit double precision (a-h,o-z)<a name='12486'>
<a name='12487'>
<font color=#447700>!PARAMETER(NKR=33, NK=129, ICEMAX=3)<a name='12488'></font>
<a name='12489'>
<font color=#447700>! new changes 25.01.08                                       (start)<a name='12490'></font>
<a name='12491'>
PARAMETER(COL=0.23105D0, CP=1004.7D0, RV=461.51D0, RD=287.039D0, &amp;<a name='12492'>
          EPS=RD/RV, FJOULES_IN_A_CAL=4.187D0, PI=3.141592654D0, &amp;<a name='12493'>
          AR_LIM=2.D0, GRAV=9.8D0, RHO_ICE=920.D0, &amp;<a name='12494'>
          RHO_WATER=1000.D0, FLIQFRAC_LIM=0.9D0, &amp;<a name='12495'>
          PETIT_PARAMETRE=1.D-10)<a name='12496'>
	  <a name='12497'>
<font color=#447700>! new changes 12.02.08                                       (start)<a name='12498'></font>
PARAMETER(ISHEDDING_ON=1, IVT_ADJUST=1, IPRINTING=0, &amp;<a name='12499'>
          ITEMP_ADJUST=1, IEVAP_ADJUST=1, ISUBLIME_ADJUST=1)<a name='12500'>
<font color=#447700>! new changes 12.02.08                                         (end)<a name='12501'></font>
<a name='12502'>
<font color=#447700>! new changes 25.01.08                                         (end)<a name='12503'></font>
<a name='12504'>
<font color=#447700>! control in main program &amp; others subroutines<a name='12505'></font>
<a name='12506'>
<font color=#447700>! new changes 12.02.08                                       (start)<a name='12507'></font>
<a name='12508'>
DIMENSION FF1(NKR), XL(NKR), VTL(NKR)<a name='12509'>
<a name='12510'>
<font color=#447700>! new changes 10.02.08                                         (end)<a name='12511'></font>
<a name='12512'>
DIMENSION FF4(NKR),XG(NKR),V4(NKR), &amp;<a name='12513'>
          VTG(NKR),FLIQFR_G(NKR),RHO_G(NKR)<a name='12514'>
<a name='12515'>
DIMENSION FF5(NKR),XH(NKR),V5(NKR), &amp;<a name='12516'>
          VTH(NKR),FLIQFR_H(NKR),RHO_H(NKR)<a name='12517'>
<a name='12518'>
DIMENSION FF1_SI(NKR), XL_SI(NKR), &amp; <a name='12519'>
          VTL_SI(NKR)<a name='12520'>
<a name='12521'>
DIMENSION FF4_SI(NKR),XG_SI(NKR),V4_SI(NKR), &amp;<a name='12522'>
          VTG_SI(NKR), RHO_G_SI(NKR)<a name='12523'>
<a name='12524'>
DIMENSION FF5_SI(NKR),XH_SI(NKR),V5_SI(NKR), &amp;<a name='12525'>
          VTH_SI(NKR), RHO_H_SI(NKR)<a name='12526'>
	  <a name='12527'>
INTRINSIC SUM<a name='12528'>
<a name='12529'>
<a name='12530'>
If(TIN &lt;= 273.15D0) then<a name='12531'>
  RETURN<a name='12532'>
ENDIF<a name='12533'>
<a name='12534'>
if(SUM(FF4) &lt;= 0.D0.and.SUM(FF5) &lt;= 0.D0) then<a name='12535'>
<a name='12536'>
  return<a name='12537'>
  <a name='12538'>
endif<a name='12539'>
<a name='12540'>
<font color=#447700>!=============================================================<a name='12541'></font>
<font color=#447700>!       UNIT CONVERSION OF ALL INPUTS to SI<a name='12542'></font>
<font color=#447700>!=============================================================<a name='12543'></font>
<a name='12544'>
if(ihucm_flag == 1) then<a name='12545'>
<a name='12546'>
RHO_G_SI = RHO_G*1000.D0<a name='12547'>
RHO_H_SI = RHO_H*1000.D0<a name='12548'>
<a name='12549'>
XL_SI = XL/1000.D0<a name='12550'>
XG_SI = XG/1000.D0<a name='12551'>
XH_SI = XH/1000.D0<a name='12552'>
<a name='12553'>
<a name='12554'>
VTL_SI = VTL/100.D0<a name='12555'>
VTG_SI = VTG/100.D0<a name='12556'>
VTH_SI = VTH/100.D0<a name='12557'>
<a name='12558'>
V4_SI = V4/100.D0<a name='12559'>
V5_SI = V5/100.D0<a name='12560'>
<a name='12561'>
FF1_SI = 1.E9*FF1<a name='12562'>
FF4_SI = 1.E9*FF4<a name='12563'>
FF5_SI = 1.E9*FF5<a name='12564'>
<a name='12565'>
pres_SI = pres/10.D0<a name='12566'>
rhoa_SI = rhoa*1000.D0<a name='12567'>
<a name='12568'>
<font color=#447700>! in case ihucm_flag == 1<a name='12569'></font>
<a name='12570'>
else<a name='12571'>
<a name='12572'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='12573'></font>
<a name='12574'>
RHO_G_SI = RHO_G<a name='12575'>
RHO_H_SI = RHO_H<a name='12576'>
<a name='12577'>
<a name='12578'>
XL_SI = XL<a name='12579'>
XG_SI = XG<a name='12580'>
XH_SI = XH<a name='12581'>
<a name='12582'>
VTL_SI = VTL<a name='12583'>
VTG_SI = VTG<a name='12584'>
VTH_SI = VTH<a name='12585'>
<a name='12586'>
V4_SI = V4<a name='12587'>
V5_SI = V5<a name='12588'>
<a name='12589'>
FF1_SI = FF1<a name='12590'>
FF4_SI = FF4<a name='12591'>
FF5_SI = FF5<a name='12592'>
<a name='12593'>
pres_SI = pres<a name='12594'>
rhoa_SI = rhoa<a name='12595'>
<a name='12596'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='12597'></font>
<a name='12598'>
endif<a name='12599'>
<a name='12600'>
<font color=#447700>!=============================================================<a name='12601'></font>
<font color=#447700>!       INITIALISATION<a name='12602'></font>
<font color=#447700>!=============================================================<a name='12603'></font>
<font color=#447700>!<a name='12604'></font>
V4_SI(:) = VTG_SI(:)<a name='12605'>
V5_SI(:) = VTH_SI(:)<a name='12606'>
<a name='12607'>
ee = QQV*pres_SI/(EPS + QQV)<a name='12608'>
<a name='12609'>
es_zero = 611.21D0<a name='12610'>
<a name='12611'>
if(pres_SI &gt; 200000.D0.or.pres_SI &lt; 10000.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_858">("fatal error in module_mp_full_sbm , model stop 9071")<a name='12612'>
<a name='12613'>
D_V=0.211D0*((TIN/273.15D0)**1.94D0)*(101325.D0/pres_SI)/1.D4<a name='12614'>
<a name='12615'>
<font color=#447700>! D_V = 2.21D-5<a name='12616'></font>
<font color=#447700>! FK_a = 2.40D-2<a name='12617'></font>
<a name='12618'>
FK_a =(5.69D0+0.017D0*(TIN-273.15D0))*1.0D-3*4.187D0<a name='12619'>
<a name='12620'>
<font color=#447700>! XLV = 2.50D6<a name='12621'></font>
<font color=#447700>! XLF = 2.83D6 - XLV<a name='12622'></font>
<a name='12623'>
<font color=#447700>! The expressions for latent heats used by R&amp;H, 1987,<a name='12624'></font>
<font color=#447700>! seem more applicable to<a name='12625'></font>
<font color=#447700>! T &gt; 0degC than<a name='12626'></font>
<font color=#447700>! those by P &amp; K 1997, and more modern<a name='12627'></font>
<a name='12628'>
<font color=#447700>! XLV=597.3D0*((273.15D0/TIN)**(0.167D0+3.67D-4*TIN))<a name='12629'></font>
<a name='12630'>
XLV = 597.3D0<a name='12631'>
XLV = XLV*FJOULES_IN_A_CAL*1000.D0<a name='12632'>
XLS = 2.83D6<a name='12633'>
<a name='12634'>
<font color=#447700>!XLF=79.7+0.485D0*(TIN-273.15D0)-2.5D-3*(TIN-273.15D0)*(TIN-273.15D0)<a name='12635'></font>
<a name='12636'>
XLF = 79.7D0<a name='12637'>
XLF = XLF*FJOULES_IN_A_CAL*1000.D0<a name='12638'>
<a name='12639'>
<font color=#447700>! FNSC=0.632D0<a name='12640'></font>
<a name='12641'>
etaa = (1.718D0 + 0.0049D0*(TIN-273.15D0) - &amp;<a name='12642'>
        1.2D-5*(TIN-273.15D0)*(TIN-273.15D0))*1.D-5<a name='12643'>
<a name='12644'>
<font color=#447700>! etaa/rhoa_SI = kinematic viscosity<a name='12645'></font>
<a name='12646'>
FNSC = etaa/(rhoa_SI*D_V)<a name='12647'>
<a name='12648'>
<font color=#447700>! FNPR=0.71D0<a name='12649'></font>
<a name='12650'>
ALPHA_H = FK_a/(CP*rhoa_SI)<a name='12651'>
FNPR = etaa/(rhoa_SI*ALPHA_H)<a name='12652'>
RHO_CRIT = 910.D0<a name='12653'>
<a name='12654'>
if(rhoa_SI &gt; 2.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_859">("fatal error in module_mp_full_sbm , model stop 111")<a name='12655'>
<a name='12656'>
if(rhoa_SI &lt; 0.1D0) then<a name='12657'>
<font color=#447700>!  print*, &amp;<a name='12658'></font>
<font color=#447700>! 'rhoa_SI &lt; 0.1D0 kg/m3::TIN,rhoa_SI,PRES,DT,QQV = ', &amp;<a name='12659'></font>
<font color=#447700>!  TIN,rhoa_SI,pres_SI,DT,QQV<a name='12660'></font>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_860">("fatal error in module_mp_full_sbm , model stop 112")<a name='12661'>
endif<a name='12662'>
<a name='12663'>
if(RHO_H_SI(1) &lt; 1.D0) then<a name='12664'>
 <font color=#447700>! print *, 'RHO_H_SI(1) &lt; 1.D0kg/m3'<a name='12665'></font>
  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_861">("fatal error in module_mp_full_sbm , model stop 113")<a name='12666'>
endif<a name='12667'>
<a name='12668'>
TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_4">(ee, TIN, XLS*D_V/(FK_a*RV), 1.D0, XLS, RV)<a name='12669'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='12670'>
<a name='12671'>
<font color=#447700>!=============================================================<a name='12672'></font>
<font color=#447700>!               GRAUPEL (assumed to be spheres)<a name='12673'></font>
<font color=#447700>!=============================================================<a name='12674'></font>
<a name='12675'>
ISIGN_GRAUPEL=1<a name='12676'>
ISIGN_HAIL=0<a name='12677'>
<a name='12678'>
DO IK = 1, NKR<a name='12679'>
<a name='12680'>
   IK_MELT=IK<a name='12681'>
   I_MELT=0<a name='12682'>
<a name='12683'>
if(TIN &gt; 273.15D0) then<a name='12684'>
<a name='12685'>
IF(FLIQFR_G(IK).GE.1.D0.OR.FF4_SI(IK).LE.PETIT_PARAMETRE.OR. &amp;<a name='12686'>
TIN &lt;= 273.15D0) THEN<a name='12687'>
  IF(FLIQFR_G(IK) &gt; 1.D0) FLIQFR_G(IK) = 1.D0<a name='12688'>
CYCLE<a name='12689'>
ENDIF<a name='12690'>
<font color=#447700>!<a name='12691'></font>
vt_start = 0.D0<a name='12692'>
vt_end = 0.D0<a name='12693'>
<font color=#447700>!<a name='12694'></font>
rhoi = RHO_G_SI(IK)<a name='12695'>
fm_i = XG_SI(IK)*(1.D0 - FLIQFR_G(IK))<a name='12696'>
V_i = fm_i/rhoi<a name='12697'>
<a name='12698'>
fm_w = XG_SI(IK)*FLIQFR_G(IK)<a name='12699'>
V_w = fm_w/RHO_WATER<a name='12700'>
<a name='12701'>
if(rhoi &lt; RHO_CRIT) then<a name='12702'>
  V_soakable = V_i - fm_i/RHO_ICE<a name='12703'>
else<a name='12704'>
  V_soakable = 0.D0<a name='12705'>
endif<a name='12706'>
<a name='12707'>
a_i = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_10">(V_i)<a name='12708'>
a_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_11">(XG_SI(IK)/rhoi)<a name='12709'>
fnre_dry = VTG_SI(IK) * 2.D0*rhoa_SI*a_izero/etaa<a name='12710'>
<a name='12711'>
<font color=#447700>! FIND RE (ie. CD) OF SMOOTH SPHERE OF SAME MASS<a name='12712'></font>
<font color=#447700>!(fnre_smooth is invariant during melting)<a name='12713'></font>
<a name='12714'>
X_Best = 8.D0 * XG_SI(IK) * rhoa_SI * GRAV / (PI * etaa * etaa)<a name='12715'>
fnre_smooth = <A href='../../html_code/phys/module_mp_full_sbm.F.html#FNRE_SPHERE'>fnre_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FNRE_SPHERE_3">(X_Best)<a name='12716'>
<a name='12717'>
if(V_w &lt; V_soakable) then<a name='12718'>
<a name='12719'>
  a_d = a_i<a name='12720'>
  vt=VT_LOW_DENSITY_SOAKING &amp;<a name='12721'>
    (fnre_dry,fnre_smooth,VTG_SI(IK),a_i,a_izero,etaa,rhoa_SI)<a name='12722'>
<a name='12723'>
<font color=#447700>! in case V_w &lt; V_soakable<a name='12724'></font>
<a name='12725'>
else<a name='12726'>
<a name='12727'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='12728'></font>
<a name='12729'>
  a_d = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_12">(V_i + (V_w - V_soakable))<a name='12730'>
  fm_w_soaked = RHO_WATER* V_soakable<a name='12731'>
  fm_w_crit = (0.268D0 + (fm_i + fm_w_soaked) * 1.D3 * 0.1389D0)<a name='12732'>
  fm_w_crit = fm_w_crit* 1.D-3<a name='12733'>
  a_crit = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_13">(V_i + fm_w_crit/RHO_WATER)<a name='12734'>
<a name='12735'>
  if(rhoi &lt; RHO_CRIT) then<a name='12736'>
    vt_start = VT_LOW_DENSITY_TRANS &amp;<a name='12737'>
              (fnre_dry, fnre_smooth, &amp;<a name='12738'>
               VTG_SI(IK),a_izero,etaa,rhoa_SI,rhoi,XG_SI(IK))<a name='12739'>
  else<a name='12740'>
    vt_start=VT_HIGH_DENSITY_TRANS &amp;<a name='12741'>
            (fnre_dry,fnre_smooth,VTG_SI(IK),a_izero,etaa,rhoa_SI)<a name='12742'>
  endif<a name='12743'>
<a name='12744'>
  vt_end=equilibrium_fallspeed &amp;<a name='12745'>
        (fm_i+fm_w_soaked,fm_w_crit, &amp;<a name='12746'>
         XG(:),VTL_SI(:),rhoa_SI,etaa,a_crit)<a name='12747'>
<a name='12748'>
  frac_eqm=(fm_w-fm_w_soaked)/fm_w_crit<a name='12749'>
<a name='12750'>
  if(frac_eqm &lt; 0.D0) frac_eqm = 0.D0<a name='12751'>
  if(frac_eqm &gt; 1.D0) frac_eqm = 1.D0<a name='12752'>
<a name='12753'>
  vt = vt_start + (vt_end - vt_start) * frac_eqm<a name='12754'>
<a name='12755'>
  if(vt &lt; 0.D0) vt = 0.D0<a name='12756'>
<a name='12757'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='12758'></font>
<a name='12759'>
endif<a name='12760'>
<a name='12761'>
<font color=#447700>! new changes 3.02.08                                        (start)<a name='12762'></font>
<a name='12763'>
if(ivt_G_H_interpol.ne.0) then<a name='12764'>
<a name='12765'>
  vt=VTG_SI(IK)+FLIQFR_G(IK)*(VTL_SI(IK) - VTG_SI(IK))<a name='12766'>
  <a name='12767'>
endif<a name='12768'>
<a name='12769'>
<font color=#447700>! new changes 3.02.08                                          (end)<a name='12770'></font>
<a name='12771'>
V4_SI(IK) = vt<a name='12772'>
<a name='12773'>
fnre = vt * (2.D0 * a_d * rhoa_SI)/etaa<a name='12774'>
<a name='12775'>
fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_5">(fnre,FNSC,IK)<a name='12776'>
fh = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_6">(fnre,FNPR,IK)<a name='12777'>
<a name='12778'>
<font color=#447700>! new change 10.02.08                                        (start)<a name='12779'></font>
<a name='12780'>
if(FLIQFR_G(IK) &lt;= 0.D0) then<a name='12781'>
  TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_5">(ee, TIN, XLS*D_V/(FK_a*RV), fv/fh, XLS, RV)<a name='12782'>
else<a name='12783'>
  TS = 273.15D0<a name='12784'>
endif<a name='12785'>
<a name='12786'>
<font color=#447700>! new change 10.02.08                                          (end)<a name='12787'></font>
<a name='12788'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='12789'>
<a name='12790'>
if(fnre &lt; 6000.D0) then<a name='12791'>
  CAP = a_d<a name='12792'>
else<a name='12793'>
  CAP = a_i<a name='12794'>
endif<a name='12795'>
<a name='12796'>
if(FLIQFR_G(IK) &lt;= FLIQFRAC_LIM) then<a name='12797'>
<a name='12798'>
  if(ISHEDDING_ON.eq.1) then<a name='12799'>
<a name='12800'>
    if(IPRINTING == 1) print *,' SHEDDING CODE(GRAUPEL)  '<a name='12801'>
<a name='12802'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER'>SHED_MELTWATER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SHED_MELTWATER_1"> &amp;<a name='12803'>
   (fnre,rhoi,RHO_CRIT,XG_SI,FF4_SI,FLIQFR_G,XL_SI,FF1_SI,IK)<a name='12804'>
<a name='12805'>
  endif<a name='12806'>
  <a name='12807'>
<font color=#447700>! in case FLIQFR_G(IK) &lt;= FLIQFRAC_LIM<a name='12808'></font>
<a name='12809'>
endif<a name='12810'>
<a name='12811'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='12812'></font>
<a name='12813'>
endif<a name='12814'>
<a name='12815'>
ENDDO<a name='12816'>
<font color=#447700>! cycle by IK<a name='12817'></font>
<font color=#447700>!<a name='12818'></font>
<font color=#447700>!=============================================================<a name='12819'></font>
<font color=#447700>!               HAIL (assumed to be spheres)<a name='12820'></font>
<font color=#447700>!=============================================================<a name='12821'></font>
<a name='12822'>
ISIGN_GRAUPEL=0<a name='12823'>
ISIGN_HAIL=1<a name='12824'>
<a name='12825'>
DO IK = 1, NKR<a name='12826'>
<a name='12827'>
   IK_MELT=IK<a name='12828'>
   I_MELT=0<a name='12829'>
<a name='12830'>
if(TIN &gt; 273.15D0) then<a name='12831'>
<a name='12832'>
IF(FLIQFR_H(IK).GE.1.D0.OR.FF5_SI(IK).LE.PETIT_PARAMETRE.OR. &amp;<a name='12833'>
TIN &lt;= 273.15D0) THEN<a name='12834'>
  IF(FLIQFR_H(IK) &gt; 1.D0) FLIQFR_H(IK) = 1.D0<a name='12835'>
CYCLE<a name='12836'>
ENDIF<a name='12837'>
<a name='12838'>
vt_start = 0.D0<a name='12839'>
vt_end = 0.D0<a name='12840'>
<a name='12841'>
rhoi  = RHO_H_SI(IK)<a name='12842'>
fm_i = XH_SI(IK)*(1.D0 - FLIQFR_H(IK))<a name='12843'>
V_i = fm_i/rhoi<a name='12844'>
<a name='12845'>
fm_w = XH_SI(IK)*FLIQFR_H(IK)<a name='12846'>
V_w = fm_w/RHO_WATER<a name='12847'>
<a name='12848'>
if(rhoi &lt; RHO_CRIT) then<a name='12849'>
  V_soakable = V_i - fm_i/RHO_ICE<a name='12850'>
else<a name='12851'>
  V_soakable = 0.D0<a name='12852'>
endif<a name='12853'>
<a name='12854'>
a_i = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_14">(V_i)<a name='12855'>
a_izero = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_15">(XH_SI(IK)/rhoi)<a name='12856'>
<a name='12857'>
<font color=#447700>! FIND RE OF SMOOTH SPHERE OF SAME MASS<a name='12858'></font>
<font color=#447700>! (fnre_smooth is invariant during melting)<a name='12859'></font>
<a name='12860'>
if(IPRINTING == 1) print *, 'fnre_dry = ', fnre_dry<a name='12861'>
<a name='12862'>
fnre_dry=VTH_SI(IK)*2.D0*rhoa_SI*a_izero/etaa<a name='12863'>
X_Best=8.D0*XH_SI(IK)*rhoa_SI*GRAV/(PI * etaa * etaa)<a name='12864'>
fnre_smooth=<A href='../../html_code/phys/module_mp_full_sbm.F.html#FNRE_SPHERE'>fnre_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FNRE_SPHERE_4">(X_Best)<a name='12865'>
<a name='12866'>
vt_justwet = 0.D0<a name='12867'>
vt_justsoaked = 0.D0<a name='12868'>
<a name='12869'>
if(V_w &lt; V_soakable) then<a name='12870'>
<a name='12871'>
<font color=#447700>! SOAKING OF WATER<a name='12872'></font>
<a name='12873'>
  a_d = a_i<a name='12874'>
  vt=VT_LOW_DENSITY_SOAKING &amp;<a name='12875'>
    (fnre_dry,fnre_smooth,VTH_SI(IK),a_i,a_izero,etaa,rhoa_SI)<a name='12876'>
<a name='12877'>
<font color=#447700>! in case V_w &lt; V_soakable<a name='12878'></font>
<a name='12879'>
else<a name='12880'>
<a name='12881'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='12882'></font>
<a name='12883'>
  a_d = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_16">(V_i + (V_w - V_soakable))<a name='12884'>
  fm_w_soaked = RHO_WATER* V_soakable<a name='12885'>
  fm_w_crit=(0.268D0+(fm_i+fm_w_soaked)*1.D3*0.1389D0)<a name='12886'>
  fm_w_crit = fm_w_crit* 1.D-3<a name='12887'>
  a_crit = <A href='../../html_code/phys/module_mp_full_sbm.F.html#RAD_SPHERE'>rad_sphere</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAD_SPHERE_17">(V_i + fm_w_crit/RHO_WATER)<a name='12888'>
<a name='12889'>
<font color=#447700>!RH87: Just-wet terminal velocity - look at history<a name='12890'></font>
<font color=#447700>!of same particle passing 0oC<a name='12891'></font>
<font color=#447700>!(ie. 'just-wet' means when 0degC is just reached<a name='12892'></font>
<font color=#447700>!by surface and melting commences):<a name='12893'></font>
<a name='12894'>
  if(rhoi &lt; RHO_CRIT) then<a name='12895'>
<a name='12896'>
    vt_start = VT_LOW_DENSITY_TRANS &amp;<a name='12897'>
              (fnre_dry,fnre_smooth, &amp;<a name='12898'>
               VTH_SI(IK),a_izero,etaa,rhoa_SI,rhoi,XH_SI(IK))<a name='12899'>
  else<a name='12900'>
<a name='12901'>
    vt_start = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VT_HIGH_DENSITY_TRANS'>VT_HIGH_DENSITY_TRANS</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VT_HIGH_DENSITY_TRANS_2">(fnre_dry, fnre_smooth, &amp;<a name='12902'>
    VTH_SI(IK), a_izero, etaa, rhoa_SI)<a name='12903'>
<a name='12904'>
  endif<a name='12905'>
<a name='12906'>
    vt_end=equilibrium_fallspeed &amp;<a name='12907'>
          (fm_i + fm_w_soaked, fm_w_crit, XH(:), &amp;<a name='12908'>
           VTL_SI(:), rhoa_SI, etaa, a_crit)<a name='12909'>
<a name='12910'>
<font color=#447700>! RH87: Interpolation based on fraction of equilibrium water<a name='12911'></font>
<font color=#447700>! on surface<a name='12912'></font>
<a name='12913'>
    frac_eqm = (fm_w - fm_w_soaked)/fm_w_crit<a name='12914'>
    if(frac_eqm &lt; 0.D0) frac_eqm = 0.D0<a name='12915'>
    if(frac_eqm &gt; 1.D0) frac_eqm = 1.D0<a name='12916'>
<a name='12917'>
    vt = vt_start + (vt_end - vt_start) * frac_eqm<a name='12918'>
<a name='12919'>
    if(vt &lt; 0.D0) then<a name='12920'>
      if(IPRINTING == 1) print *, 'WARNING: vt &lt; 0', vt<a name='12921'>
      vt = 0.D0<a name='12922'>
    endif<a name='12923'>
<a name='12924'>
    if(IPRINTING == 1) print *, &amp;<a name='12925'>
   'HERE 2:: vt_start,vt_end,a_izero/a_i= ', &amp;<a name='12926'>
             vt_start,vt_end,a_izero/a_i<a name='12927'>
<a name='12928'>
    if(IPRINTING == 1) print *, &amp;<a name='12929'>
   'HERE 2:: fnre_dry,fnre_smooth,vt_justsoaked,vt_justwet', &amp;<a name='12930'>
             fnre_dry,fnre_smooth,vt_justsoaked,vt_justwet<a name='12931'>
<a name='12932'>
<font color=#447700>! in case V_w &gt;= V_soakable<a name='12933'></font>
<a name='12934'>
endif<a name='12935'>
<a name='12936'>
<font color=#447700>! new changes 3.02.08                                        (start)<a name='12937'></font>
<a name='12938'>
if(ivt_G_H_interpol.ne.0) then<a name='12939'>
<a name='12940'>
  vt=VTH_SI(IK)+FLIQFR_H(IK)*(VTL_SI(IK) - VTH_SI(IK))<a name='12941'>
  <a name='12942'>
endif<a name='12943'>
  <a name='12944'>
<font color=#447700>! new changes 3.02.08                                          (end)<a name='12945'></font>
<a name='12946'>
V5_SI(IK) = vt<a name='12947'>
<a name='12948'>
fnre = vt * (2.D0 * a_d * rhoa_SI)/etaa<a name='12949'>
<a name='12950'>
<font color=#447700>! new change 5.02.07                                          (start)<a name='12951'></font>
<a name='12952'>
fv = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_7">(fnre,FNSC,IK)<a name='12953'>
fh = <A href='../../html_code/phys/module_mp_full_sbm.F.html#HAIL_VENTILATION_COEF'>HAIL_VENTILATION_COEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HAIL_VENTILATION_COEF_8">(fnre,FNPR,IK)<a name='12954'>
<a name='12955'>
<font color=#447700>! new change 10.02.08                                         (start)<a name='12956'></font>
<a name='12957'>
if(FLIQFR_H(IK) &lt;= 0.D0) then<a name='12958'>
  TS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#SURFACE_TEMP'>SURFACE_TEMP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SURFACE_TEMP_6">(ee, TIN, XLS*D_V/(FK_a*RV), fv/fh, XLS, RV)<a name='12959'>
else<a name='12960'>
  TS = 273.15D0<a name='12961'>
endif<a name='12962'>
<a name='12963'>
<font color=#447700>! new change 10.02.08                                           (end)<a name='12964'></font>
<a name='12965'>
if(TS &gt; 273.15D0) TS = 273.15D0<a name='12966'>
<a name='12967'>
if(fnre &lt; 6000.D0) then<a name='12968'>
  CAP = a_d<a name='12969'>
else<a name='12970'>
  CAP = a_i<a name='12971'>
endif<a name='12972'>
<a name='12973'>
if(FLIQFR_H(IK) &lt;= FLIQFRAC_LIM) then<a name='12974'>
<a name='12975'>
  if(ISHEDDING_ON.eq.1) then<a name='12976'>
<a name='12977'>
    CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER'>SHED_MELTWATER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHEDDING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SHED_MELTWATER_2"> &amp;<a name='12978'>
   (fnre,rhoi,RHO_CRIT,XH_SI,FF5_SI,FLIQFR_H,XL_SI,FF1_SI,IK)<a name='12979'>
<a name='12980'>
<font color=#447700>! in case ISHEDDING_ON.eq.1<a name='12981'></font>
<a name='12982'>
  endif<a name='12983'>
  <a name='12984'>
<font color=#447700>! in case FLIQFR_H(IK) &lt;= FLIQFRAC_LIM<a name='12985'></font>
<a name='12986'>
endif<a name='12987'>
<a name='12988'>
<font color=#447700>! in case TIN &gt; 273.15D0<a name='12989'></font>
<a name='12990'>
endif<a name='12991'>
<a name='12992'>
ENDDO<a name='12993'>
<font color=#447700>! cycle by IK<a name='12994'></font>
<a name='12995'>
<font color=#447700>!=============================================================<a name='12996'></font>
<font color=#447700>!       UNIT CONVERSION OF ALL OUTPUTS from SI<a name='12997'></font>
<font color=#447700>!=============================================================<a name='12998'></font>
<font color=#447700>!<a name='12999'></font>
if(ihucm_flag == 1) then<a name='13000'>
<a name='13001'>
  if(IVT_ADJUST == 1) then<a name='13002'>
    V4 = 100.D0 * V4_SI<a name='13003'>
    V5 = 100.D0 * V5_SI<a name='13004'>
  endif<a name='13005'>
<a name='13006'>
  FF1 = 1.D-9*FF1_SI<a name='13007'>
  FF4 = 1.D-9*FF4_SI<a name='13008'>
  FF5 = 1.D-9*FF5_SI<a name='13009'>
  <a name='13010'>
<font color=#447700>! in case ihucm_flag == 1<a name='13011'></font>
<a name='13012'>
else<a name='13013'>
<a name='13014'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='13015'></font>
<a name='13016'>
  if(IVT_ADJUST == 1) then<a name='13017'>
    V4 = V4_SI<a name='13018'>
    V5 = V5_SI<a name='13019'>
  endif<a name='13020'>
<a name='13021'>
  FF1 = FF1_SI<a name='13022'>
  FF4 = FF4_SI<a name='13023'>
  FF5 = FF5_SI<a name='13024'>
  <a name='13025'>
<font color=#447700>! in case ihucm_flag.NE.1<a name='13026'></font>
<a name='13027'>
endif<a name='13028'>
<a name='13029'>
 101 FORMAT(1X,D13.5)<a name='13030'>
 102 FORMAT(1X,2D13.5)<a name='13031'>
 103 FORMAT(1X,3D13.5)<a name='13032'>
 104 FORMAT(1X,4D13.5)<a name='13033'>
 105 FORMAT(1X,5D13.5)<a name='13034'>
 106 FORMAT(1X,6D13.5)<a name='13035'>
 107 FORMAT(1X,7D13.5)<a name='13036'>
 201 FORMAT(1X,I2,D13.5)<a name='13037'>
 202 FORMAT(1X,I2,2D13.5)<a name='13038'>
 203 FORMAT(1X,I2,3D13.5)<a name='13039'>
 204 FORMAT(1X,I2,4D13.5)<a name='13040'>
<a name='13041'>
END SUBROUTINE<a name='13042'>
<a name='13043'>
<font color=#447700>! end of shedding subroutine<a name='13044'></font>
<font color=#447700>!====================================================================<a name='13045'></font>
<A NAME='SHED_MELTWATER'><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13046'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>SHED_MELTWATER</font> &amp; <A href='../../call_to/SHED_MELTWATER.html' TARGET='index'>2</A>,<A href='../../call_from/SHED_MELTWATER.html' TARGET='index'>10</A><a name='13047'>
(fnrex,rhoix,RHO_CRITX,XX,FFX,FLIQFR_X,XL_SI,FF1_SI,INK)<a name='13048'>
<a name='13049'>
implicit double precision (a-h,o-z)<a name='13050'>
<a name='13051'>
<font color=#447700>! new change 27.03.07                                         (start)<a name='13052'></font>
<a name='13053'>
<font color=#447700>!PARAMETER(NKR=33, &amp;<a name='13054'></font>
PARAMETER(PI=3.141592654D0, RHO_ICE=920D0, RHO_WATER=1000.D0, &amp;<a name='13055'>
<a name='13056'>
<font color=#447700>! new change 27.03.07                                           (end)<a name='13057'></font>
<a name='13058'>
<font color=#447700>! new change 27.08.04                                         (start)<a name='13059'></font>
<a name='13060'>
IPRINTING=0, &amp; <a name='13061'>
<font color=#447700>!IPRINTING=1, &amp; <a name='13062'></font>
<a name='13063'>
COL=0.23105D0, FMAX_DROP_MASS_FRACTION=0.5D0)<a name='13064'>
<a name='13065'>
<font color=#447700>! new change 27.08.04                                           (end)<a name='13066'></font>
<a name='13067'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13068'></font>
<a name='13069'>
<font color=#447700>! new change 30.10.04                                         (start)<a name='13070'></font>
DIMENSION XX(NKR), XL_SI(NKR)<a name='13071'>
DIMENSION FFX(NKR), FF1_SI(NKR), FLIQFR_X(NKR)<a name='13072'>
<a name='13073'>
DIMENSION fmass_ice(NKR), fmass_X(NKR)<a name='13074'>
<a name='13075'>
INTRINSIC DABS, SUM<a name='13076'>
<a name='13077'>
fm_i = XX(INK)*(1.D0 - FLIQFR_X(INK))<a name='13078'>
<a name='13079'>
V_i = fm_i/rhoix<a name='13080'>
<a name='13081'>
fm_w = XX(INK)*FLIQFR_X(INK)<a name='13082'>
<a name='13083'>
V_w = fm_w/RHO_WATER<a name='13084'>
<a name='13085'>
if(rhoix &lt; RHO_CRITX) then<a name='13086'>
  V_soakable = V_i - fm_i/RHO_ICE<a name='13087'>
else<a name='13088'>
  V_soakable = 0.D0<a name='13089'>
endif<a name='13090'>
<a name='13091'>
if(V_w &gt; V_soakable) then<a name='13092'>
<a name='13093'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13094'></font>
<a name='13095'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13096'></font>
<a name='13097'>
  fm_w_soaked = RHO_WATER*V_soakable<a name='13098'>
  fm_w_crit=(0.268D0+(fm_i+fm_w_soaked)*1.D3*0.1389D0)<a name='13099'>
  fm_w_crit = fm_w_crit*1.D-3<a name='13100'>
<a name='13101'>
<font color=#447700>! new change 22.06.04                                         (start)<a name='13102'></font>
<a name='13103'>
<font color=#447700>! new change 22.06.04                                           (end)<a name='13104'></font>
<a name='13105'>
  if(fm_w - fm_w_soaked &gt; fm_w_crit) then<a name='13106'>
<a name='13107'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13108'></font>
<a name='13109'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13110'></font>
<a name='13111'>
    if(fnrex &gt; 1.5D4) then<a name='13112'>
      melting_mode = 2<a name='13113'>
    else<a name='13114'>
      if(fnrex &gt; 1.D4 ) then<a name='13115'>
        melting_mode = 3<a name='13116'>
      else<a name='13117'>
        melting_mode = 4<a name='13118'>
      endif<a name='13119'>
    endif<a name='13120'>
<a name='13121'>
    select case (melting_mode)<a name='13122'>
<a name='13123'>
       case(2)<a name='13124'>
       d_w_shed = 1.5D-3<a name='13125'>
<a name='13126'>
       case(3)<a name='13127'>
       d_w_shed = 3.D-3<a name='13128'>
<a name='13129'>
       case(4)<a name='13130'>
       d_w_shed = 4.5E-3<a name='13131'>
<a name='13132'>
       case default<a name='13133'>
<a name='13134'>
 call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_862">("fatal error in module_mp_full_sbm , model stop 9999")<a name='13135'>
<a name='13136'>
    end select<a name='13137'>
<a name='13138'>
    drop_mass = RHO_WATER*(PI/6.D0)*(d_w_shed**3.D0)<a name='13139'>
<a name='13140'>
    if(drop_mass &gt; fm_w_crit*FMAX_DROP_MASS_FRACTION) &amp;<a name='13141'>
    drop_mass = fm_w_crit*FMAX_DROP_MASS_FRACTION<a name='13142'>
<a name='13143'>
    fm_w_save=fm_w<a name='13144'>
<a name='13145'>
    if(melting_mode == 2) then<a name='13146'>
<a name='13147'>
      if(fnrex &gt; 2.5D4) then<a name='13148'>
<a name='13149'>
<font color=#447700>! all melt-water on sfc is shed<a name='13150'></font>
<a name='13151'>
        fm_w = fm_w_soaked<a name='13152'>
<a name='13153'>
      else<a name='13154'>
<a name='13155'>
<font color=#447700>! small drops shed continuously<a name='13156'></font>
<a name='13157'>
        fm_w = fm_w_crit + fm_w_soaked<a name='13158'>
<a name='13159'>
      endif<a name='13160'>
<a name='13161'>
<font color=#447700>! in case melting_mode == 2<a name='13162'></font>
<a name='13163'>
    else<a name='13164'>
<a name='13165'>
<font color=#447700>! in case melting_mode.ne.2<a name='13166'></font>
<a name='13167'>
<font color=#447700>! intermittent shedding of up to FMAX_DROP_MASS_FRACTION<a name='13168'></font>
<font color=#447700>! of exterior meltwater<a name='13169'></font>
<a name='13170'>
      fm_w =  fm_w - drop_mass<a name='13171'>
<a name='13172'>
<font color=#447700>! in case melting_mode.ne.2<a name='13173'></font>
<a name='13174'>
    endif<a name='13175'>
<a name='13176'>
    if(fm_w - fm_w_soaked &gt; fm_w_crit) fm_w = fm_w_crit + fm_w_soaked<a name='13177'>
<a name='13178'>
    if(fm_w &lt; fm_w_soaked) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_863">("fatal error in module_mp_full_sbm , model stop 9065")<a name='13179'>
<a name='13180'>
    fm_w_shed = fm_w_save - fm_w<a name='13181'>
<a name='13182'>
    ILIQ = <A href='../../html_code/phys/module_mp_full_sbm.F.html#IFIND_IK'>IFIND_IK</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IFIND_IK_1">(drop_mass, XL_SI, frac_liq)<a name='13183'>
<a name='13184'>
    INEW = <A href='../../html_code/phys/module_mp_full_sbm.F.html#IFIND_IK'>IFIND_IK</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IFIND_IK_2">(fm_w + fm_i, XX, frac)<a name='13185'>
<a name='13186'>
    if(INEW &lt; INK) then<a name='13187'>
<a name='13188'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13189'></font>
<a name='13190'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13191'></font>
<a name='13192'>
      fmass_X(:)=FFX(:)*XX(:)*XX(:)*3.D0*COL<a name='13193'>
      fmass_ice(:)=FFX(:)*XX(:)*(1.D0-FLIQFR_X(:))*XX(:)*3.D0*COL<a name='13194'>
      fm_X_before = SUM(fmass_X)<a name='13195'>
      fm_ice_before = SUM(fmass_ice)<a name='13196'>
<a name='13197'>
<font color=#447700>! take mass of water shed out of mass_X(IK) and place<a name='13198'></font>
<font color=#447700>! in temporary reservoir 1<a name='13199'></font>
<a name='13200'>
      res_mass_shed =  FFX(INK) * fm_w_shed * XX(INK)*3.D0*COL<a name='13201'>
      fmass_X(INK) = fmass_X(INK) - res_mass_shed<a name='13202'>
<a name='13203'>
      if(fmass_X(INK) &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_864">("fatal error in module_mp_full_sbm , model stop 8020")<a name='13204'>
      if(res_mass_shed &lt; 0.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_865">("fatal error in module_mp_full_sbm , model stop 8021")<a name='13205'>
<a name='13206'>
<font color=#447700>! take all remaining water out of mass_X/mass_ice and place<a name='13207'></font>
<font color=#447700>! in temporary reservoirs 2 and 3<a name='13208'></font>
<a name='13209'>
      res_mass_X = fmass_X(INK)<a name='13210'>
      fmass_X(INK) = 0.D0<a name='13211'>
      res_mass_ice = fmass_ice(INK)<a name='13212'>
      fmass_ice(INK) = 0.D0<a name='13213'>
<a name='13214'>
<font color=#447700>! transfer water of reservoir 2 into the two size-bins adjacent<a name='13215'></font>
<font color=#447700>! to fm_w+m_i<a name='13216'></font>
<a name='13217'>
      fmass_X(INEW)=fmass_X(INEW )+(1.D0-frac)*res_mass_X<a name='13218'>
      fmass_X(INEW+1)=fmass_X(INEW+1)+frac*res_mass_X<a name='13219'>
      res_mass_X = 0.D0<a name='13220'>
<a name='13221'>
<font color=#447700>! transfer ice of reservoir 3 into the two size-bins adjacent<a name='13222'></font>
<font color=#447700>! to fm_w+m_i<a name='13223'></font>
<a name='13224'>
      fmass_ice(INEW)=fmass_ice(INEW)+(1.D0-frac)*res_mass_ice<a name='13225'>
      fmass_ice(INEW+1)=fmass_ice(INEW+1)+frac*res_mass_ice<a name='13226'>
      res_mass_ice=0.D0<a name='13227'>
<a name='13228'>
<font color=#447700>! transfer shed water of reservoir 1 into liquid bins<a name='13229'></font>
<a name='13230'>
      FF1_SI(ILIQ)=FF1_SI(ILIQ)+ &amp;<a name='13231'>
      res_mass_shed/(XL_SI(ILIQ)*XL_SI(ILIQ)*3.D0*COL)<a name='13232'>
<a name='13233'>
      FFX(INEW)=fmass_X (INEW)/(XX(INEW)*XX(INEW)*3.D0*COL)<a name='13234'>
      FFX(INEW+1)=fmass_X (INEW+1)/(XX(INEW+1)*XX(INEW+1)*3.D0*COL)<a name='13235'>
      FFX(INK)=fmass_X (INK)/(XX(INK)*XX(INK)*3.D0*COL)<a name='13236'>
<a name='13237'>
      if(FFX(INEW) &gt; 0.D0) then<a name='13238'>
      <a name='13239'>
        FLIQFR_X(INEW)= &amp;<a name='13240'>
        1.D0-fmass_ice (INEW)/(XX(INEW)*FFX(INEW)*XX(INEW)*3.D0*COL)<a name='13241'>
	<a name='13242'>
<font color=#447700>! new change 9.12.07                                          (start)<a name='13243'></font>
        if(DABS(FLIQFR_X(INEW)) &lt; 1.0D-3) FLIQFR_X(INEW)= 0.0D0 <a name='13244'>
<font color=#447700>! new change 9.12.07                                            (end)<a name='13245'></font>
<a name='13246'>
      else<a name='13247'>
<a name='13248'>
        FLIQFR_X(INEW) = 1.D0<a name='13249'>
<a name='13250'>
      endif<a name='13251'>
<a name='13252'>
      if(FFX(INEW+1) &gt; 0.D0) then<a name='13253'>
<a name='13254'>
        FLIQFR_X(INEW+1)=1.D0 - &amp;<a name='13255'>
                         fmass_ice(INEW+1)/ &amp;<a name='13256'>
                        (XX(INEW+1)*FFX(INEW+1)*XX(INEW+1)*3.D0*COL)<a name='13257'>
<font color=#447700>! new change 9.12.07                                          (start)<a name='13258'></font>
        if(DABS(FLIQFR_X(INEW+1)) &lt; 1.0D-3) FLIQFR_X(INEW+1)= 0.0D0 <a name='13259'>
<font color=#447700>! new change 9.12.07                                            (end)<a name='13260'></font>
<a name='13261'>
      else<a name='13262'>
<a name='13263'>
        FLIQFR_X(INEW+1) = 1.D0<a name='13264'>
<a name='13265'>
      endif<a name='13266'>
<a name='13267'>
      if(FFX(INK) &gt; 0.D0) then<a name='13268'>
<a name='13269'>
        FLIQFR_X(INK)=1.D0 - fmass_ice(INK)/ &amp;<a name='13270'>
                            (XX(INK)*FFX(INK)*XX(INK)*3.D0*COL)<a name='13271'>
<font color=#447700>! new change 9.12.07                                          (start)<a name='13272'></font>
        if(DABS(FLIQFR_X(INK)) &lt; 1.0D-3) FLIQFR_X(INK)= 0.0D0 <a name='13273'>
<font color=#447700>! new change 9.12.07                                            (end)<a name='13274'></font>
<a name='13275'>
      else<a name='13276'>
<a name='13277'>
        FLIQFR_X(INK) = 1.D0<a name='13278'>
<a name='13279'>
      endif<a name='13280'>
<a name='13281'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13282'></font>
<a name='13283'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13284'></font>
<a name='13285'>
<font color=#447700>! new change 9.12.07                                          (start)<a name='13286'></font>
<a name='13287'>
<font color=#447700>!      if(FLIQFR_X(INEW) &lt; 0.D0.or.FLIQFR_X(INEW) &gt; 1.D0) stop 8003<a name='13288'></font>
<a name='13289'>
      if(FLIQFR_X(INEW) &lt; 0.D0.or.FLIQFR_X(INEW) &gt; 1.D0) THEN<a name='13290'>
      <a name='13291'>
      <font color=#447700>!  PRINT*, 'IJK,KX,KZ,INK,INEW'<a name='13292'></font>
      <font color=#447700>!  PRINT*,  IJK,KX,KZ,INK,INEW<a name='13293'></font>
<font color=#447700>!	<a name='13294'></font>
<font color=#447700>!        PRINT*,   'FLIQFR_X(INEW)'<a name='13295'></font>
<font color=#447700>!        PRINT 106, FLIQFR_X(INEW)<a name='13296'></font>
<font color=#447700>!	<a name='13297'></font>
<font color=#447700>!        PRINT*,   'XX(INEW),FFX(INEW),fmass_ice(INEW)'<a name='13298'></font>
<font color=#447700>!        PRINT 106, XX(INEW),FFX(INEW),fmass_ice(INEW)<a name='13299'></font>
<font color=#447700>!	<a name='13300'></font>
<font color=#447700>!	PRINT*, &amp;<a name='13301'></font>
<font color=#447700>!       'STOP 8003: FLIQFR_X(INEW) &lt; 0.D0.or.FLIQFR_X(INEW) &gt; 1.D0'<a name='13302'></font>
       <a name='13303'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_866">("fatal error in module_mp_full_sbm , model stop 8003")<a name='13304'>
	<a name='13305'>
      endif<a name='13306'>
	<a name='13307'>
<font color=#447700>! new change 9.12.07                                            (end)<a name='13308'></font>
 <a name='13309'>
      if(FLIQFR_X(INEW+1) &lt; 0.D0.or.FLIQFR_X(INEW+1) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_867">("fatal error in module_mp_full_sbm , model stop 8004")<a name='13310'>
      if(FLIQFR_X(INK) &lt; 0.D0.or.FLIQFR_X(INK) &gt; 1.D0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_868">("fatal error in module_mp_full_sbm , model stop 8005")<a name='13311'>
<a name='13312'>
      fmass_X(:)=FFX(:)*XX(:)*XX(:)*3.D0*COL<a name='13313'>
      fmass_ice(:)=FFX(:)*XX(:)*(1.D0-FLIQFR_X(:))*XX(:)*3.D0*COL<a name='13314'>
<a name='13315'>
      fm_X_after = SUM(fmass_X)<a name='13316'>
      fm_ice_after = SUM(fmass_ice)<a name='13317'>
<a name='13318'>
      if(fm_ice_before &gt; 0.D0) then<a name='13319'>
<a name='13320'>
        fjunk = (fm_ice_after/fm_ice_before-1.D0)*100.D0<a name='13321'>
<a name='13322'>
<font color=#447700>! new change 9.12.07                                          (start)<a name='13323'></font>
<a name='13324'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13325'></font>
<a name='13326'>
<font color=#447700>!       if(DABS(fjunk) &gt; 1.D0) stop 8011<a name='13327'></font>
<a name='13328'>
<font color=#447700>! in case fm_ice_before &gt; 0.D0<a name='13329'></font>
<a name='13330'>
      endif<a name='13331'>
<a name='13332'>
      if(fm_X_before &gt; 0.D0) then<a name='13333'>
<a name='13334'>
        fjunk=((fm_X_after+res_mass_shed)/fm_X_before-1.D0)*100.D0<a name='13335'>
<a name='13336'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13337'></font>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13338'></font>
<a name='13339'>
<font color=#447700>!       if(DABS(fjunk) &gt; 1.D0) stop 8012<a name='13340'></font>
<a name='13341'>
<font color=#447700>! in case fm_X_before &gt; 0.D0<a name='13342'></font>
<a name='13343'>
      endif<a name='13344'>
<a name='13345'>
<font color=#447700>! new change 21.06.04                                         (start)<a name='13346'></font>
<a name='13347'>
<font color=#447700>! new change 21.06.04                                           (end)<a name='13348'></font>
<a name='13349'>
<font color=#447700>! in case INEW &lt; INK<a name='13350'></font>
<a name='13351'>
    else<a name='13352'>
<a name='13353'>
<font color=#447700>! in case INEW &gt;= INK<a name='13354'></font>
<a name='13355'>
<font color=#447700>! new change 21.06.04                                          (start)<a name='13356'></font>
<a name='13357'>
   <font color=#447700>!   print*, &amp; <a name='13358'></font>
<a name='13359'>
 <font color=#447700>!'STOP: drop_mass is too large compared to total mass of particle'<a name='13360'></font>
<a name='13361'>
 <font color=#447700>!     print*,   'INEW &gt;= INK'<a name='13362'></font>
<a name='13363'>
 <font color=#447700>!     print*,   'INEW,INK'<a name='13364'></font>
 <font color=#447700>!     print*,    INEW,INK <a name='13365'></font>
<a name='13366'>
 <font color=#447700>!     print*,   'drop_mass,fm_i+fm_w' <a name='13367'></font>
 <font color=#447700>!     print 106, drop_mass,fm_i+fm_w<a name='13368'></font>
<a name='13369'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#SHED_MELTWATER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_869">("fatal error in module_mp_full_sbm , model stop 9089")<a name='13370'>
      <a name='13371'>
<font color=#447700>! new change 21.06.04                                            (end)<a name='13372'></font>
<a name='13373'>
<font color=#447700>! in case INEW &gt;= INK<a name='13374'></font>
<a name='13375'>
    endif<a name='13376'>
<a name='13377'>
<font color=#447700>! in case fm_w - fm_w_soaked &gt; fm_w_crit<a name='13378'></font>
<a name='13379'>
  endif<a name='13380'>
<a name='13381'>
<font color=#447700>! in case V_w &gt; V_soakable<a name='13382'></font>
<a name='13383'>
endif<a name='13384'>
<a name='13385'>
<font color=#447700>! new change 21.06.04                                          (start)<a name='13386'></font>
<a name='13387'>
106 FORMAT(1X,6D13.5)<a name='13388'>
<a name='13389'>
<font color=#447700>! new change 21.06.04                                            (end)<a name='13390'></font>
<a name='13391'>
END SUBROUTINE<a name='13392'>
<a name='13393'>
<font color=#447700>! end of shed_meltwater subroutine<a name='13394'></font>
<font color=#447700>!====================================================================<a name='13395'></font>
<font color=#447700>! from module_mp_morr_two_moment.F<a name='13396'></font>
<A NAME='REFL10CM_HM'><A href='../../html_code/phys/module_mp_full_sbm.F.html#REFL10CM_HM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13397'>
      <font color=#993300>subroutine </font><font color=#cc0000>refl10cm_hm</font> (qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, &amp; <A href='../../call_to/REFL10CM_HM.html' TARGET='index'>3</A>,<A href='../../call_from/REFL10CM_HM.html' TARGET='index'>6</A><a name='13398'>
                      t1d, p1d, dBZ, kts, kte, ii, jj)<a name='13399'>
<a name='13400'>
      IMPLICIT NONE<a name='13401'>
<a name='13402'>
<font color=#447700>!..Sub arguments<a name='13403'></font>
      INTEGER, INTENT(IN):: kts, kte, ii, jj<a name='13404'>
      REAL, DIMENSION(kts:kte), INTENT(IN)::                            &amp;<a name='13405'>
                      qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, t1d, p1d<a name='13406'>
      REAL, DIMENSION(kts:kte), INTENT(INOUT):: dBZ<a name='13407'>
<a name='13408'>
<font color=#447700>!..Local variables<a name='13409'></font>
      REAL, DIMENSION(kts:kte):: temp, pres, qv, rho<a name='13410'>
      REAL, DIMENSION(kts:kte):: rr, nr, rs, ns, rg, ng<a name='13411'>
<a name='13412'>
      DOUBLE PRECISION, DIMENSION(kts:kte):: ilamr, ilamg, ilams<a name='13413'>
      DOUBLE PRECISION, DIMENSION(kts:kte):: N0_r, N0_g, N0_s<a name='13414'>
      DOUBLE PRECISION:: lamr, lamg, lams<a name='13415'>
      LOGICAL, DIMENSION(kts:kte):: L_qr, L_qs, L_qg<a name='13416'>
<a name='13417'>
      REAL, DIMENSION(kts:kte):: ze_rain, ze_snow, ze_graupel<a name='13418'>
      DOUBLE PRECISION:: fmelt_s, fmelt_g<a name='13419'>
      DOUBLE PRECISION:: cback, x, eta, f_d<a name='13420'>
<a name='13421'>
      INTEGER:: i, k, k_0, kbot, n<a name='13422'>
      LOGICAL:: melti<a name='13423'>
<a name='13424'>
<font color=#447700>!+---+<a name='13425'></font>
<a name='13426'>
      do k = kts, kte<a name='13427'>
         dBZ(k) = -35.0<a name='13428'>
      enddo<a name='13429'>
<a name='13430'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13431'></font>
<font color=#447700>!..Put column of data into local arrays.<a name='13432'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13433'></font>
      do k = kts, kte<a name='13434'>
         temp(k) = t1d(k)<a name='13435'>
         qv(k) = MAX(1.E-10, qv1d(k))<a name='13436'>
         pres(k) = p1d(k)<a name='13437'>
         rho(k) = 0.622*pres(k)/(R_MORR*temp(k)*(qv(k)+0.622))<a name='13438'>
<a name='13439'>
         if (qr1d(k) .gt. 1.E-9) then<a name='13440'>
            rr(k) = qr1d(k)*rho(k)<a name='13441'>
            nr(k) = nr1d(k)*rho(k)<a name='13442'>
            lamr = (xam_r*xcrg(3)*xorg2*nr(k)/rr(k))**xobmr<a name='13443'>
            ilamr(k) = 1./lamr<a name='13444'>
            N0_r(k) = nr(k)*xorg2*lamr**xcre(2)<a name='13445'>
            L_qr(k) = .true.<a name='13446'>
         else<a name='13447'>
            rr(k) = 1.E-12<a name='13448'>
            nr(k) = 1.E-12<a name='13449'>
            L_qr(k) = .false.<a name='13450'>
         endif<a name='13451'>
<a name='13452'>
         if (qs1d(k) .gt. 1.E-9) then<a name='13453'>
            rs(k) = qs1d(k)*rho(k)<a name='13454'>
            ns(k) = ns1d(k)*rho(k)<a name='13455'>
            lams = (xam_s*xcsg(3)*xosg2*ns(k)/rs(k))**xobms<a name='13456'>
            ilams(k) = 1./lams<a name='13457'>
            N0_s(k) = ns(k)*xosg2*lams**xcse(2)<a name='13458'>
            L_qs(k) = .true.<a name='13459'>
         else<a name='13460'>
            rs(k) = 1.E-12<a name='13461'>
            ns(k) = 1.E-12<a name='13462'>
            L_qs(k) = .false.<a name='13463'>
         endif<a name='13464'>
<a name='13465'>
         if (qg1d(k) .gt. 1.E-9) then<a name='13466'>
            rg(k) = qg1d(k)*rho(k)<a name='13467'>
            ng(k) = ng1d(k)*rho(k)<a name='13468'>
            lamg = (xam_g*xcgg(3)*xogg2*ng(k)/rg(k))**xobmg<a name='13469'>
            ilamg(k) = 1./lamg<a name='13470'>
            N0_g(k) = ng(k)*xogg2*lamg**xcge(2)<a name='13471'>
            L_qg(k) = .true.<a name='13472'>
         else<a name='13473'>
            rg(k) = 1.E-12<a name='13474'>
            ng(k) = 1.E-12<a name='13475'>
            L_qg(k) = .false.<a name='13476'>
         endif<a name='13477'>
      enddo<a name='13478'>
<a name='13479'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13480'></font>
<font color=#447700>!..Locate K-level of start of melting (k_0 is level above).<a name='13481'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13482'></font>
      melti = .false.<a name='13483'>
      k_0 = kts<a name='13484'>
      do k = kte-1, kts, -1<a name='13485'>
         if ( (temp(k).gt.273.15) .and. L_qr(k)                         &amp;<a name='13486'>
                                  .and. (L_qs(k+1).or.L_qg(k+1)) ) then<a name='13487'>
            k_0 = MAX(k+1, k_0)<a name='13488'>
            melti=.true.<a name='13489'>
            goto 195<a name='13490'>
         endif<a name='13491'>
      enddo<a name='13492'>
 195  continue<a name='13493'>
<a name='13494'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13495'></font>
<font color=#447700>!..Assume Rayleigh approximation at 10 cm wavelength. Rain (all temps)<a name='13496'></font>
<font color=#447700>!.. and non-water-coated snow and graupel when below freezing are<a name='13497'></font>
<font color=#447700>!.. simple. Integrations of m(D)*m(D)*N(D)*dD.<a name='13498'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13499'></font>
<a name='13500'>
      do k = kts, kte<a name='13501'>
         ze_rain(k) = 1.e-22<a name='13502'>
         ze_snow(k) = 1.e-22<a name='13503'>
         ze_graupel(k) = 1.e-22<a name='13504'>
         if (L_qr(k)) ze_rain(k) = N0_r(k)*xcrg(4)*ilamr(k)**xcre(4)<a name='13505'>
         if (L_qs(k)) ze_snow(k) = (0.176/0.93) * (6.0/PI_MORR)*(6.0/PI_MORR)     &amp;<a name='13506'>
                                 * (xam_s/900.0)*(xam_s/900.0)          &amp;<a name='13507'>
                                 * N0_s(k)*xcsg(4)*ilams(k)**xcse(4)<a name='13508'>
         if (L_qg(k)) ze_graupel(k) = (0.176/0.93) * (6.0/PI_MORR)*(6.0/PI_MORR)  &amp;<a name='13509'>
                                    * (xam_g/900.0)*(xam_g/900.0)       &amp;<a name='13510'>
                                    * N0_g(k)*xcgg(4)*ilamg(k)**xcge(4)<a name='13511'>
      enddo<a name='13512'>
<a name='13513'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13514'></font>
<font color=#447700>!..Special case of melting ice (snow/graupel) particles.  Assume the<a name='13515'></font>
<font color=#447700>!.. ice is surrounded by the liquid water.  Fraction of meltwater is<a name='13516'></font>
<font color=#447700>!.. extremely simple based on amount found above the melting level.<a name='13517'></font>
<font color=#447700>!.. Uses code from Uli Blahak (rayleigh_soak_wetgraupel and supporting<a name='13518'></font>
<font color=#447700>!.. routines).<a name='13519'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='13520'></font>
<a name='13521'>
      if (melti .and. k_0.ge.kts+1) then<a name='13522'>
       do k = k_0-1, kts, -1<a name='13523'>
<a name='13524'>
<font color=#447700>!..Reflectivity contributed by melting snow<a name='13525'></font>
          if (L_qs(k) .and. L_qs(k_0) ) then<a name='13526'>
           fmelt_s = MAX(0.005d0, MIN(1.0d0-rs(k)/rs(k_0), 0.99d0))<a name='13527'>
           eta = 0.d0<a name='13528'>
           lams = 1./ilams(k)<a name='13529'>
           do n = 1, nrbins<a name='13530'>
              x = xam_s * xxDs(n)**xbm_s<a name='13531'>
              call <A href='../../html_code/phys/module_mp_radar.F.html#RAYLEIGH_SOAK_WETGRAUPEL'>rayleigh_soak_wetgraupel</A><A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAYLEIGH_SOAK_WETGRAUPEL_3"> (x,DBLE(xocms),DBLE(xobms), &amp;<a name='13532'>
                    fmelt_s, melt_outside_s, m_w_0, m_i_0, lamda_radar, &amp;<a name='13533'>
                    CBACK, mixingrulestring_s, matrixstring_s,          &amp;<a name='13534'>
                    inclusionstring_s, hoststring_s,                    &amp;<a name='13535'>
                    hostmatrixstring_s, hostinclusionstring_s)<a name='13536'>
              f_d = N0_s(k)*xxDs(n)**xmu_s * DEXP(-lams*xxDs(n))<a name='13537'>
              eta = eta + f_d * CBACK * simpson(n) * xdts(n)<a name='13538'>
           enddo<a name='13539'>
           ze_snow(k) = SNGL(lamda4 / (pi5 * K_w) * eta)<a name='13540'>
          endif<a name='13541'>
<a name='13542'>
<a name='13543'>
<font color=#447700>!..Reflectivity contributed by melting graupel<a name='13544'></font>
<a name='13545'>
          if (L_qg(k) .and. L_qg(k_0) ) then<a name='13546'>
           fmelt_g = MAX(0.005d0, MIN(1.0d0-rg(k)/rg(k_0), 0.99d0))<a name='13547'>
           eta = 0.d0<a name='13548'>
           lamg = 1./ilamg(k)<a name='13549'>
           do n = 1, nrbins<a name='13550'>
              x = xam_g * xxDg(n)**xbm_g<a name='13551'>
              call <A href='../../html_code/phys/module_mp_radar.F.html#RAYLEIGH_SOAK_WETGRAUPEL'>rayleigh_soak_wetgraupel</A><A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAYLEIGH_SOAK_WETGRAUPEL_4"> (x,DBLE(xocmg),DBLE(xobmg), &amp;<a name='13552'>
                    fmelt_g, melt_outside_g, m_w_0, m_i_0, lamda_radar, &amp;<a name='13553'>
                    CBACK, mixingrulestring_g, matrixstring_g,          &amp;<a name='13554'>
                    inclusionstring_g, hoststring_g,                    &amp;<a name='13555'>
                    hostmatrixstring_g, hostinclusionstring_g)<a name='13556'>
              f_d = N0_g(k)*xxDg(n)**xmu_g * DEXP(-lamg*xxDg(n))<a name='13557'>
              eta = eta + f_d * CBACK * simpson(n) * xdtg(n)<a name='13558'>
           enddo<a name='13559'>
           ze_graupel(k) = SNGL(lamda4 / (pi5 * K_w) * eta)<a name='13560'>
          endif<a name='13561'>
<a name='13562'>
       enddo<a name='13563'>
      endif<a name='13564'>
<a name='13565'>
      do k = kte, kts, -1<a name='13566'>
         dBZ(k) = 10.*log10((ze_rain(k)+ze_snow(k)+ze_graupel(k))*1.d18)<a name='13567'>
      enddo<a name='13568'>
<a name='13569'>
<a name='13570'>
      end subroutine refl10cm_hm<a name='13571'>
<a name='13572'>
      END MODULE module_mp_full_sbm<a name='13573'>
</pre></body></html>