<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!MODULE module_ra_rrtmg_lw<a name='2'></font>
<a name='3'>
<A NAME='PARKIND'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4'>
      <font color=#993300>module </font><font color=#cc0000>parkind</font> <A href='../../call_to/PARKIND.html' TARGET='index'>61</A><a name='5'>
<font color=#447700>!     implicit none<a name='6'></font>
      save<a name='7'>
<a name='8'>
<font color=#447700>!------------------------------------------------------------------<a name='9'></font>
<font color=#447700>! rrtmg kinds<a name='10'></font>
<font color=#447700>! Define integer and real kinds for various types.<a name='11'></font>
<font color=#447700>!<a name='12'></font>
<font color=#447700>! Initial version: MJIacono, AER, jun2006<a name='13'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='14'></font>
<font color=#447700>!------------------------------------------------------------------<a name='15'></font>
<a name='16'>
<font color=#447700>!<a name='17'></font>
<font color=#447700>!     integer kinds<a name='18'></font>
<font color=#447700>!     -------------<a name='19'></font>
<font color=#447700>!<a name='20'></font>
<font color=#447700>!     integer, parameter :: kind_ib = selected_int_kind(13)  ! 8 byte integer<a name='21'></font>
<font color=#447700>!     integer, parameter :: kind_im = selected_int_kind(6)   ! 4 byte integer<a name='22'></font>
      integer, parameter :: kind_ib = kind(1)            <a name='23'>
      integer, parameter :: kind_im = kind(1)            <a name='24'>
      integer, parameter :: kind_in = kind(1)                <font color=#447700>! native integer<a name='25'></font>
<a name='26'>
<font color=#447700>!<a name='27'></font>
<font color=#447700>!     real kinds<a name='28'></font>
<font color=#447700>!     ----------<a name='29'></font>
<font color=#447700>!<a name='30'></font>
<font color=#447700>!      integer, parameter :: kind_rb = selected_real_kind(12) ! 8 byte real<a name='31'></font>
<font color=#447700>!      integer, parameter :: kind_rm = selected_real_kind(6)  ! 4 byte real<a name='32'></font>
<font color=#447700>!      integer, parameter :: kind_rn = kind(1.0)              ! native real<a name='33'></font>
<a name='34'>
#if 0<a name='35'>
<font color=#447700>! Modified for WRF:<a name='36'></font>
#if (RWORDSIZE == 8)<a name='37'>
      integer, parameter :: kind_rb = selected_real_kind(12) <font color=#447700>! 8 byte real<a name='38'></font>
#endif<a name='39'>
#if (RWORDSIZE == 4)<a name='40'>
      integer, parameter :: kind_rb = selected_real_kind(6)  <font color=#447700>! 4 byte real<a name='41'></font>
#endif<a name='42'>
#else<a name='43'>
       integer, parameter :: kind_rb = kind(1.0)              <font color=#447700>! native real<a name='44'></font>
#endif<a name='45'>
<a name='46'>
      end module parkind<a name='47'>
<a name='48'>
<A NAME='PARRRTM'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='49'>
      <font color=#993300>module </font><font color=#cc0000>parrrtm</font> <A href='../../call_to/PARRRTM.html' TARGET='index'>43</A>,<A href='../../call_from/PARRRTM.html' TARGET='index'>1</A><a name='50'>
<a name='51'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_1"> ,only : im =&gt; kind_im<a name='52'>
<a name='53'>
<font color=#447700>!     implicit none<a name='54'></font>
      save<a name='55'>
<a name='56'>
<font color=#447700>!------------------------------------------------------------------<a name='57'></font>
<font color=#447700>! rrtmg_lw main parameters<a name='58'></font>
<font color=#447700>!<a name='59'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, Jul 1998<a name='60'></font>
<font color=#447700>! Revised: MJIacono, AER, Jun 2006<a name='61'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2007<a name='62'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2008<a name='63'></font>
<font color=#447700>!------------------------------------------------------------------<a name='64'></font>
<a name='65'>
<font color=#447700>!  name     type     purpose<a name='66'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='67'></font>
<font color=#447700>! mxlay  :  integer: maximum number of layers<a name='68'></font>
<font color=#447700>! mg     :  integer: number of original g-intervals per spectral band<a name='69'></font>
<font color=#447700>! nbndlw :  integer: number of spectral bands<a name='70'></font>
<font color=#447700>! maxxsec:  integer: maximum number of cross-section molecules<a name='71'></font>
<font color=#447700>!                    (e.g. cfcs)<a name='72'></font>
<font color=#447700>! maxinpx:  integer: <a name='73'></font>
<font color=#447700>! ngptlw :  integer: total number of reduced g-intervals for rrtmg_lw<a name='74'></font>
<font color=#447700>! ngNN   :  integer: number of reduced g-intervals per spectral band<a name='75'></font>
<font color=#447700>! ngsNN  :  integer: cumulative number of g-intervals per band<a name='76'></font>
<font color=#447700>!------------------------------------------------------------------<a name='77'></font>
<a name='78'>
      integer(kind=im), parameter :: mxlay  = 203<a name='79'>
      integer(kind=im), parameter :: mg     = 16<a name='80'>
      integer(kind=im), parameter :: nbndlw = 16<a name='81'>
      integer(kind=im), parameter :: maxxsec= 4<a name='82'>
      integer(kind=im), parameter :: mxmol  = 38<a name='83'>
      integer(kind=im), parameter :: maxinpx= 38<a name='84'>
      integer(kind=im), parameter :: nmol   = 7<a name='85'>
<font color=#447700>! Use for 140 g-point model <a name='86'></font>
      integer(kind=im), parameter :: ngptlw = 140<a name='87'>
<font color=#447700>! Use for 256 g-point model <a name='88'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngptlw = 256<a name='89'></font>
<a name='90'>
<font color=#447700>! Use for 140 g-point model<a name='91'></font>
      integer(kind=im), parameter :: ng1  = 10<a name='92'>
      integer(kind=im), parameter :: ng2  = 12<a name='93'>
      integer(kind=im), parameter :: ng3  = 16<a name='94'>
      integer(kind=im), parameter :: ng4  = 14<a name='95'>
      integer(kind=im), parameter :: ng5  = 16<a name='96'>
      integer(kind=im), parameter :: ng6  = 8<a name='97'>
      integer(kind=im), parameter :: ng7  = 12<a name='98'>
      integer(kind=im), parameter :: ng8  = 8<a name='99'>
      integer(kind=im), parameter :: ng9  = 12<a name='100'>
      integer(kind=im), parameter :: ng10 = 6<a name='101'>
      integer(kind=im), parameter :: ng11 = 8<a name='102'>
      integer(kind=im), parameter :: ng12 = 8<a name='103'>
      integer(kind=im), parameter :: ng13 = 4<a name='104'>
      integer(kind=im), parameter :: ng14 = 2<a name='105'>
      integer(kind=im), parameter :: ng15 = 2<a name='106'>
      integer(kind=im), parameter :: ng16 = 2<a name='107'>
<a name='108'>
      integer(kind=im), parameter :: ngs1  = 10<a name='109'>
      integer(kind=im), parameter :: ngs2  = 22<a name='110'>
      integer(kind=im), parameter :: ngs3  = 38<a name='111'>
      integer(kind=im), parameter :: ngs4  = 52<a name='112'>
      integer(kind=im), parameter :: ngs5  = 68<a name='113'>
      integer(kind=im), parameter :: ngs6  = 76<a name='114'>
      integer(kind=im), parameter :: ngs7  = 88<a name='115'>
      integer(kind=im), parameter :: ngs8  = 96<a name='116'>
      integer(kind=im), parameter :: ngs9  = 108<a name='117'>
      integer(kind=im), parameter :: ngs10 = 114<a name='118'>
      integer(kind=im), parameter :: ngs11 = 122<a name='119'>
      integer(kind=im), parameter :: ngs12 = 130<a name='120'>
      integer(kind=im), parameter :: ngs13 = 134<a name='121'>
      integer(kind=im), parameter :: ngs14 = 136<a name='122'>
      integer(kind=im), parameter :: ngs15 = 138<a name='123'>
<a name='124'>
<font color=#447700>! Use for 256 g-point model<a name='125'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng1  = 16<a name='126'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng2  = 16<a name='127'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng3  = 16<a name='128'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng4  = 16<a name='129'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng5  = 16<a name='130'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng6  = 16<a name='131'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng7  = 16<a name='132'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng8  = 16<a name='133'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng9  = 16<a name='134'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng10 = 16<a name='135'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng11 = 16<a name='136'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng12 = 16<a name='137'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng13 = 16<a name='138'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng14 = 16<a name='139'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng15 = 16<a name='140'></font>
<font color=#447700>!      integer(kind=im), parameter :: ng16 = 16<a name='141'></font>
<a name='142'>
<font color=#447700>!      integer(kind=im), parameter :: ngs1  = 16<a name='143'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs2  = 32<a name='144'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs3  = 48<a name='145'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs4  = 64<a name='146'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs5  = 80<a name='147'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs6  = 96<a name='148'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs7  = 112<a name='149'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs8  = 128<a name='150'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs9  = 144<a name='151'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs10 = 160<a name='152'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs11 = 176<a name='153'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs12 = 192<a name='154'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs13 = 208<a name='155'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs14 = 224<a name='156'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs15 = 240<a name='157'></font>
<font color=#447700>!      integer(kind=im), parameter :: ngs16 = 256<a name='158'></font>
<a name='159'>
      end module parrrtm<a name='160'>
<a name='161'>
<A NAME='RRLW_CLD'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CLD' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='162'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_cld</font> <A href='../../call_to/RRLW_CLD.html' TARGET='index'>2</A>,<A href='../../call_from/RRLW_CLD.html' TARGET='index'>1</A><a name='163'>
<a name='164'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CLD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_2">, only : rb =&gt; kind_rb<a name='165'>
<a name='166'>
<font color=#447700>!     implicit none<a name='167'></font>
      save<a name='168'>
<a name='169'>
<font color=#447700>!------------------------------------------------------------------<a name='170'></font>
<font color=#447700>! rrtmg_lw cloud property coefficients<a name='171'></font>
<a name='172'>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='173'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='174'></font>
<font color=#447700>!------------------------------------------------------------------<a name='175'></font>
<a name='176'>
<font color=#447700>!  name     type     purpose<a name='177'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='178'></font>
<font color=#447700>! abscld1:  real   : <a name='179'></font>
<font color=#447700>! absice0:  real   : <a name='180'></font>
<font color=#447700>! absice1:  real   : <a name='181'></font>
<font color=#447700>! absice2:  real   : <a name='182'></font>
<font color=#447700>! absice3:  real   : <a name='183'></font>
<font color=#447700>! absliq0:  real   : <a name='184'></font>
<font color=#447700>! absliq1:  real   : <a name='185'></font>
<font color=#447700>!------------------------------------------------------------------<a name='186'></font>
<a name='187'>
      real(kind=rb) :: abscld1<a name='188'>
      real(kind=rb) , dimension(2) :: absice0<a name='189'>
      real(kind=rb) , dimension(2,5) :: absice1<a name='190'>
      real(kind=rb) , dimension(43,16) :: absice2<a name='191'>
      real(kind=rb) , dimension(46,16) :: absice3<a name='192'>
      real(kind=rb) :: absliq0<a name='193'>
      real(kind=rb) , dimension(58,16) :: absliq1<a name='194'>
<a name='195'>
      end module rrlw_cld<a name='196'>
<a name='197'>
<A NAME='RRLW_CON'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='198'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_con</font> <A href='../../call_to/RRLW_CON.html' TARGET='index'>6</A>,<A href='../../call_from/RRLW_CON.html' TARGET='index'>1</A><a name='199'>
<a name='200'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_3">, only : rb =&gt; kind_rb<a name='201'>
<a name='202'>
<font color=#447700>!     implicit none<a name='203'></font>
      save<a name='204'>
<a name='205'>
<font color=#447700>!------------------------------------------------------------------<a name='206'></font>
<font color=#447700>! rrtmg_lw constants<a name='207'></font>
<a name='208'>
<font color=#447700>! Initial version: MJIacono, AER, jun2006<a name='209'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='210'></font>
<font color=#447700>!------------------------------------------------------------------<a name='211'></font>
<a name='212'>
<font color=#447700>!  name     type     purpose<a name='213'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='214'></font>
<font color=#447700>! fluxfac:  real   : radiance to flux conversion factor <a name='215'></font>
<font color=#447700>! heatfac:  real   : flux to heating rate conversion factor<a name='216'></font>
<font color=#447700>!oneminus:  real   : 1.-1.e-6<a name='217'></font>
<font color=#447700>! pi     :  real   : pi<a name='218'></font>
<font color=#447700>! grav   :  real   : acceleration of gravity<a name='219'></font>
<font color=#447700>! planck :  real   : planck constant<a name='220'></font>
<font color=#447700>! boltz  :  real   : boltzmann constant<a name='221'></font>
<font color=#447700>! clight :  real   : speed of light<a name='222'></font>
<font color=#447700>! avogad :  real   : avogadro constant <a name='223'></font>
<font color=#447700>! alosmt :  real   : loschmidt constant<a name='224'></font>
<font color=#447700>! gascon :  real   : molar gas constant<a name='225'></font>
<font color=#447700>! radcn1 :  real   : first radiation constant<a name='226'></font>
<font color=#447700>! radcn2 :  real   : second radiation constant<a name='227'></font>
<font color=#447700>! sbcnst :  real   : stefan-boltzmann constant<a name='228'></font>
<font color=#447700>!  secdy :  real   : seconds per day  <a name='229'></font>
<font color=#447700>!------------------------------------------------------------------<a name='230'></font>
<a name='231'>
      real(kind=rb) :: fluxfac, heatfac<a name='232'>
      real(kind=rb) :: oneminus, pi, grav<a name='233'>
      real(kind=rb) :: planck, boltz, clight<a name='234'>
      real(kind=rb) :: avogad, alosmt, gascon<a name='235'>
      real(kind=rb) :: radcn1, radcn2<a name='236'>
      real(kind=rb) :: sbcnst, secdy<a name='237'>
<a name='238'>
      end module rrlw_con<a name='239'>
<a name='240'>
<A NAME='RRLW_KG01'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG01' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='241'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg01</font> <A href='../../call_to/RRLW_KG01.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG01.html' TARGET='index'>1</A><a name='242'>
<a name='243'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_4"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='244'>
<a name='245'>
<font color=#447700>!     implicit none<a name='246'></font>
      save<a name='247'>
<a name='248'>
<font color=#447700>!-----------------------------------------------------------------<a name='249'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 1<a name='250'></font>
<font color=#447700>! band 1:  10-250 cm-1 (low - h2o; high - h2o)<a name='251'></font>
<font color=#447700>!<a name='252'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='253'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='254'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='255'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='256'></font>
<font color=#447700>!<a name='257'></font>
<font color=#447700>!  name     type     purpose<a name='258'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='259'></font>
<font color=#447700>!fracrefao: real    <a name='260'></font>
<font color=#447700>!fracrefbo: real<a name='261'></font>
<font color=#447700>! kao     : real     <a name='262'></font>
<font color=#447700>! kbo     : real     <a name='263'></font>
<font color=#447700>! kao_mn2 : real     <a name='264'></font>
<font color=#447700>! kbo_mn2 : real     <a name='265'></font>
<font color=#447700>! selfrefo: real     <a name='266'></font>
<font color=#447700>! forrefo : real<a name='267'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='268'></font>
<a name='269'>
      integer(kind=im), parameter :: no1  = 16<a name='270'>
<a name='271'>
      real(kind=rb) :: fracrefao(no1)  , fracrefbo(no1)<a name='272'>
      real(kind=rb) :: kao(5,13,no1)<a name='273'>
      real(kind=rb) :: kbo(5,13:59,no1)<a name='274'>
      real(kind=rb) :: kao_mn2(19,no1) , kbo_mn2(19,no1)<a name='275'>
      real(kind=rb) :: selfrefo(10,no1), forrefo(4,no1)<a name='276'>
<a name='277'>
<font color=#447700>!-----------------------------------------------------------------<a name='278'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 1<a name='279'></font>
<font color=#447700>! band 1:  10-250 cm-1 (low - h2o; high - h2o)<a name='280'></font>
<font color=#447700>!<a name='281'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='282'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='283'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='284'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='285'></font>
<font color=#447700>!<a name='286'></font>
<font color=#447700>!  name     type     purpose<a name='287'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='288'></font>
<font color=#447700>!fracrefa : real    <a name='289'></font>
<font color=#447700>!fracrefb : real<a name='290'></font>
<font color=#447700>! ka      : real     <a name='291'></font>
<font color=#447700>! kb      : real     <a name='292'></font>
<font color=#447700>! absa    : real<a name='293'></font>
<font color=#447700>! absb    : real<a name='294'></font>
<font color=#447700>! ka_mn2  : real     <a name='295'></font>
<font color=#447700>! kb_mn2  : real     <a name='296'></font>
<font color=#447700>! selfref : real     <a name='297'></font>
<font color=#447700>! forref  : real<a name='298'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='299'></font>
<a name='300'>
      integer(kind=im), parameter :: ng1  = 10<a name='301'>
<a name='302'>
      real(kind=rb) :: fracrefa(ng1)  , fracrefb(ng1)<a name='303'>
      real(kind=rb) :: ka(5,13,ng1)   , absa(65,ng1)<a name='304'>
      real(kind=rb) :: kb(5,13:59,ng1), absb(235,ng1)<a name='305'>
      real(kind=rb) :: ka_mn2(19,ng1) , kb_mn2(19,ng1)<a name='306'>
      real(kind=rb) :: selfref(10,ng1), forref(4,ng1)<a name='307'>
<a name='308'>
      equivalence (ka(1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='309'>
<a name='310'>
      end module rrlw_kg01<a name='311'>
<a name='312'>
<A NAME='RRLW_KG02'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG02' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='313'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg02</font> <A href='../../call_to/RRLW_KG02.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG02.html' TARGET='index'>1</A><a name='314'>
<a name='315'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_5"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='316'>
<a name='317'>
<font color=#447700>!     implicit none<a name='318'></font>
      save<a name='319'>
<a name='320'>
<font color=#447700>!-----------------------------------------------------------------<a name='321'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 2<a name='322'></font>
<font color=#447700>! band 2:  250-500 cm-1 (low - h2o; high - h2o)<a name='323'></font>
<font color=#447700>!<a name='324'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='325'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='326'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='327'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='328'></font>
<font color=#447700>!<a name='329'></font>
<font color=#447700>!  name     type     purpose<a name='330'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='331'></font>
<font color=#447700>!fracrefao: real    <a name='332'></font>
<font color=#447700>!fracrefbo: real<a name='333'></font>
<font color=#447700>! kao     : real     <a name='334'></font>
<font color=#447700>! kbo     : real     <a name='335'></font>
<font color=#447700>! selfrefo: real     <a name='336'></font>
<font color=#447700>! forrefo : real<a name='337'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='338'></font>
<a name='339'>
      integer(kind=im), parameter :: no2  = 16<a name='340'>
<a name='341'>
      real(kind=rb) :: fracrefao(no2)   , fracrefbo(no2)<a name='342'>
      real(kind=rb) :: kao(5,13,no2)<a name='343'>
      real(kind=rb) :: kbo(5,13:59,no2)<a name='344'>
      real(kind=rb) :: selfrefo(10,no2) , forrefo(4,no2)<a name='345'>
<a name='346'>
<font color=#447700>!-----------------------------------------------------------------<a name='347'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 2<a name='348'></font>
<font color=#447700>! band 2:  250-500 cm-1 (low - h2o; high - h2o)<a name='349'></font>
<font color=#447700>!<a name='350'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='351'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='352'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='353'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='354'></font>
<font color=#447700>!<a name='355'></font>
<font color=#447700>!  name     type     purpose<a name='356'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='357'></font>
<font color=#447700>!fracrefa : real    <a name='358'></font>
<font color=#447700>!fracrefb : real<a name='359'></font>
<font color=#447700>! ka      : real     <a name='360'></font>
<font color=#447700>! kb      : real     <a name='361'></font>
<font color=#447700>! absa    : real<a name='362'></font>
<font color=#447700>! absb    : real<a name='363'></font>
<font color=#447700>! selfref : real     <a name='364'></font>
<font color=#447700>! forref  : real<a name='365'></font>
<font color=#447700>!<a name='366'></font>
<font color=#447700>! refparam: real<a name='367'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='368'></font>
<a name='369'>
      integer(kind=im), parameter :: ng2  = 12<a name='370'>
<a name='371'>
      real(kind=rb) :: fracrefa(ng2)  , fracrefb(ng2)<a name='372'>
      real(kind=rb) :: ka(5,13,ng2)   , absa(65,ng2)<a name='373'>
      real(kind=rb) :: kb(5,13:59,ng2), absb(235,ng2)<a name='374'>
      real(kind=rb) :: selfref(10,ng2), forref(4,ng2)<a name='375'>
<a name='376'>
      real(kind=rb) :: refparam(13)<a name='377'>
<a name='378'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='379'>
<a name='380'>
      end module rrlw_kg02<a name='381'>
<a name='382'>
<A NAME='RRLW_KG03'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG03' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='383'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg03</font> <A href='../../call_to/RRLW_KG03.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG03.html' TARGET='index'>1</A><a name='384'>
<a name='385'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_6"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='386'>
<a name='387'>
<font color=#447700>!     implicit none<a name='388'></font>
      save<a name='389'>
<a name='390'>
<font color=#447700>!-----------------------------------------------------------------<a name='391'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 3<a name='392'></font>
<font color=#447700>! band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='393'></font>
<font color=#447700>!<a name='394'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='395'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='396'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='397'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='398'></font>
<font color=#447700>!<a name='399'></font>
<font color=#447700>!  name     type     purpose<a name='400'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='401'></font>
<font color=#447700>!fracrefao: real    <a name='402'></font>
<font color=#447700>!fracrefbo: real<a name='403'></font>
<font color=#447700>! kao     : real     <a name='404'></font>
<font color=#447700>! kbo     : real     <a name='405'></font>
<font color=#447700>! kao_mn2o: real     <a name='406'></font>
<font color=#447700>! kbo_mn2o: real     <a name='407'></font>
<font color=#447700>! selfrefo: real     <a name='408'></font>
<font color=#447700>! forrefo : real<a name='409'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='410'></font>
<a name='411'>
      integer(kind=im), parameter :: no3  = 16<a name='412'>
<a name='413'>
      real(kind=rb) :: fracrefao(no3,9) ,fracrefbo(no3,5)<a name='414'>
      real(kind=rb) :: kao(9,5,13,no3)<a name='415'>
      real(kind=rb) :: kbo(5,5,13:59,no3)<a name='416'>
      real(kind=rb) :: kao_mn2o(9,19,no3), kbo_mn2o(5,19,no3)<a name='417'>
      real(kind=rb) :: selfrefo(10,no3)<a name='418'>
      real(kind=rb) :: forrefo(4,no3)<a name='419'>
<a name='420'>
<font color=#447700>!-----------------------------------------------------------------<a name='421'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 3<a name='422'></font>
<font color=#447700>! band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='423'></font>
<font color=#447700>!<a name='424'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='425'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='426'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='427'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='428'></font>
<font color=#447700>!<a name='429'></font>
<font color=#447700>!  name     type     purpose<a name='430'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='431'></font>
<font color=#447700>!fracrefa : real    <a name='432'></font>
<font color=#447700>!fracrefb : real<a name='433'></font>
<font color=#447700>! ka      : real     <a name='434'></font>
<font color=#447700>! kb      : real     <a name='435'></font>
<font color=#447700>! ka_mn2o : real     <a name='436'></font>
<font color=#447700>! kb_mn2o : real     <a name='437'></font>
<font color=#447700>! selfref : real     <a name='438'></font>
<font color=#447700>! forref  : real<a name='439'></font>
<font color=#447700>!<a name='440'></font>
<font color=#447700>! absa    : real<a name='441'></font>
<font color=#447700>! absb    : real<a name='442'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='443'></font>
<a name='444'>
      integer(kind=im), parameter :: ng3  = 16<a name='445'>
<a name='446'>
      real(kind=rb) :: fracrefa(ng3,9) ,fracrefb(ng3,5)<a name='447'>
      real(kind=rb) :: ka(9,5,13,ng3)  ,absa(585,ng3)<a name='448'>
      real(kind=rb) :: kb(5,5,13:59,ng3),absb(1175,ng3)<a name='449'>
      real(kind=rb) :: ka_mn2o(9,19,ng3), kb_mn2o(5,19,ng3)<a name='450'>
      real(kind=rb) :: selfref(10,ng3)<a name='451'>
      real(kind=rb) :: forref(4,ng3)<a name='452'>
<a name='453'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='454'>
<a name='455'>
      end module rrlw_kg03<a name='456'>
<a name='457'>
<A NAME='RRLW_KG04'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG04' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='458'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg04</font> <A href='../../call_to/RRLW_KG04.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG04.html' TARGET='index'>1</A><a name='459'>
<a name='460'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_7"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='461'>
<a name='462'>
<font color=#447700>!     implicit none<a name='463'></font>
      save<a name='464'>
<a name='465'>
<font color=#447700>!-----------------------------------------------------------------<a name='466'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 4<a name='467'></font>
<font color=#447700>! band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='468'></font>
<font color=#447700>!<a name='469'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='470'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='471'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='472'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='473'></font>
<font color=#447700>!<a name='474'></font>
<font color=#447700>!  name     type     purpose<a name='475'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='476'></font>
<font color=#447700>!fracrefao: real    <a name='477'></font>
<font color=#447700>!fracrefbo: real<a name='478'></font>
<font color=#447700>! kao     : real     <a name='479'></font>
<font color=#447700>! kbo     : real     <a name='480'></font>
<font color=#447700>! selfrefo: real     <a name='481'></font>
<font color=#447700>! forrefo : real     <a name='482'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='483'></font>
<a name='484'>
      integer(kind=im), parameter :: no4  = 16<a name='485'>
<a name='486'>
      real(kind=rb) :: fracrefao(no4,9)  ,fracrefbo(no4,5)<a name='487'>
      real(kind=rb) :: kao(9,5,13,no4)<a name='488'>
      real(kind=rb) :: kbo(5,5,13:59,no4)<a name='489'>
      real(kind=rb) :: selfrefo(10,no4)  ,forrefo(4,no4)<a name='490'>
<a name='491'>
<font color=#447700>!-----------------------------------------------------------------<a name='492'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 4<a name='493'></font>
<font color=#447700>! band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='494'></font>
<font color=#447700>!<a name='495'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='496'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='497'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='498'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='499'></font>
<font color=#447700>!<a name='500'></font>
<font color=#447700>!  name     type     purpose<a name='501'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='502'></font>
<font color=#447700>! absa    : real<a name='503'></font>
<font color=#447700>! absb    : real<a name='504'></font>
<font color=#447700>!fracrefa : real    <a name='505'></font>
<font color=#447700>!fracrefb : real<a name='506'></font>
<font color=#447700>! ka      : real     <a name='507'></font>
<font color=#447700>! kb      : real     <a name='508'></font>
<font color=#447700>! selfref : real     <a name='509'></font>
<font color=#447700>! forref  : real     <a name='510'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='511'></font>
<a name='512'>
      integer(kind=im), parameter :: ng4  = 14<a name='513'>
<a name='514'>
      real(kind=rb) :: fracrefa(ng4,9)  ,fracrefb(ng4,5)<a name='515'>
      real(kind=rb) :: ka(9,5,13,ng4)   ,absa(585,ng4)<a name='516'>
      real(kind=rb) :: kb(5,5,13:59,ng4),absb(1175,ng4)<a name='517'>
      real(kind=rb) :: selfref(10,ng4)  ,forref(4,ng4)<a name='518'>
<a name='519'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='520'>
<a name='521'>
      end module rrlw_kg04<a name='522'>
<a name='523'>
<A NAME='RRLW_KG05'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG05' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='524'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg05</font> <A href='../../call_to/RRLW_KG05.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG05.html' TARGET='index'>1</A><a name='525'>
<a name='526'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_8"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='527'>
<a name='528'>
<font color=#447700>!     implicit none<a name='529'></font>
      save<a name='530'>
<a name='531'>
<font color=#447700>!-----------------------------------------------------------------<a name='532'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 5<a name='533'></font>
<font color=#447700>! band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='534'></font>
<font color=#447700>!<a name='535'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='536'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='537'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='538'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='539'></font>
<font color=#447700>!<a name='540'></font>
<font color=#447700>!  name     type     purpose<a name='541'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='542'></font>
<font color=#447700>!fracrefao: real    <a name='543'></font>
<font color=#447700>!fracrefbo: real<a name='544'></font>
<font color=#447700>! kao     : real     <a name='545'></font>
<font color=#447700>! kbo     : real     <a name='546'></font>
<font color=#447700>! kao_mo3 : real     <a name='547'></font>
<font color=#447700>! selfrefo: real     <a name='548'></font>
<font color=#447700>! forrefo : real     <a name='549'></font>
<font color=#447700>! ccl4o   : real<a name='550'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='551'></font>
<a name='552'>
      integer(kind=im), parameter :: no5  = 16<a name='553'>
<a name='554'>
      real(kind=rb) :: fracrefao(no5,9) ,fracrefbo(no5,5)<a name='555'>
      real(kind=rb) :: kao(9,5,13,no5)<a name='556'>
      real(kind=rb) :: kbo(5,5,13:59,no5)<a name='557'>
      real(kind=rb) :: kao_mo3(9,19,no5)<a name='558'>
      real(kind=rb) :: selfrefo(10,no5)<a name='559'>
      real(kind=rb) :: forrefo(4,no5)<a name='560'>
      real(kind=rb) :: ccl4o(no5)<a name='561'>
<a name='562'>
<font color=#447700>!-----------------------------------------------------------------<a name='563'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 5<a name='564'></font>
<font color=#447700>! band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='565'></font>
<font color=#447700>!<a name='566'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='567'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='568'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='569'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='570'></font>
<font color=#447700>!<a name='571'></font>
<font color=#447700>!  name     type     purpose<a name='572'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='573'></font>
<font color=#447700>!fracrefa : real    <a name='574'></font>
<font color=#447700>!fracrefb : real<a name='575'></font>
<font color=#447700>! ka      : real     <a name='576'></font>
<font color=#447700>! kb      : real     <a name='577'></font>
<font color=#447700>! ka_mo3  : real     <a name='578'></font>
<font color=#447700>! selfref : real     <a name='579'></font>
<font color=#447700>! forref  : real     <a name='580'></font>
<font color=#447700>! ccl4    : real<a name='581'></font>
<font color=#447700>!<a name='582'></font>
<font color=#447700>! absa    : real<a name='583'></font>
<font color=#447700>! absb    : real<a name='584'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='585'></font>
<a name='586'>
      integer(kind=im), parameter :: ng5  = 16<a name='587'>
<a name='588'>
      real(kind=rb) :: fracrefa(ng5,9) ,fracrefb(ng5,5)<a name='589'>
      real(kind=rb) :: ka(9,5,13,ng5)   ,absa(585,ng5)<a name='590'>
      real(kind=rb) :: kb(5,5,13:59,ng5),absb(1175,ng5)<a name='591'>
      real(kind=rb) :: ka_mo3(9,19,ng5)<a name='592'>
      real(kind=rb) :: selfref(10,ng5)<a name='593'>
      real(kind=rb) :: forref(4,ng5)<a name='594'>
      real(kind=rb) :: ccl4(ng5)<a name='595'>
      <a name='596'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,1,13,1),absb(1,1))<a name='597'>
<a name='598'>
      end module rrlw_kg05<a name='599'>
<a name='600'>
<A NAME='RRLW_KG06'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG06' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='601'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg06</font> <A href='../../call_to/RRLW_KG06.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG06.html' TARGET='index'>1</A><a name='602'>
<a name='603'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_9"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='604'>
<a name='605'>
<font color=#447700>!     implicit none<a name='606'></font>
      save<a name='607'>
<a name='608'>
<font color=#447700>!-----------------------------------------------------------------<a name='609'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 6<a name='610'></font>
<font color=#447700>! band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='611'></font>
<font color=#447700>!<a name='612'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='613'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='614'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='615'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='616'></font>
<font color=#447700>!<a name='617'></font>
<font color=#447700>!  name     type     purpose<a name='618'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='619'></font>
<font color=#447700>!fracrefao: real    <a name='620'></font>
<font color=#447700>! kao     : real     <a name='621'></font>
<font color=#447700>! kao_mco2: real     <a name='622'></font>
<font color=#447700>! selfrefo: real     <a name='623'></font>
<font color=#447700>! forrefo : real     <a name='624'></font>
<font color=#447700>!cfc11adjo: real<a name='625'></font>
<font color=#447700>! cfc12o  : real<a name='626'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='627'></font>
<a name='628'>
      integer(kind=im), parameter :: no6  = 16<a name='629'>
<a name='630'>
      real(kind=rb) , dimension(no6) :: fracrefao<a name='631'>
      real(kind=rb) :: kao(5,13,no6)<a name='632'>
      real(kind=rb) :: kao_mco2(19,no6)<a name='633'>
      real(kind=rb) :: selfrefo(10,no6)<a name='634'>
      real(kind=rb) :: forrefo(4,no6)<a name='635'>
<a name='636'>
      real(kind=rb) , dimension(no6) :: cfc11adjo<a name='637'>
      real(kind=rb) , dimension(no6) :: cfc12o<a name='638'>
<a name='639'>
<font color=#447700>!-----------------------------------------------------------------<a name='640'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 6<a name='641'></font>
<font color=#447700>! band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='642'></font>
<font color=#447700>!<a name='643'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='644'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='645'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='646'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='647'></font>
<font color=#447700>!<a name='648'></font>
<font color=#447700>!  name     type     purpose<a name='649'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='650'></font>
<font color=#447700>!fracrefa : real    <a name='651'></font>
<font color=#447700>! ka      : real     <a name='652'></font>
<font color=#447700>! ka_mco2 : real     <a name='653'></font>
<font color=#447700>! selfref : real     <a name='654'></font>
<font color=#447700>! forref  : real     <a name='655'></font>
<font color=#447700>!cfc11adj : real<a name='656'></font>
<font color=#447700>! cfc12   : real<a name='657'></font>
<font color=#447700>!<a name='658'></font>
<font color=#447700>! absa    : real<a name='659'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='660'></font>
<a name='661'>
      integer(kind=im), parameter :: ng6  = 8<a name='662'>
<a name='663'>
      real(kind=rb) , dimension(ng6) :: fracrefa<a name='664'>
      real(kind=rb) :: ka(5,13,ng6),absa(65,ng6)<a name='665'>
      real(kind=rb) :: ka_mco2(19,ng6)<a name='666'>
      real(kind=rb) :: selfref(10,ng6)<a name='667'>
      real(kind=rb) :: forref(4,ng6)<a name='668'>
<a name='669'>
      real(kind=rb) , dimension(ng6) :: cfc11adj<a name='670'>
      real(kind=rb) , dimension(ng6) :: cfc12<a name='671'>
<a name='672'>
      equivalence (ka(1,1,1),absa(1,1))<a name='673'>
<a name='674'>
      end module rrlw_kg06<a name='675'>
<a name='676'>
<A NAME='RRLW_KG07'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG07' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='677'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg07</font> <A href='../../call_to/RRLW_KG07.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG07.html' TARGET='index'>1</A><a name='678'>
<a name='679'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_10"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='680'>
<a name='681'>
<font color=#447700>!     implicit none<a name='682'></font>
      save<a name='683'>
<a name='684'>
<font color=#447700>!-----------------------------------------------------------------<a name='685'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 7<a name='686'></font>
<font color=#447700>! band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='687'></font>
<font color=#447700>!<a name='688'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='689'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='690'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='691'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='692'></font>
<font color=#447700>!<a name='693'></font>
<font color=#447700>!  name     type     purpose<a name='694'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='695'></font>
<font color=#447700>!fracrefao: real    <a name='696'></font>
<font color=#447700>!fracrefbo: real    <a name='697'></font>
<font color=#447700>! kao     : real     <a name='698'></font>
<font color=#447700>! kbo     : real     <a name='699'></font>
<font color=#447700>! kao_mco2: real     <a name='700'></font>
<font color=#447700>! kbo_mco2: real     <a name='701'></font>
<font color=#447700>! selfrefo: real     <a name='702'></font>
<font color=#447700>! forrefo : real     <a name='703'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='704'></font>
<a name='705'>
      integer(kind=im), parameter :: no7  = 16<a name='706'>
<a name='707'>
      real(kind=rb) , dimension(no7) :: fracrefbo<a name='708'>
      real(kind=rb) :: fracrefao(no7,9)<a name='709'>
      real(kind=rb) :: kao(9,5,13,no7)<a name='710'>
      real(kind=rb) :: kbo(5,13:59,no7)<a name='711'>
      real(kind=rb) :: kao_mco2(9,19,no7)<a name='712'>
      real(kind=rb) :: kbo_mco2(19,no7)<a name='713'>
      real(kind=rb) :: selfrefo(10,no7)<a name='714'>
      real(kind=rb) :: forrefo(4,no7)<a name='715'>
<a name='716'>
<font color=#447700>!-----------------------------------------------------------------<a name='717'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 7<a name='718'></font>
<font color=#447700>! band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='719'></font>
<font color=#447700>!<a name='720'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='721'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='722'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='723'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='724'></font>
<font color=#447700>!<a name='725'></font>
<font color=#447700>!  name     type     purpose<a name='726'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='727'></font>
<font color=#447700>!fracrefa : real    <a name='728'></font>
<font color=#447700>!fracrefb : real    <a name='729'></font>
<font color=#447700>! ka      : real     <a name='730'></font>
<font color=#447700>! kb      : real     <a name='731'></font>
<font color=#447700>! ka_mco2 : real     <a name='732'></font>
<font color=#447700>! kb_mco2 : real     <a name='733'></font>
<font color=#447700>! selfref : real     <a name='734'></font>
<font color=#447700>! forref  : real     <a name='735'></font>
<font color=#447700>!<a name='736'></font>
<font color=#447700>! absa    : real<a name='737'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='738'></font>
<a name='739'>
      integer(kind=im), parameter :: ng7  = 12<a name='740'>
<a name='741'>
      real(kind=rb) , dimension(ng7) :: fracrefb<a name='742'>
      real(kind=rb) :: fracrefa(ng7,9)<a name='743'>
      real(kind=rb) :: ka(9,5,13,ng7) ,absa(585,ng7)<a name='744'>
      real(kind=rb) :: kb(5,13:59,ng7),absb(235,ng7)<a name='745'>
      real(kind=rb) :: ka_mco2(9,19,ng7)<a name='746'>
      real(kind=rb) :: kb_mco2(19,ng7)<a name='747'>
      real(kind=rb) :: selfref(10,ng7)<a name='748'>
      real(kind=rb) :: forref(4,ng7)<a name='749'>
<a name='750'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='751'>
<a name='752'>
      end module rrlw_kg07<a name='753'>
<a name='754'>
<A NAME='RRLW_KG08'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG08' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='755'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg08</font> <A href='../../call_to/RRLW_KG08.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG08.html' TARGET='index'>1</A><a name='756'>
<a name='757'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_11"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='758'>
<a name='759'>
<font color=#447700>!     implicit none<a name='760'></font>
      save<a name='761'>
<a name='762'>
<font color=#447700>!-----------------------------------------------------------------<a name='763'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 8<a name='764'></font>
<font color=#447700>! band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='765'></font>
<font color=#447700>!<a name='766'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='767'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='768'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='769'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='770'></font>
<font color=#447700>!<a name='771'></font>
<font color=#447700>!  name     type     purpose<a name='772'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='773'></font>
<font color=#447700>!fracrefao: real    <a name='774'></font>
<font color=#447700>!fracrefbo: real    <a name='775'></font>
<font color=#447700>! kao     : real     <a name='776'></font>
<font color=#447700>! kbo     : real     <a name='777'></font>
<font color=#447700>! kao_mco2: real     <a name='778'></font>
<font color=#447700>! kbo_mco2: real     <a name='779'></font>
<font color=#447700>! kao_mn2o: real     <a name='780'></font>
<font color=#447700>! kbo_mn2o: real     <a name='781'></font>
<font color=#447700>! kao_mo3 : real     <a name='782'></font>
<font color=#447700>! selfrefo: real     <a name='783'></font>
<font color=#447700>! forrefo : real     <a name='784'></font>
<font color=#447700>! cfc12o  : real     <a name='785'></font>
<font color=#447700>!cfc22adjo: real     <a name='786'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='787'></font>
<a name='788'>
      integer(kind=im), parameter :: no8  = 16<a name='789'>
<a name='790'>
      real(kind=rb) , dimension(no8) :: fracrefao<a name='791'>
      real(kind=rb) , dimension(no8) :: fracrefbo<a name='792'>
      real(kind=rb) , dimension(no8) :: cfc12o<a name='793'>
      real(kind=rb) , dimension(no8) :: cfc22adjo<a name='794'>
<a name='795'>
      real(kind=rb) :: kao(5,13,no8)<a name='796'>
      real(kind=rb) :: kao_mco2(19,no8)<a name='797'>
      real(kind=rb) :: kao_mn2o(19,no8)<a name='798'>
      real(kind=rb) :: kao_mo3(19,no8)<a name='799'>
      real(kind=rb) :: kbo(5,13:59,no8)<a name='800'>
      real(kind=rb) :: kbo_mco2(19,no8)<a name='801'>
      real(kind=rb) :: kbo_mn2o(19,no8)<a name='802'>
      real(kind=rb) :: selfrefo(10,no8)<a name='803'>
      real(kind=rb) :: forrefo(4,no8)<a name='804'>
<a name='805'>
<font color=#447700>!-----------------------------------------------------------------<a name='806'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 8<a name='807'></font>
<font color=#447700>! band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='808'></font>
<font color=#447700>!<a name='809'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='810'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='811'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='812'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='813'></font>
<font color=#447700>!<a name='814'></font>
<font color=#447700>!  name     type     purpose<a name='815'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='816'></font>
<font color=#447700>!fracrefa : real    <a name='817'></font>
<font color=#447700>!fracrefb : real    <a name='818'></font>
<font color=#447700>! ka      : real     <a name='819'></font>
<font color=#447700>! kb      : real     <a name='820'></font>
<font color=#447700>! ka_mco2 : real     <a name='821'></font>
<font color=#447700>! kb_mco2 : real     <a name='822'></font>
<font color=#447700>! ka_mn2o : real     <a name='823'></font>
<font color=#447700>! kb_mn2o : real     <a name='824'></font>
<font color=#447700>! ka_mo3  : real     <a name='825'></font>
<font color=#447700>! selfref : real     <a name='826'></font>
<font color=#447700>! forref  : real     <a name='827'></font>
<font color=#447700>! cfc12   : real     <a name='828'></font>
<font color=#447700>! cfc22adj: real     <a name='829'></font>
<font color=#447700>!<a name='830'></font>
<font color=#447700>! absa    : real<a name='831'></font>
<font color=#447700>! absb    : real<a name='832'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='833'></font>
<a name='834'>
      integer(kind=im), parameter :: ng8  = 8<a name='835'>
<a name='836'>
      real(kind=rb) , dimension(ng8) :: fracrefa<a name='837'>
      real(kind=rb) , dimension(ng8) :: fracrefb<a name='838'>
      real(kind=rb) , dimension(ng8) :: cfc12<a name='839'>
      real(kind=rb) , dimension(ng8) :: cfc22adj<a name='840'>
<a name='841'>
      real(kind=rb) :: ka(5,13,ng8)    ,absa(65,ng8)<a name='842'>
      real(kind=rb) :: kb(5,13:59,ng8) ,absb(235,ng8)<a name='843'>
      real(kind=rb) :: ka_mco2(19,ng8)<a name='844'>
      real(kind=rb) :: ka_mn2o(19,ng8)<a name='845'>
      real(kind=rb) :: ka_mo3(19,ng8)<a name='846'>
      real(kind=rb) :: kb_mco2(19,ng8)<a name='847'>
      real(kind=rb) :: kb_mn2o(19,ng8)<a name='848'>
      real(kind=rb) :: selfref(10,ng8)<a name='849'>
      real(kind=rb) :: forref(4,ng8)<a name='850'>
<a name='851'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='852'>
<a name='853'>
      end module rrlw_kg08<a name='854'>
<a name='855'>
<A NAME='RRLW_KG09'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG09' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='856'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg09</font> <A href='../../call_to/RRLW_KG09.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG09.html' TARGET='index'>1</A><a name='857'>
<a name='858'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_12"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='859'>
<a name='860'>
<font color=#447700>!     implicit none<a name='861'></font>
      save<a name='862'>
<a name='863'>
<font color=#447700>!-----------------------------------------------------------------<a name='864'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 9<a name='865'></font>
<font color=#447700>! band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='866'></font>
<font color=#447700>!<a name='867'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='868'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='869'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='870'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='871'></font>
<font color=#447700>!<a name='872'></font>
<font color=#447700>!  name     type     purpose<a name='873'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='874'></font>
<font color=#447700>!fracrefao: real    <a name='875'></font>
<font color=#447700>!fracrefbo: real    <a name='876'></font>
<font color=#447700>! kao     : real     <a name='877'></font>
<font color=#447700>! kbo     : real     <a name='878'></font>
<font color=#447700>! kao_mn2o: real     <a name='879'></font>
<font color=#447700>! kbo_mn2o: real     <a name='880'></font>
<font color=#447700>! selfrefo: real     <a name='881'></font>
<font color=#447700>! forrefo : real     <a name='882'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='883'></font>
<a name='884'>
      integer(kind=im), parameter :: no9  = 16<a name='885'>
<a name='886'>
      real(kind=rb) , dimension(no9) :: fracrefbo<a name='887'>
<a name='888'>
      real(kind=rb) :: fracrefao(no9,9)<a name='889'>
      real(kind=rb) :: kao(9,5,13,no9)<a name='890'>
      real(kind=rb) :: kbo(5,13:59,no9)<a name='891'>
      real(kind=rb) :: kao_mn2o(9,19,no9)<a name='892'>
      real(kind=rb) :: kbo_mn2o(19,no9)<a name='893'>
      real(kind=rb) :: selfrefo(10,no9)<a name='894'>
      real(kind=rb) :: forrefo(4,no9)<a name='895'>
<a name='896'>
<font color=#447700>!-----------------------------------------------------------------<a name='897'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 9<a name='898'></font>
<font color=#447700>! band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='899'></font>
<font color=#447700>!<a name='900'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='901'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='902'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='903'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='904'></font>
<font color=#447700>!<a name='905'></font>
<font color=#447700>!  name     type     purpose<a name='906'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='907'></font>
<font color=#447700>!fracrefa : real    <a name='908'></font>
<font color=#447700>!fracrefb : real    <a name='909'></font>
<font color=#447700>! ka      : real     <a name='910'></font>
<font color=#447700>! kb      : real     <a name='911'></font>
<font color=#447700>! ka_mn2o : real     <a name='912'></font>
<font color=#447700>! kb_mn2o : real     <a name='913'></font>
<font color=#447700>! selfref : real     <a name='914'></font>
<font color=#447700>! forref  : real     <a name='915'></font>
<font color=#447700>!<a name='916'></font>
<font color=#447700>! absa    : real<a name='917'></font>
<font color=#447700>! absb    : real<a name='918'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='919'></font>
<a name='920'>
      integer(kind=im), parameter :: ng9  = 12<a name='921'>
<a name='922'>
      real(kind=rb) , dimension(ng9) :: fracrefb<a name='923'>
      real(kind=rb) :: fracrefa(ng9,9)<a name='924'>
      real(kind=rb) :: ka(9,5,13,ng9) ,absa(585,ng9)<a name='925'>
      real(kind=rb) :: kb(5,13:59,ng9) ,absb(235,ng9)<a name='926'>
      real(kind=rb) :: ka_mn2o(9,19,ng9)<a name='927'>
      real(kind=rb) :: kb_mn2o(19,ng9)<a name='928'>
      real(kind=rb) :: selfref(10,ng9)<a name='929'>
      real(kind=rb) :: forref(4,ng9)<a name='930'>
<a name='931'>
      equivalence (ka(1,1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='932'>
<a name='933'>
      end module rrlw_kg09<a name='934'>
<a name='935'>
<A NAME='RRLW_KG10'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG10' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='936'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg10</font> <A href='../../call_to/RRLW_KG10.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG10.html' TARGET='index'>1</A><a name='937'>
<a name='938'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_13"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='939'>
<a name='940'>
<font color=#447700>!     implicit none<a name='941'></font>
      save<a name='942'>
<a name='943'>
<font color=#447700>!-----------------------------------------------------------------<a name='944'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 10<a name='945'></font>
<font color=#447700>! band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='946'></font>
<font color=#447700>!<a name='947'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='948'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='949'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='950'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='951'></font>
<font color=#447700>!<a name='952'></font>
<font color=#447700>!  name     type     purpose<a name='953'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='954'></font>
<font color=#447700>!fracrefao: real    <a name='955'></font>
<font color=#447700>!fracrefbo: real    <a name='956'></font>
<font color=#447700>! kao     : real     <a name='957'></font>
<font color=#447700>! kbo     : real     <a name='958'></font>
<font color=#447700>! selfrefo: real     <a name='959'></font>
<font color=#447700>! forrefo : real     <a name='960'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='961'></font>
<a name='962'>
      integer(kind=im), parameter :: no10 = 16<a name='963'>
<a name='964'>
      real(kind=rb) , dimension(no10) :: fracrefao<a name='965'>
      real(kind=rb) , dimension(no10) :: fracrefbo<a name='966'>
<a name='967'>
      real(kind=rb) :: kao(5,13,no10)<a name='968'>
      real(kind=rb) :: kbo(5,13:59,no10)<a name='969'>
      real(kind=rb) :: selfrefo(10,no10)<a name='970'>
      real(kind=rb) :: forrefo(4,no10)<a name='971'>
<a name='972'>
<font color=#447700>!-----------------------------------------------------------------<a name='973'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 10<a name='974'></font>
<font color=#447700>! band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='975'></font>
<font color=#447700>!<a name='976'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='977'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='978'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='979'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='980'></font>
<font color=#447700>!<a name='981'></font>
<font color=#447700>!  name     type     purpose<a name='982'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='983'></font>
<font color=#447700>!fracrefao: real    <a name='984'></font>
<font color=#447700>!fracrefbo: real    <a name='985'></font>
<font color=#447700>! kao     : real     <a name='986'></font>
<font color=#447700>! kbo     : real     <a name='987'></font>
<font color=#447700>! selfref : real     <a name='988'></font>
<font color=#447700>! forref  : real     <a name='989'></font>
<font color=#447700>!<a name='990'></font>
<font color=#447700>! absa    : real<a name='991'></font>
<font color=#447700>! absb    : real<a name='992'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='993'></font>
<a name='994'>
      integer(kind=im), parameter :: ng10 = 6<a name='995'>
<a name='996'>
      real(kind=rb) , dimension(ng10) :: fracrefa<a name='997'>
      real(kind=rb) , dimension(ng10) :: fracrefb<a name='998'>
<a name='999'>
      real(kind=rb) :: ka(5,13,ng10)   , absa(65,ng10)<a name='1000'>
      real(kind=rb) :: kb(5,13:59,ng10), absb(235,ng10)<a name='1001'>
      real(kind=rb) :: selfref(10,ng10)<a name='1002'>
      real(kind=rb) :: forref(4,ng10)<a name='1003'>
<a name='1004'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='1005'>
<a name='1006'>
      end module rrlw_kg10<a name='1007'>
<a name='1008'>
<A NAME='RRLW_KG11'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG11' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1009'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg11</font> <A href='../../call_to/RRLW_KG11.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG11.html' TARGET='index'>1</A><a name='1010'>
<a name='1011'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_14"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1012'>
<a name='1013'>
<font color=#447700>!     implicit none<a name='1014'></font>
      save<a name='1015'>
<a name='1016'>
<font color=#447700>!-----------------------------------------------------------------<a name='1017'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 11<a name='1018'></font>
<font color=#447700>! band 11:  1480-1800 cm-1 (low - h2o; high - h2o)<a name='1019'></font>
<font color=#447700>!<a name='1020'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1021'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1022'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1023'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1024'></font>
<font color=#447700>!<a name='1025'></font>
<font color=#447700>!  name     type     purpose<a name='1026'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1027'></font>
<font color=#447700>!fracrefao: real    <a name='1028'></font>
<font color=#447700>!fracrefbo: real    <a name='1029'></font>
<font color=#447700>! kao     : real     <a name='1030'></font>
<font color=#447700>! kbo     : real     <a name='1031'></font>
<font color=#447700>! kao_mo2 : real     <a name='1032'></font>
<font color=#447700>! kbo_mo2 : real     <a name='1033'></font>
<font color=#447700>! selfrefo: real     <a name='1034'></font>
<font color=#447700>! forrefo : real     <a name='1035'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1036'></font>
<a name='1037'>
      integer(kind=im), parameter :: no11 = 16<a name='1038'>
<a name='1039'>
      real(kind=rb) , dimension(no11) :: fracrefao<a name='1040'>
      real(kind=rb) , dimension(no11) :: fracrefbo<a name='1041'>
<a name='1042'>
      real(kind=rb) :: kao(5,13,no11)<a name='1043'>
      real(kind=rb) :: kbo(5,13:59,no11)<a name='1044'>
      real(kind=rb) :: kao_mo2(19,no11)<a name='1045'>
      real(kind=rb) :: kbo_mo2(19,no11)<a name='1046'>
      real(kind=rb) :: selfrefo(10,no11)<a name='1047'>
      real(kind=rb) :: forrefo(4,no11)<a name='1048'>
<a name='1049'>
<font color=#447700>!-----------------------------------------------------------------<a name='1050'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 11<a name='1051'></font>
<font color=#447700>! band 11:  1480-1800 cm-1 (low - h2o; high - h2o)<a name='1052'></font>
<font color=#447700>!<a name='1053'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1054'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1055'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1056'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1057'></font>
<font color=#447700>!<a name='1058'></font>
<font color=#447700>!  name     type     purpose<a name='1059'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1060'></font>
<font color=#447700>!fracrefa : real    <a name='1061'></font>
<font color=#447700>!fracrefb : real    <a name='1062'></font>
<font color=#447700>! ka      : real     <a name='1063'></font>
<font color=#447700>! kb      : real     <a name='1064'></font>
<font color=#447700>! ka_mo2  : real     <a name='1065'></font>
<font color=#447700>! kb_mo2  : real     <a name='1066'></font>
<font color=#447700>! selfref : real     <a name='1067'></font>
<font color=#447700>! forref  : real     <a name='1068'></font>
<font color=#447700>!<a name='1069'></font>
<font color=#447700>! absa    : real<a name='1070'></font>
<font color=#447700>! absb    : real<a name='1071'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1072'></font>
<a name='1073'>
      integer(kind=im), parameter :: ng11 = 8<a name='1074'>
<a name='1075'>
      real(kind=rb) , dimension(ng11) :: fracrefa<a name='1076'>
      real(kind=rb) , dimension(ng11) :: fracrefb<a name='1077'>
<a name='1078'>
      real(kind=rb) :: ka(5,13,ng11)   , absa(65,ng11)<a name='1079'>
      real(kind=rb) :: kb(5,13:59,ng11), absb(235,ng11)<a name='1080'>
      real(kind=rb) :: ka_mo2(19,ng11)<a name='1081'>
      real(kind=rb) :: kb_mo2(19,ng11)<a name='1082'>
      real(kind=rb) :: selfref(10,ng11)<a name='1083'>
      real(kind=rb) :: forref(4,ng11)<a name='1084'>
<a name='1085'>
      equivalence (ka(1,1,1),absa(1,1)),(kb(1,13,1),absb(1,1))<a name='1086'>
<a name='1087'>
      end module rrlw_kg11<a name='1088'>
<a name='1089'>
<A NAME='RRLW_KG12'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG12' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1090'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg12</font> <A href='../../call_to/RRLW_KG12.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG12.html' TARGET='index'>1</A><a name='1091'>
<a name='1092'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_15"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1093'>
<a name='1094'>
<font color=#447700>!     implicit none<a name='1095'></font>
      save<a name='1096'>
<a name='1097'>
<font color=#447700>!-----------------------------------------------------------------<a name='1098'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 12<a name='1099'></font>
<font color=#447700>! band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='1100'></font>
<font color=#447700>!<a name='1101'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1102'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1103'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1104'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1105'></font>
<font color=#447700>!<a name='1106'></font>
<font color=#447700>!  name     type     purpose<a name='1107'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1108'></font>
<font color=#447700>!fracrefao: real    <a name='1109'></font>
<font color=#447700>! kao     : real     <a name='1110'></font>
<font color=#447700>! selfrefo: real     <a name='1111'></font>
<font color=#447700>! forrefo : real     <a name='1112'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1113'></font>
<a name='1114'>
      integer(kind=im), parameter :: no12 = 16<a name='1115'>
<a name='1116'>
      real(kind=rb) :: fracrefao(no12,9)<a name='1117'>
      real(kind=rb) :: kao(9,5,13,no12)<a name='1118'>
      real(kind=rb) :: selfrefo(10,no12)<a name='1119'>
      real(kind=rb) :: forrefo(4,no12)<a name='1120'>
<a name='1121'>
<font color=#447700>!-----------------------------------------------------------------<a name='1122'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 12<a name='1123'></font>
<font color=#447700>! band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='1124'></font>
<font color=#447700>!<a name='1125'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1126'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1127'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1128'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1129'></font>
<font color=#447700>!<a name='1130'></font>
<font color=#447700>!  name     type     purpose<a name='1131'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1132'></font>
<font color=#447700>!fracrefa : real    <a name='1133'></font>
<font color=#447700>! ka      : real     <a name='1134'></font>
<font color=#447700>! selfref : real     <a name='1135'></font>
<font color=#447700>! forref  : real     <a name='1136'></font>
<font color=#447700>!<a name='1137'></font>
<font color=#447700>! absa    : real<a name='1138'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1139'></font>
<a name='1140'>
      integer(kind=im), parameter :: ng12 = 8<a name='1141'>
<a name='1142'>
      real(kind=rb) :: fracrefa(ng12,9)<a name='1143'>
      real(kind=rb) :: ka(9,5,13,ng12) ,absa(585,ng12)<a name='1144'>
      real(kind=rb) :: selfref(10,ng12)<a name='1145'>
      real(kind=rb) :: forref(4,ng12)<a name='1146'>
<a name='1147'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='1148'>
<a name='1149'>
      end module rrlw_kg12<a name='1150'>
<a name='1151'>
<A NAME='RRLW_KG13'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG13' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1152'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg13</font> <A href='../../call_to/RRLW_KG13.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG13.html' TARGET='index'>1</A><a name='1153'>
<a name='1154'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_16"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1155'>
<a name='1156'>
<font color=#447700>!     implicit none<a name='1157'></font>
      save<a name='1158'>
<a name='1159'>
<font color=#447700>!-----------------------------------------------------------------<a name='1160'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 13<a name='1161'></font>
<font color=#447700>! band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='1162'></font>
<font color=#447700>!<a name='1163'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1164'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1165'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1166'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1167'></font>
<font color=#447700>!<a name='1168'></font>
<font color=#447700>!  name     type     purpose<a name='1169'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1170'></font>
<font color=#447700>!fracrefao: real    <a name='1171'></font>
<font color=#447700>! kao     : real     <a name='1172'></font>
<font color=#447700>! kao_mco2: real     <a name='1173'></font>
<font color=#447700>! kao_mco : real     <a name='1174'></font>
<font color=#447700>! kbo_mo3 : real     <a name='1175'></font>
<font color=#447700>! selfrefo: real     <a name='1176'></font>
<font color=#447700>! forrefo : real     <a name='1177'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1178'></font>
<a name='1179'>
      integer(kind=im), parameter :: no13 = 16<a name='1180'>
<a name='1181'>
      real(kind=rb) , dimension(no13) :: fracrefbo<a name='1182'>
<a name='1183'>
      real(kind=rb) :: fracrefao(no13,9)<a name='1184'>
      real(kind=rb) :: kao(9,5,13,no13)<a name='1185'>
      real(kind=rb) :: kao_mco2(9,19,no13)<a name='1186'>
      real(kind=rb) :: kao_mco(9,19,no13)<a name='1187'>
      real(kind=rb) :: kbo_mo3(19,no13)<a name='1188'>
      real(kind=rb) :: selfrefo(10,no13)<a name='1189'>
      real(kind=rb) :: forrefo(4,no13)<a name='1190'>
<a name='1191'>
<font color=#447700>!-----------------------------------------------------------------<a name='1192'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 13<a name='1193'></font>
<font color=#447700>! band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='1194'></font>
<font color=#447700>!<a name='1195'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1196'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1197'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1198'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1199'></font>
<font color=#447700>!<a name='1200'></font>
<font color=#447700>!  name     type     purpose<a name='1201'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1202'></font>
<font color=#447700>!fracrefa : real    <a name='1203'></font>
<font color=#447700>! ka      : real     <a name='1204'></font>
<font color=#447700>! ka_mco2 : real     <a name='1205'></font>
<font color=#447700>! ka_mco  : real     <a name='1206'></font>
<font color=#447700>! kb_mo3  : real     <a name='1207'></font>
<font color=#447700>! selfref : real     <a name='1208'></font>
<font color=#447700>! forref  : real     <a name='1209'></font>
<font color=#447700>!<a name='1210'></font>
<font color=#447700>! absa    : real<a name='1211'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1212'></font>
<a name='1213'>
      integer(kind=im), parameter :: ng13 = 4<a name='1214'>
<a name='1215'>
      real(kind=rb) , dimension(ng13) :: fracrefb<a name='1216'>
<a name='1217'>
      real(kind=rb) :: fracrefa(ng13,9)<a name='1218'>
      real(kind=rb) :: ka(9,5,13,ng13) ,absa(585,ng13)<a name='1219'>
      real(kind=rb) :: ka_mco2(9,19,ng13)<a name='1220'>
      real(kind=rb) :: ka_mco(9,19,ng13)<a name='1221'>
      real(kind=rb) :: kb_mo3(19,ng13)<a name='1222'>
      real(kind=rb) :: selfref(10,ng13)<a name='1223'>
      real(kind=rb) :: forref(4,ng13)<a name='1224'>
<a name='1225'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='1226'>
<a name='1227'>
      end module rrlw_kg13<a name='1228'>
<a name='1229'>
<A NAME='RRLW_KG14'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG14' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1230'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg14</font> <A href='../../call_to/RRLW_KG14.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG14.html' TARGET='index'>1</A><a name='1231'>
<a name='1232'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_17"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1233'>
<a name='1234'>
<font color=#447700>!     implicit none<a name='1235'></font>
      save<a name='1236'>
<a name='1237'>
<font color=#447700>!-----------------------------------------------------------------<a name='1238'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 14<a name='1239'></font>
<font color=#447700>! band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='1240'></font>
<font color=#447700>!<a name='1241'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1242'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1243'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1244'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1245'></font>
<font color=#447700>!<a name='1246'></font>
<font color=#447700>!  name     type     purpose<a name='1247'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1248'></font>
<font color=#447700>!fracrefao: real    <a name='1249'></font>
<font color=#447700>!fracrefbo: real    <a name='1250'></font>
<font color=#447700>! kao     : real     <a name='1251'></font>
<font color=#447700>! kbo     : real     <a name='1252'></font>
<font color=#447700>! selfrefo: real     <a name='1253'></font>
<font color=#447700>! forrefo : real     <a name='1254'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1255'></font>
<a name='1256'>
      integer(kind=im), parameter :: no14 = 16<a name='1257'>
<a name='1258'>
      real(kind=rb) , dimension(no14) :: fracrefao<a name='1259'>
      real(kind=rb) , dimension(no14) :: fracrefbo<a name='1260'>
<a name='1261'>
      real(kind=rb) :: kao(5,13,no14)<a name='1262'>
      real(kind=rb) :: kbo(5,13:59,no14)<a name='1263'>
      real(kind=rb) :: selfrefo(10,no14)<a name='1264'>
      real(kind=rb) :: forrefo(4,no14)<a name='1265'>
<a name='1266'>
<font color=#447700>!-----------------------------------------------------------------<a name='1267'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 14<a name='1268'></font>
<font color=#447700>! band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='1269'></font>
<font color=#447700>!<a name='1270'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1271'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1272'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1273'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1274'></font>
<font color=#447700>!<a name='1275'></font>
<font color=#447700>!  name     type     purpose<a name='1276'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1277'></font>
<font color=#447700>!fracrefa : real    <a name='1278'></font>
<font color=#447700>!fracrefb : real    <a name='1279'></font>
<font color=#447700>! ka      : real     <a name='1280'></font>
<font color=#447700>! kb      : real     <a name='1281'></font>
<font color=#447700>! selfref : real     <a name='1282'></font>
<font color=#447700>! forref  : real     <a name='1283'></font>
<font color=#447700>!<a name='1284'></font>
<font color=#447700>! absa    : real<a name='1285'></font>
<font color=#447700>! absb    : real<a name='1286'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1287'></font>
<a name='1288'>
      integer(kind=im), parameter :: ng14 = 2<a name='1289'>
<a name='1290'>
      real(kind=rb) , dimension(ng14) :: fracrefa<a name='1291'>
      real(kind=rb) , dimension(ng14) :: fracrefb<a name='1292'>
<a name='1293'>
      real(kind=rb) :: ka(5,13,ng14)   ,absa(65,ng14)<a name='1294'>
      real(kind=rb) :: kb(5,13:59,ng14),absb(235,ng14)<a name='1295'>
      real(kind=rb) :: selfref(10,ng14)<a name='1296'>
      real(kind=rb) :: forref(4,ng14)<a name='1297'>
<a name='1298'>
      equivalence (ka(1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='1299'>
<a name='1300'>
      end module rrlw_kg14<a name='1301'>
<a name='1302'>
<A NAME='RRLW_KG15'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG15' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1303'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg15</font> <A href='../../call_to/RRLW_KG15.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG15.html' TARGET='index'>1</A><a name='1304'>
<a name='1305'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_18"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1306'>
<a name='1307'>
<font color=#447700>!     implicit none<a name='1308'></font>
      save<a name='1309'>
<a name='1310'>
<font color=#447700>!-----------------------------------------------------------------<a name='1311'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 15<a name='1312'></font>
<font color=#447700>! band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='1313'></font>
<font color=#447700>!<a name='1314'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1315'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1316'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1317'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1318'></font>
<font color=#447700>!<a name='1319'></font>
<font color=#447700>!  name     type     purpose<a name='1320'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1321'></font>
<font color=#447700>!fracrefao: real    <a name='1322'></font>
<font color=#447700>! kao     : real     <a name='1323'></font>
<font color=#447700>! kao_mn2 : real     <a name='1324'></font>
<font color=#447700>! selfrefo: real     <a name='1325'></font>
<font color=#447700>! forrefo : real     <a name='1326'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1327'></font>
<a name='1328'>
      integer(kind=im), parameter :: no15 = 16<a name='1329'>
<a name='1330'>
      real(kind=rb) :: fracrefao(no15,9)<a name='1331'>
      real(kind=rb) :: kao(9,5,13,no15)<a name='1332'>
      real(kind=rb) :: kao_mn2(9,19,no15)<a name='1333'>
      real(kind=rb) :: selfrefo(10,no15)<a name='1334'>
      real(kind=rb) :: forrefo(4,no15)<a name='1335'>
<a name='1336'>
<a name='1337'>
<font color=#447700>!-----------------------------------------------------------------<a name='1338'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 15<a name='1339'></font>
<font color=#447700>! band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='1340'></font>
<font color=#447700>!<a name='1341'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1342'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1343'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1344'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1345'></font>
<font color=#447700>!<a name='1346'></font>
<font color=#447700>!  name     type     purpose<a name='1347'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1348'></font>
<font color=#447700>!fracrefa : real    <a name='1349'></font>
<font color=#447700>! ka      : real     <a name='1350'></font>
<font color=#447700>! ka_mn2  : real     <a name='1351'></font>
<font color=#447700>! selfref : real     <a name='1352'></font>
<font color=#447700>! forref  : real     <a name='1353'></font>
<font color=#447700>!<a name='1354'></font>
<font color=#447700>! absa    : real<a name='1355'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1356'></font>
<a name='1357'>
      integer(kind=im), parameter :: ng15 = 2<a name='1358'>
<a name='1359'>
      real(kind=rb) :: fracrefa(ng15,9)<a name='1360'>
      real(kind=rb) :: ka(9,5,13,ng15) ,absa(585,ng15)<a name='1361'>
      real(kind=rb) :: ka_mn2(9,19,ng15)<a name='1362'>
      real(kind=rb) :: selfref(10,ng15)<a name='1363'>
      real(kind=rb) :: forref(4,ng15)<a name='1364'>
<a name='1365'>
      equivalence (ka(1,1,1,1),absa(1,1))<a name='1366'>
<a name='1367'>
      end module rrlw_kg15<a name='1368'>
<a name='1369'>
<A NAME='RRLW_KG16'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG16' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1370'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_kg16</font> <A href='../../call_to/RRLW_KG16.html' TARGET='index'>3</A>,<A href='../../call_from/RRLW_KG16.html' TARGET='index'>1</A><a name='1371'>
<a name='1372'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_19"> ,only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1373'>
<a name='1374'>
<font color=#447700>!     implicit none<a name='1375'></font>
      save<a name='1376'>
<a name='1377'>
<font color=#447700>!-----------------------------------------------------------------<a name='1378'></font>
<font color=#447700>! rrtmg_lw ORIGINAL abs. coefficients for interval 16<a name='1379'></font>
<font color=#447700>! band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='1380'></font>
<font color=#447700>!<a name='1381'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1382'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1383'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1384'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1385'></font>
<font color=#447700>!<a name='1386'></font>
<font color=#447700>!  name     type     purpose<a name='1387'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1388'></font>
<font color=#447700>!fracrefao: real    <a name='1389'></font>
<font color=#447700>! kao     : real     <a name='1390'></font>
<font color=#447700>! kbo     : real     <a name='1391'></font>
<font color=#447700>! selfrefo: real     <a name='1392'></font>
<font color=#447700>! forrefo : real     <a name='1393'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1394'></font>
<a name='1395'>
      integer(kind=im), parameter :: no16 = 16<a name='1396'>
<a name='1397'>
      real(kind=rb) , dimension(no16) :: fracrefbo<a name='1398'>
<a name='1399'>
      real(kind=rb) :: fracrefao(no16,9)<a name='1400'>
      real(kind=rb) :: kao(9,5,13,no16)<a name='1401'>
      real(kind=rb) :: kbo(5,13:59,no16)<a name='1402'>
      real(kind=rb) :: selfrefo(10,no16)<a name='1403'>
      real(kind=rb) :: forrefo(4,no16)<a name='1404'>
<a name='1405'>
<font color=#447700>!-----------------------------------------------------------------<a name='1406'></font>
<font color=#447700>! rrtmg_lw COMBINED abs. coefficients for interval 16<a name='1407'></font>
<font color=#447700>! band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='1408'></font>
<font color=#447700>!<a name='1409'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1410'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1411'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1412'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1413'></font>
<font color=#447700>!<a name='1414'></font>
<font color=#447700>!  name     type     purpose<a name='1415'></font>
<font color=#447700>!  ----   : ----   : ---------------------------------------------<a name='1416'></font>
<font color=#447700>!fracrefa : real    <a name='1417'></font>
<font color=#447700>! ka      : real     <a name='1418'></font>
<font color=#447700>! kb      : real     <a name='1419'></font>
<font color=#447700>! selfref : real     <a name='1420'></font>
<font color=#447700>! forref  : real     <a name='1421'></font>
<font color=#447700>!<a name='1422'></font>
<font color=#447700>! absa    : real<a name='1423'></font>
<font color=#447700>! absb    : real<a name='1424'></font>
<font color=#447700>!-----------------------------------------------------------------<a name='1425'></font>
<a name='1426'>
      integer(kind=im), parameter :: ng16 = 2<a name='1427'>
<a name='1428'>
      real(kind=rb) , dimension(ng16) :: fracrefb<a name='1429'>
<a name='1430'>
      real(kind=rb) :: fracrefa(ng16,9)<a name='1431'>
      real(kind=rb) :: ka(9,5,13,ng16) ,absa(585,ng16)<a name='1432'>
      real(kind=rb) :: kb(5,13:59,ng16), absb(235,ng16)<a name='1433'>
      real(kind=rb) :: selfref(10,ng16)<a name='1434'>
      real(kind=rb) :: forref(4,ng16)<a name='1435'>
<a name='1436'>
      equivalence (ka(1,1,1,1),absa(1,1)), (kb(1,13,1),absb(1,1))<a name='1437'>
<a name='1438'>
      end module rrlw_kg16<a name='1439'>
<a name='1440'>
<a name='1441'>
<A NAME='RRLW_REF'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1442'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_ref</font> <A href='../../call_to/RRLW_REF.html' TARGET='index'>12</A>,<A href='../../call_from/RRLW_REF.html' TARGET='index'>1</A><a name='1443'>
<a name='1444'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_20">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1445'>
<a name='1446'>
<font color=#447700>!     implicit none<a name='1447'></font>
      save<a name='1448'>
<a name='1449'>
<font color=#447700>!------------------------------------------------------------------<a name='1450'></font>
<font color=#447700>! rrtmg_lw reference atmosphere <a name='1451'></font>
<font color=#447700>! Based on standard mid-latitude summer profile<a name='1452'></font>
<font color=#447700>!<a name='1453'></font>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1454'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1455'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1456'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1457'></font>
<a name='1458'>
<font color=#447700>!  name     type     purpose<a name='1459'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='1460'></font>
<font color=#447700>! pref   :  real   : Reference pressure levels<a name='1461'></font>
<font color=#447700>! preflog:  real   : Reference pressure levels, ln(pref)<a name='1462'></font>
<font color=#447700>! tref   :  real   : Reference temperature levels for MLS profile<a name='1463'></font>
<font color=#447700>! chi_mls:  real   : <a name='1464'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1465'></font>
<a name='1466'>
      real(kind=rb) , dimension(59) :: pref<a name='1467'>
      real(kind=rb) , dimension(59) :: preflog<a name='1468'>
      real(kind=rb) , dimension(59) :: tref<a name='1469'>
      real(kind=rb) :: chi_mls(7,59)<a name='1470'>
<a name='1471'>
      end module rrlw_ref<a name='1472'>
<a name='1473'>
<A NAME='RRLW_TBL'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_TBL' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1474'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_tbl</font> <A href='../../call_to/RRLW_TBL.html' TARGET='index'>2</A>,<A href='../../call_from/RRLW_TBL.html' TARGET='index'>1</A><a name='1475'>
<a name='1476'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_TBL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_21">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1477'>
<a name='1478'>
<font color=#447700>!     implicit none<a name='1479'></font>
      save<a name='1480'>
<a name='1481'>
<font color=#447700>!------------------------------------------------------------------<a name='1482'></font>
<font color=#447700>! rrtmg_lw exponential lookup table arrays<a name='1483'></font>
<a name='1484'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1485'></font>
<font color=#447700>! Revised: MJIacono, AER, Jun 2006<a name='1486'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2007<a name='1487'></font>
<font color=#447700>! Revised: MJIacono, AER, Aug 2008<a name='1488'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1489'></font>
<a name='1490'>
<font color=#447700>!  name     type     purpose<a name='1491'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='1492'></font>
<font color=#447700>! ntbl   :  integer: Lookup table dimension<a name='1493'></font>
<font color=#447700>! tblint :  real   : Lookup table conversion factor<a name='1494'></font>
<font color=#447700>! tau_tbl:  real   : Clear-sky optical depth (used in cloudy radiative<a name='1495'></font>
<font color=#447700>!                    transfer)<a name='1496'></font>
<font color=#447700>! exp_tbl:  real   : Transmittance lookup table<a name='1497'></font>
<font color=#447700>! tfn_tbl:  real   : Tau transition function; i.e. the transition of<a name='1498'></font>
<font color=#447700>!                    the Planck function from that for the mean layer<a name='1499'></font>
<font color=#447700>!                    temperature to that for the layer boundary<a name='1500'></font>
<font color=#447700>!                    temperature as a function of optical depth.<a name='1501'></font>
<font color=#447700>!                    The "linear in tau" method is used to make <a name='1502'></font>
<font color=#447700>!                    the table.<a name='1503'></font>
<font color=#447700>! pade   :  real   : Pade constant   <a name='1504'></font>
<font color=#447700>! bpade  :  real   : Inverse of Pade constant   <a name='1505'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1506'></font>
<a name='1507'>
      integer(kind=im), parameter :: ntbl = 10000<a name='1508'>
<a name='1509'>
      real(kind=rb), parameter :: tblint = 10000.0_rb<a name='1510'>
<a name='1511'>
      real(kind=rb) , dimension(0:ntbl) :: tau_tbl<a name='1512'>
      real(kind=rb) , dimension(0:ntbl) :: exp_tbl<a name='1513'>
      real(kind=rb) , dimension(0:ntbl) :: tfn_tbl<a name='1514'>
<a name='1515'>
      real(kind=rb), parameter :: pade = 0.278_rb<a name='1516'>
      real(kind=rb) :: bpade<a name='1517'>
<a name='1518'>
      end module rrlw_tbl<a name='1519'>
<a name='1520'>
<A NAME='RRLW_VSN'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1521'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_vsn</font> <A href='../../call_to/RRLW_VSN.html' TARGET='index'>8</A><a name='1522'>
<a name='1523'>
<font color=#447700>!     implicit none<a name='1524'></font>
      save<a name='1525'>
<a name='1526'>
<font color=#447700>!------------------------------------------------------------------<a name='1527'></font>
<font color=#447700>! rrtmg_lw version information<a name='1528'></font>
<a name='1529'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1530'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1531'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1532'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1533'></font>
<a name='1534'>
<font color=#447700>!  name     type     purpose<a name='1535'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='1536'></font>
<font color=#447700>!hnamrtm :character: <a name='1537'></font>
<font color=#447700>!hnamini :character: <a name='1538'></font>
<font color=#447700>!hnamcld :character: <a name='1539'></font>
<font color=#447700>!hnamclc :character: <a name='1540'></font>
<font color=#447700>!hnamrtr :character: <a name='1541'></font>
<font color=#447700>!hnamrtx :character: <a name='1542'></font>
<font color=#447700>!hnamrtc :character: <a name='1543'></font>
<font color=#447700>!hnamset :character: <a name='1544'></font>
<font color=#447700>!hnamtau :character: <a name='1545'></font>
<font color=#447700>!hnamatm :character: <a name='1546'></font>
<font color=#447700>!hnamutl :character: <a name='1547'></font>
<font color=#447700>!hnamext :character: <a name='1548'></font>
<font color=#447700>!hnamkg  :character: <a name='1549'></font>
<font color=#447700>!<a name='1550'></font>
<font color=#447700>! hvrrtm :character: <a name='1551'></font>
<font color=#447700>! hvrini :character: <a name='1552'></font>
<font color=#447700>! hvrcld :character: <a name='1553'></font>
<font color=#447700>! hvrclc :character: <a name='1554'></font>
<font color=#447700>! hvrrtr :character: <a name='1555'></font>
<font color=#447700>! hvrrtx :character: <a name='1556'></font>
<font color=#447700>! hvrrtc :character: <a name='1557'></font>
<font color=#447700>! hvrset :character: <a name='1558'></font>
<font color=#447700>! hvrtau :character: <a name='1559'></font>
<font color=#447700>! hvratm :character: <a name='1560'></font>
<font color=#447700>! hvrutl :character: <a name='1561'></font>
<font color=#447700>! hvrext :character: <a name='1562'></font>
<font color=#447700>! hvrkg  :character: <a name='1563'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1564'></font>
<a name='1565'>
      character*18 hvrrtm,hvrini,hvrcld,hvrclc,hvrrtr,hvrrtx, &amp;<a name='1566'>
                   hvrrtc,hvrset,hvrtau,hvratm,hvrutl,hvrext<a name='1567'>
      character*20 hnamrtm,hnamini,hnamcld,hnamclc,hnamrtr,hnamrtx, &amp;<a name='1568'>
                   hnamrtc,hnamset,hnamtau,hnamatm,hnamutl,hnamext<a name='1569'>
<a name='1570'>
      character*18 hvrkg<a name='1571'>
      character*20 hnamkg<a name='1572'>
<a name='1573'>
      end module rrlw_vsn<a name='1574'>
<a name='1575'>
<A NAME='RRLW_WVN'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1576'>
      <font color=#993300>module </font><font color=#cc0000>rrlw_wvn</font> <A href='../../call_to/RRLW_WVN.html' TARGET='index'>8</A>,<A href='../../call_from/RRLW_WVN.html' TARGET='index'>2</A><a name='1577'>
<a name='1578'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_22">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='1579'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_1">, only : nbndlw, mg, ngptlw, maxinpx<a name='1580'>
<a name='1581'>
<font color=#447700>!     implicit none<a name='1582'></font>
      save<a name='1583'>
<a name='1584'>
<font color=#447700>!------------------------------------------------------------------<a name='1585'></font>
<font color=#447700>! rrtmg_lw spectral information<a name='1586'></font>
<a name='1587'>
<font color=#447700>! Initial version:  JJMorcrette, ECMWF, jul1998<a name='1588'></font>
<font color=#447700>! Revised: MJIacono, AER, jun2006<a name='1589'></font>
<font color=#447700>! Revised: MJIacono, AER, aug2008<a name='1590'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1591'></font>
<a name='1592'>
<font color=#447700>!  name     type     purpose<a name='1593'></font>
<font color=#447700>! -----  :  ----   : ----------------------------------------------<a name='1594'></font>
<font color=#447700>! ng     :  integer: Number of original g-intervals in each spectral band<a name='1595'></font>
<font color=#447700>! nspa   :  integer: For the lower atmosphere, the number of reference<a name='1596'></font>
<font color=#447700>!                    atmospheres that are stored for each spectral band<a name='1597'></font>
<font color=#447700>!                    per pressure level and temperature.  Each of these<a name='1598'></font>
<font color=#447700>!                    atmospheres has different relative amounts of the <a name='1599'></font>
<font color=#447700>!                    key species for the band (i.e. different binary<a name='1600'></font>
<font color=#447700>!                    species parameters).<a name='1601'></font>
<font color=#447700>! nspb   :  integer: Same as nspa for the upper atmosphere<a name='1602'></font>
<font color=#447700>!wavenum1:  real   : Spectral band lower boundary in wavenumbers<a name='1603'></font>
<font color=#447700>!wavenum2:  real   : Spectral band upper boundary in wavenumbers<a name='1604'></font>
<font color=#447700>! delwave:  real   : Spectral band width in wavenumbers<a name='1605'></font>
<font color=#447700>! totplnk:  real   : Integrated Planck value for each band; (band 16<a name='1606'></font>
<font color=#447700>!                    includes total from 2600 cm-1 to infinity)<a name='1607'></font>
<font color=#447700>!                    Used for calculation across total spectrum<a name='1608'></font>
<font color=#447700>!totplk16:  real   : Integrated Planck value for band 16 (2600-3250 cm-1)<a name='1609'></font>
<font color=#447700>!                    Used for calculation in band 16 only if <a name='1610'></font>
<font color=#447700>!                    individual band output requested<a name='1611'></font>
<font color=#447700>!<a name='1612'></font>
<font color=#447700>! ngc    :  integer: The number of new g-intervals in each band<a name='1613'></font>
<font color=#447700>! ngs    :  integer: The cumulative sum of new g-intervals for each band<a name='1614'></font>
<font color=#447700>! ngm    :  integer: The index of each new g-interval relative to the<a name='1615'></font>
<font color=#447700>!                    original 16 g-intervals in each band<a name='1616'></font>
<font color=#447700>! ngn    :  integer: The number of original g-intervals that are <a name='1617'></font>
<font color=#447700>!                    combined to make each new g-intervals in each band<a name='1618'></font>
<font color=#447700>! ngb    :  integer: The band index for each new g-interval<a name='1619'></font>
<font color=#447700>! wt     :  real   : RRTM weights for the original 16 g-intervals<a name='1620'></font>
<font color=#447700>! rwgt   :  real   : Weights for combining original 16 g-intervals <a name='1621'></font>
<font color=#447700>!                    (256 total) into reduced set of g-intervals <a name='1622'></font>
<font color=#447700>!                    (140 total)<a name='1623'></font>
<font color=#447700>! nxmol  :  integer: Number of cross-section molecules<a name='1624'></font>
<font color=#447700>! ixindx :  integer: Flag for active cross-sections in calculation<a name='1625'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1626'></font>
<a name='1627'>
      integer(kind=im) :: ng(nbndlw)<a name='1628'>
      integer(kind=im) :: nspa(nbndlw)<a name='1629'>
      integer(kind=im) :: nspb(nbndlw)<a name='1630'>
<a name='1631'>
      real(kind=rb) :: wavenum1(nbndlw)<a name='1632'>
      real(kind=rb) :: wavenum2(nbndlw)<a name='1633'>
      real(kind=rb) :: delwave(nbndlw)<a name='1634'>
<a name='1635'>
      real(kind=rb) :: totplnk(181,nbndlw)<a name='1636'>
      real(kind=rb) :: totplk16(181)<a name='1637'>
<a name='1638'>
      integer(kind=im) :: ngc(nbndlw)<a name='1639'>
      integer(kind=im) :: ngs(nbndlw)<a name='1640'>
      integer(kind=im) :: ngn(ngptlw)<a name='1641'>
      integer(kind=im) :: ngb(ngptlw)<a name='1642'>
      integer(kind=im) :: ngm(nbndlw*mg)<a name='1643'>
<a name='1644'>
      real(kind=rb) :: wt(mg)<a name='1645'>
      real(kind=rb) :: rwgt(nbndlw*mg)<a name='1646'>
<a name='1647'>
      integer(kind=im) :: nxmol<a name='1648'>
      integer(kind=im) :: ixindx(maxinpx)<a name='1649'>
<a name='1650'>
      end module rrlw_wvn<a name='1651'>
<a name='1652'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='1653'></font>
<font color=#447700>!     author:    $Author: trn $<a name='1654'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='1655'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='1656'></font>
<font color=#447700>!<a name='1657'></font>
<a name='1658'>
<font color=#447700>! Fortran-95 implementation of the Mersenne Twister 19937, following <a name='1659'></font>
<font color=#447700>!   the C implementation described below (code mt19937ar-cok.c, dated 2002/2/10), <a name='1660'></font>
<font color=#447700>!   adapted cosmetically by making the names more general.  <a name='1661'></font>
<font color=#447700>! Users must declare one or more variables of type randomNumberSequence in the calling <a name='1662'></font>
<font color=#447700>!   procedure which are then initialized using a required seed. If the <a name='1663'></font>
<font color=#447700>!   variable is not initialized the random numbers will all be 0. <a name='1664'></font>
<font color=#447700>! For example: <a name='1665'></font>
<font color=#447700>! program testRandoms <a name='1666'></font>
<font color=#447700>!   use RandomNumbers<a name='1667'></font>
<font color=#447700>!   type(randomNumberSequence) :: randomNumbers<a name='1668'></font>
<font color=#447700>!   integer                    :: i<a name='1669'></font>
<font color=#447700>!   <a name='1670'></font>
<font color=#447700>!   randomNumbers = new_RandomNumberSequence(seed = 100)<a name='1671'></font>
<font color=#447700>!   do i = 1, 10<a name='1672'></font>
<font color=#447700>!     print ('(f12.10, 2x)'), getRandomReal(randomNumbers)<a name='1673'></font>
<font color=#447700>!   end do<a name='1674'></font>
<font color=#447700>! end program testRandoms<a name='1675'></font>
<font color=#447700>! <a name='1676'></font>
<font color=#447700>! Fortran-95 implementation by <a name='1677'></font>
<font color=#447700>!   Robert Pincus<a name='1678'></font>
<font color=#447700>!   NOAA-CIRES Climate Diagnostics Center<a name='1679'></font>
<font color=#447700>!   Boulder, CO 80305 <a name='1680'></font>
<font color=#447700>!   email: Robert.Pincus@colorado.edu<a name='1681'></font>
<font color=#447700>!<a name='1682'></font>
<font color=#447700>! This documentation in the original C program reads:<a name='1683'></font>
<font color=#447700>! -------------------------------------------------------------<a name='1684'></font>
<font color=#447700>!    A C-program for MT19937, with initialization improved 2002/2/10.<a name='1685'></font>
<font color=#447700>!    Coded by Takuji Nishimura and Makoto Matsumoto.<a name='1686'></font>
<font color=#447700>!    This is a faster version by taking Shawn Cokus's optimization,<a name='1687'></font>
<font color=#447700>!    Matthe Bellew's simplification, Isaku Wada's real version.<a name='1688'></font>
<font color=#447700>! <a name='1689'></font>
<font color=#447700>!    Before using, initialize the state by using init_genrand(seed) <a name='1690'></font>
<font color=#447700>!    or init_by_array(init_key, key_length).<a name='1691'></font>
<font color=#447700>! <a name='1692'></font>
<font color=#447700>!    Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,<a name='1693'></font>
<font color=#447700>!    All rights reserved.                          <a name='1694'></font>
<font color=#447700>! <a name='1695'></font>
<font color=#447700>!    Redistribution and use in source and binary forms, with or without<a name='1696'></font>
<font color=#447700>!    modification, are permitted provided that the following conditions<a name='1697'></font>
<font color=#447700>!    are met:<a name='1698'></font>
<font color=#447700>! <a name='1699'></font>
<font color=#447700>!      1. Redistributions of source code must retain the above copyright<a name='1700'></font>
<font color=#447700>!         notice, this list of conditions and the following disclaimer.<a name='1701'></font>
<font color=#447700>! <a name='1702'></font>
<font color=#447700>!      2. Redistributions in binary form must reproduce the above copyright<a name='1703'></font>
<font color=#447700>!         notice, this list of conditions and the following disclaimer in the<a name='1704'></font>
<font color=#447700>!         documentation and/or other materials provided with the distribution.<a name='1705'></font>
<font color=#447700>! <a name='1706'></font>
<font color=#447700>!      3. The names of its contributors may not be used to endorse or promote <a name='1707'></font>
<font color=#447700>!         products derived from this software without specific prior written <a name='1708'></font>
<font color=#447700>!         permission.<a name='1709'></font>
<font color=#447700>! <a name='1710'></font>
<font color=#447700>!    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS<a name='1711'></font>
<font color=#447700>!    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT<a name='1712'></font>
<font color=#447700>!    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR<a name='1713'></font>
<font color=#447700>!    A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR<a name='1714'></font>
<font color=#447700>!    CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,<a name='1715'></font>
<font color=#447700>!    EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,<a name='1716'></font>
<font color=#447700>!    PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR<a name='1717'></font>
<font color=#447700>!    PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF<a name='1718'></font>
<font color=#447700>!    LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING<a name='1719'></font>
<font color=#447700>!    NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS<a name='1720'></font>
<font color=#447700>!    SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.<a name='1721'></font>
<font color=#447700>! <a name='1722'></font>
<font color=#447700>! <a name='1723'></font>
<font color=#447700>!    Any feedback is very welcome.<a name='1724'></font>
<font color=#447700>!    http://www.math.keio.ac.jp/matumoto/emt.html<a name='1725'></font>
<font color=#447700>!    email: matumoto@math.keio.ac.jp<a name='1726'></font>
<font color=#447700>! -------------------------------------------------------------<a name='1727'></font>
<a name='1728'>
<A NAME='MERSENNETWISTER'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1729'>
  <font color=#993300>module </font><font color=#cc0000>MersenneTwister</font> <A href='../../call_to/MERSENNETWISTER.html' TARGET='index'>3</A>,<A href='../../call_from/MERSENNETWISTER.html' TARGET='index'>3</A><a name='1730'>
<font color=#447700>! -------------------------------------------------------------<a name='1731'></font>
<a name='1732'>
  use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_23">, only : im =&gt; kind_im, rb =&gt; kind_rb <a name='1733'>
<a name='1734'>
  implicit none<a name='1735'>
  private<a name='1736'>
  <a name='1737'>
  <font color=#447700>! Algorithm parameters<a name='1738'></font>
  <font color=#447700>! -------<a name='1739'></font>
  <font color=#447700>! Period parameters<a name='1740'></font>
  integer(kind=im), parameter :: blockSize = 624,         &amp;<a name='1741'>
                        M         = 397,         &amp;<a name='1742'>
                        MATRIX_A  = -1727483681, &amp; <font color=#447700>! constant vector a         (0x9908b0dfUL)<a name='1743'></font>
                        UMASK     = -2147483647-1, &amp; <font color=#447700>! most significant w-r bits (0x80000000UL)<a name='1744'></font>
                        LMASK     =  2147483647    <font color=#447700>! least significant r bits  (0x7fffffffUL)<a name='1745'></font>
  <font color=#447700>! Tempering parameters<a name='1746'></font>
  integer(kind=im), parameter :: TMASKB= -1658038656, &amp; <font color=#447700>! (0x9d2c5680UL)<a name='1747'></font>
                        TMASKC= -272236544     <font color=#447700>! (0xefc60000UL)<a name='1748'></font>
  <font color=#447700>! -------<a name='1749'></font>
<a name='1750'>
  <font color=#447700>! The type containing the state variable  <a name='1751'></font>
  type randomNumberSequence<a name='1752'>
    integer(kind=im)                            :: currentElement <font color=#447700>! = blockSize<a name='1753'></font>
    integer(kind=im), dimension(0:blockSize -1) :: state <font color=#447700>! = 0<a name='1754'></font>
  end type randomNumberSequence<a name='1755'>
<a name='1756'>
<A NAME='NEW_RANDOMNUMBERSEQUENCE'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#NEW_RANDOMNUMBERSEQUENCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1757'>
  <font color=#993300>interface </font><font color=#cc0000>new_RandomNumberSequence</font><a name='1758'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_SCALAR'>initialize_scalar</A><A NAME="INITIALIZE_SCALAR_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_VECTOR'>initialize_vector</A><A NAME="INITIALIZE_VECTOR_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1759'>
  end interface new_RandomNumberSequence <a name='1760'>
<a name='1761'>
  public :: randomNumberSequence<a name='1762'>
  public :: new_RandomNumberSequence, finalize_RandomNumberSequence, &amp;<a name='1763'>
            getRandomInt, getRandomPositiveInt, getRandomReal<a name='1764'>
<font color=#447700>! -------------------------------------------------------------<a name='1765'></font>
contains<a name='1766'>
  <font color=#447700>! -------------------------------------------------------------<a name='1767'></font>
  <font color=#447700>! Private functions<a name='1768'></font>
  <font color=#447700>! ---------------------------<a name='1769'></font>
<A NAME='MIXBITS'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MIXBITS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1770'>
  <font color=#993300>function </font><font color=#cc0000>mixbits</font>(u, v)<a name='1771'>
    integer(kind=im), intent( in) :: u, v<a name='1772'>
    integer(kind=im)              :: mixbits<a name='1773'>
    <a name='1774'>
    mixbits = ior(iand(u, UMASK), iand(v, LMASK))<a name='1775'>
  end function mixbits<a name='1776'>
  <font color=#447700>! ---------------------------<a name='1777'></font>
<A NAME='TWIST'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TWIST' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1778'>
  <font color=#993300>function </font><font color=#cc0000>twist</font>(u, v)<a name='1779'>
    integer(kind=im), intent( in) :: u, v<a name='1780'>
    integer(kind=im)              :: twist<a name='1781'>
<a name='1782'>
    <font color=#447700>! Local variable<a name='1783'></font>
    integer(kind=im), parameter, dimension(0:1) :: t_matrix = (/ 0_im, MATRIX_A /)<a name='1784'>
    <a name='1785'>
    twist = ieor(ishft(mixbits(u, v), -1_im), t_matrix(iand(v, 1_im)))<a name='1786'>
    twist = ieor(ishft(mixbits(u, v), -1_im), t_matrix(iand(v, 1_im)))<a name='1787'>
  end function twist<a name='1788'>
  <font color=#447700>! ---------------------------<a name='1789'></font>
<A NAME='NEXTSTATE'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#NEXTSTATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1790'>
  <font color=#993300>subroutine </font><font color=#cc0000>nextState</font>(twister) <A href='../../call_to/NEXTSTATE.html' TARGET='index'>2</A><a name='1791'>
    type(randomNumberSequence), intent(inout) :: twister<a name='1792'>
    <a name='1793'>
    <font color=#447700>! Local variables<a name='1794'></font>
    integer(kind=im) :: k<a name='1795'>
    <a name='1796'>
    do k = 0, blockSize - M - 1<a name='1797'>
      twister%state(k) = ieor(twister%state(k + M), &amp;<a name='1798'>
                              twist(twister%state(k), twister%state(k + 1_im)))<a name='1799'>
    end do <a name='1800'>
    do k = blockSize - M, blockSize - 2<a name='1801'>
      twister%state(k) = ieor(twister%state(k + M - blockSize), &amp;<a name='1802'>
                              twist(twister%state(k), twister%state(k + 1_im)))<a name='1803'>
    end do <a name='1804'>
    twister%state(blockSize - 1_im) = ieor(twister%state(M - 1_im), &amp;<a name='1805'>
                                        twist(twister%state(blockSize - 1_im), twister%state(0_im)))<a name='1806'>
    twister%currentElement = 0_im<a name='1807'>
<a name='1808'>
  end subroutine nextState<a name='1809'>
  <font color=#447700>! ---------------------------<a name='1810'></font>
<A NAME='TEMPER'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TEMPER' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1811'>
  elemental <font color=#993300>function </font><font color=#cc0000>temper</font>(y) <A href='../../call_to/TEMPER.html' TARGET='index'>2</A><a name='1812'>
    integer(kind=im), intent(in) :: y<a name='1813'>
    integer(kind=im)             :: temper<a name='1814'>
    <a name='1815'>
    integer(kind=im) :: x<a name='1816'>
    <a name='1817'>
    <font color=#447700>! Tempering<a name='1818'></font>
    x      = ieor(y, ishft(y, -11))<a name='1819'>
    x      = ieor(x, iand(ishft(x,  7), TMASKB))<a name='1820'>
    x      = ieor(x, iand(ishft(x, 15), TMASKC))<a name='1821'>
    temper = ieor(x, ishft(x, -18))<a name='1822'>
  end function temper<a name='1823'>
  <font color=#447700>! -------------------------------------------------------------<a name='1824'></font>
  <font color=#447700>! Public (but hidden) functions<a name='1825'></font>
  <font color=#447700>! --------------------<a name='1826'></font>
<A NAME='INITIALIZE_SCALAR'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INITIALIZE_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1827'>
  <font color=#993300>function </font><font color=#cc0000>initialize_scalar</font>(seed) result(twister) <A href='../../call_to/INITIALIZE_SCALAR.html' TARGET='index'>4</A><a name='1828'>
    integer(kind=im),       intent(in   ) :: seed<a name='1829'>
    type(randomNumberSequence)                :: twister <a name='1830'>
    <a name='1831'>
    integer(kind=im) :: i<a name='1832'>
    <font color=#447700>! See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. In the previous versions, <a name='1833'></font>
    <font color=#447700>!   MSBs of the seed affect only MSBs of the array state[].                       <a name='1834'></font>
    <font color=#447700>!   2002/01/09 modified by Makoto Matsumoto            <a name='1835'></font>
    <a name='1836'>
    twister%state(0) = iand(seed, -1_im)<a name='1837'>
    do i = 1,  blockSize - 1 <font color=#447700>! ubound(twister%state)<a name='1838'></font>
       twister%state(i) = 1812433253_im * ieor(twister%state(i-1), &amp;<a name='1839'>
                                            ishft(twister%state(i-1), -30_im)) + i<a name='1840'>
       twister%state(i) = iand(twister%state(i), -1_im) <font color=#447700>! for &gt;32 bit machines<a name='1841'></font>
    end do<a name='1842'>
    twister%currentElement = blockSize<a name='1843'>
  end function initialize_scalar<a name='1844'>
  <font color=#447700>! -------------------------------------------------------------<a name='1845'></font>
<A NAME='INITIALIZE_VECTOR'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INITIALIZE_VECTOR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1846'>
  <font color=#993300>function </font><font color=#cc0000>initialize_vector</font>(seed) result(twister) <A href='../../call_to/INITIALIZE_VECTOR.html' TARGET='index'>2</A>,<A href='../../call_from/INITIALIZE_VECTOR.html' TARGET='index'>2</A><a name='1847'>
    integer(kind=im), dimension(0:), intent(in) :: seed<a name='1848'>
    type(randomNumberSequence)                      :: twister <a name='1849'>
    <a name='1850'>
    integer(kind=im) :: i, j, k, nFirstLoop, nWraps<a name='1851'>
    <a name='1852'>
    nWraps  = 0<a name='1853'>
    twister = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_SCALAR'>initialize_scalar</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZE_VECTOR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIALIZE_SCALAR_2">(19650218_im)<a name='1854'>
    <a name='1855'>
    nFirstLoop = max(blockSize, size(seed))<a name='1856'>
    do k = 1, nFirstLoop<a name='1857'>
       i = mod(k + nWraps, blockSize)<a name='1858'>
       j = mod(k - 1,      size(seed))<a name='1859'>
       if(i == 0) then<a name='1860'>
         twister%state(i) = twister%state(blockSize - 1)<a name='1861'>
         twister%state(1) = ieor(twister%state(1),                                 &amp;<a name='1862'>
                                 ieor(twister%state(1-1),                          &amp; <a name='1863'>
                                      ishft(twister%state(1-1), -30_im)) * 1664525_im) + &amp; <a name='1864'>
                            seed(j) + j <font color=#447700>! Non-linear<a name='1865'></font>
         twister%state(i) = iand(twister%state(i), -1_im) <font color=#447700>! for &gt;32 bit machines<a name='1866'></font>
         nWraps = nWraps + 1<a name='1867'>
       else<a name='1868'>
         twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='1869'>
                                 ieor(twister%state(i-1),                          &amp; <a name='1870'>
                                      ishft(twister%state(i-1), -30_im)) * 1664525_im) + &amp; <a name='1871'>
                            seed(j) + j <font color=#447700>! Non-linear<a name='1872'></font>
         twister%state(i) = iand(twister%state(i), -1_im) <font color=#447700>! for &gt;32 bit machines<a name='1873'></font>
      end if<a name='1874'>
    end do<a name='1875'>
    <a name='1876'>
    <font color=#447700>!<a name='1877'></font>
    <font color=#447700>! Walk through the state array, beginning where we left off in the block above<a name='1878'></font>
    <font color=#447700>! <a name='1879'></font>
    do i = mod(nFirstLoop, blockSize) + nWraps + 1, blockSize - 1<a name='1880'>
      twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='1881'>
                              ieor(twister%state(i-1),                          &amp; <a name='1882'>
                                   ishft(twister%state(i-1), -30_im)) * 1566083941_im) - i <font color=#447700>! Non-linear<a name='1883'></font>
      twister%state(i) = iand(twister%state(i), -1_im) <font color=#447700>! for &gt;32 bit machines<a name='1884'></font>
    end do<a name='1885'>
    <a name='1886'>
    twister%state(0) = twister%state(blockSize - 1) <a name='1887'>
    <a name='1888'>
    do i = 1, mod(nFirstLoop, blockSize) + nWraps<a name='1889'>
      twister%state(i) = ieor(twister%state(i),                                 &amp;<a name='1890'>
                              ieor(twister%state(i-1),                          &amp; <a name='1891'>
                                   ishft(twister%state(i-1), -30_im)) * 1566083941_im) - i <font color=#447700>! Non-linear<a name='1892'></font>
      twister%state(i) = iand(twister%state(i), -1_im) <font color=#447700>! for &gt;32 bit machines<a name='1893'></font>
    end do<a name='1894'>
    <a name='1895'>
    twister%state(0) = UMASK <a name='1896'>
    twister%currentElement = blockSize<a name='1897'>
    <a name='1898'>
  end function initialize_vector<a name='1899'>
  <font color=#447700>! -------------------------------------------------------------<a name='1900'></font>
  <font color=#447700>! Public functions<a name='1901'></font>
  <font color=#447700>! --------------------<a name='1902'></font>
<A NAME='GETRANDOMINT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMINT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1903'>
  <font color=#993300>function </font><font color=#cc0000>getRandomInt</font>(twister) <A href='../../call_to/GETRANDOMINT.html' TARGET='index'>4</A>,<A href='../../call_from/GETRANDOMINT.html' TARGET='index'>4</A><a name='1904'>
    type(randomNumberSequence), intent(inout) :: twister<a name='1905'>
    integer(kind=im)                        :: getRandomInt<a name='1906'>
    <font color=#447700>! Generate a random integer on the interval [0,0xffffffff]<a name='1907'></font>
    <font color=#447700>!   Equivalent to genrand_int32 in the C code. <a name='1908'></font>
    <font color=#447700>!   Fortran doesn't have a type that's unsigned like C does, <a name='1909'></font>
    <font color=#447700>!   so this is integers in the range -2**31 - 2**31<a name='1910'></font>
    <font color=#447700>! All functions for getting random numbers call this one, <a name='1911'></font>
    <font color=#447700>!   then manipulate the result<a name='1912'></font>
    <a name='1913'>
    if(twister%currentElement &gt;= blockSize) call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#NEXTSTATE'>nextState</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NEXTSTATE_1">(twister)<a name='1914'>
      <a name='1915'>
    getRandomInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#TEMPER'>temper</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEMPER_1">(twister%state(twister%currentElement))<a name='1916'>
    twister%currentElement = twister%currentElement + 1<a name='1917'>
  <a name='1918'>
  end function getRandomInt<a name='1919'>
  <font color=#447700>! --------------------<a name='1920'></font>
<A NAME='GETRANDOMPOSITIVEINT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMPOSITIVEINT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1921'>
  <font color=#993300>function </font><font color=#cc0000>getRandomPositiveInt</font>(twister),<A href='../../call_from/GETRANDOMPOSITIVEINT.html' TARGET='index'>2</A><a name='1922'>
    type(randomNumberSequence), intent(inout) :: twister<a name='1923'>
    integer(kind=im)                        :: getRandomPositiveInt<a name='1924'>
    <font color=#447700>! Generate a random integer on the interval [0,0x7fffffff]<a name='1925'></font>
    <font color=#447700>!   or [0,2**31]<a name='1926'></font>
    <font color=#447700>!   Equivalent to genrand_int31 in the C code. <a name='1927'></font>
    <a name='1928'>
    <font color=#447700>! Local integers<a name='1929'></font>
    integer(kind=im) :: localInt<a name='1930'>
<a name='1931'>
    localInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT'>getRandomInt</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMPOSITIVEINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMINT_1">(twister)<a name='1932'>
    getRandomPositiveInt = ishft(localInt, -1)<a name='1933'>
  <a name='1934'>
  end function getRandomPositiveInt<a name='1935'>
  <font color=#447700>! --------------------<a name='1936'></font>
<font color=#447700>!! mji - modified Jan 2007, double converted to rrtmg real kind type<a name='1937'></font>
<A NAME='GETRANDOMREAL'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMREAL' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1938'>
  <font color=#993300>function </font><font color=#cc0000>getRandomReal</font>(twister) <A href='../../call_to/GETRANDOMREAL.html' TARGET='index'>10</A>,<A href='../../call_from/GETRANDOMREAL.html' TARGET='index'>2</A><a name='1939'>
    type(randomNumberSequence), intent(inout) :: twister<a name='1940'>
<font color=#447700>!    double precision             :: getRandomReal<a name='1941'></font>
    real(kind=rb)             :: getRandomReal<a name='1942'>
    <font color=#447700>! Generate a random number on [0,1]<a name='1943'></font>
    <font color=#447700>!   Equivalent to genrand_real1 in the C code<a name='1944'></font>
    <font color=#447700>!   The result is stored as double precision but has 32 bit resolution<a name='1945'></font>
    <a name='1946'>
    integer(kind=im) :: localInt<a name='1947'>
    <a name='1948'>
    localInt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMINT'>getRandomInt</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMINT_2">(twister)<a name='1949'>
    if(localInt &lt; 0) then<a name='1950'>
<font color=#447700>!      getRandomReal = dble(localInt + 2.0d0**32)/(2.0d0**32 - 1.0d0)<a name='1951'></font>
      getRandomReal = (localInt + 2.0**32_rb)/(2.0**32_rb - 1.0_rb)<a name='1952'>
    else<a name='1953'>
<font color=#447700>!      getRandomReal = dble(localInt            )/(2.0d0**32 - 1.0d0)<a name='1954'></font>
      getRandomReal = (localInt            )/(2.0**32_rb - 1.0_rb)<a name='1955'>
    end if<a name='1956'>
<a name='1957'>
  end function getRandomReal<a name='1958'>
  <font color=#447700>! --------------------<a name='1959'></font>
<A NAME='FINALIZE_RANDOMNUMBERSEQUENCE'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#FINALIZE_RANDOMNUMBERSEQUENCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1960'>
  <font color=#993300>subroutine </font><font color=#cc0000>finalize_RandomNumberSequence</font>(twister)<a name='1961'>
    type(randomNumberSequence), intent(inout) :: twister<a name='1962'>
    <a name='1963'>
      twister%currentElement = blockSize<a name='1964'>
      twister%state(:) = 0_im<a name='1965'>
  end subroutine finalize_RandomNumberSequence<a name='1966'>
<a name='1967'>
  <font color=#447700>! --------------------  <a name='1968'></font>
  <a name='1969'>
  end module MersenneTwister<a name='1970'>
<a name='1971'>
<a name='1972'>
<A NAME='MCICA_RANDOM_NUMBERS'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='1973'>
  <font color=#993300>module </font><font color=#cc0000>mcica_random_numbers</font> <A href='../../call_to/MCICA_RANDOM_NUMBERS.html' TARGET='index'>2</A>,<A href='../../call_from/MCICA_RANDOM_NUMBERS.html' TARGET='index'>7</A><a name='1974'>
<a name='1975'>
  <font color=#447700>! Generic module to wrap random number generators. <a name='1976'></font>
  <font color=#447700>!   The module defines a type that identifies the particular stream of random <a name='1977'></font>
  <font color=#447700>!   numbers, and has procedures for initializing it and getting real numbers <a name='1978'></font>
  <font color=#447700>!   in the range 0 to 1. <a name='1979'></font>
  <font color=#447700>! This version uses the Mersenne Twister to generate random numbers on [0, 1]. <a name='1980'></font>
  <font color=#447700>!<a name='1981'></font>
  use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER'>MersenneTwister</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MERSENNETWISTER_1">, only: randomNumberSequence, &amp; <font color=#447700>! The random number engine.<a name='1982'></font>
                             new_RandomNumberSequence, getRandomReal<a name='1983'>
<font color=#447700>!! mji<a name='1984'></font>
<font color=#447700>!!  use time_manager_mod, only: time_type, get_date<a name='1985'></font>
<a name='1986'>
  use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_24">, only : im =&gt; kind_im, rb =&gt; kind_rb <a name='1987'>
<a name='1988'>
  implicit none<a name='1989'>
  private<a name='1990'>
  <a name='1991'>
  type randomNumberStream<a name='1992'>
    type(randomNumberSequence) :: theNumbers<a name='1993'>
  end type randomNumberStream<a name='1994'>
  <a name='1995'>
<A NAME='GETRANDOMNUMBERS'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMNUMBERS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1996'>
  <font color=#993300>interface </font><font color=#cc0000>getRandomNumbers</font><a name='1997'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_SCALAR'>getRandomNumber_Scalar</A><A NAME="GETRANDOMNUMBER_SCALAR_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D'>getRandomNumber_1D</A><A NAME="GETRANDOMNUMBER_1D_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_2D'>getRandomNumber_2D</A><A NAME="GETRANDOMNUMBER_2D_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1998'>
  end interface getRandomNumbers<a name='1999'>
  <a name='2000'>
<A NAME='INITIALIZERANDOMNUMBERSTREAM'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INITIALIZERANDOMNUMBERSTREAM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2001'>
  <font color=#993300>interface </font><font color=#cc0000>initializeRandomNumberStream</font><a name='2002'>
    module procedure <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_S'>initializeRandomNumberStream_S</A><A NAME="INITIALIZERANDOMNUMBERSTREAM_S_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INITIALIZERANDOMNUMBERSTREAM_V'>initializeRandomNumberStream_V</A><A NAME="INITIALIZERANDOMNUMBERSTREAM_V_1"><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2003'>
  end interface initializeRandomNumberStream<a name='2004'>
<a name='2005'>
  public :: randomNumberStream,                             &amp;<a name='2006'>
            initializeRandomNumberStream, getRandomNumbers<a name='2007'>
<font color=#447700>!! mji<a name='2008'></font>
<font color=#447700>!!            initializeRandomNumberStream, getRandomNumbers, &amp;<a name='2009'></font>
<font color=#447700>!!            constructSeed<a name='2010'></font>
contains<a name='2011'>
  <font color=#447700>! ---------------------------------------------------------<a name='2012'></font>
  <font color=#447700>! Initialization<a name='2013'></font>
  <font color=#447700>! ---------------------------------------------------------<a name='2014'></font>
<A NAME='INITIALIZERANDOMNUMBERSTREAM_S'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INITIALIZERANDOMNUMBERSTREAM_S' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2015'>
  <font color=#993300>function </font><font color=#cc0000>initializeRandomNumberStream_S</font>(seed) result(new)  <A href='../../call_to/INITIALIZERANDOMNUMBERSTREAM_S.html' TARGET='index'>2</A><a name='2016'>
    integer(kind=im), intent( in)     :: seed<a name='2017'>
    type(randomNumberStream) :: new<a name='2018'>
    <a name='2019'>
    new%theNumbers = new_RandomNumberSequence(seed)<a name='2020'>
    <a name='2021'>
  end function initializeRandomNumberStream_S<a name='2022'>
  <font color=#447700>! ---------------------------------------------------------<a name='2023'></font>
<A NAME='INITIALIZERANDOMNUMBERSTREAM_V'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INITIALIZERANDOMNUMBERSTREAM_V' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2024'>
  <font color=#993300>function </font><font color=#cc0000>initializeRandomNumberStream_V</font>(seed) result(new)  <A href='../../call_to/INITIALIZERANDOMNUMBERSTREAM_V.html' TARGET='index'>2</A><a name='2025'>
    integer(kind=im), dimension(:), intent( in) :: seed<a name='2026'>
    type(randomNumberStream)           :: new<a name='2027'>
    <a name='2028'>
    new%theNumbers = new_RandomNumberSequence(seed)<a name='2029'>
    <a name='2030'>
  end function initializeRandomNumberStream_V<a name='2031'>
  <font color=#447700>! ---------------------------------------------------------<a name='2032'></font>
  <font color=#447700>! Procedures for drawing random numbers<a name='2033'></font>
  <font color=#447700>! ---------------------------------------------------------<a name='2034'></font>
<A NAME='GETRANDOMNUMBER_SCALAR'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMNUMBER_SCALAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2035'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_Scalar</font>(stream, number) <A href='../../call_to/GETRANDOMNUMBER_SCALAR.html' TARGET='index'>2</A>,<A href='../../call_from/GETRANDOMNUMBER_SCALAR.html' TARGET='index'>2</A><a name='2036'>
    type(randomNumberStream), intent(inout) :: stream<a name='2037'>
    real(kind=rb),                     intent(  out) :: number<a name='2038'>
    <a name='2039'>
    number = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_SCALAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_1">(stream%theNumbers)<a name='2040'>
  end subroutine getRandomNumber_Scalar<a name='2041'>
  <font color=#447700>! ---------------------------------------------------------<a name='2042'></font>
<A NAME='GETRANDOMNUMBER_1D'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMNUMBER_1D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2043'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_1D</font>(stream, numbers) <A href='../../call_to/GETRANDOMNUMBER_1D.html' TARGET='index'>4</A>,<A href='../../call_from/GETRANDOMNUMBER_1D.html' TARGET='index'>2</A><a name='2044'>
    type(randomNumberStream), intent(inout) :: stream<a name='2045'>
    real(kind=rb), dimension(:),       intent(  out) :: numbers<a name='2046'>
    <a name='2047'>
    <font color=#447700>! Local variables<a name='2048'></font>
    integer(kind=im) :: i<a name='2049'>
    <a name='2050'>
    do i = 1, size(numbers)<a name='2051'>
      numbers(i) = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_2">(stream%theNumbers)<a name='2052'>
    end do<a name='2053'>
  end subroutine getRandomNumber_1D<a name='2054'>
  <font color=#447700>! ---------------------------------------------------------<a name='2055'></font>
<A NAME='GETRANDOMNUMBER_2D'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GETRANDOMNUMBER_2D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2056'>
  <font color=#993300>subroutine </font><font color=#cc0000>getRandomNumber_2D</font>(stream, numbers) <A href='../../call_to/GETRANDOMNUMBER_2D.html' TARGET='index'>2</A>,<A href='../../call_from/GETRANDOMNUMBER_2D.html' TARGET='index'>2</A><a name='2057'>
    type(randomNumberStream), intent(inout) :: stream<a name='2058'>
    real(kind=rb), dimension(:, :),    intent(  out) :: numbers<a name='2059'>
    <a name='2060'>
    <font color=#447700>! Local variables<a name='2061'></font>
    integer(kind=im) :: i<a name='2062'>
    <a name='2063'>
    do i = 1, size(numbers, 2)<a name='2064'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_1D'>getRandomNumber_1D</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMNUMBER_2D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMNUMBER_1D_2">(stream, numbers(:, i))<a name='2065'>
    end do<a name='2066'>
  end subroutine getRandomNumber_2D<a name='2067'>
<font color=#447700>! mji<a name='2068'></font>
<font color=#447700>!  ! ---------------------------------------------------------<a name='2069'></font>
<font color=#447700>!  ! Constructing a unique seed from grid cell index and model date/time<a name='2070'></font>
<font color=#447700>!  !   Once we have the GFDL stuff we'll add the year, month, day, hour, minute<a name='2071'></font>
<font color=#447700>!  ! ---------------------------------------------------------<a name='2072'></font>
<font color=#447700>!  function constructSeed(i, j, time) result(seed)<a name='2073'></font>
<font color=#447700>!    integer(kind=im),         intent( in)  :: i, j<a name='2074'></font>
<font color=#447700>!    type(time_type), intent( in) :: time<a name='2075'></font>
<font color=#447700>!    integer(kind=im), dimension(8) :: seed<a name='2076'></font>
<font color=#447700>!    <a name='2077'></font>
<font color=#447700>!    ! Local variables<a name='2078'></font>
<font color=#447700>!    integer(kind=im) :: year, month, day, hour, minute, second<a name='2079'></font>
<font color=#447700>!    <a name='2080'></font>
<font color=#447700>!    <a name='2081'></font>
<font color=#447700>!    call get_date(time, year, month, day, hour, minute, second)<a name='2082'></font>
<font color=#447700>!    seed = (/ i, j, year, month, day, hour, minute, second /)<a name='2083'></font>
<font color=#447700>!  end function constructSeed<a name='2084'></font>
<a name='2085'>
  end module mcica_random_numbers<a name='2086'>
<a name='2087'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='2088'></font>
<font color=#447700>!     author:    $Author: trn $<a name='2089'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='2090'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='2091'></font>
<font color=#447700>!<a name='2092'></font>
<A NAME='MCICA_SUBCOL_GEN_LW'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2093'>
      <font color=#993300>module </font><font color=#cc0000>mcica_subcol_gen_lw</font> <A href='../../call_to/MCICA_SUBCOL_GEN_LW.html' TARGET='index'>2</A>,<A href='../../call_from/MCICA_SUBCOL_GEN_LW.html' TARGET='index'>5</A><a name='2094'>
<a name='2095'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2096'></font>
<font color=#447700>! |                                                                          |<a name='2097'></font>
<font color=#447700>! |  Copyright 2006-2008, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='2098'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='2099'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='2100'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='2101'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='2102'></font>
<font color=#447700>! |                                                                          |<a name='2103'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2104'></font>
<a name='2105'>
<font color=#447700>! Purpose: Create McICA stochastic arrays for cloud physical or optical properties.<a name='2106'></font>
<font color=#447700>! Two options are possible:<a name='2107'></font>
<font color=#447700>! 1) Input cloud physical properties: cloud fraction, ice and liquid water<a name='2108'></font>
<font color=#447700>!    paths, ice fraction, and particle sizes.  Output will be stochastic<a name='2109'></font>
<font color=#447700>!    arrays of these variables.  (inflag = 1)<a name='2110'></font>
<font color=#447700>! 2) Input cloud optical properties directly: cloud optical depth, single<a name='2111'></font>
<font color=#447700>!    scattering albedo and asymmetry parameter.  Output will be stochastic<a name='2112'></font>
<font color=#447700>!    arrays of these variables.  (inflag = 0; longwave scattering is not<a name='2113'></font>
<font color=#447700>!    yet available, ssac and asmc are for future expansion)<a name='2114'></font>
<a name='2115'>
<font color=#447700>! --------- Modules ----------<a name='2116'></font>
<a name='2117'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_25">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='2118'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_2">, only : nbndlw, ngptlw<a name='2119'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_1">, only: grav<a name='2120'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_1">, only: ngb<a name='2121'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_1"><a name='2122'>
<a name='2123'>
      implicit none<a name='2124'>
<a name='2125'>
<font color=#447700>! public interfaces/functions/subroutines<a name='2126'></font>
      public :: mcica_subcol_lw, generate_stochastic_clouds <a name='2127'>
<a name='2128'>
      contains<a name='2129'>
<a name='2130'>
<font color=#447700>!------------------------------------------------------------------<a name='2131'></font>
<font color=#447700>! Public subroutines<a name='2132'></font>
<font color=#447700>!------------------------------------------------------------------<a name='2133'></font>
<a name='2134'>
<A NAME='MCICA_SUBCOL_LW'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_LW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2135'>
      <font color=#993300>subroutine </font><font color=#cc0000>mcica_subcol_lw</font>(iplon, ncol, nlay, icld, permuteseed, irng, play, &amp; <A href='../../call_to/MCICA_SUBCOL_LW.html' TARGET='index'>1</A>,<A href='../../call_from/MCICA_SUBCOL_LW.html' TARGET='index'>1</A><a name='2136'>
                       cldfrac, ciwp, clwp, cswp, rei, rel, res, tauc, cldfmcl, &amp;<a name='2137'>
                       ciwpmcl, clwpmcl, cswpmcl, reicmcl, relqmcl, resnmcl, taucmcl)<a name='2138'>
<a name='2139'>
<font color=#447700>! ----- Input -----<a name='2140'></font>
<font color=#447700>! Control<a name='2141'></font>
      integer(kind=im), intent(in) :: iplon           <font color=#447700>! column/longitude index<a name='2142'></font>
      integer(kind=im), intent(in) :: ncol            <font color=#447700>! number of columns<a name='2143'></font>
      integer(kind=im), intent(in) :: nlay            <font color=#447700>! number of model layers<a name='2144'></font>
      integer(kind=im), intent(in) :: icld            <font color=#447700>! clear/cloud, cloud overlap flag<a name='2145'></font>
      integer(kind=im), intent(in) :: permuteseed     <font color=#447700>! if the cloud generator is called multiple times, <a name='2146'></font>
                                                      <font color=#447700>! permute the seed between each call.<a name='2147'></font>
                                                      <font color=#447700>! between calls for LW and SW, recommended<a name='2148'></font>
                                                      <font color=#447700>! permuteseed differes by 'ngpt'<a name='2149'></font>
      integer(kind=im), intent(inout) :: irng         <font color=#447700>! flag for random number generator<a name='2150'></font>
                                                      <font color=#447700>!  0 = kissvec<a name='2151'></font>
                                                      <font color=#447700>!  1 = Mersenne Twister<a name='2152'></font>
<a name='2153'>
<font color=#447700>! Atmosphere<a name='2154'></font>
      real(kind=rb), intent(in) :: play(:,:)          <font color=#447700>! layer pressures (mb) <a name='2155'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2156'></font>
<a name='2157'>
<font color=#447700>! Atmosphere/clouds - cldprop<a name='2158'></font>
      real(kind=rb), intent(in) :: cldfrac(:,:)       <font color=#447700>! layer cloud fraction<a name='2159'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2160'></font>
      real(kind=rb), intent(in) :: tauc(:,:,:)        <font color=#447700>! in-cloud optical depth<a name='2161'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2162'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: ssac(:,:,:)       ! in-cloud single scattering albedo<a name='2163'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2164'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: asmc(:,:,:)       ! in-cloud asymmetry parameter<a name='2165'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2166'></font>
      real(kind=rb), intent(in) :: ciwp(:,:)          <font color=#447700>! in-cloud ice water path<a name='2167'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2168'></font>
      real(kind=rb), intent(in) :: clwp(:,:)          <font color=#447700>! in-cloud liquid water path<a name='2169'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2170'></font>
      real(kind=rb), intent(in) :: cswp(:,:)          <font color=#447700>! in-cloud snow path<a name='2171'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2172'></font>
      real(kind=rb), intent(in) :: rei(:,:)           <font color=#447700>! cloud ice particle size<a name='2173'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2174'></font>
      real(kind=rb), intent(in) :: rel(:,:)           <font color=#447700>! cloud liquid particle size<a name='2175'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2176'></font>
      real(kind=rb), intent(in) :: res(:,:)           <font color=#447700>! snow particle size<a name='2177'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2178'></font>
<a name='2179'>
<font color=#447700>! ----- Output -----<a name='2180'></font>
<font color=#447700>! Atmosphere/clouds - cldprmc [mcica]<a name='2181'></font>
      real(kind=rb), intent(out) :: cldfmcl(:,:,:)    <font color=#447700>! cloud fraction [mcica]<a name='2182'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2183'></font>
      real(kind=rb), intent(out) :: ciwpmcl(:,:,:)    <font color=#447700>! in-cloud ice water path [mcica]<a name='2184'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2185'></font>
      real(kind=rb), intent(out) :: clwpmcl(:,:,:)    <font color=#447700>! in-cloud liquid water path [mcica]<a name='2186'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2187'></font>
      real(kind=rb), intent(out) :: cswpmcl(:,:,:)    <font color=#447700>! in-cloud snow path [mcica]<a name='2188'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2189'></font>
      real(kind=rb), intent(out) :: relqmcl(:,:)      <font color=#447700>! liquid particle size (microns)<a name='2190'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2191'></font>
      real(kind=rb), intent(out) :: reicmcl(:,:)      <font color=#447700>! ice partcle size (microns)<a name='2192'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2193'></font>
      real(kind=rb), intent(out) :: resnmcl(:,:)      <font color=#447700>! snow partcle size (microns)<a name='2194'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2195'></font>
      real(kind=rb), intent(out) :: taucmcl(:,:,:)    <font color=#447700>! in-cloud optical depth [mcica]<a name='2196'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2197'></font>
<font color=#447700>!      real(kind=rb), intent(out) :: ssacmcl(:,:,:)   ! in-cloud single scattering albedo [mcica]<a name='2198'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2199'></font>
<font color=#447700>!      real(kind=rb), intent(out) :: asmcmcl(:,:,:)   ! in-cloud asymmetry parameter [mcica]<a name='2200'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2201'></font>
<a name='2202'>
<font color=#447700>! ----- Local -----<a name='2203'></font>
<a name='2204'>
<font color=#447700>! Stochastic cloud generator variables [mcica]<a name='2205'></font>
      integer(kind=im), parameter :: nsubclw = ngptlw <font color=#447700>! number of sub-columns (g-point intervals)<a name='2206'></font>
      integer(kind=im) :: ilev                        <font color=#447700>! loop index<a name='2207'></font>
<a name='2208'>
      real(kind=rb) :: pmid(ncol, nlay)               <font color=#447700>! layer pressures (Pa) <a name='2209'></font>
<font color=#447700>!      real(kind=rb) :: pdel(ncol, nlay)              ! layer pressure thickness (Pa) <a name='2210'></font>
<font color=#447700>!      real(kind=rb) :: qi(ncol, nlay)                ! ice water (specific humidity)<a name='2211'></font>
<font color=#447700>!      real(kind=rb) :: ql(ncol, nlay)                ! liq water (specific humidity)<a name='2212'></font>
<a name='2213'>
<a name='2214'>
<font color=#447700>! Return if clear sky; or stop if icld out of range<a name='2215'></font>
      if (icld.eq.0) return<a name='2216'>
      if (icld.lt.0.or.icld.gt.3) then <a name='2217'>
         stop 'MCICA_SUBCOL: INVALID ICLD'<a name='2218'>
      endif <a name='2219'>
<a name='2220'>
<font color=#447700>! NOTE: For GCM mode, permuteseed must be offset between LW and SW by at least the number of subcolumns<a name='2221'></font>
<a name='2222'>
<a name='2223'>
<font color=#447700>! Pass particle sizes to new arrays, no subcolumns for these properties yet<a name='2224'></font>
<font color=#447700>! Convert pressures from mb to Pa<a name='2225'></font>
<a name='2226'>
      reicmcl(:ncol,:nlay) = rei(:ncol,:nlay)<a name='2227'>
      relqmcl(:ncol,:nlay) = rel(:ncol,:nlay)<a name='2228'>
      resnmcl(:ncol,:nlay) = res(:ncol,:nlay)<a name='2229'>
      pmid(:ncol,:nlay) = play(:ncol,:nlay)*1.e2_rb<a name='2230'>
<a name='2231'>
<font color=#447700>! Convert input ice and liquid cloud water paths to specific humidity ice and liquid components <a name='2232'></font>
<a name='2233'>
<font color=#447700>!      cwp =  (q * pdel * 1000.) / gravit)<a name='2234'></font>
<font color=#447700>!           = (kg/kg * kg m-1 s-2 *1000.) / m s-2<a name='2235'></font>
<font color=#447700>!           = (g m-2)<a name='2236'></font>
<font color=#447700>!<a name='2237'></font>
<font color=#447700>!      q  = (cwp * gravit) / (pdel *1000.)<a name='2238'></font>
<font color=#447700>!         = (g m-2 * m s-2) / (kg m-1 s-2 * 1000.)<a name='2239'></font>
<font color=#447700>!         =  kg/kg<a name='2240'></font>
<a name='2241'>
<font color=#447700>!      do ilev = 1, nlay<a name='2242'></font>
<font color=#447700>!         qi(ilev) = (ciwp(ilev) * grav) / (pdel(ilev) * 1000._rb)<a name='2243'></font>
<font color=#447700>!         ql(ilev) = (clwp(ilev) * grav) / (pdel(ilev) * 1000._rb)<a name='2244'></font>
<font color=#447700>!      enddo<a name='2245'></font>
<a name='2246'>
<font color=#447700>!  Generate the stochastic subcolumns of cloud optical properties for the longwave;<a name='2247'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS'>generate_stochastic_clouds</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GENERATE_STOCHASTIC_CLOUDS_1"> (ncol, nlay, nsubclw, icld, irng, pmid, cldfrac, clwp, ciwp, cswp, tauc, &amp;<a name='2248'>
                               cldfmcl, clwpmcl, ciwpmcl, cswpmcl, taucmcl, permuteseed)<a name='2249'>
<a name='2250'>
      end subroutine mcica_subcol_lw<a name='2251'>
<a name='2252'>
<a name='2253'>
<font color=#447700>!-------------------------------------------------------------------------------------------------<a name='2254'></font>
<A NAME='GENERATE_STOCHASTIC_CLOUDS'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2255'>
      <font color=#993300>subroutine </font><font color=#cc0000>generate_stochastic_clouds</font>(ncol, nlay, nsubcol, icld, irng, pmid, cld, clwp, ciwp, cswp, tauc, &amp; <A href='../../call_to/GENERATE_STOCHASTIC_CLOUDS.html' TARGET='index'>1</A>,<A href='../../call_from/GENERATE_STOCHASTIC_CLOUDS.html' TARGET='index'>9</A><a name='2256'>
                                   cld_stoch, clwp_stoch, ciwp_stoch, cswp_stoch, tauc_stoch, changeSeed) <a name='2257'>
<font color=#447700>!-------------------------------------------------------------------------------------------------<a name='2258'></font>
<a name='2259'>
  <font color=#447700>!----------------------------------------------------------------------------------------------------------------<a name='2260'></font>
  <font color=#447700>! ---------------------<a name='2261'></font>
  <font color=#447700>! Contact: Cecile Hannay (hannay@ucar.edu)<a name='2262'></font>
  <font color=#447700>! <a name='2263'></font>
  <font color=#447700>! Original code: Based on Raisanen et al., QJRMS, 2004.<a name='2264'></font>
  <font color=#447700>! <a name='2265'></font>
  <font color=#447700>! Modifications: Generalized for use with RRTMG and added Mersenne Twister as the default<a name='2266'></font>
  <font color=#447700>!   random number generator, which can be changed to the optional kissvec random number generator<a name='2267'></font>
  <font color=#447700>!   with flag 'irng'. Some extra functionality has been commented or removed.  <a name='2268'></font>
  <font color=#447700>!   Michael J. Iacono, AER, Inc., February 2007<a name='2269'></font>
  <font color=#447700>!<a name='2270'></font>
  <font color=#447700>! Given a profile of cloud fraction, cloud water and cloud ice, we produce a set of subcolumns.<a name='2271'></font>
  <font color=#447700>! Each layer within each subcolumn is homogeneous, with cloud fraction equal to zero or one <a name='2272'></font>
  <font color=#447700>! and uniform cloud liquid and cloud ice concentration.<a name='2273'></font>
  <font color=#447700>! The ensemble as a whole reproduces the probability function of cloud liquid and ice within each layer <a name='2274'></font>
  <font color=#447700>! and obeys an overlap assumption in the vertical.   <a name='2275'></font>
  <font color=#447700>! <a name='2276'></font>
  <font color=#447700>! Overlap assumption:<a name='2277'></font>
  <font color=#447700>!  The cloud are consistent with 4 overlap assumptions: random, maximum, maximum-random and exponential. <a name='2278'></font>
  <font color=#447700>!  The default option is maximum-random (option 3)<a name='2279'></font>
  <font color=#447700>!  The options are: 1=random overlap, 2=max/random, 3=maximum overlap, 4=exponential overlap<a name='2280'></font>
  <font color=#447700>!  This is set with the variable "overlap" <a name='2281'></font>
  <font color=#447700>!mji - Exponential overlap option (overlap=4) has been deactivated in this version<a name='2282'></font>
  <font color=#447700>!  The exponential overlap uses also a length scale, Zo. (real,    parameter  :: Zo = 2500. ) <a name='2283'></font>
  <font color=#447700>! <a name='2284'></font>
  <font color=#447700>! Seed:<a name='2285'></font>
  <font color=#447700>!  If the stochastic cloud generator is called several times during the same timestep, <a name='2286'></font>
  <font color=#447700>!  one should change the seed between the call to insure that the subcolumns are different.<a name='2287'></font>
  <font color=#447700>!  This is done by changing the argument 'changeSeed'<a name='2288'></font>
  <font color=#447700>!  For example, if one wants to create a set of columns for the shortwave and another set for the longwave ,<a name='2289'></font>
  <font color=#447700>!  use 'changeSeed = 1' for the first call and'changeSeed = 2' for the second call <a name='2290'></font>
  <font color=#447700>!<a name='2291'></font>
  <font color=#447700>! PDF assumption:<a name='2292'></font>
  <font color=#447700>!  We can use arbitrary complicated PDFS. <a name='2293'></font>
  <font color=#447700>!  In the present version, we produce homogeneuous clouds (the simplest case).  <a name='2294'></font>
  <font color=#447700>!  Future developments include using the PDF scheme of Ben Johnson. <a name='2295'></font>
  <font color=#447700>!<a name='2296'></font>
  <font color=#447700>! History file:<a name='2297'></font>
  <font color=#447700>!  Option to add diagnostics variables in the history file. (using FINCL in the namelist)<a name='2298'></font>
  <font color=#447700>!  nsubcol = number of subcolumns<a name='2299'></font>
  <font color=#447700>!  overlap = overlap type (1-3)<a name='2300'></font>
  <font color=#447700>!  Zo = length scale <a name='2301'></font>
  <font color=#447700>!  CLOUD_S = mean of the subcolumn cloud fraction ('_S" means Stochastic)<a name='2302'></font>
  <font color=#447700>!  CLDLIQ_S = mean of the subcolumn cloud water<a name='2303'></font>
  <font color=#447700>!  CLDICE_S = mean of the subcolumn cloud ice <a name='2304'></font>
  <font color=#447700>!<a name='2305'></font>
  <font color=#447700>! Note:<a name='2306'></font>
  <font color=#447700>!   Here: we force that the cloud condensate to be consistent with the cloud fraction <a name='2307'></font>
  <font color=#447700>!   i.e we only have cloud condensate when the cell is cloudy. <a name='2308'></font>
  <font color=#447700>!   In CAM: The cloud condensate and the cloud fraction are obtained from 2 different equations <a name='2309'></font>
  <font color=#447700>!   and the 2 quantities can be inconsistent (i.e. CAM can produce cloud fraction <a name='2310'></font>
  <font color=#447700>!   without cloud condensate or the opposite).<a name='2311'></font>
  <font color=#447700>!---------------------------------------------------------------------------------------------------------------<a name='2312'></font>
<a name='2313'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_RANDOM_NUMBERS'>mcica_random_numbers</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MCICA_RANDOM_NUMBERS_1"><a name='2314'>
<font color=#447700>! The Mersenne Twister random number engine<a name='2315'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MERSENNETWISTER'>MersenneTwister</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MERSENNETWISTER_2">, only: randomNumberSequence, &amp;   <a name='2316'>
                                 new_RandomNumberSequence, getRandomReal<a name='2317'>
<a name='2318'>
      type(randomNumberSequence) :: randomNumbers<a name='2319'>
<a name='2320'>
<font color=#447700>! -- Arguments<a name='2321'></font>
<a name='2322'>
      integer(kind=im), intent(in) :: ncol            <font color=#447700>! number of columns<a name='2323'></font>
      integer(kind=im), intent(in) :: nlay            <font color=#447700>! number of layers<a name='2324'></font>
      integer(kind=im), intent(in) :: icld            <font color=#447700>! clear/cloud, cloud overlap flag<a name='2325'></font>
      integer(kind=im), intent(inout) :: irng         <font color=#447700>! flag for random number generator<a name='2326'></font>
                                                      <font color=#447700>!  0 = kissvec<a name='2327'></font>
                                                      <font color=#447700>!  1 = Mersenne Twister<a name='2328'></font>
      integer(kind=im), intent(in) :: nsubcol         <font color=#447700>! number of sub-columns (g-point intervals)<a name='2329'></font>
      integer(kind=im), optional, intent(in) :: changeSeed     <font color=#447700>! allows permuting seed<a name='2330'></font>
<a name='2331'>
<font color=#447700>! Column state (cloud fraction, cloud water, cloud ice) + variables needed to read physics state <a name='2332'></font>
      real(kind=rb), intent(in) :: pmid(:,:)          <font color=#447700>! layer pressure (Pa)<a name='2333'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2334'></font>
      real(kind=rb), intent(in) :: cld(:,:)           <font color=#447700>! cloud fraction <a name='2335'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2336'></font>
      real(kind=rb), intent(in) :: clwp(:,:)          <font color=#447700>! in-cloud liquid water path<a name='2337'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2338'></font>
      real(kind=rb), intent(in) :: ciwp(:,:)          <font color=#447700>! in-cloud ice water path<a name='2339'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2340'></font>
      real(kind=rb), intent(in) :: cswp(:,:)          <font color=#447700>! in-cloud snow path<a name='2341'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='2342'></font>
      real(kind=rb), intent(in) :: tauc(:,:,:)        <font color=#447700>! in-cloud optical depth<a name='2343'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2344'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: ssac(:,:,:)       ! in-cloud single scattering albedo<a name='2345'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2346'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='2347'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: asmc(:,:,:)       ! in-cloud asymmetry parameter<a name='2348'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw,ncol,nlay)<a name='2349'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='2350'></font>
<a name='2351'>
      real(kind=rb), intent(out) :: cld_stoch(:,:,:)  <font color=#447700>! subcolumn cloud fraction <a name='2352'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2353'></font>
      real(kind=rb), intent(out) :: clwp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud liquid water path<a name='2354'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2355'></font>
      real(kind=rb), intent(out) :: ciwp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud ice water path<a name='2356'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2357'></font>
      real(kind=rb), intent(out) :: cswp_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud snow path<a name='2358'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2359'></font>
      real(kind=rb), intent(out) :: tauc_stoch(:,:,:) <font color=#447700>! subcolumn in-cloud optical depth<a name='2360'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2361'></font>
<font color=#447700>!      real(kind=rb), intent(out) :: ssac_stoch(:,:,:)! subcolumn in-cloud single scattering albedo<a name='2362'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2363'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='2364'></font>
<font color=#447700>!      real(kind=rb), intent(out) :: asmc_stoch(:,:,:)! subcolumn in-cloud asymmetry parameter<a name='2365'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='2366'></font>
                                                      <font color=#447700>!   inactive - for future expansion<a name='2367'></font>
<a name='2368'>
<font color=#447700>! -- Local variables<a name='2369'></font>
      real(kind=rb) :: cldf(ncol,nlay)                <font color=#447700>! cloud fraction <a name='2370'></font>
    <a name='2371'>
<font color=#447700>! Mean over the subcolumns (cloud fraction, cloud water , cloud ice) - inactive<a name='2372'></font>
<font color=#447700>!      real(kind=rb) :: mean_cld_stoch(ncol, nlay)    ! cloud fraction <a name='2373'></font>
<font color=#447700>!      real(kind=rb) :: mean_clwp_stoch(ncol, nlay)   ! cloud water<a name='2374'></font>
<font color=#447700>!      real(kind=rb) :: mean_ciwp_stoch(ncol, nlay)   ! cloud ice<a name='2375'></font>
<font color=#447700>!      real(kind=rb) :: mean_tauc_stoch(ncol, nlay)   ! cloud optical depth<a name='2376'></font>
<font color=#447700>!      real(kind=rb) :: mean_ssac_stoch(ncol, nlay)   ! cloud single scattering albedo<a name='2377'></font>
<font color=#447700>!      real(kind=rb) :: mean_asmc_stoch(ncol, nlay)   ! cloud asymmetry parameter<a name='2378'></font>
<a name='2379'>
<font color=#447700>! Set overlap<a name='2380'></font>
      integer(kind=im) :: overlap                     <font color=#447700>! 1 = random overlap, 2 = maximum/random,<a name='2381'></font>
                                                      <font color=#447700>! 3 = maximum overlap, <a name='2382'></font>
<font color=#447700>!      real(kind=rb), parameter  :: Zo = 2500._rb        ! length scale (m) <a name='2383'></font>
<font color=#447700>!      real(kind=rb) :: zm(ncol,nlay)                 ! Height of midpoints (above surface)<a name='2384'></font>
<font color=#447700>!      real(kind=rb), dimension(nlay) :: alpha=0.0_rb    ! overlap parameter  <a name='2385'></font>
<a name='2386'>
<font color=#447700>! Constants (min value for cloud fraction and cloud water and ice)<a name='2387'></font>
      real(kind=rb), parameter :: cldmin = 1.0e-20_rb <font color=#447700>! min cloud fraction<a name='2388'></font>
<font color=#447700>!      real(kind=rb), parameter :: qmin   = 1.0e-10_rb   ! min cloud water and cloud ice (not used)<a name='2389'></font>
<a name='2390'>
<font color=#447700>! Variables related to random number and seed <a name='2391'></font>
      real(kind=rb), dimension(nsubcol, ncol, nlay) :: CDF, CDF2      <font color=#447700>! random numbers<a name='2392'></font>
      integer(kind=im), dimension(ncol) :: seed1, seed2, seed3, seed4 <font color=#447700>! seed to create random number (kissvec)<a name='2393'></font>
      real(kind=rb), dimension(ncol) :: rand_num      <font color=#447700>! random number (kissvec)<a name='2394'></font>
      integer(kind=im) :: iseed                       <font color=#447700>! seed to create random number (Mersenne Teister)<a name='2395'></font>
      real(kind=rb) :: rand_num_mt                    <font color=#447700>! random number (Mersenne Twister)<a name='2396'></font>
<a name='2397'>
<font color=#447700>! Flag to identify cloud fraction in subcolumns<a name='2398'></font>
      logical,  dimension(nsubcol, ncol, nlay) :: iscloudy   <font color=#447700>! flag that says whether a gridbox is cloudy<a name='2399'></font>
<a name='2400'>
<font color=#447700>! Indices<a name='2401'></font>
      integer(kind=im) :: ilev, isubcol, i, n         <font color=#447700>! indices<a name='2402'></font>
<a name='2403'>
<font color=#447700>!------------------------------------------------------------------------------------------ <a name='2404'></font>
<a name='2405'>
<font color=#447700>! Check that irng is in bounds; if not, set to default<a name='2406'></font>
      if (irng .ne. 0) irng = 1<a name='2407'>
<a name='2408'>
<font color=#447700>! Pass input cloud overlap setting to local variable<a name='2409'></font>
      overlap = icld<a name='2410'>
<a name='2411'>
<font color=#447700>! Ensure that cloud fractions are in bounds <a name='2412'></font>
      do ilev = 1, nlay<a name='2413'>
         do i = 1, ncol<a name='2414'>
            cldf(i,ilev) = cld(i,ilev)<a name='2415'>
            if (cldf(i,ilev) &lt; cldmin) then<a name='2416'>
               cldf(i,ilev) = 0._rb<a name='2417'>
            endif<a name='2418'>
         enddo<a name='2419'>
      enddo<a name='2420'>
<a name='2421'>
<font color=#447700>! ----- Create seed  --------<a name='2422'></font>
   <a name='2423'>
<font color=#447700>! Advance randum number generator by changeseed values<a name='2424'></font>
      if (irng.eq.0) then   <a name='2425'>
<font color=#447700>! For kissvec, create a seed that depends on the state of the columns. Maybe not the best way, but it works.  <a name='2426'></font>
<font color=#447700>! Must use pmid from bottom four layers. <a name='2427'></font>
         do i=1,ncol<a name='2428'>
            if (pmid(i,1).lt.pmid(i,2)) then <a name='2429'>
               stop 'MCICA_SUBCOL: KISSVEC SEED GENERATOR REQUIRES PMID FROM BOTTOM FOUR LAYERS.'<a name='2430'>
            endif <a name='2431'>
            seed1(i) = (pmid(i,1) - int(pmid(i,1)))  * 1000000000_im<a name='2432'>
            seed2(i) = (pmid(i,2) - int(pmid(i,2)))  * 1000000000_im<a name='2433'>
            seed3(i) = (pmid(i,3) - int(pmid(i,3)))  * 1000000000_im<a name='2434'>
            seed4(i) = (pmid(i,4) - int(pmid(i,4)))  * 1000000000_im<a name='2435'>
          enddo<a name='2436'>
         do i=1,changeSeed<a name='2437'>
            call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_1">(seed1, seed2, seed3, seed4, rand_num)<a name='2438'>
         enddo<a name='2439'>
      elseif (irng.eq.1) then<a name='2440'>
         randomNumbers = new_RandomNumberSequence(seed = changeSeed)<a name='2441'>
      endif <a name='2442'>
<a name='2443'>
<a name='2444'>
<font color=#447700>! ------ Apply overlap assumption --------<a name='2445'></font>
<a name='2446'>
<font color=#447700>! generate the random numbers  <a name='2447'></font>
<a name='2448'>
      select case (overlap)<a name='2449'>
<a name='2450'>
      case(1) <a name='2451'>
<font color=#447700>! Random overlap<a name='2452'></font>
<font color=#447700>! i) pick a random value at every level<a name='2453'></font>
  <a name='2454'>
         if (irng.eq.0) then <a name='2455'>
            do isubcol = 1,nsubcol<a name='2456'>
               do ilev = 1,nlay<a name='2457'>
                  call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_2">(seed1, seed2, seed3, seed4, rand_num)  <font color=#447700>! we get different random number for each level<a name='2458'></font>
                  CDF(isubcol,:,ilev) = rand_num<a name='2459'>
               enddo<a name='2460'>
            enddo<a name='2461'>
         elseif (irng.eq.1) then<a name='2462'>
            do isubcol = 1, nsubcol<a name='2463'>
               do i = 1, ncol<a name='2464'>
                  do ilev = 1, nlay<a name='2465'>
                     rand_num_mt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_3">(randomNumbers)<a name='2466'>
                     CDF(isubcol,i,ilev) = rand_num_mt<a name='2467'>
                  enddo<a name='2468'>
               enddo<a name='2469'>
             enddo<a name='2470'>
         endif<a name='2471'>
<a name='2472'>
      case(2) <a name='2473'>
<font color=#447700>! Maximum-Random overlap<a name='2474'></font>
<font color=#447700>! i) pick a random number for top layer.<a name='2475'></font>
<font color=#447700>! ii) walk down the column: <a name='2476'></font>
<font color=#447700>!    - if the layer above is cloudy, we use the same random number than in the layer above<a name='2477'></font>
<font color=#447700>!    - if the layer above is clear, we use a new random number <a name='2478'></font>
<a name='2479'>
         if (irng.eq.0) then <a name='2480'>
            do isubcol = 1,nsubcol<a name='2481'>
               do ilev = 1,nlay<a name='2482'>
                  call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_3">(seed1, seed2, seed3, seed4, rand_num) <a name='2483'>
                  CDF(isubcol,:,ilev) = rand_num<a name='2484'>
               enddo<a name='2485'>
            enddo<a name='2486'>
         elseif (irng.eq.1) then<a name='2487'>
            do isubcol = 1, nsubcol<a name='2488'>
               do i = 1, ncol<a name='2489'>
                  do ilev = 1, nlay<a name='2490'>
                     rand_num_mt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_4">(randomNumbers)<a name='2491'>
                     CDF(isubcol,i,ilev) = rand_num_mt<a name='2492'>
                  enddo<a name='2493'>
               enddo<a name='2494'>
             enddo<a name='2495'>
         endif<a name='2496'>
<a name='2497'>
         do ilev = 2,nlay<a name='2498'>
            do i = 1, ncol<a name='2499'>
               do isubcol = 1, nsubcol<a name='2500'>
                  if (CDF(isubcol, i, ilev-1) &gt; 1._rb - cldf(i,ilev-1) ) then<a name='2501'>
                     CDF(isubcol,i,ilev) = CDF(isubcol,i,ilev-1) <a name='2502'>
                  else<a name='2503'>
                     CDF(isubcol,i,ilev) = CDF(isubcol,i,ilev) * (1._rb - cldf(i,ilev-1)) <a name='2504'>
                  endif<a name='2505'>
               enddo<a name='2506'>
            enddo<a name='2507'>
         enddo<a name='2508'>
       <a name='2509'>
      case(3) <a name='2510'>
<font color=#447700>! Maximum overlap<a name='2511'></font>
<font color=#447700>! i) pick the same random numebr at every level  <a name='2512'></font>
<a name='2513'>
         if (irng.eq.0) then <a name='2514'>
            do isubcol = 1,nsubcol<a name='2515'>
               call <A href='../../html_code/phys/module_ra_rrtmg_sw.F.html#KISSVEC'>kissvec</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KISSVEC_4">(seed1, seed2, seed3, seed4, rand_num)<a name='2516'>
               do ilev = 1,nlay<a name='2517'>
                  CDF(isubcol,:,ilev) = rand_num<a name='2518'>
               enddo<a name='2519'>
            enddo<a name='2520'>
         elseif (irng.eq.1) then<a name='2521'>
            do isubcol = 1, nsubcol<a name='2522'>
               do i = 1, ncol<a name='2523'>
                  rand_num_mt = <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#GETRANDOMREAL'>getRandomReal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#GENERATE_STOCHASTIC_CLOUDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETRANDOMREAL_5">(randomNumbers)<a name='2524'>
                  do ilev = 1, nlay<a name='2525'>
                     CDF(isubcol,i,ilev) = rand_num_mt<a name='2526'>
                  enddo<a name='2527'>
               enddo<a name='2528'>
             enddo<a name='2529'>
         endif<a name='2530'>
<a name='2531'>
<font color=#447700>!    case(4) - inactive<a name='2532'></font>
<font color=#447700>!       ! Exponential overlap: weighting between maximum and random overlap increases with the distance. <a name='2533'></font>
<font color=#447700>!       ! The random numbers for exponential overlap verify:<a name='2534'></font>
<font color=#447700>!       ! j=1   RAN(j)=RND1<a name='2535'></font>
<font color=#447700>!       ! j&gt;1   if RND1 &lt; alpha(j,j-1) =&gt; RAN(j) = RAN(j-1)<a name='2536'></font>
<font color=#447700>!       !                                 RAN(j) = RND2<a name='2537'></font>
<font color=#447700>!       ! alpha is obtained from the equation<a name='2538'></font>
<font color=#447700>!       ! alpha = exp(- (Zi-Zj-1)/Zo) where Zo is a characteristic length scale    <a name='2539'></font>
<a name='2540'>
<a name='2541'>
<font color=#447700>!       ! compute alpha<a name='2542'></font>
<font color=#447700>!       zm    = state%zm     <a name='2543'></font>
<font color=#447700>!       alpha(:, 1) = 0.<a name='2544'></font>
<font color=#447700>!       do ilev = 2,nlay<a name='2545'></font>
<font color=#447700>!          alpha(:, ilev) = exp( -( zm (:, ilev-1) -  zm (:, ilev)) / Zo)<a name='2546'></font>
<font color=#447700>!       end do<a name='2547'></font>
       <a name='2548'>
<font color=#447700>!       ! generate 2 streams of random numbers<a name='2549'></font>
<font color=#447700>!       do isubcol = 1,nsubcol<a name='2550'></font>
<font color=#447700>!          do ilev = 1,nlay<a name='2551'></font>
<font color=#447700>!             call kissvec(seed1, seed2, seed3, seed4, rand_num)<a name='2552'></font>
<font color=#447700>!             CDF(isubcol, :, ilev) = rand_num<a name='2553'></font>
<font color=#447700>!             call kissvec(seed1, seed2, seed3, seed4, rand_num)<a name='2554'></font>
<font color=#447700>!             CDF2(isubcol, :, ilev) = rand_num<a name='2555'></font>
<font color=#447700>!          end do<a name='2556'></font>
<font color=#447700>!       end do<a name='2557'></font>
<a name='2558'>
<font color=#447700>!       ! generate random numbers<a name='2559'></font>
<font color=#447700>!       do ilev = 2,nlay<a name='2560'></font>
<font color=#447700>!          where (CDF2(:, :, ilev) &lt; spread(alpha (:,ilev), dim=1, nCopies=nsubcol) )<a name='2561'></font>
<font color=#447700>!             CDF(:,:,ilev) = CDF(:,:,ilev-1) <a name='2562'></font>
<font color=#447700>!          end where<a name='2563'></font>
<font color=#447700>!       end do<a name='2564'></font>
<a name='2565'>
      end select<a name='2566'>
<a name='2567'>
 <a name='2568'>
<font color=#447700>! -- generate subcolumns for homogeneous clouds -----<a name='2569'></font>
      do ilev = 1,nlay<a name='2570'>
         iscloudy(:,:,ilev) = (CDF(:,:,ilev) &gt;= 1._rb - spread(cldf(:,ilev), dim=1, nCopies=nsubcol) )<a name='2571'>
      enddo<a name='2572'>
<a name='2573'>
<font color=#447700>! where the subcolumn is cloudy, the subcolumn cloud fraction is 1;<a name='2574'></font>
<font color=#447700>! where the subcolumn is not cloudy, the subcolumn cloud fraction is 0;<a name='2575'></font>
<font color=#447700>! where there is a cloud, define the subcolumn cloud properties, <a name='2576'></font>
<font color=#447700>! otherwise set these to zero<a name='2577'></font>
<a name='2578'>
      do ilev = 1,nlay<a name='2579'>
         do i = 1, ncol<a name='2580'>
            do isubcol = 1, nsubcol<a name='2581'>
               if (iscloudy(isubcol,i,ilev) ) then<a name='2582'>
                  cld_stoch(isubcol,i,ilev) = 1._rb<a name='2583'>
                  clwp_stoch(isubcol,i,ilev) = clwp(i,ilev)<a name='2584'>
                  ciwp_stoch(isubcol,i,ilev) = ciwp(i,ilev)<a name='2585'>
                  cswp_stoch(isubcol,i,ilev) = cswp(i,ilev)<a name='2586'>
                  n = ngb(isubcol)<a name='2587'>
                  tauc_stoch(isubcol,i,ilev) = tauc(n,i,ilev)<a name='2588'>
<font color=#447700>!                  ssac_stoch(isubcol,i,ilev) = ssac(n,i,ilev)<a name='2589'></font>
<font color=#447700>!                  asmc_stoch(isubcol,i,ilev) = asmc(n,i,ilev)<a name='2590'></font>
               else<a name='2591'>
                  cld_stoch(isubcol,i,ilev) = 0._rb<a name='2592'>
                  clwp_stoch(isubcol,i,ilev) = 0._rb<a name='2593'>
                  ciwp_stoch(isubcol,i,ilev) = 0._rb<a name='2594'>
                  cswp_stoch(isubcol,i,ilev) = 0._rb<a name='2595'>
                  tauc_stoch(isubcol,i,ilev) = 0._rb<a name='2596'>
<font color=#447700>!                  ssac_stoch(isubcol,i,ilev) = 1._rb<a name='2597'></font>
<font color=#447700>!                  asmc_stoch(isubcol,i,ilev) = 1._rb<a name='2598'></font>
               endif<a name='2599'>
            enddo<a name='2600'>
         enddo<a name='2601'>
      enddo<a name='2602'>
<a name='2603'>
<font color=#447700>! -- compute the means of the subcolumns ---<a name='2604'></font>
<font color=#447700>!      mean_cld_stoch(:,:) = 0._rb<a name='2605'></font>
<font color=#447700>!      mean_clwp_stoch(:,:) = 0._rb<a name='2606'></font>
<font color=#447700>!      mean_ciwp_stoch(:,:) = 0._rb<a name='2607'></font>
<font color=#447700>!      mean_tauc_stoch(:,:) = 0._rb<a name='2608'></font>
<font color=#447700>!      mean_ssac_stoch(:,:) = 0._rb<a name='2609'></font>
<font color=#447700>!      mean_asmc_stoch(:,:) = 0._rb<a name='2610'></font>
<font color=#447700>!      do i = 1, nsubcol<a name='2611'></font>
<font color=#447700>!         mean_cld_stoch(:,:) =  cld_stoch(i,:,:) + mean_cld_stoch(:,:) <a name='2612'></font>
<font color=#447700>!         mean_clwp_stoch(:,:) =  clwp_stoch( i,:,:) + mean_clwp_stoch(:,:) <a name='2613'></font>
<font color=#447700>!         mean_ciwp_stoch(:,:) =  ciwp_stoch( i,:,:) + mean_ciwp_stoch(:,:) <a name='2614'></font>
<font color=#447700>!         mean_tauc_stoch(:,:) =  tauc_stoch( i,:,:) + mean_tauc_stoch(:,:) <a name='2615'></font>
<font color=#447700>!         mean_ssac_stoch(:,:) =  ssac_stoch( i,:,:) + mean_ssac_stoch(:,:) <a name='2616'></font>
<font color=#447700>!         mean_asmc_stoch(:,:) =  asmc_stoch( i,:,:) + mean_asmc_stoch(:,:) <a name='2617'></font>
<font color=#447700>!      end do<a name='2618'></font>
<font color=#447700>!      mean_cld_stoch(:,:) = mean_cld_stoch(:,:) / nsubcol<a name='2619'></font>
<font color=#447700>!      mean_clwp_stoch(:,:) = mean_clwp_stoch(:,:) / nsubcol<a name='2620'></font>
<font color=#447700>!      mean_ciwp_stoch(:,:) = mean_ciwp_stoch(:,:) / nsubcol<a name='2621'></font>
<font color=#447700>!      mean_tauc_stoch(:,:) = mean_tauc_stoch(:,:) / nsubcol<a name='2622'></font>
<font color=#447700>!      mean_ssac_stoch(:,:) = mean_ssac_stoch(:,:) / nsubcol<a name='2623'></font>
<font color=#447700>!      mean_asmc_stoch(:,:) = mean_asmc_stoch(:,:) / nsubcol<a name='2624'></font>
<a name='2625'>
      end subroutine generate_stochastic_clouds<a name='2626'>
<a name='2627'>
<a name='2628'>
<font color=#447700>!------------------------------------------------------------------<a name='2629'></font>
<font color=#447700>! Private subroutines<a name='2630'></font>
<font color=#447700>!------------------------------------------------------------------<a name='2631'></font>
<a name='2632'>
<font color=#447700>!-------------------------------------------------------------------------------------------------- <a name='2633'></font>
<A NAME='KISSVEC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#KISSVEC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2634'>
      <font color=#993300>subroutine </font><font color=#cc0000>kissvec</font>(seed1,seed2,seed3,seed4,ran_arr) <A href='../../call_to/KISSVEC.html' TARGET='index'>12</A><a name='2635'>
<font color=#447700>!-------------------------------------------------------------------------------------------------- <a name='2636'></font>
<a name='2637'>
<font color=#447700>! public domain code<a name='2638'></font>
<font color=#447700>! made available from http://www.fortran.com/<a name='2639'></font>
<font color=#447700>! downloaded by pjr on 03/16/04 for NCAR CAM<a name='2640'></font>
<font color=#447700>! converted to vector form, functions inlined by pjr,mvr on 05/10/2004<a name='2641'></font>
<a name='2642'>
<font color=#447700>! The  KISS (Keep It Simple Stupid) random number generator. Combines:<a name='2643'></font>
<font color=#447700>! (1) The congruential generator x(n)=69069*x(n-1)+1327217885, period 2^32.<a name='2644'></font>
<font color=#447700>! (2) A 3-shift shift-register generator, period 2^32-1,<a name='2645'></font>
<font color=#447700>! (3) Two 16-bit multiply-with-carry generators, period 597273182964842497&gt;2^59<a name='2646'></font>
<font color=#447700>!  Overall period&gt;2^123; <a name='2647'></font>
<font color=#447700>!<a name='2648'></font>
      real(kind=rb), dimension(:), intent(inout)  :: ran_arr<a name='2649'>
      integer(kind=im), dimension(:), intent(inout) :: seed1,seed2,seed3,seed4<a name='2650'>
      integer(kind=im) :: i,sz,kiss<a name='2651'>
      integer(kind=im) :: m, k, n<a name='2652'>
<a name='2653'>
<font color=#447700>! inline function <a name='2654'></font>
      m(k, n) = ieor (k, ishft (k, n) )<a name='2655'>
<a name='2656'>
      sz = size(ran_arr)<a name='2657'>
      do i = 1, sz<a name='2658'>
         seed1(i) = 69069_im * seed1(i) + 1327217885_im<a name='2659'>
         seed2(i) = m (m (m (seed2(i), 13_im), - 17_im), 5_im)<a name='2660'>
         seed3(i) = 18000_im * iand (seed3(i), 65535_im) + ishft (seed3(i), - 16_im)<a name='2661'>
         seed4(i) = 30903_im * iand (seed4(i), 65535_im) + ishft (seed4(i), - 16_im)<a name='2662'>
         kiss = seed1(i) + seed2(i) + ishft (seed3(i), 16_im) + seed4(i)<a name='2663'>
         ran_arr(i) = kiss*2.328306e-10_rb + 0.5_rb<a name='2664'>
      end do<a name='2665'>
    <a name='2666'>
      end subroutine kissvec<a name='2667'>
<a name='2668'>
      end module mcica_subcol_gen_lw<a name='2669'>
<a name='2670'>
<font color=#447700>!     path:      $Source: /storm/rc1/cvsroot/rc/rrtmg_lw/src/rrtmg_lw_cldprmc.f90,v $<a name='2671'></font>
<font color=#447700>!     author:    $Author: mike $<a name='2672'></font>
<font color=#447700>!     revision:  $Revision: 1.8 $<a name='2673'></font>
<font color=#447700>!     created:   $Date: 2009/05/22 21:04:30 $<a name='2674'></font>
<font color=#447700>!<a name='2675'></font>
<A NAME='RRTMG_LW_CLDPRMC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2676'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_cldprmc</font> <A href='../../call_to/RRTMG_LW_CLDPRMC.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_CLDPRMC.html' TARGET='index'>5</A><a name='2677'>
<a name='2678'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2679'></font>
<font color=#447700>! |                                                                          |<a name='2680'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='2681'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='2682'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='2683'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='2684'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='2685'></font>
<font color=#447700>! |                                                                          |<a name='2686'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2687'></font>
<a name='2688'>
<font color=#447700>! --------- Modules ----------<a name='2689'></font>
<a name='2690'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_26">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='2691'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_3">, only : ngptlw, nbndlw<a name='2692'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CLD'>rrlw_cld</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CLD_1">, only: abscld1, absliq0, absliq1, &amp;<a name='2693'>
                          absice0, absice1, absice2, absice3<a name='2694'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_2">, only: ngb<a name='2695'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_2">, only: hvrclc, hnamclc<a name='2696'>
<a name='2697'>
      implicit none<a name='2698'>
<a name='2699'>
      contains<a name='2700'>
<a name='2701'>
<font color=#447700>! ------------------------------------------------------------------------------<a name='2702'></font>
<A NAME='CLDPRMC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CLDPRMC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2703'>
      <font color=#993300>subroutine </font><font color=#cc0000>cldprmc</font>(nlayers, inflag, iceflag, liqflag, cldfmc, &amp; <A href='../../call_to/CLDPRMC.html' TARGET='index'>1</A>,<A href='../../call_from/CLDPRMC.html' TARGET='index'>2</A><a name='2704'>
                         ciwpmc, clwpmc, cswpmc, reicmc, relqmc, resnmc, ncbands, taucmc)<a name='2705'>
<font color=#447700>! ------------------------------------------------------------------------------<a name='2706'></font>
<a name='2707'>
<font color=#447700>! Purpose:  Compute the cloud optical depth(s) for each cloudy layer.<a name='2708'></font>
<a name='2709'>
<font color=#447700>! ------- Input -------<a name='2710'></font>
<a name='2711'>
      integer(kind=im), intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='2712'></font>
      integer(kind=im), intent(in) :: inflag          <font color=#447700>! see definitions<a name='2713'></font>
      integer(kind=im), intent(in) :: iceflag         <font color=#447700>! see definitions<a name='2714'></font>
      integer(kind=im), intent(in) :: liqflag         <font color=#447700>! see definitions<a name='2715'></font>
<a name='2716'>
      real(kind=rb), intent(in) :: cldfmc(:,:)        <font color=#447700>! cloud fraction [mcica]<a name='2717'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='2718'></font>
      real(kind=rb), intent(in) :: ciwpmc(:,:)        <font color=#447700>! cloud ice water path [mcica]<a name='2719'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='2720'></font>
      real(kind=rb), intent(in) :: clwpmc(:,:)        <font color=#447700>! cloud liquid water path [mcica]<a name='2721'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='2722'></font>
      real(kind=rb), intent(in) :: cswpmc(:,:)        <font color=#447700>! cloud snow path [mcica]<a name='2723'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='2724'></font>
      real(kind=rb), intent(in) :: relqmc(:)          <font color=#447700>! liquid particle effective radius (microns)<a name='2725'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='2726'></font>
      real(kind=rb), intent(in) :: reicmc(:)          <font color=#447700>! ice particle effective radius (microns)<a name='2727'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='2728'></font>
      real(kind=rb), intent(in) :: resnmc(:)          <font color=#447700>! snow particle effective radius (microns)<a name='2729'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='2730'></font>
                                                      <font color=#447700>! specific definition of reicmc depends on setting of iceflag:<a name='2731'></font>
                                                      <font color=#447700>! iceflag = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='2732'></font>
                                                      <font color=#447700>!              r_ec must be &gt;= 10.0 microns<a name='2733'></font>
                                                      <font color=#447700>! iceflag = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='2734'></font>
                                                      <font color=#447700>!              r_ec range is limited to 13.0 to 130.0 microns<a name='2735'></font>
                                                      <font color=#447700>! iceflag = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='2736'></font>
                                                      <font color=#447700>!              r_k range is limited to 5.0 to 131.0 microns<a name='2737'></font>
                                                      <font color=#447700>! iceflag = 3: generalized effective size, dge, (Fu, 1996),<a name='2738'></font>
                                                      <font color=#447700>!              dge range is limited to 5.0 to 140.0 microns<a name='2739'></font>
                                                      <font color=#447700>!              [dge = 1.0315 * r_ec]<a name='2740'></font>
<a name='2741'>
<font color=#447700>! ------- Output -------<a name='2742'></font>
<a name='2743'>
      integer(kind=im), intent(out) :: ncbands        <font color=#447700>! number of cloud spectral bands<a name='2744'></font>
      real(kind=rb), intent(inout) :: taucmc(:,:)     <font color=#447700>! cloud optical depth [mcica]<a name='2745'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='2746'></font>
<a name='2747'>
<font color=#447700>! ------- Local -------<a name='2748'></font>
<a name='2749'>
      integer(kind=im) :: lay                         <font color=#447700>! Layer index<a name='2750'></font>
      integer(kind=im) :: ib                          <font color=#447700>! spectral band index<a name='2751'></font>
      integer(kind=im) :: ig                          <font color=#447700>! g-point interval index<a name='2752'></font>
      integer(kind=im) :: index <a name='2753'>
      integer(kind=im) :: icb(nbndlw)<a name='2754'>
<a name='2755'>
      real(kind=rb) :: abscoice(ngptlw)               <font color=#447700>! ice absorption coefficients<a name='2756'></font>
      real(kind=rb) :: abscoliq(ngptlw)               <font color=#447700>! liquid absorption coefficients<a name='2757'></font>
      real(kind=rb) :: abscosno(ngptlw)               <font color=#447700>! snow absorption coefficients<a name='2758'></font>
      real(kind=rb) :: cwp                            <font color=#447700>! cloud water path<a name='2759'></font>
      real(kind=rb) :: radice                         <font color=#447700>! cloud ice effective size (microns)<a name='2760'></font>
      real(kind=rb) :: factor                         <font color=#447700>! <a name='2761'></font>
      real(kind=rb) :: fint                           <font color=#447700>! <a name='2762'></font>
      real(kind=rb) :: radliq                         <font color=#447700>! cloud liquid droplet radius (microns)<a name='2763'></font>
      real(kind=rb) :: radsno                         <font color=#447700>! cloud snow effective size (microns)<a name='2764'></font>
      real(kind=rb), parameter :: eps = 1.e-6_rb      <font color=#447700>! epsilon<a name='2765'></font>
      real(kind=rb), parameter :: cldmin = 1.e-20_rb  <font color=#447700>! minimum value for cloud quantities<a name='2766'></font>
      character*80 errmess<a name='2767'>
<a name='2768'>
<font color=#447700>! ------- Definitions -------<a name='2769'></font>
<a name='2770'>
<font color=#447700>!     Explanation of the method for each value of INFLAG.  Values of<a name='2771'></font>
<font color=#447700>!     0 or 1 for INFLAG do not distingish being liquid and ice clouds.<a name='2772'></font>
<font color=#447700>!     INFLAG = 2 does distinguish between liquid and ice clouds, and<a name='2773'></font>
<font color=#447700>!     requires further user input to specify the method to be used to <a name='2774'></font>
<font color=#447700>!     compute the aborption due to each.<a name='2775'></font>
<font color=#447700>!     INFLAG = 0:  For each cloudy layer, the cloud fraction and (gray)<a name='2776'></font>
<font color=#447700>!                  optical depth are input.  <a name='2777'></font>
<font color=#447700>!     INFLAG = 1:  For each cloudy layer, the cloud fraction and cloud<a name='2778'></font>
<font color=#447700>!                  water path (g/m2) are input.  The (gray) cloud optical <a name='2779'></font>
<font color=#447700>!                  depth is computed as in CCM2.<a name='2780'></font>
<font color=#447700>!     INFLAG = 2:  For each cloudy layer, the cloud fraction, cloud <a name='2781'></font>
<font color=#447700>!                  water path (g/m2), and cloud ice fraction are input.<a name='2782'></font>
<font color=#447700>!       ICEFLAG = 0:  The ice effective radius (microns) is input and the<a name='2783'></font>
<font color=#447700>!                     optical depths due to ice clouds are computed as in CCM3.<a name='2784'></font>
<font color=#447700>!       ICEFLAG = 1:  The ice effective radius (microns) is input and the<a name='2785'></font>
<font color=#447700>!                     optical depths due to ice clouds are computed as in <a name='2786'></font>
<font color=#447700>!                     Ebert and Curry, JGR, 97, 3831-3836 (1992).  The <a name='2787'></font>
<font color=#447700>!                     spectral regions in this work have been matched with<a name='2788'></font>
<font color=#447700>!                     the spectral bands in RRTM to as great an extent <a name='2789'></font>
<font color=#447700>!                     as possible:  <a name='2790'></font>
<font color=#447700>!                     E&amp;C 1      IB = 5      RRTM bands 9-16<a name='2791'></font>
<font color=#447700>!                     E&amp;C 2      IB = 4      RRTM bands 6-8<a name='2792'></font>
<font color=#447700>!                     E&amp;C 3      IB = 3      RRTM bands 3-5<a name='2793'></font>
<font color=#447700>!                     E&amp;C 4      IB = 2      RRTM band 2<a name='2794'></font>
<font color=#447700>!                     E&amp;C 5      IB = 1      RRTM band 1<a name='2795'></font>
<font color=#447700>!       ICEFLAG = 2:  The ice effective radius (microns) is input and the<a name='2796'></font>
<font color=#447700>!                     optical properties due to ice clouds are computed from<a name='2797'></font>
<font color=#447700>!                     the optical properties stored in the RT code,<a name='2798'></font>
<font color=#447700>!                     STREAMER v3.0 (Reference: Key. J., Streamer <a name='2799'></font>
<font color=#447700>!                     User's Guide, Cooperative Institute for<a name='2800'></font>
<font color=#447700>!                     Meteorological Satellite Studies, 2001, 96 pp.).<a name='2801'></font>
<font color=#447700>!                     Valid range of values for re are between 5.0 and<a name='2802'></font>
<font color=#447700>!                     131.0 micron.<a name='2803'></font>
<font color=#447700>!       ICEFLAG = 3: The ice generalized effective size (dge) is input<a name='2804'></font>
<font color=#447700>!                    and the optical properties, are calculated as in<a name='2805'></font>
<font color=#447700>!                    Q. Fu, J. Climate, (1998). Q. Fu provided high resolution<a name='2806'></font>
<font color=#447700>!                    tables which were appropriately averaged for the<a name='2807'></font>
<font color=#447700>!                    bands in RRTM_LW.  Linear interpolation is used to<a name='2808'></font>
<font color=#447700>!                    get the coefficients from the stored tables.<a name='2809'></font>
<font color=#447700>!                    Valid range of values for dge are between 5.0 and<a name='2810'></font>
<font color=#447700>!                    140.0 micron.<a name='2811'></font>
<font color=#447700>!       LIQFLAG = 0:  The optical depths due to water clouds are computed as<a name='2812'></font>
<font color=#447700>!                     in CCM3.<a name='2813'></font>
<font color=#447700>!       LIQFLAG = 1:  The water droplet effective radius (microns) is input <a name='2814'></font>
<font color=#447700>!                     and the optical depths due to water clouds are computed <a name='2815'></font>
<font color=#447700>!                     as in Hu and Stamnes, J., Clim., 6, 728-742, (1993).<a name='2816'></font>
<font color=#447700>!                     The values for absorption coefficients appropriate for<a name='2817'></font>
<font color=#447700>!                     the spectral bands in RRTM have been obtained for a <a name='2818'></font>
<font color=#447700>!                     range of effective radii by an averaging procedure <a name='2819'></font>
<font color=#447700>!                     based on the work of J. Pinto (private communication).<a name='2820'></font>
<font color=#447700>!                     Linear interpolation is used to get the absorption <a name='2821'></font>
<font color=#447700>!                     coefficients for the input effective radius.<a name='2822'></font>
<a name='2823'>
      data icb /1,2,3,3,3,4,4,4,5, 5, 5, 5, 5, 5, 5, 5/<a name='2824'>
<a name='2825'>
<font color=#447700>!jm not thread safe      hvrclc = '$Revision: 1.8 $'<a name='2826'></font>
<a name='2827'>
      ncbands = 1<a name='2828'>
<a name='2829'>
<font color=#447700>! This initialization is done in rrtmg_lw_subcol.F90.<a name='2830'></font>
<font color=#447700>!      do lay = 1, nlayers<a name='2831'></font>
<font color=#447700>!         do ig = 1, ngptlw<a name='2832'></font>
<font color=#447700>!            taucmc(ig,lay) = 0.0_rb<a name='2833'></font>
<font color=#447700>!         enddo<a name='2834'></font>
<font color=#447700>!      enddo<a name='2835'></font>
<a name='2836'>
<font color=#447700>! Main layer loop<a name='2837'></font>
      do lay = 1, nlayers<a name='2838'>
<a name='2839'>
        do ig = 1, ngptlw<a name='2840'>
          cwp = ciwpmc(ig,lay) + clwpmc(ig,lay) + cswpmc(ig,lay)<a name='2841'>
          if (cldfmc(ig,lay) .ge. cldmin .and. &amp;<a name='2842'>
             (cwp .ge. cldmin .or. taucmc(ig,lay) .ge. cldmin)) then<a name='2843'>
<a name='2844'>
<font color=#447700>! Ice clouds and water clouds combined.<a name='2845'></font>
            if (inflag .eq. 0) then<a name='2846'>
<font color=#447700>! Cloud optical depth already defined in taucmc, return to main program<a name='2847'></font>
               return<a name='2848'>
<a name='2849'>
            elseif(inflag .eq. 1) then <a name='2850'>
                stop 'INFLAG = 1 OPTION NOT AVAILABLE WITH MCICA'<a name='2851'>
<font color=#447700>!               cwp = ciwpmc(ig,lay) + clwpmc(ig,lay)<a name='2852'></font>
<font color=#447700>!               taucmc(ig,lay) = abscld1 * cwp<a name='2853'></font>
<a name='2854'>
<font color=#447700>! Separate treatement of ice clouds and water clouds.<a name='2855'></font>
            elseif(inflag .ge. 2) then<a name='2856'>
               radice = reicmc(lay)<a name='2857'>
<a name='2858'>
<font color=#447700>! Calculation of absorption coefficients due to ice clouds.<a name='2859'></font>
               if ((ciwpmc(ig,lay)+cswpmc(ig,lay)) .eq. 0.0_rb) then<a name='2860'>
                  abscoice(ig) = 0.0_rb<a name='2861'>
                  abscosno(ig) = 0.0_rb<a name='2862'>
<a name='2863'>
               elseif (iceflag .eq. 0) then<a name='2864'>
                  if (radice .lt. 10.0_rb) stop 'ICE RADIUS TOO SMALL'<a name='2865'>
                  abscoice(ig) = absice0(1) + absice0(2)/radice<a name='2866'>
                  abscosno(ig) = 0.0_rb<a name='2867'>
<a name='2868'>
               elseif (iceflag .eq. 1) then<a name='2869'>
                  if (radice .lt. 13.0_rb .or. radice .gt. 130._rb) stop &amp;<a name='2870'>
                      'ICE RADIUS OUT OF BOUNDS'<a name='2871'>
                  ncbands = 5<a name='2872'>
                  ib = icb(ngb(ig))<a name='2873'>
                  abscoice(ig) = absice1(1,ib) + absice1(2,ib)/radice<a name='2874'>
                  abscosno(ig) = 0.0_rb<a name='2875'>
<a name='2876'>
<font color=#447700>! For iceflag=2 option, ice particle effective radius is limited to 5.0 to 131.0 microns<a name='2877'></font>
<a name='2878'>
               elseif (iceflag .eq. 2) then<a name='2879'>
                  if (radice .lt. 5.0_rb .or. radice .gt. 131.0_rb) stop 'ICE RADIUS OUT OF BOUNDS'<a name='2880'>
                     ncbands = 16<a name='2881'>
                     factor = (radice - 2._rb)/3._rb<a name='2882'>
                     index = int(factor)<a name='2883'>
                     if (index .eq. 43) index = 42<a name='2884'>
                     fint = factor - float(index)<a name='2885'>
                     ib = ngb(ig)<a name='2886'>
                     abscoice(ig) = &amp;<a name='2887'>
                         absice2(index,ib) + fint * &amp;<a name='2888'>
                         (absice2(index+1,ib) - (absice2(index,ib))) <a name='2889'>
                     abscosno(ig) = 0.0_rb<a name='2890'>
               <a name='2891'>
<font color=#447700>! For iceflag=3 option, ice particle generalized effective size is limited to 5.0 to 140.0 microns<a name='2892'></font>
<a name='2893'>
               elseif (iceflag .ge. 3) then<a name='2894'>
                  if (radice .lt. 5.0_rb .or. radice .gt. 140.0_rb) then<a name='2895'>
                         write(errmess,'(A,i5,i5,f8.2,f8.2)' )         &amp;<a name='2896'>
               'ERROR: ICE GENERALIZED EFFECTIVE SIZE OUT OF BOUNDS'   &amp;<a name='2897'>
               ,ig, lay, ciwpmc(ig,lay), radice<a name='2898'>
                         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1028">(errmess)<a name='2899'>
                     end if<a name='2900'>
                     ncbands = 16<a name='2901'>
                     factor = (radice - 2._rb)/3._rb<a name='2902'>
                     index = int(factor)<a name='2903'>
                     if (index .eq. 46) index = 45<a name='2904'>
                     fint = factor - float(index)<a name='2905'>
                     ib = ngb(ig)<a name='2906'>
                     abscoice(ig) = &amp;<a name='2907'>
                         absice3(index,ib) + fint * &amp;<a name='2908'>
                         (absice3(index+1,ib) - (absice3(index,ib)))<a name='2909'>
                     abscosno(ig) = 0.0_rb<a name='2910'>
   <a name='2911'>
               endif<a name='2912'>
<a name='2913'>
<font color=#447700>!..Incorporate additional effects due to snow.<a name='2914'></font>
               if (cswpmc(ig,lay).gt.0.0_rb .and. iceflag .eq. 5) then<a name='2915'>
                  radsno = resnmc(lay)<a name='2916'>
                  if (radsno .lt. 5.0_rb .or. radsno .gt. 140.0_rb) then<a name='2917'>
                         write(errmess,'(A,i5,i5,f8.2,f8.2)' )         &amp;<a name='2918'>
               'ERROR: SNOW GENERALIZED EFFECTIVE SIZE OUT OF BOUNDS'   &amp;<a name='2919'>
               ,ig, lay, cswpmc(ig,lay), radsno<a name='2920'>
                         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CLDPRMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1029">(errmess)<a name='2921'>
                     end if<a name='2922'>
                     ncbands = 16<a name='2923'>
                     factor = (radsno - 2._rb)/3._rb<a name='2924'>
                     index = int(factor)<a name='2925'>
                     if (index .eq. 46) index = 45<a name='2926'>
                     fint = factor - float(index)<a name='2927'>
                     ib = ngb(ig)<a name='2928'>
                     abscosno(ig) = &amp;<a name='2929'>
                         absice3(index,ib) + fint * &amp;<a name='2930'>
                         (absice3(index+1,ib) - (absice3(index,ib)))<a name='2931'>
               endif<a name='2932'>
<a name='2933'>
                  <a name='2934'>
<font color=#447700>! Calculation of absorption coefficients due to water clouds.<a name='2935'></font>
               if (clwpmc(ig,lay) .eq. 0.0_rb) then<a name='2936'>
                  abscoliq(ig) = 0.0_rb<a name='2937'>
<a name='2938'>
               elseif (liqflag .eq. 0) then<a name='2939'>
                   abscoliq(ig) = absliq0<a name='2940'>
<a name='2941'>
               elseif (liqflag .eq. 1) then<a name='2942'>
                  radliq = relqmc(lay)<a name='2943'>
                  if (radliq .lt. 2.5_rb .or. radliq .gt. 60._rb) stop &amp;<a name='2944'>
                       'LIQUID EFFECTIVE RADIUS OUT OF BOUNDS'<a name='2945'>
                  index = int(radliq - 1.5_rb)<a name='2946'>
                  if (index .eq. 0) index = 1<a name='2947'>
                  if (index .eq. 58) index = 57<a name='2948'>
                  fint = radliq - 1.5_rb - float(index)<a name='2949'>
                  ib = ngb(ig)<a name='2950'>
                  abscoliq(ig) = &amp;<a name='2951'>
                        absliq1(index,ib) + fint * &amp;<a name='2952'>
                        (absliq1(index+1,ib) - (absliq1(index,ib)))<a name='2953'>
               endif<a name='2954'>
<a name='2955'>
               taucmc(ig,lay) = ciwpmc(ig,lay) * abscoice(ig) + &amp;<a name='2956'>
                                clwpmc(ig,lay) * abscoliq(ig) + &amp;<a name='2957'>
                                cswpmc(ig,lay) * abscosno(ig)<a name='2958'>
<a name='2959'>
            endif<a name='2960'>
         endif<a name='2961'>
         enddo<a name='2962'>
      enddo<a name='2963'>
<a name='2964'>
      end subroutine cldprmc<a name='2965'>
<a name='2966'>
      end module rrtmg_lw_cldprmc<a name='2967'>
<a name='2968'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='2969'></font>
<font color=#447700>!     author:    $Author: trn $<a name='2970'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='2971'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='2972'></font>
<font color=#447700>!<a name='2973'></font>
<A NAME='RRTMG_LW_RTRNMC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2974'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_rtrnmc</font> <A href='../../call_to/RRTMG_LW_RTRNMC.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_RTRNMC.html' TARGET='index'>6</A><a name='2975'>
<a name='2976'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2977'></font>
<font color=#447700>! |                                                                          |<a name='2978'></font>
<font color=#447700>! |  Copyright 2002-2008, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='2979'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='2980'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='2981'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='2982'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='2983'></font>
<font color=#447700>! |                                                                          |<a name='2984'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='2985'></font>
<a name='2986'>
<font color=#447700>! --------- Modules ----------<a name='2987'></font>
<a name='2988'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_27">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='2989'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_4">, only : mg, nbndlw, ngptlw<a name='2990'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_2">, only: fluxfac, heatfac<a name='2991'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_3">, only: delwave, ngb, ngs<a name='2992'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_TBL'>rrlw_tbl</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_1">, only: tblint, bpade, tau_tbl, exp_tbl, tfn_tbl<a name='2993'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_3">, only: hvrrtc, hnamrtc<a name='2994'>
<a name='2995'>
      implicit none<a name='2996'>
<a name='2997'>
      real(kind=rb) :: wtdiff, rec_6<a name='2998'>
      real(kind=rb) :: a0(nbndlw),a1(nbndlw),a2(nbndlw)<font color=#447700>! diffusivity angle adjustment coefficients<a name='2999'></font>
<a name='3000'>
<font color=#447700>! This secant and weight corresponds to the standard diffusivity <a name='3001'></font>
<font color=#447700>! angle.  This initial value is redefined below for some bands.<a name='3002'></font>
      data wtdiff /0.5_rb/<a name='3003'>
      data rec_6 /0.166667_rb/<a name='3004'>
<a name='3005'>
<font color=#447700>! Reset diffusivity angle for Bands 2-3 and 5-9 to vary (between 1.50<a name='3006'></font>
<font color=#447700>! and 1.80) as a function of total column water vapor.  The function<a name='3007'></font>
<font color=#447700>! has been defined to minimize flux and cooling rate errors in these bands<a name='3008'></font>
<font color=#447700>! over a wide range of precipitable water values.<a name='3009'></font>
      data a0 / 1.66_rb,  1.55_rb,  1.58_rb,  1.66_rb, &amp;<a name='3010'>
                1.54_rb, 1.454_rb,  1.89_rb,  1.33_rb, &amp;<a name='3011'>
               1.668_rb,  1.66_rb,  1.66_rb,  1.66_rb, &amp;<a name='3012'>
                1.66_rb,  1.66_rb,  1.66_rb,  1.66_rb /<a name='3013'>
      data a1 / 0.00_rb,  0.25_rb,  0.22_rb,  0.00_rb, &amp;<a name='3014'>
                0.13_rb, 0.446_rb, -0.10_rb,  0.40_rb, &amp;<a name='3015'>
              -0.006_rb,  0.00_rb,  0.00_rb,  0.00_rb, &amp;<a name='3016'>
                0.00_rb,  0.00_rb,  0.00_rb,  0.00_rb /<a name='3017'>
      data a2 / 0.00_rb, -12.0_rb, -11.7_rb,  0.00_rb, &amp;<a name='3018'>
               -0.72_rb,-0.243_rb,  0.19_rb,-0.062_rb, &amp;<a name='3019'>
               0.414_rb,  0.00_rb,  0.00_rb,  0.00_rb, &amp;<a name='3020'>
                0.00_rb,  0.00_rb,  0.00_rb,  0.00_rb /<a name='3021'>
<a name='3022'>
      contains<a name='3023'>
<a name='3024'>
<font color=#447700>!-----------------------------------------------------------------------------<a name='3025'></font>
<A NAME='RTRNMC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RTRNMC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3026'>
      <font color=#993300>subroutine </font><font color=#cc0000>rtrnmc</font>(nlayers, istart, iend, iout, pz, semiss, ncbands, &amp; <A href='../../call_to/RTRNMC.html' TARGET='index'>1</A><a name='3027'>
                        cldfmc, taucmc, planklay, planklev, plankbnd, &amp;<a name='3028'>
                        pwvcm, fracs, taut, &amp;<a name='3029'>
                        totuflux, totdflux, fnet, htr, &amp;<a name='3030'>
                        totuclfl, totdclfl, fnetc, htrc ) <a name='3031'>
<font color=#447700>!-----------------------------------------------------------------------------<a name='3032'></font>
<font color=#447700>!<a name='3033'></font>
<font color=#447700>!  Original version:   E. J. Mlawer, et al. RRTM_V3.0<a name='3034'></font>
<font color=#447700>!  Revision for GCMs:  Michael J. Iacono; October, 2002<a name='3035'></font>
<font color=#447700>!  Revision for F90:  Michael J. Iacono; June, 2006<a name='3036'></font>
<font color=#447700>!<a name='3037'></font>
<font color=#447700>!  This program calculates the upward fluxes, downward fluxes, and<a name='3038'></font>
<font color=#447700>!  heating rates for an arbitrary clear or cloudy atmosphere.  The input<a name='3039'></font>
<font color=#447700>!  to this program is the atmospheric profile, all Planck function<a name='3040'></font>
<font color=#447700>!  information, and the cloud fraction by layer.  A variable diffusivity <a name='3041'></font>
<font color=#447700>!  angle (SECDIFF) is used for the angle integration.  Bands 2-3 and 5-9 <a name='3042'></font>
<font color=#447700>!  use a value for SECDIFF that varies from 1.50 to 1.80 as a function of <a name='3043'></font>
<font color=#447700>!  the column water vapor, and other bands use a value of 1.66.  The Gaussian <a name='3044'></font>
<font color=#447700>!  weight appropriate to this angle (WTDIFF=0.5) is applied here.  Note that <a name='3045'></font>
<font color=#447700>!  use of the emissivity angle for the flux integration can cause errors of <a name='3046'></font>
<font color=#447700>!  1 to 4 W/m2 within cloudy layers.  <a name='3047'></font>
<font color=#447700>!  Clouds are treated with the McICA stochastic approach and maximum-random<a name='3048'></font>
<font color=#447700>!  cloud overlap. <a name='3049'></font>
<font color=#447700>!***************************************************************************<a name='3050'></font>
<a name='3051'>
<font color=#447700>! ------- Declarations -------<a name='3052'></font>
<a name='3053'>
<font color=#447700>! ----- Input -----<a name='3054'></font>
      integer(kind=im), intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='3055'></font>
      integer(kind=im), intent(in) :: istart          <font color=#447700>! beginning band of calculation<a name='3056'></font>
      integer(kind=im), intent(in) :: iend            <font color=#447700>! ending band of calculation<a name='3057'></font>
      integer(kind=im), intent(in) :: iout            <font color=#447700>! output option flag<a name='3058'></font>
<a name='3059'>
<font color=#447700>! Atmosphere<a name='3060'></font>
      real(kind=rb), intent(in) :: pz(0:)             <font color=#447700>! level (interface) pressures (hPa, mb)<a name='3061'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3062'></font>
      real(kind=rb), intent(in) :: pwvcm              <font color=#447700>! precipitable water vapor (cm)<a name='3063'></font>
      real(kind=rb), intent(in) :: semiss(:)          <font color=#447700>! lw surface emissivity<a name='3064'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='3065'></font>
      real(kind=rb), intent(in) :: planklay(:,:)      <font color=#447700>! <a name='3066'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,nbndlw)<a name='3067'></font>
      real(kind=rb), intent(in) :: planklev(0:,:)     <font color=#447700>! <a name='3068'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers,nbndlw)<a name='3069'></font>
      real(kind=rb), intent(in) :: plankbnd(:)        <font color=#447700>! <a name='3070'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='3071'></font>
      real(kind=rb), intent(in) :: fracs(:,:)         <font color=#447700>! <a name='3072'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,ngptw)<a name='3073'></font>
      real(kind=rb), intent(in) :: taut(:,:)          <font color=#447700>! gaseous + aerosol optical depths<a name='3074'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,ngptlw)<a name='3075'></font>
<a name='3076'>
<font color=#447700>! Clouds<a name='3077'></font>
      integer(kind=im), intent(in) :: ncbands         <font color=#447700>! number of cloud spectral bands<a name='3078'></font>
      real(kind=rb), intent(in) :: cldfmc(:,:)        <font color=#447700>! layer cloud fraction [mcica]<a name='3079'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='3080'></font>
      real(kind=rb), intent(in) :: taucmc(:,:)        <font color=#447700>! layer cloud optical depth [mcica]<a name='3081'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlayers)<a name='3082'></font>
<a name='3083'>
<font color=#447700>! ----- Output -----<a name='3084'></font>
      real(kind=rb), intent(out) :: totuflux(0:)      <font color=#447700>! upward longwave flux (w/m2)<a name='3085'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3086'></font>
      real(kind=rb), intent(out) :: totdflux(0:)      <font color=#447700>! downward longwave flux (w/m2)<a name='3087'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3088'></font>
      real(kind=rb), intent(out) :: fnet(0:)          <font color=#447700>! net longwave flux (w/m2)<a name='3089'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3090'></font>
      real(kind=rb), intent(out) :: htr(0:)           <font color=#447700>! longwave heating rate (k/day)<a name='3091'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3092'></font>
      real(kind=rb), intent(out) :: totuclfl(0:)      <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='3093'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3094'></font>
      real(kind=rb), intent(out) :: totdclfl(0:)      <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='3095'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3096'></font>
      real(kind=rb), intent(out) :: fnetc(0:)         <font color=#447700>! clear sky net longwave flux (w/m2)<a name='3097'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3098'></font>
      real(kind=rb), intent(out) :: htrc(0:)          <font color=#447700>! clear sky longwave heating rate (k/day)<a name='3099'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3100'></font>
<a name='3101'>
<font color=#447700>! ----- Local -----<a name='3102'></font>
<font color=#447700>! Declarations for radiative transfer<a name='3103'></font>
      real(kind=rb) :: abscld(nlayers,ngptlw)<a name='3104'>
      real(kind=rb) :: atot(nlayers)<a name='3105'>
      real(kind=rb) :: atrans(nlayers)<a name='3106'>
      real(kind=rb) :: bbugas(nlayers)<a name='3107'>
      real(kind=rb) :: bbutot(nlayers)<a name='3108'>
      real(kind=rb) :: clrurad(0:nlayers)<a name='3109'>
      real(kind=rb) :: clrdrad(0:nlayers)<a name='3110'>
      real(kind=rb) :: efclfrac(nlayers,ngptlw)<a name='3111'>
      real(kind=rb) :: uflux(0:nlayers)<a name='3112'>
      real(kind=rb) :: dflux(0:nlayers)<a name='3113'>
      real(kind=rb) :: urad(0:nlayers)<a name='3114'>
      real(kind=rb) :: drad(0:nlayers)<a name='3115'>
      real(kind=rb) :: uclfl(0:nlayers)<a name='3116'>
      real(kind=rb) :: dclfl(0:nlayers)<a name='3117'>
      real(kind=rb) :: odcld(nlayers,ngptlw)<a name='3118'>
<a name='3119'>
<a name='3120'>
      real(kind=rb) :: secdiff(nbndlw)                 <font color=#447700>! secant of diffusivity angle<a name='3121'></font>
      real(kind=rb) :: transcld, radld, radclrd, plfrac, blay, dplankup, dplankdn<a name='3122'>
      real(kind=rb) :: odepth, odtot, odepth_rec, odtot_rec, gassrc<a name='3123'>
      real(kind=rb) :: tblind, tfactot, bbd, bbdtot, tfacgas, transc, tausfac<a name='3124'>
      real(kind=rb) :: rad0, reflect, radlu, radclru<a name='3125'>
<a name='3126'>
      integer(kind=im) :: icldlyr(nlayers)                  <font color=#447700>! flag for cloud in layer<a name='3127'></font>
      integer(kind=im) :: ibnd, ib, iband, lay, lev, l, ig  <font color=#447700>! loop indices<a name='3128'></font>
      integer(kind=im) :: igc                               <font color=#447700>! g-point interval counter<a name='3129'></font>
      integer(kind=im) :: iclddn                            <font color=#447700>! flag for cloud in down path<a name='3130'></font>
      integer(kind=im) :: ittot, itgas, itr                 <font color=#447700>! lookup table indices<a name='3131'></font>
<a name='3132'>
<font color=#447700>! ------- Definitions -------<a name='3133'></font>
<font color=#447700>! input<a name='3134'></font>
<font color=#447700>!    nlayers                      ! number of model layers<a name='3135'></font>
<font color=#447700>!    ngptlw                       ! total number of g-point subintervals<a name='3136'></font>
<font color=#447700>!    nbndlw                       ! number of longwave spectral bands<a name='3137'></font>
<font color=#447700>!    ncbands                      ! number of spectral bands for clouds<a name='3138'></font>
<font color=#447700>!    secdiff                      ! diffusivity angle<a name='3139'></font>
<font color=#447700>!    wtdiff                       ! weight for radiance to flux conversion<a name='3140'></font>
<font color=#447700>!    pavel                        ! layer pressures (mb)<a name='3141'></font>
<font color=#447700>!    pz                           ! level (interface) pressures (mb)<a name='3142'></font>
<font color=#447700>!    tavel                        ! layer temperatures (k)<a name='3143'></font>
<font color=#447700>!    tz                           ! level (interface) temperatures(mb)<a name='3144'></font>
<font color=#447700>!    tbound                       ! surface temperature (k)<a name='3145'></font>
<font color=#447700>!    cldfrac                      ! layer cloud fraction<a name='3146'></font>
<font color=#447700>!    taucloud                     ! layer cloud optical depth<a name='3147'></font>
<font color=#447700>!    itr                          ! integer look-up table index<a name='3148'></font>
<font color=#447700>!    icldlyr                      ! flag for cloudy layers<a name='3149'></font>
<font color=#447700>!    iclddn                       ! flag for cloud in column at any layer<a name='3150'></font>
<font color=#447700>!    semiss                       ! surface emissivities for each band<a name='3151'></font>
<font color=#447700>!    reflect                      ! surface reflectance<a name='3152'></font>
<font color=#447700>!    bpade                        ! 1/(pade constant)<a name='3153'></font>
<font color=#447700>!    tau_tbl                      ! clear sky optical depth look-up table<a name='3154'></font>
<font color=#447700>!    exp_tbl                      ! exponential look-up table for transmittance<a name='3155'></font>
<font color=#447700>!    tfn_tbl                      ! tau transition function look-up table<a name='3156'></font>
<a name='3157'>
<font color=#447700>! local<a name='3158'></font>
<font color=#447700>!    atrans                       ! gaseous absorptivity<a name='3159'></font>
<font color=#447700>!    abscld                       ! cloud absorptivity<a name='3160'></font>
<font color=#447700>!    atot                         ! combined gaseous and cloud absorptivity<a name='3161'></font>
<font color=#447700>!    odclr                        ! clear sky (gaseous) optical depth<a name='3162'></font>
<font color=#447700>!    odcld                        ! cloud optical depth<a name='3163'></font>
<font color=#447700>!    odtot                        ! optical depth of gas and cloud<a name='3164'></font>
<font color=#447700>!    tfacgas                      ! gas-only pade factor, used for planck fn<a name='3165'></font>
<font color=#447700>!    tfactot                      ! gas and cloud pade factor, used for planck fn<a name='3166'></font>
<font color=#447700>!    bbdgas                       ! gas-only planck function for downward rt<a name='3167'></font>
<font color=#447700>!    bbugas                       ! gas-only planck function for upward rt<a name='3168'></font>
<font color=#447700>!    bbdtot                       ! gas and cloud planck function for downward rt<a name='3169'></font>
<font color=#447700>!    bbutot                       ! gas and cloud planck function for upward calc.<a name='3170'></font>
<font color=#447700>!    gassrc                       ! source radiance due to gas only<a name='3171'></font>
<font color=#447700>!    efclfrac                     ! effective cloud fraction<a name='3172'></font>
<font color=#447700>!    radlu                        ! spectrally summed upward radiance <a name='3173'></font>
<font color=#447700>!    radclru                      ! spectrally summed clear sky upward radiance <a name='3174'></font>
<font color=#447700>!    urad                         ! upward radiance by layer<a name='3175'></font>
<font color=#447700>!    clrurad                      ! clear sky upward radiance by layer<a name='3176'></font>
<font color=#447700>!    radld                        ! spectrally summed downward radiance <a name='3177'></font>
<font color=#447700>!    radclrd                      ! spectrally summed clear sky downward radiance <a name='3178'></font>
<font color=#447700>!    drad                         ! downward radiance by layer<a name='3179'></font>
<font color=#447700>!    clrdrad                      ! clear sky downward radiance by layer<a name='3180'></font>
<a name='3181'>
<font color=#447700>! output<a name='3182'></font>
<font color=#447700>!    totuflux                     ! upward longwave flux (w/m2)<a name='3183'></font>
<font color=#447700>!    totdflux                     ! downward longwave flux (w/m2)<a name='3184'></font>
<font color=#447700>!    fnet                         ! net longwave flux (w/m2)<a name='3185'></font>
<font color=#447700>!    htr                          ! longwave heating rate (k/day)<a name='3186'></font>
<font color=#447700>!    totuclfl                     ! clear sky upward longwave flux (w/m2)<a name='3187'></font>
<font color=#447700>!    totdclfl                     ! clear sky downward longwave flux (w/m2)<a name='3188'></font>
<font color=#447700>!    fnetc                        ! clear sky net longwave flux (w/m2)<a name='3189'></font>
<font color=#447700>!    htrc                         ! clear sky longwave heating rate (k/day)<a name='3190'></font>
<a name='3191'>
<a name='3192'>
<font color=#447700>!jm not thread safe      hvrrtc = '$Revision: 1.3 $'<a name='3193'></font>
<a name='3194'>
      do ibnd = 1,nbndlw<a name='3195'>
         if (ibnd.eq.1 .or. ibnd.eq.4 .or. ibnd.ge.10) then<a name='3196'>
           secdiff(ibnd) = 1.66_rb<a name='3197'>
         else<a name='3198'>
           secdiff(ibnd) = a0(ibnd) + a1(ibnd)*exp(a2(ibnd)*pwvcm)<a name='3199'>
           if (secdiff(ibnd) .gt. 1.80_rb) secdiff(ibnd) = 1.80_rb<a name='3200'>
           if (secdiff(ibnd) .lt. 1.50_rb) secdiff(ibnd) = 1.50_rb<a name='3201'>
         endif<a name='3202'>
      enddo<a name='3203'>
<a name='3204'>
      urad(0) = 0.0_rb<a name='3205'>
      drad(0) = 0.0_rb<a name='3206'>
      totuflux(0) = 0.0_rb<a name='3207'>
      totdflux(0) = 0.0_rb<a name='3208'>
      clrurad(0) = 0.0_rb<a name='3209'>
      clrdrad(0) = 0.0_rb<a name='3210'>
      totuclfl(0) = 0.0_rb<a name='3211'>
      totdclfl(0) = 0.0_rb<a name='3212'>
<a name='3213'>
      do lay = 1, nlayers<a name='3214'>
         urad(lay) = 0.0_rb<a name='3215'>
         drad(lay) = 0.0_rb<a name='3216'>
         totuflux(lay) = 0.0_rb<a name='3217'>
         totdflux(lay) = 0.0_rb<a name='3218'>
         clrurad(lay) = 0.0_rb<a name='3219'>
         clrdrad(lay) = 0.0_rb<a name='3220'>
         totuclfl(lay) = 0.0_rb<a name='3221'>
         totdclfl(lay) = 0.0_rb<a name='3222'>
         icldlyr(lay) = 0<a name='3223'>
<a name='3224'>
<font color=#447700>! Change to band loop?<a name='3225'></font>
         do ig = 1, ngptlw<a name='3226'>
            if (cldfmc(ig,lay) .eq. 1._rb) then<a name='3227'>
               ib = ngb(ig)<a name='3228'>
               odcld(lay,ig) = secdiff(ib) * taucmc(ig,lay)<a name='3229'>
               transcld = exp(-odcld(lay,ig))<a name='3230'>
               abscld(lay,ig) = 1._rb - transcld<a name='3231'>
               efclfrac(lay,ig) = abscld(lay,ig) * cldfmc(ig,lay)<a name='3232'>
               icldlyr(lay) = 1<a name='3233'>
            else<a name='3234'>
               odcld(lay,ig) = 0.0_rb<a name='3235'>
               abscld(lay,ig) = 0.0_rb<a name='3236'>
               efclfrac(lay,ig) = 0.0_rb<a name='3237'>
            endif<a name='3238'>
         enddo<a name='3239'>
<a name='3240'>
      enddo<a name='3241'>
<a name='3242'>
      igc = 1<a name='3243'>
<font color=#447700>! Loop over frequency bands.<a name='3244'></font>
      do iband = istart, iend<a name='3245'>
<a name='3246'>
<font color=#447700>! Reinitialize g-point counter for each band if output for each band is requested.<a name='3247'></font>
         if (iout.gt.0.and.iband.ge.2) igc = ngs(iband-1)+1<a name='3248'>
<a name='3249'>
<font color=#447700>! Loop over g-channels.<a name='3250'></font>
 1000    continue<a name='3251'>
<a name='3252'>
<font color=#447700>! Radiative transfer starts here.<a name='3253'></font>
         radld = 0._rb<a name='3254'>
         radclrd = 0._rb<a name='3255'>
         iclddn = 0<a name='3256'>
<a name='3257'>
<font color=#447700>! Downward radiative transfer loop.  <a name='3258'></font>
<a name='3259'>
         do lev = nlayers, 1, -1<a name='3260'>
               plfrac = fracs(lev,igc)<a name='3261'>
               blay = planklay(lev,iband)<a name='3262'>
               dplankup = planklev(lev,iband) - blay<a name='3263'>
               dplankdn = planklev(lev-1,iband) - blay<a name='3264'>
               odepth = secdiff(iband) * taut(lev,igc)<a name='3265'>
               if (odepth .lt. 0.0_rb) odepth = 0.0_rb<a name='3266'>
<font color=#447700>!  Cloudy layer<a name='3267'></font>
               if (icldlyr(lev).eq.1) then<a name='3268'>
                  iclddn = 1<a name='3269'>
                  odtot = odepth + odcld(lev,igc)<a name='3270'>
                  if (odtot .lt. 0.06_rb) then<a name='3271'>
                     atrans(lev) = odepth - 0.5_rb*odepth*odepth<a name='3272'>
                     odepth_rec = rec_6*odepth<a name='3273'>
                     gassrc = plfrac*(blay+dplankdn*odepth_rec)*atrans(lev)<a name='3274'>
<a name='3275'>
                     atot(lev) =  odtot - 0.5_rb*odtot*odtot<a name='3276'>
                     odtot_rec = rec_6*odtot<a name='3277'>
                     bbdtot =  plfrac * (blay+dplankdn*odtot_rec)<a name='3278'>
                     bbd = plfrac*(blay+dplankdn*odepth_rec)<a name='3279'>
                     radld = radld - radld * (atrans(lev) + &amp;<a name='3280'>
                         efclfrac(lev,igc) * (1. - atrans(lev))) + &amp;<a name='3281'>
                         gassrc + cldfmc(igc,lev) * &amp;<a name='3282'>
                         (bbdtot * atot(lev) - gassrc)<a name='3283'>
                     drad(lev-1) = drad(lev-1) + radld<a name='3284'>
                  <a name='3285'>
                     bbugas(lev) =  plfrac * (blay+dplankup*odepth_rec)<a name='3286'>
                     bbutot(lev) =  plfrac * (blay+dplankup*odtot_rec)<a name='3287'>
<a name='3288'>
                  elseif (odepth .le. 0.06_rb) then<a name='3289'>
                     atrans(lev) = odepth - 0.5_rb*odepth*odepth<a name='3290'>
                     odepth_rec = rec_6*odepth<a name='3291'>
                     gassrc = plfrac*(blay+dplankdn*odepth_rec)*atrans(lev)<a name='3292'>
<a name='3293'>
                     odtot = odepth + odcld(lev,igc)<a name='3294'>
                     tblind = odtot/(bpade+odtot)<a name='3295'>
                     ittot = tblint*tblind + 0.5_rb<a name='3296'>
                     tfactot = tfn_tbl(ittot)<a name='3297'>
                     bbdtot = plfrac * (blay + tfactot*dplankdn)<a name='3298'>
                     bbd = plfrac*(blay+dplankdn*odepth_rec)<a name='3299'>
                     atot(lev) = 1. - exp_tbl(ittot)<a name='3300'>
<a name='3301'>
                     radld = radld - radld * (atrans(lev) + &amp;<a name='3302'>
                         efclfrac(lev,igc) * (1._rb - atrans(lev))) + &amp;<a name='3303'>
                         gassrc + cldfmc(igc,lev) * &amp;<a name='3304'>
                         (bbdtot * atot(lev) - gassrc)<a name='3305'>
                     drad(lev-1) = drad(lev-1) + radld<a name='3306'>
<a name='3307'>
                     bbugas(lev) = plfrac * (blay + dplankup*odepth_rec)<a name='3308'>
                     bbutot(lev) = plfrac * (blay + tfactot * dplankup)<a name='3309'>
<a name='3310'>
                  else<a name='3311'>
<a name='3312'>
                     tblind = odepth/(bpade+odepth)<a name='3313'>
                     itgas = tblint*tblind+0.5_rb<a name='3314'>
                     odepth = tau_tbl(itgas)<a name='3315'>
                     atrans(lev) = 1._rb - exp_tbl(itgas)<a name='3316'>
                     tfacgas = tfn_tbl(itgas)<a name='3317'>
                     gassrc = atrans(lev) * plfrac * (blay + tfacgas*dplankdn)<a name='3318'>
<a name='3319'>
                     odtot = odepth + odcld(lev,igc)<a name='3320'>
                     tblind = odtot/(bpade+odtot)<a name='3321'>
                     ittot = tblint*tblind + 0.5_rb<a name='3322'>
                     tfactot = tfn_tbl(ittot)<a name='3323'>
                     bbdtot = plfrac * (blay + tfactot*dplankdn)<a name='3324'>
                     bbd = plfrac*(blay+tfacgas*dplankdn)<a name='3325'>
                     atot(lev) = 1._rb - exp_tbl(ittot)<a name='3326'>
<a name='3327'>
                  radld = radld - radld * (atrans(lev) + &amp;<a name='3328'>
                    efclfrac(lev,igc) * (1._rb - atrans(lev))) + &amp;<a name='3329'>
                    gassrc + cldfmc(igc,lev) * &amp;<a name='3330'>
                    (bbdtot * atot(lev) - gassrc)<a name='3331'>
                  drad(lev-1) = drad(lev-1) + radld<a name='3332'>
                  bbugas(lev) = plfrac * (blay + tfacgas * dplankup)<a name='3333'>
                  bbutot(lev) = plfrac * (blay + tfactot * dplankup)<a name='3334'>
                  endif<a name='3335'>
<font color=#447700>!  Clear layer<a name='3336'></font>
               else<a name='3337'>
                  if (odepth .le. 0.06_rb) then<a name='3338'>
                     atrans(lev) = odepth-0.5_rb*odepth*odepth<a name='3339'>
                     odepth = rec_6*odepth<a name='3340'>
                     bbd = plfrac*(blay+dplankdn*odepth)<a name='3341'>
                     bbugas(lev) = plfrac*(blay+dplankup*odepth)<a name='3342'>
                  else<a name='3343'>
                     tblind = odepth/(bpade+odepth)<a name='3344'>
                     itr = tblint*tblind+0.5_rb<a name='3345'>
                     transc = exp_tbl(itr)<a name='3346'>
                     atrans(lev) = 1._rb-transc<a name='3347'>
                     tausfac = tfn_tbl(itr)<a name='3348'>
                     bbd = plfrac*(blay+tausfac*dplankdn)<a name='3349'>
                     bbugas(lev) = plfrac * (blay + tausfac * dplankup)<a name='3350'>
                  endif   <a name='3351'>
                  radld = radld + (bbd-radld)*atrans(lev)<a name='3352'>
                  drad(lev-1) = drad(lev-1) + radld<a name='3353'>
               endif<a name='3354'>
<font color=#447700>!  Set clear sky stream to total sky stream as long as layers<a name='3355'></font>
<font color=#447700>!  remain clear.  Streams diverge when a cloud is reached (iclddn=1),<a name='3356'></font>
<font color=#447700>!  and clear sky stream must be computed separately from that point.<a name='3357'></font>
                  if (iclddn.eq.1) then<a name='3358'>
                     radclrd = radclrd + (bbd-radclrd) * atrans(lev) <a name='3359'>
                     clrdrad(lev-1) = clrdrad(lev-1) + radclrd<a name='3360'>
                  else<a name='3361'>
                     radclrd = radld<a name='3362'>
                     clrdrad(lev-1) = drad(lev-1)<a name='3363'>
                  endif<a name='3364'>
            enddo<a name='3365'>
<a name='3366'>
<font color=#447700>! Spectral emissivity &amp; reflectance<a name='3367'></font>
<font color=#447700>!  Include the contribution of spectrally varying longwave emissivity<a name='3368'></font>
<font color=#447700>!  and reflection from the surface to the upward radiative transfer.<a name='3369'></font>
<font color=#447700>!  Note: Spectral and Lambertian reflection are identical for the<a name='3370'></font>
<font color=#447700>!  diffusivity angle flux integration used here.<a name='3371'></font>
<a name='3372'>
         rad0 = fracs(1,igc) * plankbnd(iband)<a name='3373'>
<font color=#447700>!  Add in specular reflection of surface downward radiance.<a name='3374'></font>
         reflect = 1._rb - semiss(iband)<a name='3375'>
         radlu = rad0 + reflect * radld<a name='3376'>
         radclru = rad0 + reflect * radclrd<a name='3377'>
<a name='3378'>
<a name='3379'>
<font color=#447700>! Upward radiative transfer loop.<a name='3380'></font>
         urad(0) = urad(0) + radlu<a name='3381'>
         clrurad(0) = clrurad(0) + radclru<a name='3382'>
<a name='3383'>
         do lev = 1, nlayers<a name='3384'>
<font color=#447700>!  Cloudy layer<a name='3385'></font>
            if (icldlyr(lev) .eq. 1) then<a name='3386'>
               gassrc = bbugas(lev) * atrans(lev)<a name='3387'>
               radlu = radlu - radlu * (atrans(lev) + &amp;<a name='3388'>
                   efclfrac(lev,igc) * (1._rb - atrans(lev))) + &amp;<a name='3389'>
                   gassrc + cldfmc(igc,lev) * &amp;<a name='3390'>
                   (bbutot(lev) * atot(lev) - gassrc)<a name='3391'>
               urad(lev) = urad(lev) + radlu<a name='3392'>
<font color=#447700>!  Clear layer<a name='3393'></font>
            else<a name='3394'>
               radlu = radlu + (bbugas(lev)-radlu)*atrans(lev)<a name='3395'>
               urad(lev) = urad(lev) + radlu<a name='3396'>
            endif<a name='3397'>
<font color=#447700>!  Set clear sky stream to total sky stream as long as all layers<a name='3398'></font>
<font color=#447700>!  are clear (iclddn=0).  Streams must be calculated separately at <a name='3399'></font>
<font color=#447700>!  all layers when a cloud is present (ICLDDN=1), because surface <a name='3400'></font>
<font color=#447700>!  reflectance is different for each stream.<a name='3401'></font>
               if (iclddn.eq.1) then<a name='3402'>
                  radclru = radclru + (bbugas(lev)-radclru)*atrans(lev) <a name='3403'>
                  clrurad(lev) = clrurad(lev) + radclru<a name='3404'>
               else<a name='3405'>
                  radclru = radlu<a name='3406'>
                  clrurad(lev) = urad(lev)<a name='3407'>
               endif<a name='3408'>
         enddo<a name='3409'>
<a name='3410'>
<font color=#447700>! Increment g-point counter<a name='3411'></font>
         igc = igc + 1<a name='3412'>
<font color=#447700>! Return to continue radiative transfer for all g-channels in present band<a name='3413'></font>
         if (igc .le. ngs(iband)) go to 1000<a name='3414'>
<a name='3415'>
<font color=#447700>! Process longwave output from band for total and clear streams.<a name='3416'></font>
<font color=#447700>! Calculate upward, downward, and net flux.<a name='3417'></font>
         do lev = nlayers, 0, -1<a name='3418'>
            uflux(lev) = urad(lev)*wtdiff<a name='3419'>
            dflux(lev) = drad(lev)*wtdiff<a name='3420'>
            urad(lev) = 0.0_rb<a name='3421'>
            drad(lev) = 0.0_rb<a name='3422'>
            totuflux(lev) = totuflux(lev) + uflux(lev) * delwave(iband)<a name='3423'>
            totdflux(lev) = totdflux(lev) + dflux(lev) * delwave(iband)<a name='3424'>
            uclfl(lev) = clrurad(lev)*wtdiff<a name='3425'>
            dclfl(lev) = clrdrad(lev)*wtdiff<a name='3426'>
            clrurad(lev) = 0.0_rb<a name='3427'>
            clrdrad(lev) = 0.0_rb<a name='3428'>
            totuclfl(lev) = totuclfl(lev) + uclfl(lev) * delwave(iband)<a name='3429'>
            totdclfl(lev) = totdclfl(lev) + dclfl(lev) * delwave(iband)<a name='3430'>
         enddo<a name='3431'>
<a name='3432'>
<font color=#447700>! End spectral band loop<a name='3433'></font>
      enddo<a name='3434'>
<a name='3435'>
<font color=#447700>! Calculate fluxes at surface<a name='3436'></font>
      totuflux(0) = totuflux(0) * fluxfac<a name='3437'>
      totdflux(0) = totdflux(0) * fluxfac<a name='3438'>
      fnet(0) = totuflux(0) - totdflux(0)<a name='3439'>
      totuclfl(0) = totuclfl(0) * fluxfac<a name='3440'>
      totdclfl(0) = totdclfl(0) * fluxfac<a name='3441'>
      fnetc(0) = totuclfl(0) - totdclfl(0)<a name='3442'>
<a name='3443'>
<font color=#447700>! Calculate fluxes at model levels<a name='3444'></font>
      do lev = 1, nlayers<a name='3445'>
         totuflux(lev) = totuflux(lev) * fluxfac<a name='3446'>
         totdflux(lev) = totdflux(lev) * fluxfac<a name='3447'>
         fnet(lev) = totuflux(lev) - totdflux(lev)<a name='3448'>
         totuclfl(lev) = totuclfl(lev) * fluxfac<a name='3449'>
         totdclfl(lev) = totdclfl(lev) * fluxfac<a name='3450'>
         fnetc(lev) = totuclfl(lev) - totdclfl(lev)<a name='3451'>
         l = lev - 1<a name='3452'>
<a name='3453'>
<font color=#447700>! Calculate heating rates at model layers<a name='3454'></font>
         htr(l)=heatfac*(fnet(l)-fnet(lev))/(pz(l)-pz(lev)) <a name='3455'>
         htrc(l)=heatfac*(fnetc(l)-fnetc(lev))/(pz(l)-pz(lev)) <a name='3456'>
      enddo<a name='3457'>
<a name='3458'>
<font color=#447700>! Set heating rate to zero in top layer<a name='3459'></font>
      htr(nlayers) = 0.0_rb<a name='3460'>
      htrc(nlayers) = 0.0_rb<a name='3461'>
<a name='3462'>
      end subroutine rtrnmc<a name='3463'>
<a name='3464'>
      end module rrtmg_lw_rtrnmc<a name='3465'>
<a name='3466'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='3467'></font>
<font color=#447700>!     author:    $Author: trn $<a name='3468'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='3469'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='3470'></font>
<font color=#447700>!<a name='3471'></font>
<A NAME='RRTMG_LW_SETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='3472'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_setcoef</font> <A href='../../call_to/RRTMG_LW_SETCOEF.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LW_SETCOEF.html' TARGET='index'>5</A><a name='3473'>
<a name='3474'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='3475'></font>
<font color=#447700>! |                                                                          |<a name='3476'></font>
<font color=#447700>! |  Copyright 2002-2008, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='3477'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='3478'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='3479'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='3480'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='3481'></font>
<font color=#447700>! |                                                                          |<a name='3482'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='3483'></font>
<a name='3484'>
<font color=#447700>! ------- Modules -------<a name='3485'></font>
<a name='3486'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_28">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='3487'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_5">, only : nbndlw, mg, maxxsec, mxmol<a name='3488'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_4">, only: totplnk, totplk16<a name='3489'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_1"><a name='3490'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_4">, only: hvrset, hnamset<a name='3491'>
<a name='3492'>
      implicit none<a name='3493'>
<a name='3494'>
      contains<a name='3495'>
<a name='3496'>
<font color=#447700>!----------------------------------------------------------------------------<a name='3497'></font>
<A NAME='SETCOEF'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#SETCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3498'>
      <font color=#993300>subroutine </font><font color=#cc0000>setcoef</font>(nlayers, istart, pavel, tavel, tz, tbound, semiss, &amp; <A href='../../call_to/SETCOEF.html' TARGET='index'>2</A><a name='3499'>
                         coldry, wkl, wbroad, &amp;<a name='3500'>
                         laytrop, jp, jt, jt1, planklay, planklev, plankbnd, &amp;<a name='3501'>
                         colh2o, colco2, colo3, coln2o, colco, colch4, colo2, &amp;<a name='3502'>
                         colbrd, fac00, fac01, fac10, fac11, &amp;<a name='3503'>
                         rat_h2oco2, rat_h2oco2_1, rat_h2oo3, rat_h2oo3_1, &amp;<a name='3504'>
                         rat_h2on2o, rat_h2on2o_1, rat_h2och4, rat_h2och4_1, &amp;<a name='3505'>
                         rat_n2oco2, rat_n2oco2_1, rat_o3co2, rat_o3co2_1, &amp;<a name='3506'>
                         selffac, selffrac, indself, forfac, forfrac, indfor, &amp;<a name='3507'>
                         minorfrac, scaleminor, scaleminorn2, indminor)<a name='3508'>
<font color=#447700>!----------------------------------------------------------------------------<a name='3509'></font>
<font color=#447700>!<a name='3510'></font>
<font color=#447700>!  Purpose:  For a given atmosphere, calculate the indices and<a name='3511'></font>
<font color=#447700>!  fractions related to the pressure and temperature interpolations.<a name='3512'></font>
<font color=#447700>!  Also calculate the values of the integrated Planck functions <a name='3513'></font>
<font color=#447700>!  for each band at the level and layer temperatures.<a name='3514'></font>
<a name='3515'>
<font color=#447700>! ------- Declarations -------<a name='3516'></font>
<a name='3517'>
<font color=#447700>! ----- Input -----<a name='3518'></font>
      integer(kind=im), intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='3519'></font>
      integer(kind=im), intent(in) :: istart          <font color=#447700>! beginning band of calculation<a name='3520'></font>
<a name='3521'>
      real(kind=rb), intent(in) :: pavel(:)           <font color=#447700>! layer pressures (mb) <a name='3522'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3523'></font>
      real(kind=rb), intent(in) :: tavel(:)           <font color=#447700>! layer temperatures (K)<a name='3524'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3525'></font>
      real(kind=rb), intent(in) :: tz(0:)             <font color=#447700>! level (interface) temperatures (K)<a name='3526'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers)<a name='3527'></font>
      real(kind=rb), intent(in) :: tbound             <font color=#447700>! surface temperature (K)<a name='3528'></font>
      real(kind=rb), intent(in) :: coldry(:)          <font color=#447700>! dry air column density (mol/cm2)<a name='3529'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3530'></font>
      real(kind=rb), intent(in) :: wbroad(:)          <font color=#447700>! broadening gas column density (mol/cm2)<a name='3531'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3532'></font>
      real(kind=rb), intent(in) :: wkl(:,:)           <font color=#447700>! molecular amounts (mol/cm-2)<a name='3533'></font>
                                                      <font color=#447700>!    Dimensions: (mxmol,nlayers)<a name='3534'></font>
      real(kind=rb), intent(in) :: semiss(:)          <font color=#447700>! lw surface emissivity<a name='3535'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='3536'></font>
<a name='3537'>
<font color=#447700>! ----- Output -----<a name='3538'></font>
      integer(kind=im), intent(out) :: laytrop        <font color=#447700>! tropopause layer index<a name='3539'></font>
      integer(kind=im), intent(out) :: jp(:)          <font color=#447700>! <a name='3540'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3541'></font>
      integer(kind=im), intent(out) :: jt(:)          <font color=#447700>!<a name='3542'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3543'></font>
      integer(kind=im), intent(out) :: jt1(:)         <font color=#447700>!<a name='3544'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3545'></font>
      real(kind=rb), intent(out) :: planklay(:,:)     <font color=#447700>! <a name='3546'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,nbndlw)<a name='3547'></font>
      real(kind=rb), intent(out) :: planklev(0:,:)    <font color=#447700>! <a name='3548'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlayers,nbndlw)<a name='3549'></font>
      real(kind=rb), intent(out) :: plankbnd(:)       <font color=#447700>! <a name='3550'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='3551'></font>
<a name='3552'>
      real(kind=rb), intent(out) :: colh2o(:)         <font color=#447700>! column amount (h2o)<a name='3553'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3554'></font>
      real(kind=rb), intent(out) :: colco2(:)         <font color=#447700>! column amount (co2)<a name='3555'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3556'></font>
      real(kind=rb), intent(out) :: colo3(:)          <font color=#447700>! column amount (o3)<a name='3557'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3558'></font>
      real(kind=rb), intent(out) :: coln2o(:)         <font color=#447700>! column amount (n2o)<a name='3559'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3560'></font>
      real(kind=rb), intent(out) :: colco(:)          <font color=#447700>! column amount (co)<a name='3561'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3562'></font>
      real(kind=rb), intent(out) :: colch4(:)         <font color=#447700>! column amount (ch4)<a name='3563'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3564'></font>
      real(kind=rb), intent(out) :: colo2(:)          <font color=#447700>! column amount (o2)<a name='3565'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3566'></font>
      real(kind=rb), intent(out) :: colbrd(:)         <font color=#447700>! column amount (broadening gases)<a name='3567'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3568'></font>
<a name='3569'>
      integer(kind=im), intent(out) :: indself(:)<a name='3570'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3571'></font>
      integer(kind=im), intent(out) :: indfor(:)<a name='3572'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3573'></font>
      real(kind=rb), intent(out) :: selffac(:)<a name='3574'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3575'></font>
      real(kind=rb), intent(out) :: selffrac(:)<a name='3576'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3577'></font>
      real(kind=rb), intent(out) :: forfac(:)<a name='3578'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3579'></font>
      real(kind=rb), intent(out) :: forfrac(:)<a name='3580'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3581'></font>
<a name='3582'>
      integer(kind=im), intent(out) :: indminor(:)<a name='3583'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3584'></font>
      real(kind=rb), intent(out) :: minorfrac(:)<a name='3585'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3586'></font>
      real(kind=rb), intent(out) :: scaleminor(:)<a name='3587'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3588'></font>
      real(kind=rb), intent(out) :: scaleminorn2(:)<a name='3589'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='3590'></font>
<a name='3591'>
      real(kind=rb), intent(out) :: &amp;                 <font color=#447700>!<a name='3592'></font>
                       fac00(:), fac01(:), &amp;          <font color=#447700>!    Dimensions: (nlayers)<a name='3593'></font>
                       fac10(:), fac11(:) <a name='3594'>
                                                        <a name='3595'>
      real(kind=rb), intent(out) :: &amp;                 <font color=#447700>!<a name='3596'></font>
                       rat_h2oco2(:),rat_h2oco2_1(:), &amp;<a name='3597'>
                       rat_h2oo3(:),rat_h2oo3_1(:), &amp; <font color=#447700>!    Dimensions: (nlayers)<a name='3598'></font>
                       rat_h2on2o(:),rat_h2on2o_1(:), &amp;<a name='3599'>
                       rat_h2och4(:),rat_h2och4_1(:), &amp;<a name='3600'>
                       rat_n2oco2(:),rat_n2oco2_1(:), &amp;<a name='3601'>
                       rat_o3co2(:),rat_o3co2_1(:)<a name='3602'>
                                                        <a name='3603'>
<a name='3604'>
<font color=#447700>! ----- Local -----<a name='3605'></font>
      integer(kind=im) :: indbound, indlev0<a name='3606'>
      integer(kind=im) :: lay, indlay, indlev, iband<a name='3607'>
      integer(kind=im) :: jp1<a name='3608'>
      real(kind=rb) :: stpfac, tbndfrac, t0frac, tlayfrac, tlevfrac<a name='3609'>
      real(kind=rb) :: dbdtlev, dbdtlay<a name='3610'>
      real(kind=rb) :: plog, fp, ft, ft1, water, scalefac, factor, compfp<a name='3611'>
<a name='3612'>
<a name='3613'>
<font color=#447700>!jm not thread safe      hvrset = '$Revision: 1.3 $'<a name='3614'></font>
<a name='3615'>
      stpfac = 296._rb/1013._rb<a name='3616'>
<a name='3617'>
      indbound = tbound - 159._rb<a name='3618'>
      if (indbound .lt. 1) then<a name='3619'>
         indbound = 1<a name='3620'>
      elseif (indbound .gt. 180) then<a name='3621'>
         indbound = 180<a name='3622'>
      endif<a name='3623'>
      tbndfrac = tbound - 159._rb - float(indbound)<a name='3624'>
      indlev0 = tz(0) - 159._rb<a name='3625'>
      if (indlev0 .lt. 1) then<a name='3626'>
         indlev0 = 1<a name='3627'>
      elseif (indlev0 .gt. 180) then<a name='3628'>
         indlev0 = 180<a name='3629'>
      endif<a name='3630'>
      t0frac = tz(0) - 159._rb - float(indlev0)<a name='3631'>
      laytrop = 0<a name='3632'>
<a name='3633'>
<font color=#447700>! Begin layer loop <a name='3634'></font>
<font color=#447700>!  Calculate the integrated Planck functions for each band at the<a name='3635'></font>
<font color=#447700>!  surface, level, and layer temperatures.<a name='3636'></font>
      do lay = 1, nlayers<a name='3637'>
         indlay = tavel(lay) - 159._rb<a name='3638'>
         if (indlay .lt. 1) then<a name='3639'>
            indlay = 1<a name='3640'>
         elseif (indlay .gt. 180) then<a name='3641'>
            indlay = 180<a name='3642'>
         endif<a name='3643'>
         tlayfrac = tavel(lay) - 159._rb - float(indlay)<a name='3644'>
         indlev = tz(lay) - 159._rb<a name='3645'>
         if (indlev .lt. 1) then<a name='3646'>
            indlev = 1<a name='3647'>
         elseif (indlev .gt. 180) then<a name='3648'>
            indlev = 180<a name='3649'>
         endif<a name='3650'>
         tlevfrac = tz(lay) - 159._rb - float(indlev)<a name='3651'>
<a name='3652'>
<font color=#447700>! Begin spectral band loop <a name='3653'></font>
         do iband = 1, 15<a name='3654'>
            if (lay.eq.1) then<a name='3655'>
               dbdtlev = totplnk(indbound+1,iband) - totplnk(indbound,iband)<a name='3656'>
               plankbnd(iband) = semiss(iband) * &amp;<a name='3657'>
                   (totplnk(indbound,iband) + tbndfrac * dbdtlev)<a name='3658'>
               dbdtlev = totplnk(indlev0+1,iband)-totplnk(indlev0,iband)<a name='3659'>
               planklev(0,iband) = totplnk(indlev0,iband) + t0frac * dbdtlev<a name='3660'>
            endif<a name='3661'>
            dbdtlev = totplnk(indlev+1,iband) - totplnk(indlev,iband)<a name='3662'>
            dbdtlay = totplnk(indlay+1,iband) - totplnk(indlay,iband)<a name='3663'>
            planklay(lay,iband) = totplnk(indlay,iband) + tlayfrac * dbdtlay<a name='3664'>
            planklev(lay,iband) = totplnk(indlev,iband) + tlevfrac * dbdtlev<a name='3665'>
         enddo<a name='3666'>
<a name='3667'>
<font color=#447700>!  For band 16, if radiative transfer will be performed on just<a name='3668'></font>
<font color=#447700>!  this band, use integrated Planck values up to 3250 cm-1.  <a name='3669'></font>
<font color=#447700>!  If radiative transfer will be performed across all 16 bands,<a name='3670'></font>
<font color=#447700>!  then include in the integrated Planck values for this band<a name='3671'></font>
<font color=#447700>!  contributions from 2600 cm-1 to infinity.<a name='3672'></font>
         iband = 16<a name='3673'>
         if (istart .eq. 16) then<a name='3674'>
            if (lay.eq.1) then<a name='3675'>
               dbdtlev = totplk16(indbound+1) - totplk16(indbound)<a name='3676'>
               plankbnd(iband) = semiss(iband) * &amp;<a name='3677'>
                    (totplk16(indbound) + tbndfrac * dbdtlev)<a name='3678'>
               dbdtlev = totplnk(indlev0+1,iband)-totplnk(indlev0,iband)<a name='3679'>
               planklev(0,iband) = totplk16(indlev0) + &amp;<a name='3680'>
                    t0frac * dbdtlev<a name='3681'>
            endif<a name='3682'>
            dbdtlev = totplk16(indlev+1) - totplk16(indlev)<a name='3683'>
            dbdtlay = totplk16(indlay+1) - totplk16(indlay)<a name='3684'>
            planklay(lay,iband) = totplk16(indlay) + tlayfrac * dbdtlay<a name='3685'>
            planklev(lay,iband) = totplk16(indlev) + tlevfrac * dbdtlev<a name='3686'>
         else<a name='3687'>
            if (lay.eq.1) then<a name='3688'>
               dbdtlev = totplnk(indbound+1,iband) - totplnk(indbound,iband)<a name='3689'>
               plankbnd(iband) = semiss(iband) * &amp;<a name='3690'>
                    (totplnk(indbound,iband) + tbndfrac * dbdtlev)<a name='3691'>
               dbdtlev = totplnk(indlev0+1,iband)-totplnk(indlev0,iband)<a name='3692'>
               planklev(0,iband) = totplnk(indlev0,iband) + t0frac * dbdtlev<a name='3693'>
            endif<a name='3694'>
            dbdtlev = totplnk(indlev+1,iband) - totplnk(indlev,iband)<a name='3695'>
            dbdtlay = totplnk(indlay+1,iband) - totplnk(indlay,iband)<a name='3696'>
            planklay(lay,iband) = totplnk(indlay,iband) + tlayfrac * dbdtlay<a name='3697'>
            planklev(lay,iband) = totplnk(indlev,iband) + tlevfrac * dbdtlev<a name='3698'>
         endif<a name='3699'>
<a name='3700'>
<font color=#447700>!  Find the two reference pressures on either side of the<a name='3701'></font>
<font color=#447700>!  layer pressure.  Store them in JP and JP1.  Store in FP the<a name='3702'></font>
<font color=#447700>!  fraction of the difference (in ln(pressure)) between these<a name='3703'></font>
<font color=#447700>!  two values that the layer pressure lies.<a name='3704'></font>
         plog = log(pavel(lay))<a name='3705'>
<font color=#447700>!         plog = dlog(pavel(lay))<a name='3706'></font>
         jp(lay) = int(36._rb - 5*(plog+0.04_rb))<a name='3707'>
         if (jp(lay) .lt. 1) then<a name='3708'>
            jp(lay) = 1<a name='3709'>
         elseif (jp(lay) .gt. 58) then<a name='3710'>
            jp(lay) = 58<a name='3711'>
         endif<a name='3712'>
         jp1 = jp(lay) + 1<a name='3713'>
         fp = 5._rb *(preflog(jp(lay)) - plog)<a name='3714'>
<a name='3715'>
<font color=#447700>!  Determine, for each reference pressure (JP and JP1), which<a name='3716'></font>
<font color=#447700>!  reference temperature (these are different for each  <a name='3717'></font>
<font color=#447700>!  reference pressure) is nearest the layer temperature but does<a name='3718'></font>
<font color=#447700>!  not exceed it.  Store these indices in JT and JT1, resp.<a name='3719'></font>
<font color=#447700>!  Store in FT (resp. FT1) the fraction of the way between JT<a name='3720'></font>
<font color=#447700>!  (JT1) and the next highest reference temperature that the <a name='3721'></font>
<font color=#447700>!  layer temperature falls.<a name='3722'></font>
         jt(lay) = int(3._rb + (tavel(lay)-tref(jp(lay)))/15._rb)<a name='3723'>
         if (jt(lay) .lt. 1) then<a name='3724'>
            jt(lay) = 1<a name='3725'>
         elseif (jt(lay) .gt. 4) then<a name='3726'>
            jt(lay) = 4<a name='3727'>
         endif<a name='3728'>
         ft = ((tavel(lay)-tref(jp(lay)))/15._rb) - float(jt(lay)-3)<a name='3729'>
         jt1(lay) = int(3._rb + (tavel(lay)-tref(jp1))/15._rb)<a name='3730'>
         if (jt1(lay) .lt. 1) then<a name='3731'>
            jt1(lay) = 1<a name='3732'>
         elseif (jt1(lay) .gt. 4) then<a name='3733'>
            jt1(lay) = 4<a name='3734'>
         endif<a name='3735'>
         ft1 = ((tavel(lay)-tref(jp1))/15._rb) - float(jt1(lay)-3)<a name='3736'>
         water = wkl(1,lay)/coldry(lay)<a name='3737'>
         scalefac = pavel(lay) * stpfac / tavel(lay)<a name='3738'>
<a name='3739'>
<font color=#447700>!  If the pressure is less than ~100mb, perform a different<a name='3740'></font>
<font color=#447700>!  set of species interpolations.<a name='3741'></font>
         if (plog .le. 4.56_rb) go to 5300<a name='3742'>
         laytrop =  laytrop + 1<a name='3743'>
<a name='3744'>
         forfac(lay) = scalefac / (1.+water)<a name='3745'>
         factor = (332.0_rb-tavel(lay))/36.0_rb<a name='3746'>
         indfor(lay) = min(2, max(1, int(factor)))<a name='3747'>
         forfrac(lay) = factor - float(indfor(lay))<a name='3748'>
<a name='3749'>
<font color=#447700>!  Set up factors needed to separately include the water vapor<a name='3750'></font>
<font color=#447700>!  self-continuum in the calculation of absorption coefficient.<a name='3751'></font>
         selffac(lay) = water * forfac(lay)<a name='3752'>
         factor = (tavel(lay)-188.0_rb)/7.2_rb<a name='3753'>
         indself(lay) = min(9, max(1, int(factor)-7))<a name='3754'>
         selffrac(lay) = factor - float(indself(lay) + 7)<a name='3755'>
<a name='3756'>
<font color=#447700>!  Set up factors needed to separately include the minor gases<a name='3757'></font>
<font color=#447700>!  in the calculation of absorption coefficient<a name='3758'></font>
         scaleminor(lay) = pavel(lay)/tavel(lay)<a name='3759'>
         scaleminorn2(lay) = (pavel(lay)/tavel(lay)) &amp;<a name='3760'>
             *(wbroad(lay)/(coldry(lay)+wkl(1,lay)))<a name='3761'>
         factor = (tavel(lay)-180.8_rb)/7.2_rb<a name='3762'>
         indminor(lay) = min(18, max(1, int(factor)))<a name='3763'>
         minorfrac(lay) = factor - float(indminor(lay))<a name='3764'>
<a name='3765'>
<font color=#447700>!  Setup reference ratio to be used in calculation of binary<a name='3766'></font>
<font color=#447700>!  species parameter in lower atmosphere.<a name='3767'></font>
         rat_h2oco2(lay)=chi_mls(1,jp(lay))/chi_mls(2,jp(lay))<a name='3768'>
         rat_h2oco2_1(lay)=chi_mls(1,jp(lay)+1)/chi_mls(2,jp(lay)+1)<a name='3769'>
<a name='3770'>
         rat_h2oo3(lay)=chi_mls(1,jp(lay))/chi_mls(3,jp(lay))<a name='3771'>
         rat_h2oo3_1(lay)=chi_mls(1,jp(lay)+1)/chi_mls(3,jp(lay)+1)<a name='3772'>
<a name='3773'>
         rat_h2on2o(lay)=chi_mls(1,jp(lay))/chi_mls(4,jp(lay))<a name='3774'>
         rat_h2on2o_1(lay)=chi_mls(1,jp(lay)+1)/chi_mls(4,jp(lay)+1)<a name='3775'>
<a name='3776'>
         rat_h2och4(lay)=chi_mls(1,jp(lay))/chi_mls(6,jp(lay))<a name='3777'>
         rat_h2och4_1(lay)=chi_mls(1,jp(lay)+1)/chi_mls(6,jp(lay)+1)<a name='3778'>
<a name='3779'>
         rat_n2oco2(lay)=chi_mls(4,jp(lay))/chi_mls(2,jp(lay))<a name='3780'>
         rat_n2oco2_1(lay)=chi_mls(4,jp(lay)+1)/chi_mls(2,jp(lay)+1)<a name='3781'>
<a name='3782'>
<font color=#447700>!  Calculate needed column amounts.<a name='3783'></font>
         colh2o(lay) = 1.e-20_rb * wkl(1,lay)<a name='3784'>
         colco2(lay) = 1.e-20_rb * wkl(2,lay)<a name='3785'>
         colo3(lay) = 1.e-20_rb * wkl(3,lay)<a name='3786'>
         coln2o(lay) = 1.e-20_rb * wkl(4,lay)<a name='3787'>
         colco(lay) = 1.e-20_rb * wkl(5,lay)<a name='3788'>
         colch4(lay) = 1.e-20_rb * wkl(6,lay)<a name='3789'>
         colo2(lay) = 1.e-20_rb * wkl(7,lay)<a name='3790'>
         if (colco2(lay) .eq. 0._rb) colco2(lay) = 1.e-32_rb * coldry(lay)<a name='3791'>
         if (colo3(lay) .eq. 0._rb) colo3(lay) = 1.e-32_rb * coldry(lay)<a name='3792'>
         if (coln2o(lay) .eq. 0._rb) coln2o(lay) = 1.e-32_rb * coldry(lay)<a name='3793'>
         if (colco(lay) .eq. 0._rb) colco(lay) = 1.e-32_rb * coldry(lay)<a name='3794'>
         if (colch4(lay) .eq. 0._rb) colch4(lay) = 1.e-32_rb * coldry(lay)<a name='3795'>
         colbrd(lay) = 1.e-20_rb * wbroad(lay)<a name='3796'>
         go to 5400<a name='3797'>
<a name='3798'>
<font color=#447700>!  Above laytrop.<a name='3799'></font>
 5300    continue<a name='3800'>
<a name='3801'>
         forfac(lay) = scalefac / (1.+water)<a name='3802'>
         factor = (tavel(lay)-188.0_rb)/36.0_rb<a name='3803'>
         indfor(lay) = 3<a name='3804'>
         forfrac(lay) = factor - 1.0_rb<a name='3805'>
<a name='3806'>
<font color=#447700>!  Set up factors needed to separately include the water vapor<a name='3807'></font>
<font color=#447700>!  self-continuum in the calculation of absorption coefficient.<a name='3808'></font>
         selffac(lay) = water * forfac(lay)<a name='3809'>
<a name='3810'>
<font color=#447700>!  Set up factors needed to separately include the minor gases<a name='3811'></font>
<font color=#447700>!  in the calculation of absorption coefficient<a name='3812'></font>
         scaleminor(lay) = pavel(lay)/tavel(lay)         <a name='3813'>
         scaleminorn2(lay) = (pavel(lay)/tavel(lay)) &amp;<a name='3814'>
             * (wbroad(lay)/(coldry(lay)+wkl(1,lay)))<a name='3815'>
         factor = (tavel(lay)-180.8_rb)/7.2_rb<a name='3816'>
         indminor(lay) = min(18, max(1, int(factor)))<a name='3817'>
         minorfrac(lay) = factor - float(indminor(lay))<a name='3818'>
<a name='3819'>
<font color=#447700>!  Setup reference ratio to be used in calculation of binary<a name='3820'></font>
<font color=#447700>!  species parameter in upper atmosphere.<a name='3821'></font>
         rat_h2oco2(lay)=chi_mls(1,jp(lay))/chi_mls(2,jp(lay))<a name='3822'>
         rat_h2oco2_1(lay)=chi_mls(1,jp(lay)+1)/chi_mls(2,jp(lay)+1)         <a name='3823'>
<a name='3824'>
         rat_o3co2(lay)=chi_mls(3,jp(lay))/chi_mls(2,jp(lay))<a name='3825'>
         rat_o3co2_1(lay)=chi_mls(3,jp(lay)+1)/chi_mls(2,jp(lay)+1)         <a name='3826'>
<a name='3827'>
<font color=#447700>!  Calculate needed column amounts.<a name='3828'></font>
         colh2o(lay) = 1.e-20_rb * wkl(1,lay)<a name='3829'>
         colco2(lay) = 1.e-20_rb * wkl(2,lay)<a name='3830'>
         colo3(lay) = 1.e-20_rb * wkl(3,lay)<a name='3831'>
         coln2o(lay) = 1.e-20_rb * wkl(4,lay)<a name='3832'>
         colco(lay) = 1.e-20_rb * wkl(5,lay)<a name='3833'>
         colch4(lay) = 1.e-20_rb * wkl(6,lay)<a name='3834'>
         colo2(lay) = 1.e-20_rb * wkl(7,lay)<a name='3835'>
         if (colco2(lay) .eq. 0._rb) colco2(lay) = 1.e-32_rb * coldry(lay)<a name='3836'>
         if (colo3(lay) .eq. 0._rb) colo3(lay) = 1.e-32_rb * coldry(lay)<a name='3837'>
         if (coln2o(lay) .eq. 0._rb) coln2o(lay) = 1.e-32_rb * coldry(lay)<a name='3838'>
         if (colco(lay)  .eq. 0._rb) colco(lay) = 1.e-32_rb * coldry(lay)<a name='3839'>
         if (colch4(lay) .eq. 0._rb) colch4(lay) = 1.e-32_rb * coldry(lay)<a name='3840'>
         colbrd(lay) = 1.e-20_rb * wbroad(lay)<a name='3841'>
 5400    continue<a name='3842'>
<a name='3843'>
<font color=#447700>!  We have now isolated the layer ln pressure and temperature,<a name='3844'></font>
<font color=#447700>!  between two reference pressures and two reference temperatures <a name='3845'></font>
<font color=#447700>!  (for each reference pressure).  We multiply the pressure <a name='3846'></font>
<font color=#447700>!  fraction FP with the appropriate temperature fractions to get <a name='3847'></font>
<font color=#447700>!  the factors that will be needed for the interpolation that yields<a name='3848'></font>
<font color=#447700>!  the optical depths (performed in routines TAUGBn for band n).`<a name='3849'></font>
<a name='3850'>
         compfp = 1. - fp<a name='3851'>
         fac10(lay) = compfp * ft<a name='3852'>
         fac00(lay) = compfp * (1._rb - ft)<a name='3853'>
         fac11(lay) = fp * ft1<a name='3854'>
         fac01(lay) = fp * (1._rb - ft1)<a name='3855'>
<a name='3856'>
<font color=#447700>!  Rescale selffac and forfac for use in taumol<a name='3857'></font>
         selffac(lay) = colh2o(lay)*selffac(lay)<a name='3858'>
         forfac(lay) = colh2o(lay)*forfac(lay)<a name='3859'>
<a name='3860'>
<font color=#447700>! End layer loop<a name='3861'></font>
      enddo<a name='3862'>
<a name='3863'>
      end subroutine setcoef<a name='3864'>
<a name='3865'>
<font color=#447700>!***************************************************************************<a name='3866'></font>
<A NAME='LWATMREF'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LWATMREF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3867'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwatmref</font> <A href='../../call_to/LWATMREF.html' TARGET='index'>2</A><a name='3868'>
<font color=#447700>!***************************************************************************<a name='3869'></font>
<a name='3870'>
      save<a name='3871'>
 <a name='3872'>
<font color=#447700>! These pressures are chosen such that the ln of the first pressure<a name='3873'></font>
<font color=#447700>! has only a few non-zero digits (i.e. ln(PREF(1)) = 6.96000) and<a name='3874'></font>
<font color=#447700>! each subsequent ln(pressure) differs from the previous one by 0.2.<a name='3875'></font>
<a name='3876'>
      pref(:) = (/ &amp;<a name='3877'>
          1.05363e+03_rb,8.62642e+02_rb,7.06272e+02_rb,5.78246e+02_rb,4.73428e+02_rb, &amp;<a name='3878'>
          3.87610e+02_rb,3.17348e+02_rb,2.59823e+02_rb,2.12725e+02_rb,1.74164e+02_rb, &amp;<a name='3879'>
          1.42594e+02_rb,1.16746e+02_rb,9.55835e+01_rb,7.82571e+01_rb,6.40715e+01_rb, &amp;<a name='3880'>
          5.24573e+01_rb,4.29484e+01_rb,3.51632e+01_rb,2.87892e+01_rb,2.35706e+01_rb, &amp;<a name='3881'>
          1.92980e+01_rb,1.57998e+01_rb,1.29358e+01_rb,1.05910e+01_rb,8.67114e+00_rb, &amp;<a name='3882'>
          7.09933e+00_rb,5.81244e+00_rb,4.75882e+00_rb,3.89619e+00_rb,3.18993e+00_rb, &amp;<a name='3883'>
          2.61170e+00_rb,2.13828e+00_rb,1.75067e+00_rb,1.43333e+00_rb,1.17351e+00_rb, &amp;<a name='3884'>
          9.60789e-01_rb,7.86628e-01_rb,6.44036e-01_rb,5.27292e-01_rb,4.31710e-01_rb, &amp;<a name='3885'>
          3.53455e-01_rb,2.89384e-01_rb,2.36928e-01_rb,1.93980e-01_rb,1.58817e-01_rb, &amp;<a name='3886'>
          1.30029e-01_rb,1.06458e-01_rb,8.71608e-02_rb,7.13612e-02_rb,5.84256e-02_rb, &amp;<a name='3887'>
          4.78349e-02_rb,3.91639e-02_rb,3.20647e-02_rb,2.62523e-02_rb,2.14936e-02_rb, &amp;<a name='3888'>
          1.75975e-02_rb,1.44076e-02_rb,1.17959e-02_rb,9.65769e-03_rb/)<a name='3889'>
<a name='3890'>
      preflog(:) = (/ &amp;<a name='3891'>
           6.9600e+00_rb, 6.7600e+00_rb, 6.5600e+00_rb, 6.3600e+00_rb, 6.1600e+00_rb, &amp;<a name='3892'>
           5.9600e+00_rb, 5.7600e+00_rb, 5.5600e+00_rb, 5.3600e+00_rb, 5.1600e+00_rb, &amp;<a name='3893'>
           4.9600e+00_rb, 4.7600e+00_rb, 4.5600e+00_rb, 4.3600e+00_rb, 4.1600e+00_rb, &amp;<a name='3894'>
           3.9600e+00_rb, 3.7600e+00_rb, 3.5600e+00_rb, 3.3600e+00_rb, 3.1600e+00_rb, &amp;<a name='3895'>
           2.9600e+00_rb, 2.7600e+00_rb, 2.5600e+00_rb, 2.3600e+00_rb, 2.1600e+00_rb, &amp;<a name='3896'>
           1.9600e+00_rb, 1.7600e+00_rb, 1.5600e+00_rb, 1.3600e+00_rb, 1.1600e+00_rb, &amp;<a name='3897'>
           9.6000e-01_rb, 7.6000e-01_rb, 5.6000e-01_rb, 3.6000e-01_rb, 1.6000e-01_rb, &amp;<a name='3898'>
          -4.0000e-02_rb,-2.4000e-01_rb,-4.4000e-01_rb,-6.4000e-01_rb,-8.4000e-01_rb, &amp;<a name='3899'>
          -1.0400e+00_rb,-1.2400e+00_rb,-1.4400e+00_rb,-1.6400e+00_rb,-1.8400e+00_rb, &amp;<a name='3900'>
          -2.0400e+00_rb,-2.2400e+00_rb,-2.4400e+00_rb,-2.6400e+00_rb,-2.8400e+00_rb, &amp;<a name='3901'>
          -3.0400e+00_rb,-3.2400e+00_rb,-3.4400e+00_rb,-3.6400e+00_rb,-3.8400e+00_rb, &amp;<a name='3902'>
          -4.0400e+00_rb,-4.2400e+00_rb,-4.4400e+00_rb,-4.6400e+00_rb/)<a name='3903'>
<a name='3904'>
<font color=#447700>! These are the temperatures associated with the respective <a name='3905'></font>
<font color=#447700>! pressures for the mls standard atmosphere. <a name='3906'></font>
<a name='3907'>
      tref(:) = (/ &amp;<a name='3908'>
           2.9420e+02_rb, 2.8799e+02_rb, 2.7894e+02_rb, 2.6925e+02_rb, 2.5983e+02_rb, &amp;<a name='3909'>
           2.5017e+02_rb, 2.4077e+02_rb, 2.3179e+02_rb, 2.2306e+02_rb, 2.1578e+02_rb, &amp;<a name='3910'>
           2.1570e+02_rb, 2.1570e+02_rb, 2.1570e+02_rb, 2.1706e+02_rb, 2.1858e+02_rb, &amp;<a name='3911'>
           2.2018e+02_rb, 2.2174e+02_rb, 2.2328e+02_rb, 2.2479e+02_rb, 2.2655e+02_rb, &amp;<a name='3912'>
           2.2834e+02_rb, 2.3113e+02_rb, 2.3401e+02_rb, 2.3703e+02_rb, 2.4022e+02_rb, &amp;<a name='3913'>
           2.4371e+02_rb, 2.4726e+02_rb, 2.5085e+02_rb, 2.5457e+02_rb, 2.5832e+02_rb, &amp;<a name='3914'>
           2.6216e+02_rb, 2.6606e+02_rb, 2.6999e+02_rb, 2.7340e+02_rb, 2.7536e+02_rb, &amp;<a name='3915'>
           2.7568e+02_rb, 2.7372e+02_rb, 2.7163e+02_rb, 2.6955e+02_rb, 2.6593e+02_rb, &amp;<a name='3916'>
           2.6211e+02_rb, 2.5828e+02_rb, 2.5360e+02_rb, 2.4854e+02_rb, 2.4348e+02_rb, &amp;<a name='3917'>
           2.3809e+02_rb, 2.3206e+02_rb, 2.2603e+02_rb, 2.2000e+02_rb, 2.1435e+02_rb, &amp;<a name='3918'>
           2.0887e+02_rb, 2.0340e+02_rb, 1.9792e+02_rb, 1.9290e+02_rb, 1.8809e+02_rb, &amp;<a name='3919'>
           1.8329e+02_rb, 1.7849e+02_rb, 1.7394e+02_rb, 1.7212e+02_rb/)<a name='3920'>
<a name='3921'>
       chi_mls(1,1:12) = (/ &amp;<a name='3922'>
        1.8760e-02_rb, 1.2223e-02_rb, 5.8909e-03_rb, 2.7675e-03_rb, 1.4065e-03_rb, &amp;<a name='3923'>
        7.5970e-04_rb, 3.8876e-04_rb, 1.6542e-04_rb, 3.7190e-05_rb, 7.4765e-06_rb, &amp;<a name='3924'>
        4.3082e-06_rb, 3.3319e-06_rb/)<a name='3925'>
       chi_mls(1,13:59) = (/ &amp;<a name='3926'>
        3.2039e-06_rb,  3.1619e-06_rb,  3.2524e-06_rb,  3.4226e-06_rb,  3.6288e-06_rb, &amp;<a name='3927'>
        3.9148e-06_rb,  4.1488e-06_rb,  4.3081e-06_rb,  4.4420e-06_rb,  4.5778e-06_rb, &amp;<a name='3928'>
        4.7087e-06_rb,  4.7943e-06_rb,  4.8697e-06_rb,  4.9260e-06_rb,  4.9669e-06_rb, &amp;<a name='3929'>
        4.9963e-06_rb,  5.0527e-06_rb,  5.1266e-06_rb,  5.2503e-06_rb,  5.3571e-06_rb, &amp;<a name='3930'>
        5.4509e-06_rb,  5.4830e-06_rb,  5.5000e-06_rb,  5.5000e-06_rb,  5.4536e-06_rb, &amp;<a name='3931'>
        5.4047e-06_rb,  5.3558e-06_rb,  5.2533e-06_rb,  5.1436e-06_rb,  5.0340e-06_rb, &amp;<a name='3932'>
        4.8766e-06_rb,  4.6979e-06_rb,  4.5191e-06_rb,  4.3360e-06_rb,  4.1442e-06_rb, &amp;<a name='3933'>
        3.9523e-06_rb,  3.7605e-06_rb,  3.5722e-06_rb,  3.3855e-06_rb,  3.1988e-06_rb, &amp;<a name='3934'>
        3.0121e-06_rb,  2.8262e-06_rb,  2.6407e-06_rb,  2.4552e-06_rb,  2.2696e-06_rb, &amp;<a name='3935'>
        4.3360e-06_rb,  4.1442e-06_rb/)<a name='3936'>
       chi_mls(2,1:12) = (/ &amp;<a name='3937'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3938'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3939'>
        3.5500e-04_rb,  3.5500e-04_rb/)<a name='3940'>
       chi_mls(2,13:59) = (/ &amp;<a name='3941'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3942'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3943'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3944'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3945'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3946'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3947'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3948'>
        3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb,  3.5500e-04_rb, &amp;<a name='3949'>
        3.5500e-04_rb,  3.5471e-04_rb,  3.5427e-04_rb,  3.5384e-04_rb,  3.5340e-04_rb, &amp;<a name='3950'>
        3.5500e-04_rb,  3.5500e-04_rb/)<a name='3951'>
       chi_mls(3,1:12) = (/ &amp;<a name='3952'>
        3.0170e-08_rb,  3.4725e-08_rb,  4.2477e-08_rb,  5.2759e-08_rb,  6.6944e-08_rb, &amp;<a name='3953'>
        8.7130e-08_rb,  1.1391e-07_rb,  1.5677e-07_rb,  2.1788e-07_rb,  3.2443e-07_rb, &amp;<a name='3954'>
        4.6594e-07_rb,  5.6806e-07_rb/)<a name='3955'>
       chi_mls(3,13:59) = (/ &amp;<a name='3956'>
        6.9607e-07_rb,  1.1186e-06_rb,  1.7618e-06_rb,  2.3269e-06_rb,  2.9577e-06_rb, &amp;<a name='3957'>
        3.6593e-06_rb,  4.5950e-06_rb,  5.3189e-06_rb,  5.9618e-06_rb,  6.5113e-06_rb, &amp;<a name='3958'>
        7.0635e-06_rb,  7.6917e-06_rb,  8.2577e-06_rb,  8.7082e-06_rb,  8.8325e-06_rb, &amp;<a name='3959'>
        8.7149e-06_rb,  8.0943e-06_rb,  7.3307e-06_rb,  6.3101e-06_rb,  5.3672e-06_rb, &amp;<a name='3960'>
        4.4829e-06_rb,  3.8391e-06_rb,  3.2827e-06_rb,  2.8235e-06_rb,  2.4906e-06_rb, &amp;<a name='3961'>
        2.1645e-06_rb,  1.8385e-06_rb,  1.6618e-06_rb,  1.5052e-06_rb,  1.3485e-06_rb, &amp;<a name='3962'>
        1.1972e-06_rb,  1.0482e-06_rb,  8.9926e-07_rb,  7.6343e-07_rb,  6.5381e-07_rb, &amp;<a name='3963'>
        5.4419e-07_rb,  4.3456e-07_rb,  3.6421e-07_rb,  3.1194e-07_rb,  2.5967e-07_rb, &amp;<a name='3964'>
        2.0740e-07_rb,  1.9146e-07_rb,  1.9364e-07_rb,  1.9582e-07_rb,  1.9800e-07_rb, &amp;<a name='3965'>
        7.6343e-07_rb,  6.5381e-07_rb/)<a name='3966'>
       chi_mls(4,1:12) = (/ &amp;<a name='3967'>
        3.2000e-07_rb,  3.2000e-07_rb,  3.2000e-07_rb,  3.2000e-07_rb,  3.2000e-07_rb, &amp;<a name='3968'>
        3.1965e-07_rb,  3.1532e-07_rb,  3.0383e-07_rb,  2.9422e-07_rb,  2.8495e-07_rb, &amp;<a name='3969'>
        2.7671e-07_rb,  2.6471e-07_rb/)<a name='3970'>
       chi_mls(4,13:59) = (/ &amp;<a name='3971'>
        2.4285e-07_rb,  2.0955e-07_rb,  1.7195e-07_rb,  1.3749e-07_rb,  1.1332e-07_rb, &amp;<a name='3972'>
        1.0035e-07_rb,  9.1281e-08_rb,  8.5463e-08_rb,  8.0363e-08_rb,  7.3372e-08_rb, &amp;<a name='3973'>
        6.5975e-08_rb,  5.6039e-08_rb,  4.7090e-08_rb,  3.9977e-08_rb,  3.2979e-08_rb, &amp;<a name='3974'>
        2.6064e-08_rb,  2.1066e-08_rb,  1.6592e-08_rb,  1.3017e-08_rb,  1.0090e-08_rb, &amp;<a name='3975'>
        7.6249e-09_rb,  6.1159e-09_rb,  4.6672e-09_rb,  3.2857e-09_rb,  2.8484e-09_rb, &amp;<a name='3976'>
        2.4620e-09_rb,  2.0756e-09_rb,  1.8551e-09_rb,  1.6568e-09_rb,  1.4584e-09_rb, &amp;<a name='3977'>
        1.3195e-09_rb,  1.2072e-09_rb,  1.0948e-09_rb,  9.9780e-10_rb,  9.3126e-10_rb, &amp;<a name='3978'>
        8.6472e-10_rb,  7.9818e-10_rb,  7.5138e-10_rb,  7.1367e-10_rb,  6.7596e-10_rb, &amp;<a name='3979'>
        6.3825e-10_rb,  6.0981e-10_rb,  5.8600e-10_rb,  5.6218e-10_rb,  5.3837e-10_rb, &amp;<a name='3980'>
        9.9780e-10_rb,  9.3126e-10_rb/)<a name='3981'>
       chi_mls(5,1:12) = (/ &amp;<a name='3982'>
        1.5000e-07_rb,  1.4306e-07_rb,  1.3474e-07_rb,  1.3061e-07_rb,  1.2793e-07_rb, &amp;<a name='3983'>
        1.2038e-07_rb,  1.0798e-07_rb,  9.4238e-08_rb,  7.9488e-08_rb,  6.1386e-08_rb, &amp;<a name='3984'>
        4.5563e-08_rb,  3.3475e-08_rb/)<a name='3985'>
       chi_mls(5,13:59) = (/ &amp;<a name='3986'>
        2.5118e-08_rb,  1.8671e-08_rb,  1.4349e-08_rb,  1.2501e-08_rb,  1.2407e-08_rb, &amp;<a name='3987'>
        1.3472e-08_rb,  1.4900e-08_rb,  1.6079e-08_rb,  1.7156e-08_rb,  1.8616e-08_rb, &amp;<a name='3988'>
        2.0106e-08_rb,  2.1654e-08_rb,  2.3096e-08_rb,  2.4340e-08_rb,  2.5643e-08_rb, &amp;<a name='3989'>
        2.6990e-08_rb,  2.8456e-08_rb,  2.9854e-08_rb,  3.0943e-08_rb,  3.2023e-08_rb, &amp;<a name='3990'>
        3.3101e-08_rb,  3.4260e-08_rb,  3.5360e-08_rb,  3.6397e-08_rb,  3.7310e-08_rb, &amp;<a name='3991'>
        3.8217e-08_rb,  3.9123e-08_rb,  4.1303e-08_rb,  4.3652e-08_rb,  4.6002e-08_rb, &amp;<a name='3992'>
        5.0289e-08_rb,  5.5446e-08_rb,  6.0603e-08_rb,  6.8946e-08_rb,  8.3652e-08_rb, &amp;<a name='3993'>
        9.8357e-08_rb,  1.1306e-07_rb,  1.4766e-07_rb,  1.9142e-07_rb,  2.3518e-07_rb, &amp;<a name='3994'>
        2.7894e-07_rb,  3.5001e-07_rb,  4.3469e-07_rb,  5.1938e-07_rb,  6.0407e-07_rb, &amp;<a name='3995'>
        6.8946e-08_rb,  8.3652e-08_rb/)<a name='3996'>
       chi_mls(6,1:12) = (/ &amp;<a name='3997'>
        1.7000e-06_rb,  1.7000e-06_rb,  1.6999e-06_rb,  1.6904e-06_rb,  1.6671e-06_rb, &amp;<a name='3998'>
        1.6351e-06_rb,  1.6098e-06_rb,  1.5590e-06_rb,  1.5120e-06_rb,  1.4741e-06_rb, &amp;<a name='3999'>
        1.4385e-06_rb,  1.4002e-06_rb/)<a name='4000'>
       chi_mls(6,13:59) = (/ &amp;<a name='4001'>
        1.3573e-06_rb,  1.3130e-06_rb,  1.2512e-06_rb,  1.1668e-06_rb,  1.0553e-06_rb, &amp;<a name='4002'>
        9.3281e-07_rb,  8.1217e-07_rb,  7.5239e-07_rb,  7.0728e-07_rb,  6.6722e-07_rb, &amp;<a name='4003'>
        6.2733e-07_rb,  5.8604e-07_rb,  5.4769e-07_rb,  5.1480e-07_rb,  4.8206e-07_rb, &amp;<a name='4004'>
        4.4943e-07_rb,  4.1702e-07_rb,  3.8460e-07_rb,  3.5200e-07_rb,  3.1926e-07_rb, &amp;<a name='4005'>
        2.8646e-07_rb,  2.5498e-07_rb,  2.2474e-07_rb,  1.9588e-07_rb,  1.8295e-07_rb, &amp;<a name='4006'>
        1.7089e-07_rb,  1.5882e-07_rb,  1.5536e-07_rb,  1.5304e-07_rb,  1.5072e-07_rb, &amp;<a name='4007'>
        1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb, &amp;<a name='4008'>
        1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb, &amp;<a name='4009'>
        1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb,  1.5000e-07_rb, &amp;<a name='4010'>
        1.5000e-07_rb,  1.5000e-07_rb/)<a name='4011'>
       chi_mls(7,1:12) = (/ &amp;<a name='4012'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4013'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4014'>
        0.2090_rb,  0.2090_rb/)<a name='4015'>
       chi_mls(7,13:59) = (/ &amp;<a name='4016'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4017'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4018'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4019'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4020'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4021'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4022'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4023'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4024'>
        0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb,  0.2090_rb, &amp;<a name='4025'>
        0.2090_rb,  0.2090_rb/)<a name='4026'>
<a name='4027'>
      end subroutine lwatmref<a name='4028'>
<a name='4029'>
<font color=#447700>!***************************************************************************<a name='4030'></font>
<A NAME='LWAVPLANK'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LWAVPLANK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4031'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwavplank</font> <A href='../../call_to/LWAVPLANK.html' TARGET='index'>2</A><a name='4032'>
<font color=#447700>!***************************************************************************<a name='4033'></font>
<a name='4034'>
      save<a name='4035'>
 <a name='4036'>
      totplnk(1:50,  1) = (/ &amp;<a name='4037'>
      0.14783e-05_rb,0.15006e-05_rb,0.15230e-05_rb,0.15455e-05_rb,0.15681e-05_rb, &amp;<a name='4038'>
      0.15908e-05_rb,0.16136e-05_rb,0.16365e-05_rb,0.16595e-05_rb,0.16826e-05_rb, &amp;<a name='4039'>
      0.17059e-05_rb,0.17292e-05_rb,0.17526e-05_rb,0.17762e-05_rb,0.17998e-05_rb, &amp;<a name='4040'>
      0.18235e-05_rb,0.18473e-05_rb,0.18712e-05_rb,0.18953e-05_rb,0.19194e-05_rb, &amp;<a name='4041'>
      0.19435e-05_rb,0.19678e-05_rb,0.19922e-05_rb,0.20166e-05_rb,0.20412e-05_rb, &amp;<a name='4042'>
      0.20658e-05_rb,0.20905e-05_rb,0.21153e-05_rb,0.21402e-05_rb,0.21652e-05_rb, &amp;<a name='4043'>
      0.21902e-05_rb,0.22154e-05_rb,0.22406e-05_rb,0.22659e-05_rb,0.22912e-05_rb, &amp;<a name='4044'>
      0.23167e-05_rb,0.23422e-05_rb,0.23678e-05_rb,0.23934e-05_rb,0.24192e-05_rb, &amp;<a name='4045'>
      0.24450e-05_rb,0.24709e-05_rb,0.24968e-05_rb,0.25229e-05_rb,0.25490e-05_rb, &amp;<a name='4046'>
      0.25751e-05_rb,0.26014e-05_rb,0.26277e-05_rb,0.26540e-05_rb,0.26805e-05_rb/)<a name='4047'>
      totplnk(51:100,  1) = (/ &amp;<a name='4048'>
      0.27070e-05_rb,0.27335e-05_rb,0.27602e-05_rb,0.27869e-05_rb,0.28136e-05_rb, &amp;<a name='4049'>
      0.28404e-05_rb,0.28673e-05_rb,0.28943e-05_rb,0.29213e-05_rb,0.29483e-05_rb, &amp;<a name='4050'>
      0.29754e-05_rb,0.30026e-05_rb,0.30298e-05_rb,0.30571e-05_rb,0.30845e-05_rb, &amp;<a name='4051'>
      0.31119e-05_rb,0.31393e-05_rb,0.31669e-05_rb,0.31944e-05_rb,0.32220e-05_rb, &amp;<a name='4052'>
      0.32497e-05_rb,0.32774e-05_rb,0.33052e-05_rb,0.33330e-05_rb,0.33609e-05_rb, &amp;<a name='4053'>
      0.33888e-05_rb,0.34168e-05_rb,0.34448e-05_rb,0.34729e-05_rb,0.35010e-05_rb, &amp;<a name='4054'>
      0.35292e-05_rb,0.35574e-05_rb,0.35857e-05_rb,0.36140e-05_rb,0.36424e-05_rb, &amp;<a name='4055'>
      0.36708e-05_rb,0.36992e-05_rb,0.37277e-05_rb,0.37563e-05_rb,0.37848e-05_rb, &amp;<a name='4056'>
      0.38135e-05_rb,0.38421e-05_rb,0.38708e-05_rb,0.38996e-05_rb,0.39284e-05_rb, &amp;<a name='4057'>
      0.39572e-05_rb,0.39861e-05_rb,0.40150e-05_rb,0.40440e-05_rb,0.40730e-05_rb/)<a name='4058'>
      totplnk(101:150,  1) = (/ &amp;<a name='4059'>
      0.41020e-05_rb,0.41311e-05_rb,0.41602e-05_rb,0.41893e-05_rb,0.42185e-05_rb, &amp;<a name='4060'>
      0.42477e-05_rb,0.42770e-05_rb,0.43063e-05_rb,0.43356e-05_rb,0.43650e-05_rb, &amp;<a name='4061'>
      0.43944e-05_rb,0.44238e-05_rb,0.44533e-05_rb,0.44828e-05_rb,0.45124e-05_rb, &amp;<a name='4062'>
      0.45419e-05_rb,0.45715e-05_rb,0.46012e-05_rb,0.46309e-05_rb,0.46606e-05_rb, &amp;<a name='4063'>
      0.46903e-05_rb,0.47201e-05_rb,0.47499e-05_rb,0.47797e-05_rb,0.48096e-05_rb, &amp;<a name='4064'>
      0.48395e-05_rb,0.48695e-05_rb,0.48994e-05_rb,0.49294e-05_rb,0.49594e-05_rb, &amp;<a name='4065'>
      0.49895e-05_rb,0.50196e-05_rb,0.50497e-05_rb,0.50798e-05_rb,0.51100e-05_rb, &amp;<a name='4066'>
      0.51402e-05_rb,0.51704e-05_rb,0.52007e-05_rb,0.52309e-05_rb,0.52612e-05_rb, &amp;<a name='4067'>
      0.52916e-05_rb,0.53219e-05_rb,0.53523e-05_rb,0.53827e-05_rb,0.54132e-05_rb, &amp;<a name='4068'>
      0.54436e-05_rb,0.54741e-05_rb,0.55047e-05_rb,0.55352e-05_rb,0.55658e-05_rb/)<a name='4069'>
      totplnk(151:181,  1) = (/ &amp;<a name='4070'>
      0.55964e-05_rb,0.56270e-05_rb,0.56576e-05_rb,0.56883e-05_rb,0.57190e-05_rb, &amp;<a name='4071'>
      0.57497e-05_rb,0.57804e-05_rb,0.58112e-05_rb,0.58420e-05_rb,0.58728e-05_rb, &amp;<a name='4072'>
      0.59036e-05_rb,0.59345e-05_rb,0.59653e-05_rb,0.59962e-05_rb,0.60272e-05_rb, &amp;<a name='4073'>
      0.60581e-05_rb,0.60891e-05_rb,0.61201e-05_rb,0.61511e-05_rb,0.61821e-05_rb, &amp;<a name='4074'>
      0.62131e-05_rb,0.62442e-05_rb,0.62753e-05_rb,0.63064e-05_rb,0.63376e-05_rb, &amp;<a name='4075'>
      0.63687e-05_rb,0.63998e-05_rb,0.64310e-05_rb,0.64622e-05_rb,0.64935e-05_rb, &amp;<a name='4076'>
      0.65247e-05_rb/)<a name='4077'>
      totplnk(1:50,  2) = (/ &amp;<a name='4078'>
      0.20262e-05_rb,0.20757e-05_rb,0.21257e-05_rb,0.21763e-05_rb,0.22276e-05_rb, &amp;<a name='4079'>
      0.22794e-05_rb,0.23319e-05_rb,0.23849e-05_rb,0.24386e-05_rb,0.24928e-05_rb, &amp;<a name='4080'>
      0.25477e-05_rb,0.26031e-05_rb,0.26591e-05_rb,0.27157e-05_rb,0.27728e-05_rb, &amp;<a name='4081'>
      0.28306e-05_rb,0.28889e-05_rb,0.29478e-05_rb,0.30073e-05_rb,0.30673e-05_rb, &amp;<a name='4082'>
      0.31279e-05_rb,0.31890e-05_rb,0.32507e-05_rb,0.33129e-05_rb,0.33757e-05_rb, &amp;<a name='4083'>
      0.34391e-05_rb,0.35029e-05_rb,0.35674e-05_rb,0.36323e-05_rb,0.36978e-05_rb, &amp;<a name='4084'>
      0.37638e-05_rb,0.38304e-05_rb,0.38974e-05_rb,0.39650e-05_rb,0.40331e-05_rb, &amp;<a name='4085'>
      0.41017e-05_rb,0.41708e-05_rb,0.42405e-05_rb,0.43106e-05_rb,0.43812e-05_rb, &amp;<a name='4086'>
      0.44524e-05_rb,0.45240e-05_rb,0.45961e-05_rb,0.46687e-05_rb,0.47418e-05_rb, &amp;<a name='4087'>
      0.48153e-05_rb,0.48894e-05_rb,0.49639e-05_rb,0.50389e-05_rb,0.51143e-05_rb/)<a name='4088'>
      totplnk(51:100,  2) = (/ &amp;<a name='4089'>
      0.51902e-05_rb,0.52666e-05_rb,0.53434e-05_rb,0.54207e-05_rb,0.54985e-05_rb, &amp;<a name='4090'>
      0.55767e-05_rb,0.56553e-05_rb,0.57343e-05_rb,0.58139e-05_rb,0.58938e-05_rb, &amp;<a name='4091'>
      0.59742e-05_rb,0.60550e-05_rb,0.61362e-05_rb,0.62179e-05_rb,0.63000e-05_rb, &amp;<a name='4092'>
      0.63825e-05_rb,0.64654e-05_rb,0.65487e-05_rb,0.66324e-05_rb,0.67166e-05_rb, &amp;<a name='4093'>
      0.68011e-05_rb,0.68860e-05_rb,0.69714e-05_rb,0.70571e-05_rb,0.71432e-05_rb, &amp;<a name='4094'>
      0.72297e-05_rb,0.73166e-05_rb,0.74039e-05_rb,0.74915e-05_rb,0.75796e-05_rb, &amp;<a name='4095'>
      0.76680e-05_rb,0.77567e-05_rb,0.78459e-05_rb,0.79354e-05_rb,0.80252e-05_rb, &amp;<a name='4096'>
      0.81155e-05_rb,0.82061e-05_rb,0.82970e-05_rb,0.83883e-05_rb,0.84799e-05_rb, &amp;<a name='4097'>
      0.85719e-05_rb,0.86643e-05_rb,0.87569e-05_rb,0.88499e-05_rb,0.89433e-05_rb, &amp;<a name='4098'>
      0.90370e-05_rb,0.91310e-05_rb,0.92254e-05_rb,0.93200e-05_rb,0.94150e-05_rb/)<a name='4099'>
      totplnk(101:150,  2) = (/ &amp;<a name='4100'>
      0.95104e-05_rb,0.96060e-05_rb,0.97020e-05_rb,0.97982e-05_rb,0.98948e-05_rb, &amp;<a name='4101'>
      0.99917e-05_rb,0.10089e-04_rb,0.10186e-04_rb,0.10284e-04_rb,0.10382e-04_rb, &amp;<a name='4102'>
      0.10481e-04_rb,0.10580e-04_rb,0.10679e-04_rb,0.10778e-04_rb,0.10877e-04_rb, &amp;<a name='4103'>
      0.10977e-04_rb,0.11077e-04_rb,0.11178e-04_rb,0.11279e-04_rb,0.11380e-04_rb, &amp;<a name='4104'>
      0.11481e-04_rb,0.11583e-04_rb,0.11684e-04_rb,0.11786e-04_rb,0.11889e-04_rb, &amp;<a name='4105'>
      0.11992e-04_rb,0.12094e-04_rb,0.12198e-04_rb,0.12301e-04_rb,0.12405e-04_rb, &amp;<a name='4106'>
      0.12509e-04_rb,0.12613e-04_rb,0.12717e-04_rb,0.12822e-04_rb,0.12927e-04_rb, &amp;<a name='4107'>
      0.13032e-04_rb,0.13138e-04_rb,0.13244e-04_rb,0.13349e-04_rb,0.13456e-04_rb, &amp;<a name='4108'>
      0.13562e-04_rb,0.13669e-04_rb,0.13776e-04_rb,0.13883e-04_rb,0.13990e-04_rb, &amp;<a name='4109'>
      0.14098e-04_rb,0.14206e-04_rb,0.14314e-04_rb,0.14422e-04_rb,0.14531e-04_rb/)<a name='4110'>
      totplnk(151:181,  2) = (/ &amp;<a name='4111'>
      0.14639e-04_rb,0.14748e-04_rb,0.14857e-04_rb,0.14967e-04_rb,0.15076e-04_rb, &amp;<a name='4112'>
      0.15186e-04_rb,0.15296e-04_rb,0.15407e-04_rb,0.15517e-04_rb,0.15628e-04_rb, &amp;<a name='4113'>
      0.15739e-04_rb,0.15850e-04_rb,0.15961e-04_rb,0.16072e-04_rb,0.16184e-04_rb, &amp;<a name='4114'>
      0.16296e-04_rb,0.16408e-04_rb,0.16521e-04_rb,0.16633e-04_rb,0.16746e-04_rb, &amp;<a name='4115'>
      0.16859e-04_rb,0.16972e-04_rb,0.17085e-04_rb,0.17198e-04_rb,0.17312e-04_rb, &amp;<a name='4116'>
      0.17426e-04_rb,0.17540e-04_rb,0.17654e-04_rb,0.17769e-04_rb,0.17883e-04_rb, &amp;<a name='4117'>
      0.17998e-04_rb/)<a name='4118'>
      totplnk(1:50, 3) = (/ &amp;<a name='4119'>
      1.34822e-06_rb,1.39134e-06_rb,1.43530e-06_rb,1.48010e-06_rb,1.52574e-06_rb, &amp;<a name='4120'>
      1.57222e-06_rb,1.61956e-06_rb,1.66774e-06_rb,1.71678e-06_rb,1.76666e-06_rb, &amp;<a name='4121'>
      1.81741e-06_rb,1.86901e-06_rb,1.92147e-06_rb,1.97479e-06_rb,2.02898e-06_rb, &amp;<a name='4122'>
      2.08402e-06_rb,2.13993e-06_rb,2.19671e-06_rb,2.25435e-06_rb,2.31285e-06_rb, &amp;<a name='4123'>
      2.37222e-06_rb,2.43246e-06_rb,2.49356e-06_rb,2.55553e-06_rb,2.61837e-06_rb, &amp;<a name='4124'>
      2.68207e-06_rb,2.74664e-06_rb,2.81207e-06_rb,2.87837e-06_rb,2.94554e-06_rb, &amp;<a name='4125'>
      3.01356e-06_rb,3.08245e-06_rb,3.15221e-06_rb,3.22282e-06_rb,3.29429e-06_rb, &amp;<a name='4126'>
      3.36662e-06_rb,3.43982e-06_rb,3.51386e-06_rb,3.58876e-06_rb,3.66451e-06_rb, &amp;<a name='4127'>
      3.74112e-06_rb,3.81857e-06_rb,3.89688e-06_rb,3.97602e-06_rb,4.05601e-06_rb, &amp;<a name='4128'>
      4.13685e-06_rb,4.21852e-06_rb,4.30104e-06_rb,4.38438e-06_rb,4.46857e-06_rb/)<a name='4129'>
      totplnk(51:100, 3) = (/ &amp;<a name='4130'>
      4.55358e-06_rb,4.63943e-06_rb,4.72610e-06_rb,4.81359e-06_rb,4.90191e-06_rb, &amp;<a name='4131'>
      4.99105e-06_rb,5.08100e-06_rb,5.17176e-06_rb,5.26335e-06_rb,5.35573e-06_rb, &amp;<a name='4132'>
      5.44892e-06_rb,5.54292e-06_rb,5.63772e-06_rb,5.73331e-06_rb,5.82970e-06_rb, &amp;<a name='4133'>
      5.92688e-06_rb,6.02485e-06_rb,6.12360e-06_rb,6.22314e-06_rb,6.32346e-06_rb, &amp;<a name='4134'>
      6.42455e-06_rb,6.52641e-06_rb,6.62906e-06_rb,6.73247e-06_rb,6.83664e-06_rb, &amp;<a name='4135'>
      6.94156e-06_rb,7.04725e-06_rb,7.15370e-06_rb,7.26089e-06_rb,7.36883e-06_rb, &amp;<a name='4136'>
      7.47752e-06_rb,7.58695e-06_rb,7.69712e-06_rb,7.80801e-06_rb,7.91965e-06_rb, &amp;<a name='4137'>
      8.03201e-06_rb,8.14510e-06_rb,8.25891e-06_rb,8.37343e-06_rb,8.48867e-06_rb, &amp;<a name='4138'>
      8.60463e-06_rb,8.72128e-06_rb,8.83865e-06_rb,8.95672e-06_rb,9.07548e-06_rb, &amp;<a name='4139'>
      9.19495e-06_rb,9.31510e-06_rb,9.43594e-06_rb,9.55745e-06_rb,9.67966e-06_rb/)<a name='4140'>
      totplnk(101:150, 3) = (/ &amp;<a name='4141'>
      9.80254e-06_rb,9.92609e-06_rb,1.00503e-05_rb,1.01752e-05_rb,1.03008e-05_rb, &amp;<a name='4142'>
      1.04270e-05_rb,1.05539e-05_rb,1.06814e-05_rb,1.08096e-05_rb,1.09384e-05_rb, &amp;<a name='4143'>
      1.10679e-05_rb,1.11980e-05_rb,1.13288e-05_rb,1.14601e-05_rb,1.15922e-05_rb, &amp;<a name='4144'>
      1.17248e-05_rb,1.18581e-05_rb,1.19920e-05_rb,1.21265e-05_rb,1.22616e-05_rb, &amp;<a name='4145'>
      1.23973e-05_rb,1.25337e-05_rb,1.26706e-05_rb,1.28081e-05_rb,1.29463e-05_rb, &amp;<a name='4146'>
      1.30850e-05_rb,1.32243e-05_rb,1.33642e-05_rb,1.35047e-05_rb,1.36458e-05_rb, &amp;<a name='4147'>
      1.37875e-05_rb,1.39297e-05_rb,1.40725e-05_rb,1.42159e-05_rb,1.43598e-05_rb, &amp;<a name='4148'>
      1.45044e-05_rb,1.46494e-05_rb,1.47950e-05_rb,1.49412e-05_rb,1.50879e-05_rb, &amp;<a name='4149'>
      1.52352e-05_rb,1.53830e-05_rb,1.55314e-05_rb,1.56803e-05_rb,1.58297e-05_rb, &amp;<a name='4150'>
      1.59797e-05_rb,1.61302e-05_rb,1.62812e-05_rb,1.64327e-05_rb,1.65848e-05_rb/)<a name='4151'>
      totplnk(151:181, 3) = (/ &amp;<a name='4152'>
      1.67374e-05_rb,1.68904e-05_rb,1.70441e-05_rb,1.71982e-05_rb,1.73528e-05_rb, &amp;<a name='4153'>
      1.75079e-05_rb,1.76635e-05_rb,1.78197e-05_rb,1.79763e-05_rb,1.81334e-05_rb, &amp;<a name='4154'>
      1.82910e-05_rb,1.84491e-05_rb,1.86076e-05_rb,1.87667e-05_rb,1.89262e-05_rb, &amp;<a name='4155'>
      1.90862e-05_rb,1.92467e-05_rb,1.94076e-05_rb,1.95690e-05_rb,1.97309e-05_rb, &amp;<a name='4156'>
      1.98932e-05_rb,2.00560e-05_rb,2.02193e-05_rb,2.03830e-05_rb,2.05472e-05_rb, &amp;<a name='4157'>
      2.07118e-05_rb,2.08768e-05_rb,2.10423e-05_rb,2.12083e-05_rb,2.13747e-05_rb, &amp;<a name='4158'>
      2.15414e-05_rb/)<a name='4159'>
      totplnk(1:50, 4) = (/ &amp;<a name='4160'>
      8.90528e-07_rb,9.24222e-07_rb,9.58757e-07_rb,9.94141e-07_rb,1.03038e-06_rb, &amp;<a name='4161'>
      1.06748e-06_rb,1.10545e-06_rb,1.14430e-06_rb,1.18403e-06_rb,1.22465e-06_rb, &amp;<a name='4162'>
      1.26618e-06_rb,1.30860e-06_rb,1.35193e-06_rb,1.39619e-06_rb,1.44136e-06_rb, &amp;<a name='4163'>
      1.48746e-06_rb,1.53449e-06_rb,1.58246e-06_rb,1.63138e-06_rb,1.68124e-06_rb, &amp;<a name='4164'>
      1.73206e-06_rb,1.78383e-06_rb,1.83657e-06_rb,1.89028e-06_rb,1.94495e-06_rb, &amp;<a name='4165'>
      2.00060e-06_rb,2.05724e-06_rb,2.11485e-06_rb,2.17344e-06_rb,2.23303e-06_rb, &amp;<a name='4166'>
      2.29361e-06_rb,2.35519e-06_rb,2.41777e-06_rb,2.48134e-06_rb,2.54592e-06_rb, &amp;<a name='4167'>
      2.61151e-06_rb,2.67810e-06_rb,2.74571e-06_rb,2.81433e-06_rb,2.88396e-06_rb, &amp;<a name='4168'>
      2.95461e-06_rb,3.02628e-06_rb,3.09896e-06_rb,3.17267e-06_rb,3.24741e-06_rb, &amp;<a name='4169'>
      3.32316e-06_rb,3.39994e-06_rb,3.47774e-06_rb,3.55657e-06_rb,3.63642e-06_rb/)<a name='4170'>
      totplnk(51:100, 4) = (/ &amp;<a name='4171'>
      3.71731e-06_rb,3.79922e-06_rb,3.88216e-06_rb,3.96612e-06_rb,4.05112e-06_rb, &amp;<a name='4172'>
      4.13714e-06_rb,4.22419e-06_rb,4.31227e-06_rb,4.40137e-06_rb,4.49151e-06_rb, &amp;<a name='4173'>
      4.58266e-06_rb,4.67485e-06_rb,4.76806e-06_rb,4.86229e-06_rb,4.95754e-06_rb, &amp;<a name='4174'>
      5.05383e-06_rb,5.15113e-06_rb,5.24946e-06_rb,5.34879e-06_rb,5.44916e-06_rb, &amp;<a name='4175'>
      5.55053e-06_rb,5.65292e-06_rb,5.75632e-06_rb,5.86073e-06_rb,5.96616e-06_rb, &amp;<a name='4176'>
      6.07260e-06_rb,6.18003e-06_rb,6.28848e-06_rb,6.39794e-06_rb,6.50838e-06_rb, &amp;<a name='4177'>
      6.61983e-06_rb,6.73229e-06_rb,6.84573e-06_rb,6.96016e-06_rb,7.07559e-06_rb, &amp;<a name='4178'>
      7.19200e-06_rb,7.30940e-06_rb,7.42779e-06_rb,7.54715e-06_rb,7.66749e-06_rb, &amp;<a name='4179'>
      7.78882e-06_rb,7.91110e-06_rb,8.03436e-06_rb,8.15859e-06_rb,8.28379e-06_rb, &amp;<a name='4180'>
      8.40994e-06_rb,8.53706e-06_rb,8.66515e-06_rb,8.79418e-06_rb,8.92416e-06_rb/)<a name='4181'>
      totplnk(101:150, 4) = (/ &amp;<a name='4182'>
      9.05510e-06_rb,9.18697e-06_rb,9.31979e-06_rb,9.45356e-06_rb,9.58826e-06_rb, &amp;<a name='4183'>
      9.72389e-06_rb,9.86046e-06_rb,9.99793e-06_rb,1.01364e-05_rb,1.02757e-05_rb, &amp;<a name='4184'>
      1.04159e-05_rb,1.05571e-05_rb,1.06992e-05_rb,1.08422e-05_rb,1.09861e-05_rb, &amp;<a name='4185'>
      1.11309e-05_rb,1.12766e-05_rb,1.14232e-05_rb,1.15707e-05_rb,1.17190e-05_rb, &amp;<a name='4186'>
      1.18683e-05_rb,1.20184e-05_rb,1.21695e-05_rb,1.23214e-05_rb,1.24741e-05_rb, &amp;<a name='4187'>
      1.26277e-05_rb,1.27822e-05_rb,1.29376e-05_rb,1.30939e-05_rb,1.32509e-05_rb, &amp;<a name='4188'>
      1.34088e-05_rb,1.35676e-05_rb,1.37273e-05_rb,1.38877e-05_rb,1.40490e-05_rb, &amp;<a name='4189'>
      1.42112e-05_rb,1.43742e-05_rb,1.45380e-05_rb,1.47026e-05_rb,1.48680e-05_rb, &amp;<a name='4190'>
      1.50343e-05_rb,1.52014e-05_rb,1.53692e-05_rb,1.55379e-05_rb,1.57074e-05_rb, &amp;<a name='4191'>
      1.58778e-05_rb,1.60488e-05_rb,1.62207e-05_rb,1.63934e-05_rb,1.65669e-05_rb/)<a name='4192'>
      totplnk(151:181, 4) = (/ &amp;<a name='4193'>
      1.67411e-05_rb,1.69162e-05_rb,1.70920e-05_rb,1.72685e-05_rb,1.74459e-05_rb, &amp;<a name='4194'>
      1.76240e-05_rb,1.78029e-05_rb,1.79825e-05_rb,1.81629e-05_rb,1.83440e-05_rb, &amp;<a name='4195'>
      1.85259e-05_rb,1.87086e-05_rb,1.88919e-05_rb,1.90760e-05_rb,1.92609e-05_rb, &amp;<a name='4196'>
      1.94465e-05_rb,1.96327e-05_rb,1.98199e-05_rb,2.00076e-05_rb,2.01961e-05_rb, &amp;<a name='4197'>
      2.03853e-05_rb,2.05752e-05_rb,2.07658e-05_rb,2.09571e-05_rb,2.11491e-05_rb, &amp;<a name='4198'>
      2.13418e-05_rb,2.15352e-05_rb,2.17294e-05_rb,2.19241e-05_rb,2.21196e-05_rb, &amp;<a name='4199'>
      2.23158e-05_rb/)<a name='4200'>
      totplnk(1:50, 5) = (/ &amp;<a name='4201'>
      5.70230e-07_rb,5.94788e-07_rb,6.20085e-07_rb,6.46130e-07_rb,6.72936e-07_rb, &amp;<a name='4202'>
      7.00512e-07_rb,7.28869e-07_rb,7.58019e-07_rb,7.87971e-07_rb,8.18734e-07_rb, &amp;<a name='4203'>
      8.50320e-07_rb,8.82738e-07_rb,9.15999e-07_rb,9.50110e-07_rb,9.85084e-07_rb, &amp;<a name='4204'>
      1.02093e-06_rb,1.05765e-06_rb,1.09527e-06_rb,1.13378e-06_rb,1.17320e-06_rb, &amp;<a name='4205'>
      1.21353e-06_rb,1.25479e-06_rb,1.29698e-06_rb,1.34011e-06_rb,1.38419e-06_rb, &amp;<a name='4206'>
      1.42923e-06_rb,1.47523e-06_rb,1.52221e-06_rb,1.57016e-06_rb,1.61910e-06_rb, &amp;<a name='4207'>
      1.66904e-06_rb,1.71997e-06_rb,1.77192e-06_rb,1.82488e-06_rb,1.87886e-06_rb, &amp;<a name='4208'>
      1.93387e-06_rb,1.98991e-06_rb,2.04699e-06_rb,2.10512e-06_rb,2.16430e-06_rb, &amp;<a name='4209'>
      2.22454e-06_rb,2.28584e-06_rb,2.34821e-06_rb,2.41166e-06_rb,2.47618e-06_rb, &amp;<a name='4210'>
      2.54178e-06_rb,2.60847e-06_rb,2.67626e-06_rb,2.74514e-06_rb,2.81512e-06_rb/)<a name='4211'>
      totplnk(51:100, 5) = (/ &amp;<a name='4212'>
      2.88621e-06_rb,2.95841e-06_rb,3.03172e-06_rb,3.10615e-06_rb,3.18170e-06_rb, &amp;<a name='4213'>
      3.25838e-06_rb,3.33618e-06_rb,3.41511e-06_rb,3.49518e-06_rb,3.57639e-06_rb, &amp;<a name='4214'>
      3.65873e-06_rb,3.74221e-06_rb,3.82684e-06_rb,3.91262e-06_rb,3.99955e-06_rb, &amp;<a name='4215'>
      4.08763e-06_rb,4.17686e-06_rb,4.26725e-06_rb,4.35880e-06_rb,4.45150e-06_rb, &amp;<a name='4216'>
      4.54537e-06_rb,4.64039e-06_rb,4.73659e-06_rb,4.83394e-06_rb,4.93246e-06_rb, &amp;<a name='4217'>
      5.03215e-06_rb,5.13301e-06_rb,5.23504e-06_rb,5.33823e-06_rb,5.44260e-06_rb, &amp;<a name='4218'>
      5.54814e-06_rb,5.65484e-06_rb,5.76272e-06_rb,5.87177e-06_rb,5.98199e-06_rb, &amp;<a name='4219'>
      6.09339e-06_rb,6.20596e-06_rb,6.31969e-06_rb,6.43460e-06_rb,6.55068e-06_rb, &amp;<a name='4220'>
      6.66793e-06_rb,6.78636e-06_rb,6.90595e-06_rb,7.02670e-06_rb,7.14863e-06_rb, &amp;<a name='4221'>
      7.27173e-06_rb,7.39599e-06_rb,7.52142e-06_rb,7.64802e-06_rb,7.77577e-06_rb/)<a name='4222'>
      totplnk(101:150, 5) = (/ &amp;<a name='4223'>
      7.90469e-06_rb,8.03477e-06_rb,8.16601e-06_rb,8.29841e-06_rb,8.43198e-06_rb, &amp;<a name='4224'>
      8.56669e-06_rb,8.70256e-06_rb,8.83957e-06_rb,8.97775e-06_rb,9.11706e-06_rb, &amp;<a name='4225'>
      9.25753e-06_rb,9.39915e-06_rb,9.54190e-06_rb,9.68580e-06_rb,9.83085e-06_rb, &amp;<a name='4226'>
      9.97704e-06_rb,1.01243e-05_rb,1.02728e-05_rb,1.04224e-05_rb,1.05731e-05_rb, &amp;<a name='4227'>
      1.07249e-05_rb,1.08779e-05_rb,1.10320e-05_rb,1.11872e-05_rb,1.13435e-05_rb, &amp;<a name='4228'>
      1.15009e-05_rb,1.16595e-05_rb,1.18191e-05_rb,1.19799e-05_rb,1.21418e-05_rb, &amp;<a name='4229'>
      1.23048e-05_rb,1.24688e-05_rb,1.26340e-05_rb,1.28003e-05_rb,1.29676e-05_rb, &amp;<a name='4230'>
      1.31361e-05_rb,1.33056e-05_rb,1.34762e-05_rb,1.36479e-05_rb,1.38207e-05_rb, &amp;<a name='4231'>
      1.39945e-05_rb,1.41694e-05_rb,1.43454e-05_rb,1.45225e-05_rb,1.47006e-05_rb, &amp;<a name='4232'>
      1.48797e-05_rb,1.50600e-05_rb,1.52413e-05_rb,1.54236e-05_rb,1.56070e-05_rb/)<a name='4233'>
      totplnk(151:181, 5) = (/ &amp;<a name='4234'>
      1.57914e-05_rb,1.59768e-05_rb,1.61633e-05_rb,1.63509e-05_rb,1.65394e-05_rb, &amp;<a name='4235'>
      1.67290e-05_rb,1.69197e-05_rb,1.71113e-05_rb,1.73040e-05_rb,1.74976e-05_rb, &amp;<a name='4236'>
      1.76923e-05_rb,1.78880e-05_rb,1.80847e-05_rb,1.82824e-05_rb,1.84811e-05_rb, &amp;<a name='4237'>
      1.86808e-05_rb,1.88814e-05_rb,1.90831e-05_rb,1.92857e-05_rb,1.94894e-05_rb, &amp;<a name='4238'>
      1.96940e-05_rb,1.98996e-05_rb,2.01061e-05_rb,2.03136e-05_rb,2.05221e-05_rb, &amp;<a name='4239'>
      2.07316e-05_rb,2.09420e-05_rb,2.11533e-05_rb,2.13657e-05_rb,2.15789e-05_rb, &amp;<a name='4240'>
      2.17931e-05_rb/)<a name='4241'>
      totplnk(1:50, 6) = (/ &amp;<a name='4242'>
      2.73493e-07_rb,2.87408e-07_rb,3.01848e-07_rb,3.16825e-07_rb,3.32352e-07_rb, &amp;<a name='4243'>
      3.48439e-07_rb,3.65100e-07_rb,3.82346e-07_rb,4.00189e-07_rb,4.18641e-07_rb, &amp;<a name='4244'>
      4.37715e-07_rb,4.57422e-07_rb,4.77774e-07_rb,4.98784e-07_rb,5.20464e-07_rb, &amp;<a name='4245'>
      5.42824e-07_rb,5.65879e-07_rb,5.89638e-07_rb,6.14115e-07_rb,6.39320e-07_rb, &amp;<a name='4246'>
      6.65266e-07_rb,6.91965e-07_rb,7.19427e-07_rb,7.47666e-07_rb,7.76691e-07_rb, &amp;<a name='4247'>
      8.06516e-07_rb,8.37151e-07_rb,8.68607e-07_rb,9.00896e-07_rb,9.34029e-07_rb, &amp;<a name='4248'>
      9.68018e-07_rb,1.00287e-06_rb,1.03860e-06_rb,1.07522e-06_rb,1.11274e-06_rb, &amp;<a name='4249'>
      1.15117e-06_rb,1.19052e-06_rb,1.23079e-06_rb,1.27201e-06_rb,1.31418e-06_rb, &amp;<a name='4250'>
      1.35731e-06_rb,1.40141e-06_rb,1.44650e-06_rb,1.49257e-06_rb,1.53965e-06_rb, &amp;<a name='4251'>
      1.58773e-06_rb,1.63684e-06_rb,1.68697e-06_rb,1.73815e-06_rb,1.79037e-06_rb/)<a name='4252'>
      totplnk(51:100, 6) = (/ &amp;<a name='4253'>
      1.84365e-06_rb,1.89799e-06_rb,1.95341e-06_rb,2.00991e-06_rb,2.06750e-06_rb, &amp;<a name='4254'>
      2.12619e-06_rb,2.18599e-06_rb,2.24691e-06_rb,2.30895e-06_rb,2.37212e-06_rb, &amp;<a name='4255'>
      2.43643e-06_rb,2.50189e-06_rb,2.56851e-06_rb,2.63628e-06_rb,2.70523e-06_rb, &amp;<a name='4256'>
      2.77536e-06_rb,2.84666e-06_rb,2.91916e-06_rb,2.99286e-06_rb,3.06776e-06_rb, &amp;<a name='4257'>
      3.14387e-06_rb,3.22120e-06_rb,3.29975e-06_rb,3.37953e-06_rb,3.46054e-06_rb, &amp;<a name='4258'>
      3.54280e-06_rb,3.62630e-06_rb,3.71105e-06_rb,3.79707e-06_rb,3.88434e-06_rb, &amp;<a name='4259'>
      3.97288e-06_rb,4.06270e-06_rb,4.15380e-06_rb,4.24617e-06_rb,4.33984e-06_rb, &amp;<a name='4260'>
      4.43479e-06_rb,4.53104e-06_rb,4.62860e-06_rb,4.72746e-06_rb,4.82763e-06_rb, &amp;<a name='4261'>
      4.92911e-06_rb,5.03191e-06_rb,5.13603e-06_rb,5.24147e-06_rb,5.34824e-06_rb, &amp;<a name='4262'>
      5.45634e-06_rb,5.56578e-06_rb,5.67656e-06_rb,5.78867e-06_rb,5.90213e-06_rb/)<a name='4263'>
      totplnk(101:150, 6) = (/ &amp;<a name='4264'>
      6.01694e-06_rb,6.13309e-06_rb,6.25060e-06_rb,6.36947e-06_rb,6.48968e-06_rb, &amp;<a name='4265'>
      6.61126e-06_rb,6.73420e-06_rb,6.85850e-06_rb,6.98417e-06_rb,7.11120e-06_rb, &amp;<a name='4266'>
      7.23961e-06_rb,7.36938e-06_rb,7.50053e-06_rb,7.63305e-06_rb,7.76694e-06_rb, &amp;<a name='4267'>
      7.90221e-06_rb,8.03887e-06_rb,8.17690e-06_rb,8.31632e-06_rb,8.45710e-06_rb, &amp;<a name='4268'>
      8.59928e-06_rb,8.74282e-06_rb,8.88776e-06_rb,9.03409e-06_rb,9.18179e-06_rb, &amp;<a name='4269'>
      9.33088e-06_rb,9.48136e-06_rb,9.63323e-06_rb,9.78648e-06_rb,9.94111e-06_rb, &amp;<a name='4270'>
      1.00971e-05_rb,1.02545e-05_rb,1.04133e-05_rb,1.05735e-05_rb,1.07351e-05_rb, &amp;<a name='4271'>
      1.08980e-05_rb,1.10624e-05_rb,1.12281e-05_rb,1.13952e-05_rb,1.15637e-05_rb, &amp;<a name='4272'>
      1.17335e-05_rb,1.19048e-05_rb,1.20774e-05_rb,1.22514e-05_rb,1.24268e-05_rb, &amp;<a name='4273'>
      1.26036e-05_rb,1.27817e-05_rb,1.29612e-05_rb,1.31421e-05_rb,1.33244e-05_rb/)<a name='4274'>
      totplnk(151:181, 6) = (/ &amp;<a name='4275'>
      1.35080e-05_rb,1.36930e-05_rb,1.38794e-05_rb,1.40672e-05_rb,1.42563e-05_rb, &amp;<a name='4276'>
      1.44468e-05_rb,1.46386e-05_rb,1.48318e-05_rb,1.50264e-05_rb,1.52223e-05_rb, &amp;<a name='4277'>
      1.54196e-05_rb,1.56182e-05_rb,1.58182e-05_rb,1.60196e-05_rb,1.62223e-05_rb, &amp;<a name='4278'>
      1.64263e-05_rb,1.66317e-05_rb,1.68384e-05_rb,1.70465e-05_rb,1.72559e-05_rb, &amp;<a name='4279'>
      1.74666e-05_rb,1.76787e-05_rb,1.78921e-05_rb,1.81069e-05_rb,1.83230e-05_rb, &amp;<a name='4280'>
      1.85404e-05_rb,1.87591e-05_rb,1.89791e-05_rb,1.92005e-05_rb,1.94232e-05_rb, &amp;<a name='4281'>
      1.96471e-05_rb/)<a name='4282'>
      totplnk(1:50, 7) = (/ &amp;<a name='4283'>
      1.25349e-07_rb,1.32735e-07_rb,1.40458e-07_rb,1.48527e-07_rb,1.56954e-07_rb, &amp;<a name='4284'>
      1.65748e-07_rb,1.74920e-07_rb,1.84481e-07_rb,1.94443e-07_rb,2.04814e-07_rb, &amp;<a name='4285'>
      2.15608e-07_rb,2.26835e-07_rb,2.38507e-07_rb,2.50634e-07_rb,2.63229e-07_rb, &amp;<a name='4286'>
      2.76301e-07_rb,2.89864e-07_rb,3.03930e-07_rb,3.18508e-07_rb,3.33612e-07_rb, &amp;<a name='4287'>
      3.49253e-07_rb,3.65443e-07_rb,3.82195e-07_rb,3.99519e-07_rb,4.17428e-07_rb, &amp;<a name='4288'>
      4.35934e-07_rb,4.55050e-07_rb,4.74785e-07_rb,4.95155e-07_rb,5.16170e-07_rb, &amp;<a name='4289'>
      5.37844e-07_rb,5.60186e-07_rb,5.83211e-07_rb,6.06929e-07_rb,6.31355e-07_rb, &amp;<a name='4290'>
      6.56498e-07_rb,6.82373e-07_rb,7.08990e-07_rb,7.36362e-07_rb,7.64501e-07_rb, &amp;<a name='4291'>
      7.93420e-07_rb,8.23130e-07_rb,8.53643e-07_rb,8.84971e-07_rb,9.17128e-07_rb, &amp;<a name='4292'>
      9.50123e-07_rb,9.83969e-07_rb,1.01868e-06_rb,1.05426e-06_rb,1.09073e-06_rb/)<a name='4293'>
      totplnk(51:100, 7) = (/ &amp;<a name='4294'>
      1.12810e-06_rb,1.16638e-06_rb,1.20558e-06_rb,1.24572e-06_rb,1.28680e-06_rb, &amp;<a name='4295'>
      1.32883e-06_rb,1.37183e-06_rb,1.41581e-06_rb,1.46078e-06_rb,1.50675e-06_rb, &amp;<a name='4296'>
      1.55374e-06_rb,1.60174e-06_rb,1.65078e-06_rb,1.70087e-06_rb,1.75200e-06_rb, &amp;<a name='4297'>
      1.80421e-06_rb,1.85749e-06_rb,1.91186e-06_rb,1.96732e-06_rb,2.02389e-06_rb, &amp;<a name='4298'>
      2.08159e-06_rb,2.14040e-06_rb,2.20035e-06_rb,2.26146e-06_rb,2.32372e-06_rb, &amp;<a name='4299'>
      2.38714e-06_rb,2.45174e-06_rb,2.51753e-06_rb,2.58451e-06_rb,2.65270e-06_rb, &amp;<a name='4300'>
      2.72210e-06_rb,2.79272e-06_rb,2.86457e-06_rb,2.93767e-06_rb,3.01201e-06_rb, &amp;<a name='4301'>
      3.08761e-06_rb,3.16448e-06_rb,3.24261e-06_rb,3.32204e-06_rb,3.40275e-06_rb, &amp;<a name='4302'>
      3.48476e-06_rb,3.56808e-06_rb,3.65271e-06_rb,3.73866e-06_rb,3.82595e-06_rb, &amp;<a name='4303'>
      3.91456e-06_rb,4.00453e-06_rb,4.09584e-06_rb,4.18851e-06_rb,4.28254e-06_rb/)<a name='4304'>
      totplnk(101:150, 7) = (/ &amp;<a name='4305'>
      4.37796e-06_rb,4.47475e-06_rb,4.57293e-06_rb,4.67249e-06_rb,4.77346e-06_rb, &amp;<a name='4306'>
      4.87583e-06_rb,4.97961e-06_rb,5.08481e-06_rb,5.19143e-06_rb,5.29948e-06_rb, &amp;<a name='4307'>
      5.40896e-06_rb,5.51989e-06_rb,5.63226e-06_rb,5.74608e-06_rb,5.86136e-06_rb, &amp;<a name='4308'>
      5.97810e-06_rb,6.09631e-06_rb,6.21597e-06_rb,6.33713e-06_rb,6.45976e-06_rb, &amp;<a name='4309'>
      6.58388e-06_rb,6.70950e-06_rb,6.83661e-06_rb,6.96521e-06_rb,7.09531e-06_rb, &amp;<a name='4310'>
      7.22692e-06_rb,7.36005e-06_rb,7.49468e-06_rb,7.63084e-06_rb,7.76851e-06_rb, &amp;<a name='4311'>
      7.90773e-06_rb,8.04846e-06_rb,8.19072e-06_rb,8.33452e-06_rb,8.47985e-06_rb, &amp;<a name='4312'>
      8.62674e-06_rb,8.77517e-06_rb,8.92514e-06_rb,9.07666e-06_rb,9.22975e-06_rb, &amp;<a name='4313'>
      9.38437e-06_rb,9.54057e-06_rb,9.69832e-06_rb,9.85762e-06_rb,1.00185e-05_rb, &amp;<a name='4314'>
      1.01810e-05_rb,1.03450e-05_rb,1.05106e-05_rb,1.06777e-05_rb,1.08465e-05_rb/)<a name='4315'>
      totplnk(151:181, 7) = (/ &amp;<a name='4316'>
      1.10168e-05_rb,1.11887e-05_rb,1.13621e-05_rb,1.15372e-05_rb,1.17138e-05_rb, &amp;<a name='4317'>
      1.18920e-05_rb,1.20718e-05_rb,1.22532e-05_rb,1.24362e-05_rb,1.26207e-05_rb, &amp;<a name='4318'>
      1.28069e-05_rb,1.29946e-05_rb,1.31839e-05_rb,1.33749e-05_rb,1.35674e-05_rb, &amp;<a name='4319'>
      1.37615e-05_rb,1.39572e-05_rb,1.41544e-05_rb,1.43533e-05_rb,1.45538e-05_rb, &amp;<a name='4320'>
      1.47558e-05_rb,1.49595e-05_rb,1.51647e-05_rb,1.53716e-05_rb,1.55800e-05_rb, &amp;<a name='4321'>
      1.57900e-05_rb,1.60017e-05_rb,1.62149e-05_rb,1.64296e-05_rb,1.66460e-05_rb, &amp;<a name='4322'>
      1.68640e-05_rb/)<a name='4323'>
      totplnk(1:50, 8) = (/ &amp;<a name='4324'>
      6.74445e-08_rb,7.18176e-08_rb,7.64153e-08_rb,8.12456e-08_rb,8.63170e-08_rb, &amp;<a name='4325'>
      9.16378e-08_rb,9.72168e-08_rb,1.03063e-07_rb,1.09184e-07_rb,1.15591e-07_rb, &amp;<a name='4326'>
      1.22292e-07_rb,1.29296e-07_rb,1.36613e-07_rb,1.44253e-07_rb,1.52226e-07_rb, &amp;<a name='4327'>
      1.60540e-07_rb,1.69207e-07_rb,1.78236e-07_rb,1.87637e-07_rb,1.97421e-07_rb, &amp;<a name='4328'>
      2.07599e-07_rb,2.18181e-07_rb,2.29177e-07_rb,2.40598e-07_rb,2.52456e-07_rb, &amp;<a name='4329'>
      2.64761e-07_rb,2.77523e-07_rb,2.90755e-07_rb,3.04468e-07_rb,3.18673e-07_rb, &amp;<a name='4330'>
      3.33381e-07_rb,3.48603e-07_rb,3.64352e-07_rb,3.80638e-07_rb,3.97474e-07_rb, &amp;<a name='4331'>
      4.14871e-07_rb,4.32841e-07_rb,4.51395e-07_rb,4.70547e-07_rb,4.90306e-07_rb, &amp;<a name='4332'>
      5.10687e-07_rb,5.31699e-07_rb,5.53357e-07_rb,5.75670e-07_rb,5.98652e-07_rb, &amp;<a name='4333'>
      6.22315e-07_rb,6.46672e-07_rb,6.71731e-07_rb,6.97511e-07_rb,7.24018e-07_rb/)<a name='4334'>
      totplnk(51:100, 8) = (/ &amp;<a name='4335'>
      7.51266e-07_rb,7.79269e-07_rb,8.08038e-07_rb,8.37584e-07_rb,8.67922e-07_rb, &amp;<a name='4336'>
      8.99061e-07_rb,9.31016e-07_rb,9.63797e-07_rb,9.97417e-07_rb,1.03189e-06_rb, &amp;<a name='4337'>
      1.06722e-06_rb,1.10343e-06_rb,1.14053e-06_rb,1.17853e-06_rb,1.21743e-06_rb, &amp;<a name='4338'>
      1.25726e-06_rb,1.29803e-06_rb,1.33974e-06_rb,1.38241e-06_rb,1.42606e-06_rb, &amp;<a name='4339'>
      1.47068e-06_rb,1.51630e-06_rb,1.56293e-06_rb,1.61056e-06_rb,1.65924e-06_rb, &amp;<a name='4340'>
      1.70894e-06_rb,1.75971e-06_rb,1.81153e-06_rb,1.86443e-06_rb,1.91841e-06_rb, &amp;<a name='4341'>
      1.97350e-06_rb,2.02968e-06_rb,2.08699e-06_rb,2.14543e-06_rb,2.20500e-06_rb, &amp;<a name='4342'>
      2.26573e-06_rb,2.32762e-06_rb,2.39068e-06_rb,2.45492e-06_rb,2.52036e-06_rb, &amp;<a name='4343'>
      2.58700e-06_rb,2.65485e-06_rb,2.72393e-06_rb,2.79424e-06_rb,2.86580e-06_rb, &amp;<a name='4344'>
      2.93861e-06_rb,3.01269e-06_rb,3.08803e-06_rb,3.16467e-06_rb,3.24259e-06_rb/)<a name='4345'>
      totplnk(101:150, 8) = (/ &amp;<a name='4346'>
      3.32181e-06_rb,3.40235e-06_rb,3.48420e-06_rb,3.56739e-06_rb,3.65192e-06_rb, &amp;<a name='4347'>
      3.73779e-06_rb,3.82502e-06_rb,3.91362e-06_rb,4.00359e-06_rb,4.09494e-06_rb, &amp;<a name='4348'>
      4.18768e-06_rb,4.28182e-06_rb,4.37737e-06_rb,4.47434e-06_rb,4.57273e-06_rb, &amp;<a name='4349'>
      4.67254e-06_rb,4.77380e-06_rb,4.87651e-06_rb,4.98067e-06_rb,5.08630e-06_rb, &amp;<a name='4350'>
      5.19339e-06_rb,5.30196e-06_rb,5.41201e-06_rb,5.52356e-06_rb,5.63660e-06_rb, &amp;<a name='4351'>
      5.75116e-06_rb,5.86722e-06_rb,5.98479e-06_rb,6.10390e-06_rb,6.22453e-06_rb, &amp;<a name='4352'>
      6.34669e-06_rb,6.47042e-06_rb,6.59569e-06_rb,6.72252e-06_rb,6.85090e-06_rb, &amp;<a name='4353'>
      6.98085e-06_rb,7.11238e-06_rb,7.24549e-06_rb,7.38019e-06_rb,7.51646e-06_rb, &amp;<a name='4354'>
      7.65434e-06_rb,7.79382e-06_rb,7.93490e-06_rb,8.07760e-06_rb,8.22192e-06_rb, &amp;<a name='4355'>
      8.36784e-06_rb,8.51540e-06_rb,8.66459e-06_rb,8.81542e-06_rb,8.96786e-06_rb/)<a name='4356'>
      totplnk(151:181, 8) = (/ &amp;<a name='4357'>
      9.12197e-06_rb,9.27772e-06_rb,9.43513e-06_rb,9.59419e-06_rb,9.75490e-06_rb, &amp;<a name='4358'>
      9.91728e-06_rb,1.00813e-05_rb,1.02471e-05_rb,1.04144e-05_rb,1.05835e-05_rb, &amp;<a name='4359'>
      1.07543e-05_rb,1.09267e-05_rb,1.11008e-05_rb,1.12766e-05_rb,1.14541e-05_rb, &amp;<a name='4360'>
      1.16333e-05_rb,1.18142e-05_rb,1.19969e-05_rb,1.21812e-05_rb,1.23672e-05_rb, &amp;<a name='4361'>
      1.25549e-05_rb,1.27443e-05_rb,1.29355e-05_rb,1.31284e-05_rb,1.33229e-05_rb, &amp;<a name='4362'>
      1.35193e-05_rb,1.37173e-05_rb,1.39170e-05_rb,1.41185e-05_rb,1.43217e-05_rb, &amp;<a name='4363'>
      1.45267e-05_rb/)<a name='4364'>
      totplnk(1:50, 9) = (/ &amp;<a name='4365'>
      2.61522e-08_rb,2.80613e-08_rb,3.00838e-08_rb,3.22250e-08_rb,3.44899e-08_rb, &amp;<a name='4366'>
      3.68841e-08_rb,3.94129e-08_rb,4.20820e-08_rb,4.48973e-08_rb,4.78646e-08_rb, &amp;<a name='4367'>
      5.09901e-08_rb,5.42799e-08_rb,5.77405e-08_rb,6.13784e-08_rb,6.52001e-08_rb, &amp;<a name='4368'>
      6.92126e-08_rb,7.34227e-08_rb,7.78375e-08_rb,8.24643e-08_rb,8.73103e-08_rb, &amp;<a name='4369'>
      9.23832e-08_rb,9.76905e-08_rb,1.03240e-07_rb,1.09039e-07_rb,1.15097e-07_rb, &amp;<a name='4370'>
      1.21421e-07_rb,1.28020e-07_rb,1.34902e-07_rb,1.42075e-07_rb,1.49548e-07_rb, &amp;<a name='4371'>
      1.57331e-07_rb,1.65432e-07_rb,1.73860e-07_rb,1.82624e-07_rb,1.91734e-07_rb, &amp;<a name='4372'>
      2.01198e-07_rb,2.11028e-07_rb,2.21231e-07_rb,2.31818e-07_rb,2.42799e-07_rb, &amp;<a name='4373'>
      2.54184e-07_rb,2.65983e-07_rb,2.78205e-07_rb,2.90862e-07_rb,3.03963e-07_rb, &amp;<a name='4374'>
      3.17519e-07_rb,3.31541e-07_rb,3.46039e-07_rb,3.61024e-07_rb,3.76507e-07_rb/)<a name='4375'>
      totplnk(51:100, 9) = (/ &amp;<a name='4376'>
      3.92498e-07_rb,4.09008e-07_rb,4.26050e-07_rb,4.43633e-07_rb,4.61769e-07_rb, &amp;<a name='4377'>
      4.80469e-07_rb,4.99744e-07_rb,5.19606e-07_rb,5.40067e-07_rb,5.61136e-07_rb, &amp;<a name='4378'>
      5.82828e-07_rb,6.05152e-07_rb,6.28120e-07_rb,6.51745e-07_rb,6.76038e-07_rb, &amp;<a name='4379'>
      7.01010e-07_rb,7.26674e-07_rb,7.53041e-07_rb,7.80124e-07_rb,8.07933e-07_rb, &amp;<a name='4380'>
      8.36482e-07_rb,8.65781e-07_rb,8.95845e-07_rb,9.26683e-07_rb,9.58308e-07_rb, &amp;<a name='4381'>
      9.90732e-07_rb,1.02397e-06_rb,1.05803e-06_rb,1.09292e-06_rb,1.12866e-06_rb, &amp;<a name='4382'>
      1.16526e-06_rb,1.20274e-06_rb,1.24109e-06_rb,1.28034e-06_rb,1.32050e-06_rb, &amp;<a name='4383'>
      1.36158e-06_rb,1.40359e-06_rb,1.44655e-06_rb,1.49046e-06_rb,1.53534e-06_rb, &amp;<a name='4384'>
      1.58120e-06_rb,1.62805e-06_rb,1.67591e-06_rb,1.72478e-06_rb,1.77468e-06_rb, &amp;<a name='4385'>
      1.82561e-06_rb,1.87760e-06_rb,1.93066e-06_rb,1.98479e-06_rb,2.04000e-06_rb/)<a name='4386'>
      totplnk(101:150, 9) = (/ &amp;<a name='4387'>
      2.09631e-06_rb,2.15373e-06_rb,2.21228e-06_rb,2.27196e-06_rb,2.33278e-06_rb, &amp;<a name='4388'>
      2.39475e-06_rb,2.45790e-06_rb,2.52222e-06_rb,2.58773e-06_rb,2.65445e-06_rb, &amp;<a name='4389'>
      2.72238e-06_rb,2.79152e-06_rb,2.86191e-06_rb,2.93354e-06_rb,3.00643e-06_rb, &amp;<a name='4390'>
      3.08058e-06_rb,3.15601e-06_rb,3.23273e-06_rb,3.31075e-06_rb,3.39009e-06_rb, &amp;<a name='4391'>
      3.47074e-06_rb,3.55272e-06_rb,3.63605e-06_rb,3.72072e-06_rb,3.80676e-06_rb, &amp;<a name='4392'>
      3.89417e-06_rb,3.98297e-06_rb,4.07315e-06_rb,4.16474e-06_rb,4.25774e-06_rb, &amp;<a name='4393'>
      4.35217e-06_rb,4.44802e-06_rb,4.54532e-06_rb,4.64406e-06_rb,4.74428e-06_rb, &amp;<a name='4394'>
      4.84595e-06_rb,4.94911e-06_rb,5.05376e-06_rb,5.15990e-06_rb,5.26755e-06_rb, &amp;<a name='4395'>
      5.37671e-06_rb,5.48741e-06_rb,5.59963e-06_rb,5.71340e-06_rb,5.82871e-06_rb, &amp;<a name='4396'>
      5.94559e-06_rb,6.06403e-06_rb,6.18404e-06_rb,6.30565e-06_rb,6.42885e-06_rb/)<a name='4397'>
      totplnk(151:181, 9) = (/ &amp;<a name='4398'>
      6.55364e-06_rb,6.68004e-06_rb,6.80806e-06_rb,6.93771e-06_rb,7.06898e-06_rb, &amp;<a name='4399'>
      7.20190e-06_rb,7.33646e-06_rb,7.47267e-06_rb,7.61056e-06_rb,7.75010e-06_rb, &amp;<a name='4400'>
      7.89133e-06_rb,8.03423e-06_rb,8.17884e-06_rb,8.32514e-06_rb,8.47314e-06_rb, &amp;<a name='4401'>
      8.62284e-06_rb,8.77427e-06_rb,8.92743e-06_rb,9.08231e-06_rb,9.23893e-06_rb, &amp;<a name='4402'>
      9.39729e-06_rb,9.55741e-06_rb,9.71927e-06_rb,9.88291e-06_rb,1.00483e-05_rb, &amp;<a name='4403'>
      1.02155e-05_rb,1.03844e-05_rb,1.05552e-05_rb,1.07277e-05_rb,1.09020e-05_rb, &amp;<a name='4404'>
      1.10781e-05_rb/)<a name='4405'>
      totplnk(1:50,10) = (/ &amp;<a name='4406'>
      8.89300e-09_rb,9.63263e-09_rb,1.04235e-08_rb,1.12685e-08_rb,1.21703e-08_rb, &amp;<a name='4407'>
      1.31321e-08_rb,1.41570e-08_rb,1.52482e-08_rb,1.64090e-08_rb,1.76428e-08_rb, &amp;<a name='4408'>
      1.89533e-08_rb,2.03441e-08_rb,2.18190e-08_rb,2.33820e-08_rb,2.50370e-08_rb, &amp;<a name='4409'>
      2.67884e-08_rb,2.86402e-08_rb,3.05969e-08_rb,3.26632e-08_rb,3.48436e-08_rb, &amp;<a name='4410'>
      3.71429e-08_rb,3.95660e-08_rb,4.21179e-08_rb,4.48040e-08_rb,4.76294e-08_rb, &amp;<a name='4411'>
      5.05996e-08_rb,5.37201e-08_rb,5.69966e-08_rb,6.04349e-08_rb,6.40411e-08_rb, &amp;<a name='4412'>
      6.78211e-08_rb,7.17812e-08_rb,7.59276e-08_rb,8.02670e-08_rb,8.48059e-08_rb, &amp;<a name='4413'>
      8.95508e-08_rb,9.45090e-08_rb,9.96873e-08_rb,1.05093e-07_rb,1.10733e-07_rb, &amp;<a name='4414'>
      1.16614e-07_rb,1.22745e-07_rb,1.29133e-07_rb,1.35786e-07_rb,1.42711e-07_rb, &amp;<a name='4415'>
      1.49916e-07_rb,1.57410e-07_rb,1.65202e-07_rb,1.73298e-07_rb,1.81709e-07_rb/)<a name='4416'>
      totplnk(51:100,10) = (/ &amp;<a name='4417'>
      1.90441e-07_rb,1.99505e-07_rb,2.08908e-07_rb,2.18660e-07_rb,2.28770e-07_rb, &amp;<a name='4418'>
      2.39247e-07_rb,2.50101e-07_rb,2.61340e-07_rb,2.72974e-07_rb,2.85013e-07_rb, &amp;<a name='4419'>
      2.97467e-07_rb,3.10345e-07_rb,3.23657e-07_rb,3.37413e-07_rb,3.51623e-07_rb, &amp;<a name='4420'>
      3.66298e-07_rb,3.81448e-07_rb,3.97082e-07_rb,4.13212e-07_rb,4.29848e-07_rb, &amp;<a name='4421'>
      4.47000e-07_rb,4.64680e-07_rb,4.82898e-07_rb,5.01664e-07_rb,5.20991e-07_rb, &amp;<a name='4422'>
      5.40888e-07_rb,5.61369e-07_rb,5.82440e-07_rb,6.04118e-07_rb,6.26410e-07_rb, &amp;<a name='4423'>
      6.49329e-07_rb,6.72887e-07_rb,6.97095e-07_rb,7.21964e-07_rb,7.47506e-07_rb, &amp;<a name='4424'>
      7.73732e-07_rb,8.00655e-07_rb,8.28287e-07_rb,8.56635e-07_rb,8.85717e-07_rb, &amp;<a name='4425'>
      9.15542e-07_rb,9.46122e-07_rb,9.77469e-07_rb,1.00960e-06_rb,1.04251e-06_rb, &amp;<a name='4426'>
      1.07623e-06_rb,1.11077e-06_rb,1.14613e-06_rb,1.18233e-06_rb,1.21939e-06_rb/)<a name='4427'>
      totplnk(101:150,10) = (/ &amp;<a name='4428'>
      1.25730e-06_rb,1.29610e-06_rb,1.33578e-06_rb,1.37636e-06_rb,1.41785e-06_rb, &amp;<a name='4429'>
      1.46027e-06_rb,1.50362e-06_rb,1.54792e-06_rb,1.59319e-06_rb,1.63942e-06_rb, &amp;<a name='4430'>
      1.68665e-06_rb,1.73487e-06_rb,1.78410e-06_rb,1.83435e-06_rb,1.88564e-06_rb, &amp;<a name='4431'>
      1.93797e-06_rb,1.99136e-06_rb,2.04582e-06_rb,2.10137e-06_rb,2.15801e-06_rb, &amp;<a name='4432'>
      2.21576e-06_rb,2.27463e-06_rb,2.33462e-06_rb,2.39577e-06_rb,2.45806e-06_rb, &amp;<a name='4433'>
      2.52153e-06_rb,2.58617e-06_rb,2.65201e-06_rb,2.71905e-06_rb,2.78730e-06_rb, &amp;<a name='4434'>
      2.85678e-06_rb,2.92749e-06_rb,2.99946e-06_rb,3.07269e-06_rb,3.14720e-06_rb, &amp;<a name='4435'>
      3.22299e-06_rb,3.30007e-06_rb,3.37847e-06_rb,3.45818e-06_rb,3.53923e-06_rb, &amp;<a name='4436'>
      3.62161e-06_rb,3.70535e-06_rb,3.79046e-06_rb,3.87695e-06_rb,3.96481e-06_rb, &amp;<a name='4437'>
      4.05409e-06_rb,4.14477e-06_rb,4.23687e-06_rb,4.33040e-06_rb,4.42538e-06_rb/)<a name='4438'>
      totplnk(151:181,10) = (/ &amp;<a name='4439'>
      4.52180e-06_rb,4.61969e-06_rb,4.71905e-06_rb,4.81991e-06_rb,4.92226e-06_rb, &amp;<a name='4440'>
      5.02611e-06_rb,5.13148e-06_rb,5.23839e-06_rb,5.34681e-06_rb,5.45681e-06_rb, &amp;<a name='4441'>
      5.56835e-06_rb,5.68146e-06_rb,5.79614e-06_rb,5.91242e-06_rb,6.03030e-06_rb, &amp;<a name='4442'>
      6.14978e-06_rb,6.27088e-06_rb,6.39360e-06_rb,6.51798e-06_rb,6.64398e-06_rb, &amp;<a name='4443'>
      6.77165e-06_rb,6.90099e-06_rb,7.03198e-06_rb,7.16468e-06_rb,7.29906e-06_rb, &amp;<a name='4444'>
      7.43514e-06_rb,7.57294e-06_rb,7.71244e-06_rb,7.85369e-06_rb,7.99666e-06_rb, &amp;<a name='4445'>
      8.14138e-06_rb/)<a name='4446'>
      totplnk(1:50,11) = (/ &amp;<a name='4447'>
      2.53767e-09_rb,2.77242e-09_rb,3.02564e-09_rb,3.29851e-09_rb,3.59228e-09_rb, &amp;<a name='4448'>
      3.90825e-09_rb,4.24777e-09_rb,4.61227e-09_rb,5.00322e-09_rb,5.42219e-09_rb, &amp;<a name='4449'>
      5.87080e-09_rb,6.35072e-09_rb,6.86370e-09_rb,7.41159e-09_rb,7.99628e-09_rb, &amp;<a name='4450'>
      8.61974e-09_rb,9.28404e-09_rb,9.99130e-09_rb,1.07437e-08_rb,1.15436e-08_rb, &amp;<a name='4451'>
      1.23933e-08_rb,1.32953e-08_rb,1.42522e-08_rb,1.52665e-08_rb,1.63410e-08_rb, &amp;<a name='4452'>
      1.74786e-08_rb,1.86820e-08_rb,1.99542e-08_rb,2.12985e-08_rb,2.27179e-08_rb, &amp;<a name='4453'>
      2.42158e-08_rb,2.57954e-08_rb,2.74604e-08_rb,2.92141e-08_rb,3.10604e-08_rb, &amp;<a name='4454'>
      3.30029e-08_rb,3.50457e-08_rb,3.71925e-08_rb,3.94476e-08_rb,4.18149e-08_rb, &amp;<a name='4455'>
      4.42991e-08_rb,4.69043e-08_rb,4.96352e-08_rb,5.24961e-08_rb,5.54921e-08_rb, &amp;<a name='4456'>
      5.86277e-08_rb,6.19081e-08_rb,6.53381e-08_rb,6.89231e-08_rb,7.26681e-08_rb/)<a name='4457'>
      totplnk(51:100,11) = (/ &amp;<a name='4458'>
      7.65788e-08_rb,8.06604e-08_rb,8.49187e-08_rb,8.93591e-08_rb,9.39879e-08_rb, &amp;<a name='4459'>
      9.88106e-08_rb,1.03834e-07_rb,1.09063e-07_rb,1.14504e-07_rb,1.20165e-07_rb, &amp;<a name='4460'>
      1.26051e-07_rb,1.32169e-07_rb,1.38525e-07_rb,1.45128e-07_rb,1.51982e-07_rb, &amp;<a name='4461'>
      1.59096e-07_rb,1.66477e-07_rb,1.74132e-07_rb,1.82068e-07_rb,1.90292e-07_rb, &amp;<a name='4462'>
      1.98813e-07_rb,2.07638e-07_rb,2.16775e-07_rb,2.26231e-07_rb,2.36015e-07_rb, &amp;<a name='4463'>
      2.46135e-07_rb,2.56599e-07_rb,2.67415e-07_rb,2.78592e-07_rb,2.90137e-07_rb, &amp;<a name='4464'>
      3.02061e-07_rb,3.14371e-07_rb,3.27077e-07_rb,3.40186e-07_rb,3.53710e-07_rb, &amp;<a name='4465'>
      3.67655e-07_rb,3.82031e-07_rb,3.96848e-07_rb,4.12116e-07_rb,4.27842e-07_rb, &amp;<a name='4466'>
      4.44039e-07_rb,4.60713e-07_rb,4.77876e-07_rb,4.95537e-07_rb,5.13706e-07_rb, &amp;<a name='4467'>
      5.32392e-07_rb,5.51608e-07_rb,5.71360e-07_rb,5.91662e-07_rb,6.12521e-07_rb/)<a name='4468'>
      totplnk(101:150,11) = (/ &amp;<a name='4469'>
      6.33950e-07_rb,6.55958e-07_rb,6.78556e-07_rb,7.01753e-07_rb,7.25562e-07_rb, &amp;<a name='4470'>
      7.49992e-07_rb,7.75055e-07_rb,8.00760e-07_rb,8.27120e-07_rb,8.54145e-07_rb, &amp;<a name='4471'>
      8.81845e-07_rb,9.10233e-07_rb,9.39318e-07_rb,9.69113e-07_rb,9.99627e-07_rb, &amp;<a name='4472'>
      1.03087e-06_rb,1.06286e-06_rb,1.09561e-06_rb,1.12912e-06_rb,1.16340e-06_rb, &amp;<a name='4473'>
      1.19848e-06_rb,1.23435e-06_rb,1.27104e-06_rb,1.30855e-06_rb,1.34690e-06_rb, &amp;<a name='4474'>
      1.38609e-06_rb,1.42614e-06_rb,1.46706e-06_rb,1.50886e-06_rb,1.55155e-06_rb, &amp;<a name='4475'>
      1.59515e-06_rb,1.63967e-06_rb,1.68512e-06_rb,1.73150e-06_rb,1.77884e-06_rb, &amp;<a name='4476'>
      1.82715e-06_rb,1.87643e-06_rb,1.92670e-06_rb,1.97797e-06_rb,2.03026e-06_rb, &amp;<a name='4477'>
      2.08356e-06_rb,2.13791e-06_rb,2.19330e-06_rb,2.24975e-06_rb,2.30728e-06_rb, &amp;<a name='4478'>
      2.36589e-06_rb,2.42560e-06_rb,2.48641e-06_rb,2.54835e-06_rb,2.61142e-06_rb/)<a name='4479'>
      totplnk(151:181,11) = (/ &amp;<a name='4480'>
      2.67563e-06_rb,2.74100e-06_rb,2.80754e-06_rb,2.87526e-06_rb,2.94417e-06_rb, &amp;<a name='4481'>
      3.01429e-06_rb,3.08562e-06_rb,3.15819e-06_rb,3.23199e-06_rb,3.30704e-06_rb, &amp;<a name='4482'>
      3.38336e-06_rb,3.46096e-06_rb,3.53984e-06_rb,3.62002e-06_rb,3.70151e-06_rb, &amp;<a name='4483'>
      3.78433e-06_rb,3.86848e-06_rb,3.95399e-06_rb,4.04084e-06_rb,4.12907e-06_rb, &amp;<a name='4484'>
      4.21868e-06_rb,4.30968e-06_rb,4.40209e-06_rb,4.49592e-06_rb,4.59117e-06_rb, &amp;<a name='4485'>
      4.68786e-06_rb,4.78600e-06_rb,4.88561e-06_rb,4.98669e-06_rb,5.08926e-06_rb, &amp;<a name='4486'>
      5.19332e-06_rb/)<a name='4487'>
      totplnk(1:50,12) = (/ &amp;<a name='4488'>
      2.73921e-10_rb,3.04500e-10_rb,3.38056e-10_rb,3.74835e-10_rb,4.15099e-10_rb, &amp;<a name='4489'>
      4.59126e-10_rb,5.07214e-10_rb,5.59679e-10_rb,6.16857e-10_rb,6.79103e-10_rb, &amp;<a name='4490'>
      7.46796e-10_rb,8.20335e-10_rb,9.00144e-10_rb,9.86671e-10_rb,1.08039e-09_rb, &amp;<a name='4491'>
      1.18180e-09_rb,1.29142e-09_rb,1.40982e-09_rb,1.53757e-09_rb,1.67529e-09_rb, &amp;<a name='4492'>
      1.82363e-09_rb,1.98327e-09_rb,2.15492e-09_rb,2.33932e-09_rb,2.53726e-09_rb, &amp;<a name='4493'>
      2.74957e-09_rb,2.97710e-09_rb,3.22075e-09_rb,3.48145e-09_rb,3.76020e-09_rb, &amp;<a name='4494'>
      4.05801e-09_rb,4.37595e-09_rb,4.71513e-09_rb,5.07672e-09_rb,5.46193e-09_rb, &amp;<a name='4495'>
      5.87201e-09_rb,6.30827e-09_rb,6.77205e-09_rb,7.26480e-09_rb,7.78794e-09_rb, &amp;<a name='4496'>
      8.34304e-09_rb,8.93163e-09_rb,9.55537e-09_rb,1.02159e-08_rb,1.09151e-08_rb, &amp;<a name='4497'>
      1.16547e-08_rb,1.24365e-08_rb,1.32625e-08_rb,1.41348e-08_rb,1.50554e-08_rb/)<a name='4498'>
      totplnk(51:100,12) = (/ &amp;<a name='4499'>
      1.60264e-08_rb,1.70500e-08_rb,1.81285e-08_rb,1.92642e-08_rb,2.04596e-08_rb, &amp;<a name='4500'>
      2.17171e-08_rb,2.30394e-08_rb,2.44289e-08_rb,2.58885e-08_rb,2.74209e-08_rb, &amp;<a name='4501'>
      2.90290e-08_rb,3.07157e-08_rb,3.24841e-08_rb,3.43371e-08_rb,3.62782e-08_rb, &amp;<a name='4502'>
      3.83103e-08_rb,4.04371e-08_rb,4.26617e-08_rb,4.49878e-08_rb,4.74190e-08_rb, &amp;<a name='4503'>
      4.99589e-08_rb,5.26113e-08_rb,5.53801e-08_rb,5.82692e-08_rb,6.12826e-08_rb, &amp;<a name='4504'>
      6.44245e-08_rb,6.76991e-08_rb,7.11105e-08_rb,7.46634e-08_rb,7.83621e-08_rb, &amp;<a name='4505'>
      8.22112e-08_rb,8.62154e-08_rb,9.03795e-08_rb,9.47081e-08_rb,9.92066e-08_rb, &amp;<a name='4506'>
      1.03879e-07_rb,1.08732e-07_rb,1.13770e-07_rb,1.18998e-07_rb,1.24422e-07_rb, &amp;<a name='4507'>
      1.30048e-07_rb,1.35880e-07_rb,1.41924e-07_rb,1.48187e-07_rb,1.54675e-07_rb, &amp;<a name='4508'>
      1.61392e-07_rb,1.68346e-07_rb,1.75543e-07_rb,1.82988e-07_rb,1.90688e-07_rb/)<a name='4509'>
      totplnk(101:150,12) = (/ &amp;<a name='4510'>
      1.98650e-07_rb,2.06880e-07_rb,2.15385e-07_rb,2.24172e-07_rb,2.33247e-07_rb, &amp;<a name='4511'>
      2.42617e-07_rb,2.52289e-07_rb,2.62272e-07_rb,2.72571e-07_rb,2.83193e-07_rb, &amp;<a name='4512'>
      2.94147e-07_rb,3.05440e-07_rb,3.17080e-07_rb,3.29074e-07_rb,3.41430e-07_rb, &amp;<a name='4513'>
      3.54155e-07_rb,3.67259e-07_rb,3.80747e-07_rb,3.94631e-07_rb,4.08916e-07_rb, &amp;<a name='4514'>
      4.23611e-07_rb,4.38725e-07_rb,4.54267e-07_rb,4.70245e-07_rb,4.86666e-07_rb, &amp;<a name='4515'>
      5.03541e-07_rb,5.20879e-07_rb,5.38687e-07_rb,5.56975e-07_rb,5.75751e-07_rb, &amp;<a name='4516'>
      5.95026e-07_rb,6.14808e-07_rb,6.35107e-07_rb,6.55932e-07_rb,6.77293e-07_rb, &amp;<a name='4517'>
      6.99197e-07_rb,7.21656e-07_rb,7.44681e-07_rb,7.68278e-07_rb,7.92460e-07_rb, &amp;<a name='4518'>
      8.17235e-07_rb,8.42614e-07_rb,8.68606e-07_rb,8.95223e-07_rb,9.22473e-07_rb, &amp;<a name='4519'>
      9.50366e-07_rb,9.78915e-07_rb,1.00813e-06_rb,1.03802e-06_rb,1.06859e-06_rb/)<a name='4520'>
      totplnk(151:181,12) = (/ &amp;<a name='4521'>
      1.09986e-06_rb,1.13184e-06_rb,1.16453e-06_rb,1.19796e-06_rb,1.23212e-06_rb, &amp;<a name='4522'>
      1.26703e-06_rb,1.30270e-06_rb,1.33915e-06_rb,1.37637e-06_rb,1.41440e-06_rb, &amp;<a name='4523'>
      1.45322e-06_rb,1.49286e-06_rb,1.53333e-06_rb,1.57464e-06_rb,1.61679e-06_rb, &amp;<a name='4524'>
      1.65981e-06_rb,1.70370e-06_rb,1.74847e-06_rb,1.79414e-06_rb,1.84071e-06_rb, &amp;<a name='4525'>
      1.88821e-06_rb,1.93663e-06_rb,1.98599e-06_rb,2.03631e-06_rb,2.08759e-06_rb, &amp;<a name='4526'>
      2.13985e-06_rb,2.19310e-06_rb,2.24734e-06_rb,2.30260e-06_rb,2.35888e-06_rb, &amp;<a name='4527'>
      2.41619e-06_rb/)<a name='4528'>
      totplnk(1:50,13) = (/ &amp;<a name='4529'>
      4.53634e-11_rb,5.11435e-11_rb,5.75754e-11_rb,6.47222e-11_rb,7.26531e-11_rb, &amp;<a name='4530'>
      8.14420e-11_rb,9.11690e-11_rb,1.01921e-10_rb,1.13790e-10_rb,1.26877e-10_rb, &amp;<a name='4531'>
      1.41288e-10_rb,1.57140e-10_rb,1.74555e-10_rb,1.93665e-10_rb,2.14613e-10_rb, &amp;<a name='4532'>
      2.37548e-10_rb,2.62633e-10_rb,2.90039e-10_rb,3.19948e-10_rb,3.52558e-10_rb, &amp;<a name='4533'>
      3.88073e-10_rb,4.26716e-10_rb,4.68719e-10_rb,5.14331e-10_rb,5.63815e-10_rb, &amp;<a name='4534'>
      6.17448e-10_rb,6.75526e-10_rb,7.38358e-10_rb,8.06277e-10_rb,8.79625e-10_rb, &amp;<a name='4535'>
      9.58770e-10_rb,1.04410e-09_rb,1.13602e-09_rb,1.23495e-09_rb,1.34135e-09_rb, &amp;<a name='4536'>
      1.45568e-09_rb,1.57845e-09_rb,1.71017e-09_rb,1.85139e-09_rb,2.00268e-09_rb, &amp;<a name='4537'>
      2.16464e-09_rb,2.33789e-09_rb,2.52309e-09_rb,2.72093e-09_rb,2.93212e-09_rb, &amp;<a name='4538'>
      3.15740e-09_rb,3.39757e-09_rb,3.65341e-09_rb,3.92579e-09_rb,4.21559e-09_rb/)<a name='4539'>
      totplnk(51:100,13) = (/ &amp;<a name='4540'>
      4.52372e-09_rb,4.85115e-09_rb,5.19886e-09_rb,5.56788e-09_rb,5.95928e-09_rb, &amp;<a name='4541'>
      6.37419e-09_rb,6.81375e-09_rb,7.27917e-09_rb,7.77168e-09_rb,8.29256e-09_rb, &amp;<a name='4542'>
      8.84317e-09_rb,9.42487e-09_rb,1.00391e-08_rb,1.06873e-08_rb,1.13710e-08_rb, &amp;<a name='4543'>
      1.20919e-08_rb,1.28515e-08_rb,1.36514e-08_rb,1.44935e-08_rb,1.53796e-08_rb, &amp;<a name='4544'>
      1.63114e-08_rb,1.72909e-08_rb,1.83201e-08_rb,1.94008e-08_rb,2.05354e-08_rb, &amp;<a name='4545'>
      2.17258e-08_rb,2.29742e-08_rb,2.42830e-08_rb,2.56545e-08_rb,2.70910e-08_rb, &amp;<a name='4546'>
      2.85950e-08_rb,3.01689e-08_rb,3.18155e-08_rb,3.35373e-08_rb,3.53372e-08_rb, &amp;<a name='4547'>
      3.72177e-08_rb,3.91818e-08_rb,4.12325e-08_rb,4.33727e-08_rb,4.56056e-08_rb, &amp;<a name='4548'>
      4.79342e-08_rb,5.03617e-08_rb,5.28915e-08_rb,5.55270e-08_rb,5.82715e-08_rb, &amp;<a name='4549'>
      6.11286e-08_rb,6.41019e-08_rb,6.71951e-08_rb,7.04119e-08_rb,7.37560e-08_rb/)<a name='4550'>
      totplnk(101:150,13) = (/ &amp;<a name='4551'>
      7.72315e-08_rb,8.08424e-08_rb,8.45927e-08_rb,8.84866e-08_rb,9.25281e-08_rb, &amp;<a name='4552'>
      9.67218e-08_rb,1.01072e-07_rb,1.05583e-07_rb,1.10260e-07_rb,1.15107e-07_rb, &amp;<a name='4553'>
      1.20128e-07_rb,1.25330e-07_rb,1.30716e-07_rb,1.36291e-07_rb,1.42061e-07_rb, &amp;<a name='4554'>
      1.48031e-07_rb,1.54206e-07_rb,1.60592e-07_rb,1.67192e-07_rb,1.74015e-07_rb, &amp;<a name='4555'>
      1.81064e-07_rb,1.88345e-07_rb,1.95865e-07_rb,2.03628e-07_rb,2.11643e-07_rb, &amp;<a name='4556'>
      2.19912e-07_rb,2.28443e-07_rb,2.37244e-07_rb,2.46318e-07_rb,2.55673e-07_rb, &amp;<a name='4557'>
      2.65316e-07_rb,2.75252e-07_rb,2.85489e-07_rb,2.96033e-07_rb,3.06891e-07_rb, &amp;<a name='4558'>
      3.18070e-07_rb,3.29576e-07_rb,3.41417e-07_rb,3.53600e-07_rb,3.66133e-07_rb, &amp;<a name='4559'>
      3.79021e-07_rb,3.92274e-07_rb,4.05897e-07_rb,4.19899e-07_rb,4.34288e-07_rb, &amp;<a name='4560'>
      4.49071e-07_rb,4.64255e-07_rb,4.79850e-07_rb,4.95863e-07_rb,5.12300e-07_rb/)<a name='4561'>
      totplnk(151:181,13) = (/ &amp;<a name='4562'>
      5.29172e-07_rb,5.46486e-07_rb,5.64250e-07_rb,5.82473e-07_rb,6.01164e-07_rb, &amp;<a name='4563'>
      6.20329e-07_rb,6.39979e-07_rb,6.60122e-07_rb,6.80767e-07_rb,7.01922e-07_rb, &amp;<a name='4564'>
      7.23596e-07_rb,7.45800e-07_rb,7.68539e-07_rb,7.91826e-07_rb,8.15669e-07_rb, &amp;<a name='4565'>
      8.40076e-07_rb,8.65058e-07_rb,8.90623e-07_rb,9.16783e-07_rb,9.43544e-07_rb, &amp;<a name='4566'>
      9.70917e-07_rb,9.98912e-07_rb,1.02754e-06_rb,1.05681e-06_rb,1.08673e-06_rb, &amp;<a name='4567'>
      1.11731e-06_rb,1.14856e-06_rb,1.18050e-06_rb,1.21312e-06_rb,1.24645e-06_rb, &amp;<a name='4568'>
      1.28049e-06_rb/)<a name='4569'>
      totplnk(1:50,14) = (/ &amp;<a name='4570'>
      1.40113e-11_rb,1.59358e-11_rb,1.80960e-11_rb,2.05171e-11_rb,2.32266e-11_rb, &amp;<a name='4571'>
      2.62546e-11_rb,2.96335e-11_rb,3.33990e-11_rb,3.75896e-11_rb,4.22469e-11_rb, &amp;<a name='4572'>
      4.74164e-11_rb,5.31466e-11_rb,5.94905e-11_rb,6.65054e-11_rb,7.42522e-11_rb, &amp;<a name='4573'>
      8.27975e-11_rb,9.22122e-11_rb,1.02573e-10_rb,1.13961e-10_rb,1.26466e-10_rb, &amp;<a name='4574'>
      1.40181e-10_rb,1.55206e-10_rb,1.71651e-10_rb,1.89630e-10_rb,2.09265e-10_rb, &amp;<a name='4575'>
      2.30689e-10_rb,2.54040e-10_rb,2.79467e-10_rb,3.07128e-10_rb,3.37190e-10_rb, &amp;<a name='4576'>
      3.69833e-10_rb,4.05243e-10_rb,4.43623e-10_rb,4.85183e-10_rb,5.30149e-10_rb, &amp;<a name='4577'>
      5.78755e-10_rb,6.31255e-10_rb,6.87910e-10_rb,7.49002e-10_rb,8.14824e-10_rb, &amp;<a name='4578'>
      8.85687e-10_rb,9.61914e-10_rb,1.04385e-09_rb,1.13186e-09_rb,1.22631e-09_rb, &amp;<a name='4579'>
      1.32761e-09_rb,1.43617e-09_rb,1.55243e-09_rb,1.67686e-09_rb,1.80992e-09_rb/)<a name='4580'>
      totplnk(51:100,14) = (/ &amp;<a name='4581'>
      1.95212e-09_rb,2.10399e-09_rb,2.26607e-09_rb,2.43895e-09_rb,2.62321e-09_rb, &amp;<a name='4582'>
      2.81949e-09_rb,3.02844e-09_rb,3.25073e-09_rb,3.48707e-09_rb,3.73820e-09_rb, &amp;<a name='4583'>
      4.00490e-09_rb,4.28794e-09_rb,4.58819e-09_rb,4.90647e-09_rb,5.24371e-09_rb, &amp;<a name='4584'>
      5.60081e-09_rb,5.97875e-09_rb,6.37854e-09_rb,6.80120e-09_rb,7.24782e-09_rb, &amp;<a name='4585'>
      7.71950e-09_rb,8.21740e-09_rb,8.74271e-09_rb,9.29666e-09_rb,9.88054e-09_rb, &amp;<a name='4586'>
      1.04956e-08_rb,1.11434e-08_rb,1.18251e-08_rb,1.25422e-08_rb,1.32964e-08_rb, &amp;<a name='4587'>
      1.40890e-08_rb,1.49217e-08_rb,1.57961e-08_rb,1.67140e-08_rb,1.76771e-08_rb, &amp;<a name='4588'>
      1.86870e-08_rb,1.97458e-08_rb,2.08553e-08_rb,2.20175e-08_rb,2.32342e-08_rb, &amp;<a name='4589'>
      2.45077e-08_rb,2.58401e-08_rb,2.72334e-08_rb,2.86900e-08_rb,3.02122e-08_rb, &amp;<a name='4590'>
      3.18021e-08_rb,3.34624e-08_rb,3.51954e-08_rb,3.70037e-08_rb,3.88899e-08_rb/)<a name='4591'>
      totplnk(101:150,14) = (/ &amp;<a name='4592'>
      4.08568e-08_rb,4.29068e-08_rb,4.50429e-08_rb,4.72678e-08_rb,4.95847e-08_rb, &amp;<a name='4593'>
      5.19963e-08_rb,5.45058e-08_rb,5.71161e-08_rb,5.98309e-08_rb,6.26529e-08_rb, &amp;<a name='4594'>
      6.55857e-08_rb,6.86327e-08_rb,7.17971e-08_rb,7.50829e-08_rb,7.84933e-08_rb, &amp;<a name='4595'>
      8.20323e-08_rb,8.57035e-08_rb,8.95105e-08_rb,9.34579e-08_rb,9.75488e-08_rb, &amp;<a name='4596'>
      1.01788e-07_rb,1.06179e-07_rb,1.10727e-07_rb,1.15434e-07_rb,1.20307e-07_rb, &amp;<a name='4597'>
      1.25350e-07_rb,1.30566e-07_rb,1.35961e-07_rb,1.41539e-07_rb,1.47304e-07_rb, &amp;<a name='4598'>
      1.53263e-07_rb,1.59419e-07_rb,1.65778e-07_rb,1.72345e-07_rb,1.79124e-07_rb, &amp;<a name='4599'>
      1.86122e-07_rb,1.93343e-07_rb,2.00792e-07_rb,2.08476e-07_rb,2.16400e-07_rb, &amp;<a name='4600'>
      2.24568e-07_rb,2.32988e-07_rb,2.41666e-07_rb,2.50605e-07_rb,2.59813e-07_rb, &amp;<a name='4601'>
      2.69297e-07_rb,2.79060e-07_rb,2.89111e-07_rb,2.99455e-07_rb,3.10099e-07_rb/)<a name='4602'>
      totplnk(151:181,14) = (/ &amp;<a name='4603'>
      3.21049e-07_rb,3.32311e-07_rb,3.43893e-07_rb,3.55801e-07_rb,3.68041e-07_rb, &amp;<a name='4604'>
      3.80621e-07_rb,3.93547e-07_rb,4.06826e-07_rb,4.20465e-07_rb,4.34473e-07_rb, &amp;<a name='4605'>
      4.48856e-07_rb,4.63620e-07_rb,4.78774e-07_rb,4.94325e-07_rb,5.10280e-07_rb, &amp;<a name='4606'>
      5.26648e-07_rb,5.43436e-07_rb,5.60652e-07_rb,5.78302e-07_rb,5.96397e-07_rb, &amp;<a name='4607'>
      6.14943e-07_rb,6.33949e-07_rb,6.53421e-07_rb,6.73370e-07_rb,6.93803e-07_rb, &amp;<a name='4608'>
      7.14731e-07_rb,7.36157e-07_rb,7.58095e-07_rb,7.80549e-07_rb,8.03533e-07_rb, &amp;<a name='4609'>
      8.27050e-07_rb/)<a name='4610'>
      totplnk(1:50,15) = (/ &amp;<a name='4611'>
      3.90483e-12_rb,4.47999e-12_rb,5.13122e-12_rb,5.86739e-12_rb,6.69829e-12_rb, &amp;<a name='4612'>
      7.63467e-12_rb,8.68833e-12_rb,9.87221e-12_rb,1.12005e-11_rb,1.26885e-11_rb, &amp;<a name='4613'>
      1.43534e-11_rb,1.62134e-11_rb,1.82888e-11_rb,2.06012e-11_rb,2.31745e-11_rb, &amp;<a name='4614'>
      2.60343e-11_rb,2.92087e-11_rb,3.27277e-11_rb,3.66242e-11_rb,4.09334e-11_rb, &amp;<a name='4615'>
      4.56935e-11_rb,5.09455e-11_rb,5.67338e-11_rb,6.31057e-11_rb,7.01127e-11_rb, &amp;<a name='4616'>
      7.78096e-11_rb,8.62554e-11_rb,9.55130e-11_rb,1.05651e-10_rb,1.16740e-10_rb, &amp;<a name='4617'>
      1.28858e-10_rb,1.42089e-10_rb,1.56519e-10_rb,1.72243e-10_rb,1.89361e-10_rb, &amp;<a name='4618'>
      2.07978e-10_rb,2.28209e-10_rb,2.50173e-10_rb,2.73999e-10_rb,2.99820e-10_rb, &amp;<a name='4619'>
      3.27782e-10_rb,3.58034e-10_rb,3.90739e-10_rb,4.26067e-10_rb,4.64196e-10_rb, &amp;<a name='4620'>
      5.05317e-10_rb,5.49631e-10_rb,5.97347e-10_rb,6.48689e-10_rb,7.03891e-10_rb/)<a name='4621'>
      totplnk(51:100,15) = (/ &amp;<a name='4622'>
      7.63201e-10_rb,8.26876e-10_rb,8.95192e-10_rb,9.68430e-10_rb,1.04690e-09_rb, &amp;<a name='4623'>
      1.13091e-09_rb,1.22079e-09_rb,1.31689e-09_rb,1.41957e-09_rb,1.52922e-09_rb, &amp;<a name='4624'>
      1.64623e-09_rb,1.77101e-09_rb,1.90401e-09_rb,2.04567e-09_rb,2.19647e-09_rb, &amp;<a name='4625'>
      2.35690e-09_rb,2.52749e-09_rb,2.70875e-09_rb,2.90127e-09_rb,3.10560e-09_rb, &amp;<a name='4626'>
      3.32238e-09_rb,3.55222e-09_rb,3.79578e-09_rb,4.05375e-09_rb,4.32682e-09_rb, &amp;<a name='4627'>
      4.61574e-09_rb,4.92128e-09_rb,5.24420e-09_rb,5.58536e-09_rb,5.94558e-09_rb, &amp;<a name='4628'>
      6.32575e-09_rb,6.72678e-09_rb,7.14964e-09_rb,7.59526e-09_rb,8.06470e-09_rb, &amp;<a name='4629'>
      8.55897e-09_rb,9.07916e-09_rb,9.62638e-09_rb,1.02018e-08_rb,1.08066e-08_rb, &amp;<a name='4630'>
      1.14420e-08_rb,1.21092e-08_rb,1.28097e-08_rb,1.35446e-08_rb,1.43155e-08_rb, &amp;<a name='4631'>
      1.51237e-08_rb,1.59708e-08_rb,1.68581e-08_rb,1.77873e-08_rb,1.87599e-08_rb/)<a name='4632'>
      totplnk(101:150,15) = (/ &amp;<a name='4633'>
      1.97777e-08_rb,2.08423e-08_rb,2.19555e-08_rb,2.31190e-08_rb,2.43348e-08_rb, &amp;<a name='4634'>
      2.56045e-08_rb,2.69302e-08_rb,2.83140e-08_rb,2.97578e-08_rb,3.12636e-08_rb, &amp;<a name='4635'>
      3.28337e-08_rb,3.44702e-08_rb,3.61755e-08_rb,3.79516e-08_rb,3.98012e-08_rb, &amp;<a name='4636'>
      4.17265e-08_rb,4.37300e-08_rb,4.58143e-08_rb,4.79819e-08_rb,5.02355e-08_rb, &amp;<a name='4637'>
      5.25777e-08_rb,5.50114e-08_rb,5.75393e-08_rb,6.01644e-08_rb,6.28896e-08_rb, &amp;<a name='4638'>
      6.57177e-08_rb,6.86521e-08_rb,7.16959e-08_rb,7.48520e-08_rb,7.81239e-08_rb, &amp;<a name='4639'>
      8.15148e-08_rb,8.50282e-08_rb,8.86675e-08_rb,9.24362e-08_rb,9.63380e-08_rb, &amp;<a name='4640'>
      1.00376e-07_rb,1.04555e-07_rb,1.08878e-07_rb,1.13349e-07_rb,1.17972e-07_rb, &amp;<a name='4641'>
      1.22751e-07_rb,1.27690e-07_rb,1.32793e-07_rb,1.38064e-07_rb,1.43508e-07_rb, &amp;<a name='4642'>
      1.49129e-07_rb,1.54931e-07_rb,1.60920e-07_rb,1.67099e-07_rb,1.73473e-07_rb/)<a name='4643'>
      totplnk(151:181,15) = (/ &amp;<a name='4644'>
      1.80046e-07_rb,1.86825e-07_rb,1.93812e-07_rb,2.01014e-07_rb,2.08436e-07_rb, &amp;<a name='4645'>
      2.16082e-07_rb,2.23957e-07_rb,2.32067e-07_rb,2.40418e-07_rb,2.49013e-07_rb, &amp;<a name='4646'>
      2.57860e-07_rb,2.66963e-07_rb,2.76328e-07_rb,2.85961e-07_rb,2.95868e-07_rb, &amp;<a name='4647'>
      3.06053e-07_rb,3.16524e-07_rb,3.27286e-07_rb,3.38345e-07_rb,3.49707e-07_rb, &amp;<a name='4648'>
      3.61379e-07_rb,3.73367e-07_rb,3.85676e-07_rb,3.98315e-07_rb,4.11287e-07_rb, &amp;<a name='4649'>
      4.24602e-07_rb,4.38265e-07_rb,4.52283e-07_rb,4.66662e-07_rb,4.81410e-07_rb, &amp;<a name='4650'>
      4.96535e-07_rb/)<a name='4651'>
      totplnk(1:50,16) = (/ &amp;<a name='4652'>
      0.28639e-12_rb,0.33349e-12_rb,0.38764e-12_rb,0.44977e-12_rb,0.52093e-12_rb, &amp;<a name='4653'>
      0.60231e-12_rb,0.69522e-12_rb,0.80111e-12_rb,0.92163e-12_rb,0.10586e-11_rb, &amp;<a name='4654'>
      0.12139e-11_rb,0.13899e-11_rb,0.15890e-11_rb,0.18138e-11_rb,0.20674e-11_rb, &amp;<a name='4655'>
      0.23531e-11_rb,0.26744e-11_rb,0.30352e-11_rb,0.34401e-11_rb,0.38936e-11_rb, &amp;<a name='4656'>
      0.44011e-11_rb,0.49681e-11_rb,0.56010e-11_rb,0.63065e-11_rb,0.70919e-11_rb, &amp;<a name='4657'>
      0.79654e-11_rb,0.89357e-11_rb,0.10012e-10_rb,0.11205e-10_rb,0.12526e-10_rb, &amp;<a name='4658'>
      0.13986e-10_rb,0.15600e-10_rb,0.17380e-10_rb,0.19342e-10_rb,0.21503e-10_rb, &amp;<a name='4659'>
      0.23881e-10_rb,0.26494e-10_rb,0.29362e-10_rb,0.32509e-10_rb,0.35958e-10_rb, &amp;<a name='4660'>
      0.39733e-10_rb,0.43863e-10_rb,0.48376e-10_rb,0.53303e-10_rb,0.58679e-10_rb, &amp;<a name='4661'>
      0.64539e-10_rb,0.70920e-10_rb,0.77864e-10_rb,0.85413e-10_rb,0.93615e-10_rb/)<a name='4662'>
      totplnk(51:100,16) = (/ &amp;<a name='4663'>
      0.10252e-09_rb,0.11217e-09_rb,0.12264e-09_rb,0.13397e-09_rb,0.14624e-09_rb, &amp;<a name='4664'>
      0.15950e-09_rb,0.17383e-09_rb,0.18930e-09_rb,0.20599e-09_rb,0.22399e-09_rb, &amp;<a name='4665'>
      0.24339e-09_rb,0.26427e-09_rb,0.28674e-09_rb,0.31090e-09_rb,0.33686e-09_rb, &amp;<a name='4666'>
      0.36474e-09_rb,0.39466e-09_rb,0.42676e-09_rb,0.46115e-09_rb,0.49800e-09_rb, &amp;<a name='4667'>
      0.53744e-09_rb,0.57964e-09_rb,0.62476e-09_rb,0.67298e-09_rb,0.72448e-09_rb, &amp;<a name='4668'>
      0.77945e-09_rb,0.83809e-09_rb,0.90062e-09_rb,0.96725e-09_rb,0.10382e-08_rb, &amp;<a name='4669'>
      0.11138e-08_rb,0.11941e-08_rb,0.12796e-08_rb,0.13704e-08_rb,0.14669e-08_rb, &amp;<a name='4670'>
      0.15694e-08_rb,0.16781e-08_rb,0.17934e-08_rb,0.19157e-08_rb,0.20453e-08_rb, &amp;<a name='4671'>
      0.21825e-08_rb,0.23278e-08_rb,0.24815e-08_rb,0.26442e-08_rb,0.28161e-08_rb, &amp;<a name='4672'>
      0.29978e-08_rb,0.31898e-08_rb,0.33925e-08_rb,0.36064e-08_rb,0.38321e-08_rb/)<a name='4673'>
      totplnk(101:150,16) = (/ &amp;<a name='4674'>
      0.40700e-08_rb,0.43209e-08_rb,0.45852e-08_rb,0.48636e-08_rb,0.51567e-08_rb, &amp;<a name='4675'>
      0.54652e-08_rb,0.57897e-08_rb,0.61310e-08_rb,0.64897e-08_rb,0.68667e-08_rb, &amp;<a name='4676'>
      0.72626e-08_rb,0.76784e-08_rb,0.81148e-08_rb,0.85727e-08_rb,0.90530e-08_rb, &amp;<a name='4677'>
      0.95566e-08_rb,0.10084e-07_rb,0.10638e-07_rb,0.11217e-07_rb,0.11824e-07_rb, &amp;<a name='4678'>
      0.12458e-07_rb,0.13123e-07_rb,0.13818e-07_rb,0.14545e-07_rb,0.15305e-07_rb, &amp;<a name='4679'>
      0.16099e-07_rb,0.16928e-07_rb,0.17795e-07_rb,0.18699e-07_rb,0.19643e-07_rb, &amp;<a name='4680'>
      0.20629e-07_rb,0.21656e-07_rb,0.22728e-07_rb,0.23845e-07_rb,0.25010e-07_rb, &amp;<a name='4681'>
      0.26223e-07_rb,0.27487e-07_rb,0.28804e-07_rb,0.30174e-07_rb,0.31600e-07_rb, &amp;<a name='4682'>
      0.33084e-07_rb,0.34628e-07_rb,0.36233e-07_rb,0.37902e-07_rb,0.39637e-07_rb, &amp;<a name='4683'>
      0.41440e-07_rb,0.43313e-07_rb,0.45259e-07_rb,0.47279e-07_rb,0.49376e-07_rb/)<a name='4684'>
      totplnk(151:181,16) = (/ &amp;<a name='4685'>
      0.51552e-07_rb,0.53810e-07_rb,0.56153e-07_rb,0.58583e-07_rb,0.61102e-07_rb, &amp;<a name='4686'>
      0.63713e-07_rb,0.66420e-07_rb,0.69224e-07_rb,0.72129e-07_rb,0.75138e-07_rb, &amp;<a name='4687'>
      0.78254e-07_rb,0.81479e-07_rb,0.84818e-07_rb,0.88272e-07_rb,0.91846e-07_rb, &amp;<a name='4688'>
      0.95543e-07_rb,0.99366e-07_rb,0.10332e-06_rb,0.10740e-06_rb,0.11163e-06_rb, &amp;<a name='4689'>
      0.11599e-06_rb,0.12050e-06_rb,0.12515e-06_rb,0.12996e-06_rb,0.13493e-06_rb, &amp;<a name='4690'>
      0.14005e-06_rb,0.14534e-06_rb,0.15080e-06_rb,0.15643e-06_rb,0.16224e-06_rb, &amp;<a name='4691'>
      0.16823e-06_rb/)<a name='4692'>
      totplk16(1:50) = (/ &amp;<a name='4693'>
      0.28481e-12_rb,0.33159e-12_rb,0.38535e-12_rb,0.44701e-12_rb,0.51763e-12_rb, &amp;<a name='4694'>
      0.59836e-12_rb,0.69049e-12_rb,0.79549e-12_rb,0.91493e-12_rb,0.10506e-11_rb, &amp;<a name='4695'>
      0.12045e-11_rb,0.13788e-11_rb,0.15758e-11_rb,0.17984e-11_rb,0.20493e-11_rb, &amp;<a name='4696'>
      0.23317e-11_rb,0.26494e-11_rb,0.30060e-11_rb,0.34060e-11_rb,0.38539e-11_rb, &amp;<a name='4697'>
      0.43548e-11_rb,0.49144e-11_rb,0.55387e-11_rb,0.62344e-11_rb,0.70086e-11_rb, &amp;<a name='4698'>
      0.78692e-11_rb,0.88248e-11_rb,0.98846e-11_rb,0.11059e-10_rb,0.12358e-10_rb, &amp;<a name='4699'>
      0.13794e-10_rb,0.15379e-10_rb,0.17128e-10_rb,0.19055e-10_rb,0.21176e-10_rb, &amp;<a name='4700'>
      0.23508e-10_rb,0.26070e-10_rb,0.28881e-10_rb,0.31963e-10_rb,0.35339e-10_rb, &amp;<a name='4701'>
      0.39034e-10_rb,0.43073e-10_rb,0.47484e-10_rb,0.52299e-10_rb,0.57548e-10_rb, &amp;<a name='4702'>
      0.63267e-10_rb,0.69491e-10_rb,0.76261e-10_rb,0.83616e-10_rb,0.91603e-10_rb/)<a name='4703'>
      totplk16(51:100) = (/ &amp;<a name='4704'>
      0.10027e-09_rb,0.10966e-09_rb,0.11983e-09_rb,0.13084e-09_rb,0.14275e-09_rb, &amp;<a name='4705'>
      0.15562e-09_rb,0.16951e-09_rb,0.18451e-09_rb,0.20068e-09_rb,0.21810e-09_rb, &amp;<a name='4706'>
      0.23686e-09_rb,0.25704e-09_rb,0.27875e-09_rb,0.30207e-09_rb,0.32712e-09_rb, &amp;<a name='4707'>
      0.35400e-09_rb,0.38282e-09_rb,0.41372e-09_rb,0.44681e-09_rb,0.48223e-09_rb, &amp;<a name='4708'>
      0.52013e-09_rb,0.56064e-09_rb,0.60392e-09_rb,0.65015e-09_rb,0.69948e-09_rb, &amp;<a name='4709'>
      0.75209e-09_rb,0.80818e-09_rb,0.86794e-09_rb,0.93157e-09_rb,0.99929e-09_rb, &amp;<a name='4710'>
      0.10713e-08_rb,0.11479e-08_rb,0.12293e-08_rb,0.13157e-08_rb,0.14074e-08_rb, &amp;<a name='4711'>
      0.15047e-08_rb,0.16079e-08_rb,0.17172e-08_rb,0.18330e-08_rb,0.19557e-08_rb, &amp;<a name='4712'>
      0.20855e-08_rb,0.22228e-08_rb,0.23680e-08_rb,0.25214e-08_rb,0.26835e-08_rb, &amp;<a name='4713'>
      0.28546e-08_rb,0.30352e-08_rb,0.32257e-08_rb,0.34266e-08_rb,0.36384e-08_rb/)<a name='4714'>
      totplk16(101:150) = (/ &amp;<a name='4715'>
      0.38615e-08_rb,0.40965e-08_rb,0.43438e-08_rb,0.46041e-08_rb,0.48779e-08_rb, &amp;<a name='4716'>
      0.51658e-08_rb,0.54683e-08_rb,0.57862e-08_rb,0.61200e-08_rb,0.64705e-08_rb, &amp;<a name='4717'>
      0.68382e-08_rb,0.72240e-08_rb,0.76285e-08_rb,0.80526e-08_rb,0.84969e-08_rb, &amp;<a name='4718'>
      0.89624e-08_rb,0.94498e-08_rb,0.99599e-08_rb,0.10494e-07_rb,0.11052e-07_rb, &amp;<a name='4719'>
      0.11636e-07_rb,0.12246e-07_rb,0.12884e-07_rb,0.13551e-07_rb,0.14246e-07_rb, &amp;<a name='4720'>
      0.14973e-07_rb,0.15731e-07_rb,0.16522e-07_rb,0.17347e-07_rb,0.18207e-07_rb, &amp;<a name='4721'>
      0.19103e-07_rb,0.20037e-07_rb,0.21011e-07_rb,0.22024e-07_rb,0.23079e-07_rb, &amp;<a name='4722'>
      0.24177e-07_rb,0.25320e-07_rb,0.26508e-07_rb,0.27744e-07_rb,0.29029e-07_rb, &amp;<a name='4723'>
      0.30365e-07_rb,0.31753e-07_rb,0.33194e-07_rb,0.34691e-07_rb,0.36246e-07_rb, &amp;<a name='4724'>
      0.37859e-07_rb,0.39533e-07_rb,0.41270e-07_rb,0.43071e-07_rb,0.44939e-07_rb/)<a name='4725'>
      totplk16(151:181) = (/ &amp;<a name='4726'>
      0.46875e-07_rb,0.48882e-07_rb,0.50961e-07_rb,0.53115e-07_rb,0.55345e-07_rb, &amp;<a name='4727'>
      0.57655e-07_rb,0.60046e-07_rb,0.62520e-07_rb,0.65080e-07_rb,0.67728e-07_rb, &amp;<a name='4728'>
      0.70466e-07_rb,0.73298e-07_rb,0.76225e-07_rb,0.79251e-07_rb,0.82377e-07_rb, &amp;<a name='4729'>
      0.85606e-07_rb,0.88942e-07_rb,0.92386e-07_rb,0.95942e-07_rb,0.99612e-07_rb, &amp;<a name='4730'>
      0.10340e-06_rb,0.10731e-06_rb,0.11134e-06_rb,0.11550e-06_rb,0.11979e-06_rb, &amp;<a name='4731'>
      0.12421e-06_rb,0.12876e-06_rb,0.13346e-06_rb,0.13830e-06_rb,0.14328e-06_rb, &amp;<a name='4732'>
      0.14841e-06_rb/)<a name='4733'>
<a name='4734'>
      end subroutine lwavplank<a name='4735'>
<a name='4736'>
      end module rrtmg_lw_setcoef<a name='4737'>
<a name='4738'>
<font color=#447700>!     path:      $Source: /storm/rc1/cvsroot/rc/rrtmg_lw/src/rrtmg_lw_taumol.f90,v $<a name='4739'></font>
<font color=#447700>!     author:    $Author: mike $<a name='4740'></font>
<font color=#447700>!     revision:  $Revision: 1.7 $<a name='4741'></font>
<font color=#447700>!     created:   $Date: 2009/10/20 15:08:37 $<a name='4742'></font>
<font color=#447700>!<a name='4743'></font>
<A NAME='RRTMG_LW_TAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4744'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_taumol</font> <A href='../../call_to/RRTMG_LW_TAUMOL.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_TAUMOL.html' TARGET='index'>5</A><a name='4745'>
<a name='4746'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4747'></font>
<font color=#447700>! |                                                                          |<a name='4748'></font>
<font color=#447700>! |  Copyright 2002-2009, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='4749'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='4750'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='4751'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='4752'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='4753'></font>
<font color=#447700>! |                                                                          |<a name='4754'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='4755'></font>
<a name='4756'>
<font color=#447700>! ------- Modules -------<a name='4757'></font>
<a name='4758'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_29">, only : im =&gt; kind_im, rb =&gt; kind_rb <a name='4759'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_6">, only : mg, nbndlw, maxxsec, ngptlw<a name='4760'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_3">, only: oneminus<a name='4761'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_5">, only: nspa, nspb<a name='4762'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_5">, only: hvrtau, hnamtau<a name='4763'>
<a name='4764'>
      implicit none<a name='4765'>
<a name='4766'>
      contains<a name='4767'>
<a name='4768'>
<font color=#447700>!----------------------------------------------------------------------------<a name='4769'></font>
<A NAME='TAUMOL'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4770'>
      <font color=#993300>subroutine </font><font color=#cc0000>taumol</font>(nlayers, pavel, wx, coldry, &amp; <A href='../../call_to/TAUMOL.html' TARGET='index'>1</A>,<A href='../../call_from/TAUMOL.html' TARGET='index'>16</A><a name='4771'>
                        laytrop, jp, jt, jt1, planklay, planklev, plankbnd, &amp;<a name='4772'>
                        colh2o, colco2, colo3, coln2o, colco, colch4, colo2, &amp;<a name='4773'>
                        colbrd, fac00, fac01, fac10, fac11, &amp;<a name='4774'>
                        rat_h2oco2, rat_h2oco2_1, rat_h2oo3, rat_h2oo3_1, &amp;<a name='4775'>
                        rat_h2on2o, rat_h2on2o_1, rat_h2och4, rat_h2och4_1, &amp;<a name='4776'>
                        rat_n2oco2, rat_n2oco2_1, rat_o3co2, rat_o3co2_1, &amp;<a name='4777'>
                        selffac, selffrac, indself, forfac, forfrac, indfor, &amp;<a name='4778'>
                        minorfrac, scaleminor, scaleminorn2, indminor, &amp;<a name='4779'>
                        fracs, taug)<a name='4780'>
<font color=#447700>!----------------------------------------------------------------------------<a name='4781'></font>
<a name='4782'>
<font color=#447700>! *******************************************************************************<a name='4783'></font>
<font color=#447700>! *                                                                             *<a name='4784'></font>
<font color=#447700>! *                  Optical depths developed for the                           *<a name='4785'></font>
<font color=#447700>! *                                                                             *<a name='4786'></font>
<font color=#447700>! *                RAPID RADIATIVE TRANSFER MODEL (RRTM)                        *<a name='4787'></font>
<font color=#447700>! *                                                                             *<a name='4788'></font>
<font color=#447700>! *                                                                             *<a name='4789'></font>
<font color=#447700>! *            ATMOSPHERIC AND ENVIRONMENTAL RESEARCH, INC.                     *<a name='4790'></font>
<font color=#447700>! *                        131 HARTWELL AVENUE                                  *<a name='4791'></font>
<font color=#447700>! *                        LEXINGTON, MA 02421                                  *<a name='4792'></font>
<font color=#447700>! *                                                                             *<a name='4793'></font>
<font color=#447700>! *                                                                             *<a name='4794'></font>
<font color=#447700>! *                           ELI J. MLAWER                                     * <a name='4795'></font>
<font color=#447700>! *                         JENNIFER DELAMERE                                   * <a name='4796'></font>
<font color=#447700>! *                         STEVEN J. TAUBMAN                                   *<a name='4797'></font>
<font color=#447700>! *                         SHEPARD A. CLOUGH                                   *<a name='4798'></font>
<font color=#447700>! *                                                                             *<a name='4799'></font>
<font color=#447700>! *                                                                             *<a name='4800'></font>
<font color=#447700>! *                                                                             *<a name='4801'></font>
<font color=#447700>! *                                                                             *<a name='4802'></font>
<font color=#447700>! *                       email:  mlawer@aer.com                                *<a name='4803'></font>
<font color=#447700>! *                       email:  jdelamer@aer.com                              *<a name='4804'></font>
<font color=#447700>! *                                                                             *<a name='4805'></font>
<font color=#447700>! *        The authors wish to acknowledge the contributions of the             *<a name='4806'></font>
<font color=#447700>! *        following people:  Karen Cady-Pereira, Patrick D. Brown,             *  <a name='4807'></font>
<font color=#447700>! *        Michael J. Iacono, Ronald E. Farren, Luke Chen, Robert Bergstrom.    *<a name='4808'></font>
<font color=#447700>! *                                                                             *<a name='4809'></font>
<font color=#447700>! *******************************************************************************<a name='4810'></font>
<font color=#447700>! *                                                                             *<a name='4811'></font>
<font color=#447700>! *  Revision for g-point reduction: Michael J. Iacono, AER, Inc.               *<a name='4812'></font>
<font color=#447700>! *                                                                             *<a name='4813'></font>
<font color=#447700>! *******************************************************************************<a name='4814'></font>
<font color=#447700>! *     TAUMOL                                                                  *<a name='4815'></font>
<font color=#447700>! *                                                                             *<a name='4816'></font>
<font color=#447700>! *     This file contains the subroutines TAUGBn (where n goes from            *<a name='4817'></font>
<font color=#447700>! *     1 to 16).  TAUGBn calculates the optical depths and Planck fractions    *<a name='4818'></font>
<font color=#447700>! *     per g-value and layer for band n.                                       *<a name='4819'></font>
<font color=#447700>! *                                                                             *<a name='4820'></font>
<font color=#447700>! *  Output:  optical depths (unitless)                                         *<a name='4821'></font>
<font color=#447700>! *           fractions needed to compute Planck functions at every layer       *<a name='4822'></font>
<font color=#447700>! *               and g-value                                                   *<a name='4823'></font>
<font color=#447700>! *                                                                             *<a name='4824'></font>
<font color=#447700>! *     COMMON /TAUGCOM/  TAUG(MXLAY,MG)                                        *<a name='4825'></font>
<font color=#447700>! *     COMMON /PLANKG/   FRACS(MXLAY,MG)                                       *<a name='4826'></font>
<font color=#447700>! *                                                                             *<a name='4827'></font>
<font color=#447700>! *  Input                                                                      *<a name='4828'></font>
<font color=#447700>! *                                                                             *<a name='4829'></font>
<font color=#447700>! *     COMMON /FEATURES/ NG(NBANDS),NSPA(NBANDS),NSPB(NBANDS)                  *<a name='4830'></font>
<font color=#447700>! *     COMMON /PRECISE/  ONEMINUS                                              *<a name='4831'></font>
<font color=#447700>! *     COMMON /PROFILE/  NLAYERS,PAVEL(MXLAY),TAVEL(MXLAY),                    *<a name='4832'></font>
<font color=#447700>! *     &amp;                 PZ(0:MXLAY),TZ(0:MXLAY)                               *<a name='4833'></font>
<font color=#447700>! *     COMMON /PROFDATA/ LAYTROP,                                              *<a name='4834'></font>
<font color=#447700>! *    &amp;                  COLH2O(MXLAY),COLCO2(MXLAY),COLO3(MXLAY),             *<a name='4835'></font>
<font color=#447700>! *    &amp;                  COLN2O(MXLAY),COLCO(MXLAY),COLCH4(MXLAY),             *<a name='4836'></font>
<font color=#447700>! *    &amp;                  COLO2(MXLAY)<a name='4837'></font>
<font color=#447700>! *     COMMON /INTFAC/   FAC00(MXLAY),FAC01(MXLAY),                            *<a name='4838'></font>
<font color=#447700>! *    &amp;                  FAC10(MXLAY),FAC11(MXLAY)                             *<a name='4839'></font>
<font color=#447700>! *     COMMON /INTIND/   JP(MXLAY),JT(MXLAY),JT1(MXLAY)                        *<a name='4840'></font>
<font color=#447700>! *     COMMON /SELF/     SELFFAC(MXLAY), SELFFRAC(MXLAY), INDSELF(MXLAY)       *<a name='4841'></font>
<font color=#447700>! *                                                                             *<a name='4842'></font>
<font color=#447700>! *     Description:                                                            *<a name='4843'></font>
<font color=#447700>! *     NG(IBAND) - number of g-values in band IBAND                            *<a name='4844'></font>
<font color=#447700>! *     NSPA(IBAND) - for the lower atmosphere, the number of reference         *<a name='4845'></font>
<font color=#447700>! *                   atmospheres that are stored for band IBAND per            *<a name='4846'></font>
<font color=#447700>! *                   pressure level and temperature.  Each of these            *<a name='4847'></font>
<font color=#447700>! *                   atmospheres has different relative amounts of the         *<a name='4848'></font>
<font color=#447700>! *                   key species for the band (i.e. different binary           *<a name='4849'></font>
<font color=#447700>! *                   species parameters).                                      *<a name='4850'></font>
<font color=#447700>! *     NSPB(IBAND) - same for upper atmosphere                                 *<a name='4851'></font>
<font color=#447700>! *     ONEMINUS - since problems are caused in some cases by interpolation     *<a name='4852'></font>
<font color=#447700>! *                parameters equal to or greater than 1, for these cases       *<a name='4853'></font>
<font color=#447700>! *                these parameters are set to this value, slightly &lt; 1.        *<a name='4854'></font>
<font color=#447700>! *     PAVEL - layer pressures (mb)                                            *<a name='4855'></font>
<font color=#447700>! *     TAVEL - layer temperatures (degrees K)                                  *<a name='4856'></font>
<font color=#447700>! *     PZ - level pressures (mb)                                               *<a name='4857'></font>
<font color=#447700>! *     TZ - level temperatures (degrees K)                                     *<a name='4858'></font>
<font color=#447700>! *     LAYTROP - layer at which switch is made from one combination of         *<a name='4859'></font>
<font color=#447700>! *               key species to another                                        *<a name='4860'></font>
<font color=#447700>! *     COLH2O, COLCO2, COLO3, COLN2O, COLCH4 - column amounts of water         *<a name='4861'></font>
<font color=#447700>! *               vapor,carbon dioxide, ozone, nitrous ozide, methane,          *<a name='4862'></font>
<font color=#447700>! *               respectively (molecules/cm**2)                                *<a name='4863'></font>
<font color=#447700>! *     FACij(LAY) - for layer LAY, these are factors that are needed to        *<a name='4864'></font>
<font color=#447700>! *                  compute the interpolation factors that multiply the        *<a name='4865'></font>
<font color=#447700>! *                  appropriate reference k-values.  A value of 0 (1) for      *<a name='4866'></font>
<font color=#447700>! *                  i,j indicates that the corresponding factor multiplies     *<a name='4867'></font>
<font color=#447700>! *                  reference k-value for the lower (higher) of the two        *<a name='4868'></font>
<font color=#447700>! *                  appropriate temperatures, and altitudes, respectively.     *<a name='4869'></font>
<font color=#447700>! *     JP - the index of the lower (in altitude) of the two appropriate        *<a name='4870'></font>
<font color=#447700>! *          reference pressure levels needed for interpolation                 *<a name='4871'></font>
<font color=#447700>! *     JT, JT1 - the indices of the lower of the two appropriate reference     *<a name='4872'></font>
<font color=#447700>! *               temperatures needed for interpolation (for pressure           *<a name='4873'></font>
<font color=#447700>! *               levels JP and JP+1, respectively)                             *<a name='4874'></font>
<font color=#447700>! *     SELFFAC - scale factor needed for water vapor self-continuum, equals    *<a name='4875'></font>
<font color=#447700>! *               (water vapor density)/(atmospheric density at 296K and        *<a name='4876'></font>
<font color=#447700>! *               1013 mb)                                                      *<a name='4877'></font>
<font color=#447700>! *     SELFFRAC - factor needed for temperature interpolation of reference     *<a name='4878'></font>
<font color=#447700>! *                water vapor self-continuum data                              *<a name='4879'></font>
<font color=#447700>! *     INDSELF - index of the lower of the two appropriate reference           *<a name='4880'></font>
<font color=#447700>! *               temperatures needed for the self-continuum interpolation      *<a name='4881'></font>
<font color=#447700>! *     FORFAC  - scale factor needed for water vapor foreign-continuum.        *<a name='4882'></font>
<font color=#447700>! *     FORFRAC - factor needed for temperature interpolation of reference      *<a name='4883'></font>
<font color=#447700>! *                water vapor foreign-continuum data                           *<a name='4884'></font>
<font color=#447700>! *     INDFOR  - index of the lower of the two appropriate reference           *<a name='4885'></font>
<font color=#447700>! *               temperatures needed for the foreign-continuum interpolation   *<a name='4886'></font>
<font color=#447700>! *                                                                             *<a name='4887'></font>
<font color=#447700>! *  Data input                                                                 *<a name='4888'></font>
<font color=#447700>! *     COMMON /Kn/ KA(NSPA(n),5,13,MG), KB(NSPB(n),5,13:59,MG), SELFREF(10,MG),*<a name='4889'></font>
<font color=#447700>! *                 FORREF(4,MG), KA_M'MGAS', KB_M'MGAS'                        *<a name='4890'></font>
<font color=#447700>! *        (note:  n is the band number,'MGAS' is the species name of the minor *<a name='4891'></font>
<font color=#447700>! *         gas)                                                                *<a name='4892'></font>
<font color=#447700>! *                                                                             *<a name='4893'></font>
<font color=#447700>! *     Description:                                                            *<a name='4894'></font>
<font color=#447700>! *     KA - k-values for low reference atmospheres (key-species only)          *<a name='4895'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='4896'></font>
<font color=#447700>! *     KB - k-values for high reference atmospheres (key-species only)         *<a name='4897'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='4898'></font>
<font color=#447700>! *     KA_M'MGAS' - k-values for low reference atmosphere minor species        *<a name='4899'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='4900'></font>
<font color=#447700>! *     KB_M'MGAS' - k-values for high reference atmosphere minor species       *<a name='4901'></font>
<font color=#447700>! *          (units: cm**2/molecule)                                            *<a name='4902'></font>
<font color=#447700>! *     SELFREF - k-values for water vapor self-continuum for reference         *<a name='4903'></font>
<font color=#447700>! *               atmospheres (used below LAYTROP)                              *<a name='4904'></font>
<font color=#447700>! *               (units: cm**2/molecule)                                       *<a name='4905'></font>
<font color=#447700>! *     FORREF  - k-values for water vapor foreign-continuum for reference      *<a name='4906'></font>
<font color=#447700>! *               atmospheres (used below/above LAYTROP)                        *<a name='4907'></font>
<font color=#447700>! *               (units: cm**2/molecule)                                       *<a name='4908'></font>
<font color=#447700>! *                                                                             *<a name='4909'></font>
<font color=#447700>! *     DIMENSION ABSA(65*NSPA(n),MG), ABSB(235*NSPB(n),MG)                     *<a name='4910'></font>
<font color=#447700>! *     EQUIVALENCE (KA,ABSA),(KB,ABSB)                                         *<a name='4911'></font>
<font color=#447700>! *                                                                             *<a name='4912'></font>
<font color=#447700>!*******************************************************************************<a name='4913'></font>
<a name='4914'>
<font color=#447700>! ------- Declarations -------<a name='4915'></font>
<a name='4916'>
<font color=#447700>! ----- Input -----<a name='4917'></font>
      integer(kind=im), intent(in) :: nlayers         <font color=#447700>! total number of layers<a name='4918'></font>
      real(kind=rb), intent(in) :: pavel(:)           <font color=#447700>! layer pressures (mb) <a name='4919'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4920'></font>
      real(kind=rb), intent(in) :: wx(:,:)            <font color=#447700>! cross-section amounts (mol/cm2)<a name='4921'></font>
                                                      <font color=#447700>!    Dimensions: (maxxsec,nlayers)<a name='4922'></font>
      real(kind=rb), intent(in) :: coldry(:)          <font color=#447700>! column amount (dry air)<a name='4923'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4924'></font>
<a name='4925'>
      integer(kind=im), intent(in) :: laytrop         <font color=#447700>! tropopause layer index<a name='4926'></font>
      integer(kind=im), intent(in) :: jp(:)           <font color=#447700>! <a name='4927'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4928'></font>
      integer(kind=im), intent(in) :: jt(:)           <font color=#447700>!<a name='4929'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4930'></font>
      integer(kind=im), intent(in) :: jt1(:)          <font color=#447700>!<a name='4931'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4932'></font>
      real(kind=rb), intent(in) :: planklay(:,:)      <font color=#447700>! <a name='4933'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,nbndlw)<a name='4934'></font>
      real(kind=rb), intent(in) :: planklev(0:,:)     <font color=#447700>! <a name='4935'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,nbndlw)<a name='4936'></font>
      real(kind=rb), intent(in) :: plankbnd(:)        <font color=#447700>! <a name='4937'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='4938'></font>
<a name='4939'>
      real(kind=rb), intent(in) :: colh2o(:)          <font color=#447700>! column amount (h2o)<a name='4940'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4941'></font>
      real(kind=rb), intent(in) :: colco2(:)          <font color=#447700>! column amount (co2)<a name='4942'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4943'></font>
      real(kind=rb), intent(in) :: colo3(:)           <font color=#447700>! column amount (o3)<a name='4944'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4945'></font>
      real(kind=rb), intent(in) :: coln2o(:)          <font color=#447700>! column amount (n2o)<a name='4946'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4947'></font>
      real(kind=rb), intent(in) :: colco(:)           <font color=#447700>! column amount (co)<a name='4948'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4949'></font>
      real(kind=rb), intent(in) :: colch4(:)          <font color=#447700>! column amount (ch4)<a name='4950'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4951'></font>
      real(kind=rb), intent(in) :: colo2(:)           <font color=#447700>! column amount (o2)<a name='4952'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4953'></font>
      real(kind=rb), intent(in) :: colbrd(:)          <font color=#447700>! column amount (broadening gases)<a name='4954'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4955'></font>
<a name='4956'>
      integer(kind=im), intent(in) :: indself(:)<a name='4957'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4958'></font>
      integer(kind=im), intent(in) :: indfor(:)<a name='4959'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4960'></font>
      real(kind=rb), intent(in) :: selffac(:)<a name='4961'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4962'></font>
      real(kind=rb), intent(in) :: selffrac(:)<a name='4963'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4964'></font>
      real(kind=rb), intent(in) :: forfac(:)<a name='4965'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4966'></font>
      real(kind=rb), intent(in) :: forfrac(:)<a name='4967'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4968'></font>
<a name='4969'>
      integer(kind=im), intent(in) :: indminor(:)<a name='4970'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4971'></font>
      real(kind=rb), intent(in) :: minorfrac(:)<a name='4972'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4973'></font>
      real(kind=rb), intent(in) :: scaleminor(:)<a name='4974'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4975'></font>
      real(kind=rb), intent(in) :: scaleminorn2(:)<a name='4976'>
                                                      <font color=#447700>!    Dimensions: (nlayers)<a name='4977'></font>
<a name='4978'>
      real(kind=rb), intent(in) :: &amp;                  <font color=#447700>!<a name='4979'></font>
                       fac00(:), fac01(:), &amp;          <font color=#447700>!    Dimensions: (nlayers)<a name='4980'></font>
                       fac10(:), fac11(:) <a name='4981'>
      real(kind=rb), intent(in) :: &amp;                  <font color=#447700>!<a name='4982'></font>
                       rat_h2oco2(:),rat_h2oco2_1(:), &amp;<a name='4983'>
                       rat_h2oo3(:),rat_h2oo3_1(:), &amp; <font color=#447700>!    Dimensions: (nlayers)<a name='4984'></font>
                       rat_h2on2o(:),rat_h2on2o_1(:), &amp;<a name='4985'>
                       rat_h2och4(:),rat_h2och4_1(:), &amp;<a name='4986'>
                       rat_n2oco2(:),rat_n2oco2_1(:), &amp;<a name='4987'>
                       rat_o3co2(:),rat_o3co2_1(:)<a name='4988'>
<a name='4989'>
<font color=#447700>! ----- Output -----<a name='4990'></font>
      real(kind=rb), intent(out) :: fracs(:,:)        <font color=#447700>! planck fractions<a name='4991'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,ngptlw)<a name='4992'></font>
      real(kind=rb), intent(out) :: taug(:,:)         <font color=#447700>! gaseous optical depth <a name='4993'></font>
                                                      <font color=#447700>!    Dimensions: (nlayers,ngptlw)<a name='4994'></font>
<a name='4995'>
<font color=#447700>!jm not thread safe      hvrtau = '$Revision: 1.7 $'<a name='4996'></font>
<a name='4997'>
<font color=#447700>! Calculate gaseous optical depth and planck fractions for each spectral band.<a name='4998'></font>
<a name='4999'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB1'>taugb1</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB1_2"><a name='5000'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB2'>taugb2</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB2_2"><a name='5001'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB3'>taugb3</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB3_2"><a name='5002'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB4'>taugb4</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB4_2"><a name='5003'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB5'>taugb5</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB5_2"><a name='5004'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB6'>taugb6</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB6_2"><a name='5005'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB7'>taugb7</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB7_2"><a name='5006'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB8'>taugb8</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB8_2"><a name='5007'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB9'>taugb9</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB9_2"><a name='5008'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB10'>taugb10</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB10_2"><a name='5009'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB11'>taugb11</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB11_2"><a name='5010'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB12'>taugb12</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB12_2"><a name='5011'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB13'>taugb13</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB13_2"><a name='5012'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB14'>taugb14</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB14_2"><a name='5013'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB15'>taugb15</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB15_2"><a name='5014'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB16'>taugb16</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUGB16_2"><a name='5015'>
<a name='5016'>
      contains<a name='5017'>
<a name='5018'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5019'></font>
<A NAME='TAUGB1'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5020'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb1</font> <A href='../../call_to/TAUGB1.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB1.html' TARGET='index'>2</A><a name='5021'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5022'></font>
<a name='5023'>
<font color=#447700>! ------- Modifications -------<a name='5024'></font>
<font color=#447700>!  Written by Eli J. Mlawer, Atmospheric &amp; Environmental Research.<a name='5025'></font>
<font color=#447700>!  Revised by Michael J. Iacono, Atmospheric &amp; Environmental Research.<a name='5026'></font>
<font color=#447700>!<a name='5027'></font>
<font color=#447700>!     band 1:  10-350 cm-1 (low key - h2o; low minor - n2)<a name='5028'></font>
<font color=#447700>!                          (high key - h2o; high minor - n2)<a name='5029'></font>
<font color=#447700>!<a name='5030'></font>
<font color=#447700>!     note: previous versions of rrtm band 1: <a name='5031'></font>
<font color=#447700>!           10-250 cm-1 (low - h2o; high - h2o)<a name='5032'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5033'></font>
<a name='5034'>
<font color=#447700>! ------- Modules -------<a name='5035'></font>
<a name='5036'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_7">, only : ng1<a name='5037'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG01'>rrlw_kg01</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='5038'>
                            ka_mn2, kb_mn2, selfref, forref<a name='5039'>
<a name='5040'>
<font color=#447700>! ------- Declarations -------<a name='5041'></font>
<a name='5042'>
<font color=#447700>! Local <a name='5043'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='5044'>
      real(kind=rb) :: pp, corradj, scalen2, tauself, taufor, taun2<a name='5045'>
<a name='5046'>
<a name='5047'>
<font color=#447700>! Minor gas mapping levels:<a name='5048'></font>
<font color=#447700>!     lower - n2, p = 142.5490 mbar, t = 215.70 k<a name='5049'></font>
<font color=#447700>!     upper - n2, p = 142.5490 mbar, t = 215.70 k<a name='5050'></font>
<a name='5051'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5052'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='5053'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='5054'></font>
<a name='5055'>
<font color=#447700>! Lower atmosphere loop<a name='5056'></font>
      do lay = 1, laytrop<a name='5057'>
<a name='5058'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(1) + 1<a name='5059'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(1) + 1<a name='5060'>
         inds = indself(lay)<a name='5061'>
         indf = indfor(lay)<a name='5062'>
         indm = indminor(lay)<a name='5063'>
         pp = pavel(lay)<a name='5064'>
         corradj =  1.<a name='5065'>
         if (pp .lt. 250._rb) then<a name='5066'>
            corradj = 1._rb - 0.15_rb * (250._rb-pp) / 154.4_rb<a name='5067'>
         endif<a name='5068'>
<a name='5069'>
         scalen2 = colbrd(lay) * scaleminorn2(lay)<a name='5070'>
         do ig = 1, ng1<a name='5071'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='5072'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='5073'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='5074'>
                 (forref(indf+1,ig) -  forref(indf,ig))) <a name='5075'>
            taun2 = scalen2*(ka_mn2(indm,ig) + &amp; <a name='5076'>
                 minorfrac(lay) * (ka_mn2(indm+1,ig) - ka_mn2(indm,ig)))<a name='5077'>
            taug(lay,ig) = corradj * (colh2o(lay) * &amp;<a name='5078'>
                (fac00(lay) * absa(ind0,ig) + &amp;<a name='5079'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='5080'>
                 fac01(lay) * absa(ind1,ig) + &amp;<a name='5081'>
                 fac11(lay) * absa(ind1+1,ig)) &amp; <a name='5082'>
                 + tauself + taufor + taun2)<a name='5083'>
             fracs(lay,ig) = fracrefa(ig)<a name='5084'>
         enddo<a name='5085'>
      enddo<a name='5086'>
<a name='5087'>
<font color=#447700>! Upper atmosphere loop<a name='5088'></font>
      do lay = laytrop+1, nlayers<a name='5089'>
<a name='5090'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(1) + 1<a name='5091'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(1) + 1<a name='5092'>
         indf = indfor(lay)<a name='5093'>
         indm = indminor(lay)<a name='5094'>
         pp = pavel(lay)<a name='5095'>
         corradj =  1._rb - 0.15_rb * (pp / 95.6_rb)<a name='5096'>
<a name='5097'>
         scalen2 = colbrd(lay) * scaleminorn2(lay)<a name='5098'>
         do ig = 1, ng1<a name='5099'>
            taufor = forfac(lay) * (forref(indf,ig) + &amp;<a name='5100'>
                 forfrac(lay) * (forref(indf+1,ig) - forref(indf,ig))) <a name='5101'>
            taun2 = scalen2*(kb_mn2(indm,ig) + &amp; <a name='5102'>
                 minorfrac(lay) * (kb_mn2(indm+1,ig) - kb_mn2(indm,ig)))<a name='5103'>
            taug(lay,ig) = corradj * (colh2o(lay) * &amp;<a name='5104'>
                (fac00(lay) * absb(ind0,ig) + &amp;<a name='5105'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='5106'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='5107'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;  <a name='5108'>
                 + taufor + taun2)<a name='5109'>
            fracs(lay,ig) = fracrefb(ig)<a name='5110'>
         enddo<a name='5111'>
      enddo<a name='5112'>
<a name='5113'>
      end subroutine taugb1<a name='5114'>
<a name='5115'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5116'></font>
<A NAME='TAUGB2'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5117'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb2</font> <A href='../../call_to/TAUGB2.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB2.html' TARGET='index'>2</A><a name='5118'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5119'></font>
<font color=#447700>!<a name='5120'></font>
<font color=#447700>!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)<a name='5121'></font>
<font color=#447700>!<a name='5122'></font>
<font color=#447700>!     note: previous version of rrtm band 2: <a name='5123'></font>
<font color=#447700>!           250 - 500 cm-1 (low - h2o; high - h2o)<a name='5124'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5125'></font>
<a name='5126'>
<font color=#447700>! ------- Modules -------<a name='5127'></font>
<a name='5128'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_8">, only : ng2, ngs1<a name='5129'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG02'>rrlw_kg02</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='5130'>
                            selfref, forref<a name='5131'>
<a name='5132'>
<font color=#447700>! ------- Declarations -------<a name='5133'></font>
<a name='5134'>
<font color=#447700>! Local <a name='5135'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='5136'>
      real(kind=rb) :: pp, corradj, tauself, taufor<a name='5137'>
<a name='5138'>
<a name='5139'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5140'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='5141'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='5142'></font>
<a name='5143'>
<font color=#447700>! Lower atmosphere loop<a name='5144'></font>
      do lay = 1, laytrop<a name='5145'>
<a name='5146'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(2) + 1<a name='5147'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(2) + 1<a name='5148'>
         inds = indself(lay)<a name='5149'>
         indf = indfor(lay)<a name='5150'>
         pp = pavel(lay)<a name='5151'>
         corradj = 1._rb - .05_rb * (pp - 100._rb) / 900._rb<a name='5152'>
         do ig = 1, ng2<a name='5153'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='5154'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='5155'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='5156'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='5157'>
            taug(lay,ngs1+ig) = corradj * (colh2o(lay) * &amp;<a name='5158'>
                (fac00(lay) * absa(ind0,ig) + &amp;<a name='5159'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='5160'>
                 fac01(lay) * absa(ind1,ig) + &amp;<a name='5161'>
                 fac11(lay) * absa(ind1+1,ig)) &amp;<a name='5162'>
                 + tauself + taufor)<a name='5163'>
            fracs(lay,ngs1+ig) = fracrefa(ig)<a name='5164'>
         enddo<a name='5165'>
      enddo<a name='5166'>
<a name='5167'>
<font color=#447700>! Upper atmosphere loop<a name='5168'></font>
      do lay = laytrop+1, nlayers<a name='5169'>
<a name='5170'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(2) + 1<a name='5171'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(2) + 1<a name='5172'>
         indf = indfor(lay)<a name='5173'>
         do ig = 1, ng2<a name='5174'>
            taufor =  forfac(lay) * (forref(indf,ig) + &amp;<a name='5175'>
                 forfrac(lay) * (forref(indf+1,ig) - forref(indf,ig))) <a name='5176'>
            taug(lay,ngs1+ig) = colh2o(lay) * &amp;<a name='5177'>
                (fac00(lay) * absb(ind0,ig) + &amp;<a name='5178'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='5179'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='5180'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;<a name='5181'>
                 + taufor<a name='5182'>
            fracs(lay,ngs1+ig) = fracrefb(ig)<a name='5183'>
         enddo<a name='5184'>
      enddo<a name='5185'>
<a name='5186'>
      end subroutine taugb2<a name='5187'>
<a name='5188'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5189'></font>
<A NAME='TAUGB3'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5190'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb3</font> <A href='../../call_to/TAUGB3.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB3.html' TARGET='index'>3</A><a name='5191'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5192'></font>
<font color=#447700>!<a name='5193'></font>
<font color=#447700>!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)<a name='5194'></font>
<font color=#447700>!                           (high key - h2o,co2; high minor - n2o)<a name='5195'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5196'></font>
<a name='5197'>
<font color=#447700>! ------- Modules -------<a name='5198'></font>
<a name='5199'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_9">, only : ng3, ngs2<a name='5200'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_2">, only : chi_mls<a name='5201'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG03'>rrlw_kg03</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='5202'>
                            ka_mn2o, kb_mn2o, selfref, forref<a name='5203'>
<a name='5204'>
<font color=#447700>! ------- Declarations -------<a name='5205'></font>
<a name='5206'>
<font color=#447700>! Local <a name='5207'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='5208'>
      integer(kind=im) :: js, js1, jmn2o, jpl<a name='5209'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='5210'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='5211'>
      real(kind=rb) :: speccomb_mn2o, specparm_mn2o, specmult_mn2o, &amp;<a name='5212'>
                       fmn2o, fmn2omf, chi_n2o, ratn2o, adjfac, adjcoln2o<a name='5213'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='5214'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='5215'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='5216'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='5217'>
      real(kind=rb) :: tauself, taufor, n2om1, n2om2, absn2o<a name='5218'>
      real(kind=rb) :: refrat_planck_a, refrat_planck_b, refrat_m_a, refrat_m_b<a name='5219'>
      real(kind=rb) :: tau_major, tau_major1<a name='5220'>
<a name='5221'>
<a name='5222'>
<font color=#447700>! Minor gas mapping levels:<a name='5223'></font>
<font color=#447700>!     lower - n2o, p = 706.272 mbar, t = 278.94 k<a name='5224'></font>
<font color=#447700>!     upper - n2o, p = 95.58 mbar, t = 215.7 k<a name='5225'></font>
<a name='5226'>
<font color=#447700>!  P = 212.725 mb<a name='5227'></font>
      refrat_planck_a = chi_mls(1,9)/chi_mls(2,9)<a name='5228'>
<a name='5229'>
<font color=#447700>!  P = 95.58 mb<a name='5230'></font>
      refrat_planck_b = chi_mls(1,13)/chi_mls(2,13)<a name='5231'>
<a name='5232'>
<font color=#447700>!  P = 706.270mb<a name='5233'></font>
      refrat_m_a = chi_mls(1,3)/chi_mls(2,3)<a name='5234'>
<a name='5235'>
<font color=#447700>!  P = 95.58 mb <a name='5236'></font>
      refrat_m_b = chi_mls(1,13)/chi_mls(2,13)<a name='5237'>
<a name='5238'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5239'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water vapor <a name='5240'></font>
<font color=#447700>! self-continuum and foreign continuum is interpolated (in temperature) <a name='5241'></font>
<font color=#447700>! separately.<a name='5242'></font>
<a name='5243'>
<font color=#447700>! Lower atmosphere loop<a name='5244'></font>
      do lay = 1, laytrop<a name='5245'>
<a name='5246'>
         speccomb = colh2o(lay) + rat_h2oco2(lay)*colco2(lay)<a name='5247'>
         specparm = colh2o(lay)/speccomb<a name='5248'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5249'>
         specmult = 8._rb*(specparm)<a name='5250'>
         js = 1 + int(specmult)<a name='5251'>
         fs = mod(specmult,1.0_rb)        <a name='5252'>
<a name='5253'>
         speccomb1 = colh2o(lay) + rat_h2oco2_1(lay)*colco2(lay)<a name='5254'>
         specparm1 = colh2o(lay)/speccomb1<a name='5255'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5256'>
         specmult1 = 8._rb*(specparm1)<a name='5257'>
         js1 = 1 + int(specmult1)<a name='5258'>
         fs1 = mod(specmult1,1.0_rb)<a name='5259'>
<a name='5260'>
         speccomb_mn2o = colh2o(lay) + refrat_m_a*colco2(lay)<a name='5261'>
         specparm_mn2o = colh2o(lay)/speccomb_mn2o<a name='5262'>
         if (specparm_mn2o .ge. oneminus) specparm_mn2o = oneminus<a name='5263'>
         specmult_mn2o = 8._rb*specparm_mn2o<a name='5264'>
         jmn2o = 1 + int(specmult_mn2o)<a name='5265'>
         fmn2o = mod(specmult_mn2o,1.0_rb)<a name='5266'>
         fmn2omf = minorfrac(lay)*fmn2o<a name='5267'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='5268'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='5269'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='5270'></font>
         chi_n2o = coln2o(lay)/coldry(lay)<a name='5271'>
         ratn2o = 1.e20_rb*chi_n2o/chi_mls(4,jp(lay)+1)<a name='5272'>
         if (ratn2o .gt. 1.5_rb) then<a name='5273'>
            adjfac = 0.5_rb+(ratn2o-0.5_rb)**0.65_rb<a name='5274'>
            adjcoln2o = adjfac*chi_mls(4,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='5275'>
         else<a name='5276'>
            adjcoln2o = coln2o(lay)<a name='5277'>
         endif<a name='5278'>
<a name='5279'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colco2(lay)<a name='5280'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='5281'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='5282'>
         specmult_planck = 8._rb*specparm_planck<a name='5283'>
         jpl= 1 + int(specmult_planck)<a name='5284'>
         fpl = mod(specmult_planck,1.0_rb)<a name='5285'>
<a name='5286'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(3) + js<a name='5287'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(3) + js1<a name='5288'>
         inds = indself(lay)<a name='5289'>
         indf = indfor(lay)<a name='5290'>
         indm = indminor(lay)<a name='5291'>
<a name='5292'>
         if (specparm .lt. 0.125_rb) then<a name='5293'>
            p = fs - 1<a name='5294'>
            p4 = p**4<a name='5295'>
            fk0 = p4<a name='5296'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5297'>
            fk2 = p + p4<a name='5298'>
            fac000 = fk0*fac00(lay)<a name='5299'>
            fac100 = fk1*fac00(lay)<a name='5300'>
            fac200 = fk2*fac00(lay)<a name='5301'>
            fac010 = fk0*fac10(lay)<a name='5302'>
            fac110 = fk1*fac10(lay)<a name='5303'>
            fac210 = fk2*fac10(lay)<a name='5304'>
         else if (specparm .gt. 0.875_rb) then<a name='5305'>
            p = -fs <a name='5306'>
            p4 = p**4<a name='5307'>
            fk0 = p4<a name='5308'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5309'>
            fk2 = p + p4<a name='5310'>
            fac000 = fk0*fac00(lay)<a name='5311'>
            fac100 = fk1*fac00(lay)<a name='5312'>
            fac200 = fk2*fac00(lay)<a name='5313'>
            fac010 = fk0*fac10(lay)<a name='5314'>
            fac110 = fk1*fac10(lay)<a name='5315'>
            fac210 = fk2*fac10(lay)<a name='5316'>
         else<a name='5317'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='5318'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='5319'>
            fac100 = fs * fac00(lay)<a name='5320'>
            fac110 = fs * fac10(lay)<a name='5321'>
         endif<a name='5322'>
         if (specparm1 .lt. 0.125_rb) then<a name='5323'>
            p = fs1 - 1<a name='5324'>
            p4 = p**4<a name='5325'>
            fk0 = p4<a name='5326'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5327'>
            fk2 = p + p4<a name='5328'>
            fac001 = fk0*fac01(lay)<a name='5329'>
            fac101 = fk1*fac01(lay)<a name='5330'>
            fac201 = fk2*fac01(lay)<a name='5331'>
            fac011 = fk0*fac11(lay)<a name='5332'>
            fac111 = fk1*fac11(lay)<a name='5333'>
            fac211 = fk2*fac11(lay)<a name='5334'>
         else if (specparm1 .gt. 0.875_rb) then<a name='5335'>
            p = -fs1 <a name='5336'>
            p4 = p**4<a name='5337'>
            fk0 = p4<a name='5338'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5339'>
            fk2 = p + p4<a name='5340'>
            fac001 = fk0*fac01(lay)<a name='5341'>
            fac101 = fk1*fac01(lay)<a name='5342'>
            fac201 = fk2*fac01(lay)<a name='5343'>
            fac011 = fk0*fac11(lay)<a name='5344'>
            fac111 = fk1*fac11(lay)<a name='5345'>
            fac211 = fk2*fac11(lay)<a name='5346'>
         else<a name='5347'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='5348'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='5349'>
            fac101 = fs1 * fac01(lay)<a name='5350'>
            fac111 = fs1 * fac11(lay)<a name='5351'>
         endif<a name='5352'>
<a name='5353'>
         do ig = 1, ng3<a name='5354'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='5355'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='5356'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='5357'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='5358'>
            n2om1 = ka_mn2o(jmn2o,indm,ig) + fmn2o * &amp;<a name='5359'>
                 (ka_mn2o(jmn2o+1,indm,ig) - ka_mn2o(jmn2o,indm,ig))<a name='5360'>
            n2om2 = ka_mn2o(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='5361'>
                 (ka_mn2o(jmn2o+1,indm+1,ig) - ka_mn2o(jmn2o,indm+1,ig))<a name='5362'>
            absn2o = n2om1 + minorfrac(lay) * (n2om2 - n2om1)<a name='5363'>
<a name='5364'>
            if (specparm .lt. 0.125_rb) then<a name='5365'>
               tau_major = speccomb * &amp;<a name='5366'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5367'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5368'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='5369'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5370'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='5371'>
                    fac210 * absa(ind0+11,ig))<a name='5372'>
            else if (specparm .gt. 0.875_rb) then<a name='5373'>
               tau_major = speccomb * &amp;<a name='5374'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='5375'>
                    fac100 * absa(ind0,ig) + &amp;<a name='5376'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='5377'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='5378'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='5379'>
                    fac010 * absa(ind0+10,ig))<a name='5380'>
            else<a name='5381'>
               tau_major = speccomb * &amp;<a name='5382'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5383'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5384'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5385'>
                    fac110 * absa(ind0+10,ig))<a name='5386'>
            endif<a name='5387'>
<a name='5388'>
            if (specparm1 .lt. 0.125_rb) then<a name='5389'>
               tau_major1 = speccomb1 * &amp;<a name='5390'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='5391'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5392'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='5393'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5394'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='5395'>
                    fac211 * absa(ind1+11,ig))<a name='5396'>
            else if (specparm1 .gt. 0.875_rb) then<a name='5397'>
               tau_major1 = speccomb1 * &amp;<a name='5398'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='5399'>
                    fac101 * absa(ind1,ig) + &amp;<a name='5400'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='5401'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='5402'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='5403'>
                    fac011 * absa(ind1+10,ig))<a name='5404'>
            else<a name='5405'>
               tau_major1 = speccomb1 * &amp;<a name='5406'>
                    (fac001 * absa(ind1,ig) +  &amp;<a name='5407'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5408'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5409'>
                    fac111 * absa(ind1+10,ig))<a name='5410'>
            endif<a name='5411'>
<a name='5412'>
            taug(lay,ngs2+ig) = tau_major + tau_major1 &amp;<a name='5413'>
                 + tauself + taufor &amp;<a name='5414'>
                 + adjcoln2o*absn2o<a name='5415'>
            fracs(lay,ngs2+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='5416'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='5417'>
         enddo<a name='5418'>
      enddo<a name='5419'>
<a name='5420'>
<font color=#447700>! Upper atmosphere loop<a name='5421'></font>
      do lay = laytrop+1, nlayers<a name='5422'>
<a name='5423'>
         speccomb = colh2o(lay) + rat_h2oco2(lay)*colco2(lay)<a name='5424'>
         specparm = colh2o(lay)/speccomb<a name='5425'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5426'>
         specmult = 4._rb*(specparm)<a name='5427'>
         js = 1 + int(specmult)<a name='5428'>
         fs = mod(specmult,1.0_rb)<a name='5429'>
<a name='5430'>
         speccomb1 = colh2o(lay) + rat_h2oco2_1(lay)*colco2(lay)<a name='5431'>
         specparm1 = colh2o(lay)/speccomb1<a name='5432'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5433'>
         specmult1 = 4._rb*(specparm1)<a name='5434'>
         js1 = 1 + int(specmult1)<a name='5435'>
         fs1 = mod(specmult1,1.0_rb)<a name='5436'>
<a name='5437'>
         fac000 = (1._rb - fs) * fac00(lay)<a name='5438'>
         fac010 = (1._rb - fs) * fac10(lay)<a name='5439'>
         fac100 = fs * fac00(lay)<a name='5440'>
         fac110 = fs * fac10(lay)<a name='5441'>
         fac001 = (1._rb - fs1) * fac01(lay)<a name='5442'>
         fac011 = (1._rb - fs1) * fac11(lay)<a name='5443'>
         fac101 = fs1 * fac01(lay)<a name='5444'>
         fac111 = fs1 * fac11(lay)<a name='5445'>
<a name='5446'>
         speccomb_mn2o = colh2o(lay) + refrat_m_b*colco2(lay)<a name='5447'>
         specparm_mn2o = colh2o(lay)/speccomb_mn2o<a name='5448'>
         if (specparm_mn2o .ge. oneminus) specparm_mn2o = oneminus<a name='5449'>
         specmult_mn2o = 4._rb*specparm_mn2o<a name='5450'>
         jmn2o = 1 + int(specmult_mn2o)<a name='5451'>
         fmn2o = mod(specmult_mn2o,1.0_rb)<a name='5452'>
         fmn2omf = minorfrac(lay)*fmn2o<a name='5453'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='5454'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='5455'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='5456'></font>
         chi_n2o = coln2o(lay)/coldry(lay)<a name='5457'>
         ratn2o = 1.e20*chi_n2o/chi_mls(4,jp(lay)+1)<a name='5458'>
         if (ratn2o .gt. 1.5_rb) then<a name='5459'>
            adjfac = 0.5_rb+(ratn2o-0.5_rb)**0.65_rb<a name='5460'>
            adjcoln2o = adjfac*chi_mls(4,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='5461'>
         else<a name='5462'>
            adjcoln2o = coln2o(lay)<a name='5463'>
         endif<a name='5464'>
<a name='5465'>
         speccomb_planck = colh2o(lay)+refrat_planck_b*colco2(lay)<a name='5466'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='5467'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='5468'>
         specmult_planck = 4._rb*specparm_planck<a name='5469'>
         jpl= 1 + int(specmult_planck)<a name='5470'>
         fpl = mod(specmult_planck,1.0_rb)<a name='5471'>
<a name='5472'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(3) + js<a name='5473'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(3) + js1<a name='5474'>
         indf = indfor(lay)<a name='5475'>
         indm = indminor(lay)<a name='5476'>
<a name='5477'>
         do ig = 1, ng3<a name='5478'>
            taufor = forfac(lay) * (forref(indf,ig) + &amp;<a name='5479'>
                 forfrac(lay) * (forref(indf+1,ig) - forref(indf,ig))) <a name='5480'>
            n2om1 = kb_mn2o(jmn2o,indm,ig) + fmn2o * &amp;<a name='5481'>
                 (kb_mn2o(jmn2o+1,indm,ig)-kb_mn2o(jmn2o,indm,ig))<a name='5482'>
            n2om2 = kb_mn2o(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='5483'>
                 (kb_mn2o(jmn2o+1,indm+1,ig)-kb_mn2o(jmn2o,indm+1,ig))<a name='5484'>
            absn2o = n2om1 + minorfrac(lay) * (n2om2 - n2om1)<a name='5485'>
            taug(lay,ngs2+ig) = speccomb * &amp;<a name='5486'>
                (fac000 * absb(ind0,ig) + &amp;<a name='5487'>
                fac100 * absb(ind0+1,ig) + &amp;<a name='5488'>
                fac010 * absb(ind0+5,ig) + &amp;<a name='5489'>
                fac110 * absb(ind0+6,ig)) &amp;<a name='5490'>
                + speccomb1 * &amp;<a name='5491'>
                (fac001 * absb(ind1,ig) +  &amp;<a name='5492'>
                fac101 * absb(ind1+1,ig) + &amp;<a name='5493'>
                fac011 * absb(ind1+5,ig) + &amp;<a name='5494'>
                fac111 * absb(ind1+6,ig))  &amp;<a name='5495'>
                + taufor &amp;<a name='5496'>
                + adjcoln2o*absn2o<a name='5497'>
            fracs(lay,ngs2+ig) = fracrefb(ig,jpl) + fpl * &amp;<a name='5498'>
                (fracrefb(ig,jpl+1)-fracrefb(ig,jpl))<a name='5499'>
         enddo<a name='5500'>
      enddo<a name='5501'>
<a name='5502'>
      end subroutine taugb3<a name='5503'>
<a name='5504'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5505'></font>
<A NAME='TAUGB4'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5506'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb4</font> <A href='../../call_to/TAUGB4.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB4.html' TARGET='index'>3</A><a name='5507'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5508'></font>
<font color=#447700>!<a name='5509'></font>
<font color=#447700>!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)<a name='5510'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5511'></font>
<a name='5512'>
<font color=#447700>! ------- Modules -------<a name='5513'></font>
<a name='5514'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_10">, only : ng4, ngs3<a name='5515'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_3">, only : chi_mls<a name='5516'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG04'>rrlw_kg04</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='5517'>
                            selfref, forref<a name='5518'>
<a name='5519'>
<font color=#447700>! ------- Declarations -------<a name='5520'></font>
<a name='5521'>
<font color=#447700>! Local <a name='5522'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='5523'>
      integer(kind=im) :: js, js1, jpl<a name='5524'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='5525'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='5526'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='5527'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='5528'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='5529'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='5530'>
      real(kind=rb) :: tauself, taufor<a name='5531'>
      real(kind=rb) :: refrat_planck_a, refrat_planck_b<a name='5532'>
      real(kind=rb) :: tau_major, tau_major1<a name='5533'>
<a name='5534'>
<a name='5535'>
<font color=#447700>! P =   142.5940 mb<a name='5536'></font>
      refrat_planck_a = chi_mls(1,11)/chi_mls(2,11)<a name='5537'>
<a name='5538'>
<font color=#447700>! P = 95.58350 mb<a name='5539'></font>
      refrat_planck_b = chi_mls(3,13)/chi_mls(2,13)<a name='5540'>
<a name='5541'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5542'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water <a name='5543'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated (in temperature) <a name='5544'></font>
<font color=#447700>! separately.<a name='5545'></font>
<a name='5546'>
<font color=#447700>! Lower atmosphere loop<a name='5547'></font>
      do lay = 1, laytrop<a name='5548'>
<a name='5549'>
         speccomb = colh2o(lay) + rat_h2oco2(lay)*colco2(lay)<a name='5550'>
         specparm = colh2o(lay)/speccomb<a name='5551'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5552'>
         specmult = 8._rb*(specparm)<a name='5553'>
         js = 1 + int(specmult)<a name='5554'>
         fs = mod(specmult,1.0_rb)<a name='5555'>
<a name='5556'>
         speccomb1 = colh2o(lay) + rat_h2oco2_1(lay)*colco2(lay)<a name='5557'>
         specparm1 = colh2o(lay)/speccomb1<a name='5558'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5559'>
         specmult1 = 8._rb*(specparm1)<a name='5560'>
         js1 = 1 + int(specmult1)<a name='5561'>
         fs1 = mod(specmult1,1.0_rb)<a name='5562'>
<a name='5563'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colco2(lay)<a name='5564'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='5565'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='5566'>
         specmult_planck = 8._rb*specparm_planck<a name='5567'>
         jpl= 1 + int(specmult_planck)<a name='5568'>
         fpl = mod(specmult_planck,1.0_rb)<a name='5569'>
<a name='5570'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(4) + js<a name='5571'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(4) + js1<a name='5572'>
         inds = indself(lay)<a name='5573'>
         indf = indfor(lay)<a name='5574'>
<a name='5575'>
         if (specparm .lt. 0.125_rb) then<a name='5576'>
            p = fs - 1<a name='5577'>
            p4 = p**4<a name='5578'>
            fk0 = p4<a name='5579'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5580'>
            fk2 = p + p4<a name='5581'>
            fac000 = fk0*fac00(lay)<a name='5582'>
            fac100 = fk1*fac00(lay)<a name='5583'>
            fac200 = fk2*fac00(lay)<a name='5584'>
            fac010 = fk0*fac10(lay)<a name='5585'>
            fac110 = fk1*fac10(lay)<a name='5586'>
            fac210 = fk2*fac10(lay)<a name='5587'>
         else if (specparm .gt. 0.875_rb) then<a name='5588'>
            p = -fs <a name='5589'>
            p4 = p**4<a name='5590'>
            fk0 = p4<a name='5591'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5592'>
            fk2 = p + p4<a name='5593'>
            fac000 = fk0*fac00(lay)<a name='5594'>
            fac100 = fk1*fac00(lay)<a name='5595'>
            fac200 = fk2*fac00(lay)<a name='5596'>
            fac010 = fk0*fac10(lay)<a name='5597'>
            fac110 = fk1*fac10(lay)<a name='5598'>
            fac210 = fk2*fac10(lay)<a name='5599'>
         else<a name='5600'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='5601'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='5602'>
            fac100 = fs * fac00(lay)<a name='5603'>
            fac110 = fs * fac10(lay)<a name='5604'>
         endif<a name='5605'>
<a name='5606'>
         if (specparm1 .lt. 0.125_rb) then<a name='5607'>
            p = fs1 - 1<a name='5608'>
            p4 = p**4<a name='5609'>
            fk0 = p4<a name='5610'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5611'>
            fk2 = p + p4<a name='5612'>
            fac001 = fk0*fac01(lay)<a name='5613'>
            fac101 = fk1*fac01(lay)<a name='5614'>
            fac201 = fk2*fac01(lay)<a name='5615'>
            fac011 = fk0*fac11(lay)<a name='5616'>
            fac111 = fk1*fac11(lay)<a name='5617'>
            fac211 = fk2*fac11(lay)<a name='5618'>
         else if (specparm1 .gt. 0.875_rb) then<a name='5619'>
            p = -fs1 <a name='5620'>
            p4 = p**4<a name='5621'>
            fk0 = p4<a name='5622'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5623'>
            fk2 = p + p4<a name='5624'>
            fac001 = fk0*fac01(lay)<a name='5625'>
            fac101 = fk1*fac01(lay)<a name='5626'>
            fac201 = fk2*fac01(lay)<a name='5627'>
            fac011 = fk0*fac11(lay)<a name='5628'>
            fac111 = fk1*fac11(lay)<a name='5629'>
            fac211 = fk2*fac11(lay)<a name='5630'>
         else<a name='5631'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='5632'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='5633'>
            fac101 = fs1 * fac01(lay)<a name='5634'>
            fac111 = fs1 * fac11(lay)<a name='5635'>
         endif<a name='5636'>
<a name='5637'>
         do ig = 1, ng4<a name='5638'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='5639'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='5640'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='5641'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='5642'>
<a name='5643'>
            if (specparm .lt. 0.125_rb) then<a name='5644'>
               tau_major = speccomb * &amp;<a name='5645'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5646'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5647'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='5648'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5649'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='5650'>
                    fac210 * absa(ind0+11,ig))<a name='5651'>
            else if (specparm .gt. 0.875_rb) then<a name='5652'>
               tau_major = speccomb * &amp;<a name='5653'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='5654'>
                    fac100 * absa(ind0,ig) + &amp;<a name='5655'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='5656'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='5657'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='5658'>
                    fac010 * absa(ind0+10,ig))<a name='5659'>
            else<a name='5660'>
               tau_major = speccomb * &amp;<a name='5661'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5662'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5663'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5664'>
                    fac110 * absa(ind0+10,ig))<a name='5665'>
            endif<a name='5666'>
<a name='5667'>
            if (specparm1 .lt. 0.125_rb) then<a name='5668'>
               tau_major1 = speccomb1 * &amp;<a name='5669'>
                    (fac001 * absa(ind1,ig) +  &amp;<a name='5670'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5671'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='5672'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5673'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='5674'>
                    fac211 * absa(ind1+11,ig))<a name='5675'>
            else if (specparm1 .gt. 0.875_rb) then<a name='5676'>
               tau_major1 = speccomb1 * &amp;<a name='5677'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='5678'>
                    fac101 * absa(ind1,ig) + &amp;<a name='5679'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='5680'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='5681'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='5682'>
                    fac011 * absa(ind1+10,ig))<a name='5683'>
            else<a name='5684'>
               tau_major1 = speccomb1 * &amp;<a name='5685'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='5686'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5687'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5688'>
                    fac111 * absa(ind1+10,ig))<a name='5689'>
            endif<a name='5690'>
<a name='5691'>
            taug(lay,ngs3+ig) = tau_major + tau_major1 &amp;<a name='5692'>
                 + tauself + taufor<a name='5693'>
            fracs(lay,ngs3+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='5694'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='5695'>
         enddo<a name='5696'>
      enddo<a name='5697'>
<a name='5698'>
<font color=#447700>! Upper atmosphere loop<a name='5699'></font>
      do lay = laytrop+1, nlayers<a name='5700'>
<a name='5701'>
         speccomb = colo3(lay) + rat_o3co2(lay)*colco2(lay)<a name='5702'>
         specparm = colo3(lay)/speccomb<a name='5703'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5704'>
         specmult = 4._rb*(specparm)<a name='5705'>
         js = 1 + int(specmult)<a name='5706'>
         fs = mod(specmult,1.0_rb)<a name='5707'>
<a name='5708'>
         speccomb1 = colo3(lay) + rat_o3co2_1(lay)*colco2(lay)<a name='5709'>
         specparm1 = colo3(lay)/speccomb1<a name='5710'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5711'>
         specmult1 = 4._rb*(specparm1)<a name='5712'>
         js1 = 1 + int(specmult1)<a name='5713'>
         fs1 = mod(specmult1,1.0_rb)<a name='5714'>
<a name='5715'>
         fac000 = (1._rb - fs) * fac00(lay)<a name='5716'>
         fac010 = (1._rb - fs) * fac10(lay)<a name='5717'>
         fac100 = fs * fac00(lay)<a name='5718'>
         fac110 = fs * fac10(lay)<a name='5719'>
         fac001 = (1._rb - fs1) * fac01(lay)<a name='5720'>
         fac011 = (1._rb - fs1) * fac11(lay)<a name='5721'>
         fac101 = fs1 * fac01(lay)<a name='5722'>
         fac111 = fs1 * fac11(lay)<a name='5723'>
<a name='5724'>
         speccomb_planck = colo3(lay)+refrat_planck_b*colco2(lay)<a name='5725'>
         specparm_planck = colo3(lay)/speccomb_planck<a name='5726'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='5727'>
         specmult_planck = 4._rb*specparm_planck<a name='5728'>
         jpl= 1 + int(specmult_planck)<a name='5729'>
         fpl = mod(specmult_planck,1.0_rb)<a name='5730'>
<a name='5731'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(4) + js<a name='5732'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(4) + js1<a name='5733'>
<a name='5734'>
         do ig = 1, ng4<a name='5735'>
            taug(lay,ngs3+ig) =  speccomb * &amp;<a name='5736'>
                (fac000 * absb(ind0,ig) + &amp;<a name='5737'>
                fac100 * absb(ind0+1,ig) + &amp;<a name='5738'>
                fac010 * absb(ind0+5,ig) + &amp;<a name='5739'>
                fac110 * absb(ind0+6,ig)) &amp;<a name='5740'>
                + speccomb1 * &amp;<a name='5741'>
                (fac001 * absb(ind1,ig) +  &amp;<a name='5742'>
                fac101 * absb(ind1+1,ig) + &amp;<a name='5743'>
                fac011 * absb(ind1+5,ig) + &amp;<a name='5744'>
                fac111 * absb(ind1+6,ig))<a name='5745'>
            fracs(lay,ngs3+ig) = fracrefb(ig,jpl) + fpl * &amp;<a name='5746'>
                (fracrefb(ig,jpl+1)-fracrefb(ig,jpl))<a name='5747'>
         enddo<a name='5748'>
<a name='5749'>
<font color=#447700>! Empirical modification to code to improve stratospheric cooling rates<a name='5750'></font>
<font color=#447700>! for co2.  Revised to apply weighting for g-point reduction in this band.<a name='5751'></font>
<a name='5752'>
         taug(lay,ngs3+8)=taug(lay,ngs3+8)*0.92<a name='5753'>
         taug(lay,ngs3+9)=taug(lay,ngs3+9)*0.88<a name='5754'>
         taug(lay,ngs3+10)=taug(lay,ngs3+10)*1.07<a name='5755'>
         taug(lay,ngs3+11)=taug(lay,ngs3+11)*1.1<a name='5756'>
         taug(lay,ngs3+12)=taug(lay,ngs3+12)*0.99<a name='5757'>
         taug(lay,ngs3+13)=taug(lay,ngs3+13)*0.88<a name='5758'>
         taug(lay,ngs3+14)=taug(lay,ngs3+14)*0.943<a name='5759'>
<a name='5760'>
      enddo<a name='5761'>
<a name='5762'>
      end subroutine taugb4<a name='5763'>
<a name='5764'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5765'></font>
<A NAME='TAUGB5'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5766'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb5</font> <A href='../../call_to/TAUGB5.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB5.html' TARGET='index'>3</A><a name='5767'>
<font color=#447700>!----------------------------------------------------------------------------<a name='5768'></font>
<font color=#447700>!<a name='5769'></font>
<font color=#447700>!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)<a name='5770'></font>
<font color=#447700>!                           (high key - o3,co2)<a name='5771'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='5772'></font>
<a name='5773'>
<font color=#447700>! ------- Modules -------<a name='5774'></font>
<a name='5775'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_11">, only : ng5, ngs4<a name='5776'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_4">, only : chi_mls<a name='5777'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG05'>rrlw_kg05</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='5778'>
                            ka_mo3, selfref, forref, ccl4<a name='5779'>
<a name='5780'>
<font color=#447700>! ------- Declarations -------<a name='5781'></font>
<a name='5782'>
<font color=#447700>! Local <a name='5783'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='5784'>
      integer(kind=im) :: js, js1, jmo3, jpl<a name='5785'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='5786'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='5787'>
      real(kind=rb) :: speccomb_mo3, specparm_mo3, specmult_mo3, fmo3<a name='5788'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='5789'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='5790'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='5791'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='5792'>
      real(kind=rb) :: tauself, taufor, o3m1, o3m2, abso3<a name='5793'>
      real(kind=rb) :: refrat_planck_a, refrat_planck_b, refrat_m_a<a name='5794'>
      real(kind=rb) :: tau_major, tau_major1<a name='5795'>
<a name='5796'>
<a name='5797'>
<font color=#447700>! Minor gas mapping level :<a name='5798'></font>
<font color=#447700>!     lower - o3, p = 317.34 mbar, t = 240.77 k<a name='5799'></font>
<font color=#447700>!     lower - ccl4<a name='5800'></font>
<a name='5801'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='5802'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='5803'></font>
<a name='5804'>
<font color=#447700>! P = 473.420 mb<a name='5805'></font>
      refrat_planck_a = chi_mls(1,5)/chi_mls(2,5)<a name='5806'>
<a name='5807'>
<font color=#447700>! P = 0.2369 mb<a name='5808'></font>
      refrat_planck_b = chi_mls(3,43)/chi_mls(2,43)<a name='5809'>
<a name='5810'>
<font color=#447700>! P = 317.3480<a name='5811'></font>
      refrat_m_a = chi_mls(1,7)/chi_mls(2,7)<a name='5812'>
<a name='5813'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='5814'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the <a name='5815'></font>
<font color=#447700>! water vapor self-continuum and foreign continuum is <a name='5816'></font>
<font color=#447700>! interpolated (in temperature) separately.<a name='5817'></font>
<a name='5818'>
<font color=#447700>! Lower atmosphere loop<a name='5819'></font>
      do lay = 1, laytrop<a name='5820'>
<a name='5821'>
         speccomb = colh2o(lay) + rat_h2oco2(lay)*colco2(lay)<a name='5822'>
         specparm = colh2o(lay)/speccomb<a name='5823'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5824'>
         specmult = 8._rb*(specparm)<a name='5825'>
         js = 1 + int(specmult)<a name='5826'>
         fs = mod(specmult,1.0_rb)<a name='5827'>
<a name='5828'>
         speccomb1 = colh2o(lay) + rat_h2oco2_1(lay)*colco2(lay)<a name='5829'>
         specparm1 = colh2o(lay)/speccomb1<a name='5830'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5831'>
         specmult1 = 8._rb*(specparm1)<a name='5832'>
         js1 = 1 + int(specmult1)<a name='5833'>
         fs1 = mod(specmult1,1.0_rb)<a name='5834'>
<a name='5835'>
         speccomb_mo3 = colh2o(lay) + refrat_m_a*colco2(lay)<a name='5836'>
         specparm_mo3 = colh2o(lay)/speccomb_mo3<a name='5837'>
         if (specparm_mo3 .ge. oneminus) specparm_mo3 = oneminus<a name='5838'>
         specmult_mo3 = 8._rb*specparm_mo3<a name='5839'>
         jmo3 = 1 + int(specmult_mo3)<a name='5840'>
         fmo3 = mod(specmult_mo3,1.0_rb)<a name='5841'>
<a name='5842'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colco2(lay)<a name='5843'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='5844'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='5845'>
         specmult_planck = 8._rb*specparm_planck<a name='5846'>
         jpl= 1 + int(specmult_planck)<a name='5847'>
         fpl = mod(specmult_planck,1.0_rb)<a name='5848'>
<a name='5849'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(5) + js<a name='5850'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(5) + js1<a name='5851'>
         inds = indself(lay)<a name='5852'>
         indf = indfor(lay)<a name='5853'>
         indm = indminor(lay)<a name='5854'>
<a name='5855'>
         if (specparm .lt. 0.125_rb) then<a name='5856'>
            p = fs - 1<a name='5857'>
            p4 = p**4<a name='5858'>
            fk0 = p4<a name='5859'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5860'>
            fk2 = p + p4<a name='5861'>
            fac000 = fk0*fac00(lay)<a name='5862'>
            fac100 = fk1*fac00(lay)<a name='5863'>
            fac200 = fk2*fac00(lay)<a name='5864'>
            fac010 = fk0*fac10(lay)<a name='5865'>
            fac110 = fk1*fac10(lay)<a name='5866'>
            fac210 = fk2*fac10(lay)<a name='5867'>
         else if (specparm .gt. 0.875_rb) then<a name='5868'>
            p = -fs <a name='5869'>
            p4 = p**4<a name='5870'>
            fk0 = p4<a name='5871'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5872'>
            fk2 = p + p4<a name='5873'>
            fac000 = fk0*fac00(lay)<a name='5874'>
            fac100 = fk1*fac00(lay)<a name='5875'>
            fac200 = fk2*fac00(lay)<a name='5876'>
            fac010 = fk0*fac10(lay)<a name='5877'>
            fac110 = fk1*fac10(lay)<a name='5878'>
            fac210 = fk2*fac10(lay)<a name='5879'>
         else<a name='5880'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='5881'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='5882'>
            fac100 = fs * fac00(lay)<a name='5883'>
            fac110 = fs * fac10(lay)<a name='5884'>
         endif<a name='5885'>
<a name='5886'>
         if (specparm1 .lt. 0.125_rb) then<a name='5887'>
            p = fs1 - 1<a name='5888'>
            p4 = p**4<a name='5889'>
            fk0 = p4<a name='5890'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5891'>
            fk2 = p + p4<a name='5892'>
            fac001 = fk0*fac01(lay)<a name='5893'>
            fac101 = fk1*fac01(lay)<a name='5894'>
            fac201 = fk2*fac01(lay)<a name='5895'>
            fac011 = fk0*fac11(lay)<a name='5896'>
            fac111 = fk1*fac11(lay)<a name='5897'>
            fac211 = fk2*fac11(lay)<a name='5898'>
         else if (specparm1 .gt. 0.875_rb) then<a name='5899'>
            p = -fs1 <a name='5900'>
            p4 = p**4<a name='5901'>
            fk0 = p4<a name='5902'>
            fk1 = 1 - p - 2.0_rb*p4<a name='5903'>
            fk2 = p + p4<a name='5904'>
            fac001 = fk0*fac01(lay)<a name='5905'>
            fac101 = fk1*fac01(lay)<a name='5906'>
            fac201 = fk2*fac01(lay)<a name='5907'>
            fac011 = fk0*fac11(lay)<a name='5908'>
            fac111 = fk1*fac11(lay)<a name='5909'>
            fac211 = fk2*fac11(lay)<a name='5910'>
         else<a name='5911'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='5912'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='5913'>
            fac101 = fs1 * fac01(lay)<a name='5914'>
            fac111 = fs1 * fac11(lay)<a name='5915'>
         endif<a name='5916'>
<a name='5917'>
         do ig = 1, ng5<a name='5918'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='5919'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='5920'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='5921'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='5922'>
            o3m1 = ka_mo3(jmo3,indm,ig) + fmo3 * &amp;<a name='5923'>
                 (ka_mo3(jmo3+1,indm,ig)-ka_mo3(jmo3,indm,ig))<a name='5924'>
            o3m2 = ka_mo3(jmo3,indm+1,ig) + fmo3 * &amp;<a name='5925'>
                 (ka_mo3(jmo3+1,indm+1,ig)-ka_mo3(jmo3,indm+1,ig))<a name='5926'>
            abso3 = o3m1 + minorfrac(lay)*(o3m2-o3m1)<a name='5927'>
<a name='5928'>
            if (specparm .lt. 0.125_rb) then<a name='5929'>
               tau_major = speccomb * &amp;<a name='5930'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5931'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5932'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='5933'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5934'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='5935'>
                    fac210 * absa(ind0+11,ig))<a name='5936'>
            else if (specparm .gt. 0.875_rb) then<a name='5937'>
               tau_major = speccomb * &amp;<a name='5938'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='5939'>
                    fac100 * absa(ind0,ig) + &amp;<a name='5940'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='5941'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='5942'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='5943'>
                    fac010 * absa(ind0+10,ig))<a name='5944'>
            else<a name='5945'>
               tau_major = speccomb * &amp;<a name='5946'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='5947'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='5948'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='5949'>
                    fac110 * absa(ind0+10,ig))<a name='5950'>
            endif<a name='5951'>
<a name='5952'>
            if (specparm1 .lt. 0.125_rb) then<a name='5953'>
               tau_major1 = speccomb1 * &amp;<a name='5954'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='5955'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5956'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='5957'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5958'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='5959'>
                    fac211 * absa(ind1+11,ig))<a name='5960'>
            else if (specparm1 .gt. 0.875_rb) then<a name='5961'>
               tau_major1 = speccomb1 * &amp; <a name='5962'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='5963'>
                    fac101 * absa(ind1,ig) + &amp;<a name='5964'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='5965'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='5966'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='5967'>
                    fac011 * absa(ind1+10,ig))<a name='5968'>
            else<a name='5969'>
               tau_major1 = speccomb1 * &amp;<a name='5970'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='5971'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='5972'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='5973'>
                    fac111 * absa(ind1+10,ig))<a name='5974'>
            endif<a name='5975'>
<a name='5976'>
            taug(lay,ngs4+ig) = tau_major + tau_major1 &amp;<a name='5977'>
                 + tauself + taufor &amp;<a name='5978'>
                 + abso3*colo3(lay) &amp;<a name='5979'>
                 + wx(1,lay) * ccl4(ig)<a name='5980'>
            fracs(lay,ngs4+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='5981'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='5982'>
         enddo<a name='5983'>
      enddo<a name='5984'>
<a name='5985'>
<font color=#447700>! Upper atmosphere loop<a name='5986'></font>
      do lay = laytrop+1, nlayers<a name='5987'>
<a name='5988'>
         speccomb = colo3(lay) + rat_o3co2(lay)*colco2(lay)<a name='5989'>
         specparm = colo3(lay)/speccomb<a name='5990'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='5991'>
         specmult = 4._rb*(specparm)<a name='5992'>
         js = 1 + int(specmult)<a name='5993'>
         fs = mod(specmult,1.0_rb)<a name='5994'>
<a name='5995'>
         speccomb1 = colo3(lay) + rat_o3co2_1(lay)*colco2(lay)<a name='5996'>
         specparm1 = colo3(lay)/speccomb1<a name='5997'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='5998'>
         specmult1 = 4._rb*(specparm1)<a name='5999'>
         js1 = 1 + int(specmult1)<a name='6000'>
         fs1 = mod(specmult1,1.0_rb)<a name='6001'>
<a name='6002'>
         fac000 = (1._rb - fs) * fac00(lay)<a name='6003'>
         fac010 = (1._rb - fs) * fac10(lay)<a name='6004'>
         fac100 = fs * fac00(lay)<a name='6005'>
         fac110 = fs * fac10(lay)<a name='6006'>
         fac001 = (1._rb - fs1) * fac01(lay)<a name='6007'>
         fac011 = (1._rb - fs1) * fac11(lay)<a name='6008'>
         fac101 = fs1 * fac01(lay)<a name='6009'>
         fac111 = fs1 * fac11(lay)<a name='6010'>
<a name='6011'>
         speccomb_planck = colo3(lay)+refrat_planck_b*colco2(lay)<a name='6012'>
         specparm_planck = colo3(lay)/speccomb_planck<a name='6013'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='6014'>
         specmult_planck = 4._rb*specparm_planck<a name='6015'>
         jpl= 1 + int(specmult_planck)<a name='6016'>
         fpl = mod(specmult_planck,1.0_rb)<a name='6017'>
<a name='6018'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(5) + js<a name='6019'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(5) + js1<a name='6020'>
         <a name='6021'>
         do ig = 1, ng5<a name='6022'>
            taug(lay,ngs4+ig) = speccomb * &amp;<a name='6023'>
                (fac000 * absb(ind0,ig) + &amp;<a name='6024'>
                fac100 * absb(ind0+1,ig) + &amp;<a name='6025'>
                fac010 * absb(ind0+5,ig) + &amp;<a name='6026'>
                fac110 * absb(ind0+6,ig)) &amp;<a name='6027'>
                + speccomb1 * &amp;<a name='6028'>
                (fac001 * absb(ind1,ig) + &amp;<a name='6029'>
                fac101 * absb(ind1+1,ig) + &amp;<a name='6030'>
                fac011 * absb(ind1+5,ig) + &amp;<a name='6031'>
                fac111 * absb(ind1+6,ig))  &amp;<a name='6032'>
                + wx(1,lay) * ccl4(ig)<a name='6033'>
            fracs(lay,ngs4+ig) = fracrefb(ig,jpl) + fpl * &amp;<a name='6034'>
                (fracrefb(ig,jpl+1)-fracrefb(ig,jpl))<a name='6035'>
         enddo<a name='6036'>
      enddo<a name='6037'>
<a name='6038'>
      end subroutine taugb5<a name='6039'>
<a name='6040'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6041'></font>
<A NAME='TAUGB6'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB6' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6042'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb6</font> <A href='../../call_to/TAUGB6.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB6.html' TARGET='index'>3</A><a name='6043'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6044'></font>
<font color=#447700>!<a name='6045'></font>
<font color=#447700>!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)<a name='6046'></font>
<font color=#447700>!                           (high key - nothing; high minor - cfc11, cfc12)<a name='6047'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6048'></font>
<a name='6049'>
<font color=#447700>! ------- Modules -------<a name='6050'></font>
<a name='6051'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_12">, only : ng6, ngs5<a name='6052'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_5">, only : chi_mls<a name='6053'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG06'>rrlw_kg06</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_1">, only : fracrefa, absa, ka, ka_mco2, &amp;<a name='6054'>
                            selfref, forref, cfc11adj, cfc12<a name='6055'>
<a name='6056'>
<font color=#447700>! ------- Declarations -------<a name='6057'></font>
<a name='6058'>
<font color=#447700>! Local <a name='6059'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='6060'>
      real(kind=rb) :: chi_co2, ratco2, adjfac, adjcolco2<a name='6061'>
      real(kind=rb) :: tauself, taufor, absco2<a name='6062'>
<a name='6063'>
<a name='6064'>
<font color=#447700>! Minor gas mapping level:<a name='6065'></font>
<font color=#447700>!     lower - co2, p = 706.2720 mb, t = 294.2 k<a name='6066'></font>
<font color=#447700>!     upper - cfc11, cfc12<a name='6067'></font>
<a name='6068'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and<a name='6069'></font>
<font color=#447700>! temperature. The water vapor self-continuum and foreign continuum<a name='6070'></font>
<font color=#447700>! is interpolated (in temperature) separately.  <a name='6071'></font>
<a name='6072'>
<font color=#447700>! Lower atmosphere loop<a name='6073'></font>
      do lay = 1, laytrop<a name='6074'>
<a name='6075'>
<font color=#447700>! In atmospheres where the amount of CO2 is too great to be considered<a name='6076'></font>
<font color=#447700>! a minor species, adjust the column amount of CO2 by an empirical factor <a name='6077'></font>
<font color=#447700>! to obtain the proper contribution.<a name='6078'></font>
         chi_co2 = colco2(lay)/(coldry(lay))<a name='6079'>
         ratco2 = 1.e20_rb*chi_co2/chi_mls(2,jp(lay)+1)<a name='6080'>
         if (ratco2 .gt. 3.0_rb) then<a name='6081'>
            adjfac = 2.0_rb+(ratco2-2.0_rb)**0.77_rb<a name='6082'>
            adjcolco2 = adjfac*chi_mls(2,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6083'>
         else<a name='6084'>
            adjcolco2 = colco2(lay)<a name='6085'>
         endif<a name='6086'>
<a name='6087'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(6) + 1<a name='6088'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(6) + 1<a name='6089'>
         inds = indself(lay)<a name='6090'>
         indf = indfor(lay)<a name='6091'>
         indm = indminor(lay)<a name='6092'>
<a name='6093'>
         do ig = 1, ng6<a name='6094'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6095'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6096'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6097'>
                 (forref(indf+1,ig) - forref(indf,ig)))<a name='6098'>
            absco2 =  (ka_mco2(indm,ig) + minorfrac(lay) * &amp;<a name='6099'>
                 (ka_mco2(indm+1,ig) - ka_mco2(indm,ig)))<a name='6100'>
            taug(lay,ngs5+ig) = colh2o(lay) * &amp;<a name='6101'>
                (fac00(lay) * absa(ind0,ig) + &amp;<a name='6102'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='6103'>
                 fac01(lay) * absa(ind1,ig) +  &amp;<a name='6104'>
                 fac11(lay) * absa(ind1+1,ig))  &amp;<a name='6105'>
                 + tauself + taufor &amp;<a name='6106'>
                 + adjcolco2 * absco2 &amp;<a name='6107'>
                 + wx(2,lay) * cfc11adj(ig) &amp;<a name='6108'>
                 + wx(3,lay) * cfc12(ig)<a name='6109'>
            fracs(lay,ngs5+ig) = fracrefa(ig)<a name='6110'>
         enddo<a name='6111'>
      enddo<a name='6112'>
<a name='6113'>
<font color=#447700>! Upper atmosphere loop<a name='6114'></font>
<font color=#447700>! Nothing important goes on above laytrop in this band.<a name='6115'></font>
      do lay = laytrop+1, nlayers<a name='6116'>
<a name='6117'>
         do ig = 1, ng6<a name='6118'>
            taug(lay,ngs5+ig) = 0.0_rb &amp;<a name='6119'>
                 + wx(2,lay) * cfc11adj(ig) &amp;<a name='6120'>
                 + wx(3,lay) * cfc12(ig)<a name='6121'>
            fracs(lay,ngs5+ig) = fracrefa(ig)<a name='6122'>
         enddo<a name='6123'>
      enddo<a name='6124'>
<a name='6125'>
      end subroutine taugb6<a name='6126'>
<a name='6127'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6128'></font>
<A NAME='TAUGB7'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB7' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6129'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb7</font> <A href='../../call_to/TAUGB7.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB7.html' TARGET='index'>3</A><a name='6130'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6131'></font>
<font color=#447700>!<a name='6132'></font>
<font color=#447700>!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)<a name='6133'></font>
<font color=#447700>!                            (high key - o3; high minor - co2)<a name='6134'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6135'></font>
<a name='6136'>
<font color=#447700>! ------- Modules -------<a name='6137'></font>
<a name='6138'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_13">, only : ng7, ngs6<a name='6139'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_6">, only : chi_mls<a name='6140'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG07'>rrlw_kg07</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='6141'>
                            ka_mco2, kb_mco2, selfref, forref<a name='6142'>
<a name='6143'>
<font color=#447700>! ------- Declarations -------<a name='6144'></font>
<a name='6145'>
<font color=#447700>! Local <a name='6146'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='6147'>
      integer(kind=im) :: js, js1, jmco2, jpl<a name='6148'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='6149'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='6150'>
      real(kind=rb) :: speccomb_mco2, specparm_mco2, specmult_mco2, fmco2<a name='6151'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6152'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='6153'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6154'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6155'>
      real(kind=rb) :: tauself, taufor, co2m1, co2m2, absco2<a name='6156'>
      real(kind=rb) :: chi_co2, ratco2, adjfac, adjcolco2<a name='6157'>
      real(kind=rb) :: refrat_planck_a, refrat_m_a<a name='6158'>
      real(kind=rb) :: tau_major, tau_major1<a name='6159'>
<a name='6160'>
<a name='6161'>
<font color=#447700>! Minor gas mapping level :<a name='6162'></font>
<font color=#447700>!     lower - co2, p = 706.2620 mbar, t= 278.94 k<a name='6163'></font>
<font color=#447700>!     upper - co2, p = 12.9350 mbar, t = 234.01 k<a name='6164'></font>
<a name='6165'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='6166'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='6167'></font>
<a name='6168'>
<font color=#447700>! P = 706.2620 mb<a name='6169'></font>
      refrat_planck_a = chi_mls(1,3)/chi_mls(3,3)<a name='6170'>
<a name='6171'>
<font color=#447700>! P = 706.2720 mb<a name='6172'></font>
      refrat_m_a = chi_mls(1,3)/chi_mls(3,3)<a name='6173'>
<a name='6174'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='6175'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='6176'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='6177'></font>
<font color=#447700>! (in temperature) separately. <a name='6178'></font>
<a name='6179'>
<font color=#447700>! Lower atmosphere loop<a name='6180'></font>
      do lay = 1, laytrop<a name='6181'>
<a name='6182'>
         speccomb = colh2o(lay) + rat_h2oo3(lay)*colo3(lay)<a name='6183'>
         specparm = colh2o(lay)/speccomb<a name='6184'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='6185'>
         specmult = 8._rb*(specparm)<a name='6186'>
         js = 1 + int(specmult)<a name='6187'>
         fs = mod(specmult,1.0_rb)<a name='6188'>
<a name='6189'>
         speccomb1 = colh2o(lay) + rat_h2oo3_1(lay)*colo3(lay)<a name='6190'>
         specparm1 = colh2o(lay)/speccomb1<a name='6191'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='6192'>
         specmult1 = 8._rb*(specparm1)<a name='6193'>
         js1 = 1 + int(specmult1)<a name='6194'>
         fs1 = mod(specmult1,1.0_rb)<a name='6195'>
<a name='6196'>
         speccomb_mco2 = colh2o(lay) + refrat_m_a*colo3(lay)<a name='6197'>
         specparm_mco2 = colh2o(lay)/speccomb_mco2<a name='6198'>
         if (specparm_mco2 .ge. oneminus) specparm_mco2 = oneminus<a name='6199'>
         specmult_mco2 = 8._rb*specparm_mco2<a name='6200'>
<a name='6201'>
         jmco2 = 1 + int(specmult_mco2)<a name='6202'>
         fmco2 = mod(specmult_mco2,1.0_rb)<a name='6203'>
<a name='6204'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='6205'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='6206'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6207'></font>
         chi_co2 = colco2(lay)/(coldry(lay))<a name='6208'>
         ratco2 = 1.e20*chi_co2/chi_mls(2,jp(lay)+1)<a name='6209'>
         if (ratco2 .gt. 3.0_rb) then<a name='6210'>
            adjfac = 3.0_rb+(ratco2-3.0_rb)**0.79_rb<a name='6211'>
            adjcolco2 = adjfac*chi_mls(2,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6212'>
         else<a name='6213'>
            adjcolco2 = colco2(lay)<a name='6214'>
         endif<a name='6215'>
<a name='6216'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colo3(lay)<a name='6217'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='6218'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='6219'>
         specmult_planck = 8._rb*specparm_planck<a name='6220'>
         jpl= 1 + int(specmult_planck)<a name='6221'>
         fpl = mod(specmult_planck,1.0_rb)<a name='6222'>
<a name='6223'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(7) + js<a name='6224'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(7) + js1<a name='6225'>
         inds = indself(lay)<a name='6226'>
         indf = indfor(lay)<a name='6227'>
         indm = indminor(lay)<a name='6228'>
<a name='6229'>
         if (specparm .lt. 0.125_rb) then<a name='6230'>
            p = fs - 1<a name='6231'>
            p4 = p**4<a name='6232'>
            fk0 = p4<a name='6233'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6234'>
            fk2 = p + p4<a name='6235'>
            fac000 = fk0*fac00(lay)<a name='6236'>
            fac100 = fk1*fac00(lay)<a name='6237'>
            fac200 = fk2*fac00(lay)<a name='6238'>
            fac010 = fk0*fac10(lay)<a name='6239'>
            fac110 = fk1*fac10(lay)<a name='6240'>
            fac210 = fk2*fac10(lay)<a name='6241'>
         else if (specparm .gt. 0.875_rb) then<a name='6242'>
            p = -fs <a name='6243'>
            p4 = p**4<a name='6244'>
            fk0 = p4<a name='6245'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6246'>
            fk2 = p + p4<a name='6247'>
            fac000 = fk0*fac00(lay)<a name='6248'>
            fac100 = fk1*fac00(lay)<a name='6249'>
            fac200 = fk2*fac00(lay)<a name='6250'>
            fac010 = fk0*fac10(lay)<a name='6251'>
            fac110 = fk1*fac10(lay)<a name='6252'>
            fac210 = fk2*fac10(lay)<a name='6253'>
         else<a name='6254'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='6255'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='6256'>
            fac100 = fs * fac00(lay)<a name='6257'>
            fac110 = fs * fac10(lay)<a name='6258'>
         endif<a name='6259'>
         if (specparm1 .lt. 0.125_rb) then<a name='6260'>
            p = fs1 - 1<a name='6261'>
            p4 = p**4<a name='6262'>
            fk0 = p4<a name='6263'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6264'>
            fk2 = p + p4<a name='6265'>
            fac001 = fk0*fac01(lay)<a name='6266'>
            fac101 = fk1*fac01(lay)<a name='6267'>
            fac201 = fk2*fac01(lay)<a name='6268'>
            fac011 = fk0*fac11(lay)<a name='6269'>
            fac111 = fk1*fac11(lay)<a name='6270'>
            fac211 = fk2*fac11(lay)<a name='6271'>
         else if (specparm1 .gt. 0.875_rb) then<a name='6272'>
            p = -fs1 <a name='6273'>
            p4 = p**4<a name='6274'>
            fk0 = p4<a name='6275'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6276'>
            fk2 = p + p4<a name='6277'>
            fac001 = fk0*fac01(lay)<a name='6278'>
            fac101 = fk1*fac01(lay)<a name='6279'>
            fac201 = fk2*fac01(lay)<a name='6280'>
            fac011 = fk0*fac11(lay)<a name='6281'>
            fac111 = fk1*fac11(lay)<a name='6282'>
            fac211 = fk2*fac11(lay)<a name='6283'>
         else<a name='6284'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='6285'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='6286'>
            fac101 = fs1 * fac01(lay)<a name='6287'>
            fac111 = fs1 * fac11(lay)<a name='6288'>
         endif<a name='6289'>
<a name='6290'>
         do ig = 1, ng7<a name='6291'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6292'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6293'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6294'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='6295'>
            co2m1 = ka_mco2(jmco2,indm,ig) + fmco2 * &amp;<a name='6296'>
                 (ka_mco2(jmco2+1,indm,ig) - ka_mco2(jmco2,indm,ig))<a name='6297'>
            co2m2 = ka_mco2(jmco2,indm+1,ig) + fmco2 * &amp;<a name='6298'>
                 (ka_mco2(jmco2+1,indm+1,ig) - ka_mco2(jmco2,indm+1,ig))<a name='6299'>
            absco2 = co2m1 + minorfrac(lay) * (co2m2 - co2m1)<a name='6300'>
<a name='6301'>
            if (specparm .lt. 0.125_rb) then<a name='6302'>
               tau_major = speccomb * &amp;<a name='6303'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='6304'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='6305'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='6306'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='6307'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='6308'>
                    fac210 * absa(ind0+11,ig))<a name='6309'>
            else if (specparm .gt. 0.875_rb) then<a name='6310'>
               tau_major = speccomb * &amp;<a name='6311'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='6312'>
                    fac100 * absa(ind0,ig) + &amp;<a name='6313'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='6314'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='6315'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='6316'>
                    fac010 * absa(ind0+10,ig))<a name='6317'>
            else<a name='6318'>
               tau_major = speccomb * &amp;<a name='6319'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='6320'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='6321'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='6322'>
                    fac110 * absa(ind0+10,ig))<a name='6323'>
            endif<a name='6324'>
<a name='6325'>
            if (specparm1 .lt. 0.125_rb) then<a name='6326'>
               tau_major1 = speccomb1 * &amp;<a name='6327'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='6328'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='6329'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='6330'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='6331'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='6332'>
                    fac211 * absa(ind1+11,ig))<a name='6333'>
            else if (specparm1 .gt. 0.875_rb) then<a name='6334'>
               tau_major1 = speccomb1 * &amp;<a name='6335'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='6336'>
                    fac101 * absa(ind1,ig) + &amp;<a name='6337'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='6338'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='6339'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='6340'>
                    fac011 * absa(ind1+10,ig))<a name='6341'>
            else<a name='6342'>
               tau_major1 = speccomb1 * &amp;<a name='6343'>
                    (fac001 * absa(ind1,ig) +  &amp;<a name='6344'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='6345'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='6346'>
                    fac111 * absa(ind1+10,ig))<a name='6347'>
            endif<a name='6348'>
<a name='6349'>
            taug(lay,ngs6+ig) = tau_major + tau_major1 &amp;<a name='6350'>
                 + tauself + taufor &amp;<a name='6351'>
                 + adjcolco2*absco2<a name='6352'>
            fracs(lay,ngs6+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='6353'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='6354'>
         enddo<a name='6355'>
      enddo<a name='6356'>
<a name='6357'>
<font color=#447700>! Upper atmosphere loop<a name='6358'></font>
      do lay = laytrop+1, nlayers<a name='6359'>
<a name='6360'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='6361'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='6362'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6363'></font>
         chi_co2 = colco2(lay)/(coldry(lay))<a name='6364'>
         ratco2 = 1.e20*chi_co2/chi_mls(2,jp(lay)+1)<a name='6365'>
         if (ratco2 .gt. 3.0_rb) then<a name='6366'>
            adjfac = 2.0_rb+(ratco2-2.0_rb)**0.79_rb<a name='6367'>
            adjcolco2 = adjfac*chi_mls(2,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6368'>
         else<a name='6369'>
            adjcolco2 = colco2(lay)<a name='6370'>
         endif<a name='6371'>
<a name='6372'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(7) + 1<a name='6373'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(7) + 1<a name='6374'>
         indm = indminor(lay)<a name='6375'>
<a name='6376'>
         do ig = 1, ng7<a name='6377'>
            absco2 = kb_mco2(indm,ig) + minorfrac(lay) * &amp;<a name='6378'>
                 (kb_mco2(indm+1,ig) - kb_mco2(indm,ig))<a name='6379'>
            taug(lay,ngs6+ig) = colo3(lay) * &amp;<a name='6380'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='6381'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='6382'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='6383'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;<a name='6384'>
                 + adjcolco2 * absco2<a name='6385'>
            fracs(lay,ngs6+ig) = fracrefb(ig)<a name='6386'>
         enddo<a name='6387'>
<a name='6388'>
<font color=#447700>! Empirical modification to code to improve stratospheric cooling rates<a name='6389'></font>
<font color=#447700>! for o3.  Revised to apply weighting for g-point reduction in this band.<a name='6390'></font>
<a name='6391'>
         taug(lay,ngs6+6)=taug(lay,ngs6+6)*0.92_rb<a name='6392'>
         taug(lay,ngs6+7)=taug(lay,ngs6+7)*0.88_rb<a name='6393'>
         taug(lay,ngs6+8)=taug(lay,ngs6+8)*1.07_rb<a name='6394'>
         taug(lay,ngs6+9)=taug(lay,ngs6+9)*1.1_rb<a name='6395'>
         taug(lay,ngs6+10)=taug(lay,ngs6+10)*0.99_rb<a name='6396'>
         taug(lay,ngs6+11)=taug(lay,ngs6+11)*0.855_rb<a name='6397'>
<a name='6398'>
      enddo<a name='6399'>
<a name='6400'>
      end subroutine taugb7<a name='6401'>
<a name='6402'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6403'></font>
<A NAME='TAUGB8'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6404'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb8</font> <A href='../../call_to/TAUGB8.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB8.html' TARGET='index'>3</A><a name='6405'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6406'></font>
<font color=#447700>!<a name='6407'></font>
<font color=#447700>!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)<a name='6408'></font>
<font color=#447700>!                             (high key - o3; high minor - co2, n2o)<a name='6409'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6410'></font>
<a name='6411'>
<font color=#447700>! ------- Modules -------<a name='6412'></font>
<a name='6413'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_14">, only : ng8, ngs7<a name='6414'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_7">, only : chi_mls<a name='6415'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG08'>rrlw_kg08</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='6416'>
                            ka_mco2, ka_mn2o, ka_mo3, kb_mco2, kb_mn2o, &amp;<a name='6417'>
                            selfref, forref, cfc12, cfc22adj<a name='6418'>
<a name='6419'>
<font color=#447700>! ------- Declarations -------<a name='6420'></font>
<a name='6421'>
<font color=#447700>! Local <a name='6422'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='6423'>
      real(kind=rb) :: tauself, taufor, absco2, abso3, absn2o<a name='6424'>
      real(kind=rb) :: chi_co2, ratco2, adjfac, adjcolco2<a name='6425'>
<a name='6426'>
<a name='6427'>
<font color=#447700>! Minor gas mapping level:<a name='6428'></font>
<font color=#447700>!     lower - co2, p = 1053.63 mb, t = 294.2 k<a name='6429'></font>
<font color=#447700>!     lower - o3,  p = 317.348 mb, t = 240.77 k<a name='6430'></font>
<font color=#447700>!     lower - n2o, p = 706.2720 mb, t= 278.94 k<a name='6431'></font>
<font color=#447700>!     lower - cfc12,cfc11<a name='6432'></font>
<font color=#447700>!     upper - co2, p = 35.1632 mb, t = 223.28 k<a name='6433'></font>
<font color=#447700>!     upper - n2o, p = 8.716e-2 mb, t = 226.03 k<a name='6434'></font>
<a name='6435'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='6436'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water vapor <a name='6437'></font>
<font color=#447700>! self-continuum and foreign continuum is interpolated (in temperature) <a name='6438'></font>
<font color=#447700>! separately.<a name='6439'></font>
<a name='6440'>
<font color=#447700>! Lower atmosphere loop<a name='6441'></font>
      do lay = 1, laytrop<a name='6442'>
<a name='6443'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='6444'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='6445'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6446'></font>
         chi_co2 = colco2(lay)/(coldry(lay))<a name='6447'>
         ratco2 = 1.e20_rb*chi_co2/chi_mls(2,jp(lay)+1)<a name='6448'>
         if (ratco2 .gt. 3.0_rb) then<a name='6449'>
            adjfac = 2.0_rb+(ratco2-2.0_rb)**0.65_rb<a name='6450'>
            adjcolco2 = adjfac*chi_mls(2,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6451'>
         else<a name='6452'>
            adjcolco2 = colco2(lay)<a name='6453'>
         endif<a name='6454'>
<a name='6455'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(8) + 1<a name='6456'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(8) + 1<a name='6457'>
         inds = indself(lay)<a name='6458'>
         indf = indfor(lay)<a name='6459'>
         indm = indminor(lay)<a name='6460'>
<a name='6461'>
         do ig = 1, ng8<a name='6462'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6463'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6464'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6465'>
                 (forref(indf+1,ig) - forref(indf,ig)))<a name='6466'>
            absco2 =  (ka_mco2(indm,ig) + minorfrac(lay) * &amp;<a name='6467'>
                 (ka_mco2(indm+1,ig) - ka_mco2(indm,ig)))<a name='6468'>
            abso3 =  (ka_mo3(indm,ig) + minorfrac(lay) * &amp;<a name='6469'>
                 (ka_mo3(indm+1,ig) - ka_mo3(indm,ig)))<a name='6470'>
            absn2o =  (ka_mn2o(indm,ig) + minorfrac(lay) * &amp;<a name='6471'>
                 (ka_mn2o(indm+1,ig) - ka_mn2o(indm,ig)))<a name='6472'>
            taug(lay,ngs7+ig) = colh2o(lay) * &amp;<a name='6473'>
                 (fac00(lay) * absa(ind0,ig) + &amp;<a name='6474'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='6475'>
                 fac01(lay) * absa(ind1,ig) +  &amp;<a name='6476'>
                 fac11(lay) * absa(ind1+1,ig)) &amp;<a name='6477'>
                 + tauself + taufor &amp;<a name='6478'>
                 + adjcolco2*absco2 &amp;<a name='6479'>
                 + colo3(lay) * abso3 &amp;<a name='6480'>
                 + coln2o(lay) * absn2o &amp;<a name='6481'>
                 + wx(3,lay) * cfc12(ig) &amp;<a name='6482'>
                 + wx(4,lay) * cfc22adj(ig)<a name='6483'>
            fracs(lay,ngs7+ig) = fracrefa(ig)<a name='6484'>
         enddo<a name='6485'>
      enddo<a name='6486'>
<a name='6487'>
<font color=#447700>! Upper atmosphere loop<a name='6488'></font>
      do lay = laytrop+1, nlayers<a name='6489'>
<a name='6490'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='6491'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='6492'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6493'></font>
         chi_co2 = colco2(lay)/coldry(lay)<a name='6494'>
         ratco2 = 1.e20_rb*chi_co2/chi_mls(2,jp(lay)+1)<a name='6495'>
         if (ratco2 .gt. 3.0_rb) then<a name='6496'>
            adjfac = 2.0_rb+(ratco2-2.0_rb)**0.65_rb<a name='6497'>
            adjcolco2 = adjfac*chi_mls(2,jp(lay)+1) * coldry(lay)*1.e-20_rb<a name='6498'>
         else<a name='6499'>
            adjcolco2 = colco2(lay)<a name='6500'>
         endif<a name='6501'>
<a name='6502'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(8) + 1<a name='6503'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(8) + 1<a name='6504'>
         indm = indminor(lay)<a name='6505'>
<a name='6506'>
         do ig = 1, ng8<a name='6507'>
            absco2 =  (kb_mco2(indm,ig) + minorfrac(lay) * &amp;<a name='6508'>
                 (kb_mco2(indm+1,ig) - kb_mco2(indm,ig)))<a name='6509'>
            absn2o =  (kb_mn2o(indm,ig) + minorfrac(lay) * &amp;<a name='6510'>
                 (kb_mn2o(indm+1,ig) - kb_mn2o(indm,ig)))<a name='6511'>
            taug(lay,ngs7+ig) = colo3(lay) * &amp;<a name='6512'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='6513'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='6514'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='6515'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;<a name='6516'>
                 + adjcolco2*absco2 &amp;<a name='6517'>
                 + coln2o(lay)*absn2o &amp; <a name='6518'>
                 + wx(3,lay) * cfc12(ig) &amp;<a name='6519'>
                 + wx(4,lay) * cfc22adj(ig)<a name='6520'>
            fracs(lay,ngs7+ig) = fracrefb(ig)<a name='6521'>
         enddo<a name='6522'>
      enddo<a name='6523'>
<a name='6524'>
      end subroutine taugb8<a name='6525'>
<a name='6526'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6527'></font>
<A NAME='TAUGB9'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB9' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6528'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb9</font> <A href='../../call_to/TAUGB9.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB9.html' TARGET='index'>3</A><a name='6529'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6530'></font>
<font color=#447700>!<a name='6531'></font>
<font color=#447700>!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)<a name='6532'></font>
<font color=#447700>!                             (high key - ch4; high minor - n2o)<a name='6533'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6534'></font>
<a name='6535'>
<font color=#447700>! ------- Modules -------<a name='6536'></font>
<a name='6537'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_15">, only : ng9, ngs8<a name='6538'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_8">, only : chi_mls<a name='6539'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG09'>rrlw_kg09</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='6540'>
                            ka_mn2o, kb_mn2o, selfref, forref<a name='6541'>
<a name='6542'>
<font color=#447700>! ------- Declarations -------<a name='6543'></font>
<a name='6544'>
<font color=#447700>! Local <a name='6545'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='6546'>
      integer(kind=im) :: js, js1, jmn2o, jpl<a name='6547'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='6548'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='6549'>
      real(kind=rb) :: speccomb_mn2o, specparm_mn2o, specmult_mn2o, fmn2o<a name='6550'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6551'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='6552'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6553'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6554'>
      real(kind=rb) :: tauself, taufor, n2om1, n2om2, absn2o<a name='6555'>
      real(kind=rb) :: chi_n2o, ratn2o, adjfac, adjcoln2o<a name='6556'>
      real(kind=rb) :: refrat_planck_a, refrat_m_a<a name='6557'>
      real(kind=rb) :: tau_major, tau_major1<a name='6558'>
<a name='6559'>
<a name='6560'>
<font color=#447700>! Minor gas mapping level :<a name='6561'></font>
<font color=#447700>!     lower - n2o, p = 706.272 mbar, t = 278.94 k<a name='6562'></font>
<font color=#447700>!     upper - n2o, p = 95.58 mbar, t = 215.7 k<a name='6563'></font>
<a name='6564'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='6565'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='6566'></font>
<a name='6567'>
<font color=#447700>! P = 212 mb<a name='6568'></font>
      refrat_planck_a = chi_mls(1,9)/chi_mls(6,9)<a name='6569'>
<a name='6570'>
<font color=#447700>! P = 706.272 mb <a name='6571'></font>
      refrat_m_a = chi_mls(1,3)/chi_mls(6,3)<a name='6572'>
<a name='6573'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='6574'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='6575'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='6576'></font>
<font color=#447700>! (in temperature) separately.  <a name='6577'></font>
<a name='6578'>
<font color=#447700>! Lower atmosphere loop<a name='6579'></font>
      do lay = 1, laytrop<a name='6580'>
<a name='6581'>
         speccomb = colh2o(lay) + rat_h2och4(lay)*colch4(lay)<a name='6582'>
         specparm = colh2o(lay)/speccomb<a name='6583'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='6584'>
         specmult = 8._rb*(specparm)<a name='6585'>
         js = 1 + int(specmult)<a name='6586'>
         fs = mod(specmult,1.0_rb)<a name='6587'>
<a name='6588'>
         speccomb1 = colh2o(lay) + rat_h2och4_1(lay)*colch4(lay)<a name='6589'>
         specparm1 = colh2o(lay)/speccomb1<a name='6590'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='6591'>
         specmult1 = 8._rb*(specparm1)<a name='6592'>
         js1 = 1 + int(specmult1)<a name='6593'>
         fs1 = mod(specmult1,1.0_rb)<a name='6594'>
<a name='6595'>
         speccomb_mn2o = colh2o(lay) + refrat_m_a*colch4(lay)<a name='6596'>
         specparm_mn2o = colh2o(lay)/speccomb_mn2o<a name='6597'>
         if (specparm_mn2o .ge. oneminus) specparm_mn2o = oneminus<a name='6598'>
         specmult_mn2o = 8._rb*specparm_mn2o<a name='6599'>
         jmn2o = 1 + int(specmult_mn2o)<a name='6600'>
         fmn2o = mod(specmult_mn2o,1.0_rb)<a name='6601'>
<a name='6602'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='6603'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='6604'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6605'></font>
         chi_n2o = coln2o(lay)/(coldry(lay))<a name='6606'>
         ratn2o = 1.e20_rb*chi_n2o/chi_mls(4,jp(lay)+1)<a name='6607'>
         if (ratn2o .gt. 1.5_rb) then<a name='6608'>
            adjfac = 0.5_rb+(ratn2o-0.5_rb)**0.65_rb<a name='6609'>
            adjcoln2o = adjfac*chi_mls(4,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6610'>
         else<a name='6611'>
            adjcoln2o = coln2o(lay)<a name='6612'>
         endif<a name='6613'>
<a name='6614'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colch4(lay)<a name='6615'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='6616'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='6617'>
         specmult_planck = 8._rb*specparm_planck<a name='6618'>
         jpl= 1 + int(specmult_planck)<a name='6619'>
         fpl = mod(specmult_planck,1.0_rb)<a name='6620'>
<a name='6621'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(9) + js<a name='6622'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(9) + js1<a name='6623'>
         inds = indself(lay)<a name='6624'>
         indf = indfor(lay)<a name='6625'>
         indm = indminor(lay)<a name='6626'>
<a name='6627'>
         if (specparm .lt. 0.125_rb) then<a name='6628'>
            p = fs - 1<a name='6629'>
            p4 = p**4<a name='6630'>
            fk0 = p4<a name='6631'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6632'>
            fk2 = p + p4<a name='6633'>
            fac000 = fk0*fac00(lay)<a name='6634'>
            fac100 = fk1*fac00(lay)<a name='6635'>
            fac200 = fk2*fac00(lay)<a name='6636'>
            fac010 = fk0*fac10(lay)<a name='6637'>
            fac110 = fk1*fac10(lay)<a name='6638'>
            fac210 = fk2*fac10(lay)<a name='6639'>
         else if (specparm .gt. 0.875_rb) then<a name='6640'>
            p = -fs <a name='6641'>
            p4 = p**4<a name='6642'>
            fk0 = p4<a name='6643'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6644'>
            fk2 = p + p4<a name='6645'>
            fac000 = fk0*fac00(lay)<a name='6646'>
            fac100 = fk1*fac00(lay)<a name='6647'>
            fac200 = fk2*fac00(lay)<a name='6648'>
            fac010 = fk0*fac10(lay)<a name='6649'>
            fac110 = fk1*fac10(lay)<a name='6650'>
            fac210 = fk2*fac10(lay)<a name='6651'>
         else<a name='6652'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='6653'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='6654'>
            fac100 = fs * fac00(lay)<a name='6655'>
            fac110 = fs * fac10(lay)<a name='6656'>
         endif<a name='6657'>
<a name='6658'>
         if (specparm1 .lt. 0.125_rb) then<a name='6659'>
            p = fs1 - 1<a name='6660'>
            p4 = p**4<a name='6661'>
            fk0 = p4<a name='6662'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6663'>
            fk2 = p + p4<a name='6664'>
            fac001 = fk0*fac01(lay)<a name='6665'>
            fac101 = fk1*fac01(lay)<a name='6666'>
            fac201 = fk2*fac01(lay)<a name='6667'>
            fac011 = fk0*fac11(lay)<a name='6668'>
            fac111 = fk1*fac11(lay)<a name='6669'>
            fac211 = fk2*fac11(lay)<a name='6670'>
         else if (specparm1 .gt. 0.875_rb) then<a name='6671'>
            p = -fs1 <a name='6672'>
            p4 = p**4<a name='6673'>
            fk0 = p4<a name='6674'>
            fk1 = 1 - p - 2.0_rb*p4<a name='6675'>
            fk2 = p + p4<a name='6676'>
            fac001 = fk0*fac01(lay)<a name='6677'>
            fac101 = fk1*fac01(lay)<a name='6678'>
            fac201 = fk2*fac01(lay)<a name='6679'>
            fac011 = fk0*fac11(lay)<a name='6680'>
            fac111 = fk1*fac11(lay)<a name='6681'>
            fac211 = fk2*fac11(lay)<a name='6682'>
         else<a name='6683'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='6684'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='6685'>
            fac101 = fs1 * fac01(lay)<a name='6686'>
            fac111 = fs1 * fac11(lay)<a name='6687'>
         endif<a name='6688'>
<a name='6689'>
         do ig = 1, ng9<a name='6690'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6691'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6692'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6693'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='6694'>
            n2om1 = ka_mn2o(jmn2o,indm,ig) + fmn2o * &amp;<a name='6695'>
                 (ka_mn2o(jmn2o+1,indm,ig) - ka_mn2o(jmn2o,indm,ig))<a name='6696'>
            n2om2 = ka_mn2o(jmn2o,indm+1,ig) + fmn2o * &amp;<a name='6697'>
                 (ka_mn2o(jmn2o+1,indm+1,ig) - ka_mn2o(jmn2o,indm+1,ig))<a name='6698'>
            absn2o = n2om1 + minorfrac(lay) * (n2om2 - n2om1)<a name='6699'>
<a name='6700'>
            if (specparm .lt. 0.125_rb) then<a name='6701'>
               tau_major = speccomb * &amp;<a name='6702'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='6703'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='6704'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='6705'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='6706'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='6707'>
                    fac210 * absa(ind0+11,ig))<a name='6708'>
            else if (specparm .gt. 0.875_rb) then<a name='6709'>
               tau_major = speccomb * &amp;<a name='6710'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='6711'>
                    fac100 * absa(ind0,ig) + &amp;<a name='6712'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='6713'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='6714'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='6715'>
                    fac010 * absa(ind0+10,ig))<a name='6716'>
            else<a name='6717'>
               tau_major = speccomb * &amp;<a name='6718'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='6719'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='6720'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='6721'>
                    fac110 * absa(ind0+10,ig))<a name='6722'>
            endif<a name='6723'>
<a name='6724'>
            if (specparm1 .lt. 0.125_rb) then<a name='6725'>
               tau_major1 = speccomb1 * &amp;<a name='6726'>
                    (fac001 * absa(ind1,ig) + &amp; <a name='6727'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='6728'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='6729'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='6730'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='6731'>
                    fac211 * absa(ind1+11,ig))<a name='6732'>
            else if (specparm1 .gt. 0.875_rb) then<a name='6733'>
               tau_major1 = speccomb1 * &amp;<a name='6734'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='6735'>
                    fac101 * absa(ind1,ig) + &amp;<a name='6736'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='6737'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='6738'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='6739'>
                    fac011 * absa(ind1+10,ig))<a name='6740'>
            else<a name='6741'>
               tau_major1 = speccomb1 * &amp;<a name='6742'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='6743'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='6744'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='6745'>
                    fac111 * absa(ind1+10,ig))<a name='6746'>
            endif<a name='6747'>
<a name='6748'>
            taug(lay,ngs8+ig) = tau_major + tau_major1 &amp;<a name='6749'>
                 + tauself + taufor &amp;<a name='6750'>
                 + adjcoln2o*absn2o<a name='6751'>
            fracs(lay,ngs8+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='6752'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='6753'>
         enddo<a name='6754'>
      enddo<a name='6755'>
<a name='6756'>
<font color=#447700>! Upper atmosphere loop<a name='6757'></font>
      do lay = laytrop+1, nlayers<a name='6758'>
<a name='6759'>
<font color=#447700>!  In atmospheres where the amount of N2O is too great to be considered<a name='6760'></font>
<font color=#447700>!  a minor species, adjust the column amount of N2O by an empirical factor <a name='6761'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='6762'></font>
         chi_n2o = coln2o(lay)/(coldry(lay))<a name='6763'>
         ratn2o = 1.e20_rb*chi_n2o/chi_mls(4,jp(lay)+1)<a name='6764'>
         if (ratn2o .gt. 1.5_rb) then<a name='6765'>
            adjfac = 0.5_rb+(ratn2o-0.5_rb)**0.65_rb<a name='6766'>
            adjcoln2o = adjfac*chi_mls(4,jp(lay)+1)*coldry(lay)*1.e-20_rb<a name='6767'>
         else<a name='6768'>
            adjcoln2o = coln2o(lay)<a name='6769'>
         endif<a name='6770'>
<a name='6771'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(9) + 1<a name='6772'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(9) + 1<a name='6773'>
         indm = indminor(lay)<a name='6774'>
<a name='6775'>
         do ig = 1, ng9<a name='6776'>
            absn2o = kb_mn2o(indm,ig) + minorfrac(lay) * &amp;<a name='6777'>
                (kb_mn2o(indm+1,ig) - kb_mn2o(indm,ig))<a name='6778'>
            taug(lay,ngs8+ig) = colch4(lay) * &amp;<a name='6779'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='6780'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='6781'>
                 fac01(lay) * absb(ind1,ig) +  &amp;<a name='6782'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;<a name='6783'>
                 + adjcoln2o*absn2o<a name='6784'>
            fracs(lay,ngs8+ig) = fracrefb(ig)<a name='6785'>
         enddo<a name='6786'>
      enddo<a name='6787'>
<a name='6788'>
      end subroutine taugb9<a name='6789'>
<a name='6790'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6791'></font>
<A NAME='TAUGB10'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6792'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb10</font> <A href='../../call_to/TAUGB10.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB10.html' TARGET='index'>2</A><a name='6793'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6794'></font>
<font color=#447700>!<a name='6795'></font>
<font color=#447700>!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)<a name='6796'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6797'></font>
<a name='6798'>
<font color=#447700>! ------- Modules -------<a name='6799'></font>
<a name='6800'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_16">, only : ng10, ngs9<a name='6801'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG10'>rrlw_kg10</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='6802'>
                            selfref, forref<a name='6803'>
<a name='6804'>
<font color=#447700>! ------- Declarations -------<a name='6805'></font>
<a name='6806'>
<font color=#447700>! Local <a name='6807'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='6808'>
      real(kind=rb) :: tauself, taufor<a name='6809'>
<a name='6810'>
<a name='6811'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='6812'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='6813'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='6814'></font>
<a name='6815'>
<font color=#447700>! Lower atmosphere loop<a name='6816'></font>
      do lay = 1, laytrop<a name='6817'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(10) + 1<a name='6818'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(10) + 1<a name='6819'>
         inds = indself(lay)<a name='6820'>
         indf = indfor(lay)<a name='6821'>
<a name='6822'>
         do ig = 1, ng10<a name='6823'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6824'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6825'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6826'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='6827'>
            taug(lay,ngs9+ig) = colh2o(lay) * &amp;<a name='6828'>
                 (fac00(lay) * absa(ind0,ig) + &amp;<a name='6829'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='6830'>
                 fac01(lay) * absa(ind1,ig) + &amp;<a name='6831'>
                 fac11(lay) * absa(ind1+1,ig))  &amp;<a name='6832'>
                 + tauself + taufor<a name='6833'>
            fracs(lay,ngs9+ig) = fracrefa(ig)<a name='6834'>
         enddo<a name='6835'>
      enddo<a name='6836'>
<a name='6837'>
<font color=#447700>! Upper atmosphere loop<a name='6838'></font>
      do lay = laytrop+1, nlayers<a name='6839'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(10) + 1<a name='6840'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(10) + 1<a name='6841'>
         indf = indfor(lay)<a name='6842'>
<a name='6843'>
         do ig = 1, ng10<a name='6844'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6845'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='6846'>
            taug(lay,ngs9+ig) = colh2o(lay) * &amp;<a name='6847'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='6848'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='6849'>
                 fac01(lay) * absb(ind1,ig) +  &amp;<a name='6850'>
                 fac11(lay) * absb(ind1+1,ig)) &amp;<a name='6851'>
                 + taufor<a name='6852'>
            fracs(lay,ngs9+ig) = fracrefb(ig)<a name='6853'>
         enddo<a name='6854'>
      enddo<a name='6855'>
<a name='6856'>
      end subroutine taugb10<a name='6857'>
<a name='6858'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6859'></font>
<A NAME='TAUGB11'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6860'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb11</font> <A href='../../call_to/TAUGB11.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB11.html' TARGET='index'>2</A><a name='6861'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6862'></font>
<font color=#447700>!<a name='6863'></font>
<font color=#447700>!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='6864'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='6865'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6866'></font>
<a name='6867'>
<font color=#447700>! ------- Modules -------<a name='6868'></font>
<a name='6869'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_17">, only : ng11, ngs10<a name='6870'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG11'>rrlw_kg11</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='6871'>
                            ka_mo2, kb_mo2, selfref, forref<a name='6872'>
<a name='6873'>
<font color=#447700>! ------- Declarations -------<a name='6874'></font>
<a name='6875'>
<font color=#447700>! Local <a name='6876'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='6877'>
      real(kind=rb) :: scaleo2, tauself, taufor, tauo2<a name='6878'>
<a name='6879'>
<a name='6880'>
<font color=#447700>! Minor gas mapping level :<a name='6881'></font>
<font color=#447700>!     lower - o2, p = 706.2720 mbar, t = 278.94 k<a name='6882'></font>
<font color=#447700>!     upper - o2, p = 4.758820 mbarm t = 250.85 k<a name='6883'></font>
<a name='6884'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='6885'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum and<a name='6886'></font>
<font color=#447700>! foreign continuum is interpolated (in temperature) separately.<a name='6887'></font>
<a name='6888'>
<font color=#447700>! Lower atmosphere loop<a name='6889'></font>
      do lay = 1, laytrop<a name='6890'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(11) + 1<a name='6891'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(11) + 1<a name='6892'>
         inds = indself(lay)<a name='6893'>
         indf = indfor(lay)<a name='6894'>
         indm = indminor(lay)<a name='6895'>
         scaleo2 = colo2(lay)*scaleminor(lay)<a name='6896'>
         do ig = 1, ng11<a name='6897'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='6898'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='6899'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6900'>
                 (forref(indf+1,ig) - forref(indf,ig)))<a name='6901'>
            tauo2 =  scaleo2 * (ka_mo2(indm,ig) + minorfrac(lay) * &amp;<a name='6902'>
                 (ka_mo2(indm+1,ig) - ka_mo2(indm,ig)))<a name='6903'>
            taug(lay,ngs10+ig) = colh2o(lay) * &amp;<a name='6904'>
                 (fac00(lay) * absa(ind0,ig) + &amp;<a name='6905'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='6906'>
                 fac01(lay) * absa(ind1,ig) + &amp;<a name='6907'>
                 fac11(lay) * absa(ind1+1,ig)) &amp;<a name='6908'>
                 + tauself + taufor &amp;<a name='6909'>
                 + tauo2<a name='6910'>
            fracs(lay,ngs10+ig) = fracrefa(ig)<a name='6911'>
         enddo<a name='6912'>
      enddo<a name='6913'>
<a name='6914'>
<font color=#447700>! Upper atmosphere loop<a name='6915'></font>
      do lay = laytrop+1, nlayers<a name='6916'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(11) + 1<a name='6917'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(11) + 1<a name='6918'>
         indf = indfor(lay)<a name='6919'>
         indm = indminor(lay)<a name='6920'>
         scaleo2 = colo2(lay)*scaleminor(lay)<a name='6921'>
         do ig = 1, ng11<a name='6922'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='6923'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='6924'>
            tauo2 =  scaleo2 * (kb_mo2(indm,ig) + minorfrac(lay) * &amp;<a name='6925'>
                 (kb_mo2(indm+1,ig) - kb_mo2(indm,ig)))<a name='6926'>
            taug(lay,ngs10+ig) = colh2o(lay) * &amp;<a name='6927'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='6928'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='6929'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='6930'>
                 fac11(lay) * absb(ind1+1,ig))  &amp;<a name='6931'>
                 + taufor &amp;<a name='6932'>
                 + tauo2<a name='6933'>
            fracs(lay,ngs10+ig) = fracrefb(ig)<a name='6934'>
         enddo<a name='6935'>
      enddo<a name='6936'>
<a name='6937'>
      end subroutine taugb11<a name='6938'>
<a name='6939'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6940'></font>
<A NAME='TAUGB12'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6941'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb12</font> <A href='../../call_to/TAUGB12.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB12.html' TARGET='index'>3</A><a name='6942'>
<font color=#447700>!----------------------------------------------------------------------------<a name='6943'></font>
<font color=#447700>!<a name='6944'></font>
<font color=#447700>!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='6945'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='6946'></font>
<a name='6947'>
<font color=#447700>! ------- Modules -------<a name='6948'></font>
<a name='6949'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_18">, only : ng12, ngs11<a name='6950'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_9">, only : chi_mls<a name='6951'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG12'>rrlw_kg12</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_1">, only : fracrefa, absa, ka, &amp;<a name='6952'>
                            selfref, forref<a name='6953'>
<a name='6954'>
<font color=#447700>! ------- Declarations -------<a name='6955'></font>
<a name='6956'>
<font color=#447700>! Local <a name='6957'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='6958'>
      integer(kind=im) :: js, js1, jpl<a name='6959'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='6960'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='6961'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='6962'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='6963'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='6964'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='6965'>
      real(kind=rb) :: tauself, taufor<a name='6966'>
      real(kind=rb) :: refrat_planck_a<a name='6967'>
      real(kind=rb) :: tau_major, tau_major1<a name='6968'>
<a name='6969'>
<a name='6970'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='6971'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='6972'></font>
<a name='6973'>
<font color=#447700>! P =   174.164 mb <a name='6974'></font>
      refrat_planck_a = chi_mls(1,10)/chi_mls(2,10)<a name='6975'>
<a name='6976'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='6977'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='6978'></font>
<font color=#447700>! vapor self-continuum adn foreign continuum is interpolated <a name='6979'></font>
<font color=#447700>! (in temperature) separately.  <a name='6980'></font>
<a name='6981'>
<font color=#447700>! Lower atmosphere loop<a name='6982'></font>
      do lay = 1, laytrop<a name='6983'>
<a name='6984'>
         speccomb = colh2o(lay) + rat_h2oco2(lay)*colco2(lay)<a name='6985'>
         specparm = colh2o(lay)/speccomb<a name='6986'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='6987'>
         specmult = 8._rb*(specparm)<a name='6988'>
         js = 1 + int(specmult)<a name='6989'>
         fs = mod(specmult,1.0_rb)<a name='6990'>
<a name='6991'>
         speccomb1 = colh2o(lay) + rat_h2oco2_1(lay)*colco2(lay)<a name='6992'>
         specparm1 = colh2o(lay)/speccomb1<a name='6993'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='6994'>
         specmult1 = 8._rb*(specparm1)<a name='6995'>
         js1 = 1 + int(specmult1)<a name='6996'>
         fs1 = mod(specmult1,1.0_rb)<a name='6997'>
<a name='6998'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colco2(lay)<a name='6999'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='7000'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='7001'>
         specmult_planck = 8._rb*specparm_planck<a name='7002'>
         jpl= 1 + int(specmult_planck)<a name='7003'>
         fpl = mod(specmult_planck,1.0_rb)<a name='7004'>
<a name='7005'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(12) + js<a name='7006'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(12) + js1<a name='7007'>
         inds = indself(lay)<a name='7008'>
         indf = indfor(lay)<a name='7009'>
<a name='7010'>
         if (specparm .lt. 0.125_rb) then<a name='7011'>
            p = fs - 1<a name='7012'>
            p4 = p**4<a name='7013'>
            fk0 = p4<a name='7014'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7015'>
            fk2 = p + p4<a name='7016'>
            fac000 = fk0*fac00(lay)<a name='7017'>
            fac100 = fk1*fac00(lay)<a name='7018'>
            fac200 = fk2*fac00(lay)<a name='7019'>
            fac010 = fk0*fac10(lay)<a name='7020'>
            fac110 = fk1*fac10(lay)<a name='7021'>
            fac210 = fk2*fac10(lay)<a name='7022'>
         else if (specparm .gt. 0.875_rb) then<a name='7023'>
            p = -fs <a name='7024'>
            p4 = p**4<a name='7025'>
            fk0 = p4<a name='7026'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7027'>
            fk2 = p + p4<a name='7028'>
            fac000 = fk0*fac00(lay)<a name='7029'>
            fac100 = fk1*fac00(lay)<a name='7030'>
            fac200 = fk2*fac00(lay)<a name='7031'>
            fac010 = fk0*fac10(lay)<a name='7032'>
            fac110 = fk1*fac10(lay)<a name='7033'>
            fac210 = fk2*fac10(lay)<a name='7034'>
         else<a name='7035'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='7036'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='7037'>
            fac100 = fs * fac00(lay)<a name='7038'>
            fac110 = fs * fac10(lay)<a name='7039'>
         endif<a name='7040'>
<a name='7041'>
         if (specparm1 .lt. 0.125_rb) then<a name='7042'>
            p = fs1 - 1<a name='7043'>
            p4 = p**4<a name='7044'>
            fk0 = p4<a name='7045'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7046'>
            fk2 = p + p4<a name='7047'>
            fac001 = fk0*fac01(lay)<a name='7048'>
            fac101 = fk1*fac01(lay)<a name='7049'>
            fac201 = fk2*fac01(lay)<a name='7050'>
            fac011 = fk0*fac11(lay)<a name='7051'>
            fac111 = fk1*fac11(lay)<a name='7052'>
            fac211 = fk2*fac11(lay)<a name='7053'>
         else if (specparm1 .gt. 0.875_rb) then<a name='7054'>
            p = -fs1 <a name='7055'>
            p4 = p**4<a name='7056'>
            fk0 = p4<a name='7057'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7058'>
            fk2 = p + p4<a name='7059'>
            fac001 = fk0*fac01(lay)<a name='7060'>
            fac101 = fk1*fac01(lay)<a name='7061'>
            fac201 = fk2*fac01(lay)<a name='7062'>
            fac011 = fk0*fac11(lay)<a name='7063'>
            fac111 = fk1*fac11(lay)<a name='7064'>
            fac211 = fk2*fac11(lay)<a name='7065'>
         else<a name='7066'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='7067'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='7068'>
            fac101 = fs1 * fac01(lay)<a name='7069'>
            fac111 = fs1 * fac11(lay)<a name='7070'>
         endif<a name='7071'>
<a name='7072'>
         do ig = 1, ng12<a name='7073'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='7074'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='7075'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='7076'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='7077'>
<a name='7078'>
            if (specparm .lt. 0.125_rb) then<a name='7079'>
               tau_major = speccomb * &amp;<a name='7080'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7081'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7082'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='7083'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7084'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='7085'>
                    fac210 * absa(ind0+11,ig))<a name='7086'>
            else if (specparm .gt. 0.875_rb) then<a name='7087'>
               tau_major = speccomb * &amp;<a name='7088'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='7089'>
                    fac100 * absa(ind0,ig) + &amp;<a name='7090'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='7091'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='7092'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='7093'>
                    fac010 * absa(ind0+10,ig))<a name='7094'>
            else<a name='7095'>
               tau_major = speccomb * &amp;<a name='7096'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7097'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7098'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7099'>
                    fac110 * absa(ind0+10,ig))<a name='7100'>
            endif<a name='7101'>
<a name='7102'>
            if (specparm1 .lt. 0.125_rb) then<a name='7103'>
               tau_major1 = speccomb1 * &amp;<a name='7104'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7105'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7106'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='7107'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7108'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='7109'>
                    fac211 * absa(ind1+11,ig))<a name='7110'>
            else if (specparm1 .gt. 0.875_rb) then<a name='7111'>
               tau_major1 = speccomb1 * &amp;<a name='7112'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='7113'>
                    fac101 * absa(ind1,ig) + &amp;<a name='7114'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='7115'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='7116'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='7117'>
                    fac011 * absa(ind1+10,ig))<a name='7118'>
            else<a name='7119'>
               tau_major1 = speccomb1 * &amp;<a name='7120'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7121'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7122'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7123'>
                    fac111 * absa(ind1+10,ig))<a name='7124'>
            endif<a name='7125'>
<a name='7126'>
            taug(lay,ngs11+ig) = tau_major + tau_major1 &amp;<a name='7127'>
                 + tauself + taufor<a name='7128'>
            fracs(lay,ngs11+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='7129'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='7130'>
         enddo<a name='7131'>
      enddo<a name='7132'>
<a name='7133'>
<font color=#447700>! Upper atmosphere loop<a name='7134'></font>
      do lay = laytrop+1, nlayers<a name='7135'>
<a name='7136'>
         do ig = 1, ng12<a name='7137'>
            taug(lay,ngs11+ig) = 0.0_rb<a name='7138'>
            fracs(lay,ngs11+ig) = 0.0_rb<a name='7139'>
         enddo<a name='7140'>
      enddo<a name='7141'>
<a name='7142'>
      end subroutine taugb12<a name='7143'>
<a name='7144'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7145'></font>
<A NAME='TAUGB13'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7146'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb13</font> <A href='../../call_to/TAUGB13.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB13.html' TARGET='index'>3</A><a name='7147'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7148'></font>
<font color=#447700>!<a name='7149'></font>
<font color=#447700>!     band 13:  2080-2250 cm-1 (low key - h2o,n2o; high minor - o3 minor)<a name='7150'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7151'></font>
<a name='7152'>
<font color=#447700>! ------- Modules -------<a name='7153'></font>
<a name='7154'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_19">, only : ng13, ngs12<a name='7155'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_10">, only : chi_mls<a name='7156'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG13'>rrlw_kg13</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_1">, only : fracrefa, fracrefb, absa, ka, &amp;<a name='7157'>
                            ka_mco2, ka_mco, kb_mo3, selfref, forref<a name='7158'>
<a name='7159'>
<font color=#447700>! ------- Declarations -------<a name='7160'></font>
<a name='7161'>
<font color=#447700>! Local <a name='7162'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='7163'>
      integer(kind=im) :: js, js1, jmco2, jmco, jpl<a name='7164'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='7165'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='7166'>
      real(kind=rb) :: speccomb_mco2, specparm_mco2, specmult_mco2, fmco2<a name='7167'>
      real(kind=rb) :: speccomb_mco, specparm_mco, specmult_mco, fmco<a name='7168'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='7169'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='7170'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='7171'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='7172'>
      real(kind=rb) :: tauself, taufor, co2m1, co2m2, absco2 <a name='7173'>
      real(kind=rb) :: com1, com2, absco, abso3<a name='7174'>
      real(kind=rb) :: chi_co2, ratco2, adjfac, adjcolco2<a name='7175'>
      real(kind=rb) :: refrat_planck_a, refrat_m_a, refrat_m_a3<a name='7176'>
      real(kind=rb) :: tau_major, tau_major1<a name='7177'>
<a name='7178'>
<font color=#447700>! Minor gas mapping levels :<a name='7179'></font>
<font color=#447700>!     lower - co2, p = 1053.63 mb, t = 294.2 k<a name='7180'></font>
<font color=#447700>!     lower - co, p = 706 mb, t = 278.94 k<a name='7181'></font>
<font color=#447700>!     upper - o3, p = 95.5835 mb, t = 215.7 k<a name='7182'></font>
<a name='7183'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='7184'></font>
<font color=#447700>! fraction in lower/upper atmosphere.<a name='7185'></font>
<a name='7186'>
<font color=#447700>! P = 473.420 mb (Level 5)<a name='7187'></font>
      refrat_planck_a = chi_mls(1,5)/chi_mls(4,5)<a name='7188'>
<a name='7189'>
<font color=#447700>! P = 1053. (Level 1)<a name='7190'></font>
      refrat_m_a = chi_mls(1,1)/chi_mls(4,1)<a name='7191'>
<a name='7192'>
<font color=#447700>! P = 706. (Level 3)<a name='7193'></font>
      refrat_m_a3 = chi_mls(1,3)/chi_mls(4,3)<a name='7194'>
<a name='7195'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='7196'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='7197'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='7198'></font>
<font color=#447700>! (in temperature) separately.  <a name='7199'></font>
<a name='7200'>
<font color=#447700>! Lower atmosphere loop<a name='7201'></font>
      do lay = 1, laytrop<a name='7202'>
<a name='7203'>
         speccomb = colh2o(lay) + rat_h2on2o(lay)*coln2o(lay)<a name='7204'>
         specparm = colh2o(lay)/speccomb<a name='7205'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='7206'>
         specmult = 8._rb*(specparm)<a name='7207'>
         js = 1 + int(specmult)<a name='7208'>
         fs = mod(specmult,1.0_rb)<a name='7209'>
<a name='7210'>
         speccomb1 = colh2o(lay) + rat_h2on2o_1(lay)*coln2o(lay)<a name='7211'>
         specparm1 = colh2o(lay)/speccomb1<a name='7212'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='7213'>
         specmult1 = 8._rb*(specparm1)<a name='7214'>
         js1 = 1 + int(specmult1)<a name='7215'>
         fs1 = mod(specmult1,1.0_rb)<a name='7216'>
<a name='7217'>
         speccomb_mco2 = colh2o(lay) + refrat_m_a*coln2o(lay)<a name='7218'>
         specparm_mco2 = colh2o(lay)/speccomb_mco2<a name='7219'>
         if (specparm_mco2 .ge. oneminus) specparm_mco2 = oneminus<a name='7220'>
         specmult_mco2 = 8._rb*specparm_mco2<a name='7221'>
         jmco2 = 1 + int(specmult_mco2)<a name='7222'>
         fmco2 = mod(specmult_mco2,1.0_rb)<a name='7223'>
<a name='7224'>
<font color=#447700>!  In atmospheres where the amount of CO2 is too great to be considered<a name='7225'></font>
<font color=#447700>!  a minor species, adjust the column amount of CO2 by an empirical factor <a name='7226'></font>
<font color=#447700>!  to obtain the proper contribution.<a name='7227'></font>
         chi_co2 = colco2(lay)/(coldry(lay))<a name='7228'>
         ratco2 = 1.e20_rb*chi_co2/3.55e-4_rb<a name='7229'>
         if (ratco2 .gt. 3.0_rb) then<a name='7230'>
            adjfac = 2.0_rb+(ratco2-2.0_rb)**0.68_rb<a name='7231'>
            adjcolco2 = adjfac*3.55e-4*coldry(lay)*1.e-20_rb<a name='7232'>
         else<a name='7233'>
            adjcolco2 = colco2(lay)<a name='7234'>
         endif<a name='7235'>
<a name='7236'>
         speccomb_mco = colh2o(lay) + refrat_m_a3*coln2o(lay)<a name='7237'>
         specparm_mco = colh2o(lay)/speccomb_mco<a name='7238'>
         if (specparm_mco .ge. oneminus) specparm_mco = oneminus<a name='7239'>
         specmult_mco = 8._rb*specparm_mco<a name='7240'>
         jmco = 1 + int(specmult_mco)<a name='7241'>
         fmco = mod(specmult_mco,1.0_rb)<a name='7242'>
<a name='7243'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*coln2o(lay)<a name='7244'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='7245'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='7246'>
         specmult_planck = 8._rb*specparm_planck<a name='7247'>
         jpl= 1 + int(specmult_planck)<a name='7248'>
         fpl = mod(specmult_planck,1.0_rb)<a name='7249'>
<a name='7250'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(13) + js<a name='7251'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(13) + js1<a name='7252'>
         inds = indself(lay)<a name='7253'>
         indf = indfor(lay)<a name='7254'>
         indm = indminor(lay)<a name='7255'>
<a name='7256'>
         if (specparm .lt. 0.125_rb) then<a name='7257'>
            p = fs - 1<a name='7258'>
            p4 = p**4<a name='7259'>
            fk0 = p4<a name='7260'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7261'>
            fk2 = p + p4<a name='7262'>
            fac000 = fk0*fac00(lay)<a name='7263'>
            fac100 = fk1*fac00(lay)<a name='7264'>
            fac200 = fk2*fac00(lay)<a name='7265'>
            fac010 = fk0*fac10(lay)<a name='7266'>
            fac110 = fk1*fac10(lay)<a name='7267'>
            fac210 = fk2*fac10(lay)<a name='7268'>
         else if (specparm .gt. 0.875_rb) then<a name='7269'>
            p = -fs <a name='7270'>
            p4 = p**4<a name='7271'>
            fk0 = p4<a name='7272'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7273'>
            fk2 = p + p4<a name='7274'>
            fac000 = fk0*fac00(lay)<a name='7275'>
            fac100 = fk1*fac00(lay)<a name='7276'>
            fac200 = fk2*fac00(lay)<a name='7277'>
            fac010 = fk0*fac10(lay)<a name='7278'>
            fac110 = fk1*fac10(lay)<a name='7279'>
            fac210 = fk2*fac10(lay)<a name='7280'>
         else<a name='7281'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='7282'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='7283'>
            fac100 = fs * fac00(lay)<a name='7284'>
            fac110 = fs * fac10(lay)<a name='7285'>
         endif<a name='7286'>
<a name='7287'>
         if (specparm1 .lt. 0.125_rb) then<a name='7288'>
            p = fs1 - 1<a name='7289'>
            p4 = p**4<a name='7290'>
            fk0 = p4<a name='7291'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7292'>
            fk2 = p + p4<a name='7293'>
            fac001 = fk0*fac01(lay)<a name='7294'>
            fac101 = fk1*fac01(lay)<a name='7295'>
            fac201 = fk2*fac01(lay)<a name='7296'>
            fac011 = fk0*fac11(lay)<a name='7297'>
            fac111 = fk1*fac11(lay)<a name='7298'>
            fac211 = fk2*fac11(lay)<a name='7299'>
         else if (specparm1 .gt. 0.875_rb) then<a name='7300'>
            p = -fs1 <a name='7301'>
            p4 = p**4<a name='7302'>
            fk0 = p4<a name='7303'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7304'>
            fk2 = p + p4<a name='7305'>
            fac001 = fk0*fac01(lay)<a name='7306'>
            fac101 = fk1*fac01(lay)<a name='7307'>
            fac201 = fk2*fac01(lay)<a name='7308'>
            fac011 = fk0*fac11(lay)<a name='7309'>
            fac111 = fk1*fac11(lay)<a name='7310'>
            fac211 = fk2*fac11(lay)<a name='7311'>
         else<a name='7312'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='7313'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='7314'>
            fac101 = fs1 * fac01(lay)<a name='7315'>
            fac111 = fs1 * fac11(lay)<a name='7316'>
         endif<a name='7317'>
<a name='7318'>
         do ig = 1, ng13<a name='7319'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='7320'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='7321'>
            taufor = forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='7322'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='7323'>
            co2m1 = ka_mco2(jmco2,indm,ig) + fmco2 * &amp;<a name='7324'>
                 (ka_mco2(jmco2+1,indm,ig) - ka_mco2(jmco2,indm,ig))<a name='7325'>
            co2m2 = ka_mco2(jmco2,indm+1,ig) + fmco2 * &amp;<a name='7326'>
                 (ka_mco2(jmco2+1,indm+1,ig) - ka_mco2(jmco2,indm+1,ig))<a name='7327'>
            absco2 = co2m1 + minorfrac(lay) * (co2m2 - co2m1)<a name='7328'>
            com1 = ka_mco(jmco,indm,ig) + fmco * &amp;<a name='7329'>
                 (ka_mco(jmco+1,indm,ig) - ka_mco(jmco,indm,ig))<a name='7330'>
            com2 = ka_mco(jmco,indm+1,ig) + fmco * &amp;<a name='7331'>
                 (ka_mco(jmco+1,indm+1,ig) - ka_mco(jmco,indm+1,ig))<a name='7332'>
            absco = com1 + minorfrac(lay) * (com2 - com1)<a name='7333'>
<a name='7334'>
            if (specparm .lt. 0.125_rb) then<a name='7335'>
               tau_major = speccomb * &amp;<a name='7336'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7337'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7338'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='7339'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7340'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='7341'>
                    fac210 * absa(ind0+11,ig))<a name='7342'>
            else if (specparm .gt. 0.875_rb) then<a name='7343'>
               tau_major = speccomb * &amp;<a name='7344'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='7345'>
                    fac100 * absa(ind0,ig) + &amp;<a name='7346'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='7347'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='7348'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='7349'>
                    fac010 * absa(ind0+10,ig))<a name='7350'>
            else<a name='7351'>
               tau_major = speccomb * &amp;<a name='7352'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7353'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7354'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7355'>
                    fac110 * absa(ind0+10,ig))<a name='7356'>
            endif<a name='7357'>
<a name='7358'>
            if (specparm1 .lt. 0.125_rb) then<a name='7359'>
               tau_major1 = speccomb1 * &amp;<a name='7360'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7361'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7362'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='7363'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7364'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='7365'>
                    fac211 * absa(ind1+11,ig))<a name='7366'>
            else if (specparm1 .gt. 0.875_rb) then<a name='7367'>
               tau_major1 = speccomb1 * &amp;<a name='7368'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='7369'>
                    fac101 * absa(ind1,ig) + &amp;<a name='7370'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='7371'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='7372'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='7373'>
                    fac011 * absa(ind1+10,ig))<a name='7374'>
            else<a name='7375'>
               tau_major1 = speccomb1 * &amp;<a name='7376'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7377'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7378'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7379'>
                    fac111 * absa(ind1+10,ig))<a name='7380'>
            endif<a name='7381'>
<a name='7382'>
            taug(lay,ngs12+ig) = tau_major + tau_major1 &amp;<a name='7383'>
                 + tauself + taufor &amp;<a name='7384'>
                 + adjcolco2*absco2 &amp;<a name='7385'>
                 + colco(lay)*absco<a name='7386'>
            fracs(lay,ngs12+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='7387'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='7388'>
         enddo<a name='7389'>
      enddo<a name='7390'>
<a name='7391'>
<font color=#447700>! Upper atmosphere loop<a name='7392'></font>
      do lay = laytrop+1, nlayers<a name='7393'>
         indm = indminor(lay)<a name='7394'>
         do ig = 1, ng13<a name='7395'>
            abso3 = kb_mo3(indm,ig) + minorfrac(lay) * &amp;<a name='7396'>
                 (kb_mo3(indm+1,ig) - kb_mo3(indm,ig))<a name='7397'>
            taug(lay,ngs12+ig) = colo3(lay)*abso3<a name='7398'>
            fracs(lay,ngs12+ig) =  fracrefb(ig)<a name='7399'>
         enddo<a name='7400'>
      enddo<a name='7401'>
<a name='7402'>
      end subroutine taugb13<a name='7403'>
<a name='7404'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7405'></font>
<A NAME='TAUGB14'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7406'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb14</font> <A href='../../call_to/TAUGB14.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB14.html' TARGET='index'>2</A><a name='7407'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7408'></font>
<font color=#447700>!<a name='7409'></font>
<font color=#447700>!     band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='7410'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7411'></font>
<a name='7412'>
<font color=#447700>! ------- Modules -------<a name='7413'></font>
<a name='7414'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_20">, only : ng14, ngs13<a name='7415'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG14'>rrlw_kg14</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='7416'>
                            selfref, forref<a name='7417'>
<a name='7418'>
<font color=#447700>! ------- Declarations -------<a name='7419'></font>
<a name='7420'>
<font color=#447700>! Local <a name='7421'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='7422'>
      real(kind=rb) :: tauself, taufor<a name='7423'>
<a name='7424'>
<a name='7425'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure) and <a name='7426'></font>
<font color=#447700>! temperature.  Below laytrop, the water vapor self-continuum <a name='7427'></font>
<font color=#447700>! and foreign continuum is interpolated (in temperature) separately.  <a name='7428'></font>
<a name='7429'>
<font color=#447700>! Lower atmosphere loop<a name='7430'></font>
      do lay = 1, laytrop<a name='7431'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(14) + 1<a name='7432'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(14) + 1<a name='7433'>
         inds = indself(lay)<a name='7434'>
         indf = indfor(lay)<a name='7435'>
         do ig = 1, ng14<a name='7436'>
            tauself = selffac(lay) * (selfref(inds,ig) + selffrac(lay) * &amp;<a name='7437'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='7438'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='7439'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='7440'>
            taug(lay,ngs13+ig) = colco2(lay) * &amp;<a name='7441'>
                 (fac00(lay) * absa(ind0,ig) + &amp;<a name='7442'>
                 fac10(lay) * absa(ind0+1,ig) + &amp;<a name='7443'>
                 fac01(lay) * absa(ind1,ig) + &amp;<a name='7444'>
                 fac11(lay) * absa(ind1+1,ig)) &amp;<a name='7445'>
                 + tauself + taufor<a name='7446'>
            fracs(lay,ngs13+ig) = fracrefa(ig)<a name='7447'>
         enddo<a name='7448'>
      enddo<a name='7449'>
<a name='7450'>
<font color=#447700>! Upper atmosphere loop<a name='7451'></font>
      do lay = laytrop+1, nlayers<a name='7452'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(14) + 1<a name='7453'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(14) + 1<a name='7454'>
         do ig = 1, ng14<a name='7455'>
            taug(lay,ngs13+ig) = colco2(lay) * &amp;<a name='7456'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='7457'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='7458'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='7459'>
                 fac11(lay) * absb(ind1+1,ig))<a name='7460'>
            fracs(lay,ngs13+ig) = fracrefb(ig)<a name='7461'>
         enddo<a name='7462'>
      enddo<a name='7463'>
<a name='7464'>
      end subroutine taugb14<a name='7465'>
<a name='7466'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7467'></font>
<A NAME='TAUGB15'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7468'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb15</font> <A href='../../call_to/TAUGB15.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB15.html' TARGET='index'>3</A><a name='7469'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7470'></font>
<font color=#447700>!<a name='7471'></font>
<font color=#447700>!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)<a name='7472'></font>
<font color=#447700>!                              (high - nothing)<a name='7473'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7474'></font>
<a name='7475'>
<font color=#447700>! ------- Modules -------<a name='7476'></font>
<a name='7477'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_21">, only : ng15, ngs14<a name='7478'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_11">, only : chi_mls<a name='7479'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG15'>rrlw_kg15</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_1">, only : fracrefa, absa, ka, &amp;<a name='7480'>
                            ka_mn2, selfref, forref<a name='7481'>
<a name='7482'>
<font color=#447700>! ------- Declarations -------<a name='7483'></font>
<a name='7484'>
<font color=#447700>! Local <a name='7485'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, indm, ig<a name='7486'>
      integer(kind=im) :: js, js1, jmn2, jpl<a name='7487'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='7488'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='7489'>
      real(kind=rb) :: speccomb_mn2, specparm_mn2, specmult_mn2, fmn2<a name='7490'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='7491'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='7492'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='7493'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='7494'>
      real(kind=rb) :: scalen2, tauself, taufor, n2m1, n2m2, taun2 <a name='7495'>
      real(kind=rb) :: refrat_planck_a, refrat_m_a<a name='7496'>
      real(kind=rb) :: tau_major, tau_major1<a name='7497'>
<a name='7498'>
<a name='7499'>
<font color=#447700>! Minor gas mapping level : <a name='7500'></font>
<font color=#447700>!     Lower - Nitrogen Continuum, P = 1053., T = 294.<a name='7501'></font>
<a name='7502'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='7503'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='7504'></font>
<font color=#447700>! P = 1053. mb (Level 1)<a name='7505'></font>
      refrat_planck_a = chi_mls(4,1)/chi_mls(2,1)<a name='7506'>
<a name='7507'>
<font color=#447700>! P = 1053.<a name='7508'></font>
      refrat_m_a = chi_mls(4,1)/chi_mls(2,1)<a name='7509'>
<a name='7510'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='7511'></font>
<font color=#447700>! temperature, and appropriate species.  Below laytrop, the water<a name='7512'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='7513'></font>
<font color=#447700>! (in temperature) separately.  <a name='7514'></font>
<a name='7515'>
<font color=#447700>! Lower atmosphere loop<a name='7516'></font>
      do lay = 1, laytrop<a name='7517'>
<a name='7518'>
         speccomb = coln2o(lay) + rat_n2oco2(lay)*colco2(lay)<a name='7519'>
         specparm = coln2o(lay)/speccomb<a name='7520'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='7521'>
         specmult = 8._rb*(specparm)<a name='7522'>
         js = 1 + int(specmult)<a name='7523'>
         fs = mod(specmult,1.0_rb)<a name='7524'>
<a name='7525'>
         speccomb1 = coln2o(lay) + rat_n2oco2_1(lay)*colco2(lay)<a name='7526'>
         specparm1 = coln2o(lay)/speccomb1<a name='7527'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='7528'>
         specmult1 = 8._rb*(specparm1)<a name='7529'>
         js1 = 1 + int(specmult1)<a name='7530'>
         fs1 = mod(specmult1,1.0_rb)<a name='7531'>
<a name='7532'>
         speccomb_mn2 = coln2o(lay) + refrat_m_a*colco2(lay)<a name='7533'>
         specparm_mn2 = coln2o(lay)/speccomb_mn2<a name='7534'>
         if (specparm_mn2 .ge. oneminus) specparm_mn2 = oneminus<a name='7535'>
         specmult_mn2 = 8._rb*specparm_mn2<a name='7536'>
         jmn2 = 1 + int(specmult_mn2)<a name='7537'>
         fmn2 = mod(specmult_mn2,1.0_rb)<a name='7538'>
<a name='7539'>
         speccomb_planck = coln2o(lay)+refrat_planck_a*colco2(lay)<a name='7540'>
         specparm_planck = coln2o(lay)/speccomb_planck<a name='7541'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='7542'>
         specmult_planck = 8._rb*specparm_planck<a name='7543'>
         jpl= 1 + int(specmult_planck)<a name='7544'>
         fpl = mod(specmult_planck,1.0_rb)<a name='7545'>
<a name='7546'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(15) + js<a name='7547'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(15) + js1<a name='7548'>
         inds = indself(lay)<a name='7549'>
         indf = indfor(lay)<a name='7550'>
         indm = indminor(lay)<a name='7551'>
         <a name='7552'>
         scalen2 = colbrd(lay)*scaleminor(lay)<a name='7553'>
<a name='7554'>
         if (specparm .lt. 0.125_rb) then<a name='7555'>
            p = fs - 1<a name='7556'>
            p4 = p**4<a name='7557'>
            fk0 = p4<a name='7558'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7559'>
            fk2 = p + p4<a name='7560'>
            fac000 = fk0*fac00(lay)<a name='7561'>
            fac100 = fk1*fac00(lay)<a name='7562'>
            fac200 = fk2*fac00(lay)<a name='7563'>
            fac010 = fk0*fac10(lay)<a name='7564'>
            fac110 = fk1*fac10(lay)<a name='7565'>
            fac210 = fk2*fac10(lay)<a name='7566'>
         else if (specparm .gt. 0.875_rb) then<a name='7567'>
            p = -fs <a name='7568'>
            p4 = p**4<a name='7569'>
            fk0 = p4<a name='7570'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7571'>
            fk2 = p + p4<a name='7572'>
            fac000 = fk0*fac00(lay)<a name='7573'>
            fac100 = fk1*fac00(lay)<a name='7574'>
            fac200 = fk2*fac00(lay)<a name='7575'>
            fac010 = fk0*fac10(lay)<a name='7576'>
            fac110 = fk1*fac10(lay)<a name='7577'>
            fac210 = fk2*fac10(lay)<a name='7578'>
         else<a name='7579'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='7580'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='7581'>
            fac100 = fs * fac00(lay)<a name='7582'>
            fac110 = fs * fac10(lay)<a name='7583'>
         endif<a name='7584'>
         if (specparm1 .lt. 0.125_rb) then<a name='7585'>
            p = fs1 - 1<a name='7586'>
            p4 = p**4<a name='7587'>
            fk0 = p4<a name='7588'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7589'>
            fk2 = p + p4<a name='7590'>
            fac001 = fk0*fac01(lay)<a name='7591'>
            fac101 = fk1*fac01(lay)<a name='7592'>
            fac201 = fk2*fac01(lay)<a name='7593'>
            fac011 = fk0*fac11(lay)<a name='7594'>
            fac111 = fk1*fac11(lay)<a name='7595'>
            fac211 = fk2*fac11(lay)<a name='7596'>
         else if (specparm1 .gt. 0.875_rb) then<a name='7597'>
            p = -fs1 <a name='7598'>
            p4 = p**4<a name='7599'>
            fk0 = p4<a name='7600'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7601'>
            fk2 = p + p4<a name='7602'>
            fac001 = fk0*fac01(lay)<a name='7603'>
            fac101 = fk1*fac01(lay)<a name='7604'>
            fac201 = fk2*fac01(lay)<a name='7605'>
            fac011 = fk0*fac11(lay)<a name='7606'>
            fac111 = fk1*fac11(lay)<a name='7607'>
            fac211 = fk2*fac11(lay)<a name='7608'>
         else<a name='7609'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='7610'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='7611'>
            fac101 = fs1 * fac01(lay)<a name='7612'>
            fac111 = fs1 * fac11(lay)<a name='7613'>
         endif<a name='7614'>
<a name='7615'>
         do ig = 1, ng15<a name='7616'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='7617'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='7618'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='7619'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='7620'>
            n2m1 = ka_mn2(jmn2,indm,ig) + fmn2 * &amp;<a name='7621'>
                 (ka_mn2(jmn2+1,indm,ig) - ka_mn2(jmn2,indm,ig))<a name='7622'>
            n2m2 = ka_mn2(jmn2,indm+1,ig) + fmn2 * &amp;<a name='7623'>
                 (ka_mn2(jmn2+1,indm+1,ig) - ka_mn2(jmn2,indm+1,ig))<a name='7624'>
            taun2 = scalen2 * (n2m1 + minorfrac(lay) * (n2m2 - n2m1))<a name='7625'>
<a name='7626'>
            if (specparm .lt. 0.125_rb) then<a name='7627'>
               tau_major = speccomb * &amp;<a name='7628'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7629'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7630'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='7631'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7632'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='7633'>
                    fac210 * absa(ind0+11,ig))<a name='7634'>
            else if (specparm .gt. 0.875_rb) then<a name='7635'>
               tau_major = speccomb * &amp;<a name='7636'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='7637'>
                    fac100 * absa(ind0,ig) + &amp;<a name='7638'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='7639'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='7640'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='7641'>
                    fac010 * absa(ind0+10,ig))<a name='7642'>
            else<a name='7643'>
               tau_major = speccomb * &amp;<a name='7644'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7645'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7646'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7647'>
                    fac110 * absa(ind0+10,ig))<a name='7648'>
            endif <a name='7649'>
<a name='7650'>
            if (specparm1 .lt. 0.125_rb) then<a name='7651'>
               tau_major1 = speccomb1 * &amp;<a name='7652'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7653'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7654'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='7655'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7656'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='7657'>
                    fac211 * absa(ind1+11,ig))<a name='7658'>
            else if (specparm1 .gt. 0.875_rb) then<a name='7659'>
               tau_major1 = speccomb1 * &amp;<a name='7660'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='7661'>
                    fac101 * absa(ind1,ig) + &amp;<a name='7662'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='7663'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='7664'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='7665'>
                    fac011 * absa(ind1+10,ig))<a name='7666'>
            else<a name='7667'>
               tau_major1 = speccomb1 * &amp;<a name='7668'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7669'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7670'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7671'>
                    fac111 * absa(ind1+10,ig))<a name='7672'>
            endif<a name='7673'>
<a name='7674'>
            taug(lay,ngs14+ig) = tau_major + tau_major1 &amp;<a name='7675'>
                 + tauself + taufor &amp;<a name='7676'>
                 + taun2<a name='7677'>
            fracs(lay,ngs14+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='7678'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='7679'>
         enddo<a name='7680'>
      enddo<a name='7681'>
<a name='7682'>
<font color=#447700>! Upper atmosphere loop<a name='7683'></font>
      do lay = laytrop+1, nlayers<a name='7684'>
         do ig = 1, ng15<a name='7685'>
            taug(lay,ngs14+ig) = 0.0_rb<a name='7686'>
            fracs(lay,ngs14+ig) = 0.0_rb<a name='7687'>
         enddo<a name='7688'>
      enddo<a name='7689'>
<a name='7690'>
      end subroutine taugb15<a name='7691'>
<a name='7692'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7693'></font>
<A NAME='TAUGB16'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7694'>
      <font color=#993300>subroutine </font><font color=#cc0000>taugb16</font> <A href='../../call_to/TAUGB16.html' TARGET='index'>2</A>,<A href='../../call_from/TAUGB16.html' TARGET='index'>3</A><a name='7695'>
<font color=#447700>!----------------------------------------------------------------------------<a name='7696'></font>
<font color=#447700>!<a name='7697'></font>
<font color=#447700>!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)<a name='7698'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='7699'></font>
<a name='7700'>
<font color=#447700>! ------- Modules -------<a name='7701'></font>
<a name='7702'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_22">, only : ng16, ngs15<a name='7703'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_REF'>rrlw_ref</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_REF_12">, only : chi_mls<a name='7704'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG16'>rrlw_kg16</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_1">, only : fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='7705'>
                            selfref, forref<a name='7706'>
<a name='7707'>
<font color=#447700>! ------- Declarations -------<a name='7708'></font>
<a name='7709'>
<font color=#447700>! Local <a name='7710'></font>
      integer(kind=im) :: lay, ind0, ind1, inds, indf, ig<a name='7711'>
      integer(kind=im) :: js, js1, jpl<a name='7712'>
      real(kind=rb) :: speccomb, specparm, specmult, fs<a name='7713'>
      real(kind=rb) :: speccomb1, specparm1, specmult1, fs1<a name='7714'>
      real(kind=rb) :: speccomb_planck, specparm_planck, specmult_planck, fpl<a name='7715'>
      real(kind=rb) :: p, p4, fk0, fk1, fk2<a name='7716'>
      real(kind=rb) :: fac000, fac100, fac200, fac010, fac110, fac210<a name='7717'>
      real(kind=rb) :: fac001, fac101, fac201, fac011, fac111, fac211<a name='7718'>
      real(kind=rb) :: tauself, taufor<a name='7719'>
      real(kind=rb) :: refrat_planck_a<a name='7720'>
      real(kind=rb) :: tau_major, tau_major1<a name='7721'>
<a name='7722'>
<a name='7723'>
<font color=#447700>! Calculate reference ratio to be used in calculation of Planck<a name='7724'></font>
<font color=#447700>! fraction in lower atmosphere.<a name='7725'></font>
<a name='7726'>
<font color=#447700>! P = 387. mb (Level 6)<a name='7727'></font>
      refrat_planck_a = chi_mls(1,6)/chi_mls(6,6)<a name='7728'>
<a name='7729'>
<font color=#447700>! Compute the optical depth by interpolating in ln(pressure), <a name='7730'></font>
<font color=#447700>! temperature,and appropriate species.  Below laytrop, the water<a name='7731'></font>
<font color=#447700>! vapor self-continuum and foreign continuum is interpolated <a name='7732'></font>
<font color=#447700>! (in temperature) separately.  <a name='7733'></font>
<a name='7734'>
<font color=#447700>! Lower atmosphere loop<a name='7735'></font>
      do lay = 1, laytrop<a name='7736'>
<a name='7737'>
         speccomb = colh2o(lay) + rat_h2och4(lay)*colch4(lay)<a name='7738'>
         specparm = colh2o(lay)/speccomb<a name='7739'>
         if (specparm .ge. oneminus) specparm = oneminus<a name='7740'>
         specmult = 8._rb*(specparm)<a name='7741'>
         js = 1 + int(specmult)<a name='7742'>
         fs = mod(specmult,1.0_rb)<a name='7743'>
<a name='7744'>
         speccomb1 = colh2o(lay) + rat_h2och4_1(lay)*colch4(lay)<a name='7745'>
         specparm1 = colh2o(lay)/speccomb1<a name='7746'>
         if (specparm1 .ge. oneminus) specparm1 = oneminus<a name='7747'>
         specmult1 = 8._rb*(specparm1)<a name='7748'>
         js1 = 1 + int(specmult1)<a name='7749'>
         fs1 = mod(specmult1,1.0_rb)<a name='7750'>
<a name='7751'>
         speccomb_planck = colh2o(lay)+refrat_planck_a*colch4(lay)<a name='7752'>
         specparm_planck = colh2o(lay)/speccomb_planck<a name='7753'>
         if (specparm_planck .ge. oneminus) specparm_planck=oneminus<a name='7754'>
         specmult_planck = 8._rb*specparm_planck<a name='7755'>
         jpl= 1 + int(specmult_planck)<a name='7756'>
         fpl = mod(specmult_planck,1.0_rb)<a name='7757'>
<a name='7758'>
         ind0 = ((jp(lay)-1)*5+(jt(lay)-1))*nspa(16) + js<a name='7759'>
         ind1 = (jp(lay)*5+(jt1(lay)-1))*nspa(16) + js1<a name='7760'>
         inds = indself(lay)<a name='7761'>
         indf = indfor(lay)<a name='7762'>
<a name='7763'>
         if (specparm .lt. 0.125_rb) then<a name='7764'>
            p = fs - 1<a name='7765'>
            p4 = p**4<a name='7766'>
            fk0 = p4<a name='7767'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7768'>
            fk2 = p + p4<a name='7769'>
            fac000 = fk0*fac00(lay)<a name='7770'>
            fac100 = fk1*fac00(lay)<a name='7771'>
            fac200 = fk2*fac00(lay)<a name='7772'>
            fac010 = fk0*fac10(lay)<a name='7773'>
            fac110 = fk1*fac10(lay)<a name='7774'>
            fac210 = fk2*fac10(lay)<a name='7775'>
         else if (specparm .gt. 0.875_rb) then<a name='7776'>
            p = -fs <a name='7777'>
            p4 = p**4<a name='7778'>
            fk0 = p4<a name='7779'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7780'>
            fk2 = p + p4<a name='7781'>
            fac000 = fk0*fac00(lay)<a name='7782'>
            fac100 = fk1*fac00(lay)<a name='7783'>
            fac200 = fk2*fac00(lay)<a name='7784'>
            fac010 = fk0*fac10(lay)<a name='7785'>
            fac110 = fk1*fac10(lay)<a name='7786'>
            fac210 = fk2*fac10(lay)<a name='7787'>
         else<a name='7788'>
            fac000 = (1._rb - fs) * fac00(lay)<a name='7789'>
            fac010 = (1._rb - fs) * fac10(lay)<a name='7790'>
            fac100 = fs * fac00(lay)<a name='7791'>
            fac110 = fs * fac10(lay)<a name='7792'>
         endif<a name='7793'>
<a name='7794'>
         if (specparm1 .lt. 0.125_rb) then<a name='7795'>
            p = fs1 - 1<a name='7796'>
            p4 = p**4<a name='7797'>
            fk0 = p4<a name='7798'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7799'>
            fk2 = p + p4<a name='7800'>
            fac001 = fk0*fac01(lay)<a name='7801'>
            fac101 = fk1*fac01(lay)<a name='7802'>
            fac201 = fk2*fac01(lay)<a name='7803'>
            fac011 = fk0*fac11(lay)<a name='7804'>
            fac111 = fk1*fac11(lay)<a name='7805'>
            fac211 = fk2*fac11(lay)<a name='7806'>
         else if (specparm1 .gt. 0.875_rb) then<a name='7807'>
            p = -fs1 <a name='7808'>
            p4 = p**4<a name='7809'>
            fk0 = p4<a name='7810'>
            fk1 = 1 - p - 2.0_rb*p4<a name='7811'>
            fk2 = p + p4<a name='7812'>
            fac001 = fk0*fac01(lay)<a name='7813'>
            fac101 = fk1*fac01(lay)<a name='7814'>
            fac201 = fk2*fac01(lay)<a name='7815'>
            fac011 = fk0*fac11(lay)<a name='7816'>
            fac111 = fk1*fac11(lay)<a name='7817'>
            fac211 = fk2*fac11(lay)<a name='7818'>
         else<a name='7819'>
            fac001 = (1._rb - fs1) * fac01(lay)<a name='7820'>
            fac011 = (1._rb - fs1) * fac11(lay)<a name='7821'>
            fac101 = fs1 * fac01(lay)<a name='7822'>
            fac111 = fs1 * fac11(lay)<a name='7823'>
         endif<a name='7824'>
<a name='7825'>
         do ig = 1, ng16<a name='7826'>
            tauself = selffac(lay)* (selfref(inds,ig) + selffrac(lay) * &amp;<a name='7827'>
                 (selfref(inds+1,ig) - selfref(inds,ig)))<a name='7828'>
            taufor =  forfac(lay) * (forref(indf,ig) + forfrac(lay) * &amp;<a name='7829'>
                 (forref(indf+1,ig) - forref(indf,ig))) <a name='7830'>
<a name='7831'>
            if (specparm .lt. 0.125_rb) then<a name='7832'>
               tau_major = speccomb * &amp;<a name='7833'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7834'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7835'>
                    fac200 * absa(ind0+2,ig) + &amp;<a name='7836'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7837'>
                    fac110 * absa(ind0+10,ig) + &amp;<a name='7838'>
                    fac210 * absa(ind0+11,ig))<a name='7839'>
            else if (specparm .gt. 0.875_rb) then<a name='7840'>
               tau_major = speccomb * &amp;<a name='7841'>
                    (fac200 * absa(ind0-1,ig) + &amp;<a name='7842'>
                    fac100 * absa(ind0,ig) + &amp;<a name='7843'>
                    fac000 * absa(ind0+1,ig) + &amp;<a name='7844'>
                    fac210 * absa(ind0+8,ig) + &amp;<a name='7845'>
                    fac110 * absa(ind0+9,ig) + &amp;<a name='7846'>
                    fac010 * absa(ind0+10,ig))<a name='7847'>
            else<a name='7848'>
               tau_major = speccomb * &amp;<a name='7849'>
                    (fac000 * absa(ind0,ig) + &amp;<a name='7850'>
                    fac100 * absa(ind0+1,ig) + &amp;<a name='7851'>
                    fac010 * absa(ind0+9,ig) + &amp;<a name='7852'>
                    fac110 * absa(ind0+10,ig))<a name='7853'>
            endif<a name='7854'>
<a name='7855'>
            if (specparm1 .lt. 0.125_rb) then<a name='7856'>
               tau_major1 = speccomb1 * &amp;<a name='7857'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7858'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7859'>
                    fac201 * absa(ind1+2,ig) + &amp;<a name='7860'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7861'>
                    fac111 * absa(ind1+10,ig) + &amp;<a name='7862'>
                    fac211 * absa(ind1+11,ig))<a name='7863'>
            else if (specparm1 .gt. 0.875_rb) then<a name='7864'>
               tau_major1 = speccomb1 * &amp;<a name='7865'>
                    (fac201 * absa(ind1-1,ig) + &amp;<a name='7866'>
                    fac101 * absa(ind1,ig) + &amp;<a name='7867'>
                    fac001 * absa(ind1+1,ig) + &amp;<a name='7868'>
                    fac211 * absa(ind1+8,ig) + &amp;<a name='7869'>
                    fac111 * absa(ind1+9,ig) + &amp;<a name='7870'>
                    fac011 * absa(ind1+10,ig))<a name='7871'>
            else<a name='7872'>
               tau_major1 = speccomb1 * &amp;<a name='7873'>
                    (fac001 * absa(ind1,ig) + &amp;<a name='7874'>
                    fac101 * absa(ind1+1,ig) + &amp;<a name='7875'>
                    fac011 * absa(ind1+9,ig) + &amp;<a name='7876'>
                    fac111 * absa(ind1+10,ig))<a name='7877'>
            endif<a name='7878'>
<a name='7879'>
            taug(lay,ngs15+ig) = tau_major + tau_major1 &amp;<a name='7880'>
                 + tauself + taufor<a name='7881'>
            fracs(lay,ngs15+ig) = fracrefa(ig,jpl) + fpl * &amp;<a name='7882'>
                 (fracrefa(ig,jpl+1)-fracrefa(ig,jpl))<a name='7883'>
         enddo<a name='7884'>
      enddo<a name='7885'>
<a name='7886'>
<font color=#447700>! Upper atmosphere loop<a name='7887'></font>
      do lay = laytrop+1, nlayers<a name='7888'>
         ind0 = ((jp(lay)-13)*5+(jt(lay)-1))*nspb(16) + 1<a name='7889'>
         ind1 = ((jp(lay)-12)*5+(jt1(lay)-1))*nspb(16) + 1<a name='7890'>
         do ig = 1, ng16<a name='7891'>
            taug(lay,ngs15+ig) = colch4(lay) * &amp;<a name='7892'>
                 (fac00(lay) * absb(ind0,ig) + &amp;<a name='7893'>
                 fac10(lay) * absb(ind0+1,ig) + &amp;<a name='7894'>
                 fac01(lay) * absb(ind1,ig) + &amp;<a name='7895'>
                 fac11(lay) * absb(ind1+1,ig))<a name='7896'>
            fracs(lay,ngs15+ig) = fracrefb(ig)<a name='7897'>
         enddo<a name='7898'>
      enddo<a name='7899'>
<a name='7900'>
      end subroutine taugb16<a name='7901'>
<a name='7902'>
      end subroutine taumol<a name='7903'>
<a name='7904'>
      end module rrtmg_lw_taumol<a name='7905'>
<a name='7906'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='7907'></font>
<font color=#447700>!     author:    $Author: trn $<a name='7908'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='7909'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='7910'></font>
<font color=#447700>!<a name='7911'></font>
<A NAME='RRTMG_LW_INIT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='7912'>
      <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_init</font> <A href='../../call_to/RRTMG_LW_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_INIT.html' TARGET='index'>3</A><a name='7913'>
<a name='7914'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='7915'></font>
<font color=#447700>! |                                                                          |<a name='7916'></font>
<font color=#447700>! |  Copyright 2002-2008, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='7917'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='7918'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='7919'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='7920'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='7921'></font>
<font color=#447700>! |                                                                          |<a name='7922'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='7923'></font>
<a name='7924'>
<font color=#447700>! ------- Modules -------<a name='7925'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_30">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='7926'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_6"><a name='7927'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF'>rrtmg_lw_setcoef</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_SETCOEF_1">, only: lwatmref, lwavplank<a name='7928'>
<a name='7929'>
<font color=#447700>! Steven Cavallo: added for buffer layer adjustment<a name='7930'></font>
      implicit none<a name='7931'>
<a name='7932'>
      integer , save    :: nlayers <a name='7933'>
<a name='7934'>
      contains<a name='7935'>
<a name='7936'>
<font color=#447700>! **************************************************************************<a name='7937'></font>
<A NAME='RRTMG_LW_INI'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INI' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7938'>
      <font color=#993300>subroutine </font><font color=#cc0000>rrtmg_lw_ini</font>(cpdair) <A href='../../call_to/RRTMG_LW_INI.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LW_INI.html' TARGET='index'>49</A><a name='7939'>
<font color=#447700>! **************************************************************************<a name='7940'></font>
<font color=#447700>!<a name='7941'></font>
<font color=#447700>!  Original version:       Michael J. Iacono; July, 1998<a name='7942'></font>
<font color=#447700>!  First revision for GCMs:   September, 1998<a name='7943'></font>
<font color=#447700>!  Second revision for RRTM_V3.0:  September, 2002<a name='7944'></font>
<font color=#447700>!<a name='7945'></font>
<font color=#447700>!  This subroutine performs calculations necessary for the initialization<a name='7946'></font>
<font color=#447700>!  of the longwave model.  Lookup tables are computed for use in the LW<a name='7947'></font>
<font color=#447700>!  radiative transfer, and input absorption coefficient data for each<a name='7948'></font>
<font color=#447700>!  spectral band are reduced from 256 g-point intervals to 140.<a name='7949'></font>
<font color=#447700>! **************************************************************************<a name='7950'></font>
<a name='7951'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_23">, only : mg, nbndlw, ngptlw<a name='7952'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_TBL'>rrlw_tbl</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_TBL_2">, only: ntbl, tblint, pade, bpade, tau_tbl, exp_tbl, tfn_tbl<a name='7953'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_6">, only: hvrini, hnamini<a name='7954'>
<a name='7955'>
      real(kind=rb), intent(in) :: cpdair     <font color=#447700>! Specific heat capacity of dry air<a name='7956'></font>
                                              <font color=#447700>! at constant pressure at 273 K<a name='7957'></font>
                                              <font color=#447700>! (J kg-1 K-1)<a name='7958'></font>
<a name='7959'>
<font color=#447700>! ------- Local -------<a name='7960'></font>
<a name='7961'>
      integer(kind=im) :: itr, ibnd, igc, ig, ind, ipr <a name='7962'>
      integer(kind=im) :: igcsm, iprsm<a name='7963'>
<a name='7964'>
      real(kind=rb) :: wtsum, wtsm(mg)        <font color=#447700>!<a name='7965'></font>
      real(kind=rb) :: tfn                    <font color=#447700>!<a name='7966'></font>
<a name='7967'>
      real(kind=rb), parameter :: expeps = 1.e-20   <font color=#447700>! Smallest value for exponential table<a name='7968'></font>
<a name='7969'>
<font color=#447700>! ------- Definitions -------<a name='7970'></font>
<font color=#447700>!     Arrays for 10000-point look-up tables:<a name='7971'></font>
<font color=#447700>!     TAU_TBL Clear-sky optical depth (used in cloudy radiative transfer)<a name='7972'></font>
<font color=#447700>!     EXP_TBL Exponential lookup table for ransmittance<a name='7973'></font>
<font color=#447700>!     TFN_TBL Tau transition function; i.e. the transition of the Planck<a name='7974'></font>
<font color=#447700>!             function from that for the mean layer temperature to that for<a name='7975'></font>
<font color=#447700>!             the layer boundary temperature as a function of optical depth.<a name='7976'></font>
<font color=#447700>!             The "linear in tau" method is used to make the table.<a name='7977'></font>
<font color=#447700>!     PADE    Pade approximation constant (= 0.278)<a name='7978'></font>
<font color=#447700>!     BPADE   Inverse of the Pade approximation constant<a name='7979'></font>
<font color=#447700>!<a name='7980'></font>
<a name='7981'>
<font color=#447700>!jm not thread safe      hvrini = '$Revision: 1.3 $'<a name='7982'></font>
<a name='7983'>
<font color=#447700>! Initialize model data<a name='7984'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT'>lwdatinit</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWDATINIT_1">(cpdair)<a name='7985'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCMBDAT'>lwcmbdat</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWCMBDAT_1">               <font color=#447700>! g-point interval reduction data<a name='7986'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCLDPR'>lwcldpr</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWCLDPR_1">                <font color=#447700>! cloud optical properties<a name='7987'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWATMREF'>lwatmref</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWATMREF_1">               <font color=#447700>! reference MLS profile<a name='7988'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWAVPLANK'>lwavplank</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LWAVPLANK_1">              <font color=#447700>! Planck function <a name='7989'></font>
<font color=#447700>! Moved to module_ra_rrtmg_lw for WRF<a name='7990'></font>
<font color=#447700>!      call lw_kgb01               ! molecular absorption coefficients<a name='7991'></font>
<font color=#447700>!      call lw_kgb02<a name='7992'></font>
<font color=#447700>!      call lw_kgb03<a name='7993'></font>
<font color=#447700>!      call lw_kgb04<a name='7994'></font>
<font color=#447700>!      call lw_kgb05<a name='7995'></font>
<font color=#447700>!      call lw_kgb06<a name='7996'></font>
<font color=#447700>!      call lw_kgb07<a name='7997'></font>
<font color=#447700>!      call lw_kgb08<a name='7998'></font>
<font color=#447700>!      call lw_kgb09<a name='7999'></font>
<font color=#447700>!      call lw_kgb10<a name='8000'></font>
<font color=#447700>!      call lw_kgb11<a name='8001'></font>
<font color=#447700>!      call lw_kgb12<a name='8002'></font>
<font color=#447700>!      call lw_kgb13<a name='8003'></font>
<font color=#447700>!      call lw_kgb14<a name='8004'></font>
<font color=#447700>!      call lw_kgb15<a name='8005'></font>
<font color=#447700>!      call lw_kgb16<a name='8006'></font>
<a name='8007'>
<font color=#447700>! Compute lookup tables for transmittance, tau transition function,<a name='8008'></font>
<font color=#447700>! and clear sky tau (for the cloudy sky radiative transfer).  Tau is <a name='8009'></font>
<font color=#447700>! computed as a function of the tau transition function, transmittance <a name='8010'></font>
<font color=#447700>! is calculated as a function of tau, and the tau transition function <a name='8011'></font>
<font color=#447700>! is calculated using the linear in tau formulation at values of tau <a name='8012'></font>
<font color=#447700>! above 0.01.  TF is approximated as tau/6 for tau &lt; 0.01.  All tables <a name='8013'></font>
<font color=#447700>! are computed at intervals of 0.001.  The inverse of the constant used<a name='8014'></font>
<font color=#447700>! in the Pade approximation to the tau transition function is set to b.<a name='8015'></font>
<a name='8016'>
      tau_tbl(0) = 0.0_rb<a name='8017'>
      tau_tbl(ntbl) = 1.e10_rb<a name='8018'>
      exp_tbl(0) = 1.0_rb<a name='8019'>
      exp_tbl(ntbl) = expeps<a name='8020'>
      tfn_tbl(0) = 0.0_rb<a name='8021'>
      tfn_tbl(ntbl) = 1.0_rb<a name='8022'>
      bpade = 1.0_rb / pade<a name='8023'>
      do itr = 1, ntbl-1<a name='8024'>
         tfn = float(itr) / float(ntbl)<a name='8025'>
         tau_tbl(itr) = bpade * tfn / (1._rb - tfn)<a name='8026'>
         exp_tbl(itr) = exp(-tau_tbl(itr))<a name='8027'>
         if (exp_tbl(itr) .le. expeps) exp_tbl(itr) = expeps<a name='8028'>
         if (tau_tbl(itr) .lt. 0.06_rb) then<a name='8029'>
            tfn_tbl(itr) = tau_tbl(itr)/6._rb<a name='8030'>
         else<a name='8031'>
            tfn_tbl(itr) = 1._rb-2._rb*((1._rb/tau_tbl(itr))-(exp_tbl(itr)/(1.-exp_tbl(itr))))<a name='8032'>
         endif<a name='8033'>
      enddo<a name='8034'>
<a name='8035'>
<font color=#447700>! Perform g-point reduction from 16 per band (256 total points) to<a name='8036'></font>
<font color=#447700>! a band dependant number (140 total points) for all absorption<a name='8037'></font>
<font color=#447700>! coefficient input data and Planck fraction input data.<a name='8038'></font>
<font color=#447700>! Compute relative weighting for new g-point combinations.<a name='8039'></font>
<a name='8040'>
      igcsm = 0<a name='8041'>
      do ibnd = 1,nbndlw<a name='8042'>
         iprsm = 0<a name='8043'>
         if (ngc(ibnd).lt.mg) then<a name='8044'>
            do igc = 1,ngc(ibnd) <a name='8045'>
               igcsm = igcsm + 1<a name='8046'>
               wtsum = 0._rb<a name='8047'>
               do ipr = 1, ngn(igcsm)<a name='8048'>
                  iprsm = iprsm + 1<a name='8049'>
                  wtsum = wtsum + wt(iprsm)<a name='8050'>
               enddo<a name='8051'>
               wtsm(igc) = wtsum<a name='8052'>
            enddo<a name='8053'>
            do ig = 1, ng(ibnd)<a name='8054'>
               ind = (ibnd-1)*mg + ig<a name='8055'>
               rwgt(ind) = wt(ig)/wtsm(ngm(ind))<a name='8056'>
            enddo<a name='8057'>
         else<a name='8058'>
            do ig = 1, ng(ibnd)<a name='8059'>
               igcsm = igcsm + 1<a name='8060'>
               ind = (ibnd-1)*mg + ig<a name='8061'>
               rwgt(ind) = 1.0_rb<a name='8062'>
            enddo<a name='8063'>
         endif<a name='8064'>
      enddo<a name='8065'>
<a name='8066'>
<font color=#447700>! Reduce g-points for absorption coefficient data in each LW spectral band.<a name='8067'></font>
<a name='8068'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1'>cmbgb1</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB1_2"><a name='8069'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2'>cmbgb2</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB2_2"><a name='8070'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3'>cmbgb3</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB3_2"><a name='8071'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4'>cmbgb4</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB4_2"><a name='8072'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5'>cmbgb5</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB5_2"><a name='8073'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6'>cmbgb6</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB6_2"><a name='8074'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7'>cmbgb7</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB7_2"><a name='8075'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8'>cmbgb8</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB8_2"><a name='8076'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9'>cmbgb9</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB9_2"><a name='8077'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10'>cmbgb10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB10_2"><a name='8078'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11'>cmbgb11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB11_2"><a name='8079'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12'>cmbgb12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB12_2"><a name='8080'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13'>cmbgb13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB13_2"><a name='8081'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14'>cmbgb14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB14_2"><a name='8082'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15'>cmbgb15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB15_2"><a name='8083'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16'>cmbgb16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CMBGB16_2"><a name='8084'>
<a name='8085'>
      end subroutine rrtmg_lw_ini<a name='8086'>
<a name='8087'>
<font color=#447700>!***************************************************************************<a name='8088'></font>
<A NAME='LWDATINIT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LWDATINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8089'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwdatinit</font>(cpdair) <A href='../../call_to/LWDATINIT.html' TARGET='index'>2</A>,<A href='../../call_from/LWDATINIT.html' TARGET='index'>6</A><a name='8090'>
<font color=#447700>!***************************************************************************<a name='8091'></font>
<a name='8092'>
<font color=#447700>! --------- Modules ----------<a name='8093'></font>
<a name='8094'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_24">, only : maxxsec, maxinpx<a name='8095'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_4">, only: heatfac, grav, planck, boltz, &amp;<a name='8096'>
                          clight, avogad, alosmt, gascon, radcn1, radcn2, &amp;<a name='8097'>
                          sbcnst, secdy, fluxfac, oneminus, pi<a name='8098'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWDATINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_7"><a name='8099'>
<a name='8100'>
      save <a name='8101'>
 <a name='8102'>
      real(kind=rb), intent(in) :: cpdair      <font color=#447700>! Specific heat capacity of dry air<a name='8103'></font>
                                               <font color=#447700>! at constant pressure at 273 K<a name='8104'></font>
                                               <font color=#447700>! (J kg-1 K-1)<a name='8105'></font>
<a name='8106'>
<font color=#447700>! Longwave spectral band limits (wavenumbers)<a name='8107'></font>
      wavenum1(:) = (/ 10._rb, 350._rb, 500._rb, 630._rb, 700._rb, 820._rb, &amp;<a name='8108'>
                      980._rb,1080._rb,1180._rb,1390._rb,1480._rb,1800._rb, &amp;<a name='8109'>
                     2080._rb,2250._rb,2380._rb,2600._rb/)<a name='8110'>
      wavenum2(:) = (/350._rb, 500._rb, 630._rb, 700._rb, 820._rb, 980._rb, &amp;<a name='8111'>
                     1080._rb,1180._rb,1390._rb,1480._rb,1800._rb,2080._rb, &amp;<a name='8112'>
                     2250._rb,2380._rb,2600._rb,3250._rb/)<a name='8113'>
      delwave(:) =  (/340._rb, 150._rb, 130._rb,  70._rb, 120._rb, 160._rb, &amp;<a name='8114'>
                      100._rb, 100._rb, 210._rb,  90._rb, 320._rb, 280._rb, &amp;<a name='8115'>
                      170._rb, 130._rb, 220._rb, 650._rb/)<a name='8116'>
<a name='8117'>
<font color=#447700>! Spectral band information<a name='8118'></font>
      ng(:) = (/16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16/)<a name='8119'>
      nspa(:) = (/1,1,9,9,9,1,9,1,9,1,1,9,9,1,9,9/)<a name='8120'>
      nspb(:) = (/1,1,5,5,5,0,1,1,1,1,1,0,0,1,0,0/)<a name='8121'>
<a name='8122'>
<font color=#447700>!     nxmol     - number of cross-sections input by user<a name='8123'></font>
<font color=#447700>!     ixindx(i) - index of cross-section molecule corresponding to Ith<a name='8124'></font>
<font color=#447700>!                 cross-section specified by user<a name='8125'></font>
<font color=#447700>!                 = 0 -- not allowed in rrtm<a name='8126'></font>
<font color=#447700>!                 = 1 -- ccl4<a name='8127'></font>
<font color=#447700>!                 = 2 -- cfc11<a name='8128'></font>
<font color=#447700>!                 = 3 -- cfc12<a name='8129'></font>
<font color=#447700>!                 = 4 -- cfc22<a name='8130'></font>
      nxmol = 4<a name='8131'>
      ixindx(1) = 1<a name='8132'>
      ixindx(2) = 2<a name='8133'>
      ixindx(3) = 3<a name='8134'>
      ixindx(4) = 4<a name='8135'>
      ixindx(5:maxinpx) = 0<a name='8136'>
<a name='8137'>
<font color=#447700>! Fundamental physical constants from NIST 2002<a name='8138'></font>
<a name='8139'>
      grav = 9.8066_rb                        <font color=#447700>! Acceleration of gravity<a name='8140'></font>
                                              <font color=#447700>! (m s-2)<a name='8141'></font>
      planck = 6.62606876e-27_rb              <font color=#447700>! Planck constant<a name='8142'></font>
                                              <font color=#447700>! (ergs s; g cm2 s-1)<a name='8143'></font>
      boltz = 1.3806503e-16_rb                <font color=#447700>! Boltzmann constant<a name='8144'></font>
                                              <font color=#447700>! (ergs K-1; g cm2 s-2 K-1)<a name='8145'></font>
      clight = 2.99792458e+10_rb              <font color=#447700>! Speed of light in a vacuum  <a name='8146'></font>
                                              <font color=#447700>! (cm s-1)<a name='8147'></font>
      avogad = 6.02214199e+23_rb              <font color=#447700>! Avogadro constant<a name='8148'></font>
                                              <font color=#447700>! (mol-1)<a name='8149'></font>
      alosmt = 2.6867775e+19_rb               <font color=#447700>! Loschmidt constant<a name='8150'></font>
                                              <font color=#447700>! (cm-3)<a name='8151'></font>
      gascon = 8.31447200e+07_rb              <font color=#447700>! Molar gas constant<a name='8152'></font>
                                              <font color=#447700>! (ergs mol-1 K-1)<a name='8153'></font>
      radcn1 = 1.191042722e-12_rb             <font color=#447700>! First radiation constant<a name='8154'></font>
                                              <font color=#447700>! (W cm2 sr-1)<a name='8155'></font>
      radcn2 = 1.4387752_rb                   <font color=#447700>! Second radiation constant<a name='8156'></font>
                                              <font color=#447700>! (cm K)<a name='8157'></font>
      sbcnst = 5.670400e-04_rb                <font color=#447700>! Stefan-Boltzmann constant<a name='8158'></font>
                                              <font color=#447700>! (W cm-2 K-4)<a name='8159'></font>
      secdy = 8.6400e4_rb                     <font color=#447700>! Number of seconds per day<a name='8160'></font>
                                              <font color=#447700>! (s d-1)<a name='8161'></font>
<a name='8162'>
<font color=#447700>!jm moved here for thread safety, 20141107<a name='8163'></font>
      oneminus = 1._rb - 1.e-6_rb<a name='8164'>
      pi       = 2._rb * asin(1._rb)<a name='8165'>
      fluxfac  =  pi * 2.e4_rb  <font color=#447700>! orig:   fluxfac = pi * 2.d4<a name='8166'></font>
<a name='8167'>
<font color=#447700>!<a name='8168'></font>
<font color=#447700>!     units are generally cgs<a name='8169'></font>
<font color=#447700>!<a name='8170'></font>
<font color=#447700>!     The first and second radiation constants are taken from NIST.<a name='8171'></font>
<font color=#447700>!     They were previously obtained from the relations:<a name='8172'></font>
<font color=#447700>!          radcn1 = 2.*planck*clight*clight*1.e-07<a name='8173'></font>
<font color=#447700>!          radcn2 = planck*clight/boltz<a name='8174'></font>
<a name='8175'>
<font color=#447700>!     Heatfac is the factor by which delta-flux / delta-pressure is<a name='8176'></font>
<font color=#447700>!     multiplied, with flux in W/m-2 and pressure in mbar, to get <a name='8177'></font>
<font color=#447700>!     the heating rate in units of degrees/day.  It is equal to:<a name='8178'></font>
<font color=#447700>!     Original value:<a name='8179'></font>
<font color=#447700>!           (g)x(#sec/day)x(1e-5)/(specific heat of air at const. p)<a name='8180'></font>
<font color=#447700>!           Here, cpdair (1.004) is in units of J g-1 K-1, and the <a name='8181'></font>
<font color=#447700>!           constant (1.e-5) converts mb to Pa and g-1 to kg-1.<a name='8182'></font>
<font color=#447700>!        =  (9.8066)(86400)(1e-5)/(1.004)<a name='8183'></font>
<font color=#447700>!      heatfac = 8.4391_rb<a name='8184'></font>
<font color=#447700>!<a name='8185'></font>
<font color=#447700>!     Modified value for consistency with CAM3:<a name='8186'></font>
<font color=#447700>!           (g)x(#sec/day)x(1e-5)/(specific heat of air at const. p)<a name='8187'></font>
<font color=#447700>!           Here, cpdair (1.00464) is in units of J g-1 K-1, and the<a name='8188'></font>
<font color=#447700>!           constant (1.e-5) converts mb to Pa and g-1 to kg-1.<a name='8189'></font>
<font color=#447700>!        =  (9.80616)(86400)(1e-5)/(1.00464)<a name='8190'></font>
<font color=#447700>!      heatfac = 8.43339130434_rb<a name='8191'></font>
<font color=#447700>!<a name='8192'></font>
<font color=#447700>!     Calculated value:<a name='8193'></font>
<font color=#447700>!        (grav) x (#sec/day) / (specific heat of dry air at const. p x 1.e2)<a name='8194'></font>
<font color=#447700>!           Here, cpdair is in units of J kg-1 K-1, and the constant (1.e2) <a name='8195'></font>
<font color=#447700>!           converts mb to Pa when heatfac is multiplied by W m-2 mb-1. <a name='8196'></font>
      heatfac = grav * secdy / (cpdair * 1.e2_rb)<a name='8197'>
<a name='8198'>
      end subroutine lwdatinit<a name='8199'>
<a name='8200'>
<font color=#447700>!***************************************************************************<a name='8201'></font>
<A NAME='LWCMBDAT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LWCMBDAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8202'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwcmbdat</font> <A href='../../call_to/LWCMBDAT.html' TARGET='index'>2</A><a name='8203'>
<font color=#447700>!***************************************************************************<a name='8204'></font>
<a name='8205'>
      save<a name='8206'>
 <a name='8207'>
<font color=#447700>! ------- Definitions -------<a name='8208'></font>
<font color=#447700>!     Arrays for the g-point reduction from 256 to 140 for the 16 LW bands:<a name='8209'></font>
<font color=#447700>!     This mapping from 256 to 140 points has been carefully selected to <a name='8210'></font>
<font color=#447700>!     minimize the effect on the resulting fluxes and cooling rates, and<a name='8211'></font>
<font color=#447700>!     caution should be used if the mapping is modified.  The full 256<a name='8212'></font>
<font color=#447700>!     g-point set can be restored with ngptlw=256, ngc=16*16, ngn=256*1., etc.<a name='8213'></font>
<font color=#447700>!     ngptlw  The total number of new g-points<a name='8214'></font>
<font color=#447700>!     ngc     The number of new g-points in each band<a name='8215'></font>
<font color=#447700>!     ngs     The cumulative sum of new g-points for each band<a name='8216'></font>
<font color=#447700>!     ngm     The index of each new g-point relative to the original<a name='8217'></font>
<font color=#447700>!             16 g-points for each band.  <a name='8218'></font>
<font color=#447700>!     ngn     The number of original g-points that are combined to make<a name='8219'></font>
<font color=#447700>!             each new g-point in each band.<a name='8220'></font>
<font color=#447700>!     ngb     The band index for each new g-point.<a name='8221'></font>
<font color=#447700>!     wt      RRTM weights for 16 g-points.<a name='8222'></font>
<a name='8223'>
<font color=#447700>! ------- Data statements -------<a name='8224'></font>
      ngc(:) = (/10,12,16,14,16,8,12,8,12,6,8,8,4,2,2,2/)<a name='8225'>
      ngs(:) = (/10,22,38,52,68,76,88,96,108,114,122,130,134,136,138,140/)<a name='8226'>
      ngm(:) = (/1,2,3,3,4,4,5,5,6,6,7,7,8,8,9,10, &amp;          <font color=#447700>! band 1<a name='8227'></font>
                 1,2,3,4,5,6,7,8,9,9,10,10,11,11,12,12, &amp;     <font color=#447700>! band 2<a name='8228'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &amp;    <font color=#447700>! band 3<a name='8229'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,14,14, &amp;    <font color=#447700>! band 4<a name='8230'></font>
                 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16, &amp;    <font color=#447700>! band 5<a name='8231'></font>
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &amp;           <font color=#447700>! band 6<a name='8232'></font>
                 1,1,2,2,3,4,5,6,7,8,9,10,11,11,12,12, &amp;      <font color=#447700>! band 7<a name='8233'></font>
                 1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8, &amp;           <font color=#447700>! band 8<a name='8234'></font>
                 1,2,3,4,5,6,7,8,9,9,10,10,11,11,12,12, &amp;     <font color=#447700>! band 9<a name='8235'></font>
                 1,1,2,2,3,3,4,4,5,5,5,5,6,6,6,6, &amp;           <font color=#447700>! band 10<a name='8236'></font>
                 1,2,3,3,4,4,5,5,6,6,7,7,7,8,8,8, &amp;           <font color=#447700>! band 11<a name='8237'></font>
                 1,2,3,4,5,5,6,6,7,7,7,7,8,8,8,8, &amp;           <font color=#447700>! band 12<a name='8238'></font>
                 1,1,1,2,2,2,3,3,3,3,4,4,4,4,4,4, &amp;           <font color=#447700>! band 13<a name='8239'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &amp;           <font color=#447700>! band 14<a name='8240'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2, &amp;           <font color=#447700>! band 15<a name='8241'></font>
                 1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2/)            <font color=#447700>! band 16<a name='8242'></font>
      ngn(:) = (/1,1,2,2,2,2,2,2,1,1, &amp;                       <font color=#447700>! band 1<a name='8243'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2, &amp;                   <font color=#447700>! band 2<a name='8244'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, &amp;           <font color=#447700>! band 3<a name='8245'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,3, &amp;               <font color=#447700>! band 4<a name='8246'></font>
                 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1, &amp;           <font color=#447700>! band 5<a name='8247'></font>
                 2,2,2,2,2,2,2,2, &amp;                           <font color=#447700>! band 6<a name='8248'></font>
                 2,2,1,1,1,1,1,1,1,1,2,2, &amp;                   <font color=#447700>! band 7<a name='8249'></font>
                 2,2,2,2,2,2,2,2, &amp;                           <font color=#447700>! band 8<a name='8250'></font>
                 1,1,1,1,1,1,1,1,2,2,2,2, &amp;                   <font color=#447700>! band 9<a name='8251'></font>
                 2,2,2,2,4,4, &amp;                               <font color=#447700>! band 10<a name='8252'></font>
                 1,1,2,2,2,2,3,3, &amp;                           <font color=#447700>! band 11<a name='8253'></font>
                 1,1,1,1,2,2,4,4, &amp;                           <font color=#447700>! band 12<a name='8254'></font>
                 3,3,4,6, &amp;                                   <font color=#447700>! band 13<a name='8255'></font>
                 8,8, &amp;                                       <font color=#447700>! band 14<a name='8256'></font>
                 8,8, &amp;                                       <font color=#447700>! band 15<a name='8257'></font>
                 4,12/)                                       <font color=#447700>! band 16<a name='8258'></font>
      ngb(:) = (/1,1,1,1,1,1,1,1,1,1, &amp;                       <font color=#447700>! band 1<a name='8259'></font>
                 2,2,2,2,2,2,2,2,2,2,2,2, &amp;                   <font color=#447700>! band 2<a name='8260'></font>
                 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3, &amp;           <font color=#447700>! band 3<a name='8261'></font>
                 4,4,4,4,4,4,4,4,4,4,4,4,4,4, &amp;               <font color=#447700>! band 4<a name='8262'></font>
                 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5, &amp;           <font color=#447700>! band 5<a name='8263'></font>
                 6,6,6,6,6,6,6,6, &amp;                           <font color=#447700>! band 6<a name='8264'></font>
                 7,7,7,7,7,7,7,7,7,7,7,7, &amp;                   <font color=#447700>! band 7<a name='8265'></font>
                 8,8,8,8,8,8,8,8, &amp;                           <font color=#447700>! band 8<a name='8266'></font>
                 9,9,9,9,9,9,9,9,9,9,9,9, &amp;                   <font color=#447700>! band 9<a name='8267'></font>
                 10,10,10,10,10,10, &amp;                         <font color=#447700>! band 10<a name='8268'></font>
                 11,11,11,11,11,11,11,11, &amp;                   <font color=#447700>! band 11<a name='8269'></font>
                 12,12,12,12,12,12,12,12, &amp;                   <font color=#447700>! band 12<a name='8270'></font>
                 13,13,13,13, &amp;                               <font color=#447700>! band 13<a name='8271'></font>
                 14,14, &amp;                                     <font color=#447700>! band 14<a name='8272'></font>
                 15,15, &amp;                                     <font color=#447700>! band 15<a name='8273'></font>
                 16,16/)                                      <font color=#447700>! band 16<a name='8274'></font>
      wt(:) = (/ 0.1527534276_rb, 0.1491729617_rb, 0.1420961469_rb, &amp;<a name='8275'>
                 0.1316886544_rb, 0.1181945205_rb, 0.1019300893_rb, &amp;<a name='8276'>
                 0.0832767040_rb, 0.0626720116_rb, 0.0424925000_rb, &amp;<a name='8277'>
                 0.0046269894_rb, 0.0038279891_rb, 0.0030260086_rb, &amp;<a name='8278'>
                 0.0022199750_rb, 0.0014140010_rb, 0.0005330000_rb, &amp;<a name='8279'>
                 0.0000750000_rb/)<a name='8280'>
<a name='8281'>
      end subroutine lwcmbdat<a name='8282'>
<a name='8283'>
<font color=#447700>!***************************************************************************<a name='8284'></font>
<A NAME='CMBGB1'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8285'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb1</font> <A href='../../call_to/CMBGB1.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB1.html' TARGET='index'>4</A><a name='8286'>
<font color=#447700>!***************************************************************************<a name='8287'></font>
<font color=#447700>!<a name='8288'></font>
<font color=#447700>!  Original version:    MJIacono; July 1998<a name='8289'></font>
<font color=#447700>!  Revision for GCMs:   MJIacono; September 1998<a name='8290'></font>
<font color=#447700>!  Revision for RRTMG:  MJIacono, September 2002<a name='8291'></font>
<font color=#447700>!  Revision for F90 reformatting:  MJIacono, June 2006<a name='8292'></font>
<font color=#447700>!<a name='8293'></font>
<font color=#447700>!  The subroutines CMBGB1-&gt;CMBGB16 input the absorption coefficient<a name='8294'></font>
<font color=#447700>!  data for each band, which are defined for 16 g-points and 16 spectral<a name='8295'></font>
<font color=#447700>!  bands. The data are combined with appropriate weighting following the<a name='8296'></font>
<font color=#447700>!  g-point mapping arrays specified in RRTMINIT.  Plank fraction data<a name='8297'></font>
<font color=#447700>!  in arrays FRACREFA and FRACREFB are combined without weighting.  All<a name='8298'></font>
<font color=#447700>!  g-point reduced data are put into new arrays for use in RRTM.<a name='8299'></font>
<font color=#447700>!<a name='8300'></font>
<font color=#447700>!  band 1:  10-350 cm-1 (low key - h2o; low minor - n2)<a name='8301'></font>
<font color=#447700>!                       (high key - h2o; high minor - n2)<a name='8302'></font>
<font color=#447700>!  note: previous versions of rrtm band 1: <a name='8303'></font>
<font color=#447700>!        10-250 cm-1 (low - h2o; high - h2o)<a name='8304'></font>
<font color=#447700>!***************************************************************************<a name='8305'></font>
<a name='8306'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_25">, only : mg, nbndlw, ngptlw, ng1<a name='8307'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG01'>rrlw_kg01</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_2">, only: fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, &amp;<a name='8308'>
                           selfrefo, forrefo, &amp;<a name='8309'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mn2, kb_mn2, &amp;<a name='8310'>
                           selfref, forref<a name='8311'>
<a name='8312'>
<font color=#447700>! ------- Local -------<a name='8313'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='8314'>
      real(kind=rb) :: sumk, sumk1, sumk2, sumf1, sumf2<a name='8315'>
<a name='8316'>
<a name='8317'>
      do jt = 1,5<a name='8318'>
         do jp = 1,13<a name='8319'>
            iprsm = 0<a name='8320'>
            do igc = 1,ngc(1)<a name='8321'>
               sumk = 0.<a name='8322'>
               do ipr = 1, ngn(igc)<a name='8323'>
                  iprsm = iprsm + 1<a name='8324'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm)<a name='8325'>
               enddo<a name='8326'>
               ka(jt,jp,igc) = sumk<a name='8327'>
            enddo<a name='8328'>
         enddo<a name='8329'>
         do jp = 13,59<a name='8330'>
            iprsm = 0<a name='8331'>
            do igc = 1,ngc(1)<a name='8332'>
               sumk = 0.<a name='8333'>
               do ipr = 1, ngn(igc)<a name='8334'>
                  iprsm = iprsm + 1<a name='8335'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm)<a name='8336'>
               enddo<a name='8337'>
               kb(jt,jp,igc) = sumk<a name='8338'>
            enddo<a name='8339'>
         enddo<a name='8340'>
      enddo<a name='8341'>
<a name='8342'>
      do jt = 1,10<a name='8343'>
         iprsm = 0<a name='8344'>
         do igc = 1,ngc(1)<a name='8345'>
            sumk = 0.<a name='8346'>
            do ipr = 1, ngn(igc)<a name='8347'>
               iprsm = iprsm + 1<a name='8348'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm)<a name='8349'>
            enddo<a name='8350'>
            selfref(jt,igc) = sumk<a name='8351'>
         enddo<a name='8352'>
      enddo<a name='8353'>
<a name='8354'>
      do jt = 1,4<a name='8355'>
         iprsm = 0<a name='8356'>
         do igc = 1,ngc(1)<a name='8357'>
            sumk = 0.<a name='8358'>
            do ipr = 1, ngn(igc)<a name='8359'>
               iprsm = iprsm + 1<a name='8360'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm)<a name='8361'>
            enddo<a name='8362'>
            forref(jt,igc) = sumk<a name='8363'>
         enddo<a name='8364'>
      enddo<a name='8365'>
<a name='8366'>
      do jt = 1,19<a name='8367'>
         iprsm = 0<a name='8368'>
         do igc = 1,ngc(1)<a name='8369'>
            sumk1 = 0.<a name='8370'>
            sumk2 = 0.<a name='8371'>
            do ipr = 1, ngn(igc)<a name='8372'>
               iprsm = iprsm + 1<a name='8373'>
               sumk1 = sumk1 + kao_mn2(jt,iprsm)*rwgt(iprsm)<a name='8374'>
               sumk2 = sumk2 + kbo_mn2(jt,iprsm)*rwgt(iprsm)<a name='8375'>
            enddo<a name='8376'>
            ka_mn2(jt,igc) = sumk1<a name='8377'>
            kb_mn2(jt,igc) = sumk2<a name='8378'>
         enddo<a name='8379'>
      enddo<a name='8380'>
<a name='8381'>
      iprsm = 0<a name='8382'>
      do igc = 1,ngc(1)<a name='8383'>
         sumf1 = 0.<a name='8384'>
         sumf2 = 0.<a name='8385'>
         do ipr = 1, ngn(igc)<a name='8386'>
            iprsm = iprsm + 1<a name='8387'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='8388'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='8389'>
         enddo<a name='8390'>
         fracrefa(igc) = sumf1<a name='8391'>
         fracrefb(igc) = sumf2<a name='8392'>
      enddo<a name='8393'>
<a name='8394'>
      end subroutine cmbgb1<a name='8395'>
<a name='8396'>
<font color=#447700>!***************************************************************************<a name='8397'></font>
<A NAME='CMBGB2'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8398'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb2</font> <A href='../../call_to/CMBGB2.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB2.html' TARGET='index'>4</A><a name='8399'>
<font color=#447700>!***************************************************************************<a name='8400'></font>
<font color=#447700>!<a name='8401'></font>
<font color=#447700>!     band 2:  350-500 cm-1 (low key - h2o; high key - h2o)<a name='8402'></font>
<font color=#447700>!<a name='8403'></font>
<font color=#447700>!     note: previous version of rrtm band 2: <a name='8404'></font>
<font color=#447700>!           250 - 500 cm-1 (low - h2o; high - h2o)<a name='8405'></font>
<font color=#447700>!***************************************************************************<a name='8406'></font>
<a name='8407'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_26">, only : mg, nbndlw, ngptlw, ng2<a name='8408'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG02'>rrlw_kg02</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_2">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='8409'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='8410'>
<a name='8411'>
<font color=#447700>! ------- Local -------<a name='8412'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='8413'>
      real(kind=rb) :: sumk, sumf1, sumf2<a name='8414'>
<a name='8415'>
<a name='8416'>
      do jt = 1,5<a name='8417'>
         do jp = 1,13<a name='8418'>
            iprsm = 0<a name='8419'>
            do igc = 1,ngc(2)<a name='8420'>
               sumk = 0.<a name='8421'>
               do ipr = 1, ngn(ngs(1)+igc)<a name='8422'>
                  iprsm = iprsm + 1<a name='8423'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+16)<a name='8424'>
               enddo<a name='8425'>
               ka(jt,jp,igc) = sumk<a name='8426'>
            enddo<a name='8427'>
         enddo<a name='8428'>
         do jp = 13,59<a name='8429'>
            iprsm = 0<a name='8430'>
            do igc = 1,ngc(2)<a name='8431'>
               sumk = 0.<a name='8432'>
               do ipr = 1, ngn(ngs(1)+igc)<a name='8433'>
                  iprsm = iprsm + 1<a name='8434'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+16)<a name='8435'>
               enddo<a name='8436'>
               kb(jt,jp,igc) = sumk<a name='8437'>
            enddo<a name='8438'>
         enddo<a name='8439'>
      enddo<a name='8440'>
<a name='8441'>
      do jt = 1,10<a name='8442'>
         iprsm = 0<a name='8443'>
         do igc = 1,ngc(2)<a name='8444'>
            sumk = 0.<a name='8445'>
            do ipr = 1, ngn(ngs(1)+igc)<a name='8446'>
               iprsm = iprsm + 1<a name='8447'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+16)<a name='8448'>
            enddo<a name='8449'>
            selfref(jt,igc) = sumk<a name='8450'>
         enddo<a name='8451'>
      enddo<a name='8452'>
<a name='8453'>
      do jt = 1,4<a name='8454'>
         iprsm = 0<a name='8455'>
         do igc = 1,ngc(2)<a name='8456'>
            sumk = 0.<a name='8457'>
            do ipr = 1, ngn(ngs(1)+igc)<a name='8458'>
               iprsm = iprsm + 1<a name='8459'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+16)<a name='8460'>
            enddo<a name='8461'>
            forref(jt,igc) = sumk<a name='8462'>
         enddo<a name='8463'>
      enddo<a name='8464'>
<a name='8465'>
      iprsm = 0<a name='8466'>
      do igc = 1,ngc(2)<a name='8467'>
         sumf1 = 0.<a name='8468'>
         sumf2 = 0.<a name='8469'>
         do ipr = 1, ngn(ngs(1)+igc)<a name='8470'>
            iprsm = iprsm + 1<a name='8471'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='8472'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='8473'>
         enddo<a name='8474'>
         fracrefa(igc) = sumf1<a name='8475'>
         fracrefb(igc) = sumf2<a name='8476'>
      enddo<a name='8477'>
<a name='8478'>
      end subroutine cmbgb2<a name='8479'>
<a name='8480'>
<font color=#447700>!***************************************************************************<a name='8481'></font>
<A NAME='CMBGB3'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8482'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb3</font> <A href='../../call_to/CMBGB3.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB3.html' TARGET='index'>4</A><a name='8483'>
<font color=#447700>!***************************************************************************<a name='8484'></font>
<font color=#447700>!<a name='8485'></font>
<font color=#447700>!     band 3:  500-630 cm-1 (low key - h2o,co2; low minor - n2o)<a name='8486'></font>
<font color=#447700>!                           (high key - h2o,co2; high minor - n2o)<a name='8487'></font>
<font color=#447700>!<a name='8488'></font>
<font color=#447700>! old band 3:  500-630 cm-1 (low - h2o,co2; high - h2o,co2)<a name='8489'></font>
<font color=#447700>!***************************************************************************<a name='8490'></font>
<a name='8491'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_27">, only : mg, nbndlw, ngptlw, ng3<a name='8492'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG03'>rrlw_kg03</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_2">, only: fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, &amp;<a name='8493'>
                           selfrefo, forrefo, &amp;<a name='8494'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mn2o, kb_mn2o, &amp;<a name='8495'>
                           selfref, forref<a name='8496'>
<a name='8497'>
<font color=#447700>! ------- Local -------<a name='8498'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='8499'>
      real(kind=rb) :: sumk, sumf<a name='8500'>
<a name='8501'>
<a name='8502'>
      do jn = 1,9<a name='8503'>
         do jt = 1,5<a name='8504'>
            do jp = 1,13<a name='8505'>
               iprsm = 0<a name='8506'>
               do igc = 1,ngc(3)<a name='8507'>
                 sumk = 0.<a name='8508'>
                  do ipr = 1, ngn(ngs(2)+igc)<a name='8509'>
                     iprsm = iprsm + 1<a name='8510'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+32)<a name='8511'>
                  enddo<a name='8512'>
                  ka(jn,jt,jp,igc) = sumk<a name='8513'>
               enddo<a name='8514'>
            enddo<a name='8515'>
         enddo<a name='8516'>
      enddo<a name='8517'>
      do jn = 1,5<a name='8518'>
         do jt = 1,5<a name='8519'>
            do jp = 13,59<a name='8520'>
               iprsm = 0<a name='8521'>
               do igc = 1,ngc(3)<a name='8522'>
                  sumk = 0.<a name='8523'>
                  do ipr = 1, ngn(ngs(2)+igc)<a name='8524'>
                     iprsm = iprsm + 1<a name='8525'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+32)<a name='8526'>
                  enddo<a name='8527'>
                  kb(jn,jt,jp,igc) = sumk<a name='8528'>
               enddo<a name='8529'>
            enddo<a name='8530'>
         enddo<a name='8531'>
      enddo<a name='8532'>
<a name='8533'>
      do jn = 1,9<a name='8534'>
         do jt = 1,19<a name='8535'>
            iprsm = 0<a name='8536'>
            do igc = 1,ngc(3)<a name='8537'>
              sumk = 0.<a name='8538'>
               do ipr = 1, ngn(ngs(2)+igc)<a name='8539'>
                  iprsm = iprsm + 1<a name='8540'>
                  sumk = sumk + kao_mn2o(jn,jt,iprsm)*rwgt(iprsm+32)<a name='8541'>
               enddo<a name='8542'>
               ka_mn2o(jn,jt,igc) = sumk<a name='8543'>
            enddo<a name='8544'>
         enddo<a name='8545'>
      enddo<a name='8546'>
<a name='8547'>
      do jn = 1,5<a name='8548'>
         do jt = 1,19<a name='8549'>
            iprsm = 0<a name='8550'>
            do igc = 1,ngc(3)<a name='8551'>
              sumk = 0.<a name='8552'>
               do ipr = 1, ngn(ngs(2)+igc)<a name='8553'>
                  iprsm = iprsm + 1<a name='8554'>
                  sumk = sumk + kbo_mn2o(jn,jt,iprsm)*rwgt(iprsm+32)<a name='8555'>
               enddo<a name='8556'>
               kb_mn2o(jn,jt,igc) = sumk<a name='8557'>
            enddo<a name='8558'>
         enddo<a name='8559'>
      enddo<a name='8560'>
<a name='8561'>
      do jt = 1,10<a name='8562'>
         iprsm = 0<a name='8563'>
         do igc = 1,ngc(3)<a name='8564'>
            sumk = 0.<a name='8565'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='8566'>
               iprsm = iprsm + 1<a name='8567'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+32)<a name='8568'>
            enddo<a name='8569'>
            selfref(jt,igc) = sumk<a name='8570'>
         enddo<a name='8571'>
      enddo<a name='8572'>
<a name='8573'>
      do jt = 1,4<a name='8574'>
         iprsm = 0<a name='8575'>
         do igc = 1,ngc(3)<a name='8576'>
            sumk = 0.<a name='8577'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='8578'>
               iprsm = iprsm + 1<a name='8579'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+32)<a name='8580'>
            enddo<a name='8581'>
            forref(jt,igc) = sumk<a name='8582'>
         enddo<a name='8583'>
      enddo<a name='8584'>
<a name='8585'>
      do jp = 1,9<a name='8586'>
         iprsm = 0<a name='8587'>
         do igc = 1,ngc(3)<a name='8588'>
            sumf = 0.<a name='8589'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='8590'>
               iprsm = iprsm + 1<a name='8591'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='8592'>
            enddo<a name='8593'>
            fracrefa(igc,jp) = sumf<a name='8594'>
         enddo<a name='8595'>
      enddo<a name='8596'>
<a name='8597'>
      do jp = 1,5<a name='8598'>
         iprsm = 0<a name='8599'>
         do igc = 1,ngc(3)<a name='8600'>
            sumf = 0.<a name='8601'>
            do ipr = 1, ngn(ngs(2)+igc)<a name='8602'>
               iprsm = iprsm + 1<a name='8603'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='8604'>
            enddo<a name='8605'>
            fracrefb(igc,jp) = sumf<a name='8606'>
         enddo<a name='8607'>
      enddo<a name='8608'>
<a name='8609'>
      end subroutine cmbgb3<a name='8610'>
<a name='8611'>
<font color=#447700>!***************************************************************************<a name='8612'></font>
<A NAME='CMBGB4'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8613'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb4</font> <A href='../../call_to/CMBGB4.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB4.html' TARGET='index'>4</A><a name='8614'>
<font color=#447700>!***************************************************************************<a name='8615'></font>
<font color=#447700>!<a name='8616'></font>
<font color=#447700>!     band 4:  630-700 cm-1 (low key - h2o,co2; high key - o3,co2)<a name='8617'></font>
<font color=#447700>!<a name='8618'></font>
<font color=#447700>! old band 4:  630-700 cm-1 (low - h2o,co2; high - o3,co2)<a name='8619'></font>
<font color=#447700>!***************************************************************************<a name='8620'></font>
<a name='8621'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_28">, only : mg, nbndlw, ngptlw, ng4<a name='8622'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG04'>rrlw_kg04</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_2">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='8623'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='8624'>
<a name='8625'>
<font color=#447700>! ------- Local -------<a name='8626'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='8627'>
      real(kind=rb) :: sumk, sumf<a name='8628'>
<a name='8629'>
<a name='8630'>
      do jn = 1,9<a name='8631'>
         do jt = 1,5<a name='8632'>
            do jp = 1,13<a name='8633'>
               iprsm = 0<a name='8634'>
               do igc = 1,ngc(4)<a name='8635'>
                 sumk = 0.<a name='8636'>
                  do ipr = 1, ngn(ngs(3)+igc)<a name='8637'>
                     iprsm = iprsm + 1<a name='8638'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+48)<a name='8639'>
                  enddo<a name='8640'>
                  ka(jn,jt,jp,igc) = sumk<a name='8641'>
               enddo<a name='8642'>
            enddo<a name='8643'>
         enddo<a name='8644'>
      enddo<a name='8645'>
      do jn = 1,5<a name='8646'>
         do jt = 1,5<a name='8647'>
            do jp = 13,59<a name='8648'>
               iprsm = 0<a name='8649'>
               do igc = 1,ngc(4)<a name='8650'>
                  sumk = 0.<a name='8651'>
                  do ipr = 1, ngn(ngs(3)+igc)<a name='8652'>
                     iprsm = iprsm + 1<a name='8653'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+48)<a name='8654'>
                  enddo<a name='8655'>
                  kb(jn,jt,jp,igc) = sumk<a name='8656'>
               enddo<a name='8657'>
            enddo<a name='8658'>
         enddo<a name='8659'>
      enddo<a name='8660'>
<a name='8661'>
      do jt = 1,10<a name='8662'>
         iprsm = 0<a name='8663'>
         do igc = 1,ngc(4)<a name='8664'>
            sumk = 0.<a name='8665'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='8666'>
               iprsm = iprsm + 1<a name='8667'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+48)<a name='8668'>
            enddo<a name='8669'>
            selfref(jt,igc) = sumk<a name='8670'>
         enddo<a name='8671'>
      enddo<a name='8672'>
<a name='8673'>
      do jt = 1,4<a name='8674'>
         iprsm = 0<a name='8675'>
         do igc = 1,ngc(4)<a name='8676'>
            sumk = 0.<a name='8677'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='8678'>
               iprsm = iprsm + 1<a name='8679'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+48)<a name='8680'>
            enddo<a name='8681'>
            forref(jt,igc) = sumk<a name='8682'>
         enddo<a name='8683'>
      enddo<a name='8684'>
<a name='8685'>
      do jp = 1,9<a name='8686'>
         iprsm = 0<a name='8687'>
         do igc = 1,ngc(4)<a name='8688'>
            sumf = 0.<a name='8689'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='8690'>
               iprsm = iprsm + 1<a name='8691'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='8692'>
            enddo<a name='8693'>
            fracrefa(igc,jp) = sumf<a name='8694'>
         enddo<a name='8695'>
      enddo<a name='8696'>
<a name='8697'>
      do jp = 1,5<a name='8698'>
         iprsm = 0<a name='8699'>
         do igc = 1,ngc(4)<a name='8700'>
            sumf = 0.<a name='8701'>
            do ipr = 1, ngn(ngs(3)+igc)<a name='8702'>
               iprsm = iprsm + 1<a name='8703'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='8704'>
            enddo<a name='8705'>
            fracrefb(igc,jp) = sumf<a name='8706'>
         enddo<a name='8707'>
      enddo<a name='8708'>
<a name='8709'>
      end subroutine cmbgb4<a name='8710'>
<a name='8711'>
<font color=#447700>!***************************************************************************<a name='8712'></font>
<A NAME='CMBGB5'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB5' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8713'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb5</font> <A href='../../call_to/CMBGB5.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB5.html' TARGET='index'>4</A><a name='8714'>
<font color=#447700>!***************************************************************************<a name='8715'></font>
<font color=#447700>!<a name='8716'></font>
<font color=#447700>!     band 5:  700-820 cm-1 (low key - h2o,co2; low minor - o3, ccl4)<a name='8717'></font>
<font color=#447700>!                           (high key - o3,co2)<a name='8718'></font>
<font color=#447700>!<a name='8719'></font>
<font color=#447700>! old band 5:  700-820 cm-1 (low - h2o,co2; high - o3,co2)<a name='8720'></font>
<font color=#447700>!***************************************************************************<a name='8721'></font>
<a name='8722'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_29">, only : mg, nbndlw, ngptlw, ng5<a name='8723'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG05'>rrlw_kg05</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB5' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_2">, only: fracrefao, fracrefbo, kao, kbo, kao_mo3, ccl4o, &amp;<a name='8724'>
                           selfrefo, forrefo, &amp;<a name='8725'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mo3, ccl4, &amp;<a name='8726'>
                           selfref, forref<a name='8727'>
<a name='8728'>
<font color=#447700>! ------- Local -------<a name='8729'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='8730'>
      real(kind=rb) :: sumk, sumf<a name='8731'>
<a name='8732'>
<a name='8733'>
      do jn = 1,9<a name='8734'>
         do jt = 1,5<a name='8735'>
            do jp = 1,13<a name='8736'>
               iprsm = 0<a name='8737'>
               do igc = 1,ngc(5)<a name='8738'>
                 sumk = 0.<a name='8739'>
                  do ipr = 1, ngn(ngs(4)+igc)<a name='8740'>
                     iprsm = iprsm + 1<a name='8741'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+64)<a name='8742'>
                  enddo<a name='8743'>
                  ka(jn,jt,jp,igc) = sumk<a name='8744'>
               enddo<a name='8745'>
            enddo<a name='8746'>
         enddo<a name='8747'>
      enddo<a name='8748'>
      do jn = 1,5<a name='8749'>
         do jt = 1,5<a name='8750'>
            do jp = 13,59<a name='8751'>
               iprsm = 0<a name='8752'>
               do igc = 1,ngc(5)<a name='8753'>
                  sumk = 0.<a name='8754'>
                  do ipr = 1, ngn(ngs(4)+igc)<a name='8755'>
                     iprsm = iprsm + 1<a name='8756'>
                     sumk = sumk + kbo(jn,jt,jp,iprsm)*rwgt(iprsm+64)<a name='8757'>
                  enddo<a name='8758'>
                  kb(jn,jt,jp,igc) = sumk<a name='8759'>
               enddo<a name='8760'>
            enddo<a name='8761'>
         enddo<a name='8762'>
      enddo<a name='8763'>
<a name='8764'>
      do jn = 1,9<a name='8765'>
         do jt = 1,19<a name='8766'>
            iprsm = 0<a name='8767'>
            do igc = 1,ngc(5)<a name='8768'>
              sumk = 0.<a name='8769'>
               do ipr = 1, ngn(ngs(4)+igc)<a name='8770'>
                  iprsm = iprsm + 1<a name='8771'>
                  sumk = sumk + kao_mo3(jn,jt,iprsm)*rwgt(iprsm+64)<a name='8772'>
               enddo<a name='8773'>
               ka_mo3(jn,jt,igc) = sumk<a name='8774'>
            enddo<a name='8775'>
         enddo<a name='8776'>
      enddo<a name='8777'>
<a name='8778'>
      do jt = 1,10<a name='8779'>
         iprsm = 0<a name='8780'>
         do igc = 1,ngc(5)<a name='8781'>
            sumk = 0.<a name='8782'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='8783'>
               iprsm = iprsm + 1<a name='8784'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+64)<a name='8785'>
            enddo<a name='8786'>
            selfref(jt,igc) = sumk<a name='8787'>
         enddo<a name='8788'>
      enddo<a name='8789'>
<a name='8790'>
      do jt = 1,4<a name='8791'>
         iprsm = 0<a name='8792'>
         do igc = 1,ngc(5)<a name='8793'>
            sumk = 0.<a name='8794'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='8795'>
               iprsm = iprsm + 1<a name='8796'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+64)<a name='8797'>
            enddo<a name='8798'>
            forref(jt,igc) = sumk<a name='8799'>
         enddo<a name='8800'>
      enddo<a name='8801'>
<a name='8802'>
      do jp = 1,9<a name='8803'>
         iprsm = 0<a name='8804'>
         do igc = 1,ngc(5)<a name='8805'>
            sumf = 0.<a name='8806'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='8807'>
               iprsm = iprsm + 1<a name='8808'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='8809'>
            enddo<a name='8810'>
            fracrefa(igc,jp) = sumf<a name='8811'>
         enddo<a name='8812'>
      enddo<a name='8813'>
<a name='8814'>
      do jp = 1,5<a name='8815'>
         iprsm = 0<a name='8816'>
         do igc = 1,ngc(5)<a name='8817'>
            sumf = 0.<a name='8818'>
            do ipr = 1, ngn(ngs(4)+igc)<a name='8819'>
               iprsm = iprsm + 1<a name='8820'>
               sumf = sumf + fracrefbo(iprsm,jp)<a name='8821'>
            enddo<a name='8822'>
            fracrefb(igc,jp) = sumf<a name='8823'>
         enddo<a name='8824'>
      enddo<a name='8825'>
<a name='8826'>
      iprsm = 0<a name='8827'>
      do igc = 1,ngc(5)<a name='8828'>
         sumk = 0.<a name='8829'>
         do ipr = 1, ngn(ngs(4)+igc)<a name='8830'>
            iprsm = iprsm + 1<a name='8831'>
            sumk = sumk + ccl4o(iprsm)*rwgt(iprsm+64)<a name='8832'>
         enddo<a name='8833'>
         ccl4(igc) = sumk<a name='8834'>
      enddo<a name='8835'>
<a name='8836'>
      end subroutine cmbgb5<a name='8837'>
<a name='8838'>
<font color=#447700>!***************************************************************************<a name='8839'></font>
<A NAME='CMBGB6'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB6' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8840'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb6</font> <A href='../../call_to/CMBGB6.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB6.html' TARGET='index'>4</A><a name='8841'>
<font color=#447700>!***************************************************************************<a name='8842'></font>
<font color=#447700>!<a name='8843'></font>
<font color=#447700>!     band 6:  820-980 cm-1 (low key - h2o; low minor - co2)<a name='8844'></font>
<font color=#447700>!                           (high key - nothing; high minor - cfc11, cfc12)<a name='8845'></font>
<font color=#447700>!<a name='8846'></font>
<font color=#447700>! old band 6:  820-980 cm-1 (low - h2o; high - nothing)<a name='8847'></font>
<font color=#447700>!***************************************************************************<a name='8848'></font>
<a name='8849'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_30">, only : mg, nbndlw, ngptlw, ng6<a name='8850'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG06'>rrlw_kg06</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB6' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_2">, only: fracrefao, kao, kao_mco2, cfc11adjo, cfc12o, &amp;<a name='8851'>
                           selfrefo, forrefo, &amp;<a name='8852'>
                           fracrefa, absa, ka, ka_mco2, cfc11adj, cfc12, &amp;<a name='8853'>
                           selfref, forref<a name='8854'>
<a name='8855'>
<font color=#447700>! ------- Local -------<a name='8856'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='8857'>
      real(kind=rb) :: sumk, sumf, sumk1, sumk2<a name='8858'>
<a name='8859'>
<a name='8860'>
      do jt = 1,5<a name='8861'>
         do jp = 1,13<a name='8862'>
            iprsm = 0<a name='8863'>
            do igc = 1,ngc(6)<a name='8864'>
               sumk = 0.<a name='8865'>
               do ipr = 1, ngn(ngs(5)+igc)<a name='8866'>
                  iprsm = iprsm + 1<a name='8867'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+80)<a name='8868'>
               enddo<a name='8869'>
               ka(jt,jp,igc) = sumk<a name='8870'>
            enddo<a name='8871'>
         enddo<a name='8872'>
      enddo<a name='8873'>
<a name='8874'>
      do jt = 1,19<a name='8875'>
         iprsm = 0<a name='8876'>
         do igc = 1,ngc(6)<a name='8877'>
            sumk = 0.<a name='8878'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='8879'>
               iprsm = iprsm + 1<a name='8880'>
               sumk = sumk + kao_mco2(jt,iprsm)*rwgt(iprsm+80)<a name='8881'>
            enddo<a name='8882'>
            ka_mco2(jt,igc) = sumk<a name='8883'>
         enddo<a name='8884'>
      enddo<a name='8885'>
<a name='8886'>
      do jt = 1,10<a name='8887'>
         iprsm = 0<a name='8888'>
         do igc = 1,ngc(6)<a name='8889'>
            sumk = 0.<a name='8890'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='8891'>
               iprsm = iprsm + 1<a name='8892'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+80)<a name='8893'>
            enddo<a name='8894'>
            selfref(jt,igc) = sumk<a name='8895'>
         enddo<a name='8896'>
      enddo<a name='8897'>
<a name='8898'>
      do jt = 1,4<a name='8899'>
         iprsm = 0<a name='8900'>
         do igc = 1,ngc(6)<a name='8901'>
            sumk = 0.<a name='8902'>
            do ipr = 1, ngn(ngs(5)+igc)<a name='8903'>
               iprsm = iprsm + 1<a name='8904'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+80)<a name='8905'>
            enddo<a name='8906'>
            forref(jt,igc) = sumk<a name='8907'>
         enddo<a name='8908'>
      enddo<a name='8909'>
<a name='8910'>
      iprsm = 0<a name='8911'>
      do igc = 1,ngc(6)<a name='8912'>
         sumf = 0.<a name='8913'>
         sumk1= 0.<a name='8914'>
         sumk2= 0.<a name='8915'>
         do ipr = 1, ngn(ngs(5)+igc)<a name='8916'>
            iprsm = iprsm + 1<a name='8917'>
            sumf = sumf + fracrefao(iprsm)<a name='8918'>
            sumk1= sumk1+ cfc11adjo(iprsm)*rwgt(iprsm+80)<a name='8919'>
            sumk2= sumk2+ cfc12o(iprsm)*rwgt(iprsm+80)<a name='8920'>
         enddo<a name='8921'>
         fracrefa(igc) = sumf<a name='8922'>
         cfc11adj(igc) = sumk1<a name='8923'>
         cfc12(igc) = sumk2<a name='8924'>
      enddo<a name='8925'>
<a name='8926'>
      end subroutine cmbgb6<a name='8927'>
<a name='8928'>
<font color=#447700>!***************************************************************************<a name='8929'></font>
<A NAME='CMBGB7'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB7' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8930'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb7</font> <A href='../../call_to/CMBGB7.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB7.html' TARGET='index'>4</A><a name='8931'>
<font color=#447700>!***************************************************************************<a name='8932'></font>
<font color=#447700>!<a name='8933'></font>
<font color=#447700>!     band 7:  980-1080 cm-1 (low key - h2o,o3; low minor - co2)<a name='8934'></font>
<font color=#447700>!                            (high key - o3; high minor - co2)<a name='8935'></font>
<font color=#447700>!<a name='8936'></font>
<font color=#447700>! old band 7:  980-1080 cm-1 (low - h2o,o3; high - o3)<a name='8937'></font>
<font color=#447700>!***************************************************************************<a name='8938'></font>
<a name='8939'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_31">, only : mg, nbndlw, ngptlw, ng7<a name='8940'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG07'>rrlw_kg07</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB7' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_2">, only: fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, &amp;<a name='8941'>
                           selfrefo, forrefo, &amp;<a name='8942'>
                           fracrefa, fracrefb, absa, ka, absb, kb, ka_mco2, kb_mco2, &amp;<a name='8943'>
                           selfref, forref<a name='8944'>
<a name='8945'>
<font color=#447700>! ------- Local -------<a name='8946'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='8947'>
      real(kind=rb) :: sumk, sumf<a name='8948'>
<a name='8949'>
<a name='8950'>
      do jn = 1,9<a name='8951'>
         do jt = 1,5<a name='8952'>
            do jp = 1,13<a name='8953'>
               iprsm = 0<a name='8954'>
               do igc = 1,ngc(7)<a name='8955'>
                 sumk = 0.<a name='8956'>
                  do ipr = 1, ngn(ngs(6)+igc)<a name='8957'>
                     iprsm = iprsm + 1<a name='8958'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+96)<a name='8959'>
                  enddo<a name='8960'>
                  ka(jn,jt,jp,igc) = sumk<a name='8961'>
               enddo<a name='8962'>
            enddo<a name='8963'>
         enddo<a name='8964'>
      enddo<a name='8965'>
      do jt = 1,5<a name='8966'>
         do jp = 13,59<a name='8967'>
            iprsm = 0<a name='8968'>
            do igc = 1,ngc(7)<a name='8969'>
               sumk = 0.<a name='8970'>
               do ipr = 1, ngn(ngs(6)+igc)<a name='8971'>
                  iprsm = iprsm + 1<a name='8972'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+96)<a name='8973'>
               enddo<a name='8974'>
               kb(jt,jp,igc) = sumk<a name='8975'>
            enddo<a name='8976'>
         enddo<a name='8977'>
      enddo<a name='8978'>
<a name='8979'>
      do jn = 1,9<a name='8980'>
         do jt = 1,19<a name='8981'>
            iprsm = 0<a name='8982'>
            do igc = 1,ngc(7)<a name='8983'>
              sumk = 0.<a name='8984'>
               do ipr = 1, ngn(ngs(6)+igc)<a name='8985'>
                  iprsm = iprsm + 1<a name='8986'>
                  sumk = sumk + kao_mco2(jn,jt,iprsm)*rwgt(iprsm+96)<a name='8987'>
               enddo<a name='8988'>
               ka_mco2(jn,jt,igc) = sumk<a name='8989'>
            enddo<a name='8990'>
         enddo<a name='8991'>
      enddo<a name='8992'>
<a name='8993'>
      do jt = 1,19<a name='8994'>
         iprsm = 0<a name='8995'>
         do igc = 1,ngc(7)<a name='8996'>
            sumk = 0.<a name='8997'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='8998'>
               iprsm = iprsm + 1<a name='8999'>
               sumk = sumk + kbo_mco2(jt,iprsm)*rwgt(iprsm+96)<a name='9000'>
            enddo<a name='9001'>
            kb_mco2(jt,igc) = sumk<a name='9002'>
         enddo<a name='9003'>
      enddo<a name='9004'>
<a name='9005'>
      do jt = 1,10<a name='9006'>
         iprsm = 0<a name='9007'>
         do igc = 1,ngc(7)<a name='9008'>
            sumk = 0.<a name='9009'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='9010'>
               iprsm = iprsm + 1<a name='9011'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+96)<a name='9012'>
            enddo<a name='9013'>
            selfref(jt,igc) = sumk<a name='9014'>
         enddo<a name='9015'>
      enddo<a name='9016'>
<a name='9017'>
      do jt = 1,4<a name='9018'>
         iprsm = 0<a name='9019'>
         do igc = 1,ngc(7)<a name='9020'>
            sumk = 0.<a name='9021'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='9022'>
               iprsm = iprsm + 1<a name='9023'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+96)<a name='9024'>
            enddo<a name='9025'>
            forref(jt,igc) = sumk<a name='9026'>
         enddo<a name='9027'>
      enddo<a name='9028'>
<a name='9029'>
      do jp = 1,9<a name='9030'>
         iprsm = 0<a name='9031'>
         do igc = 1,ngc(7)<a name='9032'>
            sumf = 0.<a name='9033'>
            do ipr = 1, ngn(ngs(6)+igc)<a name='9034'>
               iprsm = iprsm + 1<a name='9035'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9036'>
            enddo<a name='9037'>
            fracrefa(igc,jp) = sumf<a name='9038'>
         enddo<a name='9039'>
      enddo<a name='9040'>
<a name='9041'>
      iprsm = 0<a name='9042'>
      do igc = 1,ngc(7)<a name='9043'>
         sumf = 0.<a name='9044'>
         do ipr = 1, ngn(ngs(6)+igc)<a name='9045'>
            iprsm = iprsm + 1<a name='9046'>
            sumf = sumf + fracrefbo(iprsm)<a name='9047'>
         enddo<a name='9048'>
         fracrefb(igc) = sumf<a name='9049'>
      enddo<a name='9050'>
<a name='9051'>
      end subroutine cmbgb7<a name='9052'>
<a name='9053'>
<font color=#447700>!***************************************************************************<a name='9054'></font>
<A NAME='CMBGB8'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9055'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb8</font> <A href='../../call_to/CMBGB8.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB8.html' TARGET='index'>4</A><a name='9056'>
<font color=#447700>!***************************************************************************<a name='9057'></font>
<font color=#447700>!<a name='9058'></font>
<font color=#447700>!     band 8:  1080-1180 cm-1 (low key - h2o; low minor - co2,o3,n2o)<a name='9059'></font>
<font color=#447700>!                             (high key - o3; high minor - co2, n2o)<a name='9060'></font>
<font color=#447700>!<a name='9061'></font>
<font color=#447700>! old band 8:  1080-1180 cm-1 (low (i.e.&gt;~300mb) - h2o; high - o3)<a name='9062'></font>
<font color=#447700>!***************************************************************************<a name='9063'></font>
<a name='9064'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_32">, only : mg, nbndlw, ngptlw, ng8<a name='9065'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG08'>rrlw_kg08</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_2">, only: fracrefao, fracrefbo, kao, kao_mco2, kao_mn2o, &amp;<a name='9066'>
                           kao_mo3, kbo, kbo_mco2, kbo_mn2o, selfrefo, forrefo, &amp;<a name='9067'>
                           cfc12o, cfc22adjo, &amp;<a name='9068'>
                           fracrefa, fracrefb, absa, ka, ka_mco2, ka_mn2o, &amp;<a name='9069'>
                           ka_mo3, absb, kb, kb_mco2, kb_mn2o, selfref, forref, &amp;<a name='9070'>
                           cfc12, cfc22adj<a name='9071'>
<a name='9072'>
<font color=#447700>! ------- Local -------<a name='9073'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='9074'>
      real(kind=rb) :: sumk, sumk1, sumk2, sumk3, sumk4, sumk5, sumf1, sumf2<a name='9075'>
<a name='9076'>
<a name='9077'>
      do jt = 1,5<a name='9078'>
         do jp = 1,13<a name='9079'>
            iprsm = 0<a name='9080'>
            do igc = 1,ngc(8)<a name='9081'>
              sumk = 0.<a name='9082'>
               do ipr = 1, ngn(ngs(7)+igc)<a name='9083'>
                  iprsm = iprsm + 1<a name='9084'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+112)<a name='9085'>
               enddo<a name='9086'>
               ka(jt,jp,igc) = sumk<a name='9087'>
            enddo<a name='9088'>
         enddo<a name='9089'>
      enddo<a name='9090'>
      do jt = 1,5<a name='9091'>
         do jp = 13,59<a name='9092'>
            iprsm = 0<a name='9093'>
            do igc = 1,ngc(8)<a name='9094'>
               sumk = 0.<a name='9095'>
               do ipr = 1, ngn(ngs(7)+igc)<a name='9096'>
                  iprsm = iprsm + 1<a name='9097'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+112)<a name='9098'>
               enddo<a name='9099'>
               kb(jt,jp,igc) = sumk<a name='9100'>
            enddo<a name='9101'>
         enddo<a name='9102'>
      enddo<a name='9103'>
<a name='9104'>
      do jt = 1,10<a name='9105'>
         iprsm = 0<a name='9106'>
         do igc = 1,ngc(8)<a name='9107'>
            sumk = 0.<a name='9108'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='9109'>
               iprsm = iprsm + 1<a name='9110'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+112)<a name='9111'>
            enddo<a name='9112'>
            selfref(jt,igc) = sumk<a name='9113'>
         enddo<a name='9114'>
      enddo<a name='9115'>
<a name='9116'>
      do jt = 1,4<a name='9117'>
         iprsm = 0<a name='9118'>
         do igc = 1,ngc(8)<a name='9119'>
            sumk = 0.<a name='9120'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='9121'>
               iprsm = iprsm + 1<a name='9122'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+112)<a name='9123'>
            enddo<a name='9124'>
            forref(jt,igc) = sumk<a name='9125'>
         enddo<a name='9126'>
      enddo<a name='9127'>
<a name='9128'>
      do jt = 1,19<a name='9129'>
         iprsm = 0<a name='9130'>
         do igc = 1,ngc(8)<a name='9131'>
            sumk1 = 0.<a name='9132'>
            sumk2 = 0.<a name='9133'>
            sumk3 = 0.<a name='9134'>
            sumk4 = 0.<a name='9135'>
            sumk5 = 0.<a name='9136'>
            do ipr = 1, ngn(ngs(7)+igc)<a name='9137'>
               iprsm = iprsm + 1<a name='9138'>
               sumk1 = sumk1 + kao_mco2(jt,iprsm)*rwgt(iprsm+112)<a name='9139'>
               sumk2 = sumk2 + kbo_mco2(jt,iprsm)*rwgt(iprsm+112)<a name='9140'>
               sumk3 = sumk3 + kao_mo3(jt,iprsm)*rwgt(iprsm+112)<a name='9141'>
               sumk4 = sumk4 + kao_mn2o(jt,iprsm)*rwgt(iprsm+112)<a name='9142'>
               sumk5 = sumk5 + kbo_mn2o(jt,iprsm)*rwgt(iprsm+112)<a name='9143'>
            enddo<a name='9144'>
            ka_mco2(jt,igc) = sumk1<a name='9145'>
            kb_mco2(jt,igc) = sumk2<a name='9146'>
            ka_mo3(jt,igc) = sumk3<a name='9147'>
            ka_mn2o(jt,igc) = sumk4<a name='9148'>
            kb_mn2o(jt,igc) = sumk5<a name='9149'>
         enddo<a name='9150'>
      enddo<a name='9151'>
<a name='9152'>
      iprsm = 0<a name='9153'>
      do igc = 1,ngc(8)<a name='9154'>
         sumf1= 0.<a name='9155'>
         sumf2= 0.<a name='9156'>
         sumk1= 0.<a name='9157'>
         sumk2= 0.<a name='9158'>
         do ipr = 1, ngn(ngs(7)+igc)<a name='9159'>
            iprsm = iprsm + 1<a name='9160'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='9161'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='9162'>
            sumk1= sumk1+ cfc12o(iprsm)*rwgt(iprsm+112)<a name='9163'>
            sumk2= sumk2+ cfc22adjo(iprsm)*rwgt(iprsm+112)<a name='9164'>
         enddo<a name='9165'>
         fracrefa(igc) = sumf1<a name='9166'>
         fracrefb(igc) = sumf2<a name='9167'>
         cfc12(igc) = sumk1<a name='9168'>
         cfc22adj(igc) = sumk2<a name='9169'>
      enddo<a name='9170'>
<a name='9171'>
      end subroutine cmbgb8<a name='9172'>
<a name='9173'>
<font color=#447700>!***************************************************************************<a name='9174'></font>
<A NAME='CMBGB9'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB9' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9175'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb9</font> <A href='../../call_to/CMBGB9.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB9.html' TARGET='index'>4</A><a name='9176'>
<font color=#447700>!***************************************************************************<a name='9177'></font>
<font color=#447700>!<a name='9178'></font>
<font color=#447700>!     band 9:  1180-1390 cm-1 (low key - h2o,ch4; low minor - n2o)<a name='9179'></font>
<font color=#447700>!                             (high key - ch4; high minor - n2o)!<a name='9180'></font>
<a name='9181'>
<font color=#447700>! old band 9:  1180-1390 cm-1 (low - h2o,ch4; high - ch4)<a name='9182'></font>
<font color=#447700>!***************************************************************************<a name='9183'></font>
<a name='9184'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_33">, only : mg, nbndlw, ngptlw, ng9<a name='9185'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG09'>rrlw_kg09</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB9' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_2">, only: fracrefao, fracrefbo, kao, kao_mn2o, &amp;<a name='9186'>
                           kbo, kbo_mn2o, selfrefo, forrefo, &amp;<a name='9187'>
                           fracrefa, fracrefb, absa, ka, ka_mn2o, &amp;<a name='9188'>
                           absb, kb, kb_mn2o, selfref, forref<a name='9189'>
<a name='9190'>
<font color=#447700>! ------- Local -------<a name='9191'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='9192'>
      real(kind=rb) :: sumk, sumf<a name='9193'>
<a name='9194'>
<a name='9195'>
      do jn = 1,9<a name='9196'>
         do jt = 1,5<a name='9197'>
            do jp = 1,13<a name='9198'>
               iprsm = 0<a name='9199'>
               do igc = 1,ngc(9)<a name='9200'>
                  sumk = 0.<a name='9201'>
                  do ipr = 1, ngn(ngs(8)+igc)<a name='9202'>
                     iprsm = iprsm + 1<a name='9203'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+128)<a name='9204'>
                  enddo<a name='9205'>
                  ka(jn,jt,jp,igc) = sumk<a name='9206'>
               enddo<a name='9207'>
            enddo<a name='9208'>
         enddo<a name='9209'>
      enddo<a name='9210'>
<a name='9211'>
      do jt = 1,5<a name='9212'>
         do jp = 13,59<a name='9213'>
            iprsm = 0<a name='9214'>
            do igc = 1,ngc(9)<a name='9215'>
               sumk = 0.<a name='9216'>
               do ipr = 1, ngn(ngs(8)+igc)<a name='9217'>
                  iprsm = iprsm + 1<a name='9218'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+128)<a name='9219'>
               enddo<a name='9220'>
               kb(jt,jp,igc) = sumk<a name='9221'>
            enddo<a name='9222'>
         enddo<a name='9223'>
      enddo<a name='9224'>
<a name='9225'>
      do jn = 1,9<a name='9226'>
         do jt = 1,19<a name='9227'>
            iprsm = 0<a name='9228'>
            do igc = 1,ngc(9)<a name='9229'>
              sumk = 0.<a name='9230'>
               do ipr = 1, ngn(ngs(8)+igc)<a name='9231'>
                  iprsm = iprsm + 1<a name='9232'>
                  sumk = sumk + kao_mn2o(jn,jt,iprsm)*rwgt(iprsm+128)<a name='9233'>
               enddo<a name='9234'>
               ka_mn2o(jn,jt,igc) = sumk<a name='9235'>
            enddo<a name='9236'>
         enddo<a name='9237'>
      enddo<a name='9238'>
<a name='9239'>
      do jt = 1,19<a name='9240'>
         iprsm = 0<a name='9241'>
         do igc = 1,ngc(9)<a name='9242'>
            sumk = 0.<a name='9243'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='9244'>
               iprsm = iprsm + 1<a name='9245'>
               sumk = sumk + kbo_mn2o(jt,iprsm)*rwgt(iprsm+128)<a name='9246'>
            enddo<a name='9247'>
            kb_mn2o(jt,igc) = sumk<a name='9248'>
         enddo<a name='9249'>
      enddo<a name='9250'>
<a name='9251'>
      do jt = 1,10<a name='9252'>
         iprsm = 0<a name='9253'>
         do igc = 1,ngc(9)<a name='9254'>
            sumk = 0.<a name='9255'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='9256'>
               iprsm = iprsm + 1<a name='9257'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+128)<a name='9258'>
            enddo<a name='9259'>
            selfref(jt,igc) = sumk<a name='9260'>
         enddo<a name='9261'>
      enddo<a name='9262'>
<a name='9263'>
      do jt = 1,4<a name='9264'>
         iprsm = 0<a name='9265'>
         do igc = 1,ngc(9)<a name='9266'>
            sumk = 0.<a name='9267'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='9268'>
               iprsm = iprsm + 1<a name='9269'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+128)<a name='9270'>
            enddo<a name='9271'>
            forref(jt,igc) = sumk<a name='9272'>
         enddo<a name='9273'>
      enddo<a name='9274'>
<a name='9275'>
      do jp = 1,9<a name='9276'>
         iprsm = 0<a name='9277'>
         do igc = 1,ngc(9)<a name='9278'>
            sumf = 0.<a name='9279'>
            do ipr = 1, ngn(ngs(8)+igc)<a name='9280'>
               iprsm = iprsm + 1<a name='9281'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9282'>
            enddo<a name='9283'>
            fracrefa(igc,jp) = sumf<a name='9284'>
         enddo<a name='9285'>
      enddo<a name='9286'>
<a name='9287'>
      iprsm = 0<a name='9288'>
      do igc = 1,ngc(9)<a name='9289'>
         sumf = 0.<a name='9290'>
         do ipr = 1, ngn(ngs(8)+igc)<a name='9291'>
            iprsm = iprsm + 1<a name='9292'>
            sumf = sumf + fracrefbo(iprsm)<a name='9293'>
         enddo<a name='9294'>
         fracrefb(igc) = sumf<a name='9295'>
      enddo<a name='9296'>
<a name='9297'>
      end subroutine cmbgb9<a name='9298'>
<a name='9299'>
<font color=#447700>!***************************************************************************<a name='9300'></font>
<A NAME='CMBGB10'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9301'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb10</font> <A href='../../call_to/CMBGB10.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB10.html' TARGET='index'>4</A><a name='9302'>
<font color=#447700>!***************************************************************************<a name='9303'></font>
<font color=#447700>!<a name='9304'></font>
<font color=#447700>!     band 10:  1390-1480 cm-1 (low key - h2o; high key - h2o)<a name='9305'></font>
<font color=#447700>!<a name='9306'></font>
<font color=#447700>! old band 10:  1390-1480 cm-1 (low - h2o; high - h2o)<a name='9307'></font>
<font color=#447700>!***************************************************************************<a name='9308'></font>
<a name='9309'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_34">, only : mg, nbndlw, ngptlw, ng10<a name='9310'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG10'>rrlw_kg10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_2">, only: fracrefao, fracrefbo, kao, kbo, &amp;<a name='9311'>
                           selfrefo, forrefo, &amp;<a name='9312'>
                           fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='9313'>
                           selfref, forref<a name='9314'>
<a name='9315'>
<font color=#447700>! ------- Local -------<a name='9316'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='9317'>
      real(kind=rb) :: sumk, sumf1, sumf2<a name='9318'>
<a name='9319'>
<a name='9320'>
      do jt = 1,5<a name='9321'>
         do jp = 1,13<a name='9322'>
            iprsm = 0<a name='9323'>
            do igc = 1,ngc(10)<a name='9324'>
               sumk = 0.<a name='9325'>
               do ipr = 1, ngn(ngs(9)+igc)<a name='9326'>
                  iprsm = iprsm + 1<a name='9327'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+144)<a name='9328'>
               enddo<a name='9329'>
               ka(jt,jp,igc) = sumk<a name='9330'>
            enddo<a name='9331'>
         enddo<a name='9332'>
      enddo<a name='9333'>
<a name='9334'>
      do jt = 1,5<a name='9335'>
         do jp = 13,59<a name='9336'>
            iprsm = 0<a name='9337'>
            do igc = 1,ngc(10)<a name='9338'>
               sumk = 0.<a name='9339'>
               do ipr = 1, ngn(ngs(9)+igc)<a name='9340'>
                  iprsm = iprsm + 1<a name='9341'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+144)<a name='9342'>
               enddo<a name='9343'>
               kb(jt,jp,igc) = sumk<a name='9344'>
            enddo<a name='9345'>
         enddo<a name='9346'>
      enddo<a name='9347'>
<a name='9348'>
      do jt = 1,10<a name='9349'>
         iprsm = 0<a name='9350'>
         do igc = 1,ngc(10)<a name='9351'>
            sumk = 0.<a name='9352'>
            do ipr = 1, ngn(ngs(9)+igc)<a name='9353'>
               iprsm = iprsm + 1<a name='9354'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+144)<a name='9355'>
            enddo<a name='9356'>
            selfref(jt,igc) = sumk<a name='9357'>
         enddo<a name='9358'>
      enddo<a name='9359'>
<a name='9360'>
      do jt = 1,4<a name='9361'>
         iprsm = 0<a name='9362'>
         do igc = 1,ngc(10)<a name='9363'>
            sumk = 0.<a name='9364'>
            do ipr = 1, ngn(ngs(9)+igc)<a name='9365'>
               iprsm = iprsm + 1<a name='9366'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+144)<a name='9367'>
            enddo<a name='9368'>
            forref(jt,igc) = sumk<a name='9369'>
         enddo<a name='9370'>
      enddo<a name='9371'>
<a name='9372'>
      iprsm = 0<a name='9373'>
      do igc = 1,ngc(10)<a name='9374'>
         sumf1= 0.<a name='9375'>
         sumf2= 0.<a name='9376'>
         do ipr = 1, ngn(ngs(9)+igc)<a name='9377'>
            iprsm = iprsm + 1<a name='9378'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='9379'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='9380'>
         enddo<a name='9381'>
         fracrefa(igc) = sumf1<a name='9382'>
         fracrefb(igc) = sumf2<a name='9383'>
      enddo<a name='9384'>
<a name='9385'>
      end subroutine cmbgb10<a name='9386'>
<a name='9387'>
<font color=#447700>!***************************************************************************<a name='9388'></font>
<A NAME='CMBGB11'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9389'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb11</font> <A href='../../call_to/CMBGB11.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB11.html' TARGET='index'>4</A><a name='9390'>
<font color=#447700>!***************************************************************************<a name='9391'></font>
<font color=#447700>!<a name='9392'></font>
<font color=#447700>!     band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='9393'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='9394'></font>
<font color=#447700>!<a name='9395'></font>
<font color=#447700>! old band 11:  1480-1800 cm-1 (low - h2o; low minor - o2)<a name='9396'></font>
<font color=#447700>!                              (high key - h2o; high minor - o2)<a name='9397'></font>
<font color=#447700>!***************************************************************************<a name='9398'></font>
<a name='9399'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_35">, only : mg, nbndlw, ngptlw, ng11<a name='9400'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG11'>rrlw_kg11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_2">, only: fracrefao, fracrefbo, kao, kao_mo2, &amp;<a name='9401'>
                           kbo, kbo_mo2, selfrefo, forrefo, &amp;<a name='9402'>
                           fracrefa, fracrefb, absa, ka, ka_mo2, &amp;<a name='9403'>
                           absb, kb, kb_mo2, selfref, forref<a name='9404'>
<a name='9405'>
<font color=#447700>! ------- Local -------<a name='9406'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='9407'>
      real(kind=rb) :: sumk, sumk1, sumk2, sumf1, sumf2<a name='9408'>
<a name='9409'>
<a name='9410'>
      do jt = 1,5<a name='9411'>
         do jp = 1,13<a name='9412'>
            iprsm = 0<a name='9413'>
            do igc = 1,ngc(11)<a name='9414'>
               sumk = 0.<a name='9415'>
               do ipr = 1, ngn(ngs(10)+igc)<a name='9416'>
                  iprsm = iprsm + 1<a name='9417'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+160)<a name='9418'>
               enddo<a name='9419'>
               ka(jt,jp,igc) = sumk<a name='9420'>
            enddo<a name='9421'>
         enddo<a name='9422'>
      enddo<a name='9423'>
      do jt = 1,5<a name='9424'>
         do jp = 13,59<a name='9425'>
            iprsm = 0<a name='9426'>
            do igc = 1,ngc(11)<a name='9427'>
               sumk = 0.<a name='9428'>
               do ipr = 1, ngn(ngs(10)+igc)<a name='9429'>
                  iprsm = iprsm + 1<a name='9430'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+160)<a name='9431'>
               enddo<a name='9432'>
               kb(jt,jp,igc) = sumk<a name='9433'>
            enddo<a name='9434'>
         enddo<a name='9435'>
      enddo<a name='9436'>
<a name='9437'>
      do jt = 1,19<a name='9438'>
         iprsm = 0<a name='9439'>
         do igc = 1,ngc(11)<a name='9440'>
            sumk1 = 0.<a name='9441'>
            sumk2 = 0.<a name='9442'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='9443'>
               iprsm = iprsm + 1<a name='9444'>
               sumk1 = sumk1 + kao_mo2(jt,iprsm)*rwgt(iprsm+160)<a name='9445'>
               sumk2 = sumk2 + kbo_mo2(jt,iprsm)*rwgt(iprsm+160)<a name='9446'>
            enddo<a name='9447'>
            ka_mo2(jt,igc) = sumk1<a name='9448'>
            kb_mo2(jt,igc) = sumk2<a name='9449'>
         enddo<a name='9450'>
      enddo<a name='9451'>
<a name='9452'>
      do jt = 1,10<a name='9453'>
         iprsm = 0<a name='9454'>
         do igc = 1,ngc(11)<a name='9455'>
            sumk = 0.<a name='9456'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='9457'>
               iprsm = iprsm + 1<a name='9458'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+160)<a name='9459'>
            enddo<a name='9460'>
            selfref(jt,igc) = sumk<a name='9461'>
         enddo<a name='9462'>
      enddo<a name='9463'>
<a name='9464'>
      do jt = 1,4<a name='9465'>
         iprsm = 0<a name='9466'>
         do igc = 1,ngc(11)<a name='9467'>
            sumk = 0.<a name='9468'>
            do ipr = 1, ngn(ngs(10)+igc)<a name='9469'>
               iprsm = iprsm + 1<a name='9470'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+160)<a name='9471'>
            enddo<a name='9472'>
            forref(jt,igc) = sumk<a name='9473'>
         enddo<a name='9474'>
      enddo<a name='9475'>
<a name='9476'>
      iprsm = 0<a name='9477'>
      do igc = 1,ngc(11)<a name='9478'>
         sumf1= 0.<a name='9479'>
         sumf2= 0.<a name='9480'>
         do ipr = 1, ngn(ngs(10)+igc)<a name='9481'>
            iprsm = iprsm + 1<a name='9482'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='9483'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='9484'>
         enddo<a name='9485'>
         fracrefa(igc) = sumf1<a name='9486'>
         fracrefb(igc) = sumf2<a name='9487'>
      enddo<a name='9488'>
<a name='9489'>
      end subroutine cmbgb11<a name='9490'>
<a name='9491'>
<font color=#447700>!***************************************************************************<a name='9492'></font>
<A NAME='CMBGB12'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9493'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb12</font> <A href='../../call_to/CMBGB12.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB12.html' TARGET='index'>4</A><a name='9494'>
<font color=#447700>!***************************************************************************<a name='9495'></font>
<font color=#447700>!<a name='9496'></font>
<font color=#447700>!     band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='9497'></font>
<font color=#447700>!<a name='9498'></font>
<font color=#447700>! old band 12:  1800-2080 cm-1 (low - h2o,co2; high - nothing)<a name='9499'></font>
<font color=#447700>!***************************************************************************<a name='9500'></font>
<a name='9501'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_36">, only : mg, nbndlw, ngptlw, ng12<a name='9502'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG12'>rrlw_kg12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_2">, only: fracrefao, kao, selfrefo, forrefo, &amp;<a name='9503'>
                           fracrefa, absa, ka, selfref, forref<a name='9504'>
<a name='9505'>
<font color=#447700>! ------- Local -------<a name='9506'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='9507'>
      real(kind=rb) :: sumk, sumf<a name='9508'>
<a name='9509'>
<a name='9510'>
      do jn = 1,9<a name='9511'>
         do jt = 1,5<a name='9512'>
            do jp = 1,13<a name='9513'>
               iprsm = 0<a name='9514'>
               do igc = 1,ngc(12)<a name='9515'>
                  sumk = 0.<a name='9516'>
                  do ipr = 1, ngn(ngs(11)+igc)<a name='9517'>
                     iprsm = iprsm + 1<a name='9518'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+176)<a name='9519'>
                  enddo<a name='9520'>
                  ka(jn,jt,jp,igc) = sumk<a name='9521'>
               enddo<a name='9522'>
            enddo<a name='9523'>
         enddo<a name='9524'>
      enddo<a name='9525'>
<a name='9526'>
      do jt = 1,10<a name='9527'>
         iprsm = 0<a name='9528'>
         do igc = 1,ngc(12)<a name='9529'>
            sumk = 0.<a name='9530'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='9531'>
               iprsm = iprsm + 1<a name='9532'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+176)<a name='9533'>
            enddo<a name='9534'>
            selfref(jt,igc) = sumk<a name='9535'>
         enddo<a name='9536'>
      enddo<a name='9537'>
<a name='9538'>
      do jt = 1,4<a name='9539'>
         iprsm = 0<a name='9540'>
         do igc = 1,ngc(12)<a name='9541'>
            sumk = 0.<a name='9542'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='9543'>
               iprsm = iprsm + 1<a name='9544'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+176)<a name='9545'>
            enddo<a name='9546'>
            forref(jt,igc) = sumk<a name='9547'>
         enddo<a name='9548'>
      enddo<a name='9549'>
<a name='9550'>
      do jp = 1,9<a name='9551'>
         iprsm = 0<a name='9552'>
         do igc = 1,ngc(12)<a name='9553'>
            sumf = 0.<a name='9554'>
            do ipr = 1, ngn(ngs(11)+igc)<a name='9555'>
               iprsm = iprsm + 1<a name='9556'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9557'>
            enddo<a name='9558'>
            fracrefa(igc,jp) = sumf<a name='9559'>
         enddo<a name='9560'>
      enddo<a name='9561'>
<a name='9562'>
      end subroutine cmbgb12<a name='9563'>
<a name='9564'>
<font color=#447700>!***************************************************************************<a name='9565'></font>
<A NAME='CMBGB13'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9566'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb13</font> <A href='../../call_to/CMBGB13.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB13.html' TARGET='index'>4</A><a name='9567'>
<font color=#447700>!***************************************************************************<a name='9568'></font>
<font color=#447700>!<a name='9569'></font>
<font color=#447700>!     band 13:  2080-2250 cm-1 (low key - h2o,n2o; high minor - o3 minor)<a name='9570'></font>
<font color=#447700>!<a name='9571'></font>
<font color=#447700>! old band 13:  2080-2250 cm-1 (low - h2o,n2o; high - nothing)<a name='9572'></font>
<font color=#447700>!***************************************************************************<a name='9573'></font>
<a name='9574'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_37">, only : mg, nbndlw, ngptlw, ng13<a name='9575'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG13'>rrlw_kg13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_2">, only: fracrefao, fracrefbo, kao, kao_mco2, kao_mco, &amp;<a name='9576'>
                           kbo_mo3, selfrefo, forrefo, &amp;<a name='9577'>
                           fracrefa, fracrefb, absa, ka, ka_mco2, ka_mco, &amp;<a name='9578'>
                           kb_mo3, selfref, forref<a name='9579'>
<a name='9580'>
<font color=#447700>! ------- Local -------<a name='9581'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='9582'>
      real(kind=rb) :: sumk, sumk1, sumk2, sumf<a name='9583'>
<a name='9584'>
<a name='9585'>
      do jn = 1,9<a name='9586'>
         do jt = 1,5<a name='9587'>
            do jp = 1,13<a name='9588'>
               iprsm = 0<a name='9589'>
               do igc = 1,ngc(13)<a name='9590'>
                  sumk = 0.<a name='9591'>
                  do ipr = 1, ngn(ngs(12)+igc)<a name='9592'>
                     iprsm = iprsm + 1<a name='9593'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+192)<a name='9594'>
                  enddo<a name='9595'>
                  ka(jn,jt,jp,igc) = sumk<a name='9596'>
               enddo<a name='9597'>
            enddo<a name='9598'>
         enddo<a name='9599'>
      enddo<a name='9600'>
<a name='9601'>
      do jn = 1,9<a name='9602'>
         do jt = 1,19<a name='9603'>
            iprsm = 0<a name='9604'>
            do igc = 1,ngc(13)<a name='9605'>
              sumk1 = 0.<a name='9606'>
              sumk2 = 0.<a name='9607'>
               do ipr = 1, ngn(ngs(12)+igc)<a name='9608'>
                  iprsm = iprsm + 1<a name='9609'>
                  sumk1 = sumk1 + kao_mco2(jn,jt,iprsm)*rwgt(iprsm+192)<a name='9610'>
                  sumk2 = sumk2 + kao_mco(jn,jt,iprsm)*rwgt(iprsm+192)<a name='9611'>
               enddo<a name='9612'>
               ka_mco2(jn,jt,igc) = sumk1<a name='9613'>
               ka_mco(jn,jt,igc) = sumk2<a name='9614'>
            enddo<a name='9615'>
         enddo<a name='9616'>
      enddo<a name='9617'>
<a name='9618'>
      do jt = 1,19<a name='9619'>
         iprsm = 0<a name='9620'>
         do igc = 1,ngc(13)<a name='9621'>
            sumk = 0.<a name='9622'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='9623'>
               iprsm = iprsm + 1<a name='9624'>
               sumk = sumk + kbo_mo3(jt,iprsm)*rwgt(iprsm+192)<a name='9625'>
            enddo<a name='9626'>
            kb_mo3(jt,igc) = sumk<a name='9627'>
         enddo<a name='9628'>
      enddo<a name='9629'>
<a name='9630'>
      do jt = 1,10<a name='9631'>
         iprsm = 0<a name='9632'>
         do igc = 1,ngc(13)<a name='9633'>
            sumk = 0.<a name='9634'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='9635'>
               iprsm = iprsm + 1<a name='9636'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+192)<a name='9637'>
            enddo<a name='9638'>
            selfref(jt,igc) = sumk<a name='9639'>
         enddo<a name='9640'>
      enddo<a name='9641'>
<a name='9642'>
      do jt = 1,4<a name='9643'>
         iprsm = 0<a name='9644'>
         do igc = 1,ngc(13)<a name='9645'>
            sumk = 0.<a name='9646'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='9647'>
               iprsm = iprsm + 1<a name='9648'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+192)<a name='9649'>
            enddo<a name='9650'>
            forref(jt,igc) = sumk<a name='9651'>
         enddo<a name='9652'>
      enddo<a name='9653'>
<a name='9654'>
      iprsm = 0<a name='9655'>
      do igc = 1,ngc(13)<a name='9656'>
         sumf = 0.<a name='9657'>
         do ipr = 1, ngn(ngs(12)+igc)<a name='9658'>
            iprsm = iprsm + 1<a name='9659'>
            sumf = sumf + fracrefbo(iprsm)<a name='9660'>
         enddo<a name='9661'>
         fracrefb(igc) = sumf<a name='9662'>
      enddo<a name='9663'>
<a name='9664'>
      do jp = 1,9<a name='9665'>
         iprsm = 0<a name='9666'>
         do igc = 1,ngc(13)<a name='9667'>
            sumf = 0.<a name='9668'>
            do ipr = 1, ngn(ngs(12)+igc)<a name='9669'>
               iprsm = iprsm + 1<a name='9670'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9671'>
            enddo<a name='9672'>
            fracrefa(igc,jp) = sumf<a name='9673'>
         enddo<a name='9674'>
      enddo<a name='9675'>
<a name='9676'>
      end subroutine cmbgb13<a name='9677'>
<a name='9678'>
<font color=#447700>!***************************************************************************<a name='9679'></font>
<A NAME='CMBGB14'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9680'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb14</font> <A href='../../call_to/CMBGB14.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB14.html' TARGET='index'>4</A><a name='9681'>
<font color=#447700>!***************************************************************************<a name='9682'></font>
<font color=#447700>!<a name='9683'></font>
<font color=#447700>!     band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='9684'></font>
<font color=#447700>!<a name='9685'></font>
<font color=#447700>! old band 14:  2250-2380 cm-1 (low - co2; high - co2)<a name='9686'></font>
<font color=#447700>!***************************************************************************<a name='9687'></font>
<a name='9688'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_38">, only : mg, nbndlw, ngptlw, ng14<a name='9689'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG14'>rrlw_kg14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_2">, only: fracrefao, fracrefbo, kao, kbo, &amp;<a name='9690'>
                           selfrefo, forrefo, &amp;<a name='9691'>
                           fracrefa, fracrefb, absa, ka, absb, kb, &amp;<a name='9692'>
                           selfref, forref<a name='9693'>
<a name='9694'>
<font color=#447700>! ------- Local -------<a name='9695'></font>
      integer(kind=im) :: jt, jp, igc, ipr, iprsm <a name='9696'>
      real(kind=rb) :: sumk, sumf1, sumf2<a name='9697'>
<a name='9698'>
<a name='9699'>
      do jt = 1,5<a name='9700'>
         do jp = 1,13<a name='9701'>
            iprsm = 0<a name='9702'>
            do igc = 1,ngc(14)<a name='9703'>
               sumk = 0.<a name='9704'>
               do ipr = 1, ngn(ngs(13)+igc)<a name='9705'>
                  iprsm = iprsm + 1<a name='9706'>
                  sumk = sumk + kao(jt,jp,iprsm)*rwgt(iprsm+208)<a name='9707'>
               enddo<a name='9708'>
               ka(jt,jp,igc) = sumk<a name='9709'>
            enddo<a name='9710'>
         enddo<a name='9711'>
      enddo<a name='9712'>
<a name='9713'>
      do jt = 1,5<a name='9714'>
         do jp = 13,59<a name='9715'>
            iprsm = 0<a name='9716'>
            do igc = 1,ngc(14)<a name='9717'>
               sumk = 0.<a name='9718'>
               do ipr = 1, ngn(ngs(13)+igc)<a name='9719'>
                  iprsm = iprsm + 1<a name='9720'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+208)<a name='9721'>
               enddo<a name='9722'>
               kb(jt,jp,igc) = sumk<a name='9723'>
            enddo<a name='9724'>
         enddo<a name='9725'>
      enddo<a name='9726'>
<a name='9727'>
      do jt = 1,10<a name='9728'>
         iprsm = 0<a name='9729'>
         do igc = 1,ngc(14)<a name='9730'>
            sumk = 0.<a name='9731'>
            do ipr = 1, ngn(ngs(13)+igc)<a name='9732'>
               iprsm = iprsm + 1<a name='9733'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+208)<a name='9734'>
            enddo<a name='9735'>
            selfref(jt,igc) = sumk<a name='9736'>
         enddo<a name='9737'>
      enddo<a name='9738'>
<a name='9739'>
      do jt = 1,4<a name='9740'>
         iprsm = 0<a name='9741'>
         do igc = 1,ngc(14)<a name='9742'>
            sumk = 0.<a name='9743'>
            do ipr = 1, ngn(ngs(13)+igc)<a name='9744'>
               iprsm = iprsm + 1<a name='9745'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+208)<a name='9746'>
            enddo<a name='9747'>
            forref(jt,igc) = sumk<a name='9748'>
         enddo<a name='9749'>
      enddo<a name='9750'>
<a name='9751'>
      iprsm = 0<a name='9752'>
      do igc = 1,ngc(14)<a name='9753'>
         sumf1= 0.<a name='9754'>
         sumf2= 0.<a name='9755'>
         do ipr = 1, ngn(ngs(13)+igc)<a name='9756'>
            iprsm = iprsm + 1<a name='9757'>
            sumf1= sumf1+ fracrefao(iprsm)<a name='9758'>
            sumf2= sumf2+ fracrefbo(iprsm)<a name='9759'>
         enddo<a name='9760'>
         fracrefa(igc) = sumf1<a name='9761'>
         fracrefb(igc) = sumf2<a name='9762'>
      enddo<a name='9763'>
<a name='9764'>
      end subroutine cmbgb14<a name='9765'>
<a name='9766'>
<font color=#447700>!***************************************************************************<a name='9767'></font>
<A NAME='CMBGB15'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9768'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb15</font> <A href='../../call_to/CMBGB15.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB15.html' TARGET='index'>4</A><a name='9769'>
<font color=#447700>!***************************************************************************<a name='9770'></font>
<font color=#447700>!<a name='9771'></font>
<font color=#447700>!     band 15:  2380-2600 cm-1 (low - n2o,co2; low minor - n2)<a name='9772'></font>
<font color=#447700>!                              (high - nothing)<a name='9773'></font>
<font color=#447700>!<a name='9774'></font>
<font color=#447700>! old band 15:  2380-2600 cm-1 (low - n2o,co2; high - nothing)<a name='9775'></font>
<font color=#447700>!***************************************************************************<a name='9776'></font>
<a name='9777'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_39">, only : mg, nbndlw, ngptlw, ng15<a name='9778'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG15'>rrlw_kg15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_2">, only: fracrefao, kao, kao_mn2, selfrefo, forrefo, &amp;<a name='9779'>
                           fracrefa, absa, ka, ka_mn2, selfref, forref<a name='9780'>
<a name='9781'>
<font color=#447700>! ------- Local -------<a name='9782'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='9783'>
      real(kind=rb) :: sumk, sumf<a name='9784'>
<a name='9785'>
<a name='9786'>
      do jn = 1,9<a name='9787'>
         do jt = 1,5<a name='9788'>
            do jp = 1,13<a name='9789'>
               iprsm = 0<a name='9790'>
               do igc = 1,ngc(15)<a name='9791'>
                  sumk = 0.<a name='9792'>
                  do ipr = 1, ngn(ngs(14)+igc)<a name='9793'>
                     iprsm = iprsm + 1<a name='9794'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+224)<a name='9795'>
                  enddo<a name='9796'>
                  ka(jn,jt,jp,igc) = sumk<a name='9797'>
               enddo<a name='9798'>
            enddo<a name='9799'>
         enddo<a name='9800'>
      enddo<a name='9801'>
<a name='9802'>
      do jn = 1,9<a name='9803'>
         do jt = 1,19<a name='9804'>
            iprsm = 0<a name='9805'>
            do igc = 1,ngc(15)<a name='9806'>
              sumk = 0.<a name='9807'>
               do ipr = 1, ngn(ngs(14)+igc)<a name='9808'>
                  iprsm = iprsm + 1<a name='9809'>
                  sumk = sumk + kao_mn2(jn,jt,iprsm)*rwgt(iprsm+224)<a name='9810'>
               enddo<a name='9811'>
               ka_mn2(jn,jt,igc) = sumk<a name='9812'>
            enddo<a name='9813'>
         enddo<a name='9814'>
      enddo<a name='9815'>
<a name='9816'>
      do jt = 1,10<a name='9817'>
         iprsm = 0<a name='9818'>
         do igc = 1,ngc(15)<a name='9819'>
            sumk = 0.<a name='9820'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='9821'>
               iprsm = iprsm + 1<a name='9822'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+224)<a name='9823'>
            enddo<a name='9824'>
            selfref(jt,igc) = sumk<a name='9825'>
         enddo<a name='9826'>
      enddo<a name='9827'>
<a name='9828'>
      do jt = 1,4<a name='9829'>
         iprsm = 0<a name='9830'>
         do igc = 1,ngc(15)<a name='9831'>
            sumk = 0.<a name='9832'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='9833'>
               iprsm = iprsm + 1<a name='9834'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+224)<a name='9835'>
            enddo<a name='9836'>
            forref(jt,igc) = sumk<a name='9837'>
         enddo<a name='9838'>
      enddo<a name='9839'>
<a name='9840'>
      do jp = 1,9<a name='9841'>
         iprsm = 0<a name='9842'>
         do igc = 1,ngc(15)<a name='9843'>
            sumf = 0.<a name='9844'>
            do ipr = 1, ngn(ngs(14)+igc)<a name='9845'>
               iprsm = iprsm + 1<a name='9846'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9847'>
            enddo<a name='9848'>
            fracrefa(igc,jp) = sumf<a name='9849'>
         enddo<a name='9850'>
      enddo<a name='9851'>
<a name='9852'>
      end subroutine cmbgb15<a name='9853'>
<a name='9854'>
<font color=#447700>!***************************************************************************<a name='9855'></font>
<A NAME='CMBGB16'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CMBGB16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9856'>
      <font color=#993300>subroutine </font><font color=#cc0000>cmbgb16</font> <A href='../../call_to/CMBGB16.html' TARGET='index'>3</A>,<A href='../../call_from/CMBGB16.html' TARGET='index'>4</A><a name='9857'>
<font color=#447700>!***************************************************************************<a name='9858'></font>
<font color=#447700>!<a name='9859'></font>
<font color=#447700>!     band 16:  2600-3250 cm-1 (low key- h2o,ch4; high key - ch4)<a name='9860'></font>
<font color=#447700>!<a name='9861'></font>
<font color=#447700>! old band 16:  2600-3000 cm-1 (low - h2o,ch4; high - nothing)<a name='9862'></font>
<font color=#447700>!***************************************************************************<a name='9863'></font>
<a name='9864'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_40">, only : mg, nbndlw, ngptlw, ng16<a name='9865'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG16'>rrlw_kg16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#CMBGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_2">, only: fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo, &amp;<a name='9866'>
                           fracrefa, fracrefb, absa, ka, absb, kb, selfref, forref<a name='9867'>
<a name='9868'>
<font color=#447700>! ------- Local -------<a name='9869'></font>
      integer(kind=im) :: jn, jt, jp, igc, ipr, iprsm <a name='9870'>
      real(kind=rb) :: sumk, sumf<a name='9871'>
<a name='9872'>
<a name='9873'>
      do jn = 1,9<a name='9874'>
         do jt = 1,5<a name='9875'>
            do jp = 1,13<a name='9876'>
               iprsm = 0<a name='9877'>
               do igc = 1,ngc(16)<a name='9878'>
                  sumk = 0.<a name='9879'>
                  do ipr = 1, ngn(ngs(15)+igc)<a name='9880'>
                     iprsm = iprsm + 1<a name='9881'>
                     sumk = sumk + kao(jn,jt,jp,iprsm)*rwgt(iprsm+240)<a name='9882'>
                  enddo<a name='9883'>
                  ka(jn,jt,jp,igc) = sumk<a name='9884'>
               enddo<a name='9885'>
            enddo<a name='9886'>
         enddo<a name='9887'>
      enddo<a name='9888'>
<a name='9889'>
      do jt = 1,5<a name='9890'>
         do jp = 13,59<a name='9891'>
            iprsm = 0<a name='9892'>
            do igc = 1,ngc(16)<a name='9893'>
               sumk = 0.<a name='9894'>
               do ipr = 1, ngn(ngs(15)+igc)<a name='9895'>
                  iprsm = iprsm + 1<a name='9896'>
                  sumk = sumk + kbo(jt,jp,iprsm)*rwgt(iprsm+240)<a name='9897'>
               enddo<a name='9898'>
               kb(jt,jp,igc) = sumk<a name='9899'>
            enddo<a name='9900'>
         enddo<a name='9901'>
      enddo<a name='9902'>
<a name='9903'>
      do jt = 1,10<a name='9904'>
         iprsm = 0<a name='9905'>
         do igc = 1,ngc(16)<a name='9906'>
            sumk = 0.<a name='9907'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='9908'>
               iprsm = iprsm + 1<a name='9909'>
               sumk = sumk + selfrefo(jt,iprsm)*rwgt(iprsm+240)<a name='9910'>
            enddo<a name='9911'>
            selfref(jt,igc) = sumk<a name='9912'>
         enddo<a name='9913'>
      enddo<a name='9914'>
<a name='9915'>
      do jt = 1,4<a name='9916'>
         iprsm = 0<a name='9917'>
         do igc = 1,ngc(16)<a name='9918'>
            sumk = 0.<a name='9919'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='9920'>
               iprsm = iprsm + 1<a name='9921'>
               sumk = sumk + forrefo(jt,iprsm)*rwgt(iprsm+240)<a name='9922'>
            enddo<a name='9923'>
            forref(jt,igc) = sumk<a name='9924'>
         enddo<a name='9925'>
      enddo<a name='9926'>
<a name='9927'>
      iprsm = 0<a name='9928'>
      do igc = 1,ngc(16)<a name='9929'>
         sumf = 0.<a name='9930'>
         do ipr = 1, ngn(ngs(15)+igc)<a name='9931'>
            iprsm = iprsm + 1<a name='9932'>
            sumf = sumf + fracrefbo(iprsm)<a name='9933'>
         enddo<a name='9934'>
         fracrefb(igc) = sumf<a name='9935'>
      enddo<a name='9936'>
<a name='9937'>
      do jp = 1,9<a name='9938'>
         iprsm = 0<a name='9939'>
         do igc = 1,ngc(16)<a name='9940'>
            sumf = 0.<a name='9941'>
            do ipr = 1, ngn(ngs(15)+igc)<a name='9942'>
               iprsm = iprsm + 1<a name='9943'>
               sumf = sumf + fracrefao(iprsm,jp)<a name='9944'>
            enddo<a name='9945'>
            fracrefa(igc,jp) = sumf<a name='9946'>
         enddo<a name='9947'>
      enddo<a name='9948'>
<a name='9949'>
      end subroutine cmbgb16<a name='9950'>
<a name='9951'>
<font color=#447700>!***************************************************************************<a name='9952'></font>
<A NAME='LWCLDPR'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LWCLDPR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='9953'>
      <font color=#993300>subroutine </font><font color=#cc0000>lwcldpr</font> <A href='../../call_to/LWCLDPR.html' TARGET='index'>2</A>,<A href='../../call_from/LWCLDPR.html' TARGET='index'>2</A><a name='9954'>
<font color=#447700>!***************************************************************************<a name='9955'></font>
<a name='9956'>
<font color=#447700>! --------- Modules ----------<a name='9957'></font>
<a name='9958'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CLD'>rrlw_cld</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LWCLDPR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CLD_2">, only: abscld1, absliq0, absliq1, &amp;<a name='9959'>
                          absice0, absice1, absice2, absice3<a name='9960'>
<a name='9961'>
      save<a name='9962'>
<a name='9963'>
<font color=#447700>! ABSCLDn is the liquid water absorption coefficient (m2/g). <a name='9964'></font>
<font color=#447700>! For INFLAG = 1.<a name='9965'></font>
      abscld1 = 0.0602410_rb<a name='9966'>
<font color=#447700>!  <a name='9967'></font>
<font color=#447700>! Everything below is for INFLAG = 2.<a name='9968'></font>
<a name='9969'>
<font color=#447700>! ABSICEn(J,IB) are the parameters needed to compute the liquid water <a name='9970'></font>
<font color=#447700>! absorption coefficient in spectral region IB for ICEFLAG=n.  The units<a name='9971'></font>
<font color=#447700>! of ABSICEn(1,IB) are m2/g and ABSICEn(2,IB) has units (microns (m2/g)).<a name='9972'></font>
<font color=#447700>! For ICEFLAG = 0.<a name='9973'></font>
<a name='9974'>
      absice0(:)= (/0.005_rb,  1.0_rb/)<a name='9975'>
<a name='9976'>
<font color=#447700>! For ICEFLAG = 1.<a name='9977'></font>
      absice1(1,:) = (/0.0036_rb, 0.0068_rb, 0.0003_rb, 0.0016_rb, 0.0020_rb/)<a name='9978'>
      absice1(2,:) = (/1.136_rb , 0.600_rb , 1.338_rb , 1.166_rb , 1.118_rb /)<a name='9979'>
<a name='9980'>
<font color=#447700>! For ICEFLAG = 2.  In each band, the absorption<a name='9981'></font>
<font color=#447700>! coefficients are listed for a range of effective radii from 5.0<a name='9982'></font>
<font color=#447700>! to 131.0 microns in increments of 3.0 microns.<a name='9983'></font>
<font color=#447700>! Spherical Ice Particle Parameterization<a name='9984'></font>
<font color=#447700>! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]<a name='9985'></font>
      absice2(:,1) = (/ &amp;<a name='9986'>
<font color=#447700>! band 1<a name='9987'></font>
       7.798999e-02_rb,6.340479e-02_rb,5.417973e-02_rb,4.766245e-02_rb,4.272663e-02_rb, &amp;<a name='9988'>
       3.880939e-02_rb,3.559544e-02_rb,3.289241e-02_rb,3.057511e-02_rb,2.855800e-02_rb, &amp;<a name='9989'>
       2.678022e-02_rb,2.519712e-02_rb,2.377505e-02_rb,2.248806e-02_rb,2.131578e-02_rb, &amp;<a name='9990'>
       2.024194e-02_rb,1.925337e-02_rb,1.833926e-02_rb,1.749067e-02_rb,1.670007e-02_rb, &amp;<a name='9991'>
       1.596113e-02_rb,1.526845e-02_rb,1.461739e-02_rb,1.400394e-02_rb,1.342462e-02_rb, &amp;<a name='9992'>
       1.287639e-02_rb,1.235656e-02_rb,1.186279e-02_rb,1.139297e-02_rb,1.094524e-02_rb, &amp;<a name='9993'>
       1.051794e-02_rb,1.010956e-02_rb,9.718755e-03_rb,9.344316e-03_rb,8.985139e-03_rb, &amp;<a name='9994'>
       8.640223e-03_rb,8.308656e-03_rb,7.989606e-03_rb,7.682312e-03_rb,7.386076e-03_rb, &amp;<a name='9995'>
       7.100255e-03_rb,6.824258e-03_rb,6.557540e-03_rb/)<a name='9996'>
      absice2(:,2) = (/ &amp;<a name='9997'>
<font color=#447700>! band 2<a name='9998'></font>
       2.784879e-02_rb,2.709863e-02_rb,2.619165e-02_rb,2.529230e-02_rb,2.443225e-02_rb, &amp;<a name='9999'>
       2.361575e-02_rb,2.284021e-02_rb,2.210150e-02_rb,2.139548e-02_rb,2.071840e-02_rb, &amp;<a name='10000'>
       2.006702e-02_rb,1.943856e-02_rb,1.883064e-02_rb,1.824120e-02_rb,1.766849e-02_rb, &amp;<a name='10001'>
       1.711099e-02_rb,1.656737e-02_rb,1.603647e-02_rb,1.551727e-02_rb,1.500886e-02_rb, &amp;<a name='10002'>
       1.451045e-02_rb,1.402132e-02_rb,1.354084e-02_rb,1.306842e-02_rb,1.260355e-02_rb, &amp;<a name='10003'>
       1.214575e-02_rb,1.169460e-02_rb,1.124971e-02_rb,1.081072e-02_rb,1.037731e-02_rb, &amp;<a name='10004'>
       9.949167e-03_rb,9.526021e-03_rb,9.107615e-03_rb,8.693714e-03_rb,8.284096e-03_rb, &amp;<a name='10005'>
       7.878558e-03_rb,7.476910e-03_rb,7.078974e-03_rb,6.684586e-03_rb,6.293589e-03_rb, &amp;<a name='10006'>
       5.905839e-03_rb,5.521200e-03_rb,5.139543e-03_rb/)<a name='10007'>
      absice2(:,3) = (/ &amp;<a name='10008'>
<font color=#447700>! band 3<a name='10009'></font>
       1.065397e-01_rb,8.005726e-02_rb,6.546428e-02_rb,5.589131e-02_rb,4.898681e-02_rb, &amp;<a name='10010'>
       4.369932e-02_rb,3.947901e-02_rb,3.600676e-02_rb,3.308299e-02_rb,3.057561e-02_rb, &amp;<a name='10011'>
       2.839325e-02_rb,2.647040e-02_rb,2.475872e-02_rb,2.322164e-02_rb,2.183091e-02_rb, &amp;<a name='10012'>
       2.056430e-02_rb,1.940407e-02_rb,1.833586e-02_rb,1.734787e-02_rb,1.643034e-02_rb, &amp;<a name='10013'>
       1.557512e-02_rb,1.477530e-02_rb,1.402501e-02_rb,1.331924e-02_rb,1.265364e-02_rb, &amp;<a name='10014'>
       1.202445e-02_rb,1.142838e-02_rb,1.086257e-02_rb,1.032445e-02_rb,9.811791e-03_rb, &amp;<a name='10015'>
       9.322587e-03_rb,8.855053e-03_rb,8.407591e-03_rb,7.978763e-03_rb,7.567273e-03_rb, &amp;<a name='10016'>
       7.171949e-03_rb,6.791728e-03_rb,6.425642e-03_rb,6.072809e-03_rb,5.732424e-03_rb, &amp;<a name='10017'>
       5.403748e-03_rb,5.086103e-03_rb,4.778865e-03_rb/)<a name='10018'>
      absice2(:,4) = (/ &amp;<a name='10019'>
<font color=#447700>! band 4<a name='10020'></font>
       1.804566e-01_rb,1.168987e-01_rb,8.680442e-02_rb,6.910060e-02_rb,5.738174e-02_rb, &amp;<a name='10021'>
       4.902332e-02_rb,4.274585e-02_rb,3.784923e-02_rb,3.391734e-02_rb,3.068690e-02_rb, &amp;<a name='10022'>
       2.798301e-02_rb,2.568480e-02_rb,2.370600e-02_rb,2.198337e-02_rb,2.046940e-02_rb, &amp;<a name='10023'>
       1.912777e-02_rb,1.793016e-02_rb,1.685420e-02_rb,1.588193e-02_rb,1.499882e-02_rb, &amp;<a name='10024'>
       1.419293e-02_rb,1.345440e-02_rb,1.277496e-02_rb,1.214769e-02_rb,1.156669e-02_rb, &amp;<a name='10025'>
       1.102694e-02_rb,1.052412e-02_rb,1.005451e-02_rb,9.614854e-03_rb,9.202335e-03_rb, &amp;<a name='10026'>
       8.814470e-03_rb,8.449077e-03_rb,8.104223e-03_rb,7.778195e-03_rb,7.469466e-03_rb, &amp;<a name='10027'>
       7.176671e-03_rb,6.898588e-03_rb,6.634117e-03_rb,6.382264e-03_rb,6.142134e-03_rb, &amp;<a name='10028'>
       5.912913e-03_rb,5.693862e-03_rb,5.484308e-03_rb/)<a name='10029'>
      absice2(:,5) = (/ &amp;<a name='10030'>
<font color=#447700>! band 5<a name='10031'></font>
       2.131806e-01_rb,1.311372e-01_rb,9.407171e-02_rb,7.299442e-02_rb,5.941273e-02_rb, &amp;<a name='10032'>
       4.994043e-02_rb,4.296242e-02_rb,3.761113e-02_rb,3.337910e-02_rb,2.994978e-02_rb, &amp;<a name='10033'>
       2.711556e-02_rb,2.473461e-02_rb,2.270681e-02_rb,2.095943e-02_rb,1.943839e-02_rb, &amp;<a name='10034'>
       1.810267e-02_rb,1.692057e-02_rb,1.586719e-02_rb,1.492275e-02_rb,1.407132e-02_rb, &amp;<a name='10035'>
       1.329989e-02_rb,1.259780e-02_rb,1.195618e-02_rb,1.136761e-02_rb,1.082583e-02_rb, &amp;<a name='10036'>
       1.032552e-02_rb,9.862158e-03_rb,9.431827e-03_rb,9.031157e-03_rb,8.657217e-03_rb, &amp;<a name='10037'>
       8.307449e-03_rb,7.979609e-03_rb,7.671724e-03_rb,7.382048e-03_rb,7.109032e-03_rb, &amp;<a name='10038'>
       6.851298e-03_rb,6.607615e-03_rb,6.376881e-03_rb,6.158105e-03_rb,5.950394e-03_rb, &amp;<a name='10039'>
       5.752942e-03_rb,5.565019e-03_rb,5.385963e-03_rb/)<a name='10040'>
      absice2(:,6) = (/ &amp;<a name='10041'>
<font color=#447700>! band 6<a name='10042'></font>
       1.546177e-01_rb,1.039251e-01_rb,7.910347e-02_rb,6.412429e-02_rb,5.399997e-02_rb, &amp;<a name='10043'>
       4.664937e-02_rb,4.104237e-02_rb,3.660781e-02_rb,3.300218e-02_rb,3.000586e-02_rb, &amp;<a name='10044'>
       2.747148e-02_rb,2.529633e-02_rb,2.340647e-02_rb,2.174723e-02_rb,2.027731e-02_rb, &amp;<a name='10045'>
       1.896487e-02_rb,1.778492e-02_rb,1.671761e-02_rb,1.574692e-02_rb,1.485978e-02_rb, &amp;<a name='10046'>
       1.404543e-02_rb,1.329489e-02_rb,1.260066e-02_rb,1.195636e-02_rb,1.135657e-02_rb, &amp;<a name='10047'>
       1.079664e-02_rb,1.027257e-02_rb,9.780871e-03_rb,9.318505e-03_rb,8.882815e-03_rb, &amp;<a name='10048'>
       8.471458e-03_rb,8.082364e-03_rb,7.713696e-03_rb,7.363817e-03_rb,7.031264e-03_rb, &amp;<a name='10049'>
       6.714725e-03_rb,6.413021e-03_rb,6.125086e-03_rb,5.849958e-03_rb,5.586764e-03_rb, &amp;<a name='10050'>
       5.334707e-03_rb,5.093066e-03_rb,4.861179e-03_rb/)<a name='10051'>
      absice2(:,7) = (/ &amp;<a name='10052'>
<font color=#447700>! band 7<a name='10053'></font>
       7.583404e-02_rb,6.181558e-02_rb,5.312027e-02_rb,4.696039e-02_rb,4.225986e-02_rb, &amp;<a name='10054'>
       3.849735e-02_rb,3.538340e-02_rb,3.274182e-02_rb,3.045798e-02_rb,2.845343e-02_rb, &amp;<a name='10055'>
       2.667231e-02_rb,2.507353e-02_rb,2.362606e-02_rb,2.230595e-02_rb,2.109435e-02_rb, &amp;<a name='10056'>
       1.997617e-02_rb,1.893916e-02_rb,1.797328e-02_rb,1.707016e-02_rb,1.622279e-02_rb, &amp;<a name='10057'>
       1.542523e-02_rb,1.467241e-02_rb,1.395997e-02_rb,1.328414e-02_rb,1.264164e-02_rb, &amp;<a name='10058'>
       1.202958e-02_rb,1.144544e-02_rb,1.088697e-02_rb,1.035218e-02_rb,9.839297e-03_rb, &amp;<a name='10059'>
       9.346733e-03_rb,8.873057e-03_rb,8.416980e-03_rb,7.977335e-03_rb,7.553066e-03_rb, &amp;<a name='10060'>
       7.143210e-03_rb,6.746888e-03_rb,6.363297e-03_rb,5.991700e-03_rb,5.631422e-03_rb, &amp;<a name='10061'>
       5.281840e-03_rb,4.942378e-03_rb,4.612505e-03_rb/)<a name='10062'>
      absice2(:,8) = (/ &amp;<a name='10063'>
<font color=#447700>! band 8<a name='10064'></font>
       9.022185e-02_rb,6.922700e-02_rb,5.710674e-02_rb,4.898377e-02_rb,4.305946e-02_rb, &amp;<a name='10065'>
       3.849553e-02_rb,3.484183e-02_rb,3.183220e-02_rb,2.929794e-02_rb,2.712627e-02_rb, &amp;<a name='10066'>
       2.523856e-02_rb,2.357810e-02_rb,2.210286e-02_rb,2.078089e-02_rb,1.958747e-02_rb, &amp;<a name='10067'>
       1.850310e-02_rb,1.751218e-02_rb,1.660205e-02_rb,1.576232e-02_rb,1.498440e-02_rb, &amp;<a name='10068'>
       1.426107e-02_rb,1.358624e-02_rb,1.295474e-02_rb,1.236212e-02_rb,1.180456e-02_rb, &amp;<a name='10069'>
       1.127874e-02_rb,1.078175e-02_rb,1.031106e-02_rb,9.864433e-03_rb,9.439878e-03_rb, &amp;<a name='10070'>
       9.035637e-03_rb,8.650140e-03_rb,8.281981e-03_rb,7.929895e-03_rb,7.592746e-03_rb, &amp;<a name='10071'>
       7.269505e-03_rb,6.959238e-03_rb,6.661100e-03_rb,6.374317e-03_rb,6.098185e-03_rb, &amp;<a name='10072'>
       5.832059e-03_rb,5.575347e-03_rb,5.327504e-03_rb/)<a name='10073'>
      absice2(:,9) = (/ &amp;<a name='10074'>
<font color=#447700>! band 9<a name='10075'></font>
       1.294087e-01_rb,8.788217e-02_rb,6.728288e-02_rb,5.479720e-02_rb,4.635049e-02_rb, &amp;<a name='10076'>
       4.022253e-02_rb,3.555576e-02_rb,3.187259e-02_rb,2.888498e-02_rb,2.640843e-02_rb, &amp;<a name='10077'>
       2.431904e-02_rb,2.253038e-02_rb,2.098024e-02_rb,1.962267e-02_rb,1.842293e-02_rb, &amp;<a name='10078'>
       1.735426e-02_rb,1.639571e-02_rb,1.553060e-02_rb,1.474552e-02_rb,1.402953e-02_rb, &amp;<a name='10079'>
       1.337363e-02_rb,1.277033e-02_rb,1.221336e-02_rb,1.169741e-02_rb,1.121797e-02_rb, &amp;<a name='10080'>
       1.077117e-02_rb,1.035369e-02_rb,9.962643e-03_rb,9.595509e-03_rb,9.250088e-03_rb, &amp;<a name='10081'>
       8.924447e-03_rb,8.616876e-03_rb,8.325862e-03_rb,8.050057e-03_rb,7.788258e-03_rb, &amp;<a name='10082'>
       7.539388e-03_rb,7.302478e-03_rb,7.076656e-03_rb,6.861134e-03_rb,6.655197e-03_rb, &amp;<a name='10083'>
       6.458197e-03_rb,6.269543e-03_rb,6.088697e-03_rb/)<a name='10084'>
      absice2(:,10) = (/ &amp;<a name='10085'>
<font color=#447700>! band 10<a name='10086'></font>
       1.593628e-01_rb,1.014552e-01_rb,7.458955e-02_rb,5.903571e-02_rb,4.887582e-02_rb, &amp;<a name='10087'>
       4.171159e-02_rb,3.638480e-02_rb,3.226692e-02_rb,2.898717e-02_rb,2.631256e-02_rb, &amp;<a name='10088'>
       2.408925e-02_rb,2.221156e-02_rb,2.060448e-02_rb,1.921325e-02_rb,1.799699e-02_rb, &amp;<a name='10089'>
       1.692456e-02_rb,1.597177e-02_rb,1.511961e-02_rb,1.435289e-02_rb,1.365933e-02_rb, &amp;<a name='10090'>
       1.302890e-02_rb,1.245334e-02_rb,1.192576e-02_rb,1.144037e-02_rb,1.099230e-02_rb, &amp;<a name='10091'>
       1.057739e-02_rb,1.019208e-02_rb,9.833302e-03_rb,9.498395e-03_rb,9.185047e-03_rb, &amp;<a name='10092'>
       8.891237e-03_rb,8.615185e-03_rb,8.355325e-03_rb,8.110267e-03_rb,7.878778e-03_rb, &amp;<a name='10093'>
       7.659759e-03_rb,7.452224e-03_rb,7.255291e-03_rb,7.068166e-03_rb,6.890130e-03_rb, &amp;<a name='10094'>
       6.720536e-03_rb,6.558794e-03_rb,6.404371e-03_rb/)<a name='10095'>
      absice2(:,11) = (/ &amp;<a name='10096'>
<font color=#447700>! band 11<a name='10097'></font>
       1.656227e-01_rb,1.032129e-01_rb,7.487359e-02_rb,5.871431e-02_rb,4.828355e-02_rb, &amp;<a name='10098'>
       4.099989e-02_rb,3.562924e-02_rb,3.150755e-02_rb,2.824593e-02_rb,2.560156e-02_rb, &amp;<a name='10099'>
       2.341503e-02_rb,2.157740e-02_rb,2.001169e-02_rb,1.866199e-02_rb,1.748669e-02_rb, &amp;<a name='10100'>
       1.645421e-02_rb,1.554015e-02_rb,1.472535e-02_rb,1.399457e-02_rb,1.333553e-02_rb, &amp;<a name='10101'>
       1.273821e-02_rb,1.219440e-02_rb,1.169725e-02_rb,1.124104e-02_rb,1.082096e-02_rb, &amp;<a name='10102'>
       1.043290e-02_rb,1.007336e-02_rb,9.739338e-03_rb,9.428223e-03_rb,9.137756e-03_rb, &amp;<a name='10103'>
       8.865964e-03_rb,8.611115e-03_rb,8.371686e-03_rb,8.146330e-03_rb,7.933852e-03_rb, &amp;<a name='10104'>
       7.733187e-03_rb,7.543386e-03_rb,7.363597e-03_rb,7.193056e-03_rb,7.031072e-03_rb, &amp;<a name='10105'>
       6.877024e-03_rb,6.730348e-03_rb,6.590531e-03_rb/)<a name='10106'>
      absice2(:,12) = (/ &amp;<a name='10107'>
<font color=#447700>! band 12<a name='10108'></font>
       9.194591e-02_rb,6.446867e-02_rb,4.962034e-02_rb,4.042061e-02_rb,3.418456e-02_rb, &amp;<a name='10109'>
       2.968856e-02_rb,2.629900e-02_rb,2.365572e-02_rb,2.153915e-02_rb,1.980791e-02_rb, &amp;<a name='10110'>
       1.836689e-02_rb,1.714979e-02_rb,1.610900e-02_rb,1.520946e-02_rb,1.442476e-02_rb, &amp;<a name='10111'>
       1.373468e-02_rb,1.312345e-02_rb,1.257858e-02_rb,1.209010e-02_rb,1.164990e-02_rb, &amp;<a name='10112'>
       1.125136e-02_rb,1.088901e-02_rb,1.055827e-02_rb,1.025531e-02_rb,9.976896e-03_rb, &amp;<a name='10113'>
       9.720255e-03_rb,9.483022e-03_rb,9.263160e-03_rb,9.058902e-03_rb,8.868710e-03_rb, &amp;<a name='10114'>
       8.691240e-03_rb,8.525312e-03_rb,8.369886e-03_rb,8.224042e-03_rb,8.086961e-03_rb, &amp;<a name='10115'>
       7.957917e-03_rb,7.836258e-03_rb,7.721400e-03_rb,7.612821e-03_rb,7.510045e-03_rb, &amp;<a name='10116'>
       7.412648e-03_rb,7.320242e-03_rb,7.232476e-03_rb/)<a name='10117'>
      absice2(:,13) = (/ &amp;<a name='10118'>
<font color=#447700>! band 13<a name='10119'></font>
       1.437021e-01_rb,8.872535e-02_rb,6.392420e-02_rb,4.991833e-02_rb,4.096790e-02_rb, &amp;<a name='10120'>
       3.477881e-02_rb,3.025782e-02_rb,2.681909e-02_rb,2.412102e-02_rb,2.195132e-02_rb, &amp;<a name='10121'>
       2.017124e-02_rb,1.868641e-02_rb,1.743044e-02_rb,1.635529e-02_rb,1.542540e-02_rb, &amp;<a name='10122'>
       1.461388e-02_rb,1.390003e-02_rb,1.326766e-02_rb,1.270395e-02_rb,1.219860e-02_rb, &amp;<a name='10123'>
       1.174326e-02_rb,1.133107e-02_rb,1.095637e-02_rb,1.061442e-02_rb,1.030126e-02_rb, &amp;<a name='10124'>
       1.001352e-02_rb,9.748340e-03_rb,9.503256e-03_rb,9.276155e-03_rb,9.065205e-03_rb, &amp;<a name='10125'>
       8.868808e-03_rb,8.685571e-03_rb,8.514268e-03_rb,8.353820e-03_rb,8.203272e-03_rb, &amp;<a name='10126'>
       8.061776e-03_rb,7.928578e-03_rb,7.803001e-03_rb,7.684443e-03_rb,7.572358e-03_rb, &amp;<a name='10127'>
       7.466258e-03_rb,7.365701e-03_rb,7.270286e-03_rb/)<a name='10128'>
      absice2(:,14) = (/ &amp;<a name='10129'>
<font color=#447700>! band 14<a name='10130'></font>
       1.288870e-01_rb,8.160295e-02_rb,5.964745e-02_rb,4.703790e-02_rb,3.888637e-02_rb, &amp;<a name='10131'>
       3.320115e-02_rb,2.902017e-02_rb,2.582259e-02_rb,2.330224e-02_rb,2.126754e-02_rb, &amp;<a name='10132'>
       1.959258e-02_rb,1.819130e-02_rb,1.700289e-02_rb,1.598320e-02_rb,1.509942e-02_rb, &amp;<a name='10133'>
       1.432666e-02_rb,1.364572e-02_rb,1.304156e-02_rb,1.250220e-02_rb,1.201803e-02_rb, &amp;<a name='10134'>
       1.158123e-02_rb,1.118537e-02_rb,1.082513e-02_rb,1.049605e-02_rb,1.019440e-02_rb, &amp;<a name='10135'>
       9.916989e-03_rb,9.661116e-03_rb,9.424457e-03_rb,9.205005e-03_rb,9.001022e-03_rb, &amp;<a name='10136'>
       8.810992e-03_rb,8.633588e-03_rb,8.467646e-03_rb,8.312137e-03_rb,8.166151e-03_rb, &amp;<a name='10137'>
       8.028878e-03_rb,7.899597e-03_rb,7.777663e-03_rb,7.662498e-03_rb,7.553581e-03_rb, &amp;<a name='10138'>
       7.450444e-03_rb,7.352662e-03_rb,7.259851e-03_rb/)<a name='10139'>
      absice2(:,15) = (/ &amp;<a name='10140'>
<font color=#447700>! band 15<a name='10141'></font>
       8.254229e-02_rb,5.808787e-02_rb,4.492166e-02_rb,3.675028e-02_rb,3.119623e-02_rb, &amp;<a name='10142'>
       2.718045e-02_rb,2.414450e-02_rb,2.177073e-02_rb,1.986526e-02_rb,1.830306e-02_rb, &amp;<a name='10143'>
       1.699991e-02_rb,1.589698e-02_rb,1.495199e-02_rb,1.413374e-02_rb,1.341870e-02_rb, &amp;<a name='10144'>
       1.278883e-02_rb,1.223002e-02_rb,1.173114e-02_rb,1.128322e-02_rb,1.087900e-02_rb, &amp;<a name='10145'>
       1.051254e-02_rb,1.017890e-02_rb,9.873991e-03_rb,9.594347e-03_rb,9.337044e-03_rb, &amp;<a name='10146'>
       9.099589e-03_rb,8.879842e-03_rb,8.675960e-03_rb,8.486341e-03_rb,8.309594e-03_rb, &amp;<a name='10147'>
       8.144500e-03_rb,7.989986e-03_rb,7.845109e-03_rb,7.709031e-03_rb,7.581007e-03_rb, &amp;<a name='10148'>
       7.460376e-03_rb,7.346544e-03_rb,7.238978e-03_rb,7.137201e-03_rb,7.040780e-03_rb, &amp;<a name='10149'>
       6.949325e-03_rb,6.862483e-03_rb,6.779931e-03_rb/)<a name='10150'>
      absice2(:,16) = (/ &amp;<a name='10151'>
<font color=#447700>! band 16<a name='10152'></font>
       1.382062e-01_rb,8.643227e-02_rb,6.282935e-02_rb,4.934783e-02_rb,4.063891e-02_rb, &amp;<a name='10153'>
       3.455591e-02_rb,3.007059e-02_rb,2.662897e-02_rb,2.390631e-02_rb,2.169972e-02_rb, &amp;<a name='10154'>
       1.987596e-02_rb,1.834393e-02_rb,1.703924e-02_rb,1.591513e-02_rb,1.493679e-02_rb, &amp;<a name='10155'>
       1.407780e-02_rb,1.331775e-02_rb,1.264061e-02_rb,1.203364e-02_rb,1.148655e-02_rb, &amp;<a name='10156'>
       1.099099e-02_rb,1.054006e-02_rb,1.012807e-02_rb,9.750215e-03_rb,9.402477e-03_rb, &amp;<a name='10157'>
       9.081428e-03_rb,8.784143e-03_rb,8.508107e-03_rb,8.251146e-03_rb,8.011373e-03_rb, &amp;<a name='10158'>
       7.787140e-03_rb,7.577002e-03_rb,7.379687e-03_rb,7.194071e-03_rb,7.019158e-03_rb, &amp;<a name='10159'>
       6.854061e-03_rb,6.697986e-03_rb,6.550224e-03_rb,6.410138e-03_rb,6.277153e-03_rb, &amp;<a name='10160'>
       6.150751e-03_rb,6.030462e-03_rb,5.915860e-03_rb/)<a name='10161'>
<a name='10162'>
<font color=#447700>! ICEFLAG = 3; Fu parameterization. Particle size 5 - 140 micron in <a name='10163'></font>
<font color=#447700>! increments of 3 microns.<a name='10164'></font>
<font color=#447700>! units = m2/g<a name='10165'></font>
<font color=#447700>! Hexagonal Ice Particle Parameterization<a name='10166'></font>
<font color=#447700>! absorption units (abs coef/iwc): [(m^-1)/(g m^-3)]<a name='10167'></font>
      absice3(:,1) = (/ &amp;<a name='10168'>
<font color=#447700>! band 1<a name='10169'></font>
       3.110649e-03_rb,4.666352e-02_rb,6.606447e-02_rb,6.531678e-02_rb,6.012598e-02_rb, &amp;<a name='10170'>
       5.437494e-02_rb,4.906411e-02_rb,4.441146e-02_rb,4.040585e-02_rb,3.697334e-02_rb, &amp;<a name='10171'>
       3.403027e-02_rb,3.149979e-02_rb,2.931596e-02_rb,2.742365e-02_rb,2.577721e-02_rb, &amp;<a name='10172'>
       2.433888e-02_rb,2.307732e-02_rb,2.196644e-02_rb,2.098437e-02_rb,2.011264e-02_rb, &amp;<a name='10173'>
       1.933561e-02_rb,1.863992e-02_rb,1.801407e-02_rb,1.744812e-02_rb,1.693346e-02_rb, &amp;<a name='10174'>
       1.646252e-02_rb,1.602866e-02_rb,1.562600e-02_rb,1.524933e-02_rb,1.489399e-02_rb, &amp;<a name='10175'>
       1.455580e-02_rb,1.423098e-02_rb,1.391612e-02_rb,1.360812e-02_rb,1.330413e-02_rb, &amp;<a name='10176'>
       1.300156e-02_rb,1.269801e-02_rb,1.239127e-02_rb,1.207928e-02_rb,1.176014e-02_rb, &amp;<a name='10177'>
       1.143204e-02_rb,1.109334e-02_rb,1.074243e-02_rb,1.037786e-02_rb,9.998198e-03_rb, &amp;<a name='10178'>
       9.602126e-03_rb/)<a name='10179'>
      absice3(:,2) = (/ &amp;<a name='10180'>
<font color=#447700>! band 2<a name='10181'></font>
       3.984966e-04_rb,1.681097e-02_rb,2.627680e-02_rb,2.767465e-02_rb,2.700722e-02_rb, &amp;<a name='10182'>
       2.579180e-02_rb,2.448677e-02_rb,2.323890e-02_rb,2.209096e-02_rb,2.104882e-02_rb, &amp;<a name='10183'>
       2.010547e-02_rb,1.925003e-02_rb,1.847128e-02_rb,1.775883e-02_rb,1.710358e-02_rb, &amp;<a name='10184'>
       1.649769e-02_rb,1.593449e-02_rb,1.540829e-02_rb,1.491429e-02_rb,1.444837e-02_rb, &amp;<a name='10185'>
       1.400704e-02_rb,1.358729e-02_rb,1.318654e-02_rb,1.280258e-02_rb,1.243346e-02_rb, &amp;<a name='10186'>
       1.207750e-02_rb,1.173325e-02_rb,1.139941e-02_rb,1.107487e-02_rb,1.075861e-02_rb, &amp;<a name='10187'>
       1.044975e-02_rb,1.014753e-02_rb,9.851229e-03_rb,9.560240e-03_rb,9.274003e-03_rb, &amp;<a name='10188'>
       8.992020e-03_rb,8.713845e-03_rb,8.439074e-03_rb,8.167346e-03_rb,7.898331e-03_rb, &amp;<a name='10189'>
       7.631734e-03_rb,7.367286e-03_rb,7.104742e-03_rb,6.843882e-03_rb,6.584504e-03_rb, &amp;<a name='10190'>
       6.326424e-03_rb/)<a name='10191'>
      absice3(:,3) = (/ &amp;<a name='10192'>
<font color=#447700>! band 3<a name='10193'></font>
       6.933163e-02_rb,8.540475e-02_rb,7.701816e-02_rb,6.771158e-02_rb,5.986953e-02_rb, &amp;<a name='10194'>
       5.348120e-02_rb,4.824962e-02_rb,4.390563e-02_rb,4.024411e-02_rb,3.711404e-02_rb, &amp;<a name='10195'>
       3.440426e-02_rb,3.203200e-02_rb,2.993478e-02_rb,2.806474e-02_rb,2.638464e-02_rb, &amp;<a name='10196'>
       2.486516e-02_rb,2.348288e-02_rb,2.221890e-02_rb,2.105780e-02_rb,1.998687e-02_rb, &amp;<a name='10197'>
       1.899552e-02_rb,1.807490e-02_rb,1.721750e-02_rb,1.641693e-02_rb,1.566773e-02_rb, &amp;<a name='10198'>
       1.496515e-02_rb,1.430509e-02_rb,1.368398e-02_rb,1.309865e-02_rb,1.254634e-02_rb, &amp;<a name='10199'>
       1.202456e-02_rb,1.153114e-02_rb,1.106409e-02_rb,1.062166e-02_rb,1.020224e-02_rb, &amp;<a name='10200'>
       9.804381e-03_rb,9.426771e-03_rb,9.068205e-03_rb,8.727578e-03_rb,8.403876e-03_rb, &amp;<a name='10201'>
       8.096160e-03_rb,7.803564e-03_rb,7.525281e-03_rb,7.260560e-03_rb,7.008697e-03_rb, &amp;<a name='10202'>
       6.769036e-03_rb/)<a name='10203'>
      absice3(:,4) = (/ &amp;<a name='10204'>
<font color=#447700>! band 4<a name='10205'></font>
       1.765735e-01_rb,1.382700e-01_rb,1.095129e-01_rb,8.987475e-02_rb,7.591185e-02_rb, &amp;<a name='10206'>
       6.554169e-02_rb,5.755500e-02_rb,5.122083e-02_rb,4.607610e-02_rb,4.181475e-02_rb, &amp;<a name='10207'>
       3.822697e-02_rb,3.516432e-02_rb,3.251897e-02_rb,3.021073e-02_rb,2.817876e-02_rb, &amp;<a name='10208'>
       2.637607e-02_rb,2.476582e-02_rb,2.331871e-02_rb,2.201113e-02_rb,2.082388e-02_rb, &amp;<a name='10209'>
       1.974115e-02_rb,1.874983e-02_rb,1.783894e-02_rb,1.699922e-02_rb,1.622280e-02_rb, &amp;<a name='10210'>
       1.550296e-02_rb,1.483390e-02_rb,1.421064e-02_rb,1.362880e-02_rb,1.308460e-02_rb, &amp;<a name='10211'>
       1.257468e-02_rb,1.209611e-02_rb,1.164628e-02_rb,1.122287e-02_rb,1.082381e-02_rb, &amp;<a name='10212'>
       1.044725e-02_rb,1.009154e-02_rb,9.755166e-03_rb,9.436783e-03_rb,9.135163e-03_rb, &amp;<a name='10213'>
       8.849193e-03_rb,8.577856e-03_rb,8.320225e-03_rb,8.075451e-03_rb,7.842755e-03_rb, &amp;<a name='10214'>
       7.621418e-03_rb/)<a name='10215'>
      absice3(:,5) = (/ &amp;<a name='10216'>
<font color=#447700>! band 5<a name='10217'></font>
       2.339673e-01_rb,1.692124e-01_rb,1.291656e-01_rb,1.033837e-01_rb,8.562949e-02_rb, &amp;<a name='10218'>
       7.273526e-02_rb,6.298262e-02_rb,5.537015e-02_rb,4.927787e-02_rb,4.430246e-02_rb, &amp;<a name='10219'>
       4.017061e-02_rb,3.669072e-02_rb,3.372455e-02_rb,3.116995e-02_rb,2.894977e-02_rb, &amp;<a name='10220'>
       2.700471e-02_rb,2.528842e-02_rb,2.376420e-02_rb,2.240256e-02_rb,2.117959e-02_rb, &amp;<a name='10221'>
       2.007567e-02_rb,1.907456e-02_rb,1.816271e-02_rb,1.732874e-02_rb,1.656300e-02_rb, &amp;<a name='10222'>
       1.585725e-02_rb,1.520445e-02_rb,1.459852e-02_rb,1.403419e-02_rb,1.350689e-02_rb, &amp;<a name='10223'>
       1.301260e-02_rb,1.254781e-02_rb,1.210941e-02_rb,1.169468e-02_rb,1.130118e-02_rb, &amp;<a name='10224'>
       1.092675e-02_rb,1.056945e-02_rb,1.022757e-02_rb,9.899560e-03_rb,9.584021e-03_rb, &amp;<a name='10225'>
       9.279705e-03_rb,8.985479e-03_rb,8.700322e-03_rb,8.423306e-03_rb,8.153590e-03_rb, &amp;<a name='10226'>
       7.890412e-03_rb/)<a name='10227'>
      absice3(:,6) = (/ &amp;<a name='10228'>
<font color=#447700>! band 6<a name='10229'></font>
       1.145369e-01_rb,1.174566e-01_rb,9.917866e-02_rb,8.332990e-02_rb,7.104263e-02_rb, &amp;<a name='10230'>
       6.153370e-02_rb,5.405472e-02_rb,4.806281e-02_rb,4.317918e-02_rb,3.913795e-02_rb, &amp;<a name='10231'>
       3.574916e-02_rb,3.287437e-02_rb,3.041067e-02_rb,2.828017e-02_rb,2.642292e-02_rb, &amp;<a name='10232'>
       2.479206e-02_rb,2.335051e-02_rb,2.206851e-02_rb,2.092195e-02_rb,1.989108e-02_rb, &amp;<a name='10233'>
       1.895958e-02_rb,1.811385e-02_rb,1.734245e-02_rb,1.663573e-02_rb,1.598545e-02_rb, &amp;<a name='10234'>
       1.538456e-02_rb,1.482700e-02_rb,1.430750e-02_rb,1.382150e-02_rb,1.336499e-02_rb, &amp;<a name='10235'>
       1.293447e-02_rb,1.252685e-02_rb,1.213939e-02_rb,1.176968e-02_rb,1.141555e-02_rb, &amp;<a name='10236'>
       1.107508e-02_rb,1.074655e-02_rb,1.042839e-02_rb,1.011923e-02_rb,9.817799e-03_rb, &amp;<a name='10237'>
       9.522962e-03_rb,9.233688e-03_rb,8.949041e-03_rb,8.668171e-03_rb,8.390301e-03_rb, &amp;<a name='10238'>
       8.114723e-03_rb/)<a name='10239'>
      absice3(:,7) = (/ &amp;<a name='10240'>
<font color=#447700>! band 7<a name='10241'></font>
       1.222345e-02_rb,5.344230e-02_rb,5.523465e-02_rb,5.128759e-02_rb,4.676925e-02_rb, &amp;<a name='10242'>
       4.266150e-02_rb,3.910561e-02_rb,3.605479e-02_rb,3.342843e-02_rb,3.115052e-02_rb, &amp;<a name='10243'>
       2.915776e-02_rb,2.739935e-02_rb,2.583499e-02_rb,2.443266e-02_rb,2.316681e-02_rb, &amp;<a name='10244'>
       2.201687e-02_rb,2.096619e-02_rb,2.000112e-02_rb,1.911044e-02_rb,1.828481e-02_rb, &amp;<a name='10245'>
       1.751641e-02_rb,1.679866e-02_rb,1.612598e-02_rb,1.549360e-02_rb,1.489742e-02_rb, &amp;<a name='10246'>
       1.433392e-02_rb,1.380002e-02_rb,1.329305e-02_rb,1.281068e-02_rb,1.235084e-02_rb, &amp;<a name='10247'>
       1.191172e-02_rb,1.149171e-02_rb,1.108936e-02_rb,1.070341e-02_rb,1.033271e-02_rb, &amp;<a name='10248'>
       9.976220e-03_rb,9.633021e-03_rb,9.302273e-03_rb,8.983216e-03_rb,8.675161e-03_rb, &amp;<a name='10249'>
       8.377478e-03_rb,8.089595e-03_rb,7.810986e-03_rb,7.541170e-03_rb,7.279706e-03_rb, &amp;<a name='10250'>
       7.026186e-03_rb/)<a name='10251'>
      absice3(:,8) = (/ &amp;<a name='10252'>
<font color=#447700>! band 8<a name='10253'></font>
       6.711058e-02_rb,6.918198e-02_rb,6.127484e-02_rb,5.411944e-02_rb,4.836902e-02_rb, &amp;<a name='10254'>
       4.375293e-02_rb,3.998077e-02_rb,3.683587e-02_rb,3.416508e-02_rb,3.186003e-02_rb, &amp;<a name='10255'>
       2.984290e-02_rb,2.805671e-02_rb,2.645895e-02_rb,2.501733e-02_rb,2.370689e-02_rb, &amp;<a name='10256'>
       2.250808e-02_rb,2.140532e-02_rb,2.038609e-02_rb,1.944018e-02_rb,1.855918e-02_rb, &amp;<a name='10257'>
       1.773609e-02_rb,1.696504e-02_rb,1.624106e-02_rb,1.555990e-02_rb,1.491793e-02_rb, &amp;<a name='10258'>
       1.431197e-02_rb,1.373928e-02_rb,1.319743e-02_rb,1.268430e-02_rb,1.219799e-02_rb, &amp;<a name='10259'>
       1.173682e-02_rb,1.129925e-02_rb,1.088393e-02_rb,1.048961e-02_rb,1.011516e-02_rb, &amp;<a name='10260'>
       9.759543e-03_rb,9.421813e-03_rb,9.101089e-03_rb,8.796559e-03_rb,8.507464e-03_rb, &amp;<a name='10261'>
       8.233098e-03_rb,7.972798e-03_rb,7.725942e-03_rb,7.491940e-03_rb,7.270238e-03_rb, &amp;<a name='10262'>
       7.060305e-03_rb/)<a name='10263'>
      absice3(:,9) = (/ &amp;<a name='10264'>
<font color=#447700>! band 9<a name='10265'></font>
       1.236780e-01_rb,9.222386e-02_rb,7.383997e-02_rb,6.204072e-02_rb,5.381029e-02_rb, &amp;<a name='10266'>
       4.770678e-02_rb,4.296928e-02_rb,3.916131e-02_rb,3.601540e-02_rb,3.335878e-02_rb, &amp;<a name='10267'>
       3.107493e-02_rb,2.908247e-02_rb,2.732282e-02_rb,2.575276e-02_rb,2.433968e-02_rb, &amp;<a name='10268'>
       2.305852e-02_rb,2.188966e-02_rb,2.081757e-02_rb,1.982974e-02_rb,1.891599e-02_rb, &amp;<a name='10269'>
       1.806794e-02_rb,1.727865e-02_rb,1.654227e-02_rb,1.585387e-02_rb,1.520924e-02_rb, &amp;<a name='10270'>
       1.460476e-02_rb,1.403730e-02_rb,1.350416e-02_rb,1.300293e-02_rb,1.253153e-02_rb, &amp;<a name='10271'>
       1.208808e-02_rb,1.167094e-02_rb,1.127862e-02_rb,1.090979e-02_rb,1.056323e-02_rb, &amp;<a name='10272'>
       1.023786e-02_rb,9.932665e-03_rb,9.646744e-03_rb,9.379250e-03_rb,9.129409e-03_rb, &amp;<a name='10273'>
       8.896500e-03_rb,8.679856e-03_rb,8.478852e-03_rb,8.292904e-03_rb,8.121463e-03_rb, &amp;<a name='10274'>
       7.964013e-03_rb/)<a name='10275'>
      absice3(:,10) = (/ &amp;<a name='10276'>
<font color=#447700>! band 10<a name='10277'></font>
       1.655966e-01_rb,1.134205e-01_rb,8.714344e-02_rb,7.129241e-02_rb,6.063739e-02_rb, &amp;<a name='10278'>
       5.294203e-02_rb,4.709309e-02_rb,4.247476e-02_rb,3.871892e-02_rb,3.559206e-02_rb, &amp;<a name='10279'>
       3.293893e-02_rb,3.065226e-02_rb,2.865558e-02_rb,2.689288e-02_rb,2.532221e-02_rb, &amp;<a name='10280'>
       2.391150e-02_rb,2.263582e-02_rb,2.147549e-02_rb,2.041476e-02_rb,1.944089e-02_rb, &amp;<a name='10281'>
       1.854342e-02_rb,1.771371e-02_rb,1.694456e-02_rb,1.622989e-02_rb,1.556456e-02_rb, &amp;<a name='10282'>
       1.494415e-02_rb,1.436491e-02_rb,1.382354e-02_rb,1.331719e-02_rb,1.284339e-02_rb, &amp;<a name='10283'>
       1.239992e-02_rb,1.198486e-02_rb,1.159647e-02_rb,1.123323e-02_rb,1.089375e-02_rb, &amp;<a name='10284'>
       1.057679e-02_rb,1.028124e-02_rb,1.000607e-02_rb,9.750376e-03_rb,9.513303e-03_rb, &amp;<a name='10285'>
       9.294082e-03_rb,9.092003e-03_rb,8.906412e-03_rb,8.736702e-03_rb,8.582314e-03_rb, &amp;<a name='10286'>
       8.442725e-03_rb/)<a name='10287'>
      absice3(:,11) = (/ &amp;<a name='10288'>
<font color=#447700>! band 11<a name='10289'></font>
       1.775615e-01_rb,1.180046e-01_rb,8.929607e-02_rb,7.233500e-02_rb,6.108333e-02_rb, &amp;<a name='10290'>
       5.303642e-02_rb,4.696927e-02_rb,4.221206e-02_rb,3.836768e-02_rb,3.518576e-02_rb, &amp;<a name='10291'>
       3.250063e-02_rb,3.019825e-02_rb,2.819758e-02_rb,2.643943e-02_rb,2.487953e-02_rb, &amp;<a name='10292'>
       2.348414e-02_rb,2.222705e-02_rb,2.108762e-02_rb,2.004936e-02_rb,1.909892e-02_rb, &amp;<a name='10293'>
       1.822539e-02_rb,1.741975e-02_rb,1.667449e-02_rb,1.598330e-02_rb,1.534084e-02_rb, &amp;<a name='10294'>
       1.474253e-02_rb,1.418446e-02_rb,1.366325e-02_rb,1.317597e-02_rb,1.272004e-02_rb, &amp;<a name='10295'>
       1.229321e-02_rb,1.189350e-02_rb,1.151915e-02_rb,1.116859e-02_rb,1.084042e-02_rb, &amp;<a name='10296'>
       1.053338e-02_rb,1.024636e-02_rb,9.978326e-03_rb,9.728357e-03_rb,9.495613e-03_rb, &amp;<a name='10297'>
       9.279327e-03_rb,9.078798e-03_rb,8.893383e-03_rb,8.722488e-03_rb,8.565568e-03_rb, &amp;<a name='10298'>
       8.422115e-03_rb/)<a name='10299'>
      absice3(:,12) = (/ &amp;<a name='10300'>
<font color=#447700>! band 12<a name='10301'></font>
       9.465447e-02_rb,6.432047e-02_rb,5.060973e-02_rb,4.267283e-02_rb,3.741843e-02_rb, &amp;<a name='10302'>
       3.363096e-02_rb,3.073531e-02_rb,2.842405e-02_rb,2.651789e-02_rb,2.490518e-02_rb, &amp;<a name='10303'>
       2.351273e-02_rb,2.229056e-02_rb,2.120335e-02_rb,2.022541e-02_rb,1.933763e-02_rb, &amp;<a name='10304'>
       1.852546e-02_rb,1.777763e-02_rb,1.708528e-02_rb,1.644134e-02_rb,1.584009e-02_rb, &amp;<a name='10305'>
       1.527684e-02_rb,1.474774e-02_rb,1.424955e-02_rb,1.377957e-02_rb,1.333549e-02_rb, &amp;<a name='10306'>
       1.291534e-02_rb,1.251743e-02_rb,1.214029e-02_rb,1.178265e-02_rb,1.144337e-02_rb, &amp;<a name='10307'>
       1.112148e-02_rb,1.081609e-02_rb,1.052642e-02_rb,1.025178e-02_rb,9.991540e-03_rb, &amp;<a name='10308'>
       9.745130e-03_rb,9.512038e-03_rb,9.291797e-03_rb,9.083980e-03_rb,8.888195e-03_rb, &amp;<a name='10309'>
       8.704081e-03_rb,8.531306e-03_rb,8.369560e-03_rb,8.218558e-03_rb,8.078032e-03_rb, &amp;<a name='10310'>
       7.947730e-03_rb/)<a name='10311'>
      absice3(:,13) = (/ &amp;<a name='10312'>
<font color=#447700>! band 13<a name='10313'></font>
       1.560311e-01_rb,9.961097e-02_rb,7.502949e-02_rb,6.115022e-02_rb,5.214952e-02_rb, &amp;<a name='10314'>
       4.578149e-02_rb,4.099731e-02_rb,3.724174e-02_rb,3.419343e-02_rb,3.165356e-02_rb, &amp;<a name='10315'>
       2.949251e-02_rb,2.762222e-02_rb,2.598073e-02_rb,2.452322e-02_rb,2.321642e-02_rb, &amp;<a name='10316'>
       2.203516e-02_rb,2.096002e-02_rb,1.997579e-02_rb,1.907036e-02_rb,1.823401e-02_rb, &amp;<a name='10317'>
       1.745879e-02_rb,1.673819e-02_rb,1.606678e-02_rb,1.544003e-02_rb,1.485411e-02_rb, &amp;<a name='10318'>
       1.430574e-02_rb,1.379215e-02_rb,1.331092e-02_rb,1.285996e-02_rb,1.243746e-02_rb, &amp;<a name='10319'>
       1.204183e-02_rb,1.167164e-02_rb,1.132567e-02_rb,1.100281e-02_rb,1.070207e-02_rb, &amp;<a name='10320'>
       1.042258e-02_rb,1.016352e-02_rb,9.924197e-03_rb,9.703953e-03_rb,9.502199e-03_rb, &amp;<a name='10321'>
       9.318400e-03_rb,9.152066e-03_rb,9.002749e-03_rb,8.870038e-03_rb,8.753555e-03_rb, &amp;<a name='10322'>
       8.652951e-03_rb/)<a name='10323'>
      absice3(:,14) = (/ &amp;<a name='10324'>
<font color=#447700>! band 14<a name='10325'></font>
       1.559547e-01_rb,9.896700e-02_rb,7.441231e-02_rb,6.061469e-02_rb,5.168730e-02_rb, &amp;<a name='10326'>
       4.537821e-02_rb,4.064106e-02_rb,3.692367e-02_rb,3.390714e-02_rb,3.139438e-02_rb, &amp;<a name='10327'>
       2.925702e-02_rb,2.740783e-02_rb,2.578547e-02_rb,2.434552e-02_rb,2.305506e-02_rb, &amp;<a name='10328'>
       2.188910e-02_rb,2.082842e-02_rb,1.985789e-02_rb,1.896553e-02_rb,1.814165e-02_rb, &amp;<a name='10329'>
       1.737839e-02_rb,1.666927e-02_rb,1.600891e-02_rb,1.539279e-02_rb,1.481712e-02_rb, &amp;<a name='10330'>
       1.427865e-02_rb,1.377463e-02_rb,1.330266e-02_rb,1.286068e-02_rb,1.244689e-02_rb, &amp;<a name='10331'>
       1.205973e-02_rb,1.169780e-02_rb,1.135989e-02_rb,1.104492e-02_rb,1.075192e-02_rb, &amp;<a name='10332'>
       1.048004e-02_rb,1.022850e-02_rb,9.996611e-03_rb,9.783753e-03_rb,9.589361e-03_rb, &amp;<a name='10333'>
       9.412924e-03_rb,9.253977e-03_rb,9.112098e-03_rb,8.986903e-03_rb,8.878039e-03_rb, &amp;<a name='10334'>
       8.785184e-03_rb/)<a name='10335'>
      absice3(:,15) = (/ &amp;<a name='10336'>
<font color=#447700>! band 15<a name='10337'></font>
       1.102926e-01_rb,7.176622e-02_rb,5.530316e-02_rb,4.606056e-02_rb,4.006116e-02_rb, &amp;<a name='10338'>
       3.579628e-02_rb,3.256909e-02_rb,3.001360e-02_rb,2.791920e-02_rb,2.615617e-02_rb, &amp;<a name='10339'>
       2.464023e-02_rb,2.331426e-02_rb,2.213817e-02_rb,2.108301e-02_rb,2.012733e-02_rb, &amp;<a name='10340'>
       1.925493e-02_rb,1.845331e-02_rb,1.771269e-02_rb,1.702531e-02_rb,1.638493e-02_rb, &amp;<a name='10341'>
       1.578648e-02_rb,1.522579e-02_rb,1.469940e-02_rb,1.420442e-02_rb,1.373841e-02_rb, &amp;<a name='10342'>
       1.329931e-02_rb,1.288535e-02_rb,1.249502e-02_rb,1.212700e-02_rb,1.178015e-02_rb, &amp;<a name='10343'>
       1.145348e-02_rb,1.114612e-02_rb,1.085730e-02_rb,1.058633e-02_rb,1.033263e-02_rb, &amp;<a name='10344'>
       1.009564e-02_rb,9.874895e-03_rb,9.669960e-03_rb,9.480449e-03_rb,9.306014e-03_rb, &amp;<a name='10345'>
       9.146339e-03_rb,9.001138e-03_rb,8.870154e-03_rb,8.753148e-03_rb,8.649907e-03_rb, &amp;<a name='10346'>
       8.560232e-03_rb/)<a name='10347'>
      absice3(:,16) = (/ &amp;<a name='10348'>
<font color=#447700>! band 16<a name='10349'></font>
       1.688344e-01_rb,1.077072e-01_rb,7.994467e-02_rb,6.403862e-02_rb,5.369850e-02_rb, &amp;<a name='10350'>
       4.641582e-02_rb,4.099331e-02_rb,3.678724e-02_rb,3.342069e-02_rb,3.065831e-02_rb, &amp;<a name='10351'>
       2.834557e-02_rb,2.637680e-02_rb,2.467733e-02_rb,2.319286e-02_rb,2.188299e-02_rb, &amp;<a name='10352'>
       2.071701e-02_rb,1.967121e-02_rb,1.872692e-02_rb,1.786931e-02_rb,1.708641e-02_rb, &amp;<a name='10353'>
       1.636846e-02_rb,1.570743e-02_rb,1.509665e-02_rb,1.453052e-02_rb,1.400433e-02_rb, &amp;<a name='10354'>
       1.351407e-02_rb,1.305631e-02_rb,1.262810e-02_rb,1.222688e-02_rb,1.185044e-02_rb, &amp;<a name='10355'>
       1.149683e-02_rb,1.116436e-02_rb,1.085153e-02_rb,1.055701e-02_rb,1.027961e-02_rb, &amp;<a name='10356'>
       1.001831e-02_rb,9.772141e-03_rb,9.540280e-03_rb,9.321966e-03_rb,9.116517e-03_rb, &amp;<a name='10357'>
       8.923315e-03_rb,8.741803e-03_rb,8.571472e-03_rb,8.411860e-03_rb,8.262543e-03_rb, &amp;<a name='10358'>
       8.123136e-03_rb/)<a name='10359'>
<a name='10360'>
<font color=#447700>! For LIQFLAG = 0.<a name='10361'></font>
      absliq0 = 0.0903614_rb<a name='10362'>
<a name='10363'>
<font color=#447700>! For LIQFLAG = 1.  In each band, the absorption<a name='10364'></font>
<font color=#447700>! coefficients are listed for a range of effective radii from 2.5<a name='10365'></font>
<font color=#447700>! to 59.5 microns in increments of 1.0 micron.<a name='10366'></font>
      absliq1(:, 1) = (/ &amp;<a name='10367'>
<font color=#447700>! band  1<a name='10368'></font>
       1.64047e-03_rb, 6.90533e-02_rb, 7.72017e-02_rb, 7.78054e-02_rb, 7.69523e-02_rb, &amp;<a name='10369'>
       7.58058e-02_rb, 7.46400e-02_rb, 7.35123e-02_rb, 7.24162e-02_rb, 7.13225e-02_rb, &amp;<a name='10370'>
       6.99145e-02_rb, 6.66409e-02_rb, 6.36582e-02_rb, 6.09425e-02_rb, 5.84593e-02_rb, &amp;<a name='10371'>
       5.61743e-02_rb, 5.40571e-02_rb, 5.20812e-02_rb, 5.02245e-02_rb, 4.84680e-02_rb, &amp;<a name='10372'>
       4.67959e-02_rb, 4.51944e-02_rb, 4.36516e-02_rb, 4.21570e-02_rb, 4.07015e-02_rb, &amp;<a name='10373'>
       3.92766e-02_rb, 3.78747e-02_rb, 3.64886e-02_rb, 3.53632e-02_rb, 3.41992e-02_rb, &amp;<a name='10374'>
       3.31016e-02_rb, 3.20643e-02_rb, 3.10817e-02_rb, 3.01490e-02_rb, 2.92620e-02_rb, &amp;<a name='10375'>
       2.84171e-02_rb, 2.76108e-02_rb, 2.68404e-02_rb, 2.61031e-02_rb, 2.53966e-02_rb, &amp;<a name='10376'>
       2.47189e-02_rb, 2.40678e-02_rb, 2.34418e-02_rb, 2.28392e-02_rb, 2.22586e-02_rb, &amp;<a name='10377'>
       2.16986e-02_rb, 2.11580e-02_rb, 2.06356e-02_rb, 2.01305e-02_rb, 1.96417e-02_rb, &amp;<a name='10378'>
       1.91682e-02_rb, 1.87094e-02_rb, 1.82643e-02_rb, 1.78324e-02_rb, 1.74129e-02_rb, &amp;<a name='10379'>
       1.70052e-02_rb, 1.66088e-02_rb, 1.62231e-02_rb/)<a name='10380'>
      absliq1(:, 2) = (/ &amp;<a name='10381'>
<font color=#447700>! band  2<a name='10382'></font>
       2.19486e-01_rb, 1.80687e-01_rb, 1.59150e-01_rb, 1.44731e-01_rb, 1.33703e-01_rb, &amp;<a name='10383'>
       1.24355e-01_rb, 1.15756e-01_rb, 1.07318e-01_rb, 9.86119e-02_rb, 8.92739e-02_rb, &amp;<a name='10384'>
       8.34911e-02_rb, 7.70773e-02_rb, 7.15240e-02_rb, 6.66615e-02_rb, 6.23641e-02_rb, &amp;<a name='10385'>
       5.85359e-02_rb, 5.51020e-02_rb, 5.20032e-02_rb, 4.91916e-02_rb, 4.66283e-02_rb, &amp;<a name='10386'>
       4.42813e-02_rb, 4.21236e-02_rb, 4.01330e-02_rb, 3.82905e-02_rb, 3.65797e-02_rb, &amp;<a name='10387'>
       3.49869e-02_rb, 3.35002e-02_rb, 3.21090e-02_rb, 3.08957e-02_rb, 2.97601e-02_rb, &amp;<a name='10388'>
       2.86966e-02_rb, 2.76984e-02_rb, 2.67599e-02_rb, 2.58758e-02_rb, 2.50416e-02_rb, &amp;<a name='10389'>
       2.42532e-02_rb, 2.35070e-02_rb, 2.27997e-02_rb, 2.21284e-02_rb, 2.14904e-02_rb, &amp;<a name='10390'>
       2.08834e-02_rb, 2.03051e-02_rb, 1.97536e-02_rb, 1.92271e-02_rb, 1.87239e-02_rb, &amp;<a name='10391'>
       1.82425e-02_rb, 1.77816e-02_rb, 1.73399e-02_rb, 1.69162e-02_rb, 1.65094e-02_rb, &amp;<a name='10392'>
       1.61187e-02_rb, 1.57430e-02_rb, 1.53815e-02_rb, 1.50334e-02_rb, 1.46981e-02_rb, &amp;<a name='10393'>
       1.43748e-02_rb, 1.40628e-02_rb, 1.37617e-02_rb/)<a name='10394'>
      absliq1(:, 3) = (/ &amp;<a name='10395'>
<font color=#447700>! band  3<a name='10396'></font>
       2.95174e-01_rb, 2.34765e-01_rb, 1.98038e-01_rb, 1.72114e-01_rb, 1.52083e-01_rb, &amp;<a name='10397'>
       1.35654e-01_rb, 1.21613e-01_rb, 1.09252e-01_rb, 9.81263e-02_rb, 8.79448e-02_rb, &amp;<a name='10398'>
       8.12566e-02_rb, 7.44563e-02_rb, 6.86374e-02_rb, 6.36042e-02_rb, 5.92094e-02_rb, &amp;<a name='10399'>
       5.53402e-02_rb, 5.19087e-02_rb, 4.88455e-02_rb, 4.60951e-02_rb, 4.36124e-02_rb, &amp;<a name='10400'>
       4.13607e-02_rb, 3.93096e-02_rb, 3.74338e-02_rb, 3.57119e-02_rb, 3.41261e-02_rb, &amp;<a name='10401'>
       3.26610e-02_rb, 3.13036e-02_rb, 3.00425e-02_rb, 2.88497e-02_rb, 2.78077e-02_rb, &amp;<a name='10402'>
       2.68317e-02_rb, 2.59158e-02_rb, 2.50545e-02_rb, 2.42430e-02_rb, 2.34772e-02_rb, &amp;<a name='10403'>
       2.27533e-02_rb, 2.20679e-02_rb, 2.14181e-02_rb, 2.08011e-02_rb, 2.02145e-02_rb, &amp;<a name='10404'>
       1.96561e-02_rb, 1.91239e-02_rb, 1.86161e-02_rb, 1.81311e-02_rb, 1.76673e-02_rb, &amp;<a name='10405'>
       1.72234e-02_rb, 1.67981e-02_rb, 1.63903e-02_rb, 1.59989e-02_rb, 1.56230e-02_rb, &amp;<a name='10406'>
       1.52615e-02_rb, 1.49138e-02_rb, 1.45791e-02_rb, 1.42565e-02_rb, 1.39455e-02_rb, &amp;<a name='10407'>
       1.36455e-02_rb, 1.33559e-02_rb, 1.30761e-02_rb/)<a name='10408'>
      absliq1(:, 4) = (/ &amp;<a name='10409'>
<font color=#447700>! band  4<a name='10410'></font>
       3.00925e-01_rb, 2.36949e-01_rb, 1.96947e-01_rb, 1.68692e-01_rb, 1.47190e-01_rb, &amp;<a name='10411'>
       1.29986e-01_rb, 1.15719e-01_rb, 1.03568e-01_rb, 9.30028e-02_rb, 8.36658e-02_rb, &amp;<a name='10412'>
       7.71075e-02_rb, 7.07002e-02_rb, 6.52284e-02_rb, 6.05024e-02_rb, 5.63801e-02_rb, &amp;<a name='10413'>
       5.27534e-02_rb, 4.95384e-02_rb, 4.66690e-02_rb, 4.40925e-02_rb, 4.17664e-02_rb, &amp;<a name='10414'>
       3.96559e-02_rb, 3.77326e-02_rb, 3.59727e-02_rb, 3.43561e-02_rb, 3.28662e-02_rb, &amp;<a name='10415'>
       3.14885e-02_rb, 3.02110e-02_rb, 2.90231e-02_rb, 2.78948e-02_rb, 2.69109e-02_rb, &amp;<a name='10416'>
       2.59884e-02_rb, 2.51217e-02_rb, 2.43058e-02_rb, 2.35364e-02_rb, 2.28096e-02_rb, &amp;<a name='10417'>
       2.21218e-02_rb, 2.14700e-02_rb, 2.08515e-02_rb, 2.02636e-02_rb, 1.97041e-02_rb, &amp;<a name='10418'>
       1.91711e-02_rb, 1.86625e-02_rb, 1.81769e-02_rb, 1.77126e-02_rb, 1.72683e-02_rb, &amp;<a name='10419'>
       1.68426e-02_rb, 1.64344e-02_rb, 1.60427e-02_rb, 1.56664e-02_rb, 1.53046e-02_rb, &amp;<a name='10420'>
       1.49565e-02_rb, 1.46214e-02_rb, 1.42985e-02_rb, 1.39871e-02_rb, 1.36866e-02_rb, &amp;<a name='10421'>
       1.33965e-02_rb, 1.31162e-02_rb, 1.28453e-02_rb/)<a name='10422'>
      absliq1(:, 5) = (/ &amp;<a name='10423'>
<font color=#447700>! band  5<a name='10424'></font>
       2.64691e-01_rb, 2.12018e-01_rb, 1.78009e-01_rb, 1.53539e-01_rb, 1.34721e-01_rb, &amp;<a name='10425'>
       1.19580e-01_rb, 1.06996e-01_rb, 9.62772e-02_rb, 8.69710e-02_rb, 7.87670e-02_rb, &amp;<a name='10426'>
       7.29272e-02_rb, 6.70920e-02_rb, 6.20977e-02_rb, 5.77732e-02_rb, 5.39910e-02_rb, &amp;<a name='10427'>
       5.06538e-02_rb, 4.76866e-02_rb, 4.50301e-02_rb, 4.26374e-02_rb, 4.04704e-02_rb, &amp;<a name='10428'>
       3.84981e-02_rb, 3.66948e-02_rb, 3.50394e-02_rb, 3.35141e-02_rb, 3.21038e-02_rb, &amp;<a name='10429'>
       3.07957e-02_rb, 2.95788e-02_rb, 2.84438e-02_rb, 2.73790e-02_rb, 2.64390e-02_rb, &amp;<a name='10430'>
       2.55565e-02_rb, 2.47263e-02_rb, 2.39437e-02_rb, 2.32047e-02_rb, 2.25056e-02_rb, &amp;<a name='10431'>
       2.18433e-02_rb, 2.12149e-02_rb, 2.06177e-02_rb, 2.00495e-02_rb, 1.95081e-02_rb, &amp;<a name='10432'>
       1.89917e-02_rb, 1.84984e-02_rb, 1.80269e-02_rb, 1.75755e-02_rb, 1.71431e-02_rb, &amp;<a name='10433'>
       1.67283e-02_rb, 1.63303e-02_rb, 1.59478e-02_rb, 1.55801e-02_rb, 1.52262e-02_rb, &amp;<a name='10434'>
       1.48853e-02_rb, 1.45568e-02_rb, 1.42400e-02_rb, 1.39342e-02_rb, 1.36388e-02_rb, &amp;<a name='10435'>
       1.33533e-02_rb, 1.30773e-02_rb, 1.28102e-02_rb/)<a name='10436'>
      absliq1(:, 6) = (/ &amp;<a name='10437'>
<font color=#447700>! band  6<a name='10438'></font>
       8.81182e-02_rb, 1.06745e-01_rb, 9.79753e-02_rb, 8.99625e-02_rb, 8.35200e-02_rb, &amp;<a name='10439'>
       7.81899e-02_rb, 7.35939e-02_rb, 6.94696e-02_rb, 6.56266e-02_rb, 6.19148e-02_rb, &amp;<a name='10440'>
       5.83355e-02_rb, 5.49306e-02_rb, 5.19642e-02_rb, 4.93325e-02_rb, 4.69659e-02_rb, &amp;<a name='10441'>
       4.48148e-02_rb, 4.28431e-02_rb, 4.10231e-02_rb, 3.93332e-02_rb, 3.77563e-02_rb, &amp;<a name='10442'>
       3.62785e-02_rb, 3.48882e-02_rb, 3.35758e-02_rb, 3.23333e-02_rb, 3.11536e-02_rb, &amp;<a name='10443'>
       3.00310e-02_rb, 2.89601e-02_rb, 2.79365e-02_rb, 2.70502e-02_rb, 2.62618e-02_rb, &amp;<a name='10444'>
       2.55025e-02_rb, 2.47728e-02_rb, 2.40726e-02_rb, 2.34013e-02_rb, 2.27583e-02_rb, &amp;<a name='10445'>
       2.21422e-02_rb, 2.15522e-02_rb, 2.09869e-02_rb, 2.04453e-02_rb, 1.99260e-02_rb, &amp;<a name='10446'>
       1.94280e-02_rb, 1.89501e-02_rb, 1.84913e-02_rb, 1.80506e-02_rb, 1.76270e-02_rb, &amp;<a name='10447'>
       1.72196e-02_rb, 1.68276e-02_rb, 1.64500e-02_rb, 1.60863e-02_rb, 1.57357e-02_rb, &amp;<a name='10448'>
       1.53975e-02_rb, 1.50710e-02_rb, 1.47558e-02_rb, 1.44511e-02_rb, 1.41566e-02_rb, &amp;<a name='10449'>
       1.38717e-02_rb, 1.35960e-02_rb, 1.33290e-02_rb/)<a name='10450'>
      absliq1(:, 7) = (/ &amp;<a name='10451'>
<font color=#447700>! band  7<a name='10452'></font>
       4.32174e-02_rb, 7.36078e-02_rb, 6.98340e-02_rb, 6.65231e-02_rb, 6.41948e-02_rb, &amp;<a name='10453'>
       6.23551e-02_rb, 6.06638e-02_rb, 5.88680e-02_rb, 5.67124e-02_rb, 5.38629e-02_rb, &amp;<a name='10454'>
       4.99579e-02_rb, 4.86289e-02_rb, 4.70120e-02_rb, 4.52854e-02_rb, 4.35466e-02_rb, &amp;<a name='10455'>
       4.18480e-02_rb, 4.02169e-02_rb, 3.86658e-02_rb, 3.71992e-02_rb, 3.58168e-02_rb, &amp;<a name='10456'>
       3.45155e-02_rb, 3.32912e-02_rb, 3.21390e-02_rb, 3.10538e-02_rb, 3.00307e-02_rb, &amp;<a name='10457'>
       2.90651e-02_rb, 2.81524e-02_rb, 2.72885e-02_rb, 2.62821e-02_rb, 2.55744e-02_rb, &amp;<a name='10458'>
       2.48799e-02_rb, 2.42029e-02_rb, 2.35460e-02_rb, 2.29108e-02_rb, 2.22981e-02_rb, &amp;<a name='10459'>
       2.17079e-02_rb, 2.11402e-02_rb, 2.05945e-02_rb, 2.00701e-02_rb, 1.95663e-02_rb, &amp;<a name='10460'>
       1.90824e-02_rb, 1.86174e-02_rb, 1.81706e-02_rb, 1.77411e-02_rb, 1.73281e-02_rb, &amp;<a name='10461'>
       1.69307e-02_rb, 1.65483e-02_rb, 1.61801e-02_rb, 1.58254e-02_rb, 1.54835e-02_rb, &amp;<a name='10462'>
       1.51538e-02_rb, 1.48358e-02_rb, 1.45288e-02_rb, 1.42322e-02_rb, 1.39457e-02_rb, &amp;<a name='10463'>
       1.36687e-02_rb, 1.34008e-02_rb, 1.31416e-02_rb/)<a name='10464'>
      absliq1(:, 8) = (/ &amp;<a name='10465'>
<font color=#447700>! band  8<a name='10466'></font>
       1.41881e-01_rb, 7.15419e-02_rb, 6.30335e-02_rb, 6.11132e-02_rb, 6.01931e-02_rb, &amp;<a name='10467'>
       5.92420e-02_rb, 5.78968e-02_rb, 5.58876e-02_rb, 5.28923e-02_rb, 4.84462e-02_rb, &amp;<a name='10468'>
       4.60839e-02_rb, 4.56013e-02_rb, 4.45410e-02_rb, 4.31866e-02_rb, 4.17026e-02_rb, &amp;<a name='10469'>
       4.01850e-02_rb, 3.86892e-02_rb, 3.72461e-02_rb, 3.58722e-02_rb, 3.45749e-02_rb, &amp;<a name='10470'>
       3.33564e-02_rb, 3.22155e-02_rb, 3.11494e-02_rb, 3.01541e-02_rb, 2.92253e-02_rb, &amp;<a name='10471'>
       2.83584e-02_rb, 2.75488e-02_rb, 2.67925e-02_rb, 2.57692e-02_rb, 2.50704e-02_rb, &amp;<a name='10472'>
       2.43918e-02_rb, 2.37350e-02_rb, 2.31005e-02_rb, 2.24888e-02_rb, 2.18996e-02_rb, &amp;<a name='10473'>
       2.13325e-02_rb, 2.07870e-02_rb, 2.02623e-02_rb, 1.97577e-02_rb, 1.92724e-02_rb, &amp;<a name='10474'>
       1.88056e-02_rb, 1.83564e-02_rb, 1.79241e-02_rb, 1.75079e-02_rb, 1.71070e-02_rb, &amp;<a name='10475'>
       1.67207e-02_rb, 1.63482e-02_rb, 1.59890e-02_rb, 1.56424e-02_rb, 1.53077e-02_rb, &amp;<a name='10476'>
       1.49845e-02_rb, 1.46722e-02_rb, 1.43702e-02_rb, 1.40782e-02_rb, 1.37955e-02_rb, &amp;<a name='10477'>
       1.35219e-02_rb, 1.32569e-02_rb, 1.30000e-02_rb/)<a name='10478'>
      absliq1(:, 9) = (/ &amp;<a name='10479'>
<font color=#447700>! band  9<a name='10480'></font>
       6.72726e-02_rb, 6.61013e-02_rb, 6.47866e-02_rb, 6.33780e-02_rb, 6.18985e-02_rb, &amp;<a name='10481'>
       6.03335e-02_rb, 5.86136e-02_rb, 5.65876e-02_rb, 5.39839e-02_rb, 5.03536e-02_rb, &amp;<a name='10482'>
       4.71608e-02_rb, 4.63630e-02_rb, 4.50313e-02_rb, 4.34526e-02_rb, 4.17876e-02_rb, &amp;<a name='10483'>
       4.01261e-02_rb, 3.85171e-02_rb, 3.69860e-02_rb, 3.55442e-02_rb, 3.41954e-02_rb, &amp;<a name='10484'>
       3.29384e-02_rb, 3.17693e-02_rb, 3.06832e-02_rb, 2.96745e-02_rb, 2.87374e-02_rb, &amp;<a name='10485'>
       2.78662e-02_rb, 2.70557e-02_rb, 2.63008e-02_rb, 2.52450e-02_rb, 2.45424e-02_rb, &amp;<a name='10486'>
       2.38656e-02_rb, 2.32144e-02_rb, 2.25885e-02_rb, 2.19873e-02_rb, 2.14099e-02_rb, &amp;<a name='10487'>
       2.08554e-02_rb, 2.03230e-02_rb, 1.98116e-02_rb, 1.93203e-02_rb, 1.88482e-02_rb, &amp;<a name='10488'>
       1.83944e-02_rb, 1.79578e-02_rb, 1.75378e-02_rb, 1.71335e-02_rb, 1.67440e-02_rb, &amp;<a name='10489'>
       1.63687e-02_rb, 1.60069e-02_rb, 1.56579e-02_rb, 1.53210e-02_rb, 1.49958e-02_rb, &amp;<a name='10490'>
       1.46815e-02_rb, 1.43778e-02_rb, 1.40841e-02_rb, 1.37999e-02_rb, 1.35249e-02_rb, &amp;<a name='10491'>
       1.32585e-02_rb, 1.30004e-02_rb, 1.27502e-02_rb/)<a name='10492'>
      absliq1(:,10) = (/ &amp;<a name='10493'>
<font color=#447700>! band 10<a name='10494'></font>
       7.97040e-02_rb, 7.63844e-02_rb, 7.36499e-02_rb, 7.13525e-02_rb, 6.93043e-02_rb, &amp;<a name='10495'>
       6.72807e-02_rb, 6.50227e-02_rb, 6.22395e-02_rb, 5.86093e-02_rb, 5.37815e-02_rb, &amp;<a name='10496'>
       5.14682e-02_rb, 4.97214e-02_rb, 4.77392e-02_rb, 4.56961e-02_rb, 4.36858e-02_rb, &amp;<a name='10497'>
       4.17569e-02_rb, 3.99328e-02_rb, 3.82224e-02_rb, 3.66265e-02_rb, 3.51416e-02_rb, &amp;<a name='10498'>
       3.37617e-02_rb, 3.24798e-02_rb, 3.12887e-02_rb, 3.01812e-02_rb, 2.91505e-02_rb, &amp;<a name='10499'>
       2.81900e-02_rb, 2.72939e-02_rb, 2.64568e-02_rb, 2.54165e-02_rb, 2.46832e-02_rb, &amp;<a name='10500'>
       2.39783e-02_rb, 2.33017e-02_rb, 2.26531e-02_rb, 2.20314e-02_rb, 2.14359e-02_rb, &amp;<a name='10501'>
       2.08653e-02_rb, 2.03187e-02_rb, 1.97947e-02_rb, 1.92924e-02_rb, 1.88106e-02_rb, &amp;<a name='10502'>
       1.83483e-02_rb, 1.79043e-02_rb, 1.74778e-02_rb, 1.70678e-02_rb, 1.66735e-02_rb, &amp;<a name='10503'>
       1.62941e-02_rb, 1.59286e-02_rb, 1.55766e-02_rb, 1.52371e-02_rb, 1.49097e-02_rb, &amp;<a name='10504'>
       1.45937e-02_rb, 1.42885e-02_rb, 1.39936e-02_rb, 1.37085e-02_rb, 1.34327e-02_rb, &amp;<a name='10505'>
       1.31659e-02_rb, 1.29075e-02_rb, 1.26571e-02_rb/)<a name='10506'>
      absliq1(:,11) = (/ &amp;<a name='10507'>
<font color=#447700>! band 11<a name='10508'></font>
       1.49438e-01_rb, 1.33535e-01_rb, 1.21542e-01_rb, 1.11743e-01_rb, 1.03263e-01_rb, &amp;<a name='10509'>
       9.55774e-02_rb, 8.83382e-02_rb, 8.12943e-02_rb, 7.42533e-02_rb, 6.70609e-02_rb, &amp;<a name='10510'>
       6.38761e-02_rb, 5.97788e-02_rb, 5.59841e-02_rb, 5.25318e-02_rb, 4.94132e-02_rb, &amp;<a name='10511'>
       4.66014e-02_rb, 4.40644e-02_rb, 4.17706e-02_rb, 3.96910e-02_rb, 3.77998e-02_rb, &amp;<a name='10512'>
       3.60742e-02_rb, 3.44947e-02_rb, 3.30442e-02_rb, 3.17079e-02_rb, 3.04730e-02_rb, &amp;<a name='10513'>
       2.93283e-02_rb, 2.82642e-02_rb, 2.72720e-02_rb, 2.61789e-02_rb, 2.53277e-02_rb, &amp;<a name='10514'>
       2.45237e-02_rb, 2.37635e-02_rb, 2.30438e-02_rb, 2.23615e-02_rb, 2.17140e-02_rb, &amp;<a name='10515'>
       2.10987e-02_rb, 2.05133e-02_rb, 1.99557e-02_rb, 1.94241e-02_rb, 1.89166e-02_rb, &amp;<a name='10516'>
       1.84317e-02_rb, 1.79679e-02_rb, 1.75238e-02_rb, 1.70983e-02_rb, 1.66901e-02_rb, &amp;<a name='10517'>
       1.62983e-02_rb, 1.59219e-02_rb, 1.55599e-02_rb, 1.52115e-02_rb, 1.48761e-02_rb, &amp;<a name='10518'>
       1.45528e-02_rb, 1.42411e-02_rb, 1.39402e-02_rb, 1.36497e-02_rb, 1.33690e-02_rb, &amp;<a name='10519'>
       1.30976e-02_rb, 1.28351e-02_rb, 1.25810e-02_rb/)<a name='10520'>
      absliq1(:,12) = (/ &amp;<a name='10521'>
<font color=#447700>! band 12<a name='10522'></font>
       3.71985e-02_rb, 3.88586e-02_rb, 3.99070e-02_rb, 4.04351e-02_rb, 4.04610e-02_rb, &amp;<a name='10523'>
       3.99834e-02_rb, 3.89953e-02_rb, 3.74886e-02_rb, 3.54551e-02_rb, 3.28870e-02_rb, &amp;<a name='10524'>
       3.32576e-02_rb, 3.22444e-02_rb, 3.12384e-02_rb, 3.02584e-02_rb, 2.93146e-02_rb, &amp;<a name='10525'>
       2.84120e-02_rb, 2.75525e-02_rb, 2.67361e-02_rb, 2.59618e-02_rb, 2.52280e-02_rb, &amp;<a name='10526'>
       2.45327e-02_rb, 2.38736e-02_rb, 2.32487e-02_rb, 2.26558e-02_rb, 2.20929e-02_rb, &amp;<a name='10527'>
       2.15579e-02_rb, 2.10491e-02_rb, 2.05648e-02_rb, 1.99749e-02_rb, 1.95704e-02_rb, &amp;<a name='10528'>
       1.91731e-02_rb, 1.87839e-02_rb, 1.84032e-02_rb, 1.80315e-02_rb, 1.76689e-02_rb, &amp;<a name='10529'>
       1.73155e-02_rb, 1.69712e-02_rb, 1.66362e-02_rb, 1.63101e-02_rb, 1.59928e-02_rb, &amp;<a name='10530'>
       1.56842e-02_rb, 1.53840e-02_rb, 1.50920e-02_rb, 1.48080e-02_rb, 1.45318e-02_rb, &amp;<a name='10531'>
       1.42631e-02_rb, 1.40016e-02_rb, 1.37472e-02_rb, 1.34996e-02_rb, 1.32586e-02_rb, &amp;<a name='10532'>
       1.30239e-02_rb, 1.27954e-02_rb, 1.25728e-02_rb, 1.23559e-02_rb, 1.21445e-02_rb, &amp;<a name='10533'>
       1.19385e-02_rb, 1.17376e-02_rb, 1.15417e-02_rb/)<a name='10534'>
      absliq1(:,13) = (/ &amp;<a name='10535'>
<font color=#447700>! band 13<a name='10536'></font>
       3.11868e-02_rb, 4.48357e-02_rb, 4.90224e-02_rb, 4.96406e-02_rb, 4.86806e-02_rb, &amp;<a name='10537'>
       4.69610e-02_rb, 4.48630e-02_rb, 4.25795e-02_rb, 4.02138e-02_rb, 3.78236e-02_rb, &amp;<a name='10538'>
       3.74266e-02_rb, 3.60384e-02_rb, 3.47074e-02_rb, 3.34434e-02_rb, 3.22499e-02_rb, &amp;<a name='10539'>
       3.11264e-02_rb, 3.00704e-02_rb, 2.90784e-02_rb, 2.81463e-02_rb, 2.72702e-02_rb, &amp;<a name='10540'>
       2.64460e-02_rb, 2.56698e-02_rb, 2.49381e-02_rb, 2.42475e-02_rb, 2.35948e-02_rb, &amp;<a name='10541'>
       2.29774e-02_rb, 2.23925e-02_rb, 2.18379e-02_rb, 2.11793e-02_rb, 2.07076e-02_rb, &amp;<a name='10542'>
       2.02470e-02_rb, 1.97981e-02_rb, 1.93613e-02_rb, 1.89367e-02_rb, 1.85243e-02_rb, &amp;<a name='10543'>
       1.81240e-02_rb, 1.77356e-02_rb, 1.73588e-02_rb, 1.69935e-02_rb, 1.66392e-02_rb, &amp;<a name='10544'>
       1.62956e-02_rb, 1.59624e-02_rb, 1.56393e-02_rb, 1.53259e-02_rb, 1.50219e-02_rb, &amp;<a name='10545'>
       1.47268e-02_rb, 1.44404e-02_rb, 1.41624e-02_rb, 1.38925e-02_rb, 1.36302e-02_rb, &amp;<a name='10546'>
       1.33755e-02_rb, 1.31278e-02_rb, 1.28871e-02_rb, 1.26530e-02_rb, 1.24253e-02_rb, &amp;<a name='10547'>
       1.22038e-02_rb, 1.19881e-02_rb, 1.17782e-02_rb/)<a name='10548'>
      absliq1(:,14) = (/ &amp;<a name='10549'>
<font color=#447700>! band 14<a name='10550'></font>
       1.58988e-02_rb, 3.50652e-02_rb, 4.00851e-02_rb, 4.07270e-02_rb, 3.98101e-02_rb, &amp;<a name='10551'>
       3.83306e-02_rb, 3.66829e-02_rb, 3.50327e-02_rb, 3.34497e-02_rb, 3.19609e-02_rb, &amp;<a name='10552'>
       3.13712e-02_rb, 3.03348e-02_rb, 2.93415e-02_rb, 2.83973e-02_rb, 2.75037e-02_rb, &amp;<a name='10553'>
       2.66604e-02_rb, 2.58654e-02_rb, 2.51161e-02_rb, 2.44100e-02_rb, 2.37440e-02_rb, &amp;<a name='10554'>
       2.31154e-02_rb, 2.25215e-02_rb, 2.19599e-02_rb, 2.14282e-02_rb, 2.09242e-02_rb, &amp;<a name='10555'>
       2.04459e-02_rb, 1.99915e-02_rb, 1.95594e-02_rb, 1.90254e-02_rb, 1.86598e-02_rb, &amp;<a name='10556'>
       1.82996e-02_rb, 1.79455e-02_rb, 1.75983e-02_rb, 1.72584e-02_rb, 1.69260e-02_rb, &amp;<a name='10557'>
       1.66013e-02_rb, 1.62843e-02_rb, 1.59752e-02_rb, 1.56737e-02_rb, 1.53799e-02_rb, &amp;<a name='10558'>
       1.50936e-02_rb, 1.48146e-02_rb, 1.45429e-02_rb, 1.42782e-02_rb, 1.40203e-02_rb, &amp;<a name='10559'>
       1.37691e-02_rb, 1.35243e-02_rb, 1.32858e-02_rb, 1.30534e-02_rb, 1.28270e-02_rb, &amp;<a name='10560'>
       1.26062e-02_rb, 1.23909e-02_rb, 1.21810e-02_rb, 1.19763e-02_rb, 1.17766e-02_rb, &amp;<a name='10561'>
       1.15817e-02_rb, 1.13915e-02_rb, 1.12058e-02_rb/)<a name='10562'>
      absliq1(:,15) = (/ &amp;<a name='10563'>
<font color=#447700>! band 15<a name='10564'></font>
       5.02079e-03_rb, 2.17615e-02_rb, 2.55449e-02_rb, 2.59484e-02_rb, 2.53650e-02_rb, &amp;<a name='10565'>
       2.45281e-02_rb, 2.36843e-02_rb, 2.29159e-02_rb, 2.22451e-02_rb, 2.16716e-02_rb, &amp;<a name='10566'>
       2.11451e-02_rb, 2.05817e-02_rb, 2.00454e-02_rb, 1.95372e-02_rb, 1.90567e-02_rb, &amp;<a name='10567'>
       1.86028e-02_rb, 1.81742e-02_rb, 1.77693e-02_rb, 1.73866e-02_rb, 1.70244e-02_rb, &amp;<a name='10568'>
       1.66815e-02_rb, 1.63563e-02_rb, 1.60477e-02_rb, 1.57544e-02_rb, 1.54755e-02_rb, &amp;<a name='10569'>
       1.52097e-02_rb, 1.49564e-02_rb, 1.47146e-02_rb, 1.43684e-02_rb, 1.41728e-02_rb, &amp;<a name='10570'>
       1.39762e-02_rb, 1.37797e-02_rb, 1.35838e-02_rb, 1.33891e-02_rb, 1.31961e-02_rb, &amp;<a name='10571'>
       1.30051e-02_rb, 1.28164e-02_rb, 1.26302e-02_rb, 1.24466e-02_rb, 1.22659e-02_rb, &amp;<a name='10572'>
       1.20881e-02_rb, 1.19131e-02_rb, 1.17412e-02_rb, 1.15723e-02_rb, 1.14063e-02_rb, &amp;<a name='10573'>
       1.12434e-02_rb, 1.10834e-02_rb, 1.09264e-02_rb, 1.07722e-02_rb, 1.06210e-02_rb, &amp;<a name='10574'>
       1.04725e-02_rb, 1.03269e-02_rb, 1.01839e-02_rb, 1.00436e-02_rb, 9.90593e-03_rb, &amp;<a name='10575'>
       9.77080e-03_rb, 9.63818e-03_rb, 9.50800e-03_rb/)<a name='10576'>
      absliq1(:,16) = (/ &amp;<a name='10577'>
<font color=#447700>! band 16<a name='10578'></font>
       5.64971e-02_rb, 9.04736e-02_rb, 8.11726e-02_rb, 7.05450e-02_rb, 6.20052e-02_rb, &amp;<a name='10579'>
       5.54286e-02_rb, 5.03503e-02_rb, 4.63791e-02_rb, 4.32290e-02_rb, 4.06959e-02_rb, &amp;<a name='10580'>
       3.74690e-02_rb, 3.52964e-02_rb, 3.33799e-02_rb, 3.16774e-02_rb, 3.01550e-02_rb, &amp;<a name='10581'>
       2.87856e-02_rb, 2.75474e-02_rb, 2.64223e-02_rb, 2.53953e-02_rb, 2.44542e-02_rb, &amp;<a name='10582'>
       2.35885e-02_rb, 2.27894e-02_rb, 2.20494e-02_rb, 2.13622e-02_rb, 2.07222e-02_rb, &amp;<a name='10583'>
       2.01246e-02_rb, 1.95654e-02_rb, 1.90408e-02_rb, 1.84398e-02_rb, 1.80021e-02_rb, &amp;<a name='10584'>
       1.75816e-02_rb, 1.71775e-02_rb, 1.67889e-02_rb, 1.64152e-02_rb, 1.60554e-02_rb, &amp;<a name='10585'>
       1.57089e-02_rb, 1.53751e-02_rb, 1.50531e-02_rb, 1.47426e-02_rb, 1.44428e-02_rb, &amp;<a name='10586'>
       1.41532e-02_rb, 1.38734e-02_rb, 1.36028e-02_rb, 1.33410e-02_rb, 1.30875e-02_rb, &amp;<a name='10587'>
       1.28420e-02_rb, 1.26041e-02_rb, 1.23735e-02_rb, 1.21497e-02_rb, 1.19325e-02_rb, &amp;<a name='10588'>
       1.17216e-02_rb, 1.15168e-02_rb, 1.13177e-02_rb, 1.11241e-02_rb, 1.09358e-02_rb, &amp;<a name='10589'>
       1.07525e-02_rb, 1.05741e-02_rb, 1.04003e-02_rb/)<a name='10590'>
<a name='10591'>
      end subroutine lwcldpr<a name='10592'>
<a name='10593'>
      end module rrtmg_lw_init<a name='10594'>
<a name='10595'>
<font color=#447700>!     path:      $Source: /cvsroot/NWP/WRFV3/phys/module_ra_rrtmg_lw.F,v $<a name='10596'></font>
<font color=#447700>!     author:    $Author: trn $<a name='10597'></font>
<font color=#447700>!     revision:  $Revision: 1.3 $<a name='10598'></font>
<font color=#447700>!     created:   $Date: 2009/04/16 19:54:22 $<a name='10599'></font>
<font color=#447700>!<a name='10600'></font>
<A NAME='RRTMG_LW_RAD'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='10601'>
       <font color=#993300>module </font><font color=#cc0000>rrtmg_lw_rad</font> <A href='../../call_to/RRTMG_LW_RAD.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LW_RAD.html' TARGET='index'>7</A><a name='10602'>
<a name='10603'>
<font color=#447700>!  --------------------------------------------------------------------------<a name='10604'></font>
<font color=#447700>! |                                                                          |<a name='10605'></font>
<font color=#447700>! |  Copyright 2002-2008, Atmospheric &amp; Environmental Research, Inc. (AER).  |<a name='10606'></font>
<font color=#447700>! |  This software may be used, copied, or redistributed as long as it is    |<a name='10607'></font>
<font color=#447700>! |  not sold and this copyright notice is reproduced on each copy made.     |<a name='10608'></font>
<font color=#447700>! |  This model is provided as is without any express or implied warranties. |<a name='10609'></font>
<font color=#447700>! |                       (http://www.rtweb.aer.com/)                        |<a name='10610'></font>
<font color=#447700>! |                                                                          |<a name='10611'></font>
<font color=#447700>!  --------------------------------------------------------------------------<a name='10612'></font>
<font color=#447700>!<a name='10613'></font>
<font color=#447700>! ****************************************************************************<a name='10614'></font>
<font color=#447700>! *                                                                          *<a name='10615'></font>
<font color=#447700>! *                              RRTMG_LW                                    *<a name='10616'></font>
<font color=#447700>! *                                                                          *<a name='10617'></font>
<font color=#447700>! *                                                                          *<a name='10618'></font>
<font color=#447700>! *                                                                          *<a name='10619'></font>
<font color=#447700>! *                   a rapid radiative transfer model                       *<a name='10620'></font>
<font color=#447700>! *                       for the longwave region                            * <a name='10621'></font>
<font color=#447700>! *             for application to general circulation models                *<a name='10622'></font>
<font color=#447700>! *                                                                          *<a name='10623'></font>
<font color=#447700>! *                                                                          *<a name='10624'></font>
<font color=#447700>! *            Atmospheric and Environmental Research, Inc.                  *<a name='10625'></font>
<font color=#447700>! *                        131 Hartwell Avenue                               *<a name='10626'></font>
<font color=#447700>! *                        Lexington, MA 02421                               *<a name='10627'></font>
<font color=#447700>! *                                                                          *<a name='10628'></font>
<font color=#447700>! *                                                                          *<a name='10629'></font>
<font color=#447700>! *                           Eli J. Mlawer                                  *<a name='10630'></font>
<font color=#447700>! *                        Jennifer S. Delamere                              *<a name='10631'></font>
<font color=#447700>! *                         Michael J. Iacono                                *<a name='10632'></font>
<font color=#447700>! *                         Shepard A. Clough                                *<a name='10633'></font>
<font color=#447700>! *                                                                          *<a name='10634'></font>
<font color=#447700>! *                                                                          *<a name='10635'></font>
<font color=#447700>! *                                                                          *<a name='10636'></font>
<font color=#447700>! *                                                                          *<a name='10637'></font>
<font color=#447700>! *                                                                          *<a name='10638'></font>
<font color=#447700>! *                                                                          *<a name='10639'></font>
<font color=#447700>! *                       email:  miacono@aer.com                            *<a name='10640'></font>
<font color=#447700>! *                       email:  emlawer@aer.com                            *<a name='10641'></font>
<font color=#447700>! *                       email:  jdelamer@aer.com                           *<a name='10642'></font>
<font color=#447700>! *                                                                          *<a name='10643'></font>
<font color=#447700>! *        The authors wish to acknowledge the contributions of the          *<a name='10644'></font>
<font color=#447700>! *        following people:  Steven J. Taubman, Karen Cady-Pereira,         *<a name='10645'></font>
<font color=#447700>! *        Patrick D. Brown, Ronald E. Farren, Luke Chen, Robert Bergstrom.  *<a name='10646'></font>
<font color=#447700>! *                                                                          *<a name='10647'></font>
<font color=#447700>! ****************************************************************************<a name='10648'></font>
<a name='10649'>
<font color=#447700>! -------- Modules --------<a name='10650'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARKIND'>parkind</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARKIND_31">, only : im =&gt; kind_im, rb =&gt; kind_rb<a name='10651'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_VSN'>rrlw_vsn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_VSN_8"><a name='10652'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW'>mcica_subcol_gen_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MCICA_SUBCOL_GEN_LW_1">, only: mcica_subcol_lw<a name='10653'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_CLDPRMC'>rrtmg_lw_cldprmc</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_CLDPRMC_1">, only: cldprmc<a name='10654'>
<font color=#447700>! *** Move the required call to rrtmg_lw_ini below and the following <a name='10655'></font>
<font color=#447700>! use association to the GCM initialization area ***<a name='10656'></font>
<font color=#447700>!      use rrtmg_lw_init, only: rrtmg_lw_ini<a name='10657'></font>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RTRNMC'>rrtmg_lw_rtrnmc</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_RTRNMC_1">, only: rtrnmc<a name='10658'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_SETCOEF'>rrtmg_lw_setcoef</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_SETCOEF_2">, only: setcoef<a name='10659'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_TAUMOL'>rrtmg_lw_taumol</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_TAUMOL_1">, only: taumol<a name='10660'>
<a name='10661'>
      implicit none<a name='10662'>
<a name='10663'>
<font color=#447700>! public interfaces/functions/subroutines<a name='10664'></font>
      public :: rrtmg_lw, inatm<a name='10665'>
<a name='10666'>
<font color=#447700>!------------------------------------------------------------------<a name='10667'></font>
      contains<a name='10668'>
<font color=#447700>!------------------------------------------------------------------<a name='10669'></font>
<a name='10670'>
<font color=#447700>!------------------------------------------------------------------<a name='10671'></font>
<font color=#447700>! Public subroutines<a name='10672'></font>
<font color=#447700>!------------------------------------------------------------------<a name='10673'></font>
<a name='10674'>
<A NAME='RRTMG_LW'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='10675'>
      <font color=#993300>subroutine </font><font color=#cc0000>rrtmg_lw</font> &amp; <A href='../../call_to/RRTMG_LW.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LW.html' TARGET='index'>18</A><a name='10676'>
            (ncol    ,nlay    ,icld    , &amp;<a name='10677'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='10678'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='10679'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='10680'>
             inflglw ,iceflglw,liqflglw,cldfmcl , &amp;<a name='10681'>
             taucmcl ,ciwpmcl ,clwpmcl , cswpmcl ,reicmcl ,relqmcl , resnmcl , &amp;<a name='10682'>
             tauaer  , &amp;<a name='10683'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc,  hrc)<a name='10684'>
<a name='10685'>
<font color=#447700>! -------- Description --------<a name='10686'></font>
<a name='10687'>
<font color=#447700>! This program is the driver subroutine for RRTMG_LW, the AER LW radiation <a name='10688'></font>
<font color=#447700>! model for application to GCMs, that has been adapted from RRTM_LW for<a name='10689'></font>
<font color=#447700>! improved efficiency.<a name='10690'></font>
<font color=#447700>!<a name='10691'></font>
<font color=#447700>! NOTE: The call to RRTMG_LW_INI should be moved to the GCM initialization<a name='10692'></font>
<font color=#447700>!  area, since this has to be called only once. <a name='10693'></font>
<font color=#447700>!<a name='10694'></font>
<font color=#447700>! This routine:<a name='10695'></font>
<font color=#447700>!    a) calls INATM to read in the atmospheric profile from GCM;<a name='10696'></font>
<font color=#447700>!       all layering in RRTMG is ordered from surface to toa. <a name='10697'></font>
<font color=#447700>!    b) calls CLDPRMC to set cloud optical depth for McICA based <a name='10698'></font>
<font color=#447700>!       on input cloud properties <a name='10699'></font>
<font color=#447700>!    c) calls SETCOEF to calculate various quantities needed for <a name='10700'></font>
<font color=#447700>!       the radiative transfer algorithm<a name='10701'></font>
<font color=#447700>!    d) calls TAUMOL to calculate gaseous optical depths for each <a name='10702'></font>
<font color=#447700>!       of the 16 spectral bands<a name='10703'></font>
<font color=#447700>!    e) calls RTRNMC (for both clear and cloudy profiles) to perform the<a name='10704'></font>
<font color=#447700>!       radiative transfer calculation using McICA, the Monte-Carlo <a name='10705'></font>
<font color=#447700>!       Independent Column Approximation, to represent sub-grid scale <a name='10706'></font>
<font color=#447700>!       cloud variability<a name='10707'></font>
<font color=#447700>!    f) passes the necessary fluxes and cooling rates back to GCM<a name='10708'></font>
<font color=#447700>!<a name='10709'></font>
<font color=#447700>! Two modes of operation are possible:<a name='10710'></font>
<font color=#447700>!     The mode is chosen by using either rrtmg_lw.nomcica.f90 (to not use<a name='10711'></font>
<font color=#447700>!     McICA) or rrtmg_lw.f90 (to use McICA) to interface with a GCM. <a name='10712'></font>
<font color=#447700>!<a name='10713'></font>
<font color=#447700>!    1) Standard, single forward model calculation (imca = 0)<a name='10714'></font>
<font color=#447700>!    2) Monte Carlo Independent Column Approximation (McICA, Pincus et al., <a name='10715'></font>
<font color=#447700>!       JC, 2003) method is applied to the forward model calculation (imca = 1)<a name='10716'></font>
<font color=#447700>!<a name='10717'></font>
<font color=#447700>! This call to RRTMG_LW must be preceeded by a call to the module<a name='10718'></font>
<font color=#447700>!     mcica_subcol_gen_lw.f90 to run the McICA sub-column cloud generator,<a name='10719'></font>
<font color=#447700>!     which will provide the cloud physical or cloud optical properties<a name='10720'></font>
<font color=#447700>!     on the RRTMG quadrature point (ngpt) dimension.<a name='10721'></font>
<font color=#447700>!     Two random number generators are available for use when imca = 1.<a name='10722'></font>
<font color=#447700>!     This is chosen by setting flag irnd on input to mcica_subcol_gen_lw.<a name='10723'></font>
<font color=#447700>!     1) KISSVEC (irnd = 0)<a name='10724'></font>
<font color=#447700>!     2) Mersenne-Twister (irnd = 1)<a name='10725'></font>
<font color=#447700>!<a name='10726'></font>
<font color=#447700>! Two methods of cloud property input are possible:<a name='10727'></font>
<font color=#447700>!     Cloud properties can be input in one of two ways (controlled by input <a name='10728'></font>
<font color=#447700>!     flags inflglw, iceflglw, and liqflglw; see text file rrtmg_lw_instructions<a name='10729'></font>
<font color=#447700>!     and subroutine rrtmg_lw_cldprop.f90 for further details):<a name='10730'></font>
<font color=#447700>!<a name='10731'></font>
<font color=#447700>!    1) Input cloud fraction and cloud optical depth directly (inflglw = 0)<a name='10732'></font>
<font color=#447700>!    2) Input cloud fraction and cloud physical properties (inflglw = 1 or 2);  <a name='10733'></font>
<font color=#447700>!       cloud optical properties are calculated by cldprop or cldprmc based<a name='10734'></font>
<font color=#447700>!       on input settings of iceflglw and liqflglw.  Ice particle size provided<a name='10735'></font>
<font color=#447700>!       must be appropriately defined for the ice parameterization selected. <a name='10736'></font>
<font color=#447700>!<a name='10737'></font>
<font color=#447700>! One method of aerosol property input is possible:<a name='10738'></font>
<font color=#447700>!     Aerosol properties can be input in only one way (controlled by input <a name='10739'></font>
<font color=#447700>!     flag iaer; see text file rrtmg_lw_instructions for further details):<a name='10740'></font>
<font color=#447700>!<a name='10741'></font>
<font color=#447700>!    1) Input aerosol optical depth directly by layer and spectral band (iaer=10);<a name='10742'></font>
<font color=#447700>!       band average optical depth at the mid-point of each spectral band.<a name='10743'></font>
<font color=#447700>!       RRTMG_LW currently treats only aerosol absorption;<a name='10744'></font>
<font color=#447700>!       scattering capability is not presently available.<a name='10745'></font>
<font color=#447700>!<a name='10746'></font>
<font color=#447700>!<a name='10747'></font>
<font color=#447700>! ------- Modifications -------<a name='10748'></font>
<font color=#447700>!<a name='10749'></font>
<font color=#447700>! This version of RRTMG_LW has been modified from RRTM_LW to use a reduced <a name='10750'></font>
<font color=#447700>! set of g-points for application to GCMs.  <a name='10751'></font>
<font color=#447700>!<a name='10752'></font>
<font color=#447700>!-- Original version (derived from RRTM_LW), reduction of g-points, other<a name='10753'></font>
<font color=#447700>!   revisions for use with GCMs.  <a name='10754'></font>
<font color=#447700>!     1999: M. J. Iacono, AER, Inc.<a name='10755'></font>
<font color=#447700>!-- Adapted for use with NCAR/CAM.<a name='10756'></font>
<font color=#447700>!     May 2004: M. J. Iacono, AER, Inc.<a name='10757'></font>
<font color=#447700>!-- Revised to add McICA capability. <a name='10758'></font>
<font color=#447700>!     Nov 2005: M. J. Iacono, AER, Inc.<a name='10759'></font>
<font color=#447700>!-- Conversion to F90 formatting for consistency with rrtmg_sw.<a name='10760'></font>
<font color=#447700>!     Feb 2007: M. J. Iacono, AER, Inc.<a name='10761'></font>
<font color=#447700>!-- Modifications to formatting to use assumed-shape arrays.<a name='10762'></font>
<font color=#447700>!     Aug 2007: M. J. Iacono, AER, Inc.<a name='10763'></font>
<font color=#447700>!-- Modified to add longwave aerosol absorption.<a name='10764'></font>
<font color=#447700>!     Apr 2008: M. J. Iacono, AER, Inc.<a name='10765'></font>
<a name='10766'>
<font color=#447700>! --------- Modules ----------<a name='10767'></font>
<a name='10768'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_41">, only : nbndlw, ngptlw, maxxsec, mxmol<a name='10769'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_5">, only: fluxfac, heatfac, oneminus, pi<a name='10770'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_7">, only: ng, ngb, nspa, nspb, wavenum1, wavenum2, delwave<a name='10771'>
<a name='10772'>
<font color=#447700>! ------- Declarations -------<a name='10773'></font>
<a name='10774'>
<font color=#447700>! ----- Input -----<a name='10775'></font>
      integer(kind=im), intent(in) :: ncol            <font color=#447700>! Number of horizontal columns<a name='10776'></font>
      integer(kind=im), intent(in) :: nlay            <font color=#447700>! Number of model layers<a name='10777'></font>
      integer(kind=im), intent(inout) :: icld         <font color=#447700>! Cloud overlap method<a name='10778'></font>
                                                      <font color=#447700>!    0: Clear only<a name='10779'></font>
                                                      <font color=#447700>!    1: Random<a name='10780'></font>
                                                      <font color=#447700>!    2: Maximum/random<a name='10781'></font>
                                                      <font color=#447700>!    3: Maximum<a name='10782'></font>
      real(kind=rb), intent(in) :: play(:,:)          <font color=#447700>! Layer pressures (hPa, mb)<a name='10783'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10784'></font>
      real(kind=rb), intent(in) :: plev(:,:)          <font color=#447700>! Interface pressures (hPa, mb)<a name='10785'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10786'></font>
      real(kind=rb), intent(in) :: tlay(:,:)          <font color=#447700>! Layer temperatures (K)<a name='10787'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10788'></font>
      real(kind=rb), intent(in) :: tlev(:,:)          <font color=#447700>! Interface temperatures (K)<a name='10789'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10790'></font>
      real(kind=rb), intent(in) :: tsfc(:)            <font color=#447700>! Surface temperature (K)<a name='10791'></font>
                                                      <font color=#447700>!    Dimensions: (ncol)<a name='10792'></font>
      real(kind=rb), intent(in) :: h2ovmr(:,:)        <font color=#447700>! H2O volume mixing ratio<a name='10793'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10794'></font>
      real(kind=rb), intent(in) :: o3vmr(:,:)         <font color=#447700>! O3 volume mixing ratio<a name='10795'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10796'></font>
      real(kind=rb), intent(in) :: co2vmr(:,:)        <font color=#447700>! CO2 volume mixing ratio<a name='10797'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10798'></font>
      real(kind=rb), intent(in) :: ch4vmr(:,:)        <font color=#447700>! Methane volume mixing ratio<a name='10799'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10800'></font>
      real(kind=rb), intent(in) :: n2ovmr(:,:)        <font color=#447700>! Nitrous oxide volume mixing ratio<a name='10801'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10802'></font>
      real(kind=rb), intent(in) :: o2vmr(:,:)         <font color=#447700>! Oxygen volume mixing ratio<a name='10803'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10804'></font>
      real(kind=rb), intent(in) :: cfc11vmr(:,:)      <font color=#447700>! CFC11 volume mixing ratio<a name='10805'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10806'></font>
      real(kind=rb), intent(in) :: cfc12vmr(:,:)      <font color=#447700>! CFC12 volume mixing ratio<a name='10807'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10808'></font>
      real(kind=rb), intent(in) :: cfc22vmr(:,:)      <font color=#447700>! CFC22 volume mixing ratio<a name='10809'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10810'></font>
      real(kind=rb), intent(in) :: ccl4vmr(:,:)       <font color=#447700>! CCL4 volume mixing ratio<a name='10811'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10812'></font>
      real(kind=rb), intent(in) :: emis(:,:)          <font color=#447700>! Surface emissivity<a name='10813'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='10814'></font>
<a name='10815'>
      integer(kind=im), intent(in) :: inflglw         <font color=#447700>! Flag for cloud optical properties<a name='10816'></font>
      integer(kind=im), intent(in) :: iceflglw        <font color=#447700>! Flag for ice particle specification<a name='10817'></font>
      integer(kind=im), intent(in) :: liqflglw        <font color=#447700>! Flag for liquid droplet specification<a name='10818'></font>
<a name='10819'>
      real(kind=rb), intent(in) :: cldfmcl(:,:,:)     <font color=#447700>! Cloud fraction<a name='10820'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10821'></font>
      real(kind=rb), intent(in) :: ciwpmcl(:,:,:)     <font color=#447700>! In-cloud ice water path (g/m2)<a name='10822'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10823'></font>
      real(kind=rb), intent(in) :: clwpmcl(:,:,:)     <font color=#447700>! In-cloud liquid water path (g/m2)<a name='10824'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10825'></font>
      real(kind=rb), intent(in) :: cswpmcl(:,:,:)     <font color=#447700>! In-cloud snow water path (g/m2)<a name='10826'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10827'></font>
      real(kind=rb), intent(in) :: reicmcl(:,:)       <font color=#447700>! Cloud ice particle effective size (microns)<a name='10828'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10829'></font>
                                                      <font color=#447700>! specific definition of reicmcl depends on setting of iceflglw:<a name='10830'></font>
                                                      <font color=#447700>! iceflglw = 0: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='10831'></font>
                                                      <font color=#447700>!               r_ec must be &gt;= 10.0 microns<a name='10832'></font>
                                                      <font color=#447700>! iceflglw = 1: ice effective radius, r_ec, (Ebert and Curry, 1992),<a name='10833'></font>
                                                      <font color=#447700>!               r_ec range is limited to 13.0 to 130.0 microns<a name='10834'></font>
                                                      <font color=#447700>! iceflglw = 2: ice effective radius, r_k, (Key, Streamer Ref. Manual, 1996)<a name='10835'></font>
                                                      <font color=#447700>!               r_k range is limited to 5.0 to 131.0 microns<a name='10836'></font>
                                                      <font color=#447700>! iceflglw = 3: generalized effective size, dge, (Fu, 1996),<a name='10837'></font>
                                                      <font color=#447700>!               dge range is limited to 5.0 to 140.0 microns<a name='10838'></font>
                                                      <font color=#447700>!               [dge = 1.0315 * r_ec]<a name='10839'></font>
      real(kind=rb), intent(in) :: relqmcl(:,:)       <font color=#447700>! Cloud water drop effective radius (microns)<a name='10840'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10841'></font>
      real(kind=rb), intent(in) :: resnmcl(:,:)       <font color=#447700>! Snow effective radius (microns)<a name='10842'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10843'></font>
      real(kind=rb), intent(in) :: taucmcl(:,:,:)     <font color=#447700>! In-cloud optical depth<a name='10844'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10845'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: ssacmcl(:,:,:)    ! In-cloud single scattering albedo<a name='10846'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10847'></font>
                                                      <font color=#447700>!   for future expansion<a name='10848'></font>
                                                      <font color=#447700>!   lw scattering not yet available<a name='10849'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: asmcmcl(:,:,:)    ! In-cloud asymmetry parameter<a name='10850'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='10851'></font>
                                                      <font color=#447700>!   for future expansion<a name='10852'></font>
                                                      <font color=#447700>!   lw scattering not yet available<a name='10853'></font>
      real(kind=rb), intent(in) :: tauaer(:,:,:)      <font color=#447700>! aerosol optical depth<a name='10854'></font>
                                                      <font color=#447700>!   at mid-point of LW spectral bands<a name='10855'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='10856'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: ssaaer(:,:,:)     ! aerosol single scattering albedo<a name='10857'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='10858'></font>
                                                      <font color=#447700>!   for future expansion <a name='10859'></font>
                                                      <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='10860'></font>
<font color=#447700>!      real(kind=rb), intent(in) :: asmaer(:,:,:)     ! aerosol asymmetry parameter<a name='10861'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='10862'></font>
                                                      <font color=#447700>!   for future expansion <a name='10863'></font>
                                                      <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='10864'></font>
<a name='10865'>
<font color=#447700>! ----- Output -----<a name='10866'></font>
<a name='10867'>
      real(kind=rb), intent(out) :: uflx(:,:)         <font color=#447700>! Total sky longwave upward flux (W/m2)<a name='10868'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10869'></font>
      real(kind=rb), intent(out) :: dflx(:,:)         <font color=#447700>! Total sky longwave downward flux (W/m2)<a name='10870'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10871'></font>
      real(kind=rb), intent(out) :: hr(:,:)           <font color=#447700>! Total sky longwave radiative heating rate (K/d)<a name='10872'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10873'></font>
      real(kind=rb), intent(out) :: uflxc(:,:)        <font color=#447700>! Clear sky longwave upward flux (W/m2)<a name='10874'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10875'></font>
      real(kind=rb), intent(out) :: dflxc(:,:)        <font color=#447700>! Clear sky longwave downward flux (W/m2)<a name='10876'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='10877'></font>
      real(kind=rb), intent(out) :: hrc(:,:)          <font color=#447700>! Clear sky longwave radiative heating rate (K/d)<a name='10878'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='10879'></font>
<a name='10880'>
<font color=#447700>! ----- Local -----<a name='10881'></font>
<a name='10882'>
<font color=#447700>! Control<a name='10883'></font>
      integer(kind=im) :: nlayers             <font color=#447700>! total number of layers<a name='10884'></font>
      integer(kind=im) :: istart              <font color=#447700>! beginning band of calculation<a name='10885'></font>
      integer(kind=im) :: iend                <font color=#447700>! ending band of calculation<a name='10886'></font>
      integer(kind=im) :: iout                <font color=#447700>! output option flag (inactive)<a name='10887'></font>
      integer(kind=im) :: iaer                <font color=#447700>! aerosol option flag<a name='10888'></font>
      integer(kind=im) :: iplon               <font color=#447700>! column loop index<a name='10889'></font>
      integer(kind=im) :: imca                <font color=#447700>! flag for mcica [0=off, 1=on]<a name='10890'></font>
      integer(kind=im) :: ims                 <font color=#447700>! value for changing mcica permute seed<a name='10891'></font>
      integer(kind=im) :: k                   <font color=#447700>! layer loop index<a name='10892'></font>
      integer(kind=im) :: ig                  <font color=#447700>! g-point loop index<a name='10893'></font>
<a name='10894'>
<font color=#447700>! Atmosphere<a name='10895'></font>
      real(kind=rb) :: pavel(nlay+1)          <font color=#447700>! layer pressures (mb) <a name='10896'></font>
      real(kind=rb) :: tavel(nlay+1)          <font color=#447700>! layer temperatures (K)<a name='10897'></font>
      real(kind=rb) :: pz(0:nlay+1)           <font color=#447700>! level (interface) pressures (hPa, mb)<a name='10898'></font>
      real(kind=rb) :: tz(0:nlay+1)           <font color=#447700>! level (interface) temperatures (K)<a name='10899'></font>
      real(kind=rb) :: tbound                 <font color=#447700>! surface temperature (K)<a name='10900'></font>
      real(kind=rb) :: coldry(nlay+1)         <font color=#447700>! dry air column density (mol/cm2)<a name='10901'></font>
      real(kind=rb) :: wbrodl(nlay+1)         <font color=#447700>! broadening gas column density (mol/cm2)<a name='10902'></font>
      real(kind=rb) :: wkl(mxmol,nlay+1)      <font color=#447700>! molecular amounts (mol/cm-2)<a name='10903'></font>
      real(kind=rb) :: wx(maxxsec,nlay+1)     <font color=#447700>! cross-section amounts (mol/cm-2)<a name='10904'></font>
      real(kind=rb) :: pwvcm                  <font color=#447700>! precipitable water vapor (cm)<a name='10905'></font>
      real(kind=rb) :: semiss(nbndlw)         <font color=#447700>! lw surface emissivity<a name='10906'></font>
      real(kind=rb) :: fracs(nlay+1,ngptlw)   <font color=#447700>! <a name='10907'></font>
      real(kind=rb) :: taug(nlay+1,ngptlw)    <font color=#447700>! gaseous optical depths<a name='10908'></font>
      real(kind=rb) :: taut(nlay+1,ngptlw)    <font color=#447700>! gaseous + aerosol optical depths<a name='10909'></font>
<a name='10910'>
      real(kind=rb) :: taua(nlay+1,nbndlw)    <font color=#447700>! aerosol optical depth<a name='10911'></font>
<font color=#447700>!      real(kind=rb) :: ssaa(nlay+1,nbndlw)   ! aerosol single scattering albedo<a name='10912'></font>
                                              <font color=#447700>!   for future expansion <a name='10913'></font>
                                              <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='10914'></font>
<font color=#447700>!      real(kind=rb) :: asma(nlay+1,nbndlw)   ! aerosol asymmetry parameter<a name='10915'></font>
                                              <font color=#447700>!   for future expansion <a name='10916'></font>
                                              <font color=#447700>!   (lw aerosols/scattering not yet available)<a name='10917'></font>
<a name='10918'>
<font color=#447700>! Atmosphere - setcoef<a name='10919'></font>
      integer(kind=im) :: laytrop             <font color=#447700>! tropopause layer index<a name='10920'></font>
      integer(kind=im) :: jp(nlay+1)          <font color=#447700>! lookup table index <a name='10921'></font>
      integer(kind=im) :: jt(nlay+1)          <font color=#447700>! lookup table index <a name='10922'></font>
      integer(kind=im) :: jt1(nlay+1)         <font color=#447700>! lookup table index <a name='10923'></font>
      real(kind=rb) :: planklay(nlay+1,nbndlw)<font color=#447700>! <a name='10924'></font>
      real(kind=rb) :: planklev(0:nlay+1,nbndlw)<font color=#447700>! <a name='10925'></font>
      real(kind=rb) :: plankbnd(nbndlw)       <font color=#447700>! <a name='10926'></font>
<a name='10927'>
      real(kind=rb) :: colh2o(nlay+1)         <font color=#447700>! column amount (h2o)<a name='10928'></font>
      real(kind=rb) :: colco2(nlay+1)         <font color=#447700>! column amount (co2)<a name='10929'></font>
      real(kind=rb) :: colo3(nlay+1)          <font color=#447700>! column amount (o3)<a name='10930'></font>
      real(kind=rb) :: coln2o(nlay+1)         <font color=#447700>! column amount (n2o)<a name='10931'></font>
      real(kind=rb) :: colco(nlay+1)          <font color=#447700>! column amount (co)<a name='10932'></font>
      real(kind=rb) :: colch4(nlay+1)         <font color=#447700>! column amount (ch4)<a name='10933'></font>
      real(kind=rb) :: colo2(nlay+1)          <font color=#447700>! column amount (o2)<a name='10934'></font>
      real(kind=rb) :: colbrd(nlay+1)         <font color=#447700>! column amount (broadening gases)<a name='10935'></font>
<a name='10936'>
      integer(kind=im) :: indself(nlay+1)<a name='10937'>
      integer(kind=im) :: indfor(nlay+1)<a name='10938'>
      real(kind=rb) :: selffac(nlay+1)<a name='10939'>
      real(kind=rb) :: selffrac(nlay+1)<a name='10940'>
      real(kind=rb) :: forfac(nlay+1)<a name='10941'>
      real(kind=rb) :: forfrac(nlay+1)<a name='10942'>
<a name='10943'>
      integer(kind=im) :: indminor(nlay+1)<a name='10944'>
      real(kind=rb) :: minorfrac(nlay+1)<a name='10945'>
      real(kind=rb) :: scaleminor(nlay+1)<a name='10946'>
      real(kind=rb) :: scaleminorn2(nlay+1)<a name='10947'>
<a name='10948'>
      real(kind=rb) :: &amp;                      <font color=#447700>!<a name='10949'></font>
                         fac00(nlay+1), fac01(nlay+1), &amp;<a name='10950'>
                         fac10(nlay+1), fac11(nlay+1) <a name='10951'>
      real(kind=rb) :: &amp;                      <font color=#447700>!<a name='10952'></font>
                         rat_h2oco2(nlay+1),rat_h2oco2_1(nlay+1), &amp;<a name='10953'>
                         rat_h2oo3(nlay+1),rat_h2oo3_1(nlay+1), &amp;<a name='10954'>
                         rat_h2on2o(nlay+1),rat_h2on2o_1(nlay+1), &amp;<a name='10955'>
                         rat_h2och4(nlay+1),rat_h2och4_1(nlay+1), &amp;<a name='10956'>
                         rat_n2oco2(nlay+1),rat_n2oco2_1(nlay+1), &amp;<a name='10957'>
                         rat_o3co2(nlay+1),rat_o3co2_1(nlay+1)<a name='10958'>
<a name='10959'>
<font color=#447700>! Atmosphere/clouds - cldprop<a name='10960'></font>
      integer(kind=im) :: ncbands             <font color=#447700>! number of cloud spectral bands<a name='10961'></font>
      integer(kind=im) :: inflag              <font color=#447700>! flag for cloud property method<a name='10962'></font>
      integer(kind=im) :: iceflag             <font color=#447700>! flag for ice cloud properties<a name='10963'></font>
      integer(kind=im) :: liqflag             <font color=#447700>! flag for liquid cloud properties<a name='10964'></font>
<a name='10965'>
<font color=#447700>! Atmosphere/clouds - cldprmc [mcica]<a name='10966'></font>
      real(kind=rb) :: cldfmc(ngptlw,nlay+1)  <font color=#447700>! cloud fraction [mcica]<a name='10967'></font>
      real(kind=rb) :: ciwpmc(ngptlw,nlay+1)  <font color=#447700>! in-cloud ice water path [mcica]<a name='10968'></font>
      real(kind=rb) :: clwpmc(ngptlw,nlay+1)  <font color=#447700>! in-cloud liquid water path [mcica]<a name='10969'></font>
      real(kind=rb) :: cswpmc(ngptlw,nlay+1)  <font color=#447700>! in-cloud snow path [mcica]<a name='10970'></font>
      real(kind=rb) :: relqmc(nlay+1)         <font color=#447700>! liquid particle effective radius (microns)<a name='10971'></font>
      real(kind=rb) :: reicmc(nlay+1)         <font color=#447700>! ice particle effective size (microns)<a name='10972'></font>
      real(kind=rb) :: resnmc(nlay+1)         <font color=#447700>! snow particle effective size (microns)<a name='10973'></font>
      real(kind=rb) :: taucmc(ngptlw,nlay+1)  <font color=#447700>! in-cloud optical depth [mcica]<a name='10974'></font>
<font color=#447700>!      real(kind=rb) :: ssacmc(ngptlw,nlay+1) ! in-cloud single scattering albedo [mcica]<a name='10975'></font>
                                              <font color=#447700>!   for future expansion <a name='10976'></font>
                                              <font color=#447700>!   (lw scattering not yet available)<a name='10977'></font>
<font color=#447700>!      real(kind=rb) :: asmcmc(ngptlw,nlay+1) ! in-cloud asymmetry parameter [mcica]<a name='10978'></font>
                                              <font color=#447700>!   for future expansion <a name='10979'></font>
                                              <font color=#447700>!   (lw scattering not yet available)<a name='10980'></font>
<a name='10981'>
<font color=#447700>! Output<a name='10982'></font>
      real(kind=rb) :: totuflux(0:nlay+1)     <font color=#447700>! upward longwave flux (w/m2)<a name='10983'></font>
      real(kind=rb) :: totdflux(0:nlay+1)     <font color=#447700>! downward longwave flux (w/m2)<a name='10984'></font>
      real(kind=rb) :: fnet(0:nlay+1)         <font color=#447700>! net longwave flux (w/m2)<a name='10985'></font>
      real(kind=rb) :: htr(0:nlay+1)          <font color=#447700>! longwave heating rate (k/day)<a name='10986'></font>
      real(kind=rb) :: totuclfl(0:nlay+1)     <font color=#447700>! clear sky upward longwave flux (w/m2)<a name='10987'></font>
      real(kind=rb) :: totdclfl(0:nlay+1)     <font color=#447700>! clear sky downward longwave flux (w/m2)<a name='10988'></font>
      real(kind=rb) :: fnetc(0:nlay+1)        <font color=#447700>! clear sky net longwave flux (w/m2)<a name='10989'></font>
      real(kind=rb) :: htrc(0:nlay+1)         <font color=#447700>! clear sky longwave heating rate (k/day)<a name='10990'></font>
<a name='10991'>
<font color=#447700>!<a name='10992'></font>
<font color=#447700>! Initializations<a name='10993'></font>
<a name='10994'>
<font color=#447700>!jm not thread safe      oneminus = 1._rb - 1.e-6_rb<a name='10995'></font>
<font color=#447700>!jm not thread safe      pi = 2._rb * asin(1._rb)<a name='10996'></font>
<font color=#447700>!jm not thread safe      fluxfac = pi * 2.e4_rb                  ! orig:   fluxfac = pi * 2.d4  <a name='10997'></font>
      istart = 1<a name='10998'>
      iend = 16<a name='10999'>
      iout = 0<a name='11000'>
      ims = 1<a name='11001'>
<a name='11002'>
<font color=#447700>! Set imca to select calculation type:<a name='11003'></font>
<font color=#447700>!  imca = 0, use standard forward model calculation<a name='11004'></font>
<font color=#447700>!  imca = 1, use McICA for Monte Carlo treatment of sub-grid cloud variability<a name='11005'></font>
<a name='11006'>
<font color=#447700>! *** This version uses McICA (imca = 1) ***<a name='11007'></font>
<a name='11008'>
<font color=#447700>! Set icld to select of clear or cloud calculation and cloud overlap method  <a name='11009'></font>
<font color=#447700>! icld = 0, clear only<a name='11010'></font>
<font color=#447700>! icld = 1, with clouds using random cloud overlap<a name='11011'></font>
<font color=#447700>! icld = 2, with clouds using maximum/random cloud overlap<a name='11012'></font>
<font color=#447700>! icld = 3, with clouds using maximum cloud overlap (McICA only)<a name='11013'></font>
      if (icld.lt.0.or.icld.gt.3) icld = 2<a name='11014'>
<a name='11015'>
<font color=#447700>! Set iaer to select aerosol option<a name='11016'></font>
<font color=#447700>! iaer = 0, no aerosols<a name='11017'></font>
<font color=#447700>! icld = 10, input total aerosol optical depth (tauaer) directly<a name='11018'></font>
      iaer = 10<a name='11019'>
<a name='11020'>
<font color=#447700>! Call model and data initialization, compute lookup tables, perform<a name='11021'></font>
<font color=#447700>! reduction of g-points from 256 to 140 for input absorption coefficient <a name='11022'></font>
<font color=#447700>! data and other arrays.<a name='11023'></font>
<font color=#447700>!<a name='11024'></font>
<font color=#447700>! In a GCM this call should be placed in the model initialization<a name='11025'></font>
<font color=#447700>! area, since this has to be called only once.  <a name='11026'></font>
<font color=#447700>!      call rrtmg_lw_ini(cpdair)<a name='11027'></font>
<a name='11028'>
<font color=#447700>!  This is the main longitude/column loop within RRTMG.<a name='11029'></font>
      do iplon = 1, ncol<a name='11030'>
<a name='11031'>
<font color=#447700>!  Prepare atmospheric profile from GCM for use in RRTMG, and define<a name='11032'></font>
<font color=#447700>!  other input parameters.  <a name='11033'></font>
<a name='11034'>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM'>inatm</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INATM_1"> (iplon, nlay, icld, iaer, &amp;<a name='11035'>
              play, plev, tlay, tlev, tsfc, h2ovmr, &amp;<a name='11036'>
              o3vmr, co2vmr, ch4vmr, n2ovmr, o2vmr, cfc11vmr, cfc12vmr, &amp;<a name='11037'>
              cfc22vmr, ccl4vmr, emis, inflglw, iceflglw, liqflglw, &amp;<a name='11038'>
              cldfmcl, taucmcl, ciwpmcl, clwpmcl, cswpmcl, reicmcl, relqmcl, resnmcl, tauaer, &amp;<a name='11039'>
              nlayers, pavel, pz, tavel, tz, tbound, semiss, coldry, &amp;<a name='11040'>
              wkl, wbrodl, wx, pwvcm, inflag, iceflag, liqflag, &amp;<a name='11041'>
              cldfmc, taucmc, ciwpmc, clwpmc, cswpmc, reicmc, relqmc, resnmc, taua)<a name='11042'>
<a name='11043'>
<font color=#447700>!  For cloudy atmosphere, use cldprop to set cloud optical properties based on<a name='11044'></font>
<font color=#447700>!  input cloud physical properties.  Select method based on choices described<a name='11045'></font>
<font color=#447700>!  in cldprop.  Cloud fraction, water path, liquid droplet and ice particle<a name='11046'></font>
<font color=#447700>!  effective radius must be passed into cldprop.  Cloud fraction and cloud<a name='11047'></font>
<font color=#447700>!  optical depth are transferred to rrtmg_lw arrays in cldprop.  <a name='11048'></font>
<a name='11049'>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#CLDPRMC'>cldprmc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLDPRMC_1">(nlayers, inflag, iceflag, liqflag, cldfmc, ciwpmc, &amp;<a name='11050'>
                      clwpmc, cswpmc, reicmc, relqmc, resnmc, ncbands, taucmc)<a name='11051'>
<a name='11052'>
<font color=#447700>! Calculate information needed by the radiative transfer routine<a name='11053'></font>
<font color=#447700>! that is specific to this atmosphere, especially some of the <a name='11054'></font>
<font color=#447700>! coefficients and indices needed to compute the optical depths<a name='11055'></font>
<font color=#447700>! by interpolating data from stored reference atmospheres. <a name='11056'></font>
<a name='11057'>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#SETCOEF'>setcoef</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETCOEF_2">(nlayers, istart, pavel, tavel, tz, tbound, semiss, &amp;<a name='11058'>
                      coldry, wkl, wbrodl, &amp;<a name='11059'>
                      laytrop, jp, jt, jt1, planklay, planklev, plankbnd, &amp;<a name='11060'>
                      colh2o, colco2, colo3, coln2o, colco, colch4, colo2, &amp;<a name='11061'>
                      colbrd, fac00, fac01, fac10, fac11, &amp;<a name='11062'>
                      rat_h2oco2, rat_h2oco2_1, rat_h2oo3, rat_h2oo3_1, &amp;<a name='11063'>
                      rat_h2on2o, rat_h2on2o_1, rat_h2och4, rat_h2och4_1, &amp;<a name='11064'>
                      rat_n2oco2, rat_n2oco2_1, rat_o3co2, rat_o3co2_1, &amp;<a name='11065'>
                      selffac, selffrac, indself, forfac, forfrac, indfor, &amp;<a name='11066'>
                      minorfrac, scaleminor, scaleminorn2, indminor)<a name='11067'>
<a name='11068'>
<font color=#447700>!  Calculate the gaseous optical depths and Planck fractions for <a name='11069'></font>
<font color=#447700>!  each longwave spectral band.<a name='11070'></font>
<a name='11071'>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#TAUMOL'>taumol</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TAUMOL_1">(nlayers, pavel, wx, coldry, &amp;<a name='11072'>
                     laytrop, jp, jt, jt1, planklay, planklev, plankbnd, &amp;<a name='11073'>
                     colh2o, colco2, colo3, coln2o, colco, colch4, colo2, &amp;<a name='11074'>
                     colbrd, fac00, fac01, fac10, fac11, &amp;<a name='11075'>
                     rat_h2oco2, rat_h2oco2_1, rat_h2oo3, rat_h2oo3_1, &amp;<a name='11076'>
                     rat_h2on2o, rat_h2on2o_1, rat_h2och4, rat_h2och4_1, &amp;<a name='11077'>
                     rat_n2oco2, rat_n2oco2_1, rat_o3co2, rat_o3co2_1, &amp;<a name='11078'>
                     selffac, selffrac, indself, forfac, forfrac, indfor, &amp;<a name='11079'>
                     minorfrac, scaleminor, scaleminorn2, indminor, &amp;<a name='11080'>
                     fracs, taug)<a name='11081'>
<a name='11082'>
<a name='11083'>
<font color=#447700>! Combine gaseous and aerosol optical depths, if aerosol active<a name='11084'></font>
         if (iaer .eq. 0) then<a name='11085'>
            do k = 1, nlayers<a name='11086'>
               do ig = 1, ngptlw<a name='11087'>
                  taut(k,ig) = taug(k,ig)<a name='11088'>
               enddo<a name='11089'>
            enddo<a name='11090'>
         elseif (iaer .eq. 10) then<a name='11091'>
            do k = 1, nlayers<a name='11092'>
               do ig = 1, ngptlw<a name='11093'>
                  taut(k,ig) = taug(k,ig) + taua(k,ngb(ig))<a name='11094'>
               enddo<a name='11095'>
            enddo<a name='11096'>
         endif<a name='11097'>
<a name='11098'>
<font color=#447700>! Call the radiative transfer routine.<a name='11099'></font>
<font color=#447700>! Either routine can be called to do clear sky calculation.  If clouds<a name='11100'></font>
<font color=#447700>! are present, then select routine based on cloud overlap assumption<a name='11101'></font>
<font color=#447700>! to be used.  Clear sky calculation is done simultaneously.<a name='11102'></font>
<font color=#447700>! For McICA, RTRNMC is called for clear and cloudy calculations.<a name='11103'></font>
<a name='11104'>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RTRNMC'>rtrnmc</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RTRNMC_1">(nlayers, istart, iend, iout, pz, semiss, ncbands, &amp;<a name='11105'>
                     cldfmc, taucmc, planklay, planklev, plankbnd, &amp;<a name='11106'>
                     pwvcm, fracs, taut, &amp;<a name='11107'>
                     totuflux, totdflux, fnet, htr, &amp;<a name='11108'>
                     totuclfl, totdclfl, fnetc, htrc )<a name='11109'>
<a name='11110'>
<font color=#447700>!  Transfer up and down fluxes and heating rate to output arrays.<a name='11111'></font>
<font color=#447700>!  Vertical indexing goes from bottom to top; reverse here for GCM if necessary.<a name='11112'></font>
<a name='11113'>
         do k = 0, nlayers<a name='11114'>
            uflx(iplon,k+1) = totuflux(k)<a name='11115'>
            dflx(iplon,k+1) = totdflux(k)<a name='11116'>
            uflxc(iplon,k+1) = totuclfl(k)<a name='11117'>
            dflxc(iplon,k+1) = totdclfl(k)<a name='11118'>
         enddo<a name='11119'>
         do k = 0, nlayers-1<a name='11120'>
            hr(iplon,k+1) = htr(k)<a name='11121'>
            hrc(iplon,k+1) = htrc(k)<a name='11122'>
         enddo<a name='11123'>
<a name='11124'>
      enddo<a name='11125'>
<a name='11126'>
      end subroutine rrtmg_lw<a name='11127'>
<a name='11128'>
<font color=#447700>!***************************************************************************<a name='11129'></font>
<A NAME='INATM'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11130'>
      <font color=#993300>subroutine </font><font color=#cc0000>inatm</font> (iplon, nlay, icld, iaer, &amp; <A href='../../call_to/INATM.html' TARGET='index'>1</A>,<A href='../../call_from/INATM.html' TARGET='index'>11</A><a name='11131'>
              play, plev, tlay, tlev, tsfc, h2ovmr, &amp;<a name='11132'>
              o3vmr, co2vmr, ch4vmr, n2ovmr, o2vmr, cfc11vmr, cfc12vmr, &amp;<a name='11133'>
              cfc22vmr, ccl4vmr, emis, inflglw, iceflglw, liqflglw, &amp;<a name='11134'>
              cldfmcl, taucmcl, ciwpmcl, clwpmcl, cswpmcl, reicmcl, relqmcl, resnmcl, tauaer, &amp;<a name='11135'>
              nlayers, pavel, pz, tavel, tz, tbound, semiss, coldry, &amp;<a name='11136'>
              wkl, wbrodl, wx, pwvcm, inflag, iceflag, liqflag, &amp;<a name='11137'>
              cldfmc, taucmc, ciwpmc, clwpmc, cswpmc, reicmc, relqmc, resnmc, taua)<a name='11138'>
<font color=#447700>!***************************************************************************<a name='11139'></font>
<font color=#447700>!<a name='11140'></font>
<font color=#447700>!  Input atmospheric profile from GCM, and prepare it for use in RRTMG_LW.<a name='11141'></font>
<font color=#447700>!  Set other RRTMG_LW input parameters.  <a name='11142'></font>
<font color=#447700>!<a name='11143'></font>
<font color=#447700>!***************************************************************************<a name='11144'></font>
<a name='11145'>
<font color=#447700>! --------- Modules ----------<a name='11146'></font>
<a name='11147'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_42">, only : nbndlw, ngptlw, nmol, maxxsec, mxmol<a name='11148'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_CON'>rrlw_con</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_CON_6">, only: fluxfac, heatfac, oneminus, pi, grav, avogad<a name='11149'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_WVN'>rrlw_wvn</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_WVN_8">, only: ng, nspa, nspb, wavenum1, wavenum2, delwave, ixindx<a name='11150'>
<a name='11151'>
<font color=#447700>! ------- Declarations -------<a name='11152'></font>
<a name='11153'>
<font color=#447700>! ----- Input -----<a name='11154'></font>
      integer(kind=im), intent(in) :: iplon           <font color=#447700>! column loop index<a name='11155'></font>
      integer(kind=im), intent(in) :: nlay            <font color=#447700>! Number of model layers<a name='11156'></font>
      integer(kind=im), intent(in) :: icld            <font color=#447700>! clear/cloud and cloud overlap flag<a name='11157'></font>
      integer(kind=im), intent(in) :: iaer            <font color=#447700>! aerosol option flag<a name='11158'></font>
<a name='11159'>
      real(kind=rb), intent(in) :: play(:,:)          <font color=#447700>! Layer pressures (hPa, mb)<a name='11160'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11161'></font>
      real(kind=rb), intent(in) :: plev(:,:)          <font color=#447700>! Interface pressures (hPa, mb)<a name='11162'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='11163'></font>
      real(kind=rb), intent(in) :: tlay(:,:)          <font color=#447700>! Layer temperatures (K)<a name='11164'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11165'></font>
      real(kind=rb), intent(in) :: tlev(:,:)          <font color=#447700>! Interface temperatures (K)<a name='11166'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay+1)<a name='11167'></font>
      real(kind=rb), intent(in) :: tsfc(:)            <font color=#447700>! Surface temperature (K)<a name='11168'></font>
                                                      <font color=#447700>!    Dimensions: (ncol)<a name='11169'></font>
      real(kind=rb), intent(in) :: h2ovmr(:,:)        <font color=#447700>! H2O volume mixing ratio<a name='11170'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11171'></font>
      real(kind=rb), intent(in) :: o3vmr(:,:)         <font color=#447700>! O3 volume mixing ratio<a name='11172'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11173'></font>
      real(kind=rb), intent(in) :: co2vmr(:,:)        <font color=#447700>! CO2 volume mixing ratio<a name='11174'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11175'></font>
      real(kind=rb), intent(in) :: ch4vmr(:,:)        <font color=#447700>! Methane volume mixing ratio<a name='11176'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11177'></font>
      real(kind=rb), intent(in) :: n2ovmr(:,:)        <font color=#447700>! Nitrous oxide volume mixing ratio<a name='11178'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11179'></font>
      real(kind=rb), intent(in) :: o2vmr(:,:)         <font color=#447700>! Oxygen volume mixing ratio<a name='11180'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11181'></font>
      real(kind=rb), intent(in) :: cfc11vmr(:,:)      <font color=#447700>! CFC11 volume mixing ratio<a name='11182'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11183'></font>
      real(kind=rb), intent(in) :: cfc12vmr(:,:)      <font color=#447700>! CFC12 volume mixing ratio<a name='11184'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11185'></font>
      real(kind=rb), intent(in) :: cfc22vmr(:,:)      <font color=#447700>! CFC22 volume mixing ratio<a name='11186'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11187'></font>
      real(kind=rb), intent(in) :: ccl4vmr(:,:)       <font color=#447700>! CCL4 volume mixing ratio<a name='11188'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11189'></font>
      real(kind=rb), intent(in) :: emis(:,:)          <font color=#447700>! Surface emissivity<a name='11190'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nbndlw)<a name='11191'></font>
<a name='11192'>
      integer(kind=im), intent(in) :: inflglw         <font color=#447700>! Flag for cloud optical properties<a name='11193'></font>
      integer(kind=im), intent(in) :: iceflglw        <font color=#447700>! Flag for ice particle specification<a name='11194'></font>
      integer(kind=im), intent(in) :: liqflglw        <font color=#447700>! Flag for liquid droplet specification<a name='11195'></font>
<a name='11196'>
      real(kind=rb), intent(in) :: cldfmcl(:,:,:)     <font color=#447700>! Cloud fraction<a name='11197'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='11198'></font>
      real(kind=rb), intent(in) :: ciwpmcl(:,:,:)     <font color=#447700>! In-cloud ice water path (g/m2)<a name='11199'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='11200'></font>
      real(kind=rb), intent(in) :: clwpmcl(:,:,:)     <font color=#447700>! In-cloud liquid water path (g/m2)<a name='11201'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='11202'></font>
      real(kind=rb), intent(in) :: cswpmcl(:,:,:)     <font color=#447700>! In-cloud snow water path (g/m2)<a name='11203'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='11204'></font>
      real(kind=rb), intent(in) :: relqmcl(:,:)       <font color=#447700>! Cloud water drop effective radius (microns)<a name='11205'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11206'></font>
      real(kind=rb), intent(in) :: reicmcl(:,:)       <font color=#447700>! Cloud ice effective size (microns)<a name='11207'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11208'></font>
      real(kind=rb), intent(in) :: resnmcl(:,:)       <font color=#447700>! Snow effective size (microns)<a name='11209'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay)<a name='11210'></font>
      real(kind=rb), intent(in) :: taucmcl(:,:,:)     <font color=#447700>! In-cloud optical depth<a name='11211'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,ncol,nlay)<a name='11212'></font>
      real(kind=rb), intent(in) :: tauaer(:,:,:)      <font color=#447700>! Aerosol optical depth<a name='11213'></font>
                                                      <font color=#447700>!    Dimensions: (ncol,nlay,nbndlw)<a name='11214'></font>
<a name='11215'>
<font color=#447700>! ----- Output -----<a name='11216'></font>
<font color=#447700>! Atmosphere<a name='11217'></font>
      integer(kind=im), intent(out) :: nlayers        <font color=#447700>! number of layers<a name='11218'></font>
<a name='11219'>
      real(kind=rb), intent(out) :: pavel(:)          <font color=#447700>! layer pressures (mb) <a name='11220'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11221'></font>
      real(kind=rb), intent(out) :: tavel(:)          <font color=#447700>! layer temperatures (K)<a name='11222'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11223'></font>
      real(kind=rb), intent(out) :: pz(0:)            <font color=#447700>! level (interface) pressures (hPa, mb)<a name='11224'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlay)<a name='11225'></font>
      real(kind=rb), intent(out) :: tz(0:)            <font color=#447700>! level (interface) temperatures (K)<a name='11226'></font>
                                                      <font color=#447700>!    Dimensions: (0:nlay)<a name='11227'></font>
      real(kind=rb), intent(out) :: tbound            <font color=#447700>! surface temperature (K)<a name='11228'></font>
      real(kind=rb), intent(out) :: coldry(:)         <font color=#447700>! dry air column density (mol/cm2)<a name='11229'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11230'></font>
      real(kind=rb), intent(out) :: wbrodl(:)         <font color=#447700>! broadening gas column density (mol/cm2)<a name='11231'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11232'></font>
      real(kind=rb), intent(out) :: wkl(:,:)          <font color=#447700>! molecular amounts (mol/cm-2)<a name='11233'></font>
                                                      <font color=#447700>!    Dimensions: (mxmol,nlay)<a name='11234'></font>
      real(kind=rb), intent(out) :: wx(:,:)           <font color=#447700>! cross-section amounts (mol/cm-2)<a name='11235'></font>
                                                      <font color=#447700>!    Dimensions: (maxxsec,nlay)<a name='11236'></font>
      real(kind=rb), intent(out) :: pwvcm             <font color=#447700>! precipitable water vapor (cm)<a name='11237'></font>
      real(kind=rb), intent(out) :: semiss(:)         <font color=#447700>! lw surface emissivity<a name='11238'></font>
                                                      <font color=#447700>!    Dimensions: (nbndlw)<a name='11239'></font>
<a name='11240'>
<font color=#447700>! Atmosphere/clouds - cldprop<a name='11241'></font>
      integer(kind=im), intent(out) :: inflag         <font color=#447700>! flag for cloud property method<a name='11242'></font>
      integer(kind=im), intent(out) :: iceflag        <font color=#447700>! flag for ice cloud properties<a name='11243'></font>
      integer(kind=im), intent(out) :: liqflag        <font color=#447700>! flag for liquid cloud properties<a name='11244'></font>
<a name='11245'>
      real(kind=rb), intent(out) :: cldfmc(:,:)       <font color=#447700>! cloud fraction [mcica]<a name='11246'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlay)<a name='11247'></font>
      real(kind=rb), intent(out) :: ciwpmc(:,:)       <font color=#447700>! in-cloud ice water path [mcica]<a name='11248'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlay)<a name='11249'></font>
      real(kind=rb), intent(out) :: clwpmc(:,:)       <font color=#447700>! in-cloud liquid water path [mcica]<a name='11250'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlay)<a name='11251'></font>
      real(kind=rb), intent(out) :: cswpmc(:,:)       <font color=#447700>! in-cloud snow path [mcica]<a name='11252'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlay)<a name='11253'></font>
      real(kind=rb), intent(out) :: relqmc(:)         <font color=#447700>! liquid particle effective radius (microns)<a name='11254'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11255'></font>
      real(kind=rb), intent(out) :: reicmc(:)         <font color=#447700>! ice particle effective size (microns)<a name='11256'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11257'></font>
      real(kind=rb), intent(out) :: resnmc(:)         <font color=#447700>! snow effective size (microns)<a name='11258'></font>
                                                      <font color=#447700>!    Dimensions: (nlay)<a name='11259'></font>
      real(kind=rb), intent(out) :: taucmc(:,:)       <font color=#447700>! in-cloud optical depth [mcica]<a name='11260'></font>
                                                      <font color=#447700>!    Dimensions: (ngptlw,nlay)<a name='11261'></font>
      real(kind=rb), intent(out) :: taua(:,:)         <font color=#447700>! aerosol optical depth<a name='11262'></font>
                                                      <font color=#447700>!    Dimensions: (nlay,nbndlw)<a name='11263'></font>
<a name='11264'>
<a name='11265'>
<font color=#447700>! ----- Local -----<a name='11266'></font>
      real(kind=rb), parameter :: amd = 28.9660_rb    <font color=#447700>! Effective molecular weight of dry air (g/mol)<a name='11267'></font>
      real(kind=rb), parameter :: amw = 18.0160_rb    <font color=#447700>! Molecular weight of water vapor (g/mol)<a name='11268'></font>
<font color=#447700>!      real(kind=rb), parameter :: amc = 44.0098_rb    ! Molecular weight of carbon dioxide (g/mol)<a name='11269'></font>
<font color=#447700>!      real(kind=rb), parameter :: amo = 47.9998_rb    ! Molecular weight of ozone (g/mol)<a name='11270'></font>
<font color=#447700>!      real(kind=rb), parameter :: amo2 = 31.9999_rb   ! Molecular weight of oxygen (g/mol)<a name='11271'></font>
<font color=#447700>!      real(kind=rb), parameter :: amch4 = 16.0430_rb  ! Molecular weight of methane (g/mol)<a name='11272'></font>
<font color=#447700>!      real(kind=rb), parameter :: amn2o = 44.0128_rb  ! Molecular weight of nitrous oxide (g/mol)<a name='11273'></font>
<font color=#447700>!      real(kind=rb), parameter :: amc11 = 137.3684_rb ! Molecular weight of CFC11 (g/mol) - CCL3F<a name='11274'></font>
<font color=#447700>!      real(kind=rb), parameter :: amc12 = 120.9138_rb ! Molecular weight of CFC12 (g/mol) - CCL2F2<a name='11275'></font>
<font color=#447700>!      real(kind=rb), parameter :: amc22 = 86.4688_rb  ! Molecular weight of CFC22 (g/mol) - CHCLF2<a name='11276'></font>
<font color=#447700>!      real(kind=rb), parameter :: amcl4 = 153.823_rb  ! Molecular weight of CCL4 (g/mol) - CCL4<a name='11277'></font>
<a name='11278'>
<font color=#447700>! Set molecular weight ratios (for converting mmr to vmr)<a name='11279'></font>
<font color=#447700>!  e.g. h2ovmr = h2ommr * amdw)<a name='11280'></font>
      real(kind=rb), parameter :: amdw = 1.607793_rb  <font color=#447700>! Molecular weight of dry air / water vapor<a name='11281'></font>
      real(kind=rb), parameter :: amdc = 0.658114_rb  <font color=#447700>! Molecular weight of dry air / carbon dioxide<a name='11282'></font>
      real(kind=rb), parameter :: amdo = 0.603428_rb  <font color=#447700>! Molecular weight of dry air / ozone<a name='11283'></font>
      real(kind=rb), parameter :: amdm = 1.805423_rb  <font color=#447700>! Molecular weight of dry air / methane<a name='11284'></font>
      real(kind=rb), parameter :: amdn = 0.658090_rb  <font color=#447700>! Molecular weight of dry air / nitrous oxide<a name='11285'></font>
      real(kind=rb), parameter :: amdo2 = 0.905140_rb <font color=#447700>! Molecular weight of dry air / oxygen<a name='11286'></font>
      real(kind=rb), parameter :: amdc1 = 0.210852_rb <font color=#447700>! Molecular weight of dry air / CFC11<a name='11287'></font>
      real(kind=rb), parameter :: amdc2 = 0.239546_rb <font color=#447700>! Molecular weight of dry air / CFC12<a name='11288'></font>
<a name='11289'>
      integer(kind=im) :: isp, l, ix, n, imol, ib, ig   <font color=#447700>! Loop indices<a name='11290'></font>
      real(kind=rb) :: amm, amttl, wvttl, wvsh, summol  <a name='11291'>
<a name='11292'>
<font color=#447700>! Add one to nlayers here to include extra model layer at top of atmosphere<a name='11293'></font>
      nlayers = nlay<a name='11294'>
<a name='11295'>
<font color=#447700>!  Initialize all molecular amounts and cloud properties to zero here, then pass input amounts<a name='11296'></font>
<font color=#447700>!  into RRTM arrays below.<a name='11297'></font>
<a name='11298'>
      wkl(:,:) = 0.0_rb<a name='11299'>
      wx(:,:) = 0.0_rb<a name='11300'>
      cldfmc(:,:) = 0.0_rb<a name='11301'>
      taucmc(:,:) = 0.0_rb<a name='11302'>
      ciwpmc(:,:) = 0.0_rb<a name='11303'>
      clwpmc(:,:) = 0.0_rb<a name='11304'>
      cswpmc(:,:) = 0.0_rb<a name='11305'>
      reicmc(:) = 0.0_rb<a name='11306'>
      relqmc(:) = 0.0_rb<a name='11307'>
      resnmc(:) = 0.0_rb<a name='11308'>
      taua(:,:) = 0.0_rb<a name='11309'>
      amttl = 0.0_rb<a name='11310'>
      wvttl = 0.0_rb<a name='11311'>
 <a name='11312'>
<font color=#447700>!  Set surface temperature.<a name='11313'></font>
      tbound = tsfc(iplon)<a name='11314'>
<a name='11315'>
<font color=#447700>!  Install input GCM arrays into RRTMG_LW arrays for pressure, temperature,<a name='11316'></font>
<font color=#447700>!  and molecular amounts.  <a name='11317'></font>
<font color=#447700>!  Pressures are input in mb, or are converted to mb here.<a name='11318'></font>
<font color=#447700>!  Molecular amounts are input in volume mixing ratio, or are converted from <a name='11319'></font>
<font color=#447700>!  mass mixing ratio (or specific humidity for h2o) to volume mixing ratio<a name='11320'></font>
<font color=#447700>!  here. These are then converted to molecular amount (molec/cm2) below.  <a name='11321'></font>
<font color=#447700>!  The dry air column COLDRY (in molec/cm2) is calculated from the level <a name='11322'></font>
<font color=#447700>!  pressures, pz (in mb), based on the hydrostatic equation and includes a <a name='11323'></font>
<font color=#447700>!  correction to account for h2o in the layer.  The molecular weight of moist <a name='11324'></font>
<font color=#447700>!  air (amm) is calculated for each layer.  <a name='11325'></font>
<font color=#447700>!  Note: In RRTMG, layer indexing goes from bottom to top, and coding below<a name='11326'></font>
<font color=#447700>!  assumes GCM input fields are also bottom to top. Input layer indexing<a name='11327'></font>
<font color=#447700>!  from GCM fields should be reversed here if necessary.<a name='11328'></font>
<a name='11329'>
      pz(0) = plev(iplon,1)<a name='11330'>
      tz(0) = tlev(iplon,1)<a name='11331'>
      do l = 1, nlayers<a name='11332'>
         pavel(l) = play(iplon,l)<a name='11333'>
         tavel(l) = tlay(iplon,l)<a name='11334'>
         pz(l) = plev(iplon,l+1)<a name='11335'>
         tz(l) = tlev(iplon,l+1)<a name='11336'>
<font color=#447700>! For h2o input in vmr:<a name='11337'></font>
         wkl(1,l) = h2ovmr(iplon,l)<a name='11338'>
<font color=#447700>! For h2o input in mmr:<a name='11339'></font>
<font color=#447700>!         wkl(1,l) = h2o(iplon,l)*amdw<a name='11340'></font>
<font color=#447700>! For h2o input in specific humidity;<a name='11341'></font>
<font color=#447700>!         wkl(1,l) = (h2o(iplon,l)/(1._rb - h2o(iplon,l)))*amdw<a name='11342'></font>
         wkl(2,l) = co2vmr(iplon,l)<a name='11343'>
         wkl(3,l) = o3vmr(iplon,l)<a name='11344'>
         wkl(4,l) = n2ovmr(iplon,l)<a name='11345'>
         wkl(6,l) = ch4vmr(iplon,l)<a name='11346'>
         wkl(7,l) = o2vmr(iplon,l)<a name='11347'>
         amm = (1._rb - wkl(1,l)) * amd + wkl(1,l) * amw            <a name='11348'>
         coldry(l) = (pz(l-1)-pz(l)) * 1.e3_rb * avogad / &amp;<a name='11349'>
                     (1.e2_rb * grav * amm * (1._rb + wkl(1,l)))<a name='11350'>
      enddo<a name='11351'>
<a name='11352'>
<font color=#447700>! Set cross section molecule amounts from input; convert to vmr if necessary<a name='11353'></font>
      do l=1, nlayers<a name='11354'>
         wx(1,l) = ccl4vmr(iplon,l)<a name='11355'>
         wx(2,l) = cfc11vmr(iplon,l)<a name='11356'>
         wx(3,l) = cfc12vmr(iplon,l)<a name='11357'>
         wx(4,l) = cfc22vmr(iplon,l)<a name='11358'>
      enddo      <a name='11359'>
<a name='11360'>
<font color=#447700>! The following section can be used to set values for an additional layer (from<a name='11361'></font>
<font color=#447700>! the GCM top level to 1.e-4 mb) for improved calculation of TOA fluxes. <a name='11362'></font>
<font color=#447700>! Temperature and molecular amounts in the extra model layer are set to <a name='11363'></font>
<font color=#447700>! their values in the top GCM model layer, though these can be modified<a name='11364'></font>
<font color=#447700>! here if necessary. <a name='11365'></font>
<font color=#447700>! If this feature is utilized, increase nlayers by one above, limit the two<a name='11366'></font>
<font color=#447700>! loops above to (nlayers-1), and set the top most (extra) layer values here. <a name='11367'></font>
<a name='11368'>
<font color=#447700>!      pavel(nlayers) = 0.5_rb * pz(nlayers-1)<a name='11369'></font>
<font color=#447700>!      tavel(nlayers) = tavel(nlayers-1)<a name='11370'></font>
<font color=#447700>!      pz(nlayers) = 1.e-4_rb<a name='11371'></font>
<font color=#447700>!      tz(nlayers-1) = 0.5_rb * (tavel(nlayers)+tavel(nlayers-1))<a name='11372'></font>
<font color=#447700>!      tz(nlayers) = tz(nlayers-1)<a name='11373'></font>
<font color=#447700>!      wkl(1,nlayers) = wkl(1,nlayers-1)<a name='11374'></font>
<font color=#447700>!      wkl(2,nlayers) = wkl(2,nlayers-1)<a name='11375'></font>
<font color=#447700>!      wkl(3,nlayers) = wkl(3,nlayers-1)<a name='11376'></font>
<font color=#447700>!      wkl(4,nlayers) = wkl(4,nlayers-1)<a name='11377'></font>
<font color=#447700>!      wkl(6,nlayers) = wkl(6,nlayers-1)<a name='11378'></font>
<font color=#447700>!      wkl(7,nlayers) = wkl(7,nlayers-1)<a name='11379'></font>
<font color=#447700>!      amm = (1._rb - wkl(1,nlayers-1)) * amd + wkl(1,nlayers-1) * amw<a name='11380'></font>
<font color=#447700>!      coldry(nlayers) = (pz(nlayers-1)) * 1.e3_rb * avogad / &amp;<a name='11381'></font>
<font color=#447700>!                        (1.e2_rb * grav * amm * (1._rb + wkl(1,nlayers-1)))<a name='11382'></font>
<font color=#447700>!      wx(1,nlayers) = wx(1,nlayers-1)<a name='11383'></font>
<font color=#447700>!      wx(2,nlayers) = wx(2,nlayers-1)<a name='11384'></font>
<font color=#447700>!      wx(3,nlayers) = wx(3,nlayers-1)<a name='11385'></font>
<font color=#447700>!      wx(4,nlayers) = wx(4,nlayers-1)<a name='11386'></font>
<a name='11387'>
<font color=#447700>! At this point all molecular amounts in wkl and wx are in volume mixing ratio; <a name='11388'></font>
<font color=#447700>! convert to molec/cm2 based on coldry for use in rrtm.  also, compute precipitable<a name='11389'></font>
<font color=#447700>! water vapor for diffusivity angle adjustments in rtrn and rtrnmr.<a name='11390'></font>
<a name='11391'>
      do l = 1, nlayers<a name='11392'>
         summol = 0.0_rb<a name='11393'>
         do imol = 2, nmol<a name='11394'>
            summol = summol + wkl(imol,l)<a name='11395'>
         enddo<a name='11396'>
         wbrodl(l) = coldry(l) * (1._rb - summol)<a name='11397'>
         do imol = 1, nmol<a name='11398'>
            wkl(imol,l) = coldry(l) * wkl(imol,l)<a name='11399'>
         enddo<a name='11400'>
         amttl = amttl + coldry(l)+wkl(1,l)<a name='11401'>
         wvttl = wvttl + wkl(1,l)<a name='11402'>
         do ix = 1,maxxsec<a name='11403'>
            if (ixindx(ix) .ne. 0) then<a name='11404'>
               wx(ixindx(ix),l) = coldry(l) * wx(ix,l) * 1.e-20_rb<a name='11405'>
            endif<a name='11406'>
         enddo<a name='11407'>
      enddo<a name='11408'>
<a name='11409'>
      wvsh = (amw * wvttl) / (amd * amttl)<a name='11410'>
      pwvcm = wvsh * (1.e3_rb * pz(0)) / (1.e2_rb * grav)<a name='11411'>
<a name='11412'>
<font color=#447700>! Set spectral surface emissivity for each longwave band.  <a name='11413'></font>
<a name='11414'>
      do n=1,nbndlw<a name='11415'>
         semiss(n) = emis(iplon,n)<a name='11416'>
<font color=#447700>!          semiss(n) = 1.0_rb<a name='11417'></font>
      enddo<a name='11418'>
<a name='11419'>
<font color=#447700>! Transfer aerosol optical properties to RRTM variable;<a name='11420'></font>
<font color=#447700>! modify to reverse layer indexing here if necessary.<a name='11421'></font>
<a name='11422'>
     if (iaer .ge. 1) then<a name='11423'>
        do l = 1, nlayers<a name='11424'>
           do ib = 1, nbndlw<a name='11425'>
              taua(l,ib) = tauaer(iplon,l,ib)<a name='11426'>
           enddo<a name='11427'>
        enddo<a name='11428'>
      endif<a name='11429'>
<a name='11430'>
<font color=#447700>! Transfer cloud fraction and cloud optical properties to RRTM variables,<a name='11431'></font>
<font color=#447700>! modify to reverse layer indexing here if necessary.<a name='11432'></font>
<a name='11433'>
      if (icld .ge. 1) then <a name='11434'>
         inflag = inflglw<a name='11435'>
         iceflag = iceflglw<a name='11436'>
         liqflag = liqflglw<a name='11437'>
<a name='11438'>
<font color=#447700>! Move incoming GCM cloud arrays to RRTMG cloud arrays.<a name='11439'></font>
<font color=#447700>! For GCM input, incoming reicmcl is defined based on selected ice parameterization (inflglw)<a name='11440'></font>
<a name='11441'>
         do l = 1, nlayers<a name='11442'>
            do ig = 1, ngptlw<a name='11443'>
               cldfmc(ig,l) = cldfmcl(ig,iplon,l)<a name='11444'>
               taucmc(ig,l) = taucmcl(ig,iplon,l)<a name='11445'>
               ciwpmc(ig,l) = ciwpmcl(ig,iplon,l)<a name='11446'>
               clwpmc(ig,l) = clwpmcl(ig,iplon,l)<a name='11447'>
               cswpmc(ig,l) = cswpmcl(ig,iplon,l)<a name='11448'>
            enddo<a name='11449'>
            reicmc(l) = reicmcl(iplon,l)<a name='11450'>
            relqmc(l) = relqmcl(iplon,l)<a name='11451'>
            resnmc(l) = resnmcl(iplon,l)<a name='11452'>
         enddo<a name='11453'>
<a name='11454'>
<font color=#447700>! If an extra layer is being used in RRTMG, set all cloud properties to zero in the extra layer.<a name='11455'></font>
<a name='11456'>
<font color=#447700>!         cldfmc(:,nlayers) = 0.0_rb<a name='11457'></font>
<font color=#447700>!         taucmc(:,nlayers) = 0.0_rb<a name='11458'></font>
<font color=#447700>!         ciwpmc(:,nlayers) = 0.0_rb<a name='11459'></font>
<font color=#447700>!         clwpmc(:,nlayers) = 0.0_rb<a name='11460'></font>
<font color=#447700>!         reicmc(nlayers) = 0.0_rb<a name='11461'></font>
<font color=#447700>!         relqmc(nlayers) = 0.0_rb<a name='11462'></font>
<font color=#447700>!         taua(nlayers,:) = 0.0_rb<a name='11463'></font>
<a name='11464'>
      endif<a name='11465'>
      <a name='11466'>
      end subroutine inatm<a name='11467'>
<a name='11468'>
      end module rrtmg_lw_rad<a name='11469'>
<a name='11470'>
<font color=#447700>!------------------------------------------------------------------<a name='11471'></font>
<A NAME='MODULE_RA_RRTMG_LW'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MODULE_RA_RRTMG_LW' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='11472'>
<font color=#993300>MODULE </font><font color=#cc0000>module_ra_rrtmg_lw</font> <A href='../../call_to/MODULE_RA_RRTMG_LW.html' TARGET='index'>3</A><a name='11473'>
<a name='11474'>
use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_83">, only : cp<a name='11475'>
use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_78"><a name='11476'>
#if (HWRF == 1)<a name='11477'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_144">, ONLY : FER_MP_HIRES, FER_MP_HIRES_ADVECT, ETAMP_HWRF <a name='11478'>
#else<a name='11479'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_145">, ONLY : FER_MP_HIRES, FER_MP_HIRES_ADVECT<a name='11480'>
#endif<a name='11481'>
<font color=#447700>!use module_dm<a name='11482'></font>
<a name='11483'>
use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#PARRRTM'>parrrtm</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PARRRTM_43">, only : nbndlw, ngptlw<a name='11484'>
use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_INIT'>rrtmg_lw_init</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_INIT_1">, only: rrtmg_lw_ini<a name='11485'>
use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LW_RAD'>rrtmg_lw_rad</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_RAD_1">, only: rrtmg_lw<a name='11486'>
use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_GEN_LW'>mcica_subcol_gen_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INATM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MCICA_SUBCOL_GEN_LW_2">, only: mcica_subcol_lw<a name='11487'>
<a name='11488'>
    real retab(95)<a name='11489'>
    data retab /                                                &amp;<a name='11490'>
         5.92779, 6.26422, 6.61973, 6.99539, 7.39234,   &amp;<a name='11491'>
         7.81177, 8.25496, 8.72323, 9.21800, 9.74075, 10.2930,  &amp;<a name='11492'>
         10.8765, 11.4929, 12.1440, 12.8317, 13.5581, 14.2319,  &amp;<a name='11493'>
         15.0351, 15.8799, 16.7674, 17.6986, 18.6744, 19.6955,  &amp;<a name='11494'>
         20.7623, 21.8757, 23.0364, 24.2452, 25.5034, 26.8125,  &amp;<a name='11495'>
         27.7895, 28.6450, 29.4167, 30.1088, 30.7306, 31.2943,  &amp;<a name='11496'>
         31.8151, 32.3077, 32.7870, 33.2657, 33.7540, 34.2601,  &amp;<a name='11497'>
         34.7892, 35.3442, 35.9255, 36.5316, 37.1602, 37.8078,  &amp;<a name='11498'>
         38.4720, 39.1508, 39.8442, 40.5552, 41.2912, 42.0635,  &amp;<a name='11499'>
         42.8876, 43.7863, 44.7853, 45.9170, 47.2165, 48.7221,  &amp;<a name='11500'>
         50.4710, 52.4980, 54.8315, 57.4898, 60.4785, 63.7898,  &amp;<a name='11501'>
         65.5604, 71.2885, 75.4113, 79.7368, 84.2351, 88.8833,  &amp;<a name='11502'>
         93.6658, 98.5739, 103.603, 108.752, 114.025, 119.424,  &amp;<a name='11503'>
         124.954, 130.630, 136.457, 142.446, 148.608, 154.956,  &amp;<a name='11504'>
         161.503, 168.262, 175.248, 182.473, 189.952, 197.699,  &amp;<a name='11505'>
         205.728, 214.055, 222.694, 231.661, 240.971, 250.639/  <a name='11506'>
    <font color=#447700>!<a name='11507'></font>
    save retab<a name='11508'>
    <font color=#447700>! For buffer layer adjustment.  Steven Cavallo, Dec 2010.<a name='11509'></font>
    integer , save    :: nlayers    <a name='11510'>
    real, PARAMETER :: deltap = 4.  <font color=#447700>! Pressure interval for buffer layer in mb<a name='11511'></font>
    <a name='11512'>
CONTAINS<a name='11513'>
<a name='11514'>
<font color=#447700>!------------------------------------------------------------------<a name='11515'></font>
<A NAME='RRTMG_LWRAD'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11516'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>RRTMG_LWRAD</font>(                                        &amp; <A href='../../call_to/RRTMG_LWRAD.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LWRAD.html' TARGET='index'>18</A><a name='11517'>
                       rthratenlw,                                &amp;<a name='11518'>
                       lwupt, lwuptc, lwdnt, lwdntc,              &amp;<a name='11519'>
                       lwupb, lwupbc, lwdnb, lwdnbc,              &amp;<a name='11520'>
<font color=#447700>!                      lwupflx, lwupflxc, lwdnflx, lwdnflxc,      &amp;<a name='11521'></font>
                       glw, olr, lwcf, emiss,                     &amp;<a name='11522'>
                       p8w, p3d, pi3d,                            &amp;<a name='11523'>
                       dz8w, tsk, t3d, t8w, rho3d, r, g,          &amp;<a name='11524'>
                       icloud, warm_rain, cldfra3d,               &amp;<a name='11525'>
                       lradius,iradius,                           &amp; <a name='11526'>
                       is_cammgmp_used,                           &amp; <a name='11527'>
                       f_ice_phy, f_rain_phy,                     &amp;<a name='11528'>
                       xland, xice, snow,                         &amp;<a name='11529'>
                       qv3d, qc3d, qr3d,                          &amp;<a name='11530'>
                       qi3d, qs3d, qg3d,                          &amp;<a name='11531'>
                       o3input, o33d,                             &amp;<a name='11532'>
                       f_qv, f_qc, f_qr, f_qi, f_qs, f_qg,        &amp;<a name='11533'>
                       re_cloud, re_ice, re_snow,                 &amp;  <font color=#447700>! G. Thompson<a name='11534'></font>
                       has_reqc, has_reqi, has_reqs,              &amp;  <font color=#447700>! G. Thompson<a name='11535'></font>
                       tauaerlw1,tauaerlw2,tauaerlw3,tauaerlw4,   &amp; <font color=#447700>! czhao <a name='11536'></font>
                       tauaerlw5,tauaerlw6,tauaerlw7,tauaerlw8,   &amp; <font color=#447700>! czhao <a name='11537'></font>
                       tauaerlw9,tauaerlw10,tauaerlw11,tauaerlw12,   &amp; <font color=#447700>! czhao <a name='11538'></font>
                       tauaerlw13,tauaerlw14,tauaerlw15,tauaerlw16,   &amp; <font color=#447700>! czhao <a name='11539'></font>
                       aer_ra_feedback,                           &amp; <font color=#447700>!czhao<a name='11540'></font>
<font color=#447700>!jdfcz                 progn,prescribe,                           &amp; !czhao<a name='11541'></font>
                       progn,                                     &amp; <font color=#447700>!czhao<a name='11542'></font>
                       qndrop3d,f_qndrop,                         &amp; <font color=#447700>!czhao<a name='11543'></font>
<font color=#447700>!ccc added for time varying gases.<a name='11544'></font>
                       yr,julian,                                 &amp;<a name='11545'>
<font color=#447700>!ccc<a name='11546'></font>
                       mp_physics,                                &amp;<a name='11547'>
                       ids,ide, jds,jde, kds,kde,                 &amp; <a name='11548'>
                       ims,ime, jms,jme, kms,kme,                 &amp;<a name='11549'>
                       its,ite, jts,jte, kts,kte,                 &amp;<a name='11550'>
                       lwupflx, lwupflxc, lwdnflx, lwdnflxc       &amp;<a name='11551'>
                                                                  )<a name='11552'>
<font color=#447700>!------------------------------------------------------------------<a name='11553'></font>
<font color=#447700>!ccc To use clWRF time varying trace gases<a name='11554'></font>
   USE <A href='../../html_code/phys/module_ra_clWRF_support.F.html#MODULE_RA_CLWRF_SUPPORT'>MODULE_RA_CLWRF_SUPPORT</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RA_CLWRF_SUPPORT_3">, ONLY : read_CAMgases<a name='11555'>
<a name='11556'>
   IMPLICIT NONE<a name='11557'>
<font color=#447700>!------------------------------------------------------------------<a name='11558'></font>
   LOGICAL, INTENT(IN )      ::        warm_rain<a name='11559'>
   LOGICAL, INTENT(IN )      ::   is_CAMMGMP_used <font color=#447700>! Added for CAM5 RRTMG&lt;-&gt;CAMMGMP<a name='11560'></font>
<font color=#447700>!<a name='11561'></font>
   INTEGER, INTENT(IN )      ::        ids,ide, jds,jde, kds,kde, &amp;<a name='11562'>
                                       ims,ime, jms,jme, kms,kme, &amp;<a name='11563'>
                                       its,ite, jts,jte, kts,kte<a name='11564'>
<a name='11565'>
   INTEGER, INTENT(IN )      ::        ICLOUD<a name='11566'>
   INTEGER, INTENT(IN )      ::        MP_PHYSICS<a name='11567'>
<font color=#447700>!<a name='11568'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='11569'>
         INTENT(IN   ) ::                                   dz8w, &amp;<a name='11570'>
                                                             t3d, &amp;<a name='11571'>
                                                             t8w, &amp;<a name='11572'>
                                                             p8w, &amp;<a name='11573'>
                                                             p3d, &amp;<a name='11574'>
                                                            pi3d, &amp;<a name='11575'>
                                                           rho3d<a name='11576'>
<a name='11577'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='11578'>
         INTENT(INOUT)  ::                            RTHRATENLW<a name='11579'>
<a name='11580'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='11581'>
         INTENT(INOUT)  ::                                   GLW, &amp;<a name='11582'>
                                                             OLR, &amp;<a name='11583'>
                                                            LWCF<a name='11584'>
<a name='11585'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='11586'>
         INTENT(IN   )  ::                                 EMISS, &amp;<a name='11587'>
                                                             TSK<a name='11588'>
<a name='11589'>
   REAL, INTENT(IN  )   ::                                   R,G<a name='11590'>
<a name='11591'>
   REAL, DIMENSION( ims:ime, jms:jme )                          , &amp;<a name='11592'>
         INTENT(IN   )  ::                                 XLAND, &amp;<a name='11593'>
                                                            XICE, &amp;<a name='11594'>
                                                            SNOW<a name='11595'>
<font color=#447700>!ccc Added for time-varying trace gases.<a name='11596'></font>
   INTEGER, INTENT(IN    ) ::                                 yr<a name='11597'>
   REAL, INTENT(IN    ) ::                                julian<a name='11598'>
<font color=#447700>!ccc<a name='11599'></font>
<a name='11600'>
<font color=#447700>!<a name='11601'></font>
<font color=#447700>! Optional<a name='11602'></font>
<font color=#447700>!<a name='11603'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='11604'>
         OPTIONAL                                               , &amp;<a name='11605'>
         INTENT(IN   ) ::                                         &amp;<a name='11606'>
                                                        CLDFRA3D, &amp;<a name='11607'>
                                                         LRADIUS, &amp;<a name='11608'>
                                                         IRADIUS, &amp;<a name='11609'>
<a name='11610'>
                                                            QV3D, &amp;<a name='11611'>
                                                            QC3D, &amp;<a name='11612'>
                                                            QR3D, &amp;<a name='11613'>
                                                            QI3D, &amp;<a name='11614'>
                                                            QS3D, &amp;<a name='11615'>
                                                            QG3D, &amp;<a name='11616'>
                                                        QNDROP3D<a name='11617'>
<a name='11618'>
<font color=#447700>!..Added by G. Thompson to couple cloud physics effective radii.<a name='11619'></font>
   REAL, DIMENSION(ims:ime,kms:kme,jms:jme), INTENT(IN)::         &amp;<a name='11620'>
                                                        re_cloud, &amp;<a name='11621'>
                                                          re_ice, &amp;<a name='11622'>
                                                         re_snow<a name='11623'>
   INTEGER, INTENT(IN):: has_reqc, has_reqi, has_reqs<a name='11624'>
<a name='11625'>
   real pi,third,relconst,lwpmin,rhoh2o<a name='11626'>
<a name='11627'>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='11628'>
         OPTIONAL                                               , &amp;<a name='11629'>
         INTENT(IN   ) ::                                         &amp;<a name='11630'>
                                                       F_ICE_PHY, &amp;<a name='11631'>
                                                      F_RAIN_PHY<a name='11632'>
<a name='11633'>
   LOGICAL, OPTIONAL, INTENT(IN)   ::                             &amp;<a name='11634'>
                                   F_QV,F_QC,F_QR,F_QI,F_QS,F_QG,F_QNDROP<a name='11635'>
<font color=#447700>! Optional<a name='11636'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme ), OPTIONAL ,       &amp;<a name='11637'>
         INTENT(IN    ) :: tauaerlw1,tauaerlw2,tauaerlw3,tauaerlw4, &amp; <font color=#447700>! czhao <a name='11638'></font>
                           tauaerlw5,tauaerlw6,tauaerlw7,tauaerlw8, &amp; <font color=#447700>! czhao <a name='11639'></font>
                           tauaerlw9,tauaerlw10,tauaerlw11,tauaerlw12, &amp; <font color=#447700>! czhao <a name='11640'></font>
                           tauaerlw13,tauaerlw14,tauaerlw15,tauaerlw16<a name='11641'>
<a name='11642'>
   INTEGER,    INTENT(IN  ), OPTIONAL   ::       aer_ra_feedback<a name='11643'>
<font color=#447700>!jdfcz   INTEGER,    INTENT(IN  ), OPTIONAL   ::       progn,prescribe<a name='11644'></font>
   INTEGER,    INTENT(IN  ), OPTIONAL   ::       progn<a name='11645'>
<font color=#447700>!  Ozone<a name='11646'></font>
   REAL, DIMENSION( ims:ime, kms:kme, jms:jme )                 , &amp;<a name='11647'>
         OPTIONAL                                               , &amp;<a name='11648'>
         INTENT(IN   ) :: O33D<a name='11649'>
   INTEGER, OPTIONAL, INTENT(IN ) :: o3input<a name='11650'>
<a name='11651'>
      real, parameter :: thresh=1.e-9<a name='11652'>
      real slope<a name='11653'>
      character(len=200) :: msg<a name='11654'>
<a name='11655'>
<a name='11656'>
<font color=#447700>! Top of atmosphere and surface longwave fluxes (W m-2)<a name='11657'></font>
   REAL, DIMENSION( ims:ime, jms:jme ),                           &amp;<a name='11658'>
         OPTIONAL, INTENT(INOUT) ::                               &amp;<a name='11659'>
                                       LWUPT,LWUPTC,LWDNT,LWDNTC, &amp;<a name='11660'>
                                       LWUPB,LWUPBC,LWDNB,LWDNBC<a name='11661'>
<a name='11662'>
<font color=#447700>! Layer longwave fluxes (including extra layer above model top)<a name='11663'></font>
<font color=#447700>! Vertical ordering is from bottom to top (W m-2)<a name='11664'></font>
   REAL, DIMENSION( ims:ime, kms:kme+2, jms:jme ),                &amp;<a name='11665'>
         OPTIONAL, INTENT(OUT) ::                                 &amp;<a name='11666'>
                               LWUPFLX,LWUPFLXC,LWDNFLX,LWDNFLXC<a name='11667'>
<a name='11668'>
<font color=#447700>!  LOCAL VARS<a name='11669'></font>
 <a name='11670'>
   REAL, DIMENSION( kts:kte+1 ) ::                          Pw1D, &amp;<a name='11671'>
                                                            Tw1D<a name='11672'>
<a name='11673'>
   REAL, DIMENSION( kts:kte ) ::                          TTEN1D, &amp;<a name='11674'>
                                                        CLDFRA1D, &amp;<a name='11675'>
                                                            DZ1D, &amp;<a name='11676'>
                                                             P1D, &amp;<a name='11677'>
                                                             T1D, &amp;<a name='11678'>
                                                            QV1D, &amp;<a name='11679'>
                                                            QC1D, &amp;<a name='11680'>
                                                            QR1D, &amp;<a name='11681'>
                                                            QI1D, &amp;<a name='11682'>
                                                           RHO1D, &amp;<a name='11683'>
                                                            QS1D, &amp;<a name='11684'>
                                                            QG1D, &amp;<a name='11685'>
                                                            O31D, &amp;<a name='11686'>
                                                          qndrop1d <a name='11687'>
<font color=#447700>!BSF: From eq. (5) on p. 2434 in McFarquhar &amp; Heymsfield (1996)<a name='11688'></font>
       real, parameter :: re_50C=1250.0/9.917, re_40C=1250.0/9.337, &amp;<a name='11689'>
                          re_30C=1250.0/9.208, re_20C=1250.0/9.387<a name='11690'>
<a name='11691'>
<a name='11692'>
<font color=#447700>! Added local arrays for RRTMG<a name='11693'></font>
    integer ::                                              ncol, &amp;<a name='11694'>
                                                            nlay, &amp;<a name='11695'>
                                                            icld, &amp;<a name='11696'>
                                                         inflglw, &amp;<a name='11697'>
                                                        iceflglw, &amp;<a name='11698'>
                                                        liqflglw<a name='11699'>
<font color=#447700>! Dimension with extra layer from model top to TOA<a name='11700'></font>
    real, dimension( 1, kts:nlayers+1 )  ::                 plev, &amp;<a name='11701'>
                                                            tlev<a name='11702'>
    real, dimension( 1, kts:nlayers )  ::                   play, &amp;<a name='11703'>
                                                            tlay, &amp;<a name='11704'>
                                                          h2ovmr, &amp;<a name='11705'>
                                                           o3vmr, &amp;<a name='11706'>
                                                          co2vmr, &amp;<a name='11707'>
                                                           o2vmr, &amp;<a name='11708'>
                                                          ch4vmr, &amp;<a name='11709'>
                                                          n2ovmr, &amp;<a name='11710'>
                                                        cfc11vmr, &amp;<a name='11711'>
                                                        cfc12vmr, &amp;<a name='11712'>
                                                        cfc22vmr, &amp;<a name='11713'>
                                                         ccl4vmr<a name='11714'>
    real, dimension( kts:nlayers )  ::                     o3mmr<a name='11715'>
<font color=#447700>! For old cloud property specification for rrtm_lw<a name='11716'></font>
    real, dimension( kts:kte )  ::                          clwp, &amp;<a name='11717'>
                                                            ciwp, &amp;<a name='11718'>
                                                            cswp, &amp;<a name='11719'>
                                                            plwp, &amp;<a name='11720'>
                                                            piwp<a name='11721'>
<font color=#447700>! Surface emissivity (for 16 LW spectral bands)<a name='11722'></font>
    real, dimension( 1, nbndlw )  ::                        emis<a name='11723'>
<font color=#447700>! Dimension with extra layer from model top to TOA, <a name='11724'></font>
<font color=#447700>! though no clouds are allowed in extra layer<a name='11725'></font>
    real, dimension( 1, kts:nlayers )  ::                 clwpth, &amp;<a name='11726'>
                                                          ciwpth, &amp;<a name='11727'>
                                                          cswpth, &amp;<a name='11728'>
                                                             rel, &amp;<a name='11729'>
                                                             rei, &amp;<a name='11730'>
                                                             res, &amp;<a name='11731'>
                                                         cldfrac, &amp;<a name='11732'>
                                                         relqmcl, &amp;<a name='11733'>
                                                         reicmcl, &amp;<a name='11734'>
                                                         resnmcl<a name='11735'>
    real, dimension( nbndlw, 1, kts:nlayers )  ::        taucld<a name='11736'>
    real, dimension( ngptlw, 1, kts:nlayers )  ::        cldfmcl, &amp;<a name='11737'>
                                                         clwpmcl, &amp;<a name='11738'>
                                                         ciwpmcl, &amp;<a name='11739'>
                                                         cswpmcl, &amp;<a name='11740'>
                                                         taucmcl<a name='11741'>
    real, dimension( 1, kts:nlayers, nbndlw )  ::           tauaer<a name='11742'>
<a name='11743'>
<font color=#447700>! Output arrays contain extra layer from model top to TOA<a name='11744'></font>
    real, dimension( 1, kts:nlayers+1 )  ::                 uflx, &amp;<a name='11745'>
                                                            dflx, &amp;<a name='11746'>
                                                           uflxc, &amp;<a name='11747'>
                                                           dflxc<a name='11748'>
    real, dimension( 1, kts:nlayers )  ::                    hr, &amp;<a name='11749'>
                                                             hrc<a name='11750'>
<a name='11751'>
    real, dimension ( 1 ) ::                                tsfc, &amp;<a name='11752'>
                                                              ps<a name='11753'>
    real ::                                                   ro, &amp;<a name='11754'>
                                                              dz<a name='11755'>
    real:: snow_mass_factor<a name='11756'>
<a name='11757'>
<font color=#447700>!..We can use message interface regardless of what options are running,<a name='11758'></font>
<font color=#447700>!.. so let us ask for it here.<a name='11759'></font>
      CHARACTER(LEN=256)                           :: message<a name='11760'>
      LOGICAL, EXTERNAL                            :: wrf_dm_on_monitor<a name='11761'>
<a name='11762'>
<font color=#447700>!ccc To add time-varying trace gases (CO2, N2O and CH4). Read the conc.  from file<a name='11763'></font>
<font color=#447700>! then interpolate to date of run.<a name='11764'></font>
#ifdef CLWRFGHG<a name='11765'>
<font color=#447700>! CLWRF-UC June.09<a name='11766'></font>
      REAL(8)                                      :: co2, n2o, ch4, cfc11, cfc12<a name='11767'>
#else<a name='11768'>
<a name='11769'>
<font color=#447700>! Set trace gas volume mixing ratios, 2005 values, IPCC (2007)<a name='11770'></font>
<font color=#447700>! carbon dioxide (379 ppmv)<a name='11771'></font>
    real :: co2<a name='11772'>
    data co2 / 379.e-6 / <a name='11773'>
<font color=#447700>! methane (1774 ppbv)<a name='11774'></font>
    real :: ch4<a name='11775'>
    data ch4 / 1774.e-9 / <a name='11776'>
<font color=#447700>! nitrous oxide (319 ppbv)<a name='11777'></font>
    real :: n2o<a name='11778'>
    data n2o / 319.e-9 / <a name='11779'>
<font color=#447700>! cfc-11 (251 ppt)<a name='11780'></font>
    real :: cfc11<a name='11781'>
    data cfc11 / 0.251e-9 / <a name='11782'>
<font color=#447700>! cfc-12 (538 ppt)<a name='11783'></font>
    real :: cfc12<a name='11784'>
    data cfc12 / 0.538e-9 / <a name='11785'>
#endif<a name='11786'>
<font color=#447700>! cfc-22 (169 ppt)<a name='11787'></font>
    real :: cfc22<a name='11788'>
    data cfc22 / 0.169e-9 / <a name='11789'>
<font color=#447700>! ccl4 (93 ppt)<a name='11790'></font>
    real :: ccl4<a name='11791'>
    data ccl4 / 0.093e-9 / <a name='11792'>
<font color=#447700>! Set oxygen volume mixing ratio (for o2mmr=0.23143)<a name='11793'></font>
    real :: o2<a name='11794'>
    data o2 / 0.209488 /<a name='11795'>
<a name='11796'>
    integer :: iplon, irng, permuteseed<a name='11797'>
    integer :: nb<a name='11798'>
<a name='11799'>
<font color=#447700>! For old cloud property specification for rrtm_lw<a name='11800'></font>
<font color=#447700>! Cloud and precipitation absorption coefficients<a name='11801'></font>
    real :: abcw,abice,abrn,absn<a name='11802'>
    data abcw /0.144/<a name='11803'>
    data abice /0.0735/<a name='11804'>
    data abrn /0.330e-3/<a name='11805'>
    data absn /2.34e-3/<a name='11806'>
<a name='11807'>
<font color=#447700>! Molecular weights and ratios for converting mmr to vmr units<a name='11808'></font>
<font color=#447700>!    real :: amd       ! Effective molecular weight of dry air (g/mol)  <a name='11809'></font>
<font color=#447700>!    real :: amw       ! Molecular weight of water vapor (g/mol)        <a name='11810'></font>
<font color=#447700>!    real :: amo       ! Molecular weight of ozone (g/mol)              <a name='11811'></font>
<font color=#447700>!    real :: amo2      ! Molecular weight of oxygen (g/mol)              <a name='11812'></font>
<font color=#447700>! Atomic weights for conversion from mass to volume mixing ratios                <a name='11813'></font>
<font color=#447700>!    data amd   /  28.9660   /                                                  <a name='11814'></font>
<font color=#447700>!    data amw   /  18.0160   /                                                  <a name='11815'></font>
<font color=#447700>!    data amo   /  47.9998   /                                                  <a name='11816'></font>
<font color=#447700>!    data amo2  /  31.9999   /<a name='11817'></font>
                                                                                 <a name='11818'>
    real :: amdw     <font color=#447700>! Molecular weight of dry air / water vapor  <a name='11819'></font>
    real :: amdo     <font color=#447700>! Molecular weight of dry air / ozone<a name='11820'></font>
    real :: amdo2    <font color=#447700>! Molecular weight of dry air / oxygen<a name='11821'></font>
    data amdw /  1.607793 /                                                    <a name='11822'>
    data amdo /  0.603461 /<a name='11823'>
    data amdo2 / 0.905190 /<a name='11824'>
    <a name='11825'>
<font color=#447700>!!<a name='11826'></font>
    real, dimension( 1, 1:kte-kts+1 )  :: pdel         <font color=#447700>! Layer pressure thickness (mb)<a name='11827'></font>
<a name='11828'>
    real, dimension(1, 1:kte-kts+1) ::   cicewp, &amp;     <font color=#447700>! in-cloud cloud ice water path<a name='11829'></font>
                                         cliqwp, &amp;     <font color=#447700>! in-cloud cloud liquid water path<a name='11830'></font>
                                         csnowp, &amp;     <font color=#447700>! in-cloud snow water path<a name='11831'></font>
                                          reliq, &amp;     <font color=#447700>! effective drop radius (microns)<a name='11832'></font>
                                          reice        <font color=#447700>! effective ice crystal size (microns)<a name='11833'></font>
    real, dimension(1, 1:kte-kts+1):: recloud1d, &amp;<a name='11834'>
                                        reice1d, &amp;<a name='11835'>
                                       resnow1d<a name='11836'>
<a name='11837'>
    real :: gliqwp, gicewp, gsnowp, gravmks<a name='11838'>
<a name='11839'>
<font color=#447700>!<a name='11840'></font>
<font color=#447700>!    REAL   ::  TSFC,GLW0,OLR0,EMISS0,FP<a name='11841'></font>
<a name='11842'>
    real, dimension (1) :: landfrac, landm, snowh, icefrac<a name='11843'>
<a name='11844'>
    integer :: pcols, pver<a name='11845'>
<a name='11846'>
<font color=#447700>!<a name='11847'></font>
    INTEGER :: i,j,K, idx_rei<a name='11848'>
    REAL :: corr<a name='11849'>
    LOGICAL :: predicate<a name='11850'>
<a name='11851'>
<font color=#447700>! Added for top of model adjustment.  Steven Cavallo NCAR/MMM December 2010<a name='11852'></font>
    INTEGER, PARAMETER :: nproflevs = 60 <font color=#447700>! Constant, from the table<a name='11853'></font>
    INTEGER :: L, LL, klev               <font color=#447700>! Loop indices      <a name='11854'></font>
    REAL, DIMENSION( kts:nlayers+1 ) :: varint<a name='11855'>
    REAL :: wght,vark,vark1,tem1,tem2,tem3<a name='11856'>
    REAL :: PPROF(nproflevs), TPROF(nproflevs)            <a name='11857'>
    <font color=#447700>! Weighted mean pressure and temperature profiles from midlatitude <a name='11858'></font>
    <font color=#447700>! summer (MLS),midlatitude winter (MLW), sub-Arctic <a name='11859'></font>
    <font color=#447700>! winter (SAW),sub-Arctic summer (SAS), and tropical (TROP) <a name='11860'></font>
    <font color=#447700>! standard atmospheres.<a name='11861'></font>
    DATA PPROF   /1000.00,855.47,731.82,626.05,535.57,458.16,     &amp;<a name='11862'>
                  391.94,335.29,286.83,245.38,209.91,179.57,      &amp;<a name='11863'>
                  153.62,131.41,112.42,96.17,82.27,70.38,         &amp;<a name='11864'>
                  60.21,51.51,44.06,37.69,32.25,27.59,            &amp;<a name='11865'>
                  23.60,20.19,17.27,14.77,12.64,10.81,            &amp;<a name='11866'>
                  9.25,7.91,6.77,5.79,4.95,4.24,                  &amp;<a name='11867'>
                  3.63,3.10,2.65,2.27,1.94,1.66,                  &amp;<a name='11868'>
                  1.42,1.22,1.04,0.89,0.76,0.65,                  &amp;<a name='11869'>
                  0.56,0.48,0.41,0.35,0.30,0.26,                  &amp;<a name='11870'>
                  0.22,0.19,0.16,0.14,0.12,0.10/<a name='11871'>
    DATA TPROF   /286.96,281.07,275.16,268.11,260.56,253.02,      &amp;<a name='11872'>
                  245.62,238.41,231.57,225.91,221.72,217.79,      &amp;<a name='11873'>
                  215.06,212.74,210.25,210.16,210.69,212.14,      &amp;<a name='11874'>
                  213.74,215.37,216.82,217.94,219.03,220.18,      &amp;<a name='11875'>
                  221.37,222.64,224.16,225.88,227.63,229.51,      &amp;<a name='11876'>
                  231.50,233.73,236.18,238.78,241.60,244.44,      &amp;<a name='11877'>
                  247.35,250.33,253.32,256.30,259.22,262.12,      &amp;<a name='11878'>
                  264.80,266.50,267.59,268.44,268.69,267.76,      &amp;<a name='11879'>
                  266.13,263.96,261.54,258.93,256.15,253.23,      &amp;<a name='11880'>
                  249.89,246.67,243.48,240.25,236.66,233.86/    <a name='11881'>
<font color=#447700>!------------------------------------------------------------------<a name='11882'></font>
#if ( WRF_CHEM == 1 )<a name='11883'>
      IF ( aer_ra_feedback == 1) then<a name='11884'>
      IF ( .NOT. &amp;<a name='11885'>
      ( PRESENT(tauaerlw1) .AND. &amp;<a name='11886'>
        PRESENT(tauaerlw2) .AND. &amp;<a name='11887'>
        PRESENT(tauaerlw3) .AND. &amp;<a name='11888'>
        PRESENT(tauaerlw4) .AND. &amp;<a name='11889'>
        PRESENT(tauaerlw5) .AND. &amp;<a name='11890'>
        PRESENT(tauaerlw6) .AND. &amp;<a name='11891'>
        PRESENT(tauaerlw7) .AND. &amp;<a name='11892'>
        PRESENT(tauaerlw8) .AND. &amp;<a name='11893'>
        PRESENT(tauaerlw9) .AND. &amp;<a name='11894'>
        PRESENT(tauaerlw10) .AND. &amp;<a name='11895'>
        PRESENT(tauaerlw11) .AND. &amp;<a name='11896'>
        PRESENT(tauaerlw12) .AND. &amp;<a name='11897'>
        PRESENT(tauaerlw13) .AND. &amp;<a name='11898'>
        PRESENT(tauaerlw14) .AND. &amp;<a name='11899'>
        PRESENT(tauaerlw15) .AND. &amp;<a name='11900'>
        PRESENT(tauaerlw16) ) ) THEN<a name='11901'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1030">  &amp;<a name='11902'>
      ('Warning: missing fields required for aerosol radiation' )<a name='11903'>
      ENDIF<a name='11904'>
      ENDIF<a name='11905'>
#endif<a name='11906'>
<a name='11907'>
<a name='11908'>
<font color=#447700>!-----CALCULATE LONG WAVE RADIATION<a name='11909'></font>
<font color=#447700>!                                                              <a name='11910'></font>
<font color=#447700>! All fields are ordered vertically from bottom to top<a name='11911'></font>
<font color=#447700>! Pressures are in mb<a name='11912'></font>
<font color=#447700>!<a name='11913'></font>
<font color=#447700>!ccc Read time-varying trace gases concentrations and interpolate them to run date.<a name='11914'></font>
<font color=#447700>!<a name='11915'></font>
#ifdef CLWRFGHG<a name='11916'>
<a name='11917'>
   CALL <A href='../../html_code/phys/module_ra_clWRF_support.F.html#READ_CAMGASES'>read_CAMgases</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_CAMGASES_3">(yr,julian,"RRTMG",co2,n2o,ch4,cfc11,cfc12)<a name='11918'>
<a name='11919'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='11920'>
     WRITE(message,*)'CAM-CLWRF interpolated values______ year:',yr,' julian day:',julian<a name='11921'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_777">( 100, message)<a name='11922'>
     WRITE(message,*)'  CAM-CLWRF co2vmr: ',co2,' n2ovmr:',n2o,' ch4vmr:',ch4,' cfc11vmr:',cfc11,' cfc12vmr:',cfc12<a name='11923'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_778">( 100, message)<a name='11924'>
   ENDIF<a name='11925'>
<a name='11926'>
#endif<a name='11927'>
<font color=#447700>!ccc<a name='11928'></font>
<a name='11929'>
<font color=#447700>! latitude loop<a name='11930'></font>
  j_loop: do j = jts,jte<a name='11931'>
<a name='11932'>
<font color=#447700>! longitude loop<a name='11933'></font>
     i_loop: do i = its,ite<a name='11934'>
<a name='11935'>
         do k=kts,kte+1<a name='11936'>
            Pw1D(K) = p8w(I,K,J)/100.<a name='11937'>
            Tw1D(K) = t8w(I,K,J)<a name='11938'>
         enddo<a name='11939'>
<a name='11940'>
         DO K=kts,kte<a name='11941'>
            QV1D(K)=0.<a name='11942'>
            QC1D(K)=0.<a name='11943'>
            QR1D(K)=0.<a name='11944'>
            QI1D(K)=0.<a name='11945'>
            QS1D(K)=0.<a name='11946'>
            CLDFRA1D(k)=0.<a name='11947'>
         ENDDO<a name='11948'>
<a name='11949'>
         DO K=kts,kte<a name='11950'>
            QV1D(K)=QV3D(I,K,J)<a name='11951'>
            QV1D(K)=max(0.,QV1D(K))<a name='11952'>
         ENDDO<a name='11953'>
<a name='11954'>
         IF (PRESENT(O33D)) THEN<a name='11955'>
            DO K=kts,kte<a name='11956'>
               O31D(K)=O33D(I,K,J)<a name='11957'>
            ENDDO<a name='11958'>
         ELSE<a name='11959'>
            DO K=kts,kte<a name='11960'>
               O31D(K)=0.0<a name='11961'>
            ENDDO<a name='11962'>
         ENDIF<a name='11963'>
<a name='11964'>
         DO K=kts,kte<a name='11965'>
            TTEN1D(K)=0.<a name='11966'>
            T1D(K)=T3D(I,K,J)<a name='11967'>
            P1D(K)=P3D(I,K,J)/100.<a name='11968'>
            RHO1D(K)=RHO3D(I,K,J)<a name='11969'>
            DZ1D(K)=dz8w(I,K,J)<a name='11970'>
         ENDDO<a name='11971'>
<a name='11972'>
<font color=#447700>! moist variables<a name='11973'></font>
<a name='11974'>
         IF (ICLOUD .ne. 0) THEN<a name='11975'>
            IF ( PRESENT( CLDFRA3D ) ) THEN<a name='11976'>
              DO K=kts,kte<a name='11977'>
                 CLDFRA1D(k)=CLDFRA3D(I,K,J)<a name='11978'>
              ENDDO<a name='11979'>
            ENDIF<a name='11980'>
<a name='11981'>
            IF (PRESENT(F_QC) .AND. PRESENT(QC3D)) THEN<a name='11982'>
              IF ( F_QC) THEN<a name='11983'>
                 DO K=kts,kte<a name='11984'>
                    QC1D(K)=QC3D(I,K,J)<a name='11985'>
                    QC1D(K)=max(0.,QC1D(K))<a name='11986'>
                 ENDDO<a name='11987'>
              ENDIF<a name='11988'>
            ENDIF<a name='11989'>
<a name='11990'>
            IF (PRESENT(F_QR) .AND. PRESENT(QR3D)) THEN<a name='11991'>
              IF ( F_QR) THEN<a name='11992'>
                 DO K=kts,kte<a name='11993'>
                    QR1D(K)=QR3D(I,K,J)<a name='11994'>
                    QR1D(K)=max(0.,QR1D(K))<a name='11995'>
                 ENDDO<a name='11996'>
              ENDIF<a name='11997'>
            ENDIF<a name='11998'>
<a name='11999'>
            IF ( PRESENT(F_QNDROP).AND.PRESENT(QNDROP3D)) THEN<a name='12000'>
             IF (F_QNDROP) THEN<a name='12001'>
              DO K=kts,kte<a name='12002'>
               qndrop1d(K)=qndrop3d(I,K,J)<a name='12003'>
              ENDDO<a name='12004'>
             ENDIF<a name='12005'>
            ENDIF<a name='12006'>
<a name='12007'>
<font color=#447700>! This logic is tortured because cannot test F_QI unless<a name='12008'></font>
<font color=#447700>! it is present, and order of evaluation of expressions<a name='12009'></font>
<font color=#447700>! is not specified in Fortran<a name='12010'></font>
<a name='12011'>
            IF ( PRESENT ( F_QI ) ) THEN<a name='12012'>
              predicate = F_QI<a name='12013'>
            ELSE<a name='12014'>
              predicate = .FALSE.<a name='12015'>
            ENDIF<a name='12016'>
<a name='12017'>
<font color=#447700>! For MP option 3<a name='12018'></font>
            IF (.NOT. predicate .and. .not. warm_rain) THEN<a name='12019'>
               DO K=kts,kte<a name='12020'>
                  IF (T1D(K) .lt. 273.15) THEN<a name='12021'>
                  QI1D(K)=QC1D(K)<a name='12022'>
                  QS1D(K)=QR1D(K)<a name='12023'>
                  QC1D(K)=0.<a name='12024'>
                  QR1D(K)=0.<a name='12025'>
                  ENDIF<a name='12026'>
               ENDDO<a name='12027'>
            ENDIF<a name='12028'>
<a name='12029'>
            IF (PRESENT(F_QI) .AND. PRESENT(QI3D)) THEN<a name='12030'>
               IF (F_QI) THEN<a name='12031'>
                  DO K=kts,kte<a name='12032'>
                     QI1D(K)=QI3D(I,K,J)<a name='12033'>
                     QI1D(K)=max(0.,QI1D(K))<a name='12034'>
                  ENDDO<a name='12035'>
               ENDIF<a name='12036'>
            ENDIF<a name='12037'>
<a name='12038'>
            IF (PRESENT(F_QS) .AND. PRESENT(QS3D)) THEN<a name='12039'>
               IF (F_QS) THEN<a name='12040'>
                  DO K=kts,kte<a name='12041'>
                     QS1D(K)=QS3D(I,K,J)<a name='12042'>
                     QS1D(K)=max(0.,QS1D(K))<a name='12043'>
                  ENDDO<a name='12044'>
               ENDIF<a name='12045'>
            ENDIF<a name='12046'>
<a name='12047'>
            IF (PRESENT(F_QG) .AND. PRESENT(QG3D)) THEN<a name='12048'>
               IF (F_QG) THEN<a name='12049'>
                  DO K=kts,kte<a name='12050'>
                     QG1D(K)=QG3D(I,K,J)<a name='12051'>
                     QG1D(K)=max(0.,QG1D(K))<a name='12052'>
                  ENDDO<a name='12053'>
               ENDIF<a name='12054'>
            ENDIF<a name='12055'>
<a name='12056'>
<font color=#447700>! mji - For MP option 5<a name='12057'></font>
            IF ( PRESENT(F_QI) .and. PRESENT(F_QC) .and. PRESENT(F_QS) .and. PRESENT(F_ICE_PHY) ) THEN<a name='12058'>
               IF ( F_QC .and. .not. F_QI .and. F_QS ) THEN<a name='12059'>
                  DO K=kts,kte<a name='12060'>
                     qi1d(k) = 0.1*qs3d(i,k,j)<a name='12061'>
                     qs1d(k) = 0.9*qs3d(i,k,j)<a name='12062'>
                     qc1d(k) = qc3d(i,k,j)<a name='12063'>
                     qi1d(k) = max(0.,qi1d(k))<a name='12064'>
                     qc1d(k) = max(0.,qc1d(k))<a name='12065'>
                  ENDDO<a name='12066'>
               ENDIF<a name='12067'>
            ENDIF<a name='12068'>
<a name='12069'>
        ENDIF<a name='12070'>
<a name='12071'>
<font color=#447700>!   For mp option=5 or 85  (new Ferrier- Aligo or fer_hires scheme), QI3D saves all<a name='12072'></font>
#if (HWRF == 1)<a name='12073'>
        IF ( mp_physics == FER_MP_HIRES .OR. &amp;<a name='12074'>
             mp_physics == FER_MP_HIRES_ADVECT .OR. &amp;<a name='12075'>
             mp_physics == ETAMP_HWRF ) THEN<a name='12076'>
#else<a name='12077'>
        IF ( mp_physics == FER_MP_HIRES .OR. &amp;<a name='12078'>
             mp_physics == FER_MP_HIRES_ADVECT) THEN<a name='12079'>
#endif<a name='12080'>
                  DO K=kts,kte<a name='12081'>
                     qi1d(k) = qi3d(i,k,j)<a name='12082'>
                     qs1d(k) = 0.0<a name='12083'>
                     qc1d(k) = qc3d(i,k,j)<a name='12084'>
                     qi1d(k) = max(0.,qi1d(k))<a name='12085'>
                     qc1d(k) = max(0.,qc1d(k))<a name='12086'>
                  ENDDO<a name='12087'>
        ENDIF<a name='12088'>
<a name='12089'>
<font color=#447700>!         EMISS0=EMISS(I,J)<a name='12090'></font>
<font color=#447700>!         GLW0=0. <a name='12091'></font>
<font color=#447700>!         OLR0=0. <a name='12092'></font>
<font color=#447700>!         TSFC=TSK(I,J)<a name='12093'></font>
         DO K=kts,kte<a name='12094'>
            QV1D(K)=AMAX1(QV1D(K),1.E-12) <a name='12095'>
         ENDDO<a name='12096'>
<a name='12097'>
<font color=#447700>! Set up input for longwave<a name='12098'></font>
         ncol = 1<a name='12099'>
<font color=#447700>! Add extra layer from top of model to top of atmosphere<a name='12100'></font>
<font color=#447700>!         nlay = (kte - kts + 1) + 1<a name='12101'></font>
<font color=#447700>! Edited for top of model adjustment (nlayers = kte + 1).  <a name='12102'></font>
<font color=#447700>! Steven Cavallo, December 2010<a name='12103'></font>
          nlay = nlayers <font color=#447700>! Keep these indices the same<a name='12104'></font>
<a name='12105'>
<a name='12106'>
<font color=#447700>! Select cloud liquid and ice optics parameterization options<a name='12107'></font>
<font color=#447700>! For passing in cloud optical properties directly:<a name='12108'></font>
<font color=#447700>!         icld = 2<a name='12109'></font>
<font color=#447700>!         inflglw = 0<a name='12110'></font>
<font color=#447700>!         iceflglw = 0<a name='12111'></font>
<font color=#447700>!         liqflglw = 0<a name='12112'></font>
<font color=#447700>! For passing in cloud physical properties; cloud optics parameterized in RRTMG:<a name='12113'></font>
         icld = 2<a name='12114'>
         inflglw = 2<a name='12115'>
         iceflglw = 3<a name='12116'>
         liqflglw = 1<a name='12117'>
<a name='12118'>
<font color=#447700>!Mukul change the flags here with reference to the new effective cloud/ice/snow radius<a name='12119'></font>
         IF (ICLOUD .ne. 0) THEN<a name='12120'>
            IF ( has_reqc .ne. 0) THEN<a name='12121'>
               inflglw = 3<a name='12122'>
               DO K=kts,kte<a name='12123'>
                  recloud1D(ncol,K) = MAX(2.5, re_cloud(I,K,J)*1.E6)<a name='12124'>
                  if (recloud1D(ncol,K).LE.2.5.AND.cldfra3d(i,k,j).gt.0. &amp;<a name='12125'>
     &amp;                            .AND. (XLAND(I,J)-1.5).GT.0.) then     <font color=#447700>!--- Ocean<a name='12126'></font>
                     recloud1D(ncol,K) = 10.5<a name='12127'>
                  elseif(recloud1D(ncol,K).LE.2.5.AND.cldfra3d(i,k,j).gt.0. &amp;<a name='12128'>
     &amp;                            .AND. (XLAND(I,J)-1.5).LT.0.) then     <font color=#447700>!--- Land<a name='12129'></font>
                     recloud1D(ncol,K) = 7.5<a name='12130'>
                  endif<a name='12131'>
               ENDDO<a name='12132'>
            ELSE<a name='12133'>
               DO K=kts,kte<a name='12134'>
                  recloud1D(ncol,K) = 5.0<a name='12135'>
               ENDDO<a name='12136'>
            ENDIF<a name='12137'>
<a name='12138'>
            IF ( has_reqi .ne. 0) THEN<a name='12139'>
               inflglw  = 4<a name='12140'>
               iceflglw = 4<a name='12141'>
               DO K=kts,kte<a name='12142'>
                  reice1D(ncol,K) = MAX(5., re_ice(I,K,J)*1.E6)<a name='12143'>
                  if (reice1D(ncol,K).LE.5..AND.cldfra3d(i,k,j).gt.0.) then<a name='12144'>
                     idx_rei = int(t3d(i,k,j)-179.)<a name='12145'>
                     idx_rei = min(max(idx_rei,1),75)<a name='12146'>
                     corr = t3d(i,k,j) - int(t3d(i,k,j))<a name='12147'>
                     reice1D(ncol,K) = retab(idx_rei)*(1.-corr) +       &amp;<a name='12148'>
     &amp;                                 retab(idx_rei+1)*corr<a name='12149'>
                     reice1D(ncol,K) = MAX(reice1D(ncol,K), 5.0)<a name='12150'>
                  endif<a name='12151'>
               ENDDO<a name='12152'>
            ELSE<a name='12153'>
               DO K=kts,kte<a name='12154'>
#if (EM_CORE==1) <a name='12155'>
                  reice1D(ncol,K) = 10.0<a name='12156'>
#else<a name='12157'>
                  tem2 = 25.0  <font color=#447700>!- was 10.0<a name='12158'></font>
                  tem3=1.e3*rho1d(k)*qi1d(k)  <font color=#447700>!- IWC (g m^-3)<a name='12159'></font>
                  if (tem3&gt;thresh) then       <font color=#447700>!- Only when IWC&gt;1.e-9 gm^-3<a name='12160'></font>
                    tem1=t1d(k)-273.15<a name='12161'>
                    if (tem1 &lt; -50.0) then<a name='12162'>
                      tem2 = re_50C*tem3**0.109<a name='12163'>
                    elseif (tem1 &lt; -40.0) then<a name='12164'>
                      tem2 = re_40C*tem3**0.08<a name='12165'>
                    elseif (tem1 &lt; -30.0) then<a name='12166'>
                      tem2 = re_30C*tem3**0.055<a name='12167'>
                    else<a name='12168'>
                      tem2 = re_20C*tem3**0.031<a name='12169'>
                    endif<a name='12170'>
                    tem2 = max(25.,tem2)<a name='12171'>
                  endif<a name='12172'>
                  reice1D(ncol,K) = min(tem2, 135.72)   <font color=#447700>!- 1.0315*reice&lt;= 140 microns<a name='12173'></font>
#endif<a name='12174'>
               ENDDO<a name='12175'>
            ENDIF<a name='12176'>
<a name='12177'>
            IF ( has_reqs .ne. 0) THEN<a name='12178'>
               inflglw  = 5<a name='12179'>
               iceflglw = 5<a name='12180'>
               DO K=kts,kte<a name='12181'>
                  resnow1D(ncol,K) = MAX(10., re_snow(I,K,J)*1.E6)<a name='12182'>
               ENDDO<a name='12183'>
            ELSE<a name='12184'>
               DO K=kts,kte<a name='12185'>
                  resnow1D(ncol,K) = 10.0<a name='12186'>
               ENDDO<a name='12187'>
            ENDIF<a name='12188'>
<a name='12189'>
<font color=#447700>! special case for P3 microphysics<a name='12190'></font>
<font color=#447700>! put ice into snow category for optics, then set ice to zero<a name='12191'></font>
            IF (has_reqs .eq. 0 .and. has_reqi .ne. 0 .and. has_reqc .ne. 0) THEN<a name='12192'>
               inflglw  = 5<a name='12193'>
               iceflglw = 5<a name='12194'>
               DO K=kts,kte<a name='12195'>
                  resnow1D(ncol,K) = MAX(10., re_ice(I,K,J)*1.E6)<a name='12196'>
                  QS1D(K)=QI3D(I,K,J)<a name='12197'>
                  QI1D(K)=0.<a name='12198'>
                  reice1D(ncol,K)=10.<a name='12199'>
               END DO<a name='12200'>
            END IF<a name='12201'>
<a name='12202'>
         ENDIF<a name='12203'>
<a name='12204'>
<font color=#447700>! Layer indexing goes bottom to top here for all fields.<a name='12205'></font>
<font color=#447700>! Water vapor and ozone are converted from mmr to vmr. <a name='12206'></font>
<font color=#447700>! Pressures are in units of mb here. <a name='12207'></font>
         plev(ncol,1) = pw1d(1)<a name='12208'>
         tlev(ncol,1) = tw1d(1)<a name='12209'>
         tsfc(ncol) = tsk(i,j)<a name='12210'>
         do k = kts, kte<a name='12211'>
            play(ncol,k) = p1d(k)<a name='12212'>
            plev(ncol,k+1) = pw1d(k+1)<a name='12213'>
            pdel(ncol,k) = plev(ncol,k) - plev(ncol,k+1)<a name='12214'>
            tlay(ncol,k) = t1d(k)<a name='12215'>
            tlev(ncol,k+1) = tw1d(k+1)<a name='12216'>
            h2ovmr(ncol,k) = qv1d(k) * amdw<a name='12217'>
            co2vmr(ncol,k) = co2<a name='12218'>
            o2vmr(ncol,k) = o2<a name='12219'>
            ch4vmr(ncol,k) = ch4<a name='12220'>
            n2ovmr(ncol,k) = n2o<a name='12221'>
            cfc11vmr(ncol,k) = cfc11<a name='12222'>
            cfc12vmr(ncol,k) = cfc12<a name='12223'>
            cfc22vmr(ncol,k) = cfc22<a name='12224'>
            ccl4vmr(ncol,k) = ccl4<a name='12225'>
         enddo<a name='12226'>
<a name='12227'>
<font color=#447700>! This section is replaced with a new method to deal with model top<a name='12228'></font>
         if ( 1 == 0 ) then<a name='12229'>
<a name='12230'>
<font color=#447700>!  Define profile values for extra layer from model top to top of atmosphere. <a name='12231'></font>
<font color=#447700>!  The top layer temperature for all gridpoints is set to the top layer-1 <a name='12232'></font>
<font color=#447700>!  temperature plus a constant (0 K) that represents an isothermal layer    <a name='12233'></font>
<font color=#447700>!  above ptop.  Top layer interface temperatures are linearly interpolated <a name='12234'></font>
<font color=#447700>!  from the layer temperatures.  <a name='12235'></font>
<a name='12236'>
         play(ncol,kte+1) = 0.5 * plev(ncol,kte+1)<a name='12237'>
         tlay(ncol,kte+1) = tlev(ncol,kte+1) + 0.0<a name='12238'>
         plev(ncol,kte+2) = 1.0e-5<a name='12239'>
         tlev(ncol,kte+2) = tlev(ncol,kte+1) + 0.0<a name='12240'>
         h2ovmr(ncol,kte+1) = h2ovmr(ncol,kte) <a name='12241'>
         co2vmr(ncol,kte+1) = co2vmr(ncol,kte) <a name='12242'>
         o2vmr(ncol,kte+1) = o2vmr(ncol,kte) <a name='12243'>
         ch4vmr(ncol,kte+1) = ch4vmr(ncol,kte) <a name='12244'>
         n2ovmr(ncol,kte+1) = n2ovmr(ncol,kte) <a name='12245'>
         cfc11vmr(ncol,kte+1) = cfc11vmr(ncol,kte) <a name='12246'>
         cfc12vmr(ncol,kte+1) = cfc12vmr(ncol,kte) <a name='12247'>
         cfc22vmr(ncol,kte+1) = cfc22vmr(ncol,kte) <a name='12248'>
         ccl4vmr(ncol,kte+1) = ccl4vmr(ncol,kte) <a name='12249'>
<a name='12250'>
         endif<a name='12251'>
<a name='12252'>
<font color=#447700>!  Set up values for extra layers to the top of the atmosphere.                       <a name='12253'></font>
<font color=#447700>!  Temperature is calculated based on an average temperature profile given<a name='12254'></font>
<font color=#447700>!  here in a table.  The input table data is linearly interpolated to the<a name='12255'></font>
<font color=#447700>!  column pressure.  Mixing ratios are held constant except for ozone.  <a name='12256'></font>
<font color=#447700>!  Caution should be used if model top pressure is less than 5 hPa.<a name='12257'></font>
<font color=#447700>!  Steven Cavallo, NCAR/MMM, December 2010<a name='12258'></font>
       <font color=#447700>! Calculate the column pressure buffer levels above the <a name='12259'></font>
       <font color=#447700>! model top       <a name='12260'></font>
       do L=kte+1,nlayers,1<a name='12261'>
          plev(ncol,L+1) = plev(ncol,L) - deltap<a name='12262'>
          play(ncol,L) = 0.5*(plev(ncol,L) + plev(ncol,L+1))<a name='12263'>
       enddo          <a name='12264'>
       <font color=#447700>! Add zero as top level.  This gets the temperature max at the<a name='12265'></font>
       <font color=#447700>! stratopause, reducing the downward flux errors in the top <a name='12266'></font>
       <font color=#447700>! levels.  If zero happened to be the top level already,<a name='12267'></font>
       <font color=#447700>! this will add another level with zero, but will not affect<a name='12268'></font>
       <font color=#447700>! the radiative transfer calculation.<a name='12269'></font>
       plev(ncol,nlayers+1) = 0.00<a name='12270'>
       play(ncol,nlayers) =  0.5*(plev(ncol,nlayers) + plev(ncol,nlayers+1))<a name='12271'>
<a name='12272'>
       <font color=#447700>! Interpolate the table temperatures to column pressure levels    <a name='12273'></font>
       do L=1,nlayers+1,1<a name='12274'>
          if ( PPROF(nproflevs) .lt. plev(ncol,L) ) then<a name='12275'>
             do LL=2,nproflevs,1       <a name='12276'>
                if ( PPROF(LL) .lt. plev(ncol,L) ) then           <a name='12277'>
                   klev = LL - 1<a name='12278'>
                   exit<a name='12279'>
                endif<a name='12280'>
             enddo<a name='12281'>
          <a name='12282'>
          else<a name='12283'>
             klev = nproflevs<a name='12284'>
          endif  <a name='12285'>
  <a name='12286'>
          if (klev .ne. nproflevs ) then<a name='12287'>
             vark  = TPROF(klev) <a name='12288'>
             vark1 = TPROF(klev+1)<a name='12289'>
             wght=(plev(ncol,L)-PPROF(klev) )/( PPROF(klev+1)-PPROF(klev))<a name='12290'>
          else<a name='12291'>
             vark  = TPROF(klev) <a name='12292'>
             vark1 = TPROF(klev)<a name='12293'>
             wght = 0.0<a name='12294'>
          endif<a name='12295'>
          varint(L) = wght*(vark1-vark)+vark<a name='12296'>
<a name='12297'>
       enddo                   <a name='12298'>
       <a name='12299'>
       <font color=#447700>! Match the interpolated table temperature profile to WRF column                    <a name='12300'></font>
       do L=kte+1,nlayers+1,1<a name='12301'>
          tlev(ncol,L) = varint(L) + (tlev(ncol,kte) - varint(kte))<a name='12302'>
          <font color=#447700>!if ( L .le. nlay ) then<a name='12303'></font>
          tlay(ncol,L-1) = 0.5*(tlev(ncol,L) + tlev(ncol,L-1))  <a name='12304'>
          <font color=#447700>!endif<a name='12305'></font>
       enddo <a name='12306'>
<a name='12307'>
       <font color=#447700>! Now the chemical species (except for ozone)<a name='12308'></font>
       do L=kte+1,nlayers,1<a name='12309'>
          h2ovmr(ncol,L) = h2ovmr(ncol,kte) <a name='12310'>
          co2vmr(ncol,L) = co2vmr(ncol,kte) <a name='12311'>
          o2vmr(ncol,L) = o2vmr(ncol,kte) <a name='12312'>
          ch4vmr(ncol,L) = ch4vmr(ncol,kte) <a name='12313'>
          n2ovmr(ncol,L) = n2ovmr(ncol,kte) <a name='12314'>
          cfc11vmr(ncol,L) = cfc11vmr(ncol,kte) <a name='12315'>
          cfc12vmr(ncol,L) = cfc12vmr(ncol,kte) <a name='12316'>
          cfc22vmr(ncol,L) = cfc22vmr(ncol,kte) <a name='12317'>
          ccl4vmr(ncol,L) = ccl4vmr(ncol,kte) <a name='12318'>
       enddo     <a name='12319'>
<font color=#447700>! End top of model buffer <a name='12320'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! <a name='12321'></font>
<font color=#447700>! Get ozone profile including amount in extra layer above model top.<a name='12322'></font>
<font color=#447700>! Steven Cavallo: Must pass nlay-1 into subroutine to get nlayers <a name='12323'></font>
<font color=#447700>! dimension for o3mmr<a name='12324'></font>
         call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INIRAD'>inirad</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIRAD_3"> (o3mmr,plev,kts,nlay-1)<a name='12325'>
<a name='12326'>
<font color=#447700>! Steven Cavallo: Changed to nlayers from kte+1<a name='12327'></font>
        if(present(o33d)) then<a name='12328'>
         do k = kts, nlayers<a name='12329'>
            o3vmr(ncol,k) = o3mmr(k) * amdo<a name='12330'>
            IF ( PRESENT( O33D ) ) THEN<a name='12331'>
            if(o3input .eq. 2)then<a name='12332'>
               if(k.le.kte)then<a name='12333'>
                 o3vmr(ncol,k) = o31d(k)<a name='12334'>
               else<a name='12335'>
<font color=#447700>! apply shifted climatology profile above model top<a name='12336'></font>
                 o3vmr(ncol,k) = o31d(kte) - o3mmr(kte)*amdo + o3mmr(k)*amdo<a name='12337'>
                 if(o3vmr(ncol,k) .le. 0.)o3vmr(ncol,k) = o3mmr(k)*amdo<a name='12338'>
               endif<a name='12339'>
            endif<a name='12340'>
            ENDIF<a name='12341'>
         enddo<a name='12342'>
        else<a name='12343'>
         do k = kts, nlayers<a name='12344'>
            o3vmr(ncol,k) = o3mmr(k) * amdo<a name='12345'>
         enddo<a name='12346'>
        endif<a name='12347'>
<a name='12348'>
<font color=#447700>! Set surface emissivity in each RRTMG longwave band<a name='12349'></font>
         do nb = 1, nbndlw<a name='12350'>
            emis(ncol, nb) = emiss(i,j)<a name='12351'>
         enddo<a name='12352'>
<a name='12353'>
<font color=#447700>! Define cloud optical properties for radiation (inflglw = 0)<a name='12354'></font>
<font color=#447700>! This is approach used with older RRTM_LW;<a name='12355'></font>
<font color=#447700>! Cloud and precipitation paths in g/m2 <a name='12356'></font>
<font color=#447700>! qi=0 if no ice phase<a name='12357'></font>
<font color=#447700>! qs=0 if no ice phase<a name='12358'></font>
         if (inflglw .eq. 0) then<a name='12359'>
            do k = kts,kte<a name='12360'>
               ro = p1d(k) / (r * t1d(k))*100. <a name='12361'>
               dz = dz1d(k)<a name='12362'>
               clwp(k) = ro*qc1d(k)*dz*1000.         <a name='12363'>
               ciwp(k) = ro*qi1d(k)*dz*1000.         <a name='12364'>
               plwp(k) = (ro*qr1d(k))**0.75*dz*1000. <a name='12365'>
               piwp(k) = (ro*qs1d(k))**0.75*dz*1000. <a name='12366'>
            enddo<a name='12367'>
<a name='12368'>
<font color=#447700>! Cloud fraction and cloud optical depth; old approach used with RRTM_LW<a name='12369'></font>
            do k = kts, kte<a name='12370'>
               cldfrac(ncol,k) = cldfra1d(k)<a name='12371'>
               do nb = 1, nbndlw<a name='12372'>
                  taucld(nb,ncol,k) = abcw*clwp(k) + abice*ciwp(k) &amp; <a name='12373'>
                            +abrn*plwp(k) + absn*piwp(k) <a name='12374'>
                  if (taucld(nb,ncol,k) .gt. 0.01) cldfrac(ncol,k) = 1. <a name='12375'>
               enddo<a name='12376'>
            enddo<a name='12377'>
<a name='12378'>
<font color=#447700>! Zero out cloud physical property arrays; not used when passing optical properties<a name='12379'></font>
<font color=#447700>! into radiation<a name='12380'></font>
            do k = kts, kte<a name='12381'>
               clwpth(ncol,k) = 0.0<a name='12382'>
               ciwpth(ncol,k) = 0.0<a name='12383'>
               rel(ncol,k) = 10.0<a name='12384'>
               rei(ncol,k) = 10.0<a name='12385'>
            enddo<a name='12386'>
         endif<a name='12387'>
<a name='12388'>
<font color=#447700>! Define cloud physical properties for radiation (inflglw = 1 or 2)<a name='12389'></font>
<font color=#447700>! Cloud fraction<a name='12390'></font>
<font color=#447700>! Set cloud arrays if passing cloud physical properties into radiation<a name='12391'></font>
         if (inflglw .gt. 0) then <a name='12392'>
            do k = kts, kte<a name='12393'>
               cldfrac(ncol,k) = cldfra1d(k)<a name='12394'>
            enddo<a name='12395'>
<a name='12396'>
<font color=#447700>! Compute cloud water/ice paths and particle sizes for input to radiation (CAM method)<a name='12397'></font>
            pcols = ncol<a name='12398'>
            pver = kte - kts + 1<a name='12399'>
            gravmks = g<a name='12400'>
            landfrac(ncol) = 2.-XLAND(I,J)<a name='12401'>
            landm(ncol) = landfrac(ncol)<a name='12402'>
            snowh(ncol) = 0.001*SNOW(I,J)<a name='12403'>
            icefrac(ncol) = XICE(I,J)<a name='12404'>
<a name='12405'>
<font color=#447700>! From module_ra_cam: Convert liquid and ice mixing ratios to water paths;<a name='12406'></font>
<font color=#447700>! pdel is in mb here; convert back to Pa (*100.)<a name='12407'></font>
<font color=#447700>! Water paths are in units of g/m2<a name='12408'></font>
<font color=#447700>! snow added as ice cloud (JD 091022)<a name='12409'></font>
            do k = kts, kte<a name='12410'>
               gicewp = (qi1d(k)+qs1d(k)) * pdel(ncol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box ice water path.<a name='12411'></font>
               gliqwp = qc1d(k) * pdel(ncol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box liquid water path.<a name='12412'></font>
               cicewp(ncol,k) = gicewp / max(0.01,cldfrac(ncol,k))               <font color=#447700>! In-cloud ice water path.<a name='12413'></font>
               cliqwp(ncol,k) = gliqwp / max(0.01,cldfrac(ncol,k))               <font color=#447700>! In-cloud liquid water path.<a name='12414'></font>
            end do<a name='12415'>
<a name='12416'>
<a name='12417'>
<font color=#447700>! Mukul<a name='12418'></font>
<font color=#447700>!..The ice water path is already sum of cloud ice and snow, but when we have explicit<a name='12419'></font>
<font color=#447700>!.. ice effective radius, overwrite the ice path with only the cloud ice variable,<a name='12420'></font>
<font color=#447700>!.. leaving out the snow for its own effect.<a name='12421'></font>
           if(iceflglw.ge.4)then<a name='12422'>
              do k = kts, kte<a name='12423'>
                     gicewp = qi1d(k) * pdel(ncol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box ice water path.<a name='12424'></font>
                     cicewp(ncol,k) = gicewp / max(0.01,cldfrac(ncol,k))               <font color=#447700>! In-cloud ice water path.<a name='12425'></font>
              end do<a name='12426'>
           end if<a name='12427'>
<a name='12428'>
<font color=#447700>!..Here the snow path is adjusted if (radiation) effective radius of snow is<a name='12429'></font>
<font color=#447700>!.. larger than what we currently have in the lookup tables.  Since mass goes<a name='12430'></font>
<font color=#447700>!.. rather close to diameter squared, adjust the mixing ratio of snow used<a name='12431'></font>
<font color=#447700>!.. to compute its water path in combination with the max diameter.  Not a<a name='12432'></font>
<font color=#447700>!.. perfect fix, but certainly better than using all snow mass when diameter is<a name='12433'></font>
<font color=#447700>!.. far larger than table currently contains and crystal sizes much larger than<a name='12434'></font>
<font color=#447700>!.. about 140 microns have lesser impact than those much smaller sizes.<a name='12435'></font>
<a name='12436'>
           if(iceflglw.eq.5)then<a name='12437'>
              do k = kts, kte<a name='12438'>
                 snow_mass_factor = 1.0<a name='12439'>
                 if (resnow1d(ncol,k) .gt. 130.)then<a name='12440'>
                     snow_mass_factor = (130.0/resnow1d(ncol,k))*(130.0/resnow1d(ncol,k))<a name='12441'>
                     resnow1d(ncol,k)   = 130.0<a name='12442'>
                     IF ( wrf_dm_on_monitor() ) THEN<a name='12443'>
                       WRITE(message,*)'RRTMG:  reducing snow mass (cloud path) to ', &amp;<a name='12444'>
                                       nint(snow_mass_factor*100.), ' percent of full value'<a name='12445'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_779">(150, message)<a name='12446'>
                     ENDIF<a name='12447'>
                 endif<a name='12448'>
                 gsnowp = qs1d(k) * snow_mass_factor * pdel(ncol,k)*100.0 / gravmks * 1000.0     <font color=#447700>! Grid box snow water path.<a name='12449'></font>
                 csnowp(ncol,k) = gsnowp / max(0.01,cldfrac(ncol,k))<a name='12450'>
              end do<a name='12451'>
           end if<a name='12452'>
<a name='12453'>
<a name='12454'>
<font color=#447700>!link the aerosol feedback to cloud  -czhao<a name='12455'></font>
  if( PRESENT( progn ) ) then<a name='12456'>
    if (progn == 1) then<a name='12457'>
<font color=#447700>!jdfcz     if(prescribe==0) then<a name='12458'></font>
<a name='12459'>
      pi = 4.*atan(1.0)<a name='12460'>
      third=1./3.<a name='12461'>
      rhoh2o=1.e3<a name='12462'>
      relconst=3/(4.*pi*rhoh2o)<a name='12463'>
<font color=#447700>!     minimun liquid water path to calculate rel<a name='12464'></font>
<font color=#447700>!     corresponds to optical depth of 1.e-3 for radius 4 microns.<a name='12465'></font>
      lwpmin=3.e-5<a name='12466'>
      do k = kts, kte<a name='12467'>
         reliq(ncol,k) = 10.<a name='12468'>
         if( PRESENT( F_QNDROP ) ) then<a name='12469'>
            if( F_QNDROP ) then<a name='12470'>
              if ( qc1d(k)*pdel(ncol,k).gt.lwpmin.and. &amp;<a name='12471'>
                   qndrop1d(k).gt.1000. ) then<a name='12472'>
               reliq(ncol,k)=(relconst*qc1d(k)/qndrop1d(k))**third <font color=#447700>! effective radius in m<a name='12473'></font>
<font color=#447700>!           apply scaling from Martin et al., JAS 51, 1830.<a name='12474'></font>
               reliq(ncol,k)=1.1*reliq(ncol,k)<a name='12475'>
               reliq(ncol,k)=reliq(ncol,k)*1.e6 <font color=#447700>! convert from m to microns<a name='12476'></font>
               reliq(ncol,k)=max(reliq(ncol,k),4.)<a name='12477'>
               reliq(ncol,k)=min(reliq(ncol,k),20.)<a name='12478'>
              end if<a name='12479'>
            end if<a name='12480'>
         end if<a name='12481'>
      end do<a name='12482'>
<font color=#447700>!jdfcz     else ! prescribe <a name='12483'></font>
<font color=#447700>! following Kiehl<a name='12484'></font>
<font color=#447700>!     call relcalc(ncol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='12485'></font>
<font color=#447700>!     write(0,*) 'lw prescribe aerosol',maxval(qndrop3d)<a name='12486'></font>
<font color=#447700>!jdfcz     endif<a name='12487'></font>
    else  <font color=#447700>! progn   <a name='12488'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RELCALC'>relcalc</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELCALC_1">(ncol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='12489'>
    endif<a name='12490'>
  else   <font color=#447700>!present(progn) <a name='12491'></font>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RELCALC'>relcalc</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELCALC_2">(ncol, pcols, pver, tlay, landfrac, landm, icefrac, reliq, snowh)<a name='12492'>
  endif<a name='12493'>
<a name='12494'>
<font color=#447700>! following Kristjansson and Mitchell<a name='12495'></font>
            call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#REICALC'>reicalc</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REICALC_1">(ncol, pcols, pver, tlay, reice)<a name='12496'>
<a name='12497'>
<a name='12498'>
<font color=#447700>!..If we already have effective radius of cloud and ice, then just overwrite what<a name='12499'></font>
<font color=#447700>!.. was computed in the relcalc and reicalc subroutines above.<a name='12500'></font>
<a name='12501'>
      if (inflglw .ge. 3) then<a name='12502'>
         do k = kts, kte<a name='12503'>
            reliq(ncol,k) = recloud1d(ncol,k)<a name='12504'>
         end do<a name='12505'>
      endif<a name='12506'>
#if (EM_CORE==1) <a name='12507'>
      if (iceflglw .ge. 4) then<a name='12508'>
#else<a name='12509'>
      if (iceflglw .ge. 3) then    <font color=#447700>!BSF: was .ge. 4<a name='12510'></font>
#endif<a name='12511'>
<a name='12512'>
         do k = kts, kte<a name='12513'>
            reice(ncol,k) = reice1d(ncol,k)<a name='12514'>
         end do<a name='12515'>
      endif<a name='12516'>
<a name='12517'>
<font color=#447700>! Limit upper bound of reice for Fu ice parameterization and convert<a name='12518'></font>
<font color=#447700>! from effective radius to generalized effective size (*1.0315; Fu, 1996)<a name='12519'></font>
            if (iceflglw .eq. 3) then<a name='12520'>
               do k = kts, kte<a name='12521'>
                  reice(ncol,k) = reice(ncol,k) * 1.0315<a name='12522'>
                  reice(ncol,k) = min(140.0,reice(ncol,k))<a name='12523'>
               end do<a name='12524'>
            endif<a name='12525'>
<font color=#447700>!if CAMMGMP is used, use output from CAMMGMP<a name='12526'></font>
            if(is_CAMMGMP_used) then<a name='12527'>
               do k = kts, kte<a name='12528'>
                  if ( qi1d(k) .gt. 1.e-20 .or. qs1d(k) .gt. 1.e-20) then<a name='12529'>
                     reice(ncol,k) = iradius(i,k,j)<a name='12530'>
                  else<a name='12531'>
                     reice(ncol,k) = 25.<a name='12532'>
                  end if<a name='12533'>
                  reice(ncol,k) = max(5., min(140.0,reice(ncol,k)))<a name='12534'>
                  if ( qc1d(k) .gt. 1.e-20) then<a name='12535'>
                     reliq(ncol,k) = lradius(i,k,j)<a name='12536'>
                  else<a name='12537'>
                     reliq(ncol,k) = 10.<a name='12538'>
                  end if<a name='12539'>
                  reliq(ncol,k) = max(2.5, min(60.0,reliq(ncol,k)))<a name='12540'>
               enddo<a name='12541'>
            endif<a name='12542'>
<a name='12543'>
<a name='12544'>
<font color=#447700>! Set cloud physical property arrays<a name='12545'></font>
            do k = kts, kte<a name='12546'>
               clwpth(ncol,k) = cliqwp(ncol,k)<a name='12547'>
               ciwpth(ncol,k) = cicewp(ncol,k)<a name='12548'>
               rel(ncol,k) = reliq(ncol,k)<a name='12549'>
               rei(ncol,k) = reice(ncol,k)<a name='12550'>
            enddo<a name='12551'>
<a name='12552'>
<font color=#447700>!Mukul<a name='12553'></font>
            if (inflglw .eq. 5) then<a name='12554'>
               do k = kts, kte<a name='12555'>
                  cswpth(ncol,k) = csnowp(ncol,k)<a name='12556'>
                  res(ncol,k) = resnow1d(ncol,k)<a name='12557'>
               end do<a name='12558'>
            else<a name='12559'>
               do k = kts, kte<a name='12560'>
                  cswpth(ncol,k) = 0.<a name='12561'>
                  res(ncol,k) = 10.<a name='12562'>
               end do<a name='12563'>
            endif<a name='12564'>
<a name='12565'>
<font color=#447700>! Zero out cloud optical properties here; not used when passing physical properties<a name='12566'></font>
<font color=#447700>! to radiation and taucld is calculated in radiation <a name='12567'></font>
            do k = kts, kte<a name='12568'>
               do nb = 1, nbndlw<a name='12569'>
                  taucld(nb,ncol,k) = 0.0<a name='12570'>
               enddo<a name='12571'>
            enddo<a name='12572'>
         endif<a name='12573'>
<a name='12574'>
<font color=#447700>! No clouds are allowed in the extra layer from model top to TOA<a name='12575'></font>
         <font color=#447700>! Steven Cavallo: Edited out for buffer adjustment below<a name='12576'></font>
         if ( 1 == 0 ) then<a name='12577'>
<a name='12578'>
<a name='12579'>
         clwpth(ncol,kte+1) = 0.<a name='12580'>
         ciwpth(ncol,kte+1) = 0.<a name='12581'>
         cswpth(ncol,kte+1) = 0.<a name='12582'>
         rel(ncol,kte+1) = 10.<a name='12583'>
         rei(ncol,kte+1) = 10.<a name='12584'>
         res(ncol,kte+1) = 10.<a name='12585'>
         cldfrac(ncol,kte+1) = 0.<a name='12586'>
         do nb = 1, nbndlw<a name='12587'>
            taucld(nb,ncol,kte+1) = 0.<a name='12588'>
         enddo<a name='12589'>
<a name='12590'>
         endif<a name='12591'>
<a name='12592'>
         <font color=#447700>! Buffer adjustment. Steven Cavallo December 2010<a name='12593'></font>
         do k=kte+1,nlayers<a name='12594'>
            clwpth(ncol,k) = 0.<a name='12595'>
            ciwpth(ncol,k) = 0.<a name='12596'>
            cswpth(ncol,k) = 0.<a name='12597'>
            rel(ncol,k) = 10.<a name='12598'>
            rei(ncol,k) = 10.<a name='12599'>
            res(ncol,k) = 10.<a name='12600'>
            cldfrac(ncol,k) = 0.<a name='12601'>
            do nb = 1,nbndlw<a name='12602'>
               taucld(nb,ncol,k) = 0.<a name='12603'>
            enddo<a name='12604'>
         enddo   <a name='12605'>
<a name='12606'>
         iplon = 1<a name='12607'>
         irng = 0<a name='12608'>
         permuteseed = 150<a name='12609'>
<a name='12610'>
<font color=#447700>! Sub-column generator for McICA<a name='12611'></font>
         call <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#MCICA_SUBCOL_LW'>mcica_subcol_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MCICA_SUBCOL_LW_1">(iplon, ncol, nlay, icld, permuteseed, irng, play, &amp;<a name='12612'>
                       cldfrac, ciwpth, clwpth, cswpth, rei, rel, res, taucld, cldfmcl, &amp;<a name='12613'>
                       ciwpmcl, clwpmcl, cswpmcl, reicmcl, relqmcl, resnmcl, taucmcl)<a name='12614'>
<a name='12615'>
<font color=#447700>!--------------------------------------------------------------------------<a name='12616'></font>
<font color=#447700>! Aerosol optical depth, single scattering albedo and asymmetry parameter -czhao 03/2010<a name='12617'></font>
<font color=#447700>!--------------------------------------------------------------------------<a name='12618'></font>
<font color=#447700>! Aerosol optical depth by layer for each RRTMG longwave band<a name='12619'></font>
<font color=#447700>! No aerosols in layer above model top (kte+1)<a name='12620'></font>
<font color=#447700>! Steven Cavallo: Upper bound of loop changed to nlayers from kte+1<a name='12621'></font>
<font color=#447700>!        do nb = 1, nbndlw<a name='12622'></font>
<font color=#447700>!           do k = kts, kte+1<a name='12623'></font>
<font color=#447700>!              tauaer(ncol,k,nb) = 0.<a name='12624'></font>
<font color=#447700>!           enddo<a name='12625'></font>
<font color=#447700>!        enddo<a name='12626'></font>
<a name='12627'>
<font color=#447700>! ... Aerosol effects. Added aerosol feedbacks from Chem , 03/2010 -czhao<a name='12628'></font>
<font color=#447700>!<a name='12629'></font>
      do nb = 1, nbndlw<a name='12630'>
      do k = kts,nlayers<a name='12631'>
         tauaer(ncol,k,nb) = 0.<a name='12632'>
      end do<a name='12633'>
      end do<a name='12634'>
<a name='12635'>
#if ( WRF_CHEM == 1 )<a name='12636'>
   IF ( AER_RA_FEEDBACK == 1) then<a name='12637'>
<font color=#447700>!     do nb = 1, nbndlw <a name='12638'></font>
      do k = kts,kte      <font color=#447700>!wig<a name='12639'></font>
        if(tauaerlw1(i,k,j).gt.thresh .and. tauaerlw16(i,k,j).gt.thresh) then<a name='12640'>
          tauaer(ncol,k,1)=tauaerlw1(i,k,j)<a name='12641'>
          tauaer(ncol,k,2)=tauaerlw2(i,k,j)<a name='12642'>
          tauaer(ncol,k,3)=tauaerlw3(i,k,j)<a name='12643'>
          tauaer(ncol,k,4)=tauaerlw4(i,k,j)<a name='12644'>
          tauaer(ncol,k,5)=tauaerlw5(i,k,j)<a name='12645'>
          tauaer(ncol,k,6)=tauaerlw6(i,k,j)<a name='12646'>
          tauaer(ncol,k,7)=tauaerlw7(i,k,j)<a name='12647'>
          tauaer(ncol,k,8)=tauaerlw8(i,k,j)<a name='12648'>
          tauaer(ncol,k,9)=tauaerlw9(i,k,j)<a name='12649'>
          tauaer(ncol,k,10)=tauaerlw10(i,k,j)<a name='12650'>
          tauaer(ncol,k,11)=tauaerlw11(i,k,j)<a name='12651'>
          tauaer(ncol,k,12)=tauaerlw12(i,k,j)<a name='12652'>
          tauaer(ncol,k,13)=tauaerlw13(i,k,j)<a name='12653'>
          tauaer(ncol,k,14)=tauaerlw14(i,k,j)<a name='12654'>
          tauaer(ncol,k,15)=tauaerlw15(i,k,j)<a name='12655'>
          tauaer(ncol,k,16)=tauaerlw16(i,k,j)<a name='12656'>
        endif<a name='12657'>
      enddo <font color=#447700>! k<a name='12658'></font>
<font color=#447700>!     end do ! nb<a name='12659'></font>
<a name='12660'>
<font color=#447700>!wig beg<a name='12661'></font>
      do nb = 1, nbndlw<a name='12662'>
         slope = 0.  <font color=#447700>!use slope as a sum holder<a name='12663'></font>
         do k = kts,kte<a name='12664'>
            slope = slope + tauaer(ncol,k,nb)<a name='12665'>
         end do<a name='12666'>
         if( slope &lt; 0. ) then<a name='12667'>
            write(msg,'("ERROR: Negative total lw optical depth of ",f8.2," at point i,j,nb=",3i5)') slope,i,j,nb<a name='12668'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1031">(msg)<a name='12669'>
         else if( slope &gt; 5. ) then<a name='12670'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_856">("-------------------------")<a name='12671'>
            write(msg,'("WARNING: Large total lw optical depth of ",f8.2," at point i,j,nb=",3i5)') slope,i,j,nb<a name='12672'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_857">(msg)<a name='12673'>
<a name='12674'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_858">("Diagnostics 1: k, tauaerlw1, tauaerlw16")<a name='12675'>
            do k=kts,kte<a name='12676'>
               write(msg,'(i4,2f8.2)') k, tauaerlw1(i,k,j), tauaerlw16(i,k,j)<a name='12677'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_859">(msg)<a name='12678'>
            end do<a name='12679'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_860">("-------------------------")<a name='12680'>
         endif<a name='12681'>
      enddo  <font color=#447700>! nb<a name='12682'></font>
      endif  <font color=#447700>! aer_ra_feedback<a name='12683'></font>
#endif<a name='12684'>
<a name='12685'>
<font color=#447700>! Call RRTMG longwave radiation model<a name='12686'></font>
         call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW'>rrtmg_lw</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_1"> &amp;<a name='12687'>
            (ncol    ,nlay    ,icld    , &amp;<a name='12688'>
             play    ,plev    ,tlay    ,tlev    ,tsfc    , &amp; <a name='12689'>
             h2ovmr  ,o3vmr   ,co2vmr  ,ch4vmr  ,n2ovmr  ,o2vmr , &amp;<a name='12690'>
             cfc11vmr,cfc12vmr,cfc22vmr,ccl4vmr ,emis    , &amp;<a name='12691'>
             inflglw ,iceflglw,liqflglw,cldfmcl , &amp;<a name='12692'>
             taucmcl ,ciwpmcl ,clwpmcl ,cswpmcl, reicmcl ,relqmcl ,resnmcl , &amp;<a name='12693'>
             tauaer  , &amp;<a name='12694'>
             uflx    ,dflx    ,hr      ,uflxc   ,dflxc,  hrc)<a name='12695'>
<a name='12696'>
<font color=#447700>! Output downard surface flux, and outgoing longwave flux and cloud forcing <a name='12697'></font>
<font color=#447700>! at the top of atmosphere (W/m2)<a name='12698'></font>
         glw(i,j) = dflx(1,1)<a name='12699'>
<font color=#447700>!         olr(i,j) = uflx(1,kte+2)<a name='12700'></font>
<font color=#447700>!         lwcf(i,j) = uflxc(1,kte+2) - uflx(1,kte+2)<a name='12701'></font>
<font color=#447700>! Steven Cavallo: Changed OLR to be valid at the top of atmosphere instead <a name='12702'></font>
<font color=#447700>! of top of model.  Dec 2010.<a name='12703'></font>
         olr(i,j) = uflx(1,nlayers+1)<a name='12704'>
         lwcf(i,j) = uflxc(1,nlayers+1) - uflx(1,nlayers+1)<a name='12705'>
<a name='12706'>
         if (present(lwupt)) then <a name='12707'>
<font color=#447700>! Output up and down toa fluxes for total and clear sky<a name='12708'></font>
<font color=#447700>! nlayers+1 represents value at 0 mb<a name='12709'></font>
            lwupt(i,j)     = uflx(1,nlayers+1)<a name='12710'>
            lwuptc(i,j)    = uflxc(1,nlayers+1)<a name='12711'>
            lwdnt(i,j)     = dflx(1,nlayers+1)<a name='12712'>
            lwdntc(i,j)    = dflxc(1,nlayers+1)<a name='12713'>
<font color=#447700>! Output up and down surface fluxes for total and clear sky<a name='12714'></font>
            lwupb(i,j)     = uflx(1,1)<a name='12715'>
            lwupbc(i,j)    = uflxc(1,1)<a name='12716'>
            lwdnb(i,j)     = dflx(1,1)<a name='12717'>
            lwdnbc(i,j)    = dflxc(1,1)<a name='12718'>
         endif<a name='12719'>
<a name='12720'>
<font color=#447700>! Output up and down layer fluxes for total and clear sky.<a name='12721'></font>
<font color=#447700>! Vertical ordering is from bottom to top in units of W m-2. <a name='12722'></font>
         if ( present (lwupflx) ) then<a name='12723'>
         do k=kts,kte+2<a name='12724'>
            lwupflx(i,k,j)  = uflx(1,k)<a name='12725'>
            lwupflxc(i,k,j) = uflxc(1,k)<a name='12726'>
            lwdnflx(i,k,j)  = dflx(1,k)<a name='12727'>
            lwdnflxc(i,k,j) = dflxc(1,k)<a name='12728'>
         enddo<a name='12729'>
         endif<a name='12730'>
<a name='12731'>
<font color=#447700>! Output heating rate tendency; convert heating rate from K/d to K/s<a name='12732'></font>
<font color=#447700>! Heating rate arrays are ordered vertically from bottom to top here. <a name='12733'></font>
         do k=kts,kte<a name='12734'>
            tten1d(k) = hr(ncol,k)/86400.<a name='12735'>
            rthratenlw(i,k,j) = tten1d(k)/pi3d(i,k,j)<a name='12736'>
         enddo<a name='12737'>
<a name='12738'>
<font color=#447700>!<a name='12739'></font>
      end do i_loop<a name='12740'>
   end do j_loop                                           <a name='12741'>
<a name='12742'>
<font color=#447700>!-------------------------------------------------------------------<a name='12743'></font>
<a name='12744'>
   END SUBROUTINE RRTMG_LWRAD<a name='12745'>
<a name='12746'>
 <a name='12747'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12748'></font>
<A NAME='INIRAD'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#INIRAD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12749'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>INIRAD</font> (O3PROF,Plev, kts, kte) <A href='../../call_to/INIRAD.html' TARGET='index'>6</A>,<A href='../../call_from/INIRAD.html' TARGET='index'>3</A><a name='12750'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12751'></font>
      IMPLICIT NONE<a name='12752'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12753'></font>
   INTEGER, INTENT(IN   )                        ::    kts,kte<a name='12754'>
<a name='12755'>
   REAL, DIMENSION( kts:kte+1 ),INTENT(INOUT)    ::    O3PROF<a name='12756'>
<a name='12757'>
   REAL, DIMENSION( kts:kte+2 ),INTENT(IN   )    ::      Plev<a name='12758'>
<a name='12759'>
<font color=#447700>! LOCAL VAR<a name='12760'></font>
  <a name='12761'>
   INTEGER :: k<a name='12762'>
<a name='12763'>
<font color=#447700>!                                                                                <a name='12764'></font>
<font color=#447700>!  COMPUTE OZONE MIXING RATIO DISTRIBUTION                                       <a name='12765'></font>
<font color=#447700>!                                                                                <a name='12766'></font>
   DO K=kts,kte+1<a name='12767'>
      O3PROF(K)=0.                                                       <a name='12768'>
   ENDDO<a name='12769'>
                                                                                 <a name='12770'>
   CALL <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#O3DATA'>O3DATA</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#INIRAD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="O3DATA_2">(O3PROF, Plev, kts, kte)<a name='12771'>
<a name='12772'>
   END SUBROUTINE INIRAD<a name='12773'>
                                                                                 <a name='12774'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12775'></font>
<A NAME='O3DATA'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#O3DATA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12776'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>O3DATA</font> (O3PROF, Plev, kts, kte) <A href='../../call_to/O3DATA.html' TARGET='index'>3</A><a name='12777'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12778'></font>
   IMPLICIT NONE<a name='12779'>
<font color=#447700>!-------------------------------------------------------------------------<a name='12780'></font>
<font color=#447700>!<a name='12781'></font>
   INTEGER, INTENT(IN   )   ::       kts, kte<a name='12782'>
<font color=#447700>!<a name='12783'></font>
   REAL, DIMENSION( kts:kte+1 ),INTENT(INOUT)    ::    O3PROF<a name='12784'>
<a name='12785'>
   REAL, DIMENSION( kts:kte+2 ),INTENT(IN   )    ::      Plev<a name='12786'>
<a name='12787'>
<font color=#447700>! LOCAL VAR<a name='12788'></font>
   INTEGER :: K, JJ<a name='12789'>
<a name='12790'>
   REAL    ::  PRLEVH(kts:kte+2),PPWRKH(32),                     &amp;<a name='12791'>
               O3WRK(31),PPWRK(31),O3SUM(31),PPSUM(31),          &amp;<a name='12792'>
               O3WIN(31),PPWIN(31),O3ANN(31),PPANN(31)                                                       <a name='12793'>
<a name='12794'>
   REAL    ::  PB1, PB2, PT1, PT2<a name='12795'>
<a name='12796'>
   DATA O3SUM  /5.297E-8,5.852E-8,6.579E-8,7.505E-8,             &amp;                    <a name='12797'>
        8.577E-8,9.895E-8,1.175E-7,1.399E-7,1.677E-7,2.003E-7,   &amp;                 <a name='12798'>
        2.571E-7,3.325E-7,4.438E-7,6.255E-7,8.168E-7,1.036E-6,   &amp;                 <a name='12799'>
        1.366E-6,1.855E-6,2.514E-6,3.240E-6,4.033E-6,4.854E-6,   &amp;                 <a name='12800'>
        5.517E-6,6.089E-6,6.689E-6,1.106E-5,1.462E-5,1.321E-5,   &amp;                 <a name='12801'>
        9.856E-6,5.960E-6,5.960E-6/                                              <a name='12802'>
<a name='12803'>
   DATA PPSUM  /955.890,850.532,754.599,667.742,589.841,         &amp;  <a name='12804'>
        519.421,455.480,398.085,347.171,301.735,261.310,225.360, &amp;               <a name='12805'>
        193.419,165.490,141.032,120.125,102.689, 87.829, 75.123, &amp;            <a name='12806'>
         64.306, 55.086, 47.209, 40.535, 34.795, 29.865, 19.122, &amp;               <a name='12807'>
          9.277,  4.660,  2.421,  1.294,  0.647/                                 <a name='12808'>
<font color=#447700>!                                                                                <a name='12809'></font>
   DATA O3WIN  /4.629E-8,4.686E-8,5.017E-8,5.613E-8,             &amp;<a name='12810'>
        6.871E-8,8.751E-8,1.138E-7,1.516E-7,2.161E-7,3.264E-7,   &amp;               <a name='12811'>
        4.968E-7,7.338E-7,1.017E-6,1.308E-6,1.625E-6,2.011E-6,   &amp;               <a name='12812'>
        2.516E-6,3.130E-6,3.840E-6,4.703E-6,5.486E-6,6.289E-6,   &amp;               <a name='12813'>
        6.993E-6,7.494E-6,8.197E-6,9.632E-6,1.113E-5,1.146E-5,   &amp;               <a name='12814'>
        9.389E-6,6.135E-6,6.135E-6/                                              <a name='12815'>
<a name='12816'>
   DATA PPWIN  /955.747,841.783,740.199,649.538,568.404,         &amp;<a name='12817'>
        495.815,431.069,373.464,322.354,277.190,237.635,203.433, &amp;               <a name='12818'>
        174.070,148.949,127.408,108.915, 93.114, 79.551, 67.940, &amp;               <a name='12819'>
         58.072, 49.593, 42.318, 36.138, 30.907, 26.362, 16.423, &amp;               <a name='12820'>
          7.583,  3.620,  1.807,  0.938,  0.469/                                 <a name='12821'>
<font color=#447700>!                                                                                <a name='12822'></font>
<a name='12823'>
   DO K=1,31                                                              <a name='12824'>
     PPANN(K)=PPSUM(K)                                                        <a name='12825'>
   ENDDO<a name='12826'>
<font color=#447700>!<a name='12827'></font>
   O3ANN(1)=0.5*(O3SUM(1)+O3WIN(1))                                           <a name='12828'>
<font color=#447700>!                                                                                <a name='12829'></font>
   DO K=2,31                                                              <a name='12830'>
      O3ANN(K)=O3WIN(K-1)+(O3WIN(K)-O3WIN(K-1))/(PPWIN(K)-PPWIN(K-1))* &amp; <a name='12831'>
               (PPSUM(K)-PPWIN(K-1))                                           <a name='12832'>
   ENDDO<a name='12833'>
<font color=#447700>!<a name='12834'></font>
   DO K=2,31                                                              <a name='12835'>
      O3ANN(K)=0.5*(O3ANN(K)+O3SUM(K))                                         <a name='12836'>
   ENDDO<a name='12837'>
<font color=#447700>!<a name='12838'></font>
   DO K=1,31                                                                <a name='12839'>
      O3WRK(K)=O3ANN(K)                                                        <a name='12840'>
      PPWRK(K)=PPANN(K)                                                        <a name='12841'>
   ENDDO<a name='12842'>
<font color=#447700>!                                                                                <a name='12843'></font>
<font color=#447700>!  CALCULATE HALF PRESSURE LEVELS FOR MODEL AND DATA LEVELS                     <a name='12844'></font>
<font color=#447700>!                                                                                <a name='12845'></font>
<a name='12846'>
<font color=#447700>! Plev is total P at model levels, from bottom to top<a name='12847'></font>
<font color=#447700>! Plev is in mb<a name='12848'></font>
<a name='12849'>
   DO K=kts,kte+2<a name='12850'>
      PRLEVH(K)=Plev(K)<a name='12851'>
   ENDDO<a name='12852'>
<font color=#447700>!                                                                                <a name='12853'></font>
   PPWRKH(1)=1100.                                                        <a name='12854'>
   DO K=2,31                                                           <a name='12855'>
      PPWRKH(K)=(PPWRK(K)+PPWRK(K-1))/2.                                   <a name='12856'>
   ENDDO<a name='12857'>
   PPWRKH(32)=0.                                                          <a name='12858'>
   DO K=kts,kte+1<a name='12859'>
      DO 25 JJ=1,31                                                        <a name='12860'>
         IF((-(PRLEVH(K)-PPWRKH(JJ))).GE.0.)THEN                            <a name='12861'>
           PB1=0.                                                           <a name='12862'>
         ELSE                                                               <a name='12863'>
           PB1=PRLEVH(K)-PPWRKH(JJ)                                         <a name='12864'>
         ENDIF                                                              <a name='12865'>
         IF((-(PRLEVH(K)-PPWRKH(JJ+1))).GE.0.)THEN                          <a name='12866'>
           PB2=0.                                                           <a name='12867'>
         ELSE                                                               <a name='12868'>
           PB2=PRLEVH(K)-PPWRKH(JJ+1)                                       <a name='12869'>
         ENDIF                                                              <a name='12870'>
         IF((-(PRLEVH(K+1)-PPWRKH(JJ))).GE.0.)THEN                          <a name='12871'>
           PT1=0.                                                           <a name='12872'>
         ELSE                                                               <a name='12873'>
           PT1=PRLEVH(K+1)-PPWRKH(JJ)                                       <a name='12874'>
         ENDIF                                                              <a name='12875'>
         IF((-(PRLEVH(K+1)-PPWRKH(JJ+1))).GE.0.)THEN                        <a name='12876'>
           PT2=0.                                                           <a name='12877'>
         ELSE                                                               <a name='12878'>
           PT2=PRLEVH(K+1)-PPWRKH(JJ+1)                                     <a name='12879'>
         ENDIF                                                              <a name='12880'>
         O3PROF(K)=O3PROF(K)+(PB2-PB1-PT2+PT1)*O3WRK(JJ)                <a name='12881'>
  25  CONTINUE                                                             <a name='12882'>
      O3PROF(K)=O3PROF(K)/(PRLEVH(K)-PRLEVH(K+1))                      <a name='12883'>
<a name='12884'>
   ENDDO<a name='12885'>
<font color=#447700>!                                                                                <a name='12886'></font>
   END SUBROUTINE O3DATA<a name='12887'>
<a name='12888'>
<font color=#447700>!------------------------------------------------------------------<a name='12889'></font>
<a name='12890'>
<font color=#447700>!====================================================================<a name='12891'></font>
<A NAME='RRTMG_LWINIT'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12892'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>rrtmg_lwinit</font>(                                         &amp; <A href='../../call_to/RRTMG_LWINIT.html' TARGET='index'>1</A>,<A href='../../call_from/RRTMG_LWINIT.html' TARGET='index'>2</A><a name='12893'>
                       p_top, allowed_to_read ,                     &amp;<a name='12894'>
                       ids, ide, jds, jde, kds, kde,                &amp;<a name='12895'>
                       ims, ime, jms, jme, kms, kme,                &amp;<a name='12896'>
                       its, ite, jts, jte, kts, kte                 )<a name='12897'>
<font color=#447700>!--------------------------------------------------------------------<a name='12898'></font>
   IMPLICIT NONE<a name='12899'>
<font color=#447700>!--------------------------------------------------------------------<a name='12900'></font>
<a name='12901'>
   LOGICAL , INTENT(IN)           :: allowed_to_read<a name='12902'>
   INTEGER , INTENT(IN)           :: ids, ide, jds, jde, kds, kde,  &amp;<a name='12903'>
                                     ims, ime, jms, jme, kms, kme,  &amp;<a name='12904'>
                                     its, ite, jts, jte, kts, kte<a name='12905'>
   REAL, INTENT(IN)               :: p_top <a name='12906'>
<a name='12907'>
<font color=#447700>! Steven Cavallo.  Added for buffer layer adjustment.   December 2010.<a name='12908'></font>
   NLAYERS = kme + nint(p_top*0.01/deltap)- 1 <font color=#447700>! Model levels plus new levels.<a name='12909'></font>
                                              <font color=#447700>! nlayers will subsequently <a name='12910'></font>
                                              <font color=#447700>! replace kte+1<a name='12911'></font>
<a name='12912'>
<font color=#447700>! Read in absorption coefficients and other data<a name='12913'></font>
   IF ( allowed_to_read ) THEN<a name='12914'>
     CALL <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE'>rrtmg_lwlookuptable</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LWLOOKUPTABLE_1"><a name='12915'>
   ENDIF<a name='12916'>
<a name='12917'>
<font color=#447700>! Perform g-point reduction and other initializations<a name='12918'></font>
<font color=#447700>! Specific heat of dry air (cp) used in flux to heating rate conversion factor.<a name='12919'></font>
   call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LW_INI'>rrtmg_lw_ini</A><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRTMG_LW_INI_1">(cp)<a name='12920'>
<a name='12921'>
   END SUBROUTINE rrtmg_lwinit<a name='12922'>
<a name='12923'>
<a name='12924'>
<font color=#447700>! **************************************************************************     <a name='12925'></font>
<A NAME='RRTMG_LWLOOKUPTABLE'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRTMG_LWLOOKUPTABLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12926'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>rrtmg_lwlookuptable</font> <A href='../../call_to/RRTMG_LWLOOKUPTABLE.html' TARGET='index'>2</A>,<A href='../../call_from/RRTMG_LWLOOKUPTABLE.html' TARGET='index'>38</A><a name='12927'>
<font color=#447700>! **************************************************************************     <a name='12928'></font>
<a name='12929'>
IMPLICIT NONE<a name='12930'>
<a name='12931'>
<font color=#447700>! Local                                    <a name='12932'></font>
      INTEGER :: i<a name='12933'>
      LOGICAL                 :: opened<a name='12934'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='12935'>
<a name='12936'>
      CHARACTER*80 errmess<a name='12937'>
      INTEGER rrtmg_unit<a name='12938'>
<a name='12939'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='12940'>
        DO i = 10,99<a name='12941'>
          INQUIRE ( i , OPENED = opened )<a name='12942'>
          IF ( .NOT. opened ) THEN<a name='12943'>
            rrtmg_unit = i<a name='12944'>
            GOTO 2010<a name='12945'>
          ENDIF<a name='12946'>
        ENDDO<a name='12947'>
        rrtmg_unit = -1<a name='12948'>
 2010   CONTINUE<a name='12949'>
      ENDIF<a name='12950'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_318"> ( rrtmg_unit , IWORDSIZE )<a name='12951'>
      IF ( rrtmg_unit &lt; 0 ) THEN<a name='12952'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1032"> ( 'module_ra_rrtmg_lw: rrtm_lwlookuptable: Can not '// &amp;<a name='12953'>
                               'find unused fortran unit to read in lookup table.' )<a name='12954'>
      ENDIF<a name='12955'>
<a name='12956'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='12957'>
        OPEN(rrtmg_unit,FILE='RRTMG_LW_DATA',                  &amp;<a name='12958'>
             FORM='UNFORMATTED',STATUS='OLD',ERR=9009)<a name='12959'>
      ENDIF<a name='12960'>
<a name='12961'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01'>lw_kgb01</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB01_1">(rrtmg_unit)<a name='12962'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02'>lw_kgb02</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB02_1">(rrtmg_unit)<a name='12963'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03'>lw_kgb03</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB03_1">(rrtmg_unit)<a name='12964'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04'>lw_kgb04</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB04_1">(rrtmg_unit)<a name='12965'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05'>lw_kgb05</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB05_1">(rrtmg_unit)<a name='12966'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06'>lw_kgb06</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB06_1">(rrtmg_unit)<a name='12967'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07'>lw_kgb07</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB07_1">(rrtmg_unit)<a name='12968'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08'>lw_kgb08</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB08_1">(rrtmg_unit)<a name='12969'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09'>lw_kgb09</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB09_1">(rrtmg_unit)<a name='12970'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10'>lw_kgb10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB10_1">(rrtmg_unit)<a name='12971'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11'>lw_kgb11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB11_1">(rrtmg_unit)<a name='12972'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12'>lw_kgb12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB12_1">(rrtmg_unit)<a name='12973'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13'>lw_kgb13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB13_1">(rrtmg_unit)<a name='12974'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14'>lw_kgb14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB14_1">(rrtmg_unit)<a name='12975'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15'>lw_kgb15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB15_1">(rrtmg_unit)<a name='12976'>
      call <A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16'>lw_kgb16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LW_KGB16_1">(rrtmg_unit)<a name='12977'>
<a name='12978'>
     IF ( wrf_dm_on_monitor() ) CLOSE (rrtmg_unit)<a name='12979'>
<a name='12980'>
     RETURN<a name='12981'>
9009 CONTINUE<a name='12982'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error opening RRTMG_LW_DATA on unit ',rrtmg_unit<a name='12983'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#RRTMG_LWLOOKUPTABLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1033">(errmess)<a name='12984'>
<a name='12985'>
     END SUBROUTINE rrtmg_lwlookuptable<a name='12986'>
<a name='12987'>
<font color=#447700>! **************************************************************************     <a name='12988'></font>
<font color=#447700>!  RRTMG Longwave Radiative Transfer Model<a name='12989'></font>
<font color=#447700>!  Atmospheric and Environmental Research, Inc., Cambridge, MA<a name='12990'></font>
<font color=#447700>!<a name='12991'></font>
<font color=#447700>!  Original version:   E. J. Mlawer, et al.<a name='12992'></font>
<font color=#447700>!  Revision for GCMs:  Michael J. Iacono; October, 2002<a name='12993'></font>
<font color=#447700>!  Revision for F90 formatting:  Michael J. Iacono; June 2006<a name='12994'></font>
<font color=#447700>!<a name='12995'></font>
<font color=#447700>!  This file contains 16 READ statements that include the <a name='12996'></font>
<font color=#447700>!  absorption coefficients and other data for each of the 16 longwave<a name='12997'></font>
<font color=#447700>!  spectral bands used in RRTMG_LW.  Here, the data are defined for 16<a name='12998'></font>
<font color=#447700>!  g-points, or sub-intervals, per band.  These data are combined and<a name='12999'></font>
<font color=#447700>!  weighted using a mapping procedure in module RRTMG_LW_INIT to reduce<a name='13000'></font>
<font color=#447700>!  the total number of g-points from 256 to 140 for use in the GCM.<a name='13001'></font>
<font color=#447700>! **************************************************************************     <a name='13002'></font>
<a name='13003'>
<font color=#447700>! **************************************************************************<a name='13004'></font>
<A NAME='LW_KGB01'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB01' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13005'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb01</font>(rrtmg_unit) <A href='../../call_to/LW_KGB01.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB01.html' TARGET='index'>6</A><a name='13006'>
<font color=#447700>! **************************************************************************<a name='13007'></font>
<a name='13008'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG01'>rrlw_kg01</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG01_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, &amp;<a name='13009'>
                           absa, absb, &amp;<a name='13010'>
                      selfrefo, forrefo<a name='13011'>
<a name='13012'>
      implicit none<a name='13013'>
      save<a name='13014'>
<a name='13015'>
<font color=#447700>! Input<a name='13016'></font>
      integer, intent(in) :: rrtmg_unit<a name='13017'>
<a name='13018'>
<font color=#447700>! Local                                    <a name='13019'></font>
      character*80 errmess<a name='13020'>
      logical, external  :: wrf_dm_on_monitor<a name='13021'>
<a name='13022'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13023'></font>
<font color=#447700>!     and upper atmosphere.<a name='13024'></font>
<font color=#447700>!     Planck fraction mapping levels: P = 212.7250 mbar, T = 223.06 K<a name='13025'></font>
<a name='13026'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13027'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13028'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13029'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13030'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13031'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13032'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13033'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13034'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13035'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13036'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13037'></font>
<a name='13038'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13039'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13040'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13041'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13042'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13043'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13044'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13045'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13046'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13047'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13048'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13049'></font>
<a name='13050'>
<font color=#447700>!     The arrays kao_mn2 and kbo_mn2 contain the coefficients of the <a name='13051'></font>
<font color=#447700>!     nitrogen continuum for the upper and lower atmosphere.<a name='13052'></font>
<font color=#447700>!     Minor gas mapping levels: <a name='13053'></font>
<font color=#447700>!     Lower - n2: P = 142.5490 mbar, T = 215.70 K<a name='13054'></font>
<font color=#447700>!     Upper - n2: P = 142.5490 mbar, T = 215.70 K<a name='13055'></font>
<a name='13056'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13057'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13058'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13059'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13060'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13061'></font>
<a name='13062'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13063'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13064'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13065'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13066'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13067'></font>
<a name='13068'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_319"> ( A , size ( A ) * RWORDSIZE )<a name='13069'>
<a name='13070'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13071'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2, kbo_mn2, selfrefo, forrefo<a name='13072'>
      DM_BCAST_MACRO(fracrefao)<a name='13073'>
      DM_BCAST_MACRO(fracrefbo)<a name='13074'>
      DM_BCAST_MACRO(kao)<a name='13075'>
      DM_BCAST_MACRO(kbo)<a name='13076'>
      DM_BCAST_MACRO(kao_mn2)<a name='13077'>
      DM_BCAST_MACRO(kbo_mn2)<a name='13078'>
      DM_BCAST_MACRO(selfrefo)<a name='13079'>
      DM_BCAST_MACRO(forrefo)<a name='13080'>
<a name='13081'>
     RETURN<a name='13082'>
9010 CONTINUE<a name='13083'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13084'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1034">(errmess)<a name='13085'>
<a name='13086'>
      end subroutine lw_kgb01<a name='13087'>
<a name='13088'>
<font color=#447700>! **************************************************************************<a name='13089'></font>
<A NAME='LW_KGB02'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB02' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13090'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb02</font>(rrtmg_unit) <A href='../../call_to/LW_KGB02.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB02.html' TARGET='index'>6</A><a name='13091'>
<font color=#447700>! **************************************************************************<a name='13092'></font>
<a name='13093'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG02'>rrlw_kg02</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG02_3">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13094'>
<a name='13095'>
      implicit none<a name='13096'>
      save<a name='13097'>
<a name='13098'>
<font color=#447700>! Input<a name='13099'></font>
      integer, intent(in) :: rrtmg_unit<a name='13100'>
<a name='13101'>
<font color=#447700>! Local                                    <a name='13102'></font>
      character*80 errmess<a name='13103'>
      logical, external  :: wrf_dm_on_monitor<a name='13104'>
<a name='13105'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13106'></font>
<font color=#447700>!     and upper atmosphere.<a name='13107'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13108'></font>
<font color=#447700>!     Lower: P = 1053.630 mbar, T = 294.2 K<a name='13109'></font>
<font color=#447700>!     Upper: P = 3.206e-2 mb, T = 197.92 K<a name='13110'></font>
<a name='13111'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13112'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13113'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13114'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13115'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13116'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13117'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13118'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13119'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13120'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13121'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13122'></font>
<a name='13123'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13124'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13125'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13126'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13127'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13128'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13129'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13130'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13131'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13132'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13133'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13134'></font>
<a name='13135'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13136'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13137'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13138'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13139'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13140'></font>
<a name='13141'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13142'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13143'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13144'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13145'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13146'></font>
<a name='13147'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_320"> ( A , size ( A ) * RWORDSIZE )<a name='13148'>
<a name='13149'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13150'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13151'>
      DM_BCAST_MACRO(fracrefao)<a name='13152'>
      DM_BCAST_MACRO(fracrefbo)<a name='13153'>
      DM_BCAST_MACRO(kao)<a name='13154'>
      DM_BCAST_MACRO(kbo)<a name='13155'>
      DM_BCAST_MACRO(selfrefo)<a name='13156'>
      DM_BCAST_MACRO(forrefo)<a name='13157'>
<a name='13158'>
     RETURN<a name='13159'>
9010 CONTINUE<a name='13160'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13161'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB02' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1035">(errmess)<a name='13162'>
<a name='13163'>
      end subroutine lw_kgb02<a name='13164'>
<a name='13165'>
<font color=#447700>! **************************************************************************<a name='13166'></font>
<A NAME='LW_KGB03'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB03' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13167'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb03</font>(rrtmg_unit) <A href='../../call_to/LW_KGB03.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB03.html' TARGET='index'>6</A><a name='13168'>
<font color=#447700>! **************************************************************************<a name='13169'></font>
<a name='13170'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG03'>rrlw_kg03</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG03_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2o, &amp;<a name='13171'>
                            kbo_mn2o, selfrefo, forrefo<a name='13172'>
<a name='13173'>
      implicit none<a name='13174'>
      save<a name='13175'>
<a name='13176'>
<font color=#447700>! Input<a name='13177'></font>
      integer, intent(in) :: rrtmg_unit<a name='13178'>
<a name='13179'>
<font color=#447700>! Local                                    <a name='13180'></font>
      character*80 errmess<a name='13181'>
      logical, external  :: wrf_dm_on_monitor<a name='13182'>
<a name='13183'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13184'></font>
<font color=#447700>!     and upper atmosphere.<a name='13185'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13186'></font>
<font color=#447700>!     Lower: P = 212.7250 mbar, T = 223.06 K<a name='13187'></font>
<font color=#447700>!     Upper: P = 95.8 mbar, T = 215.7 k<a name='13188'></font>
<a name='13189'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='13190'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='13191'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='13192'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13193'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13194'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13195'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13196'></font>
<font color=#447700>!     to that of gas2.<a name='13197'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13198'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13199'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13200'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13201'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13202'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13203'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13204'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13205'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13206'></font>
<a name='13207'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13208'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13209'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13210'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13211'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13212'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13213'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13214'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13215'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13216'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13217'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13218'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13219'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13220'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13221'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13222'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13223'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13224'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13225'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13226'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13227'></font>
<a name='13228'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13229'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13230'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='13231'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13232'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13233'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13234'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13235'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='13236'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13237'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='13238'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13239'></font>
<a name='13240'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='13241'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13242'></font>
<font color=#447700>!     level above 100~ mb.   The first index in the array, JS, runs<a name='13243'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amounts ratios,<a name='13244'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13245'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13246'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 to <a name='13247'></font>
<font color=#447700>!     that of gas2.  The second index refers to temperature <a name='13248'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13249'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='13250'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13251'></font>
<a name='13252'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13253'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13254'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13255'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13256'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13257'></font>
<a name='13258'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13259'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13260'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13261'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13262'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13263'></font>
<a name='13264'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_321"> ( A , size ( A ) * RWORDSIZE )<a name='13265'>
<a name='13266'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13267'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, selfrefo, forrefo<a name='13268'>
      DM_BCAST_MACRO(fracrefao)<a name='13269'>
      DM_BCAST_MACRO(fracrefbo)<a name='13270'>
      DM_BCAST_MACRO(kao)<a name='13271'>
      DM_BCAST_MACRO(kbo)<a name='13272'>
      DM_BCAST_MACRO(kao_mn2o)<a name='13273'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='13274'>
      DM_BCAST_MACRO(selfrefo)<a name='13275'>
      DM_BCAST_MACRO(forrefo)<a name='13276'>
<a name='13277'>
     RETURN<a name='13278'>
9010 CONTINUE<a name='13279'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13280'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB03' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1036">(errmess)<a name='13281'>
<a name='13282'>
      end subroutine lw_kgb03 <a name='13283'>
<a name='13284'>
<font color=#447700>! **************************************************************************<a name='13285'></font>
<A NAME='LW_KGB04'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB04' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13286'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb04</font>(rrtmg_unit) <A href='../../call_to/LW_KGB04.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB04.html' TARGET='index'>6</A><a name='13287'>
<font color=#447700>! **************************************************************************<a name='13288'></font>
<a name='13289'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG04'>rrlw_kg04</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG04_3">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13290'>
<a name='13291'>
      implicit none<a name='13292'>
      save<a name='13293'>
<a name='13294'>
<font color=#447700>! Input<a name='13295'></font>
      integer, intent(in) :: rrtmg_unit<a name='13296'>
<a name='13297'>
<font color=#447700>! Local                                    <a name='13298'></font>
      character*80 errmess<a name='13299'>
      logical, external  :: wrf_dm_on_monitor<a name='13300'>
<a name='13301'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13302'></font>
<font color=#447700>!     and upper atmosphere.<a name='13303'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13304'></font>
<font color=#447700>!     Lower : P = 142.5940 mbar, T = 215.70 K<a name='13305'></font>
<font color=#447700>!     Upper : P = 95.58350 mb, T = 215.70 K<a name='13306'></font>
<a name='13307'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='13308'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='13309'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='13310'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13311'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13312'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13313'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13314'></font>
<font color=#447700>!     to that of gas2.<a name='13315'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13316'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13317'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13318'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13319'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13320'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13321'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13322'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13323'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13324'></font>
<a name='13325'>
<font color=#447700>!     The array KBO contains absorption coefs for each of the 16 g-intervals<a name='13326'></font>
<font color=#447700>!     for a range of pressure levels  &lt; ~100mb, temperatures, and ratios<a name='13327'></font>
<font color=#447700>!     of H2O to CO2.  The first index in the array, JS, runs<a name='13328'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13329'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13330'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13331'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13332'></font>
<font color=#447700>!     to that of gas2.  The second index, JT, which<a name='13333'></font>
<font color=#447700>!     runs from 1 to 5, corresponds to different temperatures.  More <a name='13334'></font>
<font color=#447700>!     specifically, JT = 3 means that the data are for the corresponding <a name='13335'></font>
<font color=#447700>!     reference temperature TREF for this  pressure level, JT = 2 refers <a name='13336'></font>
<font color=#447700>!     to the TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and<a name='13337'></font>
<font color=#447700>!     JT = 5 is for TREF+30.  The third index, JP, runs from 13 to 59 and<a name='13338'></font>
<font color=#447700>!     refers to the corresponding pressure level in PREF (e.g. JP = 13 is<a name='13339'></font>
<font color=#447700>!     for a pressure of 95.5835 mb).  The fourth index, IG, goes from 1 to<a name='13340'></font>
<font color=#447700>!     16, and tells us which g-interval the absorption coefficients are for.<a name='13341'></font>
<a name='13342'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13343'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13344'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13345'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13346'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13347'></font>
<a name='13348'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13349'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13350'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13351'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13352'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13353'></font>
<a name='13354'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_322"> ( A , size ( A ) * RWORDSIZE )<a name='13355'>
<a name='13356'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13357'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13358'>
      DM_BCAST_MACRO(fracrefao)<a name='13359'>
      DM_BCAST_MACRO(fracrefbo)<a name='13360'>
      DM_BCAST_MACRO(kao)<a name='13361'>
      DM_BCAST_MACRO(kbo)<a name='13362'>
      DM_BCAST_MACRO(selfrefo)<a name='13363'>
      DM_BCAST_MACRO(forrefo)<a name='13364'>
<a name='13365'>
     RETURN<a name='13366'>
9010 CONTINUE<a name='13367'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13368'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB04' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1037">(errmess)<a name='13369'>
<a name='13370'>
      end subroutine lw_kgb04<a name='13371'>
<a name='13372'>
<font color=#447700>! **************************************************************************<a name='13373'></font>
<A NAME='LW_KGB05'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB05' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13374'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb05</font>(rrtmg_unit) <A href='../../call_to/LW_KGB05.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB05.html' TARGET='index'>6</A><a name='13375'>
<font color=#447700>! **************************************************************************<a name='13376'></font>
<a name='13377'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG05'>rrlw_kg05</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG05_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mo3, &amp;<a name='13378'>
                            selfrefo, forrefo, ccl4o<a name='13379'>
<a name='13380'>
      implicit none<a name='13381'>
      save<a name='13382'>
<a name='13383'>
<font color=#447700>! Input<a name='13384'></font>
      integer, intent(in) :: rrtmg_unit<a name='13385'>
<a name='13386'>
<font color=#447700>! Local                                    <a name='13387'></font>
      character*80 errmess<a name='13388'>
      logical, external  :: wrf_dm_on_monitor<a name='13389'>
<a name='13390'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13391'></font>
<font color=#447700>!     and upper atmosphere.<a name='13392'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13393'></font>
<font color=#447700>!     Lower: P = 473.42 mb, T = 259.83<a name='13394'></font>
<font color=#447700>!     Upper: P = 0.2369280 mbar, T = 253.60 K<a name='13395'></font>
<a name='13396'>
<font color=#447700>!     The arrays kao_mo3 and ccl4o contain the coefficients for<a name='13397'></font>
<font color=#447700>!     ozone and ccl4 in the lower atmosphere.<a name='13398'></font>
<font color=#447700>!     Minor gas mapping level:<a name='13399'></font>
<font color=#447700>!     Lower - o3: P = 317.34 mbar, T = 240.77 k<a name='13400'></font>
<font color=#447700>!     Lower - ccl4:<a name='13401'></font>
<a name='13402'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='13403'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='13404'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='13405'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13406'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13407'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13408'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13409'></font>
<font color=#447700>!     to that of gas2.<a name='13410'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13411'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13412'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13413'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13414'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13415'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13416'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13417'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13418'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13419'></font>
<a name='13420'>
<font color=#447700>!     The array KBO contains absorption coefs for each of the 16 g-intervals<a name='13421'></font>
<font color=#447700>!     for a range of pressure levels  &lt; ~100mb, temperatures, and ratios<a name='13422'></font>
<font color=#447700>!     of H2O to CO2.  The first index in the array, JS, runs<a name='13423'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13424'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13425'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13426'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13427'></font>
<font color=#447700>!     to that of gas2.  The second index, JT, which<a name='13428'></font>
<font color=#447700>!     runs from 1 to 5, corresponds to different temperatures.  More <a name='13429'></font>
<font color=#447700>!     specifically, JT = 3 means that the data are for the corresponding <a name='13430'></font>
<font color=#447700>!     reference temperature TREF for this  pressure level, JT = 2 refers <a name='13431'></font>
<font color=#447700>!     to the TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and<a name='13432'></font>
<font color=#447700>!     JT = 5 is for TREF+30.  The third index, JP, runs from 13 to 59 and<a name='13433'></font>
<font color=#447700>!     refers to the corresponding pressure level in PREF (e.g. JP = 13 is<a name='13434'></font>
<font color=#447700>!     for a pressure of 95.5835 mb).  The fourth index, IG, goes from 1 to<a name='13435'></font>
<font color=#447700>!     16, and tells us which g-interval the absorption coefficients are for.<a name='13436'></font>
<a name='13437'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13438'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13439'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='13440'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13441'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13442'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13443'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13444'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='13445'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13446'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='13447'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13448'></font>
<a name='13449'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13450'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13451'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13452'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13453'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13454'></font>
<a name='13455'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13456'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13457'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13458'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13459'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13460'></font>
<a name='13461'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_323"> ( A , size ( A ) * RWORDSIZE )<a name='13462'>
<a name='13463'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13464'>
         fracrefao, fracrefbo, kao, kbo, kao_mo3, ccl4o, selfrefo, forrefo<a name='13465'>
      DM_BCAST_MACRO(fracrefao)<a name='13466'>
      DM_BCAST_MACRO(fracrefbo)<a name='13467'>
      DM_BCAST_MACRO(kao)<a name='13468'>
      DM_BCAST_MACRO(kbo)<a name='13469'>
      DM_BCAST_MACRO(kao_mo3)<a name='13470'>
      DM_BCAST_MACRO(ccl4o)<a name='13471'>
      DM_BCAST_MACRO(selfrefo)<a name='13472'>
      DM_BCAST_MACRO(forrefo)<a name='13473'>
<a name='13474'>
     RETURN<a name='13475'>
9010 CONTINUE<a name='13476'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13477'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB05' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1038">(errmess)<a name='13478'>
<a name='13479'>
      end subroutine lw_kgb05<a name='13480'>
<a name='13481'>
<font color=#447700>! **************************************************************************<a name='13482'></font>
<A NAME='LW_KGB06'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB06' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13483'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb06</font>(rrtmg_unit) <A href='../../call_to/LW_KGB06.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB06.html' TARGET='index'>6</A><a name='13484'>
<font color=#447700>! **************************************************************************<a name='13485'></font>
<a name='13486'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG06'>rrlw_kg06</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG06_3">, only : fracrefao, kao, kao_mco2, selfrefo, forrefo, &amp;<a name='13487'>
                            cfc11adjo, cfc12o<a name='13488'>
<a name='13489'>
      implicit none<a name='13490'>
      save<a name='13491'>
<a name='13492'>
<font color=#447700>! Input<a name='13493'></font>
      integer, intent(in) :: rrtmg_unit<a name='13494'>
<a name='13495'>
<font color=#447700>! Local                                    <a name='13496'></font>
      character*80 errmess<a name='13497'>
      logical, external  :: wrf_dm_on_monitor<a name='13498'>
<a name='13499'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13500'></font>
<font color=#447700>!     and upper atmosphere.<a name='13501'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13502'></font>
<font color=#447700>!     Lower: : P = 473.4280 mb, T = 259.83 K<a name='13503'></font>
<a name='13504'>
<font color=#447700>!     The arrays kao_mco2, cfc11adjo and cfc12o contain the coefficients for<a name='13505'></font>
<font color=#447700>!     carbon dioxide in the lower atmosphere and cfc11 and cfc12 in the upper<a name='13506'></font>
<font color=#447700>!     atmosphere.<a name='13507'></font>
<font color=#447700>!     Original cfc11 is multiplied by 1.385 to account for the 1060-1107 cm-1 band.<a name='13508'></font>
<font color=#447700>!     Minor gas mapping level:<a name='13509'></font>
<font color=#447700>!     Lower - co2: P = 706.2720 mb, T = 294.2 k<a name='13510'></font>
<font color=#447700>!     Upper - cfc11, cfc12<a name='13511'></font>
<a name='13512'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13513'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13514'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13515'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13516'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13517'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13518'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13519'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13520'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13521'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13522'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13523'></font>
<a name='13524'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13525'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13526'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='13527'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13528'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='13529'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13530'></font>
<a name='13531'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13532'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13533'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13534'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13535'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13536'></font>
<a name='13537'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13538'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13539'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13540'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13541'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13542'></font>
<a name='13543'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_324"> ( A , size ( A ) * RWORDSIZE )<a name='13544'>
<a name='13545'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13546'>
         fracrefao, kao, kao_mco2, cfc11adjo, cfc12o, selfrefo, forrefo<a name='13547'>
      DM_BCAST_MACRO(fracrefao)<a name='13548'>
      DM_BCAST_MACRO(kao)<a name='13549'>
      DM_BCAST_MACRO(kao_mco2)<a name='13550'>
      DM_BCAST_MACRO(cfc11adjo)<a name='13551'>
      DM_BCAST_MACRO(cfc12o)<a name='13552'>
      DM_BCAST_MACRO(selfrefo)<a name='13553'>
      DM_BCAST_MACRO(forrefo)<a name='13554'>
<a name='13555'>
     RETURN<a name='13556'>
9010 CONTINUE<a name='13557'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13558'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB06' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1039">(errmess)<a name='13559'>
<a name='13560'>
      end subroutine lw_kgb06<a name='13561'>
<a name='13562'>
<font color=#447700>! **************************************************************************<a name='13563'></font>
<A NAME='LW_KGB07'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB07' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13564'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb07</font>(rrtmg_unit) <A href='../../call_to/LW_KGB07.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB07.html' TARGET='index'>6</A><a name='13565'>
<font color=#447700>! **************************************************************************<a name='13566'></font>
<a name='13567'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG07'>rrlw_kg07</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG07_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mco2, &amp;<a name='13568'>
                            kbo_mco2, selfrefo, forrefo<a name='13569'>
<a name='13570'>
      implicit none<a name='13571'>
      save<a name='13572'>
<a name='13573'>
<font color=#447700>! Input<a name='13574'></font>
      integer, intent(in) :: rrtmg_unit<a name='13575'>
<a name='13576'>
<font color=#447700>! Local                                    <a name='13577'></font>
      character*80 errmess<a name='13578'>
      logical, external  :: wrf_dm_on_monitor<a name='13579'>
<a name='13580'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13581'></font>
<font color=#447700>!     and upper atmosphere.<a name='13582'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13583'></font>
<font color=#447700>!     Lower : P = 706.27 mb, T = 278.94 K<a name='13584'></font>
<font color=#447700>!     Upper : P = 95.58 mbar, T= 215.70 K<a name='13585'></font>
<a name='13586'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='13587'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='13588'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='13589'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13590'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13591'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13592'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13593'></font>
<font color=#447700>!     to that of gas2.<a name='13594'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13595'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13596'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13597'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13598'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13599'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13600'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13601'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13602'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13603'></font>
<a name='13604'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13605'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13606'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13607'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13608'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13609'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13610'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13611'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13612'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13613'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13614'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13615'></font>
<a name='13616'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13617'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13618'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='13619'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13620'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13621'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13622'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13623'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='13624'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13625'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='13626'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13627'></font>
<a name='13628'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='13629'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13630'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='13631'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13632'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='13633'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13634'></font>
<a name='13635'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13636'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13637'></font>
<font color=#447700>!     index refers to reference temperature (296_rb,260_rb,224,260) and <a name='13638'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13639'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13640'></font>
<a name='13641'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13642'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13643'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13644'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13645'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13646'></font>
<a name='13647'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_325"> ( A , size ( A ) * RWORDSIZE )<a name='13648'>
<a name='13649'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13650'>
         fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, selfrefo, forrefo<a name='13651'>
      DM_BCAST_MACRO(fracrefao)<a name='13652'>
      DM_BCAST_MACRO(fracrefbo)<a name='13653'>
      DM_BCAST_MACRO(kao)<a name='13654'>
      DM_BCAST_MACRO(kbo)<a name='13655'>
      DM_BCAST_MACRO(kao_mco2)<a name='13656'>
      DM_BCAST_MACRO(kbo_mco2)<a name='13657'>
      DM_BCAST_MACRO(selfrefo)<a name='13658'>
      DM_BCAST_MACRO(forrefo)<a name='13659'>
<a name='13660'>
     RETURN<a name='13661'>
9010 CONTINUE<a name='13662'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13663'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB07' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1040">(errmess)<a name='13664'>
<a name='13665'>
      end subroutine lw_kgb07<a name='13666'>
<a name='13667'>
<font color=#447700>! **************************************************************************<a name='13668'></font>
<A NAME='LW_KGB08'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB08' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13669'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb08</font>(rrtmg_unit) <A href='../../call_to/LW_KGB08.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB08.html' TARGET='index'>6</A><a name='13670'>
<font color=#447700>! **************************************************************************<a name='13671'></font>
<a name='13672'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG08'>rrlw_kg08</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG08_3">, only : fracrefao, fracrefbo, kao, kao_mco2, kao_mn2o, &amp;<a name='13673'>
                            kao_mo3, kbo, kbo_mco2, kbo_mn2o, selfrefo, forrefo, &amp;<a name='13674'>
                            cfc12o, cfc22adjo<a name='13675'>
<a name='13676'>
      implicit none<a name='13677'>
      save<a name='13678'>
<a name='13679'>
<font color=#447700>! Input<a name='13680'></font>
      integer, intent(in) :: rrtmg_unit<a name='13681'>
<a name='13682'>
<font color=#447700>! Local                                    <a name='13683'></font>
      character*80 errmess<a name='13684'>
      logical, external  :: wrf_dm_on_monitor<a name='13685'>
<a name='13686'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13687'></font>
<font color=#447700>!     and upper atmosphere.<a name='13688'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13689'></font>
<font color=#447700>!     Lower: P=473.4280 mb, T = 259.83 K<a name='13690'></font>
<font color=#447700>!     Upper: P=95.5835 mb, T= 215.7 K<a name='13691'></font>
<a name='13692'>
<font color=#447700>!     The arrays kao_mco2, kbo_mco2, kao_mn2o, kbo_mn2o contain the coefficients for<a name='13693'></font>
<font color=#447700>!     carbon dioxide and n2o in the lower and upper atmosphere.<a name='13694'></font>
<font color=#447700>!     The array kao_mo3 contains the coefficients for ozone in the lower atmosphere,<a name='13695'></font>
<font color=#447700>!     and arrays cfc12o and cfc12adjo contain the coefficients for cfc12 and cfc22.<a name='13696'></font>
<font color=#447700>!     Original cfc22 is multiplied by 1.485 to account for the 780-850 cm-1 <a name='13697'></font>
<font color=#447700>!     and 1290-1335 cm-1 bands.<a name='13698'></font>
<font color=#447700>!     Minor gas mapping level:<a name='13699'></font>
<font color=#447700>!     Lower - co2: P = 1053.63 mb, T = 294.2 k<a name='13700'></font>
<font color=#447700>!     Lower - o3: P = 317.348 mb, T = 240.77 k<a name='13701'></font>
<font color=#447700>!     Lower - n2o: P = 706.2720 mb, T= 278.94 k<a name='13702'></font>
<font color=#447700>!     Lower - cfc12, cfc22<a name='13703'></font>
<font color=#447700>!     Upper - co2: P = 35.1632 mb, T = 223.28 k<a name='13704'></font>
<font color=#447700>!     Upper - n2o: P = 8.716e-2 mb, T = 226.03 k<a name='13705'></font>
<a name='13706'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13707'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13708'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13709'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13710'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13711'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13712'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13713'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13714'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13715'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13716'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13717'></font>
<a name='13718'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13719'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13720'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13721'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13722'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13723'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13724'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13725'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13726'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13727'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13728'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13729'></font>
<a name='13730'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13731'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13732'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='13733'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13734'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='13735'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13736'></font>
<a name='13737'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='13738'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13739'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='13740'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13741'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='13742'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13743'></font>
<a name='13744'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13745'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13746'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13747'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13748'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13749'></font>
<a name='13750'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13751'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13752'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13753'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13754'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13755'></font>
<a name='13756'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_326"> ( A , size ( A ) * RWORDSIZE )<a name='13757'>
<a name='13758'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13759'>
         fracrefao, fracrefbo, kao, kbo, kao_mco2, kbo_mco2, kao_mn2o, &amp;<a name='13760'>
         kbo_mn2o, kao_mo3, cfc12o, cfc22adjo, selfrefo, forrefo<a name='13761'>
      DM_BCAST_MACRO(fracrefao)<a name='13762'>
      DM_BCAST_MACRO(fracrefbo)<a name='13763'>
      DM_BCAST_MACRO(kao)<a name='13764'>
      DM_BCAST_MACRO(kbo)<a name='13765'>
      DM_BCAST_MACRO(kao_mco2)<a name='13766'>
      DM_BCAST_MACRO(kbo_mco2)<a name='13767'>
      DM_BCAST_MACRO(kao_mn2o)<a name='13768'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='13769'>
      DM_BCAST_MACRO(kao_mo3)<a name='13770'>
      DM_BCAST_MACRO(cfc12o)<a name='13771'>
      DM_BCAST_MACRO(cfc22adjo)<a name='13772'>
      DM_BCAST_MACRO(selfrefo)<a name='13773'>
      DM_BCAST_MACRO(forrefo)<a name='13774'>
<a name='13775'>
     RETURN<a name='13776'>
9010 CONTINUE<a name='13777'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13778'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB08' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1041">(errmess)<a name='13779'>
<a name='13780'>
      end subroutine lw_kgb08<a name='13781'>
<a name='13782'>
<font color=#447700>! **************************************************************************<a name='13783'></font>
<A NAME='LW_KGB09'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB09' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13784'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb09</font>(rrtmg_unit) <A href='../../call_to/LW_KGB09.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB09.html' TARGET='index'>6</A><a name='13785'>
<font color=#447700>! **************************************************************************<a name='13786'></font>
<a name='13787'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG09'>rrlw_kg09</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG09_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mn2o, &amp;<a name='13788'>
                            kbo_mn2o, selfrefo, forrefo<a name='13789'>
<a name='13790'>
      implicit none<a name='13791'>
      save<a name='13792'>
<a name='13793'>
<font color=#447700>! Input<a name='13794'></font>
      integer, intent(in) :: rrtmg_unit<a name='13795'>
<a name='13796'>
<font color=#447700>! Local                                    <a name='13797'></font>
      character*80 errmess<a name='13798'>
      logical, external  :: wrf_dm_on_monitor<a name='13799'>
<a name='13800'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13801'></font>
<font color=#447700>!     and upper atmosphere.<a name='13802'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13803'></font>
<font color=#447700>!     Lower: P=212.7250 mb, T = 223.06 K<a name='13804'></font>
<font color=#447700>!     Upper: P=3.20e-2 mb, T = 197.92 k<a name='13805'></font>
<a name='13806'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='13807'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='13808'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='13809'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13810'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13811'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13812'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13813'></font>
<font color=#447700>!     to that of gas2.<a name='13814'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='13815'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='13816'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='13817'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='13818'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='13819'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='13820'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='13821'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='13822'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13823'></font>
<a name='13824'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13825'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13826'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13827'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13828'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13829'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13830'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13831'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13832'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13833'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13834'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13835'></font>
<a name='13836'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='13837'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13838'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='13839'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='13840'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='13841'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='13842'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='13843'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='13844'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13845'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='13846'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13847'></font>
<a name='13848'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='13849'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='13850'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='13851'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='13852'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='13853'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13854'></font>
<a name='13855'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13856'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13857'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13858'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13859'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13860'></font>
<a name='13861'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13862'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13863'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13864'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13865'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13866'></font>
<a name='13867'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_327"> ( A , size ( A ) * RWORDSIZE )<a name='13868'>
<a name='13869'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13870'>
         fracrefao, fracrefbo, kao, kbo, kao_mn2o, kbo_mn2o, selfrefo, forrefo<a name='13871'>
      DM_BCAST_MACRO(fracrefao)<a name='13872'>
      DM_BCAST_MACRO(fracrefbo)<a name='13873'>
      DM_BCAST_MACRO(kao)<a name='13874'>
      DM_BCAST_MACRO(kbo)<a name='13875'>
      DM_BCAST_MACRO(kao_mn2o)<a name='13876'>
      DM_BCAST_MACRO(kbo_mn2o)<a name='13877'>
      DM_BCAST_MACRO(selfrefo)<a name='13878'>
      DM_BCAST_MACRO(forrefo)<a name='13879'>
<a name='13880'>
     RETURN<a name='13881'>
9010 CONTINUE<a name='13882'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13883'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB09' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1042">(errmess)<a name='13884'>
<a name='13885'>
      end subroutine lw_kgb09<a name='13886'>
<a name='13887'>
<font color=#447700>! **************************************************************************<a name='13888'></font>
<A NAME='LW_KGB10'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB10' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13889'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb10</font>(rrtmg_unit) <A href='../../call_to/LW_KGB10.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB10.html' TARGET='index'>6</A><a name='13890'>
<font color=#447700>! **************************************************************************<a name='13891'></font>
<a name='13892'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG10'>rrlw_kg10</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG10_3">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13893'>
<a name='13894'>
      implicit none<a name='13895'>
      save<a name='13896'>
<a name='13897'>
<font color=#447700>! Input<a name='13898'></font>
      integer, intent(in) :: rrtmg_unit<a name='13899'>
<a name='13900'>
<font color=#447700>! Local                                    <a name='13901'></font>
      character*80 errmess<a name='13902'>
      logical, external  :: wrf_dm_on_monitor<a name='13903'>
<a name='13904'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13905'></font>
<font color=#447700>!     and upper atmosphere.<a name='13906'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13907'></font>
<font color=#447700>!     Lower: P = 212.7250 mb, T = 223.06 K<a name='13908'></font>
<font color=#447700>!     Upper: P = 95.58350 mb, T = 215.70 K<a name='13909'></font>
<a name='13910'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13911'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13912'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13913'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13914'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13915'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13916'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13917'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13918'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13919'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13920'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13921'></font>
<a name='13922'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='13923'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='13924'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13925'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13926'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='13927'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='13928'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='13929'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='13930'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='13931'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='13932'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='13933'></font>
<a name='13934'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='13935'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='13936'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='13937'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='13938'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='13939'></font>
<a name='13940'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='13941'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='13942'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='13943'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='13944'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='13945'></font>
<a name='13946'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_328"> ( A , size ( A ) * RWORDSIZE )<a name='13947'>
<a name='13948'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='13949'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='13950'>
      DM_BCAST_MACRO(fracrefao)<a name='13951'>
      DM_BCAST_MACRO(fracrefbo)<a name='13952'>
      DM_BCAST_MACRO(kao)<a name='13953'>
      DM_BCAST_MACRO(kbo)<a name='13954'>
      DM_BCAST_MACRO(selfrefo)<a name='13955'>
      DM_BCAST_MACRO(forrefo)<a name='13956'>
<a name='13957'>
     RETURN<a name='13958'>
9010 CONTINUE<a name='13959'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='13960'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB10' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1043">(errmess)<a name='13961'>
<a name='13962'>
      end subroutine lw_kgb10<a name='13963'>
<a name='13964'>
<font color=#447700>! **************************************************************************<a name='13965'></font>
<A NAME='LW_KGB11'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB11' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='13966'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb11</font>(rrtmg_unit) <A href='../../call_to/LW_KGB11.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB11.html' TARGET='index'>6</A><a name='13967'>
<font color=#447700>! **************************************************************************<a name='13968'></font>
<a name='13969'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG11'>rrlw_kg11</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG11_3">, only : fracrefao, fracrefbo, kao, kbo, kao_mo2, &amp;<a name='13970'>
                            kbo_mo2, selfrefo, forrefo<a name='13971'>
<a name='13972'>
      implicit none<a name='13973'>
      save<a name='13974'>
<a name='13975'>
<font color=#447700>! Input<a name='13976'></font>
      integer, intent(in) :: rrtmg_unit<a name='13977'>
<a name='13978'>
<font color=#447700>! Local                                    <a name='13979'></font>
      character*80 errmess<a name='13980'>
      logical, external  :: wrf_dm_on_monitor<a name='13981'>
<a name='13982'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='13983'></font>
<font color=#447700>!     and upper atmosphere.<a name='13984'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='13985'></font>
<font color=#447700>!     Lower: P=1053.63 mb, T= 294.2 K<a name='13986'></font>
<font color=#447700>!     Upper: P=0.353 mb, T = 262.11 K<a name='13987'></font>
<a name='13988'>
<font color=#447700>!     The array KAO contains absorption coefs at the 16 chosen g-values <a name='13989'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb and temperatures.  The first<a name='13990'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='13991'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='13992'></font>
<font color=#447700>!     data are for the corresponding TREF for this  pressure level, <a name='13993'></font>
<font color=#447700>!     JT = 2 refers to the temperatureTREF-15, JT = 1 is for TREF-30, <a name='13994'></font>
<font color=#447700>!     JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  The second <a name='13995'></font>
<font color=#447700>!     index, JP, runs from 1 to 13 and refers to the corresponding <a name='13996'></font>
<font color=#447700>!     pressure level in PREF (e.g. JP = 1 is for a pressure of 1053.63 mb).  <a name='13997'></font>
<font color=#447700>!     The third index, IG, goes from 1 to 16, and tells us which <a name='13998'></font>
<font color=#447700>!     g-interval the absorption coefficients are for.<a name='13999'></font>
<a name='14000'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='14001'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='14002'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='14003'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='14004'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='14005'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='14006'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='14007'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='14008'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='14009'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='14010'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14011'></font>
<a name='14012'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='14013'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='14014'></font>
<font color=#447700>!     level below 100~ mb.   The first index refers to temperature <a name='14015'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='14016'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='14017'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14018'></font>
<a name='14019'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='14020'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='14021'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='14022'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='14023'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='14024'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14025'></font>
<a name='14026'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14027'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14028'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14029'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14030'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14031'></font>
<a name='14032'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14033'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14034'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14035'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14036'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14037'></font>
<a name='14038'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_329"> ( A , size ( A ) * RWORDSIZE )<a name='14039'>
<a name='14040'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14041'>
         fracrefao, fracrefbo, kao, kbo, kao_mo2, kbo_mo2, selfrefo, forrefo<a name='14042'>
      DM_BCAST_MACRO(fracrefao)<a name='14043'>
      DM_BCAST_MACRO(fracrefbo)<a name='14044'>
      DM_BCAST_MACRO(kao)<a name='14045'>
      DM_BCAST_MACRO(kbo)<a name='14046'>
      DM_BCAST_MACRO(kao_mo2)<a name='14047'>
      DM_BCAST_MACRO(kbo_mo2)<a name='14048'>
      DM_BCAST_MACRO(selfrefo)<a name='14049'>
      DM_BCAST_MACRO(forrefo)<a name='14050'>
<a name='14051'>
     RETURN<a name='14052'>
9010 CONTINUE<a name='14053'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14054'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB11' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1044">(errmess)<a name='14055'>
<a name='14056'>
      end subroutine lw_kgb11<a name='14057'>
<a name='14058'>
<font color=#447700>! **************************************************************************<a name='14059'></font>
<A NAME='LW_KGB12'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB12' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14060'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb12</font>(rrtmg_unit) <A href='../../call_to/LW_KGB12.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB12.html' TARGET='index'>6</A><a name='14061'>
<font color=#447700>! **************************************************************************<a name='14062'></font>
<a name='14063'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG12'>rrlw_kg12</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG12_3">, only : fracrefao, kao, selfrefo, forrefo<a name='14064'>
<a name='14065'>
      implicit none<a name='14066'>
      save<a name='14067'>
<a name='14068'>
<font color=#447700>! Input<a name='14069'></font>
      integer, intent(in) :: rrtmg_unit<a name='14070'>
<a name='14071'>
<font color=#447700>! Local                                    <a name='14072'></font>
      character*80 errmess<a name='14073'>
      logical, external  :: wrf_dm_on_monitor<a name='14074'>
<a name='14075'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='14076'></font>
<font color=#447700>!     and upper atmosphere.<a name='14077'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='14078'></font>
<font color=#447700>!     Lower: P = 174.1640 mbar, T= 215.78 K<a name='14079'></font>
<a name='14080'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='14081'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='14082'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='14083'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14084'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14085'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14086'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14087'></font>
<font color=#447700>!     to that of gas2.<a name='14088'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='14089'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='14090'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='14091'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='14092'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='14093'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='14094'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='14095'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='14096'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14097'></font>
<a name='14098'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14099'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14100'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14101'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14102'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14103'></font>
<a name='14104'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14105'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14106'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14107'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14108'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14109'></font>
<a name='14110'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_330"> ( A , size ( A ) * RWORDSIZE )<a name='14111'>
<a name='14112'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14113'>
         fracrefao, kao, selfrefo, forrefo<a name='14114'>
      DM_BCAST_MACRO(fracrefao)<a name='14115'>
      DM_BCAST_MACRO(kao)<a name='14116'>
      DM_BCAST_MACRO(selfrefo)<a name='14117'>
      DM_BCAST_MACRO(forrefo)<a name='14118'>
<a name='14119'>
     RETURN<a name='14120'>
9010 CONTINUE<a name='14121'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14122'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB12' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1045">(errmess)<a name='14123'>
<a name='14124'>
      end subroutine lw_kgb12<a name='14125'>
<a name='14126'>
<font color=#447700>! **************************************************************************<a name='14127'></font>
<A NAME='LW_KGB13'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB13' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14128'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb13</font>(rrtmg_unit) <A href='../../call_to/LW_KGB13.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB13.html' TARGET='index'>6</A><a name='14129'>
<font color=#447700>! **************************************************************************<a name='14130'></font>
<a name='14131'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG13'>rrlw_kg13</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG13_3">, only : fracrefao, fracrefbo, kao, kao_mco2, kao_mco, &amp;<a name='14132'>
                            kbo_mo3, selfrefo, forrefo<a name='14133'>
<a name='14134'>
      implicit none<a name='14135'>
      save<a name='14136'>
<a name='14137'>
<font color=#447700>! Input<a name='14138'></font>
      integer, intent(in) :: rrtmg_unit<a name='14139'>
<a name='14140'>
<font color=#447700>! Local                                    <a name='14141'></font>
      character*80 errmess<a name='14142'>
      logical, external  :: wrf_dm_on_monitor<a name='14143'>
<a name='14144'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='14145'></font>
<font color=#447700>!     and upper atmosphere.<a name='14146'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='14147'></font>
<font color=#447700>!     Lower: P=473.4280 mb, T = 259.83 K      <a name='14148'></font>
<font color=#447700>!     Upper: P=4.758820 mb, T = 250.85 K<a name='14149'></font>
<a name='14150'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='14151'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='14152'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='14153'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14154'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14155'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14156'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14157'></font>
<font color=#447700>!     to that of gas2.<a name='14158'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='14159'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='14160'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='14161'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='14162'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='14163'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='14164'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='14165'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='14166'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14167'></font>
<a name='14168'>
<font color=#447700>!     The array KAO_Mxx contains the absorption coefficient for <a name='14169'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='14170'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='14171'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14172'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14173'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14174'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14175'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='14176'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='14177'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='14178'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14179'></font>
<a name='14180'>
<font color=#447700>!     The array KBO_Mxx contains the absorption coefficient for <a name='14181'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='14182'></font>
<font color=#447700>!     level above 100~ mb.   The first index refers to temperature <a name='14183'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='14184'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The second index <a name='14185'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14186'></font>
<a name='14187'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14188'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14189'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14190'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14191'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14192'></font>
<a name='14193'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14194'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14195'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14196'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14197'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14198'></font>
<a name='14199'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_331"> ( A , size ( A ) * RWORDSIZE )<a name='14200'>
<a name='14201'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14202'>
         fracrefao, fracrefbo, kao, kao_mco2, kao_mco, kbo_mo3, selfrefo, forrefo<a name='14203'>
      DM_BCAST_MACRO(fracrefao)<a name='14204'>
      DM_BCAST_MACRO(fracrefbo)<a name='14205'>
      DM_BCAST_MACRO(kao)<a name='14206'>
      DM_BCAST_MACRO(kao_mco2)<a name='14207'>
      DM_BCAST_MACRO(kao_mco)<a name='14208'>
      DM_BCAST_MACRO(kbo_mo3)<a name='14209'>
      DM_BCAST_MACRO(selfrefo)<a name='14210'>
      DM_BCAST_MACRO(forrefo)<a name='14211'>
<a name='14212'>
     RETURN<a name='14213'>
9010 CONTINUE<a name='14214'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14215'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB13' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1046">(errmess)<a name='14216'>
<a name='14217'>
      end subroutine lw_kgb13<a name='14218'>
<a name='14219'>
<font color=#447700>! **************************************************************************<a name='14220'></font>
<A NAME='LW_KGB14'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB14' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14221'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb14</font>(rrtmg_unit) <A href='../../call_to/LW_KGB14.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB14.html' TARGET='index'>6</A><a name='14222'>
<font color=#447700>! **************************************************************************<a name='14223'></font>
<a name='14224'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG14'>rrlw_kg14</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG14_3">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='14225'>
<a name='14226'>
      implicit none<a name='14227'>
      save<a name='14228'>
<a name='14229'>
<font color=#447700>! Input<a name='14230'></font>
      integer, intent(in) :: rrtmg_unit<a name='14231'>
<a name='14232'>
<font color=#447700>! Local                                    <a name='14233'></font>
      character*80 errmess<a name='14234'>
      logical, external  :: wrf_dm_on_monitor<a name='14235'>
<a name='14236'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='14237'></font>
<font color=#447700>!     and upper atmosphere.<a name='14238'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='14239'></font>
<font color=#447700>!     Lower: P = 142.5940 mb, T = 215.70 K<a name='14240'></font>
<font color=#447700>!     Upper: P = 4.758820 mb, T = 250.85 K<a name='14241'></font>
<a name='14242'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='14243'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='14244'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='14245'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14246'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14247'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14248'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14249'></font>
<font color=#447700>!     to that of gas2.<a name='14250'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='14251'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='14252'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='14253'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='14254'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='14255'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='14256'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='14257'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='14258'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14259'></font>
<a name='14260'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='14261'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='14262'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='14263'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='14264'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='14265'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='14266'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='14267'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='14268'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='14269'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='14270'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14271'></font>
<a name='14272'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14273'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14274'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14275'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14276'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14277'></font>
<a name='14278'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14279'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14280'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14281'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14282'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14283'></font>
<a name='14284'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_332"> ( A , size ( A ) * RWORDSIZE )<a name='14285'>
<a name='14286'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14287'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='14288'>
      DM_BCAST_MACRO(fracrefao)<a name='14289'>
      DM_BCAST_MACRO(fracrefbo)<a name='14290'>
      DM_BCAST_MACRO(kao)<a name='14291'>
      DM_BCAST_MACRO(kbo)<a name='14292'>
      DM_BCAST_MACRO(selfrefo)<a name='14293'>
      DM_BCAST_MACRO(forrefo)<a name='14294'>
<a name='14295'>
     RETURN<a name='14296'>
9010 CONTINUE<a name='14297'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14298'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB14' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1047">(errmess)<a name='14299'>
<a name='14300'>
      end subroutine lw_kgb14<a name='14301'>
<a name='14302'>
<font color=#447700>! **************************************************************************<a name='14303'></font>
<A NAME='LW_KGB15'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB15' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14304'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb15</font>(rrtmg_unit) <A href='../../call_to/LW_KGB15.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB15.html' TARGET='index'>6</A><a name='14305'>
<font color=#447700>! **************************************************************************<a name='14306'></font>
<a name='14307'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG15'>rrlw_kg15</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG15_3">, only : fracrefao, kao, kao_mn2, selfrefo, forrefo<a name='14308'>
<a name='14309'>
      implicit none<a name='14310'>
      save<a name='14311'>
<a name='14312'>
<font color=#447700>! Input<a name='14313'></font>
      integer, intent(in) :: rrtmg_unit<a name='14314'>
<a name='14315'>
<font color=#447700>! Local                                    <a name='14316'></font>
      character*80 errmess<a name='14317'>
      logical, external  :: wrf_dm_on_monitor<a name='14318'>
<a name='14319'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='14320'></font>
<font color=#447700>!     and upper atmosphere.<a name='14321'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='14322'></font>
<font color=#447700>!     Lower: P = 1053. mb, T = 294.2 K<a name='14323'></font>
<a name='14324'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='14325'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='14326'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='14327'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14328'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14329'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14330'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14331'></font>
<font color=#447700>!     to that of gas2.<a name='14332'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='14333'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='14334'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='14335'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='14336'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='14337'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='14338'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='14339'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='14340'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14341'></font>
<a name='14342'>
<font color=#447700>!     The array KA_Mxx contains the absorption coefficient for <a name='14343'></font>
<font color=#447700>!     a minor species at the 16 chosen g-values for a reference pressure<a name='14344'></font>
<font color=#447700>!     level below 100~ mb.   The first index in the array, JS, runs<a name='14345'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14346'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14347'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14348'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14349'></font>
<font color=#447700>!     to that of gas2.  The second index refers to temperature <a name='14350'></font>
<font color=#447700>!     in 7.2 degree increments.  For instance, JT = 1 refers to a <a name='14351'></font>
<font color=#447700>!     temperature of 188.0, JT = 2 refers to 195.2, etc. The third index <a name='14352'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14353'></font>
<a name='14354'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14355'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14356'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14357'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14358'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14359'></font>
<a name='14360'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14361'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14362'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14363'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14364'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14365'></font>
<a name='14366'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_333"> ( A , size ( A ) * RWORDSIZE )<a name='14367'>
<a name='14368'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14369'>
         fracrefao, kao, kao_mn2, selfrefo, forrefo<a name='14370'>
      DM_BCAST_MACRO(fracrefao)<a name='14371'>
      DM_BCAST_MACRO(kao)<a name='14372'>
      DM_BCAST_MACRO(kao_mn2)<a name='14373'>
      DM_BCAST_MACRO(selfrefo)<a name='14374'>
      DM_BCAST_MACRO(forrefo)<a name='14375'>
<a name='14376'>
     RETURN<a name='14377'>
9010 CONTINUE<a name='14378'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14379'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB15' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1048">(errmess)<a name='14380'>
<a name='14381'>
      end subroutine lw_kgb15<a name='14382'>
<a name='14383'>
<font color=#447700>! **************************************************************************<a name='14384'></font>
<A NAME='LW_KGB16'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#LW_KGB16' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14385'>
      <font color=#993300>subroutine </font><font color=#cc0000>lw_kgb16</font>(rrtmg_unit) <A href='../../call_to/LW_KGB16.html' TARGET='index'>2</A>,<A href='../../call_from/LW_KGB16.html' TARGET='index'>6</A><a name='14386'>
<font color=#447700>! **************************************************************************<a name='14387'></font>
<a name='14388'>
      use <A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RRLW_KG16'>rrlw_kg16</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RRLW_KG16_3">, only : fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='14389'>
<a name='14390'>
      implicit none<a name='14391'>
      save<a name='14392'>
<a name='14393'>
<font color=#447700>! Input<a name='14394'></font>
      integer, intent(in) :: rrtmg_unit<a name='14395'>
<a name='14396'>
<font color=#447700>! Local                                    <a name='14397'></font>
      character*80 errmess<a name='14398'>
      logical, external  :: wrf_dm_on_monitor<a name='14399'>
<a name='14400'>
<font color=#447700>!     Arrays fracrefao and fracrefbo are the Planck fractions for the lower<a name='14401'></font>
<font color=#447700>!     and upper atmosphere.<a name='14402'></font>
<font color=#447700>!     Planck fraction mapping levels: <a name='14403'></font>
<font color=#447700>!     Lower: P = 387.6100 mbar, T = 250.17 K<a name='14404'></font>
<font color=#447700>!     Upper: P=95.58350 mb, T = 215.70 K<a name='14405'></font>
<a name='14406'>
<font color=#447700>!     The array KAO contains absorption coefs for each of the 16 g-intervals<a name='14407'></font>
<font color=#447700>!     for a range of pressure levels &gt; ~100mb, temperatures, and ratios<a name='14408'></font>
<font color=#447700>!     of water vapor to CO2.  The first index in the array, JS, runs<a name='14409'></font>
<font color=#447700>!     from 1 to 10, and corresponds to different gas column amount ratios,<a name='14410'></font>
<font color=#447700>!     as expressed through the binary species parameter eta, defined as<a name='14411'></font>
<font color=#447700>!     eta = gas1/(gas1 + (rat) * gas2), where rat is the <a name='14412'></font>
<font color=#447700>!     ratio of the reference MLS column amount value of gas 1 <a name='14413'></font>
<font color=#447700>!     to that of gas2.<a name='14414'></font>
<font color=#447700>!     The 2nd index in the array, JT, which runs from 1 to 5, corresponds <a name='14415'></font>
<font color=#447700>!     to different temperatures.  More specifically, JT = 3 means that the <a name='14416'></font>
<font color=#447700>!     data are for the reference temperature TREF for this  pressure <a name='14417'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature<a name='14418'></font>
<font color=#447700>!     TREF-15, JT = 1 is for TREF-30, JT = 4 is for TREF+15, and JT = 5<a name='14419'></font>
<font color=#447700>!     is for TREF+30.  The third index, JP, runs from 1 to 13 and refers<a name='14420'></font>
<font color=#447700>!     to the reference pressure level (e.g. JP = 1 is for a<a name='14421'></font>
<font color=#447700>!     pressure of 1053.63 mb).  The fourth index, IG, goes from 1 to 16,<a name='14422'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14423'></font>
<a name='14424'>
<font color=#447700>!     The array KBO contains absorption coefs at the 16 chosen g-values <a name='14425'></font>
<font color=#447700>!     for a range of pressure levels &lt; ~100mb and temperatures. The first <a name='14426'></font>
<font color=#447700>!     index in the array, JT, which runs from 1 to 5, corresponds to <a name='14427'></font>
<font color=#447700>!     different temperatures.  More specifically, JT = 3 means that the <a name='14428'></font>
<font color=#447700>!     data are for the reference temperature TREF for this pressure <a name='14429'></font>
<font color=#447700>!     level, JT = 2 refers to the temperature TREF-15, JT = 1 is for<a name='14430'></font>
<font color=#447700>!     TREF-30, JT = 4 is for TREF+15, and JT = 5 is for TREF+30.  <a name='14431'></font>
<font color=#447700>!     The second index, JP, runs from 13 to 59 and refers to the JPth<a name='14432'></font>
<font color=#447700>!     reference pressure level (see taumol.f for the value of these<a name='14433'></font>
<font color=#447700>!     pressure levels in mb).  The third index, IG, goes from 1 to 16,<a name='14434'></font>
<font color=#447700>!     and tells us which g-interval the absorption coefficients are for.<a name='14435'></font>
<a name='14436'>
<font color=#447700>!     The array FORREFO contains the coefficient of the water vapor<a name='14437'></font>
<font color=#447700>!     foreign-continuum (including the energy term).  The first <a name='14438'></font>
<font color=#447700>!     index refers to reference temperature (296,260,224,260) and <a name='14439'></font>
<font color=#447700>!     pressure (970,475,219,3 mbar) levels.  The second index <a name='14440'></font>
<font color=#447700>!     runs over the g-channel (1 to 16).<a name='14441'></font>
<a name='14442'>
<font color=#447700>!     The array SELFREFO contains the coefficient of the water vapor<a name='14443'></font>
<font color=#447700>!     self-continuum (including the energy term).  The first index<a name='14444'></font>
<font color=#447700>!     refers to temperature in 7.2 degree increments.  For instance,<a name='14445'></font>
<font color=#447700>!     JT = 1 refers to a temperature of 245.6, JT = 2 refers to 252.8,<a name='14446'></font>
<font color=#447700>!     etc.  The second index runs over the g-channel (1 to 16).<a name='14447'></font>
<a name='14448'>
#define DM_BCAST_MACRO(A) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_334"> ( A , size ( A ) * RWORDSIZE )<a name='14449'>
<a name='14450'>
      IF ( wrf_dm_on_monitor() ) READ (rrtmg_unit,ERR=9010) &amp;<a name='14451'>
         fracrefao, fracrefbo, kao, kbo, selfrefo, forrefo<a name='14452'>
      DM_BCAST_MACRO(fracrefao)<a name='14453'>
      DM_BCAST_MACRO(fracrefbo)<a name='14454'>
      DM_BCAST_MACRO(kao)<a name='14455'>
      DM_BCAST_MACRO(kbo)<a name='14456'>
      DM_BCAST_MACRO(selfrefo)<a name='14457'>
      DM_BCAST_MACRO(forrefo)<a name='14458'>
<a name='14459'>
     RETURN<a name='14460'>
9010 CONTINUE<a name='14461'>
     WRITE( errmess , '(A,I4)' ) 'module_ra_rrtmg_lw: error reading RRTMG_LW_DATA on unit ',rrtmg_unit<a name='14462'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_ra_rrtmg_lwf.F.html#LW_KGB16' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1049">(errmess)<a name='14463'>
<a name='14464'>
      end subroutine lw_kgb16<a name='14465'>
<a name='14466'>
<font color=#447700>!===============================================================================<a name='14467'></font>
<A NAME='RELCALC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#RELCALC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14468'>
  <font color=#993300>subroutine </font><font color=#cc0000>relcalc</font>(ncol, pcols, pver, t, landfrac, landm, icefrac, rel, snowh) <A href='../../call_to/RELCALC.html' TARGET='index'>8</A><a name='14469'>
<font color=#447700>!----------------------------------------------------------------------- <a name='14470'></font>
<font color=#447700>! <a name='14471'></font>
<font color=#447700>! Purpose: <a name='14472'></font>
<font color=#447700>! Compute cloud water size<a name='14473'></font>
<font color=#447700>! <a name='14474'></font>
<font color=#447700>! Method: <a name='14475'></font>
<font color=#447700>! analytic formula following the formulation originally developed by J. T. Kiehl<a name='14476'></font>
<font color=#447700>! <a name='14477'></font>
<font color=#447700>! Author: Phil Rasch<a name='14478'></font>
<font color=#447700>! <a name='14479'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='14480'></font>
    implicit none<a name='14481'>
<font color=#447700>!------------------------------Arguments--------------------------------<a name='14482'></font>
<font color=#447700>!<a name='14483'></font>
<font color=#447700>! Input arguments<a name='14484'></font>
<font color=#447700>!<a name='14485'></font>
    integer, intent(in) :: ncol<a name='14486'>
    integer, intent(in) :: pcols, pver<a name='14487'>
    real, intent(in) :: landfrac(pcols)      <font color=#447700>! Land fraction<a name='14488'></font>
    real, intent(in) :: icefrac(pcols)       <font color=#447700>! Ice fraction<a name='14489'></font>
    real, intent(in) :: snowh(pcols)         <font color=#447700>! Snow depth over land, water equivalent (m)<a name='14490'></font>
    real, intent(in) :: landm(pcols)         <font color=#447700>! Land fraction ramping to zero over ocean<a name='14491'></font>
    real, intent(in) :: t(pcols,pver)        <font color=#447700>! Temperature<a name='14492'></font>
<a name='14493'>
<font color=#447700>!<a name='14494'></font>
<font color=#447700>! Output arguments<a name='14495'></font>
<font color=#447700>!<a name='14496'></font>
    real, intent(out) :: rel(pcols,pver)      <font color=#447700>! Liquid effective drop size (microns)<a name='14497'></font>
<font color=#447700>!<a name='14498'></font>
<font color=#447700>!---------------------------Local workspace-----------------------------<a name='14499'></font>
<font color=#447700>!<a name='14500'></font>
    integer i,k           <font color=#447700>! Lon, lev indices<a name='14501'></font>
    real tmelt            <font color=#447700>! freezing temperature of fresh water (K)<a name='14502'></font>
    real rliqland         <font color=#447700>! liquid drop size if over land<a name='14503'></font>
    real rliqocean        <font color=#447700>! liquid drop size if over ocean<a name='14504'></font>
    real rliqice          <font color=#447700>! liquid drop size if over sea ice<a name='14505'></font>
<font color=#447700>!<a name='14506'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='14507'></font>
<font color=#447700>!<a name='14508'></font>
    tmelt = 273.16<a name='14509'>
    rliqocean = 14.0<a name='14510'>
    rliqice   = 14.0<a name='14511'>
    rliqland  = 8.0<a name='14512'>
    do k=1,pver<a name='14513'>
       do i=1,ncol<a name='14514'>
<font color=#447700>! jrm Reworked effective radius algorithm<a name='14515'></font>
          <font color=#447700>! Start with temperature-dependent value appropriate for continental air<a name='14516'></font>
          <font color=#447700>! Note: findmcnew has a pressure dependence here<a name='14517'></font>
          rel(i,k) = rliqland + (rliqocean-rliqland) * min(1.0,max(0.0,(tmelt-t(i,k))*0.05))<a name='14518'>
          <font color=#447700>! Modify for snow depth over land<a name='14519'></font>
          rel(i,k) = rel(i,k) + (rliqocean-rel(i,k)) * min(1.0,max(0.0,snowh(i)*10.))<a name='14520'>
          <font color=#447700>! Ramp between polluted value over land to clean value over ocean.<a name='14521'></font>
          rel(i,k) = rel(i,k) + (rliqocean-rel(i,k)) * min(1.0,max(0.0,1.0-landm(i)))<a name='14522'>
          <font color=#447700>! Ramp between the resultant value and a sea ice value in the presence of ice.<a name='14523'></font>
          rel(i,k) = rel(i,k) + (rliqice-rel(i,k)) * min(1.0,max(0.0,icefrac(i)))<a name='14524'>
<font color=#447700>! end jrm<a name='14525'></font>
       end do<a name='14526'>
    end do<a name='14527'>
  end subroutine relcalc<a name='14528'>
<font color=#447700>!===============================================================================<a name='14529'></font>
<A NAME='REICALC'><A href='../../html_code/phys/module_ra_rrtmg_lw.F.html#REICALC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14530'>
  <font color=#993300>subroutine </font><font color=#cc0000>reicalc</font>(ncol, pcols, pver, t, re) <A href='../../call_to/REICALC.html' TARGET='index'>4</A><a name='14531'>
    <font color=#447700>!<a name='14532'></font>
<a name='14533'>
    integer, intent(in) :: ncol, pcols, pver<a name='14534'>
    real, intent(out) :: re(pcols,pver)<a name='14535'>
    real, intent(in) :: t(pcols,pver)<a name='14536'>
    real corr<a name='14537'>
    integer i<a name='14538'>
    integer k<a name='14539'>
    integer index<a name='14540'>
    <font color=#447700>!<a name='14541'></font>
    <font color=#447700>!       Tabulated values of re(T) in the temperature interval<a name='14542'></font>
    <font color=#447700>!       180 K -- 274 K; hexagonal columns assumed:<a name='14543'></font>
    <font color=#447700>!<a name='14544'></font>
    <font color=#447700>!<a name='14545'></font>
    do k=1,pver<a name='14546'>
       do i=1,ncol<a name='14547'>
          index = int(t(i,k)-179.)<a name='14548'>
          index = min(max(index,1),94)<a name='14549'>
          corr = t(i,k) - int(t(i,k))<a name='14550'>
          re(i,k) = retab(index)*(1.-corr)              &amp;<a name='14551'>
               +retab(index+1)*corr<a name='14552'>
          <font color=#447700>!           re(i,k) = amax1(amin1(re(i,k),30.),10.)<a name='14553'></font>
       end do<a name='14554'>
    end do<a name='14555'>
    <font color=#447700>!<a name='14556'></font>
    return<a name='14557'>
  end subroutine reicalc<a name='14558'>
<font color=#447700>!------------------------------------------------------------------<a name='14559'></font>
<a name='14560'>
END MODULE module_ra_rrtmg_lw<a name='14561'>
</pre></body></html>