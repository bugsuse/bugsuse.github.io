<HTML> <BODY BGCOLOR=#ddddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MODEL_MP:PHYSICS<a name='2'></font>
<font color=#447700>! The fast version calculates hydrometeor distributions for qc,qr,qs,qg, and their number concentrations<a name='3'></font>
<font color=#447700>! (including aerosol concentrations).<a name='4'></font>
<font color=#447700>! To use the FAST version of SBM, please do the following.<a name='5'></font>
<font color=#447700>! Set DX_BOUND to some value larger than the first inner nest, but smaller than the outer domain in meters<a name='6'></font>
<font color=#447700>! Set the aerosol concentration with the variables FCCNR_MAR, and FCCNR_CON, FCCNR_MIX.  <a name='7'></font>
<font color=#447700>! Each of the aerosol distributions are set with ACCN (concentration of ccn particles at 1% saturation), and<a name='8'></font>
<font color=#447700>! BCCN (the "k" coefficient; for example: FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN). <a name='9'></font>
<font color=#447700>! Questions: contact barry.h.lynn@gmail.com (Barry Lynn)<a name='10'></font>
<font color=#447700>!<a name='11'></font>
<A NAME='MODULE_MP_FAST_SBM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#MODULE_MP_FAST_SBM' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='12'>
<font color=#993300>MODULE </font><font color=#cc0000>module_mp_fast_sbm</font> <A href='../../call_to/MODULE_MP_FAST_SBM.html' TARGET='index'>2</A><a name='13'>
USE <A href='../../html_code/phys/module_mp_radar.F.html#MODULE_MP_RADAR'>module_mp_radar</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#module_mp_fast_sbm.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MP_RADAR_1"><a name='14'>
<font color=#447700>!      USE module_state_description<a name='15'></font>
<font color=#447700>!<a name='16'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='17'></font>
<font color=#447700>! BARRY<a name='18'></font>
      INTEGER,PRIVATE,PARAMETER :: REMSAT = 0<a name='19'>
      INTEGER, PRIVATE,PARAMETER :: IBREAKUP=1<a name='20'>
      INTEGER, PRIVATE,PARAMETER :: p_ff1i01=2, p_ff1i33=34,p_ff5i01=35,p_ff5i33=67,p_ff6i01=68,&amp;<a name='21'>
     &amp; p_ff6i33=100,p_ff8i01=101,p_ff8i33=133<a name='22'>
<a name='23'>
      LOGICAL, PRIVATE,PARAMETER :: CONSERV=.TRUE.<a name='24'>
<font color=#447700>! SET ONE = TRUE<a name='25'></font>
<font color=#447700>!     LOGICAL, PRIVATE,PARAMETER :: ORIGINAL_MELT=.FALSE.<a name='26'></font>
<font color=#447700>!     LOGICAL, PRIVATE,PARAMETER :: JIWEN_FAN_MELT=.TRUE.<a name='27'></font>
      LOGICAL, PRIVATE,PARAMETER :: ORIGINAL_MELT=.TRUE.<a name='28'>
      LOGICAL, PRIVATE,PARAMETER :: JIWEN_FAN_MELT=.FALSE.<a name='29'>
      REAL, PRIVATE,PARAMETER :: PI_MORR = 3.1415926535897932384626434<a name='30'>
      REAL, PRIVATE,PARAMETER ::  R_MORR = 287.15<a name='31'>
<a name='32'>
<a name='33'>
<a name='34'>
      REAL,PRIVATE,PARAMETER :: DX_BOUND=7500.<a name='35'>
      REAL ACCN,BCCN<a name='36'>
      REAL,PRIVATE,PARAMETER :: ACCN_MAR=1.0000E02, BCCN_MAR=0.900E00,ROCCN0=0.1000E01<a name='37'>
      REAL,PRIVATE,PARAMETER :: ACCN_CON=4.00000E03, BCCN_CON=0.400E00,ROCCN03=0.1000E01<a name='38'>
      REAL,PRIVATE,PARAMETER :: I3POINT=1<a name='39'>
      INTEGER,PRIVATE,PARAMETER :: ICCN = 1<a name='40'>
       DOUBLE PRECISION, PRIVATE, PARAMETER ::  SCAL=1.d0<a name='41'>
       INTEGER, PRIVATE,PARAMETER :: ICEPROCS=1,BULKNUC=0 <a name='42'>
       INTEGER, PRIVATE,PARAMETER :: ICETURB=0,LIQTURB=0<a name='43'>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: RAIN_INIT=1,GRAUPEL_INIT=1<a name='44'></font>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: ICE_INIT=0,SNOW_INIT=1<a name='45'></font>
<a name='46'>
       INTEGER, PRIVATE,PARAMETER :: ICEMAX=3,NCD=33,NHYDR=5,NHYDRO=7  &amp;<a name='47'>
     &amp;        ,ifreez_down1=0,ifreez_down2=1,ifreez_top=1              &amp;<a name='48'>
     &amp;        ,K0_LL=8,KRMIN_LL=1,KRMAX_LL=19,L0_LL=6                  &amp;<a name='49'>
     &amp;        , IEPS_400=1,IEPS_800=0,IEPS_1600=0                      &amp;<a name='50'>
     &amp;        ,K0L_GL=16,K0G_GL=16                                     &amp;<a name='51'>
     &amp;        ,KRMINL_GL=1,KRMAXL_GL=24                                &amp;<a name='52'>
     &amp;        ,KRMING_GL=1,KRMAXG_GL=33                                &amp;<a name='53'>
     &amp;        ,KRDROP=18,KRBREAK=17,KRICE=18                           &amp;<a name='54'>
     &amp;        ,NKR=33,JMAX=33,NRG=2,JBREAK = 18 <a name='55'>
       REAL dt_coll<a name='56'>
       REAL, PRIVATE,PARAMETER ::C1_MEY=0.00033,C2_MEY=0.              &amp;<a name='57'>
<font color=#447700>! New CONTINENTAL<a name='58'></font>
<font color=#447700>!      REAL, PRIVATE,PARAMETER ::C1_MEY=0.0033,C2_MEY=0.              &amp;<a name='59'></font>
     &amp;        ,an0_freez=10.,COL=0.23105                                <a name='60'>
       REAL, PRIVATE,PARAMETER :: p1=1000000.0,p2=750000.0,p3=500000.0                     <a name='61'>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: NCOND=3<a name='62'></font>
<font color=#447700>!      INTEGER, PRIVATE,PARAMETER :: NCOND=6<a name='63'></font>
       INTEGER, PRIVATE :: NCOND<a name='64'>
       INTEGER, PRIVATE,PARAMETER :: kr_icempl=9<a name='65'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 1.0<a name='66'></font>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 2.0<a name='67'></font>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 1.5<a name='68'></font>
       REAL, PRIVATE, PARAMETER :: ALCR = 2.25<a name='69'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR = 3.0<a name='70'></font>
       REAL, PRIVATE, PARAMETER :: ALCR_G = 3.0<a name='71'>
<font color=#447700>!      REAL, PRIVATE, PARAMETER :: ALCR_G = 1.0<a name='72'></font>
       INTEGER,PRIVATE,PARAMETER :: icempl=1<a name='73'>
       REAL, PRIVATE, PARAMETER :: COEFREFLL=1.E6*36.E6*COL/3.1453/3.1453 <a name='74'>
       REAL, PRIVATE, PARAMETER :: COEFREFLI=1.E9*36.E3*COL/3.1453/3.1453/5.<a name='75'>
       REAL, PRIVATE, PARAMETER :: COEFREF00=1.E9*36.E3*COL/3.1453/3.1453       <a name='76'>
       REAL, PRIVATE,DIMENSION(NKR) ::COLREFLL,COLREFLI,COLREFLS,COLREFLG,COLREFLH<a name='77'>
<a name='78'>
<a name='79'>
<font color=#447700>! YWLL_1000MB(nkr,nkr) - input array of kernels for pressure 1000mb<a name='80'></font>
<font color=#447700>! YWLL_750MB(nkr,nkr) - input array of kernels for pressure 750mb<a name='81'></font>
<font color=#447700>! YWLL_500MB(nkr,nkr) - input array of kernels for pressure 500mb<a name='82'></font>
       REAL, PRIVATE, SAVE :: &amp;<a name='83'>
<font color=#447700>! CRYSTALS <a name='84'></font>
     &amp;YWLI(NKR,NKR,ICEMAX) &amp;<a name='85'>
<font color=#447700>! MIXTURES<a name='86'></font>
     &amp;,YWIL(NKR,NKR,ICEMAX),YWII(NKR,NKR,ICEMAX,ICEMAX) &amp;<a name='87'>
     &amp;,YWIS(NKR,NKR,ICEMAX),YWIG(NKR,NKR,ICEMAX) &amp;<a name='88'>
     &amp;,YWIH(NKR,NKR,ICEMAX),YWSI(NKR,NKR,ICEMAX) &amp;<a name='89'>
     &amp;,YWGI(NKR,NKR,ICEMAX),YWHI(NKR,NKR,ICEMAX)<a name='90'>
<font color=#447700>!<a name='91'></font>
      REAL,PRIVATE,DIMENSION(NKR,NKR),SAVE :: &amp;<a name='92'>
     &amp; YWLL_1000MB,YWLL_750MB,YWLL_500MB,YWLL,YWLS,YWLG,YWLH &amp;<a name='93'>
<font color=#447700>! SNOW :<a name='94'></font>
     &amp;,YWSL,YWSS,YWSG,YWSH &amp;<a name='95'>
<font color=#447700>! GRAUPELS :<a name='96'></font>
     &amp;,YWGL,YWGS,YWGG,YWGH &amp;<a name='97'>
<font color=#447700>! HAIL :<a name='98'></font>
     &amp;,YWHL,YWHS,YWHG,YWHH<a name='99'>
       REAL, PRIVATE, SAVE :: &amp;<a name='100'>
     &amp;  XI(NKR,ICEMAX) &amp;<a name='101'>
     &amp; ,RADXX(NKR,NHYDR-1),MASSXX(NKR,NHYDR-1),DENXX(NKR,NHYDR-1) &amp;<a name='102'>
     &amp; ,RADXXO(NKR,NHYDRO),MASSXXO(NKR,NHYDRO),DENXXO(NKR,NHYDRO) &amp;<a name='103'>
     &amp; ,RIEC(NKR,ICEMAX),COEFIN(NKR),SLIC(NKR,6),TLIC(NKR,2) &amp;<a name='104'>
     &amp; ,RO2BL(NKR,ICEMAX)<a name='105'>
       REAL, PRIVATE, SAVE :: VR1(NKR),VR2(NKR,ICEMAX),VR3(NKR) &amp;<a name='106'>
     &amp; ,VR4(NKR),VR5(NKR),VRX(NKR)<a name='107'>
      REAL,PRIVATE,DIMENSION(NKR),SAVE ::  &amp;<a name='108'>
     &amp;  XL,RLEC,XX,XCCN,XS,RSEC &amp;<a name='109'>
     &amp; ,XG,RGEC,XH,RHEC,RO1BL,RO3BL,RO4BL,RO5BL &amp;<a name='110'>
     &amp; ,ROCCN,RCCN,DROPRADII<a name='111'>
  <a name='112'>
      REAL, PRIVATE,SAVE ::  FCCNR_MAR(NKR),FCCNR_CON(NKR)<a name='113'>
      REAL, PRIVATE,SAVE ::  FCCNR_MIX(NKR)<a name='114'>
      REAL, PRIVATE,SAVE ::  FCCNR(NKR)<a name='115'>
<a name='116'>
        REAL, PRIVATE :: C2,C3,C4<a name='117'>
      double precision,private,save ::  cwll(nkr,nkr)<a name='118'>
      double precision,private,save::  &amp;<a name='119'>
     &amp; xl_mg(0:nkr),xs_mg(0:nkr),xg_mg(0:nkr),xh_mg(0:nkr) &amp;<a name='120'>
     &amp;,xi1_mg(0:nkr),xi2_mg(0:nkr),xi3_mg(0:nkr) &amp;<a name='121'>
     &amp;,chucm(nkr,nkr),ima(nkr,nkr) &amp;<a name='122'>
     &amp;,cwll_1000mb(nkr,nkr),cwll_750mb(nkr,nkr),cwll_500mb(nkr,nkr) &amp;<a name='123'>
     &amp;,cwli_1(nkr,nkr),cwli_2(nkr,nkr),cwli_3(nkr,nkr) &amp;<a name='124'>
     &amp;,cwls(nkr,nkr),cwlg(nkr,nkr),cwlh(nkr,nkr) &amp;<a name='125'>
<a name='126'>
     &amp;,cwil_1(nkr,nkr),cwil_2(nkr,nkr),cwil_3(nkr,nkr) &amp;<a name='127'>
<a name='128'>
     &amp;,cwii_1_1(nkr,nkr),cwii_1_2(nkr,nkr),cwii_1_3(nkr,nkr) &amp;<a name='129'>
     &amp;,cwii_2_1(nkr,nkr),cwii_2_2(nkr,nkr),cwii_2_3(nkr,nkr) &amp;<a name='130'>
     &amp;,cwii_3_1(nkr,nkr),cwii_3_2(nkr,nkr),cwii_3_3(nkr,nkr) &amp;<a name='131'>
<a name='132'>
     &amp;,cwis_1(nkr,nkr),cwis_2(nkr,nkr),cwis_3(nkr,nkr) &amp;<a name='133'>
     &amp;,cwig_1(nkr,nkr),cwig_2(nkr,nkr),cwig_3(nkr,nkr) &amp;<a name='134'>
     &amp;,cwih_1(nkr,nkr),cwih_2(nkr,nkr),cwih_3(nkr,nkr) &amp;<a name='135'>
<a name='136'>
     &amp;,cwsl(nkr,nkr) &amp;<a name='137'>
     &amp;,cwsi_1(nkr,nkr),cwsi_2(nkr,nkr),cwsi_3(nkr,nkr)&amp;<a name='138'>
     &amp;,cwss(nkr,nkr),cwsg(nkr,nkr),cwsh(nkr,nkr) &amp;<a name='139'>
     &amp;,cwgl(nkr,nkr)&amp;<a name='140'>
     &amp;,cwgi_1(nkr,nkr),cwgi_2(nkr,nkr),cwgi_3(nkr,nkr)&amp;<a name='141'>
     &amp;,cwgs(nkr,nkr),cwgg(nkr,nkr),cwgh(nkr,nkr) &amp;<a name='142'>
<a name='143'>
     &amp;,cwhl(nkr,nkr) &amp;<a name='144'>
     &amp;,cwhi_1(nkr,nkr),cwhi_2(nkr,nkr),cwhi_3(nkr,nkr) &amp;<a name='145'>
     &amp;,cwhs(nkr,nkr),cwhg(nkr,nkr),cwhh(nkr,nkr) &amp;<a name='146'>
     &amp;,dlnr &amp;<a name='147'>
     &amp;,CTURBLL(KRMAX_LL,KRMAX_LL)&amp;<a name='148'>
     &amp;,CTURB_LL(K0_LL,K0_LL)&amp;<a name='149'>
     &amp;,CTURBGL(KRMAXG_GL,KRMAXL_GL)&amp;<a name='150'>
     &amp;,CTURB_GL(K0G_GL,K0L_GL)<a name='151'>
<a name='152'>
      DOUBLE PRECISION,private, save :: &amp;<a name='153'>
     &amp;   BRKWEIGHT(JBREAK),PKIJ(JBREAK,JBREAK,JBREAK), &amp;<a name='154'>
     &amp;   QKJ(JBREAK,JBREAK),ECOALMASSM(NKR,NKR)<a name='155'>
<a name='156'>
 <a name='157'>
<a name='158'>
<a name='159'>
<a name='160'>
<font color=#447700>!<a name='161'></font>
<font color=#447700>!<a name='162'></font>
      CONTAINS<a name='163'>
<a name='164'>
<font color=#447700>!-----------------------------------------------------------------------<a name='165'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='166'></font>
<A NAME='FAST_SBM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='167'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>FAST_SBM</font> (w,u,v,th_old,                                &amp; <A href='../../call_to/FAST_SBM.html' TARGET='index'>1</A>,<A href='../../call_from/FAST_SBM.html' TARGET='index'>21</A><a name='168'>
     &amp;                      chem_new,n_chem,                              &amp;<a name='169'>
     &amp;                      itimestep,DT,DX,DY,                         &amp;<a name='170'>
     &amp;                      dz8w,rho_phy,p_phy,pi_phy,th_phy,           &amp;<a name='171'>
     &amp;                      xland,ivgtyp,xlat,xlong,                           &amp;<a name='172'>
     &amp;                      QV,QC,QR,QI,QS,QG,QV_OLD,                   &amp;<a name='173'>
     &amp;                      QNC,QNR,QNS,QNG,QNA,                        &amp;<a name='174'>
     &amp;                      ids,ide, jds,jde, kds,kde,		        &amp;<a name='175'>
     &amp;                      ims,ime, jms,jme, kms,kme,		        &amp;<a name='176'>
     &amp;                      its,ite, jts,jte, kts,kte,                  &amp;<a name='177'>
     &amp;                      refl_10cm, diagflag, do_radar_ref,      &amp; <font color=#447700>! GT added for reflectivity calcs<a name='178'></font>
     &amp;                      RAINNC,RAINNCV,SNOWNC,SNOWNCV,GRAUPELNC,GRAUPELNCV,SR )<a name='179'>
<font color=#447700>!-----------------------------------------------------------------------<a name='180'></font>
      IMPLICIT NONE<a name='181'>
<font color=#447700>!-----------------------------------------------------------------------<a name='182'></font>
      INTEGER, PARAMETER :: ITLO=-60, ITHI=40<a name='183'>
      INTEGER NKRO,NKRE<a name='184'>
      INTEGER KR,IKL,ICE<a name='185'>
<a name='186'>
      INTEGER,INTENT(IN) :: IDS,IDE,JDS,JDE,KDS,KDE                     &amp;<a name='187'>
     &amp;                     ,IMS,IME,JMS,JME,KMS,KME                     &amp;<a name='188'>
     &amp;                     ,ITS,ITE,JTS,JTE,KTS,KTE                     &amp;<a name='189'>
     &amp;                     ,ITIMESTEP,N_CHEM<a name='190'>
<a name='191'>
      REAL, INTENT(IN) 	    :: DT,DX,DY<a name='192'>
   REAL,  DIMENSION( ims:ime , kms:kme , jms:jme )         , &amp;<a name='193'>
          INTENT(IN   ) ::                                   &amp;<a name='194'>
                                                          U, &amp;<a name='195'>
                                                          V, &amp;<a name='196'>
                                                          W   <a name='197'>
<font color=#447700>!                                                        pi<a name='198'></font>
  REAL    ,DIMENSION(ims:ime,kms:kme,jms:jme,n_chem),INTENT(INOUT)   :: chem_new<a name='199'>
  REAL, DIMENSION( ims:ime , kms:kme , jms:jme ),                 &amp;<a name='200'>
        INTENT(INOUT) ::                                          &amp;<a name='201'>
                                                              qv, &amp;<a name='202'>
                                                          qv_old, &amp;<a name='203'>
                                                          th_old, &amp;<a name='204'>
                                                              qc, &amp;<a name='205'>
                                                              qr, &amp;<a name='206'>
                                                              qi, &amp;<a name='207'>
                                                              qs, &amp;<a name='208'>
                                                              qg, &amp;<a name='209'>
                                                              qnc, &amp;<a name='210'>
                                                              qnr, &amp;<a name='211'>
                                                              qns, &amp;<a name='212'>
                                                              qng, &amp;<a name='213'>
                                                              qna<a name='214'>
<a name='215'>
<a name='216'>
<a name='217'>
      REAL , DIMENSION( ims:ime , jms:jme ) , INTENT(IN)   :: XLAND<a name='218'>
      LOGICAL, OPTIONAL, INTENT(IN) :: diagflag<a name='219'>
      INTEGER, OPTIONAL, INTENT(IN) :: do_radar_ref<a name='220'>
<a name='221'>
      REAL, DIMENSION(ims:ime, kms:kme, jms:jme), INTENT(INOUT)::       &amp;  <a name='222'>
                          refl_10cm<a name='223'>
<a name='224'>
      INTEGER, DIMENSION( ims:ime , jms:jme ), INTENT(IN)::   IVGTYP<a name='225'>
      REAL, DIMENSION( ims:ime, jms:jme ), INTENT(IN   )    :: XLAT, XLONG<a name='226'>
      REAL, INTENT(IN),     DIMENSION(ims:ime, kms:kme, jms:jme)::      &amp;<a name='227'>
     &amp;                      dz8w,p_phy,pi_phy,rho_phy<a name='228'>
      REAL, INTENT(INOUT),  DIMENSION(ims:ime, kms:kme, jms:jme)::      &amp;<a name='229'>
     &amp;                      th_phy<a name='230'>
      REAL, INTENT(INOUT),  DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='231'>
     &amp;      RAINNC,RAINNCV,SNOWNC,SNOWNCV,GRAUPELNC,GRAUPELNCV,SR<a name='232'>
<font color=#447700>!     REAL, INTENT(INOUT),  DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='233'></font>
<font color=#447700>!     REAL,                 DIMENSION(ims:ime,jms:jme), OPTIONAL ::     &amp;<a name='234'></font>
<font color=#447700>!    &amp;              LIQUEXP,ICEEXP,SNOWEXP,GRAUEXP,HAILEXP<a name='235'></font>
<font color=#447700>!<a name='236'></font>
<a name='237'>
<font color=#447700>!-----------------------------------------------------------------------<a name='238'></font>
<font color=#447700>!     LOCAL VARS<a name='239'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='240'></font>
<a name='241'>
<font color=#447700>!     NSTATS,QMAX,QTOT are diagnostic vars<a name='242'></font>
<a name='243'>
      INTEGER,DIMENSION(ITLO:ITHI,4) :: NSTATS<a name='244'>
<font color=#447700>!     REAL,   DIMENSION(ITLO:ITHI,5) :: QMAX<a name='245'></font>
      REAL,   DIMENSION(ITLO:ITHI,22):: QTOT<a name='246'>
<a name='247'>
<font color=#447700>!     SOME VARS WILL BE USED FOR DATA ASSIMILATION (DON'T NEED THEM NOW). <a name='248'></font>
<font color=#447700>!     THEY ARE TREATED AS LOCAL VARS, BUT WILL BECOME STATE VARS IN THE <a name='249'></font>
<font color=#447700>!     FUTURE. SO, WE DECLARED THEM AS MEMORY SIZES FOR THE FUTURE USE<a name='250'></font>
<a name='251'>
<font color=#447700>!     TLATGS_PHY,TRAIN_PHY,APREC,PREC,ACPREC,SR are not directly related <a name='252'></font>
<font color=#447700>!     the microphysics scheme. Instead, they will be used by Eta precip <a name='253'></font>
<font color=#447700>!     assimilation.<a name='254'></font>
<a name='255'>
      REAL,  DIMENSION( ims:ime, kms:kme, jms:jme ) ::                  &amp;<a name='256'>
     &amp;       TLATGS_PHY,TRAIN_PHY<a name='257'>
      REAL,  DIMENSION(ims:ime,jms:jme):: APREC,PREC,ACPREC<a name='258'>
      REAL,  DIMENSION(its-1:ite+1, kts:kte, jts-1:jte+1):: t_new,t_old,   &amp;<a name='259'>
     &amp;                                      zcgs,       rhocgs,pcgs<a name='260'>
<a name='261'>
      INTEGER :: I,J,K,KFLIP<a name='262'>
<font color=#447700>! BARRY<a name='263'></font>
      INTEGER :: KRFREEZ<a name='264'>
<font color=#447700>! DATA<a name='265'></font>
       REAL Z0IN,ZMIN<a name='266'>
       DATA  ZMIN/2.0E5/<a name='267'>
       DATA  Z0IN/2.0E5 /<a name='268'>
<a name='269'>
<font color=#447700>!      REAL,DIMENSION(1) :: EPSF2D, &amp;<a name='270'></font>
       REAL EPSF2D, &amp;<a name='271'>
     &amp;        TAUR1,TAUR2,EPS_R1,EPS_R2,ANC1IN, &amp;<a name='272'>
     &amp;        PEPL,PEPI,PERL,PERI,ANC1,ANC2,PARSP, &amp;<a name='273'>
     &amp;        AFREEZMY,BFREEZMY,BFREEZMAX, &amp;<a name='274'>
     &amp;        TCRIT,TTCOAL, &amp;<a name='275'>
     &amp;        EPSF1,EPSF3,EPSF4, &amp;<a name='276'>
     &amp;        SUP2_OLD, DSUPICEXZ,TFREEZ_OLD,DTFREEZXZ, &amp;<a name='277'>
     &amp;        AA1_MY,BB1_MY,AA2_MY,BB2_MY, &amp;<a name='278'>
     &amp;        DTIME,DTCOND, &amp;<a name='279'>
     &amp;        A1_MYN, BB1_MYN, A2_MYN, BB2_MYN<a name='280'>
        DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN  &amp;<a name='281'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='282'>
        DATA AA1_MY,BB1_MY,AA2_MY,BB2_MY/2.53E12,5.42E3,3.41E13,6.13E3/<a name='283'>
<font color=#447700>!            QSUM,ISUM,QSUM1,QSUM2,CCNSUM1,CCNSUM2<a name='284'></font>
        DATA KRFREEZ,BFREEZMAX,ANC1,ANC2,PARSP,PEPL,PEPI,PERL,PERI, &amp;<a name='285'>
     &amp;  TAUR1,TAUR2,EPS_R1,EPS_R2,TTCOAL,AFREEZMY,&amp;<a name='286'>
     &amp;  BFREEZMY,EPSF1,EPSF3,EPSF4,TCRIT/21,&amp;<a name='287'>
     &amp;  0.6600E00, &amp;<a name='288'>
     &amp;  1.0000E02,1.0000E02,0.9000E02, &amp;<a name='289'>
     &amp;  0.6000E00,0.6000E00,1.0000E-03,1.0000E-03, &amp;<a name='290'>
     &amp;  0.5000E00,0.8000E00,0.1500E09,0.1500E09, &amp;<a name='291'>
     &amp;  2.3315E02,0.3333E-04,0.6600E00, &amp;<a name='292'>
     &amp;  0.1000E-02,0.1000E-05,0.1000E-05, &amp;<a name='293'>
     &amp;  2.7015E02/<a name='294'>
<font color=#447700>! JIMY: N_CHEM,variables read in as data<a name='295'></font>
<font color=#447700>! SBM VARIABLES<a name='296'></font>
      REAL,DIMENSION (nkr) :: FF1IN,FF3IN,FF4IN,FF5IN,&amp;<a name='297'>
     &amp;              FF1R,FF3R,FF4R,FF5R,FCCN<a name='298'>
      REAL,DIMENSION (nkr,icemax) :: FF2IN,FF2R<a name='299'>
<font color=#447700>!!!! NOTE: ZCGS AND OTHER VARIABLES ARE ALSO DIMENSIONED IN FALFLUXHUCM<a name='300'></font>
      DOUBLE PRECISION DEL1NR,DEL2NR,DEL12R,DEL12RD,ES1N,ES2N,EW1N,EW1PN<a name='301'>
      DOUBLE PRECISION DELSUP1,DELSUP2,DELDIV1,DELDIV2<a name='302'>
      DOUBLE PRECISION TT,QQ,TTA,QQA,PP,DPSA,DELTATEMP,DELTAQ<a name='303'>
      DOUBLE PRECISION DIV1,DIV2,DIV3,DIV4,DEL1IN,DEL2IN,DEL1AD,DEL2AD<a name='304'>
      REAL DEL_BB,DEL_BBN,DEL_BBR<a name='305'>
      REAL FACTZ,CONCCCN_XZ,CONCDROP<a name='306'>
       REAL SUPICE(KTE),AR1,AR2, &amp;<a name='307'>
     &amp; DERIVT_X,DERIVT_Y,DERIVT_Z,DERIVS_X,DERIVS_Y,DERIVS_Z, &amp;<a name='308'>
     &amp; ES2NPLSX,ES2NPLSY,EW1NPLSX,EW1NPLSY,UX,VX, &amp;<a name='309'>
     &amp; DEL2INPLSX,DEL2INPLSY,DZZ(KTE)<a name='310'>
       INTEGER KRR,I_START,I_END,J_START,J_END<a name='311'>
   <a name='312'>
       REAL DTFREEZ_XYZ(ITE,KTE,JTE),DSUPICE_XYZ(ITE,KTE,JTE)<a name='313'>
<a name='314'>
       REAL DXHUCM,DYHUCM<a name='315'>
       REAL FMAX1,FMAX2,FMAX3,FMAX4,FMAX5<a name='316'>
       INTEGER ISYM1,ISYM2,ISYM3,ISYM4,ISYM5<a name='317'>
       INTEGER DIFFU<a name='318'>
       REAL DELTAW<a name='319'>
       real zcgs_z(kts:kte),pcgs_z(kts:kte),rhocgs_z(kts:kte),ffx_z(kts:kte,nkr)<a name='320'>
       real z_full<a name='321'>
<font color=#447700>! SLOPE INTERCEPT FOR RAIN, SNOW, AND GRAUPEL                                    PARAMR.32<a name='322'></font>
<font color=#447700>!     RON=8.E6                                                                   PARAMR.33<a name='323'></font>
<font color=#447700>!     RON2=1.E10                                                                 23DEC04.211<a name='324'></font>
<font color=#447700>!     RON2=1.E9                                                                  23DEC04.212<a name='325'></font>
<font color=#447700>!     SON=2.E7                                                                   PARAMR.36<a name='326'></font>
<font color=#447700>!     GON=5.E7                                                                   23DEC04.213<a name='327'></font>
<font color=#447700>!     GON=4.E6<a name='328'></font>
       REAL, PARAMETER :: RON=8.E6, GON=5.E7<a name='329'>
       REAL EFF_N,EFF_D<a name='330'>
       real nzero,son,nzero_less<a name='331'>
       parameter (son=2.E7)<a name='332'>
       real raddumb(nkr),massdumb(nkr)<a name='333'>
       real hydrosum<a name='334'>
<a name='335'>
       integer imax,kmax,jmax<a name='336'>
       real gmax<a name='337'>
       real tmax,qmax,divmax,rainmax<a name='338'>
       real qnmax,inmax,knmax<a name='339'>
       real hydro<a name='340'>
       real difmax,tdif,tt_old,w_stag,qq_old<a name='341'>
       real teten,es<a name='342'>
      REAL, DIMENSION(kts:kte)::                            &amp;<a name='343'>
                      qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, t1d, p1d<a name='344'>
      REAL, DIMENSION(kts:kte):: dBZ<a name='345'>
<a name='346'>
       integer  print_int<a name='347'>
       parameter (print_int=300)<a name='348'>
<a name='349'>
       integer t_print,xlong10<a name='350'>
       t_print=print_int/dt<a name='351'>
<a name='352'>
       difmax = 0<a name='353'>
<font color=#447700>!      print*,'itimestep = ',itimestep<a name='354'></font>
<font color=#447700>!        if (itimestep.gt.150)return<a name='355'></font>
        if (itimestep.eq.1)then<a name='356'>
         if (iceprocs.eq.1) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_803">("SBM FAST: ICE PROCESES ACTIVE")<a name='357'>
         if (iceprocs.eq.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_804">("SBM FAST: LIQUID PROCESES ONLY")<a name='358'>
        print*,'num_chem = ',n_chem<a name='359'>
        end if<a name='360'>
       tmax = 0<a name='361'>
<font color=#447700>! COAL BOTT IS EITHER CALLED EVERY TIME STEP OR TWICE<a name='362'></font>
       NCOND = 0<a name='363'>
<font color=#447700>!       if (mod(dx,1000.).eq.0)then<a name='364'></font>
<font color=#447700>!       NCOND=dx/1000<a name='365'></font>
<font color=#447700>!       else if (mod(dx,2000.).eq.0)then<a name='366'></font>
<font color=#447700>!       NCOND=dx/500<a name='367'></font>
<font color=#447700>!       else if (mod(dx,3000.).eq.0)then<a name='368'></font>
<font color=#447700>!       NCOND=dx/1000<a name='369'></font>
<font color=#447700>!       else if (mod(dx,4000.).eq.0)then<a name='370'></font>
<font color=#447700>!       NCOND=dx/1000<a name='371'></font>
<font color=#447700>!       else if (mod(dx,1333.).eq.0)then<a name='372'></font>
<font color=#447700>!       NCOND=dx/1.3333<a name='373'></font>
<font color=#447700>!       end if<a name='374'></font>
       NCOND=nint(dx/1000)<a name='375'>
<a name='376'>
 <font color=#447700>!      IF (NCOND.EQ.0)NCOND=3<a name='377'></font>
       NCOND=max(NCOND,1)<a name='378'>
       DTCOND=DT/NCOND<a name='379'>
       dt_coll=dt<a name='380'>
       call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_1">(dt)<a name='381'>
<font color=#447700>!      if (itimestep.eq.1.or.itimestep.eq.3)then<a name='382'></font>
<font color=#447700>!            do kr = 1,nkr<a name='383'></font>
<font color=#447700>!             print*,'xl = ',xl(kr),vr1(kr),RLEC(kr),RO1BL(kr)<a name='384'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,1),vr2(kr,1),RIEC(KR,1),RO2BL(KR,1)<a name='385'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,2),vr2(kr,2),RIEC(KR,2),RO2BL(KR,2)<a name='386'></font>
<font color=#447700>!             print*,'xi = ',xi(kr,3),vr2(kr,3),RIEC(KR,3),RO2BL(KR,3)<a name='387'></font>
<font color=#447700>!             print*,'xs = ',xs(kr),vr3(kr),RSEC(kr),RO3BL(kr)<a name='388'></font>
<font color=#447700>!             print*,'xg = ',xg(kr),vr4(kr),RGEC(kr),RO4BL(kr)<a name='389'></font>
<font color=#447700>!             print*,'xh = ',xh(kr),vr5(kr),RHEC(kr),RO5BL(kr)<a name='390'></font>
<font color=#447700>!            end do<a name='391'></font>
<font color=#447700>!       end if<a name='392'></font>
<a name='393'>
<font color=#447700>!<a name='394'></font>
      DEL_BB=BB2_MY-BB1_MY<a name='395'>
      DEL_BBN=BB2_MYN-BB1_MYN<a name='396'>
      DEL_BBR=BB1_MYN/DEL_BBN<a name='397'>
<font color=#447700>!<a name='398'></font>
      if (conserv)then<a name='399'>
      DO j = jts,jte<a name='400'>
      DO i = its,ite<a name='401'>
      DO k = kts,kte<a name='402'>
      rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='403'>
      KRR=0<a name='404'>
      DO kr=p_ff1i01,p_ff1i33<a name='405'>
      KRR=KRR+1<a name='406'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XL(KRR)/XL(KRR)/3.0<a name='407'>
      END DO<a name='408'>
      KRR=0<a name='409'>
      DO KR=p_ff5i01,p_ff5i33<a name='410'>
        KRR=KRR+1<a name='411'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XS(KRR)/XS(KRR)/3.0<a name='412'>
      END DO<a name='413'>
      KRR=0<a name='414'>
      DO KR=p_ff6i01,p_ff6i33<a name='415'>
        KRR=KRR+1<a name='416'>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XG(KRR)/XG(KRR)/3.0<a name='417'>
      END DO<a name='418'>
      KRR=0<a name='419'>
      DO KR=p_ff8i01,p_ff8i33<a name='420'>
        KRR=KRR+1<a name='421'>
<font color=#447700>! change by J. Fan<a name='422'></font>
<font color=#447700>!        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/XCCN(KRR)<a name='423'></font>
        chem_new(I,K,J,KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/1000.   <font color=#447700>! chem_new (input) is #/kg<a name='424'></font>
      END DO<a name='425'>
      END DO<a name='426'>
      END DO<a name='427'>
      END DO<a name='428'>
      end if<a name='429'>
<a name='430'>
      call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_2">(dt)<a name='431'>
<a name='432'>
      DXHUCM=100.*DX<a name='433'>
      DYHUCM=100.*DY<a name='434'>
<a name='435'>
<font color=#447700>! JIMY<a name='436'></font>
      I_START=MAX(1,ITS-1)<a name='437'>
      J_START=MAX(1,JTS-1)<a name='438'>
      I_END=MIN(IDE-1,ITE+1)<a name='439'>
      J_END=MIN(JDE-1,JTE+1)<a name='440'>
<font color=#447700>!     print*,'ide-1 = ',ide-1<a name='441'></font>
<font color=#447700>!     print*,'jde-1 = ',jde-1<a name='442'></font>
<font color=#447700>!     print*,'kte = ',kte<a name='443'></font>
<font color=#447700>!     print*,'i_start,i_end = ',i_start,i_end<a name='444'></font>
<font color=#447700>!     print*,'j_start,j_end = ',j_start,j_end<a name='445'></font>
<font color=#447700>!     print*,'its,ite = ',its,ite<a name='446'></font>
<font color=#447700>!     print*,'jts,jte = ',jts,jte<a name='447'></font>
      if (itimestep.eq.1)then<a name='448'>
      DO j = j_start,j_end<a name='449'>
      DO k = kts,kte<a name='450'>
      DO i = i_start,i_end<a name='451'>
         th_old(i,k,j)=th_phy(i,k,j)<a name='452'>
         qv_old(i,k,j)=qv(i,k,j)<a name='453'>
      END DO<a name='454'>
      END DO<a name='455'>
      END DO<a name='456'>
      end if<a name='457'>
      DO j = j_start,j_end<a name='458'>
      DO k = kts,kte<a name='459'>
      DO i = i_start,i_end<a name='460'>
        t_new(i,k,j) = th_phy(i,k,j)*pi_phy(i,k,j)<a name='461'>
        t_old(i,k,j) = th_old(i,k,j)*pi_phy(i,k,j)<a name='462'>
      ENDDO<a name='463'>
      ENDDO<a name='464'>
      ENDDO<a name='465'>
      DO j = j_start,j_end<a name='466'>
      DO i = i_start,i_end<a name='467'>
      z_full=0.<a name='468'>
      DO k = kts,kte<a name='469'>
          pcgs(I,K,J)=P_PHY(I,K,J)*10.<a name='470'>
          rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='471'>
          zcgs(I,K,J)=z_full+0.5*dz8w(I,K,J)*100<a name='472'>
          z_full=z_full+dz8w(i,k,j)*100.<a name='473'>
      ENDDO<a name='474'>
      ENDDO<a name='475'>
      ENDDO<a name='476'>
 <a name='477'>
<font color=#447700>!!!!!<a name='478'></font>
         if (itimestep.eq.1)then<a name='479'>
<font color=#447700>!      DO j = j_start,j_end<a name='480'></font>
<font color=#447700>!      DO i = i_start,i_end<a name='481'></font>
       DO j = jts,jte<a name='482'>
       DO i = its,ite<a name='483'>
       DO k = kts,kte<a name='484'>
         IF (zcgs(I,K,J).LE.ZMIN)THEN<a name='485'>
            FACTZ=1.<a name='486'>
         ELSE<a name='487'>
            FACTZ=EXP(-(zcgs(I,K,J)-ZMIN)/Z0IN)<a name='488'>
         END IF<a name='489'>
<font color=#447700>!        FACTZ = 1<a name='490'></font>
         KRR=0<a name='491'>
         DO KR=p_ff8i01,p_ff8i33<a name='492'>
          KRR=KRR+1<a name='493'>
          if (xland(i,j).lt.1.5)then<a name='494'>
             chem_new(I,K,J,KR)=FCCNR_CON(KRR)*FACTZ<a name='495'>
          else<a name='496'>
             chem_new(I,K,J,KR)=FCCNR_MAR(KRR)*FACTZ<a name='497'>
          end if<a name='498'>
<font color=#447700>!         if (dx.ge.4500)then<a name='499'></font>
<font color=#447700>!         if (xlat(i,j).ge.10.and.xlat(i,j).le.30.and.zcgs(i,k,j).le.300000)then<a name='500'></font>
<font color=#447700>!             chem_new(I,K,J,KR)=FCCNR_MIX(KRR)<a name='501'></font>
<font color=#447700>!         end if<a name='502'></font>
<font color=#447700>!         end if<a name='503'></font>
<a name='504'>
         END DO<a name='505'>
       end do<a name='506'>
       end do<a name='507'>
       end do<a name='508'>
         end if<a name='509'>
       if (itimestep.ne.1.and.dx.gt.dx_bound)then  <a name='510'>
       DO j = jts,jte<a name='511'>
       DO k = kts,kte<a name='512'>
       DO i = its,ite<a name='513'>
        if (i.le.5.or.i.ge.IDE-5.OR. &amp;<a name='514'>
     &amp;       j.le.5.or.j.ge.JDE-5)THEN<a name='515'>
         IF (zcgs(I,K,J).LE.ZMIN)THEN<a name='516'>
            FACTZ=1.<a name='517'>
         ELSE<a name='518'>
            FACTZ=EXP(-(zcgs(I,K,J)-ZMIN)/Z0IN)<a name='519'>
         END IF<a name='520'>
         KRR=0<a name='521'>
         DO kr=p_ff8i01,p_ff8i33<a name='522'>
          KRR=KRR+1<a name='523'>
          if (xland(i,j).lt.1.5)then<a name='524'>
             chem_new(I,K,J,KR)=FCCNR_CON(KRR)*FACTZ<a name='525'>
          else<a name='526'>
             chem_new(I,K,J,KR)=FCCNR_MAR(KRR)*FACTZ<a name='527'>
          end if<a name='528'>
         End do<a name='529'>
        end if<a name='530'>
       end do<a name='531'>
       end do<a name='532'>
       end do<a name='533'>
       end if<a name='534'>
<a name='535'>
<font color=#447700>!     print*,'dxhucm = ',dxhucm<a name='536'></font>
<font color=#447700>!     print*,'dyhucm = ',dyhucm<a name='537'></font>
<font color=#447700>!<a name='538'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='539'></font>
<font color=#447700>!**********************************************************************<a name='540'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='541'></font>
<font color=#447700>!<a name='542'></font>
<font color=#447700>!<a name='543'></font>
<font color=#447700>!     print*,'here at 1'<a name='544'></font>
      DO j = jts,jte<a name='545'>
      DO i = its,ite<a name='546'>
      DO k = kts,kte<a name='547'>
       IF(K.EQ.KTE)THEN<a name='548'>
        DZZ(K)=(zcgs(I,K,J)-zcgs(I,K-1,J))<a name='549'>
       ELSE IF(K.EQ.1)THEN<a name='550'>
        DZZ(K)=(zcgs(I,K+1,J)-zcgs(I,K,J))<a name='551'>
       ELSE<a name='552'>
        DZZ(K)=(zcgs(I,K+1,J)-zcgs(I,K-1,J))<a name='553'>
       END IF<a name='554'>
       ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='555'>
       EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='556'>
       SUPICE(K)=EW1N/ES2N-1.<a name='557'>
       IF(SUPICE(K).GT.0.5) SUPICE(K)=.5<a name='558'>
 <a name='559'>
      END DO<a name='560'>
      DO k = kts,kte<a name='561'>
       IF(T_OLD(I,K,J).GE.238.15.AND.T_OLD(I,K,J).LT.274.15) THEN<a name='562'>
       if (k.lt.kte)then       <a name='563'>
        w_stag=50.*(w(i,k,j)+w(i,k+1,j)) <a name='564'>
       else<a name='565'>
        w_stag=100*w(i,k,j)<a name='566'>
       end if<a name='567'>
             IF (I.LT.IDE-1.AND.J.LT.JDE-1)THEN<a name='568'>
              UX=25.*(U(I,K,J)+U(I+1,K,J)+U(I,K,J+1)+U(I+1,K,J+1))<a name='569'>
              VX=25.*(V(I,K,J)+V(I+1,K,J)+V(I,K,J+1)+V(I+1,K,J+1))<a name='570'>
             ELSE<a name='571'>
              UX=U(I,K,J)*100.<a name='572'>
              VX=V(I,K,J)*100.<a name='573'>
             END IF  <a name='574'>
             IF(K.EQ.1) DERIVT_Z=(T_OLD(I,K+1,J)-T_OLD(I,K,J))/DZZ(K)<a name='575'>
             IF(K.EQ.KTE) DERIVT_Z=(T_OLD(I,K,J)-T_OLD(I,K-1,J))/DZZ(K)<a name='576'>
             IF(K.GT.1.AND.K.LT.KTE) DERIVT_Z= &amp;<a name='577'>
     &amp;        (T_OLD(I,K+1,J)-T_OLD(I,K-1,J))/DZZ(K)<a name='578'>
             IF (I.EQ.1)THEN<a name='579'>
              DERIVT_X=(T_OLD(I+1,K,J)-T_OLD(I,K,J))/(DXHUCM)<a name='580'>
             ELSE IF (I.EQ.IDE-1)THEN<a name='581'>
              DERIVT_X=(T_OLD(I,K,J)-T_OLD(I-1,K,J))/(DXHUCM)<a name='582'>
             ELSE<a name='583'>
              DERIVT_X=(T_OLD(I+1,K,J)-T_OLD(I-1,K,J))/(2.*DXHUCM)<a name='584'>
             END IF<a name='585'>
             IF (J.EQ.1)THEN<a name='586'>
              DERIVT_Y=(T_OLD(I,K,J+1)-T_OLD(I,K,J))/(DYHUCM)<a name='587'>
             ELSE IF (J.EQ.JDE-1)THEN<a name='588'>
              DERIVT_Y=(T_OLD(I,K,J)-T_OLD(I,K,J-1))/(DYHUCM)<a name='589'>
             ELSE<a name='590'>
              DERIVT_Y=(T_OLD(I,K,J+1)-T_OLD(I,K,J-1))/(2.*DYHUCM)<a name='591'>
             END IF<a name='592'>
             DTFREEZ_XYZ(I,K,J)=DT*(VX*DERIVT_Y+ &amp;<a name='593'>
     &amp;            UX*DERIVT_X+w_stag*DERIVT_Z)<a name='594'>
          ELSE<a name='595'>
             DTFREEZ_XYZ(I,K,J)=0.<a name='596'>
          ENDIF<a name='597'>
          IF(SUPICE(K).GE.0.02.AND.T_OLD(I,K,J).LT.268.15) THEN<a name='598'>
            IF (I.LT.IDE-1)THEN<a name='599'>
             ES2NPLSX=AA2_MY*EXP(-BB2_MY/T_OLD(I+1,K,J))<a name='600'>
             EW1NPLSX=QV_OLD(I+1,K,J)*pcgs(I+1,K,J)/ &amp;<a name='601'>
     &amp;               (0.622+0.378*QV_OLD(I+1,K,J))<a name='602'>
            ELSE<a name='603'>
             ES2NPLSX=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='604'>
             EW1NPLSX=QV_OLD(I,K,J)*pcgs(I,K,J)/ &amp;<a name='605'>
     &amp;               (0.622+0.378*QV_OLD(I,K,J))<a name='606'>
            END IF<a name='607'>
            IF (ES2NPLSX.EQ.0)THEN<a name='608'>
             DEL2INPLSX=0.5<a name='609'>
            ELSE<a name='610'>
             DEL2INPLSX=EW1NPLSX/ES2NPLSX-1.<a name='611'>
            END IF<a name='612'>
            IF(DEL2INPLSX.GT.0.5) DEL2INPLSX=.5<a name='613'>
            IF (I.GT.1)THEN<a name='614'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I-1,K,J))<a name='615'>
             EW1N=QV_OLD(I-1,K,J)*pcgs(I-1,K,J)/(0.622+0.378*QV_OLD(I-1,K,J))<a name='616'>
            ELSE<a name='617'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='618'>
             EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='619'>
            END IF<a name='620'>
            DEL2IN=EW1N/ES2N-1.<a name='621'>
            IF(DEL2IN.GT.0.5) DEL2IN=.5<a name='622'>
            IF (I.GT.1.AND.I.LT.IDE-1)THEN<a name='623'>
             DERIVS_X=(DEL2INPLSX-DEL2IN)/(2.*DXHUCM)<a name='624'>
            ELSE<a name='625'>
             DERIVS_X=(DEL2INPLSX-DEL2IN)/(DXHUCM)<a name='626'>
            END IF<a name='627'>
            IF (J.LT.JDE-1)THEN<a name='628'>
             ES2NPLSY=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J+1))<a name='629'>
             EW1NPLSY=QV_OLD(I,K,J+1)*pcgs(I,K,J+1)/(0.622+0.378*QV_OLD(I,K,J+1))<a name='630'>
            ELSE<a name='631'>
             ES2NPLSY=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='632'>
             EW1NPLSY=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='633'>
            END IF<a name='634'>
            DEL2INPLSY=EW1NPLSY/ES2NPLSY-1.<a name='635'>
            IF(DEL2INPLSY.GT.0.5) DEL2INPLSY=.5<a name='636'>
            IF (J.GT.1)THEN<a name='637'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J-1))<a name='638'>
             EW1N=QV_OLD(I,K,J-1)*pcgs(I,K,J-1)/(0.622+0.378*QV_OLD(I,K,J-1))<a name='639'>
            ELSE<a name='640'>
             ES2N=AA2_MY*EXP(-BB2_MY/T_OLD(I,K,J))<a name='641'>
             EW1N=QV_OLD(I,K,J)*pcgs(I,K,J)/(0.622+0.378*QV_OLD(I,K,J))<a name='642'>
            END IF<a name='643'>
             DEL2IN=EW1N/ES2N-1.<a name='644'>
            IF(DEL2IN.GT.0.5) DEL2IN=.5<a name='645'>
            IF (J.GT.1.AND.J.LT.JDE-1)THEN<a name='646'>
             DERIVS_Y=(DEL2INPLSY-DEL2IN)/(2.*DYHUCM)<a name='647'>
            ELSE<a name='648'>
             DERIVS_Y=(DEL2INPLSY-DEL2IN)/(DYHUCM)<a name='649'>
            END IF<a name='650'>
<font color=#447700>!<a name='651'></font>
            IF (K.EQ.1)DERIVS_Z=(SUPICE(K+1)-SUPICE(K))/DZZ(K)<a name='652'>
            IF (K.EQ.KTE)DERIVS_Z=(SUPICE(K)-SUPICE(K-1))/DZZ(K)<a name='653'>
            IF(K.GT.1.and.K.LT.KTE) DERIVS_Z=(SUPICE(K+1)-SUPICE(K-1))/DZZ(K)<a name='654'>
            IF (I.LT.IDE-1.AND.J.LT.JDE-1)THEN<a name='655'>
             UX=25.*(U(I,K,J)+U(I+1,K,J)+U(I,K,J+1)+U(I+1,K,J+1))<a name='656'>
             VX=25.*(V(I,K,J)+V(I+1,K,J)+V(I,K,J+1)+V(I+1,K,J+1))<a name='657'>
            ELSE<a name='658'>
             UX=U(I,K,J)*100.<a name='659'>
             VX=V(I,K,J)*100.<a name='660'>
            END IF  <a name='661'>
            DSUPICE_XYZ(I,K,J)=(UX*DERIVS_X+VX*DERIVS_Y+ &amp;<a name='662'>
      &amp;                        w_stag*DERIVS_Z)*DTCOND<a name='663'>
          ELSE<a name='664'>
            DSUPICE_XYZ(I,K,J)=0.0<a name='665'>
          END IF<a name='666'>
         END DO<a name='667'>
         END DO<a name='668'>
         END DO<a name='669'>
     <a name='670'>
<a name='671'>
      do j = jts,jte<a name='672'>
      do i = its,ite<a name='673'>
      do k = kts,kte<a name='674'>
<font color=#447700>!     if (i.eq.214.and.j.eq.60.and.k.eq.14)then<a name='675'></font>
<font color=#447700>!     if (i.eq.214.and.j.eq.60)then<a name='676'></font>
<font color=#447700>!     print*,'i,j = ',i,j,k<a name='677'></font>
<font color=#447700>!     end if<a name='678'></font>
<font color=#447700>!     print*,'i,j = ',i,j,k<a name='679'></font>
<font color=#447700>!     print*,'i,j,k = ',i,j,k<a name='680'></font>
<font color=#447700>! LIQUID<a name='681'></font>
<font color=#447700>!      do kr=1,nkr<a name='682'></font>
<font color=#447700>!       if (ff4r(kr).lt.0)then<a name='683'></font>
<font color=#447700>!        print*,'i,k,j = ',i,k,j<a name='684'></font>
<font color=#447700>!        print*,'ff4r 0 = ',kr,ff4r(kr)<a name='685'></font>
<font color=#447700>!       end if<a name='686'></font>
<font color=#447700>!      end do<a name='687'></font>
<a name='688'>
          KRR=0<a name='689'>
          DO KR=p_ff1i01,p_ff1i33<a name='690'>
          KRR=KRR+1<a name='691'>
<font color=#447700>!          FF1R(KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XL(KR)/XL(KR)/3<a name='692'></font>
           FF1R(KRR)=chem_new(I,K,J,KR)<a name='693'>
           IF (FF1R(KRR).LT.0)FF1R(KRR)=0.<a name='694'>
          END DO<a name='695'>
<font color=#447700>!        DO KR=1,NKR<a name='696'></font>
<font color=#447700>!          FF1R(KR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XL(KR)/XL(KR)/3<a name='697'></font>
<font color=#447700>!          IF (FF1R(KR).LT.0)FF1R(KR)=0.<a name='698'></font>
<font color=#447700>!         END DO   <a name='699'></font>
<font color=#447700>! CCN<a name='700'></font>
        KRR=0<a name='701'>
        DO KR=p_ff8i01,p_ff8i33<a name='702'>
          KRR=KRR+1<a name='703'>
<font color=#447700>!         FCCN(KRR)=chem_new(I,K,J,KR)<a name='704'></font>
<font color=#447700>!         FCCN(KRR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/XCCN(KRR)<a name='705'></font>
          FCCN(KRR)=chem_new(I,K,J,KR)<a name='706'>
          if (fccn(krr).lt.0)fccn(krr)=0.<a name='707'>
        END DO<a name='708'>
        IF (ICEPROCS.EQ.1)THEN<a name='709'>
<font color=#447700>! COLUMNS!<a name='710'></font>
         KRR=0<a name='711'>
         DO KR=NKR+1,NKR*2<a name='712'>
          KRR=KRR+1<a name='713'>
          FF2R(KRR,1)=0.<a name='714'>
         END DO<a name='715'>
<font color=#447700>! PLATES!<a name='716'></font>
         KRR=0<a name='717'>
         DO KR=NKR*2+1,NKR*3<a name='718'>
          KRR=KRR+1<a name='719'>
          FF2R(KRR,2)=0.<a name='720'>
         END DO<a name='721'>
<font color=#447700>! DENDRITES!<a name='722'></font>
         KRR=0<a name='723'>
         DO KR=NKR*3+1,NKR*4<a name='724'>
          KRR=KRR+1<a name='725'>
          FF2R(KRR,3)=0.<a name='726'>
         END DO<a name='727'>
<font color=#447700>! SNOW<a name='728'></font>
           KRR=0<a name='729'>
           DO KR=p_ff5i01,p_ff5i33<a name='730'>
            KRR=KRR+1<a name='731'>
<font color=#447700>!           FF3R(KRR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XS(KRR)/XS(KRR)/3<a name='732'></font>
            FF3R(KRR)=chem_new(I,K,J,KR)<a name='733'>
            if (ff3r(krr).lt.0)ff3r(krr)=0.<a name='734'>
           END DO<a name='735'>
<a name='736'>
<font color=#447700>!          KRR=0<a name='737'></font>
<font color=#447700>!          DO KR=NKR*1+1,NKR*2<a name='738'></font>
<font color=#447700>!           KRR=KRR+1<a name='739'></font>
<font color=#447700>!           FF3R(KRR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XS(KRR)/XS(KRR)/3<a name='740'></font>
<font color=#447700>!           if (ff3r(krr).lt.0)ff3r(krr)=0.<a name='741'></font>
<font color=#447700>!          END DO<a name='742'></font>
<font color=#447700>! Graupel<a name='743'></font>
           KRR=0<a name='744'>
           DO KR=p_ff6i01,p_ff6i33<a name='745'>
            KRR=KRR+1<a name='746'>
<font color=#447700>!           FF4R(KRR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XG(KRR)/XG(KRR)/3<a name='747'></font>
            FF4R(KRR)=chem_new(I,K,J,KR)<a name='748'>
            IF (FF4R(KRR).LT.0)FF4R(KRR)=0.<a name='749'>
           END DO<a name='750'>
<a name='751'>
<font color=#447700>!          KRR=0<a name='752'></font>
<font color=#447700>!          DO KR=NKR*2+1,NKR*3<a name='753'></font>
<font color=#447700>!           KRR=KRR+1<a name='754'></font>
<font color=#447700>!           FF4R(KRR)=chem_new(I,K,J,KR)*RHOCGS(I,K,J)/COL/XG(KRR)/XG(KRR)/3<a name='755'></font>
<font color=#447700>!           IF (FF4R(KRR).LT.0)FF4R(KRR)=0.<a name='756'></font>
<font color=#447700>!          END DO   <a name='757'></font>
<font color=#447700>! Hail<a name='758'></font>
         KRR=0<a name='759'>
         DO KR=NKR*6+1,NKR*7<a name='760'>
          KRR=KRR+1<a name='761'>
          FF5R(KRR)=0.<a name='762'>
          if (ff5r(krr).lt.0)ff5r(krr)=0.<a name='763'>
         END DO<a name='764'>
<font color=#447700>!<a name='765'></font>
<font color=#447700>!     if (i.eq.43.and.k.eq.6.and.j.eq.41)then<a name='766'></font>
<font color=#447700>!      print*,'here 2'<a name='767'></font>
<font color=#447700>!     end if<a name='768'></font>
<a name='769'>
<font color=#447700>!      do kr=1,nkr<a name='770'></font>
<font color=#447700>!       if (ff4r(kr).lt.0)then<a name='771'></font>
<font color=#447700>!        print*,'i,k,j = ',i,k,j<a name='772'></font>
<font color=#447700>!        print*,'ff4r 1 = ',kr,ff4r(kr)<a name='773'></font>
<font color=#447700>!       end if<a name='774'></font>
<font color=#447700>!      end do<a name='775'></font>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FREEZ'>FREEZ</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FREEZ_1"> &amp;<a name='776'>
     &amp;     (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='777'>
     &amp;      T_NEW(I,K,J),DT,rhocgs(I,K,J), &amp;<a name='778'>
     &amp;      COL,AFREEZMY,BFREEZMY,BFREEZMAX, &amp;<a name='779'>
     &amp;      KRFREEZ,ICEMAX,NKR)<a name='780'>
          DO KR=1,NKR<a name='781'>
            DO ICE=1,ICEMAX<a name='782'>
             FF3R(KR)=FF2IN(KR,ICE)+FF3R(KR)<a name='783'>
             FF2IN(KR,ICE)=0<a name='784'>
             FF2R(KR,ICE)=0<a name='785'>
             FF4R(KR)=FF5R(KR)+FF4R(KR)<a name='786'>
             FF5R(KR)=0<a name='787'>
            ENDDO<a name='788'>
          END DO<a name='789'>
         IF (ORIGINAL_MELT)THEN<a name='790'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ORIG_MELT'>ORIG_MELT</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ORIG_MELT_1">  &amp;<a name='791'>
     &amp;    (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='792'>
     &amp;     T_NEW(I,K,J),DT,rhocgs(I,K,J),COL,ICEMAX,NKR)<a name='793'>
         END IF<a name='794'>
         IF (JIWEN_FAN_MELT) THEN<a name='795'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#J_W_MELT'>J_W_MELT</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="J_W_MELT_1"> &amp;<a name='796'>
     &amp;    (FF1R,XL,FF2R,XI,FF3R,XS,FF4R,XG,FF5R,XH, &amp;<a name='797'>
     &amp;     T_NEW(I,K,J),DT,rhocgs(I,K,J),COL,ICEMAX,NKR)<a name='798'>
         END IF<a name='799'>
<a name='800'>
        ENDIF<a name='801'>
<font color=#447700>!      do kr=1,nkr<a name='802'></font>
<font color=#447700>!       if (ff4r(kr).lt.0)then<a name='803'></font>
<font color=#447700>!        print*,'i,k,j = ',i,k,j<a name='804'></font>
<font color=#447700>!        print*,'ff4r 2 = ',ff4r(kr)<a name='805'></font>
<font color=#447700>!       end if<a name='806'></font>
<font color=#447700>!       end do<a name='807'></font>
<font color=#447700>!     if(i.eq.64.and.j.eq.2.and.k.eq.16)then<a name='808'></font>
<font color=#447700>!        print*,'T_NEW(I,K,J) = ',T_NEW(I,K,J)<a name='809'></font>
<font color=#447700>!        print*,'T_OLD(I,K,J) = ',T_OLD(I,K,J)<a name='810'></font>
<font color=#447700>!     end if<a name='811'></font>
        DO KR=1,NKR<a name='812'>
         DO ICE=1,ICEMAX<a name='813'>
             FF3R(KR)=FF3R(KR)+FF2R(KR,ICE)<a name='814'>
             FF2R(KR,ICE)=0.<a name='815'>
         ENDDO<a name='816'>
         FF4R(KR)=FF4R(KR)+FF5R(KR)<a name='817'>
         FF5R(KR)=0.<a name='818'>
        END DO<a name='819'>
<font color=#447700>!      do kr=1,nkr<a name='820'></font>
<font color=#447700>!       if (ff4r(kr).lt.0)then<a name='821'></font>
<font color=#447700>!        print*,'i,k,j = ',i,k,j<a name='822'></font>
<font color=#447700>!        print*,'ff4r 3 = ',ff4r(kr)<a name='823'></font>
<font color=#447700>!       end if<a name='824'></font>
<font color=#447700>!       end do<a name='825'></font>
        IF (T_OLD(I,K,J).GT.233)THEN     <a name='826'>
         TT=T_OLD(I,K,J)<a name='827'>
         QQ=QV_OLD(I,K,J)<a name='828'>
         IF (QQ.LE.0)  call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_805">("WARNING : SBM FAST: QQ &lt; 0")<a name='829'>
         IF (QQ.LE.0)QQ=1.D-10<a name='830'>
         PP=pcgs(I,K,J)<a name='831'>
         TTA=T_NEW(I,K,J)<a name='832'>
         QQA=QV(I,K,J)<a name='833'>
         IF (QQA.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_806">("WARNING : SBM FAST: QQA &lt; 0")<a name='834'>
    <font color=#447700>!     IF (QQA.LE.0)print*,'QQA = ',qqa<a name='835'></font>
    <font color=#447700>!     IF (QQA.LE.0)print*,'i,k,j = ',i,k,j<a name='836'></font>
    <font color=#447700>!     IF (QQA.LE.0)print*,'tta = ',tta<a name='837'></font>
    <font color=#447700>!     IF (QQA.LE.0)print*,'tt = ',tt<a name='838'></font>
    <font color=#447700>!     IF (QQA.LE.0)print*,'qq = ',qq<a name='839'></font>
         IF (QQA.LE.0)QQA=1.D-10<a name='840'>
         ES1N=AA1_MY*DEXP(-BB1_MY/TT)<a name='841'>
         ES2N=AA2_MY*DEXP(-BB2_MY/TT)<a name='842'>
         EW1N=QQ*PP/(0.622+0.378*QQ)<a name='843'>
         DIV1=EW1N/ES1N<a name='844'>
<font color=#447700>!     if(i.eq.64.and.j.eq.2.and.k.eq.16)then<a name='845'></font>
<font color=#447700>!        print*,'T_NEW(I,K,J) = ',T_NEW(I,K,J)<a name='846'></font>
<font color=#447700>!        print*,'tt = ',tt<a name='847'></font>
<font color=#447700>!        print*,'qq = ',qq<a name='848'></font>
<font color=#447700>!        print*,'tta = ',tta<a name='849'></font>
<font color=#447700>!        print*,'qqa = ',qqa<a name='850'></font>
<font color=#447700>!        print*,'ES1N = ',ES1N<a name='851'></font>
<font color=#447700>!        print*,'ES2N = ',ES2N<a name='852'></font>
<font color=#447700>!        print*,'EW1N = ',EW1N<a name='853'></font>
<font color=#447700>!        print*,'DIV1 = ',DIV1<a name='854'></font>
<font color=#447700>!        print*,'pp = ',pp<a name='855'></font>
<font color=#447700>!        print*,'zcgs = ',zcgs(i,k,j)<a name='856'></font>
<font color=#447700>!     end if<a name='857'></font>
<a name='858'>
         DEL1IN=EW1N/ES1N-1.<a name='859'>
         DIV2=EW1N/ES2N<a name='860'>
         DEL2IN=EW1N/ES2N-1.<a name='861'>
         ES1N=AA1_MY*DEXP(-BB1_MY/TTA)<a name='862'>
         ES2N=AA2_MY*DEXP(-BB2_MY/TTA)<a name='863'>
         EW1N=QQA*PP/(0.622+0.378*QQA)<a name='864'>
         DIV3=EW1N/ES1N<a name='865'>
         DEL1AD=EW1N/ES1N-1.<a name='866'>
         DIV4=EW1N/ES2N<a name='867'>
         DEL2AD=EW1N/ES2N-1.<a name='868'>
         SUP2_OLD=DEL2IN<a name='869'>
         DELSUP1=(DEL1AD-DEL1IN)/NCOND<a name='870'>
         DELSUP2=(DEL2AD-DEL2IN)/NCOND<a name='871'>
         DELDIV1=(DIV3-DIV1)/NCOND<a name='872'>
         DELDIV2=(DIV4-DIV2)/NCOND<a name='873'>
         DELTATEMP=0<a name='874'>
         DELTAQ=0<a name='875'>
         tt_old = TT<a name='876'>
         qq_old = qq<a name='877'>
<font color=#447700>!     if (i.eq.43.and.k.eq.6.and.j.eq.41)then<a name='878'></font>
<font color=#447700>!      print*,'here 4'<a name='879'></font>
<font color=#447700>!     end if<a name='880'></font>
         DIFFU=1<a name='881'>
         DO IKL=1,NCOND<a name='882'>
          IF (DIFFU.NE.0)THEN<a name='883'>
          DEL1IN=DEL1IN+DELSUP1<a name='884'>
          DEL2IN=DEL2IN+DELSUP2<a name='885'>
          DIV1=DIV1+DELDIV1<a name='886'>
          DIV2=DIV2+DELDIV2<a name='887'>
          END IF<a name='888'>
<font color=#447700>!959       format (' ',i3,1x,f7.1,1x,f6.1,1x,f6.4,1x,f6.2,1x,f6.3)<a name='889'></font>
          IF (DIV1.GT.DIV2.AND.TT.LE.265)THEN<a name='890'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_731">("fatal error in module_mp_fast_sbm (DIV1&gt;DIV2), model stop")<a name='891'>
           DIFFU=0<a name='892'>
          END IF<a name='893'>
          IF (DIFFU.NE.0)THEN<a name='894'>
          DEL1NR=A1_MYN*(100.*DIV1)<a name='895'>
          DEL2NR=A2_MYN*(100.*DIV2)<a name='896'>
 <font color=#447700>!         IF (DEL2NR.EQ.0) PRINT*,'DEL2NR = 0'<a name='897'></font>
          IF (DEL2NR.EQ.0)call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_732">("fatal error in module_mp_fast_sbm (DEL2NR.EQ.0), model stop")<a name='898'>
          DEL12R=DEL1NR/DEL2NR<a name='899'>
          DEL12RD=DEL12R**DEL_BBR<a name='900'>
          EW1PN=AA1_MY*100.*DIV1*DEL12RD/100.<a name='901'>
<font color=#447700>!          IF (DEL12R.EQ.0)PRINT*,'DEL12R = 0'<a name='902'></font>
          IF (DEL12R.EQ.0)call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_733">("fatal error in module_mp_fast_sbm (DEL12R.EQ.0), model stop")<a name='903'>
          TT=-DEL_BB/DLOG(DEL12R)<a name='904'>
          QQ=0.622*EW1PN/(PP-0.378*EW1PN)<a name='905'>
          DO KR=1,NKR<a name='906'>
            FF1IN(KR)=FF1R(KR)<a name='907'>
            DO ICE=1,ICEMAX<a name='908'>
             FF2IN(KR,ICE)=FF2R(KR,ICE)<a name='909'>
            ENDDO<a name='910'>
          ENDDO<a name='911'>
          IF (BULKNUC.eq.1)THEN<a name='912'>
            IF (DEL1IN.GT.0)THEN<a name='913'>
              IF (zcgs(I,K,J).LE.500.E2)THEN<a name='914'>
                FACTZ=0.<a name='915'>
              ELSE<a name='916'>
                FACTZ=1<a name='917'>
<font color=#447700>!               FACTZ=EXP(-(zcgs(I,K,J)-2.E5)/Z0IN)<a name='918'></font>
              END IF<a name='919'>
             CONCCCN_XZ=FACTZ*ACCN*(100.*DEL1IN)**BCCN<a name='920'>
<a name='921'>
             CONCDROP=0.D0<a name='922'>
<a name='923'>
             DO KR=1,NKR<a name='924'>
               CONCDROP=CONCDROP+FF1IN(KR)*XL(KR)<a name='925'>
             ENDDO<a name='926'>
<a name='927'>
             CONCDROP=CONCDROP*3.D0*COL<a name='928'>
             IF(CONCCCN_XZ.GT.CONCDROP) &amp;<a name='929'>
     &amp;       FF1IN(1)=FF1IN(1)+(CONCCCN_XZ-CONCDROP)/(3.D0*COL*XL(1))<a name='930'>
            END IF<a name='931'>
          ELSE<a name='932'>
            IF(DEL1IN.GT.0.OR.DEL2IN.GT.0)THEN<a name='933'>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01'>JERNUCL01</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNUCL01_1">(FF1IN,FF2IN,FCCN &amp;<a name='934'>
     &amp;       ,XL,XI,TT,QQ &amp;<a name='935'>
     &amp;       ,rhocgs(I,K,J),pcgs(I,K,J) &amp;<a name='936'>
     &amp;       ,DEL1IN,DEL2IN &amp;<a name='937'>
     &amp;       ,COL,AA1_MY, BB1_MY, AA2_MY,BB2_MY &amp;<a name='938'>
     &amp;       ,C1_MEY,C2_MEY,SUP2_OLD,DSUPICE_XYZ(I,K,J) &amp;<a name='939'>
     &amp;       ,RCCN,DROPRADII,NKR,ICEMAX,ICEPROCS)<a name='940'>
            END IF<a name='941'>
          END IF<a name='942'>
          DO KR=1,NKR<a name='943'>
            DO ICE=1,ICEMAX<a name='944'>
             FF3R(KR)=FF3R(KR)+FF2IN(KR,ICE)<a name='945'>
             FF2IN(KR,ICE)=0.<a name='946'>
             FF2R(KR,ICE)=0.<a name='947'>
            END DO<a name='948'>
          END DO<a name='949'>
          DO KR=1,NKR<a name='950'>
            FF1R(KR)=FF1IN(KR)<a name='951'>
<font color=#447700>!           DO ICE=1,ICEMAX<a name='952'></font>
<font color=#447700>!            FF2R(KR,ICE)=FF2IN(KR,ICE)<a name='953'></font>
<font color=#447700>!           ENDDO<a name='954'></font>
          ENDDO<a name='955'>
          FMAX1=0.<a name='956'>
          FMAX2=0.<a name='957'>
          FMAX3=0.<a name='958'>
          FMAX4=0.<a name='959'>
          FMAX5=0.<a name='960'>
          DO KR=1,NKR<a name='961'>
            FF1IN(KR)=FF1R(KR)<a name='962'>
            FMAX1=AMAX1(FF1R(KR),FMAX1)<a name='963'>
            FF3IN(KR)=FF3R(KR)<a name='964'>
            FMAX3=AMAX1(FF3R(KR),FMAX3)<a name='965'>
            FF4IN(KR)=FF4R(KR)<a name='966'>
            FMAX4=AMAX1(FF4R(KR),FMAX4)<a name='967'>
            FF5IN(KR)=FF5R(KR)<a name='968'>
            FMAX5=AMAX1(FF5R(KR),FMAX5)<a name='969'>
            DO ICE=1,ICEMAX<a name='970'>
             FF2IN(KR,ICE)=FF2R(KR,ICE)<a name='971'>
             FMAX2=AMAX1(FF2R(KR,ICE),FMAX2)<a name='972'>
            END DO<a name='973'>
          END DO<a name='974'>
          ISYM1=0<a name='975'>
          ISYM2=0<a name='976'>
          ISYM3=0<a name='977'>
          ISYM4=0<a name='978'>
          ISYM5=0<a name='979'>
          IF(FMAX1.GT.0)ISYM1=1<a name='980'>
          IF (ICEPROCS.EQ.1)THEN<a name='981'>
           IF(FMAX2.GT.1.E-4)ISYM2=1<a name='982'>
           IF(FMAX3.GT.1.E-4)ISYM3=1<a name='983'>
           IF(FMAX4.GT.1.E-4)ISYM4=1<a name='984'>
           IF(FMAX5.GT.1.E-4)ISYM5=1<a name='985'>
          END IF<a name='986'>
<font color=#447700>! Avoid Diffusional Growth<a name='987'></font>
<font color=#447700>!         IF (T_OLD(I,K,J).GE.237)THEN     <a name='988'></font>
<font color=#447700>! Same temperature range as above.<a name='989'></font>
          IF (T_OLD(I,K,J).GT.233)THEN     <a name='990'>
          IF(ISYM1.EQ.1.AND.((TT-273.15).GT.-0.187.OR. &amp;<a name='991'>
     &amp;     (ISYM2.EQ.0.AND. &amp;<a name='992'>
     &amp;     ISYM3.EQ.0.AND.ISYM4.EQ.0.AND.ISYM5.EQ.0)))THEN<a name='993'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1'>ONECOND1</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND1_1">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='994'>
     &amp;      ,VR1,pcgs(I,K,J) &amp;<a name='995'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='996'>
     &amp;      ,FF1R,FF1IN,XL,RLEC,RO1BL &amp;<a name='997'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='998'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='999'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR)<a name='1000'>
          ELSE IF(ISYM1.EQ.0.AND.(TT-273.15).LE.-0.187.AND. &amp;<a name='1001'>
     &amp;     (ISYM2.EQ.1.OR.ISYM3.EQ.1.OR.ISYM4.EQ.1.OR.ISYM5.EQ.1))THEN<a name='1002'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2'>ONECOND2</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND2_1">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='1003'>
     &amp;      ,VR2,VR3,VR4,VR5,pcgs(I,K,J) &amp;<a name='1004'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='1005'>
     &amp;      ,FF2R,FF2IN,XI,RIEC,RO2BL &amp;<a name='1006'>
     &amp;      ,FF3R,FF3IN,XS,RSEC,RO3BL &amp;<a name='1007'>
     &amp;      ,FF4R,FF4IN,XG,RGEC,RO4BL &amp;<a name='1008'>
     &amp;      ,FF5R,FF5IN,XH,RHEC,RO5BL &amp;<a name='1009'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='1010'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='1011'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR &amp;<a name='1012'>
     &amp;      ,ISYM2,ISYM3,ISYM4,ISYM5)<a name='1013'>
          ELSE IF(ISYM1.EQ.1.AND.(TT-273.15).LE.-0.187.AND. &amp;<a name='1014'>
     &amp;     (ISYM2.EQ.1.OR.ISYM3.EQ.1.OR.ISYM4.EQ.1 &amp;<a name='1015'>
     &amp;     .OR.ISYM5.EQ.1))THEN<a name='1016'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3'>ONECOND3</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ONECOND3_1">(TT,QQ,PP,rhocgs(I,K,J) &amp;<a name='1017'>
     &amp;      ,VR1,VR2,VR3,VR4,VR5,pcgs(I,K,J) &amp;<a name='1018'>
     &amp;      ,DEL1IN,DEL2IN,DIV1,DIV2 &amp;<a name='1019'>
     &amp;      ,FF1R,FF1IN,XL,RLEC,RO1BL &amp;<a name='1020'>
     &amp;      ,FF2R,FF2IN,XI,RIEC,RO2BL &amp;<a name='1021'>
     &amp;      ,FF3R,FF3IN,XS,RSEC,RO3BL &amp;<a name='1022'>
     &amp;      ,FF4R,FF4IN,XG,RGEC,RO4BL &amp;<a name='1023'>
     &amp;      ,FF5R,FF5IN,XH,RHEC,RO5BL &amp;<a name='1024'>
     &amp;      ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='1025'>
     &amp;      ,C1_MEY,C2_MEY &amp;<a name='1026'>
     &amp;      ,COL,DTCOND,ICEMAX,NKR &amp;<a name='1027'>
     &amp;      ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5)<a name='1028'>
          END IF<a name='1029'>
          DO KR=1,NKR<a name='1030'>
            DO ICE=1,ICEMAX<a name='1031'>
             FF3R(KR)=FF3R(KR)+FF2R(KR,ICE)<a name='1032'>
             FF2R(KR,ICE)=0<a name='1033'>
            END DO<a name='1034'>
            FF4R(KR)=FF4R(KR)+FF5R(KR)<a name='1035'>
            FF5R(KR)=0<a name='1036'>
          END DO<a name='1037'>
          END IF<a name='1038'>
          END IF<a name='1039'>
             IF (IKL.EQ.NCOND)CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW'>COAL_BOTT_NEW</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COAL_BOTT_NEW_1">(FF1R,FF2R,FF3R, &amp;<a name='1040'>
     &amp;       FF4R,FF5R,TT,QQ,PP,rhocgs(I,K,J),dt_coll,TCRIT,TTCOAL)<a name='1041'>
         END DO<a name='1042'>
         IF (DIFFU.EQ.0)THEN<a name='1043'>
         th_phy(i,k,j) = tt_old/pi_phy(i,k,j)<a name='1044'>
         qv(i,k,j)=qq_old<a name='1045'>
    <font color=#447700>!     print*,'tt_old = ',tt_old<a name='1046'></font>
    <font color=#447700>!     print*,'qq_old = ',qq_old<a name='1047'></font>
         ELSE<a name='1048'>
         th_phy(i,k,j) = tt/pi_phy(i,k,j)<a name='1049'>
         qv(i,k,j)=qq<a name='1050'>
         END IF<a name='1051'>
        END IF<a name='1052'>
<font color=#447700>! LIQIUD<a name='1053'></font>
        IF (REMSAT.EQ.1)THEN<a name='1054'>
        DO KR=1,NKR<a name='1055'>
         FF1R(KR)=0.<a name='1056'>
         FCCN(KR)=0<a name='1057'>
         IF (ICEPROCS.EQ.1)THEN<a name='1058'>
          FF2R(KR,1)=0.<a name='1059'>
          FF2R(KR,2)=0.<a name='1060'>
          FF2R(KR,3)=0.<a name='1061'>
          FF3R(KR)=0.<a name='1062'>
          FF4R(KR)=0.<a name='1063'>
          FF5R(KR)=0.<a name='1064'>
         END IF<a name='1065'>
        END DO<a name='1066'>
        END IF<a name='1067'>
        KRR=0<a name='1068'>
        DO KR=p_ff1i01,p_ff1i33<a name='1069'>
          KRR=KRR+1<a name='1070'>
          chem_new(I,K,J,KR)=FF1R(KRR)<a name='1071'>
        END DO   <a name='1072'>
<font color=#447700>! CCN<a name='1073'></font>
        KRR=0<a name='1074'>
        DO KR=p_ff8i01,p_ff8i33<a name='1075'>
          KRR=KRR+1<a name='1076'>
<font color=#447700>!         chem_new(I,K,J,KR)=FCCN(KRR)<a name='1077'></font>
<font color=#447700>!         chem_new(I,K,J,KR)=FCCN(KRR)/RHOCGS(I,K,J)*XCCN(KRR)<a name='1078'></font>
          chem_new(I,K,J,KR)=FCCN(KRR)<a name='1079'>
        END DO<a name='1080'>
        IF (ICEPROCS.EQ.1)THEN<a name='1081'>
         KRR=0<a name='1082'>
         DO KR=p_ff5i01,p_ff5i33<a name='1083'>
          KRR=KRR+1<a name='1084'>
<font color=#447700>!         chem_new(I,K,J,KR)=FF3R(KRR)<a name='1085'></font>
<font color=#447700>!         chem_new(I,K,J,KR)=FF3R(KRR)*(1./RHOCGS(I,K,J))*COL*XS(KRR)*XS(KRR)*3<a name='1086'></font>
          chem_new(I,K,J,KR)=FF3R(KRR)<a name='1087'>
         END DO<a name='1088'>
<font color=#447700>! Graupel<a name='1089'></font>
         KRR=0<a name='1090'>
         DO KR=p_ff6i01,p_ff6i33<a name='1091'>
          KRR=KRR+1<a name='1092'>
<font color=#447700>!         chem_new(I,K,J,KR)=FF4R(KRR)<a name='1093'></font>
<font color=#447700>!         chem_new(I,K,J,KR)=FF4R(KRR)*(1./RHOCGS(I,K,J))*COL*XG(KRR)*XG(KRR)*3<a name='1094'></font>
          chem_new(I,K,J,KR)=FF4R(KRR)<a name='1095'>
         END DO<a name='1096'>
        END IF<a name='1097'>
      END DO<a name='1098'>
      END DO<a name='1099'>
      END DO<a name='1100'>
      NKRO=1<a name='1101'>
      NKRE=NKR<a name='1102'>
      DO j = jts,jte<a name='1103'>
      DO i = its,ite<a name='1104'>
      DO k = kts,kte<a name='1105'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1106'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1107'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1108'>
      krr=0<a name='1109'>
      do kr=p_ff1i01,p_ff1i33<a name='1110'>
       krr=krr+1<a name='1111'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1112'>
      end do<a name='1113'>
      end do<a name='1114'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_1">(ffx_z,VR1,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1115'>
      DO k = kts,kte<a name='1116'>
      krr=0<a name='1117'>
      do kr=p_ff1i01,p_ff1i33<a name='1118'>
       krr=krr+1<a name='1119'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1120'>
      end do<a name='1121'>
      end do<a name='1122'>
      if (iceprocs.eq.1)then<a name='1123'>
      DO k = kts,kte<a name='1124'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1125'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1126'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1127'>
      krr=0<a name='1128'>
      do kr=p_ff5i01,p_ff5i33<a name='1129'>
       krr=krr+1<a name='1130'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1131'>
      end do<a name='1132'>
      end do<a name='1133'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_2">(ffx_z,VR3,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1134'>
      DO k = kts,kte<a name='1135'>
      krr=0<a name='1136'>
      do kr=p_ff5i01,p_ff5i33<a name='1137'>
       krr=krr+1<a name='1138'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1139'>
      end do<a name='1140'>
      end do<a name='1141'>
      DO k = kts,kte<a name='1142'>
      rhocgs_z(k)=rhocgs(i,k,j)<a name='1143'>
      pcgs_z(k)=pcgs(i,k,j)<a name='1144'>
      zcgs_z(k)=zcgs(i,k,j)<a name='1145'>
      krr=0<a name='1146'>
      do kr=p_ff6i01,p_ff6i33<a name='1147'>
       krr=krr+1<a name='1148'>
       ffx_z(k,krr)=chem_new(i,k,j,kr)/rhocgs(i,k,j)<a name='1149'>
      end do<a name='1150'>
      end do<a name='1151'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM'>FALFLUXHUCM</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FALFLUXHUCM_3">(ffx_z,VR4,RHOCGS_z,PCGS_z,ZCGS_z,DT,kts,kte,nkr)<a name='1152'>
      DO k = kts,kte<a name='1153'>
      krr=0<a name='1154'>
      do kr=p_ff6i01,p_ff6i33<a name='1155'>
       krr=krr+1<a name='1156'>
       chem_new(i,k,j,kr)=ffx_z(k,krr)*rhocgs(i,k,j)<a name='1157'>
      end do<a name='1158'>
      end do<a name='1159'>
<font color=#447700>!    &amp;     ims,ime,jms,jme,kms,kme)<a name='1160'></font>
      end if<a name='1161'>
     end do <a name='1162'>
     end do <a name='1163'>
<a name='1164'>
      gmax=0<a name='1165'>
      qmax=0<a name='1166'>
      imax=0<a name='1167'>
      kmax=0<a name='1168'>
      qnmax=0<a name='1169'>
      inmax=0<a name='1170'>
      knmax=0<a name='1171'>
      DO j = jts,jte<a name='1172'>
      DO i = its,ite<a name='1173'>
      DO k = kts,kte<a name='1174'>
      QC(I,K,J)=0<a name='1175'>
      QR(I,K,J)=0<a name='1176'>
<font color=#447700>!     QI(I,K,J)=0<a name='1177'></font>
<font color=#447700>!     QIC(I,K,J)=0<a name='1178'></font>
<font color=#447700>!     QIP(I,K,J)=0<a name='1179'></font>
<font color=#447700>!     QID(I,K,J)=0<a name='1180'></font>
      QI(I,K,J)=0<a name='1181'>
      QS(I,K,J)=0<a name='1182'>
      QG(I,K,J)=0<a name='1183'>
      QNC(I,K,J)=0<a name='1184'>
      QNR(I,K,J)=0<a name='1185'>
      QNS(I,K,J)=0<a name='1186'>
      QNG(I,K,J)=0<a name='1187'>
      QNA(I,K,J)=0<a name='1188'>
<font color=#447700>!     EFFR(I,K,J)=0<a name='1189'></font>
<font color=#447700>!     if (mod(itimestep,t_print).eq.0)then<a name='1190'></font>
      tt= th_phy(i,k,j)*pi_phy(i,k,j)<a name='1191'>
      DO KR=1,NKR<a name='1192'>
      COLREFLL(KR)=COEFREFLL<a name='1193'>
      COLREFLI(KR)=COEFREFLI<a name='1194'>
        IF(TT.GE.271.15.AND.TT.LE.273.15) THEN<a name='1195'>
               COLREFLS(KR)=COEFREF00/0.09<a name='1196'>
               COLREFLG(KR)=COEFREF00/RO4BL(KR)/RO4BL(KR)<a name='1197'>
               COLREFLH(KR)=COEFREF00/RO5BL(KR)/RO5BL(KR)<a name='1198'>
        ELSE<a name='1199'>
               COLREFLS(KR)=COEFREFLI<a name='1200'>
               COLREFLG(KR)=COEFREFLI<a name='1201'>
               COLREFLH(KR)=COEFREFLI<a name='1202'>
        ENDIF<a name='1203'>
      END DO<a name='1204'>
<font color=#447700>!     END IF<a name='1205'></font>
      EFF_N=0.<a name='1206'>
      EFF_D=0.<a name='1207'>
      krr=0<a name='1208'>
      DO kr= p_ff1i01,p_ff1i33<a name='1209'>
          KRR=KRR+1<a name='1210'>
        IF (KRR.LT.KRDROP)THEN<a name='1211'>
          EFF_N=DROPRADII(KRR)**3*chem_new(i,k,j,KR)*XL(KRR)+EFF_N<a name='1212'>
          EFF_D=DROPRADII(KRR)**2*chem_new(i,k,j,KR)*XL(KRR)+EFF_D<a name='1213'>
          QC(I,K,J)=QC(I,K,J) &amp;<a name='1214'>
     &amp;      +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XL(KRR)*XL(KRR)*3<a name='1215'>
<font color=#447700>!          QNC(I,K,J)=QNC(I,K,J) &amp;<a name='1216'></font>
<font color=#447700>! J. Fan<a name='1217'></font>
<font color=#447700>!     &amp;      +COL*chem_new(I,K,J,KR)*XL(KR)*3<a name='1218'></font>
           QNC(I,K,J)=QNC(I,K,J) &amp;<a name='1219'>
    &amp;       +COL*chem_new(I,K,J,KR)*XL(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg<a name='1220'></font>
        ELSE<a name='1221'>
          QR(I,K,J)=QR(I,K,J) &amp;<a name='1222'>
     &amp;      +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XL(KRR)*XL(KRR)*3<a name='1223'>
          QNR(I,K,J)=QNR(I,K,J) &amp;<a name='1224'>
     &amp;      +COL*chem_new(I,K,J,KR)*XL(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1225'></font>
        END IF<a name='1226'>
      END DO<a name='1227'>
<font color=#447700>!     IF(QC(I,K,J).GT.1.E-6.and.EFF_D.GT.0)THEN<a name='1228'></font>
<font color=#447700>!         EFFR(I,K,J)=EFF_N/EFF_D<a name='1229'></font>
<font color=#447700>!     END IF<a name='1230'></font>
      KRR=0<a name='1231'>
      IF (ICEPROCS.EQ.1)THEN<a name='1232'>
       KRR=0<a name='1233'>
       DO  KR=p_ff5i01,p_ff5i33<a name='1234'>
        KRR=KRR+1<a name='1235'>
        if (KRR.LE.KRICE)THEN<a name='1236'>
        QI(I,K,J)=QI(I,K,J) &amp;<a name='1237'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XS(KRR)*XS(KRR)*3<a name='1238'>
        ELSE<a name='1239'>
        QS(I,K,J)=QS(I,K,J) &amp;<a name='1240'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XS(KRR)*XS(KRR)*3<a name='1241'>
        END IF<a name='1242'>
        QNS(I,K,J)=QNS(I,K,J) &amp;<a name='1243'>
<font color=#447700>!     &amp;   +1000*COL*chem_new(I,K,J,KR)*XS(KRR)*3<a name='1244'></font>
     &amp;   +COL*chem_new(I,K,J,KR)*XS(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1245'></font>
       END DO<a name='1246'>
       KRR=0<a name='1247'>
       DO  KR=p_ff6i01,p_ff6i33<a name='1248'>
        KRR=KRR+1<a name='1249'>
        QG(I,K,J)=QG(I,K,J) &amp;<a name='1250'>
     &amp;   +(1./RHOCGS(I,K,J))*COL*chem_new(I,K,J,KR)*XG(KRR)*XG(KRR)*3<a name='1251'>
        QNG(I,K,J)=QNG(I,K,J) &amp;<a name='1252'>
<font color=#447700>!     &amp;   +1000*COL*chem_new(I,K,J,KR)*XG(KRR)*3<a name='1253'></font>
     &amp;   +COL*chem_new(I,K,J,KR)*XG(KRR)*3/rhocgs(I,K,J)*1000. <font color=#447700>! #/kg by Fan<a name='1254'></font>
       END DO<a name='1255'>
      END IF<a name='1256'>
       KRR=0<a name='1257'>
       DO  KR=p_ff8i01,p_ff8i33<a name='1258'>
        KRR=KRR+1<a name='1259'>
        QNA(I,K,J)=QNA(I,K,J) &amp;<a name='1260'>
<font color=#447700>!     &amp;   +COL*chem_new(I,K,J,KR)*3<a name='1261'></font>
<font color=#447700>!  change by J.Fan<a name='1262'></font>
     &amp;   +COL*chem_new(I,K,J,KR)/rhocgs(I,K,J)*1000.   <font color=#447700>! #/kg<a name='1263'></font>
       END DO<a name='1264'>
<a name='1265'>
      END DO<a name='1266'>
      END DO<a name='1267'>
      END DO<a name='1268'>
<a name='1269'>
<a name='1270'>
<a name='1271'>
998   format(' ',10(f10.1,1x))<a name='1272'>
      DO j = jts,jte<a name='1273'>
      DO i = its,ite<a name='1274'>
       krr=0<a name='1275'>
       RAINNCV(I,J)=0.<a name='1276'>
       SNOWNCV(I,J)=0.<a name='1277'>
       GRAUPELNCV(I,J)=0.<a name='1278'>
       DO KR=p_ff1i01,p_ff1i33<a name='1279'>
        krr=krr+1<a name='1280'>
        DELTAW=VR1(KRR)<a name='1281'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1282'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1283'>
     &amp;           chem_new(I,1,J,KR)*XL(KRR)*XL(KRR)<a name='1284'>
        RAINNCV(I,J)= RAINNCV(I,J) &amp;<a name='1285'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1286'>
     &amp;           chem_new(I,1,J,KR)*XL(KRR)*XL(KRR)<a name='1287'>
       END DO<a name='1288'>
       KRR=0<a name='1289'>
       DO KR= p_ff5i01,p_ff5i33<a name='1290'>
        KRR=KRR+1<a name='1291'>
        DELTAW=VR3(KRR)<a name='1292'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1293'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1294'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1295'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1296'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1297'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1298'>
        SNOWNC(I,J)=SNOWNC(I,J) &amp;<a name='1299'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1300'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1301'>
        SNOWNCV(I,J)= SNOWNCV(I,J) &amp;<a name='1302'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1303'>
     &amp;           chem_new(I,1,J,KR)*XS(KRR)*XS(KRR)<a name='1304'>
       END DO<a name='1305'>
       KRR=0<a name='1306'>
       DO KR=p_ff6i01,p_ff6i33<a name='1307'>
        KRR=KRR+1<a name='1308'>
        DELTAW=VR4(KRR)<a name='1309'>
        RAINNC(I,J)=RAINNC(I,J) &amp;<a name='1310'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1311'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1312'>
        RAINNCV(I,J)=RAINNCV(I,J) &amp;<a name='1313'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1314'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1315'>
        GRAUPELNC(I,J)=GRAUPELNC(I,J) &amp;<a name='1316'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1317'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1318'>
        GRAUPELNCV(I,J)= GRAUPELNCV(I,J) &amp;<a name='1319'>
     &amp;  +10*(3./RO1BL(KRR))*COL*DT*DELTAW* &amp;<a name='1320'>
     &amp;           chem_new(I,1,J,KR)*XG(KRR)*XG(KRR)<a name='1321'>
       END DO<a name='1322'>
      do k=kts,kte<a name='1323'>
<a name='1324'>
<a name='1325'>
          qv1d(k)=qv(i,k,j)<a name='1326'>
          qr1d(k)=qr(i,k,j)<a name='1327'>
          nr1d(k)=qnr(i,k,j)<a name='1328'>
          qs1d(k)=qs(i,k,j)<a name='1329'>
          ns1d(k)=qns(i,k,j)<a name='1330'>
          qg1d(k)=qg(i,k,j)<a name='1331'>
          ng1d(k)=qng(i,k,j)<a name='1332'>
          t1d(k)=th_phy(i,k,j)*pi_phy(i,k,j)<a name='1333'>
          p1d(k)=P_PHY(I,K,J)<a name='1334'>
       end do<a name='1335'>
<font color=#447700>! wrf-chem<a name='1336'></font>
<a name='1337'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='1338'></font>
         IF ( PRESENT (diagflag) ) THEN<a name='1339'>
         if (diagflag .and. do_radar_ref == 1) then<a name='1340'>
          call <A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM'>refl10cm_hm</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_SBM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REFL10CM_HM_1"> (qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d,   &amp;<a name='1341'>
                      t1d, p1d, dBZ, kts, kte, i, j)<a name='1342'>
          do k = kts, kte<a name='1343'>
             refl_10cm(i,k,j) = MAX(-35., dBZ(k))<a name='1344'>
          enddo<a name='1345'>
         endif<a name='1346'>
         ENDIF<a name='1347'>
         SR(I,J) = (SNOWNCV(I,J)+GRAUPELNCV(I,J))/(RAINNCV(I,J)+1.e-12)<a name='1348'>
<a name='1349'>
<font color=#447700>!     print*, i,j,rainnc(i,j)<a name='1350'></font>
      END DO<a name='1351'>
      END DO<a name='1352'>
<a name='1353'>
<a name='1354'>
      do j=jts,jte<a name='1355'>
      do k=kts,kte<a name='1356'>
      do i=its,ite<a name='1357'>
         th_old(i,k,j)=th_phy(i,k,j)<a name='1358'>
         qv_old(i,k,j)=qv(i,k,j)<a name='1359'>
      end do<a name='1360'>
      end do<a name='1361'>
      end do<a name='1362'>
      if (conserv)then<a name='1363'>
      DO j = jts,jte<a name='1364'>
      DO i = its,ite<a name='1365'>
      DO k = kts,kte<a name='1366'>
      rhocgs(I,K,J)=rho_phy(I,K,J)*0.001<a name='1367'>
      krr=0<a name='1368'>
      DO KR=p_ff1i01,p_ff1i33<a name='1369'>
        krr=krr+1<a name='1370'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XL(KRR)*XL(KRR)*3.0<a name='1371'>
      END DO<a name='1372'>
      KRR=0<a name='1373'>
      DO KR=p_ff5i01,p_ff5i33<a name='1374'>
       KRR=KRR+1<a name='1375'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XS(KRR)*XS(KRR)*3.0<a name='1376'>
      END DO<a name='1377'>
      KRR=0<a name='1378'>
      DO KR=p_ff6i01,p_ff6i33<a name='1379'>
       KRR=KRR+1<a name='1380'>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*COL*XG(KRR)*XG(KRR)*3.0<a name='1381'>
      END DO<a name='1382'>
      KRR=0<a name='1383'>
      DO KR=p_ff8i01,p_ff8i33<a name='1384'>
       KRR=KRR+1<a name='1385'>
<font color=#447700>! change by Fan<a name='1386'></font>
<font color=#447700>!       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*XCCN(KRR)<a name='1387'></font>
       chem_new(I,K,J,KR)=chem_new(I,K,J,KR)/RHOCGS(I,K,J)*1000.          <font color=#447700>! #/kg; remember chem_new for CCN is #/cm3, not #/(gcm-3)<a name='1388'></font>
      END DO<a name='1389'>
      END DO<a name='1390'>
      END DO<a name='1391'>
      END DO<a name='1392'>
      END IF<a name='1393'>
     <a name='1394'>
      RETURN<a name='1395'>
  END SUBROUTINE FAST_SBM<a name='1396'>
<A NAME='FALFLUXHUCM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FALFLUXHUCM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1397'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>FALFLUXHUCM</font>(chem_new,VR1,RHOCGS,PCGS,ZCGS,DT, &amp; <A href='../../call_to/FALFLUXHUCM.html' TARGET='index'>10</A>,<A href='../../call_from/FALFLUXHUCM.html' TARGET='index'>2</A><a name='1398'>
     &amp;     kts,kte,nkr)<a name='1399'>
      IMPLICIT NONE<a name='1400'>
      INTEGER I,J,K,KR<a name='1401'>
      INTEGER    kts,kte,nkr<a name='1402'>
      REAL TFALL,DTFALL,VFALL(KTE),DWFLUX(KTE)<a name='1403'>
      REAL DT<a name='1404'>
      INTEGER IFALL,N,NSUB<a name='1405'>
      REAL, DIMENSION( kts:kte,nkr ) :: chem_new <a name='1406'>
      REAL,  DIMENSION(kts:kte) :: rhocgs,pcgs,zcgs<a name='1407'>
      REAL VR1(NKR)<a name='1408'>
<a name='1409'>
<font color=#447700>! FALLING FLUXES FOR EACH KIND OF CLOUD PARTICLES: C.G.S. UNIT<a name='1410'></font>
<font color=#447700>! ADAPTED FROM GSFC CODE FOR HUCM<a name='1411'></font>
<font color=#447700>!  The flux at k=1 is assumed to be the ground so FLUX(1) is the<a name='1412'></font>
<font color=#447700>! flux into the ground. DWFLUX(1) is at the lowest half level where<a name='1413'></font>
<font color=#447700>! Q(1) etc are defined. The formula for FLUX(1) uses Q(1) etc which<a name='1414'></font>
<font color=#447700>! is actually half a grid level above it. This is what is meant by<a name='1415'></font>
<font color=#447700>! an upstream method. Upstream in this case is above because the<a name='1416'></font>
<font color=#447700>! velocity is downwards.      <a name='1417'></font>
<font color=#447700>! USE UPSTREAM METHOD (VFALL IS POSITIVE)                 <a name='1418'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',pcgs(100,10,1)<a name='1419'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',pcgs(100,1,1)<a name='1420'></font>
<font color=#447700>!      read(5,*)<a name='1421'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',zcgs(100,10,1)<a name='1422'></font>
<font color=#447700>!        print*,'pcgs(i,k,j) = ',zcgs(100,1,1)<a name='1423'></font>
<font color=#447700>!      read(5,*)<a name='1424'></font>
      DO KR=1,NKR<a name='1425'>
       IFALL=0<a name='1426'>
       DO k = kts,kte<a name='1427'>
          IF(chem_new(K,KR).GE.1.E-10)IFALL=1<a name='1428'>
       END DO <a name='1429'>
       IF (IFALL.EQ.1)THEN<a name='1430'>
        TFALL=1.E10                <a name='1431'>
        DO K=kts,kte<a name='1432'>
         VFALL(K) = VR1(KR)*SQRT(1.E6/PCGS(K))<a name='1433'>
<font color=#447700>!        if (krr.eq.20.or.krr.eq.33)then<a name='1434'></font>
<font color=#447700>!        if (k.eq.5.or.k.eq.10.or.k.eq.20)then<a name='1435'></font>
<font color=#447700>!        print*,'vr1(krr) = ',krr,vr1(krr)<a name='1436'></font>
<font color=#447700>!        print*, 'SQRT(1.E6/PCGS(I,K,J)) = ',i,k,SQRT(1.E6/PCGS(I,K,J))<a name='1437'></font>
<font color=#447700>!        print*,'vfall(k) = ',i,k,vfall(k)<a name='1438'></font>
<font color=#447700>!        print*,'zcgs(k) = ',i,k,zcgs(i,k,j)<a name='1439'></font>
<font color=#447700>!        read(5,*)<a name='1440'></font>
<font color=#447700>!        end if<a name='1441'></font>
<font color=#447700>!        end if<a name='1442'></font>
         TFALL=AMIN1(TFALL,ZCGS(K)/(VFALL(K)+1.E-20))    <a name='1443'>
<font color=#447700>!        print*,'tfall = ',i,k,tfall<a name='1444'></font>
<font color=#447700>!        if (krr.eq.5.or.krr.eq.10.or.krr.eq.20.or.krr.eq.33)read(5,*)<a name='1445'></font>
        END DO                                                 <a name='1446'>
        IF(TFALL.GE.1.E10)call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#FALFLUXHUCM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_734">("fatal error in module_mp_fast_sbm (TFALL.GE.1.E10), model stop")<a name='1447'>
        NSUB=(INT(2.0*DT/TFALL)+1)                           <a name='1448'>
        DTFALL=DT/NSUB                                      <a name='1449'>
<a name='1450'>
        DO N=1,NSUB                                    <a name='1451'>
          DO K=KTS,KTE-1                               <a name='1452'>
           DWFLUX(K)=-(RHOCGS(K)*VFALL(K)*chem_new(k,kr)- &amp;<a name='1453'>
     &amp;     RHOCGS(K+1)* &amp;<a name='1454'>
     &amp;     VFALL(K+1)*chem_new(K+1,KR))/(RHOCGS(K)*(ZCGS(K+1)- &amp;<a name='1455'>
     &amp;      ZCGS(K)))    <a name='1456'>
          END DO    <a name='1457'>
<font color=#447700>! NO Z ABOVE TOP, SO USE THE SAME DELTAZ<a name='1458'></font>
          DWFLUX(KTE)=-(RHOCGS(KTE)*VFALL(KTE)* &amp; <a name='1459'>
     &amp;       chem_new(kte,kr))/(RHOCGS(KTE)*(ZCGS(KTE)-ZCGS(KTE-1)))         <a name='1460'>
          DO K=kts,kte                                         <a name='1461'>
           chem_new(k,kr)=chem_new(k,kr)+DWFLUX(K)*DTFALL<a name='1462'>
          END DO  <a name='1463'>
        END DO  <a name='1464'>
       END IF<a name='1465'>
      END DO  <a name='1466'>
      RETURN                                                                  <a name='1467'>
      END SUBROUTINE FALFLUXHUCM                                                                    <a name='1468'>
<A NAME='FAST_HUCMINIT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1469'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>FAST_HUCMINIT</font>(DT) <A href='../../call_to/FAST_HUCMINIT.html' TARGET='index'>1</A>,<A href='../../call_from/FAST_HUCMINIT.html' TARGET='index'>80</A><a name='1470'>
      IMPLICIT NONE<a name='1471'>
      INTEGER IKERN_0,IKERN_Z,L0_REAL,L0_INTEGER,INEWMEY,INEST<a name='1472'>
      INTEGER I,J,K,KR<a name='1473'>
      REAL DT<a name='1474'>
      INTEGER :: hujisbm_unit1<a name='1475'>
      LOGICAL, PARAMETER :: PRINT_diag=.FALSE.<a name='1476'>
      LOGICAL :: opened <a name='1477'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='1478'>
      CHARACTER*80 errmess<a name='1479'>
      REAL PI<a name='1480'>
      double precision ax<a name='1481'>
      data pi/3.141592654/<a name='1482'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='1483'></font>
<font color=#447700>! ax - coefficient used for masses calculation <a name='1484'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='1485'></font>
<a name='1486'>
        REAL C1(NKR,NKR)<a name='1487'>
<font color=#447700>! DON'T NEED ALL THESE VARIABLES: STILL NEED EDITING<a name='1488'></font>
       INTEGER ICE,KGRAN,IPRINT01<a name='1489'>
       REAL TWSIN,TWCIN,TWNUC,XF5,XF4,XF3,CONCHIN,CONCGIN,CONCSIN, &amp;<a name='1490'>
     &amp; CONCCLIN,TWHIN,RADH,RADS,RADG,RADL,CONCLIN,A1_MY,A2,A2_MY,XLK, &amp;<a name='1491'>
     &amp; A1N,A3_MY,A3,A1_MYN,R0CCN,X0DROP,DEG01,CONTCCNIN,CONCCCNIN, &amp;<a name='1492'>
     &amp; A,B,X0CCN,S_KR,RCCNKR,R0,X0,TWCALLIN,A1,RCCNKR_CM,SUMIIN,TWGIN, &amp;<a name='1493'>
     &amp; XF1N,XF1,WC1N,RF1N,WNUC,RNUC,WC5,RF5, &amp;<a name='1494'>
     &amp; WC4,RF4,WC3,RF3,WC1,RF1,SMAX<a name='1495'>
       REAL TWIIN(ICEMAX)<a name='1496'>
       REAL RO_SOLUTE      <a name='1497'>
       REAL A_FALL,B_FALL<a name='1498'>
       real graupel_fall(nkr)<a name='1499'>
       data graupel_fall/0.36840E-01,0.57471E-01,0.88417E-01,0.13999E+00,&amp;<a name='1500'>
     &amp;  0.22841E+00,0.36104E+00,0.56734E+00, 0.88417E+00, 0.13999E+01,&amp;<a name='1501'>
     &amp;  0.22104E+01, 0.35367E+01, 0.54524E+01, 0.81049E+01,0.12526E+02,&amp;<a name='1502'>
     &amp;  0.19157E+02, 0.27262E+02, 0.34627E+02, 0.39776E+02,0.45690E+02,&amp; <a name='1503'>
     &amp;  0.52485E+02, 0.60289E+02, 0.69254E+02, 0.10000E+03, 0.15429E+03,&amp;<a name='1504'>
     &amp;  0.18561E+03, 0.22329E+03, 0.26863E+03,  0.32316E+03,0.38877E+03,&amp; <a name='1505'>
     &amp;  0.46770E+03, 0.56266E+03, 0.67690E+03,  0.81432E+03/<a name='1506'>
<a name='1507'>
       PARAMETER (RO_SOLUTE=2.16)<a name='1508'>
       INTEGER KR_MIN,KR_MIN1,KR_MAX<a name='1509'>
       REAL RADCCN_MIN,RADCCN_MIN1,RADCCN_MAX<a name='1510'>
     REAL  ::      RHOSU       <font color=#447700>! STANDARD AIR DENSITY AT 850 MB<a name='1511'></font>
     REAL ::      RHOW        <font color=#447700>! DENSITY OF LIQUID WATER<a name='1512'></font>
     REAL ::      RHOI        <font color=#447700>! BULK DENSITY OF CLOUD ICE<a name='1513'></font>
     REAL ::      RHOSN       <font color=#447700>! BULK DENSITY OF SNOW<a name='1514'></font>
     REAL ::      RHOG        <font color=#447700>! BULK DENSITY OF GRAUPEL<a name='1515'></font>
     REAL ::      CI,DI,CS,DS,CG,DG <font color=#447700>! SIZE DISTRIBUTION PARAMETERS FOR CLOUD ICE, SNOW, GRAUPE<a name='1516'></font>
<a name='1517'>
       REAL FR_CON,FR_MAR<a name='1518'>
       FR_MAR=1.0<a name='1519'>
<font color=#447700>!      FR_CON=1-FR_MAR<a name='1520'></font>
       FR_CON=1.0<a name='1521'>
 <font color=#447700>!       PRINT*, 'INITIALIZING HUCM'  <a name='1522'></font>
<font color=#447700>!	print *, ' ****** HUCM *******'<a name='1523'></font>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_807">("SBM FAST: INITIALIZING HUCM")<a name='1524'>
<a name='1525'>
<font color=#447700>! INPUT :<a name='1526'></font>
        dlnr=dlog(2.d0)/(3.d0*scal)<a name='1527'>
<font color=#447700>!     print*,'here in hucmint 1'<a name='1528'></font>
<font color=#447700>!<a name='1529'></font>
<font color=#447700>!--- Read in various lookup tables<a name='1530'></font>
<font color=#447700>!<a name='1531'></font>
    <font color=#447700>!    print*,'wrf_dm_on_monitor() =',wrf_dm_on_monitor() <a name='1532'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1533'>
          DO i = 31,99<a name='1534'>
            INQUIRE ( i , OPENED = opened )<a name='1535'>
            IF ( .NOT. opened ) THEN<a name='1536'>
              hujisbm_unit1 = i<a name='1537'>
              GOTO 2061<a name='1538'>
            ENDIF<a name='1539'>
          ENDDO<a name='1540'>
          hujisbm_unit1 = -1<a name='1541'>
 2061     CONTINUE<a name='1542'>
        ENDIF<a name='1543'>
<font color=#447700>!<a name='1544'></font>
<font color=#447700>!     print*,'here in hucmint 2',hujisbm_unit1<a name='1545'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_135"> ( hujisbm_unit1 , IWORDSIZE )<a name='1546'>
<font color=#447700>!     print*,'here in hucmint 3',hujisbm_unit1<a name='1547'></font>
<font color=#447700>!<a name='1548'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1549'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_735"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1550'>
        ENDIF<a name='1551'>
<font color=#447700>!<a name='1552'></font>
<font color=#447700>!       print*,'here at 1'<a name='1553'></font>
<font color=#447700>!      print*,'here in hucmint 4'<a name='1554'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1555'>
          OPEN(UNIT=hujisbm_unit1,FILE="capacity.asc",                  &amp;<a name='1556'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1557'>
<a name='1558'>
  900	FORMAT(6E13.5)<a name='1559'>
	READ(hujisbm_unit1,900) RLEC,RIEC,RSEC,RGEC,RHEC<a name='1560'>
	CLOSE(hujisbm_unit1)<a name='1561'>
<font color=#447700>!     print*,'here in hucmint 5'<a name='1562'></font>
        END IF<a name='1563'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_136"> ( RLEC , size ( RLEC ) * RWORDSIZE )<a name='1564'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_137"> ( RIEC , size ( RIEC ) * RWORDSIZE )<a name='1565'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_138"> ( RSEC , size ( RSEC ) * RWORDSIZE )<a name='1566'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_139"> ( RGEC , size ( RGEC ) * RWORDSIZE )<a name='1567'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_140"> ( RHEC , size ( RHEC ) * RWORDSIZE )<a name='1568'>
<font color=#447700>! MASSES :<a name='1569'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1570'>
          DO i = 31,99<a name='1571'>
            INQUIRE ( i , OPENED = opened )<a name='1572'>
            IF ( .NOT. opened ) THEN<a name='1573'>
              hujisbm_unit1 = i<a name='1574'>
              GOTO 2062<a name='1575'>
            ENDIF<a name='1576'>
          ENDDO<a name='1577'>
          hujisbm_unit1 = -1<a name='1578'>
 2062     CONTINUE<a name='1579'>
        ENDIF<a name='1580'>
<font color=#447700>!<a name='1581'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_141"> ( hujisbm_unit1 , IWORDSIZE )<a name='1582'>
<font color=#447700>!<a name='1583'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1584'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_736"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1585'>
        ENDIF<a name='1586'>
<font color=#447700>!<a name='1587'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1588'>
          OPEN(UNIT=hujisbm_unit1,FILE="masses.asc",                  &amp;<a name='1589'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1590'>
	READ(hujisbm_unit1,900) XL,XI,XS,XG,XH          <a name='1591'>
	CLOSE(hujisbm_unit1)<a name='1592'>
<font color=#447700>!	print *, ' ***** file2: succesfull *******'<a name='1593'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_808">("SBM FAST: file2: succesfull")<a name='1594'>
        ENDIF<a name='1595'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_142"> ( XL , size ( XL ) * RWORDSIZE )<a name='1596'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_143"> ( XI , size ( XI ) * RWORDSIZE )<a name='1597'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_144"> ( XS , size ( XS ) * RWORDSIZE )<a name='1598'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_145"> ( XG , size ( XG ) * RWORDSIZE )<a name='1599'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_146"> ( XH , size ( XH ) * RWORDSIZE )<a name='1600'>
<font color=#447700>! TERMINAL VELOSITY :<a name='1601'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1602'>
          DO i = 31,99<a name='1603'>
            INQUIRE ( i , OPENED = opened )<a name='1604'>
            IF ( .NOT. opened ) THEN<a name='1605'>
              hujisbm_unit1 = i<a name='1606'>
              GOTO 2063<a name='1607'>
            ENDIF<a name='1608'>
          ENDDO<a name='1609'>
          hujisbm_unit1 = -1<a name='1610'>
 2063     CONTINUE<a name='1611'>
        ENDIF<a name='1612'>
<font color=#447700>!<a name='1613'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_147"> ( hujisbm_unit1 , IWORDSIZE )<a name='1614'>
<font color=#447700>!<a name='1615'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1616'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_737"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1617'>
        ENDIF<a name='1618'>
<font color=#447700>!<a name='1619'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1620'>
          OPEN(UNIT=hujisbm_unit1,FILE="termvels.asc",                  &amp;<a name='1621'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1622'>
	READ(hujisbm_unit1,900) VR1,VR2,VR3,VR4,VR5     <a name='1623'>
	CLOSE(hujisbm_unit1)<a name='1624'>
<font color=#447700>!	print *, ' ***** file3: succesfull *******'<a name='1625'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_809">("SBM FAST: file3: succesfull")<a name='1626'>
        ENDIF<a name='1627'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_148"> ( VR1 , size ( VR1 ) * RWORDSIZE )<a name='1628'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_149"> ( VR2 , size ( VR2 ) * RWORDSIZE )<a name='1629'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_150"> ( VR3 , size ( VR3 ) * RWORDSIZE )<a name='1630'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_151"> ( VR4 , size ( VR4 ) * RWORDSIZE )<a name='1631'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_152"> ( VR5 , size ( VR5 ) * RWORDSIZE )<a name='1632'>
<font color=#447700>! CHANGE FALL VELOCITY OF GRAUPEL<a name='1633'></font>
        DO KR=1,NKR<a name='1634'>
<font color=#447700>!        A=RADXXO(KR,6)<a name='1635'></font>
<font color=#447700>!        B=RADXXO(KR,7)<a name='1636'></font>
         if (kr.le.17)then<a name='1637'>
          A_FALL=1<a name='1638'>
          B_FALL=0<a name='1639'>
         else<a name='1640'>
          B_FALL=1<a name='1641'>
          A_FALL=0<a name='1642'>
         end if<a name='1643'>
  <a name='1644'>
<font color=#447700>!        VR4(KR)=A_FALL*VR4(KR)+B_FALL*VR5(KR)<a name='1645'></font>
<font color=#447700>!        print*,'vr4,vr5,graupel_fall=',vr3(kr),vr5(kr),graupel_fall(kr)<a name='1646'></font>
         VR4(KR)=graupel_fall(kr)<a name='1647'>
        END DO<a name='1648'>
 <a name='1649'>
<font color=#447700>! CONSTANTS :<a name='1650'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1651'>
          DO i = 31,99<a name='1652'>
            INQUIRE ( i , OPENED = opened )<a name='1653'>
            IF ( .NOT. opened ) THEN<a name='1654'>
              hujisbm_unit1 = i<a name='1655'>
              GOTO 2065<a name='1656'>
            ENDIF<a name='1657'>
          ENDDO<a name='1658'>
          hujisbm_unit1 = -1<a name='1659'>
 2065     CONTINUE<a name='1660'>
        ENDIF<a name='1661'>
<font color=#447700>!<a name='1662'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_153"> ( hujisbm_unit1 , IWORDSIZE )<a name='1663'>
<font color=#447700>!<a name='1664'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1665'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_738"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1666'>
        ENDIF<a name='1667'>
<font color=#447700>!<a name='1668'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1669'>
          OPEN(UNIT=hujisbm_unit1,FILE="constants.asc",                  &amp;<a name='1670'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1671'>
	READ(hujisbm_unit1,900) SLIC,TLIC,COEFIN,C2,C3,C4<a name='1672'>
	CLOSE(hujisbm_unit1)<a name='1673'>
<font color=#447700>!	print *, ' ***** file4: succesfull *******'<a name='1674'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_810">("SBM FAST: file4: succesfull")<a name='1675'>
        END IF<a name='1676'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_154"> ( SLIC , size ( SLIC ) * RWORDSIZE )<a name='1677'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_155"> ( TLIC , size ( TLIC ) * RWORDSIZE )<a name='1678'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_156"> ( COEFIN , size ( COEFIN ) * RWORDSIZE )<a name='1679'>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C2 , size ( C2 ) * RWORDSIZE )<a name='1680'></font>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C3 , size ( C3 ) * RWORDSIZE )<a name='1681'></font>
<font color=#447700>!       CALL wrf_dm_bcast_bytes ( C4 , size ( C4 ) * RWORDSIZE )<a name='1682'></font>
<font color=#447700>! CONSTANTS :<a name='1683'></font>
<font color=#447700>! KERNELS DEPENDING ON PRESSURE :<a name='1684'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1685'>
          DO i = 31,99<a name='1686'>
            INQUIRE ( i , OPENED = opened )<a name='1687'>
            IF ( .NOT. opened ) THEN<a name='1688'>
              hujisbm_unit1 = i<a name='1689'>
              GOTO 2066<a name='1690'>
            ENDIF<a name='1691'>
          ENDDO<a name='1692'>
          hujisbm_unit1 = -1<a name='1693'>
 2066     CONTINUE<a name='1694'>
        ENDIF<a name='1695'>
<font color=#447700>!<a name='1696'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_157"> ( hujisbm_unit1 , IWORDSIZE )<a name='1697'>
<font color=#447700>!<a name='1698'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1699'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_739"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1700'>
        ENDIF<a name='1701'>
<font color=#447700>!<a name='1702'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1703'>
          OPEN(UNIT=hujisbm_unit1,FILE="kernels_z.asc",                  &amp;<a name='1704'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1705'>
        READ(hujisbm_unit1,900)  &amp;<a name='1706'>
     &amp;  YWLL_1000MB,YWLL_750MB,YWLL_500MB<a name='1707'>
	CLOSE(hujisbm_unit1)<a name='1708'>
        END IF<a name='1709'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_158"> ( YWLL_1000MB , size ( YWLL_1000MB ) * RWORDSIZE )<a name='1710'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_159"> ( YWLL_750MB , size ( YWLL_750MB ) * RWORDSIZE )<a name='1711'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_160"> ( YWLL_500MB , size ( YWLL_500MB ) * RWORDSIZE )<a name='1712'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1713'>
          DO i = 31,99<a name='1714'>
            INQUIRE ( i , OPENED = opened )<a name='1715'>
            IF ( .NOT. opened ) THEN<a name='1716'>
              hujisbm_unit1 = i<a name='1717'>
              GOTO 2067<a name='1718'>
            ENDIF<a name='1719'>
          ENDDO<a name='1720'>
          hujisbm_unit1 = -1<a name='1721'>
 2067     CONTINUE<a name='1722'>
        ENDIF<a name='1723'>
<font color=#447700>!<a name='1724'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_161"> ( hujisbm_unit1 , IWORDSIZE )<a name='1725'>
<font color=#447700>!<a name='1726'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1727'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_740"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1728'>
        ENDIF<a name='1729'>
<font color=#447700>!<a name='1730'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1731'>
          OPEN(UNIT=hujisbm_unit1,FILE="kernels.asc_s_0_03_0_9",                  &amp;<a name='1732'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1733'>
<font color=#447700>! KERNELS NOT DEPENDING ON PRESSURE :<a name='1734'></font>
	READ(hujisbm_unit1,900) &amp;<a name='1735'>
     &amp;  YWLL,YWLI,YWLS,YWLG,YWLH, &amp;<a name='1736'>
     &amp;  YWIL,YWII,YWIS,YWIG,YWIH, &amp;<a name='1737'>
     &amp;  YWSL,YWSI,YWSS,YWSG,YWSH, &amp;<a name='1738'>
     &amp;  YWGL,YWGI,YWGS,YWGG,YWGH, &amp;<a name='1739'>
     &amp;  YWHL,YWHI,YWHS,YWHG,YWHH<a name='1740'>
       close (hujisbm_unit1)<a name='1741'>
        END IF<a name='1742'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_162"> ( YWLL , size ( YWLL ) * RWORDSIZE )<a name='1743'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_163"> ( YWLI , size ( YWLI ) * RWORDSIZE )<a name='1744'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_164"> ( YWLS , size ( YWLS ) * RWORDSIZE )<a name='1745'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_165"> ( YWLG , size ( YWLG ) * RWORDSIZE )<a name='1746'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_166"> ( YWLH , size ( YWLH ) * RWORDSIZE )<a name='1747'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_167"> ( YWIL , size ( YWIL ) * RWORDSIZE )<a name='1748'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_168"> ( YWII , size ( YWII ) * RWORDSIZE )<a name='1749'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_169"> ( YWIS , size ( YWIS ) * RWORDSIZE )<a name='1750'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_170"> ( YWIG , size ( YWIG ) * RWORDSIZE )<a name='1751'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_171"> ( YWIH , size ( YWIH ) * RWORDSIZE )<a name='1752'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_172"> ( YWSL , size ( YWSL ) * RWORDSIZE )<a name='1753'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_173"> ( YWSI , size ( YWSI ) * RWORDSIZE )<a name='1754'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_174"> ( YWSS , size ( YWSS ) * RWORDSIZE )<a name='1755'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_175"> ( YWSG , size ( YWSG ) * RWORDSIZE )<a name='1756'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_176"> ( YWSH , size ( YWSH ) * RWORDSIZE )<a name='1757'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_177"> ( YWGL , size ( YWGL ) * RWORDSIZE )<a name='1758'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_178"> ( YWGI , size ( YWGI ) * RWORDSIZE )<a name='1759'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_179"> ( YWGS , size ( YWGS ) * RWORDSIZE )<a name='1760'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_180"> ( YWGG , size ( YWGG ) * RWORDSIZE )<a name='1761'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_181"> ( YWGH , size ( YWGH ) * RWORDSIZE )<a name='1762'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_182"> ( YWHL , size ( YWHL ) * RWORDSIZE )<a name='1763'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_183"> ( YWHI , size ( YWHI ) * RWORDSIZE )<a name='1764'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_184"> ( YWHS , size ( YWHS ) * RWORDSIZE )<a name='1765'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_185"> ( YWHG , size ( YWHG ) * RWORDSIZE )<a name='1766'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_186"> ( YWHH , size ( YWHH ) * RWORDSIZE )<a name='1767'>
<font color=#447700>! BULKDENSITY :<a name='1768'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1769'>
          DO i = 31,99<a name='1770'>
            INQUIRE ( i , OPENED = opened )<a name='1771'>
            IF ( .NOT. opened ) THEN<a name='1772'>
              hujisbm_unit1 = i<a name='1773'>
              GOTO 2068<a name='1774'>
            ENDIF<a name='1775'>
          ENDDO<a name='1776'>
          hujisbm_unit1 = -1<a name='1777'>
 2068     CONTINUE<a name='1778'>
        ENDIF<a name='1779'>
<font color=#447700>!<a name='1780'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_187"> ( hujisbm_unit1 , IWORDSIZE )<a name='1781'>
<font color=#447700>!<a name='1782'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1783'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_741"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1784'>
        ENDIF<a name='1785'>
<font color=#447700>!<a name='1786'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1787'>
          OPEN(UNIT=hujisbm_unit1,FILE="bulkdens.asc_s_0_03_0_9",         &amp; <a name='1788'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1789'>
	READ(hujisbm_unit1,900) RO1BL,RO2BL,RO3BL,RO4BL,RO5BL<a name='1790'>
	CLOSE(hujisbm_unit1)<a name='1791'>
<font color=#447700>!	print *, ' ***** file6: succesfull *******'<a name='1792'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_811">("SBM FAST: file6: succesfull")<a name='1793'>
        END IF<a name='1794'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_188"> (RO1BL  , size ( RO1BL ) * RWORDSIZE )<a name='1795'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_189"> (RO2BL  , size ( RO2BL ) * RWORDSIZE )<a name='1796'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_190"> (RO3BL  , size ( RO3BL ) * RWORDSIZE )<a name='1797'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_191"> (RO4BL  , size ( RO4BL ) * RWORDSIZE )<a name='1798'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_192"> (RO5BL  , size ( RO5BL ) * RWORDSIZE )<a name='1799'>
<font color=#447700>! BULKRADIUS<a name='1800'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1801'>
          DO i = 31,99<a name='1802'>
            INQUIRE ( i , OPENED = opened )<a name='1803'>
            IF ( .NOT. opened ) THEN<a name='1804'>
              hujisbm_unit1 = i<a name='1805'>
              GOTO 2069<a name='1806'>
            ENDIF<a name='1807'>
          ENDDO<a name='1808'>
          hujisbm_unit1 = -1<a name='1809'>
 2069     CONTINUE<a name='1810'>
        ENDIF<a name='1811'>
<font color=#447700>!<a name='1812'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_193"> ( hujisbm_unit1 , IWORDSIZE )<a name='1813'>
<font color=#447700>!<a name='1814'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='1815'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_742"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='1816'>
        ENDIF<a name='1817'>
<font color=#447700>!<a name='1818'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='1819'>
          OPEN(UNIT=hujisbm_unit1,FILE="bulkradii.asc_s_0_03_0_9",         &amp; <a name='1820'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='1821'>
	READ(hujisbm_unit1,*) RADXXO<a name='1822'>
	CLOSE(hujisbm_unit1)<a name='1823'>
<font color=#447700>!	print *, ' ***** file7: succesfull *******'<a name='1824'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_812">("SBM FAST: file7: succesfull")<a name='1825'>
<font color=#447700>!	PRINT *, '******* Hebrew Univ Cloud model-HUCM *******'<a name='1826'></font>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_813">("SBM FAST: Hebrew Univ Cloud model-HUCM")<a name='1827'>
<a name='1828'>
        END IF<a name='1829'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_194"> (RADXXO  , size ( RADXXO ) * RWORDSIZE )<a name='1830'>
<font color=#447700>! calculation of the mass(in mg) for categories boundaries :<a name='1831'></font>
        ax=2.d0**(1.0/scal)<a name='1832'>
        xl_mg(1)=0.3351d-7<a name='1833'>
	do i=2,nkr<a name='1834'>
           xl_mg(i)=ax*xl_mg(i-1)<a name='1835'>
<font color=#447700>!        if (i.eq.22)print*,'printing xl_mg = ',xl_mg(22)<a name='1836'></font>
        enddo<a name='1837'>
	do i=1,nkr<a name='1838'>
           xs_mg(i)=xs(i)*1.e3<a name='1839'>
           xg_mg(i)=xg(i)*1.e3<a name='1840'>
           xh_mg(i)=xh(i)*1.e3<a name='1841'>
           xi1_mg(i)=xi(i,1)*1.e3<a name='1842'>
           xi2_mg(i)=xi(i,2)*1.e3<a name='1843'>
           xi3_mg(i)=xi(i,3)*1.e3<a name='1844'>
        enddo<a name='1845'>
<font color=#447700>! calculation of c(i,j) and ima(i,j) :<a name='1846'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='1847'></font>
<font color=#447700>!       print*, 'calling courant_bott'<a name='1848'></font>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COURANT_BOTT'>courant_bott</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COURANT_BOTT_1"><a name='1849'>
<font color=#447700>!       print*, 'called courant_bott'<a name='1850'></font>
 <a name='1851'>
<a name='1852'>
	DEG01=1./3.<a name='1853'>
<a name='1854'>
<font color=#447700>!------------------------------------------------------------------<a name='1855'></font>
<a name='1856'>
<font color=#447700>!       print*,'XL(ICCN) = ',ICCN,XL<a name='1857'></font>
	X0DROP=XL(ICCN)<a name='1858'>
<font color=#447700>!       print*,'X0DROP = ',X0DROP<a name='1859'></font>
	X0CCN =X0DROP/(2.**(NKR-1))<a name='1860'>
	R0CCN =(3.*X0CCN/4./3.141593/ROCCN0)**DEG01<a name='1861'>
<font color=#447700>!------------------------------------------------------------------<a name='1862'></font>
<font color=#447700>! THIS TEXT FROM TWOINITM.F_203<a name='1863'></font>
<font color=#447700>!------------------------------------------------------------------<a name='1864'></font>
<font color=#447700>! TEMPERATURA IN SURFACE LAYER EQUAL 15 Celsius(288.15 K)  <a name='1865'></font>
        A=3.3E-05/288.15<a name='1866'>
        B=2.*4.3/(22.9+35.5)<a name='1867'>
        B=B*(4./3.)*3.14*RO_SOLUTE<a name='1868'>
        A1=2.*(A/3.)**1.5/SQRT(B)<a name='1869'>
        A2=A1*100.<a name='1870'>
<font color=#447700>!------------------------------------------------------------------<a name='1871'></font>
	CONCCCNIN=0.<a name='1872'>
	CONTCCNIN=0.<a name='1873'>
	DO KR=1,NKR<a name='1874'>
           DROPRADII(KR)=(3.*XL(KR)/4./3.141593/1.)**DEG01<a name='1875'>
        ENDDO<a name='1876'>
	DO KR=1,NKR<a name='1877'>
<font color=#447700>!          print*,'ROCCN0 = ',ROCCN0<a name='1878'></font>
<font color=#447700>!          print*, 'X0CCN = ',X0CCN <a name='1879'></font>
<font color=#447700>!          print*, 'DEG01 = ',DEG01<a name='1880'></font>
	   ROCCN(KR)=ROCCN0<a name='1881'>
	   X0=X0CCN*2.**(KR-1)<a name='1882'>
	   R0=(3.*X0/4./3.141593/ROCCN(KR))**DEG01<a name='1883'>
	   XCCN(KR)=X0<a name='1884'>
	   RCCN(KR)=R0<a name='1885'>
<font color=#447700>!          print*,'RCCN(KR)= ', KR,RCCN(KR)<a name='1886'></font>
           RCCNKR_CM=R0<a name='1887'>
<font color=#447700>! CCN SPECTRUM <a name='1888'></font>
<a name='1889'>
           S_KR=A2/RCCNKR_CM**1.5<a name='1890'>
           ACCN=ACCN_CON<a name='1891'>
           BCCN=BCCN_CON<a name='1892'>
<font color=#447700>!          print*,'accn, bccn,S_KR = ',accn,bccn,S_KR<a name='1893'></font>
<font color=#447700>!  CONTINENTAL<a name='1894'></font>
           FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN<a name='1895'>
           FCCNR_CON(KR)=FCCNR(KR)<a name='1896'>
<font color=#447700>!  MARITIME<a name='1897'></font>
           ACCN=ACCN_MAR<a name='1898'>
           BCCN=BCCN_MAR<a name='1899'>
           FCCNR(KR)=1.5*ACCN*BCCN*S_KR**BCCN<a name='1900'>
           FCCNR_MAR(KR)=FCCNR(KR)<a name='1901'>
<a name='1902'>
	     CONTCCNIN=CONTCCNIN+COL*FCCNR(KR)*R0*R0*R0<a name='1903'>
             CONCCCNIN=CONCCCNIN+COL*FCCNR(KR)<a name='1904'>
	ENDDO<a name='1905'>
<font color=#447700>!PRINT *, '********* MAR CCN CONCENTRATION &amp; MASS *******'<a name='1906'></font>
<font color=#447700>!	PRINT 200, CONCCCNIN,CONTCCNIN<a name='1907'></font>
<font color=#447700>! CALCULATION OF FINAL MARITIME<a name='1908'></font>
<font color=#447700>!RCCN(KR)=            1  1.2303877E-07<a name='1909'></font>
<font color=#447700>!RCCN(KR)=            2  1.5501914E-07<a name='1910'></font>
<font color=#447700>!RCCN(KR)=            3  1.9531187E-07<a name='1911'></font>
<font color=#447700>!RCCN(KR)=           16  3.9372408E-06<a name='1912'></font>
<font color=#447700>!RCCN(KR)=           21  1.2499960E-05<a name='1913'></font>
<font color=#447700>!RCCN(KR)=           33  1.9999935E-04<a name='1914'></font>
        RADCCN_MAX=RCCN(NKR)<a name='1915'>
        RADCCN_MIN=0.005E-4         <a name='1916'>
        RADCCN_MIN1=0.02E-4         <a name='1917'>
<font color=#447700>!       print*,'ALOG(RADCCN_MIN) = ',ALOG(RADCCN_MIN)<a name='1918'></font>
<font color=#447700>!       print*,'ALOG(RCCN(1) = ',ALOG(RCCN(1))<a name='1919'></font>
<font color=#447700>!       print*,'ALOG(RADCCN_MAX) = ',ALOG(RADCCN_MAX)<a name='1920'></font>
<font color=#447700>!       KR_MIN=(ALOG(RADCCN_MIN)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1921'></font>
<font color=#447700>!       KR_MIN1=(ALOG(RADCCN_MIN1)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1922'></font>
        KR_MIN=1.+ 3*(ALOG(RADCCN_MIN)- ALOG(R0CCN))/ALOG(2.)<a name='1923'>
        KR_MIN1=1.+3*(ALOG(RADCCN_MIN1)- ALOG(R0CCN))/ALOG(2.)<a name='1924'>
<font color=#447700>!       KR_MAX=(ALOG(RADCCN_MAX)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1925'></font>
        KR_MAX=1.+3.*(ALOG(RADCCN_MAX)- ALOG(R0CCN))/ALOG(2.)<a name='1926'>
        KR_MIN=MAX(KR_MIN,1)<a name='1927'>
        KR_MIN1=MAX(KR_MIN,KR_MIN1)<a name='1928'>
        KR_MAX=MIN(NKR,KR_MAX)<a name='1929'>
<font color=#447700>!       print*,'kr_min,kr_min1 = ',kr_min,kr_min1<a name='1930'></font>
<font color=#447700>!       print*,'kr_max = ',kr_max<a name='1931'></font>
<font color=#447700>! Interpolation<a name='1932'></font>
        DO KR=1,NKR<a name='1933'>
        IF (kr.ge.kr_min.and.kr.lt.kr_min1)then<a name='1934'>
           FCCNR_MAR(KR)=FCCNR_MAR(KR_MIN1)* &amp;<a name='1935'>
     &amp;      (ALOG(RCCN(KR))-ALOG(RCCN(KR_MIN)))/ &amp;<a name='1936'>
     &amp;      (ALOG(RCCN(KR_MIN1))-ALOG(RCCN(KR_MIN)))<a name='1937'>
<a name='1938'>
        END IF<a name='1939'>
        IF (KR.GT.KR_MAX.OR.KR.LT.KR_MIN)FCCNR_MAR(KR)=0<a name='1940'>
<font color=#447700>!          print*,'FCCNR_MAR(KR) = ',KR,FCCNR_MAR(KR)<a name='1941'></font>
        END DO<a name='1942'>
<font color=#447700>! CALCULATION OF FINAL CONTINENTAL<a name='1943'></font>
        RADCCN_MAX=0.6E-4<a name='1944'>
        RADCCN_MIN=0.005E-4         <a name='1945'>
        RADCCN_MIN1=0.02E-4         <a name='1946'>
<font color=#447700>!       KR_MIN=(ALOG(RADCCN_MIN)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1947'></font>
<font color=#447700>!       KR_MIN1=(ALOG(RADCCN_MIN1)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1948'></font>
        KR_MIN=1.+ 3*(ALOG(RADCCN_MIN)- ALOG(R0CCN))/ALOG(2.)<a name='1949'>
        KR_MIN1=1.+3*(ALOG(RADCCN_MIN1)- ALOG(R0CCN))/ALOG(2.)<a name='1950'>
<font color=#447700>!       KR_MAX=(ALOG(RADCCN_MAX)-ALOG(RCCN(1)))/(3.*ALOG(2.))+1.<a name='1951'></font>
        KR_MAX=1.+3.*(ALOG(RADCCN_MAX)- ALOG(R0CCN))/ALOG(2.)<a name='1952'>
        KR_MIN=MAX(KR_MIN,1)<a name='1953'>
        KR_MIN1=MAX(KR_MIN,KR_MIN1)<a name='1954'>
        KR_MAX=MIN(NKR,KR_MAX)<a name='1955'>
<font color=#447700>!       print*,'contin kr_min,kr_min1 = ',kr_min,kr_min1<a name='1956'></font>
<font color=#447700>!       print*,'kr_max = ',kr_max<a name='1957'></font>
<font color=#447700>! Interpolation<a name='1958'></font>
        DO KR=1,NKR<a name='1959'>
        IF (kr.ge.kr_min.and.kr.lt.kr_min1)then<a name='1960'>
           FCCNR_CON(KR)=FCCNR_CON(KR_MIN1)* &amp;<a name='1961'>
     &amp;      (ALOG(RCCN(KR))-ALOG(RCCN(KR_MIN)))/ &amp;<a name='1962'>
     &amp;      (ALOG(RCCN(KR_MIN1))-ALOG(RCCN(KR_MIN)))<a name='1963'>
        END IF<a name='1964'>
        IF (KR.GT.KR_MAX.OR.KR.LT.KR_MIN)FCCNR_CON(KR)=0<a name='1965'>
<font color=#447700>!          print*,'FCCNR_CON(KR) = ',KR,FCCNR_CON(KR)<a name='1966'></font>
        END DO<a name='1967'>
<font color=#447700>! CALCULATION OF MIXTURE<a name='1968'></font>
        DO KR=1,NKR<a name='1969'>
         FCCNR_MIX(KR)=FR_CON*FCCNR_CON(KR)+FR_MAR*FCCNR_MAR(KR)<a name='1970'>
<font color=#447700>!        print*,'FCCNR_MIX(KR) = ',FCCNR_MIX(KR)<a name='1971'></font>
        END DO<a name='1972'>
<a name='1973'>
<a name='1974'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT'>BREAKINIT</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BREAKINIT_1"><a name='1975'>
<font color=#447700>!        CALL TWOINITMXVAR<a name='1976'></font>
<a name='1977'>
<font color=#447700>!	PRINT *, '**** MIN CCN RADIUS,MASS &amp; DENSITY ***'<a name='1978'></font>
<font color=#447700>!	PRINT 200, R0CCN,X0CCN,ROCCN0<a name='1979'></font>
<font color=#447700>!	PRINT *, '*********  CONT CCN CONCENTRATION &amp; MASS *******'<a name='1980'></font>
<font color=#447700>!	PRINT 200, CONCCCNIN,CONTCCNIN<a name='1981'></font>
<font color=#447700>!	PRINT *, '*********  DROP RADII *******'<a name='1982'></font>
<font color=#447700>!	PRINT 200, DROPRADII<a name='1983'></font>
<font color=#447700>!	PRINT *, '*********  CCN RADII *******'<a name='1984'></font>
<font color=#447700>!	PRINT 200, RCCN<a name='1985'></font>
<font color=#447700>!	PRINT *, '********* CCN MASSES *******'<a name='1986'></font>
<font color=#447700>!	PRINT 200, XCCN<a name='1987'></font>
<font color=#447700>!	PRINT *, '********* INITIAL CCN DISTRIBUTION *******'<a name='1988'></font>
        <a name='1989'>
     <a name='1990'>
<a name='1991'>
<font color=#447700>!	IF(IPRINT01.NE.0) THEN<a name='1992'></font>
<a name='1993'>
<font color=#447700>!  PRINT *, '******** INITIAL: TWC,TWI(ICEMAX),TWS ********'<a name='1994'></font>
<font color=#447700>!  PRINT 300, TWCIN,TWIIN,TWSIN<a name='1995'></font>
<font color=#447700>!  PRINT *, '******** INITIAL: CONCLIN ********'<a name='1996'></font>
<font color=#447700>!  PRINT 300, CONCLIN<a name='1997'></font>
<a name='1998'>
<font color=#447700>! IN CASE : IPRINT01.NE.0<a name='1999'></font>
<a name='2000'>
<font color=#447700>!	ENDIF<a name='2001'></font>
<a name='2002'>
  100	FORMAT(10I4)<a name='2003'>
  101   FORMAT(3X,F7.5,E13.5)<a name='2004'>
  102	FORMAT(4E12.4)<a name='2005'>
  105	FORMAT(A48)<a name='2006'>
  106	FORMAT(A80)<a name='2007'>
  123	FORMAT(3E12.4,3I4)<a name='2008'>
  200	FORMAT(6E13.5)<a name='2009'>
  201   FORMAT(6D13.5)<a name='2010'>
  300	FORMAT(8E14.6) <a name='2011'>
  301   FORMAT(3X,F8.3,3X,E13.5)<a name='2012'>
  302   FORMAT(5E13.5)<a name='2013'>
<font color=#447700>!       if (IFREST)THEN<a name='2014'></font>
<font color=#447700>!       dtime=dt*0.5<a name='2015'></font>
<font color=#447700>!       else<a name='2016'></font>
<font color=#447700>!       END IF<a name='2017'></font>
        call <A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS'>kernals</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="KERNALS_3">(dt)<a name='2018'>
<font color=#447700>! from morr_two_moment<a name='2019'></font>
<font color=#447700>!..Set these variables needed for computing radar reflectivity.  These<a name='2020'></font>
<font color=#447700>!.. get used within radar_init to create other variables used in the<a name='2021'></font>
<font color=#447700>!.. radar module.<a name='2022'></font>
<font color=#447700>! SIZE DISTRIBUTION PARAMETERS<a name='2023'></font>
         RHOW = 997.<a name='2024'>
         RHOI = 500.<a name='2025'>
         RHOSN = 100.<a name='2026'>
<font color=#447700>!        IF (IHAIL.EQ.0) THEN<a name='2027'></font>
<font color=#447700>!        RHOG = 400.<a name='2028'></font>
<font color=#447700>!        ELSE<a name='2029'></font>
<font color=#447700>!        RHOG = 900.<a name='2030'></font>
<font color=#447700>!        END IF<a name='2031'></font>
         RHOG=450<a name='2032'>
<a name='2033'>
<a name='2034'>
         CI = RHOI*PI_MORR/6.<a name='2035'>
         DI = 3.<a name='2036'>
         CS = RHOSN*PI_MORR/6.<a name='2037'>
         DS = 3.<a name='2038'>
         CG = RHOG*PI_MORR/6.<a name='2039'>
         DG = 3.<a name='2040'>
<a name='2041'>
<a name='2042'>
         xam_r = PI_MORR*RHOW/6.<a name='2043'>
         xbm_r = 3.<a name='2044'>
         xmu_r = 0.<a name='2045'>
         xam_s = CS<a name='2046'>
         xbm_s = DS<a name='2047'>
         xmu_s = 0.<a name='2048'>
         xam_g = CG<a name='2049'>
         xbm_g = DG<a name='2050'>
         xmu_g = 0.<a name='2051'>
<a name='2052'>
         call <A href='../../html_code/phys/module_mp_radar.F.html#RADAR_INIT'>radar_init</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RADAR_INIT_1"><a name='2053'>
<a name='2054'>
        return<a name='2055'>
2070  continue<a name='2056'>
      WRITE( errmess , '(A,I4)' )                                        &amp;<a name='2057'>
       'module_mp_fast_sbm: error opening hujisbm_DATA on unit '          &amp;<a name='2058'>
     &amp;, hujisbm_unit1<a name='2059'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FAST_HUCMINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_743">(errmess)<a name='2060'>
        end  subroutine fast_hucminit<a name='2061'>
<A NAME='BREAKINIT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#BREAKINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2062'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BREAKINIT</font> <A href='../../call_to/BREAKINIT.html' TARGET='index'>2</A>,<A href='../../call_from/BREAKINIT.html' TARGET='index'>16</A><a name='2063'>
      IMPLICIT NONE<a name='2064'>
      INTEGER :: hujisbm_unit1<a name='2065'>
      LOGICAL, PARAMETER :: PRINT_diag=.FALSE.<a name='2066'>
      LOGICAL :: opened <a name='2067'>
      LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='2068'>
      CHARACTER*80 errmess<a name='2069'>
<font color=#447700>!.....INPUT VARIABLES<a name='2070'></font>
<font color=#447700>!<a name='2071'></font>
<font color=#447700>!     GT    : MASS DISTRIBUTION FUNCTION<a name='2072'></font>
<font color=#447700>!     XT_MG : MASS OF BIN IN MG<a name='2073'></font>
<font color=#447700>!     JMAX  : NUMBER OF BINS<a name='2074'></font>
<a name='2075'>
<a name='2076'>
<font color=#447700>!.....LOCAL VARIABLES<a name='2077'></font>
<a name='2078'>
      INTEGER AP,IE,JE,KE<a name='2079'>
<a name='2080'>
      PARAMETER (AP = 1)<a name='2081'>
<a name='2082'>
      INTEGER I,J,K,JDIFF<a name='2083'>
      REAL  RPKIJ(JBREAK,JBREAK,JBREAK),RQKJ(JBREAK,JBREAK)<a name='2084'>
<a name='2085'>
<a name='2086'>
      REAL PI,D0,HLP<a name='2087'>
      DOUBLE PRECISION M(0:JBREAK),ALM<a name='2088'>
      REAL DBREAK(JBREAK),GAIN,LOSS<a name='2089'>
<font color=#447700>!     REAL ECOALMASS<a name='2090'></font>
<font color=#447700>!     REAL XL(JMAX)<a name='2091'></font>
<a name='2092'>
<a name='2093'>
<font color=#447700>!.....DECLARATIONS FOR INIT<a name='2094'></font>
<a name='2095'>
      INTEGER IP,KP,JP,KQ,JQ<a name='2096'>
      REAL XTJ<a name='2097'>
<a name='2098'>
      CHARACTER*20 FILENAME_P,FILENAME_Q<a name='2099'>
<a name='2100'>
      FILENAME_P = 'coeff_p.asc'<a name='2101'>
      FILENAME_Q = 'coeff_q.asc'<a name='2102'>
<a name='2103'>
      IE = JBREAK<a name='2104'>
      JE = JBREAK<a name='2105'>
      KE = JBREAK<a name='2106'>
      PI    = 3.1415927<a name='2107'>
      D0    = 0.0101593<a name='2108'>
      M(1)  = PI/6.0 * D0**3<a name='2109'>
<a name='2110'>
<font color=#447700>!.....IN CGS<a name='2111'></font>
<a name='2112'>
<a name='2113'>
<font color=#447700>!.....SHIFT BETWEEN COAGULATION AND BREAKUP GRID<a name='2114'></font>
<a name='2115'>
      JDIFF = JMAX - JBREAK<a name='2116'>
<a name='2117'>
<font color=#447700>!.....INITIALIZATION<a name='2118'></font>
<a name='2119'>
<font color=#447700>!     IF (FIRSTCALL.NE.1) THEN<a name='2120'></font>
<a name='2121'>
<font color=#447700>!........CALCULATING THE BREAKUP GRID<a name='2122'></font>
<font color=#447700>!        ALM  = 2.**(1./FLOAT(AP))<a name='2123'></font>
         ALM  = 2.d0<a name='2124'>
         M(0)  = M(1)/ALM<a name='2125'>
         DO K=1,KE-1<a name='2126'>
            M(K+1) = M(K)*ALM<a name='2127'>
         ENDDO<a name='2128'>
         DO K=1,KE<a name='2129'>
            BRKWEIGHT(K) = 2./(M(K)**2 - M(K-1)**2)<a name='2130'>
<font color=#447700>!           print*,'m(k) = ',m(k)<a name='2131'></font>
<font color=#447700>!           print*,'m(k-1) = ',m(k-1)<a name='2132'></font>
<font color=#447700>!           print*, 'MWEIGHT = ',BRKWEIGHT(K)<a name='2133'></font>
         ENDDO<a name='2134'>
<a name='2135'>
<font color=#447700>!........OUTPUT<a name='2136'></font>
<a name='2137'>
         WRITE (*,*) 'COLL_BREAKUP_INI: COAGULATION AND BREAKUP GRID'<a name='2138'>
         WRITE (*,'(2A5,5A15)') 'ICOAG','IBREAK', &amp;<a name='2139'>
     &amp;        'XCOAG','DCOAG', &amp;<a name='2140'>
     &amp;        'XBREAK','DBREAK','MWEIGHT'<a name='2141'>
<a name='2142'>
<font color=#447700>!........READ DER BREAKUP COEFFICIENTS FROM INPUT FILE<a name='2143'></font>
<a name='2144'>
         WRITE (*,*) 'COLL_BREAKUP: READ THE BREAKUP COEFFS'<a name='2145'>
         WRITE (*,*) '              FILE PKIJ: ', FILENAME_P<a name='2146'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2147'>
          DO i = 31,99<a name='2148'>
            INQUIRE ( i , OPENED = opened )<a name='2149'>
            IF ( .NOT. opened ) THEN<a name='2150'>
              hujisbm_unit1 = i<a name='2151'>
              GOTO 2061<a name='2152'>
            ENDIF<a name='2153'>
          ENDDO<a name='2154'>
          hujisbm_unit1 = -1<a name='2155'>
 2061     CONTINUE<a name='2156'>
        ENDIF<a name='2157'>
<font color=#447700>!<a name='2158'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_195"> ( hujisbm_unit1 , IWORDSIZE )<a name='2159'>
<font color=#447700>!<a name='2160'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2161'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_744"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2162'>
        ENDIF<a name='2163'>
<font color=#447700>!<a name='2164'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2165'>
          OPEN(UNIT=hujisbm_unit1,FILE="coeff_p.asc",                  &amp;<a name='2166'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2167'>
<a name='2168'>
<font color=#447700>!         print*,'here at 3'<a name='2169'></font>
         DO K=1,KE<a name='2170'>
            DO I=1,IE<a name='2171'>
               DO J=1,I<a name='2172'>
                  READ(hujisbm_unit1,'(3I6,1E16.8)') KP,IP,JP,PKIJ(KP,IP,JP)<a name='2173'>
<font color=#447700>!                 WRITE(6,*)'PKIJ(KP,IP,JP) =', &amp;<a name='2174'></font>
<font color=#447700>!    &amp;               KP,IP,JP,PKIJ(KP,IP,JP)<a name='2175'></font>
<font color=#447700>!                 IF(RPKIJ(KP,IP,JP).EQ.0) THEN<a name='2176'></font>
<font color=#447700>!    *             PKIJ(KP,IP,JP)=INT(RPKIJ(KP,IP,JP))<a name='2177'></font>
<font color=#447700>!                 ELSE<a name='2178'></font>
<font color=#447700>!                  PKIJ(KP,IP,JP)=RPKIJ(KP,IP,JP)<a name='2179'></font>
<font color=#447700>!                 END IF<a name='2180'></font>
<font color=#447700>!                 WRITE(6,*)'RPKIJ(KP,IP,JP) =',<a name='2181'></font>
<font color=#447700>!    *               KP,IP,JP,RPKIJ(KP,IP,JP),<a name='2182'></font>
<font color=#447700>!    *               PKIJ(KP,IP,JP)<a name='2183'></font>
               ENDDO<a name='2184'>
            ENDDO<a name='2185'>
<font color=#447700>!           READ(6,*)<a name='2186'></font>
         ENDDO<a name='2187'>
	CLOSE(hujisbm_unit1)<a name='2188'>
         WRITE (*,*) '              FILE QKJ:  ', FILENAME_Q<a name='2189'>
        END IF<a name='2190'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_196"> (PKIJ  , size ( PKIJ ) * DWORDSIZE )<a name='2191'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2192'>
          DO i = 31,99<a name='2193'>
            INQUIRE ( i , OPENED = opened )<a name='2194'>
            IF ( .NOT. opened ) THEN<a name='2195'>
              hujisbm_unit1 = i<a name='2196'>
              GOTO 2062<a name='2197'>
            ENDIF<a name='2198'>
          ENDDO<a name='2199'>
          hujisbm_unit1 = -1<a name='2200'>
 2062     CONTINUE<a name='2201'>
        ENDIF<a name='2202'>
<font color=#447700>!<a name='2203'></font>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_197"> ( hujisbm_unit1 , IWORDSIZE )<a name='2204'>
<font color=#447700>!<a name='2205'></font>
        IF ( hujisbm_unit1 &lt; 0 ) THEN<a name='2206'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_745"> ( 'module_mp_fast: etanewinit: Can not find unused fortran unit to read in lookup table.' )<a name='2207'>
        ENDIF<a name='2208'>
<font color=#447700>!<a name='2209'></font>
        IF ( wrf_dm_on_monitor() ) THEN<a name='2210'>
          OPEN(UNIT=hujisbm_unit1,FILE="coeff_q.asc",                  &amp;<a name='2211'>
     &amp;        FORM="FORMATTED",STATUS="OLD",ERR=2070)<a name='2212'>
<a name='2213'>
         DO K=1,KE<a name='2214'>
            DO J=1,JE<a name='2215'>
               READ(hujisbm_unit1,'(2I6,1E16.8)') KQ,JQ,QKJ(KQ,JQ)<a name='2216'>
<font color=#447700>!              WRITE(6,*) KQ,JQ,QKJ(KQ,JQ)<a name='2217'></font>
<font color=#447700>!              QKJ(KQ,JQ) = RQKJ(KQ,JQ)<a name='2218'></font>
<font color=#447700>!              IF(QKJ(KQ,JQ).LE.1E-35)QKJ(KQ,JQ)=0.D0<a name='2219'></font>
            ENDDO<a name='2220'>
         ENDDO<a name='2221'>
         CLOSE(hujisbm_unit1)<a name='2222'>
<a name='2223'>
         WRITE (*,*) 'COLL_BREAKUP READ: ... OK'<a name='2224'>
         END IF<a name='2225'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_198"> (QKJ  , size ( QKJ ) * DWORDSIZE )<a name='2226'>
<font color=#447700>!     ENDIF<a name='2227'></font>
<font color=#447700>!        DO K=1,KE<a name='2228'></font>
<font color=#447700>!           DO J=1,JE<a name='2229'></font>
<font color=#447700>!              WRITE(6,*) 'After Broadcast, QKJ = ',K,J,QKJ(K,J)<a name='2230'></font>
<font color=#447700>!           ENDDO<a name='2231'></font>
<font color=#447700>!        ENDDO<a name='2232'></font>
<font color=#447700>!        DO K=1,KE<a name='2233'></font>
<font color=#447700>!           DO I=1,IE<a name='2234'></font>
<font color=#447700>!              DO J=1,I<a name='2235'></font>
<font color=#447700>!                 WRITE(6,*)'After Broadcast PKIJ(K,I,J) =', &amp;<a name='2236'></font>
<font color=#447700>!    &amp;               K,I,J,PKIJ(K,I,J)<a name='2237'></font>
<font color=#447700>!              ENDDO<a name='2238'></font>
<font color=#447700>!           ENDDO<a name='2239'></font>
<font color=#447700>!        ENDDO<a name='2240'></font>
      DO I=1,JMAX<a name='2241'>
         DO J=1,JMAX<a name='2242'>
              ECOALMASSM(I,J)=1.0D0<a name='2243'>
         ENDDO<a name='2244'>
      ENDDO<a name='2245'>
<a name='2246'>
      DO I=1,JMAX<a name='2247'>
         DO J=1,JMAX<a name='2248'>
           ECOALMASSM(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALMASS'>ECOALMASS</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALMASS_1">(XL(I),XL(J))<a name='2249'>
         ENDDO<a name='2250'>
      ENDDO<a name='2251'>
      RETURN<a name='2252'>
2070  continue<a name='2253'>
      WRITE( errmess , '(A,I4)' )                                        &amp;<a name='2254'>
       'module_mp_fast: error opening hujisbm_DATA on unit '          &amp;<a name='2255'>
     &amp;, hujisbm_unit1<a name='2256'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_746">(errmess)<a name='2257'>
      END SUBROUTINE BREAKINIT<a name='2258'>
<a name='2259'>
<A NAME='ECOALMASS'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ECOALMASS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2260'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALMASS</font>(ETA,KSI) <A href='../../call_to/ECOALMASS.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALMASS.html' TARGET='index'>2</A><a name='2261'>
      IMPLICIT NONE<a name='2262'>
<font color=#447700>!     REAL ECOALMASS<a name='2263'></font>
      REAL PI<a name='2264'>
      PARAMETER (PI = 3.1415927)<a name='2265'>
<a name='2266'>
      REAL ETA,KSI<a name='2267'>
      REAL KPI,RHO<a name='2268'>
      REAL DETA,DKSI<a name='2269'>
<a name='2270'>
      PARAMETER (RHO  = 1.0)<a name='2271'>
<a name='2272'>
<font color=#447700>!     REAL ECOALDIAM<a name='2273'></font>
<font color=#447700>!     EXTERNAL ECOALDIAM<a name='2274'></font>
<a name='2275'>
      KPI = 6./PI<a name='2276'>
<a name='2277'>
      DETA = (KPI*ETA/RHO)**(1./3.)<a name='2278'>
      DKSI = (KPI*KSI/RHO)**(1./3.)<a name='2279'>
<a name='2280'>
      ECOALMASS = <A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALDIAM'>ECOALDIAM</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALMASS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALDIAM_1">(DETA,DKSI)<a name='2281'>
<a name='2282'>
      RETURN<a name='2283'>
      END FUNCTION ECOALMASS<a name='2284'>
<a name='2285'>
<a name='2286'>
<font color=#447700>!------------------------------------------------<a name='2287'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY AS FUNC OF DIAMETERS<a name='2288'></font>
<font color=#447700>!------------------------------------------------<a name='2289'></font>
<a name='2290'>
<A NAME='ECOALDIAM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ECOALDIAM' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2291'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALDIAM</font>(DETA,DKSI) <A href='../../call_to/ECOALDIAM.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALDIAM.html' TARGET='index'>2</A><a name='2292'>
<font color=#447700>!     IMPLICIT NONE<a name='2293'></font>
<a name='2294'>
      INTEGER N<a name='2295'>
      REAL DETA,DKSI<a name='2296'>
      REAL DGR,DKL,RGR,RKL,P,Q,E,X,Y,QMIN,QMAX<a name='2297'>
      REAL ZERO,ONE,EPS,PI<a name='2298'>
<a name='2299'>
      PARAMETER (ZERO = 0.0)<a name='2300'>
      PARAMETER (ONE  = 1.0)<a name='2301'>
      PARAMETER (EPS  = 1.0E-30)<a name='2302'>
      PARAMETER (PI   = 3.1415927)<a name='2303'>
<a name='2304'>
<font color=#447700>!     REAL   ECOALLOWLIST,ECOALOCHS<a name='2305'></font>
<font color=#447700>!     EXTERNAL ECOALLOWLIST,ECOALOCHS<a name='2306'></font>
<a name='2307'>
      DGR = MAX(DETA,DKSI)<a name='2308'>
      DKL = MIN(DETA,DKSI)<a name='2309'>
<a name='2310'>
      RGR = 0.5*DGR<a name='2311'>
      RKL = 0.5*DKL<a name='2312'>
<a name='2313'>
      P = (RKL / RGR)<a name='2314'>
      Q = (RKL * RGR)**0.5<a name='2315'>
      Q = 0.5 * (RKL + RGR)<a name='2316'>
<a name='2317'>
      qmin = 250e-4<a name='2318'>
      qmax = 400e-4        <a name='2319'>
      if (q.lt.qmin) then<a name='2320'>
         e = max(ecoalOchs(Dgr,Dkl),ecoalBeard(Dgr,Dkl)) <a name='2321'>
      elseif (q.ge.qmin.and.q.lt.qmax) then<a name='2322'>
         x = (q - qmin) / (qmax - qmin)<a name='2323'>
         e = sin(pi/2.0*x)**2 * ecoalLowList(Dgr,Dkl) &amp;<a name='2324'>
     &amp;     + sin(pi/2.0*(1 - x))**2 * ecoalOchs(Dgr,Dkl)<a name='2325'>
      elseif (q.ge.qmax) then<a name='2326'>
         e = <A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALLOWLIST'>ecoalLowList</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALDIAM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ECOALLOWLIST_1">(Dgr,Dkl)<a name='2327'>
      else<a name='2328'>
         e  = 1.0<a name='2329'>
      endif<a name='2330'>
<a name='2331'>
      ECOALDIAM  = MAX(MIN(ONE,E),EPS)<a name='2332'>
<a name='2333'>
      RETURN<a name='2334'>
      END FUNCTION  ECOALDIAM<a name='2335'>
<a name='2336'>
<font color=#447700>!--------------------------------------------------<a name='2337'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY (LOW&amp;LIST)<a name='2338'></font>
<font color=#447700>!--------------------------------------------------<a name='2339'></font>
<a name='2340'>
<A NAME='ECOALLOWLIST'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ECOALLOWLIST' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2341'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALLOWLIST</font>(DGR,DKL) <A href='../../call_to/ECOALLOWLIST.html' TARGET='index'>2</A>,<A href='../../call_from/ECOALLOWLIST.html' TARGET='index'>2</A><a name='2342'>
      IMPLICIT NONE<a name='2343'>
<font color=#447700>!     REAL ecoallowlist<a name='2344'></font>
      REAL PI,SIGMA,KA,KB,EPSI<a name='2345'>
      REAL DGR,DKL,RGR,RKL,X<a name='2346'>
      REAL ST,SC,ET,DSTSC,CKE,W1,W2,DC,ECL<a name='2347'>
      REAL QQ0,QQ1,QQ2<a name='2348'>
<a name='2349'>
      PARAMETER (EPSI=1.E-20)<a name='2350'>
<a name='2351'>
      PI = 3.1415927<a name='2352'>
      SIGMA = 72.8<a name='2353'>
      KA = 0.778<a name='2354'>
      KB = 2.61E-4<a name='2355'>
<a name='2356'>
      RGR = 0.5*DGR<a name='2357'>
      RKL = 0.5*DKL<a name='2358'>
<a name='2359'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY'>COLLENERGY</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALLOWLIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLENERGY_1">(DGR,DKL,CKE,ST,SC,W1,W2,DC)<a name='2360'>
<a name='2361'>
      DSTSC = ST-SC<a name='2362'>
      ET = CKE+DSTSC<a name='2363'>
      IF (ET .LT. 50.0) THEN<a name='2364'>
         QQ0=1.0+(DKL/DGR)<a name='2365'>
         QQ1=KA/QQ0**2<a name='2366'>
         QQ2=KB*SIGMA*(ET**2)/(SC+EPSI)<a name='2367'>
         ECL=QQ1*EXP(-QQ2)<a name='2368'>
      ELSE<a name='2369'>
         ECL=0.0<a name='2370'>
      ENDIF<a name='2371'>
<a name='2372'>
      ECOALLOWLIST = ECL<a name='2373'>
<a name='2374'>
      RETURN<a name='2375'>
      END FUNCTION ECOALLOWLIST<a name='2376'>
<a name='2377'>
<font color=#447700>!--------------------------------------------------<a name='2378'></font>
<font color=#447700>!     COALESCENCE EFFICIENCY (BEARD AND OCHS)<a name='2379'></font>
<font color=#447700>!--------------------------------------------------<a name='2380'></font>
<a name='2381'>
<A NAME='ECOALOCHS'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ECOALOCHS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2382'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ECOALOCHS</font>(D_L,D_S)<a name='2383'>
      IMPLICIT NONE<a name='2384'>
<font color=#447700>!     real ecoalochs<a name='2385'></font>
      REAL D_L,D_S<a name='2386'>
      REAL PI,SIGMA,N_W,R_S,R_L,DV,P,G,X,E<a name='2387'>
<font color=#447700>!      REAL VTBEARD,EPSF,FPMIN<a name='2388'></font>
      REAL EPSF,FPMIN<a name='2389'>
<a name='2390'>
<font color=#447700>!     EXTERNAL VTBEARD<a name='2391'></font>
      PARAMETER (EPSF  = 1.E-30)<a name='2392'>
      PARAMETER (FPMIN = 1.E-30)<a name='2393'>
<a name='2394'>
      PI = 3.1415927<a name='2395'>
      SIGMA = 72.8<a name='2396'>
<a name='2397'>
      R_S = 0.5 * D_S<a name='2398'>
      R_L = 0.5 * D_L<a name='2399'>
      P   = R_S / R_L<a name='2400'>
<a name='2401'>
      DV  = ABS(VTBEARD(D_L) - VTBEARD(D_S))<a name='2402'>
      IF (DV.LT.FPMIN) DV = FPMIN<a name='2403'>
      N_W = R_S * DV**2 / SIGMA<a name='2404'>
      G   = 2**(3./2.)/(6.*PI) * P**4 * (1.+ P) / ((1.+P**2)*(1.+P**3))<a name='2405'>
      X   = N_W**(0.5) * G<a name='2406'>
      E   = 0.767 - 10.14 * X<a name='2407'>
<a name='2408'>
      ECOALOCHS = E<a name='2409'>
<a name='2410'>
      RETURN<a name='2411'>
      END FUNCTION ECOALOCHS<a name='2412'>
<a name='2413'>
<font color=#447700>!-----------------------------------------<a name='2414'></font>
<font color=#447700>!     CALCULATING THE COLLISION ENERGY<a name='2415'></font>
<font color=#447700>!-----------------------------------------<a name='2416'></font>
<a name='2417'>
<A NAME='COLLENERGY'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLLENERGY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2418'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>COLLENERGY</font>(DGR,DKL,CKE,ST,SC,W1,W2,DC) <A href='../../call_to/COLLENERGY.html' TARGET='index'>2</A>,<A href='../../call_from/COLLENERGY.html' TARGET='index'>4</A><a name='2419'>
<font color=#447700>!     IMPLICIT NONE<a name='2420'></font>
<a name='2421'>
      REAL DGR,DKL,DC<a name='2422'>
      REAL K10,PI,SIGMA,RHO<a name='2423'>
      REAL CKE,W1,W2,ST,SC<a name='2424'>
      REAL DGKA3,DGKB3,DGKA2<a name='2425'>
      REAL V1,V2,DV<a name='2426'>
<font color=#447700>!     REAL VTBEARD,EPSF,FPMIN<a name='2427'></font>
      REAL EPSF,FPMIN<a name='2428'>
<a name='2429'>
<font color=#447700>!     EXTERNAL VTBEARD<a name='2430'></font>
      PARAMETER (EPSF  = 1.E-30)<a name='2431'>
      PARAMETER (FPMIN = 1.E-30)<a name='2432'>
<a name='2433'>
      PI    = 3.1415927<a name='2434'>
      RHO   = 1.0<a name='2435'>
      SIGMA = 72.8<a name='2436'>
<a name='2437'>
      K10=RHO*PI/12.0D0<a name='2438'>
<a name='2439'>
      DGR = MAX(DGR,EPSF)<a name='2440'>
      DKL = MAX(DKL,EPSF)<a name='2441'>
<a name='2442'>
      DGKA2=(DGR**2)+(DKL**2)<a name='2443'>
<a name='2444'>
      DGKA3=(DGR**3)+(DKL**3)<a name='2445'>
<a name='2446'>
      IF (DGR.NE.DKL) THEN<a name='2447'>
         V1 = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VTBEARD'>VTBEARD</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VTBEARD_1">(DGR)<a name='2448'>
         V2 = <A href='../../html_code/phys/module_mp_full_sbm.F.html#VTBEARD'>VTBEARD</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COLLENERGY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VTBEARD_2">(DKL)<a name='2449'>
         DV = (V1-V2)<a name='2450'>
         IF (DV.LT.FPMIN) DV = FPMIN<a name='2451'>
         DV = DV**2<a name='2452'>
         IF (DV.LT.FPMIN) DV = FPMIN<a name='2453'>
         DGKB3=(DGR**3)*(DKL**3)<a name='2454'>
         CKE = K10 * DV * DGKB3/DGKA3<a name='2455'>
      ELSE<a name='2456'>
         CKE = 0.0D0<a name='2457'>
      ENDIF<a name='2458'>
      ST = PI*SIGMA*DGKA2<a name='2459'>
      SC = PI*SIGMA*DGKA3**(2./3.)<a name='2460'>
<a name='2461'>
      W1=CKE/(SC+EPSF)<a name='2462'>
      W2=CKE/(ST+EPSF)<a name='2463'>
<a name='2464'>
      DC=DGKA3**(1./3.)<a name='2465'>
<a name='2466'>
      RETURN<a name='2467'>
      END SUBROUTINE COLLENERGY<a name='2468'>
<a name='2469'>
<font color=#447700>!--------------------------------------------------<a name='2470'></font>
<font color=#447700>!     CALCULATING TERMINAL VELOCITY (BEARD-FORMULA)<a name='2471'></font>
<font color=#447700>!--------------------------------------------------<a name='2472'></font>
<a name='2473'>
<A NAME='VTBEARD'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#VTBEARD' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2474'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>VTBEARD</font>(DIAM) <A href='../../call_to/VTBEARD.html' TARGET='index'>4</A><a name='2475'>
      IMPLICIT NONE<a name='2476'>
<font color=#447700>!     REAL VTBEARD<a name='2477'></font>
<a name='2478'>
      REAL DIAM,AA<a name='2479'>
      REAL ROP,RU,AMT,PP,RL,TT,ETA,DENS,CD,D,A<a name='2480'>
      REAL ALA,GR,SI,BOND,PART,XX,YY,RE,VT<a name='2481'>
      REAL B00,B11,B22,B33,B44,B55,B0,B1,B2,B3,B4,B5,B6<a name='2482'>
      INTEGER ID<a name='2483'>
<a name='2484'>
      DATA B00,B11,B22,B33,B44,B55,B0,B1,B2,B3,B4,B5,B6/-5.00015, &amp;<a name='2485'>
     &amp;5.23778,-2.04914,.475294,-.0542819,.00238449,-3.18657,.992696, &amp;<a name='2486'>
     &amp;-.153193E-2,-.987059E-3,-.578878E-3,.855176E-4,-.327815E-5/<a name='2487'>
<a name='2488'>
      AA   = DIAM/2.0<a name='2489'>
      ROP  = 1.0<a name='2490'>
      RU   = 8.3144E+7<a name='2491'>
      AMT  = 28.9644<a name='2492'>
      ID   = 10000<a name='2493'>
      PP   = FLOAT(ID)*100.<a name='2494'>
      RL   = RU/AMT<a name='2495'>
      TT   = 283.15<a name='2496'>
      ETA  = (1.718+.0049*(TT-273.15))*1.E-4<a name='2497'>
      DENS = PP/TT/RL<a name='2498'>
      ALA  = 6.6E-6*1.01325E+6/PP*TT/293.15<a name='2499'>
      GR   = 979.69<a name='2500'>
      SI   = 76.1-.155*(TT-273.15)<a name='2501'>
<a name='2502'>
      IF (AA.GT.500.E-4) THEN<a name='2503'>
         BOND = GR*(ROP-DENS)*AA*AA/SI<a name='2504'>
         PART = (SI**3*DENS*DENS/(ETA**4*GR*(ROP-DENS)))**(1./6.)<a name='2505'>
         XX = LOG(16./3.*BOND*PART)<a name='2506'>
         YY = B00+B11*XX+B22*XX*XX+B33*XX**3+B44*XX**4+B55*XX**5<a name='2507'>
         RE = PART*EXP(YY)<a name='2508'>
         VT = ETA*RE/2./DENS/AA<a name='2509'>
      ELSEIF (AA.GT.1.E-3) THEN<a name='2510'>
         CD = 32.*AA*AA*AA*(ROP-DENS)*DENS*GR/3./ETA/ETA<a name='2511'>
         XX = LOG(CD)<a name='2512'>
         RE = EXP(B0+B1*XX+B2*XX*XX+B3*XX**3+B4*XX**4+B5*XX**5+B6*XX**6)<a name='2513'>
         D  = CD/RE/24.-1.<a name='2514'>
         VT = ETA*RE/2./DENS/AA<a name='2515'>
      ELSE<a name='2516'>
         A  = 1.+1.26*ALA/AA<a name='2517'>
         A  = A*2.*AA*AA*GR*(ROP-DENS)/9./ETA<a name='2518'>
         CD = 12*ETA/A/AA/DENS<a name='2519'>
         VT = A<a name='2520'>
      ENDIF<a name='2521'>
<a name='2522'>
      VTBEARD = VT<a name='2523'>
<a name='2524'>
      RETURN<a name='2525'>
      END FUNCTION VTBEARD<a name='2526'>
<a name='2527'>
<a name='2528'>
      <a name='2529'>
<font color=#447700>!-------------------------------------------------- <a name='2530'></font>
<font color=#447700>!     Function f. Coalescence-Efficiency <a name='2531'></font>
<font color=#447700>!     Eq. (7) of Beard and Ochs (1995)<a name='2532'></font>
<font color=#447700>!--------------------------------------------------      <a name='2533'></font>
 <a name='2534'>
<A NAME='ECOALBEARD'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ECOALBEARD' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2535'>
      REAL <font color=#993300>FUNCTION </font><font color=#cc0000>ecoalBeard</font>(D_l,D_s) ,<A href='../../call_from/ECOALBEARD.html' TARGET='index'>2</A><a name='2536'>
       <a name='2537'>
      IMPLICIT NONE <a name='2538'>
<font color=#447700>!     REAL ecoalBeard<a name='2539'></font>
<font color=#447700>!     REAL ECOALMASS<a name='2540'></font>
      REAL            D_l,D_s<a name='2541'>
      REAL            R_s,R_l<a name='2542'>
      REAL            rcoeff<a name='2543'>
      REAL epsf<a name='2544'>
      PARAMETER (epsf  = 1.e-30) <a name='2545'>
<a name='2546'>
      INTEGER its<a name='2547'>
      COMPLEX acoeff(4),x<a name='2548'>
<a name='2549'>
      R_s = 0.5 * D_s<a name='2550'>
      R_l = 0.5 * D_l      <a name='2551'>
<a name='2552'>
      rcoeff = 5.07 - log(R_s*1e4) - log(R_l*1e4/200.0)<a name='2553'>
<a name='2554'>
      acoeff(1) = CMPLX(rcoeff)<a name='2555'>
      acoeff(2) = CMPLX(-5.94)<a name='2556'>
      acoeff(3) = CMPLX(+7.27)<a name='2557'>
      acoeff(4) = CMPLX(-5.29)<a name='2558'>
<a name='2559'>
      x = (0.50,0)<a name='2560'>
<a name='2561'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#LAGUER'>LAGUER</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ECOALBEARD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LAGUER_1">(acoeff,3,x,its)<a name='2562'>
<a name='2563'>
      EcoalBeard = REAL(x)<a name='2564'>
<a name='2565'>
      RETURN <a name='2566'>
      END FUNCTION ecoalBeard <a name='2567'>
<a name='2568'>
<font color=#447700>!--------------------------------------------------       <a name='2569'></font>
<a name='2570'>
<A NAME='LAGUER'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#LAGUER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2571'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>laguer</font>(a,m,x,its) <A href='../../call_to/LAGUER.html' TARGET='index'>2</A><a name='2572'>
      INTEGER m,its,MAXIT,MR,MT<a name='2573'>
      REAL EPSS<a name='2574'>
      COMPLEX a(m+1),x<a name='2575'>
      PARAMETER (EPSS=2.e-7,MR=8,MT=10,MAXIT=MT*MR)<a name='2576'>
      INTEGER iter,j<a name='2577'>
      REAL abx,abp,abm,err,frac(MR)<a name='2578'>
      COMPLEX dx,x1,b,d,f,g,h,sq,gp,gm,g2<a name='2579'>
      SAVE frac<a name='2580'>
      DATA frac /.5,.25,.75,.13,.38,.62,.88,1./<a name='2581'>
      do 12 iter=1,MAXIT<a name='2582'>
        its=iter<a name='2583'>
        b=a(m+1)<a name='2584'>
        err=abs(b)<a name='2585'>
        d=cmplx(0.,0.)<a name='2586'>
        f=cmplx(0.,0.)<a name='2587'>
        abx=abs(x)<a name='2588'>
        do 11 j=m,1,-1<a name='2589'>
          f=x*f+d<a name='2590'>
          d=x*d+b<a name='2591'>
          b=x*b+a(j)<a name='2592'>
          err=abs(b)+abx*err<a name='2593'>
11      continue<a name='2594'>
        err=EPSS*err<a name='2595'>
        if(abs(b).le.err) then<a name='2596'>
          return<a name='2597'>
        else<a name='2598'>
          g=d/b<a name='2599'>
          g2=g*g<a name='2600'>
          h=g2-2.*f/b<a name='2601'>
          sq=sqrt((m-1)*(m*h-g2))<a name='2602'>
          gp=g+sq<a name='2603'>
          gm=g-sq<a name='2604'>
          abp=abs(gp)<a name='2605'>
          abm=abs(gm)<a name='2606'>
          if(abp.lt.abm) gp=gm<a name='2607'>
          if (max(abp,abm).gt.0.) then<a name='2608'>
            dx=m/gp<a name='2609'>
          else<a name='2610'>
            dx=exp(cmplx(log(1.+abx),float(iter)))<a name='2611'>
          endif<a name='2612'>
        endif<a name='2613'>
        x1=x-dx<a name='2614'>
        if(x.eq.x1)return<a name='2615'>
        if (mod(iter,MT).ne.0) then<a name='2616'>
          x=x1<a name='2617'>
        else<a name='2618'>
          x=x-dx*frac(iter/MT)<a name='2619'>
        endif<a name='2620'>
12    continue<a name='2621'>
      pause 'too many iterations in laguer'<a name='2622'>
      return<a name='2623'>
      END SUBROUTINE laguer<a name='2624'>
<a name='2625'>
<a name='2626'>
<a name='2627'>
<a name='2628'>
<A NAME='COURANT_BOTT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COURANT_BOTT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2629'>
      <font color=#993300>subroutine </font><font color=#cc0000>courant_bott</font> <A href='../../call_to/COURANT_BOTT.html' TARGET='index'>2</A><a name='2630'>
      implicit none<a name='2631'>
      integer k,kk,j,i<a name='2632'>
      double precision x0<a name='2633'>
<font color=#447700>! ima(i,j) - k-category number,<a name='2634'></font>
<font color=#447700>! chucm(i,j)   - courant number :<a name='2635'></font>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='2636'></font>
<a name='2637'>
<a name='2638'>
<font color=#447700>!================================================================<a name='2639'></font>
<font color=#447700>! BARRY     <a name='2640'></font>
<font color=#447700>!     print*,'dlnr in courant_bott = ',dlnr<a name='2641'></font>
      xl_mg(0)=xl_mg(1)/2<a name='2642'>
<font color=#447700>! BARRY<a name='2643'></font>
      do i=1,nkr<a name='2644'>
         do j=i,nkr<a name='2645'>
            x0=xl_mg(i)+xl_mg(j)<a name='2646'>
            do k=j,nkr<a name='2647'>
               kk=k<a name='2648'>
               if (k.eq.1)then<a name='2649'>
<font color=#447700>!                  print*,'xl_mg(k) = ',xl_mg(k)<a name='2650'></font>
<font color=#447700>!                  print*,'x0 = ',x0<a name='2651'></font>
<font color=#447700>! xl_mg(k) =   3.351000000000000E-008<a name='2652'></font>
<font color=#447700>!  x0 =   6.702000000000000E-008<a name='2653'></font>
<font color=#447700>!		   read (6,*)<a name='2654'></font>
               end if<a name='2655'>
               if(xl_mg(k).ge.x0.and.xl_mg(k-1).lt.x0) then<a name='2656'>
                 chucm(i,j)=dlog(x0/xl_mg(k-1))/(3.d0*dlnr)<a name='2657'>
 102             continue<a name='2658'>
                 if(chucm(i,j).gt.1.-1.d-08) then<a name='2659'>
                   chucm(i,j)=0.<a name='2660'>
                   kk=kk+1<a name='2661'>
                 endif<a name='2662'>
                 ima(i,j)=min(nkr-1,kk-1)<a name='2663'>
<a name='2664'>
                 goto 2000<a name='2665'>
               endif<a name='2666'>
            enddo<a name='2667'>
 2000       continue<a name='2668'>
<font color=#447700>!            if(i.eq.nkr.or.j.eq.nkr) ima(i,j)=nkr<a name='2669'></font>
            chucm(j,i)=chucm(i,j)<a name='2670'>
            ima(j,i)=ima(i,j)<a name='2671'>
         enddo<a name='2672'>
      enddo<a name='2673'>
      return<a name='2674'>
      end subroutine courant_bott<a name='2675'>
<a name='2676'>
<a name='2677'>
<A NAME='KERNALS'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#KERNALS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2678'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>KERNALS</font>(DTIME) <A href='../../call_to/KERNALS.html' TARGET='index'>6</A>,<A href='../../call_from/KERNALS.html' TARGET='index'>2</A><a name='2679'>
<font color=#447700>! KHAIN30/07/99<a name='2680'></font>
      IMPLICIT NONE<a name='2681'>
      INTEGER I,J<a name='2682'>
      REAL PI<a name='2683'>
<font color=#447700>!******************************************************************<a name='2684'></font>
      data pi/3.141592654/<a name='2685'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='2686'></font>
<font color=#447700>! dlnr - logarithmic grid distance<a name='2687'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='2688'></font>
<font color=#447700>! cw*(i,j) (in cm**3) - multiply help kernel with constant <a name='2689'></font>
<font color=#447700>! timestep(dt) and logarithmic grid distance(dlnr) :<a name='2690'></font>
        REAL DTIME<a name='2691'>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='2692'></font>
<font color=#447700>!       dlnr=dlog(2.d0)/(3.d0*scal)<a name='2693'></font>
<font color=#447700>! scal is micro.prm file parameter(scal=1.d0 for x(k+1)=x(k)*2)<a name='2694'></font>
<font color=#447700>! calculation of cw*(i,j) (in cm**3) - multiply help kernel <a name='2695'></font>
<font color=#447700>! with constant timestep(dtime) and logarithmic grid distance(dlnr) :<a name='2696'></font>
<font color=#447700>!     print*,'dlnr in kernal = ',dlnr,dtime<a name='2697'></font>
        DO I=1,NKR<a name='2698'>
           DO J=1,NKR<a name='2699'>
              CWLL_1000MB(I,J)=DTIME*DLNR*YWLL_1000MB(I,J)<a name='2700'>
              CWLL_750MB(I,J)=DTIME*DLNR*YWLL_750MB(I,J)<a name='2701'>
              CWLL_500MB(I,J)=DTIME*DLNR*YWLL_500MB(I,J)<a name='2702'>
<a name='2703'>
              CWLL(I,J)=DTIME*DLNR*YWLL(I,J)<a name='2704'>
              CWLG(I,J)=DTIME*DLNR*YWLG(I,J)<a name='2705'>
              CWLH(I,J)=DTIME*DLNR*YWLH(I,J)<a name='2706'>
<a name='2707'>
<font color=#447700>! barry<a name='2708'></font>
              if (i.le.16.and.j.le.16)then<a name='2709'>
              CWSL(I,J)=0.d0<a name='2710'>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='2711'></font>
              CWSL(i,j)=DTIME*DLNR*YWIL(I,J,2)<a name='2712'>
              CWLS(I,J)=0.d0<a name='2713'>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2714'></font>
              CWLS(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2715'>
              else<a name='2716'>
              CWSL(I,J)=DTIME*DLNR*YWSL(I,J)<a name='2717'>
              CWLS(I,J)=DTIME*DLNR*YWLS(I,J)<a name='2718'>
              end if<a name='2719'>
              CWSS(I,J)=DTIME*DLNR*YWSS(I,J)<a name='2720'>
              CWSG(I,J)=DTIME*DLNR*YWSG(I,J)<a name='2721'>
              CWSH(I,J)=DTIME*DLNR*YWSH(I,J)<a name='2722'>
<a name='2723'>
              CWGL(I,J)=0.8*DTIME*DLNR*YWGL(I,J)<a name='2724'>
              IF(RADXXO(I,6).LT.2.0D-2) THEN<a name='2725'>
                IF(RADXXO(J,1).LT.1.0D-3) THEN<a name='2726'>
                  IF(RADXXO(J,1).GE.7.0D-4) THEN<a name='2727'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/1.5D0<a name='2728'>
                  ELSE<a name='2729'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/3.0D0<a name='2730'>
                  ENDIF<a name='2731'>
                ENDIF<a name='2732'>
              ENDIF<a name='2733'>
              IF(I.LE.14.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='2734'>
<font color=#447700>!             IF(I.LE.17.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='2735'></font>
<font color=#447700>!             IF(I.LE.14.AND.J.LE.14) CWGL(I,J)=0.0D0<a name='2736'></font>
              CWGS(I,J)=DTIME*DLNR*YWGS(I,J)<a name='2737'>
              CWGG(I,J)=DTIME*DLNR*YWGG(I,J)<a name='2738'>
              CWGH(I,J)=DTIME*DLNR*YWGH(I,J)<a name='2739'>
<a name='2740'>
              CWHL(I,J)=DTIME*DLNR*YWHL(I,J)<a name='2741'>
              CWHS(I,J)=DTIME*DLNR*YWHS(I,J)<a name='2742'>
              CWHG(I,J)=DTIME*DLNR*YWHG(I,J)<a name='2743'>
              CWHH(I,J)=DTIME*DLNR*YWHH(I,J)<a name='2744'>
<a name='2745'>
              CWLI_1(I,J)=DTIME*DLNR*YWLI(I,J,1)<a name='2746'>
              CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2747'>
              CWLI_3(I,J)=DTIME*DLNR*YWLI(I,J,3)<a name='2748'>
              <a name='2749'>
              CWIL_1(I,J)=DTIME*DLNR*YWIL(I,J,1)<a name='2750'>
              CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='2751'>
              CWIL_3(I,J)=DTIME*DLNR*YWIL(I,J,3)<a name='2752'>
<a name='2753'>
              CWIS_1(I,J)=DTIME*DLNR*YWIS(I,J,1)<a name='2754'>
              CWIS_2(I,J)=DTIME*DLNR*YWIS(I,J,2)<a name='2755'>
              CWIS_3(I,J)=DTIME*DLNR*YWIS(I,J,3)<a name='2756'>
<a name='2757'>
              CWSI_1(I,J)=DTIME*DLNR*YWSI(I,J,1)<a name='2758'>
              CWSI_2(I,J)=DTIME*DLNR*YWSI(I,J,2)<a name='2759'>
              CWSI_3(I,J)=DTIME*DLNR*YWSI(I,J,3)<a name='2760'>
<a name='2761'>
              CWIG_1(I,J)=DTIME*DLNR*YWIG(I,J,1)<a name='2762'>
              CWIG_2(I,J)=DTIME*DLNR*YWIG(I,J,2)<a name='2763'>
              CWIG_3(I,J)=DTIME*DLNR*YWIG(I,J,3)<a name='2764'>
<a name='2765'>
              CWGI_1(I,J)=DTIME*DLNR*YWGI(I,J,1)<a name='2766'>
              CWGI_2(I,J)=DTIME*DLNR*YWGI(I,J,2)<a name='2767'>
              CWGI_3(I,J)=DTIME*DLNR*YWGI(I,J,3)<a name='2768'>
<a name='2769'>
              CWIH_1(I,J)=DTIME*DLNR*YWIH(I,J,1)<a name='2770'>
              CWIH_2(I,J)=DTIME*DLNR*YWIH(I,J,2)<a name='2771'>
              CWIH_3(I,J)=DTIME*DLNR*YWIH(I,J,3)<a name='2772'>
<a name='2773'>
              CWHI_1(I,J)=DTIME*DLNR*YWHI(I,J,1)<a name='2774'>
              CWHI_2(I,J)=DTIME*DLNR*YWHI(I,J,2)<a name='2775'>
              CWHI_3(I,J)=DTIME*DLNR*YWHI(I,J,3)<a name='2776'>
<font color=#447700>! barry<a name='2777'></font>
              if (i.lt.12.and.j.lt.12)then<a name='2778'>
<a name='2779'>
               CWII_1_1(I,J)=0.D0<a name='2780'>
               CWII_1_2(I,J)=0.D0<a name='2781'>
               CWII_1_3(I,J)=0.D0<a name='2782'>
<a name='2783'>
               CWII_2_1(I,J)=0.D0<a name='2784'>
               CWII_2_2(I,J)=0.D0<a name='2785'>
               CWII_2_3(I,J)=0.D0<a name='2786'>
<a name='2787'>
               CWII_3_1(I,J)=0.D0<a name='2788'>
               CWII_3_2(I,J)=0.D0<a name='2789'>
               CWII_3_3(I,J)=0.D0<a name='2790'>
<font color=#447700>!barry<a name='2791'></font>
              else<a name='2792'>
               CWII_1_1(I,J)=DTIME*DLNR*YWII(I,J,1,1)<a name='2793'>
               CWII_1_2(I,J)=DTIME*DLNR*YWII(I,J,1,2)<a name='2794'>
               CWII_1_3(I,J)=DTIME*DLNR*YWII(I,J,1,3)<a name='2795'>
<a name='2796'>
               CWII_2_1(I,J)=DTIME*DLNR*YWII(I,J,2,1)<a name='2797'>
               CWII_2_2(I,J)=DTIME*DLNR*YWII(I,J,2,2)<a name='2798'>
               CWII_2_3(I,J)=DTIME*DLNR*YWII(I,J,2,3)<a name='2799'>
<a name='2800'>
               CWII_3_1(I,J)=DTIME*DLNR*YWII(I,J,3,1)<a name='2801'>
               CWII_3_2(I,J)=DTIME*DLNR*YWII(I,J,3,2)<a name='2802'>
               CWII_3_3(I,J)=DTIME*DLNR*YWII(I,J,3,3)<a name='2803'>
              end if<a name='2804'>
           ENDDO<a name='2805'>
        ENDDO<a name='2806'>
<font color=#447700>!       GO TO 88<a name='2807'></font>
<font color=#447700>! NEW CHANGES 2.06.01 (BEGIN)<a name='2808'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF'>TURBCOEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TURBCOEF_1"><a name='2809'>
        DO J=1,7<a name='2810'>
           DO I=15,24-J<a name='2811'>
              CWGL(I,J)=0.0D0<a name='2812'>
           ENDDO<a name='2813'>
        ENDDO<a name='2814'>
<font color=#447700>! NEW CHANGES 2.06.01 (END)<a name='2815'></font>
<font color=#447700>! NEW CHANGES 3.02.01 (BEGIN)<a name='2816'></font>
        DO I=1,NKR<a name='2817'>
           DO J=1,NKR<a name='2818'>
              CWLG(J,I)=CWGL(I,J)<a name='2819'>
           ENDDO<a name='2820'>
        ENDDO<a name='2821'>
<font color=#447700>!       print*, 'ICETURB = ',ICETURB<a name='2822'></font>
          DO I=KRMING_GL,KRMAXG_GL<a name='2823'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='2824'>
               IF (ICETURB.EQ.1)THEN<a name='2825'>
                CWGL(I,J)=CTURBGL(I,J)*CWGL(I,J)<a name='2826'>
               ELSE<a name='2827'>
                CWGL(I,J)=CWGL(I,J)<a name='2828'>
               END IF<a name='2829'>
             ENDDO<a name='2830'>
          ENDDO<a name='2831'>
          DO I=KRMING_GL,KRMAXG_GL<a name='2832'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='2833'>
                CWLG(J,I)=CWGL(I,J)<a name='2834'>
             ENDDO<a name='2835'>
          ENDDO<a name='2836'>
<a name='2837'>
88     CONTINUE<a name='2838'>
	RETURN<a name='2839'>
	END SUBROUTINE KERNALS<a name='2840'>
<a name='2841'>
<A NAME='KERNALS_IN'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#KERNALS_IN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2842'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>KERNALS_IN</font>(DTIME),<A href='../../call_from/KERNALS_IN.html' TARGET='index'>2</A><a name='2843'>
<font color=#447700>! KHAIN30/07/99<a name='2844'></font>
      IMPLICIT NONE<a name='2845'>
      INTEGER I,J<a name='2846'>
      REAL PI<a name='2847'>
<font color=#447700>!******************************************************************<a name='2848'></font>
      data pi/3.141592654/<a name='2849'>
<font color=#447700>! dtime - timestep of integration (calculated in main program) :<a name='2850'></font>
<font color=#447700>! dlnr - logarithmic grid distance<a name='2851'></font>
<font color=#447700>! ima(i,j) - k-category number, c(i,j) - courant number <a name='2852'></font>
<font color=#447700>! cw*(i,j) (in cm**3) - multiply help kernel with constant <a name='2853'></font>
<font color=#447700>! timestep(dt) and logarithmic grid distance(dlnr) :<a name='2854'></font>
        REAL DTIME<a name='2855'>
<font color=#447700>! logarithmic grid distance(dlnr) :<a name='2856'></font>
<font color=#447700>!       dlnr=dlog(2.d0)/(3.d0*scal)<a name='2857'></font>
<font color=#447700>! scal is micro.prm file parameter(scal=1.d0 for x(k+1)=x(k)*2)<a name='2858'></font>
<font color=#447700>! calculation of cw*(i,j) (in cm**3) - multiply help kernel <a name='2859'></font>
<font color=#447700>! with constant timestep(dtime) and logarithmic grid distance(dlnr) :<a name='2860'></font>
<font color=#447700>!     print*,'dlnr in kernal = ',dlnr,dtime<a name='2861'></font>
        DO I=1,NKR<a name='2862'>
           DO J=1,NKR<a name='2863'>
              CWLL_1000MB(I,J)=DTIME*DLNR*YWLL_1000MB(I,J)<a name='2864'>
              CWLL_750MB(I,J)=DTIME*DLNR*YWLL_750MB(I,J)<a name='2865'>
              CWLL_500MB(I,J)=DTIME*DLNR*YWLL_500MB(I,J)<a name='2866'>
<a name='2867'>
              CWLL(I,J)=DTIME*DLNR*YWLL(I,J)<a name='2868'>
              CWLG(I,J)=DTIME*DLNR*YWLG(I,J)<a name='2869'>
<font color=#447700>!             CWLH(I,J)=DTIME*DLNR*YWLH(I,J)<a name='2870'></font>
<a name='2871'>
<font color=#447700>! barry<a name='2872'></font>
              if (i.le.16.and.j.le.16)then<a name='2873'>
              CWSL(I,J)=0.d0<a name='2874'>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='2875'></font>
              CWSL(i,j)=DTIME*DLNR*YWIL(I,J,2)<a name='2876'>
              CWLS(I,J)=0.d0<a name='2877'>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2878'></font>
              CWLS(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2879'>
              else<a name='2880'>
              CWSL(I,J)=DTIME*DLNR*YWSL(I,J)<a name='2881'>
              CWLS(I,J)=DTIME*DLNR*YWLS(I,J)<a name='2882'>
              end if<a name='2883'>
              CWSS(I,J)=DTIME*DLNR*YWSS(I,J)<a name='2884'>
              CWSG(I,J)=DTIME*DLNR*YWSG(I,J)<a name='2885'>
<font color=#447700>!             CWSH(I,J)=DTIME*DLNR*YWSH(I,J)<a name='2886'></font>
<a name='2887'>
              CWGL(I,J)=0.8*DTIME*DLNR*YWGL(I,J)<a name='2888'>
              IF(RADXXO(I,6).LT.2.0D-2) THEN<a name='2889'>
                IF(RADXXO(J,1).LT.1.0D-3) THEN<a name='2890'>
                  IF(RADXXO(J,1).GE.7.0D-4) THEN<a name='2891'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/1.5D0<a name='2892'>
                  ELSE<a name='2893'>
                    CWGL(I,J)=DTIME*DLNR*YWGL(I,J)/3.0D0<a name='2894'>
                  ENDIF<a name='2895'>
                ENDIF<a name='2896'>
              ENDIF<a name='2897'>
              IF(I.LE.14.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='2898'>
<font color=#447700>!             IF(I.LE.17.AND.J.LE.7) CWGL(I,J)=0.0D0<a name='2899'></font>
<font color=#447700>!             IF(I.LE.14.AND.J.LE.14) CWGL(I,J)=0.0D0<a name='2900'></font>
              CWGS(I,J)=DTIME*DLNR*YWGS(I,J)<a name='2901'>
              CWGG(I,J)=DTIME*DLNR*YWGG(I,J)<a name='2902'>
<font color=#447700>!             CWGH(I,J)=DTIME*DLNR*YWGH(I,J)<a name='2903'></font>
<a name='2904'>
<font color=#447700>!             CWHL(I,J)=DTIME*DLNR*YWHL(I,J)<a name='2905'></font>
<font color=#447700>!             CWHS(I,J)=DTIME*DLNR*YWHS(I,J)<a name='2906'></font>
<font color=#447700>!             CWHG(I,J)=DTIME*DLNR*YWHG(I,J)<a name='2907'></font>
<font color=#447700>!             CWHH(I,J)=DTIME*DLNR*YWHH(I,J)<a name='2908'></font>
<a name='2909'>
<font color=#447700>!             CWLI_1(I,J)=DTIME*DLNR*YWLI(I,J,1)<a name='2910'></font>
<font color=#447700>!             CWLI_2(I,J)=DTIME*DLNR*YWLI(I,J,2)<a name='2911'></font>
<font color=#447700>!             CWLI_3(I,J)=DTIME*DLNR*YWLI(I,J,3)<a name='2912'></font>
              <a name='2913'>
<font color=#447700>!             CWIL_1(I,J)=DTIME*DLNR*YWIL(I,J,1)<a name='2914'></font>
<font color=#447700>!             CWIL_2(I,J)=DTIME*DLNR*YWIL(I,J,2)<a name='2915'></font>
<font color=#447700>!             CWIL_3(I,J)=DTIME*DLNR*YWIL(I,J,3)<a name='2916'></font>
<a name='2917'>
<font color=#447700>!             CWIS_1(I,J)=DTIME*DLNR*YWIS(I,J,1)<a name='2918'></font>
<font color=#447700>!             CWIS_2(I,J)=DTIME*DLNR*YWIS(I,J,2)<a name='2919'></font>
<font color=#447700>!             CWIS_3(I,J)=DTIME*DLNR*YWIS(I,J,3)<a name='2920'></font>
<a name='2921'>
<font color=#447700>!             CWSI_1(I,J)=DTIME*DLNR*YWSI(I,J,1)<a name='2922'></font>
<font color=#447700>!             CWSI_2(I,J)=DTIME*DLNR*YWSI(I,J,2)<a name='2923'></font>
<font color=#447700>!             CWSI_3(I,J)=DTIME*DLNR*YWSI(I,J,3)<a name='2924'></font>
<a name='2925'>
<font color=#447700>!             CWIG_1(I,J)=DTIME*DLNR*YWIG(I,J,1)<a name='2926'></font>
<font color=#447700>!             CWIG_2(I,J)=DTIME*DLNR*YWIG(I,J,2)<a name='2927'></font>
<font color=#447700>!             CWIG_3(I,J)=DTIME*DLNR*YWIG(I,J,3)<a name='2928'></font>
<a name='2929'>
<font color=#447700>!             CWGI_1(I,J)=DTIME*DLNR*YWGI(I,J,1)<a name='2930'></font>
<font color=#447700>!             CWGI_2(I,J)=DTIME*DLNR*YWGI(I,J,2)<a name='2931'></font>
<font color=#447700>!             CWGI_3(I,J)=DTIME*DLNR*YWGI(I,J,3)<a name='2932'></font>
<a name='2933'>
<font color=#447700>!             CWIH_1(I,J)=DTIME*DLNR*YWIH(I,J,1)<a name='2934'></font>
<font color=#447700>!             CWIH_2(I,J)=DTIME*DLNR*YWIH(I,J,2)<a name='2935'></font>
<font color=#447700>!             CWIH_3(I,J)=DTIME*DLNR*YWIH(I,J,3)<a name='2936'></font>
<a name='2937'>
<font color=#447700>!             CWHI_1(I,J)=DTIME*DLNR*YWHI(I,J,1)<a name='2938'></font>
<font color=#447700>!             CWHI_2(I,J)=DTIME*DLNR*YWHI(I,J,2)<a name='2939'></font>
<font color=#447700>!             CWHI_3(I,J)=DTIME*DLNR*YWHI(I,J,3)<a name='2940'></font>
<font color=#447700>! barry<a name='2941'></font>
              if (i.lt.12.and.j.lt.12)then<a name='2942'>
<a name='2943'>
<font color=#447700>!              CWII_1_1(I,J)=0.D0<a name='2944'></font>
<font color=#447700>!              CWII_1_2(I,J)=0.D0<a name='2945'></font>
<font color=#447700>!              CWII_1_3(I,J)=0.D0<a name='2946'></font>
<a name='2947'>
<font color=#447700>!              CWII_2_1(I,J)=0.D0<a name='2948'></font>
<font color=#447700>!              CWII_2_2(I,J)=0.D0<a name='2949'></font>
<font color=#447700>!              CWII_2_3(I,J)=0.D0<a name='2950'></font>
<a name='2951'>
<font color=#447700>!              CWII_3_1(I,J)=0.D0<a name='2952'></font>
<font color=#447700>!              CWII_3_2(I,J)=0.D0<a name='2953'></font>
<font color=#447700>!              CWII_3_3(I,J)=0.D0<a name='2954'></font>
<font color=#447700>!barry<a name='2955'></font>
              else<a name='2956'>
<font color=#447700>!              CWII_1_1(I,J)=DTIME*DLNR*YWII(I,J,1,1)<a name='2957'></font>
<font color=#447700>!              CWII_1_2(I,J)=DTIME*DLNR*YWII(I,J,1,2)<a name='2958'></font>
<font color=#447700>!              CWII_1_3(I,J)=DTIME*DLNR*YWII(I,J,1,3)<a name='2959'></font>
<a name='2960'>
<font color=#447700>!              CWII_2_1(I,J)=DTIME*DLNR*YWII(I,J,2,1)<a name='2961'></font>
<font color=#447700>!              CWII_2_2(I,J)=DTIME*DLNR*YWII(I,J,2,2)<a name='2962'></font>
<font color=#447700>!              CWII_2_3(I,J)=DTIME*DLNR*YWII(I,J,2,3)<a name='2963'></font>
<a name='2964'>
<font color=#447700>!              CWII_3_1(I,J)=DTIME*DLNR*YWII(I,J,3,1)<a name='2965'></font>
<font color=#447700>!              CWII_3_2(I,J)=DTIME*DLNR*YWII(I,J,3,2)<a name='2966'></font>
<font color=#447700>!              CWII_3_3(I,J)=DTIME*DLNR*YWII(I,J,3,3)<a name='2967'></font>
              end if<a name='2968'>
           ENDDO<a name='2969'>
        ENDDO<a name='2970'>
<font color=#447700>!       GO TO 88<a name='2971'></font>
<font color=#447700>! NEW CHANGES 2.06.01 (BEGIN)<a name='2972'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF'>TURBCOEF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#KERNALS_IN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TURBCOEF_2"><a name='2973'>
        DO J=1,7<a name='2974'>
           DO I=15,24-J<a name='2975'>
              CWGL(I,J)=0.0D0<a name='2976'>
           ENDDO<a name='2977'>
        ENDDO<a name='2978'>
<font color=#447700>! NEW CHANGES 2.06.01 (END)<a name='2979'></font>
<font color=#447700>! NEW CHANGES 3.02.01 (BEGIN)<a name='2980'></font>
        DO I=1,NKR<a name='2981'>
           DO J=1,NKR<a name='2982'>
              CWLG(J,I)=CWGL(I,J)<a name='2983'>
           ENDDO<a name='2984'>
        ENDDO<a name='2985'>
<font color=#447700>!       print*, 'ICETURB = ',ICETURB<a name='2986'></font>
          DO I=KRMING_GL,KRMAXG_GL<a name='2987'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='2988'>
               IF (ICETURB.EQ.1)THEN<a name='2989'>
                CWGL(I,J)=CTURBGL(I,J)*CWGL(I,J)<a name='2990'>
               ELSE<a name='2991'>
                CWGL(I,J)=CWGL(I,J)<a name='2992'>
               END IF<a name='2993'>
             ENDDO<a name='2994'>
          ENDDO<a name='2995'>
          DO I=KRMING_GL,KRMAXG_GL<a name='2996'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='2997'>
                CWLG(J,I)=CWGL(I,J)<a name='2998'>
             ENDDO<a name='2999'>
          ENDDO<a name='3000'>
<a name='3001'>
88     CONTINUE<a name='3002'>
	RETURN<a name='3003'>
	END SUBROUTINE KERNALS_IN<a name='3004'>
<A NAME='TURBCOEF'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#TURBCOEF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3005'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>TURBCOEF</font> <A href='../../call_to/TURBCOEF.html' TARGET='index'>4</A>,<A href='../../call_from/TURBCOEF.html' TARGET='index'>4</A><a name='3006'>
        IMPLICIT NONE<a name='3007'>
        INTEGER I,J<a name='3008'>
<font color=#447700>!       DOUBLE PRECISION X_KERN,Y_KERN,F<a name='3009'></font>
        DOUBLE PRECISION X_KERN,Y_KERN<a name='3010'>
	DOUBLE PRECISION RL_LL(K0_LL),RL_GL(K0L_GL),RG_GL(K0G_GL)<a name='3011'>
          RL_LL(1)=RADXXO(KRMIN_LL,1)*1.E4<a name='3012'>
          RL_LL(2)=10.0D0<a name='3013'>
          RL_LL(3)=20.0D0<a name='3014'>
          RL_LL(4)=30.0D0<a name='3015'>
          RL_LL(5)=40.0D0<a name='3016'>
          RL_LL(6)=50.0D0<a name='3017'>
          RL_LL(7)=60.0D0<a name='3018'>
          RL_LL(8)=RADXXO(KRMAX_LL,1)*1.E4<a name='3019'>
          DO J=1,K0_LL<a name='3020'>
             DO I=1,K0_LL<a name='3021'>
                CTURB_LL(I,J)=1.0D0<a name='3022'>
             ENDDO<a name='3023'>
          ENDDO <a name='3024'>
	  CTURB_LL(1,1)=4.50D0<a name='3025'>
	  CTURB_LL(1,2)=4.50D0<a name='3026'>
	  CTURB_LL(1,3)=3.00D0<a name='3027'>
	  CTURB_LL(1,4)=2.25D0<a name='3028'>
	  CTURB_LL(1,5)=1.95D0<a name='3029'>
	  CTURB_LL(1,6)=1.40D0<a name='3030'>
	  CTURB_LL(1,7)=1.40D0<a name='3031'>
	  CTURB_LL(1,8)=1.40D0<a name='3032'>
<a name='3033'>
	  CTURB_LL(2,1)=4.50D0<a name='3034'>
	  CTURB_LL(2,2)=4.50D0<a name='3035'>
	  CTURB_LL(2,3)=3.00D0<a name='3036'>
	  CTURB_LL(2,4)=2.25D0<a name='3037'>
	  CTURB_LL(2,5)=1.95D0<a name='3038'>
	  CTURB_LL(2,6)=1.40D0<a name='3039'>
	  CTURB_LL(2,7)=1.40D0<a name='3040'>
	  CTURB_LL(2,8)=1.40D0<a name='3041'>
<a name='3042'>
	  CTURB_LL(3,1)=3.00D0<a name='3043'>
	  CTURB_LL(3,2)=3.00D0<a name='3044'>
	  CTURB_LL(3,3)=2.70D0<a name='3045'>
	  CTURB_LL(3,4)=2.25D0<a name='3046'>
	  CTURB_LL(3,5)=1.65D0<a name='3047'>
	  CTURB_LL(3,6)=1.40D0<a name='3048'>
	  CTURB_LL(3,7)=1.40D0<a name='3049'>
	  CTURB_LL(3,8)=1.40D0<a name='3050'>
<a name='3051'>
	  CTURB_LL(4,1)=2.25D0<a name='3052'>
	  CTURB_LL(4,2)=2.25D0<a name='3053'>
	  CTURB_LL(4,3)=2.25D0<a name='3054'>
	  CTURB_LL(4,4)=1.95D0<a name='3055'>
	  CTURB_LL(4,5)=1.65D0<a name='3056'>
	  CTURB_LL(4,6)=1.40D0<a name='3057'>
	  CTURB_LL(4,7)=1.40D0<a name='3058'>
	  CTURB_LL(4,8)=1.40D0<a name='3059'>
<a name='3060'>
	  CTURB_LL(5,1)=1.95D0<a name='3061'>
	  CTURB_LL(5,2)=1.95D0<a name='3062'>
	  CTURB_LL(5,3)=1.65D0<a name='3063'>
	  CTURB_LL(5,4)=1.65D0<a name='3064'>
	  CTURB_LL(5,5)=1.65D0<a name='3065'>
	  CTURB_LL(5,6)=1.40D0<a name='3066'>
	  CTURB_LL(5,7)=1.40D0<a name='3067'>
	  CTURB_LL(5,8)=1.40D0<a name='3068'>
<a name='3069'>
	  CTURB_LL(6,1)=1.40D0<a name='3070'>
	  CTURB_LL(6,2)=1.40D0<a name='3071'>
	  CTURB_LL(6,3)=1.40D0<a name='3072'>
	  CTURB_LL(6,4)=1.40D0<a name='3073'>
	  CTURB_LL(6,5)=1.40D0<a name='3074'>
	  CTURB_LL(6,6)=1.40D0<a name='3075'>
	  CTURB_LL(6,7)=1.40D0<a name='3076'>
	  CTURB_LL(6,8)=1.40D0<a name='3077'>
<a name='3078'>
	  CTURB_LL(7,1)=1.40D0<a name='3079'>
	  CTURB_LL(7,2)=1.40D0<a name='3080'>
	  CTURB_LL(7,3)=1.40D0<a name='3081'>
	  CTURB_LL(7,4)=1.40D0<a name='3082'>
	  CTURB_LL(7,5)=1.40D0<a name='3083'>
	  CTURB_LL(7,6)=1.40D0<a name='3084'>
	  CTURB_LL(7,7)=1.40D0<a name='3085'>
	  CTURB_LL(7,8)=1.40D0<a name='3086'>
<a name='3087'>
	  CTURB_LL(8,1)=1.40D0<a name='3088'>
	  CTURB_LL(8,2)=1.40D0<a name='3089'>
	  CTURB_LL(8,3)=1.40D0<a name='3090'>
	  CTURB_LL(8,4)=1.40D0<a name='3091'>
	  CTURB_LL(8,5)=1.40D0<a name='3092'>
	  CTURB_LL(8,6)=1.40D0<a name='3093'>
	  CTURB_LL(8,7)=1.40D0<a name='3094'>
	  CTURB_LL(8,8)=1.40D0<a name='3095'>
          DO J=1,K0_LL<a name='3096'>
             DO I=1,K0_LL<a name='3097'>
                CTURB_LL(I,J)=(CTURB_LL(I,J)-1.0D0)/1.5D0+1.0D0<a name='3098'>
             ENDDO<a name='3099'>
          ENDDO<a name='3100'>
	  DO I=KRMIN_LL,KRMAX_LL<a name='3101'>
             DO J=KRMIN_LL,KRMAX_LL<a name='3102'>
                CTURBLL(I,J)=1.0D0<a name='3103'>
             ENDDO<a name='3104'>
          ENDDO<a name='3105'>
          DO I=KRMIN_LL,KRMAX_LL<a name='3106'>
             X_KERN=RADXXO(I,1)*1.0D4<a name='3107'>
             IF(X_KERN.LT.RL_LL(1)) X_KERN=RL_LL(1)<a name='3108'>
             IF(X_KERN.GT.RL_LL(K0_LL)) X_KERN=RL_LL(K0_LL) <a name='3109'>
             DO J=KRMIN_LL,KRMAX_LL<a name='3110'>
                Y_KERN=RADXXO(J,1)*1.0D4<a name='3111'>
                IF(Y_KERN.LT.RL_LL(1)) Y_KERN=RL_LL(1)<a name='3112'>
                IF(Y_KERN.GT.RL_LL(K0_LL)) Y_KERN=RL_LL(K0_LL)<a name='3113'>
                CTURBLL(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>F</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_14">(X_KERN,Y_KERN,RL_LL,RL_LL,CTURB_LL &amp;<a name='3114'>
     &amp;                      ,K0_LL,K0_LL)	                         <a name='3115'>
             ENDDO<a name='3116'>
          ENDDO<a name='3117'>
          RL_GL(1) = RADXXO(1,1)*1.E4 <a name='3118'>
          RL_GL(2) = 8.0D0<a name='3119'>
          RL_GL(3) = 10.0D0<a name='3120'>
	  RL_GL(4) = 16.0D0<a name='3121'>
          RL_GL(5) = 20.0D0<a name='3122'>
          RL_GL(6) = 30.0D0<a name='3123'>
          RL_GL(7) = 40.0D0<a name='3124'>
          RL_GL(8) = 50.0D0<a name='3125'>
          RL_GL(9) = 60.0D0<a name='3126'>
          RL_GL(10)= 70.0D0<a name='3127'>
          RL_GL(11)= 80.0D0<a name='3128'>
	  RL_GL(12)= 90.0D0<a name='3129'>
	  RL_GL(13)=100.0D0<a name='3130'>
	  RL_GL(14)=200.0D0<a name='3131'>
	  RL_GL(15)=300.0D0<a name='3132'>
	  RL_GL(16)=RADXXO(24,1)*1.0D4<a name='3133'>
<font color=#447700>! TURBULENCE GRAUPEL BULK RADII IN MKM<a name='3134'></font>
          RG_GL(1) = RADXXO(1,6)*1.0D4 <a name='3135'>
          RG_GL(2) = 30.0D0  <a name='3136'>
          RG_GL(3) = 60.0D0 <a name='3137'>
          RG_GL(4) = 100.0D0 <a name='3138'>
          RG_GL(5) = 200.0D0 <a name='3139'>
	  RG_GL(6) = 300.0D0<a name='3140'>
	  RG_GL(7) = 400.0D0<a name='3141'>
	  RG_GL(8) = 500.0D0<a name='3142'>
	  RG_GL(9) = 600.0D0<a name='3143'>
	  RG_GL(10)= 700.0D0<a name='3144'>
	  RG_GL(11)= 800.0D0<a name='3145'>
	  RG_GL(12)= 900.0D0<a name='3146'>
	  RG_GL(13)=1000.0D0<a name='3147'>
	  RG_GL(14)=2000.0D0<a name='3148'>
	  RG_GL(15)=3000.0D0<a name='3149'>
	  RG_GL(16)=RADXXO(33,6)*1.0D4<a name='3150'>
	  DO I=KRMING_GL,KRMAXG_GL<a name='3151'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3152'>
                CTURBGL(I,J)=1.0D0<a name='3153'>
             ENDDO<a name='3154'>
          ENDDO<a name='3155'>
          DO I=1,K0G_GL<a name='3156'>
             DO J=1,K0L_GL<a name='3157'>
                CTURB_GL(I,J)=1.0D0<a name='3158'>
             ENDDO<a name='3159'>
          ENDDO <a name='3160'>
          IF(IEPS_400.EQ.1) THEN<a name='3161'>
	    CTURB_GL(1,1)=0.0D0<a name='3162'>
	    CTURB_GL(1,2)=0.0D0<a name='3163'>
	    CTURB_GL(1,3)=1.2D0<a name='3164'>
	    CTURB_GL(1,4)=1.3D0<a name='3165'>
	    CTURB_GL(1,5)=1.4D0<a name='3166'>
	    CTURB_GL(1,6)=1.5D0<a name='3167'>
	    CTURB_GL(1,7)=1.5D0<a name='3168'>
	    CTURB_GL(1,8)=1.5D0<a name='3169'>
	    CTURB_GL(1,9)=1.5D0<a name='3170'>
	    CTURB_GL(1,10)=1.5D0<a name='3171'>
	    CTURB_GL(1,11)=1.5D0<a name='3172'>
	    CTURB_GL(1,12)=1.0D0<a name='3173'>
	    CTURB_GL(1,13)=1.0D0<a name='3174'>
	    CTURB_GL(1,14)=1.0D0<a name='3175'>
	    CTURB_GL(1,15)=1.0D0<a name='3176'>
	<a name='3177'>
	    CTURB_GL(2,1)=1.0D0<a name='3178'>
	    CTURB_GL(2,2)=1.4D0<a name='3179'>
	    CTURB_GL(2,3)=1.8D0<a name='3180'>
	    CTURB_GL(2,4)=2.2D0<a name='3181'>
	    CTURB_GL(2,5)=2.6D0<a name='3182'>
	    CTURB_GL(2,6)=3.0D0<a name='3183'>
	    CTURB_GL(2,7)=2.85D0<a name='3184'>
	    CTURB_GL(2,8)=2.7D0<a name='3185'>
	    CTURB_GL(2,9)=2.55D0<a name='3186'>
	    CTURB_GL(2,10)=2.4D0<a name='3187'>
	    CTURB_GL(2,11)=2.25D0<a name='3188'>
	    CTURB_GL(2,12)=1.0D0<a name='3189'>
	    CTURB_GL(2,13)=1.0D0<a name='3190'>
	    CTURB_GL(2,14)=1.0D0<a name='3191'>
<a name='3192'>
	    CTURB_GL(3,1)=7.5D0<a name='3193'>
	    CTURB_GL(3,2)=7.5D0<a name='3194'>
	    CTURB_GL(3,3)=4.5D0	<a name='3195'>
	    CTURB_GL(3,4)=4.5D0	<a name='3196'>
	    CTURB_GL(3,5)=4.65D0	<a name='3197'>
	    CTURB_GL(3,6)=4.65D0	<a name='3198'>
	    CTURB_GL(3,7)=4.5D0	<a name='3199'>
	    CTURB_GL(3,8)=4.5D0	<a name='3200'>
	    CTURB_GL(3,9)=4.0D0	<a name='3201'>
	    CTURB_GL(3,10)=3.0D0	<a name='3202'>
	    CTURB_GL(3,11)=2.0D0	<a name='3203'>
	    CTURB_GL(3,12)=1.5D0	<a name='3204'>
	    CTURB_GL(3,13)=1.3D0	<a name='3205'>
	    CTURB_GL(3,14)=1.0D0	<a name='3206'>
    <a name='3207'>
	    CTURB_GL(4,1)=5.5D0<a name='3208'>
	    CTURB_GL(4,2)=5.5D0<a name='3209'>
	    CTURB_GL(4,3)=4.5D0<a name='3210'>
	    CTURB_GL(4,4)=4.5D0<a name='3211'>
	    CTURB_GL(4,5)=4.65D0<a name='3212'>
	    CTURB_GL(4,6)=4.65D0<a name='3213'>
	    CTURB_GL(4,7)=4.5D0<a name='3214'>
	    CTURB_GL(4,8)=4.5D0<a name='3215'>
	    CTURB_GL(4,9)=4.0D0<a name='3216'>
	    CTURB_GL(4,10)=3.0D0<a name='3217'>
	    CTURB_GL(4,11)=2.0D0<a name='3218'>
	    CTURB_GL(4,12)=1.5D0<a name='3219'>
	    CTURB_GL(4,13)=1.35D0<a name='3220'>
	    CTURB_GL(4,14)=1.0D0<a name='3221'>
	 <a name='3222'>
	    CTURB_GL(5,1)=4.5D0<a name='3223'>
	    CTURB_GL(5,2)=4.5D0<a name='3224'>
	    CTURB_GL(5,3)=3.3D0	<a name='3225'>
	    CTURB_GL(5,4)=3.3D0	<a name='3226'>
	    CTURB_GL(5,5)=3.3D0	<a name='3227'>
	    CTURB_GL(5,6)=3.4D0	<a name='3228'>
	    CTURB_GL(5,7)=3.8D0	<a name='3229'>
	    CTURB_GL(5,8)=3.8D0	<a name='3230'>
	    CTURB_GL(5,9)=3.8D0	<a name='3231'>
	    CTURB_GL(5,10)=3.6D0<a name='3232'>
	    CTURB_GL(5,11)=2.5D0	<a name='3233'>
	    CTURB_GL(5,12)=2.0D0	<a name='3234'>
	    CTURB_GL(5,13)=1.4D0	<a name='3235'>
	    CTURB_GL(5,14)=1.0D0	<a name='3236'>
			 		<a name='3237'>
	    CTURB_GL(6,1)=4.0D0<a name='3238'>
	    CTURB_GL(6,2)=4.0D0<a name='3239'>
	    CTURB_GL(6,3)=2.8D0<a name='3240'>
	    CTURB_GL(6,4)=2.8D0<a name='3241'>
	    CTURB_GL(6,5)=2.85D0<a name='3242'>
	    CTURB_GL(6,6)=2.9D0<a name='3243'>
	    CTURB_GL(6,7)=3.0D0<a name='3244'>
	    CTURB_GL(6,8)=3.1D0<a name='3245'>
	    CTURB_GL(6,9)=2.9D0<a name='3246'>
	    CTURB_GL(6,10)=2.6D0<a name='3247'>
	    CTURB_GL(6,11)=2.5D0<a name='3248'>
	    CTURB_GL(6,12)=2.0D0<a name='3249'>
	    CTURB_GL(6,13)=1.3D0<a name='3250'>
	    CTURB_GL(6,14)=1.1D0<a name='3251'>
<a name='3252'>
	    CTURB_GL(7,1)=3.5D0<a name='3253'>
	    CTURB_GL(7,2)=3.5D0<a name='3254'>
	    CTURB_GL(7,3)=2.5D0<a name='3255'>
	    CTURB_GL(7,4)=2.5D0<a name='3256'>
	    CTURB_GL(7,5)=2.6D0<a name='3257'>
	    CTURB_GL(7,6)=2.7D0<a name='3258'>
	    CTURB_GL(7,7)=2.8D0<a name='3259'>
	    CTURB_GL(7,8)=2.8D0<a name='3260'>
	    CTURB_GL(7,9)=2.8D0<a name='3261'>
	    CTURB_GL(7,10)=2.6D0<a name='3262'>
	    CTURB_GL(7,11)=2.3D0<a name='3263'>
	    CTURB_GL(7,12)=2.0D0<a name='3264'>
	    CTURB_GL(7,13)=1.3D0<a name='3265'>
	    CTURB_GL(7,14)=1.1D0<a name='3266'>
<a name='3267'>
	    CTURB_GL(8,1)=3.25D0<a name='3268'>
	    CTURB_GL(8,2)=3.25D0<a name='3269'>
	    CTURB_GL(8,3)=2.3D0<a name='3270'>
	    CTURB_GL(8,4)=2.3D0<a name='3271'>
	    CTURB_GL(8,5)=2.35D0<a name='3272'>
	    CTURB_GL(8,6)=2.37D0<a name='3273'>
	    CTURB_GL(8,7)=2.55D0<a name='3274'>
	    CTURB_GL(8,8)=2.55D0<a name='3275'>
	    CTURB_GL(8,9)=2.55D0<a name='3276'>
	    CTURB_GL(8,10)=2.3D0<a name='3277'>
	    CTURB_GL(8,11)=2.1D0<a name='3278'>
	    CTURB_GL(8,12)=1.9D0<a name='3279'>
	    CTURB_GL(8,13)=1.3D0<a name='3280'>
	    CTURB_GL(8,14)=1.1D0<a name='3281'>
<a name='3282'>
	    CTURB_GL(9,1)=3.0D0<a name='3283'>
	    CTURB_GL(9,2)=3.0D0<a name='3284'>
	    CTURB_GL(9,3)=3.1D0<a name='3285'>
	    CTURB_GL(9,4)=2.2D0<a name='3286'>
	    CTURB_GL(9,5)=2.2D0<a name='3287'>
	    CTURB_GL(9,6)=2.2D0<a name='3288'>
	    CTURB_GL(9,7)=2.3D0<a name='3289'>
	    CTURB_GL(9,8)=2.3D0<a name='3290'>
	    CTURB_GL(9,9)=2.5D0<a name='3291'>
	    CTURB_GL(9,10)=2.5D0<a name='3292'>
	    CTURB_GL(9,11)=2.2D0<a name='3293'>
	    CTURB_GL(9,12)=1.8D0<a name='3294'>
	    CTURB_GL(9,13)=1.25D0<a name='3295'>
	    CTURB_GL(9,14)=1.1D0<a name='3296'>
<a name='3297'>
	    CTURB_GL(10,1)=2.75D0<a name='3298'>
	    CTURB_GL(10,2)=2.75D0<a name='3299'>
	    CTURB_GL(10,3)=2.0D0<a name='3300'>
	    CTURB_GL(10,4)=2.0D0<a name='3301'>
	    CTURB_GL(10,5)=2.0D0<a name='3302'>
	    CTURB_GL(10,6)=2.1D0<a name='3303'>
	    CTURB_GL(10,7)=2.2D0<a name='3304'>
	    CTURB_GL(10,8)=2.2D0<a name='3305'>
	    CTURB_GL(10,9)=2.3D0<a name='3306'>
	    CTURB_GL(10,10)=2.3D0<a name='3307'>
	    CTURB_GL(10,11)=2.3D0<a name='3308'>
	    CTURB_GL(10,12)=1.8D0<a name='3309'>
	    CTURB_GL(10,13)=1.2D0<a name='3310'>
	    CTURB_GL(10,14)=1.1D0<a name='3311'>
<a name='3312'>
	    CTURB_GL(11,1)=2.6D0<a name='3313'>
	    CTURB_GL(11,2)=2.6D0<a name='3314'>
	    CTURB_GL(11,3)=1.95D0<a name='3315'>
	    CTURB_GL(11,4)=1.95D0<a name='3316'>
	    CTURB_GL(11,5)=1.95D0<a name='3317'>
	    CTURB_GL(11,6)=2.05D0<a name='3318'>
	    CTURB_GL(11,7)=2.15D0<a name='3319'>
	    CTURB_GL(11,8)=2.15D0<a name='3320'>
	    CTURB_GL(11,9)=2.25D0<a name='3321'>
	    CTURB_GL(11,10)=2.25D0<a name='3322'>
	    CTURB_GL(11,11)=1.9D0<a name='3323'>
	    CTURB_GL(11,12)=1.8D0<a name='3324'>
	    CTURB_GL(11,13)=1.2D0<a name='3325'>
	    CTURB_GL(11,14)=1.1D0<a name='3326'>
<a name='3327'>
	    CTURB_GL(12,1)=2.4D0<a name='3328'>
	    CTURB_GL(12,2)=2.4D0<a name='3329'>
	    CTURB_GL(12,3)=1.85D0<a name='3330'>
	    CTURB_GL(12,4)=1.85D0<a name='3331'>
	    CTURB_GL(12,5)=1.85D0<a name='3332'>
	    CTURB_GL(12,6)=1.75D0<a name='3333'>
	    CTURB_GL(12,7)=1.85D0<a name='3334'>
	    CTURB_GL(12,8)=1.85D0<a name='3335'>
	    CTURB_GL(12,9)=2.1D0<a name='3336'>
	    CTURB_GL(12,10)=2.1D0<a name='3337'>
	    CTURB_GL(12,11)=1.9D0<a name='3338'>
	    CTURB_GL(12,12)=1.8D0 <a name='3339'>
	    CTURB_GL(12,13)=1.3D0<a name='3340'>
	    CTURB_GL(12,14)=1.1D0<a name='3341'>
<a name='3342'>
	    CTURB_GL(13,1)=1.67D0<a name='3343'>
	    CTURB_GL(13,2)=1.67D0<a name='3344'>
	    CTURB_GL(13,3)=1.75D0<a name='3345'>
	    CTURB_GL(13,4)=1.83D0<a name='3346'>
	    CTURB_GL(13,5)=1.87D0<a name='3347'>
	    CTURB_GL(13,6)=2.0D0<a name='3348'>
	    CTURB_GL(13,7)=2.1D0<a name='3349'>
	    CTURB_GL(13,8)=2.12D0<a name='3350'>
	    CTURB_GL(13,9)=2.15D0<a name='3351'>
	    CTURB_GL(13,10)=2.18D0<a name='3352'>
	    CTURB_GL(13,11)=2.19D0<a name='3353'>
	    CTURB_GL(13,12)=1.67D0<a name='3354'>
	    CTURB_GL(13,13)=1.28D0<a name='3355'>
	    CTURB_GL(13,14)=1.0D0<a name='3356'>
<a name='3357'>
	    CTURB_GL(14,1)=1.3D0<a name='3358'>
	    CTURB_GL(14,2)=1.3D0<a name='3359'>
	    CTURB_GL(14,3)=1.35D0<a name='3360'>
	    CTURB_GL(14,4)=1.4D0<a name='3361'>
	    CTURB_GL(14,5)=1.6D0<a name='3362'>
	    CTURB_GL(14,6)=1.7D0<a name='3363'>
	    CTURB_GL(14,7)=1.7D0<a name='3364'>
	    CTURB_GL(14,8)=1.7D0<a name='3365'>
	    CTURB_GL(14,9)=1.7D0<a name='3366'>
	    CTURB_GL(14,10)=1.7D0<a name='3367'>
	    CTURB_GL(14,11)=1.7D0<a name='3368'>
	    CTURB_GL(14,12)=1.4D0<a name='3369'>
	    CTURB_GL(14,13)=1.25D0<a name='3370'>
	    CTURB_GL(14,14)=1.0D0<a name='3371'>
<a name='3372'>
	    CTURB_GL(15,1)=1.17D0<a name='3373'>
	    CTURB_GL(15,2)=1.17D0<a name='3374'>
	    CTURB_GL(15,3)=1.17D0<a name='3375'>
	    CTURB_GL(15,4)=1.25D0<a name='3376'>
	    CTURB_GL(15,5)=1.3D0<a name='3377'>
	    CTURB_GL(15,6)=1.35D0<a name='3378'>
	    CTURB_GL(15,7)=1.4D0<a name='3379'>
	    CTURB_GL(15,8)=1.4D0<a name='3380'>
	    CTURB_GL(15,9)=1.45D0<a name='3381'>
	    CTURB_GL(15,10)=1.47D0<a name='3382'>
	    CTURB_GL(15,11)=1.44D0<a name='3383'>
	    CTURB_GL(15,12)=1.3D0<a name='3384'>
	    CTURB_GL(15,13)=1.12D0<a name='3385'>
	    CTURB_GL(15,14)=1.0D0<a name='3386'>
<a name='3387'>
	    CTURB_GL(16,1)=1.17D0<a name='3388'>
	    CTURB_GL(16,2)=1.17D0<a name='3389'>
	    CTURB_GL(16,3)=1.17D0<a name='3390'>
	    CTURB_GL(16,4)=1.25D0<a name='3391'>
	    CTURB_GL(16,5)=1.3D0<a name='3392'>
	    CTURB_GL(16,6)=1.35D0<a name='3393'>
	    CTURB_GL(16,7)=1.4D0<a name='3394'>
	    CTURB_GL(16,8)=1.45D0<a name='3395'>
	    CTURB_GL(16,9)=1.45D0<a name='3396'>
	    CTURB_GL(16,10)=1.47D0<a name='3397'>
	    CTURB_GL(16,11)=1.44D0<a name='3398'>
	    CTURB_GL(16,12)=1.3D0<a name='3399'>
	    CTURB_GL(16,13)=1.12D0<a name='3400'>
	    CTURB_GL(16,14)=1.0D0<a name='3401'>
          ENDIF<a name='3402'>
          IF(IEPS_800.EQ.1) THEN<a name='3403'>
	    CTURB_GL(1,1) =0.00D0<a name='3404'>
	    CTURB_GL(1,2) =0.00D0<a name='3405'>
	    CTURB_GL(1,3) =1.00D0<a name='3406'>
            CTURB_GL(1,4) =1.50D0<a name='3407'>
	    CTURB_GL(1,5) =1.40D0<a name='3408'>
	    CTURB_GL(1,6) =1.30D0<a name='3409'>
	    CTURB_GL(1,7) =1.20D0<a name='3410'>
	    CTURB_GL(1,8) =1.10D0<a name='3411'>
	    CTURB_GL(1,9) =1.00D0<a name='3412'>
	    CTURB_GL(1,10)=1.00D0<a name='3413'>
	    CTURB_GL(1,11)=1.00D0<a name='3414'>
	    CTURB_GL(1,12)=1.00D0<a name='3415'>
	    CTURB_GL(1,13)=1.00D0<a name='3416'>
	    CTURB_GL(1,14)=1.00D0<a name='3417'>
	    CTURB_GL(1,15)=1.00D0<a name='3418'>
	    CTURB_GL(1,16)=1.00D0<a name='3419'>
<a name='3420'>
	    CTURB_GL(2,1) =0.00D0<a name='3421'>
	    CTURB_GL(2,2) =0.00D0<a name='3422'>
	    CTURB_GL(2,3) =1.00D0<a name='3423'>
	    CTURB_GL(2,4) =2.00D0<a name='3424'>
	    CTURB_GL(2,5) =1.80D0<a name='3425'>
	    CTURB_GL(2,6) =1.70D0<a name='3426'>
	    CTURB_GL(2,7) =1.60D0<a name='3427'>
	    CTURB_GL(2,8) =1.50D0<a name='3428'>
	    CTURB_GL(2,9) =1.50D0<a name='3429'>
	    CTURB_GL(2,10)=1.50D0<a name='3430'>
	    CTURB_GL(2,11)=1.50D0<a name='3431'>
	    CTURB_GL(2,12)=1.50D0<a name='3432'>
	    CTURB_GL(2,13)=1.50D0<a name='3433'>
	    CTURB_GL(2,14)=1.00D0<a name='3434'>
	    CTURB_GL(2,15)=1.00D0<a name='3435'>
	    CTURB_GL(2,16)=1.00D0<a name='3436'>
<a name='3437'>
	    CTURB_GL(3,1) =0.00D0<a name='3438'>
	    CTURB_GL(3,2) =0.00D0<a name='3439'>
	    CTURB_GL(3,3) =4.00D0<a name='3440'>
	    CTURB_GL(3,4) =7.65D0<a name='3441'>
	    CTURB_GL(3,5) =7.65D0<a name='3442'>
	    CTURB_GL(3,6) =8.00D0<a name='3443'>
	    CTURB_GL(3,7) =8.00D0<a name='3444'>
	    CTURB_GL(3,8) =7.50D0<a name='3445'>
	    CTURB_GL(3,9) =6.50D0<a name='3446'>
	    CTURB_GL(3,10)=6.00D0<a name='3447'>
	    CTURB_GL(3,11)=5.00D0<a name='3448'>
	    CTURB_GL(3,12)=4.50D0<a name='3449'>
	    CTURB_GL(3,13)=4.00D0<a name='3450'>
	    CTURB_GL(3,14)=2.00D0<a name='3451'>
	    CTURB_GL(3,15)=1.30D0<a name='3452'>
	    CTURB_GL(3,16)=1.00D0<a name='3453'>
<a name='3454'>
	    CTURB_GL(4,1) =7.50D0<a name='3455'>
	    CTURB_GL(4,2) =7.50D0<a name='3456'>
	    CTURB_GL(4,3) =7.50D0<a name='3457'>
	    CTURB_GL(4,4) =7.65D0	<a name='3458'>
	    CTURB_GL(4,5) =7.65D0	<a name='3459'>
	    CTURB_GL(4,6) =8.00D0	<a name='3460'>
	    CTURB_GL(4,7) =8.00D0	<a name='3461'>
	    CTURB_GL(4,8) =7.50D0	<a name='3462'>
	    CTURB_GL(4,9) =6.50D0	<a name='3463'>
	    CTURB_GL(4,10)=6.00D0	<a name='3464'>
	    CTURB_GL(4,11)=5.00D0	<a name='3465'>
	    CTURB_GL(4,12)=4.50D0	<a name='3466'>
	    CTURB_GL(4,13)=4.00D0	<a name='3467'>
	    CTURB_GL(4,14)=2.00D0	<a name='3468'>
	    CTURB_GL(4,15)=1.30D0	<a name='3469'>
	    CTURB_GL(4,16)=1.00D0	<a name='3470'>
    <a name='3471'>
	    CTURB_GL(5,1) =5.50D0<a name='3472'>
	    CTURB_GL(5,2) =5.50D0<a name='3473'>
	    CTURB_GL(5,3) =5.50D0<a name='3474'>
	    CTURB_GL(5,4) =5.75D0<a name='3475'>
	    CTURB_GL(5,5) =5.75D0<a name='3476'>
	    CTURB_GL(5,6) =6.00D0<a name='3477'>
	    CTURB_GL(5,7) =6.25D0<a name='3478'>
	    CTURB_GL(5,8) =6.17D0<a name='3479'>
	    CTURB_GL(5,9) =5.75D0<a name='3480'>
	    CTURB_GL(5,10)=5.25D0<a name='3481'>
	    CTURB_GL(5,11)=4.75D0<a name='3482'>
	    CTURB_GL(5,12)=4.25D0<a name='3483'>
	    CTURB_GL(5,13)=4.00D0<a name='3484'>
	    CTURB_GL(5,14)=2.00D0<a name='3485'>
	    CTURB_GL(5,15)=1.35D0<a name='3486'>
	    CTURB_GL(5,16)=1.00D0<a name='3487'>
	 <a name='3488'>
	    CTURB_GL(6,1) =4.50D0<a name='3489'>
	    CTURB_GL(6,2) =4.50D0<a name='3490'>
	    CTURB_GL(6,3) =4.50D0<a name='3491'>
	    CTURB_GL(6,4) =4.75D0	<a name='3492'>
	    CTURB_GL(6,5) =4.75D0	<a name='3493'>
	    CTURB_GL(6,6) =5.00D0	<a name='3494'>
	    CTURB_GL(6,7) =5.25D0	<a name='3495'>
	    CTURB_GL(6,8) =5.25D0	<a name='3496'>
	    CTURB_GL(6,9) =5.00D0	<a name='3497'>
	    CTURB_GL(6,10)=4.75D0	<a name='3498'>
	    CTURB_GL(6,11)=4.50D0	<a name='3499'>
	    CTURB_GL(6,12)=4.00D0	<a name='3500'>
	    CTURB_GL(6,13)=3.75D0	<a name='3501'>
	    CTURB_GL(6,14)=2.00D0	<a name='3502'>
	    CTURB_GL(6,15)=1.40D0	<a name='3503'>
	    CTURB_GL(6,16)=1.00D0	<a name='3504'>
			 		<a name='3505'>
	    CTURB_GL(7,1) =4.00D0<a name='3506'>
	    CTURB_GL(7,2) =4.00D0<a name='3507'>
	    CTURB_GL(7,3) =4.00D0<a name='3508'>
	    CTURB_GL(7,4) =4.00D0<a name='3509'>
	    CTURB_GL(7,5) =4.00D0<a name='3510'>
	    CTURB_GL(7,6) =4.25D0<a name='3511'>
	    CTURB_GL(7,7) =4.50D0<a name='3512'>
	    CTURB_GL(7,8) =4.67D0<a name='3513'>
	    CTURB_GL(7,9) =4.50D0<a name='3514'>
	    CTURB_GL(7,10)=4.30D0<a name='3515'>
	    CTURB_GL(7,11)=4.10D0<a name='3516'>
	    CTURB_GL(7,12)=3.80D0<a name='3517'>
	    CTURB_GL(7,13)=3.50D0<a name='3518'>
	    CTURB_GL(7,14)=2.00D0<a name='3519'>
	    CTURB_GL(7,15)=1.30D0<a name='3520'>
	    CTURB_GL(7,16)=1.10D0<a name='3521'>
<a name='3522'>
	    CTURB_GL(8,1) =3.50D0<a name='3523'>
	    CTURB_GL(8,2) =3.50D0<a name='3524'>
	    CTURB_GL(8,3) =3.50D0<a name='3525'>
	    CTURB_GL(8,4) =3.65D0<a name='3526'>
	    CTURB_GL(8,5) =3.65D0<a name='3527'>
	    CTURB_GL(8,6) =3.80D0<a name='3528'>
	    CTURB_GL(8,7) =4.1D02<a name='3529'>
	    CTURB_GL(8,8) =4.17D0<a name='3530'>
	    CTURB_GL(8,9) =4.17D0<a name='3531'>
	    CTURB_GL(8,10)=4.00D0<a name='3532'>
	    CTURB_GL(8,11)=3.80D0<a name='3533'>
	    CTURB_GL(8,12)=3.67D0<a name='3534'>
	    CTURB_GL(8,13)=3.40D0<a name='3535'>
	    CTURB_GL(8,14)=2.00D0<a name='3536'>
	    CTURB_GL(8,15)=1.30D0<a name='3537'>
	    CTURB_GL(8,16)=1.10D0<a name='3538'>
<a name='3539'>
	    CTURB_GL(9,1) =3.25D0<a name='3540'>
	    CTURB_GL(9,2) =3.25D0<a name='3541'>
	    CTURB_GL(9,3) =3.25D0<a name='3542'>
	    CTURB_GL(9,4) =3.25D0<a name='3543'>
	    CTURB_GL(9,5) =3.25D0<a name='3544'>
	    CTURB_GL(9,6) =3.50D0<a name='3545'>
	    CTURB_GL(9,7) =3.75D0<a name='3546'>
	    CTURB_GL(9,8) =3.75D0<a name='3547'>
	    CTURB_GL(9,9) =3.75D0<a name='3548'>
	    CTURB_GL(9,10)=3.75D0<a name='3549'>
	    CTURB_GL(9,11)=3.60D0<a name='3550'>
	    CTURB_GL(9,12)=3.40D0<a name='3551'>
	    CTURB_GL(9,13)=3.25D0<a name='3552'>
	    CTURB_GL(9,14)=2.00D0<a name='3553'>
	    CTURB_GL(9,15)=1.30D0<a name='3554'>
	    CTURB_GL(9,16)=1.10D0<a name='3555'>
	    <a name='3556'>
	    CTURB_GL(10,1) =3.00D0<a name='3557'>
	    CTURB_GL(10,2) =3.00D0<a name='3558'>
	    CTURB_GL(10,3) =3.00D0<a name='3559'>
	    CTURB_GL(10,4) =3.10D0<a name='3560'>
	    CTURB_GL(10,5) =3.10D0<a name='3561'>
	    CTURB_GL(10,6) =3.25D0<a name='3562'>
	    CTURB_GL(10,7) =3.40D0<a name='3563'>
	    CTURB_GL(10,8) =3.50D0<a name='3564'>
	    CTURB_GL(10,9) =3.50D0<a name='3565'>
	    CTURB_GL(10,10)=3.50D0<a name='3566'>
	    CTURB_GL(10,11)=3.40D0<a name='3567'>
	    CTURB_GL(10,12)=3.25D0<a name='3568'>
	    CTURB_GL(10,13)=3.15D0<a name='3569'>
	    CTURB_GL(10,14)=1.90D0<a name='3570'>
	    CTURB_GL(10,15)=1.30D0<a name='3571'>
	    CTURB_GL(10,16)=1.10D0<a name='3572'>
<a name='3573'>
	    CTURB_GL(11,1) =2.75D0<a name='3574'>
	    CTURB_GL(11,2) =2.75D0<a name='3575'>
	    CTURB_GL(11,3) =2.75D0<a name='3576'>
	    CTURB_GL(11,4) =2.75D0<a name='3577'>
	    CTURB_GL(11,5) =2.75D0<a name='3578'>
	    CTURB_GL(11,6) =3.00D0<a name='3579'>
	    CTURB_GL(11,7) =3.25D0<a name='3580'>
	    CTURB_GL(11,8) =3.25D0<a name='3581'>
	    CTURB_GL(11,9) =3.25D0<a name='3582'>
	    CTURB_GL(11,10)=3.25D0<a name='3583'>
	    CTURB_GL(11,11)=3.25D0<a name='3584'>
	    CTURB_GL(11,12)=3.15D0<a name='3585'>
	    CTURB_GL(11,13)=3.00D0<a name='3586'>
	    CTURB_GL(11,14)=1.80D0<a name='3587'>
	    CTURB_GL(11,15)=1.30D0<a name='3588'>
	    CTURB_GL(11,16)=1.10D0<a name='3589'>
<a name='3590'>
	    CTURB_GL(12,1) =2.60D0<a name='3591'>
	    CTURB_GL(12,2) =2.60D0<a name='3592'>
	    CTURB_GL(12,3) =2.60D0<a name='3593'>
	    CTURB_GL(12,4) =2.67D0<a name='3594'>
	    CTURB_GL(12,5) =2.67D0<a name='3595'>
	    CTURB_GL(12,6) =2.75D0<a name='3596'>
	    CTURB_GL(12,7) =3.00D0<a name='3597'>
	    CTURB_GL(12,8) =3.17D0<a name='3598'>
	    CTURB_GL(12,9) =3.17D0<a name='3599'>
	    CTURB_GL(12,10)=3.17D0<a name='3600'>
	    CTURB_GL(12,11)=3.10D0<a name='3601'>
	    CTURB_GL(12,12)=2.90D0<a name='3602'>
	    CTURB_GL(12,13)=2.80D0<a name='3603'>
	    CTURB_GL(12,14)=1.87D0<a name='3604'>
	    CTURB_GL(12,15)=1.37D0<a name='3605'>
	    CTURB_GL(12,16)=1.10D0<a name='3606'>
<a name='3607'>
	    CTURB_GL(13,1) =2.40D0<a name='3608'>
	    CTURB_GL(13,2) =2.40D0<a name='3609'>
	    CTURB_GL(13,3) =2.40D0<a name='3610'>
	    CTURB_GL(13,4) =2.50D0<a name='3611'>
	    CTURB_GL(13,5) =2.50D0<a name='3612'>
	    CTURB_GL(13,6) =2.67D0<a name='3613'>
	    CTURB_GL(13,7) =2.83D0<a name='3614'>
	    CTURB_GL(13,8) =2.90D0<a name='3615'>
	    CTURB_GL(13,9) =3.00D0<a name='3616'>
	    CTURB_GL(13,10)=2.90D0<a name='3617'>
	    CTURB_GL(13,11)=2.85D0<a name='3618'>
	    CTURB_GL(13,12)=2.80D0<a name='3619'>
	    CTURB_GL(13,13)=2.75D0<a name='3620'>
	    CTURB_GL(13,14)=1.83D0<a name='3621'>
	    CTURB_GL(13,15)=1.30D0<a name='3622'>
	    CTURB_GL(13,16)=1.10D0<a name='3623'>
<a name='3624'>
	    CTURB_GL(14,1) =1.67D0<a name='3625'>
	    CTURB_GL(14,2) =1.67D0<a name='3626'>
	    CTURB_GL(14,3) =1.67D0<a name='3627'>
	    CTURB_GL(14,4) =1.75D0<a name='3628'>
	    CTURB_GL(14,5) =1.75D0<a name='3629'>
	    CTURB_GL(14,6) =1.83D0<a name='3630'>
	    CTURB_GL(14,7) =1.87D0<a name='3631'>
	    CTURB_GL(14,8) =2.00D0<a name='3632'>
	    CTURB_GL(14,9) =2.10D0<a name='3633'>
	    CTURB_GL(14,10)=2.12D0<a name='3634'>
	    CTURB_GL(14,11)=2.15D0<a name='3635'>
	    CTURB_GL(14,12)=2.18D0<a name='3636'>
	    CTURB_GL(14,13)=2.19D0<a name='3637'>
	    CTURB_GL(14,14)=1.67D0<a name='3638'>
	    CTURB_GL(14,15)=1.28D0<a name='3639'>
	    CTURB_GL(14,16)=1.00D0<a name='3640'>
<a name='3641'>
	    CTURB_GL(15,1) =1.30D0<a name='3642'>
	    CTURB_GL(15,2) =1.30D0<a name='3643'>
	    CTURB_GL(15,3) =1.30D0<a name='3644'>
	    CTURB_GL(15,4) =1.35D0<a name='3645'>
	    CTURB_GL(15,5) =1.35D0<a name='3646'>
	    CTURB_GL(15,6) =1.40D0<a name='3647'>
	    CTURB_GL(15,7) =1.60D0<a name='3648'>
	    CTURB_GL(15,8) =1.70D0<a name='3649'>
	    CTURB_GL(15,9) =1.70D0<a name='3650'>
	    CTURB_GL(15,10)=1.70D0<a name='3651'>
	    CTURB_GL(15,11)=1.70D0<a name='3652'>
	    CTURB_GL(15,12)=1.70D0<a name='3653'>
	    CTURB_GL(15,13)=1.70D0<a name='3654'>
	    CTURB_GL(15,14)=1.40D0<a name='3655'>
	    CTURB_GL(15,15)=1.25D0<a name='3656'>
	    CTURB_GL(15,16)=1.00D0<a name='3657'>
<a name='3658'>
	    CTURB_GL(16,1) =1.17D0<a name='3659'>
	    CTURB_GL(16,2) =1.17D0<a name='3660'>
	    CTURB_GL(16,3) =1.17D0<a name='3661'>
	    CTURB_GL(16,4) =1.17D0<a name='3662'>
	    CTURB_GL(16,5) =1.17D0<a name='3663'>
	    CTURB_GL(16,6) =1.25D0<a name='3664'>
	    CTURB_GL(16,7) =1.30D0<a name='3665'>
	    CTURB_GL(16,8) =1.35D0<a name='3666'>
	    CTURB_GL(16,9) =1.40D0<a name='3667'>
	    CTURB_GL(16,10)=1.45D0<a name='3668'>
	    CTURB_GL(16,11)=1.45D0<a name='3669'>
	    CTURB_GL(16,12)=1.47D0<a name='3670'>
	    CTURB_GL(16,13)=1.44D0<a name='3671'>
	    CTURB_GL(16,14)=1.30D0<a name='3672'>
	    CTURB_GL(16,15)=1.12D0<a name='3673'>
	    CTURB_GL(16,16)=1.00D0<a name='3674'>
          ENDIF<a name='3675'>
          IF(IEPS_800.EQ.1.AND.IEPS_1600.EQ.1) THEN<a name='3676'>
            DO I=1,K0G_GL<a name='3677'>
               DO J=1,K0L_GL<a name='3678'>
                  CTURB_GL(I,J)=CTURB_GL(I,J)*1.7D0<a name='3679'>
               ENDDO<a name='3680'>
            ENDDO <a name='3681'>
          ENDIF<a name='3682'>
          DO J=1,K0L_GL<a name='3683'>
             DO I=1,K0G_GL<a name='3684'>
                CTURB_GL(I,J)=(CTURB_GL(I,J)-1.0D0)/1.5D0+1.0D0<a name='3685'>
             ENDDO<a name='3686'>
          ENDDO<a name='3687'>
	  DO I=KRMING_GL,KRMAXG_GL<a name='3688'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3689'>
                CTURBGL(I,J)=1.<a name='3690'>
             ENDDO<a name='3691'>
          ENDDO<a name='3692'>
          DO I=KRMING_GL,KRMAXG_GL                   <a name='3693'>
             X_KERN=RADXXO(I,6)*1.0D4<a name='3694'>
             IF(X_KERN.LT.RG_GL(1)) X_KERN=RG_GL(1)<a name='3695'>
             IF(X_KERN.GT.RG_GL(K0G_GL)) X_KERN=RG_GL(K0G_GL) <a name='3696'>
             DO J=KRMINL_GL,KRMAXL_GL<a name='3697'>
                Y_KERN=RADXXO(J,1)*1.0D4<a name='3698'>
                IF(Y_KERN.LT.RL_GL(1)) Y_KERN=RL_GL(1)<a name='3699'>
                IF(Y_KERN.GT.RL_GL(K0L_GL)) Y_KERN=RL_GL(K0L_GL)<a name='3700'>
                CTURBGL(I,J)=<A href='../../html_code/phys/module_mp_full_sbm.F.html#F'>F</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#TURBCOEF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="F_15">(X_KERN,Y_KERN,RG_GL,RL_GL,CTURB_GL &amp;<a name='3701'>
     &amp;                      ,K0G_GL,K0L_GL)	      <a name='3702'>
             ENDDO<a name='3703'>
          ENDDO<a name='3704'>
          IF(IEPS_800.EQ.1) THEN<a name='3705'>
            DO I=KRMING_GL,15<a name='3706'>
               DO J=KRMINL_GL,13<a name='3707'>
                  IF(CTURBGL(I,J).LT.3.0D0) CTURBGL(I,J)=3.0D0<a name='3708'>
               ENDDO<a name='3709'>
            ENDDO<a name='3710'>
          ENDIF<a name='3711'>
          IF(IEPS_1600.EQ.1) THEN<a name='3712'>
            DO I=KRMING_GL,15<a name='3713'>
               DO J=KRMINL_GL,13<a name='3714'>
                  IF(CTURBGL(I,J).LT.5.1D0) CTURBGL(I,J)=5.1D0<a name='3715'>
               ENDDO<a name='3716'>
            ENDDO<a name='3717'>
          ENDIF<a name='3718'>
	  DO I=1,33<a name='3719'>
             DO J=1,24<a name='3720'>
                IF(I.LE.14.AND.J.EQ.8) CTURBGL(I,J)=1.0D0<a name='3721'>
                IF(I.GT.14.AND.J.LE.8) CTURBGL(I,J)=1.2D0<a name='3722'>
	     ENDDO<a name='3723'>
          ENDDO                       <a name='3724'>
	RETURN<a name='3725'>
	END SUBROUTINE TURBCOEF<a name='3726'>
<font color=#447700>!===================================================================<a name='3727'></font>
<font color=#447700>! QUESTION<a name='3728'></font>
<A NAME='F'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#F' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='3729'>
        real * 8 <font color=#993300>function </font><font color=#cc0000>f</font>(x,y,x0,y0,table,k0,kk0) <A href='../../call_to/F.html' TARGET='index'>33</A><a name='3730'>
<font color=#447700>! two-dimensional linear interpolation of the collision efficiency<a name='3731'></font>
<font color=#447700>! with help table(k0,kk0)<a name='3732'></font>
<a name='3733'>
       implicit none<a name='3734'>
       integer k0,kk0,k,ir,kk,iq<a name='3735'>
       double precision x,y,p,q,ec,ek<a name='3736'>
<font color=#447700>!      double precision x,y,p,q,ec,ek,f<a name='3737'></font>
       double precision x0(k0),y0(kk0),table(k0,kk0)<a name='3738'>
<a name='3739'>
<a name='3740'>
        do k=2,k0<a name='3741'>
           if(x.le.x0(k).and.x.ge.x0(k-1)) then<a name='3742'>
             ir=k     <a name='3743'>
           elseif(x.gt.x0(k0)) then<a name='3744'>
             ir=k0+1<a name='3745'>
           elseif(x.lt.x0(1)) then<a name='3746'>
             ir=1<a name='3747'>
           endif<a name='3748'>
        enddo<a name='3749'>
        do kk=2,kk0<a name='3750'>
           if(y.le.y0(kk).and.y.ge.y0(kk-1)) iq=kk<a name='3751'>
        enddo<a name='3752'>
        if(ir.lt.k0+1) then<a name='3753'>
          if(ir.ge.2) then<a name='3754'>
            p =(x-x0(ir-1))/(x0(ir)-x0(ir-1))<a name='3755'>
            q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='3756'>
            ec=(1.d0-p)*(1.d0-q)*table(ir-1,iq-1)+ &amp;<a name='3757'>
     &amp;              p*(1.d0-q)*table(ir,iq-1)+ &amp;<a name='3758'>
     &amp;              q*(1.d0-p)*table(ir-1,iq)+ &amp;<a name='3759'>
     &amp;                   p*q*table(ir,iq)    <a name='3760'>
          else<a name='3761'>
            q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='3762'>
            ec=(1.d0-q)*table(1,iq-1)+q*table(1,iq)    <a name='3763'>
          endif<a name='3764'>
        else<a name='3765'>
          q =(y-y0(iq-1))/(y0(iq)-y0(iq-1))<a name='3766'>
          ek=(1.d0-q)*table(k0,iq-1)+q*table(k0,iq)<a name='3767'>
          ec=min(ek,1.d0) <a name='3768'>
        endif<a name='3769'>
        f=ec<a name='3770'>
        return<a name='3771'>
        end function f<a name='3772'>
<font color=#447700>! function f<a name='3773'></font>
                                                                            <a name='3774'>
<a name='3775'>
                                                                            <a name='3776'>
<a name='3777'>
<font color=#447700>!======================================================================<a name='3778'></font>
<A NAME='FREEZ'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#FREEZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3779'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>FREEZ</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/FREEZ.html' TARGET='index'>2</A><a name='3780'>
     &amp;,TIN,DT,RO,COL,AFREEZMY,BFREEZMY,BFREEZMAX,KRFREEZ,ICEMAX,NKR)       <a name='3781'>
      IMPLICIT NONE <a name='3782'>
      INTEGER KR,ICE,ICE_TYPE<a name='3783'>
      REAL COL,AFREEZMY,BFREEZMY,BFREEZMAX<a name='3784'>
      INTEGER KRFREEZ,ICEMAX,NKR<a name='3785'>
      REAL DT,RO,YKK,PF,PF_1,DEL_T,TT_DROP,ARG_1,YK2,DF1,BF,ARG_M, &amp; <a name='3786'>
     &amp; TT_DROP_AFTER_FREEZ,CFREEZ,SUM_ICE,TIN,TTIN,AF,FF_MAX,F1_MAX, &amp;<a name='3787'>
     &amp; F2_MAX,F3_MAX,F4_MAX,F5_MAX<a name='3788'>
<a name='3789'>
<a name='3790'>
	REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX) &amp;<a name='3791'>
     &amp;           ,XI(NKR,ICEMAX),FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='3792'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='3793'>
<a name='3794'>
<a name='3795'>
<a name='3796'>
	TTIN=TIN<a name='3797'>
        DEL_T	=TTIN-273.15<a name='3798'>
	ICE_TYPE=2<a name='3799'>
	F1_MAX=0.<a name='3800'>
	F2_MAX=0.<a name='3801'>
	F3_MAX=0.<a name='3802'>
	F4_MAX=0.<a name='3803'>
	F5_MAX=0.<a name='3804'>
	DO 1 KR=1,NKR<a name='3805'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='3806'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='3807'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='3808'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='3809'>
	DO 1 ICE=1,ICEMAX<a name='3810'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='3811'>
    1   CONTINUE<a name='3812'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='3813'>
<font color=#447700>!<a name='3814'></font>
<font color=#447700>!******************************* FREEZING ****************************<a name='3815'></font>
<font color=#447700>!<a name='3816'></font>
        IF(DEL_T.LT.0.AND.F1_MAX.NE.0) THEN<a name='3817'>
	SUM_ICE=0.<a name='3818'>
	AF	=AFREEZMY<a name='3819'>
	CFREEZ	=(BFREEZMAX-BFREEZMY)/XL(NKR)<a name='3820'>
<font color=#447700>!<a name='3821'></font>
<font color=#447700>!***************************** MASS LOOP **************************<a name='3822'></font>
<font color=#447700>!<a name='3823'></font>
         DO  KR	=1,NKR<a name='3824'>
	 ARG_M	=XL(KR)<a name='3825'>
	 BF	=BFREEZMY+CFREEZ*ARG_M<a name='3826'>
         PF_1	=AF*EXP(-BF*DEL_T)<a name='3827'>
         PF	=ARG_M*PF_1<a name='3828'>
	 YKK	=EXP(-PF*DT)<a name='3829'>
         DF1	=FF1(KR)*(1.-YKK)<a name='3830'>
	 YK2	=DF1<a name='3831'>
         FF1(KR)=FF1(KR)*YKK<a name='3832'>
	 IF(KR.LE.KRFREEZ)  THEN<a name='3833'>
	 FF2(KR,ICE_TYPE)=FF2(KR,ICE_TYPE)+YK2<a name='3834'>
			    ELSE<a name='3835'>
	  FF5(KR)	=FF5(KR)+YK2<a name='3836'>
	 ENDIF<a name='3837'>
         SUM_ICE=SUM_ICE+YK2*3.*XL(KR)*XL(KR)*COL<a name='3838'>
<font color=#447700>!<a name='3839'></font>
<font color=#447700>!************************ END OF "MASS LOOP" **************************<a name='3840'></font>
<font color=#447700>!<a name='3841'></font>
	 ENDDO<a name='3842'>
<font color=#447700>!<a name='3843'></font>
<font color=#447700>!************************** NEW TEMPERATURE *************************<a name='3844'></font>
<font color=#447700>!	<a name='3845'></font>
	ARG_1	=333.*SUM_ICE/RO<a name='3846'>
      	TT_DROP_AFTER_FREEZ=TTIN+ARG_1<a name='3847'>
	TIN	=TT_DROP_AFTER_FREEZ<a name='3848'>
<font color=#447700>!<a name='3849'></font>
<font color=#447700>!************************** END OF "FREEZING" ****************************<a name='3850'></font>
<font color=#447700>!<a name='3851'></font>
	ENDIF<a name='3852'>
<font color=#447700>!<a name='3853'></font>
   	RETURN                                                           <a name='3854'>
      	END SUBROUTINE FREEZ                                                             <a name='3855'>
<a name='3856'>
<A NAME='ORIG_MELT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ORIG_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3857'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ORIG_MELT</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/ORIG_MELT.html' TARGET='index'>2</A><a name='3858'>
     &amp;                           ,TIN,DT,RO,COL,ICEMAX,NKR)<a name='3859'>
      IMPLICIT NONE<a name='3860'>
      INTEGER KR,ICE,ICE_TYPE<a name='3861'>
      INTEGER ICEMAX,NKR<a name='3862'>
      REAL COL<a name='3863'>
      REAL ARG_M,TT_DROP,ARG_1,TT_DROP_AFTER_FREEZ,DT,DF1,DN,DN0, &amp;<a name='3864'>
     &amp; RO,A,B,DTFREEZ,SUM_ICE,FF_MAX,F1_MAX,F2_MAX,F3_MAX,F4_MAX,F5_MAX, &amp;<a name='3865'>
     &amp; DEL_T,gamma,TIN<a name='3866'>
        REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX),XI(NKR,ICEMAX) &amp;<a name='3867'>
     &amp;           ,FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='3868'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='3869'>
<a name='3870'>
<a name='3871'>
        gamma=4.4<a name='3872'>
        DEL_T	=TIN-273.15<a name='3873'>
	ICE_TYPE=2<a name='3874'>
	F1_MAX=0.<a name='3875'>
	F2_MAX=0.<a name='3876'>
	F3_MAX=0.<a name='3877'>
	F4_MAX=0.<a name='3878'>
	F5_MAX=0.<a name='3879'>
	DO 1 KR=1,NKR<a name='3880'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='3881'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='3882'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='3883'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='3884'>
	DO 1 ICE=1,ICEMAX<a name='3885'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='3886'>
    1	CONTINUE<a name='3887'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='3888'>
<font color=#447700>! MELTING :<a name='3889'></font>
	IF(DEL_T.GE.0.AND.FF_MAX.NE.0) THEN<a name='3890'>
	  SUM_ICE=0.<a name='3891'>
<font color=#447700>! MASS LOOP :<a name='3892'></font>
  	  DO KR=1,NKR<a name='3893'>
	     ARG_M=FF3(KR)+FF4(KR)+FF5(KR)<a name='3894'>
	     DO ICE=1,ICEMAX<a name='3895'>
	        ARG_M=ARG_M+FF2(KR,ICE)<a name='3896'>
      	        FF2(KR,ICE)=0.<a name='3897'>
 	     ENDDO<a name='3898'>
      	     FF1(KR)=FF1(KR)+ARG_M<a name='3899'>
      	     FF3(KR)=0.<a name='3900'>
             FF4(KR)=0.<a name='3901'>
      	     FF5(KR)=0.<a name='3902'>
	     SUM_ICE=SUM_ICE+ARG_M*3.*XL(KR)*XL(KR)*COL<a name='3903'>
<font color=#447700>! END OF "MASS LOOP"<a name='3904'></font>
	  ENDDO<a name='3905'>
<font color=#447700>! CYCLE BY KR<a name='3906'></font>
<font color=#447700>! NEW TEMPERATURE :<a name='3907'></font>
	  ARG_1=333.*SUM_ICE/RO	<a name='3908'>
	  TIN=TIN-ARG_1<a name='3909'>
<font color=#447700>! END OF MELTING<a name='3910'></font>
<font color=#447700>! IN CASE DEL_T.GE.0.AND.FF_MAX.NE.0<a name='3911'></font>
	ENDIF<a name='3912'>
   	RETURN                                                           <a name='3913'>
      	END SUBROUTINE ORIG_MELT                                                             <a name='3914'>
<font color=#447700>!===================================================================<a name='3915'></font>
<A NAME='J_W_MELT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#J_W_MELT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3916'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>J_W_MELT</font>(FF1,XL,FF2,XI,FF3,XS,FF4,XG,FF5,XH &amp; <A href='../../call_to/J_W_MELT.html' TARGET='index'>2</A><a name='3917'>
     &amp;                           ,TIN,DT,RO,COL,ICEMAX,NKR)<a name='3918'>
      IMPLICIT NONE<a name='3919'>
      INTEGER KR,ICE,ICE_TYPE<a name='3920'>
      INTEGER ICEMAX,NKR<a name='3921'>
      REAL COL<a name='3922'>
      REAL ARG_M,TT_DROP,ARG_1,TT_DROP_AFTER_FREEZ,DT,DF1,DN,DN0, &amp;<a name='3923'>
     &amp; RO,A,B,DTFREEZ,SUM_ICE,FF_MAX,F1_MAX,F2_MAX,F3_MAX,F4_MAX,F5_MAX, &amp;<a name='3924'>
     &amp; DEL_T,TIN,meltrate<a name='3925'>
        REAL FF1(NKR),XL(NKR),FF2(NKR,ICEMAX),XI(NKR,ICEMAX) &amp;<a name='3926'>
     &amp;           ,FF3(NKR),XS(NKR),FF4(NKR) &amp;<a name='3927'>
     &amp;           ,XG(NKR),FF5(NKR),XH(NKR)<a name='3928'>
<a name='3929'>
<a name='3930'>
<font color=#447700>!       gamma=4.4<a name='3931'></font>
        DEL_T	=TIN-273.15<a name='3932'>
	F1_MAX=0.<a name='3933'>
	F2_MAX=0.<a name='3934'>
	F3_MAX=0.<a name='3935'>
	F4_MAX=0.<a name='3936'>
	F5_MAX=0.<a name='3937'>
	DO 1 KR=1,NKR<a name='3938'>
	F1_MAX=AMAX1(F1_MAX,FF1(KR))<a name='3939'>
	F3_MAX=AMAX1(F3_MAX,FF3(KR))<a name='3940'>
	F4_MAX=AMAX1(F4_MAX,FF4(KR))<a name='3941'>
	F5_MAX=AMAX1(F5_MAX,FF5(KR))<a name='3942'>
	DO 1 ICE=1,ICEMAX<a name='3943'>
     	F2_MAX=AMAX1(F2_MAX,FF2(KR,ICE))<a name='3944'>
    1	CONTINUE<a name='3945'>
    	FF_MAX=AMAX1(F2_MAX,F3_MAX,F4_MAX,F5_MAX)<a name='3946'>
<font color=#447700>! MELTING :<a name='3947'></font>
	SUM_ICE=0.<a name='3948'>
	IF(DEL_T.GE.0.AND.FF_MAX.NE.0) THEN<a name='3949'>
<font color=#447700>! Fan's "MASS LOOP"<a name='3950'></font>
          DO KR = 1,NKR<a name='3951'>
          ARG_M = 0.<a name='3952'>
            DO ICE = 1,ICEMAX<a name='3953'>
             IF (ICE ==1) THEN<a name='3954'>
                 IF (KR .le. 10) THEN<a name='3955'>
                     ARG_M = ARG_M+FF2(KR,ICE)<a name='3956'>
                     FF2(KR,ICE)=0.<a name='3957'>
                 ELSEIF (KR .gt. 10 .and. KR .lt. 18) THEN<a name='3958'>
                     meltrate = 0.5/50.<a name='3959'>
                     ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='3960'>
                     FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='3961'>
                 ELSE<a name='3962'>
                     meltrate = 0.683/120.<a name='3963'>
                     ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='3964'>
                     FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='3965'>
                 ENDIF<a name='3966'>
             ENDIF<a name='3967'>
             IF (ICE ==2 .or. ICE ==3) THEN<a name='3968'>
                IF (kr .le. 12) THEN<a name='3969'>
                    ARG_M = ARG_M+FF2(KR,ICE)<a name='3970'>
                    FF2(KR,ICE)=0.<a name='3971'>
                ELSEIF (kr .gt. 12 .and. kr .lt. 20) THEN<a name='3972'>
                    meltrate = 0.5/50.<a name='3973'>
                    ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='3974'>
                    FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='3975'>
                 ELSE<a name='3976'>
                    meltrate = 0.683/120.<a name='3977'>
                    ARG_M=ARG_M+FF2(KR,ICE)*(meltrate*dt)<a name='3978'>
                    FF2(KR,ICE)=FF2(KR,ICE)-FF2(KR,ICE)*(meltrate*dt)<a name='3979'>
                 ENDIF<a name='3980'>
             ENDIF<a name='3981'>
            ENDDO  <font color=#447700>! Do ice<a name='3982'></font>
<font color=#447700>! snow<a name='3983'></font>
                 IF (kr .le. 14) THEN<a name='3984'>
                    ARG_M = ARG_M+FF3(KR)<a name='3985'>
                    FF3(KR)=0.<a name='3986'>
                 ELSEIF (kr .gt. 14 .and. kr .lt. 22) THEN<a name='3987'>
                    meltrate = 0.5/50.<a name='3988'>
                    ARG_M=ARG_M+FF3(KR)*(meltrate*dt)<a name='3989'>
                    FF3(KR)=FF3(KR)-FF3(KR)*(meltrate*dt)<a name='3990'>
                 ELSE<a name='3991'>
                    meltrate = 0.683/120.<a name='3992'>
                    ARG_M=ARG_M+FF3(KR)*(meltrate*dt)<a name='3993'>
                    FF3(KR)=FF3(KR)-FF3(KR)*(meltrate*dt)<a name='3994'>
                 ENDIF<a name='3995'>
<font color=#447700>! graupel/hail<a name='3996'></font>
                 IF (kr .le. 13) then<a name='3997'>
                     ARG_M = ARG_M+FF4(KR)+FF5(KR)<a name='3998'>
                     FF4(KR)=0.<a name='3999'>
                     FF5(KR)=0.<a name='4000'>
                 ELSEIF (kr .gt. 13 .and. kr .lt. 23) THEN<a name='4001'>
                     meltrate = 0.5/50.<a name='4002'>
                     ARG_M=ARG_M+(FF4(KR)+FF5(KR))*(meltrate*dt)<a name='4003'>
                     FF4(KR)=FF4(KR)-FF4(KR)*(meltrate*dt)<a name='4004'>
                     FF5(KR)=FF5(KR)-FF5(KR)*(meltrate*dt)<a name='4005'>
                 ELSE<a name='4006'>
                    meltrate = 0.683/120.<a name='4007'>
                    ARG_M=ARG_M+(FF4(KR)+FF5(KR))*(meltrate*dt)<a name='4008'>
                    FF4(KR)=FF4(KR)-FF4(KR)*(meltrate*dt)<a name='4009'>
                    FF5(KR)=FF5(KR)-FF5(KR)*(meltrate*dt)<a name='4010'>
                 ENDIF<a name='4011'>
<a name='4012'>
                   FF1(KR)=FF1(KR)+ARG_M<a name='4013'>
<a name='4014'>
                   SUM_ICE=SUM_ICE+ARG_M*3.*XL(KR)*XL(KR)*COL<a name='4015'>
<font color=#447700>! END OF Fan'a "MASS LOOP"<a name='4016'></font>
       ENDDO<a name='4017'>
<font color=#447700>! CYCLE BY KR<a name='4018'></font>
<font color=#447700>! NEW TEMPERATURE :<a name='4019'></font>
        ARG_1=333.*SUM_ICE/RO<a name='4020'>
        TIN=TIN-ARG_1<a name='4021'>
<font color=#447700>! END OF MELTING<a name='4022'></font>
<a name='4023'>
	ENDIF<a name='4024'>
   	RETURN                                                           <a name='4025'>
      	END SUBROUTINE J_W_MELT                                                             <a name='4026'>
<font color=#447700>!===================================================================<a name='4027'></font>
<A NAME='JERNUCL01'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERNUCL01' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4028'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERNUCL01</font>(PSI1,PSI2,FCCNR &amp; <A href='../../call_to/JERNUCL01.html' TARGET='index'>2</A>,<A href='../../call_from/JERNUCL01.html' TARGET='index'>4</A><a name='4029'>
     &amp;                    ,X1,X2,DTT,DQQ,ROR,PP,DSUP1,DSUP2 &amp;<a name='4030'>
     &amp;  ,COL,AA1_MY, BB1_MY, AA2_MY, BB2_MY &amp;<a name='4031'>
     &amp;  ,C1_MEY,C2_MEY,SUP2_OLD,DSUPICEXZ &amp;<a name='4032'>
     &amp;  ,RCCN,DROPRADII,NKR,ICEMAX,ICEPROCS)<a name='4033'>
      IMPLICIT NONE <a name='4034'>
<font color=#447700>!<a name='4035'></font>
      INTEGER ICEMAX,NKR<a name='4036'>
      INTEGER ICEPROCS<a name='4037'>
      REAL COL,AA1_MY, BB1_MY, AA2_MY, BB2_MY, &amp;<a name='4038'>
     &amp;  C1_MEY,C2_MEY,SUP2_OLD,DSUPICEXZ, &amp;<a name='4039'>
     &amp;  RCCN(NKR),DROPRADII(NKR),FCCNR(NKR)<a name='4040'>
<font color=#447700>!<a name='4041'></font>
      INTEGER KR,ICE,ITYPE,NRGI,ICORR,II,JJ,KK,NKRDROP,NCRITI<a name='4042'>
       DOUBLE PRECISION DTT,DQQ,DSUP1,DSUP2<a name='4043'>
       REAL TT,QQ,              &amp;<a name='4044'>
     &amp; DX,BMASS,CONCD,C2,CONCDF,DELTACD,CONCDIN,ROR, &amp;<a name='4045'>
     &amp; DELTAF,DELMASSL,FMASS,HELEK1,DEL2NN,FF1BN, &amp;<a name='4046'>
     &amp; HELEK2,TPCC,PP,ADDF,DSUP2N,FACT,EW1N,ES2N,ES1N,FNEW, &amp;<a name='4047'>
     &amp; C1,SUP1N,SUP2N,QPN,TPN,TPC,SUP1,SUP2,DEL1N,DEL2N,AL1,AL2, &amp;<a name='4048'>
     &amp; TEMP1,TEMP2,TEMP3,A1,B1,A2,B2 <a name='4049'>
<font color=#447700>!<a name='4050'></font>
<a name='4051'>
<font color=#447700>!********************************************************************<a name='4052'></font>
<a name='4053'>
<font color=#447700>! NEW MEYERS IN JERNUCL01 SUBROUTINE <a name='4054'></font>
<a name='4055'>
<a name='4056'>
<a name='4057'>
<font color=#447700>!********************************************************************<a name='4058'></font>
<a name='4059'>
<a name='4060'>
<a name='4061'>
      REAL PSI1(NKR),X1(NKR),DROPCONCN(NKR) &amp;<a name='4062'>
     &amp;     ,PSI2(NKR,ICEMAX),X2(NKR,ICEMAX)<a name='4063'>
      <a name='4064'>
<a name='4065'>
      DATA A1,B1,A2,B2/-0.639,0.1296,-2.8,0.262/<a name='4066'>
      DATA TEMP1,TEMP2,TEMP3/-5.,-2.,-20./<a name='4067'>
      DATA AL1/2500./,AL2/2834./<a name='4068'>
      SUP1=DSUP1<a name='4069'>
      SUP2=DSUP2<a name='4070'>
<a name='4071'>
<a name='4072'>
      TT=DTT<a name='4073'>
      QQ=DQQ<a name='4074'>
<font color=#447700>! DROPLETS NUCLEATION (BEGIN)<a name='4075'></font>
<a name='4076'>
        TPN=TT<a name='4077'>
        QPN=QQ<a name='4078'>
<a name='4079'>
        DEL1N=100.*SUP1<a name='4080'>
        TPC=TT-273.15<a name='4081'>
<a name='4082'>
        IF(DEL1N.GT.0.AND.TPC.GT.-30.) THEN<a name='4083'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#WATER_NUCL'>WATER_NUCL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WATER_NUCL_1"> (PSI1,FCCNR,X1,TT,SUP1  &amp;<a name='4084'>
     &amp;        ,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4085'>
        ENDIF<a name='4086'>
<font color=#447700>! DROPLETS NUCLEATION (END)<a name='4087'></font>
<font color=#447700>! drop nucleation                                               (end)<a name='4088'></font>
<font color=#447700>! nucleation of crystals                                      (begin)<a name='4089'></font>
<a name='4090'>
       IF (ICEPROCS.EQ.1)THEN<a name='4091'>
        DEL2N=100.*SUP2<a name='4092'>
        IF(TPC.LT.0..AND.TPC.GE.-35..AND.DEL2N.GT.0.) THEN<a name='4093'>
<a name='4094'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ICE_NUCL'>ICE_NUCL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNUCL01' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ICE_NUCL_1"> (PSI2,X2,TT,ROR,SUP2,SUP2_OLD &amp;<a name='4095'>
     &amp;                      ,C1_MEY,C2_MEY,COL,DSUPICEXZ &amp;<a name='4096'>
     &amp;                      ,NKR,ICEMAX)<a name='4097'>
        ENDIF<a name='4098'>
       ENDIF<a name='4099'>
<font color=#447700>! nucleation of crystals                                        (end)<a name='4100'></font>
<font color=#447700>! new change in drop nucleation                               (begin)<a name='4101'></font>
<font color=#447700>! no sink of water vapour by nucleation<a name='4102'></font>
      RETURN<a name='4103'>
      END SUBROUTINE JERNUCL01<a name='4104'>
<a name='4105'>
<font color=#447700>! SUBROUTINE JERNUCL01<a name='4106'></font>
<font color=#447700>!======================================================================      <a name='4107'></font>
<A NAME='WATER_NUCL'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#WATER_NUCL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4108'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>WATER_NUCL</font> (PSI1,FCCNR,X1,TT,SUP1 &amp; <A href='../../call_to/WATER_NUCL.html' TARGET='index'>2</A>,<A href='../../call_from/WATER_NUCL.html' TARGET='index'>2</A><a name='4109'>
     &amp;,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4110'>
      IMPLICIT NONE<a name='4111'>
      INTEGER NDROPMAX,KR,ICEMAX,NKR<a name='4112'>
      REAL PSI1(NKR),FCCNR(NKR),X1(NKR)<a name='4113'>
      REAL DROPCONCN(NKR)<a name='4114'>
      REAL RCCN(NKR),DROPRADII(NKR)<a name='4115'>
      REAL TT,SUP1,DX,COL<a name='4116'>
<a name='4117'>
<a name='4118'>
      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION'>NUCLEATION</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#WATER_NUCL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NUCLEATION_1"> (SUP1,TT,FCCNR,DROPCONCN  &amp;<a name='4119'>
     &amp;,NDROPMAX,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4120'>
<a name='4121'>
<font color=#447700>! NEW WATER SIZE DISTRIBUTION FUNCTION (BEGIN)<a name='4122'></font>
        DO KR=1,NDROPMAX<a name='4123'>
           DX=3.*COL*X1(KR)<a name='4124'>
<font color=#447700>! new changes 25.06.01                                        (begin)<a name='4125'></font>
           PSI1(KR)=PSI1(KR)+DROPCONCN(KR)/DX<a name='4126'>
<font color=#447700>! new changes 25.06.01                                          (end)<a name='4127'></font>
        ENDDO<a name='4128'>
<a name='4129'>
      RETURN<a name='4130'>
      END SUBROUTINE WATER_NUCL<a name='4131'>
<A NAME='ICE_NUCL'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ICE_NUCL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4132'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>ICE_NUCL</font> (PSI2,X2,TT,ROR,SUP2,SUP2_OLD &amp; <A href='../../call_to/ICE_NUCL.html' TARGET='index'>2</A><a name='4133'>
     &amp;                      ,C1_MEY,C2_MEY,COL,DSUPICEXZ &amp;<a name='4134'>
     &amp;                      ,NKR,ICEMAX)<a name='4135'>
        IMPLICIT NONE<a name='4136'>
        INTEGER ITYPE,KR,ICE,NRGI,ICEMAX,NKR<a name='4137'>
        REAL DEL2N,SUP2,C1,C2,C1_MEY,C2_MEY,TPC,TT,ROR<a name='4138'>
        REAL DX,COL,BMASS,BFMASS,FMASS<a name='4139'>
        REAL HELEK1,HELEK2,TPCC,DEL2NN,FF1BN,DSUPICEXZ<a name='4140'>
        REAL FACT,DSUP2N,SUP2_OLD,DELTACD,DELTAF,ADDF,FNEW<a name='4141'>
        REAL X2(NKR,ICEMAX),PSI2(NKR,ICEMAX)<a name='4142'>
<a name='4143'>
        REAL A1,B1,A2,B2<a name='4144'>
        DATA A1,B1,A2,B2/-0.639,0.1296,-2.8,0.262/<a name='4145'>
        REAL TEMP1,TEMP2,TEMP3<a name='4146'>
        DATA TEMP1,TEMP2,TEMP3/-5.,-2.,-20./<a name='4147'>
<a name='4148'>
        C1=C1_MEY<a name='4149'>
        C2=C2_MEY<a name='4150'>
<font color=#447700>! TYPE OF ICE WITH NUCLEATION (BEGIN)<a name='4151'></font>
<a name='4152'>
        TPC=TT-273.15<a name='4153'>
        ITYPE=0<a name='4154'>
<a name='4155'>
        IF((TPC.GT.-4.0).OR.(TPC.LE.-8.1.AND.TPC.GT.-12.7).OR.&amp;<a name='4156'>
     &amp;  (TPC.LE.-17.8.AND.TPC.GT.-22.4)) THEN<a name='4157'>
          ITYPE=2<a name='4158'>
        ELSE<a name='4159'>
          IF((TPC.LE.-4.0.AND.TPC.GT.-8.1).OR.(TPC.LE.-22.4)) THEN<a name='4160'>
            ITYPE=1<a name='4161'>
          ELSE<a name='4162'>
            ITYPE=3<a name='4163'>
          ENDIF<a name='4164'>
        ENDIF<a name='4165'>
<a name='4166'>
<a name='4167'>
<a name='4168'>
<font color=#447700>! NEW CRYSTAL SIZE DISTRIBUTION FUNCTION                      (BEGIN)<a name='4169'></font>
<a name='4170'>
        ICE=ITYPE<a name='4171'>
<a name='4172'>
        NRGI=2<a name='4173'>
        IF(TPC.LT.TEMP1) THEN<a name='4174'>
          DEL2N=100.*SUP2<a name='4175'>
          DEL2NN=DEL2N<a name='4176'>
          IF(DEL2N.GT.50.0) DEL2NN=50.<a name='4177'>
          HELEK1=C1*EXP(A1+B1*DEL2NN)<a name='4178'>
        ELSE<a name='4179'>
          HELEK1=0.<a name='4180'>
        ENDIF<a name='4181'>
<a name='4182'>
        IF(TPC.LT.TEMP2) THEN<a name='4183'>
          TPCC=TPC<a name='4184'>
          IF(TPCC.LT.TEMP3) TPCC=TEMP3<a name='4185'>
          HELEK2=C2*EXP(A2-B2*TPCC)<a name='4186'>
        ELSE<a name='4187'>
          HELEK2=0.<a name='4188'>
        ENDIF<a name='4189'>
<a name='4190'>
        FF1BN=HELEK1+HELEK2<a name='4191'>
<a name='4192'>
        FACT=1.<a name='4193'>
        DSUP2N=(SUP2-SUP2_OLD+DSUPICEXZ)*100.<a name='4194'>
<a name='4195'>
        SUP2_OLD=SUP2<a name='4196'>
<a name='4197'>
        IF(DSUP2N.GT.50.) DSUP2N=50.<a name='4198'>
<a name='4199'>
        DELTACD=FF1BN*B1*DSUP2N<a name='4200'>
<a name='4201'>
        IF(DELTACD.GE.FF1BN) DELTACD=FF1BN<a name='4202'>
<a name='4203'>
        IF(DELTACD.GT.0.) THEN<a name='4204'>
          DELTAF=DELTACD*FACT<a name='4205'>
          DO KR=1,NRGI-1<a name='4206'>
             DX=3.*X2(KR,ICE)*COL<a name='4207'>
             ADDF=DELTAF/DX<a name='4208'>
             PSI2(KR,ICE)=PSI2(KR,ICE)+ADDF<a name='4209'>
          ENDDO<a name='4210'>
        ENDIF<a name='4211'>
<font color=#447700>! NEW CRYSTAL SIZE DISTRIBUTION FUNCTION                        (END)<a name='4212'></font>
       RETURN<a name='4213'>
       END SUBROUTINE ICE_NUCL<a name='4214'>
<a name='4215'>
<a name='4216'>
<a name='4217'>
<a name='4218'>
<a name='4219'>
<A NAME='NUCLEATION'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#NUCLEATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4220'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>NUCLEATION</font> (SUP1,TT,FCCNR,DROPCONCN  &amp; <A href='../../call_to/NUCLEATION.html' TARGET='index'>2</A>,<A href='../../call_from/NUCLEATION.html' TARGET='index'>14</A><a name='4221'>
     &amp;,NDROPMAX,COL,RCCN,DROPRADII,NKR,ICEMAX)<a name='4222'>
<font color=#447700>! DROPCONCN(KR), 1/cm^3 - drop bin concentrations, KR=1,...,NKR<a name='4223'></font>
<a name='4224'>
<font color=#447700>! determination of new size spectra due to drop nucleation<a name='4225'></font>
<a name='4226'>
      IMPLICIT NONE<a name='4227'>
      INTEGER NDROPMAX,IDROP,ICCN,INEXT,ISMALL,KR,NCRITI<a name='4228'>
      INTEGER ICEMAX,IMIN,IMAX,NKR,I,II,I0,I1<a name='4229'>
      REAL &amp;<a name='4230'>
     &amp;  SUP1,TT,RACTMAX,XKOE,R03,SUPCRITI,AKOE23,RCRITI,BKOE, &amp;<a name='4231'>
     &amp;  AKOE,CONCCCNIN,DEG01,ALN_IP<a name='4232'>
      REAL CCNCONC(NKR)<a name='4233'>
      REAL CCNCONC_BFNUCL<a name='4234'>
<a name='4235'>
<a name='4236'>
      REAL COL<a name='4237'>
      REAL RCCN(NKR),DROPRADII(NKR),FCCNR(NKR)<a name='4238'>
      REAL RACT(NKR),DROPCONC(NKR),DROPCONCN(NKR)<a name='4239'>
      REAL DLN1,DLN2,FOLD_IP<a name='4240'>
<a name='4241'>
<a name='4242'>
<a name='4243'>
        DEG01=1./3.<a name='4244'>
<a name='4245'>
<a name='4246'>
<font color=#447700>! calculation initial value of NDROPMAX - maximal number of drop bin<a name='4247'></font>
<font color=#447700>! which is activated<a name='4248'></font>
<a name='4249'>
<font color=#447700>! initial value of NDROPMAX<a name='4250'></font>
<a name='4251'>
        NDROPMAX=0<a name='4252'>
<a name='4253'>
        DO KR=1,NKR<a name='4254'>
<font color=#447700>! initialization of bin radii of activated drops<a name='4255'></font>
           RACT(KR)=0.<a name='4256'>
<font color=#447700>! initialization of aerosol(CCN) bin concentrations<a name='4257'></font>
           CCNCONC(KR)=0.<a name='4258'>
<font color=#447700>! initialization of drop bin concentrations<a name='4259'></font>
           DROPCONCN(KR)=0.<a name='4260'>
        ENDDO<a name='4261'>
<a name='4262'>
<a name='4263'>
<font color=#447700>! CCNCONC_BFNUCL - concentration of aerosol particles before<a name='4264'></font>
<font color=#447700>!                  nucleation<a name='4265'></font>
<a name='4266'>
        CCNCONC_BFNUCL=0.<a name='4267'>
        DO I=1,NKR<a name='4268'>
           CCNCONC_BFNUCL=CCNCONC_BFNUCL+FCCNR(I)<a name='4269'>
        ENDDO<a name='4270'>
<a name='4271'>
        CCNCONC_BFNUCL=CCNCONC_BFNUCL*COL<a name='4272'>
<a name='4273'>
        IF(CCNCONC_BFNUCL.EQ.0.) THEN<a name='4274'>
           RETURN    <a name='4275'>
        ELSE<a name='4276'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDARY'>BOUNDARY</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BOUNDARY_1">(IMIN,IMAX,FCCNR,NKR)<a name='4277'>
           CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CRITICAL'>CRITICAL</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CRITICAL_1"> (AKOE,BKOE,TT,RCRITI,SUP1,DEG01)<a name='4278'>
           IF(RCRITI.GE.RCCN(IMAX))  RETURN<a name='4279'>
        END IF<a name='4280'>
<a name='4281'>
<font color=#447700>! calculation of CCNCONC(I) - aerosol(CCN) bin concentrations;<a name='4282'></font>
<font color=#447700>!                             I=IMIN,...,IMAX<a name='4283'></font>
<font color=#447700>! determination of NCRITI - number bin in which is located RCRITI<a name='4284'></font>
        IF (IMIN.EQ.1)THEN<a name='4285'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNIMIN'>CCNIMIN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNIMIN_1">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4286'>
     &amp;       FCCNR,NKR)<a name='4287'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNLOOP'>CCNLOOP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNLOOP_1">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4288'>
     &amp;       FCCNR,NKR)<a name='4289'>
        ELSE<a name='4290'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#CCNLOOP'>CCNLOOP</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CCNLOOP_2">(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp;<a name='4291'>
     &amp;       FCCNR,NKR)<a name='4292'>
        END IF<a name='4293'>
<a name='4294'>
<a name='4295'>
<font color=#447700>! calculation CCNCONC_AFNUCL - ccn concentration after nucleation<a name='4296'></font>
<a name='4297'>
<font color=#447700>!       CCNCONC_AFNUCL=0.<a name='4298'></font>
<a name='4299'>
<font color=#447700>!       DO I=IMIN,IMAX<a name='4300'></font>
<font color=#447700>!          CCNCONC_AFNUCL=CCNCONC_AFNUCL+FCCNR(I)<a name='4301'></font>
<font color=#447700>!       ENDDO<a name='4302'></font>
<a name='4303'>
<font color=#447700>!       CCNCONC_AFNUCL=CCNCONC_AFNUCL*COL<a name='4304'></font>
<a name='4305'>
<font color=#447700>! calculation DEL_CCNCONC<a name='4306'></font>
<a name='4307'>
<font color=#447700>!       DEL_CCNCONC=CCNCONC_BFNUCL-CCNCONC_AFNUCL<a name='4308'></font>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#ACTIVATE'>ACTIVATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ACTIVATE_5">(IMIN,IMAX,AKOE,BKOE,RCCN,RACT,RACTMAX,NKR)<a name='4309'>
<a name='4310'>
<a name='4311'>
<a name='4312'>
        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#DROPMAX'>DROPMAX</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#NUCLEATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DROPMAX_1">(DROPRADII,RACTMAX,NDROPMAX,NKR)<a name='4313'>
<font color=#447700>! put nucleated droplets into the drop bin according to radius<a name='4314'></font>
<font color=#447700>! change in drop concentration due to activation DROPCONCN(IDROP)<a name='4315'></font>
        ISMALL=NCRITI<a name='4316'>
<a name='4317'>
        INEXT=ISMALL<a name='4318'>
<font color=#447700>!       ISMALL=1<a name='4319'></font>
<a name='4320'>
<font color=#447700>!       INEXT=ISMALL<a name='4321'></font>
<a name='4322'>
        DO IDROP=1,NDROPMAX<a name='4323'>
           DROPCONCN(IDROP)=0.<a name='4324'>
           DO I=ISMALL,IMAX<a name='4325'>
              IF(RACT(I).LE.DROPRADII(IDROP)) THEN<a name='4326'>
                DROPCONCN(IDROP)=DROPCONCN(IDROP)+CCNCONC(I)<a name='4327'>
                INEXT=I+1<a name='4328'>
              ENDIF<a name='4329'>
           ENDDO<a name='4330'>
           ISMALL=INEXT<a name='4331'>
        ENDDO<a name='4332'>
<a name='4333'>
<font color=#447700>!999    CONTINUE<a name='4334'></font>
<a name='4335'>
<a name='4336'>
        RETURN<a name='4337'>
        END SUBROUTINE NUCLEATION<a name='4338'>
<a name='4339'>
<a name='4340'>
<a name='4341'>
<A NAME='BOUNDARY'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4342'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>BOUNDARY</font>(IMIN,IMAX,FCCNR,NKR) <A href='../../call_to/BOUNDARY.html' TARGET='index'>2</A><a name='4343'>
<font color=#447700>! IMIN - left CCN spectrum boundary<a name='4344'></font>
        IMPLICIT NONE<a name='4345'>
        INTEGER I,IMIN,IMAX,NKR<a name='4346'>
        REAL FCCNR(NKR)<a name='4347'>
<a name='4348'>
        IMIN=0<a name='4349'>
<a name='4350'>
        DO I=1,NKR<a name='4351'>
           IF(FCCNR(I).NE.0.) THEN<a name='4352'>
             IMIN=I<a name='4353'>
             GOTO 40<a name='4354'>
           ENDIF<a name='4355'>
        ENDDO<a name='4356'>
<a name='4357'>
 40     CONTINUE<a name='4358'>
<a name='4359'>
<font color=#447700>! IMAX - right CCN spectrum boundary<a name='4360'></font>
<a name='4361'>
        IMAX=0<a name='4362'>
<a name='4363'>
        DO I=NKR,1,-1<a name='4364'>
           IF(FCCNR(I).NE.0.) THEN<a name='4365'>
             IMAX=I<a name='4366'>
             GOTO 41<a name='4367'>
           ENDIF<a name='4368'>
        ENDDO<a name='4369'>
<a name='4370'>
 41     CONTINUE<a name='4371'>
        RETURN<a name='4372'>
        END  SUBROUTINE BOUNDARY<a name='4373'>
<a name='4374'>
<A NAME='CRITICAL'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#CRITICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4375'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CRITICAL</font> (AKOE,BKOE,TT,RCRITI,SUP1,DEG01) <A href='../../call_to/CRITICAL.html' TARGET='index'>2</A><a name='4376'>
<font color=#447700>! AKOE &amp; BKOE - constants in Koehler equation<a name='4377'></font>
        IMPLICIT NONE<a name='4378'>
        REAL AKOE,BKOE,TT,RCRITI,SUP1,DEG01<a name='4379'>
        REAL RO_SOLUTE<a name='4380'>
        PARAMETER (RO_SOLUTE=2.16)<a name='4381'>
<a name='4382'>
         <a name='4383'>
<a name='4384'>
        AKOE=3.3E-05/TT<a name='4385'>
        BKOE=2.*4.3/(22.9+35.5)<a name='4386'>
<font color=#447700>! new change 21.07.02                                         (begin)<a name='4387'></font>
        BKOE=BKOE*(4./3.)*3.141593*RO_SOLUTE                  <a name='4388'>
<font color=#447700>! new change 21.07.02                                           (end)<a name='4389'></font>
        <a name='4390'>
<a name='4391'>
<font color=#447700>! table of critical aerosol radii<a name='4392'></font>
<a name='4393'>
<font color=#447700>!	GOTO 992<a name='4394'></font>
<a name='4395'>
<font color=#447700>! SUP1_TEST(I), %<a name='4396'></font>
<font color=#447700>!       SUP1_TEST(1)=0.01<a name='4397'></font>
<font color=#447700>!       DO I=1,99<a name='4398'></font>
<font color=#447700>!          SUP1_TEST(I+1)=SUP1_TEST(I)+0.01<a name='4399'></font>
<font color=#447700>!          SUP1_I=SUP1_TEST(I)*0.01<a name='4400'></font>
<font color=#447700>!          RCRITI_TEST(I)=(AKOE/3.)*(4./BKOE/SUP1_I/SUP1_I)**DEG01<a name='4401'></font>
<font color=#447700>!       ENDDO<a name='4402'></font>
<a name='4403'>
<font color=#447700>! RCRITI, cm - critical radius of "dry" aerosol<a name='4404'></font>
<a name='4405'>
        RCRITI=(AKOE/3.)*(4./BKOE/SUP1/SUP1)**DEG01<a name='4406'>
        RETURN<a name='4407'>
        END  SUBROUTINE CRITICAL<a name='4408'>
            <a name='4409'>
<A NAME='CCNIMIN'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#CCNIMIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4410'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CCNIMIN</font>(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp; <A href='../../call_to/CCNIMIN.html' TARGET='index'>2</A><a name='4411'>
     &amp;       FCCNR,NKR)<a name='4412'>
<font color=#447700>! FOR    IMIN=1<a name='4413'></font>
        IMPLICIT NONE<a name='4414'>
        INTEGER IMIN,II,IMAX,NCRITI,NKR<a name='4415'>
        REAL RCRITI,COL<a name='4416'>
        REAL RCCN(NKR),FCCNR(NKR),CCNCONC(NKR)<a name='4417'>
        REAL RCCN_MIN<a name='4418'>
        REAL DLN1,DLN2,FOLD_IP<a name='4419'>
<font color=#447700>! rccn_min - minimum aerosol(ccn) radius<a name='4420'></font>
        RCCN_MIN=RCCN(1)/10000.<a name='4421'>
<font color=#447700>! calculation of ccnconc(ii)=fccnr(ii)*col - aerosol(ccn) bin<a name='4422'></font>
<font color=#447700>!                                            concentrations,<a name='4423'></font>
<font color=#447700>!                                            ii=imin,...,imax<a name='4424'></font>
<font color=#447700>! determination of ncriti   - number bin in which is located rcriti<a name='4425'></font>
<font color=#447700>! calculation of ccnconc(ncriti)=fccnr(ncriti)*dln1/(dln1+dln2),<a name='4426'></font>
<font color=#447700>! where,    <a name='4427'></font>
<font color=#447700>! dln1=Ln(rcriti)-Ln(rccn_min)<a name='4428'></font>
<font color=#447700>! dln2=Ln(rccn(1)-Ln(rcriti)<a name='4429'></font>
<font color=#447700>! calculation of new value of fccnr(ncriti)<a name='4430'></font>
<a name='4431'>
<font color=#447700>!       IF(IMIN.EQ.1) THEN<a name='4432'></font>
          IF(RCRITI.LE.RCCN_MIN) THEN<a name='4433'>
            NCRITI=1<a name='4434'>
            DO II=NCRITI+1,IMAX<a name='4435'>
               CCNCONC(II)=COL*FCCNR(II)     <a name='4436'>
               FCCNR(II)=0.                  <a name='4437'>
            ENDDO<a name='4438'>
            GOTO 42<a name='4439'>
          ENDIF<a name='4440'>
          IF(RCRITI.GT.RCCN_MIN.AND.RCRITI.LT.RCCN(IMIN)) THEN<a name='4441'>
            NCRITI=1<a name='4442'>
            DO II=NCRITI+1,IMAX<a name='4443'>
               CCNCONC(II)=COL*FCCNR(II)<a name='4444'>
               FCCNR(II)=0.<a name='4445'>
            ENDDO<a name='4446'>
            DLN1=ALOG(RCRITI)-ALOG(RCCN_MIN)<a name='4447'>
            DLN2=ALOG(RCCN(1))-ALOG(RCRITI)<a name='4448'>
            CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='4449'>
            FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/(DLN1+DLN2)<a name='4450'>
            GOTO 42<a name='4451'>
<font color=#447700>! in case RCRITI.GT.RCCN_MIN.AND.RCRITI.LT.RCCN(IMIN)<a name='4452'></font>
          ENDIF<a name='4453'>
<font color=#447700>! in case IMIN.EQ.1<a name='4454'></font>
42       CONTINUE<a name='4455'>
     <a name='4456'>
         RETURN<a name='4457'>
         END SUBROUTINE CCNIMIN<a name='4458'>
<A NAME='CCNLOOP'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#CCNLOOP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4459'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>CCNLOOP</font>(IMIN,IMAX,RCRITI,NCRITI,RCCN,CCNCONC,COL, &amp; <A href='../../call_to/CCNLOOP.html' TARGET='index'>4</A><a name='4460'>
     &amp;       FCCNR,NKR)<a name='4461'>
        IMPLICIT NONE<a name='4462'>
         INTEGER I,IMIN,IMAX,NKR,II,NCRITI<a name='4463'>
         REAL COL<a name='4464'>
         REAL RCRITI,RCCN(NKR),CCNCONC(NKR),FCCNR(NKR)<a name='4465'>
         REAL DLN1,DLN2,FOLD_IP<a name='4466'>
        IF(IMIN.GT.1) THEN<a name='4467'>
          IF(RCRITI.LE.RCCN(IMIN-1)) THEN<a name='4468'>
            NCRITI=IMIN<a name='4469'>
            DO II=NCRITI,IMAX<a name='4470'>
               CCNCONC(II)=COL*FCCNR(II)<a name='4471'>
               FCCNR(II)=0.<a name='4472'>
            ENDDO<a name='4473'>
            GOTO 42<a name='4474'>
          ENDIF<a name='4475'>
          IF(RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)) &amp;<a name='4476'>
     &amp;    THEN<a name='4477'>
<font color=#447700>! this line eliminates bug you found (when IMIN=IMAX)<a name='4478'></font>
            NCRITI=IMIN<a name='4479'>
            <a name='4480'>
            DO II=NCRITI+1,IMAX<a name='4481'>
               CCNCONC(II)=COL*FCCNR(II)<a name='4482'>
               FCCNR(II)=0.<a name='4483'>
            ENDDO<a name='4484'>
            DLN1=ALOG(RCRITI)-ALOG(RCCN(IMIN-1))<a name='4485'>
            DLN2=COL-DLN1<a name='4486'>
            CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='4487'>
            FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/COL<a name='4488'>
            GOTO 42<a name='4489'>
<font color=#447700>! in case RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)<a name='4490'></font>
          ENDIF<a name='4491'>
<font color=#447700>! in case IMIN.GT.1<a name='4492'></font>
        ENDIF<a name='4493'>
        <a name='4494'>
<font color=#447700>! END of part of interest. so in case<a name='4495'></font>
<font color=#447700>!RCRITI.LT.RCCN(IMIN).AND.RCRITI.GT.RCCN(IMIN-1)<a name='4496'></font>
<font color=#447700>!we go to 42 and avoid the next loop<a name='4497'></font>
<a name='4498'>
      <a name='4499'>
<a name='4500'>
         DO I=IMIN,IMAX-1<a name='4501'>
           IF(RCRITI.EQ.RCCN(I)) THEN<a name='4502'>
             NCRITI=I+1<a name='4503'>
             DO II=I+1,IMAX<a name='4504'>
                CCNCONC(II)=COL*FCCNR(II)<a name='4505'>
                FCCNR(II)=0.<a name='4506'>
             ENDDO<a name='4507'>
             GOTO 42<a name='4508'>
           ENDIF<a name='4509'>
           IF(RCRITI.GT.RCCN(I).AND.RCRITI.LT.RCCN(I+1)) THEN<a name='4510'>
             NCRITI=I+1<a name='4511'>
             IF(I.NE.IMAX-1) THEN<a name='4512'>
               DO II=NCRITI+1,IMAX<a name='4513'>
                  CCNCONC(II)=COL*FCCNR(II)<a name='4514'>
                  FCCNR(II)=0.<a name='4515'>
               ENDDO<a name='4516'>
             ENDIF<a name='4517'>
             DLN1=ALOG(RCRITI)-ALOG(RCCN(I))<a name='4518'>
             DLN2=COL-DLN1<a name='4519'>
             CCNCONC(NCRITI)=DLN2*FCCNR(NCRITI)<a name='4520'>
             FCCNR(NCRITI)=FCCNR(NCRITI)*DLN1/COL<a name='4521'>
             GOTO 42<a name='4522'>
<font color=#447700>! in case RCRITI.GT.RCCN(I).AND.RCRITI.LT.RCCN(I+1)<a name='4523'></font>
           END IF<a name='4524'>
      <a name='4525'>
<a name='4526'>
         ENDDO<a name='4527'>
<font color=#447700>! cycle by I, I=IMIN,...,IMAX-1<a name='4528'></font>
<a name='4529'>
  42    CONTINUE<a name='4530'>
        RETURN<a name='4531'>
        END  SUBROUTINE CCNLOOP<a name='4532'>
<A NAME='ACTIVATE'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ACTIVATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4533'>
       <font color=#993300>SUBROUTINE </font><font color=#cc0000>ACTIVATE</font>(IMIN,IMAX,AKOE,BKOE,RCCN,RACT, RACTMAX,NKR) <A href='../../call_to/ACTIVATE.html' TARGET='index'>6</A>,<A href='../../call_from/ACTIVATE.html' TARGET='index'>14</A><a name='4534'>
       IMPLICIT NONE<a name='4535'>
<a name='4536'>
       INTEGER IMIN,IMAX,NKR<a name='4537'>
       INTEGER I,I0,I1<a name='4538'>
       REAL RCCN(NKR)<a name='4539'>
        REAL  R03,SUPCRITI,RACT(NKR),XKOE<a name='4540'>
        REAL AKOE,BKOE,AKOE23,RACTMAX<a name='4541'>
<font color=#447700>! Spectrum of activated drops                                 (begin) <a name='4542'></font>
        DO I=IMIN,IMAX<a name='4543'>
<a name='4544'>
<font color=#447700>! critical water supersaturations appropriating CCN radii<a name='4545'></font>
<a name='4546'>
           XKOE=(4./27.)*(AKOE**3/BKOE)<a name='4547'>
           AKOE23=AKOE*2./3.<a name='4548'>
           R03=RCCN(I)**3<a name='4549'>
           SUPCRITI=SQRT(XKOE/R03)<a name='4550'>
<a name='4551'>
<font color=#447700>! RACT(I) - radii of activated drops, I=IMIN,...,IMAX<a name='4552'></font>
<a name='4553'>
           IF(RCCN(I).LE.(0.3E-5)) &amp;<a name='4554'>
     &amp;     RACT(I)=AKOE23/SUPCRITI<a name='4555'>
           IF(RCCN(I).GT.(0.3E-5))&amp;<a name='4556'>
     &amp;     RACT(I)=5.*RCCN(I)<a name='4557'>
        ENDDO<a name='4558'>
<font color=#447700>! cycle by I<a name='4559'></font>
<a name='4560'>
<font color=#447700>! calculation of I0<a name='4561'></font>
<a name='4562'>
        I0=IMIN<a name='4563'>
<a name='4564'>
        DO I=IMIN,IMAX-1<a name='4565'>
           IF(RACT(I+1).LT.RACT(I)) THEN<a name='4566'>
             I0=I+1<a name='4567'>
             GOTO 45<a name='4568'>
           ENDIF<a name='4569'>
        ENDDO<a name='4570'>
<a name='4571'>
 45     CONTINUE<a name='4572'>
<font color=#447700>! new changes 9.04.02                                         (begin)<a name='4573'></font>
        I1=I0-1<a name='4574'>
<font color=#447700>! new changes 9.04.02                                           (end)<a name='4575'></font>
<a name='4576'>
        IF(I0.EQ.IMIN) GOTO 47<a name='4577'>
<a name='4578'>
<font color=#447700>! new changes 9.04.02                                         (begin)<a name='4579'></font>
<a name='4580'>
        IF(I0.EQ.IMAX) THEN<a name='4581'>
          RACT(IMAX)=RACT(IMAX-1)<a name='4582'>
          GOTO 47<a name='4583'>
        ENDIF<a name='4584'>
<a name='4585'>
        IF(RACT(IMAX).LE.RACT(I0-1)) THEN<a name='4586'>
          DO I=I0,IMAX<a name='4587'>
             RACT(I)=RACT(I0-1)<a name='4588'>
          ENDDO<a name='4589'>
          GOTO 47<a name='4590'>
        ENDIF<a name='4591'>
<a name='4592'>
<font color=#447700>! new changes 9.04.02                                           (end)<a name='4593'></font>
<a name='4594'>
<a name='4595'>
<a name='4596'>
<font color=#447700>! calculation of I1<a name='4597'></font>
<a name='4598'>
        DO I=I0+1,IMAX<a name='4599'>
           IF(RACT(I).GE.RACT(I0-1)) THEN<a name='4600'>
             I1=I<a name='4601'>
             GOTO 46<a name='4602'>
           ENDIF<a name='4603'>
        ENDDO<a name='4604'>
 46     CONTINUE<a name='4605'>
<a name='4606'>
<font color=#447700>! spectrum of activated drops                                   (end)<a name='4607'></font>
<a name='4608'>
<a name='4609'>
<font color=#447700>! line interpolation RACT(I) for I=I0,...,I1<a name='4610'></font>
<a name='4611'>
        DO I=I0,I1<a name='4612'>
           RACT(I)=RACT(I0-1)+(I-I0+1)*(RACT(I1)-RACT(I0-1)) &amp;<a name='4613'>
     &amp;                       /(I1-I0+1)<a name='4614'>
        ENDDO<a name='4615'>
<a name='4616'>
<a name='4617'>
  47    CONTINUE<a name='4618'>
<a name='4619'>
<a name='4620'>
<a name='4621'>
        RACTMAX=0.<a name='4622'>
<a name='4623'>
        DO I=IMIN,IMAX<a name='4624'>
           RACTMAX=AMAX1(RACTMAX,RACT(I))<a name='4625'>
	ENDDO<a name='4626'>
        RETURN<a name='4627'>
<a name='4628'>
        END SUBROUTINE ACTIVATE<a name='4629'>
<A NAME='DROPMAX'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#DROPMAX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4630'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>DROPMAX</font>(DROPRADII,RACTMAX,NDROPMAX,NKR) <A href='../../call_to/DROPMAX.html' TARGET='index'>2</A><a name='4631'>
        IMPLICIT NONE<a name='4632'>
        INTEGER IDROP,NKR,NDROPMAX<a name='4633'>
        REAL RACTMAX,DROPRADII(NKR)<a name='4634'>
<font color=#447700>! calculation of NDROPMAX - maximal number of drop bin which<a name='4635'></font>
<font color=#447700>! is activated<a name='4636'></font>
<a name='4637'>
        NDROPMAX=1<a name='4638'>
<a name='4639'>
        DO IDROP=1,NKR<a name='4640'>
           IF(RACTMAX.LE.DROPRADII(IDROP)) THEN<a name='4641'>
             NDROPMAX=IDROP<a name='4642'>
             GOTO 44<a name='4643'>
           ENDIF<a name='4644'>
        ENDDO<a name='4645'>
 44     CONTINUE<a name='4646'>
        RETURN<a name='4647'>
        END  SUBROUTINE DROPMAX<a name='4648'>
<a name='4649'>
<a name='4650'>
<A NAME='ONECOND1'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ONECOND1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4651'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND1</font> &amp; <A href='../../call_to/ONECOND1.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND1.html' TARGET='index'>26</A><a name='4652'>
     &amp; (TT,QQ,PP,ROR &amp;<a name='4653'>
     &amp; ,VR1,PSINGLE &amp;<a name='4654'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='4655'>
     &amp; ,FF1,PSI1,R1,RLEC,RO1BL &amp;<a name='4656'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='4657'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='4658'>
     &amp; ,COL,DTCOND,ICEMAX,NKR)<a name='4659'>
<a name='4660'>
       IMPLICIT NONE<a name='4661'>
<a name='4662'>
<a name='4663'>
      INTEGER NKR,ICEMAX<a name='4664'>
      REAL    COL,VR1(NKR),PSINGLE &amp;<a name='4665'>
     &amp;       ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='4666'>
     &amp;       ,DTCOND<a name='4667'>
<a name='4668'>
      REAL C1_MEY,C2_MEY<a name='4669'>
      INTEGER I_ABERGERON,I_BERGERON, &amp;<a name='4670'>
     &amp; KR,ICE,ITIME,KCOND,NR,NRM, &amp;<a name='4671'>
     &amp; KLIMIT, &amp;<a name='4672'>
     &amp; KM,KLIMITL  <a name='4673'>
      REAL AL1,AL2,D,GAM,POD, &amp;<a name='4674'>
     &amp; RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY,ALC,DT0LREF,DTLREF, &amp;<a name='4675'>
     &amp; A1_MYN, BB1_MYN, A2_MYN, BB2_MYN,DT,DTT,XRAD, &amp;<a name='4676'>
     &amp; TPC1, TPC2, TPC3, TPC4, TPC5, &amp;<a name='4677'>
     &amp; EPSDEL, EPSDEL2,DT0L, DT0I,&amp;<a name='4678'>
     &amp; ROR, &amp;<a name='4679'>
     &amp; CWHUCM,B6,B8L,B8I, &amp;<a name='4680'>
     &amp; DEL1,DEL2,DEL1S,DEL2S, &amp;<a name='4681'>
     &amp; TIMENEW,TIMEREV,SFN11,SFN12, &amp;<a name='4682'>
     &amp; SFNL,SFNI,B5L,B5I,B7L,B7I,DOPL,DOPI,RW,RI,QW,PW, &amp;<a name='4683'>
     &amp; PI,QI,DEL1N0,DEL2N0,D1N0,D2N0,DTNEWL,DTNEWL1,D1N,D2N, &amp;<a name='4684'>
     &amp; DEL_R1,DT0L0,DT0I0, &amp;<a name='4685'>
     &amp; DTNEWL0, &amp;<a name='4686'>
     &amp; DTNEWL2 <a name='4687'>
       REAL DT_WATER_COND,DT_WATER_EVAP<a name='4688'>
<a name='4689'>
       INTEGER K<a name='4690'>
<font color=#447700>! NEW ALGORITHM OF CONDENSATION (12.01.00)<a name='4691'></font>
<a name='4692'>
      REAL  FF1_OLD(NKR),SUPINTW(NKR)<a name='4693'>
      DOUBLE PRECISION DSUPINTW(NKR),DD1N,DB11_MY,DAL1,DAL2<a name='4694'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='4695'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='4696'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='4697'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='4698'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='4699'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='4700'>
     &amp;                  ,TT,QQ,PP &amp;<a name='4701'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='4702'>
     &amp;                  ,OPER2,OPER3,AR1,AR2<a name='4703'>
<a name='4704'>
       DOUBLE PRECISION DELMASSL1<a name='4705'>
<a name='4706'>
<font color=#447700>! DROPLETS <a name='4707'></font>
                                                                       <a name='4708'>
        REAL R1(NKR) &amp;<a name='4709'>
     &amp;           ,RLEC(NKR),RO1BL(NKR) &amp;<a name='4710'>
     &amp;           ,FI1(NKR),FF1(NKR),PSI1(NKR) &amp;<a name='4711'>
     &amp;           ,B11_MY(NKR),B12_MY(NKR)<a name='4712'>
<a name='4713'>
<font color=#447700>! WORK ARRAYS <a name='4714'></font>
<a name='4715'>
<font color=#447700>! NEW ALGORITHM OF MIXED PHASE FOR EVAPORATION<a name='4716'></font>
<a name='4717'>
       <a name='4718'>
	REAL DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='4719'>
     &amp;           ,TIMESTEPD(NKR)<a name='4720'>
<a name='4721'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='4722'></font>
<a name='4723'>
<a name='4724'>
<a name='4725'>
	OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='4726'>
	OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='4727'>
<a name='4728'>
        DATA AL1 /2500./, AL2 /2834./, D /0.211/ &amp;<a name='4729'>
     &amp;      ,GAM /1.E-4/, POD /10./ <a name='4730'>
           <a name='4731'>
	DATA RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY &amp;<a name='4732'>
     &amp;      /461.5,0.24E-1,0.211E-4,2.5E6,2.834E6/<a name='4733'>
<a name='4734'>
	DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='4735'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='4736'>
<a name='4737'>
	DATA TPC1, TPC2, TPC3, TPC4, TPC5 &amp;<a name='4738'>
     &amp;      /-4.0,-8.1,-12.7,-17.8,-22.4/ <a name='4739'>
<a name='4740'>
<a name='4741'>
        DATA EPSDEL, EPSDEL2 /0.1E-03,0.1E-03/  <a name='4742'>
    <a name='4743'>
	DATA DT0L, DT0I /1.E20,1.E20/<a name='4744'>
<a name='4745'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='4746'></font>
<a name='4747'>
<a name='4748'>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS IN MIXED PHASE: EVAPORATION<a name='4749'></font>
        <a name='4750'>
        I_ABERGERON=0<a name='4751'>
        I_BERGERON=0<a name='4752'>
        COL3=3.0*COL<a name='4753'>
        ITIME=0<a name='4754'>
        KCOND=0<a name='4755'>
        DT_WATER_COND=0.4<a name='4756'>
        DT_WATER_EVAP=0.4<a name='4757'>
	ITIME=0<a name='4758'>
	KCOND=0<a name='4759'>
        DT0LREF=0.2<a name='4760'>
        DTLREF=0.4<a name='4761'>
<a name='4762'>
	NR=NKR<a name='4763'>
	NRM=NKR-1<a name='4764'>
	DT=DTCOND<a name='4765'>
	DTT=DTCOND<a name='4766'>
	XRAD=0.<a name='4767'>
<a name='4768'>
<font color=#447700>!     BARRY<a name='4769'></font>
	CWHUCM=0.<a name='4770'>
	XRAD=0.<a name='4771'>
	B6=CWHUCM*GAM-XRAD<a name='4772'>
	B8L=1./ROR<a name='4773'>
	B8I=1./ROR<a name='4774'>
        RORI=1./ROR<a name='4775'>
<a name='4776'>
<font color=#447700>! INITIALIZATION OF SOME ARRAYS<a name='4777'></font>
<font color=#447700>!       print*, 'got to here 0'<a name='4778'></font>
<a name='4779'>
<font color=#447700>!       BARRY: REMOVE RS2 LOOP<a name='4780'></font>
        DO KR=1,NKR<a name='4781'>
           FF1_OLD(KR)=FF1(KR)<a name='4782'>
           SUPINTW(KR)=0.<a name='4783'>
           DSUPINTW(KR)=0.<a name='4784'>
        ENDDO<a name='4785'>
<font color=#447700>! OLD TREATMENT OF "T" &amp; "Q" <a name='4786'></font>
<font color=#447700>!DEL12RD=DEL12R**DEL_BBR<a name='4787'></font>
<font color=#447700>! BARRY<a name='4788'></font>
<font color=#447700>!       EW1PN=AA1_MY*(100.+DEL1IN*100.)*DEL12RD/100.<a name='4789'></font>
<font color=#447700>! 	QQIN=OPER4(EW1PN,PP)<a name='4790'></font>
        TPN=TT<a name='4791'>
        QPN=QQ<a name='4792'>
        DO 19 KR=1,NKR<a name='4793'>
              FI1(KR)=FF1(KR)<a name='4794'>
19     CONTINUE<a name='4795'>
<font color=#447700>! WARM OR NO ICE (BEGIN)<a name='4796'></font>
<font color=#447700>! ONLY WATER (CONDENSATION OR EVAPORATION) (BEGIN)<a name='4797'></font>
              TIMENEW=0.<a name='4798'>
              ITIME=0<a name='4799'>
<font color=#447700>! NEW CHANGES 10.01.01 (BEGIN)<a name='4800'></font>
              TOLD=TPN<a name='4801'>
              QOLD=QPN<a name='4802'>
<font color=#447700>! NEW CHANGES 10.01.01 (END)<a name='4803'></font>
   56         ITIME=ITIME+1<a name='4804'>
              TIMEREV=DT-TIMENEW<a name='4805'>
              TIMEREV=DT-TIMENEW<a name='4806'>
              DEL1=DEL1N<a name='4807'>
              DEL2=DEL2N<a name='4808'>
              DEL1S=DEL1N<a name='4809'>
              DEL2S=DEL2N<a name='4810'>
              TPS=TPN<a name='4811'>
              QPS=QPN<a name='4812'>
<font color=#447700>! NO QPS IN JERRATE<a name='4813'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_1">(R1,TPS,PP,ROR,VR1,PSINGLE &amp;<a name='4814'>
     &amp;                    ,RLEC,RO1BL,B11_MY,B12_MY,1,1,ICEMAX,NKR)<a name='4815'>
<a name='4816'>
<font color=#447700>! INTEGRALS IN DELTA EQUATION (ONLY WATER)<a name='4817'></font>
<a name='4818'>
<font color=#447700>! CONTROL OF DROP SPECRUM IN SUBROUTINE ONECOND<a name='4819'></font>
<a name='4820'>
<a name='4821'>
<font color=#447700>! CALL JERTIMESC WATER - 1 (ONLY WATER)<a name='4822'></font>
<a name='4823'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_1">(FI1,R1,SFN11,SFN12 &amp;<a name='4824'>
     &amp;                      ,B11_MY,B12_MY,RLEC,B8L,1,COL,NKR)        <a name='4825'>
<a name='4826'>
<a name='4827'>
	      SFNL=SFN11+SFN12<a name='4828'>
	      SFNI=0.       <a name='4829'>
<a name='4830'>
<font color=#447700>! SOME CONSTANTS <a name='4831'></font>
	      B5L=BB1_MY/TPS/TPS<a name='4832'>
	      B5I=BB2_MY/TPS/TPS<a name='4833'>
              B7L=B5L*B6                                                     <a name='4834'>
              B7I=B5I*B6<a name='4835'>
	      DOPL=1.+DEL1S                                                     <a name='4836'>
	      DOPI=1.+DEL2S                                                     <a name='4837'>
              RW=(OPER2(QPS)+B5L*AL1)*DOPL*SFNL                                                 <a name='4838'>
              RI=(OPER2(QPS)+B5L*AL2)*DOPL*SFNI<a name='4839'>
	      QW=B7L*DOPL<a name='4840'>
	      PW=(OPER2(QPS)+B5I*AL1)*DOPI*SFNL<a name='4841'>
              PI=(OPER2(QPS)+B5I*AL2)*DOPI*SFNI<a name='4842'>
              QI=B7I*DOPI<a name='4843'>
<a name='4844'>
<font color=#447700>! SOLVING FOR TIMEZERO<a name='4845'></font>
<a name='4846'>
<a name='4847'>
<a name='4848'>
	      KCOND=10<a name='4849'>
<a name='4850'>
	      IF(DEL1.GT.0) KCOND=11<a name='4851'>
<a name='4852'>
<font color=#447700>! PROCESS'S TYPE <a name='4853'></font>
<a name='4854'>
	      IF(KCOND.EQ.11) THEN<a name='4855'>
<font color=#447700>! NEW TIME STEP IN CONDENSATION (ONLY WATER) (BEGIN)<a name='4856'></font>
                IF (DEL1N.EQ.0)THEN<a name='4857'>
	           DTNEWL=DT<a name='4858'>
                ELSE<a name='4859'>
                 DTNEWL=ABS(R1(ITIME)/(B11_MY(ITIME)*DEL1N &amp;<a name='4860'>
     &amp;                               -B12_MY(ITIME)))<a name='4861'>
	         IF(DTNEWL.GT.DT) DTNEWL=DT<a name='4862'>
                END IF<a name='4863'>
                IF(ITIME.GE.NKR) THEN<a name='4864'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_747">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='4865'>
                ENDIF<a name='4866'>
                TIMESTEPD(ITIME)=DTNEWL<a name='4867'>
<a name='4868'>
<font color=#447700>! NEW TIME STEP (ONLY WATER: CONDENSATION)<a name='4869'></font>
<a name='4870'>
<a name='4871'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp; <a name='4872'>
     &amp;          DTNEWL=DT-TIMENEW<a name='4873'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='4874'>
<a name='4875'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='4876'>
<a name='4877'>
	        TIMENEW=TIMENEW+DTNEWL<a name='4878'>
<a name='4879'>
	        DTT=DTNEWL<a name='4880'>
<a name='4881'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='4882'></font>
<a name='4883'>
<font color=#447700>! CALL JERSUPSAT - 2 (NEW TIMESTEP - ONLY WATER)<a name='4884'></font>
<a name='4885'>
<a name='4886'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_1">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='4887'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='4888'>
     &amp;                        ,DTT,D1N,D2N,DT0L,DT0I)<a name='4889'>
<a name='4890'>
<font color=#447700>! END OF "NEW SUPERSATURATION"<a name='4891'></font>
<a name='4892'>
<font color=#447700>! DROPLETS <a name='4893'></font>
<a name='4894'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION <a name='4895'></font>
                                                         <a name='4896'>
<font color=#447700>! CALL JERDFUN WATER - 1 (ONLY WATER: CONDENSATION)<a name='4897'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_1">(R1,B11_MY,B12_MY &amp;<a name='4898'>
     &amp;                        ,FI1,PSI1,D1N &amp;<a name='4899'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='4900'>
<a name='4901'>
	        IF((DEL1.GT.0.AND.DEL1N.LT.0) &amp;<a name='4902'>
     &amp;         .AND.ABS(DEL1N).GT.EPSDEL) THEN<a name='4903'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_748">("fatal error in module_mp_fast_sbm (DEL1.GT.0.AND.DEL1N.LT.0), model stop")<a name='4904'>
	        ENDIF<a name='4905'>
<a name='4906'>
<font color=#447700>! IN CASE : KCOND.EQ.11<a name='4907'></font>
<a name='4908'>
	      ELSE<a name='4909'>
<a name='4910'>
<font color=#447700>! EVAPORATION - ONLY WATER <a name='4911'></font>
<a name='4912'>
<font color=#447700>! IN CASE : KCOND.NE.11<a name='4913'></font>
               IF (DEL1N.EQ.0)THEN<a name='4914'>
                DTIMEO(1)=DT<a name='4915'>
	        DO KR=2,NKR<a name='4916'>
	           DTIMEO(KR)=DT<a name='4917'>
	        ENDDO<a name='4918'>
               ELSE<a name='4919'>
	        DTIMEO(1)=-R1(1)/(B11_MY(1)*DEL1N-B12_MY(1))<a name='4920'>
<a name='4921'>
	        DO KR=2,NKR<a name='4922'>
	           KM=KR-1<a name='4923'>
	           DTIMEO(KR)=(R1(KM)-R1(KR))/(B11_MY(KR)*DEL1N &amp;<a name='4924'>
     &amp;                                       -B12_MY(KR))<a name='4925'>
	        ENDDO<a name='4926'>
               END IF<a name='4927'>
<a name='4928'>
	        KLIMIT=1<a name='4929'>
<a name='4930'>
	        DO KR=1,NKR<a name='4931'>
	           IF(DTIMEO(KR).GT.TIMEREV) GOTO 55<a name='4932'>
	           KLIMIT=KR<a name='4933'>
	        ENDDO<a name='4934'>
<a name='4935'>
   55           KLIMIT=KLIMIT-1<a name='4936'>
<a name='4937'>
	        IF(KLIMIT.LT.1) KLIMIT=1<a name='4938'>
<a name='4939'>
<font color=#447700>! BARRY THIS LINE CAUSED A PROBLEM BECAUSE DTNEWL GOES FROM<a name='4940'></font>
<font color=#447700>! LARGE TO SMALL<a name='4941'></font>
  	        DTNEWL1=AMIN1(DTIMEO(3),TIMEREV)<a name='4942'>
                IF(DTNEWL1.LT.DTLREF) DTNEWL1=AMIN1(DTLREF,TIMEREV)<a name='4943'>
	        DTNEWL=DTNEWL1<a name='4944'>
	        IF(ITIME.GE.NKR) THEN<a name='4945'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_749">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='4946'>
	        ENDIF<a name='4947'>
<a name='4948'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='4949'>
<a name='4950'>
<font color=#447700>! NEW TIME STEP (ONLY_WATER: EVAPORATION)<a name='4951'></font>
<a name='4952'>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='4953'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='4954'>
     &amp;          DTNEWL=DT-TIMENEW<a name='4955'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='4956'>
<a name='4957'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='4958'>
<a name='4959'>
	        TIMENEW=TIMENEW+DTNEWL<a name='4960'>
<a name='4961'>
	        DTT=DTNEWL<a name='4962'>
<a name='4963'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='4964'></font>
<a name='4965'>
<a name='4966'>
<font color=#447700>! CALL JERSUPSAT - 3 (ONLY_WATER: EVAPORATION)<a name='4967'></font>
<a name='4968'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_2">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='4969'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='4970'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='4971'>
<font color=#447700>! END OF "NEW SUPERSATURATION"<a name='4972'></font>
<a name='4973'>
<a name='4974'>
<font color=#447700>! DROPLETS <a name='4975'></font>
<a name='4976'>
<a name='4977'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION (ONLY_WATER: EVAPORATION)<a name='4978'></font>
                                                         <a name='4979'>
<font color=#447700>! CALL JERDFUN WATER - 2 (ONLY_WATER: EVAPORATION)<a name='4980'></font>
             <a name='4981'>
 	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_2">(R1,B11_MY,B12_MY &amp;<a name='4982'>
     &amp;                        ,FI1,PSI1,D1N &amp;<a name='4983'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='4984'>
<a name='4985'>
<font color=#447700>! IN CASE : ISYML.NE.0 (ENDING OF <a name='4986'></font>
<font color=#447700>! "DROPLET DISTRIBUTION FUNCTION" (ONLY WATER: EVAPORATION)<a name='4987'></font>
<a name='4988'>
<font color=#447700>!        ENDIF<a name='4989'></font>
<a name='4990'>
	        IF((DEL1.LT.0.AND.DEL1N.GT.0) &amp;<a name='4991'>
     &amp;         .AND.ABS(DEL1N).GT.EPSDEL) THEN<a name='4992'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_750">("fatal error in module_mp_fast_sbm (DEL1.LT.0.AND.DEL1N.GT.0), model stop")<a name='4993'>
	        ENDIF<a name='4994'>
<a name='4995'>
<font color=#447700>! END OF "PROCESS'S TYPE" <a name='4996'></font>
<a name='4997'>
<font color=#447700>! IN CASE : KCOND.NE.11 (ONLY WATER: EVAPORATION)<a name='4998'></font>
<a name='4999'>
              ENDIF<a name='5000'>
<a name='5001'>
<font color=#447700>! IN CASES : KCOND.EQ.11 OR KCOND.NE.11 (BOTH CONDENSATION AND<a name='5002'></font>
<font color=#447700>! EVAPORATION : ONLY WATER)<a name='5003'></font>
<a name='5004'>
<font color=#447700>! CONCENTRATION &amp; MASS (ONLY WATER) <a name='5005'></font>
<a name='5006'>
      RMASSLBB=0.<a name='5007'>
      RMASSLAA=0.<a name='5008'>
<a name='5009'>
<font color=#447700>! BEFORE JERNEWF (ONLY WATER) <a name='5010'></font>
<a name='5011'>
              DO K=1,NKR<a name='5012'>
                 FI1_K=FI1(K)<a name='5013'>
                 R1_K=R1(K)<a name='5014'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5015'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='5016'>
              ENDDO<a name='5017'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='5018'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='5019'></font>
              IF(RMASSLBB.LE.0.) RMASSLBB=0.<a name='5020'>
              DO K=1,NKR<a name='5021'>
                 FI1_K=PSI1(K)<a name='5022'>
                 R1_K=R1(K)<a name='5023'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5024'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='5025'>
              ENDDO<a name='5026'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='5027'>
              IF(RMASSLAA.LE.0.) RMASSLAA=0.<a name='5028'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q" (ONLY WATER)<a name='5029'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='5030'>
              QPN=QPS-DELMASSL1<a name='5031'>
              DAL1=AL1<a name='5032'>
              TPN=TPS+DAL1*DELMASSL1<a name='5033'>
<font color=#447700>! SUPERSATURATION (ONLY WATER)<a name='5034'></font>
              ARGEXP=-BB1_MY/TPN<a name='5035'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='5036'>
              ARGEXP=-BB2_MY/TPN<a name='5037'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='5038'>
              EW1N=OPER3(QPN,PP)<a name='5039'>
              IF(ES1N.EQ.0)THEN<a name='5040'>
               DEL1N=0.5<a name='5041'>
               DIV1=1.5<a name='5042'>
              ELSE<a name='5043'>
               DIV1=EW1N/ES1N<a name='5044'>
               DEL1N=EW1N/ES1N-1.<a name='5045'>
              END IF<a name='5046'>
              IF(ES2N.EQ.0)THEN<a name='5047'>
               DEL2N=0.5<a name='5048'>
               DIV2=1.5<a name='5049'>
              ELSE<a name='5050'>
               DEL2N=EW1N/ES2N-1.<a name='5051'>
               DIV2=EW1N/ES2N<a name='5052'>
              END IF<a name='5053'>
              DO KR=1,NKR<a name='5054'>
                SUPINTW(KR)=SUPINTW(KR)+B11_MY(KR)*D1N<a name='5055'>
                DD1N=D1N<a name='5056'>
                DB11_MY=B11_MY(KR)<a name='5057'>
                DSUPINTW(KR)=DSUPINTW(KR)+DB11_MY*DD1N<a name='5058'>
              ENDDO<a name='5059'>
<font color=#447700>! REPEATE TIME STEP (ONLY WATER: CONDENSATION OR EVAPORATION) <a name='5060'></font>
	      IF(TIMENEW.LT.DT) GOTO 56<a name='5061'>
57            CONTINUE<a name='5062'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_NEW'>JERDFUN_NEW</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_NEW_1">(R1,DSUPINTW &amp;<a name='5063'>
     &amp;                        ,FF1_OLD,PSI1,D1N &amp;<a name='5064'>
     &amp;                        ,1,1,COL,NKR,TPN)<a name='5065'>
              RMASSLAA=0.0<a name='5066'>
              RMASSLBB=0.0<a name='5067'>
<font color=#447700>! BEFORE JERNEWF<a name='5068'></font>
              DO K=1,NKR<a name='5069'>
                 FI1_K=FF1_OLD(K)<a name='5070'>
                 R1_K=R1(K)<a name='5071'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5072'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='5073'>
              ENDDO<a name='5074'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='5075'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='5076'></font>
              IF(RMASSLBB.LT.0.0) RMASSLBB=0.0<a name='5077'>
<font color=#447700>! AFTER  JERNEWF<a name='5078'></font>
              DO K=1,NKR<a name='5079'>
                 FI1_K=PSI1(K)<a name='5080'>
                 R1_K=R1(K)<a name='5081'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='5082'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='5083'>
              ENDDO<a name='5084'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='5085'>
<font color=#447700>! NEW CHANGE RMASSLAA<a name='5086'></font>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='5087'>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='5088'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='5089'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='5090'>
<font color=#447700>! NEW CHANGES 10.01.01 (BEGIN)<a name='5091'></font>
              QPN=QOLD-DELMASSL1<a name='5092'>
              DAL1 = AL1<a name='5093'>
              TPN=TOLD+DAL1*DELMASSL1<a name='5094'>
<font color=#447700>! NEW CHANGES 10.01.01 (END)<a name='5095'></font>
<font color=#447700>! SUPERSATURATION<a name='5096'></font>
              ARGEXP=-BB1_MY/TPN<a name='5097'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='5098'>
              ARGEXP=-BB2_MY/TPN<a name='5099'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='5100'>
              EW1N=OPER3(QPN,PP)<a name='5101'>
              IF(ES1N.EQ.0)THEN<a name='5102'>
               DEL1N=0.5<a name='5103'>
               DIV1=1.5<a name='5104'>
   call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_751">("fatal error in module_mp_fast_sbm (ES1N.EQ.0), model stop")<a name='5105'>
              ELSE<a name='5106'>
               DIV1=EW1N/ES1N<a name='5107'>
               DEL1N=EW1N/ES1N-1.<a name='5108'>
              END IF<a name='5109'>
              IF(ES2N.EQ.0)THEN<a name='5110'>
               DEL2N=0.5<a name='5111'>
               DIV2=1.5<a name='5112'>
   call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_752">("fatal error in module_mp_fast_sbm (ES2N.EQ.0), model stop")<a name='5113'>
              ELSE<a name='5114'>
               DEL2N=EW1N/ES2N-1.<a name='5115'>
               DIV2=EW1N/ES2N<a name='5116'>
              END IF<a name='5117'>
        TT=TPN<a name='5118'>
        QQ=QPN<a name='5119'>
	DO KR=1,NKR<a name='5120'>
	   FF1(KR)=PSI1(KR)<a name='5121'>
	ENDDO<a name='5122'>
<a name='5123'>
<a name='5124'>
<a name='5125'>
<a name='5126'>
       RETURN<a name='5127'>
<font color=#447700>!      END <a name='5128'></font>
<a name='5129'>
  END SUBROUTINE ONECOND1<a name='5130'>
<font color=#447700>!==================================================================<a name='5131'></font>
<a name='5132'>
<a name='5133'>
<a name='5134'>
<font color=#447700>!BARRY<a name='5135'></font>
<A NAME='JERDFUN'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERDFUN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5136'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERDFUN</font>(R2,B21_MY,B22_MY &amp; <A href='../../call_to/JERDFUN.html' TARGET='index'>42</A>,<A href='../../call_from/JERDFUN.html' TARGET='index'>4</A><a name='5137'>
     &amp;                    ,FI2,PSI2,DEL2N &amp;<a name='5138'>
     &amp;                    ,IND,ITYPE,COL,NKR,TPN)<a name='5139'>
       IMPLICIT NONE<a name='5140'>
<a name='5141'>
<font color=#447700>! CRYSTALS <a name='5142'></font>
       REAL COL,DEL2N<a name='5143'>
                                                                       <a name='5144'>
      INTEGER IND,ITYPE,KR,ICE,ITYP,NRM,NR,NKR,IDROP<a name='5145'>
       REAL &amp;<a name='5146'>
     &amp;       R2(NKR,IND),R2N(NKR,IND) &amp;<a name='5147'>
     &amp;      ,FI2(NKR,IND),PSI2(NKR,IND) &amp;<a name='5148'>
     &amp;      ,B21_MY(NKR,IND),B22_MY(NKR,IND) &amp;<a name='5149'>
     &amp;      ,DEL_R2M(NKR,IND)<a name='5150'>
        DOUBLE PRECISION R2R(NKR),R2NR(NKR),FI2R(NKR),PSI2R(NKR)<a name='5151'>
        DOUBLE PRECISION DR2(NKR,IND),DR2N(NKR,IND),DDEL2N, &amp;<a name='5152'>
     &amp;     DB21_MY(NKR,IND)<a name='5153'>
       DOUBLE PRECISION CHECK,TPN<a name='5154'>
          CHECK=0.D0<a name='5155'>
           DO KR=1,NKR<a name='5156'>
             CHECK=B21_MY(1,1)*B21_MY(KR,1)<a name='5157'>
             IF (CHECK.LT.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_753">("fatal error in module_mp_fast_sbm (CHECK.LT.0), model stop") <a name='5158'>
           END DO<a name='5159'>
<a name='5160'>
	IF(IND.NE.1) THEN<a name='5161'>
	  ITYP=ITYPE<a name='5162'>
        ELSE<a name='5163'>
	  ITYP=1<a name='5164'>
	ENDIF<a name='5165'>
<a name='5166'>
           DDEL2N=DEL2N<a name='5167'>
	DO KR=1,NKR<a name='5168'>
	   PSI2R(KR)=FI2(KR,ITYP)<a name='5169'>
	   FI2R(KR)=FI2(KR,ITYP)<a name='5170'>
           DR2(KR,ITYP)=R2(KR,ITYP)<a name='5171'>
           DB21_MY(KR,ITYP)=B21_MY(KR,ITYP)<a name='5172'>
	ENDDO<a name='5173'>
<font color=#447700>!<a name='5174'></font>
<font color=#447700>!Q2=0.<a name='5175'></font>
	NR=NKR<a name='5176'>
	NRM=NKR-1<a name='5177'>
<a name='5178'>
<font color=#447700>! NEW DISTRIBUTION FUNCTION <a name='5179'></font>
<a name='5180'>
	  DO 8 ICE=1,IND<a name='5181'>
	       IF(ITYP.EQ.ICE) THEN<a name='5182'>
	          DO KR=1,NKR<a name='5183'>
                    DR2N(KR,ICE)=DR2(KR,ICE)+DDEL2N*DB21_MY(KR,ICE)<a name='5184'>
                    R2N(KR,ICE)=DR2N(KR,ICE)<a name='5185'>
<font color=#447700>!                   IF (D1N.LT.0)THEN<a name='5186'></font>
<font color=#447700>!	             if (DR2N(KR,ICE).EQ.DR2(KR,ICE))THEN<a name='5187'></font>
<font color=#447700>!		        KK=NKR-KR+1<a name='5188'></font>
<font color=#447700>!	       		DR2N(KR,ICE)=R2N(KR,ICE)-2.E-15/2**KK<a name='5189'></font>
<font color=#447700>!                    end if<a name='5190'></font>
<font color=#447700>!                   END IF<a name='5191'></font>
<a name='5192'>
	          ENDDO<a name='5193'>
	        ENDIF<a name='5194'>
    8	  CONTINUE<a name='5195'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='5196'></font>
                                                          <a name='5197'>
	  DO ICE=1,IND<a name='5198'>
<a name='5199'>
<font color=#447700>! ICE_TYPE <a name='5200'></font>
	     IF(ITYP.EQ.ICE) THEN<a name='5201'>
<font color=#447700>!       Q2=20.*ITYPE+ICE<a name='5202'></font>
               DO 5 KR=1,NKR<a name='5203'>
	            R2R(KR)=DR2(KR,ICE)<a name='5204'>
	            R2NR(KR)=DR2N(KR,ICE)               <a name='5205'>
    5         continue<a name='5206'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5207'></font>
<font color=#447700>!            IDROP=1<a name='5208'></font>
<font color=#447700>!            IDROP=0<a name='5209'></font>
             IF(IND.EQ.1.AND.ITYPE.EQ.1) IDROP=1<a name='5210'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5211'></font>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF'>JERNEWF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNEWF_1">(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR &amp;<a name='5212'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5213'></font>
     &amp;                   ,IDROP,TPN)<a name='5214'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5215'></font>
<a name='5216'>
<a name='5217'>
<a name='5218'>
<font color=#447700>!              CALL JERNEWF(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR)<a name='5219'></font>
	       DO KR=1,NKR                              <a name='5220'>
	          PSI2(KR,ICE)=PSI2R(KR)<a name='5221'>
	       ENDDO<a name='5222'>
<a name='5223'>
<a name='5224'>
<font color=#447700>! END OF "ICE_TYPE" <a name='5225'></font>
<a name='5226'>
	     ENDIF<a name='5227'>
<a name='5228'>
<font color=#447700>! END OF "CRYSTAL DISTRIBUTION FUNCTION" <a name='5229'></font>
                                                          <a name='5230'>
	  ENDDO<a name='5231'>
<a name='5232'>
<font color=#447700>! END OF "NEW DISTRIBUTION FUNCTION"<a name='5233'></font>
<a name='5234'>
<a name='5235'>
	RETURN<a name='5236'>
	END SUBROUTINE JERDFUN<a name='5237'>
<font color=#447700>!===================================================================<a name='5238'></font>
<A NAME='JERDFUN_NEW'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERDFUN_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5239'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERDFUN_NEW</font>(R2,B21_MY &amp; <A href='../../call_to/JERDFUN_NEW.html' TARGET='index'>2</A>,<A href='../../call_from/JERDFUN_NEW.html' TARGET='index'>2</A><a name='5240'>
     &amp;                    ,FI2,PSI2,DEL2N &amp;<a name='5241'>
     &amp;                    ,IND,ITYPE,COL,NKR,TPN)<a name='5242'>
       IMPLICIT NONE<a name='5243'>
<a name='5244'>
<font color=#447700>! CRYSTALS <a name='5245'></font>
       REAL COL,DEL2N<a name='5246'>
                                                                       <a name='5247'>
      INTEGER IND,ITYPE,KR,ICE,ITYP,NRM,NR,KK,NKR,IDROP<a name='5248'>
       REAL &amp;<a name='5249'>
     &amp;       R2(NKR,IND),R2N(NKR,IND) &amp;<a name='5250'>
     &amp;      ,FI2(NKR,IND),PSI2(NKR,IND)<a name='5251'>
       DOUBLE PRECISION TPN<a name='5252'>
       DOUBLE PRECISION  B21_MY(NKR,IND)<a name='5253'>
        DOUBLE PRECISION R2R(NKR),R2NR(NKR),FI2R(NKR),PSI2R(NKR)<a name='5254'>
        DOUBLE PRECISION DR2(NKR,IND),DR2N(NKR,IND),DDEL2N, &amp;<a name='5255'>
     &amp;     DB21_MY(NKR,IND)<a name='5256'>
	IF(IND.NE.1) THEN<a name='5257'>
	  ITYP=ITYPE<a name='5258'>
        ELSE<a name='5259'>
	  ITYP=1<a name='5260'>
	ENDIF<a name='5261'>
<a name='5262'>
           DDEL2N=DEL2N<a name='5263'>
	DO KR=1,NKR<a name='5264'>
	   PSI2R(KR)=FI2(KR,ITYP)<a name='5265'>
	   FI2R(KR)=FI2(KR,ITYP)<a name='5266'>
           DR2(KR,ITYP)=R2(KR,ITYP)<a name='5267'>
	ENDDO<a name='5268'>
<font color=#447700>!<a name='5269'></font>
<font color=#447700>!Q2=0.<a name='5270'></font>
	NR=NKR<a name='5271'>
	NRM=NKR-1<a name='5272'>
<a name='5273'>
<font color=#447700>! NEW DISTRIBUTION FUNCTION <a name='5274'></font>
<a name='5275'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='5276'></font>
	  DO ICE=1,IND<a name='5277'>
<font color=#447700>! ICE_TYPE <a name='5278'></font>
	     IF(ITYP.EQ.ICE) THEN<a name='5279'>
               DO 5 KR=1,NKR<a name='5280'>
	            R2R(KR)=DR2(KR,ICE)<a name='5281'>
	            R2NR(KR)=DR2(KR,ICE)+B21_MY(KR,ICE)<a name='5282'>
                    R2N(KR,ICE)=R2NR(KR)<a name='5283'>
<font color=#447700>!                   IF (D1N.LT.0)THEN<a name='5284'></font>
<font color=#447700>!	            	 if (R2NR(KR).EQ.R2R(KR))THEN<a name='5285'></font>
<font color=#447700>!	       		 KK=NKR-KR+1<a name='5286'></font>
<font color=#447700>!		        R2NR(KR)=R2R(KR)-2.E-15/2**KK<a name='5287'></font>
<font color=#447700>!		      end if<a name='5288'></font>
<font color=#447700>!	            END IF<a name='5289'></font>
    5         continue<a name='5290'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5291'></font>
             IDROP=1<a name='5292'>
<font color=#447700>!            IDROP=0<a name='5293'></font>
             CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF'>JERNEWF</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERNEWF_2">(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR &amp;<a name='5294'>
     &amp;                   ,IDROP,TPN)<a name='5295'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)<a name='5296'></font>
<a name='5297'>
<a name='5298'>
<font color=#447700>!              CALL JERNEWF(NR,NRM,R2R,FI2R,PSI2R,R2NR,COL,NKR)<a name='5299'></font>
	       DO KR=1,NKR                              <a name='5300'>
	          PSI2(KR,ICE)=PSI2R(KR)<a name='5301'>
	       ENDDO<a name='5302'>
<a name='5303'>
<font color=#447700>! END OF "ICE_TYPE" <a name='5304'></font>
<a name='5305'>
	     ENDIF<a name='5306'>
<a name='5307'>
<font color=#447700>! END OF "CRYSTAL DISTRIBUTION FUNCTION" <a name='5308'></font>
                                                          <a name='5309'>
	  ENDDO<a name='5310'>
<a name='5311'>
<font color=#447700>! END OF "NEW DISTRIBUTION FUNCTION"<a name='5312'></font>
<a name='5313'>
<a name='5314'>
	RETURN<a name='5315'>
	END SUBROUTINE JERDFUN_NEW<a name='5316'>
<font color=#447700>! SUBROUTINE JERDFUN_NEW (NEW ALGORITHM OF CONDENSATION, 12.01.00)<a name='5317'></font>
<a name='5318'>
<font color=#447700>! new change 30.01.06                                         (start)<a name='5319'></font>
<font color=#447700>!       SUBROUTINE JERNEWF(NRX,NRM,RR,FI,PSI,RN,COL,NKR)<a name='5320'></font>
<a name='5321'>
<A NAME='JERNEWF'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERNEWF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5322'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERNEWF</font> &amp; <A href='../../call_to/JERNEWF.html' TARGET='index'>4</A>,<A href='../../call_from/JERNEWF.html' TARGET='index'>12</A><a name='5323'>
       (NRX,NRM,RR,FI_OLD,PSI,RN,COL,NKR, &amp;<a name='5324'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5325'></font>
        IDROP,TPN)<a name='5326'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)	<a name='5327'></font>
 <a name='5328'>
        IMPLICIT NONE<a name='5329'>
        INTEGER  &amp; <a name='5330'>
        I,K,KM,NRXP,IM,IP,IFIN,IIN,ISYM,NKR<a name='5331'>
	<a name='5332'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5333'></font>
<a name='5334'>
        INTEGER &amp;<a name='5335'>
	KRDROP_REMAP_MIN,KRDROP_REMAP_MAX,IDROP,KMAX<a name='5336'>
	<a name='5337'>
        DOUBLE PRECISION &amp;<a name='5338'>
	COEFF_REMAP,TPN<a name='5339'>
	<a name='5340'>
        DOUBLE PRECISION &amp; <a name='5341'>
        CDROP(NRX),DELTA_CDROP(NRX)<a name='5342'>
		<a name='5343'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      	<a name='5344'></font>
<a name='5345'>
 <a name='5346'>
        REAL &amp; <a name='5347'>
        COL<a name='5348'>
<a name='5349'>
        DOUBLE PRECISION &amp;<a name='5350'>
	AOLDCON,ANEWCON,AOLDMASS,ANEWMASS<a name='5351'>
<a name='5352'>
        DOUBLE PRECISION &amp;<a name='5353'>
        RNTMP,RRTMP,RRP,RRM,RNTMP2,RRTMP2,RRP2,RRM2, &amp;<a name='5354'>
        GN1,GN1P,GN2,GN3,GMAT2<a name='5355'>
<a name='5356'>
        DOUBLE PRECISION &amp;<a name='5357'>
        DRP,FNEW,FIK,PSINEW,DRM,GMAT,R1,R2,R3,DMASS,CONCL,RRI,RNK<a name='5358'>
<a name='5359'>
        INTEGER NRX,NRM<a name='5360'>
<a name='5361'>
        DOUBLE PRECISION &amp; <a name='5362'>
        RR(NRX),FI(NRX),PSI(NRX),RN(NRX) &amp;<a name='5363'>
       ,RRS(NKR+1),RNS(NKR+1),PSIN(NKR+1),FIN(NKR+1)<a name='5364'>
<a name='5365'>
        DOUBLE PRECISION &amp; <a name='5366'>
        FI_OLD(NRX)<a name='5367'>
<font color=#447700>! ANDREI                                                      (start) <a name='5368'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5369'></font>
        DOUBLE PRECISION &amp; <a name='5370'>
        PSI_IM,PSI_I,PSI_IP<a name='5371'>
<font color=#447700>! ANDREI                                                        (end) <a name='5372'></font>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5373'></font>
<a name='5374'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5375'></font>
<a name='5376'>
       IF(TPN.LT.273.15-7.0D0) IDROP=0<a name='5377'>
<font color=#447700>! LEAVE REMAPPING ON<a name='5378'></font>
<font color=#447700>!      IDROP=0<a name='5379'></font>
 <a name='5380'>
<font color=#447700>! VALUES FOR SOME REMAPING VARIABLES<a name='5381'></font>
<a name='5382'>
        KRDROP_REMAP_MIN=8<a name='5383'>
	KRDROP_REMAP_MAX=13 <a name='5384'>
	<a name='5385'>
        COEFF_REMAP=1.0D0/150.0D0 <a name='5386'>
	       	<a name='5387'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      <a name='5388'></font>
	<a name='5389'>
<font color=#447700>! INITIAL VALUES FOR SOME VARIABLES<a name='5390'></font>
<a name='5391'>
	NRXP=NRX+1<a name='5392'>
<a name='5393'>
	DO K=1,NRX<a name='5394'>
	   FI(K)=FI_OLD(K)<a name='5395'>
        ENDDO<a name='5396'>
 <a name='5397'>
	DO K=1,NRX<a name='5398'>
	   PSI(K)=0.0D0<a name='5399'>
        ENDDO<a name='5400'>
<font color=#447700>! ANDREI                                                      (start) <a name='5401'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5402'></font>
<a name='5403'>
	IF(RN(NRX).NE.RR(NRX)) THEN<a name='5404'>
<a name='5405'>
<font color=#447700>! Kovetz-Olund method                                         (start)<a name='5406'></font>
<a name='5407'>
<font color=#447700>! ANDREI                                                        (end) <a name='5408'></font>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5409'></font>
<a name='5410'>
	  ISYM=1<a name='5411'>
<a name='5412'>
	  IF(RN(1).LT.RR(1)) ISYM=-1<a name='5413'>
<a name='5414'>
<font color=#447700>! CALCULATION OF DISTRIBUTION FUNCTION <a name='5415'></font>
<a name='5416'>
	  IF(ISYM.GT.0) THEN<a name='5417'>
	<a name='5418'>
<font color=#447700>! CONDENSATION <a name='5419'></font>
<a name='5420'>
	    RNS(NRXP)=1024.0D0*RR(NRX)<a name='5421'>
	    RRS(NRXP)=1024.0D0*RR(NRX)<a name='5422'>
<a name='5423'>
  	    PSIN(NRXP)=0.0D0<a name='5424'>
	    FIN(NRXP)=0.0D0<a name='5425'>
<a name='5426'>
	    DO K=1,NRX<a name='5427'>
	       RNS(K)=RN(K)<a name='5428'>
	       RRS(K)=RR(K)<a name='5429'>
	       PSIN(K)=0.0D0<a name='5430'>
<font color=#447700>! FIN(K) - initial(before condensation) concentration of hydrometeors<a name='5431'></font>
	       FIN(K)=3.0D0*FI(K)*RR(K)*COL<a name='5432'>
	    ENDDO<a name='5433'>
<a name='5434'>
<font color=#447700>! NUMBER OF NEW RADII POSITION IN REGULAR GRID <a name='5435'></font>
<a name='5436'>
<font color=#447700>! RNK - new first bin mass(after condensation)<a name='5437'></font>
<a name='5438'>
	    RNK=RNS(1)<a name='5439'>
<a name='5440'>
	    DO I=1,NRX<a name='5441'>
	       RRI=RRS(I)<a name='5442'>
	       IF(RRI.GT.RNK) GOTO 3<a name='5443'>
            ENDDO<a name='5444'>
<a name='5445'>
    3	    IIN=I-1<a name='5446'>
<a name='5447'>
	    IFIN=NRX<a name='5448'>
<a name='5449'>
	    CONCL=0.0D0<a name='5450'>
            DMASS=0.0D0<a name='5451'>
                        <a name='5452'>
            DO 6 I=IIN,IFIN<a name='5453'>
<a name='5454'>
                 IP=I+1<a name='5455'>
                                                                                <a name='5456'>
                 IM=MAX(1,I-1)<a name='5457'>
<a name='5458'>
	         R1=RRS(IM)<a name='5459'>
	         R2=RRS(I)<a name='5460'>
	         R3=RRS(IP)<a name='5461'>
<a name='5462'>
	         DRM=R2-R1<a name='5463'>
	         DRP=R3-R2<a name='5464'>
<a name='5465'>
	         FNEW=0.0D0<a name='5466'>
<a name='5467'>
	         DO 7 K=1,I<a name='5468'>
                 <a name='5469'>
	              FIK=FIN(K)<a name='5470'>
<a name='5471'>
	              IF(FIK.NE.0.0D0) THEN<a name='5472'>
<a name='5473'>
	                KM=K-1<a name='5474'>
<a name='5475'>
<font color=#447700>! RNK - new bin mass(after condensation)<a name='5476'></font>
<a name='5477'>
	                RNK=RNS(K)<a name='5478'>
<a name='5479'>
	                IF(RNK.NE.R2) THEN<a name='5480'>
	                  GMAT=0.0D0<a name='5481'>
	                  IF(RNK.GT.R1.AND.RNK.LT.R3) THEN<a name='5482'>
	                    IF(RNK.LT.R2) THEN<a name='5483'>
	                      GMAT=(RNK-R1)/DRM<a name='5484'>
		            ELSE<a name='5485'>
	                      GMAT=(R3-RNK)/DRP<a name='5486'>
	                    ENDIF<a name='5487'>
	                  ENDIF<a name='5488'>
	                ELSE<a name='5489'>
	                  GMAT=1.0D0<a name='5490'>
	                ENDIF<a name='5491'>
<a name='5492'>
                        FNEW=FNEW+FIK*GMAT<a name='5493'>
<font color=#447700>! in case FIK.NE.0.0D0<a name='5494'></font>
	              ENDIF<a name='5495'>
                 <a name='5496'>
   7	         CONTINUE<a name='5497'>
<a name='5498'>
	         CONCL=CONCL+FNEW<a name='5499'>
<a name='5500'>
	         DMASS=DMASS+FNEW*R2<a name='5501'>
<a name='5502'>
<font color=#447700>! PSIN(I)) - new concentration of hydrometeors after condensation<a name='5503'></font>
<a name='5504'>
    	         PSIN(I)=FNEW<a name='5505'>
                        	<a name='5506'>
   6        CONTINUE<a name='5507'>
<a name='5508'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION<a name='5509'></font>
 <a name='5510'>
<font color=#447700>! PSI(K) - new size distribution function of hydrometeors after <a name='5511'></font>
<font color=#447700>!          condensation, K=1,...,NRX=NKR<a name='5512'></font>
<a name='5513'>
	    DO K=1,NRX<a name='5514'>
	       PSI(K)=PSIN(K)/3./RR(K)/COL<a name='5515'>
	    ENDDO<a name='5516'>
<a name='5517'>
<font color=#447700>! IN CASE: ISYM.GT.0 (CONDENSATION)<a name='5518'></font>
	<a name='5519'>
          ELSE<a name='5520'>
<a name='5521'>
<font color=#447700>! IN CASE: ISYM.LE.0 (EVAPORATION)<a name='5522'></font>
<a name='5523'>
	    RNS(1)=0.0D0<a name='5524'>
	    RRS(1)=0.0D0<a name='5525'>
	    FIN(1)=0.0D0<a name='5526'>
	    PSIN(1)=0.0D0<a name='5527'>
<a name='5528'>
<font color=#447700>! FIN(K) - initial(before evaporation) concentration of hydrometeors<a name='5529'></font>
<a name='5530'>
	    DO K=2,NRXP<a name='5531'>
	       KM=K-1<a name='5532'>
	       RNS(K)=RN(KM)<a name='5533'>
	       RRS(K)=RR(KM)<a name='5534'>
	       PSIN(K)=0.0D0<a name='5535'>
	       FIN(K)=3.0D0*FI(KM)*RR(KM)*COL<a name='5536'>
	    ENDDO<a name='5537'>
<a name='5538'>
	    DO I=1,NRXP<a name='5539'>
<a name='5540'>
               IM=MAX(I-1,1)<a name='5541'>
               IP=MIN(I+1,NRXP)<a name='5542'>
<a name='5543'>
   	       R1=RRS(IP)<a name='5544'>
	       R2=RRS(I)<a name='5545'>
	       R3=RRS(IM)<a name='5546'>
<a name='5547'>
               DRM=R1-R2<a name='5548'>
               DRP=R2-R3<a name='5549'>
<a name='5550'>
	       FNEW=0.0D0<a name='5551'>
<a name='5552'>
	       DO K=I,NRXP<a name='5553'>
	          RNK=RNS(K)<a name='5554'>
                  IF(RNK.GE.R1) GOTO 4321<a name='5555'>
                  IF(RNK.GT.R3)THEN<a name='5556'>
                    IF(RNK.GT.R2) THEN<a name='5557'>
                      FNEW=FNEW+FIN(K)*(R1-RNK)/DRM<a name='5558'>
                    ELSE<a name='5559'>
                      FNEW=FNEW+FIN(K)*(RNK-R3)/DRP<a name='5560'>
	            ENDIF<a name='5561'>
	          ENDIF<a name='5562'>
               ENDDO<a name='5563'>
<a name='5564'>
 4321          CONTINUE<a name='5565'>
<a name='5566'>
<font color=#447700>! PSIN(I) - new concentration of hydrometeors after evaporation<a name='5567'></font>
<a name='5568'>
    	       PSIN(I)=FNEW<a name='5569'>
	<a name='5570'>
            ENDDO<a name='5571'>
<font color=#447700>! cycle by I<a name='5572'></font>
<a name='5573'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION                         (start)<a name='5574'></font>
<a name='5575'>
<font color=#447700>! PSI(K), 1/g/cm^3 - new size distribution function of hydrometeors <a name='5576'></font>
<font color=#447700>!                    after evaporation, K=1,...,NRX<a name='5577'></font>
	    DO K=2,NRXP<a name='5578'>
	       KM=K-1<a name='5579'>
	       R1=PSIN(K)*RR(KM)<a name='5580'>
	       PSINEW=PSIN(K)/3.0D0/RR(KM)/COL<a name='5581'>
	       IF(R1.LT.1.0D-20) PSINEW=0.0D0<a name='5582'>
	       PSI(KM)=PSINEW<a name='5583'>
	    ENDDO<a name='5584'>
<a name='5585'>
<font color=#447700>! NEW VALUES OF DISTRIBUTION FUNCTION                           (end)<a name='5586'></font>
<a name='5587'>
<font color=#447700>! IN CASE: ISYM.LE.0 (EVAPORATION)<a name='5588'></font>
<a name='5589'>
	  ENDIF<a name='5590'>
	<a name='5591'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)<a name='5592'></font>
          IF(I3POINT.NE.0.AND.ISYM.GT.0) THEN<a name='5593'>
<font color=#447700>! DIFFERENCE<a name='5594'></font>
<font color=#447700>!         IF(I3POINT.NE.0) THEN<a name='5595'></font>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)                      <a name='5596'></font>
<a name='5597'>
	    DO K=1,NKR<a name='5598'>
	       RRS(K)=RR(K)<a name='5599'>
	    ENDDO<a name='5600'>
<a name='5601'>
            RRS(NKR+1)=RRS(NKR)*1024.0D0<a name='5602'>
<a name='5603'>
	    DO I=1,NKR<a name='5604'>
 <a name='5605'>
               PSI(I)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_6">(I)*RR(I)<a name='5606'>
<a name='5607'>
<font color=#447700>! PSI(I) - concenration hydrometeors after KO divided on COL*3.0D0<a name='5608'></font>
<font color=#447700>! RN(I), g - new masses after condensation or evaporation<a name='5609'></font>
<a name='5610'>
               IF(RN(I).LT.0.0D0) THEN <a name='5611'>
                 RN(I)=1.0D-50<a name='5612'>
	         FI(I)=0.0D0<a name='5613'>
               ENDIF<a name='5614'>
<a name='5615'>
            ENDDO<a name='5616'>
 <a name='5617'>
	    DO K=1,NKR<a name='5618'>
<a name='5619'>
               IF(FI(K).NE.0.0D0) THEN<a name='5620'>
<a name='5621'>
                 IF(RRS(2).LT.RN(K)) THEN<a name='5622'>
 <a name='5623'>
                   I=2<a name='5624'>
<a name='5625'>
                   DO  WHILE &amp;<a name='5626'>
                     (.NOT.(RRS(I).LT.RN(K).AND.RRS(I+1).GT.RN(K)) &amp;<a name='5627'>
                      .AND.I.LT.NKR)<a name='5628'>
                       I=I+1<a name='5629'>
	           ENDDO<a name='5630'>
<font color=#447700>! ANDREI                                                      (start) <a name='5631'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5632'></font>
                   IF(I.LT.NKR-2) THEN<a name='5633'>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5634'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='5635'></font>
                     RNTMP=RN(K)<a name='5636'>
<a name='5637'>
                     RRTMP=RRS(I)<a name='5638'>
                     RRP=RRS(I+1)<a name='5639'>
                     RRM=RRS(I-1)<a name='5640'>
 <a name='5641'>
                     RNTMP2=RN(K+1)<a name='5642'>
<a name='5643'>
                     RRTMP2=RRS(I+1)<a name='5644'>
                     RRP2=RRS(I+2)<a name='5645'>
                     RRM2=RRS(I)<a name='5646'>
 <a name='5647'>
                     GN1=(RRP-RNTMP)*(RRTMP-RNTMP)/(RRP-RRM)/ &amp;<a name='5648'>
                       (RRTMP-RRM)<a name='5649'>
<a name='5650'>
                     GN1P=(RRP2-RNTMP2)*(RRTMP2-RNTMP2)/ &amp;<a name='5651'>
                        (RRP2-RRM2)/(RRTMP2-RRM2)<a name='5652'>
<a name='5653'>
                     GN2=(RRP-RNTMP)*(RNTMP-RRM)/(RRP-RRTMP)/ &amp;<a name='5654'>
                       (RRTMP-RRM)<a name='5655'>
 <a name='5656'>
	             GMAT=(RRP-RNTMP)/(RRP-RRTMP)<a name='5657'>
<font color=#447700>! ANDREI                                                      (start) <a name='5658'></font>
<font color=#447700>! new change 7.02.06                                          (start)<a name='5659'></font>
                     GN3=(RRTMP-RNTMP)*(RRM-RNTMP)/(RRP-RRM)/ &amp;<a name='5660'>
                                                 (RRP-RRTMP)<a name='5661'>
	             GMAT2=(RNTMP-RRTMP)/(RRP-RRTMP)<a name='5662'>
<a name='5663'>
                     PSI_IM=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_7">(I-1)+GN1*FI(K)*RR(K)<a name='5664'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5665'></font>
<font color=#447700>!                    PSI_I=PSI(I)+(GN1P+GN2-GMAT)*FI(K+1)*RR(K+1)<a name='5666'></font>
<a name='5667'>
                     PSI_I=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_8">(I)+GN1P*FI(K+1)*RR(K+1)+&amp;<a name='5668'>
	                         (GN2-GMAT)*FI(K)*RR(K)<a name='5669'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)           <a name='5670'></font>
                     PSI_IP=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_9">(I+1)+(GN3-GMAT2)*FI(K)*RR(K)<a name='5671'>
                    <a name='5672'>
                     IF(PSI_IM.GT.0.0D0) THEN<a name='5673'>
<a name='5674'>
                       IF(PSI_IP.GT.0.0D0) THEN<a name='5675'>
<a name='5676'>
                         IF(I.GT.2) THEN<a name='5677'>
<font color=#447700>! smoothing criteria<a name='5678'></font>
                           IF(PSI_IM.GT.PSI(I-2).AND.PSI_IM.LT.PSI_I &amp;<a name='5679'>
                          .AND.PSI(I-2).LT.PSI(I).OR.PSI(I-2) &amp;<a name='5680'>
                          .GE.PSI(I)) THEN<a name='5681'>
<a name='5682'>
                             PSI(I-1)=PSI_IM<a name='5683'>
<a name='5684'>
                             PSI(I)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_10">(I)+FI(K)*RR(K)*(GN2-GMAT)<a name='5685'>
<a name='5686'>
                             PSI(I+1)=PSI_IP<a name='5687'>
<a name='5688'>
<font color=#447700>! in case smoothing criteria<a name='5689'></font>
<a name='5690'>
                           ENDIF <a name='5691'>
<font color=#447700>! in case I.GT.2<a name='5692'></font>
                         ENDIF<a name='5693'>
<a name='5694'>
<font color=#447700>! in case PSI_IP.GT.0.0D0<a name='5695'></font>
<a name='5696'>
	               ENDIF<a name='5697'>
<a name='5698'>
<font color=#447700>! in case PSI_IM.GT.0.0D0<a name='5699'></font>
<a name='5700'>
	             ENDIF<a name='5701'>
<a name='5702'>
<font color=#447700>! in case I.LT.NKR-2<a name='5703'></font>
<a name='5704'>
                   ENDIF<a name='5705'>
<font color=#447700>! new change 7.02.06                                            (end)<a name='5706'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='5707'></font>
<font color=#447700>! in case RRS(2).LT.RN(K)<a name='5708'></font>
<a name='5709'>
                 ENDIF<a name='5710'>
 <a name='5711'>
<font color=#447700>! in case FI(K).NE.0.0D0<a name='5712'></font>
<a name='5713'>
               ENDIF<a name='5714'>
<a name='5715'>
 1000          CONTINUE<a name='5716'>
<a name='5717'>
	    ENDDO<a name='5718'>
<font color=#447700>! cycle by K<a name='5719'></font>
	    AOLDCON=0.0D0<a name='5720'>
	    ANEWCON=0.0D0<a name='5721'>
	    AOLDMASS=0.0D0<a name='5722'>
	    ANEWMASS=0.0D0<a name='5723'>
<a name='5724'>
	    DO K=1,NKR<a name='5725'>
	       AOLDCON=AOLDCON+FI(K)*RR(K)<a name='5726'>
	       ANEWCON=ANEWCON+PSI(K)<a name='5727'>
	       AOLDMASS=AOLDMASS+FI(K)*RR(K)*RN(K)<a name='5728'>
	       ANEWMASS=ANEWMASS+PSI(K)*RR(K)<a name='5729'>
	    ENDDO<a name='5730'>
<a name='5731'>
<font color=#447700>! new change 8.02.06                                          (start)<a name='5732'></font>
<font color=#447700>! ANDREI                                                      (start)<a name='5733'></font>
<a name='5734'>
<font color=#447700>! PSI(K) - new hydrometeor size distribution function(sdf)<a name='5735'></font>
<a name='5736'>
	    DO K=1,NKR<a name='5737'>
	       PSI(K)=<A href='../../html_code/phys/module_ra_cam_support.F.html#PSI'>PSI</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERNEWF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PSI_11">(K)/RR(K)<a name='5738'>
            ENDDO<a name='5739'>
	  <a name='5740'>
<font color=#447700>! new change 8.02.06                                            (end)	       <a name='5741'></font>
<font color=#447700>! ANDREI                                                        (end)<a name='5742'></font>
<a name='5743'>
<font color=#447700>! 3 point method                                                (end)	       <a name='5744'></font>
								     	       <a name='5745'>
<font color=#447700>! in case I3POINT.NE.0.AND.ISYM.GT.0						     		 <a name='5746'></font>
								     		    <a name='5747'>
	  ENDIF<a name='5748'>
<a name='5749'>
<font color=#447700>! Andrei's new change 1.12.09                                 (start)           <a name='5750'></font>
<a name='5751'>
          IF(IDROP.NE.0.AND.ISYM.GT.0) THEN<a name='5752'>
	  <a name='5753'>
	    DO K=KRDROP_REMAP_MIN,KRDROP_REMAP_MAX<a name='5754'>
	       CDROP(K)=3.0D0*COL*PSI(K)*RR(K)<a name='5755'>
	    ENDDO<a name='5756'>
								     		 <a name='5757'>
<font color=#447700>! KMAX - right boundary of drop sdf spectrum<a name='5758'></font>
<font color=#447700>!(KRDROP_REMAP_MIN =&lt; KMAX =&lt; KRDROP_REMAP_MAX)<a name='5759'></font>
<a name='5760'>
            DO K=KRDROP_REMAP_MAX,KRDROP_REMAP_MIN,-1<a name='5761'>
               KMAX=K<a name='5762'>
               IF(PSI(K).GT.0.0D0) GOTO 2011<a name='5763'>
            ENDDO<a name='5764'>
<a name='5765'>
 2011       CONTINUE<a name='5766'>
 <a name='5767'>
<font color=#447700>! Andrei start<a name='5768'></font>
<font color=#447700>!           DO K=KMAX-1,1,-1<a name='5769'></font>
<font color=#447700>! Andre end<a name='5770'></font>
<font color=#447700>!Alex, Andrei, Barry<a name='5771'></font>
            DO K=KMAX-1,KRDROP_REMAP_MIN,-1<a name='5772'>
<font color=#447700>!Alex, Andrei, Barry<a name='5773'></font>
	       IF(CDROP(K).GT.1.d-20) THEN<a name='5774'>
                 DELTA_CDROP(K)=CDROP(K+1)/CDROP(K)<a name='5775'>
	         IF(DELTA_CDROP(K).LT.COEFF_REMAP) THEN<a name='5776'>
	           CDROP(K)=CDROP(K)+CDROP(K+1)<a name='5777'>
		   CDROP(K+1)=0.0D0<a name='5778'>
	         ENDIF<a name='5779'>
	       ENDIF<a name='5780'>
            ENDDO<a name='5781'>
	    <a name='5782'>
	    DO K=KRDROP_REMAP_MIN,KMAX<a name='5783'>
	       PSI(K)=CDROP(K)/(3.0D0*COL*RR(K))<a name='5784'>
	    ENDDO<a name='5785'>
	    <a name='5786'>
<font color=#447700>! in case IDROP.NE.0.AND.ISYM.GT.0<a name='5787'></font>
		      <a name='5788'>
	  ENDIF<a name='5789'>
	    	  <a name='5790'>
<font color=#447700>! Andrei's new change 1.12.09                                   (end)           <a name='5791'></font>
<font color=#447700>! ANDREI                                                      (start) <a name='5792'></font>
<font color=#447700>! new change 8.02.06                                          (start)<a name='5793'></font>
<a name='5794'>
<font color=#447700>! in case RN(NRX).NE.RR(NRX)<a name='5795'></font>
<a name='5796'>
        ELSE<a name='5797'>
<a name='5798'>
<font color=#447700>! in case RN(NRX).EQ.RR(NRX)<a name='5799'></font>
<a name='5800'>
	  DO K=1,NKR<a name='5801'>
	     PSI(K)=FI(K)<a name='5802'>
	  ENDDO<a name='5803'>
<a name='5804'>
        ENDIF<a name='5805'>
<a name='5806'>
<font color=#447700>! new change 8.02.06                                            (end)           <a name='5807'></font>
<font color=#447700>! ANDREI                                            <a name='5808'></font>
<a name='5809'>
        RETURN <a name='5810'>
<a name='5811'>
<font color=#447700>! SUBROUTINE JERNEWF<a name='5812'></font>
        END SUBROUTINE JERNEWF<a name='5813'>
<a name='5814'>
<font color=#447700>! BARRY REMOVED QP,ROR<a name='5815'></font>
<A NAME='JERRATEOLD'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERRATEOLD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5816'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERRATEOLD</font>(R1S,TP,PP,ROR,VR1,PSINGLE,RIEC,RO1BL &amp;<a name='5817'>
     &amp;                    ,B11_MY,B12_MY,ID,IN,ICEMAX,NKR)<a name='5818'>
       IMPLICIT NONE<a name='5819'>
       INTEGER ID,IN,KR,ICE,NRM,ICEMAX,NKR<a name='5820'>
      DOUBLE PRECISION TP,PP<a name='5821'>
      REAL DETL,FACTPL,VENTPL,VR1K,CONSTL,RO1,RVT,D_MY, &amp;<a name='5822'>
     &amp; CONST<a name='5823'>
       REAL VR1(NKR,ID),PSINGLE,ROR<a name='5824'>
        REAL       &amp;<a name='5825'>
     &amp; R1S(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='5826'>
     &amp;,RO1BL(NKR,ID),RIEC(NKR,ID) &amp;<a name='5827'>
     &amp;,VR1KL(NKR,ICEMAX),VENTRL(NKR,ICEMAX) &amp;<a name='5828'>
     &amp;,FD1(NKR,ICEMAX),FK1(NKR,ICEMAX),FACTRL(NKR,ICEMAX) &amp;<a name='5829'>
     &amp;,R11_MY(NKR,ICEMAX),R12_MY(NKR,ICEMAX) &amp;<a name='5830'>
     &amp;,R1_MY1(NKR,ICEMAX),R1_MY2(NKR,ICEMAX),R1_MY3(NKR,ICEMAX) &amp;<a name='5831'>
     &amp;,AL1(2),AL1_MY(2),A1_MY(2),BB1_MY(2),ESAT1(2),CONSTLI(ICEMAX)<a name='5832'>
      DOUBLE PRECISION TZERO<a name='5833'>
      REAL PZERO,CF_MY,D_MYIN,RV_MY<a name='5834'>
      PARAMETER (TZERO=273.150,PZERO=1.013E6)<a name='5835'>
      DATA AL1/2500.,2833./<a name='5836'>
	CONST=12.566372<a name='5837'>
        AL1_MY(1)=2.5E10<a name='5838'>
        AL1_MY(2)=2.834E10<a name='5839'>
        A1_MY(1)=2.53E12<a name='5840'>
        A1_MY(2)=3.41E13<a name='5841'>
        BB1_MY(1)=5.42E3<a name='5842'>
        BB1_MY(2)=6.13E3<a name='5843'>
        CF_MY=2.4E3<a name='5844'>
        D_MYIN=0.221<a name='5845'>
        RV_MY=461.5E4<a name='5846'>
	NRM=NKR-1<a name='5847'>
<a name='5848'>
<font color=#447700>! RHS FOR "MAXWELL" EQUATION <a name='5849'></font>
<a name='5850'>
	D_MY=D_MYIN*(PZERO/PP)*(TP/TZERO)**1.94<a name='5851'>
	RVT=RV_MY*TP<a name='5852'>
	ESAT1(IN)=A1_MY(IN)*EXP(-BB1_MY(IN)/TP)<a name='5853'>
<a name='5854'>
	DO 1 ICE=1,ID<a name='5855'>
	     DO 1 KR=1,NKR<a name='5856'>
	     RO1=RO1BL(KR,ICE)<a name='5857'>
	     CONSTL=CONST*RIEC(KR,ICE)<a name='5858'>
	     CONSTLI(ICE)=CONSTL<a name='5859'>
	     VR1K=0.<a name='5860'>
	     VR1KL(KR,ICE)=VR1K<a name='5861'>
	     VENTPL=1.<a name='5862'>
	     VENTRL(KR,ICE)=VENTPL<a name='5863'>
	     FACTPL=1.<a name='5864'>
	     FACTRL(KR,ICE)=FACTPL<a name='5865'>
	     FD1(KR,ICE)=RVT/D_MY/ESAT1(IN)/FACTPL<a name='5866'>
	     FK1(KR,ICE)=(AL1_MY(IN)/RVT-1.)*AL1_MY(IN)/CF_MY/TP<a name='5867'>
	     R1_MY1(KR,ICE)=VENTPL*CONSTL<a name='5868'>
	     R11_MY(KR,ICE)=R1_MY1(KR,ICE)<a name='5869'>
<font color=#447700>!BARRY<a name='5870'></font>
<font color=#447700>!     R1_MY2(KR,ICE)=VENTPL*CONSTL*0.<a name='5871'></font>
<font color=#447700>!     R1_MY3(KR,ICE)=VENTPL*CONSTL*0.<a name='5872'></font>
<font color=#447700>!     R12_MY(KR,ICE)=R1_MY2(KR,ICE)-R1_MY3(KR,ICE)<a name='5873'></font>
<font color=#447700>!BARRY<a name='5874'></font>
<font color=#447700>! GROWTH RATE<a name='5875'></font>
<a name='5876'>
	     DETL=FK1(KR,ICE)+FD1(KR,ICE)<a name='5877'>
	     B11_MY(KR,ICE)=R11_MY(KR,ICE)/DETL<a name='5878'>
<font color=#447700>!BARRY     B12_MY(KR,ICE)=R12_MY(KR,ICE)/DETL<a name='5879'></font>
           B12_MY(KR,ICE)=0                       <a name='5880'>
    1	CONTINUE<a name='5881'>
<a name='5882'>
	RETURN<a name='5883'>
	END SUBROUTINE JERRATEOLD<a name='5884'>
<a name='5885'>
<font color=#447700>! SUBROUTINE JERRATE<a name='5886'></font>
<font color=#447700>!========================================================================<a name='5887'></font>
<font color=#447700>!BARRY    CALL JERSUPSAT(DEL1,DEL2,DEL1N,DEL2N<a name='5888'></font>
<font color=#447700>!    *                        ,RW,PW,RI,PI,QW,QI<a name='5889'></font>
<font color=#447700>! SUBROUTINE JERNEWF<a name='5890'></font>
<font color=#447700>!=========================================================================<a name='5891'></font>
<font color=#447700>! BARRY REMOVED QP<a name='5892'></font>
<A NAME='JERRATE'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERRATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5893'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERRATE</font>(R1S,TP,PP,ROR,VR1,PSINGLE,RIEC,RO1BL &amp; <A href='../../call_to/JERRATE.html' TARGET='index'>20</A><a name='5894'>
     &amp;                    ,B11_MY,B12_MY,ID,IN,ICEMAX,NKR)<a name='5895'>
       IMPLICIT NONE<a name='5896'>
       INTEGER ID,IN,KR,ICE,NRM,ICEMAX,NKR<a name='5897'>
      DOUBLE PRECISION TP,PP<a name='5898'>
      REAL DETL,FACTPL,VENTPL,VR1K,CONSTL,RO1,RVT,D_MY, &amp;<a name='5899'>
     &amp; CONST<a name='5900'>
        REAL VR1(NKR,ID),PSINGLE &amp;<a name='5901'>
     &amp;,R1S(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='5902'>
     &amp;,RO1BL(NKR,ID),RIEC(NKR,ID) &amp;<a name='5903'>
     &amp;,VR1KL(NKR,ICEMAX),VENTRL(NKR,ICEMAX) &amp;<a name='5904'>
     &amp;,FD1(NKR,ICEMAX),FK1(NKR,ICEMAX),FACTRL(NKR,ICEMAX) &amp;<a name='5905'>
     &amp;,R11_MY(NKR,ICEMAX),R12_MY(NKR,ICEMAX) &amp;<a name='5906'>
     &amp;,R1_MY1(NKR,ICEMAX),R1_MY2(NKR,ICEMAX),R1_MY3(NKR,ICEMAX) &amp;<a name='5907'>
     &amp;,AL1(2),AL1_MY(2),A1_MY(2),BB1_MY(2),ESAT1(2),CONSTLI(ICEMAX)<a name='5908'>
      DOUBLE PRECISION TZERO<a name='5909'>
      REAL PZERO,CF_MY,D_MYIN,RV_MY,DEG01,DEG03<a name='5910'>
      REAL COEFF_VISCOUS,SHMIDT_NUMBER,A,B<a name='5911'>
      REAL REINOLDS_NUMBER,RESHM,ROR<a name='5912'>
      PARAMETER (TZERO=273.150,PZERO=1.013E6)<a name='5913'>
      DATA AL1/2500.,2833./<a name='5914'>
        DEG01=1./3.     <a name='5915'>
        DEG03=1./3.     <a name='5916'>
	CONST=12.566372<a name='5917'>
        AL1_MY(1)=2.5E10<a name='5918'>
        AL1_MY(2)=2.834E10<a name='5919'>
        A1_MY(1)=2.53E12<a name='5920'>
        A1_MY(2)=3.41E13<a name='5921'>
        BB1_MY(1)=5.42E3<a name='5922'>
        BB1_MY(2)=6.13E3<a name='5923'>
        CF_MY=2.4E3<a name='5924'>
        D_MYIN=0.221<a name='5925'>
        RV_MY=461.5E4<a name='5926'>
	NRM=NKR-1<a name='5927'>
<font color=#447700>! rhs for "maxwell" equation<a name='5928'></font>
<font color=#447700>! coefficient of diffusion<a name='5929'></font>
        D_MY=D_MYIN*(PZERO/PP)*(TP/TZERO)**1.94<a name='5930'>
<font color=#447700>! new change 20.04.02<a name='5931'></font>
<font color=#447700>! coefficient of viscousity<a name='5932'></font>
        COEFF_VISCOUS=1.72E-2*SQRT(TP/273.)*393./(TP-120.)/ROR<a name='5933'>
<font color=#447700>! Shmidt number<a name='5934'></font>
        SHMIDT_NUMBER=COEFF_VISCOUS/D_MY<a name='5935'>
<font color=#447700>! Constants used for calculation of Reinolds number<a name='5936'></font>
        A=2.*(3./4./3.141593)**DEG01<a name='5937'>
        B=A/COEFF_VISCOUS<a name='5938'>
        <a name='5939'>
        RVT=RV_MY*TP<a name='5940'>
        ESAT1(IN)=A1_MY(IN)*EXP(-BB1_MY(IN)/TP)<a name='5941'>
        DO ICE=1,ID<a name='5942'>
           DO KR=1,NKR<a name='5943'>
<font color=#447700>! Reinolds numbers<a name='5944'></font>
              REINOLDS_NUMBER= &amp;<a name='5945'>
     &amp;        B*VR1(KR,ICE)*SQRT(1.E6/PSINGLE)* &amp;<a name='5946'>
     &amp;        (R1S(KR,ICE)/RO1BL(KR,ICE))**DEG03<a name='5947'>
              RESHM=SQRT(REINOLDS_NUMBER)*SHMIDT_NUMBER**DEG03<a name='5948'>
              IF(REINOLDS_NUMBER.LT.2.5) THEN<a name='5949'>
                VENTPL=1.+0.108*RESHM*RESHM<a name='5950'>
              ELSE<a name='5951'>
                VENTPL=0.78+0.308*RESHM<a name='5952'>
              ENDIF<a name='5953'>
<font color=#447700>! new change 20.04.02                                           (end)<a name='5954'></font>
              CONSTL=CONST*RIEC(KR,ICE)                         <a name='5955'>
              CONSTLI(ICE)=CONSTL<a name='5956'>
<font color=#447700>!             VR1K=0.<a name='5957'></font>
<font color=#447700>!             VR1KL(KR,ICE)=VR1K<a name='5958'></font>
<font color=#447700>! new change 20.04.02                                         (begin)<a name='5959'></font>
<font color=#447700>!             VENTPL=1.                                       <a name='5960'></font>
<font color=#447700>!             VENTRL(KR,ICE)=VENTPL                           <a name='5961'></font>
<font color=#447700>! new change 20.04.02                                           (end)<a name='5962'></font>
              FACTPL=1.                                         <a name='5963'>
              FACTRL(KR,ICE)=FACTPL                             <a name='5964'>
              FD1(KR,ICE)=RVT/D_MY/ESAT1(IN)/FACTPL             <a name='5965'>
              FK1(KR,ICE)=(AL1_MY(IN)/RVT-1.)*AL1_MY(IN)/CF_MY/TP<a name='5966'>
              R1_MY1(KR,ICE)=VENTPL*CONSTL<a name='5967'>
<font color=#447700>!             R1_MY2(KR,ICE)=VENTPL*CONSTL*0.<a name='5968'></font>
<font color=#447700>!             R1_MY3(KR,ICE)=VENTPL*CONSTL*0.<a name='5969'></font>
              R11_MY(KR,ICE)=R1_MY1(KR,ICE)<a name='5970'>
<font color=#447700>!BARRY        R12_MY(KR,ICE)=R1_MY2(KR,ICE)-R1_MY3(KR,ICE)<a name='5971'></font>
<font color=#447700>! growth rate <a name='5972'></font>
              DETL=FK1(KR,ICE)+FD1(KR,ICE)<a name='5973'>
              B11_MY(KR,ICE)=R11_MY(KR,ICE)/DETL<a name='5974'>
<font color=#447700>!BARRY        B12_MY(KR,ICE)=R12_MY(KR,ICE)/DETL<a name='5975'></font>
              B12_MY(KR,ICE)=0.<a name='5976'>
           ENDDO<a name='5977'>
        ENDDO<a name='5978'>
<a name='5979'>
<a name='5980'>
	RETURN<a name='5981'>
	END SUBROUTINE JERRATE<a name='5982'>
<a name='5983'>
<font color=#447700>! SUBROUTINE JERRATE<a name='5984'></font>
<font color=#447700>!========================================================================<a name='5985'></font>
<font color=#447700>!BARRY    CALL JERSUPSAT(DEL1,DEL2,DEL1N,DEL2N<a name='5986'></font>
<font color=#447700>!    *                        ,RW,PW,RI,PI,QW,QI<a name='5987'></font>
<font color=#447700>!    *                        ,DTT,D1N,D2N,DT0L,DT0I)<a name='5988'></font>
<A NAME='JERSUPSAT'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERSUPSAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5989'>
	<font color=#993300>SUBROUTINE </font><font color=#cc0000>JERSUPSAT</font>(DEL1,DEL2,DEL1N,DEL2N &amp; <A href='../../call_to/JERSUPSAT.html' TARGET='index'>12</A>,<A href='../../call_from/JERSUPSAT.html' TARGET='index'>10</A><a name='5990'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='5991'>
     &amp;                      ,DT,DEL1INT,DEL2INT,DT0L,DT0I)<a name='5992'>
      IMPLICIT NONE<a name='5993'>
   <a name='5994'>
      INTEGER ITYPE<a name='5995'>
      REAL DEL1,DEL2,RW,PW,RI,PI,QW,QI, &amp;<a name='5996'>
     &amp;  DT,DEL1INT,DEL2INT,DT0L,DT0I,DTLIN,DTIIN<a name='5997'>
      REAL DETER,DBLRW,DBLPW,DBLPI,DBLRI, &amp;<a name='5998'>
     &amp;  DBLDEL1,DBLDEL2,DBLDEL1INT,DBLDTLIN,DBLDTIIN, &amp;<a name='5999'>
     &amp;  EXPM,EXPP,ALFAMX,ALFAPX,X,ALFA,DELX,DBLDEL2INT, &amp;<a name='6000'>
     &amp;  R1RES,R2RES,R1,R2,R3,R4,R21,R11,R10,R41,R31,R30,DBLDT, &amp;<a name='6001'>
     &amp;  DBLDEL1N,DBLDEL2N<a name='6002'>
      DOUBLE PRECISION DEL1N,DEL2N<a name='6003'>
<a name='6004'>
        DOUBLE PRECISION DEL1N_2P,DEL1INT_2P,DEL2N_2P,DEL2INT_2P <a name='6005'>
        DOUBLE PRECISION EXPP_2P,EXPM_2P,ARGEXP     <a name='6006'>
<font color=#447700>! BARRY<a name='6007'></font>
      DOUBLE PRECISION RW_DP,PW_DP,PI_DP,RI_DP,X_DP,ALFA_DP<a name='6008'>
<font color=#447700>!    * ,ALFAPX_DP<a name='6009'></font>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6010'></font>
      DOUBLE PRECISION  EXPM1<a name='6011'>
      EXPM1(x_dp)= &amp;<a name='6012'>
     &amp;x_dp+x_dp*x_dp/2.0D0+x_dp*x_dp*x_dp/6.0D0+x_dp*x_dp*x_dp*x_dp/24.0D0+x_dp*x_dp*x_dp*x_dp*x_dp/120.0D0<a name='6013'>
      DOUBLE PRECISION  DETER_MIN<a name='6014'>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6015'></font>
<a name='6016'>
      DOUBLE PRECISION EXP1, EXP2<a name='6017'>
<a name='6018'>
<font color=#447700>! Andrei's new change 9.03.10                                   (end)<a name='6019'></font>
	DTLIN=1000.E17<a name='6020'>
	DTIIN=1000.E17<a name='6021'>
<font color=#447700>! Andrei's new change 9.03.10                                 (start)<a name='6022'></font>
      DETER=RW*PI-PW*RI<a name='6023'>
<font color=#447700>!     DETER_MIN=1.0D-20<a name='6024'></font>
<font color=#447700>! Andrei's new change 9.03.10                                 (end)<a name='6025'></font>
<font color=#447700>! SOLUTION  <a name='6026'></font>
<font color=#447700>!IF(DETER.EQ.0)  THEN<a name='6027'></font>
       IF(RW.EQ.0.AND.RI.EQ.0) THEN<a name='6028'>
<font color=#447700>! NO CLOUD: WITHOUT WATER &amp; ICE<a name='6029'></font>
	    DEL1N_2P=DEL1<a name='6030'>
	    DEL2N_2P=DEL2<a name='6031'>
	    DEL1INT_2P=DEL1*DT<a name='6032'>
	    DEL2INT_2P=DEL2*DT<a name='6033'>
<font color=#447700>! IN CASE: RW.NE.0 OR RI.NE.0 (WATER OR ICE) <a name='6034'></font>
       ELSE IF(RW.NE.0.AND.RI*1.E5.LT.RW) THEN<a name='6035'>
<font color=#447700>! ONLY WATER<a name='6036'></font>
              ARGEXP=-RW*DT<a name='6037'>
<a name='6038'>
	      DEL1N_2P=DEL1*DEXP(ARGEXP)+QW*(1.-DEXP(ARGEXP))<a name='6039'>
	      DEL1INT_2P=(DEL1-DEL1N_2P)/RW<a name='6040'>
	      DEL2N_2P=DEL2-PW*DEL1INT_2P<a name='6041'>
	      DEL2INT_2P= &amp;<a name='6042'>
     &amp;       (DEL2N_2P-PW*DEL1N_2P/RW)*DT+PW*DEL1INT_2P/RW<a name='6043'>
	ELSE IF(RI.NE.0.AND.RW*1.E5.LT.RI) THEN<a name='6044'>
<font color=#447700>! IN CASE: RW.EQ.0<a name='6045'></font>
<font color=#447700>! ONLY ICE <a name='6046'></font>
              ARGEXP=-PI*DT<a name='6047'>
<a name='6048'>
	      DEL2N_2P=DEL2*DEXP(ARGEXP)+QI*(1.-DEXP(ARGEXP))<a name='6049'>
	      DEL2INT_2P=(DEL2-DEL2N_2P)/PI<a name='6050'>
	      DEL1N_2P=DEL1-RI*DEL2INT_2P<a name='6051'>
	      DEL1INT_2P= &amp;<a name='6052'>
     &amp;       (DEL1N_2P-RI*DEL2N_2P/PI)*DT+RI*DEL2INT_2P/PI<a name='6053'>
<font color=#447700>!             GOTO 100<a name='6054'></font>
<font color=#447700>! IN CASE: RW.NE.0 OR RI.NE.0 (WATER OR ICE)<a name='6055'></font>
<font color=#447700>! IN CASE: DETER.EQ.0<a name='6056'></font>
        ELSE<a name='6057'>
<font color=#447700>! IN CASE: DETER.NE.0<a name='6058'></font>
<font color=#447700>! COMPLETE SOLUTION <a name='6059'></font>
<font color=#447700>!  ALFA=SQRT((RW-PI)*(RW-PI)+4.*PW*RI)<a name='6060'></font>
<font color=#447700>!  X=RW+PI<a name='6061'></font>
<font color=#447700>!  ALFAPX=.5*(ALFA+X)<a name='6062'></font>
<font color=#447700>! BARRY <a name='6063'></font>
          RW_DP=RW<a name='6064'>
          RI_DP=RI<a name='6065'>
          PI_DP=PI<a name='6066'>
          PW_DP=PW<a name='6067'>
          IF (RW.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_754">("fatal error in module_mp_fast_sbm (RW.LE.0), model stop")<a name='6068'>
          IF (PW.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_755">("fatal error in module_mp_fast_sbm (PW.LE.0), model stop")<a name='6069'>
          IF (RI.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_756">("fatal error in module_mp_fast_sbm (RI.LE.0), model stop")<a name='6070'>
          IF (PI.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_757">("fatal error in module_mp_fast_sbm (PI.LE.0), model stop")<a name='6071'>
          ALFA_DP=SQRT((RW_DP-PI_DP)*(RW_DP-PI_DP)+4.*PW_DP*RI_DP) <a name='6072'>
	  X_DP=RW_DP+PI_DP<a name='6073'>
	  ALFAPX=.5*(ALFA_DP+X_DP)<a name='6074'>
          IF (ALFAPX.LE.0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_758">("fatal error in module_mp_fast_sbm (CHECK.LT.0), model stop")<a name='6075'>
	  ALFAMX=.5*(ALFA_DP-X_DP)<a name='6076'>
<font color=#447700>!<a name='6077'></font>
<font color=#447700>! <a name='6078'></font>
          ARGEXP=-ALFAPX*DT<a name='6079'>
<font color=#447700>! Andrei 11/04/10<a name='6080'></font>
	  EXPP_2P=DEXP(ARGEXP)<a name='6081'>
          IF(DABS(ARGEXP).LE.1.0E-6) THEN<a name='6082'>
               EXP1=EXPM1(ARGEXP)<a name='6083'>
          ELSE<a name='6084'>
               EXP1=EXPP_2P-1.0D0<a name='6085'>
          ENDIF<a name='6086'>
<font color=#447700>!<a name='6087'></font>
          ARGEXP=ALFAMX*DT<a name='6088'>
<font color=#447700>!Andre 11/04/10<a name='6089'></font>
	  EXPM_2P=DEXP(ARGEXP)<a name='6090'>
              IF(DABS(ARGEXP).LE.1.0E-6) THEN<a name='6091'>
                EXP2=EXPM1(ARGEXP)<a name='6092'>
              ELSE<a name='6093'>
                EXP2=EXPM_2P-1.0D0<a name='6094'>
              ENDIF<a name='6095'>
<font color=#447700>!<a name='6096'></font>
<font color=#447700>! DROPLETS <a name='6097'></font>
	  R10=RW*DEL1+RI*DEL2<a name='6098'>
	  R11=R10-ALFAPX*DEL1<a name='6099'>
	  R21=R10+ALFAMX*DEL1<a name='6100'>
	  DEL1N_2P=(R21*EXPP_2P-R11*EXPM_2P)/ALFA_DP<a name='6101'>
<font color=#447700>! BARRY<a name='6102'></font>
	  IF(ALFAMX.NE.0) THEN<a name='6103'>
	    R1=-R11/ALFAMX<a name='6104'>
	    R2=R21/ALFAPX<a name='6105'>
<font color=#447700>!    DEL1INT_2P=(R1*(EXPM_2P-1.)-R2*(EXPP_2P-1.))/ALFA_DP<a name='6106'></font>
            DEL1INT_2P=(R1*EXP2-R2*EXP1)/ALFA_DP<a name='6107'>
	  ELSE<a name='6108'>
            DEL1INT_2P = 0.<a name='6109'>
	  ENDIF<a name='6110'>
<font color=#447700>! BARRY<a name='6111'></font>
	  R1RES=0.<a name='6112'>
	  IF(R11.NE.0) R1RES=R21/R11<a name='6113'>
	  IF(R1RES.GT.0) DTLIN=ALOG(R1RES)/ALFA_DP<a name='6114'>
<font color=#447700>! ICE <a name='6115'></font>
	  R30=PW*DEL1+PI*DEL2<a name='6116'>
	  R31=R30-ALFAPX*DEL2<a name='6117'>
	  R41=R30+ALFAMX*DEL2<a name='6118'>
<font color=#447700>! BARRY<a name='6119'></font>
	  DEL2N_2P=(R41*EXPP_2P-R31*EXPM_2P)/ALFA_DP<a name='6120'>
	  IF(ALFAMX.NE.0.AND.ALFAPX.NE.0) THEN<a name='6121'>
	    R3=-R31/ALFAMX<a name='6122'>
	    R4=R41/ALFAPX<a name='6123'>
<font color=#447700>!           DEL2INT_2P=(R3*(EXPM_2P-1.)-R4*(EXPP_2P-1.))/ALFA_DP<a name='6124'></font>
            DEL2INT_2P=(R3*EXP2-R4*EXP1)/ALFA_DP<a name='6125'>
          ELSE<a name='6126'>
	    DEL2INT_2P=0.<a name='6127'>
	  ENDIF<a name='6128'>
	  R2RES=0.<a name='6129'>
	  IF(R31.NE.0) R2RES=R41/R31<a name='6130'>
	  IF(R2RES.GT.0) DTIIN=ALOG(R2RES)/ALFA_DP<a name='6131'>
<font color=#447700>! IN CASE: DETER.NE.0<a name='6132'></font>
<font color=#447700>! END OF COMPLETE SOLUTION<a name='6133'></font>
	ENDIF<a name='6134'>
<font color=#447700>! IN CASES: DETER.EQ.0 OR DETER.NE.0<a name='6135'></font>
 100    CONTINUE<a name='6136'>
        DEL1N=DEL1N_2P<a name='6137'>
        DEL2N=DEL2N_2P<a name='6138'>
       <a name='6139'>
<font color=#447700>! BARRY<a name='6140'></font>
        DEL1INT=DEL1INT_2P<a name='6141'>
        DEL2INT=DEL2INT_2P<a name='6142'>
	DT0L=DTLIN<a name='6143'>
	IF(DT0L.LT.0) DT0L=1.E20<a name='6144'>
	DT0I=DTIIN<a name='6145'>
	IF(DT0I.LT.0) DT0I=1.E20<a name='6146'>
	RETURN<a name='6147'>
	END SUBROUTINE JERSUPSAT<a name='6148'>
<font color=#447700>!==========================================================================<a name='6149'></font>
<A NAME='JERTIMESC'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERTIMESC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6150'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERTIMESC</font>(FI1,X1,SFN11,SFN12 &amp; <A href='../../call_to/JERTIMESC.html' TARGET='index'>16</A><a name='6151'>
     &amp;                      ,B11_MY,B12_MY,RIEC,CF,ID,COL,NKR)        <a name='6152'>
      IMPLICIT NONE<a name='6153'>
       INTEGER NRM,KR,ICE,ID,NKR<a name='6154'>
      REAL B12,B11,FUN,DELM,FK,CF,SFN12S,SFN11S<a name='6155'>
	REAL  COL, &amp;<a name='6156'>
     &amp; X1(NKR,ID),FI1(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6157'>
     &amp;,RIEC(NKR,ID),SFN11,SFN12<a name='6158'>
<a name='6159'>
	NRM=NKR-1<a name='6160'>
	DO 1 ICE=1,ID  <a name='6161'>
             SFN11S=0.                              <a name='6162'>
             SFN12S=0.<a name='6163'>
	     SFN11=CF*SFN11S	<a name='6164'>
	     SFN12=CF*SFN12S<a name='6165'>
             DO KR=1,NRM<a name='6166'>
<font color=#447700>! VALUE OF DISTRIBUTION FUNCTION<a name='6167'></font>
	        FK=FI1(KR,ICE)<a name='6168'>
<font color=#447700>! DELTA-M <a name='6169'></font>
	        DELM=X1(KR,ICE)*3.*COL<a name='6170'>
<font color=#447700>! INTEGRAL'S EXPRESSION <a name='6171'></font>
	        FUN=FK*DELM<a name='6172'>
<font color=#447700>! VALUES OF INTEGRALS<a name='6173'></font>
	        B11=B11_MY(KR,ICE)<a name='6174'>
        	B12=B12_MY(KR,ICE)<a name='6175'>
                SFN11S=SFN11S+FUN*B11                               <a name='6176'>
                SFN12S=SFN12S+FUN*B12<a name='6177'>
	     ENDDO<a name='6178'>
<font color=#447700>! CORRECTION <a name='6179'></font>
	     SFN11=CF*SFN11S<a name='6180'>
             SFN12=CF*SFN12S<a name='6181'>
    1   CONTINUE<a name='6182'>
<font color=#447700>! END <a name='6183'></font>
	RETURN<a name='6184'>
	END SUBROUTINE JERTIMESC<a name='6185'>
<font color=#447700>!<a name='6186'></font>
<A NAME='JERTIMESC_ICE'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#JERTIMESC_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6187'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>JERTIMESC_ICE</font>(FI1,X1,SFN11,SFN12 &amp; <A href='../../call_to/JERTIMESC_ICE.html' TARGET='index'>4</A><a name='6188'>
     &amp;                      ,B11_MY,B12_MY,RIEC,CF,ID,COL,NKR)        <a name='6189'>
      IMPLICIT NONE<a name='6190'>
       INTEGER NRM,KR,ICE,ID,NKR<a name='6191'>
      REAL B12,B11,FUN,DELM,FK,CF,SFN12S,SFN11S<a name='6192'>
	REAL  COL, &amp;<a name='6193'>
     &amp; X1(NKR,ID),FI1(NKR,ID),B11_MY(NKR,ID),B12_MY(NKR,ID) &amp;<a name='6194'>
     &amp;,RIEC(NKR,ID),SFN11(ID),SFN12(ID)<a name='6195'>
<a name='6196'>
	NRM=NKR-1<a name='6197'>
	DO 1 ICE=1,ID  <a name='6198'>
             SFN11S=0.                              <a name='6199'>
             SFN12S=0.<a name='6200'>
	     SFN11(ICE)=CF*SFN11S	<a name='6201'>
	     SFN12(ICE)=CF*SFN12S<a name='6202'>
             DO KR=1,NRM<a name='6203'>
<font color=#447700>! VALUE OF DISTRIBUTION FUNCTION<a name='6204'></font>
	        FK=FI1(KR,ICE)<a name='6205'>
<font color=#447700>! DELTA-M <a name='6206'></font>
	        DELM=X1(KR,ICE)*3.*COL<a name='6207'>
<font color=#447700>! INTEGRAL'S EXPRESSION <a name='6208'></font>
	        FUN=FK*DELM<a name='6209'>
<font color=#447700>! VALUES OF INTEGRALS<a name='6210'></font>
	        B11=B11_MY(KR,ICE)<a name='6211'>
        	B12=B12_MY(KR,ICE)<a name='6212'>
                SFN11S=SFN11S+FUN*B11                               <a name='6213'>
                SFN12S=SFN12S+FUN*B12<a name='6214'>
	     ENDDO<a name='6215'>
<font color=#447700>! CORRECTION <a name='6216'></font>
	     SFN11(ICE)=CF*SFN11S<a name='6217'>
             SFN12(ICE)=CF*SFN12S<a name='6218'>
    1   CONTINUE<a name='6219'>
<font color=#447700>! END <a name='6220'></font>
	RETURN<a name='6221'>
	END SUBROUTINE JERTIMESC_ICE<a name='6222'>
<a name='6223'>
<a name='6224'>
<A NAME='ONECOND2'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ONECOND2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6225'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND2</font> &amp; <A href='../../call_to/ONECOND2.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND2.html' TARGET='index'>56</A><a name='6226'>
     &amp; (TT,QQ,PP,ROR  &amp;<a name='6227'>
     &amp; ,VR2,VR3,VR4,VR5,PSINGLE &amp;<a name='6228'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6229'>
     &amp; ,FF2,PSI2,R2,RIEC,RO2BL &amp;<a name='6230'>
     &amp; ,FF3,PSI3,R3,RSEC,RO3BL &amp;<a name='6231'>
     &amp; ,FF4,PSI4,R4,RGEC,RO4BL &amp;<a name='6232'>
     &amp; ,FF5,PSI5,R5,RHEC,RO5BL &amp;<a name='6233'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6234'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='6235'>
     &amp; ,COL,DTCOND,ICEMAX,NKR &amp;<a name='6236'>
     &amp; ,ISYM2,ISYM3,ISYM4,ISYM5)<a name='6237'>
<a name='6238'>
       IMPLICIT NONE<a name='6239'>
<a name='6240'>
      INTEGER NKR,ICEMAX<a name='6241'>
      REAL    COL,VR2(NKR,ICEMAX),VR3(NKR),VR4(NKR) &amp;<a name='6242'>
     &amp;           ,VR5(NKR),PSINGLE &amp;<a name='6243'>
     &amp;       ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6244'>
     &amp;       ,DTCOND<a name='6245'>
<a name='6246'>
      REAL C1_MEY,C2_MEY<a name='6247'>
      INTEGER I_MIXCOND,I_MIXEVAP,I_ABERGERON,I_BERGERON, &amp;<a name='6248'>
     &amp; KR,ICE,ITIME,ICM,KCOND,NR,NRM,INUC, &amp;<a name='6249'>
     &amp; ISYM2,ISYM3,ISYM4,ISYM5,KP,KLIMIT, &amp;<a name='6250'>
     &amp; KM,ITER,KLIMITL,KLIMITG,KLIMITH,KLIMITI_1,KLIMITI_2,KLIMITI_3, &amp;<a name='6251'>
     &amp; NCRITI<a name='6252'>
      REAL AL1,AL2,D,GAM,POD, &amp;<a name='6253'>
     &amp; RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY,ALC,DT0LREF,DTLREF, &amp;<a name='6254'>
     &amp; A1_MYN, BB1_MYN, A2_MYN, BB2_MYN,DT,DTT,XRAD, &amp;<a name='6255'>
     &amp; TPC1, TPC2, TPC3, TPC4, TPC5, &amp;<a name='6256'>
     &amp; EPSDEL, DT0L, DT0I, &amp;<a name='6257'>
     &amp; ROR, &amp;<a name='6258'>
     &amp; DEL1NUC,DEL2NUC, &amp;<a name='6259'>
     &amp; CWHUCM,B6,B8L,B8I,RMASSGL,RMASSGI, &amp;<a name='6260'>
     &amp; DEL1,DEL2,DEL1S,DEL2S, &amp;<a name='6261'>
     &amp; TIMENEW,TIMEREV,SFN11,SFN12, &amp;<a name='6262'>
     &amp; SFNL,SFNI,B5L,B5I,B7L,B7I,DOPL,DOPI,OPERQ,RW,RI,QW,PW, &amp;<a name='6263'>
     &amp; PI,QI,D1N0,D2N0,DTNEWL,DTNEWL1,D1N,D2N, &amp;<a name='6264'>
     &amp; DEL_R1,DT0L0,DT0I0,SFN31,SFN32,SFN52, &amp;<a name='6265'>
     &amp; SFNII1,SFN21,SFN22,DTNEWI3,DTNEWI4,DTNEWI5,DTNEWI2_1, &amp;<a name='6266'>
     &amp; DTNEWI2_2,DTNEWI1,DEL_R2,DEL_R4,DEL_R5,SFN41,SFN42, &amp;<a name='6267'>
     &amp; SNF51,DTNEWI2_3,DTNEWI2,DTNEWI_1,DTNEWI_2, &amp;<a name='6268'>
     &amp; DTNEWL0,DTNEWG1,DTNEWH1,DTNEWI_3, &amp;<a name='6269'>
     &amp; DTNEWL2,SFN51,SFNII2,DEL_R3,DTNEWI  <a name='6270'>
       REAL DT_WATER_COND,DT_WATER_EVAP,DT_ICE_COND,DT_ICE_EVAP, &amp;<a name='6271'>
     &amp;  DT_MIX_COND,DT_MIX_EVAP,DT_MIX_BERGERON,DT_MIX_ANTIBERGERON<a name='6272'>
<a name='6273'>
       INTEGER K<a name='6274'>
<a name='6275'>
<font color=#447700>! NEW ALGORITHM OF CONDENSATION (12.01.00)<a name='6276'></font>
<a name='6277'>
      DOUBLE PRECISION DD1N,DB11_MY,DAL1,DAL2<a name='6278'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='6279'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='6280'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='6281'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='6282'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='6283'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='6284'>
     &amp;                  ,TT,QQ,PP &amp;<a name='6285'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6286'>
     &amp;                  ,OPER2,OPER3,AR1,AR2  <a name='6287'>
<a name='6288'>
       DOUBLE PRECISION DELTAQ1,DELMASSI1,DELMASSL1<a name='6289'>
<a name='6290'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='6291'></font>
<a name='6292'>
        CHARACTER*70 CPRINT<a name='6293'>
<a name='6294'>
<a name='6295'>
<a name='6296'>
<a name='6297'>
<a name='6298'>
<a name='6299'>
<a name='6300'>
<font color=#447700>! CRYSTALS<a name='6301'></font>
                                                                       <a name='6302'>
	REAL R2(NKR,ICEMAX) &amp;<a name='6303'>
     &amp;           ,RIEC(NKR,ICEMAX) &amp;<a name='6304'>
     &amp;           ,RO2BL(NKR,ICEMAX) &amp;<a name='6305'>
     &amp;           ,FI2(NKR,ICEMAX),PSI2(NKR,ICEMAX) &amp;<a name='6306'>
     &amp;           ,FF2(NKR,ICEMAX) &amp;<a name='6307'>
     &amp;           ,B21_MY(NKR,ICEMAX),B22_MY(NKR,ICEMAX)<a name='6308'>
<a name='6309'>
<font color=#447700>! SNOW                                                                          <a name='6310'></font>
        REAL R3(NKR) &amp;<a name='6311'>
     &amp;           ,RSEC(NKR),RO3BL(NKR) &amp;<a name='6312'>
     &amp;           ,FI3(NKR),FF3(NKR),PSI3(NKR) &amp;<a name='6313'>
     &amp;           ,B31_MY(NKR),B32_MY(NKR)<a name='6314'>
<a name='6315'>
<font color=#447700>! GRAUPELS <a name='6316'></font>
                                                                       <a name='6317'>
        REAL R4(NKR) &amp;<a name='6318'>
     &amp;           ,RGEC(NKR),RO4BL(NKR) &amp;<a name='6319'>
     &amp;           ,FI4(NKR),FF4(NKR),PSI4(NKR) &amp;<a name='6320'>
     &amp;           ,B41_MY(NKR),B42_MY(NKR)  <a name='6321'>
<a name='6322'>
<font color=#447700>! HAIL                                                                          <a name='6323'></font>
        REAL R5(NKR) &amp;<a name='6324'>
     &amp;           ,RHEC(NKR),RO5BL(NKR) &amp;<a name='6325'>
     &amp;           ,FI5(NKR),FF5(NKR),PSI5(NKR) &amp;<a name='6326'>
     &amp;           ,B51_MY(NKR),B52_MY(NKR)  <a name='6327'>
<a name='6328'>
<font color=#447700>! CCN                                                                       <a name='6329'></font>
<a name='6330'>
<font color=#447700>! WORK ARRAYS <a name='6331'></font>
<a name='6332'>
<font color=#447700>! NEW ALGORITHM OF MIXED PHASE FOR EVAPORATION<a name='6333'></font>
<a name='6334'>
	REAL DTIMEG(NKR),DTIMEH(NKR) <a name='6335'>
       <a name='6336'>
	REAL DEL2D(ICEMAX),DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='6337'>
<a name='6338'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='6339'></font>
<a name='6340'>
     &amp;           ,DTIMEI_1(NKR),DTIMEI_2(NKR),DTIMEI_3(NKR) &amp;<a name='6341'>
     &amp;           ,SFNI1(ICEMAX),SFNI2(ICEMAX) &amp;<a name='6342'>
     &amp;           ,TIMESTEPD(NKR) &amp;<a name='6343'>
     &amp;           ,FI1REF(NKR),PSI1REF(NKR) &amp;<a name='6344'>
     &amp;           ,FI2REF(NKR,ICEMAX),PSI2REF(NKR,ICEMAX)&amp;<a name='6345'>
     &amp;           ,FCCNRREF(NKR)<a name='6346'>
<a name='6347'>
<a name='6348'>
	OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='6349'>
	OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='6350'>
<a name='6351'>
        DATA AL1 /2500./, AL2 /2834./, D /0.211/ &amp;<a name='6352'>
     &amp;      ,GAM /1.E-4/, POD /10./ <a name='6353'>
           <a name='6354'>
	DATA RV_MY,CF_MY,D_MYIN,AL1_MY,AL2_MY &amp;<a name='6355'>
     &amp;      /461.5,0.24E-1,0.211E-4,2.5E6,2.834E6/<a name='6356'>
<a name='6357'>
	DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='6358'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='6359'>
<a name='6360'>
	DATA TPC1, TPC2, TPC3, TPC4, TPC5 &amp;<a name='6361'>
     &amp;      /-4.0,-8.1,-12.7,-17.8,-22.4/ <a name='6362'>
<a name='6363'>
<a name='6364'>
        DATA EPSDEL/0.1E-03/<a name='6365'>
    <a name='6366'>
	DATA DT0L, DT0I /1.E20,1.E20/<a name='6367'>
<a name='6368'>
<font color=#447700>! CONTROL OF DROP SPECTRUM IN SUBROUTINE ONECOND<a name='6369'></font>
<a name='6370'>
<a name='6371'>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS IN MIXED PHASE: EVAPORATION<a name='6372'></font>
        <a name='6373'>
        I_MIXCOND=0<a name='6374'>
        I_MIXEVAP=0<a name='6375'>
        I_ABERGERON=0<a name='6376'>
        I_BERGERON=0<a name='6377'>
<font color=#447700>! SOME CONSTANTS <a name='6378'></font>
        COL3=3.0*COL<a name='6379'>
        ICM=ICEMAX<a name='6380'>
        ITIME=0<a name='6381'>
        KCOND=0<a name='6382'>
        DT_WATER_COND=0.4<a name='6383'>
        DT_WATER_EVAP=0.4<a name='6384'>
        DT_ICE_COND=0.4<a name='6385'>
        DT_ICE_EVAP=0.4<a name='6386'>
        DT_MIX_COND=0.4<a name='6387'>
        DT_MIX_EVAP=0.4<a name='6388'>
        DT_MIX_BERGERON=0.4<a name='6389'>
        DT_MIX_ANTIBERGERON=0.4<a name='6390'>
	ICM=ICEMAX<a name='6391'>
	ITIME=0<a name='6392'>
	KCOND=0<a name='6393'>
        DT0LREF=0.2<a name='6394'>
        DTLREF=0.4<a name='6395'>
<a name='6396'>
	NR=NKR<a name='6397'>
	NRM=NKR-1<a name='6398'>
	DT=DTCOND<a name='6399'>
	DTT=DTCOND<a name='6400'>
	XRAD=0.<a name='6401'>
<a name='6402'>
<font color=#447700>!     BARRY<a name='6403'></font>
	CWHUCM=0.<a name='6404'>
	XRAD=0.<a name='6405'>
	B6=CWHUCM*GAM-XRAD<a name='6406'>
	B8L=1./ROR<a name='6407'>
	B8I=1./ROR<a name='6408'>
        RORI=1./ROR<a name='6409'>
<a name='6410'>
<font color=#447700>! INITIALIZATION OF SOME ARRAYS<a name='6411'></font>
<a name='6412'>
<font color=#447700>!       BARRY<a name='6413'></font>
        TPN=TT<a name='6414'>
        QPN=QQ<a name='6415'>
<a name='6416'>
<a name='6417'>
<font color=#447700>! TYPE OF ICE IN DIFFUSIONAL GROWTH <a name='6418'></font>
<a name='6419'>
	      DO ICE=1,ICEMAX<a name='6420'>
	         SFNI1(ICE)=0.<a name='6421'>
	         SFNI2(ICE)=0.<a name='6422'>
	         DEL2D(ICE)=0.<a name='6423'>
	      ENDDO<a name='6424'>
<a name='6425'>
<font color=#447700>! TIME SPLITTING <a name='6426'></font>
<a name='6427'>
	      TIMENEW=0.<a name='6428'>
	      ITIME=0<a name='6429'>
<a name='6430'>
<font color=#447700>! ONLY ICE (CONDENSATION OR EVAPORATION) :<a name='6431'></font>
<a name='6432'>
   46         ITIME=ITIME+1<a name='6433'>
<a name='6434'>
	      TIMEREV=DT-TIMENEW<a name='6435'>
<a name='6436'>
	      DEL1=DEL1N<a name='6437'>
	      DEL2=DEL2N<a name='6438'>
	      DEL1S=DEL1N<a name='6439'>
	      DEL2S=DEL2N<a name='6440'>
	      DEL2D(1)=DEL2N<a name='6441'>
	      DEL2D(2)=DEL2N<a name='6442'>
	      DEL2D(3)=DEL2N<a name='6443'>
	      TPS=TPN<a name='6444'>
	      QPS=QPN<a name='6445'>
              DO KR=1,NKR<a name='6446'>
                 FI3(KR)=PSI3(KR)<a name='6447'>
                 FI4(KR)=PSI4(KR)<a name='6448'>
                 FI5(KR)=PSI5(KR)<a name='6449'>
                 DO ICE=1,ICEMAX<a name='6450'>
                    FI2(KR,ICE)=PSI2(KR,ICE)<a name='6451'>
                 ENDDO<a name='6452'>
              ENDDO<a name='6453'>
<font color=#447700>! TIME-STEP GROWTH RATE: <a name='6454'></font>
<font color=#447700>! ONLY ICE (CONDENSATION OR EVAPORATION)<a name='6455'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_2">(R2,TPS,PP,ROR,VR2,PSINGLE &amp;<a name='6456'>
     &amp;                    ,RIEC,RO2BL,B21_MY,B22_MY,3,2,ICEMAX,NKR)   <a name='6457'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_3">(R3,TPS,PP,ROR,VR3,PSINGLE &amp;<a name='6458'>
     &amp;                    ,RSEC,RO3BL,B31_MY,B32_MY,1,2,ICEMAX,NKR)<a name='6459'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_4">(R4,TPS,PP,ROR,VR4,PSINGLE &amp;<a name='6460'>
     &amp;                    ,RGEC,RO4BL,B41_MY,B42_MY,1,2,ICEMAX,NKR)<a name='6461'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_5">(R5,TPS,PP,ROR,VR5,PSINGLE &amp;<a name='6462'>
     &amp;                    ,RHEC,RO5BL,B51_MY,B52_MY,1,2,ICEMAX,NKR)<a name='6463'>
<a name='6464'>
<a name='6465'>
<font color=#447700>! INTEGRALS IN DELTA EQUATION<a name='6466'></font>
<a name='6467'>
<font color=#447700>! CALL JERTIMESC CRYSTAL - 1 (ONLY ICE)<a name='6468'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC_ICE'>JERTIMESC_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_ICE_1">  &amp;<a name='6469'>
     &amp;       (FI2,R2,SFNI1,SFNI2,B21_MY,B22_MY,RIEC,B8I,ICM,COL,NKR) <a name='6470'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_2"> &amp;<a name='6471'>
     &amp;       (FI3,R3,SFN31,SFN32,B31_MY,B32_MY,RSEC,B8I,1,COL,NKR)  <a name='6472'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_3"> &amp;<a name='6473'>
     &amp;       (FI4,R4,SFN41,SFN42,B41_MY,B42_MY,RGEC,B8I,1,COL,NKR) <a name='6474'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_4"> &amp;<a name='6475'>
     &amp;       (FI5,R5,SFN51,SFN52,B51_MY,B52_MY,RHEC,B8I,1,COL,NKR)<a name='6476'>
	      SFNII1=SFNI1(1)+SFNI1(2)+SFNI1(3)<a name='6477'>
	      SFNII2=SFNI2(1)+SFNI2(2)+SFNI2(3)<a name='6478'>
	      SFN21=SFNII1+SFN31+SFN41+SFN51        <a name='6479'>
	      SFN22=SFNII2+SFN32+SFN42+SFN52 <a name='6480'>
	      SFNL=0.<a name='6481'>
	      SFNI=SFN21+SFN22       <a name='6482'>
<font color=#447700>! SOME CONSTANTS <a name='6483'></font>
	      B5L=BB1_MY/TPS/TPS<a name='6484'>
	      B5I=BB2_MY/TPS/TPS<a name='6485'>
              B7L=B5L*B6                                                     <a name='6486'>
              B7I=B5I*B6<a name='6487'>
	      DOPL=1.+DEL1S                                                     <a name='6488'>
	      DOPI=1.+DEL2S                                                     <a name='6489'>
	      OPERQ=OPER2(QPS)  <a name='6490'>
              RW=(OPERQ+B5L*AL1)*DOPL*SFNL                                      <a name='6491'>
              QW=B7L*DOPL<a name='6492'>
              PW=(OPERQ+B5I*AL1)*DOPI*SFNL<a name='6493'>
              RI=(OPERQ+B5L*AL2)*DOPL*SFNI<a name='6494'>
              PI=(OPERQ+B5I*AL2)*DOPI*SFNI<a name='6495'>
              QI=B7I*DOPI<a name='6496'>
	      KCOND=20<a name='6497'>
	      IF(DEL2.GT.0) KCOND=21<a name='6498'>
<a name='6499'>
<font color=#447700>! PROCESS'S TYPE (ONLY ICE) <a name='6500'></font>
<a name='6501'>
	      IF(KCOND.EQ.21)  THEN<a name='6502'>
<a name='6503'>
<font color=#447700>! ONLY_ICE: CONDENSATION<a name='6504'></font>
<a name='6505'>
	      <a name='6506'>
                DT0I=1.E20<a name='6507'>
	        DTNEWI1=DTCOND<a name='6508'>
	        DTNEWL=DTNEWI1<a name='6509'>
	        IF(ITIME.GE.NKR) THEN<a name='6510'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_759">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='6511'>
	        ENDIF<a name='6512'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='6513'>
<font color=#447700>! NEW TIME STEP (ONLY_ICE: CONDENSATION)<a name='6514'></font>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='6515'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='6516'>
     &amp;          DTNEWL=DT-TIMENEW<a name='6517'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='6518'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='6519'>
	        TIMENEW=TIMENEW+DTNEWL<a name='6520'>
	        DTT=DTNEWL<a name='6521'>
<font color=#447700>! SOLVING FOR SUPERSATURATION (ONLY ICE: CONDENSATION) <a name='6522'></font>
<a name='6523'>
<font color=#447700>! CALL JERSUPSAT - 4 (ONLY ICE: CONDENSATION)<a name='6524'></font>
<a name='6525'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_3">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='6526'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='6527'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='6528'>
<a name='6529'>
<font color=#447700>! END OF "NEW SUPERSATURATION" (ONLY ICE: CONDENSATION)<a name='6530'></font>
<a name='6531'>
<a name='6532'>
<font color=#447700>! CRYSTALS (ONLY ICE: CONDENSATION) <a name='6533'></font>
<a name='6534'>
	        IF(ISYM2.NE.0) THEN<a name='6535'>
<a name='6536'>
<font color=#447700>! CRYSTAL DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='6537'></font>
 <a name='6538'>
<font color=#447700>! CALL JERDFUN CRYSTAL - 1 (ONLY ICE: CONDENSATION)<a name='6539'></font>
<a name='6540'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='6541'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_3">(R2,B21_MY,B22_MY &amp;<a name='6542'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='6543'>
     &amp;                        ,ICM,1,COL,NKR,TPN)<a name='6544'>
<a name='6545'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_4">(R2,B21_MY,B22_MY &amp;<a name='6546'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='6547'>
     &amp;                        ,ICM,2,COL,NKR,TPN)<a name='6548'>
<a name='6549'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_5">(R2,B21_MY,B22_MY &amp;<a name='6550'>
     &amp;                        ,FI2,PSI2,D2N &amp;<a name='6551'>
     &amp;                        ,ICM,3,COL,NKR,TPN)<a name='6552'>
<font color=#447700>! IN CASE : ISYM2.NE.0<a name='6553'></font>
<a name='6554'>
	        ENDIF<a name='6555'>
<font color=#447700>! SNOW <a name='6556'></font>
	        IF(ISYM3.NE.0) THEN<a name='6557'>
<a name='6558'>
<font color=#447700>! SNOW DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='6559'></font>
                                                         <a name='6560'>
<a name='6561'>
<font color=#447700>! CALL JERDFUN SNOW - 1 (ONLY ICE: CONDENSATION)<a name='6562'></font>
                  CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_6">(R3,B31_MY,B32_MY &amp;<a name='6563'>
     &amp;                        ,FI3,PSI3,D2N &amp;<a name='6564'>
     &amp;                        ,1,3,COL,NKR,TPN)<a name='6565'>
<a name='6566'>
	        ENDIF<a name='6567'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='6568'></font>
<font color=#447700>! GRAUPELS (ONLY_ICE: EVAPORATION)<a name='6569'></font>
<a name='6570'>
                IF(ISYM4.NE.0) THEN<a name='6571'>
<a name='6572'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION)<a name='6573'></font>
<a name='6574'>
                  CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_7">(R4,B41_MY,B42_MY &amp;<a name='6575'>
     &amp;                        ,FI4,PSI4,D2N &amp;<a name='6576'>
     &amp;                        ,1,4,COL,NKR,TPN)<a name='6577'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='6578'></font>
<a name='6579'>
                ENDIF<a name='6580'>
<a name='6581'>
<a name='6582'>
<a name='6583'>
<font color=#447700>! HAIL (ONLY ICE: CONDENSATION) <a name='6584'></font>
<a name='6585'>
	        IF(ISYM5.NE.0) THEN<a name='6586'>
<a name='6587'>
<font color=#447700>! HAIL DTRIBUTION FUNCTION (ONLY ICE: CONDENSATION) <a name='6588'></font>
                                                         <a name='6589'>
<font color=#447700>! CALL JERDFUN HAIL - 1 (ONLY ICE: CONDENSATION) <a name='6590'></font>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_8">(R5,B51_MY,B52_MY &amp;<a name='6591'>
     &amp;                        ,FI5,PSI5,D2N &amp;<a name='6592'>
     &amp;                        ,1,5,COL,NKR,TPN)<a name='6593'>
<font color=#447700>! IN CASE : ISYM5.NE.0<a name='6594'></font>
<a name='6595'>
	        ENDIF<a name='6596'>
<a name='6597'>
	        IF((DEL2.GT.0.AND.DEL2N.LT.0) &amp;<a name='6598'>
     &amp;         .AND.ABS(DEL2N).GT.EPSDEL) THEN<a name='6599'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_760">("fatal error in module_mp_fast_sbm (DEL2.GT.0.AND.DEL2N.LT.0), model stop")<a name='6600'>
                ENDIF<a name='6601'>
<a name='6602'>
	      ELSE<a name='6603'>
<a name='6604'>
<font color=#447700>! IN CASE KCOND.NE.21 <a name='6605'></font>
<a name='6606'>
<font color=#447700>! ONLY ICE: EVAPORATION  <a name='6607'></font>
<a name='6608'>
<font color=#447700>! NEW TREATMENT OF TIME STEP (ONLY ICE: EVAPORATION) <a name='6609'></font>
<a name='6610'>
	        DT0I=1.E20<a name='6611'>
                IF (DEL2N.EQ.0)THEN<a name='6612'>
	          DTNEWL=DT<a name='6613'>
                ELSE<a name='6614'>
	         DTNEWI3=-R3(3)/(B31_MY(3)*DEL2N-B32_MY(3))<a name='6615'>
	         DTNEWI4=-R4(3)/(B41_MY(3)*DEL2N-B42_MY(3))<a name='6616'>
	         DTNEWI5=-R5(3)/(B51_MY(3)*DEL2N-B52_MY(3))<a name='6617'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='6618'></font>
	         DTNEWI2_1=-R2(3,1)/(B21_MY(1,1)*DEL2N-B22_MY(1,1))<a name='6619'>
	         DTNEWI2_2=-R2(3,2)/(B21_MY(1,2)*DEL2N-B22_MY(1,2))<a name='6620'>
	         DTNEWI2_3=-R2(3,3)/(B21_MY(1,3)*DEL2N-B22_MY(1,3))<a name='6621'>
                 DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='6622'>
	         DTNEWI1=AMIN1(DTNEWI2,DTNEWI3,DTNEWI4 &amp;<a name='6623'>
     &amp;                       ,DTNEWI5,DT0I,TIMEREV)<a name='6624'>
	         DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I,TIMEREV)<a name='6625'>
	         DTNEWL=DTNEWI1<a name='6626'>
	         IF(DTNEWL.LT.DTLREF) DTNEWL=AMIN1(DTLREF,TIMEREV)<a name='6627'>
                END IF<a name='6628'>
	        IF(ITIME.GE.NKR) THEN<a name='6629'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_761">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='6630'>
                ENDIF<a name='6631'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='6632'>
<a name='6633'>
<font color=#447700>! NEW TIME STEP (ONLY_ICE: EVAPORATION)<a name='6634'></font>
<a name='6635'>
	        IF(DTNEWL.GT.DT) DTNEWL=DT<a name='6636'>
	        IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1))  &amp;<a name='6637'>
     &amp;          DTNEWL=DT-TIMENEW<a name='6638'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='6639'>
	        TIMENEW=TIMENEW+DTNEWL<a name='6640'>
	        TIMESTEPD(ITIME)=DTNEWL<a name='6641'>
	        DTT=DTNEWL<a name='6642'>
<font color=#447700>! SOLVING FOR SUPERSATURATION (ONLY_ICE: EVAPORATION) <a name='6643'></font>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_4">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='6644'>
     &amp;                        ,RW,PW,RI,PI,QW,QI &amp;<a name='6645'>
     &amp;                        ,DTT,D1N,D2N,DT0L0,DT0I0)<a name='6646'>
<font color=#447700>! END OF "NEW SUPERSATURATION" (ONLY_ICE: EVAPORATION) <a name='6647'></font>
<a name='6648'>
<font color=#447700>! CRYSTALS<a name='6649'></font>
	        IF(ISYM2.NE.0) THEN<a name='6650'>
<a name='6651'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='6652'></font>
<a name='6653'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE) <a name='6654'></font>
<a name='6655'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_9">(R2,B21_MY,B22_MY &amp;<a name='6656'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='6657'>
     &amp;                         ,ICM,1,COL,NKR,TPN)<a name='6658'>
<a name='6659'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_10">(R2,B21_MY,B22_MY &amp;<a name='6660'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='6661'>
     &amp;                         ,ICM,2,COL,NKR,TPN)<a name='6662'>
<a name='6663'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_11">(R2,B21_MY,B22_MY &amp;<a name='6664'>
     &amp;                         ,FI2,PSI2,D2N &amp;<a name='6665'>
     &amp;                         ,ICM,3,COL,NKR,TPN)<a name='6666'>
	        ENDIF<a name='6667'>
<font color=#447700>! SNOW <a name='6668'></font>
	        IF(ISYM3.NE.0) THEN<a name='6669'>
<a name='6670'>
<font color=#447700>! SNOW DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='6671'></font>
                                                         <a name='6672'>
<a name='6673'>
<font color=#447700>! CALL JERDFUN - SNOW - 2 (ONLY_ICE: EVAPORATION)<a name='6674'></font>
<a name='6675'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_12">(R3,B31_MY,B32_MY &amp;<a name='6676'>
     &amp;                        ,FI3,PSI3,D2N &amp;<a name='6677'>
     &amp;                        ,1,3,COL,NKR,TPN)<a name='6678'>
<a name='6679'>
<a name='6680'>
<a name='6681'>
<a name='6682'>
<a name='6683'>
<font color=#447700>! IN CASE : ISYM3.NE.0<a name='6684'></font>
<a name='6685'>
	        ENDIF<a name='6686'>
<a name='6687'>
<font color=#447700>! GRAUPELS (ONLY_ICE: EVAPORATION) <a name='6688'></font>
<a name='6689'>
	        IF(ISYM4.NE.0) THEN<a name='6690'>
<a name='6691'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='6692'></font>
                                                         <a name='6693'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_13">(R4,B41_MY,B42_MY &amp;<a name='6694'>
     &amp;                        ,FI4,PSI4,D2N &amp;<a name='6695'>
     &amp;                        ,1,4,COL,NKR,TPN)<a name='6696'>
<font color=#447700>! IN CASE : ISYM4.NE.0<a name='6697'></font>
<a name='6698'>
	        ENDIF<a name='6699'>
<a name='6700'>
<font color=#447700>! HAIL (ONLY_ICE: EVAPORATION) <a name='6701'></font>
<a name='6702'>
	        IF(ISYM5.NE.0) THEN<a name='6703'>
<a name='6704'>
<font color=#447700>! HAIL DISTRIBUTION FUNCTION (ONLY_ICE: EVAPORATION) <a name='6705'></font>
                                                         <a name='6706'>
	          CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_14">(R5,B51_MY,B52_MY &amp;<a name='6707'>
     &amp;                        ,FI5,PSI5,D2N &amp;<a name='6708'>
     &amp;                        ,1,5,COL,NKR,TPN)<a name='6709'>
<font color=#447700>! IN CASE : ISYM5.NE.0<a name='6710'></font>
<a name='6711'>
	        ENDIF<a name='6712'>
<a name='6713'>
	        IF((DEL2.LT.0.AND.DEL2N.GT.0) &amp;<a name='6714'>
     &amp;         .AND.ABS(DEL2N).GT.EPSDEL) THEN<a name='6715'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_762">("fatal error in module_mp_fast_sbm (ABS(DEL2N).GT.EPSDEL), model stop")<a name='6716'>
	        ENDIF<a name='6717'>
<a name='6718'>
<font color=#447700>! IN CASE : KCOND.NE.21<a name='6719'></font>
 <a name='6720'>
	      ENDIF<a name='6721'>
<a name='6722'>
<font color=#447700>! IN CASES : KCOND = 21 OR KCOND.NE.21<a name='6723'></font>
<a name='6724'>
<font color=#447700>! END OF "PROCESS'S TYPE" <a name='6725'></font>
<font color=#447700>!<a name='6726'></font>
<font color=#447700>! MASSES<a name='6727'></font>
              RMASSIBB=0.0<a name='6728'>
              RMASSIAA=0.0<a name='6729'>
<font color=#447700>! BEFORE JERNEWF<a name='6730'></font>
              DO K=1,NKR<a name='6731'>
                 DO ICE =1,ICEMAX<a name='6732'>
                    FI2_K=FI2(K,ICE)<a name='6733'>
                    R2_K=R2(K,ICE)<a name='6734'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='6735'>
                    RMASSIBB=RMASSIBB+FI2R2<a name='6736'>
                 ENDDO<a name='6737'>
                 FI3_K=FI3(K)<a name='6738'>
                 FI4_K=FI4(K)<a name='6739'>
                 FI5_K=FI5(K)<a name='6740'>
                 R3_K=R3(K)<a name='6741'>
                 R4_K=R4(K)<a name='6742'>
                 R5_K=R5(K)<a name='6743'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='6744'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='6745'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='6746'>
                 RMASSIBB=RMASSIBB+FI3R3<a name='6747'>
                 RMASSIBB=RMASSIBB+FI4R4<a name='6748'>
                 RMASSIBB=RMASSIBB+FI5R5<a name='6749'>
              ENDDO<a name='6750'>
              RMASSIBB=RMASSIBB*COL3*RORI<a name='6751'>
<font color=#447700>! NEW CHANGE RMASSIBB<a name='6752'></font>
              IF(RMASSIBB.LT.0.0) RMASSIBB=0.0<a name='6753'>
<font color=#447700>! AFTER JERNEWF<a name='6754'></font>
              DO K=1,NKR<a name='6755'>
                 DO ICE =1,ICEMAX<a name='6756'>
                    FI2_K=PSI2(K,ICE)<a name='6757'>
                    R2_K=R2(K,ICE)<a name='6758'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='6759'>
                    RMASSIAA=RMASSIAA+FI2R2<a name='6760'>
                 ENDDO<a name='6761'>
                 FI3_K=PSI3(K)<a name='6762'>
                 FI4_K=PSI4(K)<a name='6763'>
                 FI5_K=PSI5(K)<a name='6764'>
                 R3_K=R3(K)<a name='6765'>
                 R4_K=R4(K)<a name='6766'>
                 R5_K=R5(K)<a name='6767'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='6768'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='6769'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='6770'>
                 RMASSIAA=RMASSIAA+FI3R3<a name='6771'>
                 RMASSIAA=RMASSIAA+FI4R4<a name='6772'>
                 RMASSIAA=RMASSIAA+FI5R5<a name='6773'>
              ENDDO<a name='6774'>
              RMASSIAA=RMASSIAA*COL3*RORI<a name='6775'>
<font color=#447700>! NEW CHANGE RMASSIAA<a name='6776'></font>
              IF(RMASSIAA.LT.0.0) RMASSIAA=0.0<a name='6777'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='6778'></font>
              DELMASSI1=RMASSIAA-RMASSIBB<a name='6779'>
              QPN=QPS-DELMASSI1<a name='6780'>
              DAL2=AL2<a name='6781'>
              TPN=TPS+DAL2*DELMASSI1<a name='6782'>
<font color=#447700>! SUPERSATURATION<a name='6783'></font>
              ARGEXP=-BB1_MY/TPN<a name='6784'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='6785'>
              ARGEXP=-BB2_MY/TPN<a name='6786'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='6787'>
              EW1N=OPER3(QPN,PP)<a name='6788'>
              IF(ES1N.EQ.0)THEN<a name='6789'>
               DEL1N=0.5<a name='6790'>
               DIV1=1.5<a name='6791'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_763">("fatal error in module_mp_fast_sbm (ES1N.EQ.0), model stop")<a name='6792'>
              ELSE<a name='6793'>
               DIV1=EW1N/ES1N<a name='6794'>
               DEL1N=EW1N/ES1N-1.<a name='6795'>
              END IF<a name='6796'>
              IF(ES2N.EQ.0)THEN<a name='6797'>
               DEL2N=0.5<a name='6798'>
               DIV2=1.5<a name='6799'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_764">("fatal error in module_mp_fast_sbm (ES2N.EQ.0), model stop")<a name='6800'>
              ELSE<a name='6801'>
               DEL2N=EW1N/ES2N-1.<a name='6802'>
               DIV2=EW1N/ES2N<a name='6803'>
              END IF<a name='6804'>
<a name='6805'>
<font color=#447700>!  END OF TIME SPLITTING <a name='6806'></font>
<font color=#447700>! (ONLY ICE: CONDENSATION OR EVAPORATION) <a name='6807'></font>
	      IF(TIMENEW.LT.DT) GOTO 46<a name='6808'>
        TT=TPN<a name='6809'>
        QQ=QPN<a name='6810'>
	DO KR=1,NKR<a name='6811'>
	   DO ICE=1,ICEMAX<a name='6812'>
	      FF2(KR,ICE)=PSI2(KR,ICE)<a name='6813'>
	   ENDDO<a name='6814'>
	   FF3(KR)=PSI3(KR)<a name='6815'>
	   FF4(KR)=PSI4(KR)<a name='6816'>
	   FF5(KR)=PSI5(KR)<a name='6817'>
	ENDDO<a name='6818'>
<a name='6819'>
<a name='6820'>
<font color=#447700>! GO TO "CONDENSATION AND VAPORATION"<a name='6821'></font>
<a name='6822'>
<a name='6823'>
        RETURN                                          <a name='6824'>
        END SUBROUTINE ONECOND2<a name='6825'>
<font color=#447700>!==================================================================<a name='6826'></font>
<a name='6827'>
<A NAME='ONECOND3'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#ONECOND3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='6828'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>ONECOND3</font> &amp; <A href='../../call_to/ONECOND3.html' TARGET='index'>2</A>,<A href='../../call_from/ONECOND3.html' TARGET='index'>44</A><a name='6829'>
     &amp; (TT,QQ,PP,ROR &amp;<a name='6830'>
     &amp; ,VR1,VR2,VR3,VR4,VR5,PSINGLE &amp;<a name='6831'>
     &amp; ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6832'>
     &amp; ,FF1,PSI1,R1,RLEC,RO1BL &amp;<a name='6833'>
     &amp; ,FF2,PSI2,R2,RIEC,RO2BL &amp;<a name='6834'>
     &amp; ,FF3,PSI3,R3,RSEC,RO3BL &amp;<a name='6835'>
     &amp; ,FF4,PSI4,R4,RGEC,RO4BL &amp;<a name='6836'>
     &amp; ,FF5,PSI5,R5,RHEC,RO5BL &amp;<a name='6837'>
     &amp; ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6838'>
     &amp; ,C1_MEY,C2_MEY &amp;<a name='6839'>
     &amp; ,COL,DTCOND,ICEMAX,NKR &amp;<a name='6840'>
     &amp; ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5)<a name='6841'>
       IMPLICIT NONE<a name='6842'>
       INTEGER ICEMAX,NKR,KR,ITIME,ICE,KCOND,K &amp;<a name='6843'>
     &amp;           ,ISYM1,ISYM2,ISYM3,ISYM4,ISYM5<a name='6844'>
       INTEGER KLIMITL,KLIMITG,KLIMITH,KLIMITI_1, &amp;<a name='6845'>
     &amp;  KLIMITI_2,KLIMITI_3<a name='6846'>
       INTEGER I_MIXCOND,I_MIXEVAP,I_ABERGERON,I_BERGERON  <a name='6847'>
       REAL ROR,VR1(NKR),VR2(NKR,ICEMAX),VR3(NKR),VR4(NKR) &amp;<a name='6848'>
     &amp;           ,VR5(NKR),PSINGLE &amp;<a name='6849'>
     &amp;           ,AA1_MY,BB1_MY,AA2_MY,BB2_MY &amp;<a name='6850'>
     &amp;           ,C1_MEY,C2_MEY &amp;<a name='6851'>
     &amp;           ,COL,DTCOND<a name='6852'>
<a name='6853'>
<font color=#447700>! DROPLETS <a name='6854'></font>
                                                                       <a name='6855'>
        REAL R1(NKR)&amp;<a name='6856'>
     &amp;           ,RLEC(NKR),RO1BL(NKR) &amp;<a name='6857'>
     &amp;           ,FI1(NKR),FF1(NKR),PSI1(NKR) &amp;<a name='6858'>
     &amp;           ,B11_MY(NKR),B12_MY(NKR)<a name='6859'>
<a name='6860'>
<font color=#447700>! CRYSTALS<a name='6861'></font>
                                                                       <a name='6862'>
	REAL R2(NKR,ICEMAX) &amp;<a name='6863'>
     &amp;           ,RIEC(NKR,ICEMAX) &amp;<a name='6864'>
     &amp;           ,RO2BL(NKR,ICEMAX) &amp;<a name='6865'>
     &amp;           ,FI2(NKR,ICEMAX),PSI2(NKR,ICEMAX) &amp;<a name='6866'>
     &amp;           ,FF2(NKR,ICEMAX) &amp;<a name='6867'>
     &amp;           ,B21_MY(NKR,ICEMAX),B22_MY(NKR,ICEMAX) &amp;<a name='6868'>
     &amp;           ,RATE2(NKR,ICEMAX),DEL_R2M(NKR,ICEMAX)<a name='6869'>
<a name='6870'>
<font color=#447700>! SNOW                                                                          <a name='6871'></font>
        REAL R3(NKR) &amp;<a name='6872'>
     &amp;           ,RSEC(NKR),RO3BL(NKR) &amp;<a name='6873'>
     &amp;           ,FI3(NKR),FF3(NKR),PSI3(NKR) &amp;<a name='6874'>
     &amp;           ,B31_MY(NKR),B32_MY(NKR) &amp;<a name='6875'>
     &amp;           ,DEL_R3M(NKR)  <a name='6876'>
<a name='6877'>
<font color=#447700>! GRAUPELS <a name='6878'></font>
                                                                       <a name='6879'>
        REAL R4(NKR),R4N(NKR) &amp;<a name='6880'>
     &amp;           ,RGEC(NKR),RO4BL(NKR) &amp;<a name='6881'>
     &amp;           ,FI4(NKR),FF4(NKR),PSI4(NKR) &amp;<a name='6882'>
     &amp;           ,B41_MY(NKR),B42_MY(NKR) &amp;<a name='6883'>
     &amp;           ,DEL_R4M(NKR)<a name='6884'>
<a name='6885'>
<font color=#447700>! HAIL                                                                          <a name='6886'></font>
        REAL R5(NKR),R5N(NKR) &amp;<a name='6887'>
     &amp;           ,RHEC(NKR),RO5BL(NKR) &amp;<a name='6888'>
     &amp;           ,FI5(NKR),FF5(NKR),PSI5(NKR) &amp;<a name='6889'>
     &amp;           ,B51_MY(NKR),B52_MY(NKR) &amp;<a name='6890'>
     &amp;           ,DEL_R5M(NKR)<a name='6891'>
<a name='6892'>
      DOUBLE PRECISION DD1N,DB11_MY,DAL1,DAL2<a name='6893'>
      DOUBLE PRECISION COL3,RORI,TPN,TPS,QPN,QPS,TOLD,QOLD &amp;<a name='6894'>
     &amp;                  ,FI1_K,FI2_K,FI3_K,FI4_K,FI5_K &amp;<a name='6895'>
     &amp;                  ,R1_K,R2_K,R3_K,R4_K,R5_K &amp;<a name='6896'>
     &amp;                  ,FI1R1,FI2R2,FI3R3,FI4R4,FI5R5 &amp;<a name='6897'>
     &amp;                  ,RMASSLAA,RMASSLBB,RMASSIAA,RMASSIBB &amp;<a name='6898'>
     &amp;                  ,ES1N,ES2N,EW1N,ARGEXP &amp;<a name='6899'>
     &amp;                  ,TT,QQ,PP,DEL1N0,DEL2N0 &amp;<a name='6900'>
     &amp;                  ,DEL1N,DEL2N,DIV1,DIV2 &amp;<a name='6901'>
     &amp;                  ,OPER2,OPER3,AR1,AR2<a name='6902'>
<a name='6903'>
       DOUBLE PRECISION DELTAQ1,DELMASSI1,DELMASSL1<a name='6904'>
<a name='6905'>
       REAL A1_MYN, BB1_MYN, A2_MYN, BB2_MYN<a name='6906'>
        DATA A1_MYN, BB1_MYN, A2_MYN, BB2_MYN &amp;<a name='6907'>
     &amp;      /2.53,5.42,3.41E1,6.13/<a name='6908'>
       REAL B8L,B8I,SFN11,SFN12,SFNL,SFNI<a name='6909'>
       REAL B5L,B5I,B7L,B7I,B6,DOPL,DEL1S,DEL2S,DOPI,RW,QW,PW, &amp;<a name='6910'>
     &amp;  RI,PI,QI,SFNI1(ICEMAX),SFNI2(ICEMAX),AL1,AL2<a name='6911'>
       REAL D1N,D2N,DT0L, DT0I,D1N0,D2N0<a name='6912'>
       REAL SFN21,SFN22,SFNII1,SFNII2,SFN31,SFN32,SFN41,SFN42,SFN51, &amp;<a name='6913'>
     &amp;  SFN52<a name='6914'>
       REAL DEL1,DEL2<a name='6915'>
       REAL  TIMEREV,DT,DTT,TIMENEW<a name='6916'>
       REAL DTIMEG(NKR),DTIMEH(NKR)<a name='6917'>
<a name='6918'>
       REAL DEL2D(ICEMAX),DTIMEO(NKR),DTIMEL(NKR) &amp;<a name='6919'>
     &amp;           ,DTIMEI_1(NKR),DTIMEI_2(NKR),DTIMEI_3(NKR)<a name='6920'>
       REAL DT_WATER_COND,DT_WATER_EVAP,DT_ICE_COND,DT_ICE_EVAP, &amp;<a name='6921'>
     &amp;  DT_MIX_COND,DT_MIX_EVAP,DT_MIX_BERGERON,DT_MIX_ANTIBERGERON<a name='6922'>
       REAL DTNEWL0,DTNEWL1,DTNEWI1,DTNEWI2_1,DTNEWI2_2,DTNEWI2_3, &amp;<a name='6923'>
     &amp; DTNEWI2,DTNEWI_1,DTNEWI_2,DTNEWI3,DTNEWI4,DTNEWI5, &amp;<a name='6924'>
     &amp; DTNEWL,DTNEWL2,DTNEWG1,DTNEWH1<a name='6925'>
       REAL TIMESTEPD(NKR)<a name='6926'>
<a name='6927'>
       DATA AL1 /2500./, AL2 /2834./<a name='6928'>
       REAL EPSDEL,EPSDEL2<a name='6929'>
       DATA EPSDEL, EPSDEL2 /0.1E-03,0.1E-03/<a name='6930'>
       OPER2(AR1)=0.622/(0.622+0.378*AR1)/AR1<a name='6931'>
       OPER3(AR1,AR2)=AR1*AR2/(0.622+0.378*AR1)<a name='6932'>
      <a name='6933'>
<font color=#447700>! BELOW<a name='6934'></font>
<font color=#447700>!<a name='6935'></font>
        DT_WATER_COND=0.4<a name='6936'>
        DT_WATER_EVAP=0.4<a name='6937'>
        DT_ICE_COND=0.4<a name='6938'>
        DT_ICE_EVAP=0.4<a name='6939'>
        DT_MIX_COND=0.4<a name='6940'>
        DT_MIX_EVAP=0.4<a name='6941'>
        DT_MIX_BERGERON=0.4<a name='6942'>
        DT_MIX_ANTIBERGERON=0.4<a name='6943'>
<a name='6944'>
        I_MIXCOND=0<a name='6945'>
        I_MIXEVAP=0<a name='6946'>
        I_ABERGERON=0<a name='6947'>
        I_BERGERON=0<a name='6948'>
<a name='6949'>
       ITIME = 0<a name='6950'>
       TIMENEW=0.<a name='6951'>
       DT=DTCOND<a name='6952'>
       DTT=DTCOND<a name='6953'>
<a name='6954'>
       B6=0.<a name='6955'>
       B8L=1./ROR<a name='6956'>
       B8I=1./ROR<a name='6957'>
<font color=#447700>! NEW CHANGES 19.04.01 (BEGIN)<a name='6958'></font>
        RORI=1.D0/ROR<a name='6959'>
<font color=#447700>! NEW CHANGES 19.04.01 (END)<a name='6960'></font>
<font color=#447700>! NEW CHANGES 19.04.01 (BEGIN)<a name='6961'></font>
        COL3=3.D0*COL<a name='6962'>
<font color=#447700>! NEW CHANGES 19.04.01 (END)<a name='6963'></font>
<a name='6964'>
<a name='6965'>
<a name='6966'>
<font color=#447700>! BARRY:DIV<a name='6967'></font>
        TPN=TT<a name='6968'>
        QPN=QQ<a name='6969'>
<font color=#447700>! HERE<a name='6970'></font>
   16         ITIME=ITIME+1<a name='6971'>
<font color=#447700>! BARRY<a name='6972'></font>
<font color=#447700>!             TPC_NEW=TPN-273.15<a name='6973'></font>
              IF((TPN-273.15).GE.-0.187) GO TO 17<a name='6974'>
              TIMEREV=DT-TIMENEW<a name='6975'>
              DEL1=DEL1N<a name='6976'>
              DEL2=DEL2N<a name='6977'>
              DEL1S=DEL1N<a name='6978'>
              DEL2S=DEL2N<a name='6979'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='6980'></font>
              DEL2D(1)=DEL2N<a name='6981'>
              DEL2D(2)=DEL2N<a name='6982'>
              DEL2D(3)=DEL2N<a name='6983'>
              TPS=TPN<a name='6984'>
              QPS=QPN<a name='6985'>
              DO KR=1,NKR<a name='6986'>
                 FI1(KR)=PSI1(KR)<a name='6987'>
                 FI3(KR)=PSI3(KR)<a name='6988'>
                 FI4(KR)=PSI4(KR)<a name='6989'>
                 FI5(KR)=PSI5(KR)<a name='6990'>
                 DO ICE=1,ICEMAX<a name='6991'>
                    FI2(KR,ICE)=PSI2(KR,ICE)<a name='6992'>
                 ENDDO<a name='6993'>
              ENDDO<a name='6994'>
<font color=#447700>! TIME-STEP GROWTH RATE<a name='6995'></font>
<font color=#447700>! HERE<a name='6996'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_6">(R1,TPS,PP,ROR,VR1,PSINGLE &amp;<a name='6997'>
     &amp;                    ,RLEC,RO1BL,B11_MY,B12_MY,1,1,ICEMAX,NKR)<a name='6998'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_7">(R2,TPS,PP,ROR,VR2,PSINGLE &amp;<a name='6999'>
     &amp;                    ,RIEC,RO2BL,B21_MY,B22_MY,3,2,ICEMAX,NKR)<a name='7000'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_8">(R3,TPS,PP,ROR,VR3,PSINGLE &amp;<a name='7001'>
     &amp;                    ,RSEC,RO3BL,B31_MY,B32_MY,1,2,ICEMAX,NKR)<a name='7002'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_9">(R4,TPS,PP,ROR,VR4,PSINGLE &amp;<a name='7003'>
     &amp;                    ,RGEC,RO4BL,B41_MY,B42_MY,1,2,ICEMAX,NKR)<a name='7004'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERRATE'>JERRATE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERRATE_10">(R5,TPS,PP,ROR,VR5,PSINGLE &amp;<a name='7005'>
     &amp;                    ,RHEC,RO5BL,B51_MY,B52_MY,1,2,ICEMAX,NKR)<a name='7006'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_5">(FI1,R1,SFN11,SFN12 &amp;<a name='7007'>
     &amp;                      ,B11_MY,B12_MY,RLEC,B8L,1,COL,NKR)<a name='7008'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC_ICE'>JERTIMESC_ICE</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_ICE_2">(FI2,R2,SFNI1,SFNI2 &amp;<a name='7009'>
     &amp;                      ,B21_MY,B22_MY,RIEC,B8I,ICEMAX,COL,NKR)<a name='7010'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_6">(FI3,R3,SFN31,SFN32 &amp;<a name='7011'>
     &amp;                      ,B31_MY,B32_MY,RSEC,B8I,1,COL,NKR)<a name='7012'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_7">(FI4,R4,SFN41,SFN42 &amp;<a name='7013'>
     &amp;                      ,B41_MY,B42_MY,RGEC,B8I,1,COL,NKR)<a name='7014'>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERTIMESC'>JERTIMESC</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERTIMESC_8">(FI5,R5,SFN51,SFN52 &amp;<a name='7015'>
     &amp;                      ,B51_MY,B52_MY,RHEC,B8I,1,COL,NKR)<a name='7016'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7017'></font>
              SFNII1=SFNI1(1)+SFNI1(2)+SFNI1(3)<a name='7018'>
              SFNII2=SFNI2(1)+SFNI2(2)+SFNI2(3)<a name='7019'>
              SFN21=SFNII1+SFN31+SFN41+SFN51<a name='7020'>
              SFN22=SFNII2+SFN32+SFN42+SFN52<a name='7021'>
              SFNL=SFN11+SFN12<a name='7022'>
              SFNI=SFN21+SFN22<a name='7023'>
<font color=#447700>! SOME CONSTANTS (QW,QI=0,since B6=0.)<a name='7024'></font>
              B5L=BB1_MY/TPS/TPS<a name='7025'>
              B5I=BB2_MY/TPS/TPS<a name='7026'>
              B7L=B5L*B6<a name='7027'>
              B7I=B5I*B6<a name='7028'>
              DOPL=1.+DEL1S<a name='7029'>
              DOPI=1.+DEL2S<a name='7030'>
              RW=(OPER2(QPS)+B5L*AL1)*DOPL*SFNL<a name='7031'>
              QW=B7L*DOPL<a name='7032'>
              PW=(OPER2(QPS)+B5I*AL1)*DOPI*SFNL<a name='7033'>
              RI=(OPER2(QPS)+B5L*AL2)*DOPL*SFNI<a name='7034'>
              PI=(OPER2(QPS)+B5I*AL2)*DOPI*SFNI<a name='7035'>
              QI=B7I*DOPI<a name='7036'>
<font color=#447700>! SOLVING FOR TIMEZERO<a name='7037'></font>
              CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_5">(DEL1,DEL2,DEL1N0,DEL2N0 &amp;<a name='7038'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='7039'>
     &amp;                      ,DTT,D1N0,D2N0,DT0L,DT0I)<a name='7040'>
<font color=#447700>! DEL1 &gt; 0, DEL2 &lt; 0    (ANTIBERGERON MIXED PHASE - KCOND=50)<a name='7041'></font>
<font color=#447700>! DEL1 &lt; 0 AND DEL2 &lt; 0 (EVAPORATION MIXED_PHASE - KCOND=30)<a name='7042'></font>
<font color=#447700>! DEL1 &gt; 0 AND DEL2 &gt; 0 (CONDENSATION MIXED PHASE - KCOND=31)<a name='7043'></font>
<font color=#447700>! DEL1 &lt; 0, DEL2 &gt; 0    (BERGERON MIXED PHASE - KCOND=32)<a name='7044'></font>
              KCOND=50<a name='7045'>
<a name='7046'>
              IF(DEL1.LT.0.AND.DEL2.LT.0) KCOND=30<a name='7047'>
              IF(DEL1.GT.0.AND.DEL2.GT.0) KCOND=31<a name='7048'>
              IF(DEL1.LT.0.AND.DEL2.GT.0) KCOND=32<a name='7049'>
              IF(KCOND.EQ.50) THEN <a name='7050'>
                I_ABERGERON=I_ABERGERON+1<a name='7051'>
                IF(DT0L.EQ.0) THEN<a name='7052'>
                  DTNEWL=DT<a name='7053'>
                ELSE<a name='7054'>
                  DTNEWL=AMIN1(DT,DT0L)<a name='7055'>
                ENDIF<a name='7056'>
<font color=#447700>! NEW TIME STEP (ANTIBERGERON MIXED PHASE)<a name='7057'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7058'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7059'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7060'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7061'>
                TIMENEW=TIMENEW+DTNEWL<a name='7062'>
                DTT=DTNEWL<a name='7063'>
                IF(ITIME.GE.NKR) THEN<a name='7064'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_765">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='7065'>
                ENDIF<a name='7066'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7067'>
<font color=#447700>! ANTIBERGERON MIXED PHASE (BEGIN)<a name='7068'></font>
<font color=#447700>! IN CASE : KCOND = 50<a name='7069'></font>
              ENDIF<a name='7070'>
              IF(KCOND.EQ.31) THEN<a name='7071'>
<font color=#447700>! CONDENSATION MIXED PHASE (BEGIN)<a name='7072'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7073'></font>
                I_MIXCOND=I_MIXCOND+1<a name='7074'>
               IF (DEL1N.EQ.0)THEN<a name='7075'>
                DTNEWL0=DT<a name='7076'>
               ELSE<a name='7077'>
                DTNEWL0=ABS(R1(ITIME)/(B11_MY(ITIME)*DEL1N- &amp;<a name='7078'>
     &amp;                                 B12_MY(ITIME)))<a name='7079'>
               END IF<a name='7080'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='7081'></font>
<a name='7082'>
               IF (DEL2N.EQ.0)THEN<a name='7083'>
                DTNEWI2_1=DT<a name='7084'>
                DTNEWI2_2=DT<a name='7085'>
                DTNEWI2_3=DT<a name='7086'>
                DTNEWI3=DT<a name='7087'>
                DTNEWI4=DT<a name='7088'>
                DTNEWI5=DT<a name='7089'>
               ELSE<a name='7090'>
                DTNEWI2_1=ABS(R2(ITIME,1)/ &amp;<a name='7091'>
     &amp;         (B21_MY(ITIME,1)*DEL2N-B22_MY(ITIME,1)))<a name='7092'>
                DTNEWI2_2=ABS(R2(ITIME,2)/ &amp;<a name='7093'>
     &amp;         (B21_MY(ITIME,2)*DEL2N-B22_MY(ITIME,2))) <a name='7094'>
                DTNEWI2_3=ABS(R2(ITIME,3)/ &amp;<a name='7095'>
     &amp;         (B21_MY(ITIME,3)*DEL2N-B22_MY(ITIME,3)))  <a name='7096'>
                DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7097'>
<a name='7098'>
                DTNEWI3=ABS(R3(ITIME)/(B31_MY(ITIME)*DEL2N- &amp;<a name='7099'>
     &amp;                                 B32_MY(ITIME)))<a name='7100'>
                DTNEWI4=ABS(R4(ITIME)/(B41_MY(ITIME)*DEL2N- &amp;<a name='7101'>
     &amp;                                 B42_MY(ITIME)))<a name='7102'>
                DTNEWI5=ABS(R5(ITIME)/(B51_MY(ITIME)*DEL2N- &amp;<a name='7103'>
     &amp;                                 B52_MY(ITIME)))<a name='7104'>
               END IF<a name='7105'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I)<a name='7106'>
                IF(DT0L.NE.0) THEN<a name='7107'>
                  IF(ABS(DT0L).LT.DT_MIX_COND) THEN<a name='7108'>
                    DTNEWL1=AMIN1(DT_MIX_COND,DTNEWL0)<a name='7109'>
                  ELSE<a name='7110'>
                    DTNEWL1=AMIN1(DT0L,DTNEWL0)<a name='7111'>
                  ENDIF<a name='7112'>
                ELSE<a name='7113'>
                  DTNEWL1=DTNEWL0<a name='7114'>
                ENDIF<a name='7115'>
                DTNEWL=AMIN1(DTNEWL1,DTNEWI1)<a name='7116'>
                IF(ITIME.GE.NKR) THEN<a name='7117'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_766">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='7118'>
                ENDIF<a name='7119'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7120'>
<font color=#447700>! NEW TIME STEP (CONDENSATION MIXED PHASE)<a name='7121'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7122'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7123'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7124'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7125'>
                TIMENEW=TIMENEW+DTNEWL<a name='7126'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7127'>
                DTT=DTNEWL<a name='7128'>
<font color=#447700>! CONDENSATION MIXED PHASE (END)<a name='7129'></font>
<font color=#447700>! IN CASE : KCOND = 31<a name='7130'></font>
              ENDIF<a name='7131'>
              IF(KCOND.EQ.30) THEN<a name='7132'>
<font color=#447700>! EVAPORATION MIXED PHASE (BEGIN)<a name='7133'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7134'></font>
                I_MIXEVAP=I_MIXEVAP+1<a name='7135'>
                DO KR=1,NKR<a name='7136'>
                   DTIMEL(KR)=0.<a name='7137'>
                   DTIMEG(KR)=0.<a name='7138'>
                   DTIMEH(KR)=0.<a name='7139'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7140'></font>
                   DTIMEI_1(KR)=0.<a name='7141'>
                   DTIMEI_2(KR)=0.<a name='7142'>
                   DTIMEI_3(KR)=0.<a name='7143'>
                ENDDO<a name='7144'>
                DO KR=1,NKR<a name='7145'>
                 IF (DEL1N.EQ.0) THEN<a name='7146'>
                   DTIMEL(KR)=DT<a name='7147'>
                   DTIMEG(KR)=DT<a name='7148'>
                   DTIMEH(KR)=DT<a name='7149'>
                 ELSE<a name='7150'>
                   DTIMEL(KR)=-R1(KR)/(B11_MY(KR)*DEL1N- &amp;<a name='7151'>
     &amp;                                 B12_MY(KR))<a name='7152'>
                   DTIMEG(KR)=-R4(KR)/(B41_MY(KR)*DEL1N- &amp;<a name='7153'>
     &amp;                                 B42_MY(KR))<a name='7154'>
                   DTIMEH(KR)=-R5(KR)/(B51_MY(KR)*DEL1N- &amp;<a name='7155'>
     &amp;                             B52_MY(KR))<a name='7156'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE)<a name='7157'></font>
                 END IF<a name='7158'>
                 IF (DEL2N.EQ.0) THEN<a name='7159'>
                   DTIMEI_1(KR)=DT<a name='7160'>
                   DTIMEI_2(KR)=DT<a name='7161'>
                   DTIMEI_3(KR)=DT<a name='7162'>
                 ELSE<a name='7163'>
                   DTIMEI_1(KR)=-R2(KR,1)/ &amp;<a name='7164'>
     &amp;               (B21_MY(KR,1)*DEL2N-B22_MY(KR,1))<a name='7165'>
                   DTIMEI_2(KR)=-R2(KR,2)/ &amp;<a name='7166'>
     &amp;               (B21_MY(KR,2)*DEL2N-B22_MY(KR,2))<a name='7167'>
                   DTIMEI_3(KR)=-R2(KR,3)/ &amp;<a name='7168'>
     &amp;               (B21_MY(KR,3)*DEL2N-B22_MY(KR,3))<a name='7169'>
                 END IF<a name='7170'>
                ENDDO<a name='7171'>
<font color=#447700>! WATER<a name='7172'></font>
                KLIMITL=1<a name='7173'>
                DO KR=1,NKR<a name='7174'>
                   IF(DTIMEL(KR).GT.TIMEREV) GOTO 355<a name='7175'>
                   KLIMITL=KR<a name='7176'>
                ENDDO<a name='7177'>
  355           KLIMITL=KLIMITL-1<a name='7178'>
                IF(KLIMITL.LT.1) KLIMITL=1<a name='7179'>
                DTNEWL1=AMIN1(DTIMEL(KLIMITL),DT0L,TIMEREV)<a name='7180'>
<font color=#447700>! GRAUPELS<a name='7181'></font>
                KLIMITG=1<a name='7182'>
                DO KR=1,NKR<a name='7183'>
                   IF(DTIMEG(KR).GT.TIMEREV) GOTO 455<a name='7184'>
                   KLIMITG=KR<a name='7185'>
                ENDDO<a name='7186'>
  455           KLIMITG=KLIMITG-1<a name='7187'>
                IF(KLIMITG.LT.1) KLIMITG=1<a name='7188'>
                DTNEWG1=AMIN1(DTIMEG(KLIMITG),TIMEREV)<a name='7189'>
<font color=#447700>! HAIL<a name='7190'></font>
                KLIMITH=1<a name='7191'>
                DO KR=1,NKR<a name='7192'>
                   IF(DTIMEH(KR).GT.TIMEREV) GOTO 555<a name='7193'>
                   KLIMITH=KR<a name='7194'>
                ENDDO<a name='7195'>
  555           KLIMITH=KLIMITH-1<a name='7196'>
                IF(KLIMITH.LT.1) KLIMITH=1<a name='7197'>
                DTNEWH1=AMIN1(DTIMEH(KLIMITH),TIMEREV)<a name='7198'>
<font color=#447700>! ICE CRYSTALS<a name='7199'></font>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE) (BEGIN)<a name='7200'></font>
                KLIMITI_1=1<a name='7201'>
                KLIMITI_2=1<a name='7202'>
                KLIMITI_3=1<a name='7203'>
                DO KR=1,NKR<a name='7204'>
                   IF(DTIMEI_1(KR).GT.TIMEREV) GOTO 655<a name='7205'>
                   KLIMITI_1=KR<a name='7206'>
                ENDDO<a name='7207'>
  655           CONTINUE<a name='7208'>
                DO KR=1,NKR<a name='7209'>
                   IF(DTIMEI_2(KR).GT.TIMEREV) GOTO 656<a name='7210'>
                   KLIMITI_2=KR<a name='7211'>
                ENDDO<a name='7212'>
  656           CONTINUE<a name='7213'>
                DO KR=1,NKR<a name='7214'>
                   IF(DTIMEI_3(KR).GT.TIMEREV) GOTO 657<a name='7215'>
                   KLIMITI_3=KR<a name='7216'>
                ENDDO<a name='7217'>
  657           CONTINUE<a name='7218'>
                KLIMITI_1=KLIMITI_1-1<a name='7219'>
                IF(KLIMITI_1.LT.1) KLIMITI_1=1<a name='7220'>
                DTNEWI2_1=AMIN1(DTIMEI_1(KLIMITI_1),TIMEREV)<a name='7221'>
                KLIMITI_2=KLIMITI_2-1<a name='7222'>
                IF(KLIMITI_2.LT.1) KLIMITI_2=1<a name='7223'>
                DTNEWI2_2=AMIN1(DTIMEI_2(KLIMITI_2),TIMEREV)<a name='7224'>
                KLIMITI_3=KLIMITI_3-1<a name='7225'>
                IF(KLIMITI_3.LT.1) KLIMITI_3=1<a name='7226'>
                DTNEWI2_3=AMIN1(DTIMEI_3(KLIMITI_3),TIMEREV)<a name='7227'>
                DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7228'>
<font color=#447700>! NEW ALGORITHM (NO TYPE OF ICE) (END)<a name='7229'></font>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWG1,DTNEWH1,DT0I)<a name='7230'>
                IF(ABS(DEL2N).LT.EPSDEL2) &amp;<a name='7231'>
     &amp;          DTNEWI1=AMIN1(DTNEWI2,DTNEWG1,DTNEWH1)<a name='7232'>
                DTNEWL2=AMIN1(DTNEWL1,DTNEWI1)<a name='7233'>
                DTNEWL=DTNEWL2<a name='7234'>
                IF(DTNEWL.LT.DT_MIX_EVAP) &amp;<a name='7235'>
     &amp;          DTNEWL=AMIN1(DT_MIX_EVAP,TIMEREV)  <a name='7236'>
                IF(ITIME.GE.NKR) THEN<a name='7237'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_767">("fatal error in module_mp_fast_sbm (ITIME.GE.NKR), model stop")<a name='7238'>
                ENDIF<a name='7239'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7240'>
<font color=#447700>! NEW TIME STEP (EVAPORATION MIXED PHASE)<a name='7241'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7242'>
                IF((TIMENEW+DTNEWL).GT.DT &amp;<a name='7243'>
     &amp;         .AND.ITIME.LT.(NKR-1)) &amp;<a name='7244'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7245'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7246'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7247'>
                TIMENEW=TIMENEW+DTNEWL<a name='7248'>
                DTT=DTNEWL<a name='7249'>
<font color=#447700>! EVAPORATION MIXED PHASE (END)<a name='7250'></font>
<font color=#447700>! IN CASE : KCOND = 30<a name='7251'></font>
              ENDIF<a name='7252'>
              IF(KCOND.EQ.32) THEN<a name='7253'>
<font color=#447700>! BERGERON MIXED PHASE (BEGIN)<a name='7254'></font>
<font color=#447700>! CONTROL OF TIMESTEP ITERATIONS<a name='7255'></font>
                I_BERGERON=I_BERGERON+1<a name='7256'>
<font color=#447700>! NEW TREATMENT OF TIME STEP (BERGERON MIXED PHASE)<a name='7257'></font>
               IF (DEL1N.EQ.0)THEN<a name='7258'>
                DTNEWL0=DT<a name='7259'>
               ELSE<a name='7260'>
                DTNEWL0=-R1(1)/(B11_MY(1)*DEL1N-B12_MY(1))<a name='7261'>
               END IF<a name='7262'>
<font color=#447700>! NEW ALGORITHM (NO TYPE ICE)<a name='7263'></font>
               IF (DEL2N.EQ.0)THEN<a name='7264'>
                DTNEWI2_1=DT<a name='7265'>
                DTNEWI2_2=DT<a name='7266'>
                DTNEWI2_3=DT<a name='7267'>
               ELSE<a name='7268'>
                DTNEWI2_1=R2(1,1)/(B21_MY(1,1)*DEL2N-B22_MY(1,1))<a name='7269'>
                DTNEWI2_2=R2(1,2)/(B21_MY(1,2)*DEL2N-B22_MY(1,2))<a name='7270'>
                DTNEWI2_3=R2(1,3)/(B21_MY(1,3)*DEL2N-B22_MY(1,3))<a name='7271'>
               END IF<a name='7272'>
               DTNEWI2=AMIN1(DTNEWI2_1,DTNEWI2_2,DTNEWI2_3)<a name='7273'>
               IF (DEL2N.EQ.0)THEN<a name='7274'>
                DTNEWI3=DT<a name='7275'>
                DTNEWI4=DT<a name='7276'>
                DTNEWI5=DT<a name='7277'>
               ELSE<a name='7278'>
                DTNEWI3=R3(1)/(B31_MY(1)*DEL2N-B32_MY(1))<a name='7279'>
                DTNEWI4=R4(1)/(B41_MY(1)*DEL2N-B42_MY(1))<a name='7280'>
                DTNEWI5=R5(1)/(B51_MY(1)*DEL2N-B52_MY(1))<a name='7281'>
               END IF<a name='7282'>
                DTNEWL1=AMIN1(DTNEWL0,DT0L,TIMEREV)<a name='7283'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI3,DTNEWI4 &amp;<a name='7284'>
     &amp;                       ,DTNEWI5,DT0I,TIMEREV)<a name='7285'>
                DTNEWI1=AMIN1(DTNEWI2,DTNEWI4,DTNEWI5,DT0I,TIMEREV)<a name='7286'>
                DTNEWL=AMIN1(DTNEWL1,DTNEWI1)<a name='7287'>
<font color=#447700>! NEW CHANGES 23.04.01 (BEGIN)<a name='7288'></font>
                IF(DTNEWL.LT.DT_MIX_BERGERON) &amp;<a name='7289'>
     &amp;          DTNEWL=AMIN1(DT_MIX_BERGERON,TIMEREV)<a name='7290'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7291'>
<font color=#447700>! NEW TIME STEP (BERGERON MIXED PHASE)<a name='7292'></font>
                IF(DTNEWL.GT.DT) DTNEWL=DT<a name='7293'>
                IF((TIMENEW+DTNEWL).GT.DT.AND.ITIME.LT.(NKR-1)) &amp;<a name='7294'>
     &amp;          DTNEWL=DT-TIMENEW<a name='7295'>
                IF(ITIME.EQ.(NKR-1)) DTNEWL=DT-TIMENEW<a name='7296'>
                TIMESTEPD(ITIME)=DTNEWL<a name='7297'>
                TIMENEW=TIMENEW+DTNEWL<a name='7298'>
                DTT=DTNEWL<a name='7299'>
<font color=#447700>! BERGERON MIXED PHASE (END)<a name='7300'></font>
<font color=#447700>! IN CASE : KCOND = 32<a name='7301'></font>
              ENDIF<a name='7302'>
<font color=#447700>! SOLVING FOR SUPERSATURATION <a name='7303'></font>
<font color=#447700>! CALL JERSUPSAT - 7 (MIXED_PHASE)<a name='7304'></font>
         <a name='7305'>
	      CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERSUPSAT'>JERSUPSAT</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERSUPSAT_6">(DEL1,DEL2,DEL1N,DEL2N &amp;<a name='7306'>
     &amp;                      ,RW,PW,RI,PI,QW,QI &amp;<a name='7307'>
     &amp;                      ,DTT,D1N,D2N,DT0L,DT0I)<a name='7308'>
<font color=#447700>! END OF "NEW SUPERSATURATION" <a name='7309'></font>
<a name='7310'>
<font color=#447700>! DROPLETS <a name='7311'></font>
	      IF(ISYM1.NE.0) THEN<a name='7312'>
<a name='7313'>
<font color=#447700>! DROPLET DISTRIBUTION FUNCTION <a name='7314'></font>
<a name='7315'>
                                                         <a name='7316'>
<font color=#447700>! CALL JERDFUN - 3<a name='7317'></font>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_15">(R1,B11_MY,B12_MY &amp;<a name='7318'>
     &amp;                      ,FI1,PSI1,D1N &amp;<a name='7319'>
     &amp;                      ,1,1,COL,NKR,TPN)<a name='7320'>
<font color=#447700>! END OF "DROPLET DISTRIBUTION FUNCTION" <a name='7321'></font>
 <a name='7322'>
<font color=#447700>! IN CASE ISYM1.NE.0<a name='7323'></font>
<a name='7324'>
 	      ENDIF                     <a name='7325'>
<font color=#447700>! CRYSTALS <a name='7326'></font>
	      IF(ISYM2.NE.0) THEN<a name='7327'>
<a name='7328'>
<font color=#447700>! CRYSTAL DISTRIBUTION FUNCTION <a name='7329'></font>
 <a name='7330'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_16">(R2,B21_MY,B22_MY &amp;<a name='7331'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7332'>
     &amp;                      ,ICEMAX,1,COL,NKR,TPN)<a name='7333'>
<a name='7334'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_17">(R2,B21_MY,B22_MY &amp;<a name='7335'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7336'>
     &amp;                      ,ICEMAX,2,COL,NKR,TPN)<a name='7337'>
<a name='7338'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_18">(R2,B21_MY,B22_MY &amp;<a name='7339'>
     &amp;                      ,FI2,PSI2,D2N &amp;<a name='7340'>
     &amp;                      ,ICEMAX,3,COL,NKR,TPN)<a name='7341'>
<font color=#447700>! IN CASE ISYM2.NE.0<a name='7342'></font>
<a name='7343'>
	      ENDIF<a name='7344'>
<font color=#447700>! SNOW <a name='7345'></font>
	      IF(ISYM3.NE.0) THEN<a name='7346'>
<a name='7347'>
<font color=#447700>! SNOW DISTRIBUTION FUNCTION <a name='7348'></font>
                                                         <a name='7349'>
<a name='7350'>
<font color=#447700>! CALL JERDFUN - SNOW - 3<a name='7351'></font>
<a name='7352'>
 	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_19">(R3,B31_MY,B32_MY &amp;<a name='7353'>
     &amp;                      ,FI3,PSI3,D2N &amp;<a name='7354'>
     &amp;                      ,1,3,COL,NKR,TPN)<a name='7355'>
<a name='7356'>
<a name='7357'>
<font color=#447700>! IN CASE ISYM3.NE.0<a name='7358'></font>
<a name='7359'>
  	      ENDIF<a name='7360'>
<a name='7361'>
<font color=#447700>! GRAUPELS <a name='7362'></font>
<a name='7363'>
	      IF(ISYM4.NE.0) THEN<a name='7364'>
<a name='7365'>
<font color=#447700>! GRAUPEL DISTRIBUTION FUNCTION<a name='7366'></font>
                                                         <a name='7367'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_20">(R4,B41_MY,B42_MY &amp;<a name='7368'>
     &amp;                      ,FI4,PSI4,D2N &amp;<a name='7369'>
     &amp;                      ,1,4,COL,NKR,TPN)<a name='7370'>
<font color=#447700>! IN CASE ISYM4.NE.0<a name='7371'></font>
<a name='7372'>
	      ENDIF<a name='7373'>
<font color=#447700>! HAIL <a name='7374'></font>
	      IF(ISYM5.NE.0) THEN<a name='7375'>
<a name='7376'>
<font color=#447700>! HAIL DISTRIBUTION FUNCTION <a name='7377'></font>
                                                         <a name='7378'>
	        CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#JERDFUN'>JERDFUN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#ONECOND3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="JERDFUN_21">(R5,B51_MY,B52_MY &amp;<a name='7379'>
     &amp;                      ,FI5,PSI5,D2N &amp;<a name='7380'>
     &amp;                      ,1,5,COL,NKR,TPN)<a name='7381'>
<font color=#447700>! IN CASE ISYM5.NE.0<a name='7382'></font>
<a name='7383'>
	      ENDIF<a name='7384'>
<font color=#447700>! MASSES<a name='7385'></font>
              RMASSLBB=0.D0<a name='7386'>
              RMASSIBB=0.D0<a name='7387'>
              RMASSLAA=0.D0<a name='7388'>
              RMASSIAA=0.D0<a name='7389'>
<font color=#447700>! BEFORE JERNEWF<a name='7390'></font>
              DO K=1,NKR<a name='7391'>
                 FI1_K=FI1(K)<a name='7392'>
                 R1_K=R1(K)<a name='7393'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='7394'>
                 RMASSLBB=RMASSLBB+FI1R1<a name='7395'>
                 DO ICE =1,ICEMAX<a name='7396'>
                    FI2_K=FI2(K,ICE)<a name='7397'>
                    R2_K=R2(K,ICE)<a name='7398'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7399'>
                    RMASSIBB=RMASSIBB+FI2R2<a name='7400'>
                 ENDDO<a name='7401'>
                 FI3_K=FI3(K)<a name='7402'>
                 FI4_K=FI4(K)<a name='7403'>
                 FI5_K=FI5(K)<a name='7404'>
                 R3_K=R3(K)<a name='7405'>
                 R4_K=R4(K)<a name='7406'>
                 R5_K=R5(K)<a name='7407'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7408'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7409'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7410'>
                 RMASSIBB=RMASSIBB+FI3R3<a name='7411'>
                 RMASSIBB=RMASSIBB+FI4R4<a name='7412'>
                 RMASSIBB=RMASSIBB+FI5R5<a name='7413'>
              ENDDO<a name='7414'>
              RMASSIBB=RMASSIBB*COL3*RORI<a name='7415'>
<font color=#447700>! NEW CHANGE RMASSIBB<a name='7416'></font>
              IF(RMASSIBB.LT.0.0) RMASSIBB=0.0<a name='7417'>
              RMASSLBB=RMASSLBB*COL3*RORI<a name='7418'>
<font color=#447700>! NEW CHANGE RMASSLBB<a name='7419'></font>
              IF(RMASSLBB.LT.0.0) RMASSLBB=0.0<a name='7420'>
<font color=#447700>! AFTER  JERNEWF<a name='7421'></font>
              DO K=1,NKR<a name='7422'>
                 FI1_K=PSI1(K)<a name='7423'>
                 R1_K=R1(K)<a name='7424'>
                 FI1R1=FI1_K*R1_K*R1_K<a name='7425'>
                 RMASSLAA=RMASSLAA+FI1R1<a name='7426'>
                 DO ICE =1,ICEMAX<a name='7427'>
                    FI2(K,ICE)=PSI2(K,ICE)<a name='7428'>
                    FI2_K=FI2(K,ICE)<a name='7429'>
                    R2_K=R2(K,ICE)<a name='7430'>
                    FI2R2=FI2_K*R2_K*R2_K<a name='7431'>
                    RMASSIAA=RMASSIAA+FI2R2<a name='7432'>
                 ENDDO<a name='7433'>
                 FI3_K=PSI3(K)<a name='7434'>
                 FI4_K=PSI4(K)<a name='7435'>
                 FI5_K=PSI5(K)<a name='7436'>
                 R3_K=R3(K)<a name='7437'>
                 R4_K=R4(K)<a name='7438'>
                 R5_K=R5(K)<a name='7439'>
                 FI3R3=FI3_K*R3_K*R3_K<a name='7440'>
                 FI4R4=FI4_K*R4_K*R4_K<a name='7441'>
                 FI5R5=FI5_K*R5_K*R5_K<a name='7442'>
                 RMASSIAA=RMASSIAA+FI3R3<a name='7443'>
                 RMASSIAA=RMASSIAA+FI4R4<a name='7444'>
                 RMASSIAA=RMASSIAA+FI5R5<a name='7445'>
              ENDDO<a name='7446'>
              RMASSIAA=RMASSIAA*COL3*RORI<a name='7447'>
<font color=#447700>! NEW CHANGE RMASSIAA<a name='7448'></font>
              IF(RMASSIAA.LE.0.0) RMASSIAA=0.0<a name='7449'>
              RMASSLAA=RMASSLAA*COL3*RORI<a name='7450'>
<font color=#447700>! NEW CHANGE RMASSLAA<a name='7451'></font>
              IF(RMASSLAA.LT.0.0) RMASSLAA=0.0<a name='7452'>
<font color=#447700>! NEW TREATMENT OF "T" &amp; "Q"<a name='7453'></font>
              DELMASSL1=RMASSLAA-RMASSLBB<a name='7454'>
              DELMASSI1=RMASSIAA-RMASSIBB<a name='7455'>
              DELTAQ1=DELMASSL1+DELMASSI1<a name='7456'>
<font color=#447700>!             QPN=QPS-DELTAQ1-CWQ*DTT<a name='7457'></font>
              QPN=QPS-DELTAQ1<a name='7458'>
              DAL1=AL1<a name='7459'>
              DAL2=AL2<a name='7460'>
<font color=#447700>!             TPN=TPS+DAL1*DELMASSL1+AL2*DELMASSI1-CWQ*DTT<a name='7461'></font>
              TPN=TPS+DAL1*DELMASSL1+DAL2*DELMASSI1<a name='7462'>
<font color=#447700>! SUPERSATURATION<a name='7463'></font>
              ARGEXP=-BB1_MY/TPN<a name='7464'>
              ES1N=AA1_MY*DEXP(ARGEXP)<a name='7465'>
              ARGEXP=-BB2_MY/TPN<a name='7466'>
              ES2N=AA2_MY*DEXP(ARGEXP)<a name='7467'>
              EW1N=OPER3(QPN,PP)<a name='7468'>
              IF(ES1N.EQ.0)THEN<a name='7469'>
               DEL1N=0.5<a name='7470'>
               DIV1=1.5<a name='7471'>
<font color=#447700>!              print*,'es1n onecond3 = 0'<a name='7472'></font>
<font color=#447700>!              stop<a name='7473'></font>
              ELSE<a name='7474'>
               DIV1=EW1N/ES1N<a name='7475'>
               DEL1N=EW1N/ES1N-1.<a name='7476'>
              END IF<a name='7477'>
              IF(ES2N.EQ.0)THEN<a name='7478'>
               DEL2N=0.5<a name='7479'>
               DIV2=1.5<a name='7480'>
<font color=#447700>!              print*,'es2n onecond3 = 0'<a name='7481'></font>
<font color=#447700>!              stop<a name='7482'></font>
              ELSE<a name='7483'>
               DEL2N=EW1N/ES2N-1.<a name='7484'>
               DIV2=EW1N/ES2N<a name='7485'>
              END IF<a name='7486'>
<font color=#447700>! END OF TIME SPLITTING<a name='7487'></font>
<a name='7488'>
<font color=#447700>! HERE<a name='7489'></font>
<a name='7490'>
        IF(TIMENEW.LT.DT) GOTO 16<a name='7491'>
17      CONTINUE<a name='7492'>
<a name='7493'>
        TT=TPN<a name='7494'>
        QQ=QPN<a name='7495'>
        DO KR=1,NKR<a name='7496'>
           FF1(KR)=PSI1(KR)<a name='7497'>
           DO ICE=1,ICEMAX<a name='7498'>
              FF2(KR,ICE)=PSI2(KR,ICE)<a name='7499'>
           ENDDO<a name='7500'>
           FF3(KR)=PSI3(KR)<a name='7501'>
           FF4(KR)=PSI4(KR)<a name='7502'>
           FF5(KR)=PSI5(KR)<a name='7503'>
        ENDDO<a name='7504'>
<a name='7505'>
<a name='7506'>
        RETURN                                          <a name='7507'>
        END SUBROUTINE ONECOND3<a name='7508'>
<A NAME='COAL_BOTT_NEW'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COAL_BOTT_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7509'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>COAL_BOTT_NEW</font>(FF1R,FF2R,FF3R, &amp; <A href='../../call_to/COAL_BOTT_NEW.html' TARGET='index'>2</A>,<A href='../../call_from/COAL_BOTT_NEW.html' TARGET='index'>56</A><a name='7510'>
     &amp;   FF4R,FF5R,TT,QQ,PP,RHO,dt_coll,TCRIT,TTCOAL)<a name='7511'>
       implicit none<a name='7512'>
       INTEGER KR,ICE<a name='7513'>
       INTEGER icol_drop,icol_snow,icol_graupel,icol_hail, &amp;<a name='7514'>
     &amp; icol_column,icol_plate,icol_dendrite,icol_drop_brk<a name='7515'>
       double precision  g1(nkr),g2(nkr,icemax),g3(nkr),g4(nkr),g5(nkr)<a name='7516'>
       double precision gdumb(JMAX),xl_dumb(0:nkr),g_orig(nkr)<a name='7517'>
       double precision g2_1(nkr),g2_2(nkr),g2_3(nkr)<a name='7518'>
       real cont_fin_drop,dconc,conc_icempl,deldrop,t_new, &amp;<a name='7519'>
     &amp; delt_new,cont_fin_ice,conc_old,conc_new,cont_init_ice, &amp;<a name='7520'>
     &amp; cont_init_drop,ALWC<a name='7521'>
       REAL    FF1R(NKR),FF2R(NKR,ICEMAX),FF3R(NKR),FF4R(NKR),FF5R(NKR)<a name='7522'>
       REAL dt_coll<a name='7523'>
       REAL TCRIT,TTCOAL<a name='7524'>
       real tt_no_coll<a name='7525'>
       parameter (tt_no_coll=273.16)<a name='7526'>
<a name='7527'>
<a name='7528'>
       <a name='7529'>
   <a name='7530'>
<font color=#447700>! SHARED<a name='7531'></font>
       INTEGER I,J,IT,NDIV<a name='7532'>
       REAL RHO<a name='7533'>
       DOUBLE PRECISION break_drop_bef,break_drop_aft,dtbreakup<a name='7534'>
       DOUBLE PRECISION break_drop_per<a name='7535'>
       DOUBLE PRECISION TT,QQ,PP,prdkrn,prdkrn1<a name='7536'>
       parameter (prdkrn1=1.d0)<a name='7537'>
<font color=#447700>!     print*,'tcrit = ',tcrit<a name='7538'></font>
<font color=#447700>!     print*,'ttcoal = ',ttcoal<a name='7539'></font>
<font color=#447700>!     print*,'col = ',col<a name='7540'></font>
<font color=#447700>!     print*,'p1,p2,p3 = ',p1,p2,p3<a name='7541'></font>
<font color=#447700>!     print*,'icempl,kr_icempl  = ',icempl,kr_icempl<a name='7542'></font>
<font color=#447700>!     print*,'dt_coll = ',dt_coll<a name='7543'></font>
      icol_drop_brk=0<a name='7544'>
      icol_drop=0<a name='7545'>
      icol_snow=0<a name='7546'>
      icol_graupel=0<a name='7547'>
      icol_hail=0<a name='7548'>
      icol_column=0<a name='7549'>
      icol_plate=0<a name='7550'>
      icol_dendrite=0<a name='7551'>
<a name='7552'>
<a name='7553'>
       t_new=tt<a name='7554'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#MISC1'>MISC1</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MISC1_1">(PP,cwll_1000mb,cwll_750mb,cwll_500mb, &amp;<a name='7555'>
     &amp;    cwll,nkr)<a name='7556'>
<font color=#447700>! THIS IS FOR BREAKUP<a name='7557'></font>
         DO I=1,NKR<a name='7558'>
            DO J=1,NKR<a name='7559'>
               CWLL(I,J)=ECOALMASSM(I,J)*CWLL(I,J)<a name='7560'>
            ENDDO<a name='7561'>
         ENDDO<a name='7562'>
<font color=#447700>!<a name='7563'></font>
<font color=#447700>! THIS IS FOR TURBULENCE<a name='7564'></font>
        IF (LIQTURB.EQ.1)THEN<a name='7565'>
         DO I=1,KRMAX_LL<a name='7566'>
           DO J=1,KRMAX_LL<a name='7567'>
               CWLL(I,J)=CTURBLL(I,J)*CWLL(I,J)<a name='7568'>
           END DO<a name='7569'>
         END DO<a name='7570'>
        END IF<a name='7571'>
         CALL <A href='../../html_code/phys/module_mp_full_sbm.F.html#MODKRN'>MODKRN</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODKRN_1">(TT,QQ,PP,PRDKRN,TTCOAL)<a name='7572'>
        DO 13 KR=1,NKR<a name='7573'>
         G1(KR)=FF1R(KR)*3.*XL(KR)*XL(KR)*1.E3<a name='7574'>
         G2(KR,1)=FF2R(KR,1)*3*xi(KR,1)*XI(KR,1)*1.e3<a name='7575'>
         G2(KR,2)=FF2R(KR,2)*3.*xi(KR,2)*XI(KR,2)*1.e3<a name='7576'>
         G2(KR,3)=FF2R(KR,3)*3.*xi(KR,3)*XI(KR,3)*1.e3<a name='7577'>
         G3(KR)=FF3R(KR)*3.*xs(kr)*xs(kr)*1.e3<a name='7578'>
         G4(KR)=FF4R(KR)*3.*xg(kr)*xg(kr)*1.e3<a name='7579'>
         G5(KR)=FF5R(KR)*3.*xh(kr)*xh(kr)*1.e3<a name='7580'>
         g2_1(kr)=g2(KR,1)<a name='7581'>
         g2_2(KR)=g2(KR,2)<a name='7582'>
         g2_3(KR)=g2(KR,3)<a name='7583'>
         if(kr.gt.(nkr-jbreak).and.g1(kr).gt.1.e-17)icol_drop_brk=1<a name='7584'>
<font color=#447700>!        icol_drop_brk=0<a name='7585'></font>
         IF (IBREAKUP.NE.1)icol_drop_brk=0 <a name='7586'>
         if(g1(kr).gt.1.e-10)icol_drop=1<a name='7587'>
         if (tt.le.tt_no_coll)then<a name='7588'>
         if(g2_1(kr).gt.1.e-10)icol_column=1<a name='7589'>
         if(g2_2(kr).gt.1.e-10)icol_plate=1<a name='7590'>
         if(g2_3(kr).gt.1.e-10)icol_dendrite=1<a name='7591'>
         if(g3(kr).gt.1.e-10)icol_snow=1<a name='7592'>
         if(g4(kr).gt.1.e-10)icol_graupel=1<a name='7593'>
         if(g5(kr).gt.1.e-10)icol_hail=1<a name='7594'>
         end if<a name='7595'>
13     CONTINUE <a name='7596'>
<font color=#447700>! calculation of initial hydromteors content in g/cm**3 :<a name='7597'></font>
      cont_init_drop=0.<a name='7598'>
      cont_init_ice=0.<a name='7599'>
      do kr=1,nkr<a name='7600'>
         cont_init_drop=cont_init_drop+g1(kr)<a name='7601'>
         cont_init_ice=cont_init_ice+g3(kr)+g4(kr)+g5(kr)<a name='7602'>
         do ice=1,icemax<a name='7603'>
            cont_init_ice=cont_init_ice+g2(kr,ice)<a name='7604'>
         enddo<a name='7605'>
      enddo<a name='7606'>
      cont_init_drop=col*cont_init_drop*1.e-3<a name='7607'>
      cont_init_ice=col*cont_init_ice*1.e-3<a name='7608'>
<font color=#447700>! calculation of alwc in g/m**3<a name='7609'></font>
      alwc=cont_init_drop*1.e6<a name='7610'>
<font color=#447700>! calculation interactions :<a name='7611'></font>
<font color=#447700>! droplets - droplets and droplets - ice :<a name='7612'></font>
<font color=#447700>! water-water = water<a name='7613'></font>
<a name='7614'>
      if (icol_drop.eq.1)then <a name='7615'>
<font color=#447700>! break-up<a name='7616'></font>
<a name='7617'>
       call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX'>coll_xxx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXX_1"> (G1,CWLL,XL_MG,CHUCM,IMA,NKR)<a name='7618'>
<font color=#447700>! breakup!<a name='7619'></font>
       if(icol_drop_brk.eq.1)then<a name='7620'>
       ndiv=1<a name='7621'>
10     continue<a name='7622'>
       do it = 1,ndiv<a name='7623'>
         if (ndiv.gt.10000) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_768">("fatal error in module_mp_fast_sbm (ndiv.gt.10000), model stop")<a name='7624'>
         dtbreakup = dt_coll/ndiv<a name='7625'>
         if (it.eq.1)then<a name='7626'>
<font color=#447700>!         do kr=1,nkr<a name='7627'></font>
          do kr=1,JMAX<a name='7628'>
           gdumb(kr)= g1(kr)*1.D-3<a name='7629'>
           xl_dumb(kr)=xl_mg(KR)*1.D-3<a name='7630'>
          end do<a name='7631'>
          break_drop_bef=0.d0<a name='7632'>
<font color=#447700>!         do kr=1,nkr<a name='7633'></font>
          do kr=1,JMAX<a name='7634'>
            break_drop_bef=break_drop_bef+g1(kr)*1.D-3<a name='7635'>
          enddo<a name='7636'>
         end if<a name='7637'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#BREAKUP'>breakup</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BREAKUP_2">(gdumb,xl_dumb,dtbreakup,brkweight, &amp;<a name='7638'>
     &amp;        pkij,qkj,JMAX,jbreak)<a name='7639'>
       end do<a name='7640'>
       break_drop_aft=0.0d0<a name='7641'>
       do kr=1,JMAX<a name='7642'>
           break_drop_aft=break_drop_aft+gdumb(kr)<a name='7643'>
       enddo<a name='7644'>
       break_drop_per=break_drop_aft/break_drop_bef<a name='7645'>
       if (break_drop_per.gt.1.001)then<a name='7646'>
           ndiv=ndiv*2<a name='7647'>
           GO TO 10<a name='7648'>
       else<a name='7649'>
           do kr=1,JMAX<a name='7650'>
            g1(kr)=gdumb(kr)*1.D3<a name='7651'>
           end do<a name='7652'>
       end if<a name='7653'>
       end if<a name='7654'>
      end if<a name='7655'>
       if (icol_snow.eq.1)then <a name='7656'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYZ'>coll_xyz</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYZ_1"> (g1,g3,g4,cwls,xl_mg,xs_mg, &amp;<a name='7657'>
     &amp;                chucm,ima,prdkrn1,nkr,0)<a name='7658'>
         if(alwc.lt.alcr) then<a name='7659'>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_1"> (g3,g1,cwsl,xs_mg,xl_mg, &amp;<a name='7660'>
     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='7661'>
         endif<a name='7662'>
         if(alwc.ge.alcr) then<a name='7663'>
<font color=#447700>!        call coll_xyz (g3,g1,g4,cwsl,xs_mg,xl_mg, &amp;<a name='7664'></font>
<font color=#447700>!    &amp;                chucm,ima,prdkrn1,nkr,1)<a name='7665'></font>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYXZ_H'>coll_xyxz_h</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYXZ_H_1"> (g3,g1,g4,cwsl,xs_mg,xl_mg, &amp;<a name='7666'>
     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='7667'>
         endif<a name='7668'>
<font color=#447700>! in case : icolxz_snow.ne.0<a name='7669'></font>
       end if<a name='7670'>
<font color=#447700>! interactions between water and  graupel (begin)<a name='7671'></font>
<font color=#447700>! water - graupel = graupel (t &lt; tcrit ; xl_mg ge xg_mg)<a name='7672'></font>
<font color=#447700>! graupel - water = graupel (t &lt; tcrit ; xg_mg &gt; xl_mg)<a name='7673'></font>
<font color=#447700>! water - graupel = hail (t ge tcrit ; xl_mg ge xg_mg)<a name='7674'></font>
<font color=#447700>! graupel - water = hail (t ge tcrit ; xg_mg &gt; xl_mg)<a name='7675'></font>
       if (icol_graupel.eq.1)then <a name='7676'>
<font color=#447700>! water-graupel<a name='7677'></font>
<font color=#447700>! included kp_bound = 25<a name='7678'></font>
<font color=#447700>!!         call coll_xyyz_h (g1,g4,g5,cwlg,xl_mg,xg_mg, &amp;<a name='7679'></font>
<font color=#447700>!!     &amp;                chucm,ima,prdkrn1,nkr,1)<a name='7680'></font>
<font color=#447700>! for ice multiplication<a name='7681'></font>
          conc_old=0.<a name='7682'>
          conc_new=0.<a name='7683'>
          do kr=kr_icempl,nkr<a name='7684'>
               conc_old=conc_old+col*g1(kr)/xl_mg(kr)<a name='7685'>
          enddo<a name='7686'>
<font color=#447700>! graupel-water<a name='7687'></font>
<font color=#447700>!          if(alwc.lt.alcr_g) then<a name='7688'></font>
<font color=#447700>! water-graupel<a name='7689'></font>
<font color=#447700>! TEST<a name='7690'></font>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYY'>coll_xyy</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYY_1"> (g1,g4,cwlh,xl_mg,xg_mg, &amp;<a name='7691'>
     &amp;               chucm,ima,prdkrn1,nkr,0)<a name='7692'>
            call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XYX'>coll_xyx</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XYX_2"> (g4,g1,cwhl,xg_mg,xl_mg, &amp;<a name='7693'>
     &amp;          chucm,ima,prdkrn1,nkr,1)<a name='7694'>
<font color=#447700>! TEST<a name='7695'></font>
<font color=#447700>!          else<a name='7696'></font>
<font color=#447700>!!          call coll_xyxz_h (g4,g1,g5,cwgl,xg_mg,xl_mg, &amp;<a name='7697'></font>
<font color=#447700>!!   &amp;                chucm,ima,prdkrn1,nkr,1)<a name='7698'></font>
<font color=#447700>!          end if<a name='7699'></font>
<font color=#447700>! interactions between water and  graupels (end)<a name='7700'></font>
<a name='7701'>
         if(icempl.eq.1) then<a name='7702'>
          if(tt.ge.265.15.and.tt.le.tcrit) then<a name='7703'>
<font color=#447700>! ice-multiplication :<a name='7704'></font>
            do kr=kr_icempl,nkr<a name='7705'>
               conc_new=conc_new+col*g1(kr)/xl_mg(kr)<a name='7706'>
            enddo<a name='7707'>
            dconc=conc_old-conc_new<a name='7708'>
            if(tt.le.268.15) then<a name='7709'>
              conc_icempl=dconc*4.e-3*(265.15-tt)/(265.15-268.15)<a name='7710'>
            endif<a name='7711'>
            if(tt.gt.268.15) then<a name='7712'>
             conc_icempl=dconc*4.e-3*(tcrit-tt)/(tcrit-268.15)<a name='7713'>
            endif<a name='7714'>
<font color=#447700>!CHANGE FOR FOUR BIN SCHEME           g2_2(1)=g2_2(1)+conc_icempl*xi2_mg(1)/col<a name='7715'></font>
            g3(1)=g3(1)+conc_icempl*xs_mg(1)/col<a name='7716'>
<font color=#447700>! in case t.ge.265.15 :<a name='7717'></font>
          endif<a name='7718'>
<font color=#447700>! in case icempl=1<a name='7719'></font>
         endif<a name='7720'>
<font color=#447700>! interactions between water and  graupels (end)<a name='7721'></font>
<font color=#447700>! in case icolxz_graup.ne.0<a name='7722'></font>
       endif<a name='7723'>
<font color=#447700>! water - hail = hail (xl_mg ge xh_mg)                      (kxyy=2)<a name='7724'></font>
<font color=#447700>! hail - water = hail (xh_mg &gt; xl_mg)                       (kxyx=3)<a name='7725'></font>
<font color=#447700>!      if(icol_hail.eq.1) then<a name='7726'></font>
<font color=#447700>!       call coll_xyy (g1,g5,cwlh,xl_mg,xh_mg, &amp;<a name='7727'></font>
<font color=#447700>!    &amp;               chucm,ima,prdkrn1,nkr,0)<a name='7728'></font>
<font color=#447700>!       call coll_xyx (g5,g1,cwhl,xh_mg,xl_mg, &amp;<a name='7729'></font>
<font color=#447700>!    &amp;               chucm,ima,prdkrn1,nkr,1)<a name='7730'></font>
<font color=#447700>! in case icolxz_hail.ne.0<a name='7731'></font>
<font color=#447700>!      endif<a name='7732'></font>
<font color=#447700>! interactions between water and hail (end)<a name='7733'></font>
<font color=#447700>! interactions between water and crystals :<a name='7734'></font>
<font color=#447700>! interactions between water and columns :<a name='7735'></font>
<font color=#447700>! water - columns = graupel (t &lt; tcrit ; xl_mg ge xi_mg)    (kxyz=6)<a name='7736'></font>
<font color=#447700>! water - columns = hail (t ge tcrit ; xl_mg ge xi_mg)      (kxyz=7)<a name='7737'></font>
<font color=#447700>! columns - water = columns/graupel (xi_mg &gt; xl_mg)             (kxyx=4); kxyxz=2)<a name='7738'></font>
<font color=#447700>! now: columns - water = columns (xi_mg &gt; xl_mg)             (kxyx=4); kxyxz=2)<a name='7739'></font>
<font color=#447700>!      if(icol_column.eq.1) then<a name='7740'></font>
<font color=#447700>!       if(tt.lt.tcrit) then<a name='7741'></font>
<font color=#447700>!        call coll_xyz (g1,g2_1,g4,cwli_1,xl_mg,xi1_mg, &amp;<a name='7742'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7743'></font>
<font color=#447700>!       endif<a name='7744'></font>
<font color=#447700>!       if(tt.ge.tcrit) then<a name='7745'></font>
<font color=#447700>!        call coll_xyz (g1,g2_1,g5,cwli_1,xl_mg,xi1_mg, &amp;<a name='7746'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7747'></font>
<font color=#447700>!       endif<a name='7748'></font>
<font color=#447700>!       call coll_xyxz (g2_1,g1,g4,cwil_1,xi1_mg,xl_mg, &amp;<a name='7749'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7750'></font>
<font color=#447700>!       call coll_xyx (g2_1,g1,cwil_1,xi1_mg,xl_mg, &amp;<a name='7751'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7752'></font>
<font color=#447700>! in case icolxz_column.ne.0<a name='7753'></font>
<font color=#447700>!      endif<a name='7754'></font>
<a name='7755'>
<font color=#447700>!     if(icolxz_plate.ne.0) then<a name='7756'></font>
<font color=#447700>! interactions between water and plates :<a name='7757'></font>
<font color=#447700>! water - plates = graupel (t &lt; tcrit ; xl_mg ge xi2_mg)    (kxyz=8)<a name='7758'></font>
<font color=#447700>! water - plates = hail (t ge tcrit ; xl_mg ge xi2_mg)      (kxyz=9)<a name='7759'></font>
<font color=#447700>! plates - water = plates/graupel (xi2_mg &gt; xl_mg)              (kxyx=5; kxyxz=3)<a name='7760'></font>
<font color=#447700>!now: plates - water = plates (xi2_mg &gt; xl_mg)              (kxyx=5; kxyxz=3)<a name='7761'></font>
<font color=#447700>!      if(icol_plate.eq.1) then<a name='7762'></font>
<font color=#447700>!       if(tt.lt.tcrit) then<a name='7763'></font>
<font color=#447700>!        call coll_xyz (g1,g2_2,g4,cwli_2,xl_mg,xi2_mg, &amp;<a name='7764'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7765'></font>
<font color=#447700>!       endif<a name='7766'></font>
<font color=#447700>!       if(tt.ge.tcrit) then<a name='7767'></font>
<font color=#447700>!        call coll_xyz (g1,g2_2,g5,cwli_2,xl_mg,xi2_mg, &amp;<a name='7768'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7769'></font>
<font color=#447700>!       endif<a name='7770'></font>
<font color=#447700>!       call coll_xyxz (g2_2,g1,g4,cwil_2,xi2_mg,xl_mg, &amp;<a name='7771'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7772'></font>
<font color=#447700>!       call coll_xyx (g2_2,g1,cwil_2,xi2_mg,xl_mg, &amp;<a name='7773'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7774'></font>
<font color=#447700>! in case icolxz_plate.ne.0<a name='7775'></font>
<font color=#447700>!      endif<a name='7776'></font>
<a name='7777'>
<font color=#447700>! interactions between water and dendrites :<a name='7778'></font>
<font color=#447700>! water - dendrites = graupel (t &lt; tcrit ; xl_mg ge xi3_mg) (kxyz=10)<a name='7779'></font>
<font color=#447700>! water - dendrites = hail (t ge tcrit ; xl_mg ge xi3_mg)   (kxyz=11)<a name='7780'></font>
<font color=#447700>! dendrites - water = dendrites/graupel (xi3_mg &gt; xl_mg)         (kxyx=6; kxyxz=4)<a name='7781'></font>
<font color=#447700>!now dendrites - water = dendrites (xi3_mg &gt; xl_mg)         (kxyx=6; kxyxz=4)<a name='7782'></font>
<font color=#447700>!      if(icol_dendrite.eq.1) then<a name='7783'></font>
<font color=#447700>!       if(tt.lt.tcrit) then<a name='7784'></font>
<font color=#447700>!        call coll_xyz (g1,g2_3,g4,cwli_3,xl_mg,xi3_mg, &amp;<a name='7785'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7786'></font>
<font color=#447700>!       endif<a name='7787'></font>
<font color=#447700>!       if(tt.ge.tcrit) then<a name='7788'></font>
<font color=#447700>!        call coll_xyz (g1,g2_3,g5,cwli_3,xl_mg,xi3_mg, &amp;<a name='7789'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7790'></font>
<font color=#447700>!       endif<a name='7791'></font>
<font color=#447700>!       call coll_xyxz (g2_3,g1,g4,cwil_3,xi3_mg,xl_mg, &amp;<a name='7792'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7793'></font>
<font color=#447700>!       call coll_xyx (g2_3,g1,cwil_3,xi3_mg,xl_mg, &amp;<a name='7794'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7795'></font>
<font color=#447700>! in case icolxz_dendr.ne.0<a name='7796'></font>
<font color=#447700>!      endif<a name='7797'></font>
<font color=#447700>! interactions between water and dendrites (end)<a name='7798'></font>
<font color=#447700>! in case icolxz_drop.ne.0<a name='7799'></font>
<font color=#447700>!     endif<a name='7800'></font>
<font color=#447700>! interactions between water and crystals (end)<a name='7801'></font>
<a name='7802'>
<font color=#447700>! interactions between crystals :<a name='7803'></font>
<font color=#447700>! if(t.le.TTCOAL) - no interactions between crystals<a name='7804'></font>
<font color=#447700>!     if(tt.gt.TTCOAL) then<a name='7805'></font>
<font color=#447700>! interactions between columns and other particles (begin)<a name='7806'></font>
<font color=#447700>!      if(icol_column.eq.1) then<a name='7807'></font>
<font color=#447700>! columns - columns = snow<a name='7808'></font>
<font color=#447700>!       call coll_xxy (g2_1,g3,cwii_1_1,xi1_mg, &amp;<a name='7809'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr)<a name='7810'></font>
<font color=#447700>! interactions between columns and plates :<a name='7811'></font>
<font color=#447700>! columns - plates = snow (xi1_mg ge xi2_mg)                (kxyz=12)<a name='7812'></font>
<font color=#447700>! plates - columns = snow (xi2_mg &gt; xi1_mg)                 (kxyz=13)<a name='7813'></font>
<font color=#447700>!       if(icol_plate.eq.1) then     <a name='7814'></font>
<font color=#447700>!        call coll_xyz (g2_1,g2_2,g3,cwii_1_2,xi1_mg,xi2_mg, &amp;<a name='7815'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7816'></font>
<font color=#447700>!        call coll_xyz (g2_2,g2_1,g3,cwii_2_1,xi2_mg,xi1_mg, &amp;<a name='7817'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7818'></font>
<font color=#447700>!       end if<a name='7819'></font>
<font color=#447700>! interactions between columns and dendrites :<a name='7820'></font>
<font color=#447700>! columns - dendrites = snow (xi1_mg ge xi3_mg)             (kxyz=14)<a name='7821'></font>
<font color=#447700>! dendrites - columns = snow (xi3_mg &gt; xi1_mg)              (kxyz=15)<a name='7822'></font>
<font color=#447700>!       if(icol_dendrite.eq.1) then<a name='7823'></font>
<font color=#447700>!          call coll_xyz (g2_1,g2_3,g3,cwii_1_3,xi1_mg,xi3_mg, &amp;<a name='7824'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7825'></font>
<font color=#447700>!          call coll_xyz (g2_3,g2_1,g3,cwii_3_1,xi3_mg,xi1_mg, &amp;<a name='7826'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7827'></font>
<font color=#447700>!       end if<a name='7828'></font>
<font color=#447700>! interactions between columns and snow :<a name='7829'></font>
<font color=#447700>! columns - snow = snow (xi1_mg ge xs_mg)                   (kxyy=3)<a name='7830'></font>
<font color=#447700>! snow - columns = snow (xs_mg &gt; xi1_mg)                    (kxyx=7)<a name='7831'></font>
<font color=#447700>! ALEX?<a name='7832'></font>
<font color=#447700>!       if(icol_snow.eq.1) then<a name='7833'></font>
<font color=#447700>!B       call coll_xyy (g2_1,g3,cwis_1,xi1_mg,xs_mg,<a name='7834'></font>
<font color=#447700>!B   1                 chucm,ima,prdkrn,nkr,0)<a name='7835'></font>
<font color=#447700>!!        call coll_xyx (g3,g2_1,cwsi_1,xs_mg,xi1_mg, &amp;<a name='7836'></font>
<font color=#447700>!!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7837'></font>
<font color=#447700>!       endif          <a name='7838'></font>
<font color=#447700>! in case icolxz_column.ne.0<a name='7839'></font>
<font color=#447700>!      endif<a name='7840'></font>
<font color=#447700>! interactions between columns and other particles (end)<a name='7841'></font>
<font color=#447700>! interactions between plates and other particles (begin)<a name='7842'></font>
<font color=#447700>! plates - plates = snow<a name='7843'></font>
<font color=#447700>!      if(icol_plate.eq.1) then<a name='7844'></font>
<font color=#447700>!       call coll_xxy (g2_2,g3,cwii_2_2,xi2_mg, &amp;<a name='7845'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr)<a name='7846'></font>
<font color=#447700>! interactions between plates and dendrites :<a name='7847'></font>
<font color=#447700>! plates - dendrites = snow (xi2_mg ge xi3_mg)              (kxyz=17)<a name='7848'></font>
<font color=#447700>! dendrites - plates = snow (xi3_mg &gt; xi2_mg)               (kxyz=18)<a name='7849'></font>
<font color=#447700>!       if(icol_dendrite.eq.1) then<a name='7850'></font>
<font color=#447700>!        call coll_xyz (g2_2,g2_3,g3,cwii_2_3,xi2_mg,xi3_mg, &amp;<a name='7851'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,0)<a name='7852'></font>
<font color=#447700>!        call coll_xyz (g2_3,g2_2,g3,cwii_3_2,xi3_mg,xi2_mg, &amp;<a name='7853'></font>
<font color=#447700>!    &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7854'></font>
<font color=#447700>!       end if<a name='7855'></font>
<font color=#447700>! interactions between plates and snow :<a name='7856'></font>
<font color=#447700>! plates - snow = snow (xi2_mg ge xs_mg)                    (kxyy=4)<a name='7857'></font>
<font color=#447700>! snow - plates = snow (xs_mg &gt; xi2_mg)                     (kxyx=12)<a name='7858'></font>
<font color=#447700>!       if(icol_snow.eq.1) then<a name='7859'></font>
<font color=#447700>! ALEX<a name='7860'></font>
<font color=#447700>!B       call coll_xyy (g2_2,g3,cwis_2,xi2_mg,xs_mg,<a name='7861'></font>
<font color=#447700>!B   1                 chucm,ima,prdkrn,nkr,0)<a name='7862'></font>
<font color=#447700>!!        call coll_xyx (g3,g2_2,cwsi_2,xs_mg,xi2_mg, &amp;<a name='7863'></font>
<font color=#447700>!!     &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7864'></font>
<font color=#447700>!        end if<a name='7865'></font>
<font color=#447700>! in case icolxz_plate.ne.0<a name='7866'></font>
<font color=#447700>!      endif<a name='7867'></font>
<font color=#447700>! interactions between plates and others particles (end)<a name='7868'></font>
<font color=#447700>! interactions between dendrites and other hydrometeors (begin)<a name='7869'></font>
<font color=#447700>! dendrites - dendrites = snow<a name='7870'></font>
<font color=#447700>!      if(icol_dendrite.eq.1) then<a name='7871'></font>
<font color=#447700>!!       call coll_xxy (g2_3,g3,cwii_3_3,xi3_mg, &amp;<a name='7872'></font>
<font color=#447700>!!    &amp;                  chucm,ima,prdkrn,nkr)<a name='7873'></font>
<font color=#447700>! interactions between dendrites and snow :<a name='7874'></font>
<font color=#447700>! dendrites - snow = snow (xi3_mg ge xs_mg)                 (kxyy=5)<a name='7875'></font>
<font color=#447700>! snow - dendrites = snow (xs_mg &gt; xi3_mg)                  (kxyx=17)<a name='7876'></font>
<font color=#447700>!       if(icol_snow.eq.1) then<a name='7877'></font>
<font color=#447700>! ALEX<a name='7878'></font>
<font color=#447700>!B       call coll_xyy (g2_3,g3,cwis_3,xi3_mg,xs_mg,<a name='7879'></font>
<font color=#447700>!B   1                 chucm,ima,prdkrn,nkr,0)<a name='7880'></font>
<font color=#447700>!!        call coll_xyx (g3,g2_3,cwsi_3,xs_mg,xi3_mg, &amp;<a name='7881'></font>
<font color=#447700>!!   &amp;                 chucm,ima,prdkrn,nkr,1)<a name='7882'></font>
<font color=#447700>!       end if<a name='7883'></font>
<font color=#447700>! in case icolxz_dendr.ne.0<a name='7884'></font>
<font color=#447700>!      endif<a name='7885'></font>
<font color=#447700>! interactions between dendrites and other hydrometeors (end)<a name='7886'></font>
<font color=#447700>! interactions between snowflakes and other hydromteors (begin)<a name='7887'></font>
<font color=#447700>!       if(icol_snow.ne.0) then<a name='7888'></font>
<font color=#447700>! interactions between snowflakes<a name='7889'></font>
<font color=#447700>! snow - snow = snow<a name='7890'></font>
         call <A href='../../html_code/phys/module_mp_full_sbm.F.html#COLL_XXX_PRD'>coll_xxx_prd</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLL_XXX_PRD_1"> (g3,cwss,xs_mg,chucm,ima,prdkrn,nkr)<a name='7891'>
<font color=#447700>! interactions between snowflakes and graupels :<a name='7892'></font>
<font color=#447700>! snow - graupel = snow (xs_mg &gt; xg_mg)                     (kxyx=22)<a name='7893'></font>
<font color=#447700>! graupel - snow = graupel (xg_mg ge xs_mg)                 (kxyx=23)<a name='7894'></font>
<font color=#447700>!        if(icol_graupel.eq.1) then<a name='7895'></font>
<font color=#447700>!!         call coll_xyx (g3,g4,cwsg,xs_mg,xg_mg, &amp;<a name='7896'></font>
<font color=#447700>!!   &amp;                chucm,ima,prdkrn,nkr,1)<a name='7897'></font>
<font color=#447700>! in case icolxz_graup.ne.0<a name='7898'></font>
<font color=#447700>!        endif<a name='7899'></font>
<font color=#447700>! in case icolxz_snow.ne.0<a name='7900'></font>
<font color=#447700>!       endif<a name='7901'></font>
<font color=#447700>! interactions between snowflakes and other hydromteors (end)<a name='7902'></font>
<font color=#447700>! in case : t &gt; TTCOAL<a name='7903'></font>
<font color=#447700>!     endif<a name='7904'></font>
<font color=#447700>! in case : t &gt; TTCOAL or t.le.TTCOAL<a name='7905'></font>
<font color=#447700>! calculation of finish hydrometeors contents in g/cm**3 :<a name='7906'></font>
      cont_fin_drop=0.<a name='7907'>
      cont_fin_ice=0.<a name='7908'>
      do kr=1,nkr<a name='7909'>
<font color=#447700>!        g2(kr,1)=g2_1(kr)<a name='7910'></font>
<font color=#447700>!        g2(kr,2)=g2_2(kr)<a name='7911'></font>
<font color=#447700>!        g2(kr,3)=g2_3(kr)<a name='7912'></font>
         cont_fin_drop=cont_fin_drop+g1(kr)<a name='7913'>
<font color=#447700>!        cont_fin_ice=cont_fin_ice+g3(kr)+g4(kr)+g5(kr)<a name='7914'></font>
         cont_fin_ice=cont_fin_ice+g3(kr)+g4(kr)<a name='7915'>
<font color=#447700>!        do ice=1,icemax<a name='7916'></font>
<font color=#447700>!           cont_fin_ice=cont_fin_ice+g2(kr,ice)<a name='7917'></font>
<font color=#447700>!        enddo<a name='7918'></font>
      enddo<a name='7919'>
      cont_fin_drop=col*cont_fin_drop*1.e-3<a name='7920'>
      cont_fin_ice=col*cont_fin_ice*1.e-3<a name='7921'>
      deldrop=cont_init_drop-cont_fin_drop<a name='7922'>
<font color=#447700>! deldrop in g/cm**3<a name='7923'></font>
<font color=#447700>! resulted value of temperature (rob in g/cm**3) :<a name='7924'></font>
      if(t_new.le.273.15) then<a name='7925'>
        if(deldrop.ge.0.) then<a name='7926'>
          t_new=t_new+320.*deldrop/rho<a name='7927'>
        else<a name='7928'>
<font color=#447700>! if deldrop &lt; 0<a name='7929'></font>
          if(abs(deldrop).gt.cont_init_drop*0.05) then<a name='7930'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#COAL_BOTT_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_769">("fatal error in module_mp_fast_sbm, abs(deldrop).gt.cont_init_drop, model stop")<a name='7931'>
          endif<a name='7932'>
        endif<a name='7933'>
       endif<a name='7934'>
<a name='7935'>
61    continue<a name='7936'>
<font color=#447700>! recalculation of density function f1,f2,f3,f4,f5 in 1/(g*cm**3) :  <a name='7937'></font>
        DO 15 KR=1,NKR<a name='7938'>
         FF1R(KR)=G1(KR)/(3.*XL(KR)*XL(KR)*1.E3)<a name='7939'>
<font color=#447700>!        FF2R(KR,1)=G2(KR,1)/(3*xi(KR,1)*XI(KR,1)*1.e3)<a name='7940'></font>
<font color=#447700>!        FF2R(KR,2)=G2(KR,2)/(3.*xi(KR,2)*XI(KR,2)*1.e3)<a name='7941'></font>
<font color=#447700>!        FF2R(KR,3)=G2(KR,3)/(3.*xi(KR,3)*XI(KR,3)*1.e3)<a name='7942'></font>
         FF3R(KR)=G3(KR)/(3.*xs(kr)*xs(kr)*1.e3)<a name='7943'>
         FF4R(KR)=G4(KR)/(3.*xg(kr)*xg(kr)*1.e3)<a name='7944'>
<font color=#447700>!        FF5R(KR)=G5(KR)/(3.*xh(kr)*xh(kr)*1.e3)<a name='7945'></font>
15     CONTINUE <a name='7946'>
      tt=t_new<a name='7947'>
      RETURN<a name='7948'>
      END SUBROUTINE COAL_BOTT_NEW<a name='7949'>
<a name='7950'>
<A NAME='MISC1'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#MISC1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7951'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>MISC1</font>(PP,cwll_1000mb,cwll_750mb,cwll_500mb, &amp; <A href='../../call_to/MISC1.html' TARGET='index'>2</A><a name='7952'>
     &amp;      cwll,nkr)<a name='7953'>
      IMPLICIT NONE<a name='7954'>
      INTEGER kr1,kr2,NKR<a name='7955'>
      DOUBLE PRECISION PP<a name='7956'>
      REAL P_Z<a name='7957'>
      double precision cwll(nkr,nkr),cwll_1,cwll_2,cwll_3 &amp;<a name='7958'>
     &amp;,cwll_1000mb(nkr,nkr),cwll_750mb(nkr,nkr),cwll_500mb(nkr,nkr)<a name='7959'>
      P_Z=PP<a name='7960'>
              do 12 kr1=1,nkr<a name='7961'>
              do 12 kr2=1,nkr<a name='7962'>
               cwll_1=cwll_1000mb(kr1,kr2)<a name='7963'>
               cwll_2=cwll_750mb(kr1,kr2)<a name='7964'>
               cwll_3=cwll_500mb(kr1,kr2)<a name='7965'>
               if(p_z.ge.p1) cwll(kr1,kr2)=cwll_1<a name='7966'>
               if(p_z.eq.p2) cwll(kr1,kr2)=cwll_2<a name='7967'>
               if(p_z.eq.p3) cwll(kr1,kr2)=cwll_3<a name='7968'>
               if(p_z.lt.p1.and.p_z.gt.p2) &amp;<a name='7969'>
     &amp;         cwll(kr1,kr2)=cwll_2+ &amp;<a name='7970'>
     &amp;         (cwll_1-cwll_2)*(p_z-p2)/(p1-p2) <a name='7971'>
               if(p_z.lt.p2.and.p_z.gt.p3) &amp;<a name='7972'>
     &amp;         cwll(kr1,kr2)=cwll_3+ &amp;<a name='7973'>
     &amp;         (cwll_2-cwll_3)*(p_z-p3)/(p2-p3)<a name='7974'>
               if(p_z.lt.p3) cwll(kr1,kr2)=cwll_3<a name='7975'>
12            CONTINUE <a name='7976'>
      RETURN<a name='7977'>
      END SUBROUTINE  MISC1<a name='7978'>
<a name='7979'>
<A NAME='COLL_XXX'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XXX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='7980'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxx</font> (g,ckxx,x,chucm,ima,nkr) <A href='../../call_to/COLL_XXX.html' TARGET='index'>2</A><a name='7981'>
        implicit double precision (a-h,o-z)<a name='7982'>
        dimension g(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='7983'>
        dimension chucm(nkr,nkr)<a name='7984'>
        double precision ima(nkr,nkr)<a name='7985'>
        gmin=1.d-60<a name='7986'>
<font color=#447700>!       gmin=1.d-15<a name='7987'></font>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='7988'></font>
        do i=1,nkr-1<a name='7989'>
           ix0=i<a name='7990'>
           if(g(i).gt.gmin) goto 2000<a name='7991'>
        enddo<a name='7992'>
 2000   continue<a name='7993'>
        if(ix0.eq.nkr-1) goto 2020<a name='7994'>
        do i=nkr-1,1,-1<a name='7995'>
           ix1=i<a name='7996'>
           if(g(i).gt.gmin) goto 2010<a name='7997'>
        enddo<a name='7998'>
 2010   continue<a name='7999'>
<font color=#447700>! J. Dudhia gave reasons why this can't be looped with a<a name='8000'></font>
<font color=#447700>! multiprocessor.<a name='8001'></font>
<font color=#447700>! BARRY<a name='8002'></font>
<font color=#447700>!       do i=ix0,ix1<a name='8003'></font>
<font color=#447700>!          do j=i,ix1<a name='8004'></font>
        do i=ix0,ix1-1<a name='8005'>
           do j=i+1,ix1<a name='8006'>
<a name='8007'>
              k=ima(i,j)<a name='8008'>
              kp=k+1<a name='8009'>
              x0=ckxx(i,j)*g(i)*g(j)<a name='8010'>
              x0=min(x0,g(i)*x(j))<a name='8011'>
              if(j.ne.k) then<a name='8012'>
                x0=min(x0,g(j)*x(i))<a name='8013'>
              endif<a name='8014'>
              gsi=x0/x(j)<a name='8015'>
              gsj=x0/x(i)<a name='8016'>
              gsk=gsi+gsj<a name='8017'>
              g(i)=g(i)-gsi<a name='8018'>
              if(g(i).lt.0.d0) g(i)=0.d0<a name='8019'>
              g(j)=g(j)-gsj<a name='8020'>
              gk=g(k)+gsk<a name='8021'>
              if(g(j).lt.0.d0.and.gk.lt.gmin) then<a name='8022'>
                g(j)=0.d0<a name='8023'>
                g(k)=g(k)+gsi<a name='8024'>
              endif<a name='8025'>
              flux=0.d0<a name='8026'>
<font color=#447700>!<a name='8027'></font>
<font color=#447700>! BARRY<a name='8028'></font>
              if(gk.gt.gmin) then<a name='8029'>
                x1=dlog(g(kp)/gk+1.d-15)<a name='8030'>
               if (x1.eq.0)then<a name='8031'>
                flux=0  <a name='8032'>
               else<a name='8033'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8034'>
                flux=min(flux,gsk)<a name='8035'>
               end if<a name='8036'>
<a name='8037'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8038'></font>
                g(k)=gk-flux<a name='8039'>
                if(g(k).lt.0.d0) g(k)=0.d0<a name='8040'>
                g(kp)=g(kp)+flux<a name='8041'>
<font color=#447700>! in case gk &gt; gmin :<a name='8042'></font>
              endif<a name='8043'>
            end do<a name='8044'>
        end do<a name='8045'>
 2020   continue<a name='8046'>
        return<a name='8047'>
        end subroutine coll_xxx<a name='8048'>
<A NAME='COLL_XXX_PRD'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XXX_PRD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8049'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxx_prd</font> (g,ckxx,x,chucm,ima,prdkrn,nkr) <A href='../../call_to/COLL_XXX_PRD.html' TARGET='index'>2</A><a name='8050'>
        implicit double precision (a-h,o-z)<a name='8051'>
        dimension g(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='8052'>
        dimension chucm(nkr,nkr)<a name='8053'>
        double precision ima(nkr,nkr)<a name='8054'>
<font color=#447700>! this is character values containes adresses of temporary files      <a name='8055'></font>
        gmin=1.d-60<a name='8056'>
<font color=#447700>!       gmin=1.d-15<a name='8057'></font>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8058'></font>
        do i=1,nkr-1<a name='8059'>
           ix0=i<a name='8060'>
           if(g(i).gt.gmin) goto 2000<a name='8061'>
        enddo<a name='8062'>
 2000   continue<a name='8063'>
        if(ix0.eq.nkr-1) goto 2020<a name='8064'>
        do i=nkr-1,1,-1<a name='8065'>
           ix1=i<a name='8066'>
           if(g(i).gt.gmin) goto 2010<a name='8067'>
        enddo<a name='8068'>
 2010   continue<a name='8069'>
<font color=#447700>! J. Dudhia gave reasons why this can't be looped with a<a name='8070'></font>
<font color=#447700>! multiprocessor.<a name='8071'></font>
<font color=#447700>! BARRY<a name='8072'></font>
<font color=#447700>!       do i=ix0,ix1<a name='8073'></font>
<font color=#447700>!          do j=i,ix1<a name='8074'></font>
        do i=ix0,ix1-1<a name='8075'>
           do j=i+1,ix1<a name='8076'>
<a name='8077'>
              k=ima(i,j)<a name='8078'>
              kp=k+1<a name='8079'>
              x0=ckxx(i,j)*g(i)*g(j)*prdkrn<a name='8080'>
              x0=min(x0,g(i)*x(j))<a name='8081'>
              if(j.ne.k) then<a name='8082'>
                x0=min(x0,g(j)*x(i))<a name='8083'>
              endif<a name='8084'>
              gsi=x0/x(j)<a name='8085'>
              gsj=x0/x(i)<a name='8086'>
              gsk=gsi+gsj<a name='8087'>
              g(i)=g(i)-gsi<a name='8088'>
              if(g(i).lt.0.d0) g(i)=0.d0<a name='8089'>
              g(j)=g(j)-gsj<a name='8090'>
              gk=g(k)+gsk<a name='8091'>
              if(g(j).lt.0.d0.and.gk.lt.gmin) then<a name='8092'>
                g(j)=0.d0<a name='8093'>
                g(k)=g(k)+gsi<a name='8094'>
              endif<a name='8095'>
              flux=0.d0<a name='8096'>
<font color=#447700>!<a name='8097'></font>
<font color=#447700>! BARRY<a name='8098'></font>
              if(gk.gt.gmin) then<a name='8099'>
                x1=dlog(g(kp)/gk+1.d-15)<a name='8100'>
               if (x1.eq.0)then<a name='8101'>
                flux=0  <a name='8102'>
               else<a name='8103'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8104'>
                flux=min(flux,gsk)<a name='8105'>
               end if<a name='8106'>
<a name='8107'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8108'></font>
                g(k)=gk-flux<a name='8109'>
                if(g(k).lt.0.d0) g(k)=0.d0<a name='8110'>
                g(kp)=g(kp)+flux<a name='8111'>
<font color=#447700>! in case gk &gt; gmin :<a name='8112'></font>
              endif<a name='8113'>
            end do<a name='8114'>
        end do<a name='8115'>
 2020   continue<a name='8116'>
        return<a name='8117'>
        end subroutine coll_xxx_prd <a name='8118'>
<A NAME='MODKRN'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#MODKRN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8119'>
      <font color=#993300>subroutine </font><font color=#cc0000>modkrn</font>(TT,QQ,PP,PRDKRN,TTCOAL) <A href='../../call_to/MODKRN.html' TARGET='index'>2</A><a name='8120'>
      implicit none<a name='8121'>
      real epsf,tc,ttt1,ttt,factor,qs2,qq1,dele,f,factor_t<a name='8122'>
      double precision TT,QQ,PP,satq2,t,p<a name='8123'>
      double precision prdkrn<a name='8124'>
      REAL at,bt,ct,dt,temp,a,b,c,d,tc_min,tc_max<a name='8125'>
       real factor_max,factor_min<a name='8126'>
      REAL TTCOAL<a name='8127'>
	data at,bt,ct,dt/0.88333,0.0931878,0.0034793,4.5185186e-05/<a name='8128'>
        satq2(t,p)=3.80e3*(10**(9.76421-2667.1/t))/p<a name='8129'>
        temp(a,b,c,d,tc)=d*tc*tc*tc+c*tc*tc+b*tc+a<a name='8130'>
        IF (QQ.LE.0)QQ=1.E-12<a name='8131'>
        epsf    =.5<a name='8132'>
        tc      =tt-273.15<a name='8133'>
        factor=0 <font color=#447700>! mchen add temporarily<a name='8134'></font>
        if(tc.le.0) then<a name='8135'>
<font color=#447700>! in case tc.le.0<a name='8136'></font>
          ttt1  =temp(at,bt,ct,dt,tc)<a name='8137'>
          ttt   =ttt1<a name='8138'>
          qs2   =satq2(tt,pp)<a name='8139'>
          qq1   =qq*(0.622+0.378*qs2)/(0.622+0.378*qq)/qs2<a name='8140'>
          dele  =ttt*qq1<a name='8141'>
<font color=#447700>! new change 27.06.00<a name='8142'></font>
          if(tc.ge.-6.) then<a name='8143'>
            factor = dele<a name='8144'>
            if(factor.lt.epsf) factor=epsf<a name='8145'>
            if(factor.gt.1.) factor=1.<a name='8146'>
<font color=#447700>! in case : tc.ge.-6.<a name='8147'></font>
          endif                        <a name='8148'>
          factor_t=factor<a name='8149'>
          if(tc.ge.-12.5.and.tc.lt.-6.) factor_t=0.5<a name='8150'>
          if(tc.ge.-17.0.and.tc.lt.-12.5) factor_t=1.<a name='8151'>
          if(tc.ge.-20.0.and.tc.lt.-17.) factor_t=0.4<a name='8152'>
          if(tc.lt.-20.) then<a name='8153'>
            tc_min=ttcoal-273.15<a name='8154'>
            tc_max=-20.<a name='8155'>
            factor_max=0.25<a name='8156'>
            factor_min=0.<a name='8157'>
            f=factor_min+(tc-tc_min)*(factor_max-factor_min)/  &amp;<a name='8158'>
     &amp;                               (tc_max-tc_min)<a name='8159'>
            factor_t=f<a name='8160'>
          endif<a name='8161'>
<font color=#447700>! BARRY<a name='8162'></font>
          if (factor_t.lt.0)factor_t=0.01<a name='8163'>
          prdkrn=factor_t<a name='8164'>
      else<a name='8165'>
          prdkrn=1.d0<a name='8166'>
      end if<a name='8167'>
      RETURN<a name='8168'>
      END SUBROUTINE modkrn <a name='8169'>
           <a name='8170'>
<a name='8171'>
<a name='8172'>
<A NAME='COLL_XXY'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XXY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8173'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xxy</font>(gx,gy,ckxx,x,chucm,ima,prdkrn,nkr) <A href='../../call_to/COLL_XXY.html' TARGET='index'>3</A><a name='8174'>
        implicit double precision (a-h,o-z)<a name='8175'>
        dimension chucm(nkr,nkr)<a name='8176'>
        double precision ima(nkr,nkr)<a name='8177'>
        dimension  &amp;<a name='8178'>
     &amp;  gx(nkr),gy(nkr),ckxx(nkr,nkr),x(0:nkr)<a name='8179'>
        gmin=1.d-60<a name='8180'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8181'></font>
        do i=1,nkr-1<a name='8182'>
           ix0=i<a name='8183'>
           if(gx(i).gt.gmin) goto 2000<a name='8184'>
        enddo<a name='8185'>
        if(ix0.eq.nkr-1) goto 2020<a name='8186'>
 2000   continue<a name='8187'>
        do i=nkr-1,1,-1<a name='8188'>
           ix1=i<a name='8189'>
           if(gx(i).gt.gmin) goto 2010<a name='8190'>
        enddo<a name='8191'>
 2010   continue<a name='8192'>
<font color=#447700>! collisions<a name='8193'></font>
        do i=ix0,ix1<a name='8194'>
           do j=i,ix1<a name='8195'>
              k=ima(i,j)<a name='8196'>
              kp=k+1<a name='8197'>
              x0=ckxx(i,j)*gx(i)*gx(j)*prdkrn<a name='8198'>
              x0=min(x0,gx(i)*x(j))<a name='8199'>
              x0=min(x0,gx(j)*x(i))<a name='8200'>
              gsi=x0/x(j)<a name='8201'>
              gsj=x0/x(i)<a name='8202'>
              gsk=gsi+gsj<a name='8203'>
              gx(i)=gx(i)-gsi<a name='8204'>
              if(gx(i).lt.0.d0) gx(i)=0.d0<a name='8205'>
              gx(j)=gx(j)-gsj<a name='8206'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='8207'>
              gk=gy(k)+gsk<a name='8208'>
              flux=0.d0<a name='8209'>
<font color=#447700>! BARRY<a name='8210'></font>
              if(gk.gt.gmin) then<a name='8211'>
<font color=#447700>! new changes 13.01.01 (begin)<a name='8212'></font>
                x1=dlog(gy(kp)/gk+1.d-15)<a name='8213'>
<font color=#447700>! BARRY<a name='8214'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8215'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8216'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8217'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8218'></font>
<font color=#447700>! new changes 23.01.01 (end)<a name='8219'></font>
<font color=#447700>! new changes 13.01.01 (end)<a name='8220'></font>
<font color=#447700>! BARRY<a name='8221'></font>
               if (x1.eq.0)then<a name='8222'>
                flux=0  <a name='8223'>
               else<a name='8224'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8225'>
                flux=min(flux,gsk)<a name='8226'>
               end if<a name='8227'>
                gy(k)=gk-flux<a name='8228'>
                if(gy(k).lt.0.d0) gy(k)=0.d0<a name='8229'>
                gy(kp)=gy(kp)+flux<a name='8230'>
<font color=#447700>! in case gk &gt; gmin :<a name='8231'></font>
              endif<a name='8232'>
           enddo<a name='8233'>
        enddo<a name='8234'>
 2020   continue<a name='8235'>
        return<a name='8236'>
        end subroutine coll_xxy<a name='8237'>
<font color=#447700>!====================================================================<a name='8238'></font>
<A NAME='COLL_XYY'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XYY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8239'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyy</font>(gx,gy,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYY.html' TARGET='index'>6</A><a name='8240'>
     &amp;     prdkrn,nkr,indc)<a name='8241'>
        implicit double precision (a-h,o-z)<a name='8242'>
        dimension  &amp;<a name='8243'>
     &amp;  gy(nkr),gx(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8244'>
        dimension chucm(nkr,nkr)<a name='8245'>
        double precision ima(nkr,nkr)<a name='8246'>
        gmin=1.d-60<a name='8247'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8248'></font>
        do i=1,nkr-1<a name='8249'>
           ix0=i<a name='8250'>
           if(gx(i).gt.gmin) go to 2000<a name='8251'>
        enddo<a name='8252'>
 2000   continue<a name='8253'>
        if(ix0.eq.nkr-1) goto 2020<a name='8254'>
        do i=nkr-1,1,-1<a name='8255'>
           ix1=i<a name='8256'>
           if(gx(i).gt.gmin) go to 2010<a name='8257'>
        enddo<a name='8258'>
 2010   continue<a name='8259'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8260'></font>
        do i=1,nkr-1<a name='8261'>
           iy0=i<a name='8262'>
           if(gy(i).gt.gmin) go to 2001<a name='8263'>
        enddo<a name='8264'>
 2001   continue<a name='8265'>
        if(iy0.eq.nkr-1) goto 2020<a name='8266'>
        do i=nkr-1,1,-1<a name='8267'>
           iy1=i<a name='8268'>
           if(gy(i).gt.gmin) go to 2011<a name='8269'>
        enddo<a name='8270'>
 2011   continue<a name='8271'>
<font color=#447700>! collisions :<a name='8272'></font>
        do i=iy0,iy1<a name='8273'>
           jmin=i<a name='8274'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8275'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8276'>
	   do j=jmin+indc,ix1         <a name='8277'>
              k=ima(i,j)<a name='8278'>
              kp=k+1<a name='8279'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8280'>
              x0=min(x0,gy(i)*x(j))<a name='8281'>
              x0=min(x0,gx(j)*y(i))<a name='8282'>
              gsi=x0/x(j)<a name='8283'>
              gsj=x0/y(i)<a name='8284'>
              gsk=gsi+gsj<a name='8285'>
              gy(i)=gy(i)-gsi<a name='8286'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8287'>
              gx(j)=gx(j)-gsj<a name='8288'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='8289'>
              gk=gy(k)+gsk<a name='8290'>
              flux=0.d0<a name='8291'>
<font color=#447700>! BARRY<a name='8292'></font>
              if(gk.gt.gmin) then<a name='8293'>
                x1=dlog(gy(kp)/gk+1.d-15)<a name='8294'>
<font color=#447700>! BARRY<a name='8295'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8296'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8297'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8298'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8299'></font>
<font color=#447700>! BARRY<a name='8300'></font>
               if (x1.eq.0)then<a name='8301'>
                flux=0  <a name='8302'>
               else<a name='8303'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8304'>
                flux=min(flux,gsk)<a name='8305'>
               end if<a name='8306'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8307'></font>
                gy(k)=gk-flux<a name='8308'>
                if(gy(k).lt.0.d0) gy(k)=0.d0<a name='8309'>
                gy(kp)=gy(kp)+flux<a name='8310'>
<font color=#447700>! in case gk &gt; gmin :<a name='8311'></font>
              endif<a name='8312'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8313'></font>
           enddo<a name='8314'>
        enddo<a name='8315'>
 2020   continue<a name='8316'>
        return<a name='8317'>
        end subroutine coll_xyy<a name='8318'>
<font color=#447700>!=================================================================<a name='8319'></font>
<A NAME='COLL_XYX'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XYX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8320'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyx</font>(gx,gy,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYX.html' TARGET='index'>12</A><a name='8321'>
     &amp;    prdkrn,nkr,indc)<a name='8322'>
        implicit double precision (a-h,o-z)<a name='8323'>
        dimension gy(nkr),gx(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8324'>
        dimension chucm(nkr,nkr)<a name='8325'>
        double precision ima(nkr,nkr)<a name='8326'>
        gmin=1.d-60<a name='8327'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8328'></font>
        do i=1,nkr-1<a name='8329'>
           ix0=i<a name='8330'>
           if(gx(i).gt.gmin) go to 2000<a name='8331'>
        enddo<a name='8332'>
 2000   continue<a name='8333'>
        if(ix0.eq.nkr-1) goto 2020<a name='8334'>
        do i=nkr-1,1,-1<a name='8335'>
           ix1=i<a name='8336'>
           if(gx(i).gt.gmin) go to 2010<a name='8337'>
        enddo<a name='8338'>
 2010   continue<a name='8339'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8340'></font>
        do i=1,nkr-1<a name='8341'>
           iy0=i<a name='8342'>
           if(gy(i).gt.gmin) go to 2001<a name='8343'>
        enddo<a name='8344'>
 2001   continue<a name='8345'>
        if(iy0.eq.nkr-1) goto 2020<a name='8346'>
        do i=nkr-1,1,-1<a name='8347'>
           iy1=i<a name='8348'>
           if(gy(i).gt.gmin) go to 2011<a name='8349'>
        enddo<a name='8350'>
 2011   continue<a name='8351'>
<font color=#447700>! collisions :<a name='8352'></font>
        do i=iy0,iy1<a name='8353'>
           jmin=i<a name='8354'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8355'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8356'>
	   do j=jmin+indc,ix1<a name='8357'>
              k=ima(i,j)<a name='8358'>
              kp=k+1<a name='8359'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8360'>
              x0=min(x0,gy(i)*x(j))<a name='8361'>
              if(j.ne.k) then<a name='8362'>
                x0=min(x0,gx(j)*y(i))<a name='8363'>
              endif<a name='8364'>
              gsi=x0/x(j)<a name='8365'>
              gsj=x0/y(i)<a name='8366'>
              gsk=gsi+gsj<a name='8367'>
              gy(i)=gy(i)-gsi<a name='8368'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8369'>
              gx(j)=gx(j)-gsj<a name='8370'>
              gk=gx(k)+gsk<a name='8371'>
<font color=#447700>! BARRY<a name='8372'></font>
<font color=#447700>!             if(gx(j).lt.0.d0)then<a name='8373'></font>
<font color=#447700>!                gy(i)=gy(i)+gsi<a name='8374'></font>
<font color=#447700>!                gx(j)=gx(j)+gsj<a name='8375'></font>
<font color=#447700>!                go to 10<a name='8376'></font>
<font color=#447700>!             end if<a name='8377'></font>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='8378'>
                gx(j)=0.d0<a name='8379'>
                gx(k)=gx(k)+gsi<a name='8380'>
              endif<a name='8381'>
              flux=0.d0            <a name='8382'>
<font color=#447700>! BARRY<a name='8383'></font>
              if(gk.gt.gmin) then<a name='8384'>
                x1=dlog(gx(kp)/gk+1.d-15)<a name='8385'>
<font color=#447700>! BARRY<a name='8386'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8387'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8388'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8389'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8390'></font>
<font color=#447700>! BARRY<a name='8391'></font>
               if (x1.eq.0)then<a name='8392'>
                flux=0  <a name='8393'>
               else<a name='8394'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8395'>
                flux=min(flux,gsk)<a name='8396'>
               end if<a name='8397'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8398'></font>
                gx(k)=gk-flux<a name='8399'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='8400'>
                gx(kp)=gx(kp)+flux<a name='8401'>
<font color=#447700>! in case gk &gt; gmin :<a name='8402'></font>
              endif<a name='8403'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8404'></font>
<font color=#447700>! BARRY<a name='8405'></font>
10         continue<a name='8406'>
           enddo<a name='8407'>
        enddo<a name='8408'>
 2020   continue<a name='8409'>
        return<a name='8410'>
        end subroutine coll_xyx<a name='8411'>
<font color=#447700>!=====================================================================<a name='8412'></font>
<A NAME='COLL_XYXZ'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XYXZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8413'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyxz</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYXZ.html' TARGET='index'>3</A><a name='8414'>
     &amp;    prdkrn,nkr,indc)<a name='8415'>
        implicit double precision (a-h,o-z)<a name='8416'>
      dimension gy(nkr),gx(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8417'>
        dimension chucm(nkr,nkr)<a name='8418'>
        double precision ima(nkr,nkr)<a name='8419'>
        gmin=1.d-60<a name='8420'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8421'></font>
        do i=1,nkr-1<a name='8422'>
           ix0=i<a name='8423'>
           if(gx(i).gt.gmin) go to 2000<a name='8424'>
        enddo<a name='8425'>
 2000   continue<a name='8426'>
        if(ix0.eq.nkr-1) goto 2020<a name='8427'>
        do i=nkr-1,1,-1<a name='8428'>
           ix1=i<a name='8429'>
           if(gx(i).gt.gmin) go to 2010<a name='8430'>
        enddo<a name='8431'>
 2010   continue<a name='8432'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8433'></font>
        do i=1,nkr-1<a name='8434'>
           iy0=i<a name='8435'>
           if(gy(i).gt.gmin) go to 2001<a name='8436'>
        enddo<a name='8437'>
 2001   continue<a name='8438'>
        if(iy0.eq.nkr-1) goto 2020<a name='8439'>
        do i=nkr-1,1,-1<a name='8440'>
           iy1=i<a name='8441'>
           if(gy(i).gt.gmin) go to 2011<a name='8442'>
        enddo<a name='8443'>
 2011   continue<a name='8444'>
<font color=#447700>! collisions :<a name='8445'></font>
        do i=iy0,iy1<a name='8446'>
           jmin=i<a name='8447'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8448'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8449'>
	   do j=jmin+indc,ix1<a name='8450'>
              k=ima(i,j)<a name='8451'>
              kp=k+1<a name='8452'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8453'>
              x0=min(x0,gy(i)*x(j))<a name='8454'>
              if(j.ne.k) then<a name='8455'>
                x0=min(x0,gx(j)*y(i))<a name='8456'>
              endif<a name='8457'>
              gsi=x0/x(j)<a name='8458'>
              gsj=x0/y(i)<a name='8459'>
              gsk=gsi+gsj<a name='8460'>
              gy(i)=gy(i)-gsi<a name='8461'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8462'>
              gx(j)=gx(j)-gsj<a name='8463'>
              gk=gx(k)+gsk<a name='8464'>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='8465'>
                gx(j)=0.d0<a name='8466'>
                gx(k)=gx(k)+gsi<a name='8467'>
              endif<a name='8468'>
              flux=0.d0<a name='8469'>
<font color=#447700>! BARRY<a name='8470'></font>
              if(kp.lt.17) gkp=gx(kp)<a name='8471'>
              if(kp.ge.17) gkp=gz(kp)<a name='8472'>
              if(gk.gt.gmin) then<a name='8473'>
                x1=dlog(gkp/gk+1.d-15)<a name='8474'>
<font color=#447700>! BARRY<a name='8475'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8476'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8477'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8478'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8479'></font>
<font color=#447700>! BARRY<a name='8480'></font>
               if (x1.eq.0)then<a name='8481'>
                flux=0  <a name='8482'>
               else<a name='8483'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8484'>
                flux=min(flux,gsk)<a name='8485'>
               end if<a name='8486'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8487'></font>
                gx(k)=gk-flux<a name='8488'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='8489'>
                if(kp.lt.17) gx(kp)=gkp+flux<a name='8490'>
                if(kp.ge.17) gz(kp)=gkp+flux<a name='8491'>
<font color=#447700>! ALEX 15 11 2005<a name='8492'></font>
<font color=#447700>!               if(kp.ge.17) gx(kp)=gkp+flux<a name='8493'></font>
<font color=#447700>! in case gk &gt; gmin :<a name='8494'></font>
              endif<a name='8495'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8496'></font>
           enddo<a name='8497'>
        enddo<a name='8498'>
 2020   continue<a name='8499'>
        return<a name='8500'>
        end subroutine coll_xyxz<a name='8501'>
<font color=#447700>!=====================================================================<a name='8502'></font>
<A NAME='COLL_XYXZ_H'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XYXZ_H' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8503'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyxz_h</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYXZ_H.html' TARGET='index'>3</A><a name='8504'>
     &amp;    prdkrn,nkr,indc)<a name='8505'>
        implicit double precision (a-h,o-z)<a name='8506'>
      dimension gy(nkr),gx(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8507'>
        dimension chucm(nkr,nkr)<a name='8508'>
        double precision ima(nkr,nkr)<a name='8509'>
        gmin=1.d-60<a name='8510'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8511'></font>
        do i=1,nkr-1<a name='8512'>
           ix0=i<a name='8513'>
           if(gx(i).gt.gmin) go to 2000<a name='8514'>
        enddo<a name='8515'>
 2000   continue<a name='8516'>
        if(ix0.eq.nkr-1) goto 2020<a name='8517'>
        do i=nkr-1,1,-1<a name='8518'>
           ix1=i<a name='8519'>
           if(gx(i).gt.gmin) go to 2010<a name='8520'>
        enddo<a name='8521'>
 2010   continue<a name='8522'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8523'></font>
        do i=1,nkr-1<a name='8524'>
           iy0=i<a name='8525'>
           if(gy(i).gt.gmin) go to 2001<a name='8526'>
        enddo<a name='8527'>
 2001   continue<a name='8528'>
        if(iy0.eq.nkr-1) goto 2020<a name='8529'>
        do i=nkr-1,1,-1<a name='8530'>
           iy1=i<a name='8531'>
           if(gy(i).gt.gmin) go to 2011<a name='8532'>
        enddo<a name='8533'>
 2011   continue<a name='8534'>
<font color=#447700>! collisions :<a name='8535'></font>
        do i=iy0,iy1<a name='8536'>
           jmin=i<a name='8537'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8538'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8539'>
	   do j=jmin+indc,ix1<a name='8540'>
              k=ima(i,j)<a name='8541'>
              kp=k+1<a name='8542'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8543'>
              x0=min(x0,gy(i)*x(j))<a name='8544'>
              if(j.ne.k) then<a name='8545'>
                x0=min(x0,gx(j)*y(i))<a name='8546'>
              endif<a name='8547'>
              gsi=x0/x(j)<a name='8548'>
              gsj=x0/y(i)<a name='8549'>
              gsk=gsi+gsj<a name='8550'>
              gy(i)=gy(i)-gsi<a name='8551'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8552'>
              gx(j)=gx(j)-gsj<a name='8553'>
              gk=gx(k)+gsk<a name='8554'>
              if(gx(j).lt.0.d0.and.gk.lt.gmin) then<a name='8555'>
                gx(j)=0.d0<a name='8556'>
                gx(k)=gx(k)+gsi<a name='8557'>
              endif<a name='8558'>
              flux=0.d0<a name='8559'>
<font color=#447700>! BARRY<a name='8560'></font>
              if(kp.lt.22) gkp=gx(kp)<a name='8561'>
              if(kp.ge.22) gkp=gz(kp)<a name='8562'>
              if(gk.gt.gmin) then<a name='8563'>
                x1=dlog(gkp/gk+1.d-15)<a name='8564'>
<font color=#447700>! BARRY<a name='8565'></font>
<font color=#447700>!               flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8566'></font>
<font color=#447700>! new changes 23.01.01 (begin)<a name='8567'></font>
<font color=#447700>!               flux=min(flux,gk)<a name='8568'></font>
<font color=#447700>!               flux=min(flux,gsk)<a name='8569'></font>
<font color=#447700>! BARRY<a name='8570'></font>
               if (x1.eq.0)then<a name='8571'>
                flux=0  <a name='8572'>
               else<a name='8573'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8574'>
                flux=min(flux,gsk)<a name='8575'>
               end if<a name='8576'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8577'></font>
                gx(k)=gk-flux<a name='8578'>
                if(gx(k).lt.0.d0) gx(k)=0.d0<a name='8579'>
                if(kp.lt.22) gx(kp)=gkp+flux<a name='8580'>
                if(kp.ge.22) gz(kp)=gkp+flux<a name='8581'>
<font color=#447700>! ALEX 15 11 2005<a name='8582'></font>
<font color=#447700>!               if(kp.ge.25) gx(kp)=gkp+flux<a name='8583'></font>
<font color=#447700>! in case gk &gt; gmin :<a name='8584'></font>
              endif<a name='8585'>
<font color=#447700>! in case gk &gt; gmin or gk.le.gmin<a name='8586'></font>
           enddo<a name='8587'>
        enddo<a name='8588'>
 2020   continue<a name='8589'>
        return<a name='8590'>
        end subroutine coll_xyxz_h<a name='8591'>
<font color=#447700>!=====================================================================<a name='8592'></font>
<A NAME='COLL_XYZ'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#COLL_XYZ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8593'>
        <font color=#993300>subroutine </font><font color=#cc0000>coll_xyz</font>(gx,gy,gz,ckxy,x,y,chucm,ima, &amp; <A href='../../call_to/COLL_XYZ.html' TARGET='index'>14</A><a name='8594'>
     &amp;                      prdkrn,nkr,indc)<a name='8595'>
        implicit double precision (a-h,o-z)<a name='8596'>
      dimension gx(nkr),gy(nkr),gz(nkr),ckxy(nkr,nkr),x(0:nkr),y(0:nkr)<a name='8597'>
        dimension chucm(nkr,nkr)<a name='8598'>
        double precision ima(nkr,nkr)<a name='8599'>
        gmin=1.d-60<a name='8600'>
<font color=#447700>! lower and upper integration limit ix0,ix1<a name='8601'></font>
        do i=1,nkr-1<a name='8602'>
           ix0=i<a name='8603'>
           if(gx(i).gt.gmin) go to 2000<a name='8604'>
        enddo<a name='8605'>
 2000   continue<a name='8606'>
        if(ix0.eq.nkr-1) goto 2020<a name='8607'>
        do i=nkr-1,1,-1<a name='8608'>
           ix1=i<a name='8609'>
           if(gx(i).gt.gmin) go to 2010<a name='8610'>
        enddo<a name='8611'>
 2010   continue<a name='8612'>
<font color=#447700>! lower and upper integration limit iy0,iy1<a name='8613'></font>
        do i=1,nkr-1<a name='8614'>
           iy0=i<a name='8615'>
           if(gy(i).gt.gmin) go to 2001<a name='8616'>
        enddo<a name='8617'>
 2001   continue<a name='8618'>
        if(iy0.eq.nkr-1) goto 2020<a name='8619'>
        do i=nkr-1,1,-1<a name='8620'>
           iy1=i<a name='8621'>
           if(gy(i).gt.gmin) go to 2011<a name='8622'>
        enddo<a name='8623'>
 2011   continue<a name='8624'>
<font color=#447700>! collisions :<a name='8625'></font>
        do i=iy0,iy1<a name='8626'>
           jmin=i<a name='8627'>
           if(jmin.eq.(nkr-1)) goto 2020<a name='8628'>
           if(i.lt.ix0) jmin=ix0-indc<a name='8629'>
	   do j=jmin+indc,ix1         <a name='8630'>
              k=ima(i,j)<a name='8631'>
              kp=k+1<a name='8632'>
              x0=ckxy(j,i)*gy(i)*gx(j)*prdkrn<a name='8633'>
              x0=min(x0,gy(i)*x(j))<a name='8634'>
              x0=min(x0,gx(j)*y(i))<a name='8635'>
              gsi=x0/x(j)<a name='8636'>
              gsj=x0/y(i)<a name='8637'>
              gsk=gsi+gsj<a name='8638'>
              gy(i)=gy(i)-gsi<a name='8639'>
              if(gy(i).lt.0.d0) gy(i)=0.d0<a name='8640'>
              gx(j)=gx(j)-gsj<a name='8641'>
              if(gx(j).lt.0.d0) gx(j)=0.d0<a name='8642'>
              gk=gz(k)+gsk<a name='8643'>
              flux=0.d0<a name='8644'>
<font color=#447700>! BARRY<a name='8645'></font>
              if(gk.gt.gmin) then<a name='8646'>
                x1=dlog(gz(kp)/gk+1.d-15)<a name='8647'>
<font color=#447700>! BARRY<a name='8648'></font>
               if (x1.eq.0)then<a name='8649'>
                flux=0  <a name='8650'>
               else<a name='8651'>
                flux=gsk/x1*(dexp(0.5*x1)-dexp(x1*(0.5-chucm(i,j))))<a name='8652'>
                flux=min(flux,gsk)<a name='8653'>
               end if<a name='8654'>
<font color=#447700>! new changes 23.01.01 (end)<a name='8655'></font>
                gz(k)=gk-flux<a name='8656'>
                if(gz(k).lt.0.d0) gz(k)=0.d0<a name='8657'>
                gz(kp)=gz(kp)+flux<a name='8658'>
<font color=#447700>! in case gk &gt; gmin :<a name='8659'></font>
              endif<a name='8660'>
           enddo<a name='8661'>
        enddo<a name='8662'>
 2020   continue<a name='8663'>
        return<a name='8664'>
        end subroutine coll_xyz<a name='8665'>
<font color=#447700>!===============================================================<a name='8666'></font>
<font color=#447700>!****************************************************************<a name='8667'></font>
<font color=#447700>! SEE /include/microhucm.incl for setting of krdrop and krbreak<a name='8668'></font>
<font color=#447700>!****************************************************************<a name='8669'></font>
<A NAME='BREAKUP'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#BREAKUP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8670'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BREAKUP</font>(GT_MG,XT_MG,DT,BRKWEIGHT, &amp; <A href='../../call_to/BREAKUP.html' TARGET='index'>3</A><a name='8671'>
     &amp;           PKIJ,QKJ,JMAX,JBREAK)<a name='8672'>
<font color=#447700>!     SUBROUTINE BREAKUP(GT_MG,DT,JMAX,JBREAK)<a name='8673'></font>
<font color=#447700>!     implicit double precision (a-h,o-z)<a name='8674'></font>
<a name='8675'>
<font color=#447700>!.....INPUT VARIABLES<a name='8676'></font>
<font color=#447700>!<a name='8677'></font>
<font color=#447700>!     GT    : MASS DISTRIBUTION FUNCTION<a name='8678'></font>
<font color=#447700>!     XT_MG : MASS OF BIN IN MG<a name='8679'></font>
<font color=#447700>!     JMAX  : NUMBER OF BINS<a name='8680'></font>
<font color=#447700>!     DT    : TIMESTEP IN S<a name='8681'></font>
<a name='8682'>
      INTEGER JMAX<a name='8683'>
<a name='8684'>
<font color=#447700>!.....LOCAL VARIABLES<a name='8685'></font>
<a name='8686'>
      LOGICAL LTHAN<a name='8687'>
      INTEGER JBREAK,AP,IA,JA,KA,IE,JE,KE<a name='8688'>
      DOUBLE PRECISION EPS,NEGSUM<a name='8689'>
<a name='8690'>
      PARAMETER (AP = 1)<a name='8691'>
      PARAMETER (IA = 1)<a name='8692'>
      PARAMETER (JA = 1)<a name='8693'>
      PARAMETER (KA = 1)<a name='8694'>
      PARAMETER (EPS = 1.D-20)<a name='8695'>
<a name='8696'>
      INTEGER I,J,K,JJ,JDIFF<a name='8697'>
      DOUBLE PRECISION GT_MG(JMAX),XT_MG(0:JMAX),DT<a name='8698'>
<font color=#447700>!     xl_mg(0:nkr)<a name='8699'></font>
      DOUBLE PRECISION BRKWEIGHT(JBREAK),PKIJ(JBREAK,JBREAK,JBREAK), &amp;<a name='8700'>
     &amp;    QKJ(JBREAK,JBREAK)<a name='8701'>
      DOUBLE PRECISION D0,ALM,HLP(JMAX)<a name='8702'>
      DOUBLE PRECISION FT(JMAX),FA(JMAX)<a name='8703'>
      DOUBLE PRECISION DG(JMAX),DF(JMAX),DBREAK(JBREAK),GAIN,LOSS<a name='8704'>
      REAL PI<a name='8705'>
      PARAMETER (PI = 3.1415927)<a name='8706'>
      INTEGER IP,KP,JP,KQ,JQ<a name='8707'>
      IE = JBREAK<a name='8708'>
      JE = JBREAK<a name='8709'>
      KE = JBREAK<a name='8710'>
<a name='8711'>
<a name='8712'>
<a name='8713'>
<a name='8714'>
<a name='8715'>
<a name='8716'>
<a name='8717'>
<font color=#447700>!.....IN CGS<a name='8718'></font>
<a name='8719'>
<font color=#447700>!     DO J=1,JMAX<a name='8720'></font>
<font color=#447700>!        XT(J) = XT_MG(J) * 1E-3<a name='8721'></font>
<font color=#447700>!        GT_MG(J) = GT_MG(J)* 1E-3<a name='8722'></font>
<font color=#447700>!     ENDDO<a name='8723'></font>
<a name='8724'>
<font color=#447700>!.....SHIFT BETWEEN COAGULATION AND BREAKUP GRID<a name='8725'></font>
<a name='8726'>
      JDIFF = JMAX - JBREAK<a name='8727'>
<font color=#447700>!       14  =  33  - 19<a name='8728'></font>
<a name='8729'>
<font color=#447700>!.....INITIALIZATION<a name='8730'></font>
<a name='8731'>
<font color=#447700>!.....TRANSFORMATION FROM G(LN X) = X**2 F(X) TO F(X)<a name='8732'></font>
      DO J=1,JMAX<a name='8733'>
         FT(J) = GT_MG(J) / XT_MG(J)**2<a name='8734'>
      ENDDO<a name='8735'>
<a name='8736'>
<font color=#447700>!.....SHIFT TO BREAKUP GRID<a name='8737'></font>
<a name='8738'>
      DO K=1,KE<a name='8739'>
         FA(K) = FT(K+JDIFF)<a name='8740'>
      ENDDO<a name='8741'>
<a name='8742'>
<font color=#447700>!.....BREAKUP: BLECK'S FIRST ORDER METHOD<a name='8743'></font>
<font color=#447700>!<a name='8744'></font>
<font color=#447700>!     PKIJ: GAIN COEFFICIENTS<a name='8745'></font>
<font color=#447700>!     QKJ : LOSS COEFFICIENTS<a name='8746'></font>
<font color=#447700>!<a name='8747'></font>
<a name='8748'>
      DO K=1,KE<a name='8749'>
         GAIN = 0.0<a name='8750'>
         DO I=1,IE<a name='8751'>
            DO J=1,I<a name='8752'>
               GAIN = GAIN + FA(I)*FA(J)*PKIJ(K,I,J)<a name='8753'>
            ENDDO<a name='8754'>
         ENDDO<a name='8755'>
         LOSS = 0.0<a name='8756'>
         DO J=1,JE<a name='8757'>
            LOSS = LOSS + FA(J)*QKJ(K,J)<a name='8758'>
         ENDDO<a name='8759'>
         DBREAK(K) = BRKWEIGHT(K) * (GAIN - FA(K)*LOSS)<a name='8760'>
      ENDDO<a name='8761'>
<a name='8762'>
<font color=#447700>!.....SHIFT RATE TO COAGULATION GRID<a name='8763'></font>
<a name='8764'>
      DO J=1,JDIFF<a name='8765'>
         DF(J) = 0.0<a name='8766'>
      ENDDO<a name='8767'>
      DO J=1,KE<a name='8768'>
         DF(J+JDIFF) = DBREAK(J)<a name='8769'>
      ENDDO<a name='8770'>
<font color=#447700>!.....TRANSFORMATION TO MASS DISTRIBUTION FUNCTION G(LN X)<a name='8771'></font>
<a name='8772'>
      DO J=1,JMAX<a name='8773'>
         DG(J) = DF(J) * XT_MG(J)**2<a name='8774'>
      ENDDO<a name='8775'>
<a name='8776'>
<font color=#447700>!.....TIME INTEGRATION<a name='8777'></font>
<a name='8778'>
      DO J=1,JMAX<a name='8779'>
      HLP(J) = 0.0<a name='8780'>
      NEGSUM = 0.0<a name='8781'>
         GT_MG(J) = GT_MG(J) + DG(J) * DT<a name='8782'>
         IF (GT_MG(J).LT.0) THEN<a name='8783'>
            HLP(J) = MIN(GT_MG(J),HLP(J))<a name='8784'>
            GT_MG(J) = EPS<a name='8785'>
<font color=#447700>!           NEGSUM = NEGSUM+GT_MG(J)<a name='8786'></font>
<font color=#447700>!           GT_MG(J) = 0.D0<a name='8787'></font>
         ENDIF<a name='8788'>
      ENDDO<a name='8789'>
<font color=#447700>!     DO J=1,JMAX<a name='8790'></font>
<font color=#447700>!      IF (HLP(J).LT.0.) THEN<a name='8791'></font>
<font color=#447700>!        GT_MG(J-1)=GT_MG(J-1)-NEGSUM -EPS<a name='8792'></font>
<font color=#447700>!      END IF<a name='8793'></font>
<font color=#447700>!      GO TO 10<a name='8794'></font>
<font color=#447700>!     END DO<a name='8795'></font>
<font color=#447700>!10    CONTINUE<a name='8796'></font>
<font color=#447700>!     IF (HLP.LT.-1E-7) THEN<a name='8797'></font>
<font color=#447700>! BARRY<a name='8798'></font>
<font color=#447700>!     LTHAN=.FALSE.<a name='8799'></font>
<font color=#447700>!     DO J=1,JMAX<a name='8800'></font>
<font color=#447700>!      IF (HLP(J).LT.0.OR.LTHAN) THEN<a name='8801'></font>
<font color=#447700>!        WRITE (*,'(1X,A,E10.4)')<a name='8802'></font>
<font color=#447700>!    F        'COLL_BREAKUP: WARNING! G(J) &lt; 0, MIN = ' <a name='8803'></font>
<font color=#447700>!        IF(HLP(J).LT.0.OR.LTHAN)WRITE(6,*)<a name='8804'></font>
<font color=#447700>!    F      'J,G(J)  = ',J,HLP(J),GT_MG(J)<a name='8805'></font>
<font color=#447700>!        LTHAN=.TRUE.  C     ENDIF<a name='8806'></font>
<font color=#447700>!     END DO<a name='8807'></font>
<a name='8808'>
<font color=#447700>!     DO J=1,JMAX<a name='8809'></font>
<font color=#447700>!        GT_MG(J) = GT_MG(J) * 1E3<a name='8810'></font>
<font color=#447700>!     ENDDO<a name='8811'></font>
<a name='8812'>
<font color=#447700>!.....THAT'S IT<a name='8813'></font>
      RETURN<a name='8814'>
<a name='8815'>
      END SUBROUTINE BREAKUP<a name='8816'>
<a name='8817'>
<A NAME='BOUNDNUM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#BOUNDNUM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8818'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BOUNDNUM</font>(MASSMM5,FCONC,RHOX,COL,NZERO, &amp;,<A href='../../call_from/BOUNDNUM.html' TARGET='index'>2</A><a name='8819'>
     &amp;       RADXX,MASSXX,HYDROSUM, &amp;<a name='8820'>
     &amp;       NKR)<a name='8821'>
      IMPLICIT NONE<a name='8822'>
     <a name='8823'>
      INTEGER NKR,NKRI,KRBEG,KREND,IP,IPCNT<a name='8824'>
      REAL NZERO,LAMBDAHYD,MASSMM5,RHOX,HYDROMASS,COL<a name='8825'>
      REAL RADXX(NKR),MASSXX(NKR)<a name='8826'>
      REAL TERM1,TERM2A,TERM2B,TERM2C<a name='8827'>
      REAL FCONC(NKR),HYDROSUM <a name='8828'>
      DOUBLE PRECISION D1,D2,D3,D4,D5,D6,D7A,D7B <a name='8829'>
      DOUBLE PRECISION VAR1,VAR2,VAR3,VAR4,VAR5,VAR6<a name='8830'>
<font color=#447700>!     HYDROMASS IN kg/kg<a name='8831'></font>
<font color=#447700>!     VAR1=NZERO           <a name='8832'></font>
<font color=#447700>!     VAR2=RHOX            <a name='8833'></font>
<font color=#447700>!     VAR3=MASSXX(1,IHYDR)<a name='8834'></font>
<font color=#447700>!     VAR4=RADXX(1,IHYDR)<a name='8835'></font>
<font color=#447700>!     VAR5=MASSMM5       <a name='8836'></font>
<font color=#447700>!     VAR6=(6.*VAR1/VAR2)*VAR3/(8.*VAR4**3)*(1./VAR5)<a name='8837'></font>
<font color=#447700>!     var6 =sqrt(sqrt(var6))<a name='8838'></font>
<font color=#447700>!     print*,'radxx(1) = ',RADXX(1)<a name='8839'></font>
<font color=#447700>!     print*,'rhox = ',rhox<a name='8840'></font>
<font color=#447700>!     print*,'massmm5 = ',massmm5<a name='8841'></font>
<font color=#447700>!     print*,'nzero = ',nzerO<a name='8842'></font>
<font color=#447700>!     print*,'massxx = ',MASSXX(1)<a name='8843'></font>
      LAMBDAHYD=(6.*NZERO/RHOX)*MASSXX(1)/(8.*RADXX(1)**3) &amp;<a name='8844'>
     &amp;     *(1./MASSMM5)<a name='8845'>
      LAMBDAHYD=SQRT(SQRT(LAMBDAHYD))<a name='8846'>
      HYDROSUM  =0<a name='8847'>
      TERM1=(NZERO/RHOX)*(MASSXX(1)/(8.*RADXX(1)**3))<a name='8848'>
      DO NKRI=1,NKR<a name='8849'>
       IF(NKRI.EQ.1)THEN<a name='8850'>
        D1=LAMBDAHYD*2.*RADXX(NKRI)<a name='8851'>
        D2=0<a name='8852'>
       ELSE<a name='8853'>
        D1=LAMBDAHYD*2.*RADXX(NKRI)<a name='8854'>
        D2=LAMBDAHYD*2.*RADXX(NKRI-1)<a name='8855'>
       END IF<a name='8856'>
       D3=DEXP(-D1)<a name='8857'>
       D4=DEXP(-D2)<a name='8858'>
       D5 = (1./LAMBDAHYD**4)<a name='8859'>
       D6=TERM1<a name='8860'>
       IF (NKRI.EQ.1)THEN<a name='8861'>
        D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='8862'>
        D7B=-6.*D5<a name='8863'>
       ELSE<a name='8864'>
        D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='8865'>
        D7B= -D5*D4*(D2**3+3.*D2**2+6.*D2+6)<a name='8866'>
       END IF<a name='8867'>
       HYDROMASS= D6*(D7A-D7B)<a name='8868'>
       HYDROSUM=HYDROSUM+HYDROMASS   <a name='8869'>
       FCONC(NKRI)=HYDROMASS*RHOX/(COL  &amp;<a name='8870'>
     &amp;          *MASSXX(NKRI)*MASSXX(NKRI)*3)<a name='8871'>
        IF (HYDROMASS .LT.0)THEN<a name='8872'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/phys/module_mp_full_sbm.F.html#BOUNDNUM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_770">("fatal error in module_mp_fast_sbm,(HYDROMASS.LT.0) , model stop")<a name='8873'>
        END IF<a name='8874'>
      END DO<a name='8875'>
<font color=#447700>!     print*, 'massmm5,hydrosum  =',massmm5,hydrosum  <a name='8876'></font>
      IF (HYDROSUM.LT.MASSMM5)THEN<a name='8877'>
       D1=LAMBDAHYD*2.*RADXX(NKR)<a name='8878'>
       D2=LAMBDAHYD*2.*RADXX(NKR-1)<a name='8879'>
       D3=DEXP(-D1)<a name='8880'>
       D4=DEXP(-D2)<a name='8881'>
       D5 = (1./LAMBDAHYD**4)<a name='8882'>
       D6=TERM1<a name='8883'>
       D7A= -D5*D3*(D1**3+3.*D1**2+6.*D1+6)<a name='8884'>
       D7B= -D5*D4*(D2**3+3.*D2**2+6.*D2+6)<a name='8885'>
       HYDROMASS= D6*(D7A-D7B)+(MASSMM5-HYDROSUM)<a name='8886'>
       FCONC(NKR)=HYDROMASS*RHOX/(COL &amp;<a name='8887'>
     &amp;          *MASSXX(NKR)*MASSXX(NKR)*3)<a name='8888'>
       HYDROSUM=HYDROSUM+(MASSMM5-HYDROSUM)<a name='8889'>
      END IF<a name='8890'>
<font color=#447700>!     print*, 'massmm5,hydrosum adj  =',massmm5,hydrosum  <a name='8891'></font>
      RETURN<a name='8892'>
      END SUBROUTINE BOUNDNUM<a name='8893'>
<a name='8894'>
<font color=#447700>! from module_mp_morr_two_moment.F<a name='8895'></font>
<A NAME='REFL10CM_HM'><A href='../../html_code/phys/module_mp_fast_sbm.F.html#REFL10CM_HM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8896'>
      <font color=#993300>subroutine </font><font color=#cc0000>refl10cm_hm</font> (qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, &amp; <A href='../../call_to/REFL10CM_HM.html' TARGET='index'>3</A>,<A href='../../call_from/REFL10CM_HM.html' TARGET='index'>6</A><a name='8897'>
                      t1d, p1d, dBZ, kts, kte, ii, jj)<a name='8898'>
<a name='8899'>
      IMPLICIT NONE<a name='8900'>
<a name='8901'>
<font color=#447700>!..Sub arguments<a name='8902'></font>
      INTEGER, INTENT(IN):: kts, kte, ii, jj<a name='8903'>
      REAL, DIMENSION(kts:kte), INTENT(IN)::                            &amp;<a name='8904'>
                      qv1d, qr1d, nr1d, qs1d, ns1d, qg1d, ng1d, t1d, p1d<a name='8905'>
      REAL, DIMENSION(kts:kte), INTENT(INOUT):: dBZ<a name='8906'>
<a name='8907'>
<font color=#447700>!..Local variables<a name='8908'></font>
      REAL, DIMENSION(kts:kte):: temp, pres, qv, rho<a name='8909'>
      REAL, DIMENSION(kts:kte):: rr, nr, rs, ns, rg, ng<a name='8910'>
<a name='8911'>
      DOUBLE PRECISION, DIMENSION(kts:kte):: ilamr, ilamg, ilams<a name='8912'>
      DOUBLE PRECISION, DIMENSION(kts:kte):: N0_r, N0_g, N0_s<a name='8913'>
      DOUBLE PRECISION:: lamr, lamg, lams<a name='8914'>
      LOGICAL, DIMENSION(kts:kte):: L_qr, L_qs, L_qg<a name='8915'>
<a name='8916'>
      REAL, DIMENSION(kts:kte):: ze_rain, ze_snow, ze_graupel<a name='8917'>
      DOUBLE PRECISION:: fmelt_s, fmelt_g<a name='8918'>
      DOUBLE PRECISION:: cback, x, eta, f_d<a name='8919'>
<a name='8920'>
      INTEGER:: i, k, k_0, kbot, n<a name='8921'>
      LOGICAL:: melti<a name='8922'>
<a name='8923'>
<font color=#447700>!+---+<a name='8924'></font>
<a name='8925'>
      do k = kts, kte<a name='8926'>
         dBZ(k) = -35.0<a name='8927'>
      enddo<a name='8928'>
<a name='8929'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8930'></font>
<font color=#447700>!..Put column of data into local arrays.<a name='8931'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8932'></font>
      do k = kts, kte<a name='8933'>
         temp(k) = t1d(k)<a name='8934'>
         qv(k) = MAX(1.E-10, qv1d(k))<a name='8935'>
         pres(k) = p1d(k)<a name='8936'>
         rho(k) = 0.622*pres(k)/(R_MORR*temp(k)*(qv(k)+0.622))<a name='8937'>
<a name='8938'>
         if (qr1d(k) .gt. 1.E-9) then<a name='8939'>
            rr(k) = qr1d(k)*rho(k)<a name='8940'>
            nr(k) = nr1d(k)*rho(k)<a name='8941'>
            lamr = (xam_r*xcrg(3)*xorg2*nr(k)/rr(k))**xobmr<a name='8942'>
            ilamr(k) = 1./lamr<a name='8943'>
            N0_r(k) = nr(k)*xorg2*lamr**xcre(2)<a name='8944'>
            L_qr(k) = .true.<a name='8945'>
         else<a name='8946'>
            rr(k) = 1.E-12<a name='8947'>
            nr(k) = 1.E-12<a name='8948'>
            L_qr(k) = .false.<a name='8949'>
         endif<a name='8950'>
<a name='8951'>
         if (qs1d(k) .gt. 1.E-9) then<a name='8952'>
            rs(k) = qs1d(k)*rho(k)<a name='8953'>
            ns(k) = ns1d(k)*rho(k)<a name='8954'>
            lams = (xam_s*xcsg(3)*xosg2*ns(k)/rs(k))**xobms<a name='8955'>
            ilams(k) = 1./lams<a name='8956'>
            N0_s(k) = ns(k)*xosg2*lams**xcse(2)<a name='8957'>
            L_qs(k) = .true.<a name='8958'>
         else<a name='8959'>
            rs(k) = 1.E-12<a name='8960'>
            ns(k) = 1.E-12<a name='8961'>
            L_qs(k) = .false.<a name='8962'>
         endif<a name='8963'>
<a name='8964'>
         if (qg1d(k) .gt. 1.E-9) then<a name='8965'>
            rg(k) = qg1d(k)*rho(k)<a name='8966'>
            ng(k) = ng1d(k)*rho(k)<a name='8967'>
            lamg = (xam_g*xcgg(3)*xogg2*ng(k)/rg(k))**xobmg<a name='8968'>
            ilamg(k) = 1./lamg<a name='8969'>
            N0_g(k) = ng(k)*xogg2*lamg**xcge(2)<a name='8970'>
            L_qg(k) = .true.<a name='8971'>
         else<a name='8972'>
            rg(k) = 1.E-12<a name='8973'>
            ng(k) = 1.E-12<a name='8974'>
            L_qg(k) = .false.<a name='8975'>
         endif<a name='8976'>
      enddo<a name='8977'>
<a name='8978'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8979'></font>
<font color=#447700>!..Locate K-level of start of melting (k_0 is level above).<a name='8980'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8981'></font>
      melti = .false.<a name='8982'>
      k_0 = kts<a name='8983'>
      do k = kte-1, kts, -1<a name='8984'>
         if ( (temp(k).gt.273.15) .and. L_qr(k)                         &amp;<a name='8985'>
                                  .and. (L_qs(k+1).or.L_qg(k+1)) ) then<a name='8986'>
            k_0 = MAX(k+1, k_0)<a name='8987'>
            melti=.true.<a name='8988'>
            goto 195<a name='8989'>
         endif<a name='8990'>
      enddo<a name='8991'>
 195  continue<a name='8992'>
<a name='8993'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8994'></font>
<font color=#447700>!..Assume Rayleigh approximation at 10 cm wavelength. Rain (all temps)<a name='8995'></font>
<font color=#447700>!.. and non-water-coated snow and graupel when below freezing are<a name='8996'></font>
<font color=#447700>!.. simple. Integrations of m(D)*m(D)*N(D)*dD.<a name='8997'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='8998'></font>
<a name='8999'>
      do k = kts, kte<a name='9000'>
         ze_rain(k) = 1.e-22<a name='9001'>
         ze_snow(k) = 1.e-22<a name='9002'>
         ze_graupel(k) = 1.e-22<a name='9003'>
         if (L_qr(k)) ze_rain(k) = N0_r(k)*xcrg(4)*ilamr(k)**xcre(4)<a name='9004'>
         if (L_qs(k)) ze_snow(k) = (0.176/0.93) * (6.0/PI_MORR)*(6.0/PI_MORR)     &amp;<a name='9005'>
                                 * (xam_s/900.0)*(xam_s/900.0)          &amp;<a name='9006'>
                                 * N0_s(k)*xcsg(4)*ilams(k)**xcse(4)<a name='9007'>
         if (L_qg(k)) ze_graupel(k) = (0.176/0.93) * (6.0/PI_MORR)*(6.0/PI_MORR)  &amp;<a name='9008'>
                                    * (xam_g/900.0)*(xam_g/900.0)       &amp;<a name='9009'>
                                    * N0_g(k)*xcgg(4)*ilamg(k)**xcge(4)<a name='9010'>
      enddo<a name='9011'>
<a name='9012'>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='9013'></font>
<font color=#447700>!..Special case of melting ice (snow/graupel) particles.  Assume the<a name='9014'></font>
<font color=#447700>!.. ice is surrounded by the liquid water.  Fraction of meltwater is<a name='9015'></font>
<font color=#447700>!.. extremely simple based on amount found above the melting level.<a name='9016'></font>
<font color=#447700>!.. Uses code from Uli Blahak (rayleigh_soak_wetgraupel and supporting<a name='9017'></font>
<font color=#447700>!.. routines).<a name='9018'></font>
<font color=#447700>!+---+-----------------------------------------------------------------+<a name='9019'></font>
<a name='9020'>
      if (melti .and. k_0.ge.kts+1) then<a name='9021'>
       do k = k_0-1, kts, -1<a name='9022'>
<a name='9023'>
<font color=#447700>!..Reflectivity contributed by melting snow<a name='9024'></font>
          if (L_qs(k) .and. L_qs(k_0) ) then<a name='9025'>
           fmelt_s = MAX(0.005d0, MIN(1.0d0-rs(k)/rs(k_0), 0.99d0))<a name='9026'>
           eta = 0.d0<a name='9027'>
           lams = 1./ilams(k)<a name='9028'>
           do n = 1, nrbins<a name='9029'>
              x = xam_s * xxDs(n)**xbm_s<a name='9030'>
              call <A href='../../html_code/phys/module_mp_radar.F.html#RAYLEIGH_SOAK_WETGRAUPEL'>rayleigh_soak_wetgraupel</A><A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAYLEIGH_SOAK_WETGRAUPEL_1"> (x,DBLE(xocms),DBLE(xobms), &amp;<a name='9031'>
                    fmelt_s, melt_outside_s, m_w_0, m_i_0, lamda_radar, &amp;<a name='9032'>
                    CBACK, mixingrulestring_s, matrixstring_s,          &amp;<a name='9033'>
                    inclusionstring_s, hoststring_s,                    &amp;<a name='9034'>
                    hostmatrixstring_s, hostinclusionstring_s)<a name='9035'>
              f_d = N0_s(k)*xxDs(n)**xmu_s * DEXP(-lams*xxDs(n))<a name='9036'>
              eta = eta + f_d * CBACK * simpson(n) * xdts(n)<a name='9037'>
           enddo<a name='9038'>
           ze_snow(k) = SNGL(lamda4 / (pi5 * K_w) * eta)<a name='9039'>
          endif<a name='9040'>
<a name='9041'>
<a name='9042'>
<font color=#447700>!..Reflectivity contributed by melting graupel<a name='9043'></font>
<a name='9044'>
          if (L_qg(k) .and. L_qg(k_0) ) then<a name='9045'>
           fmelt_g = MAX(0.005d0, MIN(1.0d0-rg(k)/rg(k_0), 0.99d0))<a name='9046'>
           eta = 0.d0<a name='9047'>
           lamg = 1./ilamg(k)<a name='9048'>
           do n = 1, nrbins<a name='9049'>
              x = xam_g * xxDg(n)**xbm_g<a name='9050'>
              call <A href='../../html_code/phys/module_mp_radar.F.html#RAYLEIGH_SOAK_WETGRAUPEL'>rayleigh_soak_wetgraupel</A><A href='../../html_code/phys/module_mp_morr_two_moment.F.html#REFL10CM_HM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAYLEIGH_SOAK_WETGRAUPEL_2"> (x,DBLE(xocmg),DBLE(xobmg), &amp;<a name='9051'>
                    fmelt_g, melt_outside_g, m_w_0, m_i_0, lamda_radar, &amp;<a name='9052'>
                    CBACK, mixingrulestring_g, matrixstring_g,          &amp;<a name='9053'>
                    inclusionstring_g, hoststring_g,                    &amp;<a name='9054'>
                    hostmatrixstring_g, hostinclusionstring_g)<a name='9055'>
              f_d = N0_g(k)*xxDg(n)**xmu_g * DEXP(-lamg*xxDg(n))<a name='9056'>
              eta = eta + f_d * CBACK * simpson(n) * xdtg(n)<a name='9057'>
           enddo<a name='9058'>
           ze_graupel(k) = SNGL(lamda4 / (pi5 * K_w) * eta)<a name='9059'>
          endif<a name='9060'>
<a name='9061'>
       enddo<a name='9062'>
      endif<a name='9063'>
<a name='9064'>
      do k = kte, kts, -1<a name='9065'>
         dBZ(k) = 10.*log10((ze_rain(k)+ze_snow(k)+ze_graupel(k))*1.d18)<a name='9066'>
      enddo<a name='9067'>
<a name='9068'>
<a name='9069'>
      end subroutine refl10cm_hm<a name='9070'>
      END MODULE module_mp_fast_sbm<a name='9071'>
</pre></body></html>