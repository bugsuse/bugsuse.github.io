<HTML> <BODY BGCOLOR=#eeeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!  Create an initial data set for the WRF model based on real data.  This<a name='2'></font>
<font color=#447700>!  program is specifically set up for the NMM core.<a name='3'></font>
<a name='4'>
<A NAME='REAL_DATA'><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='top_target'><IMG SRC="../../gif/bar_yellow.gif" border=0></A><a name='5'>
<font color=#993300>PROGRAM </font><font color=#cc0000>real_data</font>,<A href='../../call_from/REAL_DATA.html' TARGET='index'>88</A><a name='6'>
<a name='7'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_20"><a name='8'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_208"><a name='9'>
   USE module_initialize_real<a name='10'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_15"><a name='11'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_52"><a name='12'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_137"><a name='13'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_40"><a name='14'>
   USE <A href='../../html_code/share/module_check_a_mundo.F.html#MODULE_CHECK_A_MUNDO'>module_check_a_mundo</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CHECK_A_MUNDO_5"><a name='15'>
#if ( WRF_CHEM == 1 )<a name='16'>
   USE module_input_chem_data<a name='17'>
   USE module_input_chem_bioemiss<a name='18'>
#endif<a name='19'>
   USE module_utility<a name='20'>
#ifdef DM_PARALLEL<a name='21'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_140"><a name='22'>
#endif<a name='23'>
<a name='24'>
   IMPLICIT NONE<a name='25'>
<a name='26'>
   REAL    :: time , bdyfrq<a name='27'>
<a name='28'>
   INTEGER :: loop , levels_to_process , debug_level<a name='29'>
<a name='30'>
<a name='31'>
   TYPE(domain) , POINTER :: null_domain<a name='32'>
   TYPE(domain) , POINTER :: grid<a name='33'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='34'>
   INTEGER                :: number_at_same_level<a name='35'>
<a name='36'>
   INTEGER :: max_dom, domain_id<a name='37'>
   INTEGER :: idum1, idum2 <a name='38'>
#ifdef DM_PARALLEL<a name='39'>
   INTEGER                 :: nbytes<a name='40'>
<font color=#447700>!   INTEGER, PARAMETER      :: configbuflen = 2*1024<a name='41'></font>
   INTEGER, PARAMETER      :: configbuflen = 4*CONFIG_BUF_LEN<a name='42'>
   INTEGER                 :: configbuf( configbuflen )<a name='43'>
   LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='44'>
#endif<a name='45'>
<a name='46'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='47'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='48'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='49'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='50'>
   INTEGER :: i , j , k , idts<a name='51'>
<a name='52'>
#ifdef DEREF_KLUDGE<a name='53'>
<font color=#447700>!  see http://www.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='54'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='55'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='56'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='57'>
#endif<a name='58'>
<a name='59'>
   CHARACTER (LEN=80)     :: message<a name='60'>
   CHARACTER*255 :: mess<a name='61'>
<a name='62'>
   INTEGER :: start_year , start_month , start_day <a name='63'>
   INTEGER :: start_hour , start_minute , start_second<a name='64'>
   INTEGER :: end_year ,   end_month ,   end_day ,   &amp;<a name='65'>
              end_hour ,   end_minute ,   end_second<a name='66'>
   INTEGER :: interval_seconds , real_data_init_type<a name='67'>
   INTEGER :: time_loop_max , time_loop, rc<a name='68'>
   REAL    :: t1,t2<a name='69'>
<a name='70'>
#include "<A href='../../html_code/include/version_decl.html'>version_decl</A>"<A NAME="version_decl_1"><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='71'>
<a name='72'>
   INTERFACE<a name='73'>
     SUBROUTINE Setup_Timekeeping( grid )<a name='74'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_209"><a name='75'>
      TYPE(domain), POINTER :: grid<a name='76'>
     END SUBROUTINE Setup_Timekeeping<a name='77'>
   END INTERFACE<a name='78'>
<a name='79'>
   <font color=#447700>!  Define the name of this program (program_name defined in module_domain)<a name='80'></font>
<a name='81'>
   program_name = "REAL_NMM " // TRIM(release_version) // " PREPROCESSOR"<a name='82'>
<a name='83'>
#ifdef DM_PARALLEL<a name='84'>
   CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#DISABLE_QUILTING'>disable_quilting</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DISABLE_QUILTING_6"><a name='85'>
#endif<a name='86'>
<a name='87'>
<font color=#447700>!       CALL start()<a name='88'></font>
<a name='89'>
   <font color=#447700>!  Initialize the modules used by the WRF system.  <a name='90'></font>
   <font color=#447700>!  Many of the CALLs made from the<a name='91'></font>
   <font color=#447700>!  init_modules routine are NO-OPs.  Typical initializations <a name='92'></font>
   <font color=#447700>!  are: the size of a<a name='93'></font>
   <font color=#447700>!  REAL, setting the file handles to a pre-use value, defining moisture and<a name='94'></font>
   <font color=#447700>!  chemistry indices, etc.<a name='95'></font>
<a name='96'>
   CALL       wrf_debug ( 100 , 'real_nmm: calling init_modules ' )<a name='97'>
<a name='98'>
<font color=#447700>!!!!   CALL init_modules<a name='99'></font>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_15">(1)   <font color=#447700>! Phase 1 returns after MPI_INIT() (if it is called)<a name='100'></font>
   CALL WRFU_Initialize( defaultCalKind=WRFU_CAL_GREGORIAN, rc=rc )<a name='101'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_16">(2)   <font color=#447700>! Phase 2 resumes after MPI_INIT() (if it is called)<a name='102'></font>
<a name='103'>
   <font color=#447700>!  The configuration switches mostly come from the NAMELIST input.<a name='104'></font>
<a name='105'>
#ifdef DM_PARALLEL<a name='106'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='107'>
      write(message,*) 'call initial_config'<a name='108'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_487"> ( message )<a name='109'>
      CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_15"><a name='110'>
   ENDIF<a name='111'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_15">( configbuf, configbuflen, nbytes )<a name='112'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_118">( configbuf, nbytes )<a name='113'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_15">( configbuf, configbuflen )<a name='114'>
   CALL <A href='../../html_code/frame/module_dm.F.html#WRF_DM_INITIALIZE'>wrf_dm_initialize</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_INITIALIZE_8"><a name='115'>
#else<a name='116'>
   CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_16"><a name='117'>
#endif<a name='118'>
   <a name='119'>
   CALL nl_set_use_wps_input ( 1,1 )<a name='120'>
<a name='121'>
   CALL <A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY'>check_nml_consistency</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHECK_NML_CONSISTENCY_5"><a name='122'>
   CALL <A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS'>set_physics_rconfigs</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICS_RCONFIGS_5"><a name='123'>
<a name='124'>
   CALL nl_get_debug_level ( 1, debug_level )<a name='125'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_10"> ( debug_level )<a name='126'>
<a name='127'>
   CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_488"> ( program_name )<a name='128'>
<a name='129'>
   <font color=#447700>!  Allocate the space for the mother of all domains.<a name='130'></font>
<a name='131'>
   NULLIFY( null_domain )<a name='132'>
   CALL  wrf_debug ( 100 , 'real_nmm: calling alloc_and_configure_domain ' )<a name='133'>
   CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN'>alloc_and_configure_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_AND_CONFIGURE_DOMAIN_13"> ( domain_id  = 1           , &amp;<a name='134'>
                                     grid       = head_grid   , &amp;<a name='135'>
                                     parent     = null_domain , &amp;<a name='136'>
                                     kid        = -1            )<a name='137'>
<a name='138'>
   grid =&gt; head_grid<a name='139'>
<a name='140'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_2"><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='141'>
   CALL <A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING'>Setup_Timekeeping</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_TIMEKEEPING_11"> ( grid )<a name='142'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_25">( grid, &amp;<a name='143'>
                          time_step_seconds=model_config_rec%interval_seconds )<a name='144'>
   CALL wrf_debug ( 100 , 'real_nmm: calling set_scalar_indices_from_config ' )<a name='145'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_17"> ( grid%id , idum1, idum2 )<a name='146'>
<a name='147'>
   CALL     wrf_debug ( 100 , 'real_nmm: calling model_to_grid_config_rec ' )<a name='148'>
<a name='149'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_41"> ( grid%id , model_config_rec , config_flags )<a name='150'>
<a name='151'>
   write(message,*) 'after model_to_grid_config_rec, e_we, e_sn are: ', &amp;<a name='152'>
                    config_flags%e_we, config_flags%e_sn<a name='153'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_489">(message)<a name='154'>
<a name='155'>
   <font color=#447700>!  Initialize the WRF IO: open files, init file handles, etc.<a name='156'></font>
<a name='157'>
   CALL       wrf_debug ( 100 , 'real_nmm: calling init_wrfio' )<a name='158'>
   CALL <A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO'>init_wrfio</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_WRFIO_8"><a name='159'>
<a name='160'>
<font color=#447700>!  Some of the configuration values may have been modified from the initial READ<a name='161'></font>
<font color=#447700>!  of the NAMELIST, so we re-broadcast the configuration records.<a name='162'></font>
<a name='163'>
#ifdef DM_PARALLEL<a name='164'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_368"> ( 100 , 'real_nmm: re-broadcast the configuration records' )<a name='165'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_16">( configbuf, configbuflen, nbytes )<a name='166'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_119">( configbuf, nbytes )<a name='167'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_16">( configbuf, configbuflen )<a name='168'>
#endif<a name='169'>
<a name='170'>
   <font color=#447700>!   No looping in this layer.  <a name='171'></font>
<a name='172'>
   CALL <A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT'>med_sidata_input</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SIDATA_INPUT_3"> ( grid , config_flags )<a name='173'>
<a name='174'>
   <font color=#447700>!  We are done.<a name='175'></font>
<a name='176'>
   CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_369"> (   0 , 'real_nmm: SUCCESS COMPLETE REAL_NMM INIT' )<a name='177'>
<a name='178'>
#ifdef DM_PARALLEL<a name='179'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_SHUTDOWN'>wrf_dm_shutdown</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SHUTDOWN_3"><a name='180'>
#endif<a name='181'>
<a name='182'>
   CALL WRFU_Finalize( rc=rc )<a name='183'>
<a name='184'>
END PROGRAM real_data<a name='185'>
<a name='186'>
<A NAME='MED_SIDATA_INPUT'><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='187'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_sidata_input</font> ( grid , config_flags ) <A href='../../call_to/MED_SIDATA_INPUT.html' TARGET='index'>3</A>,<A href='../../call_from/MED_SIDATA_INPUT.html' TARGET='index'>170</A><a name='188'>
  <font color=#447700>! Driver layer<a name='189'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_210"><a name='190'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_16"><a name='191'>
  <font color=#447700>! Model layer<a name='192'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_138"><a name='193'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_3"><a name='194'>
   USE module_initialize_real<a name='195'>
   USE <A href='../../html_code/share/module_optional_input.F.html#MODULE_OPTIONAL_INPUT'>module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_OPTIONAL_INPUT_7"><a name='196'>
#if ( WRF_CHEM == 1 )<a name='197'>
   USE module_input_chem_data<a name='198'>
   USE module_input_chem_bioemiss<a name='199'>
#endif<a name='200'>
<a name='201'>
   USE <A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#MODULE_SI_IO_NMM'>module_si_io_nmm</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SI_IO_NMM_2"><a name='202'>
<a name='203'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_8"><a name='204'>
<a name='205'>
   IMPLICIT NONE<a name='206'>
<a name='207'>
<a name='208'>
  <font color=#447700>! Interface <a name='209'></font>
   INTERFACE<a name='210'>
     SUBROUTINE start_domain ( grid , allowed_to_read )<a name='211'>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_211"><a name='212'>
       TYPE (domain) grid<a name='213'>
       LOGICAL, INTENT(IN) :: allowed_to_read<a name='214'>
     END SUBROUTINE start_domain<a name='215'>
   END INTERFACE<a name='216'>
<a name='217'>
  <font color=#447700>! Arguments<a name='218'></font>
   TYPE(domain)                :: grid<a name='219'>
   TYPE (grid_config_rec_type) :: config_flags<a name='220'>
  <font color=#447700>! Local<a name='221'></font>
   INTEGER                :: time_step_begin_restart<a name='222'>
   INTEGER                :: idsi , ierr , myproc<a name='223'>
   CHARACTER (LEN=80)      :: si_inpname<a name='224'>
   CHARACTER (LEN=132)     :: message<a name='225'>
<a name='226'>
   CHARACTER(LEN=19) :: start_date_char , end_date_char , &amp;<a name='227'>
                        current_date_char , next_date_char<a name='228'>
<a name='229'>
   INTEGER :: time_loop_max , loop<a name='230'>
   INTEGER :: julyr , julday , LEN<a name='231'>
<a name='232'>
   INTEGER :: io_form_auxinput1<a name='233'>
   INTEGER, EXTERNAL :: use_package<a name='234'>
<a name='235'>
   LOGICAL :: using_binary_wrfsi<a name='236'>
<a name='237'>
   REAL :: gmt<a name='238'>
   REAL :: t1,t2<a name='239'>
<a name='240'>
   INTEGER :: numx_sm_levels_input,numx_st_levels_input<a name='241'>
   REAL,DIMENSION(100) :: smx_levels_input,stx_levels_input<a name='242'>
<a name='243'>
<a name='244'>
#ifdef DEREF_KLUDGE<a name='245'>
<font color=#447700>!  see http://www.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='246'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='247'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='248'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='249'>
#endif<a name='250'>
<a name='251'>
#if ( HWRF == 1 )<a name='252'>
  <font color=#447700>! Sam Says:<a name='253'></font>
<a name='254'>
  <font color=#447700>! The *INIT arrays are used to read init data written out by hwrf_prep_hybrid<a name='255'></font>
  REAL,ALLOCATABLE,DIMENSION(:,:,:)::TINIT,UINIT,VINIT,QINIT,CWMINIT<a name='256'>
  REAL,ALLOCATABLE,DIMENSION(:,:,:)::PINIT<a name='257'>
  REAL,ALLOCATABLE,DIMENSION(:,:)::PDINIT<a name='258'>
<a name='259'>
  <font color=#447700>! The *B arrays are used to read boundary data written out by hwrf_prep_hybrid<a name='260'></font>
  REAL,ALLOCATABLE,DIMENSION(:,:,:)::TB,UB,VB,QB,CWMB<a name='261'>
  REAL,ALLOCATABLE,DIMENSION(:,:)::PDB<a name='262'>
<a name='263'>
  INTEGER :: KB, LM, IM, JM, iunit_gfs, N<a name='264'>
<a name='265'>
  integer :: i,j,k<a name='266'>
  LOGICAL,EXTERNAL :: WRF_DM_ON_MONITOR<a name='267'>
  integer :: ids,ide, jds,jde, kds,kde<a name='268'>
  integer :: ims,ime, jms,jme, kms,kme<a name='269'>
  integer :: its,ite, jts,jte, kts,kte<a name='270'>
<a name='271'>
  integer :: ioerror<a name='272'>
#endif<a name='273'>
<a name='274'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_3"><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='275'>
<a name='276'>
   grid%input_from_file = .true.<a name='277'>
   grid%input_from_file = .false.<a name='278'>
<a name='279'>
   CALL <A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END'>compute_si_start_and_end</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_SI_START_AND_END_3"> ( model_config_rec%start_year  (grid%id) , &amp;<a name='280'>
                                   model_config_rec%start_month (grid%id) , &amp;<a name='281'>
                                   model_config_rec%start_day   (grid%id) , &amp;<a name='282'>
                                   model_config_rec%start_hour  (grid%id) , &amp;<a name='283'>
                                   model_config_rec%start_minute(grid%id) , &amp;<a name='284'>
                                   model_config_rec%start_second(grid%id) , &amp;<a name='285'>
                                   model_config_rec%  end_year  (grid%id) , &amp; <a name='286'>
                                   model_config_rec%  end_month (grid%id) , &amp;<a name='287'>
                                   model_config_rec%  end_day   (grid%id) , &amp;<a name='288'>
                                   model_config_rec%  end_hour  (grid%id) , &amp;<a name='289'>
                                   model_config_rec%  end_minute(grid%id) , &amp;<a name='290'>
                                   model_config_rec%  end_second(grid%id) , &amp;<a name='291'>
                                   model_config_rec%interval_seconds      , &amp;<a name='292'>
                                   model_config_rec%real_data_init_type   , &amp;<a name='293'>
                                   start_date_char , end_date_char , time_loop_max )<a name='294'>
<a name='295'>
   <font color=#447700>!  Here we define the initial time to process, for later use by the code.<a name='296'></font>
<a name='297'>
   current_date_char = start_date_char<a name='298'>
<font color=#447700>!   start_date = start_date_char // '.0000'<a name='299'></font>
   start_date = start_date_char <a name='300'>
   current_date = start_date<a name='301'>
<a name='302'>
   CALL nl_set_bdyfrq ( grid%id , REAL(model_config_rec%interval_seconds) )<a name='303'>
<a name='304'>
   <font color=#447700>!  Loop over each time period to process.<a name='305'></font>
<a name='306'>
   write(message,*) 'time_loop_max: ', time_loop_max<a name='307'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_490">(message)<a name='308'>
   DO loop = 1 , time_loop_max<a name='309'>
<a name='310'>
     internal_time_loop=loop<a name='311'>
                                                                                                                                              <a name='312'>
      write(message,*) 'loop=', loop<a name='313'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_491">(message)<a name='314'>
                                                                                                                                              <a name='315'>
      write(message,*) '-----------------------------------------------------------'<a name='316'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_492">(message)<a name='317'>
                      <a name='318'>
      write(message,*) ' '<a name='319'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_493">(message)<a name='320'>
      write(message,'(A,A,A,I2,A,I2)') ' Current date being processed: ', &amp;<a name='321'>
        current_date, ', which is loop #',loop,' out of ',time_loop_max<a name='322'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_494">(message)<a name='323'>
<a name='324'>
      <font color=#447700>!  After current_date has been set, fill in the julgmt stuff.<a name='325'></font>
<a name='326'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT'>geth_julgmt</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_JULGMT_6"> ( config_flags%julyr , config_flags%julday , &amp;<a name='327'>
                                              config_flags%gmt )<a name='328'>
<a name='329'>
      <font color=#447700>!  Now that the specific Julian info is available, <a name='330'></font>
      <font color=#447700>!  save these in the model config record.<a name='331'></font>
<a name='332'>
      CALL nl_set_gmt (grid%id, config_flags%gmt)<a name='333'>
      CALL nl_set_julyr (grid%id, config_flags%julyr)<a name='334'>
      CALL nl_set_julday (grid%id, config_flags%julday)<a name='335'>
<a name='336'>
      CALL nl_get_io_form_auxinput1( 1, io_form_auxinput1 )<a name='337'>
      using_binary_wrfsi=.false.<a name='338'>
       <a name='339'>
       <a name='340'>
      write(message,*) 'TRIM(config_flags%auxinput1_inname): ', TRIM(config_flags%auxinput1_inname)<a name='341'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_495">(message)<a name='342'>
       <a name='343'>
#if ( HWRF == 1 )<a name='344'>
     ifph_onlyfirst: if(.not.grid%use_prep_hybrid .or. loop==1) then<a name='345'>
#endif<a name='346'>
      IF (config_flags%auxinput1_inname(1:10) .eq. 'real_input') THEN<a name='347'>
         using_binary_wrfsi=.true.<a name='348'>
      ENDIF<a name='349'>
<a name='350'>
      SELECT CASE ( use_package(io_form_auxinput1) )<a name='351'>
#if defined(NETCDF) || defined(PNETCDF) || defined(PIO)<a name='352'>
      CASE ( IO_NETCDF , IO_PNETCDF , IO_PIO )<a name='353'>
<a name='354'>
      <font color=#447700>!  Open the wrfinput file.<a name='355'></font>
<a name='356'>
        current_date_char(11:11)='_'<a name='357'>
 <a name='358'>
       WRITE ( wrf_err_message , FMT='(A,A)' )'med_sidata_input: calling open_r_dataset for ',TRIM(config_flags%auxinput1_inname)<a name='359'>
       CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_370"> ( 100 , wrf_err_message )<a name='360'>
       IF ( config_flags%auxinput1_inname(1:8) .NE. 'wrf_real' ) THEN<a name='361'>
          CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A'>construct_filename4a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME4A_5">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , current_date_char , &amp;<a name='362'>
                                     config_flags%io_form_auxinput1 )<a name='363'>
       ELSE<a name='364'>
          CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_9">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , current_date_char )<a name='365'>
       END IF<a name='366'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_9"> ( idsi, TRIM(si_inpname) , grid , config_flags , "DATASET=AUXINPUT1", ierr )<a name='367'>
 <a name='368'>
       IF ( ierr .NE. 0 ) THEN<a name='369'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_430">( 'error opening ' // TRIM(si_inpname) // ' for input; bad date in namelist or file not in directory' )<a name='370'>
       ENDIF<a name='371'>
<a name='372'>
      <font color=#447700>!  Input data.<a name='373'></font>
<a name='374'>
      CALL wrf_debug (100, 'med_sidata_input: call input_auxinput1_wrf')<a name='375'>
<a name='376'>
      CALL input_auxinput1 ( idsi, grid, config_flags, ierr )<a name='377'>
<a name='378'>
      <font color=#447700>!  Possible optional SI input.  This sets flags used by init_domain.<a name='379'></font>
<a name='380'>
      IF ( loop .EQ. 1 ) THEN<a name='381'>
         CALL  wrf_debug (100, 'med_sidata_input: call init_module_optional_input' )<a name='382'>
         CALL <A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT'>init_module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_INPUT_5"> ( grid , config_flags )<a name='383'>
      CALL wrf_debug ( 100 , 'med_sidata_input: calling optional_input' )<a name='384'>
<font color=#447700>!<a name='385'></font>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT'>optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_INPUT_3"> ( grid , idsi , config_flags )<a name='386'>
      END IF<a name='387'>
<font color=#447700>!<a name='388'></font>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_19"> ( idsi , config_flags , "DATASET=AUXINPUT1" )<a name='389'>
<a name='390'>
#endif<a name='391'>
#ifdef INTIO<a name='392'>
      CASE ( IO_INTIO )<a name='393'>
<a name='394'>
      <font color=#447700>!  Possible optional SI input.  This sets flags used by init_domain.<a name='395'></font>
<a name='396'>
      IF ( loop .EQ. 1 ) THEN<a name='397'>
         CALL  wrf_debug (100, 'med_sidata_input: call init_module_optional_input' )<a name='398'>
         CALL <A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT'>init_module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_INPUT_6"> ( grid , config_flags )<a name='399'>
      END IF<a name='400'>
<a name='401'>
      IF (using_binary_wrfsi) THEN<a name='402'>
<a name='403'>
        current_date_char(11:11)='_'<a name='404'>
        CALL <A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_SI'>read_si</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_SI_2"> ( grid, current_date_char )<a name='405'>
        current_date_char(11:11)='T'<a name='406'>
<a name='407'>
      ELSE<a name='408'>
                                                                                                                                              <a name='409'>
        write(message,*) 'binary WPS branch'<a name='410'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_496">(message)<a name='411'>
        current_date_char(11:11)='_'<a name='412'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A'>construct_filename4a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME4A_6">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , current_date_char , &amp;<a name='413'>
                                     config_flags%io_form_auxinput1 )<a name='414'>
        CALL <A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS'>read_wps</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_WPS_3"> ( grid, trim(si_inpname), current_date_char, config_flags%num_metgrid_levels )<a name='415'>
<font color=#447700>!!! bogus set some flags??<a name='416'></font>
      flag_metgrid=1<a name='417'>
      flag_soilhgt=1<a name='418'>
<a name='419'>
<a name='420'>
          ENDIF<a name='421'>
<a name='422'>
#endif<a name='423'>
      CASE DEFAULT<a name='424'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_431">('real: not valid io_form_auxinput1')<a name='425'>
      END SELECT<a name='426'>
#if ( HWRF == 1 )<a name='427'>
     endif ifph_onlyfirst<a name='428'>
#endif<a name='429'>
<a name='430'>
      grid%islope=1<a name='431'>
      grid%vegfra=grid%vegfrc<a name='432'>
      grid%dfrlg=grid%dfl/9.81<a name='433'>
<a name='434'>
      grid%isurban=1<a name='435'>
      grid%isoilwater=14<a name='436'>
<a name='437'>
      <font color=#447700>!  Initialize the mother domain for this time period with input data.<a name='438'></font>
<a name='439'>
      CALL wrf_debug ( 100 , 'med_sidata_input: calling init_domain' )<a name='440'>
      grid%input_from_file = .true.<a name='441'>
<a name='442'>
      CALL <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#INIT_DOMAIN'>init_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_4"> ( grid )<a name='443'>
<a name='444'>
#if ( HWRF == 1 )<a name='445'>
     read_phinit: if(grid%use_prep_hybrid) then<a name='446'>
#if defined(DM_PARALLEL)<a name='447'>
        if(.not. wrf_dm_on_monitor()) then<a name='448'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_432">('real: in use_prep_hybrid mode, threading and mpi are forbidden.')<a name='449'>
        endif<a name='450'>
#endif<a name='451'>
<a name='452'>
        ph_loop1: if(loop==1) then<a name='453'>
<a name='454'>
           <font color=#447700>! determine kds, ids, jds<a name='455'></font>
           SELECT CASE ( model_data_order )<a name='456'>
           CASE ( DATA_ORDER_ZXY )<a name='457'>
              kds = grid%sd31 ; kde = grid%ed31 ;<a name='458'>
              ids = grid%sd32 ; ide = grid%ed32 ;<a name='459'>
              jds = grid%sd33 ; jde = grid%ed33 ;<a name='460'>
<a name='461'>
              kms = grid%sm31 ; kme = grid%em31 ;<a name='462'>
              ims = grid%sm32 ; ime = grid%em32 ;<a name='463'>
              jms = grid%sm33 ; jme = grid%em33 ;<a name='464'>
<a name='465'>
              kts = grid%sp31 ; kte = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='466'></font>
              its = grid%sp32 ; ite = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='467'></font>
              jts = grid%sp33 ; jte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='468'></font>
<a name='469'>
           CASE ( DATA_ORDER_XYZ )<a name='470'>
              ids = grid%sd31 ; ide = grid%ed31 ;<a name='471'>
              jds = grid%sd32 ; jde = grid%ed32 ;<a name='472'>
              kds = grid%sd33 ; kde = grid%ed33 ;<a name='473'>
<a name='474'>
              ims = grid%sm31 ; ime = grid%em31 ;<a name='475'>
              jms = grid%sm32 ; jme = grid%em32 ;<a name='476'>
              kms = grid%sm33 ; kme = grid%em33 ;<a name='477'>
<a name='478'>
              its = grid%sp31 ; ite = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='479'></font>
              jts = grid%sp32 ; jte = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='480'></font>
              kts = grid%sp33 ; kte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='481'></font>
<a name='482'>
           CASE ( DATA_ORDER_XZY )<a name='483'>
              ids = grid%sd31 ; ide = grid%ed31 ;<a name='484'>
              kds = grid%sd32 ; kde = grid%ed32 ;<a name='485'>
              jds = grid%sd33 ; jde = grid%ed33 ;<a name='486'>
<a name='487'>
              ims = grid%sm31 ; ime = grid%em31 ;<a name='488'>
              kms = grid%sm32 ; kme = grid%em32 ;<a name='489'>
              jms = grid%sm33 ; jme = grid%em33 ;<a name='490'>
<a name='491'>
              its = grid%sp31 ; ite = grid%ep31 ; <font color=#447700>! tile is entire patch<a name='492'></font>
              kts = grid%sp32 ; kte = grid%ep32 ; <font color=#447700>! tile is entire patch<a name='493'></font>
              jts = grid%sp33 ; jte = grid%ep33 ; <font color=#447700>! tile is entire patch<a name='494'></font>
<a name='495'>
           END SELECT<a name='496'>
           <font color=#447700>! Allocate 3D initialization arrays:<a name='497'></font>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_497">('ALLOCATE PREP_HYBRID INIT ARRAYS')<a name='498'>
           ALLOCATE ( TINIT  (ids:(ide-1),kds:(kde-1)  ,jds:(jde-1)) )<a name='499'>
           ALLOCATE ( PINIT  (ids:(ide-1),kds:kde      ,jds:(jde-1)) )<a name='500'>
           ALLOCATE ( UINIT  (ids:(ide-1),kds:(kde-1)  ,jds:(jde-1)) )<a name='501'>
           ALLOCATE ( VINIT  (ids:(ide-1),kds:(kde-1)  ,jds:(jde-1)) )<a name='502'>
           ALLOCATE ( QINIT  (ids:(ide-1),kds:(kde-1)  ,jds:(jde-1)) )<a name='503'>
           ALLOCATE ( CWMINIT(ids:(ide-1),kds:(kde-1)  ,jds:(jde-1)) )<a name='504'>
           ALLOCATE ( PDINIT (ids:(ide-1),              jds:(jde-1)) )<a name='505'>
<a name='506'>
           REWIND 900<a name='507'>
           READ(900,iostat=ioerror) PDINIT,TINIT,QINIT,CWMINIT,UINIT,VINIT,PINIT<a name='508'>
           if(ioerror/=0) then<a name='509'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_433">('Unable to read MAKBND output from unit 900.')<a name='510'>
           endif<a name='511'>
           WRITE(mess,*) 'U V T AT 10 10 10 ',UINIT(10,10,10),VINIT(10,10,10),TINIT(10,10,10)<a name='512'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_498">(mess)<a name='513'>
           <font color=#447700>! Switch from IKJ to IJK ordering<a name='514'></font>
           DO I = ids,ide-1<a name='515'>
              DO J = jds,jde-1<a name='516'>
                 grid%pd(I,J) = PDINIT(I,J)<a name='517'>
                 DO K = kds,kde-1<a name='518'>
                    grid%q2(I,J,K) = 0<a name='519'>
                    grid%u(I,J,K) = UINIT(I,K,J)<a name='520'>
                    grid%v(I,J,K) = VINIT(I,K,J)<a name='521'>
                    grid%t(I,J,K) = TINIT(I,K,J)<a name='522'>
                    grid%q(I,J,K) = QINIT(I,K,J)<a name='523'>
                    grid%cwm(I,J,K) = CWMINIT(I,K,J)<a name='524'>
                 ENDDO<a name='525'>
                 <font color=#447700>!  Was commented out in original V2 HWRF too:<a name='526'></font>
                 <font color=#447700>!      DO K = kds,kde<a name='527'></font>
                 <font color=#447700>!         grid%nmm_pint(I,J,K) = pinit(I,K,J)<a name='528'></font>
                 <font color=#447700>!      ENDDO<a name='529'></font>
              ENDDO<a name='530'>
           ENDDO<a name='531'>
<a name='532'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_499">('DEALLOCATE PREP_HYBRID INIT ARRAYS')<a name='533'>
           deallocate(TINIT,PINIT,UINIT,VINIT,QINIT,CWMINIT,PDINIT)<a name='534'>
        end if ph_loop1<a name='535'>
     end if read_phinit<a name='536'>
#endif<a name='537'>
<a name='538'>
      CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_42"> ( grid%id, model_config_rec, config_flags )<a name='539'>
<a name='540'>
      <font color=#447700>!  Close this file that is output from the SI and input to this pre-proc.<a name='541'></font>
<a name='542'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_371"> ( 100 , 'med_sidata_input: back from init_domain' )<a name='543'>
<a name='544'>
<a name='545'>
<font color=#447700>!!! not sure about this, but doesnt seem like needs to be called each time<a name='546'></font>
      IF ( loop .EQ. 1 ) THEN<a name='547'>
        CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_2"> ( grid , .TRUE.)<a name='548'>
      END IF<a name='549'>
<a name='550'>
#if ( WRF_CHEM == 1 )<a name='551'>
      IF ( loop == 1 ) THEN<a name='552'>
<font color=#447700>!        IF ( ( grid%chem_opt .EQ. RADM2     ) .OR. &amp;<a name='553'></font>
<font color=#447700>!             ( grid%chem_opt .EQ. RADM2SORG ) .OR. &amp;<a name='554'></font>
<font color=#447700>!             ( grid%chem_opt .EQ. RACM      ) .OR. &amp;<a name='555'></font>
<font color=#447700>!             ( grid%chem_opt .EQ. RACMSORG  ) ) THEN<a name='556'></font>
         IF( grid%chem_opt &gt; 0 ) then<a name='557'>
           <font color=#447700>! Read the chemistry data from a previous wrf forecast (wrfout file)<a name='558'></font>
           IF(grid%chem_in_opt == 1 ) THEN<a name='559'>
              message = 'INITIALIZING CHEMISTRY WITH OLD SIMULATION'<a name='560'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_500"> ( message )<a name='561'>
<a name='562'>
              CALL input_ext_chem_file( grid )<a name='563'>
<a name='564'>
              IF(grid%bio_emiss_opt == BEIS311 ) THEN<a name='565'>
                 message = 'READING BEIS3.11 EMISSIONS DATA'<a name='566'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_501"> ( message )<a name='567'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_16"> ( grid , config_flags)<a name='568'>
              else IF(grid%bio_emiss_opt == 3 ) THEN <font color=#447700>!shc<a name='569'></font>
                 message = 'READING MEGAN 2 EMISSIONS DATA'<a name='570'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_502"> ( message )<a name='571'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_17"> ( grid , config_flags)<a name='572'>
              END IF<a name='573'>
<a name='574'>
           ELSEIF(grid%chem_in_opt == 0)then<a name='575'>
              <font color=#447700>! Generate chemistry data from a idealized vertical profile<a name='576'></font>
              message = 'STARTING WITH BACKGROUND CHEMISTRY '<a name='577'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_503"> ( message )<a name='578'>
<a name='579'>
              write(message,*)' ETA1 '<a name='580'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_504"> ( message )<a name='581'>
<font color=#447700>!             write(message,*) grid%eta1<a name='582'></font>
<font color=#447700>!             CALL  wrf_message ( message )<a name='583'></font>
<a name='584'>
              CALL input_chem_profile ( grid )<a name='585'>
<a name='586'>
              IF(grid%bio_emiss_opt == BEIS311 ) THEN<a name='587'>
                 message = 'READING BEIS3.11 EMISSIONS DATA'<a name='588'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_505"> ( message )<a name='589'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_18"> ( grid , config_flags)<a name='590'>
              else IF(grid%bio_emiss_opt == 3 ) THEN <font color=#447700>!shc<a name='591'></font>
                 message = 'READING MEGAN 2 EMISSIONS DATA'<a name='592'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_506"> ( message )<a name='593'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_19"> ( grid , config_flags)<a name='594'>
              END IF<a name='595'>
<a name='596'>
           ELSE<a name='597'>
             message = 'RUNNING WITHOUT CHEMISTRY INITIALIZATION'<a name='598'>
             CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_507"> ( message )<a name='599'>
           ENDIF<a name='600'>
         ENDIF<a name='601'>
      ENDIF<a name='602'>
#endif<a name='603'>
<a name='604'>
      config_flags%isurban=1<a name='605'>
      config_flags%isoilwater=14<a name='606'>
<a name='607'>
      CALL <A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT'>assemble_output</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ASSEMBLE_OUTPUT_3"> ( grid , config_flags , loop , time_loop_max )<a name='608'>
<a name='609'>
      <font color=#447700>!  Here we define the next time that we are going to process.<a name='610'></font>
<a name='611'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_11"> ( current_date_char , start_date_char , &amp;<a name='612'>
                          loop * model_config_rec%interval_seconds )<a name='613'>
      current_date =  current_date_char // '.0000'<a name='614'>
<a name='615'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_26">( grid, current_date(1:19) )<a name='616'>
<a name='617'>
      write(message,*) 'current_date= ', current_date<a name='618'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_508">(message)<a name='619'>
<a name='620'>
   END DO<a name='621'>
END SUBROUTINE med_sidata_input<a name='622'>
<a name='623'>
<A NAME='COMPUTE_SI_START_AND_END'><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='624'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>compute_si_start_and_end</font> (  &amp; <A href='../../call_to/COMPUTE_SI_START_AND_END.html' TARGET='index'>3</A>,<A href='../../call_from/COMPUTE_SI_START_AND_END.html' TARGET='index'>10</A><a name='625'>
          start_year, start_month, start_day, start_hour, &amp;<a name='626'>
          start_minute, start_second, &amp;<a name='627'>
          end_year ,   end_month ,   end_day ,   end_hour , &amp;<a name='628'>
          end_minute ,   end_second , &amp;<a name='629'>
          interval_seconds , real_data_init_type , &amp;<a name='630'>
          start_date_char , end_date_char , time_loop_max )<a name='631'>
<a name='632'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_9"><a name='633'>
<a name='634'>
   IMPLICIT NONE<a name='635'>
<a name='636'>
   INTEGER :: start_year , start_month , start_day , &amp;<a name='637'>
              start_hour , start_minute , start_second<a name='638'>
   INTEGER ::   end_year ,   end_month ,   end_day , &amp;<a name='639'>
                end_hour ,   end_minute ,   end_second<a name='640'>
   INTEGER :: interval_seconds , real_data_init_type<a name='641'>
   INTEGER :: time_loop_max , time_loop<a name='642'>
<a name='643'>
   CHARACTER(LEN=132) :: message<a name='644'>
   CHARACTER(LEN=19)  :: current_date_char , start_date_char , &amp;<a name='645'>
                        end_date_char , next_date_char<a name='646'>
<a name='647'>
<font color=#447700>!   WRITE ( start_date_char , FMT = &amp;<a name='648'></font>
<font color=#447700>!         '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='649'></font>
<font color=#447700>!         start_year,start_month,start_day,start_hour,start_minute,start_second<a name='650'></font>
<font color=#447700>!   WRITE (   end_date_char , FMT = &amp;<a name='651'></font>
<font color=#447700>!         '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='652'></font>
<font color=#447700>!          end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='653'></font>
<a name='654'>
   WRITE ( start_date_char , FMT = &amp;<a name='655'>
         '(I4.4,"-",I2.2,"-",I2.2,"T",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='656'>
         start_year,start_month,start_day,start_hour,start_minute,start_second<a name='657'>
   WRITE (   end_date_char , FMT = &amp;<a name='658'>
         '(I4.4,"-",I2.2,"-",I2.2,"T",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='659'>
          end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='660'>
<a name='661'>
<font color=#447700>!  start_date = start_date_char // '.0000'<a name='662'></font>
<a name='663'>
   <font color=#447700>!  Figure out our loop count for the processing times.<a name='664'></font>
<a name='665'>
   time_loop = 1<a name='666'>
   PRINT '(A,I4,A,A,A)','Time period #',time_loop, &amp;<a name='667'>
                        ' to process = ',start_date_char,'.'<a name='668'>
   current_date_char = start_date_char<a name='669'>
   loop_count : DO<a name='670'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_12"> (next_date_char, current_date_char, interval_seconds )<a name='671'>
      IF      ( next_date_char .LT. end_date_char ) THEN<a name='672'>
         time_loop = time_loop + 1<a name='673'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,&amp;<a name='674'>
                              ' to process = ',next_date_char,'.'<a name='675'>
         current_date_char = next_date_char<a name='676'>
      ELSE IF ( next_date_char .EQ. end_date_char ) THEN<a name='677'>
         time_loop = time_loop + 1<a name='678'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,&amp;<a name='679'>
                              ' to process = ',next_date_char,'.'<a name='680'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='681'>
         time_loop_max = time_loop<a name='682'>
         EXIT loop_count<a name='683'>
      ELSE IF ( next_date_char .GT. end_date_char ) THEN<a name='684'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='685'>
         time_loop_max = time_loop<a name='686'>
         EXIT loop_count<a name='687'>
      END IF<a name='688'>
   END DO loop_count<a name='689'>
        write(message,*) 'done in si_start_and_end'<a name='690'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_509">(message)<a name='691'>
END SUBROUTINE compute_si_start_and_end<a name='692'>
<a name='693'>
<A NAME='ASSEMBLE_OUTPUT'><A href='../../html_code/main/real_nmm.F.html#ASSEMBLE_OUTPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='694'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>assemble_output</font> ( grid , config_flags , loop , time_loop_max ) <A href='../../call_to/ASSEMBLE_OUTPUT.html' TARGET='index'>4</A>,<A href='../../call_from/ASSEMBLE_OUTPUT.html' TARGET='index'>248</A><a name='695'>
<a name='696'>
<font color=#447700>!!! replace with something?   USE module_big_step_utilities_em<a name='697'></font>
<a name='698'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_212"><a name='699'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_17"><a name='700'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_139"><a name='701'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_10"><a name='702'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_16"><a name='703'>
   IMPLICIT NONE<a name='704'>
<a name='705'>
#if ( HWRF == 1 )<a name='706'>
  external get_wrf_debug_level<a name='707'>
  integer :: debug<a name='708'>
#endif<a name='709'>
<a name='710'>
   TYPE(domain)                 :: grid<a name='711'>
   TYPE (grid_config_rec_type)  :: config_flags<a name='712'>
   INTEGER , INTENT(IN)         :: loop , time_loop_max<a name='713'>
   character*255 :: mess<a name='714'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='715'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='716'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='717'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='718'>
   INTEGER :: inc_h,inc_v<a name='719'>
   INTEGER :: i , j , k , idts<a name='720'>
<a name='721'>
   INTEGER :: id1 , interval_seconds , ierr, rc, sst_update<a name='722'>
   INTEGER , SAVE :: id ,id4<a name='723'>
   CHARACTER (LEN=80) :: inpname , bdyname<a name='724'>
   CHARACTER(LEN= 4) :: loop_char<a name='725'>
   CHARACTER(LEN=132) :: message<a name='726'>
character *19 :: temp19<a name='727'>
character *24 :: temp24 , temp24b<a name='728'>
<a name='729'>
   REAL, DIMENSION(:,:,:), ALLOCATABLE, SAVE :: ubdy3dtemp1 , vbdy3dtemp1 ,&amp;<a name='730'>
                                                tbdy3dtemp1 , &amp;<a name='731'>
				                cwmbdy3dtemp1 , qbdy3dtemp1,&amp;<a name='732'>
                                                q2bdy3dtemp1 , pdbdy2dtemp1<a name='733'>
   REAL, DIMENSION(:,:,:), ALLOCATABLE, SAVE :: ubdy3dtemp2 , vbdy3dtemp2 , &amp;<a name='734'>
                                                tbdy3dtemp2 , &amp; <a name='735'>
                                                cwmbdy3dtemp2 , qbdy3dtemp2, &amp;<a name='736'>
                                                q2bdy3dtemp2, pdbdy2dtemp2<a name='737'>
   REAL :: t1,t2<a name='738'>
<a name='739'>
#ifdef DEREF_KLUDGE<a name='740'>
<font color=#447700>!  see http://www.mmm.ucar.edu/wrf/WG2/topics/deref_kludge.htm<a name='741'></font>
   INTEGER     :: sm31 , em31 , sm32 , em32 , sm33 , em33<a name='742'>
   INTEGER     :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='743'>
   INTEGER     :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='744'>
#endif<a name='745'>
<a name='746'>
#if ( HWRF == 1 )<a name='747'>
  <font color=#447700>! Sam says:<a name='748'></font>
<a name='749'>
  <font color=#447700>! The *B arrays are used to read boundary data written out by hwrf_prep_hybrid<a name='750'></font>
  REAL,ALLOCATABLE,DIMENSION(:,:,:)::TB,UB,VB,QB,CWMB<a name='751'>
  REAL,ALLOCATABLE,DIMENSION(:,:)::PDB<a name='752'>
<a name='753'>
  <font color=#447700>! Dimensions and looping variables:<a name='754'></font>
  INTEGER :: KB, LM, IM, JM, N<a name='755'>
<a name='756'>
  <font color=#447700>! Unit number to read boundary data from (changes each time)<a name='757'></font>
  INTEGER :: iunit_gfs<a name='758'>
<a name='759'>
  <font color=#447700>! Did we allocate the prep_hybrid input arrays?<a name='760'></font>
  LOGICAL :: alloc_ph_arrays<a name='761'>
<a name='762'>
  integer :: ioerror<a name='763'>
#endif<a name='764'>
<a name='765'>
#include "<A href='../../html_code/include/deref_kludge.h.html'>deref_kludge.h</A>"<A NAME="deref_kludge.h_4"><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='766'>
<a name='767'>
#if ( HWRF == 1 )<a name='768'>
  alloc_ph_arrays=.false.<a name='769'>
  call <A href='../../html_code/frame/wrf_debug.F.html#GET_WRF_DEBUG_LEVEL'>get_wrf_debug_level</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_WRF_DEBUG_LEVEL_5">(debug)<a name='770'>
#endif<a name='771'>
<a name='772'>
   <font color=#447700>!  Various sizes that we need to be concerned about.<a name='773'></font>
<a name='774'>
   ids = grid%sd31<a name='775'>
   ide = grid%ed31-1 <font color=#447700>! 030730tst<a name='776'></font>
   jds = grid%sd32<a name='777'>
   jde = grid%ed32-1 <font color=#447700>! 030730tst<a name='778'></font>
   kds = grid%sd33<a name='779'>
   kde = grid%ed33-1 <font color=#447700>! 030730tst<a name='780'></font>
<a name='781'>
   ims = grid%sm31<a name='782'>
   ime = grid%em31<a name='783'>
   jms = grid%sm32<a name='784'>
   jme = grid%em32<a name='785'>
   kms = grid%sm33<a name='786'>
   kme = grid%em33<a name='787'>
<a name='788'>
   ips = grid%sp31<a name='789'>
   ipe = grid%ep31-1 <font color=#447700>! 030730tst<a name='790'></font>
   jps = grid%sp32<a name='791'>
   jpe = grid%ep32-1 <font color=#447700>! 030730tst<a name='792'></font>
   kps = grid%sp33<a name='793'>
   kpe = grid%ep33-1 <font color=#447700>! 030730tst<a name='794'></font>
<a name='795'>
        if (IPE .ne. IDE) IPE=IPE+1<a name='796'>
        if (JPE .ne. JDE) JPE=JPE+1<a name='797'>
<a name='798'>
        write(message,*) 'assemble output (ids,ide): ', ids,ide<a name='799'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_510">(message)<a name='800'>
        write(message,*) 'assemble output (ims,ime): ', ims,ime<a name='801'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_511">(message)<a name='802'>
        write(message,*) 'assemble output (ips,ipe): ', ips,ipe<a name='803'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_512">(message)<a name='804'>
 <a name='805'>
        write(message,*) 'assemble output (jds,jde): ', jds,jde<a name='806'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_513">(message)<a name='807'>
        write(message,*) 'assemble output (jms,jme): ', jms,jme<a name='808'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_514">(message)<a name='809'>
        write(message,*) 'assemble output (jps,jpe): ', jps,jpe<a name='810'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_515">(message)<a name='811'>
 <a name='812'>
        write(message,*) 'assemble output (kds,kde): ', kds,kde<a name='813'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_516">(message)<a name='814'>
        write(message,*) 'assemble output (kms,kme): ', kms,kme<a name='815'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_517">(message)<a name='816'>
        write(message,*) 'assemble output (kps,kpe): ', kps,kpe<a name='817'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_518">(message)<a name='818'>
<a name='819'>
   ijds = MIN ( ids , jds )<a name='820'>
<font color=#447700>!mptest030805   ijde = MAX ( ide , jde )<a name='821'></font>
   ijde = MAX ( ide , jde ) + 1   <font color=#447700>! to make stuff_bdy dimensions consistent with alloc<a name='822'></font>
<a name='823'>
   <font color=#447700>!  Boundary width, scalar value.<a name='824'></font>
<a name='825'>
   spec_bdy_width = model_config_rec%spec_bdy_width<a name='826'>
   interval_seconds = model_config_rec%interval_seconds<a name='827'>
   sst_update = model_config_rec%sst_update<a name='828'>
<a name='829'>
<font color=#447700>!-----------------------------------------------------------------------<a name='830'></font>
<font color=#447700>!<a name='831'></font>
   main_loop_test: IF ( loop .EQ. 1 ) THEN<a name='832'>
<font color=#447700>!<a name='833'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='834'></font>
<a name='835'>
      IF ( time_loop_max .NE. 1 ) THEN<a name='836'>
         IF(sst_update .EQ. 1)THEN<a name='837'>
           CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_14">( inpname , 'wrflowinp' , grid%id , 2 )<a name='838'>
           CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_15"> ( id4, TRIM(inpname) , grid , config_flags , output_auxinput4 , "DATASET=AUXINPUT4", ierr )<a name='839'>
           IF ( ierr .NE. 0 ) THEN<a name='840'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_434">( 'real: error opening wrflowinp for writing' )<a name='841'>
           END IF<a name='842'>
           CALL output_auxinput4 ( id4, grid , config_flags , ierr )<a name='843'>
         END IF<a name='844'>
      END IF<a name='845'>
<a name='846'>
<a name='847'>
   <font color=#447700>!  This is the space needed to save the current 3d data for use in computing<a name='848'></font>
   <font color=#447700>!  the lateral boundary tendencies.<a name='849'></font>
<a name='850'>
      ALLOCATE ( ubdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='851'>
      ALLOCATE ( vbdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='852'>
      ALLOCATE ( tbdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='853'>
      ALLOCATE ( qbdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='854'>
      ALLOCATE ( cwmbdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='855'>
      ALLOCATE ( q2bdy3dtemp1(ims:ime,jms:jme,kms:kme) )<a name='856'>
      ALLOCATE ( pdbdy2dtemp1(ims:ime,jms:jme,1:1) )<a name='857'>
<a name='858'>
	ubdy3dtemp1=0.<a name='859'>
	vbdy3dtemp1=0.<a name='860'>
	tbdy3dtemp1=0.<a name='861'>
	qbdy3dtemp1=0.<a name='862'>
	cwmbdy3dtemp1=0.<a name='863'>
	q2bdy3dtemp1=0.<a name='864'>
	pdbdy2dtemp1=0.<a name='865'>
<a name='866'>
      ALLOCATE ( ubdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='867'>
      ALLOCATE ( vbdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='868'>
      ALLOCATE ( tbdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='869'>
      ALLOCATE ( qbdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='870'>
      ALLOCATE ( cwmbdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='871'>
      ALLOCATE ( q2bdy3dtemp2(ims:ime,jms:jme,kms:kme) )<a name='872'>
      ALLOCATE ( pdbdy2dtemp2(ims:ime,jms:jme,1:1) )<a name='873'>
<a name='874'>
	ubdy3dtemp2=0.<a name='875'>
	vbdy3dtemp2=0.<a name='876'>
	tbdy3dtemp2=0.<a name='877'>
	qbdy3dtemp2=0.<a name='878'>
	cwmbdy3dtemp2=0.<a name='879'>
	q2bdy3dtemp2=0.<a name='880'>
	pdbdy2dtemp2=0.<a name='881'>
<a name='882'>
      <font color=#447700>!  Open the wrfinput file.  From this program, this is an *output* file.<a name='883'></font>
<a name='884'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_15">( inpname , 'wrfinput' , grid%id , 2 )<a name='885'>
<a name='886'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_16"> ( id1, TRIM(inpname) , grid , config_flags , &amp;<a name='887'>
                            output_input , "DATASET=INPUT", ierr )<a name='888'>
<a name='889'>
      IF ( ierr .NE. 0 ) THEN<a name='890'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_435">( 'real: error opening wrfinput for writing' )<a name='891'>
      ENDIF<a name='892'>
<a name='893'>
<font color=#447700>!     CALL calc_current_date ( grid%id , 0. )<a name='894'></font>
<font color=#447700>!      grid%write_metadata = .true.<a name='895'></font>
<a name='896'>
        write(message,*) 'making call to output_input'<a name='897'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_519">(message)<a name='898'>
<a name='899'>
        CALL output_input ( id1, grid , config_flags , ierr )<a name='900'>
<a name='901'>
<font color=#447700>!***<a name='902'></font>
<font color=#447700>!***  CLOSE THE WRFINPUT DATASET<a name='903'></font>
<font color=#447700>!***<a name='904'></font>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_20"> ( id1 , config_flags , "DATASET=INPUT" )<a name='905'>
<a name='906'>
      <font color=#447700>!  We need to save the 3d data to compute a <a name='907'></font>
      <font color=#447700>!  difference during the next loop. <a name='908'></font>
<a name='909'>
<font color=#447700>!<a name='910'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='911'></font>
<font color=#447700>!***  SOUTHERN BOUNDARY<a name='912'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='913'></font>
<font color=#447700>!<a name='914'></font>
<a name='915'>
        IF(JPS==JDS)THEN<a name='916'>
          J=1<a name='917'>
          DO k = kps , MIN(kde,kpe)<a name='918'>
          DO i = ips , MIN(ide,ipe)<a name='919'>
            ubdy3dtemp1(i,j,k) = grid%u(i,j,k)<a name='920'>
            vbdy3dtemp1(i,j,k) = grid%v(i,j,k)<a name='921'>
            tbdy3dtemp1(i,j,k) = grid%t(i,j,k)<a name='922'>
            qbdy3dtemp1(i,j,k) = grid%q(i,j,k)<a name='923'>
            cwmbdy3dtemp1(i,j,k) = grid%cwm(i,j,k)<a name='924'>
            q2bdy3dtemp1(i,j,k) = grid%q2(i,j,k)<a name='925'>
          END DO<a name='926'>
          END DO<a name='927'>
<a name='928'>
          DO i = ips , MIN(ide,ipe)<a name='929'>
            pdbdy2dtemp1(i,j,1) = grid%pd(i,j)<a name='930'>
          END DO<a name='931'>
        ENDIF<a name='932'>
<a name='933'>
<font color=#447700>!<a name='934'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='935'></font>
<font color=#447700>!***  NORTHERN BOUNDARY<a name='936'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='937'></font>
<font color=#447700>!<a name='938'></font>
        IF(JPE==JDE)THEN<a name='939'>
          J=MIN(JDE,JPE)<a name='940'>
          DO k = kps , MIN(kde,kpe)<a name='941'>
          DO i = ips , MIN(ide,ipe)<a name='942'>
            ubdy3dtemp1(i,j,k) = grid%u(i,j,k)<a name='943'>
            vbdy3dtemp1(i,j,k) = grid%v(i,j,k)<a name='944'>
            tbdy3dtemp1(i,j,k) = grid%t(i,j,k)<a name='945'>
            qbdy3dtemp1(i,j,k) = grid%q(i,j,k)<a name='946'>
            cwmbdy3dtemp1(i,j,k) = grid%cwm(i,j,k)<a name='947'>
            q2bdy3dtemp1(i,j,k) = grid%q2(i,j,k)<a name='948'>
          END DO<a name='949'>
          END DO<a name='950'>
<a name='951'>
          DO i = ips , MIN(ide,ipe)<a name='952'>
            pdbdy2dtemp1(i,j,1) = grid%pd(i,j)<a name='953'>
          END DO<a name='954'>
        ENDIF<a name='955'>
<a name='956'>
<font color=#447700>!<a name='957'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='958'></font>
<font color=#447700>!***  WESTERN BOUNDARY<a name='959'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='960'></font>
<font color=#447700>!<a name='961'></font>
        write(message,*) 'western boundary, store winds over J: ', jps, min(jpe,jde)<a name='962'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_520">(message)<a name='963'>
<a name='964'>
        IF(IPS==IDS)THEN<a name='965'>
          I=1<a name='966'>
          DO k = kps , MIN(kde,kpe)<a name='967'>
          inc_h=mod(jps+1,2)<a name='968'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='969'>
<a name='970'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='971'>
            tbdy3dtemp1(i,j,k) = grid%t(i,j,k)<a name='972'>
            qbdy3dtemp1(i,j,k) = grid%q(i,j,k)<a name='973'>
            cwmbdy3dtemp1(i,j,k) = grid%cwm(i,j,k)<a name='974'>
            q2bdy3dtemp1(i,j,k) = grid%q2(i,j,k)<a name='975'>
      if(k==1)then<a name='976'>
        write(message,*)' loop=',loop,' i=',i,' j=',j,' tbdy3dtemp1(i,j,k)=',tbdy3dtemp1(i,j,k)<a name='977'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_372">(10,message)<a name='978'>
      endif<a name='979'>
	endif<a name='980'>
          END DO<a name='981'>
          END DO<a name='982'>
<a name='983'>
          DO k = kps , MIN(kde,kpe)<a name='984'>
          inc_v=mod(jps,2)<a name='985'>
          DO j = jps+inc_v, min(jde,jpe),2<a name='986'>
        if (J .ge. 2 .and. J .le. JDE-1 .and. mod(J,2) .eq. 0) then<a name='987'>
            ubdy3dtemp1(i,j,k) = grid%u(i,j,k)<a name='988'>
            vbdy3dtemp1(i,j,k) = grid%v(i,j,k)<a name='989'>
	endif<a name='990'>
          END DO<a name='991'>
          END DO<a name='992'>
<font color=#447700>!<a name='993'></font>
          inc_h=mod(jps+1,2)<a name='994'>
        DO j = jps+inc_h, min(jde,jpe),2<a name='995'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='996'>
            pdbdy2dtemp1(i,j,1) = grid%pd(i,j)<a name='997'>
          write(message,*)' loop=',loop,' i=',i,' j=',j,' pdbdy2dtemp1(i,j)=',pdbdy2dtemp1(i,j,1)<a name='998'>
          CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_373">(10,message)<a name='999'>
	endif<a name='1000'>
          END DO<a name='1001'>
        ENDIF<a name='1002'>
<font color=#447700>!<a name='1003'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1004'></font>
<font color=#447700>!***  EASTERN BOUNDARY<a name='1005'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1006'></font>
<font color=#447700>!<a name='1007'></font>
        IF(IPE==IDE)THEN<a name='1008'>
          I=MIN(IDE,IPE)<a name='1009'>
<font color=#447700>!<a name='1010'></font>
          DO k = kps , MIN(kde,kpe)<a name='1011'>
<font color=#447700>!<a name='1012'></font>
<font color=#447700>!***   Make sure the J loop is on the global boundary<a name='1013'></font>
<font color=#447700>!<a name='1014'></font>
          inc_h=mod(jps+1,2)<a name='1015'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='1016'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='1017'>
            tbdy3dtemp1(i,j,k) = grid%t(i,j,k)<a name='1018'>
            qbdy3dtemp1(i,j,k) = grid%q(i,j,k)<a name='1019'>
            cwmbdy3dtemp1(i,j,k) = grid%cwm(i,j,k)<a name='1020'>
            q2bdy3dtemp1(i,j,k) = grid%q2(i,j,k)<a name='1021'>
	endif<a name='1022'>
          END DO<a name='1023'>
          END DO<a name='1024'>
<a name='1025'>
          DO k = kps , MIN(kde,kpe)<a name='1026'>
          inc_v=mod(jps,2)<a name='1027'>
          DO j = jps+inc_v, min(jde,jpe),2<a name='1028'>
        if (J .ge. 2 .and. J .le. JDE-1 .and. mod(J,2) .eq. 0) then<a name='1029'>
            ubdy3dtemp1(i,j,k) = grid%u(i,j,k)<a name='1030'>
            vbdy3dtemp1(i,j,k) = grid%v(i,j,k)<a name='1031'>
        endif<a name='1032'>
          END DO<a name='1033'>
          END DO<a name='1034'>
<font color=#447700>!<a name='1035'></font>
          inc_h=mod(jps+1,2)<a name='1036'>
          DO j = jps+inc_h, min(jde,jpe),2<a name='1037'>
        if (J .ge. 3 .and. J .le. JDE-2 .and. mod(J,2) .eq. 1) then<a name='1038'>
            pdbdy2dtemp1(i,j,1) = grid%pd(i,j)<a name='1039'>
	endif<a name='1040'>
          END DO<a name='1041'>
        ENDIF<a name='1042'>
<a name='1043'>
<a name='1044'>
      <font color=#447700>!  There are 2 components to the lateral boundaries.  <a name='1045'></font>
      <font color=#447700>!  First, there is the starting<a name='1046'></font>
      <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='1047'></font>
<a name='1048'>
<a name='1049'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_15"> (ubdy3dtemp1, grid%u_bxs, grid%u_bxe, &amp;<a name='1050'>
                                  grid%u_bys, grid%u_bye, &amp;<a name='1051'>
                                  'N', spec_bdy_width  , &amp;<a name='1052'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1053'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1054'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1055'>
<a name='1056'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_16"> (vbdy3dtemp1, grid%v_bxs, grid%v_bxe, &amp;<a name='1057'>
                                  grid%v_bys, grid%v_bye, &amp;<a name='1058'>
                                  'N', spec_bdy_width  , &amp;<a name='1059'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1060'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1061'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1062'>
<a name='1063'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_17"> (tbdy3dtemp1, grid%t_bxs, grid%t_bxe, &amp;<a name='1064'>
                                  grid%t_bys, grid%t_bye, &amp;<a name='1065'>
                                  'N', spec_bdy_width  , &amp;<a name='1066'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1067'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1068'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1069'>
<a name='1070'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_18"> (cwmbdy3dtemp1, grid%cwm_bxs, grid%cwm_bxe, &amp;<a name='1071'>
                                  grid%cwm_bys, grid%cwm_bye, &amp;<a name='1072'>
                                  'N', spec_bdy_width  , &amp;<a name='1073'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1074'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1075'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1076'>
<a name='1077'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_19"> (qbdy3dtemp1, grid%q_bxs, grid%q_bxe, &amp;<a name='1078'>
                                  grid%q_bys, grid%q_bye, &amp;<a name='1079'>
                                  'N', spec_bdy_width  , &amp;<a name='1080'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1081'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1082'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1083'>
<a name='1084'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_20"> (q2bdy3dtemp1, grid%q2_bxs, grid%q2_bxe, &amp;<a name='1085'>
                                  grid%q2_bys, grid%q2_bye, &amp;<a name='1086'>
                                  'N', spec_bdy_width  , &amp;<a name='1087'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1088'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1089'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1090'>
<a name='1091'>
<a name='1092'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_21"> (pdbdy2dtemp1, grid%pd_bxs, grid%pd_bxe, &amp;<a name='1093'>
                                   grid%pd_bys, grid%pd_bye, &amp;<a name='1094'>
                                   'M', spec_bdy_width, &amp;<a name='1095'>
                                   ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='1096'>
                                   ims , ime , jms , jme , 1 , 1 , &amp;<a name='1097'>
                                   ips , ipe , jps , jpe , 1 , 1 )<a name='1098'>
<a name='1099'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1100'></font>
<font color=#447700>!<a name='1101'></font>
   ELSE IF ( loop .GT. 1 ) THEN<a name='1102'>
<font color=#447700>!<a name='1103'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1104'></font>
<a name='1105'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_374">(1,'LOOP&gt;1, so start making non-init boundary conditions')<a name='1106'>
#if ( HWRF == 1 )<a name='1107'>
<a name='1108'>
     bdytmp_useph: if(grid%use_prep_hybrid) then<a name='1109'>
        call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_375">(1,'ALLOCATE PREP_HYBRID BOUNDARY ARRAYS')<a name='1110'>
        <font color=#447700>!! When running in prep_hybrid mode, we must read in the data here.<a name='1111'></font>
<a name='1112'>
        <font color=#447700>! Allocate boundary arrays:<a name='1113'></font>
        KB = 2*IDE + JDE - 3<a name='1114'>
        LM = KDE<a name='1115'>
        IM = IDE<a name='1116'>
        JM = JDE<a name='1117'>
        ALLOCATE(TB(KB,LM,2))<a name='1118'>
        ALLOCATE(QB(KB,LM,2))<a name='1119'>
        ALLOCATE(CWMB(KB,LM,2))<a name='1120'>
        ALLOCATE(UB(KB,LM,2))<a name='1121'>
        ALLOCATE(VB(KB,LM,2))<a name='1122'>
        ALLOCATE(PDB(KB,2))<a name='1123'>
        alloc_ph_arrays=.true.<a name='1124'>
<a name='1125'>
        <font color=#447700>! Read in the data:<a name='1126'></font>
        IUNIT_GFS = 900 + LOOP - 1<a name='1127'>
        READ(IUNIT_GFS,iostat=ioerror) PDB,TB,QB,CWMB,UB,VB<a name='1128'>
        if(ioerror/=0) then<a name='1129'>
           write(message,*) 'Unable to read MAKBND output from unit ',IUNIT_GFS<a name='1130'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_436">(message)<a name='1131'>
        endif<a name='1132'>
<a name='1133'>
        <font color=#447700>! Now copy the data into the temporary boundary arrays, and<a name='1134'></font>
        <font color=#447700>! switch from IKJ to IJK while we do it.<a name='1135'></font>
<a name='1136'>
        <font color=#447700>!!    Southern boundary<a name='1137'></font>
<a name='1138'>
        IF(JPS.EQ.JDS)THEN<a name='1139'>
           J=1<a name='1140'>
<a name='1141'>
           DO k = kps , MIN(kde,kpe)<a name='1142'>
              N=1<a name='1143'>
              DO i = ips , MIN(ide,ipe)<a name='1144'>
                 tbdy3dtemp2(i,j,k) =   TB(N,k,1)<a name='1145'>
                 qbdy3dtemp2(i,j,k) =   QB(N,k,1)<a name='1146'>
                 cwmbdy3dtemp2(i,j,k) = CWMB(N,k,1)<a name='1147'>
                 q2bdy3dtemp2(i,j,k) =  0.0        <font color=#447700>!KWON<a name='1148'></font>
                 write(message,*)'southtend t',k,i,n,tbdy3dtemp2(i,j,k)<a name='1149'>
                 call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_376">(10,message)<a name='1150'>
                 write(message,*)'southtend q',k,i,n,qbdy3dtemp2(i,j,k)<a name='1151'>
                 call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_377">(10,message)<a name='1152'>
                 if (K .eq. 1 ) then<a name='1153'>
                    write(mess,*) 'S boundary values T,Q : ', I,tbdy3dtemp2(i,j,k),  &amp;<a name='1154'>
                         qbdy3dtemp2(i,j,k)<a name='1155'>
                    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_378">(1,message)<a name='1156'>
                 endif<a name='1157'>
                 N=N+1<a name='1158'>
              END DO<a name='1159'>
           END DO<a name='1160'>
<a name='1161'>
           DO k = kps , MIN(kde,kpe)<a name='1162'>
              N=1<a name='1163'>
              DO i = ips , MIN(ide,ipe)<a name='1164'>
                 ubdy3dtemp2(i,j,k) = UB(N,k,1)<a name='1165'>
                 vbdy3dtemp2(i,j,k) = VB(N,k,1)<a name='1166'>
                 N=N+1<a name='1167'>
              ENDDO<a name='1168'>
           END DO<a name='1169'>
<a name='1170'>
           N=1<a name='1171'>
           DO i = ips , MIN(ide,ipe)<a name='1172'>
              pdbdy2dtemp2(i,j,1) = PDB(N,1)<a name='1173'>
              write(message,*)'southtend p',i,n,pdbdy2dtemp1(i,j,1)<a name='1174'>
              call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_379">(10,message)<a name='1175'>
              N=N+1<a name='1176'>
           END DO<a name='1177'>
<a name='1178'>
        ENDIF<a name='1179'>
<a name='1180'>
        <font color=#447700>!     Northern boundary<a name='1181'></font>
<a name='1182'>
        IF(JPE.EQ.JDE)THEN<a name='1183'>
<a name='1184'>
           J=MIN(JDE,JPE)<a name='1185'>
           DO k = kps , MIN(kde,kpe)<a name='1186'>
              N=IM+1<a name='1187'>
              DO i = ips , MIN(ide,ipe)<a name='1188'>
                 tbdy3dtemp2(i,j,k) =   TB(N,k,1)<a name='1189'>
                 qbdy3dtemp2(i,j,k) =   QB(N,k,1)<a name='1190'>
                 cwmbdy3dtemp2(i,j,k) = CWMB(N,k,1)<a name='1191'>
                 q2bdy3dtemp2(i,j,k) =  0.0        <font color=#447700>!KWON<a name='1192'></font>
                    write(message,*)'northtend t',k,i,n,tbdy3dtemp2(i,j,k)<a name='1193'>
                    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_380">(10,message)<a name='1194'>
                    write(message,*)'northtend q',k,i,n,qbdy3dtemp2(i,j,k)<a name='1195'>
                    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_381">(10,message)<a name='1196'>
                 N=N+1<a name='1197'>
              END DO<a name='1198'>
           END DO<a name='1199'>
<a name='1200'>
           DO k = kps , MIN(kde,kpe)<a name='1201'>
              N=IM<a name='1202'>
              DO i = ips , MIN(ide,ipe)<a name='1203'>
                 ubdy3dtemp2(i,j,k) = UB(N,k,1)<a name='1204'>
                 vbdy3dtemp2(i,j,k) = VB(N,k,1)<a name='1205'>
                 N=N+1<a name='1206'>
              END DO<a name='1207'>
           END DO<a name='1208'>
<a name='1209'>
           N=IM+1<a name='1210'>
           DO i = ips , MIN(ide,ipe)<a name='1211'>
              pdbdy2dtemp2(i,j,1) = PDB(N,1)<a name='1212'>
                 write(message,*)'northtend p',i,n,pdbdy2dtemp1(i,j,1)<a name='1213'>
                 call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_382">(10,message)<a name='1214'>
              N=N+1<a name='1215'>
           END DO<a name='1216'>
<a name='1217'>
        ENDIF<a name='1218'>
<a name='1219'>
        <font color=#447700>!!     Western boundary<a name='1220'></font>
<a name='1221'>
        IF(IPS.EQ.IDS)THEN<a name='1222'>
           I=1<a name='1223'>
           DO k = kps , MIN(kde,kpe)<a name='1224'>
              N=2*IM+1<a name='1225'>
              inc_h=mod(jps+1,2)<a name='1226'>
              DO j = jps+inc_h, MIN(jde,jpe),2<a name='1227'>
                 if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1228'>
                    tbdy3dtemp2(i,j,k) =   TB(N,k,1)<a name='1229'>
                    qbdy3dtemp2(i,j,k) =   QB(N,k,1)<a name='1230'>
                    cwmbdy3dtemp2(i,j,k) = CWMB(N,k,1)<a name='1231'>
                    q2bdy3dtemp2(i,j,k) =  0.0        <font color=#447700>!KWON<a name='1232'></font>
                       write(message,*)'westtend t',k,j,n,tbdy3dtemp2(i,j,k)<a name='1233'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_383">(10,message)<a name='1234'>
                       write(message,*)'westtend q',k,j,n,qbdy3dtemp2(i,j,k)<a name='1235'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_384">(10,message)<a name='1236'>
                    N=N+1<a name='1237'>
                 endif<a name='1238'>
              END DO<a name='1239'>
           END DO<a name='1240'>
<a name='1241'>
           DO k = kps , MIN(kde,kpe)<a name='1242'>
              N=2*IM-1<a name='1243'>
              inc_v=mod(jps,2)<a name='1244'>
              DO j = jps+inc_v, MIN(jde,jpe),2<a name='1245'>
                 if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='1246'>
                    ubdy3dtemp2(i,j,k) = UB(N,k,1)<a name='1247'>
                    vbdy3dtemp2(i,j,k) = VB(N,k,1)<a name='1248'>
                    N=N+1<a name='1249'>
                 endif<a name='1250'>
              END DO<a name='1251'>
           END DO<a name='1252'>
<a name='1253'>
           N=2*IM+1<a name='1254'>
           inc_h=mod(jps+1,2)<a name='1255'>
           DO j = jps+inc_h, MIN(jde,jpe),2<a name='1256'>
              if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1257'>
                 pdbdy2dtemp2(i,j,1) = PDB(N,1)<a name='1258'>
                    write(message,*)'westtend p',j,n,pdbdy2dtemp1(i,j,1)<a name='1259'>
                    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_385">(10,message)<a name='1260'>
                 N=N+1<a name='1261'>
              endif<a name='1262'>
           END DO<a name='1263'>
<a name='1264'>
        ENDIF<a name='1265'>
<a name='1266'>
        <font color=#447700>!!     Eastern boundary<a name='1267'></font>
<a name='1268'>
        IF(IPE.EQ.IDE)THEN<a name='1269'>
<a name='1270'>
           I=MIN(IDE,IPE)<a name='1271'>
<a name='1272'>
           DO k = kps , MIN(kde,kpe)<a name='1273'>
              N=2*IM+(JM/2)<a name='1274'>
              inc_h=mod(jps+1,2)<a name='1275'>
              DO j = jps+inc_h, MIN(jde,jpe),2<a name='1276'>
                 if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1277'>
                    tbdy3dtemp2(i,j,k) =   TB(N,k,1)<a name='1278'>
                    qbdy3dtemp2(i,j,k) =   QB(N,k,1)<a name='1279'>
                    cwmbdy3dtemp2(i,j,k) = CWMB(N,k,1)<a name='1280'>
                    q2bdy3dtemp2(i,j,k) =  0.0        <font color=#447700>!KWON<a name='1281'></font>
                       write(message,*)'easttend t',k,j,n,tbdy3dtemp2(i,j,k)<a name='1282'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_386">(10,message)<a name='1283'>
                       write(message,*)'easttend q',k,j,n,qbdy3dtemp2(i,j,k)<a name='1284'>
                       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_387">(10,message)<a name='1285'>
                    N=N+1<a name='1286'>
                 endif<a name='1287'>
              END DO<a name='1288'>
           END DO<a name='1289'>
<a name='1290'>
           DO k = kps , MIN(kde,kpe)<a name='1291'>
              N=2*IM+(JM/2)-1<a name='1292'>
              inc_v=mod(jps,2)<a name='1293'>
              DO j = jps+inc_v, MIN(jde,jpe),2<a name='1294'>
                 if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='1295'>
                    ubdy3dtemp2(i,j,k) = UB(N,k,1)<a name='1296'>
                    vbdy3dtemp2(i,j,k) = VB(N,k,1)<a name='1297'>
                    N=N+1<a name='1298'>
                 endif<a name='1299'>
              END DO<a name='1300'>
           END DO<a name='1301'>
<a name='1302'>
           N=2*IM+(JM/2)<a name='1303'>
           inc_h=mod(jps+1,2)<a name='1304'>
           DO j = jps+inc_h, MIN(jde,jpe),2<a name='1305'>
              if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1306'>
                 pdbdy2dtemp2(i,j,1) = PDB(N,1)<a name='1307'>
                    write(message,*)'easttend p',j,n,pdbdy2dtemp1(i,j,1)<a name='1308'>
                    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_388">(10,message)<a name='1309'>
                 N=N+1<a name='1310'>
              endif<a name='1311'>
           END DO<a name='1312'>
<a name='1313'>
        ENDIF<a name='1314'>
     else<a name='1315'>
#endif<a name='1316'>
<a name='1317'>
           CALL output_auxinput4 ( id4, grid , config_flags , ierr )<a name='1318'>
<a name='1319'>
#if ( HWRF == 1 )<a name='1320'>
     endif bdytmp_useph<a name='1321'>
#endif<a name='1322'>
<a name='1323'>
      write(message,*)' assemble_output loop=',loop,' in IF block'<a name='1324'>
      call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_521">(message)<a name='1325'>
<a name='1326'>
      <font color=#447700>!  Open the boundary file.<a name='1327'></font>
<a name='1328'>
      IF ( loop .eq. 2 ) THEN<a name='1329'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_16">( bdyname , 'wrfbdy' , grid%id , 2 )<a name='1330'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_17"> ( id, TRIM(bdyname) , grid , config_flags , &amp;<a name='1331'>
                          output_boundary , "DATASET=BOUNDARY", ierr )<a name='1332'>
         IF ( ierr .NE. 0 ) THEN<a name='1333'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_437">( 'real: error opening wrfbdy for writing' )<a name='1334'>
         ENDIF<a name='1335'>
<font color=#447700>!         grid%write_metadata = .true.<a name='1336'></font>
      ELSE<a name='1337'>
<font color=#447700>! what's this do?<a name='1338'></font>
<font color=#447700>!         grid%write_metadata = .true.<a name='1339'></font>
<font color=#447700>!         grid%write_metadata = .false.<a name='1340'></font>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE'>domain_clockadvance</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKADVANCE_6">( grid )<a name='1341'>
      END IF<a name='1342'>
<a name='1343'>
#if ( HWRF == 1 )<a name='1344'>
     bdytmp_notph: if(.not.grid%use_prep_hybrid) then<a name='1345'>
#endif<a name='1346'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1347'></font>
<font color=#447700>!***  SOUTHERN BOUNDARY<a name='1348'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1349'></font>
<font color=#447700>!<a name='1350'></font>
        IF(JPS==JDS)THEN<a name='1351'>
          J=1<a name='1352'>
          DO k = kps , MIN(kde,kpe)<a name='1353'>
          DO i = ips , MIN(ide,ipe)<a name='1354'>
            ubdy3dtemp2(i,j,k) = grid%u(i,j,k)<a name='1355'>
            vbdy3dtemp2(i,j,k) = grid%v(i,j,k)<a name='1356'>
            tbdy3dtemp2(i,j,k) = grid%t(i,j,k)<a name='1357'>
            qbdy3dtemp2(i,j,k) = grid%q(i,j,k)<a name='1358'>
            cwmbdy3dtemp2(i,j,k) = grid%cwm(i,j,k)<a name='1359'>
            q2bdy3dtemp2(i,j,k) = grid%q2(i,j,k)<a name='1360'>
          END DO<a name='1361'>
          END DO<a name='1362'>
<font color=#447700>!<a name='1363'></font>
          DO i = ips , MIN(ide,ipe)<a name='1364'>
            pdbdy2dtemp2(i,j,1) = grid%pd(i,j)<a name='1365'>
          END DO<a name='1366'>
        ENDIF<a name='1367'>
<a name='1368'>
<font color=#447700>!<a name='1369'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1370'></font>
<font color=#447700>!***  NORTHERN BOUNDARY<a name='1371'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1372'></font>
<font color=#447700>!<a name='1373'></font>
        IF(JPE==JDE)THEN<a name='1374'>
          J=MIN(JDE,JPE)<a name='1375'>
          DO k = kps , MIN(kde,kpe)<a name='1376'>
          DO i = ips , MIN(ide,ipe)<a name='1377'>
            ubdy3dtemp2(i,j,k) = grid%u(i,j,k)<a name='1378'>
            vbdy3dtemp2(i,j,k) = grid%v(i,j,k)<a name='1379'>
            tbdy3dtemp2(i,j,k) = grid%t(i,j,k)<a name='1380'>
            qbdy3dtemp2(i,j,k) = grid%q(i,j,k)<a name='1381'>
            cwmbdy3dtemp2(i,j,k) = grid%cwm(i,j,k)<a name='1382'>
            q2bdy3dtemp2(i,j,k) = grid%q2(i,j,k)<a name='1383'>
          END DO<a name='1384'>
          END DO<a name='1385'>
<a name='1386'>
          DO i = ips , MIN(ide,ipe)<a name='1387'>
            pdbdy2dtemp2(i,j,1) = grid%pd(i,j)<a name='1388'>
          END DO<a name='1389'>
        ENDIF<a name='1390'>
<font color=#447700>!<a name='1391'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1392'></font>
<font color=#447700>!***  WESTERN BOUNDARY<a name='1393'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1394'></font>
<font color=#447700>!<a name='1395'></font>
        IF(IPS==IDS)THEN<a name='1396'>
          I=1<a name='1397'>
          DO k = kps , MIN(kde,kpe)<a name='1398'>
          inc_h=mod(jps+1,2)<a name='1399'>
      if(k==1)then<a name='1400'>
        write(message,*)' assemble_ouput loop=',loop,' inc_h=',inc_h,' jps=',jps<a name='1401'>
        call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_389">(10,message)<a name='1402'>
      endif<a name='1403'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='1404'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1405'>
            tbdy3dtemp2(i,j,k) = grid%t(i,j,k)<a name='1406'>
      if(k==1)then<a name='1407'>
        write(message,*)' loop=',loop,' i=',i,' j=',j,' tbdy3dtemp1(i,j,k)=',tbdy3dtemp1(i,j,k)<a name='1408'>
        call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_390">(10,message)<a name='1409'>
      endif<a name='1410'>
            qbdy3dtemp2(i,j,k) = grid%q(i,j,k)<a name='1411'>
            cwmbdy3dtemp2(i,j,k) = grid%cwm(i,j,k)<a name='1412'>
            q2bdy3dtemp2(i,j,k) = grid%q2(i,j,k)<a name='1413'>
	endif<a name='1414'>
          END DO<a name='1415'>
          END DO<a name='1416'>
<font color=#447700>!<a name='1417'></font>
          DO k = kps , MIN(kde,kpe)<a name='1418'>
          inc_v=mod(jps,2)<a name='1419'>
          DO j = jps+inc_v, MIN(jde,jpe),2<a name='1420'>
        if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='1421'>
            ubdy3dtemp2(i,j,k) = grid%u(i,j,k)<a name='1422'>
            vbdy3dtemp2(i,j,k) = grid%v(i,j,k)<a name='1423'>
	endif<a name='1424'>
          END DO<a name='1425'>
          END DO<a name='1426'>
<a name='1427'>
          inc_h=mod(jps+1,2)<a name='1428'>
        DO j = jps+inc_h, MIN(jde,jpe),2<a name='1429'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1430'>
          pdbdy2dtemp2(i,j,1) = grid%pd(i,j)<a name='1431'>
          write(message,*)' loop=',loop,' i=',i,' j=',j,' pdbdy2dtemp1(i,j)=',pdbdy2dtemp1(i,j,1)<a name='1432'>
          CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_391">(10,message)<a name='1433'>
	endif<a name='1434'>
          END DO<a name='1435'>
        ENDIF<a name='1436'>
<font color=#447700>!<a name='1437'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1438'></font>
<font color=#447700>!***  EASTERN BOUNDARY<a name='1439'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1440'></font>
<font color=#447700>!<a name='1441'></font>
        IF(IPE==IDE)THEN<a name='1442'>
          I=MIN(IDE,IPE)<a name='1443'>
<a name='1444'>
          DO k = kps , MIN(kde,kpe)<a name='1445'>
          inc_h=mod(jps+1,2)<a name='1446'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='1447'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1448'>
            tbdy3dtemp2(i,j,k) = grid%t(i,j,k)<a name='1449'>
            qbdy3dtemp2(i,j,k) = grid%q(i,j,k)<a name='1450'>
            cwmbdy3dtemp2(i,j,k) = grid%cwm(i,j,k)<a name='1451'>
            q2bdy3dtemp2(i,j,k) = grid%q2(i,j,k)<a name='1452'>
	endif<a name='1453'>
          END DO<a name='1454'>
          END DO<a name='1455'>
<a name='1456'>
          DO k = kps , MIN(kde,kpe)<a name='1457'>
          inc_v=mod(jps,2)<a name='1458'>
          DO j = jps+inc_v, MIN(jde,jpe),2<a name='1459'>
        if (J .ge. 2 .and. J .le. jde-1 .and. mod(J,2) .eq. 0) then<a name='1460'>
            ubdy3dtemp2(i,j,k) = grid%u(i,j,k)<a name='1461'>
            vbdy3dtemp2(i,j,k) = grid%v(i,j,k)<a name='1462'>
	endif<a name='1463'>
          END DO<a name='1464'>
          END DO<a name='1465'>
<a name='1466'>
          inc_h=mod(jps+1,2)<a name='1467'>
          DO j = jps+inc_h, MIN(jde,jpe),2<a name='1468'>
        if (J .ge. 3 .and. J .le. jde-2 .and. mod(J,2) .eq. 1) then<a name='1469'>
            pdbdy2dtemp2(i,j,1) = grid%pd(i,j)<a name='1470'>
	endif<a name='1471'>
          END DO<a name='1472'>
        ENDIF<a name='1473'>
#if ( HWRF == 1 )<a name='1474'>
     endif bdytmp_notph<a name='1475'>
#endif<a name='1476'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1477'></font>
      <font color=#447700>!  During all of the loops after the first loop, <a name='1478'></font>
      <font color=#447700>!  we first compute the boundary<a name='1479'></font>
      <font color=#447700>!  tendencies with the current data values <a name='1480'></font>
      <font color=#447700>!  (*bdy3dtemp2 arrays) and the previously <a name='1481'></font>
      <font color=#447700>!  saved information stored in the *bdy3dtemp1 arrays.<a name='1482'></font>
<a name='1483'>
<a name='1484'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_8"> ( ubdy3dtemp2 , ubdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1485'>
                                   grid%u_btxs, grid%u_btxe, &amp;<a name='1486'>
                                   grid%u_btys, grid%u_btye, &amp;<a name='1487'>
                                   'N',  spec_bdy_width      , &amp;<a name='1488'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1489'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1490'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1491'>
<a name='1492'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_9"> ( vbdy3dtemp2 , vbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1493'>
                                   grid%v_btxs, grid%v_btxe, &amp;<a name='1494'>
                                   grid%v_btys, grid%v_btye, &amp;<a name='1495'>
                                   'N',  spec_bdy_width      , &amp;<a name='1496'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1497'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1498'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1499'>
<a name='1500'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_10"> ( tbdy3dtemp2 , tbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1501'>
                                   grid%t_btxs, grid%t_btxe, &amp;<a name='1502'>
                                   grid%t_btys, grid%t_btye, &amp;<a name='1503'>
                                   'N',  spec_bdy_width      , &amp;<a name='1504'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1505'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1506'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1507'>
<a name='1508'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_11"> ( cwmbdy3dtemp2 , cwmbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1509'>
                                   grid%cwm_btxs, grid%cwm_btxe, &amp;<a name='1510'>
                                   grid%cwm_btys, grid%cwm_btye, &amp;<a name='1511'>
                                   'N',  spec_bdy_width      , &amp;<a name='1512'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1513'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1514'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1515'>
<a name='1516'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_12"> ( qbdy3dtemp2 , qbdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1517'>
                                   grid%q_btxs, grid%q_btxe, &amp;<a name='1518'>
                                   grid%q_btys, grid%q_btye, &amp;<a name='1519'>
                                   'N',  spec_bdy_width      , &amp;<a name='1520'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1521'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1522'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1523'>
<a name='1524'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_13"> ( q2bdy3dtemp2 , q2bdy3dtemp1 , REAL(interval_seconds),&amp;<a name='1525'>
                                   grid%q2_btxs, grid%q2_btxe, &amp;<a name='1526'>
                                   grid%q2_btys, grid%q2_btye, &amp;<a name='1527'>
                                   'N',  spec_bdy_width      , &amp;<a name='1528'>
                                   ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1529'>
                                   ims , ime , jms , jme , kms , kme , &amp;<a name='1530'>
                                   ips , ipe , jps , jpe , kps , kpe+1 )<a name='1531'>
<a name='1532'>
      CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK'>stuff_bdytend_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_IJK_14">( pdbdy2dtemp2 , pdbdy2dtemp1, REAL(interval_seconds),&amp;<a name='1533'>
                                   grid%pd_btxs, grid%pd_btxe, &amp;<a name='1534'>
                                   grid%pd_btys, grid%pd_btye, &amp;<a name='1535'>
                                   'M',  spec_bdy_width      , &amp;<a name='1536'>
                                   ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='1537'>
                                   ims , ime   , jms , jme   , 1 , 1 , &amp;<a name='1538'>
                                   ips , ipe   , jps , jpe   , 1 , 1 )<a name='1539'>
<a name='1540'>
<a name='1541'>
<a name='1542'>
      <font color=#447700>!  Both pieces of the boundary data are now <a name='1543'></font>
      <font color=#447700>!  available to be written (initial time and tendency).<a name='1544'></font>
      <font color=#447700>!  This looks ugly, these date shifting things.  <a name='1545'></font>
      <font color=#447700>!  What's it for?  We want the "Times" variable<a name='1546'></font>
      <font color=#447700>!  in the lateral BDY file to have the valid times <a name='1547'></font>
      <font color=#447700>!  of when the initial fields are written.<a name='1548'></font>
      <font color=#447700>!  That's what the loop-2 thingy is for with the start date.  <a name='1549'></font>
      <font color=#447700>!  We increment the start_date so<a name='1550'></font>
      <font color=#447700>!  that the starting time in the attributes is the <a name='1551'></font>
      <font color=#447700>!  second time period.  Why you may ask.  I<a name='1552'></font>
      <font color=#447700>!  agree, why indeed.<a name='1553'></font>
<a name='1554'>
      temp24= current_date<a name='1555'>
      temp24b=start_date<a name='1556'>
      start_date = current_date<a name='1557'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_13"> ( temp19 , temp24b(1:19) , &amp;<a name='1558'>
                         (loop-2) * model_config_rec%interval_seconds )<a name='1559'>
      current_date = temp19 //  '.0000'<a name='1560'>
       CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_27">( grid, current_date(1:19) )<a name='1561'>
      write(message,*) 'LBC valid between these times ',current_date, ' ',start_date<a name='1562'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_522">(message)<a name='1563'>
<a name='1564'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY'>output_boundary</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_BOUNDARY_6"> ( id, grid , config_flags , ierr )<a name='1565'>
      current_date = temp24<a name='1566'>
      start_date = temp24b<a name='1567'>
<a name='1568'>
      <font color=#447700>!  OK, for all of the loops, we output the initialzation <a name='1569'></font>
      <font color=#447700>!  data, which would allow us to<a name='1570'></font>
      <font color=#447700>!  start the model at any of the available analysis time periods.<a name='1571'></font>
<a name='1572'>
<font color=#447700>!  WRITE ( loop_char , FMT = '(I4.4)' ) loop<a name='1573'></font>
<font color=#447700>!  CALL open_w_dataset ( id1, 'wrfinput'//loop_char , grid , config_flags , output_input , "DATASET=INPUT", ierr )<a name='1574'></font>
<font color=#447700>!  IF ( ierr .NE. 0 ) THEN<a name='1575'></font>
<font color=#447700>!    CALL wrf_error_fatal( 'real: error opening wrfinput'//loop_char//' for writing' )<a name='1576'></font>
<font color=#447700>!  ENDIF<a name='1577'></font>
<font color=#447700>!  grid%write_metadata = .true.<a name='1578'></font>
<a name='1579'>
<font color=#447700>!  CALL calc_current_date ( grid%id , 0. )<a name='1580'></font>
<font color=#447700>!  CALL output_input ( id1, grid , config_flags , ierr )<a name='1581'></font>
<font color=#447700>!  CALL close_dataset ( id1 , config_flags , "DATASET=INPUT" )<a name='1582'></font>
<a name='1583'>
  <font color=#447700>!  Is this or is this not the last time time?  We can remove some unnecessary<a name='1584'></font>
  <font color=#447700>!  stores if it is not.<a name='1585'></font>
<a name='1586'>
      IF     ( loop .LT. time_loop_max ) THEN<a name='1587'>
<a name='1588'>
         <font color=#447700>!  We need to save the 3d data to compute a <a name='1589'></font>
         <font color=#447700>!  difference during the next loop.  Couple the<a name='1590'></font>
         <font color=#447700>!  3d fields with total mu (mub + mu_2) and the <a name='1591'></font>
         <font color=#447700>!  stagger-specific map scale factor.<a name='1592'></font>
         <font color=#447700>!  We load up the boundary data again for use in the next loop.<a name='1593'></font>
<a name='1594'>
<a name='1595'>
<font color=#447700>!mp	change these limits?????????<a name='1596'></font>
<a name='1597'>
         DO k = kps , kpe<a name='1598'>
            DO j = jps , jpe<a name='1599'>
               DO i = ips , ipe<a name='1600'>
                  ubdy3dtemp1(i,j,k) = ubdy3dtemp2(i,j,k)<a name='1601'>
                  vbdy3dtemp1(i,j,k) = vbdy3dtemp2(i,j,k)<a name='1602'>
                  tbdy3dtemp1(i,j,k) = tbdy3dtemp2(i,j,k)<a name='1603'>
                  cwmbdy3dtemp1(i,j,k) = cwmbdy3dtemp2(i,j,k)<a name='1604'>
                  qbdy3dtemp1(i,j,k) = qbdy3dtemp2(i,j,k)<a name='1605'>
                  q2bdy3dtemp1(i,j,k) = q2bdy3dtemp2(i,j,k)<a name='1606'>
               END DO<a name='1607'>
            END DO<a name='1608'>
         END DO<a name='1609'>
<a name='1610'>
<font color=#447700>!mp	change these limits?????????<a name='1611'></font>
<a name='1612'>
         DO j = jps , jpe<a name='1613'>
            DO i = ips , ipe<a name='1614'>
               pdbdy2dtemp1(i,j,1) = pdbdy2dtemp2(i,j,1)<a name='1615'>
            END DO<a name='1616'>
         END DO<a name='1617'>
<a name='1618'>
  <font color=#447700>!  There are 2 components to the lateral boundaries.  <a name='1619'></font>
  <font color=#447700>!   First, there is the starting<a name='1620'></font>
  <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='1621'></font>
<a name='1622'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_22"> (ubdy3dtemp1, grid%u_bxs, grid%u_bxe, &amp;<a name='1623'>
                                  grid%u_bys, grid%u_bye, &amp;<a name='1624'>
                                  'N', spec_bdy_width  , &amp;<a name='1625'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1626'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1627'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1628'>
<a name='1629'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_23"> (vbdy3dtemp1, grid%v_bxs, grid%v_bxe, &amp;<a name='1630'>
                                  grid%v_bys, grid%v_bye, &amp;<a name='1631'>
                                  'N', spec_bdy_width  , &amp;<a name='1632'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1633'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1634'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1635'>
<a name='1636'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_24"> (tbdy3dtemp1, grid%t_bxs, grid%t_bxe, &amp;<a name='1637'>
                                  grid%t_bys, grid%t_bye, &amp;<a name='1638'>
                                  'N', spec_bdy_width  , &amp;<a name='1639'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1640'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1641'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1642'>
<a name='1643'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_25"> (cwmbdy3dtemp1, grid%cwm_bxs, grid%cwm_bxe, &amp;<a name='1644'>
                                  grid%cwm_bys, grid%cwm_bye, &amp;<a name='1645'>
                                  'N', spec_bdy_width  , &amp;<a name='1646'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1647'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1648'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1649'>
<a name='1650'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_26"> (qbdy3dtemp1, grid%q_bxs, grid%q_bxe, &amp;<a name='1651'>
                                  grid%q_bys, grid%q_bye, &amp;<a name='1652'>
                                  'N', spec_bdy_width  , &amp;<a name='1653'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1654'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1655'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1656'>
<a name='1657'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_27"> (q2bdy3dtemp1, grid%q2_bxs, grid%q2_bxe, &amp;<a name='1658'>
                                  grid%q2_bys, grid%q2_bye, &amp;<a name='1659'>
                                  'N', spec_bdy_width  , &amp;<a name='1660'>
                                  ids , ide+1 , jds , jde+1 , kds , kde+1 , &amp;<a name='1661'>
                                  ims , ime , jms , jme , kms , kme , &amp;<a name='1662'>
                                  ips , ipe , jps , jpe , kps , kpe+1 )<a name='1663'>
<a name='1664'>
 CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK'>stuff_bdy_ijk</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_IJK_28"> (pdbdy2dtemp1,grid%pd_bxs, grid%pd_bxe, &amp;<a name='1665'>
                                  grid%pd_bys, grid%pd_bye, &amp;<a name='1666'>
                                  'M', spec_bdy_width  , &amp;<a name='1667'>
                                  ids , ide+1 , jds , jde+1 , 1 , 1 , &amp;<a name='1668'>
                                  ims , ime , jms , jme , 1 , 1 , &amp;<a name='1669'>
                                  ips , ipe , jps , jpe , 1 , 1 )<a name='1670'>
<a name='1671'>
      ELSE IF ( loop .EQ. time_loop_max ) THEN<a name='1672'>
<a name='1673'>
    <font color=#447700>!  If this is the last time through here, we need to close the files.<a name='1674'></font>
<a name='1675'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_21"> ( id , config_flags , "DATASET=BOUNDARY" )<a name='1676'>
<a name='1677'>
      END IF<a name='1678'>
<a name='1679'>
   END IF main_loop_test<a name='1680'>
<a name='1681'>
#if ( HWRF == 1 )<a name='1682'>
  if(alloc_ph_arrays) then<a name='1683'>
     call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_392">(1,'DEALLOCATE PREP_HYBRID BOUNARY ARRAYS')<a name='1684'>
     deallocate(TB,QB,CWMB,UB,VB,PDB)<a name='1685'>
  endif<a name='1686'>
#endif<a name='1687'>
<a name='1688'>
END SUBROUTINE assemble_output<a name='1689'>
</pre></body></html>