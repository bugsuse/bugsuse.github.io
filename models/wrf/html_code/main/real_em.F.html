<HTML> <BODY BGCOLOR=#eeeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!  Create an initial data set for the WRF model based on real data.  This<a name='2'></font>
<font color=#447700>!  program is specifically set up for the Eulerian, mass-based coordinate.<a name='3'></font>
<A NAME='REAL_DATA'><A href='../../html_code/main/real_em.F.html#REAL_DATA' TARGET='top_target'><IMG SRC="../../gif/bar_yellow.gif" border=0></A><a name='4'>
<font color=#993300>PROGRAM </font><font color=#cc0000>real_data</font>,<A href='../../call_from/REAL_DATA.html' TARGET='index'>88</A><a name='5'>
<a name='6'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_19"><a name='7'>
#ifdef DM_PARALLEL<a name='8'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_139">, ONLY : wrf_dm_initialize<a name='9'>
#endif<a name='10'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_202">, ONLY : domain, alloc_and_configure_domain, &amp;<a name='11'>
        domain_clock_set, head_grid, program_name, domain_clockprint, &amp;<a name='12'>
        set_current_grid_ptr<a name='13'>
   USE module_initialize_real, ONLY : wrfu_initialize, find_my_parent, find_my_parent2<a name='14'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_12"><a name='15'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_51"><a name='16'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_134">, ONLY : grid_config_rec_type, model_config_rec, &amp;<a name='17'>
        initial_config, get_config_as_buffer, set_config_as_buffer<a name='18'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_39"><a name='19'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_105">, ONLY : realonly, THOMPSONAERO<a name='20'>
#ifdef NO_LEAP_CALENDAR<a name='21'>
   USE module_symbols_util, ONLY: wrfu_cal_noleap<a name='22'>
#else<a name='23'>
   USE module_symbols_util, ONLY: wrfu_cal_gregorian<a name='24'>
#endif<a name='25'>
   USE <A href='../../html_code/share/module_check_a_mundo.F.html#MODULE_CHECK_A_MUNDO'>module_check_a_mundo</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CHECK_A_MUNDO_4"><a name='26'>
#if ( WRF_CHEM == 1 )<a name='27'>
   USE module_input_chem_data<a name='28'>
   USE module_input_chem_bioemiss<a name='29'>
<font color=#447700>!  USE module_input_chem_emissopt3<a name='30'></font>
#endif<a name='31'>
   USE module_utility, ONLY : WRFU_finalize<a name='32'>
<a name='33'>
   IMPLICIT NONE<a name='34'>
<a name='35'>
#if ( WRF_CHEM == 1 )<a name='36'>
  <font color=#447700>! interface<a name='37'></font>
   INTERFACE<a name='38'>
     <font color=#447700>! mediation-supplied <a name='39'></font>
     SUBROUTINE med_read_wrf_chem_bioemiss ( grid , config_flags)<a name='40'>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_203"><a name='41'>
       TYPE (domain) grid<a name='42'>
       TYPE (grid_config_rec_type) config_flags<a name='43'>
     END SUBROUTINE med_read_wrf_chem_bioemiss<a name='44'>
   END INTERFACE<a name='45'>
#endif<a name='46'>
<a name='47'>
   REAL    :: time , bdyfrq<a name='48'>
<a name='49'>
   INTEGER :: loop , levels_to_process , debug_level<a name='50'>
<a name='51'>
<a name='52'>
   TYPE(domain) , POINTER :: null_domain<a name='53'>
   TYPE(domain) , POINTER :: grid , another_grid<a name='54'>
   TYPE(domain) , POINTER :: grid_ptr , grid_ptr2<a name='55'>
   TYPE (grid_config_rec_type)              :: config_flags<a name='56'>
   INTEGER                :: number_at_same_level<a name='57'>
<a name='58'>
   INTEGER :: max_dom, domain_id , grid_id , parent_id , parent_id1 , id<a name='59'>
   INTEGER :: e_we , e_sn , i_parent_start , j_parent_start<a name='60'>
   INTEGER :: idum1, idum2 <a name='61'>
#ifdef DM_PARALLEL<a name='62'>
   INTEGER                 :: nbytes<a name='63'>
   INTEGER, PARAMETER      :: configbuflen = 4* CONFIG_BUF_LEN<a name='64'>
   INTEGER                 :: configbuf( configbuflen )<a name='65'>
   LOGICAL , EXTERNAL      :: wrf_dm_on_monitor<a name='66'>
#endif<a name='67'>
   LOGICAL found_the_id<a name='68'>
<a name='69'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='70'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='71'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='72'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='73'>
   INTEGER :: i , j , k , idts, rc<a name='74'>
   INTEGER :: sibling_count , parent_id_hold , dom_loop<a name='75'>
<a name='76'>
   CHARACTER (LEN=80)     :: message<a name='77'>
<a name='78'>
   INTEGER :: start_year , start_month , start_day , start_hour , start_minute , start_second<a name='79'>
   INTEGER ::   end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second<a name='80'>
   INTEGER :: interval_seconds , real_data_init_type<a name='81'>
   INTEGER :: time_loop_max , time_loop<a name='82'>
real::t1,t2<a name='83'>
   INTERFACE<a name='84'>
     SUBROUTINE Setup_Timekeeping( grid )<a name='85'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_204">, ONLY : domain<a name='86'>
      TYPE(domain), POINTER :: grid<a name='87'>
     END SUBROUTINE Setup_Timekeeping<a name='88'>
   END INTERFACE<a name='89'>
<a name='90'>
   LOGICAL :: ok_so_far<a name='91'>
<a name='92'>
#include "<A href='../../html_code/include/version_decl.html'>version_decl</A>"<A NAME="version_decl_1"><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='93'>
<a name='94'>
   <font color=#447700>!  Define the name of this program (program_name defined in module_domain)<a name='95'></font>
<a name='96'>
   <font color=#447700>! NOTE: share/input_wrf.F tests first 7 chars of this name to decide <a name='97'></font>
   <font color=#447700>! whether to read P_TOP as metadata from the SI (yes, if .eq. REAL_EM)<a name='98'></font>
<a name='99'>
   program_name = "REAL_EM " // TRIM(release_version) // " PREPROCESSOR"<a name='100'>
<a name='101'>
#ifdef DM_PARALLEL<a name='102'>
   CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#DISABLE_QUILTING'>disable_quilting</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DISABLE_QUILTING_5"><a name='103'>
#endif<a name='104'>
<a name='105'>
   <font color=#447700>!  Initialize the modules used by the WRF system.  Many of the CALLs made from the<a name='106'></font>
   <font color=#447700>!  init_modules routine are NO-OPs.  Typical initializations are: the size of a<a name='107'></font>
   <font color=#447700>!  REAL, setting the file handles to a pre-use value, defining moisture and<a name='108'></font>
   <font color=#447700>!  chemistry indices, etc.<a name='109'></font>
<a name='110'>
   CALL       wrf_debug ( 100 , 'real_em: calling init_modules ' )<a name='111'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_13">(1)   <font color=#447700>! Phase 1 returns after MPI_INIT() (if it is called)<a name='112'></font>
#ifdef NO_LEAP_CALENDAR<a name='113'>
   CALL WRFU_Initialize( defaultCalKind=WRFU_CAL_NOLEAP, rc=rc )<a name='114'>
#else<a name='115'>
   CALL WRFU_Initialize( defaultCalKind=WRFU_CAL_GREGORIAN, rc=rc )<a name='116'>
#endif<a name='117'>
   CALL <A href='../../html_code/share/init_modules.F.html#INIT_MODULES'>init_modules</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULES_14">(2)   <font color=#447700>! Phase 2 resumes after MPI_INIT() (if it is called)<a name='118'></font>
<a name='119'>
   <font color=#447700>!  The configuration switches mostly come from the NAMELIST input.<a name='120'></font>
<a name='121'>
#ifdef DM_PARALLEL<a name='122'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='123'>
      CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_13"><a name='124'>
   END IF<a name='125'>
   CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_13">( configbuf, configbuflen, nbytes )<a name='126'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_116">( configbuf, nbytes )<a name='127'>
   CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_13">( configbuf, configbuflen )<a name='128'>
   CALL <A href='../../html_code/frame/module_dm.F.html#WRF_DM_INITIALIZE'>wrf_dm_initialize</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_INITIALIZE_7"><a name='129'>
#else<a name='130'>
   CALL <A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG'>initial_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INITIAL_CONFIG_14"><a name='131'>
#endif<a name='132'>
<a name='133'>
   <font color=#447700>!  There are variables in the Registry that are only required for the real<a name='134'></font>
   <font color=#447700>!  program, fields that come from the WPS package.  We define the run-time<a name='135'></font>
   <font color=#447700>!  flag that says to allocate space for these input-from-WPS-only arrays.<a name='136'></font>
<a name='137'>
   CALL nl_set_use_wps_input ( 1 , REALONLY )<a name='138'>
<a name='139'>
   CALL <A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY'>check_nml_consistency</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHECK_NML_CONSISTENCY_4"><a name='140'>
   CALL <A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE'>setup_physics_suite</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_PHYSICS_SUITE_3"><a name='141'>
   CALL <A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS'>set_physics_rconfigs</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_PHYSICS_RCONFIGS_4"><a name='142'>
<a name='143'>
   CALL nl_get_debug_level ( 1, debug_level )<a name='144'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_9"> ( debug_level )<a name='145'>
<a name='146'>
   CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_470"> ( program_name )<a name='147'>
<a name='148'>
   <font color=#447700>!  Allocate the space for the mother of all domains.<a name='149'></font>
<a name='150'>
   NULLIFY( null_domain )<a name='151'>
   CALL       wrf_debug ( 100 , 'real_em: calling alloc_and_configure_domain ' )<a name='152'>
   CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN'>alloc_and_configure_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_AND_CONFIGURE_DOMAIN_11"> ( domain_id  = 1           , &amp;<a name='153'>
                                     grid       = head_grid   , &amp;<a name='154'>
                                     parent     = null_domain , &amp;<a name='155'>
                                     kid        = -1            )<a name='156'>
<a name='157'>
   grid =&gt; head_grid<a name='158'>
   CALL nl_get_max_dom ( 1 , max_dom )<a name='159'>
<a name='160'>
   IF ( model_config_rec%interval_seconds .LE. 0 ) THEN<a name='161'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_416">( 'namelist value for interval_seconds must be &gt; 0')<a name='162'>
   END IF<a name='163'>
<a name='164'>
   all_domains : DO domain_id = 1 , max_dom<a name='165'>
<a name='166'>
      IF ( ( model_config_rec%input_from_file(domain_id) ) .OR. &amp;<a name='167'>
           ( domain_id .EQ. 1 ) ) THEN<a name='168'>
<a name='169'>
         IF ( domain_id .GT. 1 ) THEN<a name='170'>
<a name='171'>
            CALL nl_get_grid_id        ( domain_id, grid_id        )<a name='172'>
            CALL nl_get_parent_id      ( domain_id, parent_id      )<a name='173'>
            CALL nl_get_e_we           ( domain_id, e_we           )<a name='174'>
            CALL nl_get_e_sn           ( domain_id, e_sn           )<a name='175'>
            CALL nl_get_i_parent_start ( domain_id, i_parent_start )<a name='176'>
            CALL nl_get_j_parent_start ( domain_id, j_parent_start )<a name='177'>
            WRITE (message,FMT='(A,2I3,2I4,2I3)') &amp;<a name='178'>
            'new allocated  domain: id, par id, dims i/j, start i/j =', &amp;<a name='179'>
            grid_id, parent_id, e_we, e_sn, i_parent_start, j_parent_start<a name='180'>
<a name='181'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_352"> ( 100 , message )<a name='182'>
            CALL nl_get_grid_id        ( parent_id, grid_id        )<a name='183'>
            CALL nl_get_parent_id      ( parent_id, parent_id1     )<a name='184'>
            CALL nl_get_e_we           ( parent_id, e_we           )<a name='185'>
            CALL nl_get_e_sn           ( parent_id, e_sn           )<a name='186'>
            CALL nl_get_i_parent_start ( parent_id, i_parent_start )<a name='187'>
            CALL nl_get_j_parent_start ( parent_id, j_parent_start )<a name='188'>
            WRITE (message,FMT='(A,2I3,2I4,2I3)') &amp;<a name='189'>
            'parent domain: id, par id, dims i/j, start i/j =', &amp;<a name='190'>
            grid_id, parent_id1, e_we, e_sn, i_parent_start, j_parent_start<a name='191'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_353"> ( 100 , message )<a name='192'>
<a name='193'>
            CALL nl_get_grid_id        ( domain_id, grid_id        )<a name='194'>
            CALL nl_get_parent_id      ( domain_id, parent_id      )<a name='195'>
            CALL nl_get_e_we           ( domain_id, e_we           )<a name='196'>
            CALL nl_get_e_sn           ( domain_id, e_sn           )<a name='197'>
            CALL nl_get_i_parent_start ( domain_id, i_parent_start )<a name='198'>
            CALL nl_get_j_parent_start ( domain_id, j_parent_start )<a name='199'>
            grid_ptr2 =&gt; head_grid<a name='200'>
            found_the_id = .FALSE.<a name='201'>
<font color=#447700>!           CALL find_my_parent ( grid_ptr2 , grid_ptr , domain_id , parent_id , found_the_id )<a name='202'></font>
            CALL find_my_parent2( grid_ptr2 , grid_ptr ,             parent_id , found_the_id )<a name='203'>
            IF ( found_the_id ) THEN<a name='204'>
<a name='205'>
               sibling_count = 0<a name='206'>
               DO dom_loop = 2 , domain_id<a name='207'>
                 CALL nl_get_parent_id ( dom_loop, parent_id_hold )<a name='208'>
                 IF ( parent_id_hold .EQ. parent_id ) THEN<a name='209'>
                    sibling_count = sibling_count + 1<a name='210'>
                 END IF<a name='211'>
               END DO<a name='212'>
               CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN'>alloc_and_configure_domain</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_AND_CONFIGURE_DOMAIN_12"> ( domain_id  = domain_id    , &amp;<a name='213'>
                                                 grid       = another_grid , &amp;<a name='214'>
                                                 parent     = grid_ptr     , &amp;<a name='215'>
                                                 kid        = sibling_count )<a name='216'>
               grid =&gt; another_grid<a name='217'>
            ELSE<a name='218'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_417">( 'real_em.F: Could not find the parent domain')<a name='219'>
            END IF<a name='220'>
         END IF<a name='221'>
<a name='222'>
         CALL <A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING'>Setup_Timekeeping</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SETUP_TIMEKEEPING_10"> ( grid )<a name='223'>
         CALL <A href='../../html_code/frame/module_domain.F.html#SET_CURRENT_GRID_PTR'>set_current_grid_ptr</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CURRENT_GRID_PTR_8">( grid )<a name='224'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_7"> ( 150, grid, &amp;<a name='225'>
                'DEBUG real:  clock after Setup_Timekeeping,' )<a name='226'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_19">( grid, &amp;<a name='227'>
                                time_step_seconds=model_config_rec%interval_seconds )<a name='228'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_8"> ( 150, grid, &amp;<a name='229'>
                'DEBUG real:  clock after timeStep set,' )<a name='230'>
<a name='231'>
<a name='232'>
         CALL       wrf_debug ( 100 , 'real_em: calling set_scalar_indices_from_config ' )<a name='233'>
         CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_16"> ( grid%id , idum1, idum2 )<a name='234'>
<a name='235'>
         CALL       wrf_debug ( 100 , 'real_em: calling model_to_grid_config_rec ' )<a name='236'>
         CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_39"> ( grid%id , model_config_rec , config_flags )<a name='237'>
<a name='238'>
         <font color=#447700>!  Some simple checks.<a name='239'></font>
         <a name='240'>
         ok_so_far = .TRUE.<a name='241'>
<a name='242'>
         <font color=#447700>!DJW changed the check below so that instead of always comparing<a name='243'></font>
         <font color=#447700>!to d01 we now compare vertical levels between a grid and its parent.<a name='244'></font>
         <font color=#447700>!If 4 domains were used, this allows for vertical nesting to be enabled between grids 1 &amp; 2 and<a name='245'></font>
         <font color=#447700>!between grids 3 &amp; 4, but allows you to not use vertical grid nesting between grids 2 &amp; 3.<a name='246'></font>
         DO loop = 2 , model_config_rec%max_dom<a name='247'>
           IF (( model_config_rec%vert_refine_method(loop) .EQ. 0 ) .AND. ( model_config_rec%vert_refine_fact .EQ. 1 )) THEN<a name='248'>
             IF ( model_config_rec%e_vert(loop) .NE.  model_config_rec%e_vert(model_config_rec%parent_id(loop)) ) THEN<a name='249'>
               CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_471"> ( 'e_vert must be the same for each domain' )<a name='250'>
               ok_so_far = .FALSE.<a name='251'>
              END IF<a name='252'>
            END IF<a name='253'>
         END DO<a name='254'>
         IF ( .NOT. ok_so_far ) THEN<a name='255'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_418">( 'fix namelist.input settings' )<a name='256'>
         END IF<a name='257'>
<a name='258'>
         <font color=#447700>!  Initialize the WRF IO: open files, init file handles, etc.<a name='259'></font>
<a name='260'>
         CALL       wrf_debug ( 100 , 'real_em: calling init_wrfio' )<a name='261'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO'>init_wrfio</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_WRFIO_7"><a name='262'>
<a name='263'>
         <font color=#447700>!  Some of the configuration values may have been modified from the initial READ<a name='264'></font>
         <font color=#447700>!  of the NAMELIST, so we re-broadcast the configuration records.<a name='265'></font>
<a name='266'>
#ifdef DM_PARALLEL<a name='267'>
         CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_354"> ( 100 , 'real_em: re-broadcast the configuration records' )<a name='268'>
         CALL <A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER'>get_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_CONFIG_AS_BUFFER_14">( configbuf, configbuflen, nbytes )<a name='269'>
         CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_117">( configbuf, nbytes )<a name='270'>
         CALL <A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER'>set_config_as_buffer</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CONFIG_AS_BUFFER_14">( configbuf, configbuflen )<a name='271'>
#endif<a name='272'>
<a name='273'>
         <font color=#447700>!   No looping in this layer.  <a name='274'></font>
<a name='275'>
         CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_355"> ( 100 , 'calling med_sidata_input' )<a name='276'>
         CALL <A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT'>med_sidata_input</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SIDATA_INPUT_2"> ( grid , config_flags )<a name='277'>
         CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_356"> ( 100 , 'backfrom med_sidata_input' )<a name='278'>
<a name='279'>
      ELSE <a name='280'>
         CYCLE all_domains<a name='281'>
      END IF<a name='282'>
<a name='283'>
   END DO all_domains<a name='284'>
<a name='285'>
   CALL <A href='../../html_code/frame/module_domain.F.html#SET_CURRENT_GRID_PTR'>set_current_grid_ptr</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_CURRENT_GRID_PTR_9">( head_grid )<a name='286'>
<a name='287'>
   <font color=#447700>!  We are done.<a name='288'></font>
<a name='289'>
   CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_357"> (   0 , 'real_em: SUCCESS COMPLETE REAL_EM INIT' )<a name='290'>
<a name='291'>
   CALL <A href='../../html_code/frame/wrf_shutdown.F.html#WRF_SHUTDOWN'>wrf_shutdown</A><A href='../../html_code/main/real_nmm.F.html#REAL_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SHUTDOWN_5"><a name='292'>
<a name='293'>
   CALL WRFU_Finalize( rc=rc )<a name='294'>
<a name='295'>
END PROGRAM real_data<a name='296'>
<a name='297'>
<A NAME='MED_SIDATA_INPUT'><A href='../../html_code/main/real_em.F.html#MED_SIDATA_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='298'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_sidata_input</font> ( grid , config_flags ) <A href='../../call_to/MED_SIDATA_INPUT.html' TARGET='index'>3</A>,<A href='../../call_from/MED_SIDATA_INPUT.html' TARGET='index'>170</A><a name='299'>
  <font color=#447700>! Driver layer<a name='300'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_205"><a name='301'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_13"><a name='302'>
  <font color=#447700>! Model layer<a name='303'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_135"><a name='304'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_2"><a name='305'>
   USE module_initialize_real<a name='306'>
   USE <A href='../../html_code/share/module_optional_input.F.html#MODULE_OPTIONAL_INPUT'>module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_OPTIONAL_INPUT_6"><a name='307'>
#if ( WRF_CHEM == 1 )<a name='308'>
   USE module_input_chem_data<a name='309'>
   USE module_input_chem_bioemiss<a name='310'>
<font color=#447700>!  USE module_input_chem_emissopt3<a name='311'></font>
#endif<a name='312'>
<a name='313'>
   USE <A href='../../html_code/dyn_em/module_wps_io_arw.F.html#MODULE_WPS_IO_ARW'>module_wps_io_arw</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WPS_IO_ARW_1"><a name='314'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_5"><a name='315'>
   USE module_utility<a name='316'>
<a name='317'>
   IMPLICIT NONE<a name='318'>
<a name='319'>
<a name='320'>
  <font color=#447700>! Interface <a name='321'></font>
   INTERFACE<a name='322'>
     SUBROUTINE start_domain ( grid , allowed_to_read )  <font color=#447700>! comes from module_start in appropriate dyn_ directory<a name='323'></font>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_206"><a name='324'>
       TYPE (domain) grid<a name='325'>
       LOGICAL, INTENT(IN) :: allowed_to_read<a name='326'>
     END SUBROUTINE start_domain<a name='327'>
   END INTERFACE<a name='328'>
<a name='329'>
  <font color=#447700>! Arguments<a name='330'></font>
   TYPE(domain)                :: grid<a name='331'>
   TYPE (grid_config_rec_type) :: config_flags<a name='332'>
  <font color=#447700>! Local<a name='333'></font>
   INTEGER                :: time_step_begin_restart<a name='334'>
   INTEGER                :: idsi , ierr , myproc<a name='335'>
   CHARACTER (LEN=256)     :: si_inpname<a name='336'>
   CHARACTER (LEN=80)      :: message<a name='337'>
<a name='338'>
   CHARACTER(LEN=19) :: start_date_char , end_date_char , current_date_char , next_date_char<a name='339'>
<a name='340'>
   INTEGER :: time_loop_max , loop, rc<a name='341'>
   INTEGER :: julyr , julday <a name='342'>
   INTEGER :: io_form_auxinput1<a name='343'>
   INTEGER, EXTERNAL :: use_package<a name='344'>
   LOGICAL :: using_binary_wrfsi<a name='345'>
   REAL :: gmt<a name='346'>
real::t1,t2,t3,t4<a name='347'>
<a name='348'>
   grid%input_from_file = .true.<a name='349'>
   grid%input_from_file = .false.<a name='350'>
<a name='351'>
   CALL <A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END'>compute_si_start_and_end</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COMPUTE_SI_START_AND_END_2"> ( model_config_rec%start_year  (grid%id) , &amp;<a name='352'>
                                   model_config_rec%start_month (grid%id) , &amp;<a name='353'>
                                   model_config_rec%start_day   (grid%id) , &amp;<a name='354'>
                                   model_config_rec%start_hour  (grid%id) , &amp;<a name='355'>
                                   model_config_rec%start_minute(grid%id) , &amp;<a name='356'>
                                   model_config_rec%start_second(grid%id) , &amp;<a name='357'>
                                   model_config_rec%  end_year  (grid%id) , &amp; <a name='358'>
                                   model_config_rec%  end_month (grid%id) , &amp;<a name='359'>
                                   model_config_rec%  end_day   (grid%id) , &amp;<a name='360'>
                                   model_config_rec%  end_hour  (grid%id) , &amp;<a name='361'>
                                   model_config_rec%  end_minute(grid%id) , &amp;<a name='362'>
                                   model_config_rec%  end_second(grid%id) , &amp;<a name='363'>
                                   model_config_rec%interval_seconds      , &amp;<a name='364'>
                                   model_config_rec%real_data_init_type   , &amp;<a name='365'>
                                   start_date_char , end_date_char , time_loop_max )<a name='366'>
<a name='367'>
   <font color=#447700>!  Override stop time with value computed above.  <a name='368'></font>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_20">( grid, stop_timestr=end_date_char )<a name='369'>
<a name='370'>
   <font color=#447700>! TBH:  for now, turn off stop time and let it run data-driven<a name='371'></font>
   CALL WRFU_ClockStopTimeDisable( grid%domain_clock, rc=rc ) <a name='372'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_8">( WRFU_SUCCESS, rc, &amp;<a name='373'>
                         'WRFU_ClockStopTimeDisable(grid%domain_clock) FAILED', &amp;<a name='374'>
                         __FILE__ , &amp;<a name='375'>
                         __LINE__  )<a name='376'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_9"> ( 150, grid, &amp;<a name='377'>
          'DEBUG med_sidata_input:  clock after stopTime set,' )<a name='378'>
<a name='379'>
   <font color=#447700>!  Here we define the initial time to process, for later use by the code.<a name='380'></font>
   <a name='381'>
   current_date_char = start_date_char<a name='382'>
   start_date = start_date_char // '.0000'<a name='383'>
   current_date = start_date<a name='384'>
<a name='385'>
   CALL nl_set_bdyfrq ( grid%id , REAL(model_config_rec%interval_seconds) )<a name='386'>
<a name='387'>
   <font color=#447700>!!!!!!!  Loop over each time period to process.<a name='388'></font>
<a name='389'>
   CALL cpu_time ( t1 )<a name='390'>
   DO loop = 1 , time_loop_max<a name='391'>
<a name='392'>
      internal_time_loop = loop<a name='393'>
      IF ( ( grid%id .GT. 1 ) .AND. ( loop .GT. 1 ) .AND. &amp;<a name='394'>
           ( model_config_rec%grid_fdda(grid%id) .EQ. 0 ) .AND. &amp;<a name='395'>
           ( model_config_rec%sst_update .EQ. 0 ) ) EXIT<a name='396'>
<a name='397'>
      print *,' '<a name='398'>
      print *,'-----------------------------------------------------------------------------'<a name='399'>
      print *,' '<a name='400'>
      print '(A,I2,A,A,A,I4,A,I4)' , &amp;<a name='401'>
      ' Domain ',grid%id,': Current date being processed: ',current_date, ', which is loop #',loop,' out of ',time_loop_max<a name='402'>
<a name='403'>
      <font color=#447700>!  After current_date has been set, fill in the julgmt stuff.<a name='404'></font>
<a name='405'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_JULGMT'>geth_julgmt</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_JULGMT_5"> ( config_flags%julyr , config_flags%julday , config_flags%gmt )<a name='406'>
<a name='407'>
        print *,'configflags%julyr, %julday, %gmt:',config_flags%julyr, config_flags%julday, config_flags%gmt<a name='408'>
      <font color=#447700>!  Now that the specific Julian info is available, save these in the model config record.<a name='409'></font>
<a name='410'>
      CALL nl_set_gmt (grid%id, config_flags%gmt)<a name='411'>
      CALL nl_set_julyr (grid%id, config_flags%julyr)<a name='412'>
      CALL nl_set_julday (grid%id, config_flags%julday)<a name='413'>
<a name='414'>
      <font color=#447700>!  Open the input file for real.  This is either the "new" one or the "old" one.  The "new" one could have<a name='415'></font>
      <font color=#447700>!  a suffix for the type of the data format.  Check to see if either is around.<a name='416'></font>
<a name='417'>
      CALL cpu_time ( t3 )<a name='418'>
      WRITE ( wrf_err_message , FMT='(A,A)' )'med_sidata_input: calling open_r_dataset for ', &amp;<a name='419'>
                                             TRIM(config_flags%auxinput1_inname)<a name='420'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_358"> ( 100 , wrf_err_message )<a name='421'>
<a name='422'>
      IF (config_flags%auxinput1_inname(1:10) .eq. 'real_input') THEN<a name='423'>
         using_binary_wrfsi=.true.<a name='424'>
      ENDIF<a name='425'>
<a name='426'>
      CALL nl_get_io_form_auxinput1( 1, io_form_auxinput1 )<a name='427'>
<a name='428'>
      SELECT CASE ( use_package(io_form_auxinput1) )<a name='429'>
#if defined(NETCDF) || defined(PNETCDF) || defined(PIO)<a name='430'>
      CASE ( IO_NETCDF , IO_PNETCDF , IO_PIO )<a name='431'>
<a name='432'>
<a name='433'>
      IF ( config_flags%auxinput1_inname(1:8) .NE. 'wrf_real' ) THEN<a name='434'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A'>construct_filename4a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME4A_3">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , &amp;<a name='435'>
                                    current_date_char , config_flags%io_form_auxinput1 )<a name='436'>
      ELSE<a name='437'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_7">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , &amp;<a name='438'>
                                    current_date_char )<a name='439'>
      END IF<a name='440'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_8"> ( idsi, TRIM(si_inpname) , grid , config_flags , "DATASET=AUXINPUT1", ierr )<a name='441'>
      IF ( ierr .NE. 0 ) THEN<a name='442'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_419">( 'error opening ' // TRIM(si_inpname) // &amp;<a name='443'>
                               ' for input; bad date in namelist or file not in directory' )<a name='444'>
      END IF<a name='445'>
<a name='446'>
      <font color=#447700>!  Input data.<a name='447'></font>
<a name='448'>
      CALL wrf_debug ( 100 , 'med_sidata_input: calling input_auxinput1' )<a name='449'>
      CALL input_auxinput1 ( idsi ,   grid , config_flags , ierr )<a name='450'>
      CALL cpu_time ( t4 )<a name='451'>
      WRITE ( wrf_err_message , FMT='(A,I10,A)' ) 'Timing for input ',NINT(t4-t3) ,' s.'<a name='452'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_359">( 0, wrf_err_message )<a name='453'>
<a name='454'>
      <font color=#447700>!  Possible optional SI input.  This sets flags used by init_domain.<a name='455'></font>
<a name='456'>
      CALL cpu_time ( t3 )<a name='457'>
      IF ( loop .EQ. 1 ) THEN<a name='458'>
         already_been_here = .FALSE.<a name='459'>
         CALL       wrf_debug ( 100 , 'med_sidata_input: calling init_module_optional_input' )<a name='460'>
         CALL <A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT'>init_module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_INPUT_3"> ( grid , config_flags )<a name='461'>
      END IF<a name='462'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling optional_input' )<a name='463'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT'>optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_INPUT_2"> ( grid , idsi , config_flags )<a name='464'>
<a name='465'>
      <font color=#447700>!  Close this file that is output from the SI and input to this pre-proc.<a name='466'></font>
      CALL       <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_360"> ( 100 , 'med_sidata_input: back from init_domain' )<a name='467'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_13"> ( idsi , config_flags , "DATASET=AUXINPUT1" )<a name='468'>
#endif<a name='469'>
#ifdef INTIO<a name='470'>
      CASE ( IO_INTIO )<a name='471'>
<a name='472'>
<font color=#447700>!      !  Possible optional SI input.  This sets flags used by init_domain.<a name='473'></font>
<font color=#447700>!<a name='474'></font>
      IF ( loop .EQ. 1 ) THEN<a name='475'>
         CALL  wrf_debug (100, 'med_sidata_input: call init_module_optional_input' )<a name='476'>
         CALL <A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT'>init_module_optional_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_OPTIONAL_INPUT_4"> ( grid , config_flags )<a name='477'>
      END IF<a name='478'>
<a name='479'>
      IF (using_binary_wrfsi) THEN<a name='480'>
<a name='481'>
        current_date_char(11:11)='_'<a name='482'>
<font color=#447700>!        CALL read_si ( grid, current_date_char )<a name='483'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_420">("not supporting binary WRFSI in this code")<a name='484'>
        current_date_char(11:11)='T'<a name='485'>
<a name='486'>
      ELSE<a name='487'>
<a name='488'>
        write(message,*) 'binary WPS branch'<a name='489'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_472">(message)<a name='490'>
        current_date_char(11:11)='_'<a name='491'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A'>construct_filename4a</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME4A_4">( si_inpname , config_flags%auxinput1_inname , grid%id , 2 , current_date_char , &amp;<a name='492'>
                                     config_flags%io_form_auxinput1 )<a name='493'>
<a name='494'>
        CALL <A href='../../html_code/dyn_nmm/module_si_io_nmm.F.html#READ_WPS'>read_wps</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="READ_WPS_2"> ( grid, trim(si_inpname), current_date_char, config_flags%num_metgrid_levels )<a name='495'>
      ENDIF<a name='496'>
#endif<a name='497'>
      CASE DEFAULT<a name='498'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_421">('real: not valid io_form_auxinput1')<a name='499'>
      END SELECT<a name='500'>
<a name='501'>
      CALL       wrf_debug ( 100 , 'med_sidata_input: calling init_domain' )<a name='502'>
      grid%input_from_file = .true.<a name='503'>
      CALL <A href='../../html_code/dyn_em/module_initialize_b_wave.F.html#INIT_DOMAIN'>init_domain</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_DOMAIN_3"> ( grid )<a name='504'>
      CALL cpu_time ( t4 )<a name='505'>
      WRITE ( wrf_err_message , FMT='(A,I10,A)' ) 'Timing for processing ',NINT(t4-t3) ,' s.'<a name='506'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_361">( 0, wrf_err_message )<a name='507'>
      CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_40"> ( grid%id , model_config_rec , config_flags )<a name='508'>
<a name='509'>
#if ( WRF_CHEM == 1 )<a name='510'>
      IF ( loop == 1 ) THEN<a name='511'>
         IF( grid%chem_opt &gt; 0 ) then<a name='512'>
           <font color=#447700>! Read the chemistry data from a previous wrf forecast (wrfout file)<a name='513'></font>
           IF(grid%chem_in_opt == 1 ) THEN<a name='514'>
              message = 'INITIALIZING CHEMISTRY WITH OLD SIMULATION'<a name='515'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_473"> ( message )<a name='516'>
<a name='517'>
              CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_INPUT'>med_read_wrf_chem_input</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_INPUT_2"> ( grid , config_flags)<a name='518'>
<a name='519'>
              IF(grid%emiss_opt == ECPTEC .or. grid%emiss_opt == GOCART_ECPTEC   &amp;<a name='520'>
                                         .or. grid%biomass_burn_opt == BIOMASSB) THEN<a name='521'>
                 message = 'READING EMISSIONS DATA OPT 3'<a name='522'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_474"> ( message )<a name='523'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISSOPT3'>med_read_wrf_chem_emissopt3</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_EMISSOPT3_4"> ( grid , config_flags)<a name='524'>
              END IF<a name='525'>
<a name='526'>
              IF(grid%bio_emiss_opt == 2 ) THEN<a name='527'>
                 message = 'READING BEIS3.14 EMISSIONS DATA'<a name='528'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_475"> ( message )<a name='529'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_12"> ( grid , config_flags)<a name='530'>
              else IF(grid%bio_emiss_opt == 3 ) THEN <font color=#447700>!shc<a name='531'></font>
                 message = 'READING MEGAN 2 EMISSIONS DATA'<a name='532'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_476"> ( message )<a name='533'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_13"> ( grid , config_flags)<a name='534'>
              END IF<a name='535'>
<a name='536'>
              IF(grid%dust_opt == 1 .or. grid%dmsemis_opt == 1 .or. grid%chem_opt == 300) THEN <font color=#447700>!shc<a name='537'></font>
                 message = 'READING GOCART BG AND/OR DUST and DMS REF FIELDS'<a name='538'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_477"> ( message )<a name='539'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_GOCART_BG'>med_read_wrf_chem_gocart_bg</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_GOCART_BG_4"> ( grid , config_flags)<a name='540'>
              END IF<a name='541'>
<a name='542'>
           ELSEIF(grid%chem_in_opt == 0)then<a name='543'>
              <font color=#447700>! Generate chemistry data from a idealized vertical profile<a name='544'></font>
              message = 'STARTING WITH BACKGROUND CHEMISTRY '<a name='545'>
              CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_478"> ( message )<a name='546'>
<a name='547'>
              CALL input_chem_profile ( grid )<a name='548'>
<a name='549'>
              IF(grid%bio_emiss_opt == 2 ) THEN<a name='550'>
                 message = 'READING BEIS3.14 EMISSIONS DATA'<a name='551'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_479"> ( message )<a name='552'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_14"> ( grid , config_flags)<a name='553'>
              else IF(grid%bio_emiss_opt == 3 ) THEN <font color=#447700>!shc<a name='554'></font>
                 message = 'READING MEGAN 2 EMISSIONS DATA'<a name='555'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_480"> ( message ) <a name='556'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_BIOEMISS'>med_read_wrf_chem_bioemiss</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_BIOEMISS_15"> ( grid , config_flags)<a name='557'>
              END IF<a name='558'>
              IF(grid%emiss_opt == ECPTEC .or. grid%emiss_opt == GOCART_ECPTEC   &amp;<a name='559'>
                                         .or. grid%biomass_burn_opt == BIOMASSB) THEN<a name='560'>
                 message = 'READING EMISSIONS DATA OPT 3'<a name='561'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_481"> ( message )<a name='562'>
<font color=#447700>!                CALL med_read_bin_chem_emissopt3 ( grid , config_flags)<a name='563'></font>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_EMISSOPT3'>med_read_wrf_chem_emissopt3</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_EMISSOPT3_5"> ( grid , config_flags)<a name='564'>
              END IF<a name='565'>
<a name='566'>
              IF(grid%dust_opt == 1 .or. grid%dmsemis_opt == 1 .or. grid%chem_opt == 300) THEN <font color=#447700>!shc<a name='567'></font>
                 message = 'READING GOCART BG AND/OR DUST and DMS REF FIELDS'<a name='568'>
                 CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_482"> ( message )<a name='569'>
                 CALL <A href='../../html_code/share/mediation_integrate.F.html#MED_READ_WRF_CHEM_GOCART_BG'>med_read_wrf_chem_gocart_bg</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_READ_WRF_CHEM_GOCART_BG_5"> ( grid , config_flags)<a name='570'>
              END IF<a name='571'>
<a name='572'>
           ELSE<a name='573'>
             message = 'RUNNING WITHOUT CHEMISTRY INITIALIZATION'<a name='574'>
             CALL  <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_483"> ( message )<a name='575'>
           END IF<a name='576'>
         END IF<a name='577'>
      END IF<a name='578'>
#endif<a name='579'>
<a name='580'>
      CALL cpu_time ( t3 )<a name='581'>
      CALL <A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT'>assemble_output</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ASSEMBLE_OUTPUT_2"> ( grid , config_flags , loop , time_loop_max )<a name='582'>
      CALL cpu_time ( t4 )<a name='583'>
      WRITE ( wrf_err_message , FMT='(A,I10,A)' ) 'Timing for output ',NINT(t4-t3) ,' s.'<a name='584'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_362">( 0, wrf_err_message )<a name='585'>
      CALL cpu_time ( t2 )<a name='586'>
      WRITE ( wrf_err_message , FMT='(A,I4,A,I10,A)' ) 'Timing for loop # ',loop,' = ',NINT(t2-t1) ,' s.'<a name='587'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_363">( 0, wrf_err_message )<a name='588'>
<a name='589'>
      <font color=#447700>!  If this is not the last time, we define the next time that we are going to process.<a name='590'></font>
<a name='591'>
      IF ( loop .NE. time_loop_max ) THEN<a name='592'>
         CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_8"> ( current_date_char , start_date_char , loop * model_config_rec%interval_seconds )<a name='593'>
         current_date =  current_date_char // '.0000'<a name='594'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_10"> ( 150, grid, &amp;<a name='595'>
                'DEBUG med_sidata_input:  clock before current_date set,' )<a name='596'>
         WRITE (wrf_err_message,*) &amp;<a name='597'>
           'DEBUG med_sidata_input:  before currTime set, current_date = ',TRIM(current_date)<a name='598'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_364"> ( 150 , wrf_err_message )<a name='599'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_21">( grid, current_date(1:19) )<a name='600'>
         CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/real_nmm.F.html#MED_SIDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_11"> ( 150, grid, &amp;<a name='601'>
                'DEBUG med_sidata_input:  clock after current_date set,' )<a name='602'>
      END IF<a name='603'>
      CALL cpu_time ( t1 )<a name='604'>
   END DO<a name='605'>
<a name='606'>
END SUBROUTINE med_sidata_input<a name='607'>
<a name='608'>
<A NAME='COMPUTE_SI_START_AND_END'><A href='../../html_code/main/real_em.F.html#COMPUTE_SI_START_AND_END' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='609'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>compute_si_start_and_end</font> (  &amp; <A href='../../call_to/COMPUTE_SI_START_AND_END.html' TARGET='index'>3</A>,<A href='../../call_from/COMPUTE_SI_START_AND_END.html' TARGET='index'>10</A><a name='610'>
   start_year , start_month , start_day , start_hour , start_minute , start_second , &amp;<a name='611'>
     end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second , &amp;<a name='612'>
   interval_seconds , real_data_init_type , &amp;<a name='613'>
   start_date_char , end_date_char , time_loop_max )<a name='614'>
<a name='615'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_6"><a name='616'>
<a name='617'>
   IMPLICIT NONE<a name='618'>
<a name='619'>
   INTEGER :: start_year , start_month , start_day , start_hour , start_minute , start_second<a name='620'>
   INTEGER ::   end_year ,   end_month ,   end_day ,   end_hour ,   end_minute ,   end_second<a name='621'>
   INTEGER :: interval_seconds , real_data_init_type<a name='622'>
   INTEGER :: time_loop_max , time_loop<a name='623'>
<a name='624'>
   CHARACTER(LEN=19) :: current_date_char , start_date_char , end_date_char , next_date_char<a name='625'>
<a name='626'>
#ifdef PLANET<a name='627'>
   WRITE ( start_date_char , FMT = '(I4.4,"-",I5.5,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='628'>
           start_year,start_day,start_hour,start_minute,start_second<a name='629'>
   WRITE (   end_date_char , FMT = '(I4.4,"-",I5.5,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='630'>
             end_year,  end_day,  end_hour,  end_minute,  end_second<a name='631'>
#else<a name='632'>
   WRITE ( start_date_char , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='633'>
           start_year,start_month,start_day,start_hour,start_minute,start_second<a name='634'>
   WRITE (   end_date_char , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='635'>
             end_year,  end_month,  end_day,  end_hour,  end_minute,  end_second<a name='636'>
#endif<a name='637'>
<a name='638'>
   IF ( end_date_char .LT. start_date_char ) THEN<a name='639'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_422">( 'Ending date in namelist ' // end_date_char // ' prior to beginning date ' // start_date_char )<a name='640'>
   END IF<a name='641'>
<a name='642'>
<font color=#447700>!  start_date = start_date_char // '.0000'<a name='643'></font>
<a name='644'>
   <font color=#447700>!  Figure out our loop count for the processing times.<a name='645'></font>
<a name='646'>
   time_loop = 1<a name='647'>
   PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',start_date_char,'.'<a name='648'>
   current_date_char = start_date_char<a name='649'>
   loop_count : DO<a name='650'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_9"> ( next_date_char , current_date_char , interval_seconds )<a name='651'>
      IF      ( next_date_char .LT. end_date_char ) THEN<a name='652'>
         time_loop = time_loop + 1<a name='653'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',next_date_char,'.'<a name='654'>
         current_date_char = next_date_char<a name='655'>
      ELSE IF ( next_date_char .EQ. end_date_char ) THEN<a name='656'>
         time_loop = time_loop + 1<a name='657'>
         PRINT '(A,I4,A,A,A)','Time period #',time_loop,' to process = ',next_date_char,'.'<a name='658'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='659'>
         time_loop_max = time_loop<a name='660'>
         EXIT loop_count<a name='661'>
      ELSE IF ( next_date_char .GT. end_date_char ) THEN<a name='662'>
         PRINT '(A,I4,A)','Total analysis times to input = ',time_loop,'.'<a name='663'>
         time_loop_max = time_loop<a name='664'>
         IF ( ( time_loop_max .EQ. 1 ) .AND. ( start_date_char .NE. end_date_char ) ) THEN<a name='665'>
            PRINT *,'You might have set the end time in the namelist.input for the model'         <a name='666'>
            PRINT *,'Regional domains require more than one time-period to process, for BC generation'<a name='667'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/real_nmm.F.html#COMPUTE_SI_START_AND_END' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_423"> ( "Make the end time at least one 'interval_seconds' beyond the start time" )<a name='668'>
         END IF<a name='669'>
         EXIT loop_count<a name='670'>
      END IF<a name='671'>
   END DO loop_count<a name='672'>
END SUBROUTINE compute_si_start_and_end<a name='673'>
<a name='674'>
<A NAME='ASSEMBLE_OUTPUT'><A href='../../html_code/main/real_em.F.html#ASSEMBLE_OUTPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='675'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>assemble_output</font> ( grid , config_flags , loop , time_loop_max ) <A href='../../call_to/ASSEMBLE_OUTPUT.html' TARGET='index'>4</A>,<A href='../../call_from/ASSEMBLE_OUTPUT.html' TARGET='index'>248</A><a name='676'>
<a name='677'>
   USE <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#MODULE_BIG_STEP_UTILITIES_EM'>module_big_step_utilities_em</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BIG_STEP_UTILITIES_EM_7"><a name='678'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_207"><a name='679'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_14"><a name='680'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_136"><a name='681'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_7"><a name='682'>
   USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_15"><a name='683'>
   IMPLICIT NONE<a name='684'>
<a name='685'>
   TYPE(domain)                 :: grid<a name='686'>
   TYPE (grid_config_rec_type)  :: config_flags<a name='687'>
   INTEGER , INTENT(IN)         :: loop , time_loop_max<a name='688'>
<a name='689'>
   INTEGER :: ids , ide , jds , jde , kds , kde<a name='690'>
   INTEGER :: ims , ime , jms , jme , kms , kme<a name='691'>
   INTEGER :: ips , ipe , jps , jpe , kps , kpe<a name='692'>
   INTEGER :: ijds , ijde , spec_bdy_width<a name='693'>
   INTEGER :: i , j , k , idts<a name='694'>
<a name='695'>
   INTEGER :: id1 , interval_seconds , ierr, rc, sst_update, grid_fdda<a name='696'>
   INTEGER , SAVE :: id, id2,  id4 <a name='697'>
   CHARACTER (LEN=256) :: inpname , bdyname<a name='698'>
   CHARACTER(LEN= 4) :: loop_char<a name='699'>
   CHARACTER (LEN=256) :: message<a name='700'>
character *19 :: temp19<a name='701'>
character *24 :: temp24 , temp24b<a name='702'>
<a name='703'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: ubdy3dtemp1 , vbdy3dtemp1 , tbdy3dtemp1 , pbdy3dtemp1 , qbdy3dtemp1<a name='704'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: mbdy2dtemp1<a name='705'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: ubdy3dtemp2 , vbdy3dtemp2 , tbdy3dtemp2 , pbdy3dtemp2 , qbdy3dtemp2<a name='706'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: mbdy2dtemp2<a name='707'>
   REAL , DIMENSION(:,:,:) , ALLOCATABLE , SAVE :: qn1bdy3dtemp1, qn1bdy3dtemp2, qn2bdy3dtemp1, qn2bdy3dtemp2<a name='708'>
real::t1,t2<a name='709'>
<a name='710'>
   <font color=#447700>!  Various sizes that we need to be concerned about.<a name='711'></font>
<a name='712'>
   ids = grid%sd31<a name='713'>
   ide = grid%ed31<a name='714'>
   kds = grid%sd32<a name='715'>
   kde = grid%ed32<a name='716'>
   jds = grid%sd33<a name='717'>
   jde = grid%ed33<a name='718'>
<a name='719'>
   ims = grid%sm31<a name='720'>
   ime = grid%em31<a name='721'>
   kms = grid%sm32<a name='722'>
   kme = grid%em32<a name='723'>
   jms = grid%sm33<a name='724'>
   jme = grid%em33<a name='725'>
<a name='726'>
   ips = grid%sp31<a name='727'>
   ipe = grid%ep31<a name='728'>
   kps = grid%sp32<a name='729'>
   kpe = grid%ep32<a name='730'>
   jps = grid%sp33<a name='731'>
   jpe = grid%ep33<a name='732'>
<a name='733'>
   ijds = MIN ( ids , jds )<a name='734'>
   ijde = MAX ( ide , jde )<a name='735'>
<a name='736'>
   <font color=#447700>!  Boundary width, scalar value.<a name='737'></font>
<a name='738'>
   spec_bdy_width = model_config_rec%spec_bdy_width<a name='739'>
   interval_seconds = model_config_rec%interval_seconds<a name='740'>
   sst_update = model_config_rec%sst_update<a name='741'>
   grid_fdda = model_config_rec%grid_fdda(grid%id)<a name='742'>
<a name='743'>
   <font color=#447700>!  Domain check.  We cannot decompose the domain into pieces that are<a name='744'></font>
   <font color=#447700>!  too small to manufacture the lateral boundary conditions.<a name='745'></font>
<a name='746'>
   IF ( ( ipe-ips+2 .LE. spec_bdy_width ) .OR. &amp;<a name='747'>
        ( jpe-jps+2 .LE. spec_bdy_width ) ) THEN<a name='748'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_484">( 'The "width" of the lateral boundary conditions must be entirely contained within')<a name='749'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_485">( 'the decomposed patch.                                                    ')<a name='750'>
     WRITE(message,fmt='("ips=",i4,", ipe=",i4,", jps=",i4,", jpe=",i4,", spec_bdy_width=",i2)') ips,ipe,jps,jpe,spec_bdy_width<a name='751'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_486">( message )<a name='752'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_424">( 'Submit the real program again with fewer processors ')<a name='753'>
   END IF<a name='754'>
<a name='755'>
<a name='756'>
   IF ( loop .EQ. 1 ) THEN<a name='757'>
<a name='758'>
      IF ( ( time_loop_max .EQ. 1 )  .OR. ( config_flags%polar ) ) THEN<a name='759'>
<a name='760'>
         <font color=#447700>!  No need to allocate space since we do not need the lateral boundary data yet<a name='761'></font>
         <font color=#447700>!  or at all (in case of the polar flag).<a name='762'></font>
<a name='763'>
      ELSE<a name='764'>
<a name='765'>
         <font color=#447700>!  This is the space needed to save the current 3d data for use in computing<a name='766'></font>
         <font color=#447700>!  the lateral boundary tendencies.<a name='767'></font>
   <a name='768'>
         IF ( ALLOCATED ( ubdy3dtemp1 ) ) DEALLOCATE ( ubdy3dtemp1 )<a name='769'>
         IF ( ALLOCATED ( vbdy3dtemp1 ) ) DEALLOCATE ( vbdy3dtemp1 )<a name='770'>
         IF ( ALLOCATED ( tbdy3dtemp1 ) ) DEALLOCATE ( tbdy3dtemp1 )<a name='771'>
         IF ( ALLOCATED ( pbdy3dtemp1 ) ) DEALLOCATE ( pbdy3dtemp1 )<a name='772'>
         IF ( ALLOCATED ( qbdy3dtemp1 ) ) DEALLOCATE ( qbdy3dtemp1 )<a name='773'>
         IF ( ALLOCATED ( mbdy2dtemp1 ) ) DEALLOCATE ( mbdy2dtemp1 )<a name='774'>
         IF ( ALLOCATED ( ubdy3dtemp2 ) ) DEALLOCATE ( ubdy3dtemp2 )<a name='775'>
         IF ( ALLOCATED ( vbdy3dtemp2 ) ) DEALLOCATE ( vbdy3dtemp2 )<a name='776'>
         IF ( ALLOCATED ( tbdy3dtemp2 ) ) DEALLOCATE ( tbdy3dtemp2 )<a name='777'>
         IF ( ALLOCATED ( pbdy3dtemp2 ) ) DEALLOCATE ( pbdy3dtemp2 )<a name='778'>
         IF ( ALLOCATED ( qbdy3dtemp2 ) ) DEALLOCATE ( qbdy3dtemp2 )<a name='779'>
         IF ( ALLOCATED ( mbdy2dtemp2 ) ) DEALLOCATE ( mbdy2dtemp2 )<a name='780'>
<a name='781'>
         ALLOCATE ( ubdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='782'>
         ALLOCATE ( vbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='783'>
         ALLOCATE ( tbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='784'>
         ALLOCATE ( pbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='785'>
         ALLOCATE ( qbdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='786'>
         ALLOCATE ( mbdy2dtemp1(ims:ime,1:1,    jms:jme) )<a name='787'>
         ALLOCATE ( ubdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='788'>
         ALLOCATE ( vbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='789'>
         ALLOCATE ( tbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='790'>
         ALLOCATE ( pbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='791'>
         ALLOCATE ( qbdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='792'>
         ALLOCATE ( mbdy2dtemp2(ims:ime,1:1,    jms:jme) )<a name='793'>
<a name='794'>
         IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='795'>
            IF ( ALLOCATED ( qn1bdy3dtemp1 ) ) DEALLOCATE ( qn1bdy3dtemp1 )<a name='796'>
            IF ( ALLOCATED ( qn2bdy3dtemp1 ) ) DEALLOCATE ( qn2bdy3dtemp1 )<a name='797'>
            IF ( ALLOCATED ( qn1bdy3dtemp2 ) ) DEALLOCATE ( qn1bdy3dtemp2 )<a name='798'>
            IF ( ALLOCATED ( qn2bdy3dtemp2 ) ) DEALLOCATE ( qn2bdy3dtemp2 )<a name='799'>
            ALLOCATE ( qn1bdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='800'>
            ALLOCATE ( qn2bdy3dtemp1(ims:ime,kms:kme,jms:jme) )<a name='801'>
            ALLOCATE ( qn1bdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='802'>
            ALLOCATE ( qn2bdy3dtemp2(ims:ime,kms:kme,jms:jme) )<a name='803'>
         END IF<a name='804'>
<a name='805'>
      END IF<a name='806'>
<a name='807'>
      <font color=#447700>!  Open the wrfinput file.  From this program, this is an *output* file.<a name='808'></font>
<a name='809'>
      grid%this_is_an_ideal_run = .FALSE.<a name='810'>
<a name='811'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_10">( inpname , 'wrfinput' , grid%id , 2 )<a name='812'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_10"> ( id1, TRIM(inpname) , grid , config_flags , output_input , "DATASET=INPUT", ierr )<a name='813'>
      IF ( ierr .NE. 0 ) THEN<a name='814'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_425">( 'real: error opening wrfinput for writing' )<a name='815'>
      END IF<a name='816'>
      CALL output_input ( id1, grid , config_flags , ierr )<a name='817'>
      CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_14"> ( id1 , config_flags , "DATASET=INPUT" )<a name='818'>
<a name='819'>
      IF ( time_loop_max .NE. 1 ) THEN<a name='820'>
         IF(sst_update .EQ. 1)THEN<a name='821'>
           CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_11">( inpname , 'wrflowinp' , grid%id , 2 )<a name='822'>
           CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_11"> ( id4, TRIM(inpname) , grid , config_flags , output_auxinput4 , "DATASET=AUXINPUT4", ierr )<a name='823'>
           IF ( ierr .NE. 0 ) THEN<a name='824'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_426">( 'real: error opening wrflowinp for writing' )<a name='825'>
           END IF<a name='826'>
           CALL output_auxinput4 ( id4, grid , config_flags , ierr )<a name='827'>
         END IF<a name='828'>
      END IF<a name='829'>
<a name='830'>
      IF ( ( time_loop_max .EQ. 1 )  .OR. ( config_flags%polar ) ) THEN<a name='831'>
<a name='832'>
         <font color=#447700>!  No need to couple data since no lateral BCs required.<a name='833'></font>
<a name='834'>
      ELSE<a name='835'>
<a name='836'>
         <font color=#447700>!  We need to save the 3d data to compute a difference during the next loop.  Couple the<a name='837'></font>
         <font color=#447700>!  3d fields with total mu (mub + mu_2) and the stagger-specific map scale factor.<a name='838'></font>
   <a name='839'>
         <font color=#447700>!  u, theta, h, scalars coupled with my; v coupled with mx<a name='840'></font>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_19"> ( grid%mu_2 , grid%mub , ubdy3dtemp1 , grid%u_2                 , 'u' , grid%msfuy , &amp;<a name='841'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='842'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='843'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_20"> ( grid%mu_2 , grid%mub , vbdy3dtemp1 , grid%v_2                 , 'v' , grid%msfvx , &amp;<a name='844'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='845'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='846'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_21"> ( grid%mu_2 , grid%mub , tbdy3dtemp1 , grid%t_2                 , 't' , grid%msfty , &amp;<a name='847'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='848'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='849'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_22"> ( grid%mu_2 , grid%mub , pbdy3dtemp1 , grid%ph_2                , 'h' , grid%msfty , &amp;<a name='850'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='851'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='852'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_23"> ( grid%mu_2 , grid%mub , qbdy3dtemp1 , grid%moist(:,:,:,P_QV)      , 't' , grid%msfty , &amp;<a name='853'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='854'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='855'>
   <a name='856'>
         DO j = jps , MIN(jde-1,jpe)<a name='857'>
            DO i = ips , MIN(ide-1,ipe)<a name='858'>
               mbdy2dtemp1(i,1,j) = grid%mu_2(i,j)<a name='859'>
            END DO<a name='860'>
         END DO<a name='861'>
<a name='862'>
         IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='863'>
            CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_24"> ( grid%mu_2 , grid%mub , qn1bdy3dtemp1 , grid%scalar(:,:,:,P_QNWFA)      , 't' , grid%msfty , &amp;<a name='864'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='865'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='866'>
            CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_25"> ( grid%mu_2 , grid%mub , qn2bdy3dtemp1 , grid%scalar(:,:,:,P_QNIFA)      , 't' , grid%msfty , &amp;<a name='867'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='868'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='869'>
         END IF<a name='870'>
<a name='871'>
      END IF<a name='872'>
<a name='873'>
      IF(grid_fdda .GE. 1)THEN<a name='874'>
         DO j = jps , jpe<a name='875'>
            DO k = kps , kpe<a name='876'>
               DO i = ips , ipe<a name='877'>
                  grid%fdda3d(i,k,j,p_u_ndg_old) = grid%u_2(i,k,j)<a name='878'>
                  grid%fdda3d(i,k,j,p_v_ndg_old) = grid%v_2(i,k,j)<a name='879'>
                  grid%fdda3d(i,k,j,p_t_ndg_old) = grid%t_2(i,k,j)<a name='880'>
                  grid%fdda3d(i,k,j,p_q_ndg_old) = grid%moist(i,k,j,P_QV)<a name='881'>
                  grid%fdda3d(i,k,j,p_ph_ndg_old) = grid%ph_2(i,k,j)<a name='882'>
               END DO<a name='883'>
            END DO<a name='884'>
         END DO<a name='885'>
<a name='886'>
         DO j = jps , jpe<a name='887'>
            DO i = ips , ipe<a name='888'>
               grid%fdda2d(i,1,j,p_mu_ndg_old) = grid%mu_2(i,j)<a name='889'>
<font color=#447700>!              grid%fdda2d(i,1,j,p_t2_ndg_old) = grid%t2(i,j)<a name='890'></font>
<font color=#447700>!              grid%fdda2d(i,1,j,p_q2_ndg_old) = grid%q2(i,j)<a name='891'></font>
<font color=#447700>!              grid%fdda2d(i,1,j,p_sn_ndg_old) = grid%snow(i,j)<a name='892'></font>
            END DO<a name='893'>
         END DO<a name='894'>
      END IF<a name='895'>
<a name='896'>
      IF ( ( time_loop_max .EQ. 1 )  .OR. ( config_flags%polar ) ) THEN<a name='897'>
<a name='898'>
         <font color=#447700>!  No need to build boundary arrays, since no lateral BCs are being generated.<a name='899'></font>
<a name='900'>
      ELSE<a name='901'>
   <a name='902'>
         <font color=#447700>!  There are 2 components to the lateral boundaries.  First, there is the starting<a name='903'></font>
         <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='904'></font>
   <a name='905'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_17">     ( ubdy3dtemp1 , grid%u_bxs, grid%u_bxe, grid%u_bys, grid%u_bye, &amp;<a name='906'>
                                                              'U' , spec_bdy_width      , &amp;<a name='907'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='908'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='909'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='910'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_18">     ( vbdy3dtemp1 , grid%v_bxs, grid%v_bxe, grid%v_bys, grid%v_bye, &amp;<a name='911'>
                                                              'V' , spec_bdy_width      , &amp;<a name='912'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='913'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='914'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='915'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_19">     ( tbdy3dtemp1 , grid%t_bxs, grid%t_bxe, grid%t_bys, grid%t_bye, &amp;<a name='916'>
                                                              'T' , spec_bdy_width      , &amp;<a name='917'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='918'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='919'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='920'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_20">     ( pbdy3dtemp1 , grid%ph_bxs, grid%ph_bxe, grid%ph_bys, grid%ph_bye, &amp;<a name='921'>
                                                              'W' , spec_bdy_width      , &amp;<a name='922'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='923'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='924'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='925'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_21">     ( qbdy3dtemp1 , grid%moist_bxs(:,:,:,P_QV), grid%moist_bxe(:,:,:,P_QV),     &amp;<a name='926'>
                                            grid%moist_bys(:,:,:,P_QV), grid%moist_bye(:,:,:,P_QV),     &amp;<a name='927'>
                                                              'T' , spec_bdy_width      ,               &amp;<a name='928'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='929'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='930'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='931'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_22">     ( mbdy2dtemp1 , grid%mu_bxs, grid%mu_bxe, grid%mu_bys, grid%mu_bye, &amp;<a name='932'>
                                                              'M' , spec_bdy_width      , &amp;<a name='933'>
                                                                    ids , ide , jds , jde , 1 , 1 , &amp;<a name='934'>
                                                                    ims , ime , jms , jme , 1 , 1 , &amp;<a name='935'>
                                                                    ips , ipe , jps , jpe , 1 , 1 )<a name='936'>
<a name='937'>
         IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='938'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_23">     ( qn1bdy3dtemp1 , grid%scalar_bxs(:,:,:,P_QNWFA), grid%scalar_bxe(:,:,:,P_QNWFA),     &amp;<a name='939'>
                                            grid%scalar_bys(:,:,:,P_QNWFA), grid%scalar_bye(:,:,:,P_QNWFA),     &amp;<a name='940'>
                                                              'T' , spec_bdy_width      ,               &amp;<a name='941'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='942'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='943'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='944'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_24">     ( qn2bdy3dtemp1 , grid%scalar_bxs(:,:,:,P_QNIFA), grid%scalar_bxe(:,:,:,P_QNIFA),     &amp;<a name='945'>
                                            grid%scalar_bys(:,:,:,P_QNIFA), grid%scalar_bye(:,:,:,P_QNIFA),     &amp;<a name='946'>
                                                              'T' , spec_bdy_width      ,               &amp;<a name='947'>
                                                                    ids , ide , jds , jde , kds , kde , &amp;<a name='948'>
                                                                    ims , ime , jms , jme , kms , kme , &amp;<a name='949'>
                                                                    ips , ipe , jps , jpe , kps , kpe )<a name='950'>
         END IF<a name='951'>
      END IF<a name='952'>
<a name='953'>
<a name='954'>
   ELSE IF ( loop .GT. 1 ) THEN<a name='955'>
<a name='956'>
      IF(sst_update .EQ. 1)THEN<a name='957'>
        CALL output_auxinput4 ( id4, grid , config_flags , ierr )<a name='958'>
      END IF<a name='959'>
<a name='960'>
      <font color=#447700>!  Open the boundary and the fdda file.<a name='961'></font>
<a name='962'>
      IF ( loop .eq. 2 ) THEN<a name='963'>
         IF ( (grid%id .eq. 1) .and. ( .NOT. config_flags%polar ) ) THEN<a name='964'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_12">( bdyname , 'wrfbdy' , grid%id , 2 )<a name='965'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_12"> ( id, TRIM(bdyname) , grid , config_flags , output_boundary , "DATASET=BOUNDARY", ierr )<a name='966'>
            IF ( ierr .NE. 0 ) THEN<a name='967'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_427">( 'real: error opening wrfbdy for writing' )<a name='968'>
            END IF<a name='969'>
         END IF<a name='970'>
         IF(grid_fdda .GE. 1)THEN<a name='971'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1'>construct_filename1</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME1_13">( inpname , 'wrffdda' , grid%id , 2 )<a name='972'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_13"> ( id2, TRIM(inpname) , grid , config_flags , output_auxinput10 , "DATASET=AUXINPUT10", ierr )<a name='973'>
            IF ( ierr .NE. 0 ) THEN<a name='974'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_428">( 'real: error opening wrffdda for writing' )<a name='975'>
            END IF<a name='976'>
         END IF<a name='977'>
      ELSE<a name='978'>
         IF ( .NOT. domain_clockisstoptime(grid) ) THEN<a name='979'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE'>domain_clockadvance</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKADVANCE_5">( grid )<a name='980'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_12"> ( 150, grid, &amp;<a name='981'>
                   'DEBUG assemble_output:  clock after ClockAdvance,' )<a name='982'>
         END IF<a name='983'>
      END IF<a name='984'>
<a name='985'>
      IF ( config_flags%polar ) THEN<a name='986'>
<a name='987'>
         <font color=#447700>!  No need to couple fields, since no lateral BCs are required.<a name='988'></font>
<a name='989'>
      ELSE<a name='990'>
   <a name='991'>
         <font color=#447700>!  Couple this time period's data with total mu, and save it in the *bdy3dtemp2 arrays.<a name='992'></font>
   <a name='993'>
         <font color=#447700>!  u, theta, h, scalars coupled with my; v coupled with mx<a name='994'></font>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_26"> ( grid%mu_2 , grid%mub , ubdy3dtemp2 , grid%u_2                 , 'u' , grid%msfuy , &amp;<a name='995'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='996'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='997'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_27"> ( grid%mu_2 , grid%mub , vbdy3dtemp2 , grid%v_2                 , 'v' , grid%msfvx , &amp;<a name='998'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='999'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1000'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_28"> ( grid%mu_2 , grid%mub , tbdy3dtemp2 , grid%t_2                 , 't' , grid%msfty , &amp;<a name='1001'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='1002'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1003'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_29"> ( grid%mu_2 , grid%mub , pbdy3dtemp2 , grid%ph_2                , 'h' , grid%msfty , &amp;<a name='1004'>
                       grid%c1h, grid%c2h, grid%c1f, grid%c2f, &amp;<a name='1005'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1006'>
         CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_30"> ( grid%mu_2 , grid%mub , qbdy3dtemp2 , grid%moist(:,:,:,P_QV)      , 't' , grid%msfty , &amp;<a name='1007'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='1008'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1009'>
   <a name='1010'>
         DO j = jps , jpe<a name='1011'>
            DO i = ips , ipe<a name='1012'>
               mbdy2dtemp2(i,1,j) = grid%mu_2(i,j)<a name='1013'>
            END DO<a name='1014'>
         END DO<a name='1015'>
<a name='1016'>
         IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='1017'>
            CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_31"> ( grid%mu_2 , grid%mub , qn1bdy3dtemp2 , grid%scalar(:,:,:,P_QNWFA)      , 't' , grid%msfty , &amp;<a name='1018'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='1019'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1020'>
            CALL <A href='../../html_code/dyn_em/module_big_step_utilities_em.F.html#COUPLE'>couple</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_32"> ( grid%mu_2 , grid%mub , qn2bdy3dtemp2 , grid%scalar(:,:,:,P_QNIFA)      , 't' , grid%msfty , &amp;<a name='1021'>
                       grid%c1h, grid%c2h, grid%c1h, grid%c2h, &amp;<a name='1022'>
                       ids, ide, jds, jde, kds, kde, ims, ime, jms, jme, kms, kme, ips, ipe, jps, jpe, kps, kpe )<a name='1023'>
         END IF<a name='1024'>
<a name='1025'>
      END IF<a name='1026'>
<a name='1027'>
      IF(grid_fdda .GE. 1)THEN<a name='1028'>
         DO j = jps , jpe<a name='1029'>
            DO k = kps , kpe<a name='1030'>
               DO i = ips , ipe<a name='1031'>
                  grid%fdda3d(i,k,j,p_u_ndg_new) = grid%u_2(i,k,j)<a name='1032'>
                  grid%fdda3d(i,k,j,p_v_ndg_new) = grid%v_2(i,k,j)<a name='1033'>
                  grid%fdda3d(i,k,j,p_t_ndg_new) = grid%t_2(i,k,j)<a name='1034'>
                  grid%fdda3d(i,k,j,p_q_ndg_new) = grid%moist(i,k,j,P_QV)<a name='1035'>
                  grid%fdda3d(i,k,j,p_ph_ndg_new) = grid%ph_2(i,k,j)<a name='1036'>
               END DO<a name='1037'>
            END DO<a name='1038'>
         END DO<a name='1039'>
<a name='1040'>
         DO j = jps , jpe<a name='1041'>
            DO i = ips , ipe<a name='1042'>
               grid%fdda2d(i,1,j,p_mu_ndg_new) = grid%mu_2(i,j)<a name='1043'>
<font color=#447700>!              grid%fdda2d(i,1,j,p_t2_ndg_new) = grid%t2(i,j)<a name='1044'></font>
<font color=#447700>!              grid%fdda2d(i,1,j,p_q2_ndg_new) = grid%q2(i,j)<a name='1045'></font>
<font color=#447700>!              grid%fdda2d(i,1,j,p_sn_ndg_new) = grid%snow(i,j)<a name='1046'></font>
            END DO<a name='1047'>
         END DO<a name='1048'>
      END IF<a name='1049'>
<a name='1050'>
      IF ( config_flags%polar ) THEN<a name='1051'>
<a name='1052'>
         <font color=#447700>!  No need to build boundary arrays, since no lateral BCs are being generated.<a name='1053'></font>
<a name='1054'>
      ELSE<a name='1055'>
<a name='1056'>
         <font color=#447700>!  During all of the loops after the first loop, we first compute the boundary<a name='1057'></font>
         <font color=#447700>!  tendencies with the current data values (*bdy3dtemp2 arrays) and the previously <a name='1058'></font>
         <font color=#447700>!  saved information stored in the *bdy3dtemp1 arrays.<a name='1059'></font>
   <a name='1060'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_17"> ( ubdy3dtemp2 , ubdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1061'>
                                                               grid%u_btxs, grid%u_btxe,     &amp;<a name='1062'>
                                                               grid%u_btys, grid%u_btye,     &amp;<a name='1063'>
                                                               'U' , &amp;<a name='1064'>
                                                               spec_bdy_width      , &amp;<a name='1065'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1066'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1067'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1068'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_18"> ( vbdy3dtemp2 , vbdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1069'>
                                                               grid%v_btxs, grid%v_btxe,     &amp;<a name='1070'>
                                                               grid%v_btys, grid%v_btye,     &amp;<a name='1071'>
                                                               'V' , &amp;<a name='1072'>
                                                               spec_bdy_width      , &amp;<a name='1073'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1074'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1075'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1076'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_19"> ( tbdy3dtemp2 , tbdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1077'>
                                                               grid%t_btxs, grid%t_btxe,     &amp;<a name='1078'>
                                                               grid%t_btys, grid%t_btye,     &amp;<a name='1079'>
                                                               'T' , &amp;<a name='1080'>
                                                               spec_bdy_width      , &amp;<a name='1081'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1082'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1083'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1084'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_20"> ( pbdy3dtemp2 , pbdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1085'>
                                                               grid%ph_btxs, grid%ph_btxe,   &amp;<a name='1086'>
                                                               grid%ph_btys, grid%ph_btye,   &amp;<a name='1087'>
                                                               'W' , &amp;<a name='1088'>
                                                               spec_bdy_width      , &amp;<a name='1089'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1090'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1091'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1092'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_21"> ( qbdy3dtemp2 , qbdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1093'>
                                                               grid%moist_btxs(:,:,:,P_QV), grid%moist_btxe(:,:,:,P_QV), &amp;<a name='1094'>
                                                               grid%moist_btys(:,:,:,P_QV), grid%moist_btye(:,:,:,P_QV), &amp;<a name='1095'>
                                                               'T' , &amp;<a name='1096'>
                                                               spec_bdy_width      , &amp;<a name='1097'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1098'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1099'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1100'>
         CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_22"> ( mbdy2dtemp2 , mbdy2dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1101'>
                                                               grid%mu_btxs, grid%mu_btxe,   &amp;<a name='1102'>
                                                               grid%mu_btys, grid%mu_btye,   &amp;<a name='1103'>
                                                               'M' , &amp;<a name='1104'>
                                                               spec_bdy_width      , &amp;<a name='1105'>
                                                               ids , ide , jds , jde , 1 , 1 , &amp;<a name='1106'>
                                                               ims , ime , jms , jme , 1 , 1 , &amp;<a name='1107'>
                                                               ips , ipe , jps , jpe , 1 , 1 )<a name='1108'>
         IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='1109'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_23"> ( qn1bdy3dtemp2 , qn1bdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1110'>
                                                               grid%scalar_btxs(:,:,:,P_QNWFA), grid%scalar_btxe(:,:,:,P_QNWFA), &amp;<a name='1111'>
                                                               grid%scalar_btys(:,:,:,P_QNWFA), grid%scalar_btye(:,:,:,P_QNWFA), &amp;<a name='1112'>
                                                               'T' , &amp;<a name='1113'>
                                                               spec_bdy_width      , &amp;<a name='1114'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1115'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1116'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1117'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND'>stuff_bdytend</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDYTEND_24"> ( qn2bdy3dtemp2 , qn2bdy3dtemp1 , REAL(interval_seconds) ,                 &amp;<a name='1118'>
                                                               grid%scalar_btxs(:,:,:,P_QNIFA), grid%scalar_btxe(:,:,:,P_QNIFA), &amp;<a name='1119'>
                                                               grid%scalar_btys(:,:,:,P_QNIFA), grid%scalar_btye(:,:,:,P_QNIFA), &amp;<a name='1120'>
                                                               'T' , &amp;<a name='1121'>
                                                               spec_bdy_width      , &amp;<a name='1122'>
                                                               ids , ide , jds , jde , kds , kde , &amp;<a name='1123'>
                                                               ims , ime , jms , jme , kms , kme , &amp;<a name='1124'>
                                                               ips , ipe , jps , jpe , kps , kpe )<a name='1125'>
         END IF<a name='1126'>
      END IF<a name='1127'>
<a name='1128'>
      <font color=#447700>!  Both pieces of the boundary data are now available to be written (initial time and tendency).<a name='1129'></font>
      <font color=#447700>!  This looks ugly, these date shifting things.  What's it for?  We want the "Times" variable<a name='1130'></font>
      <font color=#447700>!  in the lateral BDY file to have the valid times of when the initial fields are written.<a name='1131'></font>
      <font color=#447700>!  That's what the loop-2 thingy is for with the start date.  We increment the start_date so<a name='1132'></font>
      <font color=#447700>!  that the starting time in the attributes is the second time period.  Why you may ask.  I<a name='1133'></font>
      <font color=#447700>!  agree, why indeed.<a name='1134'></font>
<a name='1135'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_13"> ( 150, grid, &amp;<a name='1136'>
             'DEBUG assemble_output:  clock before 1st current_date set,' )<a name='1137'>
      WRITE (wrf_err_message,*) &amp;<a name='1138'>
        'DEBUG assemble_output:  before 1st currTime set, current_date = ',TRIM(current_date)<a name='1139'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_365"> ( 150 , wrf_err_message )<a name='1140'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_22">( grid, current_date(1:19) )<a name='1141'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_14"> ( 150, grid, &amp;<a name='1142'>
             'DEBUG assemble_output:  clock after 1st current_date set,' )<a name='1143'>
<a name='1144'>
      temp24= current_date<a name='1145'>
      temp24b=start_date<a name='1146'>
      start_date = current_date<a name='1147'>
      CALL <A href='../../html_code/share/module_date_time.F.html#GETH_NEWDATE'>geth_newdate</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_NEWDATE_10"> ( temp19 , temp24b(1:19) , (loop-2) * model_config_rec%interval_seconds )<a name='1148'>
      current_date = temp19 //  '.0000'<a name='1149'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_15"> ( 150, grid, &amp;<a name='1150'>
             'DEBUG assemble_output:  clock before 2nd current_date set,' )<a name='1151'>
      WRITE (wrf_err_message,*) &amp;<a name='1152'>
        'DEBUG assemble_output:  before 2nd currTime set, current_date = ',TRIM(current_date)<a name='1153'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_366"> ( 150 , wrf_err_message )<a name='1154'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_23">( grid, current_date(1:19) )<a name='1155'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_16"> ( 150, grid, &amp;<a name='1156'>
             'DEBUG assemble_output:  clock after 2nd current_date set,' )<a name='1157'>
<a name='1158'>
      IF ( config_flags%polar ) THEN<a name='1159'>
<a name='1160'>
         <font color=#447700>!  No need to ouput boundary data for polar cases.<a name='1161'></font>
<a name='1162'>
      ELSE<a name='1163'>
<a name='1164'>
         <font color=#447700>!  Output boundary file.<a name='1165'></font>
   <a name='1166'>
         IF(grid%id .EQ. 1)THEN<a name='1167'>
           print *,'LBC valid between these times ',current_date, ' ',start_date<a name='1168'>
           CALL <A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY'>output_boundary</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_BOUNDARY_5"> ( id, grid , config_flags , ierr )<a name='1169'>
         END IF<a name='1170'>
<a name='1171'>
      END IF<a name='1172'>
<a name='1173'>
      <font color=#447700>!  Output gridded/analysis FDDA file.<a name='1174'></font>
<a name='1175'>
      IF(grid_fdda .GE. 1) THEN<a name='1176'>
         CALL output_auxinput10 ( id2, grid , config_flags , ierr )<a name='1177'>
      END IF<a name='1178'>
<a name='1179'>
      current_date = temp24<a name='1180'>
      start_date = temp24b<a name='1181'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_17"> ( 150, grid, &amp;<a name='1182'>
             'DEBUG assemble_output:  clock before 3rd current_date set,' )<a name='1183'>
      WRITE (wrf_err_message,*) &amp;<a name='1184'>
        'DEBUG assemble_output:  before 3rd currTime set, current_date = ',TRIM(current_date)<a name='1185'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_367"> ( 150 , wrf_err_message )<a name='1186'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET'>domain_clock_set</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_SET_24">( grid, current_date(1:19) )<a name='1187'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_18"> ( 150, grid, &amp;<a name='1188'>
             'DEBUG assemble_output:  clock after 3rd current_date set,' )<a name='1189'>
<a name='1190'>
      <font color=#447700>!  OK, for all of the loops, we output the initialzation data, which would allow us to<a name='1191'></font>
      <font color=#447700>!  start the model at any of the available analysis time periods.<a name='1192'></font>
<a name='1193'>
      IF ( config_flags%all_ic_times ) THEN<a name='1194'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_8"> ( inpname , 'wrfinput_d&lt;domain&gt;.&lt;date&gt;' , grid%id , 2 , TRIM(current_date) )<a name='1195'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET'>open_w_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_W_DATASET_14"> ( id1, inpname , grid , config_flags , output_input , "DATASET=INPUT", ierr )<a name='1196'>
         IF ( ierr .NE. 0 ) THEN<a name='1197'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_429">( 'real: error opening' // inpname // ' for writing' )<a name='1198'>
         END IF<a name='1199'>
         CALL output_input ( id1, grid , config_flags , ierr )<a name='1200'>
         CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_15"> ( id1 , config_flags , "DATASET=INPUT" )<a name='1201'>
      END IF<a name='1202'>
<a name='1203'>
      <font color=#447700>!  Is this or is this not the last time time?  We can remove some unnecessary<a name='1204'></font>
      <font color=#447700>!  stores if it is not.<a name='1205'></font>
<a name='1206'>
      IF     ( loop .LT. time_loop_max ) THEN<a name='1207'>
<a name='1208'>
         IF ( config_flags%polar ) THEN<a name='1209'>
  <a name='1210'>
            <font color=#447700>!  No need to swap old for new for the boundary data, it is not required.<a name='1211'></font>
<a name='1212'>
         ELSE<a name='1213'>
<a name='1214'>
            <font color=#447700>!  We need to save the 3d data to compute a difference during the next loop.  Couple the<a name='1215'></font>
            <font color=#447700>!  3d fields with total mu (mub + mu_2) and the stagger-specific map scale factor.<a name='1216'></font>
            <font color=#447700>!  We load up the boundary data again for use in the next loop.<a name='1217'></font>
   <a name='1218'>
            DO j = jps , jpe<a name='1219'>
               DO k = kps , kpe<a name='1220'>
                  DO i = ips , ipe<a name='1221'>
                     ubdy3dtemp1(i,k,j) = ubdy3dtemp2(i,k,j)<a name='1222'>
                     vbdy3dtemp1(i,k,j) = vbdy3dtemp2(i,k,j)<a name='1223'>
                     tbdy3dtemp1(i,k,j) = tbdy3dtemp2(i,k,j)<a name='1224'>
                     pbdy3dtemp1(i,k,j) = pbdy3dtemp2(i,k,j)<a name='1225'>
                     qbdy3dtemp1(i,k,j) = qbdy3dtemp2(i,k,j)<a name='1226'>
                  END DO<a name='1227'>
               END DO<a name='1228'>
            END DO<a name='1229'>
   <a name='1230'>
            DO j = jps , jpe<a name='1231'>
               DO i = ips , ipe<a name='1232'>
                  mbdy2dtemp1(i,1,j) = mbdy2dtemp2(i,1,j)<a name='1233'>
               END DO<a name='1234'>
            END DO<a name='1235'>
<a name='1236'>
            IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='1237'>
               DO j = jps , jpe<a name='1238'>
                  DO k = kps , kpe<a name='1239'>
                     DO i = ips , ipe<a name='1240'>
                        qn1bdy3dtemp1(i,k,j) = qn1bdy3dtemp2(i,k,j)<a name='1241'>
                        qn2bdy3dtemp1(i,k,j) = qn2bdy3dtemp2(i,k,j)<a name='1242'>
                     END DO<a name='1243'>
                  END DO<a name='1244'>
               END DO<a name='1245'>
            END IF<a name='1246'>
<a name='1247'>
         END IF<a name='1248'>
<a name='1249'>
         IF(grid_fdda .GE. 1)THEN<a name='1250'>
            DO j = jps , jpe<a name='1251'>
               DO k = kps , kpe<a name='1252'>
                  DO i = ips , ipe<a name='1253'>
                     grid%fdda3d(i,k,j,p_u_ndg_old) = grid%fdda3d(i,k,j,p_u_ndg_new)<a name='1254'>
                     grid%fdda3d(i,k,j,p_v_ndg_old) = grid%fdda3d(i,k,j,p_v_ndg_new)<a name='1255'>
                     grid%fdda3d(i,k,j,p_t_ndg_old) = grid%fdda3d(i,k,j,p_t_ndg_new)<a name='1256'>
                     grid%fdda3d(i,k,j,p_q_ndg_old) = grid%fdda3d(i,k,j,p_q_ndg_new)<a name='1257'>
                     grid%fdda3d(i,k,j,p_ph_ndg_old) = grid%fdda3d(i,k,j,p_ph_ndg_new)<a name='1258'>
                  END DO<a name='1259'>
               END DO<a name='1260'>
            END DO<a name='1261'>
<a name='1262'>
            DO j = jps , jpe<a name='1263'>
               DO i = ips , ipe<a name='1264'>
                  grid%fdda2d(i,1,j,p_mu_ndg_old) = grid%fdda2d(i,1,j,p_mu_ndg_new)<a name='1265'>
<font color=#447700>!                 grid%fdda2d(i,1,j,p_t2_ndg_old) = grid%fdda2d(i,1,j,p_t2_ndg_new)<a name='1266'></font>
<font color=#447700>!                 grid%fdda2d(i,1,j,p_q2_ndg_old) = grid%fdda2d(i,1,j,p_q2_ndg_new)<a name='1267'></font>
<font color=#447700>!                 grid%fdda2d(i,1,j,p_sn_ndg_old) = grid%fdda2d(i,1,j,p_sn_ndg_new)<a name='1268'></font>
               END DO<a name='1269'>
            END DO<a name='1270'>
         END IF<a name='1271'>
<a name='1272'>
         IF ( config_flags%polar ) THEN<a name='1273'>
<a name='1274'>
            <font color=#447700>!  No need to build boundary arrays, since no lateral BCs are being generated.<a name='1275'></font>
<a name='1276'>
         ELSE<a name='1277'>
<a name='1278'>
            <font color=#447700>!  There are 2 components to the lateral boundaries.  First, there is the starting<a name='1279'></font>
            <font color=#447700>!  point of this time period - just the outer few rows and columns.<a name='1280'></font>
   <a name='1281'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_25">     ( ubdy3dtemp1 , grid%u_bxs, grid%u_bxe, grid%u_bys, grid%u_bye, &amp;<a name='1282'>
                                                                 'U' , spec_bdy_width      , &amp;<a name='1283'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1284'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1285'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1286'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_26">     ( vbdy3dtemp1 , grid%v_bxs, grid%v_bxe, grid%v_bys, grid%v_bye, &amp;<a name='1287'>
                                                                 'V' , spec_bdy_width      , &amp;<a name='1288'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1289'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1290'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1291'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_27">     ( tbdy3dtemp1 , grid%t_bxs, grid%t_bxe, grid%t_bys, grid%t_bye, &amp;<a name='1292'>
                                                                 'T' , spec_bdy_width      , &amp;<a name='1293'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1294'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1295'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1296'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_28">     ( pbdy3dtemp1 , grid%ph_bxs, grid%ph_bxe, grid%ph_bys, grid%ph_bye, &amp;<a name='1297'>
                                                                 'W' , spec_bdy_width      , &amp;<a name='1298'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1299'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1300'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1301'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_29">     ( qbdy3dtemp1 , grid%moist_bxs(:,:,:,P_QV), grid%moist_bxe(:,:,:,P_QV),     &amp;<a name='1302'>
                                               grid%moist_bys(:,:,:,P_QV), grid%moist_bye(:,:,:,P_QV),     &amp;<a name='1303'>
                                                                 'T' , spec_bdy_width      ,               &amp;<a name='1304'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1305'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1306'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1307'>
            CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_30">     ( mbdy2dtemp1 , grid%mu_bxs, grid%mu_bxe, grid%mu_bys, grid%mu_bye, &amp;<a name='1308'>
                                                                 'M' , spec_bdy_width      , &amp;<a name='1309'>
                                                                       ids , ide , jds , jde , 1 , 1 , &amp;<a name='1310'>
                                                                       ims , ime , jms , jme , 1 , 1 , &amp;<a name='1311'>
                                                                       ips , ipe , jps , jpe , 1 , 1 )<a name='1312'>
<a name='1313'>
            IF (config_flags%mp_physics.eq.THOMPSONAERO .AND.  config_flags%use_aero_icbc) THEN<a name='1314'>
               CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_31">     ( qn1bdy3dtemp1 , grid%scalar_bxs(:,:,:,P_QNWFA), grid%scalar_bxe(:,:,:,P_QNWFA),     &amp;<a name='1315'>
                                                    grid%scalar_bys(:,:,:,P_QNWFA), grid%scalar_bye(:,:,:,P_QNWFA),     &amp;<a name='1316'>
                                                                 'T' , spec_bdy_width      ,               &amp;<a name='1317'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1318'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1319'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1320'>
               CALL <A href='../../html_code/share/module_bc.F.html#STUFF_BDY'>stuff_bdy</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="STUFF_BDY_32">     ( qn2bdy3dtemp1 , grid%scalar_bxs(:,:,:,P_QNIFA), grid%scalar_bxe(:,:,:,P_QNIFA),     &amp;<a name='1321'>
                                                    grid%scalar_bys(:,:,:,P_QNIFA), grid%scalar_bye(:,:,:,P_QNIFA),     &amp;<a name='1322'>
                                                                 'T' , spec_bdy_width      ,               &amp;<a name='1323'>
                                                                       ids , ide , jds , jde , kds , kde , &amp;<a name='1324'>
                                                                       ims , ime , jms , jme , kms , kme , &amp;<a name='1325'>
                                                                       ips , ipe , jps , jpe , kps , kpe )<a name='1326'>
            END IF<a name='1327'>
   <a name='1328'>
         END IF<a name='1329'>
<a name='1330'>
      ELSE IF ( loop .EQ. time_loop_max ) THEN<a name='1331'>
<a name='1332'>
         <font color=#447700>!  If this is the last time through here, we need to close the files.<a name='1333'></font>
<a name='1334'>
         IF ( config_flags%polar ) THEN<a name='1335'>
<a name='1336'>
            <font color=#447700>!  No need to close the boundary file, it was never used.<a name='1337'></font>
<a name='1338'>
         ELSE<a name='1339'>
            IF(grid%id .EQ. 1) THEN<a name='1340'>
               CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_16"> ( id , config_flags , "DATASET=BOUNDARY" )<a name='1341'>
            END IF<a name='1342'>
         END IF<a name='1343'>
<a name='1344'>
         IF(grid_fdda .GE. 1) THEN<a name='1345'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_17"> ( id2 , config_flags , "DATASET=AUXINPUT10" )<a name='1346'>
         END IF<a name='1347'>
<a name='1348'>
         IF(sst_update .EQ. 1)THEN<a name='1349'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/main/tc_em.F.html#ASSEMBLE_OUTPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_18"> ( id4 , config_flags , "DATASET=AUXINPUT4" )<a name='1350'>
         END IF<a name='1351'>
<a name='1352'>
      END IF<a name='1353'>
<a name='1354'>
   END IF<a name='1355'>
<a name='1356'>
END SUBROUTINE assemble_output<a name='1357'>
</pre></body></html>