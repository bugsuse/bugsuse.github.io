<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:IO<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<a name='4'>
<A NAME='MODULE_IO_DOMAIN'><A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='5'>
<font color=#993300>MODULE </font><font color=#cc0000>module_io_domain</font> <A href='../../call_to/MODULE_IO_DOMAIN.html' TARGET='index'>62</A><a name='6'>
USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/share/module_io_domain.F.html#module_io_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_12"><a name='7'>
USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_io_domain.F.html#module_io_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_4"><a name='8'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_io_domain.F.html#module_io_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_266">, ONLY : grid_config_rec_type<a name='9'>
USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_io_domain.F.html#module_io_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_418">, ONLY : domain<a name='10'>
<a name='11'>
CONTAINS<a name='12'>
<a name='13'>
<A NAME='OPEN_R_DATASET'><A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>open_r_dataset</font> ( id , fname , grid , config_flags , sysdepinfo, ierr ) <A href='../../call_to/OPEN_R_DATASET.html' TARGET='index'>29</A>,<A href='../../call_from/OPEN_R_DATASET.html' TARGET='index'>1</A><a name='15'>
   TYPE (domain)             :: grid<a name='16'>
   CHARACTER*(*) :: fname<a name='17'>
   CHARACTER*(*) :: sysdepinfo<a name='18'>
   INTEGER      , INTENT(INOUT) :: id , ierr<a name='19'>
   LOGICAL , EXTERNAL :: wrf_dm_on_monitor<a name='20'>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='21'>
   CHARACTER*128             :: DataSet, tmp<a name='22'>
   LOGICAL                   :: anyway<a name='23'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ'>wrf_open_for_read</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_OPEN_FOR_READ_3"> ( fname ,                     &amp;<a name='24'>
                            grid ,                      &amp;<a name='25'>
                            sysdepinfo ,                &amp;<a name='26'>
                            id ,                        &amp;<a name='27'>
                            ierr )<a name='28'>
   RETURN<a name='29'>
  END SUBROUTINE open_r_dataset<a name='30'>
<a name='31'>
<A NAME='OPEN_W_DATASET'><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='32'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>open_w_dataset</font> ( id , fname , grid , config_flags , outsub , sysdepinfo, ierr ) <A href='../../call_to/OPEN_W_DATASET.html' TARGET='index'>24</A>,<A href='../../call_from/OPEN_W_DATASET.html' TARGET='index'>7</A><a name='33'>
   TYPE (domain)             :: grid<a name='34'>
   CHARACTER*(*) :: fname<a name='35'>
   CHARACTER*(*) :: sysdepinfo<a name='36'>
   INTEGER      , INTENT(INOUT) :: id , ierr<a name='37'>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='38'>
   LOGICAL , EXTERNAL :: wrf_dm_on_monitor<a name='39'>
   EXTERNAL outsub<a name='40'>
   CHARACTER*128             :: DataSet, sysdepinfo_tmp<a name='41'>
   LOGICAL                   :: anyway<a name='42'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1065"> ( 100 , 'calling wrf_open_for_write_begin in open_w_dataset' )<a name='43'>
   sysdepinfo_tmp = ' '<a name='44'>
   IF ( grid%id &lt; 10 ) THEN<a name='45'>
     write(sysdepinfo_tmp,'(a,i1)')TRIM(sysdepinfo)//',GRIDID=',grid%id<a name='46'>
   ELSE<a name='47'>
     write(sysdepinfo_tmp,'(a,i2)')TRIM(sysdepinfo)//',GRIDID=',grid%id<a name='48'>
   ENDIF<a name='49'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN'>wrf_open_for_write_begin</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_OPEN_FOR_WRITE_BEGIN_1"> ( fname ,     &amp;<a name='50'>
                                   grid ,      &amp;<a name='51'>
                                   sysdepinfo_tmp ,            &amp;<a name='52'>
                                   id ,                        &amp;<a name='53'>
                                   ierr )<a name='54'>
   IF ( ierr .LE. 0 ) THEN<a name='55'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1066"> ( 100 , 'calling outsub in open_w_dataset' )<a name='56'>
     CALL outsub( id , grid , config_flags , ierr )<a name='57'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1067"> ( 100 , 'back from outsub in open_w_dataset' )<a name='58'>
   ENDIF<a name='59'>
   IF ( ierr .LE. 0 ) THEN<a name='60'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1068"> ( 100 , 'calling wrf_open_for_write_commit in open_w_dataset' )<a name='61'>
     CALL <A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT'>wrf_open_for_write_commit</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_OPEN_FOR_WRITE_COMMIT_1"> ( id , ierr )<a name='62'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_W_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1069"> ( 100 , 'back from wrf_open_for_write_commit in open_w_dataset' )<a name='63'>
   ENDIF<a name='64'>
  END SUBROUTINE open_w_dataset<a name='65'>
<a name='66'>
<A NAME='OPEN_U_DATASET'><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='67'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>open_u_dataset</font> ( id , fname , grid , config_flags , insub , sysdepinfo, ierr ) <A href='../../call_to/OPEN_U_DATASET.html' TARGET='index'>1</A>,<A href='../../call_from/OPEN_U_DATASET.html' TARGET='index'>6</A><a name='68'>
   TYPE (domain)             :: grid<a name='69'>
   CHARACTER*(*) :: fname<a name='70'>
   CHARACTER*(*) :: sysdepinfo<a name='71'>
   INTEGER      , INTENT(INOUT) :: id , ierr<a name='72'>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='73'>
   LOGICAL , EXTERNAL :: wrf_dm_on_monitor<a name='74'>
   EXTERNAL insub<a name='75'>
   CHARACTER*128             :: DataSet<a name='76'>
   LOGICAL                   :: anyway<a name='77'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1070"> ( 100 , 'calling wrf_open_for_read_begin in open_u_dataset' )<a name='78'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN'>wrf_open_for_read_begin</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_OPEN_FOR_READ_BEGIN_1"> ( fname ,     &amp;<a name='79'>
                                   grid ,     &amp;<a name='80'>
                                   sysdepinfo ,                &amp;<a name='81'>
                                   id ,                        &amp;<a name='82'>
                                   ierr )<a name='83'>
   IF ( ierr .LE. 0 ) THEN<a name='84'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1071"> ( 100 , 'calling insub in open_u_dataset' )<a name='85'>
     CALL insub( id , grid , config_flags , ierr )<a name='86'>
   ENDIF<a name='87'>
   IF ( ierr .LE. 0 ) THEN<a name='88'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1072"> ( 100 , 'calling wrf_open_for_read_commit in open_u_dataset' )<a name='89'>
     CALL <A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT'>wrf_open_for_read_commit</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_OPEN_FOR_READ_COMMIT_1"> ( id , ierr )<a name='90'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_io_domain.F.html#OPEN_U_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1073"> ( 100 , 'back from wrf_open_for_read_commit in open_u_dataset' )<a name='91'>
   ENDIF<a name='92'>
  END SUBROUTINE open_u_dataset<a name='93'>
<a name='94'>
<A NAME='CLOSE_DATASET'><A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='95'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>close_dataset</font>( id , config_flags, sysdepinfo )  <A href='../../call_to/CLOSE_DATASET.html' TARGET='index'>60</A>,<A href='../../call_from/CLOSE_DATASET.html' TARGET='index'>1</A><a name='96'>
   IMPLICIT NONE<a name='97'>
   INTEGER id , ierr<a name='98'>
   LOGICAL , EXTERNAL :: wrf_dm_on_monitor<a name='99'>
   TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='100'>
   CHARACTER*(*) :: sysdepinfo<a name='101'>
   CHARACTER*128             :: DataSet<a name='102'>
   LOGICAL                   :: anyway<a name='103'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE'>wrf_ioclose</A><A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_IOCLOSE_3">( id , ierr )<a name='104'>
  END SUBROUTINE close_dataset<a name='105'>
<a name='106'>
<a name='107'>
<font color=#447700>! ------------  Output model input data sets<a name='108'></font>
<a name='109'>
#include "<A href='../../html_code/include/module_io_domain_defs.inc.html'>module_io_domain_defs.inc</A>"<A NAME="module_io_domain_defs.inc_1"><A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='110'>
<a name='111'>
<font color=#447700>!  ------------ Input model restart data sets<a name='112'></font>
<a name='113'>
<A NAME='INPUT_RESTART'><A href='../../html_code/share/module_io_domain.F.html#INPUT_RESTART' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='114'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>input_restart</font> ( fid , grid , config_flags , ierr ) <A href='../../call_to/INPUT_RESTART.html' TARGET='index'>5</A>,<A href='../../call_from/INPUT_RESTART.html' TARGET='index'>1</A><a name='115'>
    IMPLICIT NONE<a name='116'>
    TYPE(domain) :: grid<a name='117'>
    TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='118'>
    INTEGER, INTENT(IN) :: fid<a name='119'>
    INTEGER, INTENT(INOUT) :: ierr<a name='120'>
    IF ( config_flags%io_form_restart .GT. 0 ) THEN<a name='121'>
      CALL <A href='../../html_code/share/input_wrf.F.html#INPUT_WRF'>input_wrf</A><A href='../../html_code/share/module_io_domain.F.html#INPUT_RESTART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_WRF_1"> ( fid , grid , config_flags , restart_only , ierr )<a name='122'>
    ENDIF<a name='123'>
    RETURN<a name='124'>
  END SUBROUTINE input_restart<a name='125'>
<a name='126'>
<font color=#447700>!  ------------ Input model boundary data sets<a name='127'></font>
<a name='128'>
<A NAME='INPUT_BOUNDARY'><A href='../../html_code/share/module_io_domain.F.html#INPUT_BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='129'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>input_boundary</font> ( fid , grid , config_flags , ierr ) <A href='../../call_to/INPUT_BOUNDARY.html' TARGET='index'>2</A>,<A href='../../call_from/INPUT_BOUNDARY.html' TARGET='index'>1</A><a name='130'>
    IMPLICIT NONE<a name='131'>
    TYPE(domain) :: grid<a name='132'>
    TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='133'>
    INTEGER, INTENT(IN) :: fid<a name='134'>
    INTEGER, INTENT(INOUT) :: ierr<a name='135'>
    IF ( config_flags%io_form_boundary .GT. 0 ) THEN<a name='136'>
      CALL <A href='../../html_code/share/input_wrf.F.html#INPUT_WRF'>input_wrf</A><A href='../../html_code/share/module_io_domain.F.html#INPUT_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_WRF_2"> ( fid , grid , config_flags , boundary_only , ierr )<a name='137'>
    ENDIF<a name='138'>
    RETURN<a name='139'>
  END SUBROUTINE input_boundary<a name='140'>
<a name='141'>
<font color=#447700>!  ------------ Output model restart data sets<a name='142'></font>
<a name='143'>
<A NAME='OUTPUT_RESTART'><A href='../../html_code/share/module_io_domain.F.html#OUTPUT_RESTART' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='144'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>output_restart</font> ( fid , grid , config_flags , ierr ) <A href='../../call_to/OUTPUT_RESTART.html' TARGET='index'>2</A>,<A href='../../call_from/OUTPUT_RESTART.html' TARGET='index'>1</A><a name='145'>
    IMPLICIT NONE<a name='146'>
    TYPE(domain) :: grid<a name='147'>
    TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='148'>
    INTEGER, INTENT(IN) :: fid<a name='149'>
    INTEGER, INTENT(INOUT) :: ierr <a name='150'>
    IF ( config_flags%io_form_restart .GT. 0 ) THEN<a name='151'>
      CALL <A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF'>output_wrf</A><A href='../../html_code/share/module_io_domain.F.html#OUTPUT_RESTART' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_WRF_1"> ( fid , grid , config_flags , restart_only , ierr )<a name='152'>
    ENDIF<a name='153'>
    RETURN<a name='154'>
  END SUBROUTINE output_restart<a name='155'>
<a name='156'>
<font color=#447700>!  ------------ Output model boundary data sets<a name='157'></font>
<a name='158'>
<A NAME='OUTPUT_BOUNDARY'><A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='159'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>output_boundary</font> ( fid , grid , config_flags , ierr ) <A href='../../call_to/OUTPUT_BOUNDARY.html' TARGET='index'>6</A>,<A href='../../call_from/OUTPUT_BOUNDARY.html' TARGET='index'>1</A><a name='160'>
    IMPLICIT NONE<a name='161'>
    TYPE(domain) :: grid<a name='162'>
    TYPE(grid_config_rec_type),  INTENT(IN   )    :: config_flags<a name='163'>
    INTEGER, INTENT(IN) :: fid <a name='164'>
    INTEGER, INTENT(INOUT) :: ierr<a name='165'>
    IF ( config_flags%io_form_boundary .GT. 0 ) THEN<a name='166'>
      CALL <A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF'>output_wrf</A><A href='../../html_code/share/module_io_domain.F.html#OUTPUT_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_WRF_2"> ( fid , grid , config_flags , boundary_only , ierr )<a name='167'>
    ENDIF<a name='168'>
    RETURN<a name='169'>
  END SUBROUTINE output_boundary<a name='170'>
<a name='171'>
END MODULE module_io_domain<a name='172'>
<a name='173'>
<font color=#447700>! move outside module so callable without USE of module<a name='174'></font>
<A NAME='CONSTRUCT_FILENAME1'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='175'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename1</font>( result , basename , fld1 , len1 ) <A href='../../call_to/CONSTRUCT_FILENAME1.html' TARGET='index'>25</A>,<A href='../../call_from/CONSTRUCT_FILENAME1.html' TARGET='index'>2</A><a name='176'>
  IMPLICIT NONE<a name='177'>
  CHARACTER*(*) :: result<a name='178'>
  CHARACTER*(*) :: basename<a name='179'>
  INTEGER , INTENT(IN) :: fld1 , len1<a name='180'>
  CHARACTER*64         :: t1, zeros<a name='181'>
  <a name='182'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_1"> ( t1 , fld1 , len1 )<a name='183'>
  result = TRIM(basename) // "_d" // TRIM(t1)<a name='184'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_1">(result)<a name='185'>
  RETURN<a name='186'>
END SUBROUTINE construct_filename1<a name='187'>
<a name='188'>
<A NAME='CONSTRUCT_FILENAME2'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='189'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename2</font>( result , basename , fld1 , len1 , date_char ) <A href='../../call_to/CONSTRUCT_FILENAME2.html' TARGET='index'>1</A>,<A href='../../call_from/CONSTRUCT_FILENAME2.html' TARGET='index'>2</A><a name='190'>
  IMPLICIT NONE<a name='191'>
  CHARACTER*(*) :: result<a name='192'>
  CHARACTER*(*) :: basename<a name='193'>
  CHARACTER*(*) :: date_char<a name='194'>
<a name='195'>
  INTEGER , INTENT(IN) :: fld1 , len1<a name='196'>
  CHARACTER*64         :: t1, zeros<a name='197'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_2"> ( t1 , fld1 , len1 )<a name='198'>
  result = TRIM(basename) // ".d" // TRIM(t1) // "." // TRIM(date_char)<a name='199'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_2">(result)<a name='200'>
  RETURN<a name='201'>
END SUBROUTINE construct_filename2<a name='202'>
<a name='203'>
<font color=#447700>! this version looks for &lt;date&gt; and &lt;domain&gt; in the basename and replaces with the arguments<a name='204'></font>
<a name='205'>
<A NAME='CONSTRUCT_FILENAME2A'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='206'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename2a</font>( result , basename , fld1 , len1 , date_char ) <A href='../../call_to/CONSTRUCT_FILENAME2A.html' TARGET='index'>30</A>,<A href='../../call_from/CONSTRUCT_FILENAME2A.html' TARGET='index'>2</A><a name='207'>
  IMPLICIT NONE<a name='208'>
  CHARACTER*(*) :: result<a name='209'>
  CHARACTER*(*) :: basename<a name='210'>
  CHARACTER*(*) :: date_char<a name='211'>
  INTEGER , INTENT(IN) :: fld1 , len1<a name='212'>
  CHARACTER*64         :: t1, zeros<a name='213'>
  INTEGER   i, j, l<a name='214'>
<a name='215'>
  result=basename<a name='216'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_3"> ( t1 , fld1 , len1 )<a name='217'>
<a name='218'>
<a name='219'>
<font color=#447700>! The string name length 12345678  including &lt; &gt; ----|<a name='220'></font>
<font color=#447700>!                        ||||||||                    |<a name='221'></font>
  i = index( result   , '&lt;domain&gt;' )       <font color=#447700>! is this |<a name='222'></font>
  DO WHILE ( i .GT. 0 )                    <font color=#447700>! value   |<a name='223'></font>
    l = len(trim(result))                  <font color=#447700>!        \/<a name='224'></font>
    result = result  (1:i-1) // TRIM(t1) // result(i+8:l)<a name='225'>
    i = index( result   , '&lt;domain&gt;' ) <a name='226'>
  END DO<a name='227'>
<a name='228'>
  i = index( result , '&lt;date&gt;' )<a name='229'>
  DO WHILE ( i .GT. 0 )<a name='230'>
    l = len(trim(result))<a name='231'>
    result = result(1:i-1) // TRIM(date_char) // result(i+6:l)<a name='232'>
    i = index( result , '&lt;date&gt;' )<a name='233'>
  END DO<a name='234'>
<a name='235'>
  i = index( result , '&lt;year&gt;' )<a name='236'>
  DO WHILE ( i .GT. 0 )<a name='237'>
    l = len(trim(result))<a name='238'>
    result = result(1:i-1) // TRIM(date_char( 1: 4)) // result(i+6:l)<a name='239'>
    i = index( result , '&lt;year&gt;' )<a name='240'>
  END DO<a name='241'>
<a name='242'>
  i = index( result , '&lt;month&gt;' )<a name='243'>
  DO WHILE ( i .GT. 0 )<a name='244'>
    l = len(trim(result))<a name='245'>
    result = result(1:i-1) // TRIM(date_char( 6: 7)) // result(i+7:l)<a name='246'>
    i = index( result , '&lt;month&gt;' )<a name='247'>
  END DO<a name='248'>
<a name='249'>
  i = index( result , '&lt;day&gt;' )<a name='250'>
  DO WHILE ( i .GT. 0 )<a name='251'>
    l = len(trim(result))<a name='252'>
    result = result(1:i-1) // TRIM(date_char( 9:10)) // result(i+5:l)<a name='253'>
    i = index( result , '&lt;day&gt;' )<a name='254'>
  END DO<a name='255'>
<a name='256'>
  i = index( result , '&lt;hour&gt;' )<a name='257'>
  DO WHILE ( i .GT. 0 )<a name='258'>
    l = len(trim(result))<a name='259'>
    result = result(1:i-1) // TRIM(date_char(12:13)) // result(i+6:l)<a name='260'>
    i = index( result , '&lt;hour&gt;' )<a name='261'>
  END DO<a name='262'>
<a name='263'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_3">(result)<a name='264'>
  RETURN<a name='265'>
END SUBROUTINE construct_filename2a<a name='266'>
<a name='267'>
<A NAME='CONSTRUCT_FILENAME'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='268'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename</font> ( result , basename , fld1 , len1 , fld2 , len2 ),<A href='../../call_from/CONSTRUCT_FILENAME.html' TARGET='index'>3</A><a name='269'>
  IMPLICIT NONE<a name='270'>
  CHARACTER*(*) :: result<a name='271'>
  CHARACTER*(*) :: basename<a name='272'>
  INTEGER , INTENT(IN) :: fld1 , len1 , fld2 , len2<a name='273'>
  CHARACTER*64         :: t1, t2, zeros<a name='274'>
  <a name='275'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_4"> ( t1 , fld1 , len1 )<a name='276'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_5"> ( t2 , fld2 , len2 )<a name='277'>
  result = TRIM(basename) // "_d" // TRIM(t1) // "_" // TRIM(t2)<a name='278'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_4">(result)<a name='279'>
  RETURN<a name='280'>
END SUBROUTINE construct_filename<a name='281'>
<a name='282'>
<A NAME='CONSTRUCT_FILENAME3'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME3' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='283'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename3</font> ( result , basename , fld1 , len1 , fld2 , len2, fld3, len3 ),<A href='../../call_from/CONSTRUCT_FILENAME3.html' TARGET='index'>4</A><a name='284'>
  IMPLICIT NONE<a name='285'>
  CHARACTER*(*) :: result<a name='286'>
  CHARACTER*(*) :: basename<a name='287'>
  INTEGER , INTENT(IN) :: fld1 , len1 , fld2 , len2, fld3, len3<a name='288'>
  CHARACTER*64         :: t1, t2, t3, zeros<a name='289'>
<a name='290'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_6"> ( t1 , fld1 , len1 )<a name='291'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_7"> ( t2 , fld2 , len2 )<a name='292'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_8"> ( t3 , fld3 , len3 )<a name='293'>
  result = TRIM(basename) // "_d" // TRIM(t1) // "_" // TRIM(t2) // "_" // TRIM(t3)<a name='294'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME3' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_5">(result)<a name='295'>
  RETURN<a name='296'>
END SUBROUTINE construct_filename3<a name='297'>
<a name='298'>
<A NAME='CONSTRUCT_FILENAME4'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='299'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename4</font>( result , basename , fld1 , len1 , date_char , io_form ),<A href='../../call_from/CONSTRUCT_FILENAME4.html' TARGET='index'>4</A><a name='300'>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_192"><a name='301'>
  IMPLICIT NONE<a name='302'>
  CHARACTER*(*) :: result<a name='303'>
  CHARACTER*(*) :: basename<a name='304'>
  CHARACTER*(*) :: date_char<a name='305'>
<a name='306'>
  INTEGER, EXTERNAL :: use_package<a name='307'>
  INTEGER , INTENT(IN) :: fld1 , len1 , io_form<a name='308'>
  CHARACTER*64         :: t1, zeros<a name='309'>
  CHARACTER*4          :: ext<a name='310'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_9"> ( t1 , fld1 , len1 )<a name='311'>
  IF      ( use_package(io_form) .EQ. IO_INTIO ) THEN<a name='312'>
     ext = '.int'<a name='313'>
  ELSE IF ( use_package(io_form) .EQ. IO_NETCDF ) THEN<a name='314'>
     ext = '.nc '<a name='315'>
  ELSE IF ( use_package(io_form) .EQ. IO_PNETCDF ) THEN<a name='316'>
    ext = '.nc '<a name='317'>
  ELSE IF ( use_package(io_form) .EQ. IO_PIO ) THEN<a name='318'>
    ext = '.nc '<a name='319'>
  ELSE IF ( use_package(io_form) .EQ. IO_GRIB1 ) THEN<a name='320'>
     ext = '.gb '<a name='321'>
  ELSE<a name='322'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1402"> ('improper io_form')<a name='323'>
  END IF<a name='324'>
  result = TRIM(basename) // ".d" // TRIM(t1) // "." // TRIM(date_char) // TRIM(ext)<a name='325'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_6">(result)<a name='326'>
  RETURN<a name='327'>
END SUBROUTINE construct_filename4<a name='328'>
<a name='329'>
<font color=#447700>! this version looks for &lt;date&gt; and &lt;domain&gt; in the basename and replaces with the arguments<a name='330'></font>
<a name='331'>
<A NAME='CONSTRUCT_FILENAME4A'><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='332'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>construct_filename4a</font>( result , basename , fld1 , len1 , date_char , io_form ) <A href='../../call_to/CONSTRUCT_FILENAME4A.html' TARGET='index'>8</A>,<A href='../../call_from/CONSTRUCT_FILENAME4A.html' TARGET='index'>4</A><a name='333'>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_193"><a name='334'>
  IMPLICIT NONE<a name='335'>
  CHARACTER*(*) :: result<a name='336'>
  CHARACTER*(*) :: basename<a name='337'>
  CHARACTER*(*) :: date_char<a name='338'>
<a name='339'>
  INTEGER, EXTERNAL :: use_package<a name='340'>
  INTEGER , INTENT(IN) :: fld1 , len1 , io_form<a name='341'>
  CHARACTER*64         :: t1, zeros<a name='342'>
  CHARACTER*4          :: ext<a name='343'>
  INTEGER   i, j, l<a name='344'>
  result=basename<a name='345'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_10"> ( t1 , fld1 , len1 )<a name='346'>
  IF      ( use_package(io_form) .EQ. IO_INTIO ) THEN<a name='347'>
     ext = '.int'<a name='348'>
  ELSE IF ( use_package(io_form) .EQ. IO_NETCDF ) THEN<a name='349'>
     ext = '.nc '<a name='350'>
  ELSE IF ( use_package(io_form) .EQ. IO_PNETCDF ) THEN<a name='351'>
    ext = '.nc '<a name='352'>
  ELSE IF ( use_package(io_form) .EQ. IO_PIO ) THEN<a name='353'>
    ext = '.nc '<a name='354'>
  ELSE IF ( use_package(io_form) .EQ. IO_GRIB1 ) THEN<a name='355'>
     ext = '.gb '<a name='356'>
  ELSE<a name='357'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1403"> ('improper io_form')<a name='358'>
  END IF<a name='359'>
  l = len(trim(basename))<a name='360'>
  result = basename(1:l) // TRIM(ext)<a name='361'>
<a name='362'>
<font color=#447700>! The string name length 12345678  including &lt; &gt;   ----|<a name='363'></font>
<font color=#447700>!                        ||||||||                      |<a name='364'></font>
  i = index( result   , '&lt;domain&gt;' )       <font color=#447700>!   is this |<a name='365'></font>
  DO WHILE ( i .GT. 0 )                    <font color=#447700>!   value   |<a name='366'></font>
    l = len(trim(result  ))                <font color=#447700>!          \/<a name='367'></font>
    result = result  (1:i-1) // TRIM(t1) // result  (i+8:l)<a name='368'>
    i = index( result   , '&lt;domain&gt;' )<a name='369'>
  END DO<a name='370'>
<a name='371'>
  i = index( result , '&lt;date&gt;' )<a name='372'>
  DO WHILE ( i .GT. 0 )<a name='373'>
    l = len(trim(result))<a name='374'>
    result = result(1:i-1) // TRIM(date_char) // result(i+6:l)<a name='375'>
    i = index( result , '&lt;date&gt;' )<a name='376'>
  END DO<a name='377'>
<a name='378'>
  i = index( result , '&lt;year&gt;' )<a name='379'>
  DO WHILE ( i .GT. 0 )<a name='380'>
    l = len(trim(result))<a name='381'>
    result = result(1:i-1) // TRIM(date_char( 1: 4)) // result(i+6:l)<a name='382'>
    i = index( result , '&lt;year&gt;' )<a name='383'>
  END DO<a name='384'>
<a name='385'>
  i = index( result , '&lt;month&gt;' )<a name='386'>
  DO WHILE ( i .GT. 0 )<a name='387'>
    l = len(trim(result))<a name='388'>
    result = result(1:i-1) // TRIM(date_char( 6: 7)) // result(i+7:l)<a name='389'>
    i = index( result , '&lt;month&gt;' )<a name='390'>
  END DO<a name='391'>
<a name='392'>
  i = index( result , '&lt;day&gt;' )<a name='393'>
  DO WHILE ( i .GT. 0 )<a name='394'>
    l = len(trim(result))<a name='395'>
    result = result(1:i-1) // TRIM(date_char( 9:10)) // result(i+5:l)<a name='396'>
    i = index( result , '&lt;day&gt;' )<a name='397'>
  END DO<a name='398'>
<a name='399'>
  i = index( result , '&lt;hour&gt;' )<a name='400'>
  DO WHILE ( i .GT. 0 )<a name='401'>
    l = len(trim(result))<a name='402'>
    result = result(1:i-1) // TRIM(date_char(12:13)) // result(i+6:l)<a name='403'>
    i = index( result , '&lt;hour&gt;' )<a name='404'>
  END DO<a name='405'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME4A' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_7">(result)<a name='406'>
<a name='407'>
  RETURN<a name='408'>
END SUBROUTINE construct_filename4a<a name='409'>
<a name='410'>
<A NAME='APPEND_TO_FILENAME'><A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='411'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>append_to_filename</font> ( result , basename , fld1 , len1 ) <A href='../../call_to/APPEND_TO_FILENAME.html' TARGET='index'>13</A>,<A href='../../call_from/APPEND_TO_FILENAME.html' TARGET='index'>2</A><a name='412'>
  IMPLICIT NONE<a name='413'>
  CHARACTER*(*) :: result<a name='414'>
  CHARACTER*(*) :: basename<a name='415'>
  INTEGER , INTENT(IN) :: fld1 , len1<a name='416'>
  CHARACTER*64         :: t1, zeros<a name='417'>
  <a name='418'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD'>zero_pad</A><A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZERO_PAD_11"> ( t1 , fld1 , len1 )<a name='419'>
  result = TRIM(basename) // "_" // TRIM(t1)<a name='420'>
  CALL <A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS'>maybe_remove_colons</A><A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAYBE_REMOVE_COLONS_8">(result)<a name='421'>
  RETURN<a name='422'>
END SUBROUTINE append_to_filename<a name='423'>
<a name='424'>
<A NAME='ZERO_PAD'><A href='../../html_code/share/module_io_domain.F.html#ZERO_PAD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='425'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>zero_pad</font> ( result , fld1 , len1 ) <A href='../../call_to/ZERO_PAD.html' TARGET='index'>11</A><a name='426'>
  IMPLICIT NONE<a name='427'>
  CHARACTER*(*) :: result<a name='428'>
  INTEGER , INTENT (IN)      :: fld1 , len1<a name='429'>
  INTEGER                    :: d , x<a name='430'>
  CHARACTER*64         :: t2, zeros<a name='431'>
  x = fld1 ; d = 0<a name='432'>
  DO WHILE ( x &gt; 0 )<a name='433'>
    x = x / 10<a name='434'>
    d = d + 1<a name='435'>
  END DO<a name='436'>
  write(t2,'(I9)')fld1<a name='437'>
  zeros = '0000000000000000000000000000000'<a name='438'>
  result = zeros(1:len1-d) // t2(9-d+1:9)<a name='439'>
  RETURN<a name='440'>
END SUBROUTINE zero_pad<a name='441'>
<a name='442'>
<A NAME='INIT_WRFIO'><A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='443'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_wrfio</font> <A href='../../call_to/INIT_WRFIO.html' TARGET='index'>9</A>,<A href='../../call_from/INIT_WRFIO.html' TARGET='index'>2</A><a name='444'>
   USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_13">, ONLY : wrf_ioinit<a name='445'>
   IMPLICIT NONE<a name='446'>
   INTEGER ierr<a name='447'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_IOINIT'>wrf_ioinit</A><A href='../../html_code/share/module_io_domain.F.html#INIT_WRFIO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_IOINIT_1">(ierr)<a name='448'>
END SUBROUTINE init_wrfio<a name='449'>
<a name='450'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='451'></font>
<font color=#447700>! This routine figures out the nearest previous time instant <a name='452'></font>
<font color=#447700>! that corresponds to a multiple of the input time interval.<a name='453'></font>
<font color=#447700>! Example use is to give the time instant that corresponds to <a name='454'></font>
<font color=#447700>! an I/O interval, even when the current time is a little bit<a name='455'></font>
<font color=#447700>! past that time when, for example, the number of model time<a name='456'></font>
<font color=#447700>! steps does not evenly divide the I/O interval. JM 20051013<a name='457'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='458'></font>
<font color=#447700>! <a name='459'></font>
<A NAME='ADJUST_IO_TIMESTR'><A href='../../html_code/share/module_io_domain.F.html#ADJUST_IO_TIMESTR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='460'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>adjust_io_timestr</font> ( TI, CT, ST, timestr ) <A href='../../call_to/ADJUST_IO_TIMESTR.html' TARGET='index'>4</A>,<A href='../../call_from/ADJUST_IO_TIMESTR.html' TARGET='index'>1</A><a name='461'>
   USE module_utility<a name='462'>
   IMPLICIT NONE<a name='463'>
<font color=#447700>! Args<a name='464'></font>
   TYPE(WRFU_Time), INTENT(IN)            :: ST,CT    <font color=#447700>! domain start and current time<a name='465'></font>
   TYPE(WRFU_TimeInterval), INTENT(IN)    :: TI       <font color=#447700>! interval<a name='466'></font>
   CHARACTER*(*), INTENT(INOUT)           :: timestr  <font color=#447700>! returned string<a name='467'></font>
<font color=#447700>! Local<a name='468'></font>
   TYPE(WRFU_Time)                        :: OT<a name='469'>
   TYPE(WRFU_TimeInterval)                :: IOI<a name='470'>
   INTEGER                                :: n<a name='471'>
<a name='472'>
   IOI = CT-ST                               <font color=#447700>! length of time since starting<a name='473'></font>
   n = WRFU_TimeIntervalDIVQuot( IOI , TI )  <font color=#447700>! number of whole time intervals<a name='474'></font>
   IOI = TI * n                              <font color=#447700>! amount of time since starting in whole time intervals<a name='475'></font>
   OT = ST + IOI                             <font color=#447700>! previous nearest time instant<a name='476'></font>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/module_io_domain.F.html#ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_15">( OT, timestr )           <font color=#447700>! generate string<a name='477'></font>
   RETURN<a name='478'>
END SUBROUTINE adjust_io_timestr<a name='479'>
<a name='480'>
<font color=#447700>! Modify the filename to remove things like ':' from the file name<a name='481'></font>
<font color=#447700>! unless it is a drive number. Convert to '_' instead.<a name='482'></font>
<a name='483'>
<A NAME='MAYBE_REMOVE_COLONS'><A href='../../html_code/share/module_io_domain.F.html#MAYBE_REMOVE_COLONS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='484'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>maybe_remove_colons</font>( FileName ) <A href='../../call_to/MAYBE_REMOVE_COLONS.html' TARGET='index'>8</A><a name='485'>
  CHARACTER*(*) FileName<a name='486'>
  CHARACTER c, d<a name='487'>
  INTEGER i, l<a name='488'>
  LOGICAL nocolons<a name='489'>
  l = LEN(TRIM(FileName))<a name='490'>
<font color=#447700>! do not change first two characters (naive way of dealing with<a name='491'></font>
<font color=#447700>! possiblity of drive name in a microsoft path<a name='492'></font>
  CALL nl_get_nocolons(1,nocolons)<a name='493'>
  IF ( nocolons ) THEN<a name='494'>
    DO i = 3, l<a name='495'>
      IF ( FileName(i:i) .EQ. ':' ) THEN<a name='496'>
        FileName(i:i) = '_'<a name='497'>
<font color=#447700>! Remove this modification to filename - dashes are OK<a name='498'></font>
<font color=#447700>!      ELSE IF ( FileName(i:i) .EQ. '-' ) THEN<a name='499'></font>
<font color=#447700>!        FileName(i:i) = '_'<a name='500'></font>
      ENDIF<a name='501'>
    ENDDO<a name='502'>
  ENDIF<a name='503'>
  RETURN<a name='504'>
END<a name='505'>
<a name='506'>
<a name='507'>
<a name='508'>
</pre></body></html>