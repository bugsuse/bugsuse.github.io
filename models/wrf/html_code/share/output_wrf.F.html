<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION:IO<a name='2'></font>
<font color=#447700>!  ---principal wrf output routine (called from routines in module_io_domain )<a name='3'></font>
<A NAME='OUTPUT_WRF'><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>output_wrf</font> ( fid , grid , config_flags, switch , ierr ) <A href='../../call_to/OUTPUT_WRF.html' TARGET='index'>2</A>,<A href='../../call_from/OUTPUT_WRF.html' TARGET='index'>49</A><a name='5'>
    USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_14"><a name='6'>
    USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_111"><a name='7'>
    USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_18"><a name='8'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_443"><a name='9'>
    USE <A href='../../html_code/frame/module_domain_type.F.html#MODULE_DOMAIN_TYPE'>module_domain_type</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_TYPE_13">, ONLY : fieldlist<a name='10'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_204"><a name='11'>
    USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_284"><a name='12'>
<font color=#447700>!    USE module_date_time<a name='13'></font>
    USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_120"><a name='14'>
    USE module_utility<a name='15'>
    IMPLICIT NONE<a name='16'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_1"><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='17'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_2"><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='18'>
    TYPE(domain) :: grid<a name='19'>
    TYPE(grid_config_rec_type),  INTENT(INOUT)    :: config_flags<a name='20'>
    INTEGER, INTENT(IN) :: fid, switch<a name='21'>
    INTEGER, INTENT(INOUT) :: ierr<a name='22'>
<a name='23'>
    <font color=#447700>! Local data<a name='24'></font>
    INTEGER ids , ide , jds , jde , kds , kde , &amp;<a name='25'>
            ims , ime , jms , jme , kms , kme , &amp;<a name='26'>
            ips , ipe , jps , jpe , kps , kpe<a name='27'>
<a name='28'>
    TYPE( fieldlist ), POINTER :: p<a name='29'>
<a name='30'>
    INTEGER newswitch, itrace<a name='31'>
<a name='32'>
    INTEGER , DIMENSION(3) :: domain_start , domain_end<a name='33'>
    INTEGER , DIMENSION(3) :: memory_start , memory_end<a name='34'>
    INTEGER , DIMENSION(3) :: patch_start , patch_end<a name='35'>
    INTEGER i,j<a name='36'>
    INTEGER julyr, julday, idt, iswater , islake, map_proj<a name='37'>
    INTEGER filestate<a name='38'>
    LOGICAL dryrun<a name='39'>
    REAL    gmt, cen_lat, cen_lon, bdyfrq , truelat1 , truelat2 , moad_cen_lat , stand_lon<a name='40'>
    INTEGER km_opt, diff_opt, damp_opt,  &amp;<a name='41'>
            mp_physics, ra_lw_physics, ra_sw_physics, sf_sfclay_physics, &amp;<a name='42'>
            sf_surface_physics, bl_pbl_physics, cu_physics, hypsometric_opt, sf_lake_physics, &amp;<a name='43'>
            use_theta_m, use_maxw_level, use_trop_level,hybrid_opt, gwd_opt<a name='44'>
    INTEGER swint_opt, aer_type,aer_aod550_opt,aer_angexp_opt,aer_ssa_opt,aer_asy_opt, aer_opt<a name='45'>
    REAL    aer_aod550_val,aer_angexp_val,aer_ssa_val,aer_asy_val,etac<a name='46'>
    REAL    khdif, kvdif, swrad_scat, dampcoef,radt,bldt,cudt<a name='47'>
    REAL    dt, adapt_dt_start, adapt_dt_min, adapt_dt_max<a name='48'>
    INTEGER sf_urban_physics, w_damping, smooth_option, feedback, surface_input_source, sst_update<a name='49'>
    INTEGER skebs_on, sppt_on, rand_perturb_on, nens,ISEED_SKEBS,ISEED_SPPT,ISEED_RAND_PERT<a name='50'>
    INTEGER skebs_vertstruc, sppt_vertstruc, rand_pert_vertstruc<a name='51'>
    INTEGER LMINFORC,LMAXFORC,KMINFORC,KMAXFORC,LMINFORCT,LMAXFORCT,KMINFORCT,KMAXFORCT<a name='52'>
    REAL    gridpt_stddev_rand_pert,stddev_cutoff_rand_pert,timescale_rand_pert<a name='53'>
    REAL    gridpt_stddev_sppt,stddev_cutoff_sppt,timescale_sppt<a name='54'>
    REAL    tot_backscat_psi,tot_backscat_t,REXPONENT_PSI,REXPONENT_T,ZTAU_PSI,ZTAU_T<a name='55'>
#if (EM_CORE == 1)<a name='56'>
    INTEGER grid_id , parent_id , i_parent_start , j_parent_start , parent_grid_ratio<a name='57'>
    INTEGER diff_6th_opt<a name='58'>
    REAL    diff_6th_factor<a name='59'>
    INTEGER grid_fdda, gfdda_interval_m, gfdda_end_h, if_ramping, &amp;<a name='60'>
            obs_nudge_opt, obs_nudge_wind, obs_nudge_temp, obs_nudge_mois, obs_nudge_pstr, obs_idynin, obs_ionf<a name='61'>
    INTEGER grid_sfdda, sgfdda_interval_m, sgfdda_end_h<a name='62'>
    REAL    fgdt, guv, gt, gq, gph, dtramp_min, &amp;<a name='63'>
            obs_coef_wind, obs_coef_temp, obs_coef_mois, obs_coef_pstr, obs_dtramp, fdda_end<a name='64'>
    REAL    guv_sfc, gt_sfc, gq_sfc, rinblw<a name='65'>
    INTEGER moist_adv_opt, scalar_adv_opt, tke_adv_opt<a name='66'>
    INTEGER save_topo_orig<a name='67'>
    INTEGER scalar_pblmix, tracer_pblmix, grav_settling, ysu_topdown_pblmix<a name='68'>
#endif<a name='69'>
    CHARACTER (len=19) simulation_start_date<a name='70'>
    CHARACTER (len=len_current_date) current_date_save<a name='71'>
    INTEGER simulation_start_year   , &amp;<a name='72'>
            simulation_start_month  , &amp;<a name='73'>
            simulation_start_day    , &amp;<a name='74'>
            simulation_start_hour   , &amp;<a name='75'>
            simulation_start_minute , &amp;<a name='76'>
            simulation_start_second<a name='77'>
    INTEGER rc<a name='78'>
    INTEGER :: io_form<a name='79'>
    LOGICAL, EXTERNAL :: multi_files<a name='80'>
    INTEGER, EXTERNAL :: use_package<a name='81'>
    INTEGER p_hr, p_min, p_sec, p_ms<a name='82'>
<a name='83'>
    CHARACTER*80  dname, memord<a name='84'>
    CHARACTER*256 message<a name='85'>
    CHARACTER*256  fname<a name='86'>
    CHARACTER*80  char_junk<a name='87'>
    CHARACTER(LEN=256) :: MMINLU<a name='88'>
    INTEGER    ibuf(1)<a name='89'>
    REAL       rbuf(1)<a name='90'>
    TYPE(WRFU_TimeInterval) :: bdy_increment<a name='91'>
    TYPE(WRFU_Time)         :: next_time, currentTime, startTime<a name='92'>
    CHARACTER*40            :: next_datestr<a name='93'>
    INTEGER :: start_year , start_month , start_day , start_hour , start_minute , start_second<a name='94'>
    LOGICAL :: adjust<a name='95'>
<a name='96'>
    TYPE(WRFU_Time) :: ringTime, stopTime, curtime<a name='97'>
    TYPE(WRFU_TimeInterval) :: interval, tmpinterval<a name='98'>
    CHARACTER*80 alarmname, timestring, debuggal<a name='99'>
    INTEGER seconds, seconds2, iring<a name='100'>
    INTEGER :: nio_tasks_per_group<a name='101'>
<a name='102'>
    LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='103'>
<a name='104'>
    WRITE(wrf_err_message,*)'output_wrf: begin, fid = ',fid<a name='105'>
    CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1121">( 300 , wrf_err_message )<a name='106'>
<a name='107'>
    CALL <A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS'>modify_io_masks</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODIFY_IO_MASKS_2"> ( grid%id )   <font color=#447700>! this adjusts the I/O masks according to the users run-time specs, if any<a name='108'></font>
<a name='109'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME'>wrf_inquire_filename</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_INQUIRE_FILENAME_2"> ( fid , fname , filestate , ierr )<a name='110'>
    IF ( ierr /= 0 ) THEN<a name='111'>
      WRITE(wrf_err_message,*)'module_io_wrf: output_wrf: wrf_inquire_filename Status = ',ierr<a name='112'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1479">( wrf_err_message )<a name='113'>
    ENDIF<a name='114'>
<a name='115'>
    WRITE(wrf_err_message,*)'output_wrf: fid,filestate = ',fid,filestate<a name='116'>
    CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1122">( 300 , wrf_err_message )<a name='117'>
<a name='118'>
    <font color=#447700>! io_form is used to determine if multi-file I/O is enabled and to<a name='119'></font>
    <font color=#447700>! control writing of format-specific time-independent metadata<a name='120'></font>
    io_form = <A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_STREAM'>io_form_for_stream</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IO_FORM_FOR_STREAM_1">( switch ) <a name='121'>
<a name='122'>
    dryrun       = ( filestate .EQ. WRF_FILE_OPENED_NOT_COMMITTED )<a name='123'>
<a name='124'>
    WRITE(wrf_err_message,*)'output_wrf: dryrun = ',dryrun<a name='125'>
    CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1123">( 300 , wrf_err_message )<a name='126'>
<a name='127'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_119"> (  grid ,                        &amp;<a name='128'>
                              ids, ide, jds, jde, kds, kde,    &amp;<a name='129'>
                              ims, ime, jms, jme, kms, kme,    &amp;<a name='130'>
                              ips, ipe, jps, jpe, kps, kpe    )<a name='131'>
<a name='132'>
    call nl_get_diff_opt           ( grid%id , diff_opt           )<a name='133'>
    call nl_get_km_opt             ( grid%id,  km_opt             )<a name='134'>
    call nl_get_damp_opt           ( 1, damp_opt                  )<a name='135'>
    call nl_get_dampcoef           ( grid%id,  dampcoef           )<a name='136'>
    call nl_get_khdif              ( grid%id,  khdif              )<a name='137'>
    call nl_get_kvdif              ( grid%id,  kvdif              )<a name='138'>
    call nl_get_mp_physics         ( grid%id,  mp_physics         )<a name='139'>
    call nl_get_ra_lw_physics      ( grid%id,  ra_lw_physics      )<a name='140'>
    call nl_get_ra_sw_physics      ( grid%id,  ra_sw_physics      )<a name='141'>
    call nl_get_sf_sfclay_physics  ( grid%id,  sf_sfclay_physics  )<a name='142'>
    call nl_get_sf_surface_physics ( grid%id,  sf_surface_physics )<a name='143'>
    call nl_get_bl_pbl_physics     ( grid%id,  bl_pbl_physics     )<a name='144'>
    call nl_get_cu_physics         ( grid%id,  cu_physics         )<a name='145'>
    call nl_get_radt               ( grid%id,  radt               )<a name='146'>
    call nl_get_bldt               ( grid%id,  bldt               )<a name='147'>
    call nl_get_cudt               ( grid%id,  cudt               )<a name='148'>
    call nl_get_aer_opt            ( grid%id,  aer_opt            )<a name='149'>
    call nl_get_swint_opt          ( grid%id,  swint_opt          )<a name='150'>
    call nl_get_aer_type           ( grid%id,  aer_type           )<a name='151'>
    call nl_get_aer_aod550_opt     ( grid%id,  aer_aod550_opt     )<a name='152'>
    call nl_get_aer_angexp_opt     ( grid%id,  aer_angexp_opt     )<a name='153'>
    call nl_get_aer_ssa_opt        ( grid%id,  aer_ssa_opt        )<a name='154'>
    call nl_get_aer_asy_opt        ( grid%id,  aer_asy_opt        )<a name='155'>
    call nl_get_aer_aod550_val     ( grid%id,  aer_aod550_val     )<a name='156'>
    call nl_get_aer_angexp_val     ( grid%id,  aer_angexp_val     )<a name='157'>
    call nl_get_aer_ssa_val        ( grid%id,  aer_ssa_val        )<a name='158'>
    call nl_get_aer_asy_val        ( grid%id,  aer_asy_val        )<a name='159'>
    call nl_get_sf_lake_physics    ( grid%id,  sf_lake_physics    )<a name='160'>
<a name='161'>
#if (EM_CORE == 1)<a name='162'>
    dt = grid%dt<a name='163'>
    adapt_dt_min = grid%min_time_step<a name='164'>
    adapt_dt_max = grid%max_time_step<a name='165'>
    adapt_dt_start = grid%starting_time_step<a name='166'>
    call nl_get_gwd_opt            ( grid%id,  gwd_opt            )<a name='167'>
#endif<a name='168'>
<a name='169'>
<font color=#447700>! add nml variables in 2.2<a name='170'></font>
    call nl_get_surface_input_source ( 1      ,  surface_input_source )<a name='171'>
    call nl_get_sst_update           ( 1      ,  sst_update           )<a name='172'>
    call nl_get_feedback             ( 1      ,  feedback             )<a name='173'>
    call nl_get_smooth_option        ( 1      ,  smooth_option        )<a name='174'>
    call nl_get_swrad_scat           ( 1      ,  swrad_scat           )<a name='175'>
    call nl_get_sf_urban_physics     ( 1      ,  sf_urban_physics     )<a name='176'>
    call nl_get_w_damping            ( 1      ,  w_damping            )<a name='177'>
<a name='178'>
#if (EM_CORE == 1)<a name='179'>
    call nl_get_hypsometric_opt    ( 1, hypsometric_opt           )<a name='180'>
    call nl_get_use_theta_m        ( 1, use_theta_m               )<a name='181'>
    call nl_get_use_maxw_level     ( 1, use_maxw_level            )<a name='182'>
    call nl_get_use_trop_level     ( 1, use_trop_level            )<a name='183'>
    CALL nl_get_moist_adv_opt  ( grid%id , moist_adv_opt )<a name='184'>
    CALL nl_get_scalar_adv_opt ( grid%id , scalar_adv_opt )<a name='185'>
    CALL nl_get_tke_adv_opt    ( grid%id , tke_adv_opt )<a name='186'>
    CALL nl_get_diff_6th_opt  ( grid%id , diff_6th_opt )<a name='187'>
    CALL nl_get_diff_6th_factor ( grid%id , diff_6th_factor )<a name='188'>
    CALL nl_get_grid_fdda  ( grid%id , grid_fdda )<a name='189'>
    CALL nl_get_auxinput10_end_h( grid%id , gfdda_end_h )<a name='190'>
    CALL nl_get_auxinput10_interval_m ( grid%id , gfdda_interval_m )<a name='191'>
    CALL nl_get_grid_sfdda  ( grid%id , grid_sfdda )<a name='192'>
    CALL nl_get_auxinput9_end_h( grid%id , sgfdda_end_h )<a name='193'>
    CALL nl_get_auxinput9_interval_m ( grid%id , sgfdda_interval_m )<a name='194'>
    CALL nl_get_scalar_pblmix  ( grid%id , scalar_pblmix )<a name='195'>
    CALL nl_get_tracer_pblmix  ( grid%id , tracer_pblmix )<a name='196'>
    CALL nl_get_ysu_topdown_pblmix  ( grid%id , ysu_topdown_pblmix )<a name='197'>
    CALL nl_get_grav_settling  ( grid%id , grav_settling )<a name='198'>
<a name='199'>
#if ( HYBRID_COORD==1 )<a name='200'>
    CALL nl_get_hybrid_opt ( 1       , hybrid_opt )<a name='201'>
    CALL nl_get_etac       ( 1       , etac )<a name='202'>
    IF ( hybrid_opt .EQ. 0 ) THEN<a name='203'>
       etac = 0.<a name='204'>
    END IF<a name='205'>
#endif<a name='206'>
<a name='207'>
    IF ( grid_fdda == 1 ) THEN<a name='208'>
    CALL nl_get_fgdt       ( grid%id , fgdt )<a name='209'>
    CALL nl_get_guv        ( grid%id , guv )<a name='210'>
    CALL nl_get_gt         ( grid%id , gt )<a name='211'>
    CALL nl_get_gq         ( grid%id , gq )<a name='212'>
    CALL nl_get_if_ramping ( 1       , if_ramping )<a name='213'>
    CALL nl_get_dtramp_min ( 1       , dtramp_min )<a name='214'>
    ENDIF<a name='215'>
<a name='216'>
    IF ( grid_fdda == 2 ) THEN<a name='217'>
    CALL nl_get_fgdt       ( grid%id , fgdt )<a name='218'>
    CALL nl_get_guv        ( grid%id , guv )<a name='219'>
    CALL nl_get_gt         ( grid%id , gt )<a name='220'>
    CALL nl_get_gph        ( grid%id , gph )<a name='221'>
    CALL nl_get_if_ramping ( 1       , if_ramping )<a name='222'>
    CALL nl_get_dtramp_min ( 1       , dtramp_min )<a name='223'>
    ENDIF<a name='224'>
<a name='225'>
    IF ( grid_sfdda &gt;= 1 ) THEN<a name='226'>
    CALL nl_get_guv_sfc      ( grid%id , guv_sfc )<a name='227'>
    CALL nl_get_gt_sfc       ( grid%id , gt_sfc )<a name='228'>
    CALL nl_get_gq_sfc       ( grid%id , gq_sfc )<a name='229'>
    CALL nl_get_rinblw       ( grid%id , rinblw )<a name='230'>
    ENDIF<a name='231'>
<a name='232'>
    CALL nl_get_obs_nudge_opt  ( grid%id , obs_nudge_opt )<a name='233'>
    IF ( obs_nudge_opt == 1 ) THEN<a name='234'>
    CALL nl_get_fdda_end       ( grid%id , fdda_end )<a name='235'>
    CALL nl_get_obs_nudge_wind ( grid%id , obs_nudge_wind )<a name='236'>
    CALL nl_get_obs_coef_wind  ( grid%id , obs_coef_wind )<a name='237'>
    CALL nl_get_obs_nudge_temp ( grid%id , obs_nudge_temp )<a name='238'>
    CALL nl_get_obs_coef_temp  ( grid%id , obs_coef_temp )<a name='239'>
    CALL nl_get_obs_nudge_mois ( grid%id , obs_nudge_mois )<a name='240'>
    CALL nl_get_obs_coef_mois  ( grid%id , obs_coef_mois )<a name='241'>
    CALL nl_get_obs_nudge_pstr ( grid%id , obs_nudge_pstr )<a name='242'>
    CALL nl_get_obs_coef_pstr  ( grid%id , obs_coef_pstr )<a name='243'>
    CALL nl_get_obs_ionf       ( 1       , obs_ionf )<a name='244'>
    CALL nl_get_obs_idynin     ( 1       , obs_idynin )<a name='245'>
    CALL nl_get_obs_dtramp     ( 1       , obs_dtramp )<a name='246'>
    ENDIF<a name='247'>
<a name='248'>
#if ( DA_CORE <font color=#447700>!= 1)<a name='249'></font>
    CALL nl_get_skebs_on            ( grid%id, skebs_on            )<a name='250'>
    CALL nl_get_sppt_on             ( grid%id, sppt_on             )<a name='251'>
    CALL nl_get_rand_perturb_on     ( grid%id, rand_perturb_on     )<a name='252'>
    CALL nl_get_skebs_vertstruc     ( grid%id, skebs_vertstruc     )<a name='253'>
    CALL nl_get_tot_backscat_psi    ( grid%id, tot_backscat_psi    )<a name='254'>
    CALL nl_get_tot_backscat_t      ( grid%id, tot_backscat_t      )<a name='255'>
    CALL nl_get_REXPONENT_PSI       ( grid%id, REXPONENT_PSI       )<a name='256'>
    CALL nl_get_REXPONENT_T         ( grid%id, REXPONENT_T         )<a name='257'>
    CALL nl_get_ZTAU_T              ( grid%id, ZTAU_T              )<a name='258'>
    CALL nl_get_ZTAU_PSI            ( grid%id, ZTAU_PSI            )<a name='259'>
    CALL nl_get_LMINFORC            ( grid%id, LMINFORC            )<a name='260'>
    CALL nl_get_LMAXFORC            ( grid%id, LMAXFORC            )<a name='261'>
    CALL nl_get_KMINFORC            ( grid%id, KMINFORC            )<a name='262'>
    CALL nl_get_KMAXFORC            ( grid%id, KMAXFORC            )<a name='263'>
    CALL nl_get_LMINFORCT           ( grid%id, LMINFORCT           )<a name='264'>
    CALL nl_get_LMAXFORCT           ( grid%id, LMAXFORCT           )<a name='265'>
    CALL nl_get_KMINFORCT           ( grid%id, KMINFORCT           )<a name='266'>
    CALL nl_get_KMAXFORCT           ( grid%id, KMAXFORCT           )<a name='267'>
    CALL nl_get_ISEED_SKEBS         ( grid%id, ISEED_SKEBS         )<a name='268'>
    CALL nl_get_ISEED_SPPT          ( grid%id, ISEED_SPPT          )<a name='269'>
    CALL nl_get_ISEED_RAND_PERT     ( grid%id, ISEED_RAND_PERT     )<a name='270'>
    CALL nl_get_nens                ( grid%id, nens                )<a name='271'>
    CALL nl_get_sppt_vertstruc      ( grid%id, sppt_vertstruc      )<a name='272'>
    CALL nl_get_rand_pert_vertstruc ( grid%id, rand_pert_vertstruc )<a name='273'>
    CALL nl_get_gridpt_stddev_sppt  ( grid%id, gridpt_stddev_sppt  )<a name='274'>
    CALL nl_get_stddev_cutoff_sppt  ( grid%id, stddev_cutoff_sppt  )<a name='275'>
    CALL nl_get_timescale_sppt      ( grid%id, timescale_sppt  )<a name='276'>
    CALL nl_get_gridpt_stddev_rand_pert  ( grid%id, gridpt_stddev_rand_pert  )<a name='277'>
    CALL nl_get_stddev_cutoff_rand_pert  ( grid%id, stddev_cutoff_rand_pert  )<a name='278'>
    CALL nl_get_timescale_rand_pert ( grid%id, timescale_rand_pert  )<a name='279'>
#endif<a name='280'>
#endif<a name='281'>
<a name='282'>
<font color=#447700>! julday and gmt can be set in namelist_03 for ideal.exe run<a name='283'></font>
    CALL nl_get_gmt (grid%id, gmt)<a name='284'>
    CALL nl_get_julyr (grid%id, julyr)<a name='285'>
    CALL nl_get_julday (grid%id, julday)<a name='286'>
    CALL nl_get_mminlu ( grid%id, mminlu )<a name='287'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1124">(300,"OUTPUT_WRF:  mminlu = " // mminlu )<a name='288'>
    CALL nl_get_iswater (grid%id, iswater )<a name='289'>
    CALL nl_get_islake (grid%id, islake )<a name='290'>
    CALL nl_get_cen_lat ( grid%id , cen_lat )<a name='291'>
    CALL nl_get_cen_lon ( grid%id , cen_lon )<a name='292'>
    CALL nl_get_truelat1 ( grid%id , truelat1 )<a name='293'>
    CALL nl_get_truelat2 ( grid%id , truelat2 )<a name='294'>
    CALL nl_get_moad_cen_lat ( grid%id , moad_cen_lat )<a name='295'>
    CALL nl_get_stand_lon ( grid%id , stand_lon )<a name='296'>
    CALL nl_get_map_proj ( grid%id , map_proj )<a name='297'>
<a name='298'>
#if (EM_CORE == 1)<a name='299'>
    CALL nl_get_parent_id ( grid%id , parent_id )<a name='300'>
    CALL nl_get_i_parent_start ( grid%id , i_parent_start )<a name='301'>
    CALL nl_get_j_parent_start ( grid%id , j_parent_start )<a name='302'>
    CALL nl_get_parent_grid_ratio ( grid%id , parent_grid_ratio )<a name='303'>
#endif<a name='304'>
<a name='305'>
    CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_23">(150, grid, &amp;<a name='306'>
           'DEBUG output_wrf():  before call to domain_clock_get,')<a name='307'>
    CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_81">( grid, current_time=currentTime, &amp;<a name='308'>
                                 start_time=startTime,     &amp;<a name='309'>
                                 current_timestr=current_date )<a name='310'>
<a name='311'>
    IF (switch .EQ. history_only) THEN<a name='312'>
      CALL nl_get_adjust_output_times( grid%id, adjust )<a name='313'>
      IF ( adjust ) THEN<a name='314'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#ADJUST_IO_TIMESTR'>adjust_io_timestr</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADJUST_IO_TIMESTR_4">( grid%io_intervals( history_alarm ), currentTime, startTime, timestring )<a name='315'>
        current_date_save = current_date<a name='316'>
        current_date = timestring<a name='317'>
      ENDIF<a name='318'>
    ENDIF<a name='319'>
<a name='320'>
    WRITE ( wrf_err_message , * ) 'output_wrf: begin, current_date=',current_date<a name='321'>
    CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1125"> ( 300 , wrf_err_message )<a name='322'>
<a name='323'>
    WRITE( message , * ) "OUTPUT FROM " , TRIM(program_name)<a name='324'>
    CALL wrf_put_dom_ti_char ( fid , 'TITLE' , TRIM(message) , ierr )<a name='325'>
    <font color=#447700>! added grib-specific metadata:  Todd Hutchinson 8/21/2005<a name='326'></font>
    IF ( ( use_package( io_form ) == IO_GRIB1 ) .OR. &amp;<a name='327'>
         ( use_package( io_form ) == IO_GRIB2 ) ) THEN<a name='328'>
      CALL wrf_put_dom_ti_char ( fid, 'PROGRAM_NAME', TRIM(program_name) , ierr )<a name='329'>
    ENDIF<a name='330'>
    CALL nl_get_start_year(grid%id,start_year)<a name='331'>
    CALL nl_get_start_month(grid%id,start_month)<a name='332'>
    CALL nl_get_start_day(grid%id,start_day)<a name='333'>
    CALL nl_get_start_hour(grid%id,start_hour)<a name='334'>
    CALL nl_get_start_minute(grid%id,start_minute)<a name='335'>
    CALL nl_get_start_second(grid%id,start_second)<a name='336'>
#ifdef PLANET<a name='337'>
    WRITE ( start_date , FMT = '(I4.4,"-",I5.5,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='338'>
            start_year,start_day,start_hour,start_minute,start_second<a name='339'>
#else<a name='340'>
    WRITE ( start_date , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='341'>
            start_year,start_month,start_day,start_hour,start_minute,start_second<a name='342'>
#endif<a name='343'>
    CALL wrf_put_dom_ti_char ( fid , 'START_DATE', TRIM(start_date) , ierr )<a name='344'>
    IF ( switch .EQ. input_only) THEN<a name='345'>
       CALL wrf_put_dom_ti_char ( fid , 'SIMULATION_START_DATE', TRIM(start_date) , ierr )<a name='346'>
#if ( HWRF == 1 )<a name='347'>
    ELSE<a name='348'>
#else<a name='349'>
    ELSE IF ( ( switch .EQ. restart_only ) .OR. ( switch .EQ. history_only ) ) THEN<a name='350'>
#endif<a name='351'>
       CALL nl_get_simulation_start_year   ( 1, simulation_start_year   )<a name='352'>
       CALL nl_get_simulation_start_month  ( 1, simulation_start_month  )<a name='353'>
       CALL nl_get_simulation_start_day    ( 1, simulation_start_day    )<a name='354'>
       CALL nl_get_simulation_start_hour   ( 1, simulation_start_hour   )<a name='355'>
       CALL nl_get_simulation_start_minute ( 1, simulation_start_minute )<a name='356'>
       CALL nl_get_simulation_start_second ( 1, simulation_start_second )<a name='357'>
#ifdef PLANET<a name='358'>
       WRITE ( simulation_start_date , FMT = '(I4.4,"-",I5.5,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='359'>
               simulation_start_year,simulation_start_day,&amp;<a name='360'>
               simulation_start_hour,simulation_start_minute,simulation_start_second<a name='361'>
#else<a name='362'>
       WRITE ( simulation_start_date , FMT = '(I4.4,"-",I2.2,"-",I2.2,"_",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='363'>
               simulation_start_year,simulation_start_month,simulation_start_day,&amp;<a name='364'>
               simulation_start_hour,simulation_start_minute,simulation_start_second<a name='365'>
#endif<a name='366'>
       CALL wrf_put_dom_ti_char ( fid , 'SIMULATION_START_DATE', TRIM(simulation_start_date) , ierr )<a name='367'>
    END IF<a name='368'>
<a name='369'>
    IF ( switch .EQ. restart_only ) THEN<a name='370'>
       <font color=#447700>! add some delicious alarm metadata to the restart files<a name='371'></font>
       ibuf(1) = MAX_WRF_ALARMS<a name='372'>
       CALL wrf_put_dom_ti_integer( fid, 'MAX_WRF_ALARMS', ibuf, 1, ierr )<a name='373'>
       curtime = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_CURRENT_TIME'>domain_get_current_time</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_CURRENT_TIME_3">( grid )<a name='374'>
       DO i = 1, MAX_WRF_ALARMS<a name='375'>
         IF ( grid%alarms_created(i)  ) THEN<a name='376'>
           IF ( i .LT. 10 ) THEN<a name='377'>
             write(alarmname,'("WRF_ALARM_ISRINGING_0",i1)')i<a name='378'>
           ELSE<a name='379'>
             write(alarmname,'("WRF_ALARM_ISRINGING_",i2)')i<a name='380'>
           ENDIF<a name='381'>
           IF ( WRFU_AlarmIsRinging( grid%alarms( i ), rc=rc ) ) THEN<a name='382'>
             iring = 1<a name='383'>
           ELSE<a name='384'>
             iring = 0<a name='385'>
           ENDIF<a name='386'>
           CALL wrf_put_dom_ti_integer( fid, TRIM(alarmname), iring, 1, ierr )<a name='387'>
<a name='388'>
           CALL WRFU_AlarmGet( grid%alarms(i),PrevRingTime=ringTime,RingInterval=interval,rc=rc)<a name='389'>
<a name='390'>
#if 0<a name='391'>
<font color=#447700>!different, perhaps simpler way to do this, JM 20100319<a name='392'></font>
           IF ( i .LT. 10 ) THEN<a name='393'>
             write(alarmname,'("WRF_ALARM_PREVRINGTIME_0",i1)')i<a name='394'>
           ELSE<a name='395'>
             write(alarmname,'("WRF_ALARM_PREVRINGTIME_",i2)')i<a name='396'>
           ENDIF<a name='397'>
           CALL WRFU_TimeGet( ringTime, timeString=prevringtime )<a name='398'>
           CALL wrf_put_dom_ti_char( fid, TRIM(alarmname), TRIM(prevringtime), 1, ierr )<a name='399'>
#endif<a name='400'>
<a name='401'>
           <font color=#447700>! compute time to next ring as interval minus time since last ring<a name='402'></font>
           tmpinterval = curtime - ringTime<a name='403'>
<a name='404'>
           IF ( i .LT. 10 ) THEN<a name='405'>
             write(alarmname,'("WRF_ALARM_SECS_TIL_NEXT_RING_0",i1)')i<a name='406'>
           ELSE<a name='407'>
             write(alarmname,'("WRF_ALARM_SECS_TIL_NEXT_RING_",i2)')i<a name='408'>
           ENDIF<a name='409'>
<a name='410'>
#ifdef DM_PARALLEL<a name='411'>
           if(wrf_dm_on_monitor()) then<a name='412'>
#endif<a name='413'>
             CALL WRFU_TimeIntervalGet(interval,S=seconds)<a name='414'>
             CALL WRFU_TimeIntervalGet(tmpinterval,S=seconds2)<a name='415'>
#ifdef DM_PARALLEL<a name='416'>
           endif<a name='417'>
<a name='418'>
           call <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_INTEGER'>wrf_dm_bcast_integer</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_INTEGER_70">(seconds, 1)<a name='419'>
           call <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_INTEGER'>wrf_dm_bcast_integer</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_INTEGER_71">(seconds2, 1)<a name='420'>
#endif<a name='421'>
           IF ( seconds .GE. 1700000000 .OR. seconds .LE. -1700000000 ) THEN   <font color=#447700>! it is a forever value, do not change it<a name='422'></font>
             CALL wrf_put_dom_ti_integer( fid, TRIM(alarmname), seconds, 1, ierr )<a name='423'>
           ELSE<a name='424'>
             CALL wrf_put_dom_ti_integer( fid, TRIM(alarmname), seconds-seconds2, 1, ierr )<a name='425'>
           ENDIF<a name='426'>
#if 0<a name='427'>
if ( i .eq. history_alarm .or. i .eq. restart_alarm .or. i .eq. auxhist24_alarm) then<a name='428'>
if ( i .eq. history_alarm ) write(*,*)'----------------- info for history alarm ',i<a name='429'>
if ( i .eq. restart_alarm ) write(*,*)'----------------- info for restart alarm ',i<a name='430'>
if ( i .eq. auxhist24_alarm ) write(*,*)'----------------- info for auxhist24 alarm ',i<a name='431'>
CALL ESMF_TimeGet(curTime, TimeString=debuggal ) ; write(*,*)'curTime ',TRIM(debuggal)<a name='432'>
CALL ESMF_TimeGet(ringTime, TimeString=debuggal ) ; write(*,*)'ringTime ',TRIM(debuggal)<a name='433'>
CALL ESMF_TimeIntervalGet(tmpinterval, TimeString=debuggal ) ; write(*,*)'tmpinterval ',TRIM(debuggal)<a name='434'>
CALL ESMF_TimeIntervalGet(interval, TimeString=debuggal ) ; write(*,*)'interval ',TRIM(debuggal)<a name='435'>
write(*,*)'interval seconds ',seconds,' tmpinterval seconds ',seconds2,' seconds-seconds2 ',seconds-seconds2<a name='436'>
write(*,*)'----------------- '<a name='437'>
endif<a name='438'>
#endif<a name='439'>
<a name='440'>
         ENDIF<a name='441'>
       ENDDO<a name='442'>
    ENDIF<a name='443'>
<a name='444'>
    ibuf(1) = config_flags%e_we - config_flags%s_we + 1<a name='445'>
    CALL wrf_put_dom_ti_integer ( fid , 'WEST-EAST_GRID_DIMENSION' ,  ibuf , 1 , ierr )<a name='446'>
<a name='447'>
    ibuf(1) = config_flags%e_sn - config_flags%s_sn + 1<a name='448'>
    CALL wrf_put_dom_ti_integer ( fid , 'SOUTH-NORTH_GRID_DIMENSION' , ibuf , 1 , ierr )<a name='449'>
<a name='450'>
    IF ( program_name(1:5) .EQ. 'TC_EM' ) THEN<a name='451'>
       ibuf(1) = config_flags%num_metgrid_levels<a name='452'>
       CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_GRID_DIMENSION' , ibuf , 1 , ierr )<a name='453'>
    ELSE<a name='454'>
       ibuf(1) = config_flags%e_vert - config_flags%s_vert + 1<a name='455'>
       CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_GRID_DIMENSION' , ibuf , 1 , ierr )<a name='456'>
    END IF<a name='457'>
<a name='458'>
#if (EM_CORE == 1)<a name='459'>
    IF (grid%map_proj == 6) THEN<a name='460'>
       <font color=#447700>! Global ... dx determined automatically<a name='461'></font>
       <font color=#447700>! Don't use value from namelist ... used derived value instead<a name='462'></font>
       CALL wrf_put_dom_ti_real ( fid , 'DX' , grid%dx , 1 , ierr )<a name='463'>
       CALL wrf_put_dom_ti_real ( fid , 'DY' , grid%dy , 1 , ierr )<a name='464'>
    ELSE<a name='465'>
       CALL wrf_put_dom_ti_real ( fid , 'DX' , config_flags%dx , 1 , ierr )<a name='466'>
       CALL wrf_put_dom_ti_real ( fid , 'DY' , config_flags%dy , 1 , ierr )<a name='467'>
    END IF<a name='468'>
#endif<a name='469'>
<a name='470'>
#if (NMM_CORE == 1)<a name='471'>
    CALL wrf_put_dom_ti_real ( fid , 'WBD0' , grid%wbd0 , 1 , ierr )<a name='472'>
    CALL wrf_put_dom_ti_real ( fid , 'SBD0' , grid%sbd0 , 1 , ierr )<a name='473'>
#endif<a name='474'>
<a name='475'>
#if (EM_CORE == 1)<a name='476'>
<font color=#447700>!added the following for tc bogusing<a name='477'></font>
    if( ((config_flags%insert_bogus_storm) .or. (config_flags%remove_storm)) .and. &amp;<a name='478'>
        ( program_name(1:5) .EQ. 'TC_EM' ) ) then<a name='479'>
       print *,"we have confirmed that insert or remove is true"<a name='480'>
       ibuf(1) = 1<a name='481'>
       CALL wrf_put_dom_ti_integer ( fid , 'FLAG_METGRID' ,  ibuf , 1 , ierr )<a name='482'>
       if( grid%flag_snow .eq. 1) then<a name='483'>
           CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SNOW' ,  ibuf , 1 , ierr )<a name='484'>
       end if<a name='485'>
       if( grid%flag_mf_xy .eq. 1) then<a name='486'>
           CALL wrf_put_dom_ti_integer ( fid , 'FLAG_MF_XY' ,  ibuf , 1 , ierr )<a name='487'>
       end if   <a name='488'>
       if(grid%flag_psfc .eq. 1) then<a name='489'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_PSFC' ,  ibuf , 1 , ierr ) <a name='490'>
       end if    <a name='491'>
<a name='492'>
       if(grid%flag_slp .eq. 1) then<a name='493'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SLP' ,  ibuf , 1 , ierr ) <a name='494'>
       end if <a name='495'>
<a name='496'>
       if(grid%flag_sm000010 .eq. 1)then<a name='497'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SM000010' ,  ibuf , 1 , ierr ) <a name='498'>
       end if<a name='499'>
       if(grid%flag_sm010040 .eq. 1)then<a name='500'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SM010040' ,  ibuf , 1 , ierr ) <a name='501'>
       end if<a name='502'>
        if(grid%flag_sm040100 .eq. 1)then<a name='503'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SM040100' ,  ibuf , 1 , ierr ) <a name='504'>
       end if<a name='505'>
        if(grid%flag_sm100200 .eq. 1)then<a name='506'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SM100200' ,  ibuf , 1 , ierr ) <a name='507'>
       end if <a name='508'>
<a name='509'>
       if(grid%flag_st000010 .eq. 1)then<a name='510'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_ST000010' ,  ibuf , 1 , ierr ) <a name='511'>
       end if<a name='512'>
       if(grid%flag_st010040 .eq. 1)then<a name='513'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_ST010040' ,  ibuf , 1 , ierr ) <a name='514'>
       end if<a name='515'>
        if(grid%flag_st040100 .eq. 1)then<a name='516'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_ST040100' ,  ibuf , 1 , ierr ) <a name='517'>
       end if<a name='518'>
        if(grid%flag_st100200 .eq. 1)then<a name='519'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_ST100200' ,  ibuf , 1 , ierr ) <a name='520'>
       end if <a name='521'>
<a name='522'>
        if(grid%flag_soil_layers .eq. 1)then<a name='523'>
          CALL wrf_put_dom_ti_integer ( fid , 'FLAG_SOIL_LAYERS' ,  ibuf , 1 , ierr ) <a name='524'>
       end if <a name='525'>
<a name='526'>
       ibuf(1) = grid%num_metgrid_levels<a name='527'>
       CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_GRID_DIMENSION' , ibuf , 1 , ierr )<a name='528'>
<a name='529'>
       CALL wrf_put_dom_ti_integer ( fid , 'num_metgrid_levels' , ibuf , 1 , ierr )<a name='530'>
<a name='531'>
       print *,start_date<a name='532'>
       CALL wrf_put_dom_ti_char ( fid , 'SIMULATION_START_DATE', TRIM(start_date) , ierr )<a name='533'>
<a name='534'>
       WRITE( message , * ) "OUTPUT FROM TC BOGUS"<a name='535'>
       CALL wrf_put_dom_ti_char ( fid , 'TITLE' , TRIM(message) , ierr )<a name='536'>
    end if<a name='537'>
#endif<a name='538'>
<a name='539'>
#if ((EM_CORE == 1) &amp;&amp; (DA_CORE <font color=#447700>!= 1))<a name='540'></font>
    IF ( config_flags%p_lev_diags .NE. 0 ) THEN<a name='541'>
       IF (switch .EQ. auxhist23_only) THEN<a name='542'>
          CALL wrf_put_dom_ti_real( fid, 'P_LEV_MISSING' , config_flags%p_lev_missing, 1, ierr )<a name='543'>
       END IF<a name='544'>
    END IF<a name='545'>
<a name='546'>
    IF (switch .EQ. history_only) THEN<a name='547'>
       CALL    wrf_put_dom_ti_integer( fid, 'SKEBS_ON'           , config_flags%skebs_on           , 1, ierr )<a name='548'>
       IF ( config_flags%skebs_on .NE. 0 )  THEN<a name='549'>
          CALL wrf_put_dom_ti_real   ( fid, 'TOT_BACKSCAT_PSI'   , config_flags%tot_backscat_psi   , 1, ierr )<a name='550'>
          CALL wrf_put_dom_ti_real   ( fid, 'TOT_BACKSCAT_T'     , config_flags%tot_backscat_t     , 1, ierr )<a name='551'>
          CALL wrf_put_dom_ti_real   ( fid, 'REXPONENT_PSI'      , config_flags%REXPONENT_PSI      , 1, ierr )<a name='552'>
          CALL wrf_put_dom_ti_real   ( fid, 'REXPONENT_T'        , config_flags%REXPONENT_T        , 1, ierr )<a name='553'>
          CALL wrf_put_dom_ti_real   ( fid, 'ZTAU_PSI'           , config_flags%ZTAU_PSI           , 1, ierr )<a name='554'>
          CALL wrf_put_dom_ti_real   ( fid, 'ZTAU_T  '           , config_flags%ZTAU_T             , 1, ierr )<a name='555'>
          CALL wrf_put_dom_ti_integer( fid, 'LMINFORC'           , config_flags%LMINFORC           , 1, ierr )<a name='556'>
          CALL wrf_put_dom_ti_integer( fid, 'LMAXFORC'           , config_flags%LMAXFORC           , 1, ierr )<a name='557'>
          CALL wrf_put_dom_ti_integer( fid, 'KMINFORC'           , config_flags%KMINFORC           , 1, ierr )<a name='558'>
          CALL wrf_put_dom_ti_integer( fid, 'KMAXFORC'           , config_flags%KMAXFORC           , 1, ierr )<a name='559'>
          CALL wrf_put_dom_ti_integer( fid, 'LMINFORCT'          , config_flags%LMINFORCT          , 1, ierr )<a name='560'>
          CALL wrf_put_dom_ti_integer( fid, 'LMAXFORCT'          , config_flags%LMAXFORCT          , 1, ierr )<a name='561'>
          CALL wrf_put_dom_ti_integer( fid, 'KMINFORCT'          , config_flags%KMINFORCT          , 1, ierr )<a name='562'>
          CALL wrf_put_dom_ti_integer( fid, 'KMAXFORCT'          , config_flags%KMAXFORCT          , 1, ierr )<a name='563'>
          CALL wrf_put_dom_ti_integer( fid, 'SKEBS_VERTSTRUC'    , config_flags%skebs_vertstruc    , 1, ierr )<a name='564'>
          CALL wrf_put_dom_ti_integer( fid, 'NENS'               , config_flags%nens               , 1, ierr )<a name='565'>
          CALL wrf_put_dom_ti_integer( fid, 'ISEED_SKEBS'        , config_flags%ISEED_SKEBS        , 1, ierr )<a name='566'>
       END IF<a name='567'>
       IF ( config_flags%rand_perturb_on .NE. 0 ) THEN<a name='568'>
          CALL wrf_put_dom_ti_real   ( fid, 'GRIDPT_STDDEV_RAND_PERT', config_flags%gridpt_stddev_rand_pert, 1, ierr )<a name='569'>
          CALL wrf_put_dom_ti_real   ( fid, 'STDDEV_CUTOFF_RAND_PERT', config_flags%stddev_cutoff_rand_pert, 1, ierr )<a name='570'>
          CALL wrf_put_dom_ti_real   ( fid, 'LENGTHSCALE_RAND_PERT',   config_flags%lengthscale_rand_pert, 1, ierr )<a name='571'>
          CALL wrf_put_dom_ti_real   ( fid, 'TIMESCALE_RAND_PERT',     config_flags%timescale_rand_pert, 1, ierr )<a name='572'>
          CALL wrf_put_dom_ti_integer( fid, 'RAND_PERT_VERTSTRUC',     config_flags%rand_pert_vertstruc, 1, ierr )<a name='573'>
          CALL wrf_put_dom_ti_integer( fid, 'NENS'               ,     config_flags%nens               , 1, ierr )<a name='574'>
          CALL wrf_put_dom_ti_integer( fid, 'ISEED_RAND_PERT'    ,     config_flags%ISEED_RAND_PERT    , 1, ierr )<a name='575'>
       END IF<a name='576'>
       IF ( config_flags%sppt_on      .NE. 0 ) THEN<a name='577'>
          CALL wrf_put_dom_ti_real   ( fid, 'GRIDPT_STDDEV_SPPT', config_flags%gridpt_stddev_sppt, 1, ierr )<a name='578'>
          CALL wrf_put_dom_ti_real   ( fid, 'STDDEV_CUTOFF_SPPT', config_flags%stddev_cutoff_sppt, 1, ierr )<a name='579'>
          CALL wrf_put_dom_ti_real   ( fid, 'LENGTHSCALE_SPPT',   config_flags%lengthscale_sppt, 1, ierr )<a name='580'>
          CALL wrf_put_dom_ti_real   ( fid, 'TIMESCALE_SPPT',     config_flags%timescale_sppt, 1, ierr )<a name='581'>
          CALL wrf_put_dom_ti_integer( fid, 'SPPT_VERTSTRUC',     config_flags%sppt_vertstruc, 1, ierr )<a name='582'>
          CALL wrf_put_dom_ti_integer( fid, 'NENS'               ,config_flags%nens               , 1, ierr )<a name='583'>
          CALL wrf_put_dom_ti_integer( fid, 'ISEED_SPPT'         ,config_flags% ISEED_SPPT        , 1, ierr )<a name='584'>
       END IF<a name='585'>
     IF ( config_flags%perturb_bdy .NE. 0 ) THEN<a name='586'>
          CALL wrf_put_dom_ti_integer( fid, 'PERTURB_BDY',        config_flags%perturb_bdy, 1, ierr )<a name='587'>
     END IF<a name='588'>
     CALL wrf_put_dom_ti_integer( fid, 'SPEC_BDY_FINAL_MU',  config_flags%spec_bdy_final_mu, 1, ierr )<a name='589'>
     CALL wrf_put_dom_ti_integer( fid, 'USE_Q_DIABATIC',     config_flags%use_q_diabatic,    1, ierr )<a name='590'>
    END IF<a name='591'>
#endif<a name='592'>
<a name='593'>
<font color=#447700>! added by SYHA (09-19-2014)<a name='594'></font>
#if ((WRF_CHEM == 1) &amp;&amp;  (EM_CORE == 1))<a name='595'>
     IF ( config_flags%perturb_chem_bdy .NE. 0 ) THEN<a name='596'>
          CALL wrf_put_dom_ti_integer( fid, 'PERTURB_CHEM_BDY', config_flags%perturb_chem_bdy, 1, ierr )<a name='597'>
     END IF<a name='598'>
#endif<a name='599'>
<a name='600'>
<font color=#447700>! added this metadatum for H. Chuan, NCEP, 030417, JM<a name='601'></font>
#if (NMM_CORE == 1)<a name='602'>
          CALL wrf_put_dom_ti_char ( fid , 'GRIDTYPE',  'E' , ierr )<a name='603'>
#endif<a name='604'>
#if (EM_CORE == 1)<a name='605'>
          CALL wrf_put_dom_ti_char ( fid , 'GRIDTYPE',  'C' , ierr )<a name='606'>
#endif<a name='607'>
#if (COAMPS_CORE == 1 )<a name='608'>
          CALL wrf_put_dom_ti_char ( fid , 'GRIDTYPE',  'B' , ierr )<a name='609'>
#endif<a name='610'>
<a name='611'>
<font color=#447700>! added these fields for W. Skamarock, 020402, JM<a name='612'></font>
    ibuf(1) = diff_opt<a name='613'>
    CALL wrf_put_dom_ti_integer ( fid , 'DIFF_OPT' ,  ibuf , 1 , ierr )<a name='614'>
    ibuf(1) = km_opt<a name='615'>
    CALL wrf_put_dom_ti_integer ( fid , 'KM_OPT' ,  ibuf , 1 , ierr )<a name='616'>
    ibuf(1) = damp_opt<a name='617'>
    CALL wrf_put_dom_ti_integer ( fid , 'DAMP_OPT' ,  ibuf , 1 , ierr )<a name='618'>
    rbuf(1) = dampcoef<a name='619'>
    CALL wrf_put_dom_ti_real    ( fid , 'DAMPCOEF' ,  rbuf , 1 , ierr )<a name='620'>
    rbuf(1) = khdif<a name='621'>
    CALL wrf_put_dom_ti_real    ( fid , 'KHDIF' ,  rbuf , 1 , ierr )<a name='622'>
    rbuf(1) = kvdif<a name='623'>
    CALL wrf_put_dom_ti_real    ( fid , 'KVDIF' ,  rbuf , 1 , ierr )<a name='624'>
    ibuf(1) = mp_physics<a name='625'>
    CALL wrf_put_dom_ti_integer ( fid , 'MP_PHYSICS' ,  ibuf , 1 , ierr )<a name='626'>
    ibuf(1) = ra_lw_physics<a name='627'>
    CALL wrf_put_dom_ti_integer ( fid , 'RA_LW_PHYSICS' ,  ibuf , 1 , ierr )<a name='628'>
    ibuf(1) = ra_sw_physics<a name='629'>
    CALL wrf_put_dom_ti_integer ( fid , 'RA_SW_PHYSICS' ,  ibuf , 1 , ierr )<a name='630'>
    ibuf(1) = sf_sfclay_physics<a name='631'>
    CALL wrf_put_dom_ti_integer ( fid , 'SF_SFCLAY_PHYSICS' ,  ibuf , 1 , ierr )<a name='632'>
    ibuf(1) = sf_surface_physics<a name='633'>
    CALL wrf_put_dom_ti_integer ( fid , 'SF_SURFACE_PHYSICS' ,  ibuf , 1 , ierr )<a name='634'>
    ibuf(1) = bl_pbl_physics<a name='635'>
    CALL wrf_put_dom_ti_integer ( fid , 'BL_PBL_PHYSICS' ,  ibuf , 1 , ierr )<a name='636'>
    ibuf(1) = cu_physics<a name='637'>
    CALL wrf_put_dom_ti_integer ( fid , 'CU_PHYSICS' ,  ibuf , 1 , ierr )<a name='638'>
    ibuf(1) = sf_lake_physics<a name='639'>
    CALL wrf_put_dom_ti_integer ( fid , 'SF_LAKE_PHYSICS' ,  ibuf , 1 , ierr )<a name='640'>
<a name='641'>
    <font color=#447700>! added netcdf-specific metadata:<a name='642'></font>
    IF ( ( use_package( io_form ) == IO_NETCDF ) .OR. &amp;<a name='643'>
         ( use_package( io_form ) == IO_PHDF5  ) .OR. &amp;<a name='644'>
         ( use_package( io_form ) == IO_PIO    ) .OR. &amp;<a name='645'>
         ( use_package( io_form ) == IO_PNETCDF ) ) THEN<a name='646'>
      CALL wrf_put_dom_ti_integer ( fid, 'SURFACE_INPUT_SOURCE', surface_input_source , 1 , ierr )<a name='647'>
      CALL wrf_put_dom_ti_integer ( fid, 'SST_UPDATE', sst_update , 1 , ierr )<a name='648'>
#if (EM_CORE == 1)<a name='649'>
      CALL wrf_put_dom_ti_integer ( fid, 'GRID_FDDA', grid_fdda , 1 , ierr )<a name='650'>
      CALL wrf_put_dom_ti_integer ( fid, 'GFDDA_INTERVAL_M', gfdda_interval_m , 1 , ierr )<a name='651'>
      CALL wrf_put_dom_ti_integer ( fid, 'GFDDA_END_H', gfdda_end_h , 1 , ierr )<a name='652'>
      CALL wrf_put_dom_ti_integer ( fid, 'GRID_SFDDA', grid_sfdda , 1 , ierr )<a name='653'>
      CALL wrf_put_dom_ti_integer ( fid, 'SGFDDA_INTERVAL_M', sgfdda_interval_m , 1 , ierr )<a name='654'>
      CALL wrf_put_dom_ti_integer ( fid, 'SGFDDA_END_H', sgfdda_end_h , 1 , ierr )<a name='655'>
      CALL wrf_put_dom_ti_integer ( fid, 'HYPSOMETRIC_OPT', hypsometric_opt , 1 , ierr )<a name='656'>
      CALL wrf_put_dom_ti_integer ( fid, 'USE_THETA_M', use_theta_m , 1 , ierr )<a name='657'>
      IF ( switch .EQ. input_only) THEN<a name='658'>
         CALL wrf_put_dom_ti_integer ( fid, 'USE_MAXW_LEVEL', use_maxw_level , 1 , ierr )<a name='659'>
         CALL wrf_put_dom_ti_integer ( fid, 'USE_TROP_LEVEL', use_trop_level , 1 , ierr )<a name='660'>
      END IF<a name='661'>
    ibuf(1) = gwd_opt<a name='662'>
    CALL wrf_put_dom_ti_integer ( fid, 'GWD_OPT' ,  ibuf , 1 , ierr )<a name='663'>
    CALL wrf_put_dom_ti_integer ( fid, 'SF_URBAN_PHYSICS', sf_urban_physics , 1 , ierr )<a name='664'>
    CALL wrf_put_dom_ti_integer ( fid, 'SF_OCEAN_PHYSICS', config_flags%sf_ocean_physics     , 1 , ierr ) <a name='665'>
#endif<a name='666'>
<a name='667'>
      IF ( switch .EQ. history_only ) THEN<a name='668'>
      CALL wrf_put_dom_ti_integer ( fid, 'SHCU_PHYSICS',     config_flags%shcu_physics , 1 , ierr ) <a name='669'>
      CALL wrf_put_dom_ti_integer ( fid, 'MFSHCONV',         config_flags%mfshconv , 1 , ierr ) <a name='670'>
      CALL wrf_put_dom_ti_integer ( fid, 'FEEDBACK', feedback , 1 , ierr )<a name='671'>
      CALL wrf_put_dom_ti_integer ( fid, 'SMOOTH_OPTION', smooth_option , 1 , ierr )<a name='672'>
      CALL wrf_put_dom_ti_real    ( fid, 'SWRAD_SCAT', swrad_scat , 1 , ierr )<a name='673'>
      CALL wrf_put_dom_ti_integer ( fid, 'W_DAMPING', w_damping , 1 , ierr )<a name='674'>
<a name='675'>
#if (EM_CORE == 1)<a name='676'>
      CALL wrf_put_dom_ti_real    ( fid, 'DT'  , dt, 1 , ierr)<a name='677'>
      IF ( grid%use_adaptive_time_step ) THEN<a name='678'>
         CALL wrf_put_dom_ti_real    ( fid, 'ADAPT_DT_START' , adapt_dt_start, 1 , ierr)<a name='679'>
         CALL wrf_put_dom_ti_real    ( fid, 'ADAPT_DT_MAX'   , adapt_dt_max  , 1 , ierr)<a name='680'>
         CALL wrf_put_dom_ti_real    ( fid, 'ADAPT_DT_MIN'   , adapt_dt_min  , 1 , ierr)<a name='681'>
      END IF<a name='682'>
#endif<a name='683'>
<a name='684'>
      call wrf_put_dom_ti_real    ( fid, 'RADT', radt, 1 , ierr)<a name='685'>
      call wrf_put_dom_ti_real    ( fid, 'BLDT', bldt, 1 , ierr)<a name='686'>
      call wrf_put_dom_ti_real    ( fid, 'CUDT', cudt, 1 , ierr)<a name='687'>
      call wrf_put_dom_ti_integer ( fid, 'AER_OPT'        , aer_opt        , 1 , ierr)<a name='688'>
      call wrf_put_dom_ti_integer ( fid, 'SWINT_OPT'      , swint_opt      , 1 , ierr)<a name='689'>
      call wrf_put_dom_ti_integer ( fid, 'AER_TYPE'       , aer_type       , 1 , ierr )<a name='690'>
      call wrf_put_dom_ti_integer ( fid, 'AER_AOD550_OPT' , aer_aod550_opt , 1 , ierr )<a name='691'>
      call wrf_put_dom_ti_integer ( fid, 'AER_ANGEXP_OPT' , aer_angexp_opt , 1 , ierr )<a name='692'>
      call wrf_put_dom_ti_integer ( fid, 'AER_SSA_OPT'    , aer_ssa_opt    , 1 , ierr )<a name='693'>
      call wrf_put_dom_ti_integer ( fid, 'AER_ASY_OPT'    , aer_asy_opt    , 1 , ierr )<a name='694'>
      call wrf_put_dom_ti_real    ( fid, 'AER_AOD550_VAL' , aer_aod550_val , 1 , ierr )<a name='695'>
      call wrf_put_dom_ti_real    ( fid, 'AER_ANGEXP_VAL' , aer_angexp_val , 1 , ierr )<a name='696'>
      call wrf_put_dom_ti_real    ( fid, 'AER_SSA_VAL'    , aer_ssa_val    , 1 , ierr )<a name='697'>
      call wrf_put_dom_ti_real    ( fid, 'AER_ASY_VAL'    , aer_asy_val    , 1 , ierr )<a name='698'>
<a name='699'>
#if (EM_CORE == 1)<a name='700'>
      CALL wrf_put_dom_ti_integer ( fid, 'MOIST_ADV_OPT', moist_adv_opt , 1 , ierr )<a name='701'>
      CALL wrf_put_dom_ti_integer ( fid, 'SCALAR_ADV_OPT', scalar_adv_opt , 1 , ierr )<a name='702'>
      CALL wrf_put_dom_ti_integer ( fid, 'TKE_ADV_OPT', tke_adv_opt , 1 , ierr )<a name='703'>
      CALL wrf_put_dom_ti_integer ( fid, 'DIFF_6TH_OPT', diff_6th_opt , 1 , ierr )<a name='704'>
      CALL wrf_put_dom_ti_real    ( fid, 'DIFF_6TH_FACTOR', diff_6th_factor , 1 , ierr )<a name='705'>
<a name='706'>
      IF ( config_flags%topo_wind == 1 ) THEN<a name='707'>
        CALL wrf_put_dom_ti_integer ( fid, 'TOPO_WIND', config_flags%topo_wind , 1 , ierr )<a name='708'>
      ENDIF<a name='709'>
      IF ( grid_fdda == 1 ) THEN<a name='710'>
        CALL wrf_put_dom_ti_real    ( fid, 'FGDT', fgdt , 1 , ierr )<a name='711'>
        CALL wrf_put_dom_ti_real    ( fid, 'GUV', guv , 1 , ierr )<a name='712'>
        CALL wrf_put_dom_ti_real    ( fid, 'GT', gt , 1 , ierr )<a name='713'>
        CALL wrf_put_dom_ti_real    ( fid, 'GQ', gq , 1 , ierr )<a name='714'>
        CALL wrf_put_dom_ti_integer ( fid, 'IF_RAMPING', if_ramping , 1 , ierr )<a name='715'>
        CALL wrf_put_dom_ti_real    ( fid, 'DTRAMP_MIN', dtramp_min , 1 , ierr )<a name='716'>
      ENDIF<a name='717'>
<a name='718'>
      IF ( grid_fdda == 2 ) THEN<a name='719'>
        CALL wrf_put_dom_ti_real    ( fid, 'FGDT', fgdt , 1 , ierr )<a name='720'>
        CALL wrf_put_dom_ti_real    ( fid, 'GUV', guv , 1 , ierr )<a name='721'>
        CALL wrf_put_dom_ti_real    ( fid, 'GT', gt , 1 , ierr )<a name='722'>
        CALL wrf_put_dom_ti_real    ( fid, 'GPH', gph , 1 , ierr )<a name='723'>
        CALL wrf_put_dom_ti_integer ( fid, 'IF_RAMPING', if_ramping , 1 , ierr )<a name='724'>
        CALL wrf_put_dom_ti_real    ( fid, 'DTRAMP_MIN', dtramp_min , 1 , ierr )<a name='725'>
      ENDIF<a name='726'>
<a name='727'>
      IF ( grid_sfdda &gt;= 1 ) THEN<a name='728'>
        CALL wrf_put_dom_ti_real    ( fid, 'GUV_SFC', guv_sfc , 1 , ierr )<a name='729'>
        CALL wrf_put_dom_ti_real    ( fid, 'GT_SFC', gt_sfc , 1 , ierr )<a name='730'>
        CALL wrf_put_dom_ti_real    ( fid, 'GQ_SFC', gq_sfc , 1 , ierr )<a name='731'>
        CALL wrf_put_dom_ti_real    ( fid, 'RINBLW', rinblw , 1 , ierr )<a name='732'>
      ENDIF<a name='733'>
<a name='734'>
      CALL wrf_put_dom_ti_integer ( fid, 'OBS_NUDGE_OPT', obs_nudge_opt , 1 , ierr )<a name='735'>
      IF ( obs_nudge_opt == 1 ) THEN<a name='736'>
        CALL wrf_put_dom_ti_real    ( fid, 'FDDA_END', fdda_end , 1 , ierr )<a name='737'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_NUDGE_WIND', obs_nudge_wind , 1 , ierr )<a name='738'>
        CALL wrf_put_dom_ti_real    ( fid, 'OBS_COEF_WIND', obs_coef_wind , 1 , ierr )<a name='739'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_NUDGE_TEMP', obs_nudge_temp , 1 , ierr )<a name='740'>
        CALL wrf_put_dom_ti_real    ( fid, 'OBS_COEF_TEMP', obs_coef_temp , 1 , ierr )<a name='741'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_NUDGE_MOIS', obs_nudge_mois , 1 , ierr )<a name='742'>
        CALL wrf_put_dom_ti_real    ( fid, 'OBS_COEF_MOIS', obs_coef_mois , 1 , ierr )<a name='743'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_NUDGE_PSTR', obs_nudge_pstr , 1 , ierr )<a name='744'>
        CALL wrf_put_dom_ti_real    ( fid, 'OBS_COEF_PSTR', obs_coef_pstr , 1 , ierr )<a name='745'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_IONF', obs_ionf , 1 , ierr )<a name='746'>
        CALL wrf_put_dom_ti_integer ( fid, 'OBS_IDYNIN', obs_idynin , 1 , ierr )<a name='747'>
        CALL wrf_put_dom_ti_real    ( fid, 'OBS_DTRAMP', obs_dtramp , 1 , ierr )<a name='748'>
      ENDIF<a name='749'>
<a name='750'>
      CALL wrf_put_dom_ti_real      ( fid, 'BUCKET_MM',   config_flags%bucket_mm   , 1 , ierr ) <a name='751'>
      CALL wrf_put_dom_ti_real      ( fid, 'BUCKET_J',    config_flags%bucket_J    , 1 , ierr ) <a name='752'>
      CALL wrf_put_dom_ti_real      ( fid, 'PREC_ACC_DT', config_flags%prec_acc_dt , 1 , ierr ) <a name='753'>
      CALL wrf_put_dom_ti_integer   ( fid, 'ISFTCFLX',    config_flags%isftcflx    , 1 , ierr ) <a name='754'>
      CALL wrf_put_dom_ti_integer   ( fid, 'ISHALLOW',    config_flags%ishallow    , 1 , ierr ) <a name='755'>
      CALL wrf_put_dom_ti_integer   ( fid, 'ISFFLX',      config_flags%isfflx      , 1 , ierr ) <a name='756'>
      CALL wrf_put_dom_ti_integer   ( fid, 'ICLOUD',      config_flags%icloud      , 1 , ierr ) <a name='757'>
      CALL wrf_put_dom_ti_integer   ( fid, 'ICLOUD_CU',   config_flags%icloud_cu   , 1 , ierr ) <a name='758'>
      CALL wrf_put_dom_ti_integer   ( fid, 'TRACER_PBLMIX', tracer_pblmix , 1 , ierr )<a name='759'>
      CALL wrf_put_dom_ti_integer   ( fid, 'SCALAR_PBLMIX', scalar_pblmix , 1 , ierr )<a name='760'>
      CALL wrf_put_dom_ti_integer   ( fid, 'YSU_TOPDOWN_PBLMIX', ysu_topdown_pblmix , 1 , ierr )<a name='761'>
      CALL wrf_put_dom_ti_integer   ( fid, 'GRAV_SETTLING', grav_settling , 1 , ierr )<a name='762'>
<a name='763'>
#endif<a name='764'>
<a name='765'>
      IF ( sf_surface_physics == 4 ) THEN<a name='766'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_SFC',     config_flags%opt_sfc     , 1 , ierr )<a name='767'>
        CALL wrf_put_dom_ti_integer   ( fid, 'DVEG',        config_flags%dveg        , 1 , ierr )<a name='768'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_CRS',     config_flags%opt_crs     , 1 , ierr )<a name='769'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_BTR',     config_flags%opt_btr     , 1 , ierr )<a name='770'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_RUN',     config_flags%opt_run     , 1 , ierr )<a name='771'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_FRZ',     config_flags%opt_frz     , 1 , ierr )<a name='772'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_INF',     config_flags%opt_inf     , 1 , ierr )<a name='773'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_RAD',     config_flags%opt_rad     , 1 , ierr )<a name='774'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_ALB',     config_flags%opt_alb     , 1 , ierr )<a name='775'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_SNF',     config_flags%opt_snf     , 1 , ierr )<a name='776'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_TBOT',    config_flags%opt_tbot    , 1 , ierr )<a name='777'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_STC',     config_flags%opt_stc     , 1 , ierr )<a name='778'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_GLA',     config_flags%opt_gla     , 1 , ierr )<a name='779'>
        CALL wrf_put_dom_ti_integer   ( fid, 'OPT_RSF',     config_flags%opt_rsf     , 1 , ierr )<a name='780'>
      ENDIF<a name='781'>
<a name='782'>
<a name='783'>
      CALL wrf_put_dom_ti_integer   ( fid, 'DFI_OPT',          config_flags%dfi_opt      , 1 , ierr ) <a name='784'>
<a name='785'>
      ENDIF <font color=#447700>! history_only<a name='786'></font>
<a name='787'>
#if (EM_CORE == 1) &amp;&amp; ( DA_CORE <font color=#447700>!= 1)<a name='788'></font>
      IF ( ( switch .EQ. input_only   ) .OR. &amp;<a name='789'>
           ( switch .EQ. history_only ) .OR. &amp;<a name='790'>
           ( switch .EQ. restart_only ) ) THEN<a name='791'>
         IF ( grid%this_is_an_ideal_run ) THEN<a name='792'>
            CALL wrf_put_dom_ti_char ( fid , 'SIMULATION_INITIALIZATION_TYPE', "IDEALIZED DATA" , ierr )<a name='793'>
         ELSE<a name='794'>
            CALL wrf_put_dom_ti_char ( fid , 'SIMULATION_INITIALIZATION_TYPE', "REAL-DATA CASE" , ierr )<a name='795'>
         END IF<a name='796'>
      END IF<a name='797'>
#endif<a name='798'>
    ENDIF<a name='799'>
<a name='800'>
<font color=#447700>! added these fields for use by reassembly programs , 010831, JM<a name='801'></font>
<font color=#447700>! modified these fields so "patch" == "domain" when multi-file output<a name='802'></font>
<font color=#447700>! formats are not used.  051018, TBH<a name='803'></font>
<a name='804'>
    ibuf(1) = MAX(ips,ids)<a name='805'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = ids<a name='806'>
    CALL wrf_put_dom_ti_integer ( fid , 'WEST-EAST_PATCH_START_UNSTAG' ,  ibuf , 1 , ierr )<a name='807'>
    ibuf(1) = MIN(ipe,ide-1)<a name='808'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = ide - 1<a name='809'>
    CALL wrf_put_dom_ti_integer ( fid , 'WEST-EAST_PATCH_END_UNSTAG' ,  ibuf , 1 , ierr )<a name='810'>
    ibuf(1) = MAX(ips,ids)<a name='811'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = ids<a name='812'>
    CALL wrf_put_dom_ti_integer ( fid , 'WEST-EAST_PATCH_START_STAG' ,  ibuf , 1 , ierr )<a name='813'>
    ibuf(1) = MIN(ipe,ide)<a name='814'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = ide<a name='815'>
    CALL wrf_put_dom_ti_integer ( fid , 'WEST-EAST_PATCH_END_STAG' ,  ibuf , 1 , ierr )<a name='816'>
    ibuf(1) = MAX(jps,jds)<a name='817'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = jds<a name='818'>
    CALL wrf_put_dom_ti_integer ( fid , 'SOUTH-NORTH_PATCH_START_UNSTAG' ,  ibuf , 1 , ierr )<a name='819'>
    ibuf(1) = MIN(jpe,jde-1)<a name='820'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = jde - 1<a name='821'>
    CALL wrf_put_dom_ti_integer ( fid , 'SOUTH-NORTH_PATCH_END_UNSTAG' ,  ibuf , 1 , ierr )<a name='822'>
    ibuf(1) = MAX(jps,jds)<a name='823'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = jds<a name='824'>
    CALL wrf_put_dom_ti_integer ( fid , 'SOUTH-NORTH_PATCH_START_STAG' ,  ibuf , 1 , ierr )<a name='825'>
    ibuf(1) = MIN(jpe,jde)<a name='826'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = jde<a name='827'>
    CALL wrf_put_dom_ti_integer ( fid , 'SOUTH-NORTH_PATCH_END_STAG' ,  ibuf , 1 , ierr )<a name='828'>
<a name='829'>
    ibuf(1) = MAX(kps,kds)<a name='830'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = kds<a name='831'>
    CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_PATCH_START_UNSTAG' ,  ibuf , 1 , ierr )<a name='832'>
    ibuf(1) = MIN(kpe,kde-1)<a name='833'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = kde - 1<a name='834'>
    CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_PATCH_END_UNSTAG' ,  ibuf , 1 , ierr )<a name='835'>
    ibuf(1) = MAX(kps,kds)<a name='836'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = kds<a name='837'>
    CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_PATCH_START_STAG' ,  ibuf , 1 , ierr )<a name='838'>
    ibuf(1) = MIN(kpe,kde)<a name='839'>
    IF ( .NOT. multi_files ( io_form ) ) ibuf(1) = kde<a name='840'>
    CALL wrf_put_dom_ti_integer ( fid , 'BOTTOM-TOP_PATCH_END_STAG' ,  ibuf , 1 , ierr )<a name='841'>
#if (EM_CORE == 1)<a name='842'>
    ibuf(1) = grid%id<a name='843'>
    CALL wrf_put_dom_ti_integer ( fid , 'GRID_ID' ,  ibuf , 1 , ierr )<a name='844'>
    ibuf(1) = parent_id<a name='845'>
    CALL wrf_put_dom_ti_integer ( fid , 'PARENT_ID' ,  ibuf , 1 , ierr )<a name='846'>
    ibuf(1) = i_parent_start<a name='847'>
    CALL wrf_put_dom_ti_integer ( fid , 'I_PARENT_START' ,  ibuf , 1 , ierr )<a name='848'>
    ibuf(1) = j_parent_start<a name='849'>
    CALL wrf_put_dom_ti_integer ( fid , 'J_PARENT_START' ,  ibuf , 1 , ierr )<a name='850'>
    ibuf(1) = parent_grid_ratio<a name='851'>
    CALL wrf_put_dom_ti_integer ( fid , 'PARENT_GRID_RATIO' ,  ibuf , 1 , ierr )<a name='852'>
#endif<a name='853'>
<a name='854'>
<font color=#447700>! end add 010831 JM<a name='855'></font>
<a name='856'>
#if (EM_CORE <font color=#447700>!= 1)<a name='857'></font>
    CALL wrf_put_dom_ti_real ( fid , 'DX' ,  config_flags%dx , 1 , ierr )<a name='858'>
    CALL wrf_put_dom_ti_real ( fid , 'DY' ,  config_flags%dy , 1 , ierr )<a name='859'>
#endif<a name='860'>
<font color=#447700>! Updated by T. Hutchinson to use adaptive time step.<a name='861'></font>
    CALL wrf_put_dom_ti_real ( fid , 'DT' ,  grid%dt , 1 , ierr )<a name='862'>
<font color=#447700>!    CALL wrf_put_dom_ti_real ( fid , 'DT' ,  config%dt , 1 , ierr )<a name='863'></font>
    CALL wrf_put_dom_ti_real ( fid , 'CEN_LAT' ,  config_flags%cen_lat , 1 , ierr )<a name='864'>
    CALL wrf_put_dom_ti_real ( fid , 'CEN_LON' ,  config_flags%cen_lon , 1 , ierr )<a name='865'>
    CALL wrf_put_dom_ti_real ( fid , 'TRUELAT1',  config_flags%truelat1, 1 , ierr )<a name='866'>
    CALL wrf_put_dom_ti_real ( fid , 'TRUELAT2',  config_flags%truelat2, 1 , ierr )<a name='867'>
    CALL wrf_put_dom_ti_real ( fid , 'MOAD_CEN_LAT',  config_flags%moad_cen_lat, 1 , ierr )<a name='868'>
    CALL wrf_put_dom_ti_real ( fid , 'STAND_LON',  config_flags%stand_lon, 1 , ierr )<a name='869'>
#if (EM_CORE == 1)<a name='870'>
    CALL wrf_put_dom_ti_real ( fid , 'POLE_LAT',  config_flags%pole_lat, 1 , ierr )<a name='871'>
    CALL wrf_put_dom_ti_real ( fid , 'POLE_LON',  config_flags%pole_lon, 1 , ierr )<a name='872'>
#endif<a name='873'>
    IF ( switch .NE. boundary_only .AND. switch .NE. auxinput9_only .AND. switch .NE. auxinput10_only ) THEN<a name='874'>
#ifdef PLANET<a name='875'>
      <font color=#447700>! When writing to restart files, use the values of the instantaneous<a name='876'></font>
      <font color=#447700>! time for determining the values of JULYR, JULDAY, and GMT.  If the<a name='877'></font>
      <font color=#447700>! original values in config_flags are used, this assumes that the<a name='878'></font>
      <font color=#447700>! restart simulation will start with an itimestep NE 0.  If we use<a name='879'></font>
      <font color=#447700>! the instantaneous time, we can start a restart simulation with a<a name='880'></font>
      <font color=#447700>! different value of delta-t for timestep and still get the clocks<a name='881'></font>
      <font color=#447700>! calendars (and orbital information!) correct.<a name='882'></font>
      <font color=#447700>!<a name='883'></font>
      <font color=#447700>! Current time is still defined from above call to WRF_UTIL_ClockGet<a name='884'></font>
      CALL WRFU_TimeGet( currentTime, YY=julyr, dayOfYear=julday, H=p_hr, M=p_min, S=p_sec, MS=p_ms, rc=rc)<a name='885'>
      WRITE(wrf_err_message,*)'output_wrf: julyr,julday,hr,min,sec,ms = ',julyr,julday,p_hr,p_min,p_sec,p_ms<a name='886'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1126">( 100 , wrf_err_message )<a name='887'>
      gmt = REAL(p_hr)+REAL(p_min)/60.+REAL(p_sec)/3600.+REAL(p_ms)/3600000.<a name='888'>
      CALL wrf_put_dom_ti_real ( fid , 'GMT' ,  gmt , 1 , ierr )<a name='889'>
      CALL wrf_put_dom_ti_integer ( fid , 'JULYR' ,  julyr , 1 , ierr )<a name='890'>
      CALL wrf_put_dom_ti_integer ( fid , 'JULDAY' ,  julday , 1 , ierr )<a name='891'>
#else<a name='892'>
      CALL wrf_put_dom_ti_real ( fid , 'GMT' ,  config_flags%gmt , 1 , ierr )<a name='893'>
      CALL wrf_put_dom_ti_integer ( fid , 'JULYR' ,  config_flags%julyr , 1 , ierr )<a name='894'>
      CALL wrf_put_dom_ti_integer ( fid , 'JULDAY' ,  config_flags%julday , 1 , ierr )<a name='895'>
#endif<a name='896'>
    ENDIF<a name='897'>
<a name='898'>
    CALL wrf_put_dom_ti_integer ( fid , 'MAP_PROJ' ,  config_flags%map_proj , 1 , ierr )<a name='899'>
    IF      ( config_flags%map_proj .EQ.   0 ) THEN<a name='900'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "Cartesian"               , ierr )<a name='901'>
    ELSE IF ( config_flags%map_proj .EQ.   1 ) THEN<a name='902'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "Lambert Conformal"       , ierr )<a name='903'>
    ELSE IF ( config_flags%map_proj .EQ.   2 ) THEN<a name='904'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "Polar Stereographic"     , ierr )<a name='905'>
    ELSE IF ( config_flags%map_proj .EQ.   3 ) THEN<a name='906'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "Mercator"                , ierr )<a name='907'>
    ELSE IF ( config_flags%map_proj .EQ.   6 ) THEN<a name='908'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "Cylindrical Equidistant" , ierr )<a name='909'>
    ELSE IF ( config_flags%map_proj .EQ. 203 ) THEN<a name='910'>
       CALL wrf_put_dom_ti_char ( fid , 'MAP_PROJ_CHAR' ,  "NMM Rotated Lat Lon"     , ierr )<a name='911'>
    END IF<a name='912'>
<a name='913'>
    IF(MMINLU(1:4) == 'USGS') THEN<a name='914'>
      MMINLU='USGS'<a name='915'>
    ENDIF<a name='916'>
	<a name='917'>
    IF(MMINLU(1:1) .EQ. " ")THEN<a name='918'>
       CALL wrf_put_dom_ti_char ( fid , 'MMINLU',  "    "       , ierr )<a name='919'>
    ELSE<a name='920'>
       CALL wrf_put_dom_ti_char ( fid , 'MMINLU',  TRIM(mminlu) , ierr )<a name='921'>
    END IF<a name='922'>
    call wrf_put_dom_ti_integer ( fid , 'NUM_LAND_CAT', config_flags%num_land_cat, 1, ierr)<a name='923'>
    CALL wrf_put_dom_ti_integer ( fid , 'ISWATER' ,  iswater , 1 , ierr )<a name='924'>
    CALL wrf_put_dom_ti_integer ( fid , 'ISLAKE' ,   islake , 1 , ierr )<a name='925'>
<font color=#447700>!   CALL wrf_put_dom_ti_integer ( fid , 'ISWATER' ,  config_flags%iswater , 1 , ierr )<a name='926'></font>
    CALL wrf_put_dom_ti_integer ( fid , 'ISICE' ,  config_flags%isice , 1 , ierr )<a name='927'>
    CALL wrf_put_dom_ti_integer ( fid , 'ISURBAN' ,  config_flags%isurban , 1 , ierr )<a name='928'>
    CALL wrf_put_dom_ti_integer ( fid , 'ISOILWATER' ,  config_flags%isoilwater , 1 , ierr )<a name='929'>
<font color=#447700>! added these fields for restarting of moving nests, JM<a name='930'></font>
<font color=#447700>!For HWRF: zhang <a name='931'></font>
#if ( HWRF == 1 )<a name='932'>
    CALL wrf_put_dom_ti_integer ( fid , 'I_PARENT_START' ,  grid%i_parent_start  , 1 , ierr )<a name='933'>
    CALL wrf_put_dom_ti_integer ( fid , 'J_PARENT_START' ,  grid%j_parent_start  , 1 , ierr )<a name='934'>
#elif <font color=#447700>! defined(EM_CORE)<a name='935'></font>
    CALL wrf_put_dom_ti_integer ( fid , 'I_PARENT_START' ,  config_flags%i_parent_start  , 1 , ierr )<a name='936'>
    CALL wrf_put_dom_ti_integer ( fid , 'J_PARENT_START' ,  config_flags%j_parent_start  , 1 , ierr )<a name='937'>
#endif<a name='938'>
<a name='939'>
    IF ( switch .EQ. boundary_only ) THEN<a name='940'>
        CALL WRFU_TimeIntervalSet( bdy_increment, S=NINT(config_flags%bdyfrq),rc=rc)<a name='941'>
        next_time = currentTime + bdy_increment<a name='942'>
        CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_16"> ( next_time, next_datestr )<a name='943'>
        CALL wrf_put_dom_td_char ( fid , 'THISBDYTIME' ,  current_date(1:19), current_date(1:19), ierr )<a name='944'>
        CALL wrf_put_dom_td_char ( fid , 'NEXTBDYTIME' ,  current_date(1:19), next_datestr(1:19), ierr )<a name='945'>
    ENDIF<a name='946'>
<a name='947'>
    <font color=#447700>!  Add the hybrid vertical coordinate metadata.<a name='948'></font>
<a name='949'>
#if (EM_CORE == 1)<a name='950'>
# if <font color=#447700>! ( HYBRID_COORD==1 )<a name='951'></font>
    CALL wrf_put_dom_ti_integer ( fid , 'HYBRID_OPT',          -1  , 1 , ierr )<a name='952'>
    CALL wrf_put_dom_ti_real    ( fid , 'ETAC'      ,           0. , 1 , ierr )<a name='953'>
# else<a name='954'>
    CALL wrf_put_dom_ti_integer ( fid , 'HYBRID_OPT',  hybrid_opt  , 1 , ierr )<a name='955'>
    CALL wrf_put_dom_ti_real    ( fid , 'ETAC'      ,  etac        , 1 , ierr )<a name='956'>
# endif<a name='957'>
#endif<a name='958'>
<a name='959'>
    <font color=#447700>! added grib2-specific metadata:  Todd Hutchinson 8/21/2005<a name='960'></font>
    IF ( use_package( io_form ) == IO_GRIB2 ) THEN<a name='961'>
      CALL wrf_put_dom_ti_integer ( fid , 'BACKGROUND_PROC_ID' , config_flags%background_proc_id , 1 , ierr )<a name='962'>
      CALL wrf_put_dom_ti_integer ( fid , 'FORECAST_PROC_ID' , config_flags%forecast_proc_id , 1 , ierr )<a name='963'>
      CALL wrf_put_dom_ti_integer ( fid , 'PRODUCTION_STATUS' , config_flags%production_status , 1 , ierr )<a name='964'>
      CALL wrf_put_dom_ti_integer ( fid , 'COMPRESSION' , config_flags%compression , 1 , ierr )<a name='965'>
    ENDIF<a name='966'>
<a name='967'>
#if ( (EM_CORE == 1) &amp;&amp; (DA_CORE <font color=#447700>!= 1) )<a name='968'></font>
      save_topo_orig = grid%save_topo_from_real<a name='969'>
<a name='970'>
<font color=#447700>! todo jm<a name='971'></font>
    IF ( (first_history .LE. switch .AND. switch .LE. last_history ) .OR. &amp;<a name='972'>
         ( (switch .EQ. input_only) .AND. &amp;<a name='973'>
           (program_name(1:7) .NE. 'REAL_EM') .AND. &amp;<a name='974'>
           (grid%dfi_opt .EQ. DFI_NODFI ) ) .OR. &amp;<a name='975'>
         ( switch .EQ. restart_only    ) ) THEN<a name='976'>
<a name='977'>
         <font color=#447700>! This flag sets the switch which defines the topography as the original<a name='978'></font>
         <font color=#447700>! generated by real.exe.   The "zero" value means that for the WRF model<a name='979'></font>
         <font color=#447700>! output, the topography has been modified.  All output from the ARW<a name='980'></font>
         <font color=#447700>! WRF model has this flag set.  However, to allow nests to still be <a name='981'></font>
         <font color=#447700>! instantiated after a parent does IO, and to allow that nest domain<a name='982'></font>
         <font color=#447700>! to have the topo adjusted, we save the incoming value of the save_topo<a name='983'></font>
         <font color=#447700>! flag.<a name='984'></font>
<a name='985'>
       grid%save_topo_from_real=0<a name='986'>
    ENDIF<a name='987'>
#endif<a name='988'>
<a name='989'>
    IF ( (first_input   .LE. switch .AND. switch .LE. last_input) .OR. &amp;<a name='990'>
         (first_history .LE. switch .AND. switch .LE. last_history ) .OR. &amp;<a name='991'>
          switch .EQ. restart_only    ) THEN<a name='992'>
      newswitch = switch <a name='993'>
      p =&gt; grid%head_statevars%next<a name='994'>
      DO WHILE ( ASSOCIATED( p ) ) <a name='995'>
        IF ( p%ProcOrient .NE. 'X' .AND. p%ProcOrient .NE. 'Y' ) THEN   <font color=#447700>! no I/O for xposed variables<a name='996'></font>
          IF ( p%Ndim .EQ. 0 ) THEN<a name='997'>
            IF ((p%Restart.AND.switch.EQ.restart_only).OR.on_stream(p%streams,newswitch)) THEN<a name='998'>
              IF ( in_use_for_config(grid%id,TRIM(p%VarName)) ) THEN<a name='999'>
                dname = p%DataName<a name='1000'>
                IF (p%Ntl.GT.0.AND.switch.NE.restart_only)dname=dname(1:len(TRIM(dname))-2)<a name='1001'>
                memord = p%MemoryOrder<a name='1002'>
<a name='1003'>
#if (EM_CORE == 1)<a name='1004'>
                <font color=#447700>!  CF compliancy would have us put the string "minutes since" // simulation_start_date<a name='1005'></font>
                <font color=#447700>!  as the ouput in the units attribute.  After the WRF p%Units string has the "minutes since"<a name='1006'></font>
                <font color=#447700>!  substring, we wipe out the rest of the string and add the model's original (pre-restart)<a name='1007'></font>
                <font color=#447700>!  starting date.  This is only for the time variable in WRF (XTIME), which is now considered<a name='1008'></font>
                <font color=#447700>!  the time coordinate in netcdf.<a name='1009'></font>
<a name='1010'>
                IF (TRIM(p%DataName).EQ."XTIME") THEN<a name='1011'>
                  WRITE ( simulation_start_date , FMT = '(I4.4,"-",I2.2,"-",I2.2," ",I2.2,":",I2.2,":",I2.2)' ) &amp;<a name='1012'>
                  simulation_start_year,simulation_start_month,simulation_start_day,&amp;<a name='1013'>
                  simulation_start_hour,simulation_start_minute,simulation_start_second<a name='1014'>
                  IF ( TRIM(p%Description(1:14)) .EQ. 'minutes since ' ) THEN<a name='1015'>
                    p%Description(15:33) = TRIM(simulation_start_date)<a name='1016'>
                    p%Units      (15:33) = TRIM(simulation_start_date)<a name='1017'>
                  ENDIF<a name='1018'>
                ENDIF<a name='1019'>
#endif<a name='1020'>
<a name='1021'>
                IF      ( p%Type .EQ. 'r' ) THEN<a name='1022'>
                  CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_1"> (  &amp;<a name='1023'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1024'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1025'></font>
                                    TRIM(p%DataName)        , &amp; <font color=#447700>! Data Name<a name='1026'></font>
                                    p%rfield_0d             , &amp; <font color=#447700>! Field<a name='1027'></font>
                                    WRF_FLOAT               , &amp; <font color=#447700>! FieldType<a name='1028'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1029'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1030'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1031'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1032'></font>
                                    '0'                     , &amp; <font color=#447700>! MemoryOrder<a name='1033'></font>
                                    ''                      , &amp; <font color=#447700>! Stagger<a name='1034'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 1<a name='1035'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 2<a name='1036'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 3<a name='1037'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1038'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1039'></font>
                    __FILE__ // ' writing 0d real ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1040'></font>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1041'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1042'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1043'>
                    ierr )<a name='1044'>
                ELSE IF ( p%Type .EQ. 'd' ) THEN<a name='1045'>
                  CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_2"> (  &amp;<a name='1046'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1047'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1048'></font>
                                    TRIM(p%DataName)        , &amp; <font color=#447700>! Data Name<a name='1049'></font>
                                    p%dfield_0d             , &amp; <font color=#447700>! Field<a name='1050'></font>
                                    WRF_DOUBLE              , &amp; <font color=#447700>! FieldType<a name='1051'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1052'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1053'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1054'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1055'></font>
                                    '0'                     , &amp; <font color=#447700>! MemoryOrder<a name='1056'></font>
                                    ''                      , &amp; <font color=#447700>! Stagger<a name='1057'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 1<a name='1058'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 2<a name='1059'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 3<a name='1060'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1061'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1062'></font>
                    __FILE__ // ' writing 0d double ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1063'></font>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1064'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1065'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1066'>
                    ierr )<a name='1067'>
                ELSE IF ( p%Type .EQ. 'i' ) THEN<a name='1068'>
                  CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_3"> (  &amp;<a name='1069'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1070'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1071'></font>
                                    TRIM(p%DataName)        , &amp; <font color=#447700>! Data Name<a name='1072'></font>
                                    p%ifield_0d             , &amp; <font color=#447700>! Field<a name='1073'></font>
                                    WRF_INTEGER             , &amp; <font color=#447700>! FieldType<a name='1074'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1075'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1076'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1077'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1078'></font>
                                    '0'                     , &amp; <font color=#447700>! MemoryOrder<a name='1079'></font>
                                    ''                      , &amp; <font color=#447700>! Stagger<a name='1080'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 1<a name='1081'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 2<a name='1082'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 3<a name='1083'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1084'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1085'></font>
                    __FILE__ // ' writing 0d integer ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1086'></font>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1087'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1088'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1089'>
                    ierr )<a name='1090'>
                ELSE IF ( p%Type .EQ. 'l' ) THEN<a name='1091'>
                  CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_4"> (  &amp;<a name='1092'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1093'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1094'></font>
                                    TRIM(p%DataName)        , &amp; <font color=#447700>! Data Name<a name='1095'></font>
                                    p%lfield_0d             , &amp; <font color=#447700>! Field<a name='1096'></font>
                                    WRF_LOGICAL             , &amp; <font color=#447700>! FieldType<a name='1097'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1098'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1099'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1100'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1101'></font>
                                    '0'                     , &amp; <font color=#447700>! MemoryOrder<a name='1102'></font>
                                    ''                      , &amp; <font color=#447700>! Stagger<a name='1103'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 1<a name='1104'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 2<a name='1105'></font>
                                    ''                      , &amp; <font color=#447700>! Dimname 3<a name='1106'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1107'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1108'></font>
                    __FILE__ // ' writing 0d logical ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1109'></font>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1110'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1111'>
                    1 , 1 , 1 , 1 , 1 , 1 ,  &amp;<a name='1112'>
                    ierr )<a name='1113'>
                ENDIF<a name='1114'>
              ENDIF<a name='1115'>
            ENDIF<a name='1116'>
          ELSE IF ( p%Ndim .EQ. 1 ) THEN<a name='1117'>
            IF ((p%Restart.AND.switch.EQ.restart_only).OR.on_stream(p%streams,newswitch)) THEN<a name='1118'>
              IF ( in_use_for_config(grid%id,TRIM(p%VarName)) ) THEN<a name='1119'>
                IF (switch.EQ.restart_only.OR.p%Ntl/100.EQ.mod(p%Ntl,100)) THEN<a name='1120'>
                  dname = p%DataName<a name='1121'>
                  IF (p%Ntl.GT.0.AND.switch.NE.restart_only)dname=dname(1:len(TRIM(dname))-2)<a name='1122'>
                  memord = p%MemoryOrder<a name='1123'>
                  IF      ( p%Type .EQ. 'r' ) THEN<a name='1124'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_5"> (  &amp;<a name='1125'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1126'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1127'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1128'></font>
                                    p%rfield_1d             , &amp; <font color=#447700>! Field<a name='1129'></font>
                                    WRF_FLOAT               , &amp; <font color=#447700>! FieldType<a name='1130'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1131'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1132'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1133'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1134'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1135'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1136'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1137'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1138'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1139'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1140'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1141'></font>
                     __FILE__ // ' writing 1d real ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1142'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1143'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1144'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1145'>
                     ierr )<a name='1146'>
                  ELSE IF ( p%Type .EQ. 'd' ) THEN<a name='1147'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_6"> (  &amp;<a name='1148'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1149'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1150'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1151'></font>
                                    p%dfield_1d             , &amp; <font color=#447700>! Field<a name='1152'></font>
                                    WRF_DOUBLE              , &amp; <font color=#447700>! FieldType<a name='1153'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1154'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1155'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1156'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1157'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1158'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1159'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1160'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1161'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1162'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1163'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1164'></font>
                     __FILE__ // ' writing 1d double ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1165'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1166'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1167'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1168'>
                     ierr )<a name='1169'>
                  ELSE IF ( p%Type .EQ. 'i' ) THEN<a name='1170'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_7"> (  &amp;<a name='1171'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1172'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1173'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1174'></font>
                                    p%ifield_1d             , &amp; <font color=#447700>! Field<a name='1175'></font>
                                    WRF_INTEGER             , &amp; <font color=#447700>! FieldType<a name='1176'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1177'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1178'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1179'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1180'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1181'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1182'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1183'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1184'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1185'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1186'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1187'></font>
                     __FILE__ // ' writing 1d integer ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1188'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1189'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1190'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1191'>
                     ierr )<a name='1192'>
                  ELSE IF ( p%Type .EQ. 'l' ) THEN<a name='1193'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_8"> (  &amp;<a name='1194'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1195'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1196'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1197'></font>
                                    p%lfield_1d             , &amp; <font color=#447700>! Field<a name='1198'></font>
                                    WRF_LOGICAL             , &amp; <font color=#447700>! FieldType<a name='1199'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1200'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1201'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1202'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1203'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1204'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1205'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1206'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1207'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1208'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1209'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1210'></font>
                     __FILE__ // ' writing 1d logical ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1211'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1212'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1213'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1214'>
                     ierr )<a name='1215'>
                  ENDIF<a name='1216'>
                ENDIF<a name='1217'>
              ENDIF<a name='1218'>
            ENDIF<a name='1219'>
          ELSE IF ( p%Ndim .EQ. 2 ) THEN<a name='1220'>
            IF ((p%Restart.AND.switch.EQ.restart_only).OR.on_stream(p%streams,newswitch)) THEN<a name='1221'>
              IF ( in_use_for_config(grid%id,TRIM(p%VarName)) .AND.  &amp;<a name='1222'>
                   ( .NOT. p%subgrid_x .OR. (p%subgrid_x .AND. grid%sr_x .GT. 0) ) .AND. &amp;<a name='1223'>
                   ( .NOT. p%subgrid_y .OR. (p%subgrid_y .AND. grid%sr_y .GT. 0) )       &amp;<a name='1224'>
                 ) THEN<a name='1225'>
                IF (switch.EQ.restart_only.OR.p%Ntl/100.EQ.mod(p%Ntl,100)) THEN<a name='1226'>
                  dname = p%DataName<a name='1227'>
                  IF (p%Ntl.GT.0.AND.switch.NE.restart_only)dname=dname(1:len(TRIM(dname))-2)<a name='1228'>
                  memord = p%MemoryOrder<a name='1229'>
                  IF      ( p%Type .EQ. 'r' ) THEN<a name='1230'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_9"> (  &amp;<a name='1231'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1232'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1233'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1234'></font>
                                    p%rfield_2d             , &amp; <font color=#447700>! Field<a name='1235'></font>
                                    WRF_FLOAT               , &amp; <font color=#447700>! FieldType<a name='1236'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1237'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1238'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1239'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1240'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1241'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1242'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1243'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1244'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1245'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1246'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1247'></font>
                     __FILE__ // ' writing 2d real ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1248'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1249'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1250'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1251'>
                     ierr )<a name='1252'>
                  ELSE IF ( p%Type .EQ. 'd' ) THEN<a name='1253'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_10"> (  &amp;<a name='1254'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1255'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1256'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1257'></font>
                                    p%dfield_2d             , &amp; <font color=#447700>! Field<a name='1258'></font>
                                    WRF_DOUBLE              , &amp; <font color=#447700>! FieldType<a name='1259'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1260'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1261'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1262'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1263'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1264'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1265'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1266'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1267'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1268'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1269'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1270'></font>
                     __FILE__ // ' writing 2d double ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1271'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1272'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1273'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1274'>
                     ierr )<a name='1275'>
                  ELSE IF ( p%Type .EQ. 'i' ) THEN<a name='1276'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_11"> (  &amp;<a name='1277'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1278'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1279'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1280'></font>
                                    p%ifield_2d             , &amp; <font color=#447700>! Field<a name='1281'></font>
                                    WRF_INTEGER             , &amp; <font color=#447700>! FieldType<a name='1282'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1283'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1284'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1285'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1286'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1287'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1288'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1289'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1290'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1291'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1292'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1293'></font>
                     __FILE__ // ' writing 2d integer ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1294'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1295'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1296'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1297'>
                     ierr )<a name='1298'>
                  ELSE IF ( p%Type .EQ. 'l' ) THEN<a name='1299'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_12"> (  &amp;<a name='1300'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1301'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1302'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1303'></font>
                                    p%lfield_2d             , &amp; <font color=#447700>! Field<a name='1304'></font>
                                    WRF_LOGICAL             , &amp; <font color=#447700>! FieldType<a name='1305'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1306'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1307'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1308'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1309'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1310'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1311'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1312'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1313'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1314'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1315'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1316'></font>
                     __FILE__ // ' writing 2d logical ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1317'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1318'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1319'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1320'>
                     ierr )<a name='1321'>
                  ENDIF<a name='1322'>
                ENDIF<a name='1323'>
              ENDIF<a name='1324'>
            ENDIF<a name='1325'>
          ELSE IF ( p%Ndim .EQ. 3 ) THEN<a name='1326'>
            IF ((p%Restart.AND.switch.EQ.restart_only).OR.on_stream(p%streams,newswitch)) THEN<a name='1327'>
              IF ( in_use_for_config(grid%id,TRIM(p%VarName)) .AND.  &amp;<a name='1328'>
                   ( .NOT. p%subgrid_x .OR. (p%subgrid_x .AND. grid%sr_x .GT. 0) ) .AND. &amp;<a name='1329'>
                   ( .NOT. p%subgrid_y .OR. (p%subgrid_y .AND. grid%sr_y .GT. 0) )       &amp;<a name='1330'>
                 ) THEN<a name='1331'>
                IF (switch.EQ.restart_only.OR.p%Ntl/100.EQ.mod(p%Ntl,100)) THEN<a name='1332'>
                  dname = p%DataName<a name='1333'>
                  IF (p%Ntl.GT.0.AND.switch.NE.restart_only)dname=dname(1:len(TRIM(dname))-2)<a name='1334'>
                  memord = p%MemoryOrder<a name='1335'>
                  IF      ( p%Type .EQ. 'r' ) THEN<a name='1336'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_13"> (  &amp;<a name='1337'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1338'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1339'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1340'></font>
                                    p%rfield_3d             , &amp; <font color=#447700>! Field<a name='1341'></font>
                                    WRF_FLOAT               , &amp; <font color=#447700>! FieldType<a name='1342'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1343'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1344'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1345'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1346'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1347'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1348'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1349'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1350'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1351'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1352'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1353'></font>
                     __FILE__ // ' writing 3d real ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1354'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1355'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1356'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1357'>
                     ierr )<a name='1358'>
                  ELSE IF ( p%Type .EQ. 'd' ) THEN<a name='1359'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_14"> (  &amp;<a name='1360'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1361'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1362'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1363'></font>
                                    p%dfield_3d             , &amp; <font color=#447700>! Field<a name='1364'></font>
                                    WRF_DOUBLE              , &amp; <font color=#447700>! FieldType<a name='1365'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1366'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1367'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1368'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1369'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1370'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1371'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1372'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1373'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1374'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1375'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1376'></font>
                     __FILE__ // ' writing 3d double ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1377'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1378'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1379'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1380'>
                     ierr )<a name='1381'>
                  ELSE IF ( p%Type .EQ. 'i' ) THEN<a name='1382'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD'>wrf_ext_write_field</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_15"> (  &amp;<a name='1383'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1384'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1385'></font>
                                    TRIM(dname)             , &amp; <font color=#447700>! Data Name<a name='1386'></font>
                                    p%ifield_3d             , &amp; <font color=#447700>! Field<a name='1387'></font>
                                    WRF_INTEGER             , &amp; <font color=#447700>! FieldType<a name='1388'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1389'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1390'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1391'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1392'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1393'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1394'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1395'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1396'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1397'></font>
                                    TRIM(p%Description)     , &amp; <font color=#447700>! Desc<a name='1398'></font>
                                    TRIM(p%Units)           , &amp; <font color=#447700>! Units<a name='1399'></font>
                     __FILE__ // ' writing 3d integer ' // TRIM(p%VarName)     , &amp; <font color=#447700>! Debug message<a name='1400'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1401'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1402'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1403'>
                     ierr )<a name='1404'>
<font color=#447700>! NOTE no io on logical arrays greater than 2d<a name='1405'></font>
                  ENDIF<a name='1406'>
                ENDIF<a name='1407'>
              ENDIF<a name='1408'>
            ENDIF<a name='1409'>
          ELSE IF ( p%Ndim .EQ. 4 .AND. p%scalar_array ) THEN<a name='1410'>
              IF (switch.EQ.restart_only.OR.p%Ntl/100.EQ.mod(p%Ntl,100)) THEN<a name='1411'>
<font color=#447700>! Use a different write routine, wrf_ext_write_field_arr, and pass in the <a name='1412'></font>
<font color=#447700>! tracer indeces so that p%rfield_4d can be passsed in without arguments,<a name='1413'></font>
<font color=#447700>! avoiding the possiblity of a copy-in/copy-out problem for some compilers.<a name='1414'></font>
<font color=#447700>! JM 20091208<a name='1415'></font>
              DO itrace = PARAM_FIRST_SCALAR , p%num_table(grid%id)<a name='1416'>
                IF ((p%Restart.AND.switch.EQ.restart_only).OR.on_stream(p%streams_table(grid%id,itrace)%stream,newswitch)) THEN<a name='1417'>
                  dname = p%dname_table( grid%id, itrace )<a name='1418'>
                  IF (p%Ntl.GT.0.AND.switch.NE.restart_only)dname=dname(1:len(TRIM(dname))-2)<a name='1419'>
                  memord = p%MemoryOrder<a name='1420'>
                  IF      ( p%Type .EQ. 'r' ) THEN<a name='1421'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD_ARR'>wrf_ext_write_field_arr</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_ARR_1"> (  &amp;<a name='1422'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1423'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1424'></font>
                                    TRIM(p%dname_table( grid%id, itrace ))         , &amp; <font color=#447700>! Data Name<a name='1425'></font>
                                    p%rfield_4d             , &amp; <font color=#447700>! Field<a name='1426'></font>
                                    itrace, 1, 1, 1         , &amp; <font color=#447700>! see comment above<a name='1427'></font>
                                    1, 1, 1                 , &amp; <font color=#447700>! see comment above<a name='1428'></font>
                                    RWORDSIZE               , &amp;<a name='1429'>
                                    WRF_FLOAT               , &amp; <font color=#447700>! FieldType<a name='1430'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1431'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1432'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1433'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1434'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1435'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1436'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1437'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1438'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1439'></font>
                                    TRIM(p%desc_table( grid%id, itrace))     , &amp; <font color=#447700>! Desc<a name='1440'></font>
                                    TRIM(p%units_table( grid%id, itrace))           , &amp; <font color=#447700>! Units<a name='1441'></font>
                     __FILE__ // ' writing 4d real ' // TRIM(p%dname_table(grid%id,itrace))     , &amp; <font color=#447700>! Debug message<a name='1442'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1443'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1444'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1445'>
                     ierr )<a name='1446'>
                  ELSE IF ( p%Type .EQ. 'd' ) THEN<a name='1447'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD_ARR'>wrf_ext_write_field_arr</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_ARR_2"> (  &amp;<a name='1448'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1449'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1450'></font>
                                    TRIM(p%dname_table( grid%id, itrace ))         , &amp; <font color=#447700>! Data Name<a name='1451'></font>
                                    p%dfield_4d             , &amp; <font color=#447700>! Field<a name='1452'></font>
                                    itrace, 1, 1, 1         , &amp; <font color=#447700>! see comment above<a name='1453'></font>
                                    1, 1, 1                 , &amp; <font color=#447700>! see comment above<a name='1454'></font>
                                    DWORDSIZE               , &amp;<a name='1455'>
                                    WRF_DOUBLE              , &amp; <font color=#447700>! FieldType<a name='1456'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1457'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1458'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1459'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1460'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1461'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1462'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1463'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1464'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1465'></font>
                                    TRIM(p%desc_table( grid%id, itrace))     , &amp; <font color=#447700>! Desc<a name='1466'></font>
                                    TRIM(p%units_table( grid%id, itrace))           , &amp; <font color=#447700>! Units<a name='1467'></font>
                     __FILE__ // ' writing 4d double ' // TRIM(p%dname_table(grid%id,itrace))     , &amp; <font color=#447700>! Debug message<a name='1468'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1469'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1470'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1471'>
                     ierr )<a name='1472'>
                  ELSE IF ( p%Type .EQ. 'i' ) THEN<a name='1473'>
                    CALL <A href='../../html_code/share/wrf_ext_write_field.F.html#WRF_EXT_WRITE_FIELD_ARR'>wrf_ext_write_field_arr</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_EXT_WRITE_FIELD_ARR_3"> (  &amp;<a name='1474'>
                                    fid                     , &amp; <font color=#447700>! DataHandle<a name='1475'></font>
                                    current_date(1:19)      , &amp; <font color=#447700>! DateStr<a name='1476'></font>
                                    TRIM(p%dname_table( grid%id, itrace ))         , &amp; <font color=#447700>! Data Name<a name='1477'></font>
                                    p%ifield_4d             , &amp; <font color=#447700>! Field<a name='1478'></font>
                                    itrace, 1, 1, 1         , &amp; <font color=#447700>! see comment above<a name='1479'></font>
                                    1, 1, 1                 , &amp; <font color=#447700>! see comment above<a name='1480'></font>
                                    IWORDSIZE               , &amp;<a name='1481'>
                                    WRF_INTEGER             , &amp; <font color=#447700>! FieldType<a name='1482'></font>
                                    grid                    , &amp; <font color=#447700>! grid<a name='1483'></font>
                                    grid%domdesc            , &amp; <font color=#447700>! Comm<a name='1484'></font>
                                    grid%bdy_mask           , &amp; <font color=#447700>! bdy_mask<a name='1485'></font>
                                    dryrun                  , &amp; <font color=#447700>! flag<a name='1486'></font>
                                    TRIM(memord)            , &amp; <font color=#447700>! MemoryOrder<a name='1487'></font>
                                    TRIM(p%Stagger)         , &amp; <font color=#447700>! Stagger<a name='1488'></font>
                                    TRIM(p%dimname1)        , &amp; <font color=#447700>! Dimname 1<a name='1489'></font>
                                    TRIM(p%dimname2)        , &amp; <font color=#447700>! Dimname 2<a name='1490'></font>
                                    TRIM(p%dimname3)        , &amp; <font color=#447700>! Dimname 3<a name='1491'></font>
                                    TRIM(p%desc_table( grid%id, itrace))     , &amp; <font color=#447700>! Desc<a name='1492'></font>
                                    TRIM(p%units_table( grid%id, itrace))           , &amp; <font color=#447700>! Units<a name='1493'></font>
                     __FILE__ // ' writing 4d integer ' // TRIM(p%dname_table(grid%id,itrace))     , &amp; <font color=#447700>! Debug message<a name='1494'></font>
                     p%sd1 , p%ed1 , p%sd2 , p%ed2 , p%sd3 , p%ed3 ,  &amp;<a name='1495'>
                     p%sm1 , p%em1 , p%sm2 , p%em2 , p%sm3 , p%em3 ,  &amp;<a name='1496'>
                     p%sp1 , p%ep1 , p%sp2 , p%ep2 , p%sp3 , p%ep3 ,  &amp;<a name='1497'>
                     ierr )<a name='1498'>
                  ENDIF<a name='1499'>
                ENDIF<a name='1500'>
              ENDDO  <font color=#447700>! loop over tracers<a name='1501'></font>
            ENDIF  <font color=#447700>! if-then-else over dim<a name='1502'></font>
          ENDIF<a name='1503'>
        ENDIF<a name='1504'>
        p =&gt; p%next<a name='1505'>
      ENDDO<a name='1506'>
    ELSE<a name='1507'>
       IF ( switch .EQ. boundary_only ) THEN<a name='1508'>
         CALL wrf_debug ( 300 , 'output_wrf: calling code in wrf_bdyout.inc' )<a name='1509'>
         CALL <A href='../../html_code/share/wrf_bdyout.F.html#WRF_BDYOUT'>wrf_bdyout</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_BDYOUT_1">( fid , grid , config_flags, switch, dryrun,  ierr )<a name='1510'>
       ENDIF<a name='1511'>
    ENDIF<a name='1512'>
<a name='1513'>
    IF ( switch .EQ. history_only ) THEN<a name='1514'>
      IF (adjust) THEN<a name='1515'>
        current_date = current_date_save<a name='1516'>
      ENDIF<a name='1517'>
    ENDIF<a name='1518'>
<a name='1519'>
#if ( (EM_CORE == 1) &amp;&amp; (DA_CORE <font color=#447700>!= 1) )<a name='1520'></font>
      grid%save_topo_from_real = save_topo_orig<a name='1521'>
#endif<a name='1522'>
<a name='1523'>
    IF ( .NOT. dryrun ) THEN<a name='1524'>
       CALL wrf_debug ( 300 , 'output_wrf: calling wrf_iosync ' )<a name='1525'>
       CALL <A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC'>wrf_iosync</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_IOSYNC_1"> ( fid , ierr )<a name='1526'>
       CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1127"> ( 300 , 'output_wrf: back from wrf_iosync ' )<a name='1527'>
<a name='1528'>
       <font color=#447700>! If output_ready_flag is set:<a name='1529'></font>
       <font color=#447700>! Write wrfoutReady file if finished dumping<a name='1530'></font>
       <font color=#447700>! history file, unless we're quilting, in which<a name='1531'></font>
       <font color=#447700>! case this file would get dumped before history<a name='1532'></font>
       <font color=#447700>! file was completely written.  When quilting<a name='1533'></font>
       <font color=#447700>! this file is written after the file handler<a name='1534'></font>
       <font color=#447700>! is closed in the quilt() subroutine instead of<a name='1535'></font>
       <font color=#447700>! here. (This is diagnosed by checking whether<a name='1536'></font>
       <font color=#447700>! nio_tasks_in_group is zero) GAC 20140321<a name='1537'></font>
<a name='1538'>
       IF ( switch .EQ. history_only .AND. config_flags%output_ready_flag ) THEN<a name='1539'>
          WRITE ( wrf_err_message , FMT='(I2.2)' ) grid%id<a name='1540'>
          CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#GET_NIO_TASKS_IN_GROUP'>get_nio_tasks_in_group</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_NIO_TASKS_IN_GROUP_1"> ( grid%id, nio_tasks_per_group )<a name='1541'>
          IF ( nio_tasks_per_group .EQ. 0 ) THEN<a name='1542'>
             OPEN ( UNIT   = 99 , &amp;<a name='1543'>
                    FILE   = 'wrfoutReady_d' // wrf_err_message(1:2) // '_' // TRIM(current_date) , &amp;<a name='1544'>
                    STATUS = 'UNKNOWN' , &amp;<a name='1545'>
                    ACCESS = 'SEQUENTIAL' )<a name='1546'>
             CLOSE (99)<a name='1547'>
          ENDIF<a name='1548'>
       ENDIF<a name='1549'>
    ENDIF<a name='1550'>
<a name='1551'>
    WRITE(wrf_err_message,*)'output_wrf: end, fid = ',fid<a name='1552'>
    CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/output_wrf.F.html#OUTPUT_WRF' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1128">( 300 , wrf_err_message )<a name='1553'>
<a name='1554'>
    RETURN<a name='1555'>
  END SUBROUTINE output_wrf<a name='1556'>
<a name='1557'>
<A NAME='TRAVERSE_STATEVARS_DEBUG'><A href='../../html_code/share/output_wrf.F.html#TRAVERSE_STATEVARS_DEBUG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1558'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>traverse_statevars_debug</font> (s,l),<A href='../../call_from/TRAVERSE_STATEVARS_DEBUG.html' TARGET='index'>1</A><a name='1559'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/output_wrf.F.html#TRAVERSE_STATEVARS_DEBUG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_444"><a name='1560'>
    IMPLICIT NONE<a name='1561'>
    character*(*)s<a name='1562'>
    integer l, itrace<a name='1563'>
    TYPE( fieldlist ), POINTER :: p<a name='1564'>
    p =&gt; head_grid%head_statevars%next<a name='1565'>
<font color=#447700>!    write(0,*)'traverse_statevars_debug called ',TRIM(s),' ',l<a name='1566'></font>
    DO WHILE ( ASSOCIATED( p ) )<a name='1567'>
<font color=#447700>!      IF ( p%Ndim .EQ. 4 .AND. p%scalar_array ) THEN<a name='1568'></font>
<font color=#447700>!         DO itrace = PARAM_FIRST_SCALAR , p%num_table(1)<a name='1569'></font>
<font color=#447700>!write(0,*)TRIM(s),l, itrace, p%streams_table(1,itrace)%stream<a name='1570'></font>
<font color=#447700>!         ENDDO<a name='1571'></font>
<font color=#447700>!      ENDIF<a name='1572'></font>
<font color=#447700>!      if ( TRIM(p%VarName) .EQ. 'store_rand' .OR. TRIM(p%VarName) .EQ. 'STORE_RAND' ) then<a name='1573'></font>
<font color=#447700>!        write(0,*)'traverse_statevars_debug sees ',TRIM(p%VarName),' &gt;',p%Type,'&lt;'<a name='1574'></font>
<font color=#447700>!      endif<a name='1575'></font>
      p =&gt; p%next<a name='1576'>
    ENDDO<a name='1577'>
    RETURN<a name='1578'>
  END SUBROUTINE traverse_statevars_debug<a name='1579'>
<a name='1580'>
</pre></body></html>