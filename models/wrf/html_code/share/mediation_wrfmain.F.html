<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:MEDIATION_LAYER:<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<a name='4'>
<A NAME='MED_INITIALDATA_INPUT_PTR'><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_initialdata_input_ptr</font> ( grid , config_flags ) <A href='../../call_to/MED_INITIALDATA_INPUT_PTR.html' TARGET='index'>1</A>,<A href='../../call_from/MED_INITIALDATA_INPUT_PTR.html' TARGET='index'>5</A><a name='6'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_409"><a name='7'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_256"><a name='8'>
   IMPLICIT NONE<a name='9'>
   TYPE (domain) , POINTER :: grid<a name='10'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='11'>
   INTERFACE <a name='12'>
      SUBROUTINE med_initialdata_input ( grid , config_flags )<a name='13'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_410"><a name='14'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_257"><a name='15'>
         TYPE (domain) :: grid<a name='16'>
         TYPE (grid_config_rec_type) , INTENT(IN) :: config_flags<a name='17'>
      END SUBROUTINE med_initialdata_input<a name='18'>
   END INTERFACE<a name='19'>
   CALL  <A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT'>med_initialdata_input</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT_PTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_INITIALDATA_INPUT_2"> ( grid , config_flags )<a name='20'>
END SUBROUTINE med_initialdata_input_ptr<a name='21'>
<a name='22'>
<A NAME='MED_INITIALDATA_INPUT'><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='23'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_initialdata_input</font> ( grid , config_flags ) <A href='../../call_to/MED_INITIALDATA_INPUT.html' TARGET='index'>2</A>,<A href='../../call_from/MED_INITIALDATA_INPUT.html' TARGET='index'>31</A><a name='24'>
  <font color=#447700>! Driver layer<a name='25'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_411"><a name='26'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_46"><a name='27'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_73"><a name='28'>
use <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_11"><a name='29'>
  <font color=#447700>! Model layer<a name='30'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_258"><a name='31'>
   USE <A href='../../html_code/share/module_bc_time_utilities.F.html#MODULE_BC_TIME_UTILITIES'>module_bc_time_utilities</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_TIME_UTILITIES_20"><a name='32'>
   USE module_utility<a name='33'>
<a name='34'>
   IMPLICIT NONE<a name='35'>
<a name='36'>
  <font color=#447700>! Interface <a name='37'></font>
   INTERFACE<a name='38'>
     SUBROUTINE start_domain ( grid , allowed_to_read )  <font color=#447700>! comes from module_start in appropriate dyn_ directory<a name='39'></font>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_412"><a name='40'>
       TYPE (domain) grid<a name='41'>
       LOGICAL, INTENT(IN) :: allowed_to_read <a name='42'>
     END SUBROUTINE start_domain<a name='43'>
   END INTERFACE<a name='44'>
<a name='45'>
  <font color=#447700>! Arguments<a name='46'></font>
   TYPE(domain)                               :: grid<a name='47'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='48'>
  <font color=#447700>! Local<a name='49'></font>
   INTEGER                :: fid , ierr , myproc<a name='50'>
   CHARACTER (LEN=256)    :: inpname , rstname, timestr<a name='51'>
   CHARACTER (LEN=80)     :: message<a name='52'>
   LOGICAL                :: restart<a name='53'>
   LOGICAL, EXTERNAL      :: wrf_dm_on_monitor<a name='54'>
<a name='55'>
   CALL nl_get_restart( 1, restart )<a name='56'>
   IF ( .NOT. restart ) THEN<a name='57'>
     <font color=#447700>!  Initialize the mother domain.<a name='58'></font>
     grid%input_from_file = .true.<a name='59'>
     IF ( grid%input_from_file ) THEN<a name='60'>
<a name='61'>
        CALL       wrf_debug ( 1 , 'wrf main: calling open_r_dataset for wrfinput' )<a name='62'>
<a name='63'>
        IF ( wrf_dm_on_monitor() ) CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_15"><a name='64'>
<a name='65'>
<font color=#447700>! typically &lt;date&gt; will not be part of input_inname but allow for it<a name='66'></font>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_78">( grid, current_timestr=timestr )<a name='67'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_28"> ( inpname , config_flags%input_inname , grid%id , 2 , timestr )<a name='68'>
<a name='69'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_27"> ( fid, TRIM(inpname) , grid , config_flags , "DATASET=INPUT", ierr )<a name='70'>
        IF ( ierr .NE. 0 ) THEN<a name='71'>
          WRITE( wrf_err_message , * ) 'program wrf: error opening ',TRIM(inpname),' for reading ierr=',ierr<a name='72'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1374"> ( wrf_err_message )<a name='73'>
        ENDIF<a name='74'>
<font color=#447700>! registry-generated code that reads the variable set defined on a given stream<a name='75'></font>
#include "<A href='../../html_code/include/fine_stream_input.inc.html'>fine_stream_input.inc</A>"<A NAME="fine_stream_input.inc_1"><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='76'>
<a name='77'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_55"> ( fid , config_flags , "DATASET=INPUT" )<a name='78'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='79'>
          WRITE ( message , FMT = '("processing wrfinput file (stream 0) for domain ",I8)' ) grid%id<a name='80'>
          CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_16"> ( TRIM(message) )<a name='81'>
        ENDIF<a name='82'>
<a name='83'>
<font color=#447700>!gmm add input for noamp hydro model here<a name='84'></font>
     IF ( config_flags%opt_run.eq.5 ) THEN<a name='85'>
<a name='86'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_29"> ( inpname , config_flags%auxinput7_inname &amp;<a name='87'>
                                 ,grid%id , 2 , timestr)<a name='88'>
<a name='89'>
     if( grid%auxinput7_oid .NE. 0 ) then<a name='90'>
       CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_56"> ( grid%auxinput7_oid , config_flags , "DATASET=AUXINPUT7" )<a name='91'>
     endif<a name='92'>
        <a name='93'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_28"> ( grid%auxinput7_oid, TRIM(inpname) , grid , config_flags , "DATASET=AUXINPUT7", ierr )<a name='94'>
<a name='95'>
<font color=#447700>!        call set_first_operation(grid%auxinput6_oid)<a name='96'></font>
<a name='97'>
        <a name='98'>
        IF ( ierr .NE. 0 ) THEN<a name='99'>
          WRITE( wrf_err_message , * ) 'program wrf: error opening ',TRIM(inpname),' for reading ierr=',ierr<a name='100'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1375"> ( wrf_err_message )<a name='101'>
        ENDIF<a name='102'>
           <a name='103'>
           CALL wrf_debug              (   0 , 'med_initialdata_input: calling input_aux_model_input7' )<a name='104'>
           CALL input_auxinput7 ( grid%auxinput7_oid ,   grid , config_flags , ierr )<a name='105'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1005">              ( 100 , 'med_initialdata_input: back from input_aux_model_input7' )<a name='106'>
        <a name='107'>
        CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_57"> ( grid%auxinput7_oid , config_flags , "DATASET=AUXINPUT7" )<a name='108'>
       <a name='109'>
       ENDIF<a name='110'>
<font color=#447700>!gmm<a name='111'></font>
<a name='112'>
#ifdef MOVE_NESTS<a name='113'>
#if ( EM_CORE == 1 )<a name='114'>
        grid%nest_pos = grid%ht<a name='115'>
        where ( grid%nest_pos .gt. 0 ) grid%nest_pos = grid%nest_pos + 500.  <font color=#447700>! make a cliff<a name='116'></font>
#endif<a name='117'>
#endif<a name='118'>
     ENDIF<a name='119'>
     grid%imask_nostag = 1<a name='120'>
     grid%imask_xstag = 1<a name='121'>
     grid%imask_ystag = 1<a name='122'>
     grid%imask_xystag = 1<a name='123'>
#if (EM_CORE == 1)<a name='124'>
     grid%press_adj = .FALSE.<a name='125'>
#endif<a name='126'>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_15"> ( grid , .TRUE. )<a name='127'>
   ELSE<a name='128'>
<a name='129'>
     IF ( wrf_dm_on_monitor() ) CALL <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_16"><a name='130'>
<a name='131'>
     CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_79">( grid, current_timestr=timestr )<a name='132'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CONSTRUCT_FILENAME2A'>construct_filename2a</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CONSTRUCT_FILENAME2A_30"> ( rstname , config_flags%rst_inname , grid%id , 2 , timestr )<a name='133'>
<a name='134'>
     WRITE(message,*)'RESTART run: opening ',TRIM(rstname),' for reading'<a name='135'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1213"> (  message )<a name='136'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#OPEN_R_DATASET'>open_r_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPEN_R_DATASET_29"> ( fid , TRIM(rstname) , grid , config_flags , "DATASET=RESTART", ierr )<a name='137'>
     IF ( ierr .NE. 0 ) THEN<a name='138'>
       WRITE( message , '("program wrf: error opening ",A32," for reading")') TRIM(rstname)<a name='139'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1376"> ( message )<a name='140'>
     ENDIF<a name='141'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#INPUT_RESTART'>input_restart</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INPUT_RESTART_5"> ( fid,   grid , config_flags , ierr )<a name='142'>
     CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_58"> ( fid , config_flags , "DATASET=RESTART" )<a name='143'>
<a name='144'>
     IF ( wrf_dm_on_monitor() ) THEN<a name='145'>
       WRITE ( message , FMT = '("processing restart file for domain ",I8)' ) grid%id<a name='146'>
       CALL <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_17"> ( TRIM(message) )<a name='147'>
     ENDIF<a name='148'>
<a name='149'>
     grid%imask_nostag = 1<a name='150'>
     grid%imask_xstag = 1<a name='151'>
     grid%imask_ystag = 1<a name='152'>
     grid%imask_xystag = 1<a name='153'>
#if (EM_CORE == 1)<a name='154'>
     grid%press_adj = .FALSE.<a name='155'>
#endif<a name='156'>
     CALL <A href='../../html_code/share/start_domain.F.html#START_DOMAIN'>start_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_INITIALDATA_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_DOMAIN_16"> ( grid , .TRUE. )<a name='157'>
   ENDIF<a name='158'>
<a name='159'>
   RETURN<a name='160'>
END SUBROUTINE med_initialdata_input<a name='161'>
<a name='162'>
<A NAME='MED_SHUTDOWN_IO'><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='163'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_shutdown_io</font> ( grid , config_flags ) <A href='../../call_to/MED_SHUTDOWN_IO.html' TARGET='index'>4</A>,<A href='../../call_from/MED_SHUTDOWN_IO.html' TARGET='index'>12</A><a name='164'>
  <font color=#447700>! Driver layer<a name='165'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_413"><a name='166'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_47"><a name='167'>
  <font color=#447700>! Model layer<a name='168'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_259"><a name='169'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_195">, ONLY : domain_active_this_task<a name='170'>
<a name='171'>
   IMPLICIT NONE<a name='172'>
   INTERFACE<a name='173'>
     RECURSIVE SUBROUTINE med_shutdown_io_recurse ( grid , config_flags )<a name='174'>
       USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_414"><a name='175'>
       USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_260"><a name='176'>
       TYPE (domain) , POINTER :: grid<a name='177'>
       TYPE (grid_config_rec_type), INTENT(IN) :: config_flags<a name='178'>
     END SUBROUTINE med_shutdown_io_recurse<a name='179'>
   END INTERFACE<a name='180'>
<a name='181'>
  <font color=#447700>! Arguments<a name='182'></font>
   TYPE(domain), TARGET                       :: grid<a name='183'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='184'>
  <font color=#447700>! Local<a name='185'></font>
   TYPE(domain),POINTER                       :: grid_ptr<a name='186'>
   CHARACTER (LEN=80)      :: message<a name='187'>
   INTEGER                 :: id, ierr<a name='188'>
<a name='189'>
   IF ( grid%lbc_fid &gt; 0 ) CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_59"> ( grid%lbc_fid , config_flags , "DATASET=BOUNDARY" )<a name='190'>
<a name='191'>
   grid_ptr =&gt; grid<a name='192'>
   CALL <A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE'>med_shutdown_io_recurse</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SHUTDOWN_IO_RECURSE_1"> ( grid_ptr , config_flags )<a name='193'>
<a name='194'>
#if ( HWRF == 1 ) <a name='195'>
   DO id = 1, max_domains<a name='196'>
     IF( domain_active_this_task(id) ) THEN<a name='197'>
       CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_35">(id)<a name='198'>
       CALL <A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT'>wrf_ioexit</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_IOEXIT_1">( ierr )    <font color=#447700>! shut down the quilt I/O<a name='199'></font>
       CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_35"><a name='200'>
     ENDIF<a name='201'>
   ENDDO<a name='202'>
#else<a name='203'>
   CALL <A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT'>wrf_ioexit</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_IOEXIT_2">( ierr )    <font color=#447700>! shut down the quilt I/O<a name='204'></font>
#endif<a name='205'>
<a name='206'>
   RETURN<a name='207'>
<a name='208'>
END SUBROUTINE med_shutdown_io<a name='209'>
<a name='210'>
<A NAME='MED_SHUTDOWN_IO_RECURSE'><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='211'>
RECURSIVE <font color=#993300>SUBROUTINE </font><font color=#cc0000>med_shutdown_io_recurse</font> ( grid , config_flags ) <A href='../../call_to/MED_SHUTDOWN_IO_RECURSE.html' TARGET='index'>2</A>,<A href='../../call_from/MED_SHUTDOWN_IO_RECURSE.html' TARGET='index'>7</A><a name='212'>
  <font color=#447700>! Driver layer<a name='213'></font>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_415"><a name='214'>
   USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_48"><a name='215'>
  <font color=#447700>! Model layer<a name='216'></font>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_261"><a name='217'>
<a name='218'>
   IMPLICIT NONE<a name='219'>
<a name='220'>
  <font color=#447700>! Arguments<a name='221'></font>
   TYPE(domain), POINTER                      :: grid<a name='222'>
   TYPE (grid_config_rec_type) , INTENT(IN)   :: config_flags<a name='223'>
  <font color=#447700>! Local<a name='224'></font>
   TYPE(domain), POINTER                      :: grid_ptr<a name='225'>
   CHARACTER (LEN=80)      :: message<a name='226'>
   INTEGER                 :: kid<a name='227'>
   INTEGER                 :: ierr<a name='228'>
<a name='229'>
   IF ( ASSOCIATED( grid ) ) THEN<a name='230'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_36">(grid%id)<a name='231'>
     IF ( grid%oid &gt; 0 ) CALL <A href='../../html_code/share/module_io_domain.F.html#CLOSE_DATASET'>close_dataset</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLOSE_DATASET_60"> ( grid%oid , config_flags , "DATASET=HISTORY" )<a name='232'>
<font color=#447700>! registry generated closes for auxhist streams<a name='233'></font>
#    include "<A href='../../html_code/include/shutdown_closes.inc.html'>shutdown_closes.inc</A>"<A NAME="shutdown_closes.inc_2"><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='234'>
     grid_ptr =&gt; grid<a name='235'>
     DO WHILE ( ASSOCIATED( grid_ptr ) )<a name='236'>
       DO kid = 1, max_nests<a name='237'>
         IF ( ASSOCIATED( grid_ptr%nests(kid)%ptr ) ) THEN<a name='238'>
           CALL <A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE'>med_shutdown_io_recurse</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SHUTDOWN_IO_RECURSE_2"> ( grid_ptr%nests(kid)%ptr, config_flags )<a name='239'>
         ENDIF<a name='240'>
       ENDDO<a name='241'>
       grid_ptr =&gt; grid_ptr%sibling<a name='242'>
     ENDDO<a name='243'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_SHUTDOWN_IO_RECURSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_36"><a name='244'>
   ENDIF<a name='245'>
   RETURN<a name='246'>
END SUBROUTINE med_shutdown_io_recurse<a name='247'>
<a name='248'>
<a name='249'>
<A NAME='MED_ADD_CONFIG_INFO_TO_GRID'><A href='../../html_code/share/mediation_wrfmain.F.html#MED_ADD_CONFIG_INFO_TO_GRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='250'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_add_config_info_to_grid</font> ( grid ) <A href='../../call_to/MED_ADD_CONFIG_INFO_TO_GRID.html' TARGET='index'>2</A>,<A href='../../call_from/MED_ADD_CONFIG_INFO_TO_GRID.html' TARGET='index'>2</A><a name='251'>
<a name='252'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_ADD_CONFIG_INFO_TO_GRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_416"><a name='253'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_wrfmain.F.html#MED_ADD_CONFIG_INFO_TO_GRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_262"><a name='254'>
 <a name='255'>
   IMPLICIT NONE<a name='256'>
<a name='257'>
   <font color=#447700>!  Input data.<a name='258'></font>
<a name='259'>
   TYPE(domain) , TARGET          :: grid<a name='260'>
<a name='261'>
#define SOURCE_RECORD model_config_rec %<a name='262'>
#define SOURCE_REC_DEX (grid%id)<a name='263'>
#define DEST_RECORD   grid %<a name='264'>
#include "<A href='../../html_code/include/config_assigns.inc.html'>config_assigns.inc</A>"<A NAME="config_assigns.inc_3"><A href='../../html_code/share/mediation_wrfmain.F.html#MED_ADD_CONFIG_INFO_TO_GRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='265'>
<a name='266'>
   RETURN<a name='267'>
<a name='268'>
END SUBROUTINE med_add_config_info_to_grid<a name='269'>
<a name='270'>
</pre></body></html>