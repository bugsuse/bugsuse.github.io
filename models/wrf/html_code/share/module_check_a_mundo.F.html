<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!=======================================================================<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<A NAME='MODULE_CHECK_A_MUNDO'><A href='../../html_code/share/module_check_a_mundo.F.html#MODULE_CHECK_A_MUNDO' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='4'>
   <font color=#993300>MODULE </font><font color=#cc0000>module_check_a_mundo</font> <A href='../../call_to/MODULE_CHECK_A_MUNDO.html' TARGET='index'>5</A><a name='5'>
<a name='6'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='7'></font>
<font color=#447700>!<a name='8'></font>
<font color=#447700>! Contains subroutines that check the consistency of some namelist <a name='9'></font>
<font color=#447700>! settings. Some namelist settings depend on other values in the <a name='10'></font>
<font color=#447700>! namelist. The routine check_nml_consistency can detect quite a <a name='11'></font>
<font color=#447700>! few fatal inconsistencies. These are all bundled up as a convenience.<a name='12'></font>
<font color=#447700>! The fatal errors are reported, and after the routine completes, then<a name='13'></font>
<font color=#447700>! a single call to wrf_error_fatal is issued. The setup_physics_suite routine<a name='14'></font>
<font color=#447700>! has only one fatal call, so that routine does not need this user-<a name='15'></font>
<font color=#447700>! friendly concept of bundling errors. The set_physics_rconfigs <a name='16'></font>
<font color=#447700>! routine does not detect any problems that would result in a fatal<a name='17'></font>
<font color=#447700>! error, so the bundling of errors is also not required there.<a name='18'></font>
<font color=#447700>!<a name='19'></font>
<font color=#447700>!   SUBROUTINE check_nml_consistency :<a name='20'></font>
<font color=#447700>!      Check namelist settings for consistency<a name='21'></font>
<font color=#447700>!<a name='22'></font>
<font color=#447700>!   SUBROUTINE setup_physics_suite : <a name='23'></font>
<font color=#447700>!      Interpret user setting as referring to which supported schemes<a name='24'></font>
<font color=#447700>!      Currently: conus and tropical<a name='25'></font>
<font color=#447700>!<a name='26'></font>
<font color=#447700>!   SUBROUTINE set_physics_rconfigs :<a name='27'></font>
<font color=#447700>!      Check namelist settings that determine memory allocations.<a name='28'></font>
<font color=#447700>!<a name='29'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='30'></font>
<a name='31'>
      USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_check_a_mundo.F.html#module_check_a_mundo.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_191"><a name='32'>
      USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/share/module_check_a_mundo.F.html#module_check_a_mundo.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_106"><a name='33'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_check_a_mundo.F.html#module_check_a_mundo.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_264"><a name='34'>
<a name='35'>
      IMPLICIT NONE<a name='36'>
<a name='37'>
<font color=#447700>!=======================================================================<a name='38'></font>
<a name='39'>
   CONTAINS<a name='40'>
<a name='41'>
<font color=#447700>!=======================================================================<a name='42'></font>
<a name='43'>
<A NAME='CHECK_NML_CONSISTENCY'><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='44'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>check_nml_consistency</font> <A href='../../call_to/CHECK_NML_CONSISTENCY.html' TARGET='index'>5</A>,<A href='../../call_from/CHECK_NML_CONSISTENCY.html' TARGET='index'>150</A><a name='45'>
 <a name='46'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='47'></font>
<font color=#447700>!<a name='48'></font>
<font color=#447700>! Check consistency of namelist settings<a name='49'></font>
<font color=#447700>!<a name='50'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='51'></font>
<a name='52'>
      IMPLICIT NONE<a name='53'>
<a name='54'>
      LOGICAL :: exists, vnest<a name='55'>
      LOGICAL , EXTERNAL :: wrf_dm_on_monitor<a name='56'>
      INTEGER :: i, j, oops, d1_value<a name='57'>
      LOGICAL :: km_opt_already_done , diff_opt_already_done<a name='58'>
      INTEGER :: count_opt<a name='59'>
<a name='60'>
<font color=#447700>!TWG2015<a name='61'></font>
<font color=#447700>!<a name='62'></font>
<font color=#447700>!FASDAS<a name='63'></font>
<font color=#447700>!<a name='64'></font>
      LOGICAL :: rinblw_already_done<a name='65'>
<font color=#447700>!<a name='66'></font>
<font color=#447700>!END FASDAS<a name='67'></font>
<font color=#447700>!<a name='68'></font>
      INTEGER :: count_fatal_error<a name='69'>
<a name='70'>
<font color=#447700>!-----------------------------------------------------------------------<a name='71'></font>
<font color=#447700>! Set up the WRF Hydro namelist option to allow dynamic allocation of<a name='72'></font>
<font color=#447700>! variables.<a name='73'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='74'></font>
   count_fatal_error = 0<a name='75'>
#ifdef WRF_HYDRO<a name='76'>
   model_config_rec % wrf_hydro = 1<a name='77'>
#else<a name='78'>
   model_config_rec % wrf_hydro = 0<a name='79'>
#endif<a name='80'>
<a name='81'>
#if (NMM_CORE == 1) &amp;&amp; (NMM_NEST == 1)<a name='82'>
<font color=#447700>!-----------------------------------------------------------------------<a name='83'></font>
<font color=#447700>! Ensure that minimum NMM corral distances are supplied for all domains.<a name='84'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='85'></font>
   do i=1,model_config_rec%max_dom<a name='86'>
      if(model_config_rec%corral_x(i)&lt;5) then<a name='87'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1236">("Corral X distance must be at least 5 due to intermediate domain halos.")<a name='88'>
         model_config_rec%corral_x(i)=5<a name='89'>
      endif<a name='90'>
      if(model_config_rec%corral_y(i)&lt;5) then<a name='91'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1237">("Corral Y distance must be at least 5 due to intermediate domain halos.")<a name='92'>
         model_config_rec%corral_y(i)=5<a name='93'>
      endif<a name='94'>
    enddo<a name='95'>
#endif<a name='96'>
<a name='97'>
#if (EM_CORE == 1)<a name='98'>
<font color=#447700>!-----------------------------------------------------------------------<a name='99'></font>
<font color=#447700>! There are restrictions for the use_theta_m option:<a name='100'></font>
<font color=#447700>! 1. The option to include moist theta in the WRF solver only works with a single domain.<a name='101'></font>
<font color=#447700>! 2. The option may not be used in conjunction with damp_opt=2.<a name='102'></font>
<font color=#447700>! 3. The option may not be used with rad_nudge.<a name='103'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='104'></font>
<a name='105'>
      IF ( ( model_config_rec % use_theta_m .EQ. 1 ) .AND. &amp;<a name='106'>
           ( model_config_rec % damp_opt    .EQ. 2 ) ) THEN<a name='107'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1238"> ( "The use_theta_m option may not be paired with damp_opt=2." )<a name='108'>
         wrf_err_message = '--- ERROR: Either turn off use_theta_m, or select a different damp_opt option'<a name='109'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1008"> ( 0, TRIM( wrf_err_message ) )<a name='110'>
         count_fatal_error = count_fatal_error + 1<a name='111'>
      END IF<a name='112'>
<a name='113'>
      IF ( ( model_config_rec % use_theta_m .EQ. 1 ) .AND. &amp;<a name='114'>
           ( model_config_rec % rad_nudge   .EQ. 1 ) ) THEN<a name='115'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1239"> ( "The use_theta_m option may not be paired with rad_nudge=1." )<a name='116'>
         wrf_err_message = '--- ERROR: Either turn off use_theta_m, or turn off the rad_nudge option'<a name='117'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1009"> ( 0, TRIM( wrf_err_message ) )<a name='118'>
         count_fatal_error = count_fatal_error + 1<a name='119'>
      END IF<a name='120'>
<a name='121'>
<a name='122'>
<font color=#447700>!-----------------------------------------------------------------------<a name='123'></font>
<font color=#447700>! Check that all values of diff_opt and km_opt are filled in.  A flag<a name='124'></font>
<font color=#447700>! value of "-1" from the nml file means that this column (domain) is not<a name='125'></font>
<font color=#447700>! filled as a max_doamins variable.  Since we changed these two variables <a name='126'></font>
<font color=#447700>! from being single entries to max_domain entries, we need to do special <a name='127'></font>
<font color=#447700>! checking.  If there are missing values (if we find any -1 entries), we <a name='128'></font>
<font color=#447700>! fill those columns with the value from the entry from column (domain) #1.<a name='129'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='130'></font>
<a name='131'>
      km_opt_already_done = .FALSE.<a name='132'>
      diff_opt_already_done = .FALSE.<a name='133'>
      DO i = 2, model_config_rec % max_dom<a name='134'>
         IF ( model_config_rec % km_opt(i) .EQ. -1 ) THEN<a name='135'>
            model_config_rec % km_opt(i) = model_config_rec % km_opt(1)<a name='136'>
            IF ( .NOT. km_opt_already_done ) THEN<a name='137'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1240"> ( "Setting blank km_opt entries to domain #1 values.")<a name='138'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1241"> ( " --&gt; The km_opt entry in the namelist.input is now max_domains." )<a name='139'>
            END IF<a name='140'>
            km_opt_already_done = .TRUE.<a name='141'>
         END IF<a name='142'>
         IF ( model_config_rec % diff_opt(i) .EQ. -1 ) THEN<a name='143'>
            model_config_rec % diff_opt(i) = model_config_rec % diff_opt(1)<a name='144'>
            IF ( .NOT. diff_opt_already_done ) THEN<a name='145'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1242"> ( "Setting blank diff_opt entries to domain #1 values.")<a name='146'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1243"> ( " --&gt; The diff_opt entry in the namelist.input is now max_domains." )<a name='147'>
            END IF<a name='148'>
            diff_opt_already_done = .TRUE.<a name='149'>
         END IF<a name='150'>
      ENDDO<a name='151'>
<a name='152'>
<a name='153'>
<font color=#447700>!-----------------------------------------------------------------------<a name='154'></font>
<font color=#447700>! Check that km_opt and diff_opt are not -1.  If the first column is set<a name='155'></font>
<font color=#447700>! to -1, that means this entry is NOT in the namelist file at all.<a name='156'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='157'></font>
<a name='158'>
      IF ( ( model_config_rec %   km_opt(1) .EQ. -1 ) .OR. &amp;<a name='159'>
           ( model_config_rec % diff_opt(1) .EQ. -1 ) ) THEN<a name='160'>
            wrf_err_message = '--- ERROR: Both km_opt and diff_opt need to be set in the namelist.input file.'<a name='161'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1010"> ( 0, TRIM( wrf_err_message ) )<a name='162'>
         count_fatal_error = count_fatal_error + 1<a name='163'>
      END IF<a name='164'>
<a name='165'>
<a name='166'>
#endif<a name='167'>
<a name='168'>
<font color=#447700>!-----------------------------------------------------------------------<a name='169'></font>
<font color=#447700>! Check that NSSL microphysics is not allowed for WRF-NMM run <a name='170'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='171'></font>
#if (NMM_CORE == 1) || (HWRF == 1) <a name='172'>
      DO i = 1, model_config_rec % max_dom<a name='173'>
         IF ( model_config_rec % mp_physics(i) == nssl_2mom .OR. &amp;<a name='174'>
              model_config_rec % mp_physics(i) == nssl_2momccn .OR. &amp; <a name='175'>
              model_config_rec % mp_physics(i) == nssl_1mom .OR. &amp; <a name='176'>
              model_config_rec % mp_physics(i) == nssl_1momlfo .OR. &amp; <a name='177'>
              model_config_rec % mp_physics(i) == nssl_2momg ) THEN <a name='178'>
            wrf_err_message = '--- ERROR: Chosen microphysics scheme cannot run with WRF-NMM '<a name='179'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1244"> ( wrf_err_message )<a name='180'>
            wrf_err_message = '--- Fix mp_physics in namelist.input '<a name='181'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1011"> ( 0, TRIM( wrf_err_message ) )<a name='182'>
         count_fatal_error = count_fatal_error + 1<a name='183'>
         END IF<a name='184'>
      ENDDO<a name='185'>
#endif<a name='186'>
<a name='187'>
<font color=#447700>!-----------------------------------------------------------------------<a name='188'></font>
<font color=#447700>! Check that all values of sf_surface_physics are the same for all domains<a name='189'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='190'></font>
<a name='191'>
      DO i = 2, model_config_rec % max_dom<a name='192'>
         IF ( model_config_rec % sf_surface_physics(i)     .NE. &amp;<a name='193'>
              model_config_rec % sf_surface_physics(1) ) THEN<a name='194'>
            wrf_err_message = '--- ERROR: sf_surface_physics must be equal for all domains '<a name='195'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1245"> ( wrf_err_message )<a name='196'>
            wrf_err_message = '--- Fix sf_surface_physics in namelist.input '<a name='197'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1012"> ( 0, TRIM( wrf_err_message ) )<a name='198'>
         count_fatal_error = count_fatal_error + 1<a name='199'>
         END IF<a name='200'>
      ENDDO<a name='201'>
<a name='202'>
<a name='203'>
<font color=#447700>!-----------------------------------------------------------------------<a name='204'></font>
<font color=#447700>! Check that all values of sf_sfclay_physics are the same for all domains<a name='205'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='206'></font>
<a name='207'>
      DO i = 2, model_config_rec % max_dom<a name='208'>
         IF ( model_config_rec % sf_sfclay_physics(i)     .NE. &amp;<a name='209'>
              model_config_rec % sf_sfclay_physics(1) ) THEN<a name='210'>
            wrf_err_message = '--- ERROR: sf_sfclay_physics must be equal for all domains '<a name='211'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1246"> ( wrf_err_message )<a name='212'>
            wrf_err_message = '--- Fix sf_sfclay_physics in namelist.input '<a name='213'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1013"> ( 0, TRIM( wrf_err_message ) )<a name='214'>
         count_fatal_error = count_fatal_error + 1<a name='215'>
         END IF<a name='216'>
      ENDDO<a name='217'>
<a name='218'>
<a name='219'>
<font color=#447700>!-----------------------------------------------------------------------<a name='220'></font>
<font color=#447700>! Check that all values of mp_physics are the same for all domains<a name='221'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='222'></font>
<a name='223'>
      DO i = 2, model_config_rec % max_dom<a name='224'>
         IF ( model_config_rec % mp_physics(i)     .NE. &amp;<a name='225'>
              model_config_rec % mp_physics(1) ) THEN<a name='226'>
            wrf_err_message = '--- NOTE: mp_physics must be equal for all domains '<a name='227'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1247"> ( wrf_err_message )<a name='228'>
            wrf_err_message = '--- NOTE:     ----&gt; Setting all mp_physics entries to value defined in the inner most domain'<a name='229'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1248"> ( TRIM( wrf_err_message ) )<a name='230'>
         END IF<a name='231'>
      ENDDO<a name='232'>
      d1_value = model_config_rec%mp_physics(model_config_rec % max_dom)<a name='233'>
      DO i = 1, model_config_rec % max_dom-1<a name='234'>
         model_config_rec%mp_physics(i) = d1_value<a name='235'>
      END DO<a name='236'>
<a name='237'>
<a name='238'>
<font color=#447700>!-----------------------------------------------------------------------<a name='239'></font>
<font color=#447700>! Check that all values of ra_physics are the same for all domains<a name='240'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='241'></font>
<a name='242'>
      DO i = 2, model_config_rec % max_dom<a name='243'>
         IF ( model_config_rec % ra_lw_physics(i)     .NE. &amp;<a name='244'>
              model_config_rec % ra_lw_physics(1) ) THEN<a name='245'>
            wrf_err_message = '--- ERROR: ra_lw_physics must be equal for all domains '<a name='246'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1249"> ( wrf_err_message )<a name='247'>
            wrf_err_message = '--- Fix ra_lw_physics in namelist.input '<a name='248'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1014"> ( 0, TRIM( wrf_err_message ) )<a name='249'>
         count_fatal_error = count_fatal_error + 1<a name='250'>
         END IF<a name='251'>
      ENDDO<a name='252'>
<a name='253'>
      DO i = 2, model_config_rec % max_dom<a name='254'>
         IF ( model_config_rec % ra_sw_physics(i)     .NE. &amp;<a name='255'>
              model_config_rec % ra_sw_physics(1) ) THEN<a name='256'>
            wrf_err_message = '--- ERROR: ra_sw_physics must be equal for all domains '<a name='257'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1250"> ( wrf_err_message )<a name='258'>
            wrf_err_message = '--- Fix ra_sw_physics in namelist.input '<a name='259'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1015"> ( 0, TRIM( wrf_err_message ) )<a name='260'>
         count_fatal_error = count_fatal_error + 1<a name='261'>
         END IF<a name='262'>
      ENDDO<a name='263'>
<a name='264'>
<a name='265'>
<font color=#447700>!------------------------------------------------------------------------------<a name='266'></font>
<font color=#447700>! Check that a value for time_step is given, and is not just set to default (-1)<a name='267'></font>
<font color=#447700>!------------------------------------------------------------------------------<a name='268'></font>
<a name='269'>
         IF ( ( model_config_rec % use_wps_input == 0 ) .AND. &amp;<a name='270'>
              ( model_config_rec % time_step .EQ. -1 ) ) THEN<a name='271'>
<a name='272'>
            wrf_err_message = '--- ERROR: Known problem.  time_step must be set to a positive integer'<a name='273'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1016"> ( 0, TRIM( wrf_err_message ) )<a name='274'>
         count_fatal_error = count_fatal_error + 1<a name='275'>
<a name='276'>
         END IF<a name='277'>
<a name='278'>
<font color=#447700>!-----------------------------------------------------------------------<a name='279'></font>
<font color=#447700>! Check that all values of bl_pbl_physics are the same for all domains<a name='280'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='281'></font>
<a name='282'>
      DO i = 2, model_config_rec % max_dom<a name='283'>
         IF ( ( model_config_rec % bl_pbl_physics(i) .NE. model_config_rec % bl_pbl_physics(1) ) .AND. &amp;<a name='284'>
              ( model_config_rec % bl_pbl_physics(i) .NE. 0                                    ) ) THEN<a name='285'>
            wrf_err_message = '--- ERROR: bl_pbl_physics must be equal for all domains (or = zero)'<a name='286'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1251"> ( wrf_err_message )<a name='287'>
            wrf_err_message = '--- Fix bl_pbl_physics in namelist.input '<a name='288'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1017"> ( 0, TRIM( wrf_err_message ) )<a name='289'>
         count_fatal_error = count_fatal_error + 1<a name='290'>
         END IF<a name='291'>
      ENDDO<a name='292'>
<a name='293'>
<a name='294'>
<font color=#447700>!-----------------------------------------------------------------------<a name='295'></font>
<font color=#447700>! Check that all values of cu_physics are the same for all domains<a name='296'></font>
<font color=#447700>! Note that a zero option is OK.<a name='297'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='298'></font>
<a name='299'>
      DO i = 2, model_config_rec % max_dom<a name='300'>
         IF ( ( model_config_rec % cu_physics(i) .NE. model_config_rec % cu_physics(1) ) .AND. &amp;<a name='301'>
              ( model_config_rec % cu_physics(i) .NE. 0                                ) ) THEN<a name='302'>
            wrf_err_message = '--- ERROR: cu_physics must be equal for all domains (or = zero)'<a name='303'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1252"> ( wrf_err_message )<a name='304'>
            wrf_err_message = '--- Fix cu_physics in namelist.input '<a name='305'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1018"> ( 0, TRIM( wrf_err_message ) )<a name='306'>
         count_fatal_error = count_fatal_error + 1<a name='307'>
         END IF<a name='308'>
      ENDDO<a name='309'>
<a name='310'>
<a name='311'>
#if ( defined NO_GAMMA_SUPPORT )<a name='312'>
<font color=#447700>!-----------------------------------------------------------------------<a name='313'></font>
<font color=#447700>! GF CU scheme requires an intrinsic gamma function. This is a 2008<a name='314'></font>
<font color=#447700>! feature that not all compilers yet support.<a name='315'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='316'></font>
<a name='317'>
      GF_test : DO i = 1, model_config_rec % max_dom<a name='318'>
         IF ( model_config_rec % cu_physics(i) .EQ. GFSCHEME ) THEN<a name='319'>
            wrf_err_message = '--- ERROR: cu_physics GF uses an intrinsic gamma function that is not available with this compiler'<a name='320'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1253"> ( TRIM( wrf_err_message ) )<a name='321'>
            wrf_err_message = '--- Change compilers, or change cu_physics option in the namelist.input file.'<a name='322'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1254"> ( TRIM( wrf_err_message ) )<a name='323'>
            count_fatal_error = count_fatal_error + 1<a name='324'>
            EXIT GF_test<a name='325'>
         END IF<a name='326'>
      ENDDO GF_test<a name='327'>
#endif<a name='328'>
<a name='329'>
<font color=#447700>!-----------------------------------------------------------------------<a name='330'></font>
<font color=#447700>! If fractional_seaice = 0, and tice2tsk_if2cold = .true, nothing will happen<a name='331'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='332'></font>
<a name='333'>
      IF ( ( model_config_rec%fractional_seaice .EQ. 0 ).AND. &amp;<a name='334'>
              ( model_config_rec%tice2tsk_if2cold ) ) THEN<a name='335'>
            wrf_err_message = '--- WARNING: You set tice2tsk_if2cold = .true.,  but fractional_seaice = 0'<a name='336'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1255"> ( wrf_err_message )<a name='337'>
            wrf_err_message = '--- WARNING: tice2tsk_if2cold will have no effect on results.'<a name='338'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1256"> ( wrf_err_message )<a name='339'>
      END IF<a name='340'>
<a name='341'>
<font color=#447700>!-----------------------------------------------------------------------<a name='342'></font>
<font color=#447700>! Check that if fine_input_stream /= 0, io_form_auxinput2 must also be in use<a name='343'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='344'></font>
<a name='345'>
      DO i = 1, model_config_rec % max_dom<a name='346'>
         IF ( ( model_config_rec%fine_input_stream(i) .NE. 0 ).AND. &amp;<a name='347'>
              ( model_config_rec%io_form_auxinput2 .EQ. 0 ) ) THEN<a name='348'>
            wrf_err_message = '--- ERROR: If fine_input_stream /= 0, io_form_auxinput2 must be /= 0'<a name='349'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1257"> ( wrf_err_message )<a name='350'>
            wrf_err_message = '--- Set io_form_auxinput2 in the time_control namelist (probably to 2).'<a name='351'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1019"> ( 0, TRIM( wrf_err_message ) )<a name='352'>
         count_fatal_error = count_fatal_error + 1<a name='353'>
         END IF<a name='354'>
      ENDDO<a name='355'>
<a name='356'>
#if (EM_CORE == 1)<a name='357'>
<a name='358'>
<font color=#447700>!-----------------------------------------------------------------------<a name='359'></font>
<font color=#447700>! Check that if num_metgrid_levels &lt; 20, lagrange_order should be 1<a name='360'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='361'></font>
            IF  ( model_config_rec%num_metgrid_levels .LE. 20 ) THEN<a name='362'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1258"> ( 'Linear vertical interpolation is recommended with input vertical resolution this coarse, changing lagrange_order to 1' )<a name='363'>
            model_config_rec%lagrange_order = 1<a name='364'>
            END IF<a name='365'>
<a name='366'>
<font color=#447700>!-----------------------------------------------------------------------<a name='367'></font>
<font color=#447700>! Check for domain consistency for urban options.<a name='368'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='369'></font>
<a name='370'>
      d1_value = model_config_rec%sf_urban_physics(1)<a name='371'>
      DO i = 2, model_config_rec % max_dom<a name='372'>
         IF ( model_config_rec%sf_urban_physics(i) /= d1_value ) THEN<a name='373'>
            WRITE(wrf_err_message, * ) '--- NOTE:   sf_urban_physics option must be identical in each domain'<a name='374'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1259"> ( TRIM ( wrf_err_message ) )<a name='375'>
            WRITE(wrf_err_message, * ) '--- NOTE:   ----&gt; Resetting namelist values to that defined on the inner most domain'<a name='376'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1260"> ( TRIM ( wrf_err_message ) )<a name='377'>
         ENDIF<a name='378'>
      END DO<a name='379'>
      d1_value = model_config_rec%sf_urban_physics(model_config_rec % max_dom)<a name='380'>
      DO i = 1, model_config_rec % max_dom-1<a name='381'>
         model_config_rec%sf_urban_physics(i) = d1_value<a name='382'>
      END DO<a name='383'>
<a name='384'>
<font color=#447700>!------------------------------------------------------------------------<a name='385'></font>
<font color=#447700>! Mills (2011) sea-ice albedo treatment only for Noah LSM and Noah-MP LSM<a name='386'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='387'></font>
      IF ( model_config_rec%seaice_albedo_opt == 1 ) THEN<a name='388'>
         DO i = 1, model_config_rec % max_dom<a name='389'>
            IF ( ( model_config_rec%sf_surface_physics(i) /= LSMSCHEME ) .AND. &amp;<a name='390'>
                 ( model_config_rec%sf_surface_physics(i) /= NOAHMPSCHEME ) ) THEN<a name='391'>
<a name='392'>
               write (wrf_err_message, '(" --- ERROR:   seaice_albedo_opt == 1 works only with ")')<a name='393'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1261"> ( TRIM ( wrf_err_message ) )<a name='394'>
               write (wrf_err_message, '("              sf_surface_physics == ", I2, " (Noah) or ", I2, " (Noah-MP).")') &amp;<a name='395'>
               LSMSCHEME, NOAHMPSCHEME<a name='396'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1020"> ( 0, TRIM( wrf_err_message ) )<a name='397'>
         count_fatal_error = count_fatal_error + 1<a name='398'>
<a name='399'>
            END IF<a name='400'>
            <a name='401'>
         END DO<a name='402'>
<a name='403'>
      END IF<a name='404'>
<a name='405'>
<a name='406'>
#endif<a name='407'>
<a name='408'>
#if (NMM_CORE == 1) || (HWRF == 1)<a name='409'>
<font color=#447700>!-----------------------------------------------------------------------<a name='410'></font>
<font color=#447700>!           Check that NOAH-MP LSM is not allowed for WRF-NMM run <a name='411'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='412'></font>
      DO i = 1, model_config_rec % max_dom<a name='413'>
         IF ( model_config_rec%sf_surface_physics(i) == NOAHMPSCHEME ) THEN<a name='414'>
            WRITE(wrf_err_message, '(" --- ERROR:   Noah-MP LSM scheme (sf_surface_physics==", I2, ")")') NOAHMPSCHEME<a name='415'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1262"> ( TRIM ( wrf_err_message ) )<a name='416'>
            WRITE(wrf_err_message, '("              does not work with NMM ")')<a name='417'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1263"> ( TRIM ( wrf_err_message ) )<a name='418'>
            WRITE(wrf_err_message, '("Select a different LSM scheme ")')<a name='419'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1021"> ( 0, TRIM( wrf_err_message ) )<a name='420'>
         count_fatal_error = count_fatal_error + 1<a name='421'>
         END IF<a name='422'>
      END DO<a name='423'>
#endif<a name='424'>
<a name='425'>
#if (EM_CORE == 1)<a name='426'>
<a name='427'>
<font color=#447700>!-----------------------------------------------------------------------<a name='428'></font>
<font color=#447700>! Check if any stochastic perturbation scheme is turned on in any domain,<a name='429'></font>
<font color=#447700>! if so, set derived variable sppt_on=1 and/or rand_perturb_on and/or skebs_on=1<a name='430'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='431'></font>
<a name='432'>
   DO i = 1, model_config_rec % max_dom<a name='433'>
         IF ( model_config_rec % sppt(i) .ne. 0)  then<a name='434'>
           model_config_rec % sppt_on=1<a name='435'>
           IF (( model_config_rec%KMINFORCT .ne. 1) .or. (model_config_rec%KMAXFORCT .ne. 1000000) .or.   &amp; <a name='436'>
               ( model_config_rec%LMINFORCT .ne. 1) .or. (model_config_rec%LMAXFORCT .ne. 1000000)) then    <a name='437'>
               wrf_err_message = '--- Warning: the namelist parameter "kminforct" etc. are for SKEBS only'<a name='438'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1264"> ( wrf_err_message )<a name='439'>
               wrf_err_message = '             and should not be changed from their default value for SPPT' <a name='440'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1265"> ( wrf_err_message )<a name='441'>
               wrf_err_message = '--- ERROR: If you really want to modify "kminforct" etc.,  edit module_check a_mundo.'<a name='442'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1022"> ( 0, TRIM( wrf_err_message ) )<a name='443'>
               count_fatal_error = count_fatal_error + 1<a name='444'>
           endif<a name='445'>
         endif<a name='446'>
   ENDDO<a name='447'>
   DO i = 1, model_config_rec % max_dom<a name='448'>
         IF ( model_config_rec % rand_perturb(i) .ne. 0)  then<a name='449'>
           model_config_rec % rand_perturb_on=1<a name='450'>
           IF (( model_config_rec%KMINFORCT .ne. 1) .or. (model_config_rec%KMAXFORCT .ne. 1000000) .or.   &amp; <a name='451'>
               ( model_config_rec%LMINFORCT .ne. 1) .or. (model_config_rec%LMAXFORCT .ne. 1000000)) then    <a name='452'>
               wrf_err_message = '--- Warning: the namelist parameter "kminforct" etc are for SKEBS only'<a name='453'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1266"> ( wrf_err_message )<a name='454'>
               wrf_err_message = '             and should not be changed from their default value for RAND_PERTURB' <a name='455'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1267"> ( wrf_err_message )<a name='456'>
               wrf_err_message = '--- ERROR: If you really want to modify "kminforct" etc.,  edit module_check a_mundo.'<a name='457'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1023"> ( 0, TRIM( wrf_err_message ) )<a name='458'>
               count_fatal_error = count_fatal_error + 1<a name='459'>
           endif<a name='460'>
         endif<a name='461'>
   ENDDO<a name='462'>
   DO i = 1, model_config_rec % max_dom<a name='463'>
         IF (( model_config_rec % spp_conv(i) .ne. 0).or.( model_config_rec % spp_pbl(i) .ne. 0).or. (model_config_rec % spp_lsm(i) .ne. 0)  &amp; <a name='464'>
           .or. ( model_config_rec % spp(i) .ne. 0))  then<a name='465'>
           model_config_rec % spp_on=1<a name='466'>
           IF (( model_config_rec%KMINFORCT .ne. 1) .or. (model_config_rec%KMAXFORCT .ne. 1000000) .or.   &amp; <a name='467'>
               ( model_config_rec%LMINFORCT .ne. 1) .or. (model_config_rec%LMAXFORCT .ne. 1000000)) then    <a name='468'>
               wrf_err_message = '--- Warning: the namelist parameter "kminforct" etc are for SKEBS only'<a name='469'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1268"> ( wrf_err_message )<a name='470'>
               wrf_err_message = '             and should not be changed from their default value for RAND_PERTURB' <a name='471'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1269"> ( wrf_err_message )<a name='472'>
               wrf_err_message = '--- ERROR: If you really want to modify "kminforct" etc.,  edit module_check a_mundo.'<a name='473'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1024"> ( 0, TRIM( wrf_err_message ) )<a name='474'>
               count_fatal_error = count_fatal_error + 1<a name='475'>
           endif<a name='476'>
         endif<a name='477'>
         IF ( model_config_rec % spp(i) .ne. 0)  then<a name='478'>
           model_config_rec % spp_conv=1<a name='479'>
           model_config_rec % spp_pbl=1<a name='480'>
           model_config_rec % spp_lsm=1<a name='481'>
         endif<a name='482'>
   ENDDO<a name='483'>
   DO i = 1, model_config_rec % max_dom<a name='484'>
         IF ( model_config_rec % stoch_vertstruc_opt(i) ==1 )  then<a name='485'>
           model_config_rec % skebs_vertstruc=1       <font color=#447700>! parameter stoch_vertstruc_opt is being replaced with skebs_vertstruc<a name='486'></font>
                                                      <font color=#447700>! stoch_vertstruc_opt is obsolete starting with V3.7<a name='487'></font>
           wrf_err_message = '--- WARNING: the namelist parameter "stoch_vertstruc_opt" is obsolete.'<a name='488'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1270"> ( wrf_err_message )<a name='489'>
           wrf_err_message = '             Please replace with namelist parameter "skebs_vertstruc" in V3.7 and later versions.'<a name='490'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1271"> ( wrf_err_message )<a name='491'>
         endif<a name='492'>
   ENDDO<a name='493'>
<a name='494'>
   DO i = 1, model_config_rec % max_dom<a name='495'>
         IF ( model_config_rec % stoch_force_opt(i) ==1 )  then<a name='496'>
           model_config_rec % skebs(i)=1    <font color=#447700>! parameter stoch_forc_opt is being replaced with skebs;<a name='497'></font>
                                            <font color=#447700>! stoch_vertstruc_opt is obsolete starting with V3.7<a name='498'></font>
           wrf_err_message = '--- WARNING: the namelist parameter "stoch_force_opt" is obsolete.'<a name='499'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1272"> ( wrf_err_message )<a name='500'>
           wrf_err_message = '             Please replace with namelist parameter "skebs" in V3.7 and later versions.'<a name='501'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1273"> ( wrf_err_message )<a name='502'>
         endif<a name='503'>
   ENDDO<a name='504'>
   DO i = 1, model_config_rec % max_dom<a name='505'>
         IF ( model_config_rec % skebs(i) .ne. 0)  then<a name='506'>
           model_config_rec % skebs_on=1<a name='507'>
         endif<a name='508'>
   ENDDO<a name='509'>
<a name='510'>
<font color=#447700>!-----------------------------------------------------------------------<a name='511'></font>
<font color=#447700>! Random fields are by default thin 3D arrays (:,1,:).<a name='512'></font>
<font color=#447700>! If random fields have vertical structures (stoch_vertstruc_opt .ne. 0)<a name='513'></font>
<font color=#447700>! make them full 3D array arrays<a name='514'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='515'></font>
   IF ( model_config_rec % skebs_vertstruc     .ne. 99 )  then<a name='516'>
      model_config_rec % num_stoch_levels = model_config_rec %e_vert(1)<a name='517'>
   ENDIF<a name='518'>
   IF ( model_config_rec % sppt_vertstruc      .ne. 99 )  then<a name='519'>
      model_config_rec % num_stoch_levels = model_config_rec %e_vert(1)<a name='520'>
   ENDIF<a name='521'>
   IF ( model_config_rec % rand_pert_vertstruc .ne. 99 )  then<a name='522'>
      model_config_rec % num_stoch_levels = model_config_rec %e_vert(1)<a name='523'>
   ENDIF<a name='524'>
<a name='525'>
<font color=#447700>!--------------------------------------------------------------------------------<a name='526'></font>
<font color=#447700>! Check if boundary perturbations is turned on and set to '1' (perturb_bdy=1).<a name='527'></font>
<font color=#447700>! If so, make sure skebs_on is also turned on.<a name='528'></font>
<font color=#447700>!--------------------------------------------------------------------------------<a name='529'></font>
   IF ( model_config_rec % perturb_bdy .EQ. 1 ) then<a name='530'>
        model_config_rec % skebs_on=1<a name='531'>
      wrf_err_message = '--- WARNING: perturb_bdy=1 option uses SKEBS pattern and may'<a name='532'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1274"> ( wrf_err_message )<a name='533'>
      wrf_err_message = '             increase computation time.'<a name='534'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1275"> ( wrf_err_message )<a name='535'>
   ENDIF<a name='536'>
<a name='537'>
<font color=#447700>!--------------------------------------------------------------------------------<a name='538'></font>
<font color=#447700>! Check if chemistry boundary perturbations is turned on and set to '1' (perturb_chem_bdy=1).<a name='539'></font>
<font color=#447700>! If so, make sure rand_perturb_on is also turned on.<a name='540'></font>
<font color=#447700>! perturb_chem_bdy can be turned on only if WRF_CHEM is also compiled.<a name='541'></font>
<font color=#447700>! If perturb_chem_bdy=1, then have_bcs_chem should be turned on as well.<a name='542'></font>
<font color=#447700>!--------------------------------------------------------------------------------<a name='543'></font>
<a name='544'>
   IF ( model_config_rec % perturb_chem_bdy .EQ. 1 ) then<a name='545'>
<a name='546'>
#if (WRF_CHEM <font color=#447700>!= 1)<a name='547'></font>
      wrf_err_message = '--- ERROR: This option is only for WRF_CHEM.'<a name='548'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1025"> ( 0, TRIM( wrf_err_message ) )<a name='549'>
         count_fatal_error = count_fatal_error + 1<a name='550'>
#endif<a name='551'>
<a name='552'>
      model_config_rec % rand_perturb_on=1<a name='553'>
      wrf_err_message = '--- WARNING: perturb_chem_bdy=1 option uses RAND pattern and may'<a name='554'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1276"> ( wrf_err_message )<a name='555'>
      wrf_err_message = '             increase computation time.'<a name='556'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1277"> ( wrf_err_message )<a name='557'>
<a name='558'>
#if (WRF_CHEM == 1)<a name='559'>
      IF ( .NOT. model_config_rec % have_bcs_chem(1) ) THEN<a name='560'>
            wrf_err_message = '--- ERROR: This perturb_chem_bdy option needs '// &amp;<a name='561'>
                              'have_bcs_chem = .true. in chem.'<a name='562'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1026"> ( 0, TRIM( wrf_err_message ) )<a name='563'>
         count_fatal_error = count_fatal_error + 1<a name='564'>
      ENDIF<a name='565'>
#endif<a name='566'>
<a name='567'>
   ENDIF<a name='568'>
<a name='569'>
<font color=#447700>!----------------------------------------------------------------------------<a name='570'></font>
<font color=#447700>! If trajectory option is turned off, make sure the number of trajectories is<a name='571'></font>
<font color=#447700>! zero.<a name='572'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='573'></font>
   IF ( ( model_config_rec%traj_opt .EQ. 0 ) .AND. &amp;<a name='574'>
        ( model_config_rec%num_traj .NE. 0 ) ) THEN<a name='575'>
         WRITE (wrf_err_message, FMT='(A,A)') '--- WARNING: traj_opt is zero, but ', &amp;<a name='576'>
                'num_traj is not zero; setting num_traj to zero.'<a name='577'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1278"> ( wrf_err_message )<a name='578'>
         model_config_rec%num_traj = 0 <a name='579'>
   END IF<a name='580'>
<a name='581'>
#elif( NMM_CORE == 1 )<a name='582'>
<font color=#447700>!----------------------------------------------------------------------------<a name='583'></font>
<font color=#447700>! If NMM core and trajectories are on then halt.<a name='584'></font>
<font color=#447700>!----------------------------------------------------------------------------<a name='585'></font>
   IF ( model_config_rec%traj_opt /= 0 ) THEN<a name='586'>
         wrf_err_message = 'Trajectories not supported in NMM core '<a name='587'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1027"> ( 0, TRIM( wrf_err_message ) )<a name='588'>
         count_fatal_error = count_fatal_error + 1<a name='589'>
   END IF<a name='590'>
#endif<a name='591'>
<a name='592'>
#if (EM_CORE == 1)<a name='593'>
<font color=#447700>!-----------------------------------------------------------------------<a name='594'></font>
<font color=#447700>! In program real, if hypsometric_opt = 2, adjust_heights cannot be set to .true. <a name='595'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='596'></font>
      IF ( model_config_rec%hypsometric_opt .EQ. 2 &amp;<a name='597'>
           .AND. model_config_rec%adjust_heights ) THEN<a name='598'>
           WRITE (wrf_err_message, FMT='(A,A)') '--- NOTE: hypsometric_opt is 2, ', &amp;<a name='599'>
                  'setting adjust_heights = F'<a name='600'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1279"> ( wrf_err_message )<a name='601'>
            model_config_rec%adjust_heights = .false.<a name='602'>
      ENDIF<a name='603'>
#endif<a name='604'>
<a name='605'>
#if (EM_CORE == 1)<a name='606'>
<font color=#447700>!-----------------------------------------------------------------------<a name='607'></font>
<font color=#447700>! cu_physics = 11 (scale-aware KF) only works with YSU PBL.<a name='608'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='609'></font>
<a name='610'>
      oops = 0<a name='611'>
      DO i = 1, model_config_rec % max_dom<a name='612'>
         IF ( ( model_config_rec%bl_pbl_physics(i) .NE. YSUSCHEME ) .AND. &amp;<a name='613'>
              ( model_config_rec%cu_physics(i) .EQ. MSKFSCHEME ) ) THEN<a name='614'>
            oops = oops + 1<a name='615'>
         END IF<a name='616'>
      ENDDO      <font color=#447700>! Loop over domains<a name='617'></font>
      IF ( oops .GT. 0 ) THEN<a name='618'>
         wrf_err_message = '--- ERROR: bl_pbl_physics must be set to 1 for cu_physics = 11 '<a name='619'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1280"> ( wrf_err_message )<a name='620'>
         wrf_err_message = '--- Fix bl_pbl_physics in namelist.input OR use another cu_physics option '<a name='621'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1028"> ( 0, TRIM( wrf_err_message ) )<a name='622'>
         count_fatal_error = count_fatal_error + 1<a name='623'>
      END IF<a name='624'>
<a name='625'>
      DO i = 1, model_config_rec % max_dom<a name='626'>
         IF ( model_config_rec%cu_physics(i) .EQ. MSKFSCHEME ) THEN<a name='627'>
            WRITE (wrf_err_message, FMT='(A,A)') '--- NOTE: cu_physics is 11, ', &amp;<a name='628'>
                  'setting icloud = 1 and cu_rad_feedback = T'<a name='629'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1281"> ( wrf_err_message )<a name='630'>
            model_config_rec%cu_rad_feedback(i) = .true.<a name='631'>
            model_config_rec%icloud = 1<a name='632'>
         END IF<a name='633'>
      ENDDO<a name='634'>
<a name='635'>
#endif<a name='636'>
<a name='637'>
<font color=#447700>!-----------------------------------------------------------------------<a name='638'></font>
<font color=#447700>! If sst_update = 0, set io_form_auxinput4 to 0 so WRF will not try to<a name='639'></font>
<font color=#447700>! input the data; auxinput_interval must also be 0<a name='640'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='641'></font>
<a name='642'>
      IF ( model_config_rec%sst_update .EQ. 0 ) THEN<a name='643'>
         model_config_rec%io_form_auxinput4 = 0<a name='644'>
         DO i = 1, model_config_rec % max_dom<a name='645'>
            WRITE (wrf_err_message, FMT='(A,A)') '--- NOTE: sst_update is 0, ', &amp;<a name='646'>
                  'setting io_form_auxinput4 = 0 and auxinput4_interval = 0 for all domains'<a name='647'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1282"> ( wrf_err_message )<a name='648'>
            model_config_rec%auxinput4_interval(i)   = 0<a name='649'>
            model_config_rec%auxinput4_interval_y(i) = 0<a name='650'>
            model_config_rec%auxinput4_interval_d(i) = 0<a name='651'>
            model_config_rec%auxinput4_interval_h(i) = 0<a name='652'>
            model_config_rec%auxinput4_interval_m(i) = 0<a name='653'>
            model_config_rec%auxinput4_interval_s(i) = 0<a name='654'>
         ENDDO<a name='655'>
      ELSE<a name='656'>
         IF ( model_config_rec%io_form_auxinput4 .EQ. 0 ) THEN<a name='657'>
            wrf_err_message = '--- ERROR: If sst_update /= 0, io_form_auxinput4 must be /= 0'<a name='658'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1283"> ( wrf_err_message )<a name='659'>
            wrf_err_message = '--- Set io_form_auxinput4 in the time_control namelist (probably to 2).'<a name='660'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1029"> ( 0, TRIM( wrf_err_message ) )<a name='661'>
         count_fatal_error = count_fatal_error + 1<a name='662'>
         END IF<a name='663'>
      END IF<a name='664'>
<a name='665'>
<font color=#447700>!-----------------------------------------------------------------------<a name='666'></font>
<font color=#447700>! If sst_update = 1, we need to make sure that two nml items are set:<a name='667'></font>
<font color=#447700>!   1. io_form_auxinput4 = 2 (only for one domain)<a name='668'></font>
<font color=#447700>!   2. auxinput4_interval = NON-ZERO (just check most coarse domain)<a name='669'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='670'></font>
<a name='671'>
      IF ( model_config_rec%sst_update .EQ. 1 ) THEN<a name='672'>
         IF ( model_config_rec%io_form_auxinput4 .EQ. 0 ) THEN<a name='673'>
            wrf_err_message = '--- ERROR: If sst_update /= 0, io_form_auxinput4 must be /= 0'<a name='674'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1030"> ( 0, TRIM(wrf_err_message) )<a name='675'>
            wrf_err_message = '--- Set io_form_auxinput4 in the time_control namelist (probably to 2).'<a name='676'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1031"> ( 0, TRIM( wrf_err_message ) )<a name='677'>
            count_fatal_error = count_fatal_error + 1<a name='678'>
         END IF<a name='679'>
<a name='680'>
         IF ( ( model_config_rec%auxinput4_interval(1)   .EQ. 0 ) .AND. &amp; <a name='681'>
              ( model_config_rec%auxinput4_interval_y(1) .EQ. 0 ) .AND. &amp; <a name='682'>
              ( model_config_rec%auxinput4_interval_d(1) .EQ. 0 ) .AND. &amp; <a name='683'>
              ( model_config_rec%auxinput4_interval_h(1) .EQ. 0 ) .AND. &amp; <a name='684'>
              ( model_config_rec%auxinput4_interval_m(1) .EQ. 0 ) .AND. &amp; <a name='685'>
              ( model_config_rec%auxinput4_interval_s(1) .EQ. 0 ) ) THEN<a name='686'>
            wrf_err_message = '--- ERROR: If sst_update /= 0, one of the auxinput4_interval settings must be /= 0'<a name='687'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1032"> ( 0, TRIM(wrf_err_message) )<a name='688'>
            wrf_err_message = '--- Set auxinput4_interval_s to the same value as interval_seconds (usually a pretty good guess).'<a name='689'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1033"> ( 0, TRIM( wrf_err_message ) )<a name='690'>
            count_fatal_error = count_fatal_error + 1<a name='691'>
         END IF<a name='692'>
      END IF<a name='693'>
<a name='694'>
<font color=#447700>!-----------------------------------------------------------------------<a name='695'></font>
<font color=#447700>! The qndropsource relies on the flag PROGN (when not running chemistry)<a name='696'></font>
<font color=#447700>! and is always allocated when running WRF Chem.<a name='697'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='698'></font>
<a name='699'>
#if ( (EM_CORE == 1) &amp;&amp; (WRF_CHEM <font color=#447700>!= 1) )<a name='700'></font>
      model_config_rec%alloc_qndropsource = 0<a name='701'>
      DO i = 1, model_config_rec % max_dom<a name='702'>
         IF ( model_config_rec%progn(i) .EQ. 1 ) THEN<a name='703'>
            model_config_rec%alloc_qndropsource = 1<a name='704'>
         END IF<a name='705'>
      END DO<a name='706'>
<a name='707'>
#elif (WRF_CHEM == 1) <a name='708'>
      model_config_rec%alloc_qndropsource = 1<a name='709'>
#endif<a name='710'>
<a name='711'>
#if ((EM_CORE == 1) &amp;&amp; (DA_CORE <font color=#447700>!= 1))<a name='712'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='713'></font>
<font color=#447700>! Check that if grid_sfdda is one, grid_fdda is also 1<a name='714'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='715'></font>
<a name='716'>
      DO i = 1, model_config_rec % max_dom<a name='717'>
         IF ( ( model_config_rec%grid_sfdda(i) .GT. 0 ).AND. &amp;<a name='718'>
              ( model_config_rec%grid_fdda (i) .NE. 1 ) ) THEN<a name='719'>
            wrf_err_message = '--- ERROR: If grid_sfdda &gt;= 1, then grid_fdda must also = 1 for that domain '<a name='720'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1284"> ( wrf_err_message )<a name='721'>
            wrf_err_message = '--- Change grid_fdda or grid_sfdda in namelist.input '<a name='722'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1034"> ( 0, TRIM( wrf_err_message ) )<a name='723'>
         count_fatal_error = count_fatal_error + 1<a name='724'>
         END IF<a name='725'>
      ENDDO<a name='726'>
<a name='727'>
<font color=#447700>!-----------------------------------------------------------------------<a name='728'></font>
<font color=#447700>! If grid_fdda or grid_sfdda is 0 for any domain, all interval and<a name='729'></font>
<font color=#447700>! ending time information that domain must be set to zero.  For<a name='730'></font>
<font color=#447700>! surface fdda, we also need to make sure that the PXLSM soil nudging<a name='731'></font>
<font color=#447700>! switch is also zero.  Either surface fdda or soil nudging with the<a name='732'></font>
<font color=#447700>! PX scheme are enough to allow the surface fdda file to be read.<a name='733'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='734'></font>
<a name='735'>
      DO i = 1, model_config_rec % max_dom<a name='736'>
<a name='737'>
         IF ( model_config_rec%grid_fdda(i) .EQ. 0 ) THEN<a name='738'>
            WRITE (wrf_err_message, FMT='(A,I6,A)') '--- NOTE: grid_fdda is 0 for domain ', &amp;<a name='739'>
                         i, ', setting gfdda interval and ending time to 0 for that domain.'<a name='740'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1285"> ( wrf_err_message )<a name='741'>
<a name='742'>
            model_config_rec%gfdda_end_y(i) = 0<a name='743'>
            model_config_rec%gfdda_end_d(i) = 0<a name='744'>
            model_config_rec%gfdda_end_h(i) = 0<a name='745'>
            model_config_rec%gfdda_end_m(i) = 0<a name='746'>
            model_config_rec%gfdda_end_s(i) = 0<a name='747'>
            model_config_rec%gfdda_interval(i)   = 0<a name='748'>
            model_config_rec%gfdda_interval_y(i) = 0<a name='749'>
            model_config_rec%gfdda_interval_d(i) = 0<a name='750'>
            model_config_rec%gfdda_interval_h(i) = 0<a name='751'>
            model_config_rec%gfdda_interval_m(i) = 0<a name='752'>
            model_config_rec%gfdda_interval_s(i) = 0<a name='753'>
         END IF<a name='754'>
<a name='755'>
         IF ( ( model_config_rec%grid_sfdda(i) .EQ. 0 ) .AND. &amp;<a name='756'>
              ( model_config_rec%pxlsm_soil_nudge(i) .EQ. 0 ) ) THEN<a name='757'>
            WRITE (wrf_err_message, FMT='(A,I6,A)') &amp;<a name='758'>
                         '--- NOTE: both grid_sfdda and pxlsm_soil_nudge are 0 for domain ', &amp;<a name='759'>
                         i, ', setting sgfdda interval and ending time to 0 for that domain.'<a name='760'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1286"> ( wrf_err_message )<a name='761'>
<a name='762'>
            model_config_rec%sgfdda_end_y(i) = 0<a name='763'>
            model_config_rec%sgfdda_end_d(i) = 0<a name='764'>
            model_config_rec%sgfdda_end_h(i) = 0<a name='765'>
            model_config_rec%sgfdda_end_m(i) = 0<a name='766'>
            model_config_rec%sgfdda_end_s(i) = 0<a name='767'>
            model_config_rec%sgfdda_interval(i)   = 0<a name='768'>
            model_config_rec%sgfdda_interval_y(i) = 0<a name='769'>
            model_config_rec%sgfdda_interval_d(i) = 0<a name='770'>
            model_config_rec%sgfdda_interval_h(i) = 0<a name='771'>
            model_config_rec%sgfdda_interval_m(i) = 0<a name='772'>
            model_config_rec%sgfdda_interval_s(i) = 0<a name='773'>
         END IF<a name='774'>
<a name='775'>
         IF ( model_config_rec%obs_nudge_opt(i) .EQ. 0 ) THEN<a name='776'>
            WRITE (wrf_err_message, FMT='(A,I6,A)') '--- NOTE: obs_nudge_opt is 0 for domain ', &amp;<a name='777'>
                         i, ', setting obs nudging interval and ending time to 0 for that domain.'<a name='778'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1287"> ( wrf_err_message )<a name='779'>
<a name='780'>
            model_config_rec%fdda_end(i) = 0<a name='781'>
            model_config_rec%auxinput11_interval(i)   = 0<a name='782'>
            model_config_rec%auxinput11_interval_y(i) = 0<a name='783'>
            model_config_rec%auxinput11_interval_d(i) = 0<a name='784'>
            model_config_rec%auxinput11_interval_h(i) = 0<a name='785'>
            model_config_rec%auxinput11_interval_m(i) = 0<a name='786'>
            model_config_rec%auxinput11_interval_s(i) = 0<a name='787'>
            model_config_rec%auxinput11_end(i)   = 0<a name='788'>
            model_config_rec%auxinput11_end_y(i) = 0<a name='789'>
            model_config_rec%auxinput11_end_d(i) = 0<a name='790'>
            model_config_rec%auxinput11_end_h(i) = 0<a name='791'>
            model_config_rec%auxinput11_end_m(i) = 0<a name='792'>
            model_config_rec%auxinput11_end_s(i) = 0<a name='793'>
         END IF<a name='794'>
<a name='795'>
      ENDDO      <font color=#447700>! Loop over domains<a name='796'></font>
<a name='797'>
<font color=#447700>!-----------------------------------------------------------------------<a name='798'></font>
<font color=#447700>! If grid_sfdda = 2, we turn it into derived namelist fasdas<a name='799'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='800'></font>
<a name='801'>
      DO i = 1, model_config_rec % max_dom<a name='802'>
         model_config_rec%fasdas(i) = 0<a name='803'>
         IF ( model_config_rec%grid_sfdda(i) .EQ. 2 ) THEN<a name='804'>
            model_config_rec%fasdas(i) = 1<a name='805'>
         END IF<a name='806'>
      ENDDO<a name='807'>
<font color=#447700>!<a name='808'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='809'></font>
<font color=#447700>! FASDAS:  Check that rinblw is set for max_domains in the namelist if sffdda is active<a name='810'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='811'></font>
    rinblw_already_done = .FALSE.<a name='812'>
    DO j = 1, model_config_rec%max_dom<a name='813'>
    IF (model_config_rec%grid_sfdda(j) .EQ. 1 ) THEN<a name='814'>
      DO i = 2, model_config_rec%max_dom<a name='815'>
         IF ( model_config_rec%rinblw(i) .EQ. -1 ) THEN<a name='816'>
            model_config_rec%rinblw(i) = model_config_rec % rinblw(1)<a name='817'>
            IF ( .NOT. rinblw_already_done ) THEN<a name='818'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1288"> ( "Setting blank rinblw entries to domain #1 values.")<a name='819'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1289"> ( " --&gt; The rinblw entry in the namelist.input is now max_domains." )<a name='820'>
            END IF<a name='821'>
            rinblw_already_done = .TRUE.<a name='822'>
         END IF<a name='823'>
       ENDDO<a name='824'>
<a name='825'>
<font color=#447700>!------------------------------------------------------------------------<a name='826'></font>
<font color=#447700>! Check that rinblw is not -1 if sfdda is active<a name='827'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='828'></font>
       IF ( model_config_rec%rinblw(1) .EQ. -1 ) THEN<a name='829'>
            wrf_err_message = '--- ERROR: rinblw needs to be set in the namelist.input file.'<a name='830'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1035"> ( 0, TRIM( wrf_err_message ) )<a name='831'>
         count_fatal_error = count_fatal_error + 1<a name='832'>
       END IF<a name='833'>
    END IF <a name='834'>
    END DO<a name='835'>
<a name='836'>
<font color=#447700>!------------------------------------------------------------------------<a name='837'></font>
<font color=#447700>! Check to see if FASDAS is active<a name='838'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='839'></font>
    DO i = 1, model_config_rec%max_dom<a name='840'>
     IF (model_config_rec%fasdas(i) .EQ. 1 ) THEN<a name='841'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1290"> ( "FASDAS is active. Mixed Layer fdda is inactive")<a name='842'>
     END IF<a name='843'>
<a name='844'>
<font color=#447700>!------------------------------------------------------------------------<a name='845'></font>
<font color=#447700>! Check to make sure sfdda is active if FASDAS is in namelist<a name='846'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='847'></font>
<font color=#447700>!     IF (model_config_rec%fasdas(i) .EQ. 1 ) THEN<a name='848'></font>
<font color=#447700>!       IF (model_config_rec%grid_sfdda(i) .EQ. 0) THEN<a name='849'></font>
<font color=#447700>!        wrf_err_message = '--- ERROR: sfdda needs to be set in the namelist.input file to run FASDAS.'<a name='850'></font>
<font color=#447700>!        CALL wrf_debug ( 0, TRIM( wrf_err_message ) )<a name='851'></font>
<font color=#447700>!        count_fatal_error = count_fatal_error + 1<a name='852'></font>
<font color=#447700>!       END IF<a name='853'></font>
<font color=#447700>!     END IF <a name='854'></font>
     END DO<a name='855'>
<font color=#447700>!<a name='856'></font>
<font color=#447700>!END FASDAS<a name='857'></font>
<font color=#447700>!<a name='858'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='859'></font>
<font color=#447700>!  Only implement the mfshconv option if the QNSE PBL is activated.<a name='860'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='861'></font>
<a name='862'>
      oops = 0<a name='863'>
      DO i = 1, model_config_rec % max_dom<a name='864'>
         IF ( ( model_config_rec%bl_pbl_physics(i) .NE. QNSEPBLSCHEME ) .AND. &amp;<a name='865'>
              ( model_config_rec%mfshconv(i) .NE. 0 ) ) THEN<a name='866'>
            model_config_rec%mfshconv(i) = 0<a name='867'>
            oops = oops + 1<a name='868'>
         END IF<a name='869'>
      ENDDO      <font color=#447700>! Loop over domains<a name='870'></font>
      IF ( oops .GT. 0 ) THEN<a name='871'>
         wrf_err_message = '--- NOTE: bl_pbl_physics /= 4, implies mfshconv must be 0, resetting'<a name='872'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1291"> ( wrf_err_message )<a name='873'>
      END IF<a name='874'>
<a name='875'>
<font color=#447700>!-----------------------------------------------------------------------<a name='876'></font>
<font color=#447700>!  shcu_physics = 3 (grimsshcuscheme) only works with YSU &amp; MYNN PBL.<a name='877'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='878'></font>
<a name='879'>
      oops = 0<a name='880'>
      DO i = 1, model_config_rec % max_dom<a name='881'>
         IF ( model_config_rec%shcu_physics(i) .EQ. GRIMSSHCUSCHEME ) THEN<a name='882'>
            IF ( (model_config_rec%bl_pbl_physics(i) .EQ. YSUSCHEME) .OR. &amp;<a name='883'>
                 (model_config_rec%bl_pbl_physics(i) .EQ. MYNNPBLSCHEME2) .OR. &amp;<a name='884'>
                 (model_config_rec%bl_pbl_physics(i) .EQ. MYNNPBLSCHEME3) ) THEN<a name='885'>
               <font color=#447700>!NO PROBLEM<a name='886'></font>
            ELSE<a name='887'>
               model_config_rec%shcu_physics(i) = 0<a name='888'>
               oops = oops + 1<a name='889'>
            END IF<a name='890'>
         END IF<a name='891'>
      ENDDO      <font color=#447700>! Loop over domains<a name='892'></font>
      IF ( oops .GT. 0 ) THEN<a name='893'>
         wrf_err_message = '--- NOTE: bl_pbl_physics /= 1,5,6 implies shcu_physics cannot be 3, resetting'<a name='894'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1292"> ( wrf_err_message )<a name='895'>
      END IF<a name='896'>
<a name='897'>
<font color=#447700>!-----------------------------------------------------------------------<a name='898'></font>
<font color=#447700>!  bl_mynn_edmf &gt; 0 over-rules both shcu_physics &amp; ishallow<a name='899'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='900'></font>
<a name='901'>
      oops = 0<a name='902'>
      DO i = 1, model_config_rec % max_dom<a name='903'>
         IF ( model_config_rec%bl_mynn_edmf(i) .EQ. MYNN_STEM_EDMF .OR. &amp;<a name='904'>
              model_config_rec%bl_mynn_edmf(i) .EQ. MYNN_TEMF_EDMF) THEN<a name='905'>
               model_config_rec%shcu_physics(i) = 0  <font color=#447700>! maxdom<a name='906'></font>
               model_config_rec%ishallow = 0         <font color=#447700>! not maxdom<a name='907'></font>
               oops = oops + 1<a name='908'>
         END IF<a name='909'>
      ENDDO      <font color=#447700>! Loop over domains<a name='910'></font>
      IF ( oops .GT. 0 ) THEN<a name='911'>
         wrf_err_message = 'bl_mynn_edmf &gt; 0 requires both shcu_physics=0 &amp; ishallow=0'<a name='912'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1293"> ( wrf_err_message )<a name='913'>
      END IF<a name='914'>
<a name='915'>
<font color=#447700>!-----------------------------------------------------------------------<a name='916'></font>
<font color=#447700>!  We need to know if any of the cumulus schemes are active. This<a name='917'></font>
<font color=#447700>!  allows the model to allocate space.<a name='918'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='919'></font>
<a name='920'>
      model_config_rec%cu_used = 0<a name='921'>
      DO i = 1, model_config_rec % max_dom<a name='922'>
         IF ( model_config_rec%cu_physics(i) .NE. NOCUSCHEME ) THEN<a name='923'>
            model_config_rec%cu_used = 1<a name='924'>
         END IF<a name='925'>
      ENDDO<a name='926'>
<a name='927'>
<font color=#447700>!-----------------------------------------------------------------------<a name='928'></font>
<font color=#447700>!  We need to know if any of the shallow cumulus schemes are active. This<a name='929'></font>
<font color=#447700>!  allows the model to allocate space.<a name='930'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='931'></font>
<a name='932'>
      model_config_rec%shcu_used = 0<a name='933'>
      DO i = 1, model_config_rec % max_dom<a name='934'>
         IF ( model_config_rec%shcu_physics(i) .NE. NOSHCUSCHEME ) THEN<a name='935'>
            model_config_rec%shcu_used = 1<a name='936'>
         END IF<a name='937'>
      ENDDO<a name='938'>
<a name='939'>
<font color=#447700>!-----------------------------------------------------------------------<a name='940'></font>
<font color=#447700>! Make sure icloud_bl is only used when MYNN is chosen.<a name='941'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='942'></font>
<a name='943'>
      oops = 0<a name='944'>
      DO i = 1, model_config_rec % max_dom<a name='945'>
         IF ( model_config_rec%icloud_bl .eq. 1) THEN<a name='946'>
           IF ( model_config_rec%bl_pbl_physics(i) .EQ. MYNNPBLSCHEME2 .OR. &amp;<a name='947'>
                model_config_rec%bl_pbl_physics(i) .EQ. MYNNPBLSCHEME3 ) THEN<a name='948'>
              <font color=#447700>!CORRECTLY CONFIGURED<a name='949'></font>
           ELSE<a name='950'>
              model_config_rec%icloud_bl = 0<a name='951'>
              oops = oops + 1<a name='952'>
           END IF<a name='953'>
         END IF<a name='954'>
      ENDDO      <font color=#447700>! Loop over domains<a name='955'></font>
      IF ( oops .GT. 0 ) THEN<a name='956'>
         wrf_err_message = 'Need MYNN PBL for icloud_bl = 1, resetting to 0'<a name='957'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1294"> ( wrf_err_message )<a name='958'>
      END IF<a name='959'>
<a name='960'>
<font color=#447700>!-----------------------------------------------------------------------<a name='961'></font>
<font color=#447700>! Make sure microphysics option without QICE array cannot be used with icloud=3<a name='962'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='963'></font>
<a name='964'>
      oops = 0<a name='965'>
      DO i = 1, model_config_rec % max_dom<a name='966'>
         IF ( model_config_rec%icloud .eq. 3) THEN<a name='967'>
           IF ( model_config_rec%mp_physics(i) .EQ. WSM3SCHEME .OR. &amp;<a name='968'>
                model_config_rec%mp_physics(i) .EQ. KESSLERSCHEME ) THEN<a name='969'>
                oops = oops + 1<a name='970'>
           END IF<a name='971'>
         END IF<a name='972'>
      ENDDO      <font color=#447700>! Loop over domains<a name='973'></font>
      IF ( oops .GT. 0 ) THEN<a name='974'>
         wrf_err_message = '--- ERROR: Need microphysics schemes with QICE array for icloud = 3'<a name='975'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1295"> ( wrf_err_message )<a name='976'>
         wrf_err_message = '--- Choose a microphysics scheme other than WSM3 and Kessler'<a name='977'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1296"> ( wrf_err_message )<a name='978'>
         count_fatal_error = count_fatal_error + 1<a name='979'>
      END IF<a name='980'>
<a name='981'>
<font color=#447700>!-----------------------------------------------------------------------<a name='982'></font>
<font color=#447700>!  If analysis FDDA is turned off, reset the io_forms to zero so that<a name='983'></font>
<font color=#447700>!  there is no chance that WRF tries to input the data.<a name='984'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='985'></font>
<a name='986'>
      IF ( MAXVAL( model_config_rec%grid_fdda ) .EQ. 0 ) THEN<a name='987'>
         model_config_rec%io_form_gfdda = 0<a name='988'>
      ELSE<a name='989'>
         IF ( model_config_rec%io_form_gfdda .EQ. 0 ) THEN<a name='990'>
            wrf_err_message = '--- ERROR: If grid_fdda /= 0, io_form_gfdda must be /= 0'<a name='991'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1297"> ( wrf_err_message )<a name='992'>
            wrf_err_message = '--- Set io_form_gfdda in the time_control namelist (probably to 2).'<a name='993'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1036"> ( 0, TRIM( wrf_err_message ) )<a name='994'>
         count_fatal_error = count_fatal_error + 1<a name='995'>
         END IF<a name='996'>
      END IF<a name='997'>
      IF ( MAXVAL( model_config_rec%grid_sfdda ) .EQ. 0 ) THEN<a name='998'>
         model_config_rec%io_form_sgfdda = 0<a name='999'>
      ELSE<a name='1000'>
         IF ( model_config_rec%io_form_sgfdda .EQ. 0 ) THEN<a name='1001'>
            wrf_err_message = '--- ERROR: If grid_sfdda /= 0, io_form_sgfdda must be /= 0'<a name='1002'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1298"> ( wrf_err_message )<a name='1003'>
            wrf_err_message = '--- Set io_form_sgfdda in the time_control namelist (probably to 2).'<a name='1004'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1037"> ( 0, TRIM( wrf_err_message ) )<a name='1005'>
         count_fatal_error = count_fatal_error + 1<a name='1006'>
         END IF<a name='1007'>
      END IF<a name='1008'>
<a name='1009'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1010'></font>
<font color=#447700>! If we have asked for the pressure-level diagnostics, make sure we can output them<a name='1011'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1012'></font>
<a name='1013'>
      IF ( model_config_rec%p_lev_diags .EQ. 1 ) THEN<a name='1014'>
         DO i = 1, model_config_rec % max_dom<a name='1015'>
            IF ( ( MAX ( model_config_rec%auxhist23_interval  (i) , &amp;<a name='1016'>
                         model_config_rec%auxhist23_interval_d(i) , &amp;<a name='1017'>
                         model_config_rec%auxhist23_interval_h(i) , &amp;<a name='1018'>
                         model_config_rec%auxhist23_interval_m(i) , &amp;<a name='1019'>
                         model_config_rec%auxhist23_interval_s(i) ) == 0 ) .OR. &amp;<a name='1020'>
                 (  model_config_rec%io_form_auxhist23 == 0 ) ) THEN<a name='1021'>
               wrf_err_message = '--- ERROR: p_lev_diags requires auxhist23 file information'<a name='1022'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1299"> ( wrf_err_message )<a name='1023'>
               wrf_err_message = '--- ERROR: provide: auxhist23_interval (max_dom) and io_form_auxhist23'<a name='1024'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1300"> ( wrf_err_message )<a name='1025'>
               wrf_err_message = '--- Add supporting IO for stream 23 for pressure-level diags'<a name='1026'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1038"> ( 0, TRIM( wrf_err_message ) )<a name='1027'>
               count_fatal_error = count_fatal_error + 1<a name='1028'>
            END IF<a name='1029'>
         END DO<a name='1030'>
         DO i = 1, model_config_rec % max_dom<a name='1031'>
            model_config_rec%p_lev_interval(i) = model_config_rec%auxhist23_interval  (i)*   60 + &amp;<a name='1032'>
                                                 model_config_rec%auxhist23_interval_d(i)*86400 + &amp;<a name='1033'>
                                                 model_config_rec%auxhist23_interval_h(i)* 3600 + &amp;<a name='1034'>
                                                 model_config_rec%auxhist23_interval_m(i)*   60 + &amp;<a name='1035'>
                                                 model_config_rec%auxhist23_interval_s(i)<a name='1036'>
         END DO<a name='1037'>
      END IF<a name='1038'>
<a name='1039'>
<a name='1040'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1041'></font>
<font color=#447700>! If we have asked for the height-level diagnostics, make sure we can output them<a name='1042'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1043'></font>
<a name='1044'>
      IF ( model_config_rec%z_lev_diags .EQ. 1 ) THEN<a name='1045'>
         DO i = 1, model_config_rec % max_dom<a name='1046'>
            IF ( ( MAX ( model_config_rec%auxhist22_interval  (i) , &amp;<a name='1047'>
                         model_config_rec%auxhist22_interval_d(i) , &amp;<a name='1048'>
                         model_config_rec%auxhist22_interval_h(i) , &amp;<a name='1049'>
                         model_config_rec%auxhist22_interval_m(i) , &amp;<a name='1050'>
                         model_config_rec%auxhist22_interval_s(i) ) == 0 ) .OR. &amp;<a name='1051'>
                 (  model_config_rec%io_form_auxhist22 == 0 ) ) THEN<a name='1052'>
               wrf_err_message = '--- ERROR: z_lev_diags requires auxhist22 file information'<a name='1053'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1301"> ( wrf_err_message )<a name='1054'>
               wrf_err_message = '--- ERROR: provide: auxhist22_interval (max_dom) and io_form_auxhist22'<a name='1055'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1302"> ( wrf_err_message )<a name='1056'>
               wrf_err_message = '--- Add supporting IO for stream 22 for height-level diags'<a name='1057'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1039"> ( 0, TRIM( wrf_err_message ) )<a name='1058'>
               count_fatal_error = count_fatal_error + 1<a name='1059'>
            END IF<a name='1060'>
         END DO<a name='1061'>
         DO i = 1, model_config_rec % max_dom<a name='1062'>
            model_config_rec%z_lev_interval(i) = model_config_rec%auxhist22_interval  (i)*   60 + &amp;<a name='1063'>
                                                 model_config_rec%auxhist22_interval_d(i)*86400 + &amp;<a name='1064'>
                                                 model_config_rec%auxhist22_interval_h(i)* 3600 + &amp;<a name='1065'>
                                                 model_config_rec%auxhist22_interval_m(i)*   60 + &amp;<a name='1066'>
                                                 model_config_rec%auxhist22_interval_s(i)<a name='1067'>
         END DO<a name='1068'>
      END IF<a name='1069'>
<a name='1070'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1071'></font>
<font color=#447700>! For RASM Diagnostics<a name='1072'></font>
<font color=#447700>! -verify that only one time interval is specified<a name='1073'></font>
<font color=#447700>! -change the intervals to values used in RASM Diagnotics<a name='1074'></font>
<font color=#447700>! -verify that a time interval has been set<a name='1075'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1076'></font>
<a name='1077'>
<font color=#447700>! 1. Only one time interval type specified<a name='1078'></font>
<a name='1079'>
      DO i = 1, model_config_rec % max_dom<a name='1080'>
         count_opt = 0<a name='1081'>
         IF ( model_config_rec%mean_diag_interval_s (i) .GT. 0 ) THEN<a name='1082'>
            count_opt = count_opt + 1<a name='1083'>
         END IF <a name='1084'>
         IF ( model_config_rec%mean_diag_interval_m (i) .GT. 0 ) THEN<a name='1085'>
            count_opt = count_opt + 1<a name='1086'>
         END IF <a name='1087'>
         IF ( model_config_rec%mean_diag_interval_h (i) .GT. 0 ) THEN<a name='1088'>
            count_opt = count_opt + 1<a name='1089'>
         END IF <a name='1090'>
         IF ( model_config_rec%mean_diag_interval_d (i) .GT. 0 ) THEN<a name='1091'>
            count_opt = count_opt + 1<a name='1092'>
         END IF <a name='1093'>
         IF ( model_config_rec%mean_diag_interval_mo(i) .GT. 0 ) THEN<a name='1094'>
            count_opt = count_opt + 1<a name='1095'>
         END IF <a name='1096'>
         IF ( model_config_rec%mean_diag_interval   (i) .GT. 0 ) THEN<a name='1097'>
            count_opt = count_opt + 1<a name='1098'>
         END IF <a name='1099'>
         IF ( count_opt .GT. 1 ) THEN<a name='1100'>
            wrf_err_message = '--- ERROR:  Only use one of: mean_diag_interval, _s, _m, _h, _d, _mo '<a name='1101'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1303"> ( wrf_err_message )<a name='1102'>
            count_fatal_error = count_fatal_error + 1<a name='1103'>
         END IF<a name='1104'>
      END DO<a name='1105'>
<a name='1106'>
<font color=#447700>! 2. Put canonical intervals into RASM expected form<a name='1107'></font>
<a name='1108'>
      DO i = 1, model_config_rec % max_dom<a name='1109'>
         IF ( model_config_rec%mean_diag_interval_s (i) .GT. 0 ) THEN<a name='1110'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval_s (i)<a name='1111'>
            model_config_rec%mean_freq = 1<a name='1112'>
         END IF <a name='1113'>
         IF ( model_config_rec%mean_diag_interval_m (i) .GT. 0 ) THEN<a name='1114'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval_m (i)<a name='1115'>
            model_config_rec%mean_freq = 2<a name='1116'>
         END IF <a name='1117'>
         IF ( model_config_rec%mean_diag_interval_h (i) .GT. 0 ) THEN<a name='1118'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval_h (i)<a name='1119'>
            model_config_rec%mean_freq = 3<a name='1120'>
         END IF <a name='1121'>
         IF ( model_config_rec%mean_diag_interval_d (i) .GT. 0 ) THEN<a name='1122'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval_d (i)<a name='1123'>
            model_config_rec%mean_freq = 4<a name='1124'>
         END IF <a name='1125'>
         IF ( model_config_rec%mean_diag_interval_mo(i) .GT. 0 ) THEN<a name='1126'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval_mo(i)<a name='1127'>
            model_config_rec%mean_freq = 5<a name='1128'>
         END IF <a name='1129'>
         IF ( model_config_rec%mean_diag_interval   (i) .GT. 0 ) THEN<a name='1130'>
            model_config_rec%mean_interval(i) = model_config_rec%mean_diag_interval   (i)<a name='1131'>
            model_config_rec%mean_freq = 2<a name='1132'>
         END IF <a name='1133'>
      END DO<a name='1134'>
<a name='1135'>
<font color=#447700>! 3. If requested, need an interval.<a name='1136'></font>
<a name='1137'>
      IF ( model_config_rec%mean_diag .EQ. 1 ) THEN<a name='1138'>
         count_opt = 0<a name='1139'>
         DO i = 1, model_config_rec % max_dom<a name='1140'>
            IF ( model_config_rec%mean_interval   (i) .GT. 0 ) THEN<a name='1141'>
               count_opt = count_opt + 1<a name='1142'>
            END IF <a name='1143'>
         END DO<a name='1144'>
         IF ( count_opt .LT. 1 ) THEN<a name='1145'>
            wrf_err_message = '--- ERROR:  mean_diag = 1, but no computation interval given'<a name='1146'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1304"> ( wrf_err_message )<a name='1147'>
            wrf_err_message = '            Use one of: mean_diag_interval, _s, _m, _h, _d, _mo '<a name='1148'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1305"> ( wrf_err_message )<a name='1149'>
            count_fatal_error = count_fatal_error + 1<a name='1150'>
         END IF<a name='1151'>
      END IF<a name='1152'>
<a name='1153'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1154'></font>
<font color=#447700>! For nwp_diagnostics = 1, history_interval must be used.           <a name='1155'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1156'></font>
<a name='1157'>
      IF ( ( model_config_rec%nwp_diagnostics .NE. 0 ) .AND. &amp;<a name='1158'>
           ( model_config_rec%history_interval(1) .EQ. 0 ) ) THEN<a name='1159'>
         wrf_err_message = '--- ERROR:  nwp_diagnostics requires the use of "history_interval" namelist.'<a name='1160'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1306"> ( wrf_err_message )<a name='1161'>
         wrf_err_message = '---         Replace interval variable with "history_interval".'<a name='1162'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1040"> ( 0, TRIM( wrf_err_message ) )<a name='1163'>
         count_fatal_error = count_fatal_error + 1<a name='1164'>
      END IF<a name='1165'>
<a name='1166'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1167'></font>
<font color=#447700>! If hailcast_opt = 1, horizontal grid spacing must be 4 km or finer.<a name='1168'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1169'></font>
      DO i = 1, model_config_rec % max_dom<a name='1170'>
         IF ( ( model_config_rec%hailcast_opt(i) .NE. 0 ) .AND. &amp;<a name='1171'>
              ( model_config_rec%dx(i) .GT. 4000 ) ) THEN<a name='1172'>
            wrf_err_message = '--- WARNING:  hailcast_opt requires a grid-spacing of 4 km or finer.'<a name='1173'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1307"> ( wrf_err_message )<a name='1174'>
            wrf_err_message = '---          hailcast_opt is now 0.'<a name='1175'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1308"> ( wrf_err_message )<a name='1176'>
            model_config_rec%hailcast_opt(i) = 0<a name='1177'>
         ENDIF<a name='1178'>
      ENDDO<a name='1179'>
<a name='1180'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1181'></font>
<font color=#447700>! Name change in the namelist.input file.  We used to only have the<a name='1182'></font>
<font color=#447700>! ocean mixed layer option (omlcall=1).  With the addition of a 3D ocean,<a name='1183'></font>
<font color=#447700>! now let's change the name of the option.  If the old name is present,<a name='1184'></font>
<font color=#447700>! tell the user to swap their namelist, and then stop.<a name='1185'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1186'></font>
<a name='1187'>
      IF ( model_config_rec%omlcall .NE. 0 ) THEN<a name='1188'>
         wrf_err_message = '--- ERROR:  The namelist.input variable "omlcall" has been renamed.'<a name='1189'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1309"> ( wrf_err_message )<a name='1190'>
         wrf_err_message = '---         Replace "omlcall" with the new name "sf_ocean_physics".'<a name='1191'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1041"> ( 0, TRIM( wrf_err_message ) )<a name='1192'>
         count_fatal_error = count_fatal_error + 1<a name='1193'>
      END IF<a name='1194'>
<a name='1195'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1196'></font>
<font color=#447700>! For adaptive time stepping, certain physics schemes are not allowed<a name='1197'></font>
<font color=#447700>! to have intermittent frequencies.  So, for those schemes below, we just<a name='1198'></font>
<font color=#447700>! turn the frequencies so that the schemes are called for each time step.<a name='1199'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1200'></font>
<a name='1201'>
      IF ( model_config_rec%use_adaptive_time_step ) THEN<a name='1202'>
         IF ( ( model_config_rec%cu_physics(1) .EQ. BMJSCHEME     ) .OR. &amp;<a name='1203'>
              ( model_config_rec%cu_physics(1) .EQ. SCALESASSCHEME) .OR. &amp;<a name='1204'>
              ( model_config_rec%cu_physics(1) .EQ. SASSCHEME     ) .OR. &amp;<a name='1205'>
              ( model_config_rec%cu_physics(1) .EQ. OSASSCHEME    ) .OR. &amp;<a name='1206'>
              ( model_config_rec%cu_physics(1) .EQ. NSASSCHEME    ) .OR. &amp;<a name='1207'>
              ( model_config_rec%cu_physics(1) .EQ. TIEDTKESCHEME ) ) THEN<a name='1208'>
            wrf_err_message = '--- WARNING: If use_adaptive_time_step, must use cudt=0 for the following CU schemes:'<a name='1209'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1310"> ( wrf_err_message )<a name='1210'>
            wrf_err_message = '---          BMJ, all SAS, Tiedtke' <a name='1211'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1311"> ( wrf_err_message )<a name='1212'>
            wrf_err_message = '---          CUDT=0 has been done for you.'<a name='1213'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1312"> ( wrf_err_message )<a name='1214'>
            DO i = 1, model_config_rec % max_dom<a name='1215'>
               model_config_rec%cudt(i) = 0<a name='1216'>
            END DO<a name='1217'>
         END IF<a name='1218'>
      END IF<a name='1219'>
<a name='1220'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1221'></font>
<font color=#447700>! When digital filtering is turned on, if no specific time step is given to be<a name='1222'></font>
<font color=#447700>! used during the digitial filtering period, then the standard WRF time<a name='1223'></font>
<font color=#447700>! step is used.  If neither time steps are specified, then fatal error.<a name='1224'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1225'></font>
<a name='1226'>
      IF ( .NOT. model_config_rec%dfi_opt .EQ. DFI_NODFI ) THEN<a name='1227'>
         IF ( model_config_rec%time_step_dfi .EQ. -1 ) THEN<a name='1228'>
            model_config_rec%time_step_dfi = model_config_rec%time_step<a name='1229'>
            IF ( model_config_rec%time_step_dfi .EQ. -1 ) THEN<a name='1230'>
               wrf_err_message = '--- ERROR: DFI Timestep or standard WRF time step must be specified.'<a name='1231'>
               CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1042"> ( 0, TRIM( wrf_err_message ) )<a name='1232'>
               count_fatal_error = count_fatal_error + 1<a name='1233'>
            END IF<a name='1234'>
         END IF<a name='1235'>
      END IF<a name='1236'>
<a name='1237'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1238'></font>
<font color=#447700>! The cu_rad_feedback namelist flag with the two Grell cumulus parameterization <a name='1239'></font>
<font color=#447700>! schemes needs to have the namelist flag cu_diag=1<a name='1240'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1241'></font>
<a name='1242'>
      DO i = 1, model_config_rec % max_dom<a name='1243'>
         IF ( ( model_config_rec%cu_rad_feedback(i) .EQV. .TRUE. )  .OR. &amp;<a name='1244'>
              ( model_config_rec%cu_rad_feedback(i) .EQV. .true. ) ) THEN<a name='1245'>
            IF ( ( model_config_rec%cu_physics(1) .EQ. GFSCHEME     ) .OR. &amp;<a name='1246'>
                 ( model_config_rec%cu_physics(1) .EQ. G3SCHEME     ) .OR. &amp;<a name='1247'>
                 ( model_config_rec%cu_physics(1) .EQ. GDSCHEME     ) ) THEN<a name='1248'>
               wrf_err_message = '--- WARNING: Turning on cu_rad_feedback also requires setting cu_diag== 1'<a name='1249'>
               CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1313"> ( wrf_err_message )<a name='1250'>
               model_config_rec%cu_diag(i) = 1<a name='1251'>
            ELSE<a name='1252'>
               model_config_rec%cu_diag(i) = 0<a name='1253'>
            END IF<a name='1254'>
         END IF<a name='1255'>
      END DO<a name='1256'>
<a name='1257'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1258'></font>
<font color=#447700>! The namelist flag cu_diag=1 must have one of the two Grell cumulus parameterizations<a name='1259'></font>
<font color=#447700>! turned on.  All other cumulus parameterizations need to have cu_diag=0<a name='1260'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1261'></font>
 <a name='1262'>
       DO i = 1, model_config_rec % max_dom<a name='1263'>
         IF ( model_config_rec%cu_diag(i) .EQ. G3TAVE ) THEN<a name='1264'>
          IF ( ( model_config_rec%cu_physics(i) .NE. GDSCHEME ) .AND. &amp;<a name='1265'>
               ( model_config_rec%cu_physics(i) .NE. GFSCHEME ) .AND. &amp;<a name='1266'>
               ( model_config_rec%cu_physics(i) .NE. KFCUPSCHEME ) .AND. &amp;<a name='1267'>
               ( model_config_rec%cu_physics(i) .NE. G3SCHEME ) ) THEN<a name='1268'>
                wrf_err_message = '--- ERROR: Using cu_diag=1 requires use of one of the following CU schemes:'<a name='1269'>
                CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1314"> ( wrf_err_message )<a name='1270'>
                wrf_err_message = '---          Grell (G3) CU scheme' <a name='1271'>
                CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1315"> ( wrf_err_message )<a name='1272'>
                wrf_err_message = '---          Grell-Devenyi (GD) CU scheme' <a name='1273'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1043"> ( 0, TRIM( wrf_err_message ) )<a name='1274'>
            count_fatal_error = count_fatal_error + 1<a name='1275'>
          END IF<a name='1276'>
         END IF<a name='1277'>
       END DO<a name='1278'>
 <a name='1279'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1280'></font>
<font color=#447700>! The namelist flag kf_edrates=1 must have one of the three KF cumulus parameterizations<a name='1281'></font>
<font color=#447700>! turned on.  All other cumulus parameterizations need to have kf_edrates=0<a name='1282'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1283'></font>
 <a name='1284'>
       DO i = 1, model_config_rec % max_dom<a name='1285'>
         IF ( model_config_rec%kf_edrates(i) .EQ. KFEDRATES ) THEN<a name='1286'>
          IF ( ( model_config_rec%cu_physics(i) .NE. KFETASCHEME ) .AND. &amp;<a name='1287'>
               ( model_config_rec%cu_physics(i) .NE. MSKFSCHEME ) .AND. &amp;<a name='1288'>
               ( model_config_rec%cu_physics(i) .NE. KFSCHEME ) ) THEN<a name='1289'>
                wrf_err_message = '--- ERROR: Using kf_edrates=1 requires use of one of the following KF schemes:'<a name='1290'>
                CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1316"> ( wrf_err_message )<a name='1291'>
                wrf_err_message = '---          Kain-Fritsch (cu_physics=1)' <a name='1292'>
                CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1317"> ( wrf_err_message )<a name='1293'>
                wrf_err_message = '---          Multi-scale Kain-Fritsch (cu_physics=11)' <a name='1294'>
                CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1318"> ( wrf_err_message )<a name='1295'>
                wrf_err_message = '---          old Kain-Fritsch (cu_physics=99)' <a name='1296'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1044"> ( 0, TRIM( wrf_err_message ) )<a name='1297'>
            count_fatal_error = count_fatal_error + 1<a name='1298'>
          END IF<a name='1299'>
         END IF<a name='1300'>
       END DO<a name='1301'>
 <a name='1302'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1303'></font>
<font color=#447700>! Test to see if we allocate space for the time series.<a name='1304'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1305'></font>
<a name='1306'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='1307'>
         CALL <A href='../../html_code/share/wrf_tsin.F.html#WRF_TSIN_EXIST'>wrf_tsin_exist</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TSIN_EXIST_1"> ( exists )<a name='1308'>
         IF ( exists ) THEN<a name='1309'>
            model_config_rec%process_time_series = 1<a name='1310'>
         ELSE<a name='1311'>
            model_config_rec%process_time_series = 0<a name='1312'>
         END IF<a name='1313'>
      END IF<a name='1314'>
#ifdef DM_PARALLEL<a name='1315'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_INTEGER'>wrf_dm_bcast_integer</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_INTEGER_68">(model_config_rec%process_time_series, 1)<a name='1316'>
#endif<a name='1317'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1318'></font>
<font color=#447700>! The three Grell cumulus parameterization schemes need to have the <a name='1319'></font>
<font color=#447700>! namelist flag cu_diag=1, and all other cumulus schemes must have<a name='1320'></font>
<font color=#447700>! cu_diag=0.<a name='1321'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1322'></font>
<a name='1323'>
      DO i = 1, model_config_rec % max_dom<a name='1324'>
         IF ( ( model_config_rec%cu_physics(i) .EQ. GDSCHEME ) .OR. &amp;<a name='1325'>
              ( model_config_rec%cu_physics(i) .EQ. GFSCHEME ) .OR. &amp;<a name='1326'>
              ( model_config_rec%cu_physics(i) .EQ. KFCUPSCHEME ) .OR. &amp; <a name='1327'>
              ( model_config_rec%cu_physics(i) .EQ. G3SCHEME ) ) THEN<a name='1328'>
            model_config_rec%cu_diag(i) = 1<a name='1329'>
         ELSE<a name='1330'>
            model_config_rec%cu_diag(i) = 0<a name='1331'>
         END IF<a name='1332'>
      END DO<a name='1333'>
<a name='1334'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1335'></font>
<font color=#447700>!  Only implement the TEMF PBL scheme with the TEMP SFCLAY scheme.  <a name='1336'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1337'></font>
<a name='1338'>
      DO i = 1, model_config_rec % max_dom<a name='1339'>
         IF ( ( model_config_rec%bl_pbl_physics(i) .EQ. TEMFPBLSCHEME ) .AND. &amp;<a name='1340'>
              ( model_config_rec%sf_sfclay_physics(i) .NE. TEMFSFCSCHEME ) )  THEN<a name='1341'>
            wrf_err_message = '--- ERROR: Using bl_pbl_physics=10 requires sf_sfclay_physics=10 '<a name='1342'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1045"> ( 0, TRIM( wrf_err_message ) )<a name='1343'>
            count_fatal_error = count_fatal_error + 1<a name='1344'>
         ELSEIF ( ( model_config_rec%bl_pbl_physics(i) .NE. TEMFPBLSCHEME ) .AND. &amp;<a name='1345'>
                  ( model_config_rec%sf_sfclay_physics(i) .EQ. TEMFSFCSCHEME ) ) THEN<a name='1346'>
            wrf_err_message = '--- ERROR: Using sf_sfclay_physics=10 requires bl_pbl_physics=10 '<a name='1347'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1046"> ( 0, TRIM( wrf_err_message ) )<a name='1348'>
            count_fatal_error = count_fatal_error + 1<a name='1349'>
         END IF<a name='1350'>
      ENDDO      <font color=#447700>! Loop over domains<a name='1351'></font>
<a name='1352'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1353'></font>
<font color=#447700>!  Need to set lagday to 150 if tmn_update is 1<a name='1354'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1355'></font>
<a name='1356'>
      IF ( model_config_rec%tmn_update .EQ. 1 .AND. &amp;<a name='1357'>
           model_config_rec%lagday .EQ. 1 ) THEN <a name='1358'>
           wrf_err_message = '--- ERROR: Using tmn_update=1 requires lagday=150 '<a name='1359'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1047"> ( 0, TRIM( wrf_err_message ) )<a name='1360'>
         count_fatal_error = count_fatal_error + 1<a name='1361'>
      END IF<a name='1362'>
<a name='1363'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1364'></font>
<font color=#447700>!  Do not allow digital filtering to be run with TEMF.<a name='1365'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1366'></font>
<a name='1367'>
      DO i = 1, model_config_rec % max_dom<a name='1368'>
         IF ( ( model_config_rec%bl_pbl_physics(i) .EQ. TEMFPBLSCHEME ) .AND. &amp;<a name='1369'>
              (model_config_rec%dfi_opt .NE. DFI_NODFI) )  THEN<a name='1370'>
            wrf_err_message = '--- ERROR: DFI not available for bl_pbl_physics=10 '<a name='1371'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1048"> ( 0, TRIM( wrf_err_message ) )<a name='1372'>
            count_fatal_error = count_fatal_error + 1<a name='1373'>
         END IF<a name='1374'>
      ENDDO      <font color=#447700>! Loop over domains<a name='1375'></font>
<a name='1376'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1377'></font>
<font color=#447700>!  If this is a restart, shut off the DFI.<a name='1378'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1379'></font>
<a name='1380'>
      IF ( model_config_rec%restart ) THEN<a name='1381'>
         model_config_rec%dfi_opt = DFI_NODFI<a name='1382'>
      END IF<a name='1383'>
<a name='1384'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1385'></font>
<font color=#447700>!  The CLM scheme may not even be compiled, so make sure it is not allowed<a name='1386'></font>
<font color=#447700>!  to be run if the code is not available.<a name='1387'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1388'></font>
<a name='1389'>
#if <font color=#447700>!defined ( WRF_USE_CLM )<a name='1390'></font>
      oops = 0<a name='1391'>
      DO i = 1, model_config_rec % max_dom<a name='1392'>
         IF ( model_config_rec%sf_surface_physics(i) .EQ. CLMSCHEME ) THEN<a name='1393'>
            oops = oops + 1 <a name='1394'>
         END IF<a name='1395'>
      ENDDO      <font color=#447700>! Loop over domains<a name='1396'></font>
      IF ( oops .GT. 0 ) THEN<a name='1397'>
         wrf_err_message = '--- ERROR: The CLM surface scheme was requested in the namelist.input file.'<a name='1398'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1049"> ( 0, TRIM(wrf_err_message) )<a name='1399'>
         wrf_err_message = '--- ERROR: However, the WRF CLM scheme was not compiled in WRF.'<a name='1400'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1050"> ( 0, TRIM(wrf_err_message) )<a name='1401'>
         wrf_err_message = '--- ERROR: Please place the -DWRF_USE_CLM option in configure.wrf file, and recompile.'<a name='1402'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1051"> ( 0, TRIM( wrf_err_message ) )<a name='1403'>
         count_fatal_error = count_fatal_error + 1<a name='1404'>
      END IF<a name='1405'>
#endif<a name='1406'>
<a name='1407'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1408'></font>
<font color=#447700>!  grav_settling = 1 must be turned off for mp_physics=28.<a name='1409'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1410'></font>
      oops = 0<a name='1411'>
      DO i = 1, model_config_rec % max_dom<a name='1412'>
         IF ( model_config_rec%mp_physics(i) .EQ. THOMPSONAERO ) THEN<a name='1413'>
            IF ( model_config_rec%grav_settling(i) .NE. FOGSETTLING0 ) THEN<a name='1414'>
                model_config_rec%grav_settling(i) = 0<a name='1415'>
                oops = oops + 1<a name='1416'>
            END IF<a name='1417'>
         END IF<a name='1418'>
      ENDDO      <font color=#447700>! Loop over domains<a name='1419'></font>
      IF ( oops .GT. 0 ) THEN<a name='1420'>
         wrf_err_message = '--- NOTE: mp_physics == 28, already has gravitational fog settling; resetting grav_settling to 0'<a name='1421'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1319"> ( wrf_err_message )<a name='1422'>
      END IF<a name='1423'>
 <a name='1424'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1425'></font>
<font color=#447700>!  scalar_pblmix = 1 should be turned on for mp_physics=28.<a name='1426'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1427'></font>
      oops = 0<a name='1428'>
      DO i = 1, model_config_rec % max_dom<a name='1429'>
         IF ( model_config_rec%mp_physics(i) .EQ. THOMPSONAERO ) THEN<a name='1430'>
            IF ( model_config_rec%use_aero_icbc .AND. model_config_rec%scalar_pblmix(i) .NE. 1 ) THEN<a name='1431'>
                model_config_rec%scalar_pblmix(i) = 1<a name='1432'>
                oops = oops + 1<a name='1433'>
            END IF<a name='1434'>
         END IF<a name='1435'>
      ENDDO      <font color=#447700>! Loop over domains<a name='1436'></font>
      IF ( oops .GT. 0 ) THEN<a name='1437'>
         wrf_err_message = '--- WARNING: For mp_physics == 28 and use_aero_icbc is true, recommend to turn on scalar_pblmix'<a name='1438'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1320"> ( wrf_err_message )<a name='1439'>
         wrf_err_message = 'resetting scalar_pblmix = 1'<a name='1440'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1321"> ( wrf_err_message )<a name='1441'>
      END IF<a name='1442'>
<a name='1443'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1444'></font>
<font color=#447700>!  The hybrid vertical coordinate does not work with vertical refinement.<a name='1445'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1446'></font>
     DO i=1,model_config_rec%max_dom<a name='1447'>
        IF ((model_config_rec%vert_refine_method(i) .EQ. 2) .AND. (model_config_rec%hybrid_opt .EQ. 2)) THEN<a name='1448'>
           WRITE(wrf_err_message,'(A)') '--- ERROR: The hybrid vertical coordinate does not work with vertical refinement.'<a name='1449'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1322">( wrf_err_message )<a name='1450'>
           count_fatal_error = count_fatal_error + 1<a name='1451'>
        ENDIF<a name='1452'>
     END DO <a name='1453'>
<a name='1454'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1455'></font>
<font color=#447700>!  The hybrid vertical coordinate (HVC) namelist.input option (hybrid_opt=2) <a name='1456'></font>
<font color=#447700>!  requires the code to be built with the HVC code enabled.  This is a run-time<a name='1457'></font>
<font color=#447700>!  test to make sure the correct compile-time capabilities are available.<a name='1458'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1459'></font>
#if ( HYBRID_COORD==1 )<a name='1460'>
#else<a name='1461'>
     IF (model_config_rec%hybrid_opt .NE. 0) THEN<a name='1462'>
        WRITE(wrf_err_message,'(A)') '--- ERROR: The code was not built with hybrid vertical coordinate enabled'<a name='1463'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1323">( wrf_err_message )<a name='1464'>
        WRITE(wrf_err_message,'(A)') '---        Either set hybrid_opt=0 in the namelist.input file, or '<a name='1465'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1324">( wrf_err_message )<a name='1466'>
        WRITE(wrf_err_message,'(A)') '---        re-compile with the hybrid vertical coordinate enabled'       <a name='1467'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1325">( wrf_err_message )<a name='1468'>
        WRITE(wrf_err_message,'(A)') '---        For example: clean -a ; configure -hyb ; compile em_real '<a name='1469'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1326">( wrf_err_message )<a name='1470'>
        count_fatal_error = count_fatal_error + 1<a name='1471'>
     ENDIF<a name='1472'>
#endif<a name='1473'>
<a name='1474'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1475'></font>
<font color=#447700>!  DJW Check that we're not using ndown and vertical nesting.<a name='1476'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1477'></font>
     DO i=1,model_config_rec%max_dom<a name='1478'>
       IF ((model_config_rec%vert_refine_method(i) .NE. 0) .AND. (model_config_rec%vert_refine_fact .NE. 1)) THEN<a name='1479'>
         write(wrf_err_message,'(A)') '--- ERROR: vert_refine_fact is ndown specific and cannot be used with vert_refine_method, and vice versa.'<a name='1480'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1327">( wrf_err_message )<a name='1481'>
       ENDIF<a name='1482'>
     ENDDO<a name='1483'>
<a name='1484'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1485'></font>
<font color=#447700>!  DJW Check that only one type of vertical nesting is enabled.<a name='1486'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1487'></font>
     DO i=1,model_config_rec%max_dom<a name='1488'>
       IF (model_config_rec%vert_refine_method(i) .NE. 0) THEN<a name='1489'>
         DO j=1,model_config_rec%max_dom<a name='1490'>
           IF ((model_config_rec%vert_refine_method(i) .NE. model_config_rec%vert_refine_method(j)) .AND. (model_config_rec%vert_refine_method(j) .NE. 0)) THEN<a name='1491'>
             write(wrf_err_message,'(A,I1,A,I2,A,I1,A,I2,A)') '--- ERROR: vert_refine_method differs on grid ids ',model_config_rec%grid_id(i),' and ',model_config_rec%grid_id(j),'. Only one type of vertical grid nesting can be used at a time.'<a name='1492'>
              CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1052"> ( 0, TRIM( wrf_err_message ) )<a name='1493'>
              count_fatal_error = count_fatal_error + 1<a name='1494'>
           ENDIF<a name='1495'>
         ENDDO<a name='1496'>
       ENDIF<a name='1497'>
     ENDDO<a name='1498'>
<a name='1499'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1500'></font>
<font color=#447700>!  DJW Check that e_vert is the same for nested domains not using<a name='1501'></font>
<font color=#447700>!  vertical nesting. Don't do this check if we're using ndown.<a name='1502'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1503'></font>
      IF ((model_config_rec%max_dom .GT. 1) .AND. (model_config_rec%vert_refine_fact .EQ. 1)) THEN<a name='1504'>
        DO i=1,model_config_rec%max_dom<a name='1505'>
          IF (((model_config_rec%parent_id(i) .NE. 0) .AND. (model_config_rec%parent_id(i) .NE. model_config_rec%grid_id(i))) .AND. (model_config_rec%vert_refine_method(i) .EQ. 0)) THEN<a name='1506'>
            DO j=1,model_config_rec%max_dom<a name='1507'>
              IF ((i .NE. j) .AND. (model_config_rec%parent_id(i) .EQ. model_config_rec%grid_id(j))) THEN<a name='1508'>
                IF (model_config_rec%e_vert(i) .NE. model_config_rec%e_vert(j)) THEN<a name='1509'>
                  write(wrf_err_message,'(A,I2,A,I2,A)') '--- ERROR: e_vert differs on grid ids ',model_config_rec%grid_id(i),' and ',model_config_rec%grid_id(j),'. Set vert_refine_method or make e_vert consistent.'<a name='1510'>
                  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1053"> ( 0, TRIM( wrf_err_message ) )<a name='1511'>
                  count_fatal_error = count_fatal_error + 1<a name='1512'>
                ENDIF<a name='1513'>
              ENDIF<a name='1514'>
            ENDDO<a name='1515'>
          ENDIF<a name='1516'>
        ENDDO<a name='1517'>
      ENDIF<a name='1518'>
<a name='1519'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1520'></font>
<font color=#447700>!  Check that vertical levels are defined in a logical way.<a name='1521'></font>
<font color=#447700>!  DJW Check that domains without a parent do not have vertical<a name='1522'></font>
<font color=#447700>!  nesting enabled.<a name='1523'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1524'></font>
      DO i=1,model_config_rec%max_dom<a name='1525'>
        IF ((model_config_rec%parent_id(i) .EQ. 0) .OR. (model_config_rec%parent_id(i) .EQ. model_config_rec%grid_id(i))) THEN<a name='1526'>
          IF (model_config_rec%vert_refine_method(i) .NE. 0) THEN<a name='1527'>
            write(wrf_err_message,'(A,I1,A,I2,A)') '--- ERROR: vert_refine_method=',model_config_rec%vert_refine_method(i),' for grid_id=',model_config_rec%grid_id(i),', must be 0 for a non-nested domain.'<a name='1528'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1054"> ( 0, TRIM( wrf_err_message ) )<a name='1529'>
            count_fatal_error = count_fatal_error + 1<a name='1530'>
          ENDIF<a name='1531'>
        ENDIF<a name='1532'>
      ENDDO<a name='1533'>
<a name='1534'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1535'></font>
<font color=#447700>!  DJW Check that we've got appropriate e_vert for integer refinement.<a name='1536'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1537'></font>
      DO i = 1, model_config_rec % max_dom<a name='1538'>
        IF (model_config_rec%vert_refine_method(i) .EQ. 1) THEN<a name='1539'>
          j = model_config_rec%parent_id(i)<a name='1540'>
          IF (MOD(model_config_rec%e_vert(i)-1, model_config_rec%e_vert(j)-1) .NE. 0) THEN<a name='1541'>
            write(wrf_err_message,'(A,I2,A,I2,A)') "--- ERROR: grid_id=",i," and parent (grid_id=",j,") have incompatible e_vert's for vertical nesting with integer refinement."<a name='1542'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1055"> ( 0, TRIM( wrf_err_message ) )<a name='1543'>
            count_fatal_error = count_fatal_error + 1<a name='1544'>
          ENDIF<a name='1545'>
        ENDIF<a name='1546'>
      ENDDO<a name='1547'>
<a name='1548'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1549'></font>
<font color=#447700>!  Consistency checks between vertical refinement and radiation<a name='1550'></font>
<font color=#447700>!  scheme selection.  For "choose any vertical levels" for the nest,<a name='1551'></font>
<font color=#447700>!  only RRTM is eligible.<a name='1552'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1553'></font>
<a name='1554'>
      DO i = 2, model_config_rec % max_dom<a name='1555'>
        IF (model_config_rec%vert_refine_method(i) .NE. 0) THEN<a name='1556'>
          IF ( ( ( model_config_rec%ra_lw_physics(i) .EQ. 0                   ) .OR. &amp;<a name='1557'>
                 ( model_config_rec%ra_lw_physics(i) .EQ. RRTMSCHEME          ) ) .AND. &amp;<a name='1558'>
               ( ( model_config_rec%ra_sw_physics(i) .EQ. 0                   ) .OR. &amp;<a name='1559'>
                 ( model_config_rec%ra_sw_physics(i) .EQ. SWRADSCHEME         ) ) ) THEN<a name='1560'>
             <font color=#447700>!  We are OK, I just hate writing backwards / negative / convoluted if tests <a name='1561'></font>
             <font color=#447700>!  that are not easily comprehensible.<a name='1562'></font>
          ELSE<a name='1563'>
            wrf_err_message = '--- ERROR: vert_refine_method=2 only works with ra_lw_physics=1 (RRTM) and ra_sw_physics=1 (Dudhia)'<a name='1564'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1056"> ( 0, TRIM( wrf_err_message ) )<a name='1565'>
            count_fatal_error = count_fatal_error + 1<a name='1566'>
          END IF <a name='1567'>
        END IF<a name='1568'>
      END DO<a name='1569'>
<a name='1570'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1571'></font>
<font color=#447700>! This WRF version does not support trajectories on a global domain<a name='1572'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1573'></font>
      IF (  model_config_rec % polar(1) .AND. &amp;<a name='1574'>
            model_config_rec % fft_filter_lat .LT. 90. .AND. &amp;<a name='1575'>
            model_config_rec % traj_opt .NE. 0 ) THEN<a name='1576'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1057"> ( 0, '--- ERROR: Trajectories not supported on global domain' )<a name='1577'>
         count_fatal_error = count_fatal_error + 1<a name='1578'>
      END IF<a name='1579'>
<a name='1580'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1581'></font>
<font color=#447700>!  Remapping namelist variables for gridded and surface fdda to aux streams 9 and 10.<a name='1582'></font>
<font color=#447700>!  Relocated here so that the remappings are after checking the namelist for inconsistencies.<a name='1583'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1584'></font>
<a name='1585'>
#     include "<A href='../../html_code/include/namelist_remappings_em.h.html'>../dyn_em/namelist_remappings_em.h</A>"<A NAME="namelist_remappings_em.h_1"><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1586'>
<a name='1587'>
#endif<a name='1588'>
<a name='1589'>
#if (EM_CORE == 1)<a name='1590'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1591'></font>
<font color=#447700>!  For the real program (ARW only), check that the vertical interpolation options<a name='1592'></font>
<font color=#447700>!  selected by the user are consistent.<a name='1593'></font>
<font color=#447700>!  1. If the user has turned-off using the surface level, do not allow the force<a name='1594'></font>
<font color=#447700>!     option to select how many layers the surface is to be used through.<a name='1595'></font>
<font color=#447700>!  2. If the user has turned-off using the surface level, do not allow the <a name='1596'></font>
<font color=#447700>!     lowest level from surface option to be activated.<a name='1597'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1598'></font>
<a name='1599'>
      IF ( model_config_rec % use_wps_input .EQ. 1 ) THEN<a name='1600'>
         IF ( ( .NOT. model_config_rec % use_surface )  .AND. &amp;<a name='1601'>
              ( model_config_rec % force_sfc_in_vinterp .GT. 0 ) ) THEN<a name='1602'>
            wrf_err_message = '--- NOTE: Inconsistent vertical interpolation settings in program real.'<a name='1603'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1328"> ( wrf_err_message )<a name='1604'>
            wrf_err_message = '--- NOTE: With use_surface=F, automatically setting force_sfc_in_vinterp=0.'<a name='1605'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1329"> ( wrf_err_message )<a name='1606'>
            model_config_rec % force_sfc_in_vinterp = 0<a name='1607'>
         END IF<a name='1608'>
         IF ( ( .NOT. model_config_rec % use_surface )  .AND. &amp;<a name='1609'>
              ( model_config_rec % lowest_lev_from_sfc ) ) THEN<a name='1610'>
            wrf_err_message = '--- NOTE: Inconsistent vertical interpolation settings in program real.'<a name='1611'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1330"> ( wrf_err_message )<a name='1612'>
            wrf_err_message = '--- NOTE: With use_surface=F, automatically setting lowest_lev_from_sfc=F.'<a name='1613'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1331"> ( wrf_err_message )<a name='1614'>
            model_config_rec % lowest_lev_from_sfc = .FALSE.<a name='1615'>
         END IF<a name='1616'>
      END IF<a name='1617'>
#endif<a name='1618'>
<a name='1619'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1620'></font>
<font color=#447700>!  Set the namelist parameter o3input to 0 for the radiation schemes other<a name='1621'></font>
<font color=#447700>!  than RRTMG_LWSCHEME and RRTMG_SWSCHEME.<a name='1622'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1623'></font>
<a name='1624'>
      IF ( ( model_config_rec % ra_lw_physics(1) .EQ. RRTMG_LWSCHEME )  .OR. &amp;<a name='1625'>
           ( model_config_rec % ra_sw_physics(1) .EQ. RRTMG_SWSCHEME )  .OR. &amp;<a name='1626'>
           ( model_config_rec % ra_lw_physics(1) .EQ. RRTMG_LWSCHEME_FAST )  .OR. &amp;<a name='1627'>
           ( model_config_rec % ra_sw_physics(1) .EQ. RRTMG_SWSCHEME_FAST )  ) THEN<a name='1628'>
         wrf_err_message = '--- NOTE: RRTMG radiation is used, namelist ' // &amp;<a name='1629'>
                           'value for o3input (ozone input) is used '<a name='1630'>
<font color=#447700>!        CALL wrf_message ( wrf_err_message )<a name='1631'></font>
      ELSE<a name='1632'>
         model_config_rec % o3input = 0<a name='1633'>
         wrf_err_message = '--- NOTE: RRTMG radiation is not used, setting:  ' // &amp;<a name='1634'>
                           'o3input=0 to avoid data pre-processing'<a name='1635'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1332"> ( wrf_err_message )<a name='1636'>
      END IF<a name='1637'>
<a name='1638'>
      IF ( count_fatal_error .GT. 0 ) THEN<a name='1639'>
         WRITE (wrf_err_message, FMT='(A,I6, A)') 'NOTE:  ', count_fatal_error, &amp;<a name='1640'>
                                            ' namelist settings are wrong. Please check and reset these options'<a name='1641'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_check_a_mundo.F.html#CHECK_NML_CONSISTENCY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1379"> (  wrf_err_message  )<a name='1642'>
      END IF<a name='1643'>
<a name='1644'>
   END SUBROUTINE check_nml_consistency<a name='1645'>
<a name='1646'>
<font color=#447700>!=======================================================================<a name='1647'></font>
<a name='1648'>
<A NAME='SETUP_PHYSICS_SUITE'><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1649'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>setup_physics_suite</font> <A href='../../call_to/SETUP_PHYSICS_SUITE.html' TARGET='index'>3</A>,<A href='../../call_from/SETUP_PHYSICS_SUITE.html' TARGET='index'>20</A><a name='1650'>
<a name='1651'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1652'></font>
<font color=#447700>!<a name='1653'></font>
<font color=#447700>! Based on the selection of physics suite provided in the namelist, sets the<a name='1654'></font>
<font color=#447700>! values of other namelist options (mp_physics, cu_physics, ra_lw_physics,<a name='1655'></font>
<font color=#447700>! ra_sw_physics, bl_pbl_physics, sf_sfclay_physics, and sf_surface_physics)<a name='1656'></font>
<font color=#447700>! to reflect that suite.<a name='1657'></font>
<font color=#447700>!<a name='1658'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1659'></font>
<a name='1660'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_417">, ONLY : change_to_lower_case<a name='1661'>
<a name='1662'>
      IMPLICIT NONE<a name='1663'>
#if ( EM_CORE == 1 )<a name='1664'>
<a name='1665'>
      INTEGER :: i<a name='1666'>
      INTEGER :: max_dom<a name='1667'>
      LOGICAL :: have_mods<a name='1668'>
      INTEGER, DIMENSION( max_domains ) :: orig_mp_physics, orig_cu_physics, orig_ra_lw_physics, orig_ra_sw_physics, &amp;<a name='1669'>
                                           orig_bl_pbl_physics, orig_sf_sfclay_physics, orig_sf_surface_physics<a name='1670'>
      CHARACTER, DIMENSION( max_domains ) :: modified_mp_option, modified_cu_option, modified_ra_lw_option, modified_ra_sw_option, &amp;<a name='1671'>
                                             modified_bl_pbl_option, modified_sf_sfclay_option, modified_sf_surface_option<a name='1672'>
      CHARACTER (LEN=256) :: physics_suite_lowercase<a name='1673'>
      CHARACTER (LEN=32) :: formatstring<a name='1674'>
<a name='1675'>
      max_dom = model_config_rec % max_dom<a name='1676'>
<a name='1677'>
      <font color=#447700>!<a name='1678'></font>
      <font color=#447700>! Save physics selections as given by the user to later determine if the<a name='1679'></font>
      <font color=#447700>! user has overridden any options<a name='1680'></font>
      <font color=#447700>!<a name='1681'></font>
      modified_mp_option(1:max_dom) = ' '<a name='1682'>
      orig_mp_physics(1:max_dom) = model_config_rec % mp_physics(1:max_dom)<a name='1683'>
<a name='1684'>
      modified_cu_option(1:max_dom) = ' '<a name='1685'>
      orig_cu_physics(1:max_dom) = model_config_rec % cu_physics(1:max_dom)<a name='1686'>
<a name='1687'>
      modified_ra_lw_option(1:max_dom) = ' '<a name='1688'>
      orig_ra_lw_physics(1:max_dom) = model_config_rec % ra_lw_physics(1:max_dom)<a name='1689'>
<a name='1690'>
      modified_ra_sw_option(1:max_dom) = ' '<a name='1691'>
      orig_ra_sw_physics(1:max_dom) = model_config_rec % ra_sw_physics(1:max_dom)<a name='1692'>
<a name='1693'>
      modified_bl_pbl_option(1:max_dom) = ' '<a name='1694'>
      orig_bl_pbl_physics(1:max_dom) = model_config_rec % bl_pbl_physics(1:max_dom)<a name='1695'>
<a name='1696'>
      modified_sf_sfclay_option(1:max_dom) = ' '<a name='1697'>
      orig_sf_sfclay_physics(1:max_dom) = model_config_rec % sf_sfclay_physics(1:max_dom)<a name='1698'>
<a name='1699'>
      modified_sf_surface_option(1:max_dom) = ' '<a name='1700'>
      orig_sf_surface_physics(1:max_dom) = model_config_rec % sf_surface_physics(1:max_dom)<a name='1701'>
<a name='1702'>
      CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_7">(trim(model_config_rec % physics_suite), physics_suite_lowercase)<a name='1703'>
<a name='1704'>
      <font color=#447700>!<a name='1705'></font>
      <font color=#447700>! If physics suite is 'none', we can return early<a name='1706'></font>
      <font color=#447700>!<a name='1707'></font>
      IF ( trim(physics_suite_lowercase) == 'none' ) THEN<a name='1708'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1333"> ('*************************************')<a name='1709'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1334"> ('No physics suite selected.')<a name='1710'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1335"> ('Physics options will be used directly from the namelist.')<a name='1711'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1336"> ('*************************************')<a name='1712'>
         RETURN<a name='1713'>
      END IF<a name='1714'>
<a name='1715'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1337"> ('*************************************')<a name='1716'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1338"> ('Configuring physics suite '''//trim(physics_suite_lowercase)//'''')<a name='1717'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1339"> ('')<a name='1718'>
<a name='1719'>
      <font color=#447700>!<a name='1720'></font>
      <font color=#447700>! Set options based on the suite selection<a name='1721'></font>
      <font color=#447700>!<a name='1722'></font>
      SELECT CASE ( trim(physics_suite_lowercase) )<a name='1723'>
<a name='1724'>
      <font color=#447700>!<a name='1725'></font>
      <font color=#447700>! CONUS suite<a name='1726'></font>
      <font color=#447700>!<a name='1727'></font>
      CASE ('conus')<a name='1728'>
         DO i = 1, max_dom<a name='1729'>
<a name='1730'>
            IF ( model_config_rec % cu_physics(i) == -1 ) model_config_rec % cu_physics(i) = TIEDTKESCHEME               <font color=#447700>! Tiedtke<a name='1731'></font>
            IF ( model_config_rec % mp_physics(i) == -1 ) model_config_rec % mp_physics(i) = THOMPSON                    <font color=#447700>! Thompson<a name='1732'></font>
            IF ( model_config_rec % ra_lw_physics(i) == -1 ) model_config_rec % ra_lw_physics(i) = RRTMG_LWSCHEME        <font color=#447700>! RRTMG LW<a name='1733'></font>
            IF ( model_config_rec % ra_sw_physics(i) == -1 ) model_config_rec % ra_sw_physics(i) = RRTMG_SWSCHEME        <font color=#447700>! RRTMG SW<a name='1734'></font>
            IF ( model_config_rec % bl_pbl_physics(i) == -1 ) model_config_rec % bl_pbl_physics(i) = MYJPBLSCHEME        <font color=#447700>! MYJ<a name='1735'></font>
            IF ( model_config_rec % sf_sfclay_physics(i) == -1 ) model_config_rec % sf_sfclay_physics(i) = MYJSFCSCHEME  <font color=#447700>! MYJ<a name='1736'></font>
            IF ( model_config_rec % sf_surface_physics(i) == -1 ) model_config_rec % sf_surface_physics(i) = LSMSCHEME   <font color=#447700>! Noah<a name='1737'></font>
<a name='1738'>
         END DO<a name='1739'>
<a name='1740'>
      <font color=#447700>!<a name='1741'></font>
      <font color=#447700>! Tropical suite<a name='1742'></font>
      <font color=#447700>!<a name='1743'></font>
      CASE ('tropical')<a name='1744'>
         DO i = 1, max_dom<a name='1745'>
<a name='1746'>
            IF ( model_config_rec % cu_physics(i) == -1 ) model_config_rec % cu_physics(i) = NTIEDTKESCHEME              <font color=#447700>! New Tiedtke<a name='1747'></font>
            IF ( model_config_rec % mp_physics(i) == -1 ) model_config_rec % mp_physics(i) = WSM6SCHEME                  <font color=#447700>! WSM6<a name='1748'></font>
            IF ( model_config_rec % ra_lw_physics(i) == -1 ) model_config_rec % ra_lw_physics(i) = RRTMG_LWSCHEME        <font color=#447700>! RRTMG LW<a name='1749'></font>
            IF ( model_config_rec % ra_sw_physics(i) == -1 ) model_config_rec % ra_sw_physics(i) = RRTMG_SWSCHEME        <font color=#447700>! RRTMG SW<a name='1750'></font>
            IF ( model_config_rec % bl_pbl_physics(i) == -1 ) model_config_rec % bl_pbl_physics(i) = YSUSCHEME           <font color=#447700>! YSU<a name='1751'></font>
            IF ( model_config_rec % sf_sfclay_physics(i) == -1 ) model_config_rec % sf_sfclay_physics(i) = SFCLAYSCHEME  <font color=#447700>! MM5<a name='1752'></font>
            IF ( model_config_rec % sf_surface_physics(i) == -1 ) model_config_rec % sf_surface_physics(i) = LSMSCHEME   <font color=#447700>! Noah<a name='1753'></font>
<a name='1754'>
         END DO<a name='1755'>
<a name='1756'>
      CASE DEFAULT<a name='1757'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1380"> ( 'Unrecognized physics suite' )<a name='1758'>
<a name='1759'>
      END SELECT<a name='1760'>
<a name='1761'>
      WRITE (formatstring, '(A,I3,A)') '(A21,', max_dom, '(I6,A1))'<a name='1762'>
<a name='1763'>
      <font color=#447700>!<a name='1764'></font>
      <font color=#447700>! Print microphysics options<a name='1765'></font>
      <font color=#447700>!<a name='1766'></font>
      WHERE (model_config_rec % mp_physics(1:max_dom) == orig_mp_physics(1:max_dom)) modified_mp_option(1:max_dom) = '*'<a name='1767'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) 'mp_physics: ', &amp;<a name='1768'>
                                                    (model_config_rec % mp_physics(i), modified_mp_option(i), i=1,max_dom)<a name='1769'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1340"> (wrf_err_message)<a name='1770'>
<a name='1771'>
      <font color=#447700>!<a name='1772'></font>
      <font color=#447700>! Print cumulus options<a name='1773'></font>
      <font color=#447700>!<a name='1774'></font>
      WHERE (model_config_rec % cu_physics(1:max_dom) == orig_cu_physics(1:max_dom)) modified_cu_option(1:max_dom) = '*'<a name='1775'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) 'cu_physics: ', &amp;<a name='1776'>
                                                    (model_config_rec % cu_physics(i), modified_cu_option(i), i=1,max_dom)<a name='1777'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1341"> (wrf_err_message)<a name='1778'>
<a name='1779'>
      <font color=#447700>!<a name='1780'></font>
      <font color=#447700>! Print LW radiation options<a name='1781'></font>
      <font color=#447700>!<a name='1782'></font>
      WHERE (model_config_rec % ra_lw_physics(1:max_dom) == orig_ra_lw_physics(1:max_dom)) modified_ra_lw_option(1:max_dom) = '*'<a name='1783'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) 'ra_lw_physics: ', &amp;<a name='1784'>
                                                    (model_config_rec % ra_lw_physics(i), modified_ra_lw_option(i), i=1,max_dom)<a name='1785'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1342"> (wrf_err_message)<a name='1786'>
<a name='1787'>
      <font color=#447700>!<a name='1788'></font>
      <font color=#447700>! Print SW radiation options<a name='1789'></font>
      <font color=#447700>!<a name='1790'></font>
      WHERE (model_config_rec % ra_sw_physics(1:max_dom) == orig_ra_sw_physics(1:max_dom)) modified_ra_sw_option(1:max_dom) = '*'<a name='1791'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) 'ra_sw_physics: ', &amp;<a name='1792'>
                                                    (model_config_rec % ra_sw_physics(i), modified_ra_sw_option(i), i=1,max_dom)<a name='1793'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1343"> (wrf_err_message)<a name='1794'>
<a name='1795'>
      <font color=#447700>!<a name='1796'></font>
      <font color=#447700>! Print boundary layer options<a name='1797'></font>
      <font color=#447700>!<a name='1798'></font>
      WHERE (model_config_rec % bl_pbl_physics(1:max_dom) == orig_bl_pbl_physics(1:max_dom)) modified_bl_pbl_option(1:max_dom) = '*'<a name='1799'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) 'bl_pbl_physics: ', &amp;<a name='1800'>
                                                    (model_config_rec % bl_pbl_physics(i), modified_bl_pbl_option(i), i=1,max_dom)<a name='1801'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1344"> (wrf_err_message)<a name='1802'>
<a name='1803'>
      <font color=#447700>!<a name='1804'></font>
      <font color=#447700>! Print surface layer options<a name='1805'></font>
      <font color=#447700>!<a name='1806'></font>
      WHERE (model_config_rec % sf_sfclay_physics(1:max_dom) == orig_sf_sfclay_physics(1:max_dom)) &amp;<a name='1807'>
            modified_sf_sfclay_option(1:max_dom) = '*'<a name='1808'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) &amp;<a name='1809'>
            'sf_sfclay_physics: ', (model_config_rec % sf_sfclay_physics(i), modified_sf_sfclay_option(i), i=1,max_dom)<a name='1810'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1345"> (wrf_err_message)<a name='1811'>
<a name='1812'>
      <font color=#447700>!<a name='1813'></font>
      <font color=#447700>! Print surface options<a name='1814'></font>
      <font color=#447700>!<a name='1815'></font>
      WHERE (model_config_rec % sf_surface_physics(1:max_dom) == orig_sf_surface_physics(1:max_dom)) &amp;<a name='1816'>
            modified_sf_surface_option(1:max_dom) = '*'<a name='1817'>
      WRITE (wrf_err_message, FMT=TRIM(formatstring)) &amp;<a name='1818'>
            'sf_surface_physics: ', (model_config_rec % sf_surface_physics(i), modified_sf_surface_option(i), i=1,max_dom)<a name='1819'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1346"> (wrf_err_message)<a name='1820'>
 <a name='1821'>
      <font color=#447700>!<a name='1822'></font>
      <font color=#447700>! Print footnote if any physics schemes were overridden by the user<a name='1823'></font>
      <font color=#447700>!<a name='1824'></font>
      have_mods = ANY (modified_mp_option(1:max_dom) == '*') &amp;<a name='1825'>
             .OR. ANY (modified_cu_option(1:max_dom) == '*') &amp;<a name='1826'>
             .OR. ANY (modified_ra_lw_option(1:max_dom) == '*') &amp;<a name='1827'>
             .OR. ANY (modified_ra_sw_option(1:max_dom) == '*') &amp;<a name='1828'>
             .OR. ANY (modified_bl_pbl_option(1:max_dom) == '*') &amp;<a name='1829'>
             .OR. ANY (modified_sf_sfclay_option(1:max_dom) == '*') &amp;<a name='1830'>
             .OR. ANY (modified_sf_surface_option(1:max_dom) == '*')<a name='1831'>
<a name='1832'>
      IF (have_mods) THEN<a name='1833'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1347"> ('')<a name='1834'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1348"> ('(* = option overrides suite setting)')<a name='1835'>
      END IF<a name='1836'>
<a name='1837'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SETUP_PHYSICS_SUITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1349"> ('*************************************')<a name='1838'>
<a name='1839'>
#endif<a name='1840'>
<a name='1841'>
   END SUBROUTINE setup_physics_suite<a name='1842'>
<a name='1843'>
<font color=#447700>!=======================================================================<a name='1844'></font>
<a name='1845'>
<A NAME='SET_PHYSICS_RCONFIGS'><A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1846'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_physics_rconfigs</font> <A href='../../call_to/SET_PHYSICS_RCONFIGS.html' TARGET='index'>5</A>,<A href='../../call_from/SET_PHYSICS_RCONFIGS.html' TARGET='index'>4</A><a name='1847'>
<a name='1848'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1849'></font>
<font color=#447700>!<a name='1850'></font>
<font color=#447700>! Some derived rconfig entries need to be set based on the value of other,<a name='1851'></font>
<font color=#447700>! non-derived entries before package-dependent memory allocation takes place.<a name='1852'></font>
<font color=#447700>! This works around depending on the user to set these specific settings in the<a name='1853'></font>
<font color=#447700>! namelist.<a name='1854'></font>
<font color=#447700>!<a name='1855'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1856'></font>
<a name='1857'>
      IMPLICIT NONE<a name='1858'>
<a name='1859'>
      INTEGER :: numsoiltemp , nummosaictemp<a name='1860'>
      INTEGER :: i<a name='1861'>
<a name='1862'>
<a name='1863'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1864'></font>
<font color=#447700>! Set the namelist mosaic_cat_soil parameter for the Noah-mosaic  scheme if sf_surface_mosaic == 1.  <a name='1865'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1866'></font>
<a name='1867'>
      IF ( model_config_rec % sf_surface_mosaic .EQ. 1 ) THEN<a name='1868'>
      <a name='1869'>
      numsoiltemp = model_config_rec % num_soil_layers<a name='1870'>
      nummosaictemp = model_config_rec % mosaic_cat<a name='1871'>
      <a name='1872'>
         model_config_rec % mosaic_cat_soil = numsoiltemp * nummosaictemp<a name='1873'>
<a name='1874'>
         wrf_err_message = '--- NOTE: Noah-mosaic is in use, setting:  ' // &amp;<a name='1875'>
                           'mosaic_cat_soil = mosaic_cat * num_soil_layers'<a name='1876'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1350"> ( wrf_err_message )<a name='1877'>
<a name='1878'>
      END IF     <a name='1879'>
      <a name='1880'>
#if ( (NMM_CORE <font color=#447700>!= 1) &amp;&amp; (DA_CORE != 1) )<a name='1881'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1882'></font>
<font color=#447700>! If this is a WRF run with polar boundary conditions, then this is a<a name='1883'></font>
<font color=#447700>! global domain. A global domain needs to have the FFT arrays allocated.<a name='1884'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1885'></font>
<a name='1886'>
      model_config_rec % fft_used = 0<a name='1887'>
      IF ( ( model_config_rec % polar(1) ) .AND. &amp;<a name='1888'>
           ( model_config_rec % fft_filter_lat .LT. 90. ) ) THEN<a name='1889'>
         model_config_rec % fft_used = 1<a name='1890'>
      END IF<a name='1891'>
<a name='1892'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1893'></font>
<font color=#447700>! If any CAM scheme is turned on, then there are a few shared variables.<a name='1894'></font>
<font color=#447700>! These need to be allocated when any CAM scheme is active.<a name='1895'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1896'></font>
<a name='1897'>
#if ( (EM_CORE == 1) &amp;&amp; (WRF_CHEM <font color=#447700>!= 1) )<a name='1898'></font>
      model_config_rec % cam_used = 0<a name='1899'>
      DO i = 1, model_config_rec % max_dom<a name='1900'>
         IF ( ( model_config_rec % mp_physics(i)     .EQ. CAMMGMPSCHEME   ) .OR. &amp;<a name='1901'>
              ( model_config_rec % bl_pbl_physics(i) .EQ. CAMUWPBLSCHEME  ) .OR. &amp;<a name='1902'>
              ( model_config_rec % shcu_physics(i)   .EQ. CAMUWSHCUSCHEME ) ) THEN<a name='1903'>
            model_config_rec % cam_used = 1<a name='1904'>
         END IF<a name='1905'>
      ENDDO<a name='1906'>
<a name='1907'>
#elif (WRF_CHEM == 1) <a name='1908'>
      model_config_rec % cam_used = 1<a name='1909'>
#endif<a name='1910'>
<a name='1911'>
#endif<a name='1912'>
      <a name='1913'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1914'></font>
<font color=#447700>! Set the namelist parameters for the CAM radiation scheme if either <a name='1915'></font>
<font color=#447700>! ra_lw_physics = CAMLWSCHEME or ra_sw_physics = CAMSWSCHEME.  <a name='1916'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1917'></font>
<a name='1918'>
      IF (( model_config_rec % ra_lw_physics(1) .EQ. CAMLWSCHEME ) .OR. &amp; <a name='1919'>
          ( model_config_rec % ra_sw_physics(1) .EQ. CAMSWSCHEME )) THEN<a name='1920'>
         model_config_rec % paerlev = 29<a name='1921'>
         model_config_rec % levsiz = 59<a name='1922'>
         model_config_rec % cam_abs_dim1 = 4 <a name='1923'>
         model_config_rec % cam_abs_dim2 = model_config_rec % e_vert(1)<a name='1924'>
<a name='1925'>
         wrf_err_message = '--- NOTE: CAM radiation is in use, setting:  ' // &amp;<a name='1926'>
                           'paerlev=29, levsiz=59, cam_abs_dim1=4, cam_abs_dim2=e_vert'<a name='1927'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1351"> ( wrf_err_message )<a name='1928'>
<a name='1929'>
      END IF<a name='1930'>
      <a name='1931'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1932'></font>
<font color=#447700>! If a user requested to compute the radar reflectivity .OR. if this is<a name='1933'></font>
<font color=#447700>! one of the schemes that ALWAYS computes the radar reflectivity, then<a name='1934'></font>
<font color=#447700>! turn on the switch that says allocate the space for the refl_10cm array.<a name='1935'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1936'></font>
<a name='1937'>
      DO i = 1, model_config_rec % max_dom<a name='1938'>
         IF ( ( model_config_rec % mp_physics(i) .EQ. MILBRANDT2MOM ) .OR. &amp;<a name='1939'>
#if (EM_CORE == 1)<a name='1940'>
              ( model_config_rec % mp_physics(i) .EQ. NSSL_2MOM     ) .OR. &amp;<a name='1941'>
              ( model_config_rec % mp_physics(i) .EQ. NSSL_2MOMG    ) .OR. &amp;<a name='1942'>
              ( model_config_rec % mp_physics(i) .EQ. NSSL_2MOMCCN  ) .OR. &amp;<a name='1943'>
              ( model_config_rec % mp_physics(i) .EQ. NSSL_1MOM     ) .OR. &amp;<a name='1944'>
              ( model_config_rec % mp_physics(i) .EQ. NSSL_1MOMLFO  ) .OR. &amp;<a name='1945'>
#endif<a name='1946'>
              ( model_config_rec % do_radar_ref  .EQ. 1             ) ) THEN<a name='1947'>
            model_config_rec % compute_radar_ref = 1<a name='1948'>
         END IF<a name='1949'>
      ENDDO<a name='1950'>
<a name='1951'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1952'></font>
<font color=#447700>! Set the namelist parameters for the RRTMG radiation scheme if either<a name='1953'></font>
<font color=#447700>! ra_lw_physics = RRTMG_LWSCHEME or ra_sw_physics = RRTMG_SWSCHEME.<a name='1954'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1955'></font>
<a name='1956'>
      IF (( model_config_rec % ra_lw_physics(1) .EQ. RRTMG_LWSCHEME ) .OR. &amp;<a name='1957'>
          ( model_config_rec % ra_sw_physics(1) .EQ. RRTMG_SWSCHEME )) THEN<a name='1958'>
         model_config_rec % levsiz = 59<a name='1959'>
         model_config_rec % alevsiz = 12<a name='1960'>
         model_config_rec % no_src_types = 6<a name='1961'>
<a name='1962'>
         wrf_err_message = '--- NOTE: RRTMG radiation is in use, setting:  ' // &amp;<a name='1963'>
                           'levsiz=59, alevsiz=12, no_src_types=6'<a name='1964'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1352"> ( wrf_err_message )<a name='1965'>
<a name='1966'>
      END IF<a name='1967'>
<a name='1968'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1969'></font>
<font color=#447700>! Set namelist parameter num_soil_levels depending on the value of <a name='1970'></font>
<font color=#447700>! sf_surface_physics<a name='1971'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1972'></font>
<a name='1973'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. 0           ) &amp;<a name='1974'>
           model_config_rec % num_soil_layers = 5<a name='1975'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. SLABSCHEME  ) &amp;<a name='1976'>
           model_config_rec % num_soil_layers = 5<a name='1977'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. LSMSCHEME   ) &amp;<a name='1978'>
           model_config_rec % num_soil_layers = 4<a name='1979'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. NOAHMPSCHEME   ) &amp;<a name='1980'>
           model_config_rec % num_soil_layers = 4<a name='1981'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. RUCLSMSCHEME .AND. &amp;<a name='1982'>
           (model_config_rec % num_soil_layers .NE. 6 .AND. model_config_rec % num_soil_layers .NE. 9) ) &amp;<a name='1983'>
           model_config_rec % num_soil_layers = 6<a name='1984'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. PXLSMSCHEME ) &amp;<a name='1985'>
           model_config_rec % num_soil_layers = 2<a name='1986'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. CLMSCHEME ) &amp;<a name='1987'>
           model_config_rec % num_soil_layers = 10<a name='1988'>
      IF ( model_config_rec % sf_surface_physics(1) .EQ. 88          ) &amp;<a name='1989'>
           model_config_rec % num_soil_layers = 4<a name='1990'>
<a name='1991'>
      WRITE (wrf_err_message, FMT='(A,I6)') '--- NOTE: num_soil_layers has been set to ', &amp;<a name='1992'>
                                             model_config_rec % num_soil_layers<a name='1993'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_check_a_mundo.F.html#SET_PHYSICS_RCONFIGS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1353"> ( wrf_err_message )<a name='1994'>
<a name='1995'>
   END SUBROUTINE set_physics_rconfigs<a name='1996'>
<a name='1997'>
<a name='1998'>
<font color=#447700>!=======================================================================<a name='1999'></font>
<a name='2000'>
   END MODULE module_check_a_mundo<a name='2001'>
<a name='2002'>
<font color=#447700>!=======================================================================<a name='2003'></font>
</pre></body></html>