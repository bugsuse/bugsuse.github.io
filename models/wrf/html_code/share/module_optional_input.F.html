<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_OPTIONAL_INPUT'><A href='../../html_code/share/module_optional_input.F.html#MODULE_OPTIONAL_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>MODULE </font><font color=#cc0000>module_optional_input</font> <A href='../../call_to/MODULE_OPTIONAL_INPUT.html' TARGET='index'>8</A><a name='3'>
<a name='4'>
   INTEGER :: flag_metgrid  , flag_tavgsfc  , flag_psfc     , flag_soilhgt  , flag_mf_xy , flag_slp , &amp;<a name='5'>
              flag_snow     , flag_snowh    , flag_tsk      , flag_pinterp  , flag_prho<a name='6'>
<a name='7'>
   INTEGER :: flag_qv       , flag_qc       , flag_qr       , flag_qi       , flag_qs       , &amp;<a name='8'>
              flag_qg       , flag_qh       , &amp;<a name='9'>
              flag_qni      , flag_qnr      , &amp;<a name='10'>
              flag_qnwfa    , flag_qnifa    , &amp;<a name='11'>
              flag_sh       , flag_speccldl , flag_speccldf<a name='12'>
<a name='13'>
   INTEGER :: flag_soil_levels, flag_soil_layers<a name='14'>
<a name='15'>
   INTEGER :: flag_st000010 , flag_st010040 , flag_st040100 , flag_st100200 , flag_st010200 , &amp;<a name='16'>
              flag_sm000010 , flag_sm010040 , flag_sm040100 , flag_sm100200 , flag_sm010200 , &amp;<a name='17'>
              flag_sw000010 , flag_sw010040 , flag_sw040100 , flag_sw100200 , flag_sw010200<a name='18'>
<a name='19'>
   INTEGER :: flag_st000007 , flag_st007028 , flag_st028100 , flag_st100255 , &amp;<a name='20'>
              flag_sm000007 , flag_sm007028 , flag_sm028100 , flag_sm100255<a name='21'>
<a name='22'>
   INTEGER :: flag_soilt000 , flag_soilt005 , flag_soilt020 , flag_soilt040 , flag_soilt160 , flag_soilt300 , &amp;<a name='23'>
              flag_soilm000 , flag_soilm005 , flag_soilm020 , flag_soilm040 , flag_soilm160 , flag_soilm300 , &amp;<a name='24'>
              flag_soilw000 , flag_soilw005 , flag_soilw020 , flag_soilw040 , flag_soilw160 , flag_soilw300<a name='25'>
<a name='26'>
   INTEGER :: flag_sst      , flag_toposoil<a name='27'>
<a name='28'>
   INTEGER :: flag_icedepth , flag_icefrac  , flag_albsi , flag_snowsi<a name='29'>
<a name='30'>
   INTEGER :: flag_ptheta<a name='31'>
<a name='32'>
   INTEGER :: flag_lake_depth<a name='33'>
<a name='34'>
   INTEGER :: flag_excluded_middle<a name='35'>
<a name='36'>
   INTEGER :: flag_um_soil<a name='37'>
   INTEGER :: flag_icepct<a name='38'>
<a name='39'>
   INTEGER :: flag_hgtmaxw  , flag_pmaxw    , flag_tmaxw    , flag_umaxw    , flag_vmaxw     , &amp;<a name='40'>
              flag_hgttrop  , flag_ptrop    , flag_ttrop    , flag_utrop    , flag_vtrop<a name='41'>
   INTEGER :: flag_pmaxwnn  , flag_ptropnn<a name='42'>
   INTEGER :: flag_extra_levels<a name='43'>
<a name='44'>
   INTEGER                  :: num_soil_levels_input<a name='45'>
   INTEGER                  :: num_st_levels_input , num_sm_levels_input , num_sw_levels_input<a name='46'>
   INTEGER                  :: num_st_levels_alloc , num_sm_levels_alloc , num_sw_levels_alloc<a name='47'>
   INTEGER , DIMENSION(100) ::     st_levels_input ,     sm_levels_input ,     sw_levels_input<a name='48'>
   REAL , ALLOCATABLE , DIMENSION(:,:,:) :: st_input , sm_input , sw_input<a name='49'>
<a name='50'>
   CHARACTER (LEN=80) , PRIVATE :: flag_name<a name='51'>
 <a name='52'>
   LOGICAL :: already_been_here<a name='53'>
<a name='54'>
CONTAINS<a name='55'>
<a name='56'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='57'></font>
<a name='58'>
<A NAME='INIT_MODULE_OPTIONAL_INPUT'><A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='59'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_optional_input</font> ( grid , config_flags )  <A href='../../call_to/INIT_MODULE_OPTIONAL_INPUT.html' TARGET='index'>7</A>,<A href='../../call_from/INIT_MODULE_OPTIONAL_INPUT.html' TARGET='index'>2</A><a name='60'>
<a name='61'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_419">	, ONLY : domain<a name='62'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#INIT_MODULE_OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_267"> , ONLY : grid_config_rec_type<a name='63'>
<a name='64'>
      IMPLICIT NONE <a name='65'>
<a name='66'>
      TYPE ( domain ) :: grid<a name='67'>
      TYPE (grid_config_rec_type) :: config_flags<a name='68'>
<a name='69'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='70'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='71'>
                 its, ite, jts, jte, kts, kte<a name='72'>
<a name='73'>
      <font color=#447700>!  Get the various indices, assume XYZ &amp; XZY ordering.<a name='74'></font>
#if (NMM_CORE==1)<a name='75'>
      ids = grid%sd31 ; ide = grid%ed31 ;<a name='76'>
      jds = grid%sd32 ; jde = grid%ed32 ;<a name='77'>
      kds = grid%sd33 ; kde = grid%ed33 ;<a name='78'>
<a name='79'>
      ims = grid%sm31 ; ime = grid%em31 ;<a name='80'>
      jms = grid%sm32 ; jme = grid%em32 ;<a name='81'>
      kms = grid%sm33 ; kme = grid%em33 ;<a name='82'>
<a name='83'>
      its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='84'></font>
      jts = grid%sp32 ; jte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='85'></font>
      kts = grid%sp33 ; kte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='86'></font>
#endif<a name='87'>
#if (EM_CORE==1)<a name='88'>
      ids = grid%sd31 ; ide = grid%ed31 ;<a name='89'>
      kds = grid%sd32 ; kde = grid%ed32 ;<a name='90'>
      jds = grid%sd33 ; jde = grid%ed33 ;<a name='91'>
<a name='92'>
      ims = grid%sm31 ; ime = grid%em31 ;<a name='93'>
      kms = grid%sm32 ; kme = grid%em32 ;<a name='94'>
      jms = grid%sm33 ; jme = grid%em33 ;<a name='95'>
<a name='96'>
      its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='97'></font>
      kts = grid%sp32 ; kte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='98'></font>
      jts = grid%sp33 ; jte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='99'></font>
#endif<a name='100'>
      IF ( .NOT. already_been_here ) THEN<a name='101'>
<a name='102'>
         num_st_levels_alloc = config_flags%num_soil_layers * 3 <font color=#447700>! used to be 2<a name='103'></font>
         num_sm_levels_alloc = config_flags%num_soil_layers * 3<a name='104'>
         num_sw_levels_alloc = config_flags%num_soil_layers * 3<a name='105'>
<a name='106'>
         IF ( ALLOCATED ( st_input ) ) DEALLOCATE ( st_input )<a name='107'>
         IF ( ALLOCATED ( sm_input ) ) DEALLOCATE ( sm_input )<a name='108'>
         IF ( ALLOCATED ( sw_input ) ) DEALLOCATE ( sw_input )<a name='109'>
   <a name='110'>
         ALLOCATE ( st_input(ims:ime,num_st_levels_alloc,jms:jme) )<a name='111'>
         ALLOCATE ( sm_input(ims:ime,num_sm_levels_alloc,jms:jme) )<a name='112'>
         ALLOCATE ( sw_input(ims:ime,num_sw_levels_alloc,jms:jme) )<a name='113'>
<a name='114'>
      END IF<a name='115'>
<a name='116'>
      already_been_here = .TRUE.<a name='117'>
<a name='118'>
   END SUBROUTINE init_module_optional_input<a name='119'>
<a name='120'>
#if (DA_CORE <font color=#447700>!= 1)<a name='121'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='122'></font>
<a name='123'>
<A NAME='OPTIONAL_INPUT'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='124'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_input</font> ( grid , fid, config_flags ) <A href='../../call_to/OPTIONAL_INPUT.html' TARGET='index'>4</A>,<A href='../../call_from/OPTIONAL_INPUT.html' TARGET='index'>18</A><a name='125'>
<a name='126'>
      USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_49"><a name='127'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_268">       , ONLY : grid_config_rec_type<a name='128'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_420">	, ONLY : domain<a name='129'>
<a name='130'>
      IMPLICIT NONE <a name='131'>
<a name='132'>
      TYPE ( domain ) :: grid<a name='133'>
      TYPE (grid_config_rec_type) :: config_flags<a name='134'>
      INTEGER , INTENT(IN) :: fid<a name='135'>
<a name='136'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='137'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='138'>
                 its, ite, jts, jte, kts, kte<a name='139'>
<a name='140'>
      INTEGER :: itmp , icnt , ierr, num_layers<a name='141'>
      CHARACTER (LEN=132) :: message<a name='142'>
<a name='143'>
      <font color=#447700>!  Get the various indices, assume XYZ &amp; XZY ordering.<a name='144'></font>
#if (NMM_CORE==1)<a name='145'>
      ids = grid%sd31 ; ide = grid%ed31 ;<a name='146'>
      jds = grid%sd32 ; jde = grid%ed32 ;<a name='147'>
      kds = grid%sd33 ; kde = grid%ed33 ;<a name='148'>
<a name='149'>
      ims = grid%sm31 ; ime = grid%em31 ;<a name='150'>
      jms = grid%sm32 ; jme = grid%em32 ;<a name='151'>
      kms = grid%sm33 ; kme = grid%em33 ;<a name='152'>
<a name='153'>
      its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='154'></font>
      jts = grid%sp32 ; jte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='155'></font>
      kts = grid%sp33 ; kte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='156'></font>
#endif<a name='157'>
#if (EM_CORE==1)<a name='158'>
      ids = grid%sd31 ; ide = grid%ed31 ;<a name='159'>
      kds = grid%sd32 ; kde = grid%ed32 ;<a name='160'>
      jds = grid%sd33 ; jde = grid%ed33 ;<a name='161'>
<a name='162'>
      ims = grid%sm31 ; ime = grid%em31 ;<a name='163'>
      kms = grid%sm32 ; kme = grid%em32 ;<a name='164'>
      jms = grid%sm33 ; jme = grid%em33 ;<a name='165'>
<a name='166'>
      its = grid%sp31 ; ite = grid%ep31 ;   <font color=#447700>! note that tile is entire patch<a name='167'></font>
      kts = grid%sp32 ; kte = grid%ep32 ;   <font color=#447700>! note that tile is entire patch<a name='168'></font>
      jts = grid%sp33 ; jte = grid%ep33 ;   <font color=#447700>! note that tile is entire patch<a name='169'></font>
#endif<a name='170'>
<a name='171'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK'>optional_tsk</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_TSK_1">        ( grid , fid , &amp;<a name='172'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='173'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='174'>
                                 its, ite, jts, jte, kts, kte  )<a name='175'>
<a name='176'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC'>optional_tavgsfc</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_TAVGSFC_1">    ( grid , fid , &amp;<a name='177'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='178'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='179'>
                                 its, ite, jts, jte, kts, kte  )<a name='180'>
<a name='181'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST'>optional_moist</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_MOIST_1">      ( grid , fid , &amp;<a name='182'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='183'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='184'>
                                 its, ite, jts, jte, kts, kte  )<a name='185'>
<a name='186'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID'>optional_metgrid</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_METGRID_1">    ( grid , fid , &amp;<a name='187'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='188'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='189'>
                                 its, ite, jts, jte, kts, kte  )<a name='190'>
<a name='191'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST'>optional_sst</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_SST_1">        ( grid , fid , &amp;<a name='192'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='193'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='194'>
                                 its, ite, jts, jte, kts, kte  )<a name='195'>
<a name='196'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH'>optional_snowh</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_SNOWH_1">      ( grid , fid , &amp;<a name='197'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='198'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='199'>
                                 its, ite, jts, jte, kts, kte  )<a name='200'>
<a name='201'>
<a name='202'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC'>optional_sfc</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_SFC_1">        ( grid , fid , &amp;<a name='203'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='204'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='205'>
                                 its, ite, jts, jte, kts, kte  )<a name='206'>
<a name='207'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE'>optional_ice</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_ICE_1">        ( grid , fid , &amp;<a name='208'>
                                 config_flags%seaice_albedo_opt , &amp;<a name='209'>
                                 config_flags%seaice_snowdepth_opt , &amp;<a name='210'>
                                 config_flags%seaice_thickness_opt , &amp;<a name='211'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='212'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='213'>
                                 its, ite, jts, jte, kts, kte  )<a name='214'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE'>optional_lake</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_LAKE_1">       ( grid , fid , &amp;<a name='215'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='216'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='217'>
                                 its, ite, jts, jte, kts, kte  )<a name='218'>
<a name='219'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA'>optional_ptheta</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_PTHETA_1">     ( grid , fid , &amp;<a name='220'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='221'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='222'>
                                 its, ite, jts, jte, kts, kte  )<a name='223'>
<a name='224'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE'>optional_excl_middle</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_EXCL_MIDDLE_1">( grid , fid , &amp;<a name='225'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='226'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='227'>
                                 its, ite, jts, jte, kts, kte  )<a name='228'>
<a name='229'>
      CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS'>optional_levels</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_LEVELS_1">     ( grid , fid , &amp;<a name='230'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='231'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='232'>
                                 its, ite, jts, jte, kts, kte  ) <a name='233'>
<a name='234'>
      flag_soil_levels = 0 <a name='235'>
      flag_soil_layers = 0 <a name='236'>
<a name='237'>
      <font color=#447700>!  How many soil levels have we found?  Well, right now, none.<a name='238'></font>
<a name='239'>
      num_st_levels_input = 0<a name='240'>
      num_sm_levels_input = 0<a name='241'>
      num_sw_levels_input = 0<a name='242'>
<a name='243'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_SOIL_LEVELS', itmp, 1, icnt, ierr ) <a name='244'>
<a name='245'>
      IF ( ierr .EQ. 0 ) THEN<a name='246'>
         flag_soil_levels = itmp<a name='247'>
         write (message,'(A50,I3)') 'flag_soil_levels read from met_em file is',flag_soil_levels<a name='248'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1074">(0,message)<a name='249'>
      END IF<a name='250'>
<a name='251'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_SOIL_LAYERS', itmp, 1, icnt, ierr ) <a name='252'>
<a name='253'>
      IF ( ierr .EQ. 0 ) THEN<a name='254'>
         flag_soil_layers = itmp<a name='255'>
         write (message,'(A50,I3)') 'flag_soil_layers read from met_em file is',flag_soil_layers<a name='256'>
         CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1075">(0,message)<a name='257'>
      END IF<a name='258'>
<a name='259'>
#if (EM_CORE == 1)<a name='260'>
      IF ( ( flag_soil_levels == 1 ) .OR. ( flag_soil_layers == 1 ) ) THEN<a name='261'>
<a name='262'>
         num_st_levels_input   = config_flags%num_metgrid_soil_levels<a name='263'>
         num_sm_levels_input   = config_flags%num_metgrid_soil_levels<a name='264'>
         num_sw_levels_input   = config_flags%num_metgrid_soil_levels<a name='265'>
         num_soil_levels_input = config_flags%num_metgrid_soil_levels<a name='266'>
<a name='267'>
      END IF<a name='268'>
#endif<a name='269'>
<a name='270'>
      IF (  ( model_config_rec%sf_surface_physics(grid%id) .EQ. 1 ) .OR. &amp;<a name='271'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 2 ) .OR. &amp;<a name='272'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 3 ) .OR. &amp;<a name='273'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 4 ) .OR. &amp;<a name='274'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 5 ) .OR. &amp;<a name='275'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 7 ) .OR. &amp;<a name='276'>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 8 ) .OR. &amp; <font color=#447700>!fds <a name='277'></font>
            ( model_config_rec%sf_surface_physics(grid%id) .EQ. 88 ) ) THEN<a name='278'>
   <a name='279'>
         CALL <A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS'>optional_lsm_levels</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_INPUT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OPTIONAL_LSM_LEVELS_1"> ( grid , fid , &amp;<a name='280'>
                                    ids, ide, jds, jde, kds, kde, &amp;<a name='281'>
                                    ims, ime, jms, jme, kms, kme, &amp;<a name='282'>
                                    its, ite, jts, jte, kts, kte  )<a name='283'>
      END IF<a name='284'>
     <a name='285'>
   END SUBROUTINE optional_input<a name='286'>
<a name='287'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='288'></font>
<a name='289'>
<A NAME='OPTIONAL_MOIST'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='290'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_moist</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_MOIST.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_MOIST.html' TARGET='index'>4</A><a name='291'>
                               ids, ide, jds, jde, kds, kde, &amp;<a name='292'>
                               ims, ime, jms, jme, kms, kme, &amp;<a name='293'>
                               its, ite, jts, jte, kts, kte  )<a name='294'>
<a name='295'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_5"><a name='296'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_421">	, ONLY : domain<a name='297'>
<a name='298'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_269"> , ONLY : grid_config_rec_type<a name='299'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_MOIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_50"><a name='300'>
<a name='301'>
      IMPLICIT NONE <a name='302'>
<a name='303'>
      TYPE ( domain ) :: grid<a name='304'>
      INTEGER , INTENT(IN) :: fid<a name='305'>
<a name='306'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='307'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='308'>
                 its, ite, jts, jte, kts, kte<a name='309'>
<a name='310'>
      INTEGER :: itmp , icnt , ierr<a name='311'>
<a name='312'>
      flag_name = '                                                                                '<a name='313'>
<a name='314'>
      flag_qv       = 0<a name='315'>
      flag_qc       = 0<a name='316'>
      flag_qr       = 0<a name='317'>
      flag_qi       = 0<a name='318'>
      flag_qs       = 0<a name='319'>
      flag_qg       = 0<a name='320'>
      flag_qh       = 0<a name='321'>
      flag_qni      = 0<a name='322'>
      flag_qnr      = 0<a name='323'>
      flag_qnwfa    = 0<a name='324'>
      flag_qnifa    = 0<a name='325'>
      flag_sh       = 0<a name='326'>
      flag_speccldl = 0<a name='327'>
      flag_speccldf = 0<a name='328'>
<a name='329'>
      flag_name(1:8) = 'QV      '<a name='330'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='331'>
      IF ( ierr .EQ. 0 ) THEN<a name='332'>
         flag_qv       = itmp<a name='333'>
      END IF<a name='334'>
      flag_name(1:8) = 'QC      '<a name='335'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='336'>
      IF ( ierr .EQ. 0 ) THEN<a name='337'>
         flag_qc       = itmp<a name='338'>
      END IF<a name='339'>
      flag_name(1:8) = 'QR      '<a name='340'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='341'>
      IF ( ierr .EQ. 0 ) THEN<a name='342'>
         flag_qr       = itmp<a name='343'>
      END IF<a name='344'>
      flag_name(1:8) = 'QI      '<a name='345'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='346'>
      IF ( ierr .EQ. 0 ) THEN<a name='347'>
         flag_qi       = itmp<a name='348'>
      END IF<a name='349'>
      flag_name(1:8) = 'QS      '<a name='350'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='351'>
      IF ( ierr .EQ. 0 ) THEN<a name='352'>
         flag_qs       = itmp<a name='353'>
      END IF<a name='354'>
      flag_name(1:8) = 'QG      '<a name='355'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='356'>
      IF ( ierr .EQ. 0 ) THEN<a name='357'>
         flag_qg       = itmp<a name='358'>
      END IF<a name='359'>
      flag_name(1:8) = 'QH      '<a name='360'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='361'>
      IF ( ierr .EQ. 0 ) THEN<a name='362'>
         flag_qh       = itmp<a name='363'>
      END IF<a name='364'>
      flag_name(1:8) = 'QNI      '<a name='365'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='366'>
      IF ( ierr .EQ. 0 ) THEN<a name='367'>
         flag_qni       = itmp<a name='368'>
      END IF<a name='369'>
      flag_name(1:8) = 'QNR      '<a name='370'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='371'>
      IF ( ierr .EQ. 0 ) THEN<a name='372'>
         flag_qnr       = itmp<a name='373'>
      END IF<a name='374'>
      flag_name(1:8) = 'QNWFA    '<a name='375'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='376'>
      IF ( ierr .EQ. 0 ) THEN<a name='377'>
         flag_qnwfa     = itmp<a name='378'>
      END IF<a name='379'>
      flag_name(1:8) = 'QNIFA    '<a name='380'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='381'>
      IF ( ierr .EQ. 0 ) THEN<a name='382'>
         flag_qnifa     = itmp<a name='383'>
      END IF<a name='384'>
      flag_name(1:8) = 'SH      '<a name='385'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='386'>
      IF ( ierr .EQ. 0 ) THEN<a name='387'>
         flag_sh       = itmp<a name='388'>
      END IF<a name='389'>
      flag_name(1:8) = 'SPECCLDL'<a name='390'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='391'>
      IF ( ierr .EQ. 0 ) THEN<a name='392'>
         flag_speccldl = itmp<a name='393'>
      END IF<a name='394'>
      flag_name(1:8) = 'SPECCLDF'<a name='395'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='396'>
      IF ( ierr .EQ. 0 ) THEN<a name='397'>
         flag_speccldf = itmp<a name='398'>
      END IF<a name='399'>
    <a name='400'>
   END SUBROUTINE optional_moist<a name='401'>
<a name='402'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='403'></font>
<a name='404'>
<A NAME='OPTIONAL_METGRID'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='405'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_metgrid</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_METGRID.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_METGRID.html' TARGET='index'>4</A><a name='406'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='407'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='408'>
                                 its, ite, jts, jte, kts, kte  )<a name='409'>
<a name='410'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_6"><a name='411'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_422">	, ONLY : domain<a name='412'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_270"> , ONLY : grid_config_rec_type<a name='413'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_METGRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_51"><a name='414'>
<a name='415'>
      IMPLICIT NONE <a name='416'>
<a name='417'>
      TYPE ( domain ) :: grid<a name='418'>
      INTEGER , INTENT(IN) :: fid<a name='419'>
<a name='420'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='421'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='422'>
                 its, ite, jts, jte, kts, kte<a name='423'>
<a name='424'>
      INTEGER :: itmp , icnt , ierr<a name='425'>
<a name='426'>
      flag_name = '                                                                                '<a name='427'>
<a name='428'>
      flag_metgrid = 0 <a name='429'>
<a name='430'>
      flag_name(1:8) = 'METGRID '<a name='431'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='432'>
      IF ( ierr .EQ. 0 ) THEN<a name='433'>
         flag_metgrid  = itmp<a name='434'>
      END IF<a name='435'>
<a name='436'>
      flag_pinterp = 0<a name='437'>
<a name='438'>
      flag_name(1:8) = 'P_INTERP'<a name='439'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='440'>
      IF ( ierr .EQ. 0 ) THEN<a name='441'>
         flag_pinterp  = itmp<a name='442'>
      END IF<a name='443'>
<a name='444'>
      flag_mf_xy = 0 <a name='445'>
<a name='446'>
      flag_name(1:8) = 'MF_XY   '<a name='447'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='448'>
      IF ( ierr .EQ. 0 ) THEN<a name='449'>
         flag_mf_xy    = itmp<a name='450'>
      END IF<a name='451'>
    <a name='452'>
      grid%flag_metgrid = flag_metgrid<a name='453'>
      grid%flag_mf_xy   = flag_mf_xy<a name='454'>
   END SUBROUTINE optional_metgrid<a name='455'>
<a name='456'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='457'></font>
<a name='458'>
<A NAME='OPTIONAL_SST'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='459'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_sst</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_SST.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_SST.html' TARGET='index'>4</A><a name='460'>
                             ids, ide, jds, jde, kds, kde, &amp;<a name='461'>
                             ims, ime, jms, jme, kms, kme, &amp;<a name='462'>
                             its, ite, jts, jte, kts, kte  )<a name='463'>
<a name='464'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_7"><a name='465'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_423">	, ONLY : domain<a name='466'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_271"> , ONLY : grid_config_rec_type<a name='467'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_52"><a name='468'>
<a name='469'>
      IMPLICIT NONE <a name='470'>
<a name='471'>
      TYPE ( domain ) :: grid<a name='472'>
      INTEGER , INTENT(IN) :: fid<a name='473'>
<a name='474'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='475'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='476'>
                 its, ite, jts, jte, kts, kte<a name='477'>
<a name='478'>
      INTEGER :: itmp , icnt , ierr<a name='479'>
<a name='480'>
      flag_name = '                                                                                '<a name='481'>
<a name='482'>
      flag_sst      = 0 <a name='483'>
<a name='484'>
      flag_name(1:8) = 'SST     '<a name='485'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='486'>
      IF ( ierr .EQ. 0 ) THEN<a name='487'>
         flag_sst      = itmp<a name='488'>
      END IF<a name='489'>
    <a name='490'>
   END SUBROUTINE optional_sst<a name='491'>
<a name='492'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='493'></font>
<a name='494'>
<A NAME='OPTIONAL_LEVELS'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='495'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_levels</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_LEVELS.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_LEVELS.html' TARGET='index'>4</A><a name='496'>
                                ids, ide, jds, jde, kds, kde, &amp;<a name='497'>
                                ims, ime, jms, jme, kms, kme, &amp;<a name='498'>
                                its, ite, jts, jte, kts, kte  )<a name='499'>
<a name='500'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_8"><a name='501'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_424">	, ONLY : domain<a name='502'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_272"> , ONLY : grid_config_rec_type<a name='503'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_53"><a name='504'>
<a name='505'>
      IMPLICIT NONE <a name='506'>
<a name='507'>
      TYPE ( domain ) :: grid<a name='508'>
      INTEGER , INTENT(IN) :: fid<a name='509'>
<a name='510'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='511'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='512'>
                 its, ite, jts, jte, kts, kte<a name='513'>
<a name='514'>
      INTEGER :: itmp , icnt , ierr<a name='515'>
<a name='516'>
      flag_name = '                                                                                '<a name='517'>
<a name='518'>
      flag_hgtmaxw  = 0 <a name='519'>
      flag_pmaxw    = 0 <a name='520'>
      flag_pmaxwnn  = 0 <a name='521'>
      flag_tmaxw    = 0 <a name='522'>
      flag_umaxw    = 0 <a name='523'>
      flag_vmaxw    = 0 <a name='524'>
      flag_hgttrop  = 0 <a name='525'>
      flag_ptrop    = 0 <a name='526'>
      flag_ptropnn  = 0 <a name='527'>
      flag_ttrop    = 0 <a name='528'>
      flag_utrop    = 0 <a name='529'>
      flag_vtrop    = 0 <a name='530'>
      flag_extra_levels = 0<a name='531'>
<a name='532'>
      flag_name(1:8) = 'HGTMAXW '<a name='533'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='534'>
      IF ( ierr .EQ. 0 ) THEN<a name='535'>
         flag_hgtmaxw  = itmp<a name='536'>
      END IF<a name='537'>
      flag_name(1:8) = 'PMAXW   '<a name='538'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='539'>
      IF ( ierr .EQ. 0 ) THEN<a name='540'>
         flag_pmaxw    = itmp<a name='541'>
      END IF<a name='542'>
      flag_name(1:8) = 'PMAXWNN '<a name='543'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='544'>
      IF ( ierr .EQ. 0 ) THEN<a name='545'>
         flag_pmaxwnn  = itmp<a name='546'>
      END IF<a name='547'>
      flag_name(1:8) = 'TMAXW   '<a name='548'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='549'>
      IF ( ierr .EQ. 0 ) THEN<a name='550'>
         flag_tmaxw    = itmp<a name='551'>
      END IF<a name='552'>
      flag_name(1:8) = 'UMAXW   '<a name='553'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='554'>
      IF ( ierr .EQ. 0 ) THEN<a name='555'>
         flag_umaxw    = itmp<a name='556'>
      END IF<a name='557'>
      flag_name(1:8) = 'VMAXW   '<a name='558'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='559'>
      IF ( ierr .EQ. 0 ) THEN<a name='560'>
         flag_vmaxw    = itmp<a name='561'>
      END IF<a name='562'>
      flag_name(1:8) = 'HGTTROP '<a name='563'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='564'>
      IF ( ierr .EQ. 0 ) THEN<a name='565'>
         flag_hgttrop  = itmp<a name='566'>
      END IF<a name='567'>
      flag_name(1:8) = 'PTROP   '<a name='568'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='569'>
      IF ( ierr .EQ. 0 ) THEN<a name='570'>
         flag_ptrop    = itmp<a name='571'>
      END IF<a name='572'>
      flag_name(1:8) = 'PTROPNN '<a name='573'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='574'>
      IF ( ierr .EQ. 0 ) THEN<a name='575'>
         flag_ptropnn  = itmp<a name='576'>
      END IF<a name='577'>
      flag_name(1:8) = 'TTROP   '<a name='578'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='579'>
      IF ( ierr .EQ. 0 ) THEN<a name='580'>
         flag_ttrop    = itmp<a name='581'>
      END IF<a name='582'>
      flag_name(1:8) = 'UTROP   '<a name='583'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='584'>
      IF ( ierr .EQ. 0 ) THEN<a name='585'>
         flag_utrop    = itmp<a name='586'>
      END IF<a name='587'>
      flag_name(1:8) = 'VTROP   '<a name='588'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='589'>
      IF ( ierr .EQ. 0 ) THEN<a name='590'>
         flag_vtrop    = itmp<a name='591'>
      END IF<a name='592'>
<a name='593'>
      <font color=#447700>!  Newer versions of WPS supply a nearest-neighbor version of pressure and a<a name='594'></font>
      <font color=#447700>!  pressure that is suitable for interpolation.  If the nearest neighbor is <a name='595'></font>
      <font color=#447700>!  missing, all fields are set to unavailable.<a name='596'></font>
<a name='597'>
      IF ( flag_pmaxwnn .EQ. 0 ) THEN<a name='598'>
         flag_hgtmaxw  = 0 <a name='599'>
         flag_pmaxw    = 0 <a name='600'>
         flag_tmaxw    = 0 <a name='601'>
         flag_umaxw    = 0 <a name='602'>
         flag_vmaxw    = 0 <a name='603'>
      END IF<a name='604'>
<a name='605'>
      IF ( flag_ptropnn .EQ. 0 ) THEN<a name='606'>
         flag_hgttrop  = 0 <a name='607'>
         flag_ptrop    = 0 <a name='608'>
         flag_ttrop    = 0 <a name='609'>
         flag_utrop    = 0 <a name='610'>
         flag_vtrop    = 0 <a name='611'>
      END IF<a name='612'>
<a name='613'>
      flag_extra_levels = flag_hgtmaxw*flag_pmaxw*flag_tmaxw*flag_umaxw*flag_vmaxw* &amp;<a name='614'>
                          flag_hgttrop*flag_ptrop*flag_ttrop*flag_utrop*flag_vtrop<a name='615'>
<a name='616'>
   END SUBROUTINE optional_levels<a name='617'>
<a name='618'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='619'></font>
<a name='620'>
<a name='621'>
<A NAME='OPTIONAL_LAKE'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='622'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_lake</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_LAKE.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_LAKE.html' TARGET='index'>4</A><a name='623'>
                             ids, ide, jds, jde, kds, kde, &amp;<a name='624'>
                             ims, ime, jms, jme, kms, kme, &amp;<a name='625'>
                             its, ite, jts, jte, kts, kte  )<a name='626'>
<a name='627'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_9"><a name='628'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_425">	, ONLY : domain<a name='629'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_273"> , ONLY : grid_config_rec_type<a name='630'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LAKE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_54"><a name='631'>
<a name='632'>
      IMPLICIT NONE <a name='633'>
<a name='634'>
      TYPE ( domain ) :: grid<a name='635'>
      INTEGER , INTENT(IN) :: fid<a name='636'>
<a name='637'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='638'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='639'>
                 its, ite, jts, jte, kts, kte<a name='640'>
<a name='641'>
      INTEGER :: itmp , icnt , ierr<a name='642'>
<a name='643'>
      flag_name = '                                                                                '<a name='644'>
<a name='645'>
      flag_lake_depth      = 0 <a name='646'>
<a name='647'>
      flag_name(1:10) = 'LAKE_DEPTH'<a name='648'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='649'>
      IF ( ierr .EQ. 0 ) THEN<a name='650'>
         flag_lake_depth      = itmp<a name='651'>
      END IF<a name='652'>
    <a name='653'>
   END SUBROUTINE optional_lake<a name='654'>
<a name='655'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='656'></font>
<a name='657'>
<A NAME='OPTIONAL_TSK'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='658'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_tsk</font>     ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_TSK.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_TSK.html' TARGET='index'>4</A><a name='659'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='660'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='661'>
                                 its, ite, jts, jte, kts, kte  )<a name='662'>
<a name='663'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_10"><a name='664'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_426">	, ONLY : domain<a name='665'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_274"> , ONLY : grid_config_rec_type<a name='666'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TSK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_55"><a name='667'>
<a name='668'>
      IMPLICIT NONE <a name='669'>
<a name='670'>
      TYPE ( domain ) :: grid<a name='671'>
      INTEGER , INTENT(IN) :: fid<a name='672'>
<a name='673'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='674'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='675'>
                 its, ite, jts, jte, kts, kte<a name='676'>
<a name='677'>
      INTEGER :: itmp , icnt , ierr<a name='678'>
<a name='679'>
      flag_name = '                                                                                '<a name='680'>
<a name='681'>
      flag_tsk      = 0 <a name='682'>
<a name='683'>
      flag_name(1:8) = 'TSK     '<a name='684'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='685'>
      IF ( ierr .EQ. 0 ) THEN<a name='686'>
         flag_tsk      = itmp<a name='687'>
      END IF<a name='688'>
    <a name='689'>
   END SUBROUTINE optional_tsk<a name='690'>
<a name='691'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='692'></font>
<a name='693'>
<A NAME='OPTIONAL_TAVGSFC'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='694'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_tavgsfc</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_TAVGSFC.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_TAVGSFC.html' TARGET='index'>4</A><a name='695'>
                                 ids, ide, jds, jde, kds, kde, &amp;<a name='696'>
                                 ims, ime, jms, jme, kms, kme, &amp;<a name='697'>
                                 its, ite, jts, jte, kts, kte  )<a name='698'>
<a name='699'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_11"><a name='700'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_427">	, ONLY : domain<a name='701'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_275"> , ONLY : grid_config_rec_type<a name='702'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_TAVGSFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_56"><a name='703'>
<a name='704'>
      IMPLICIT NONE <a name='705'>
<a name='706'>
      TYPE ( domain ) :: grid<a name='707'>
      INTEGER , INTENT(IN) :: fid<a name='708'>
<a name='709'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='710'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='711'>
                 its, ite, jts, jte, kts, kte<a name='712'>
<a name='713'>
      INTEGER :: itmp , icnt , ierr<a name='714'>
<a name='715'>
      flag_name = '                                                                                '<a name='716'>
<a name='717'>
      flag_tavgsfc  = 0 <a name='718'>
<a name='719'>
      flag_name(1:8) = 'TAVGSFC '<a name='720'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='721'>
      IF ( ierr .EQ. 0 ) THEN<a name='722'>
         flag_tavgsfc  = itmp<a name='723'>
      END IF<a name='724'>
    <a name='725'>
   END SUBROUTINE optional_tavgsfc<a name='726'>
<a name='727'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='728'></font>
<a name='729'>
<A NAME='OPTIONAL_SNOWH'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='730'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_snowh</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_SNOWH.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_SNOWH.html' TARGET='index'>4</A><a name='731'>
                               ids, ide, jds, jde, kds, kde, &amp;<a name='732'>
                               ims, ime, jms, jme, kms, kme, &amp;<a name='733'>
                               its, ite, jts, jte, kts, kte  )<a name='734'>
<a name='735'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_12"><a name='736'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_428">	, ONLY : domain<a name='737'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_276"> , ONLY : grid_config_rec_type<a name='738'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SNOWH' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_57"><a name='739'>
<a name='740'>
      IMPLICIT NONE <a name='741'>
<a name='742'>
      TYPE ( domain ) :: grid<a name='743'>
      INTEGER , INTENT(IN) :: fid<a name='744'>
<a name='745'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='746'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='747'>
                 its, ite, jts, jte, kts, kte<a name='748'>
<a name='749'>
      INTEGER :: itmp , icnt , ierr<a name='750'>
<a name='751'>
      flag_name = '                                                                                '<a name='752'>
<a name='753'>
      flag_snowh    = 0 <a name='754'>
<a name='755'>
      flag_name(1:8) = 'SNOWH   '<a name='756'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='757'>
      IF ( ierr .EQ. 0 ) THEN<a name='758'>
         flag_snowh    = itmp<a name='759'>
      END IF<a name='760'>
<a name='761'>
      flag_snow     = 0 <a name='762'>
<a name='763'>
      flag_name(1:8) = 'SNOW    '<a name='764'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='765'>
      IF ( ierr .EQ. 0 ) THEN<a name='766'>
         flag_snow     = itmp<a name='767'>
      END IF<a name='768'>
      grid%flag_snow = flag_snow<a name='769'>
<a name='770'>
   END SUBROUTINE optional_snowh<a name='771'>
<a name='772'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='773'></font>
<a name='774'>
<A NAME='OPTIONAL_SFC'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='775'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_sfc</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_SFC.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_SFC.html' TARGET='index'>4</A><a name='776'>
                             ids, ide, jds, jde, kds, kde, &amp;<a name='777'>
                             ims, ime, jms, jme, kms, kme, &amp;<a name='778'>
                             its, ite, jts, jte, kts, kte  )<a name='779'>
<a name='780'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_13"><a name='781'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_429">	, ONLY : domain<a name='782'>
USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_277"> , ONLY : grid_config_rec_type<a name='783'>
USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_SFC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_58"><a name='784'>
<a name='785'>
      IMPLICIT NONE <a name='786'>
<a name='787'>
      TYPE ( domain ) :: grid<a name='788'>
      INTEGER , INTENT(IN) :: fid<a name='789'>
<a name='790'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='791'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='792'>
                 its, ite, jts, jte, kts, kte<a name='793'>
<a name='794'>
      INTEGER :: itmp , icnt , ierr<a name='795'>
<a name='796'>
      flag_name = '                                                                                '<a name='797'>
<a name='798'>
      flag_psfc     = 0 <a name='799'>
      flag_soilhgt  = 0 <a name='800'>
      flag_toposoil = 0 <a name='801'>
      flag_slp      = 0 <a name='802'>
<a name='803'>
      flag_name(1:8) = 'TOPOSOIL'<a name='804'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='805'>
      IF ( ierr .EQ. 0 ) THEN<a name='806'>
         flag_toposoil = itmp<a name='807'>
      END IF<a name='808'>
<a name='809'>
      flag_name(1:8) = 'PSFC    '<a name='810'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='811'>
      IF ( ierr .EQ. 0 ) THEN<a name='812'>
         flag_psfc     = itmp<a name='813'>
      END IF<a name='814'>
<a name='815'>
      flag_name(1:8) = 'SOILHGT '<a name='816'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='817'>
      IF ( ierr .EQ. 0 ) THEN<a name='818'>
         flag_soilhgt  = itmp<a name='819'>
      END IF<a name='820'>
<a name='821'>
      flag_name(1:8) = 'SLP     '<a name='822'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='823'>
      IF ( ierr .EQ. 0 ) THEN<a name='824'>
         flag_slp      = itmp<a name='825'>
      END IF<a name='826'>
<a name='827'>
      flag_name(1:8) = 'UM_SOIL '<a name='828'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='829'>
      IF ( ierr .EQ. 0 ) THEN<a name='830'>
         flag_um_soil  = itmp<a name='831'>
      END IF<a name='832'>
    <a name='833'>
      grid%flag_soilhgt = flag_soilhgt<a name='834'>
      grid%flag_slp     = flag_slp <a name='835'>
      grid%flag_psfc    = flag_psfc<a name='836'>
   END SUBROUTINE optional_sfc<a name='837'>
<a name='838'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='839'></font>
<a name='840'>
<A NAME='OPTIONAL_ICE'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='841'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_ice</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_ICE.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_ICE.html' TARGET='index'>7</A><a name='842'>
                             seaice_albedo_opt , &amp;<a name='843'>
                             seaice_snowdepth_opt , &amp;<a name='844'>
                             seaice_thickness_opt , &amp;<a name='845'>
                             ids, ide, jds, jde, kds, kde, &amp;<a name='846'>
                             ims, ime, jms, jme, kms, kme, &amp;<a name='847'>
                             its, ite, jts, jte, kts, kte  )<a name='848'>
<a name='849'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_14"><a name='850'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_430">	, ONLY : domain<a name='851'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_278"> , ONLY : grid_config_rec_type<a name='852'>
      USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_59"><a name='853'>
<a name='854'>
      IMPLICIT NONE <a name='855'>
<a name='856'>
      TYPE ( domain ) :: grid<a name='857'>
      INTEGER , INTENT(IN) :: fid<a name='858'>
      INTEGER , INTENT(IN) :: seaice_albedo_opt<a name='859'>
      INTEGER , INTENT(IN) :: seaice_snowdepth_opt<a name='860'>
      INTEGER , INTENT(IN) :: seaice_thickness_opt<a name='861'>
<a name='862'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='863'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='864'>
                 its, ite, jts, jte, kts, kte<a name='865'>
<a name='866'>
      INTEGER :: itmp , icnt , ierr, i, j<a name='867'>
<a name='868'>
      flag_name = '                                                                                '<a name='869'>
<a name='870'>
      flag_icedepth = 0 <a name='871'>
      flag_icefrac  = 0 <a name='872'>
      flag_albsi    = 0<a name='873'>
      flag_snowsi   = 0<a name='874'>
<a name='875'>
      flag_name(1:8) = 'ICEFRAC '<a name='876'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='877'>
      IF ( ierr .EQ. 0 ) THEN<a name='878'>
         flag_icefrac  = itmp<a name='879'>
      END IF<a name='880'>
<a name='881'>
      flag_name(1:8) = 'ICEPCT  '<a name='882'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr )<a name='883'>
      IF ( ierr .EQ. 0 ) THEN<a name='884'>
         flag_icepct  = itmp<a name='885'>
      END IF<a name='886'>
<a name='887'>
      flag_name(1:8) = 'ICEDEPTH'<a name='888'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='889'>
      IF ( ierr .EQ. 0 ) THEN<a name='890'>
         flag_icedepth = itmp<a name='891'>
      END IF<a name='892'>
<a name='893'>
      flag_name(1:8) = 'ALBSI   '<a name='894'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='895'>
      IF ( ierr .EQ. 0 ) THEN<a name='896'>
         flag_albsi  = itmp<a name='897'>
      END IF<a name='898'>
    <a name='899'>
      flag_name(1:8) = 'SNOWSI  '<a name='900'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='901'>
      IF ( ierr .EQ. 0 ) THEN<a name='902'>
         flag_snowsi  = itmp<a name='903'>
      END IF<a name='904'>
<a name='905'>
      <font color=#447700>!<a name='906'></font>
      <font color=#447700>!  Check that ICEDEPTH field is available for SEAICE_THICKNESS_OPT == 1<a name='907'></font>
      <font color=#447700>!<a name='908'></font>
      IF ( flag_icedepth == 0 ) THEN<a name='909'>
          IF ( seaice_thickness_opt == 1 ) THEN<a name='910'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1427">("Field ICEDEPTH not found in input.  Field ICEDEPTH is required if SEAICE_THICKNESS_OPT=1")<a name='911'>
             <font color=#447700>! DO j = jts , MIN(jde-1,jte)<a name='912'></font>
             <font color=#447700>!     DO i = its , MIN(ide-1,ite)<a name='913'></font>
             <font color=#447700>!         grid%icedepth(i,j) = -1.E8<a name='914'></font>
             <font color=#447700>!     ENDDO<a name='915'></font>
             <font color=#447700>! ENDDO<a name='916'></font>
          ENDIF<a name='917'>
      ENDIF<a name='918'>
    <a name='919'>
      <font color=#447700>!<a name='920'></font>
      <font color=#447700>!  Check that ALBSI field is available for SEAICE_ALBEDO_OPT == 2<a name='921'></font>
      <font color=#447700>!<a name='922'></font>
      IF ( flag_albsi == 0 ) THEN<a name='923'>
          IF ( seaice_albedo_opt == 2 ) THEN<a name='924'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1428">("Field ALBSI not found in input.  Field ALBSI is required if SEAICE_ALBEDO_OPT=2")<a name='925'>
             <font color=#447700>! DO j = jts , MIN(jde-1,jte)<a name='926'></font>
             <font color=#447700>!     DO i = its , MIN(ide-1,ite)<a name='927'></font>
             <font color=#447700>!         grid%albsi(i,j) = -1.E8<a name='928'></font>
             <font color=#447700>!     ENDDO<a name='929'></font>
             <font color=#447700>! ENDDO<a name='930'></font>
          ENDIF<a name='931'>
      ENDIF<a name='932'>
<a name='933'>
      <font color=#447700>!<a name='934'></font>
      <font color=#447700>!  Check that SNOWSI field is available for SEAICE_SNOWDEPTH_OPT == 1<a name='935'></font>
      <font color=#447700>!<a name='936'></font>
      IF ( flag_snowsi == 0 ) THEN<a name='937'>
          IF ( seaice_snowdepth_opt == 1 ) THEN<a name='938'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_ICE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1429">("Field SNOWSI not found in input.  Field SNOWSI is required if SEAICE_SNOWDEPTH_OPT=1")<a name='939'>
             <font color=#447700>! DO j = jts , MIN(jde-1,jte)<a name='940'></font>
             <font color=#447700>!     DO i = its , MIN(ide-1,ite)<a name='941'></font>
             <font color=#447700>!         grid%snowsi(i,j) = -1.E8<a name='942'></font>
             <font color=#447700>!     ENDDO<a name='943'></font>
             <font color=#447700>! ENDDO<a name='944'></font>
          ENDIF<a name='945'>
      ENDIF<a name='946'>
<a name='947'>
   END SUBROUTINE optional_ice<a name='948'>
<a name='949'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='950'></font>
<a name='951'>
<A NAME='OPTIONAL_PTHETA'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='952'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_ptheta</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_PTHETA.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_PTHETA.html' TARGET='index'>4</A><a name='953'>
                                ids, ide, jds, jde, kds, kde, &amp;<a name='954'>
                                ims, ime, jms, jme, kms, kme, &amp;<a name='955'>
                                its, ite, jts, jte, kts, kte  )<a name='956'>
<a name='957'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_15"><a name='958'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_431">	, ONLY : domain<a name='959'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_279"> , ONLY : grid_config_rec_type<a name='960'>
      USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_PTHETA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_60"><a name='961'>
<a name='962'>
      IMPLICIT NONE <a name='963'>
<a name='964'>
      TYPE ( domain ) :: grid<a name='965'>
      INTEGER , INTENT(IN) :: fid<a name='966'>
<a name='967'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='968'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='969'>
                 its, ite, jts, jte, kts, kte<a name='970'>
<a name='971'>
      INTEGER :: itmp , icnt , ierr<a name='972'>
<a name='973'>
      flag_name = '                                                                                '<a name='974'>
<a name='975'>
      flag_ptheta = 0 <a name='976'>
<a name='977'>
      flag_name(1:8) = 'PTHETA  '<a name='978'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='979'>
      IF ( ierr .EQ. 0 ) THEN<a name='980'>
         flag_ptheta = itmp<a name='981'>
      END IF<a name='982'>
<a name='983'>
      flag_name = '                                                                                '<a name='984'>
<a name='985'>
      flag_prho = 0 <a name='986'>
<a name='987'>
      flag_name(1:8) = 'PRHO    '<a name='988'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='989'>
      IF ( ierr .EQ. 0 ) THEN<a name='990'>
         flag_prho = itmp<a name='991'>
      END IF<a name='992'>
<a name='993'>
   END SUBROUTINE optional_ptheta<a name='994'>
<a name='995'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='996'></font>
<a name='997'>
<A NAME='OPTIONAL_EXCL_MIDDLE'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='998'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_excl_middle</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_EXCL_MIDDLE.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_EXCL_MIDDLE.html' TARGET='index'>4</A><a name='999'>
                                     ids, ide, jds, jde, kds, kde, &amp;<a name='1000'>
                                     ims, ime, jms, jme, kms, kme, &amp;<a name='1001'>
                                     its, ite, jts, jte, kts, kte  )<a name='1002'>
<a name='1003'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_16"><a name='1004'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_432">	, ONLY : domain<a name='1005'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_280"> , ONLY : grid_config_rec_type<a name='1006'>
      USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_EXCL_MIDDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_61"><a name='1007'>
<a name='1008'>
      IMPLICIT NONE <a name='1009'>
<a name='1010'>
      TYPE ( domain ) :: grid<a name='1011'>
      INTEGER , INTENT(IN) :: fid<a name='1012'>
<a name='1013'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='1014'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='1015'>
                 its, ite, jts, jte, kts, kte<a name='1016'>
<a name='1017'>
      INTEGER :: itmp , icnt , ierr<a name='1018'>
<a name='1019'>
      flag_name = '                                                                                '<a name='1020'>
<a name='1021'>
      flag_excluded_middle = 0 <a name='1022'>
<a name='1023'>
      flag_name(1:16) = 'EXCLUDED_MIDDLE '<a name='1024'>
      CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1025'>
      IF ( ierr .EQ. 0 ) THEN<a name='1026'>
         flag_excluded_middle = itmp<a name='1027'>
      END IF<a name='1028'>
<a name='1029'>
   END SUBROUTINE optional_excl_middle<a name='1030'>
<a name='1031'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1032'></font>
<a name='1033'>
<A NAME='OPTIONAL_LSM_LEVELS'><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1034'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>optional_lsm_levels</font> ( grid , fid , &amp; <A href='../../call_to/OPTIONAL_LSM_LEVELS.html' TARGET='index'>1</A>,<A href='../../call_from/OPTIONAL_LSM_LEVELS.html' TARGET='index'>50</A><a name='1035'>
                                    ids, ide, jds, jde, kds, kde, &amp;<a name='1036'>
                                    ims, ime, jms, jme, kms, kme, &amp;<a name='1037'>
                                    its, ite, jts, jte, kts, kte  )<a name='1038'>
<a name='1039'>
      USE <A href='../../html_code/share/module_io_wrf.F.html#MODULE_IO_WRF'>module_io_wrf</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_WRF_17"><a name='1040'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_433">	, ONLY : domain<a name='1041'>
      <font color=#447700>!USE module_configure , ONLY : grid_config_rec_type<a name='1042'></font>
      USE <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_62"><a name='1043'>
<a name='1044'>
      IMPLICIT NONE <a name='1045'>
<a name='1046'>
      TYPE ( domain ) :: grid<a name='1047'>
      INTEGER , INTENT(IN) :: fid<a name='1048'>
<a name='1049'>
      INTEGER :: ids, ide, jds, jde, kds, kde, &amp;<a name='1050'>
                 ims, ime, jms, jme, kms, kme, &amp;<a name='1051'>
                 its, ite, jts, jte, kts, kte<a name='1052'>
<a name='1053'>
      INTEGER :: itmp , icnt , ierr , i , j , k<a name='1054'>
      INTEGER :: level_above<a name='1055'>
      CHARACTER (LEN=132) :: message<a name='1056'>
    <a name='1057'>
      <font color=#447700>!  Initialize the soil temp and moisture flags to "field not found".<a name='1058'></font>
<a name='1059'>
      flag_name = '                                                                                '<a name='1060'>
<a name='1061'>
      flag_st000010 = 0 <a name='1062'>
      flag_st010040 = 0<a name='1063'>
      flag_st040100 = 0<a name='1064'>
      flag_st100200 = 0<a name='1065'>
      flag_st010200 = 0<a name='1066'>
<a name='1067'>
      flag_sm000010 = 0<a name='1068'>
      flag_sm010040 = 0<a name='1069'>
      flag_sm040100 = 0<a name='1070'>
      flag_sm100200 = 0<a name='1071'>
      flag_sm010200 = 0<a name='1072'>
<a name='1073'>
      flag_sw000010 = 0<a name='1074'>
      flag_sw010040 = 0<a name='1075'>
      flag_sw040100 = 0<a name='1076'>
      flag_sw100200 = 0<a name='1077'>
      flag_sw010200 = 0<a name='1078'>
<a name='1079'>
      flag_st000007 = 0 <a name='1080'>
      flag_st007028 = 0<a name='1081'>
      flag_st028100 = 0<a name='1082'>
      flag_st100255 = 0<a name='1083'>
<a name='1084'>
      flag_sm000007 = 0<a name='1085'>
      flag_sm007028 = 0<a name='1086'>
      flag_sm028100 = 0<a name='1087'>
      flag_sm100255 = 0<a name='1088'>
<a name='1089'>
      flag_soilt000 = 0 <a name='1090'>
      flag_soilt005 = 0 <a name='1091'>
      flag_soilt020 = 0 <a name='1092'>
      flag_soilt040 = 0 <a name='1093'>
      flag_soilt160 = 0 <a name='1094'>
      flag_soilt300 = 0 <a name='1095'>
<a name='1096'>
      flag_soilm000 = 0 <a name='1097'>
      flag_soilm005 = 0 <a name='1098'>
      flag_soilm020 = 0 <a name='1099'>
      flag_soilm040 = 0 <a name='1100'>
      flag_soilm160 = 0 <a name='1101'>
      flag_soilm300 = 0 <a name='1102'>
<a name='1103'>
      flag_soilw000 = 0 <a name='1104'>
      flag_soilw005 = 0 <a name='1105'>
      flag_soilw020 = 0 <a name='1106'>
      flag_soilw040 = 0 <a name='1107'>
      flag_soilw160 = 0 <a name='1108'>
      flag_soilw300 = 0 <a name='1109'>
<a name='1110'>
      st_levels_input = -1<a name='1111'>
      sm_levels_input = -1<a name='1112'>
      sw_levels_input = -1<a name='1113'>
<a name='1114'>
#if (EM_CORE==1)<a name='1115'>
<font color=#447700>!-------------------------------------------------------------------------<a name='1116'></font>
<font color=#447700>! NOTE:  We are assuming that soil_layers are the same for each grid point<a name='1117'></font>
<font color=#447700>!-------------------------------------------------------------------------<a name='1118'></font>
      IF ( flag_soil_levels == 1 ) THEN<a name='1119'>
<a name='1120'>
         DO k = 1, num_st_levels_input<a name='1121'>
            st_levels_input(k) = grid%soil_levels(its,num_st_levels_input + 1 - k,jts)<a name='1122'>
            sm_levels_input(k) = grid%soil_levels(its,num_st_levels_input + 1 - k,jts)<a name='1123'>
            sw_levels_input(k) = grid%soil_levels(its,num_st_levels_input + 1 - k,jts)<a name='1124'>
         END DO<a name='1125'>
<a name='1126'>
         <font color=#447700>!----------------------------------------------------------------<a name='1127'></font>
         <font color=#447700>! Flip the input soil temperature/moisture/water <a name='1128'></font>
         <font color=#447700>! profiles upside down to make k=1 closest to the sfc<a name='1129'></font>
         <font color=#447700>!----------------------------------------------------------------<a name='1130'></font>
         DO j = jts , MIN(jde-1,jte)<a name='1131'>
            DO k = 1, num_st_levels_input<a name='1132'>
               DO i = its , MIN(ide-1,ite)<a name='1133'>
                  st_input(i,k,j) = grid%soilt(i,num_st_levels_input + 1 - k,j)<a name='1134'>
                  sm_input(i,k,j) = grid%soilm(i,num_st_levels_input + 1 - k,j)<a name='1135'>
                  <font color=#447700>!-------------------------------------------------------------------------<a name='1136'></font>
                  <font color=#447700>! Initialize sw_input to 0. For 3D RUC soil moisture, there is no sw, <a name='1137'></font>
                  <font color=#447700>! but num_sw_levels_input is set to num_metgrid_soil_levels from the<a name='1138'></font>
                  <font color=#447700>! namelist causing sw_input to be used in init_soil_#_real subroutines<a name='1139'></font>
                  <font color=#447700>!-------------------------------------------------------------------------<a name='1140'></font>
                  sw_input(i,k,j) = 0.0<a name='1141'>
               END DO<a name='1142'>
            END DO<a name='1143'>
         END DO<a name='1144'>
<a name='1145'>
      END IF    <font color=#447700>! flag_soil_levels == 1<a name='1146'></font>
<a name='1147'>
      IF ( flag_soil_layers == 1 ) THEN<a name='1148'>
         level_above = 0<a name='1149'>
         DO k = 1, num_st_levels_input<a name='1150'>
            <font color=#447700>!-------------------------------------------------------------<a name='1151'></font>
            <font color=#447700>! Calculate mid-point of each layer and set to st_levels_input<a name='1152'></font>
            <font color=#447700>! Flip the input soil depths upside down to make k=1 closest to the sfc<a name='1153'></font>
            <font color=#447700>!-------------------------------------------------------------<a name='1154'></font>
            <font color=#447700>!st_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1155'></font>
            <font color=#447700>!sm_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1156'></font>
            <font color=#447700>!sw_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1157'></font>
            <font color=#447700>!level_above = grid%soil_layers(its,num_st_levels_input + 1 - k,jts)<a name='1158'></font>
            <font color=#447700>!-------------------------------------------------------------<a name='1159'></font>
            <font color=#447700>! If UM soil input, levels are cumulative (0-10cm, 0-25cm,<a name='1160'></font>
            <font color=#447700>! etc.) so we simply take the midpoint of each level - GAC<a name='1161'></font>
            <font color=#447700>!-------------------------------------------------------------<a name='1162'></font>
            IF ( flag_um_soil == 1 ) THEN<a name='1163'>
              st_levels_input(k) = (grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1164'>
              sm_levels_input(k) = (grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1165'>
              sw_levels_input(k) = (grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1166'>
            ELSE<a name='1167'>
              st_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1168'>
              sm_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1169'>
              sw_levels_input(k) = (level_above + grid%soil_layers(its,num_st_levels_input + 1 - k,jts))/2<a name='1170'>
              level_above = grid%soil_layers(its,num_st_levels_input + 1 - k,jts)<a name='1171'>
            END IF<a name='1172'>
<a name='1173'>
         END DO<a name='1174'>
<a name='1175'>
         <font color=#447700>!----------------------------------------------------------------<a name='1176'></font>
         <font color=#447700>! Flip the input soil temperature/moisture/water <a name='1177'></font>
         <font color=#447700>! profiles upside down to make k=1 closest to the sfc<a name='1178'></font>
         <font color=#447700>!----------------------------------------------------------------<a name='1179'></font>
         DO j = jts , MIN(jde-1,jte)<a name='1180'>
            DO k = 1, num_st_levels_input<a name='1181'>
               DO i = its , MIN(ide-1,ite)<a name='1182'>
                  st_input(i,k+1,j) = grid%st(i,num_st_levels_input + 1 - k,j)<a name='1183'>
                  sm_input(i,k+1,j) = grid%sm(i,num_st_levels_input + 1 - k,j)<a name='1184'>
                  sw_input(i,k+1,j) = grid%sw(i,num_st_levels_input + 1 - k,j)<a name='1185'>
               END DO<a name='1186'>
            END DO<a name='1187'>
         END DO<a name='1188'>
<a name='1189'>
         <font color=#447700>!----------------------------------------------------------------<a name='1190'></font>
         <font color=#447700>! UM input is in kg/m2, convert to volumetric soil moisture here<a name='1191'></font>
         <font color=#447700>!----------------------------------------------------------------<a name='1192'></font>
         IF ( flag_um_soil == 1 ) THEN<a name='1193'>
            DO j = jts, MIN(jde-1,jte)<a name='1194'>
               DO k = 1, num_sm_levels_input<a name='1195'>
                  DO i = its, MIN(ide-1,ite)<a name='1196'>
                    sm_input(i,k+1,j)=100.*sm_input(i,k+1,j)/(2*sm_levels_input(k)*1000.)<a name='1197'>
                  END DO<a name='1198'>
               END DO<a name='1199'>
            END DO<a name='1200'>
         END IF<a name='1201'>
<a name='1202'>
      END IF    <font color=#447700>! flag_soil_layers == 1<a name='1203'></font>
#endif<a name='1204'>
<a name='1205'>
      IF ( ( flag_soil_levels == 0 ) .AND. ( flag_soil_layers == 0 ) ) THEN        <font color=#447700>! Legacy code<a name='1206'></font>
<a name='1207'>
         flag_name(1:8) = 'ST000010'<a name='1208'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1209'>
         IF ( ierr .EQ. 0 ) THEN<a name='1210'>
            flag_st000010 = itmp<a name='1211'>
            num_st_levels_input = num_st_levels_input + 1<a name='1212'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_27">(flag_name(3:8))<a name='1213'>
            DO j = jts , MIN(jde-1,jte)<a name='1214'>
               DO i = its , MIN(ide-1,ite)<a name='1215'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st000010(i,j)<a name='1216'>
               END DO<a name='1217'>
            END DO<a name='1218'>
         END IF<a name='1219'>
         flag_name(1:8) = 'ST010040'<a name='1220'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1221'>
         IF ( ierr .EQ. 0 ) THEN<a name='1222'>
            flag_st010040 = itmp<a name='1223'>
            num_st_levels_input = num_st_levels_input + 1<a name='1224'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_28">(flag_name(3:8))<a name='1225'>
            DO j = jts , MIN(jde-1,jte)<a name='1226'>
               DO i = its , MIN(ide-1,ite)<a name='1227'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st010040(i,j)<a name='1228'>
               END DO<a name='1229'>
            END DO<a name='1230'>
         END IF<a name='1231'>
         flag_name(1:8) = 'ST040100'<a name='1232'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1233'>
         IF ( ierr .EQ. 0 ) THEN<a name='1234'>
            flag_st040100 = itmp<a name='1235'>
            num_st_levels_input = num_st_levels_input + 1<a name='1236'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_29">(flag_name(3:8))<a name='1237'>
            DO j = jts , MIN(jde-1,jte)<a name='1238'>
               DO i = its , MIN(ide-1,ite)<a name='1239'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st040100(i,j)<a name='1240'>
               END DO<a name='1241'>
            END DO<a name='1242'>
         END IF<a name='1243'>
         flag_name(1:8) = 'ST100200'<a name='1244'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1245'>
         IF ( ierr .EQ. 0 ) THEN<a name='1246'>
            flag_st100200 = itmp<a name='1247'>
            num_st_levels_input = num_st_levels_input + 1<a name='1248'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_30">(flag_name(3:8))<a name='1249'>
            DO j = jts , MIN(jde-1,jte)<a name='1250'>
               DO i = its , MIN(ide-1,ite)<a name='1251'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st100200(i,j)<a name='1252'>
               END DO<a name='1253'>
            END DO<a name='1254'>
         END IF<a name='1255'>
         flag_name(1:8) = 'ST010200'<a name='1256'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1257'>
         IF ( ierr .EQ. 0 ) THEN<a name='1258'>
            flag_st010200 = itmp<a name='1259'>
            num_st_levels_input = num_st_levels_input + 1<a name='1260'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_31">(flag_name(3:8))<a name='1261'>
            DO j = jts , MIN(jde-1,jte)<a name='1262'>
               DO i = its , MIN(ide-1,ite)<a name='1263'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st010200(i,j)<a name='1264'>
               END DO<a name='1265'>
            END DO<a name='1266'>
         END IF<a name='1267'>
         flag_name(1:8) = 'ST000007'<a name='1268'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1269'>
         IF ( ierr .EQ. 0 ) THEN<a name='1270'>
            flag_st000007 = itmp<a name='1271'>
            num_st_levels_input = num_st_levels_input + 1<a name='1272'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_32">(flag_name(3:8))<a name='1273'>
            DO j = jts , MIN(jde-1,jte)<a name='1274'>
               DO i = its , MIN(ide-1,ite)<a name='1275'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st000007(i,j)<a name='1276'>
               END DO<a name='1277'>
            END DO<a name='1278'>
         END IF<a name='1279'>
         flag_name(1:8) = 'ST007028'<a name='1280'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1281'>
         IF ( ierr .EQ. 0 ) THEN<a name='1282'>
            flag_st007028 = itmp<a name='1283'>
            num_st_levels_input = num_st_levels_input + 1<a name='1284'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_33">(flag_name(3:8))<a name='1285'>
            DO j = jts , MIN(jde-1,jte)<a name='1286'>
               DO i = its , MIN(ide-1,ite)<a name='1287'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st007028(i,j)<a name='1288'>
               END DO<a name='1289'>
            END DO<a name='1290'>
         END IF<a name='1291'>
         flag_name(1:8) = 'ST028100'<a name='1292'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1293'>
         IF ( ierr .EQ. 0 ) THEN<a name='1294'>
            flag_st028100 = itmp<a name='1295'>
            num_st_levels_input = num_st_levels_input + 1<a name='1296'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_34">(flag_name(3:8))<a name='1297'>
            DO j = jts , MIN(jde-1,jte)<a name='1298'>
               DO i = its , MIN(ide-1,ite)<a name='1299'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st028100(i,j)<a name='1300'>
               END DO<a name='1301'>
            END DO<a name='1302'>
         END IF<a name='1303'>
         flag_name(1:8) = 'ST100255'<a name='1304'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1305'>
         IF ( ierr .EQ. 0 ) THEN<a name='1306'>
            flag_st100255 = itmp<a name='1307'>
            num_st_levels_input = num_st_levels_input + 1<a name='1308'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_35">(flag_name(3:8))<a name='1309'>
            DO j = jts , MIN(jde-1,jte)<a name='1310'>
               DO i = its , MIN(ide-1,ite)<a name='1311'>
                  st_input(i,num_st_levels_input + 1,j) = grid%st100255(i,j)<a name='1312'>
               END DO<a name='1313'>
            END DO<a name='1314'>
         END IF<a name='1315'>
         flag_name(1:8) = 'SOILT000'<a name='1316'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1317'>
         IF ( ierr .EQ. 0 ) THEN<a name='1318'>
            flag_soilt000 = itmp<a name='1319'>
            num_st_levels_input = num_st_levels_input + 1<a name='1320'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_9">(flag_name(6:8))<a name='1321'>
            DO j = jts , MIN(jde-1,jte)<a name='1322'>
               DO i = its , MIN(ide-1,ite)<a name='1323'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt000(i,j)<a name='1324'>
               END DO<a name='1325'>
            END DO<a name='1326'>
         END IF<a name='1327'>
         flag_name(1:8) = 'SOILT005'<a name='1328'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1329'>
         IF ( ierr .EQ. 0 ) THEN<a name='1330'>
            flag_soilt005 = itmp<a name='1331'>
            num_st_levels_input = num_st_levels_input + 1<a name='1332'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_10">(flag_name(6:8))<a name='1333'>
            DO j = jts , MIN(jde-1,jte)<a name='1334'>
               DO i = its , MIN(ide-1,ite)<a name='1335'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt005(i,j)<a name='1336'>
               END DO<a name='1337'>
            END DO<a name='1338'>
         END IF<a name='1339'>
         flag_name(1:8) = 'SOILT020'<a name='1340'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1341'>
         IF ( ierr .EQ. 0 ) THEN<a name='1342'>
            flag_soilt020 = itmp<a name='1343'>
            num_st_levels_input = num_st_levels_input + 1<a name='1344'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_11">(flag_name(6:8))<a name='1345'>
            DO j = jts , MIN(jde-1,jte)<a name='1346'>
               DO i = its , MIN(ide-1,ite)<a name='1347'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt020(i,j)<a name='1348'>
               END DO<a name='1349'>
            END DO<a name='1350'>
         END IF<a name='1351'>
         flag_name(1:8) = 'SOILT040'<a name='1352'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1353'>
         IF ( ierr .EQ. 0 ) THEN<a name='1354'>
            flag_soilt040 = itmp<a name='1355'>
            num_st_levels_input = num_st_levels_input + 1<a name='1356'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_12">(flag_name(6:8))<a name='1357'>
            DO j = jts , MIN(jde-1,jte)<a name='1358'>
               DO i = its , MIN(ide-1,ite)<a name='1359'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt040(i,j)<a name='1360'>
               END DO<a name='1361'>
            END DO<a name='1362'>
         END IF<a name='1363'>
         flag_name(1:8) = 'SOILT160'<a name='1364'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1365'>
         IF ( ierr .EQ. 0 ) THEN<a name='1366'>
            flag_soilt160 = itmp<a name='1367'>
            num_st_levels_input = num_st_levels_input + 1<a name='1368'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_13">(flag_name(6:8))<a name='1369'>
            DO j = jts , MIN(jde-1,jte)<a name='1370'>
               DO i = its , MIN(ide-1,ite)<a name='1371'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt160(i,j)<a name='1372'>
               END DO<a name='1373'>
            END DO<a name='1374'>
         END IF<a name='1375'>
         flag_name(1:8) = 'SOILT300'<a name='1376'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1377'>
         IF ( ierr .EQ. 0 ) THEN<a name='1378'>
            flag_soilt300 = itmp<a name='1379'>
            num_st_levels_input = num_st_levels_input + 1<a name='1380'>
            st_levels_input(num_st_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_14">(flag_name(6:8))<a name='1381'>
            DO j = jts , MIN(jde-1,jte)<a name='1382'>
               DO i = its , MIN(ide-1,ite)<a name='1383'>
                  st_input(i,num_st_levels_input ,j) = grid%soilt300(i,j)<a name='1384'>
               END DO<a name='1385'>
            END DO<a name='1386'>
         END IF<a name='1387'>
<a name='1388'>
         flag_name(1:8) = 'SM000010'<a name='1389'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1390'>
         IF ( ierr .EQ. 0 ) THEN<a name='1391'>
            flag_sm000010 = itmp<a name='1392'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1393'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_36">(flag_name(3:8))<a name='1394'>
            DO j = jts , MIN(jde-1,jte)<a name='1395'>
               DO i = its , MIN(ide-1,ite)<a name='1396'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm000010(i,j)<a name='1397'>
               END DO<a name='1398'>
            END DO<a name='1399'>
         END IF<a name='1400'>
         flag_name(1:8) = 'SM010040'<a name='1401'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1402'>
         IF ( ierr .EQ. 0 ) THEN<a name='1403'>
            flag_sm010040 = itmp<a name='1404'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1405'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_37">(flag_name(3:8))<a name='1406'>
            DO j = jts , MIN(jde-1,jte)<a name='1407'>
               DO i = its , MIN(ide-1,ite)<a name='1408'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm010040(i,j)<a name='1409'>
               END DO<a name='1410'>
            END DO<a name='1411'>
         END IF<a name='1412'>
         flag_name(1:8) = 'SM040100'<a name='1413'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1414'>
         IF ( ierr .EQ. 0 ) THEN<a name='1415'>
            flag_sm040100 = itmp<a name='1416'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1417'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_38">(flag_name(3:8))<a name='1418'>
            DO j = jts , MIN(jde-1,jte)<a name='1419'>
               DO i = its , MIN(ide-1,ite)<a name='1420'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm040100(i,j)<a name='1421'>
               END DO<a name='1422'>
            END DO<a name='1423'>
         END IF<a name='1424'>
         flag_name(1:8) = 'SM100200'<a name='1425'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1426'>
         IF ( ierr .EQ. 0 ) THEN<a name='1427'>
            flag_sm100200 = itmp<a name='1428'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1429'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_39">(flag_name(3:8))<a name='1430'>
            DO j = jts , MIN(jde-1,jte)<a name='1431'>
               DO i = its , MIN(ide-1,ite)<a name='1432'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm100200(i,j)<a name='1433'>
               END DO<a name='1434'>
            END DO<a name='1435'>
         END IF<a name='1436'>
         flag_name(1:8) = 'SM010200'<a name='1437'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1438'>
         IF ( ierr .EQ. 0 ) THEN<a name='1439'>
            flag_sm010200 = itmp<a name='1440'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1441'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_40">(flag_name(3:8))<a name='1442'>
            DO j = jts , MIN(jde-1,jte)<a name='1443'>
               DO i = its , MIN(ide-1,ite)<a name='1444'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm010200(i,j)<a name='1445'>
               END DO<a name='1446'>
            END DO<a name='1447'>
         END IF<a name='1448'>
         flag_name(1:8) = 'SM000007'<a name='1449'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1450'>
         IF ( ierr .EQ. 0 ) THEN<a name='1451'>
            flag_sm000007 = itmp<a name='1452'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1453'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_41">(flag_name(3:8))<a name='1454'>
            DO j = jts , MIN(jde-1,jte)<a name='1455'>
               DO i = its , MIN(ide-1,ite)<a name='1456'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm000007(i,j)<a name='1457'>
               END DO<a name='1458'>
            END DO<a name='1459'>
         END IF<a name='1460'>
         flag_name(1:8) = 'SM007028'<a name='1461'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1462'>
         IF ( ierr .EQ. 0 ) THEN<a name='1463'>
            flag_sm007028 = itmp<a name='1464'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1465'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_42">(flag_name(3:8))<a name='1466'>
            DO j = jts , MIN(jde-1,jte)<a name='1467'>
               DO i = its , MIN(ide-1,ite)<a name='1468'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm007028(i,j)<a name='1469'>
               END DO<a name='1470'>
            END DO<a name='1471'>
         END IF<a name='1472'>
         flag_name(1:8) = 'SM028100'<a name='1473'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1474'>
         IF ( ierr .EQ. 0 ) THEN<a name='1475'>
            flag_sm028100 = itmp<a name='1476'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1477'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_43">(flag_name(3:8))<a name='1478'>
            DO j = jts , MIN(jde-1,jte)<a name='1479'>
               DO i = its , MIN(ide-1,ite)<a name='1480'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm028100(i,j)<a name='1481'>
               END DO<a name='1482'>
            END DO<a name='1483'>
         END IF<a name='1484'>
         flag_name(1:8) = 'SM100255'<a name='1485'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1486'>
         IF ( ierr .EQ. 0 ) THEN<a name='1487'>
            flag_sm100255 = itmp<a name='1488'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1489'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_44">(flag_name(3:8))<a name='1490'>
            DO j = jts , MIN(jde-1,jte)<a name='1491'>
               DO i = its , MIN(ide-1,ite)<a name='1492'>
                  sm_input(i,num_sm_levels_input + 1,j) = grid%sm100255(i,j)<a name='1493'>
               END DO<a name='1494'>
            END DO<a name='1495'>
         END IF<a name='1496'>
         flag_name(1:8) = 'SOILM000'<a name='1497'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1498'>
         IF ( ierr .EQ. 0 ) THEN<a name='1499'>
            flag_soilm000 = itmp<a name='1500'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1501'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_15">(flag_name(6:8))<a name='1502'>
            DO j = jts , MIN(jde-1,jte)<a name='1503'>
               DO i = its , MIN(ide-1,ite)<a name='1504'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm000(i,j)<a name='1505'>
               END DO<a name='1506'>
            END DO<a name='1507'>
         END IF<a name='1508'>
         flag_name(1:8) = 'SOILM005'<a name='1509'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1510'>
         IF ( ierr .EQ. 0 ) THEN<a name='1511'>
            flag_soilm005 = itmp<a name='1512'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1513'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_16">(flag_name(6:8))<a name='1514'>
            DO j = jts , MIN(jde-1,jte)<a name='1515'>
               DO i = its , MIN(ide-1,ite)<a name='1516'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm005(i,j)<a name='1517'>
               END DO<a name='1518'>
            END DO<a name='1519'>
         END IF<a name='1520'>
         flag_name(1:8) = 'SOILM020'<a name='1521'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1522'>
         IF ( ierr .EQ. 0 ) THEN<a name='1523'>
            flag_soilm020 = itmp<a name='1524'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1525'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_17">(flag_name(6:8))<a name='1526'>
            DO j = jts , MIN(jde-1,jte)<a name='1527'>
               DO i = its , MIN(ide-1,ite)<a name='1528'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm020(i,j)<a name='1529'>
               END DO<a name='1530'>
            END DO<a name='1531'>
         END IF<a name='1532'>
         flag_name(1:8) = 'SOILM040'<a name='1533'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1534'>
         IF ( ierr .EQ. 0 ) THEN<a name='1535'>
            flag_soilm040 = itmp<a name='1536'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1537'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_18">(flag_name(6:8))<a name='1538'>
            DO j = jts , MIN(jde-1,jte)<a name='1539'>
               DO i = its , MIN(ide-1,ite)<a name='1540'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm040(i,j)<a name='1541'>
               END DO<a name='1542'>
            END DO<a name='1543'>
         END IF<a name='1544'>
         flag_name(1:8) = 'SOILM160'<a name='1545'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1546'>
         IF ( ierr .EQ. 0 ) THEN<a name='1547'>
            flag_soilm160 = itmp<a name='1548'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1549'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_19">(flag_name(6:8))<a name='1550'>
            DO j = jts , MIN(jde-1,jte)<a name='1551'>
               DO i = its , MIN(ide-1,ite)<a name='1552'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm160(i,j)<a name='1553'>
               END DO<a name='1554'>
            END DO<a name='1555'>
         END IF<a name='1556'>
         flag_name(1:8) = 'SOILM300'<a name='1557'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1558'>
         IF ( ierr .EQ. 0 ) THEN<a name='1559'>
            flag_soilm300 = itmp<a name='1560'>
            num_sm_levels_input = num_sm_levels_input + 1<a name='1561'>
            sm_levels_input(num_sm_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_20">(flag_name(6:8))<a name='1562'>
            DO j = jts , MIN(jde-1,jte)<a name='1563'>
               DO i = its , MIN(ide-1,ite)<a name='1564'>
                  sm_input(i,num_sm_levels_input ,j) = grid%soilm300(i,j)<a name='1565'>
               END DO<a name='1566'>
            END DO<a name='1567'>
         END IF<a name='1568'>
<a name='1569'>
         flag_name(1:8) = 'SW000010'<a name='1570'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1571'>
         IF ( ierr .EQ. 0 ) THEN<a name='1572'>
            flag_sw000010 = itmp<a name='1573'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1574'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_45">(flag_name(3:8))<a name='1575'>
            DO j = jts , MIN(jde-1,jte)<a name='1576'>
               DO i = its , MIN(ide-1,ite)<a name='1577'>
                  sw_input(i,num_sw_levels_input + 1,j) = grid%sw000010(i,j)<a name='1578'>
               END DO<a name='1579'>
            END DO<a name='1580'>
         END IF<a name='1581'>
         flag_name(1:8) = 'SW010040'<a name='1582'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1583'>
         IF ( ierr .EQ. 0 ) THEN<a name='1584'>
            flag_sw010040 = itmp<a name='1585'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1586'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_46">(flag_name(3:8))<a name='1587'>
            DO j = jts , MIN(jde-1,jte)<a name='1588'>
               DO i = its , MIN(ide-1,ite)<a name='1589'>
                  sw_input(i,num_sw_levels_input + 1,j) = grid%sw010040(i,j)<a name='1590'>
               END DO<a name='1591'>
            END DO<a name='1592'>
         END IF<a name='1593'>
         flag_name(1:8) = 'SW040100'<a name='1594'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1595'>
         IF ( ierr .EQ. 0 ) THEN<a name='1596'>
            flag_sw040100 = itmp<a name='1597'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1598'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_47">(flag_name(3:8))<a name='1599'>
            DO j = jts , MIN(jde-1,jte)<a name='1600'>
               DO i = its , MIN(ide-1,ite)<a name='1601'>
                  sw_input(i,num_sw_levels_input + 1,j) = grid%sw040100(i,j)<a name='1602'>
               END DO<a name='1603'>
            END DO<a name='1604'>
         END IF<a name='1605'>
         flag_name(1:8) = 'SW100200'<a name='1606'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1607'>
         IF ( ierr .EQ. 0 ) THEN<a name='1608'>
            flag_sw100200 = itmp<a name='1609'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1610'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_48">(flag_name(3:8))<a name='1611'>
            DO j = jts , MIN(jde-1,jte)<a name='1612'>
               DO i = its , MIN(ide-1,ite)<a name='1613'>
                  sw_input(i,num_sw_levels_input + 1,j) = grid%sw100200(i,j)<a name='1614'>
               END DO<a name='1615'>
            END DO<a name='1616'>
         END IF<a name='1617'>
         flag_name(1:8) = 'SW010200'<a name='1618'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1619'>
         IF ( ierr .EQ. 0 ) THEN<a name='1620'>
            flag_sw010200 = itmp<a name='1621'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1622'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2'>char2int2</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT2_49">(flag_name(3:8))<a name='1623'>
            DO j = jts , MIN(jde-1,jte)<a name='1624'>
               DO i = its , MIN(ide-1,ite)<a name='1625'>
                  sw_input(i,num_sw_levels_input + 1,j) = grid%sw010200(i,j)<a name='1626'>
               END DO<a name='1627'>
            END DO<a name='1628'>
         END IF<a name='1629'>
         flag_name(1:8) = 'SOILW000'<a name='1630'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1631'>
         IF ( ierr .EQ. 0 ) THEN<a name='1632'>
            flag_soilw000 = itmp<a name='1633'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1634'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_21">(flag_name(6:8))<a name='1635'>
            DO j = jts , MIN(jde-1,jte)<a name='1636'>
               DO i = its , MIN(ide-1,ite)<a name='1637'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw000(i,j)<a name='1638'>
               END DO<a name='1639'>
            END DO<a name='1640'>
         END IF<a name='1641'>
         flag_name(1:8) = 'SOILW005'<a name='1642'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1643'>
         IF ( ierr .EQ. 0 ) THEN<a name='1644'>
            flag_soilw005 = itmp<a name='1645'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1646'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_22">(flag_name(6:8))<a name='1647'>
            DO j = jts , MIN(jde-1,jte)<a name='1648'>
               DO i = its , MIN(ide-1,ite)<a name='1649'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw005(i,j)<a name='1650'>
               END DO<a name='1651'>
            END DO<a name='1652'>
         END IF<a name='1653'>
         flag_name(1:8) = 'SOILW020'<a name='1654'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1655'>
         IF ( ierr .EQ. 0 ) THEN<a name='1656'>
            flag_soilw020 = itmp<a name='1657'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1658'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_23">(flag_name(6:8))<a name='1659'>
            DO j = jts , MIN(jde-1,jte)<a name='1660'>
               DO i = its , MIN(ide-1,ite)<a name='1661'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw020(i,j)<a name='1662'>
               END DO<a name='1663'>
            END DO<a name='1664'>
         END IF<a name='1665'>
         flag_name(1:8) = 'SOILW040'<a name='1666'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1667'>
         IF ( ierr .EQ. 0 ) THEN<a name='1668'>
            flag_soilw040 = itmp<a name='1669'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1670'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_24">(flag_name(6:8))<a name='1671'>
            DO j = jts , MIN(jde-1,jte)<a name='1672'>
               DO i = its , MIN(ide-1,ite)<a name='1673'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw040(i,j)<a name='1674'>
               END DO<a name='1675'>
            END DO<a name='1676'>
         END IF<a name='1677'>
         flag_name(1:8) = 'SOILW160'<a name='1678'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1679'>
         IF ( ierr .EQ. 0 ) THEN<a name='1680'>
            flag_soilw160 = itmp<a name='1681'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1682'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_25">(flag_name(6:8))<a name='1683'>
            DO j = jts , MIN(jde-1,jte)<a name='1684'>
               DO i = its , MIN(ide-1,ite)<a name='1685'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw160(i,j)<a name='1686'>
               END DO<a name='1687'>
            END DO<a name='1688'>
         END IF<a name='1689'>
         flag_name(1:8) = 'SOILW300'<a name='1690'>
         CALL wrf_get_dom_ti_integer ( fid, 'FLAG_' // flag_name, itmp, 1, icnt, ierr ) <a name='1691'>
         IF ( ierr .EQ. 0 ) THEN<a name='1692'>
            flag_soilw300 = itmp<a name='1693'>
            num_sw_levels_input = num_sw_levels_input + 1<a name='1694'>
            sw_levels_input(num_sw_levels_input) = <A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1'>char2int1</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHAR2INT1_26">(flag_name(6:8))<a name='1695'>
            DO j = jts , MIN(jde-1,jte)<a name='1696'>
               DO i = its , MIN(ide-1,ite)<a name='1697'>
                  sw_input(i,num_sw_levels_input ,j) = grid%soilw300(i,j)<a name='1698'>
               END DO<a name='1699'>
            END DO<a name='1700'>
         END IF<a name='1701'>
<a name='1702'>
      END IF       <font color=#447700>! End of legacy code for temperature and moisture<a name='1703'></font>
<a name='1704'>
<font color=#447700>! The flags flag_st*, flag_sm*, flag_sw*, flag_soilt*, flag_soilm*, flag_soilw* are no longer used.<a name='1705'></font>
<font color=#447700>! If the new flags flag_soil_layers or flag_soil_levels are not set in met_em, and some legacy<a name='1706'></font>
<font color=#447700>! flags are, reset the new flags<a name='1707'></font>
    <a name='1708'>
      IF ( ( flag_soil_levels == 0 ) .AND. ( flag_soil_layers == 0 ) ) THEN<a name='1709'>
         IF ( flag_st000010 == 1 .OR. flag_st010040 == 1 .OR. flag_st040100 == 1 .OR. &amp;<a name='1710'>
              flag_st100200 == 1 .OR. flag_st010200 == 1 .OR. &amp;<a name='1711'>
              flag_sm000010 == 1 .OR. flag_sm010040 == 1 .OR. flag_sm040100 == 1 .OR. &amp;<a name='1712'>
              flag_sm100200 == 1 .OR. flag_sm010200 == 1 .OR. &amp;<a name='1713'>
              flag_sw000010 == 1 .OR. flag_sw010040 == 1 .OR. flag_sw040100 == 1 .OR. &amp;<a name='1714'>
              flag_sw100200 == 1 .OR. flag_sw010200 == 1 .OR. &amp;<a name='1715'>
              flag_st000007 == 1 .OR. flag_st007028 == 1 .OR. flag_st028100 == 1 .OR. &amp;<a name='1716'>
              flag_st100255 == 1 .OR. &amp;<a name='1717'>
              flag_sm000007 == 1 .OR. flag_sm007028 == 1 .OR. flag_sm028100 == 1 .OR. &amp;<a name='1718'>
              flag_sm100255 == 1 ) THEN<a name='1719'>
            flag_soil_layers=1<a name='1720'>
         END IF<a name='1721'>
         IF ( flag_soilt000 == 1 .OR. flag_soilt005 == 1 .OR. flag_soilt020 == 1 .OR. &amp;<a name='1722'>
              flag_soilt040 == 1 .OR. flag_soilt160 == 1 .OR. flag_soilt300 == 1 .OR. &amp;<a name='1723'>
              flag_soilm000 == 1 .OR. flag_soilm005 == 1 .OR. flag_soilm020 == 1 .OR. &amp;<a name='1724'>
              flag_soilm040 == 1 .OR. flag_soilm160 == 1 .OR. flag_soilm300 == 1 .OR. &amp;<a name='1725'>
              flag_soilw000 == 1 .OR. flag_soilw005 == 1 .OR. flag_soilw020 == 1 .OR. &amp;<a name='1726'>
              flag_soilw040 == 1 .OR. flag_soilw160 == 1 .OR. flag_soilw300 == 1 ) THEN<a name='1727'>
            flag_soil_levels=1<a name='1728'>
         END IF<a name='1729'>
      END IF<a name='1730'>
<a name='1731'>
      write (message,'(A,I3)') 'flag_soil_layers at end of optional_lsm_levels is',flag_soil_layers<a name='1732'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1076">(1,message)<a name='1733'>
      write (message,'(A,I3)') 'flag_soil_levels at end of optional_lsm_levels is',flag_soil_levels<a name='1734'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1077">(1,message)<a name='1735'>
<a name='1736'>
      write (message,'(A,10(i3,1x))') 'st_levels_input = ', (st_levels_input(k), k=1,num_st_levels_input)<a name='1737'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1078">(1,message)<a name='1738'>
      write (message,'(A,10(i3,1x))') 'sm_levels_input = ', (sm_levels_input(k), k=1,num_sm_levels_input)<a name='1739'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1079">(1,message)<a name='1740'>
      write (message,'(A,10(i3,1x))') 'sw_levels_input = ', (sw_levels_input(k), k=1,num_sw_levels_input)<a name='1741'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1080">(1,message)<a name='1742'>
<a name='1743'>
      <font color=#447700>!  OK, let's do a quick sanity check.<a name='1744'></font>
 <a name='1745'>
      IF ( ( num_st_levels_input .GT. num_st_levels_alloc ) .OR. &amp;<a name='1746'>
           ( num_sm_levels_input .GT. num_sm_levels_alloc ) .OR. &amp;<a name='1747'>
           ( num_sw_levels_input .GT. num_sw_levels_alloc ) ) THEN<a name='1748'>
         print *,'pain and woe, the soil level allocation is too small'<a name='1749'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_optional_input.F.html#OPTIONAL_LSM_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1430"> ( 'soil_levels_too_few' )<a name='1750'>
      END IF<a name='1751'>
<a name='1752'>
   END SUBROUTINE optional_lsm_levels<a name='1753'>
<a name='1754'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1755'></font>
<a name='1756'>
<A NAME='CHAR2INT1'><A href='../../html_code/share/module_optional_input.F.html#CHAR2INT1' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1757'>
   <font color=#993300>FUNCTION </font><font color=#cc0000>char2int1</font>( string3 ) RESULT ( int1 ) <A href='../../call_to/CHAR2INT1.html' TARGET='index'>26</A><a name='1758'>
      CHARACTER (LEN=3) , INTENT(IN) :: string3<a name='1759'>
      INTEGER :: i1 , int1<a name='1760'>
      READ(string3,fmt='(I3)') i1<a name='1761'>
      int1 = i1<a name='1762'>
   END FUNCTION char2int1<a name='1763'>
<a name='1764'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1765'></font>
<a name='1766'>
<A NAME='CHAR2INT2'><A href='../../html_code/share/module_optional_input.F.html#CHAR2INT2' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1767'>
   <font color=#993300>FUNCTION </font><font color=#cc0000>char2int2</font>( string6 ) RESULT ( int1 ) <A href='../../call_to/CHAR2INT2.html' TARGET='index'>49</A><a name='1768'>
      CHARACTER (LEN=6) , INTENT(IN) :: string6<a name='1769'>
      INTEGER :: i2 , i1 , int1<a name='1770'>
      READ(string6,fmt='(I3,I3)') i1,i2<a name='1771'>
      int1 = ( i2 + i1 ) / 2<a name='1772'>
   END FUNCTION char2int2<a name='1773'>
<a name='1774'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='1775'></font>
#endif<a name='1776'>
END MODULE module_optional_input<a name='1777'>
</pre></body></html>