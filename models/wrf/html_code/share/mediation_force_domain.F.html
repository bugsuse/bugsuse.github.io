<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!<a name='2'></font>
<font color=#447700>!WRF:MEDIATION_LAYER:NESTING<a name='3'></font>
<font color=#447700>!<a name='4'></font>
<A NAME='MED_FORCE_DOMAIN'><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='5'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>med_force_domain</font> ( parent_grid , nested_grid ) <A href='../../call_to/MED_FORCE_DOMAIN.html' TARGET='index'>1</A>,<A href='../../call_from/MED_FORCE_DOMAIN.html' TARGET='index'>51</A><a name='6'>
#ifdef NMM_FIND_LOAD_IMBALANCE<a name='7'>
   USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>module_timing</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_46">, only: now_time<a name='8'>
#endif<a name='9'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_324"><a name='10'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_201"><a name='11'>
   USE <A href='../../html_code/frame/module_intermediate_nmm.F.html#MODULE_INTERMEDIATE_NMM'>module_intermediate_nmm</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_INTERMEDIATE_NMM_2"><a name='12'>
#ifdef DM_PARALLEL<a name='13'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_176">, ONLY : intercomm_active, &amp;<a name='14'>
                         mpi_comm_to_kid, mpi_comm_to_mom, which_kid<a name='15'>
#else<a name='16'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_177">, ONLY : intercomm_active<a name='17'>
#endif<a name='18'>
<a name='19'>
   IMPLICIT NONE<a name='20'>
   TYPE(domain), POINTER :: parent_grid , nested_grid<a name='21'>
   TYPE(domain), POINTER :: grid<a name='22'>
   INTEGER nlev, msize<a name='23'>
#ifdef NMM_FIND_LOAD_IMBALANCE<a name='24'>
   REAL(kind=8), save :: total_time(40)=0<a name='25'>
   REAL(kind=8) :: this_time<a name='26'>
   character*255 :: message<a name='27'>
#endif<a name='28'>
#if <font color=#447700>!defined(MAC_KLUDGE)<a name='29'></font>
   TYPE (grid_config_rec_type)            :: config_flags<a name='30'>
#endif<a name='31'>
<a name='32'>
<font color=#447700>! ----------------------------------------------------------<a name='33'></font>
<font color=#447700>! ------------------------------------------------------<a name='34'></font>
<font color=#447700>! Interface blocks<a name='35'></font>
<font color=#447700>! ------------------------------------------------------<a name='36'></font>
   INTERFACE<a name='37'>
<font color=#447700>! ------------------------------------------------------<a name='38'></font>
<font color=#447700>!    Interface definitions for EM CORE<a name='39'></font>
<font color=#447700>! ------------------------------------------------------<a name='40'></font>
#if (EM_CORE == 1)<a name='41'>
#if <font color=#447700>!defined(MAC_KLUDGE)<a name='42'></font>
<font color=#447700>! ------------------------------------------------------<a name='43'></font>
<font color=#447700>!    These routines are supplied by module_dm.F from the<a name='44'></font>
<font color=#447700>!    external communication package (e.g. external/RSL)<a name='45'></font>
<font color=#447700>! ------------------------------------------------------<a name='46'></font>
      SUBROUTINE interp_domain_em_part1 ( grid, intermediate_grid, ngrid, config_flags   &amp;<a name='47'>
<font color=#447700>!<a name='48'></font>
#        include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_1"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='49'>
<font color=#447700>!<a name='50'></font>
                 )<a name='51'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_325"><a name='52'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_202"><a name='53'>
         TYPE(domain), POINTER :: grid          <font color=#447700>! name of the grid being dereferenced (must be "grid")<a name='54'></font>
         TYPE(domain), POINTER :: intermediate_grid<a name='55'>
         TYPE(domain), POINTER :: ngrid<a name='56'>
         TYPE (grid_config_rec_type)            :: config_flags<a name='57'>
#        include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_2"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='58'>
      END SUBROUTINE interp_domain_em_part1<a name='59'>
<a name='60'>
      SUBROUTINE force_domain_em_part2 ( grid, nested_grid, parent_grid, config_flags   &amp;<a name='61'>
<font color=#447700>!<a name='62'></font>
#        include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_3"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='63'>
<font color=#447700>!<a name='64'></font>
                 )<a name='65'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_326"><a name='66'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_203"><a name='67'>
         TYPE(domain), POINTER :: grid          <font color=#447700>! name of the grid being dereferenced (must be "grid")<a name='68'></font>
         TYPE(domain), POINTER :: nested_grid<a name='69'>
	 TYPE(domain), POINTER :: parent_grid   <font color=#447700>! KAL added for vertical nesting<a name='70'></font>
         TYPE (grid_config_rec_type)            :: config_flags<a name='71'>
#        include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_4"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='72'>
      END SUBROUTINE force_domain_em_part2<a name='73'>
<a name='74'>
<font color=#447700>! ----------------------------------------------------------<a name='75'></font>
<font color=#447700>!    This routine is supplied by dyn_em/couple_or_uncouple_em.F<a name='76'></font>
<font color=#447700>! ----------------------------------------------------------<a name='77'></font>
      SUBROUTINE couple_or_uncouple_em ( grid, config_flags , couple  &amp;<a name='78'>
<font color=#447700>!<a name='79'></font>
#        include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_5"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='80'>
<font color=#447700>!<a name='81'></font>
                 )<a name='82'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_327"><a name='83'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_204"><a name='84'>
         TYPE(domain), INTENT(INOUT)            :: grid<a name='85'>
         TYPE (grid_config_rec_type)            :: config_flags<a name='86'>
         LOGICAL, INTENT(   IN) :: couple<a name='87'>
#        include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_6"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='88'>
      END SUBROUTINE couple_or_uncouple_em<a name='89'>
#endif<a name='90'>
#endif<a name='91'>
<font color=#447700>! ----------------------------------------------------------<a name='92'></font>
<font color=#447700>!    Interface definitions for NMM (placeholder)<a name='93'></font>
<font color=#447700>! ----------------------------------------------------------<a name='94'></font>
#if (NMM_CORE == 1 &amp;&amp; NMM_NEST ==1)<a name='95'>
<font color=#447700>!=======================================================================<a name='96'></font>
<font color=#447700>!  Added for the NMM core. This is gopal's doing.<a name='97'></font>
<font color=#447700>!=======================================================================<a name='98'></font>
<a name='99'>
      SUBROUTINE force_domain_nmm_part1 ( grid, intermediate_grid, ngrid, config_flags    &amp;<a name='100'>
<font color=#447700>!<a name='101'></font>
# include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_7"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='102'>
<font color=#447700>!<a name='103'></font>
                 )<a name='104'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_328"><a name='105'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_205"><a name='106'>
         TYPE(domain), POINTER :: grid          <font color=#447700>! name of the grid being dereferenced (must be "grid")<a name='107'></font>
         TYPE(domain), POINTER :: intermediate_grid<a name='108'>
         TYPE(domain), POINTER :: ngrid<a name='109'>
         TYPE (grid_config_rec_type)            :: config_flags<a name='110'>
# include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_8"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='111'>
      END SUBROUTINE force_domain_nmm_part1<a name='112'>
<a name='113'>
      SUBROUTINE before_interp_halos_nmm(grid,config_flags &amp;<a name='114'>
<font color=#447700>!<a name='115'></font>
#include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_9"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='116'>
<font color=#447700>!<a name='117'></font>
                 )<a name='118'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_329"><a name='119'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>MODULE_CONFIGURE</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_206"><a name='120'>
         TYPE(domain), POINTER :: grid<a name='121'>
         TYPE (grid_config_rec_type)            :: config_flags<a name='122'>
#  include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_10"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='123'>
       END SUBROUTINE before_interp_halos_nmm<a name='124'>
<a name='125'>
      SUBROUTINE force_domain_nmm_part2 ( grid, nested_grid, config_flags    &amp;<a name='126'>
<font color=#447700>!<a name='127'></font>
# include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_11"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='128'>
<font color=#447700>!<a name='129'></font>
                 )<a name='130'>
         USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_330"><a name='131'>
         USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_207"><a name='132'>
         TYPE(domain), POINTER :: grid          <font color=#447700>! name of the grid being dereferenced (must be "grid")<a name='133'></font>
         TYPE(domain), POINTER :: nested_grid<a name='134'>
         TYPE (grid_config_rec_type)            :: config_flags<a name='135'>
<a name='136'>
# include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_12"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='137'>
      END SUBROUTINE force_domain_nmm_part2<a name='138'>
<font color=#447700>!=======================================================================<a name='139'></font>
<font color=#447700>!  End of gopal's doing.<a name='140'></font>
<font color=#447700>!=======================================================================<a name='141'></font>
#endif<a name='142'>
<font color=#447700>! ----------------------------------------------------------<a name='143'></font>
<font color=#447700>!    Interface definitions for COAMPS (placeholder)<a name='144'></font>
<font color=#447700>! ----------------------------------------------------------<a name='145'></font>
   END INTERFACE<a name='146'>
<font color=#447700>! ----------------------------------------------------------<a name='147'></font>
<font color=#447700>! End of Interface blocks<a name='148'></font>
<font color=#447700>! ----------------------------------------------------------<a name='149'></font>
<font color=#447700>! ----------------------------------------------------------<a name='150'></font>
<font color=#447700>! ----------------------------------------------------------<a name='151'></font>
<font color=#447700>! Executable code<a name='152'></font>
<font color=#447700>! ----------------------------------------------------------<a name='153'></font>
<font color=#447700>! ----------------------------------------------------------<a name='154'></font>
<font color=#447700>!    Forcing calls for EM CORE.<a name='155'></font>
<font color=#447700>! ----------------------------------------------------------<a name='156'></font>
#if (EM_CORE == 1 &amp;&amp; defined( DM_PARALLEL ))<a name='157'>
# if <font color=#447700>!defined(MAC_KLUDGE)<a name='158'></font>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_52"> ( nested_grid%id , model_config_rec , config_flags )<a name='159'>
<a name='160'>
   grid =&gt; nested_grid%intermediate_grid<a name='161'>
#  if (defined(MOVE_NESTS) || ((<font color=#447700>!defined(KEEP_INT_AROUND)) &amp;&amp; (!defined(SGIALTIX)) &amp;&amp; (!defined(FUJITSU_FX10))))<a name='162'></font>
<font color=#447700>!   IF ( intercomm_active(grid%id) ) THEN<a name='163'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD'>alloc_space_field</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_SPACE_FIELD_6"> ( grid, grid%id , 1 , 2 ,  .TRUE. , intercomm_active(grid%id),    &amp;<a name='164'>
                            grid%sd31, grid%ed31, grid%sd32, grid%ed32, grid%sd33, grid%ed33, &amp;<a name='165'>
                            grid%sm31,  grid%em31,  grid%sm32,  grid%em32,  grid%sm33,  grid%em33, &amp;<a name='166'>
                            grid%sp31,  grid%ep31,  grid%sp32,  grid%ep32,  grid%sp33,  grid%ep33, &amp;<a name='167'>
                            grid%sp31x, grid%ep31x, grid%sp32x, grid%ep32x, grid%sp33x, grid%ep33x,&amp;<a name='168'>
                            grid%sp31y, grid%ep31y, grid%sp32y, grid%ep32y, grid%sp33y, grid%ep33y,&amp;<a name='169'>
                            grid%sm31x, grid%em31x, grid%sm32x, grid%em32x, grid%sm33x, grid%em33x, &amp;   <font color=#447700>! x-xpose<a name='170'></font>
                            grid%sm31y, grid%em31y, grid%sm32y, grid%em32y, grid%sm33y, grid%em33y  &amp;   <font color=#447700>! y-xpose<a name='171'></font>
     )<a name='172'>
<font color=#447700>!   ENDIF<a name='173'></font>
#  endif<a name='174'>
<a name='175'>
   <font color=#447700>! couple parent domain<a name='176'></font>
   grid =&gt; parent_grid<a name='177'>
   IF ( grid%active_this_task ) THEN<a name='178'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_18">(grid%id)<a name='179'>
   <font color=#447700>! swich config_flags to point to parent rconfig info<a name='180'></font>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_53"> ( grid%id , model_config_rec , config_flags )<a name='181'>
     CALL <A href='../../html_code/dyn_em/couple_or_uncouple_em.F.html#COUPLE_OR_UNCOUPLE_EM'>couple_or_uncouple_em</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_OR_UNCOUPLE_EM_1"> ( grid , config_flags ,  .true. &amp;<a name='182'>
<font color=#447700>!<a name='183'></font>
#         include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_13"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='184'>
<font color=#447700>!<a name='185'></font>
                                )<a name='186'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_18"><a name='187'>
   ENDIF<a name='188'>
   <font color=#447700>! couple nested domain<a name='189'></font>
   grid =&gt; nested_grid<a name='190'>
   IF ( grid%active_this_task ) THEN<a name='191'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_19">(grid%id)<a name='192'>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_54"> ( grid%id , model_config_rec , config_flags )<a name='193'>
     CALL <A href='../../html_code/dyn_em/couple_or_uncouple_em.F.html#COUPLE_OR_UNCOUPLE_EM'>couple_or_uncouple_em</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_OR_UNCOUPLE_EM_2"> ( grid , config_flags ,  .true. &amp;<a name='194'>
<font color=#447700>!<a name='195'></font>
#         include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_14"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='196'>
<font color=#447700>!<a name='197'></font>
                                   )<a name='198'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_19"><a name='199'>
   ENDIF<a name='200'>
   <font color=#447700>! perform first part: transfer data from parent to intermediate domain<a name='201'></font>
   <font color=#447700>! at the same resolution but on the same decomposition as the nest<a name='202'></font>
   <font color=#447700>! note that this will involve communication on multiple DM procs<a name='203'></font>
   grid =&gt; parent_grid<a name='204'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_55"> ( grid%id , model_config_rec , config_flags )<a name='205'>
   <font color=#447700>!<a name='206'></font>
   <font color=#447700>! Added following line to handle adaptive time step.  This should probably<a name='207'></font>
   <font color=#447700>!   go somewhere else, but I'm not sure where.<a name='208'></font>
   <font color=#447700>!   <a name='209'></font>
   <font color=#447700>! T. Hutchinson, WSI  1/23/07<a name='210'></font>
   <font color=#447700>!<a name='211'></font>
<a name='212'>
   IF ( parent_grid%active_this_task .AND. nested_grid%active_this_task ) THEN<a name='213'>
     nested_grid%intermediate_grid%dt = grid%dt<a name='214'>
   ENDIF<a name='215'>
   IF ( parent_grid%active_this_task ) THEN<a name='216'>
     CALL BYTE_BCAST( parent_grid%dt,RWORDSIZE,mpi_comm_to_kid( which_kid( nested_grid%id ) , parent_grid%id ))<a name='217'>
   ELSE IF ( nested_grid%active_this_task ) THEN<a name='218'>
     CALL BYTE_BCAST( nested_grid%dt,RWORDSIZE,mpi_comm_to_mom( nested_grid%id ) )<a name='219'>
   ENDIF<a name='220'>
<a name='221'>
   IF ( parent_grid%active_this_task .OR. nested_grid%active_this_task ) THEN<a name='222'>
     CALL <A href='../../html_code/frame/module_dm.F.html#WRF_DM_NESTEXCHANGE_INIT'>wrf_dm_nestexchange_init</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_NESTEXCHANGE_INIT_4"><a name='223'>
<a name='224'>
     CALL <A href='../../html_code/frame/module_dm.F.html#INTERP_DOMAIN_EM_PART1'>interp_domain_em_part1</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INTERP_DOMAIN_EM_PART1_1"> ( grid , nested_grid%intermediate_grid, nested_grid, config_flags  &amp;<a name='225'>
<font color=#447700>!<a name='226'></font>
#         include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_15"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='227'>
<font color=#447700>!<a name='228'></font>
                                    )<a name='229'>
   ENDIF<a name='230'>
<a name='231'>
  IF ( nested_grid%active_this_task ) THEN<a name='232'>
   grid =&gt; nested_grid%intermediate_grid<a name='233'>
      <font color=#447700>! perform 2nd part: run interpolation on the intermediate domain<a name='234'></font>
      <font color=#447700>! and compute the values for the nest boundaries<a name='235'></font>
      <font color=#447700>! note that this is all local (no communication)<a name='236'></font>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_56"> ( nested_grid%id , model_config_rec , config_flags )<a name='237'>
   CALL <A href='../../html_code/frame/module_dm.F.html#FORCE_DOMAIN_EM_PART2'>force_domain_em_part2</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FORCE_DOMAIN_EM_PART2_1"> ( grid, nested_grid, parent_grid, config_flags   &amp;<a name='238'>
<font color=#447700>!<a name='239'></font>
#          include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_16"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='240'>
<font color=#447700>!<a name='241'></font>
                                   )<a name='242'>
  ENDIF<a name='243'>
   <font color=#447700>! uncouple the nest<a name='244'></font>
   grid =&gt; nested_grid<a name='245'>
   IF ( grid%active_this_task ) THEN<a name='246'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_20">(grid%id)<a name='247'>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_57"> ( grid%id , model_config_rec , config_flags )<a name='248'>
     CALL <A href='../../html_code/dyn_em/couple_or_uncouple_em.F.html#COUPLE_OR_UNCOUPLE_EM'>couple_or_uncouple_em</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_OR_UNCOUPLE_EM_3"> ( grid , config_flags ,  .false.  &amp;<a name='249'>
<font color=#447700>!<a name='250'></font>
#          include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_17"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='251'>
<font color=#447700>!<a name='252'></font>
                                   )<a name='253'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_20"><a name='254'>
   ENDIF<a name='255'>
   <font color=#447700>! uncouple the parent<a name='256'></font>
   grid =&gt; parent_grid<a name='257'>
   IF ( grid%active_this_task ) THEN<a name='258'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#PUSH_COMMUNICATORS_FOR_DOMAIN'>push_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PUSH_COMMUNICATORS_FOR_DOMAIN_21">(grid%id)<a name='259'>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_58"> ( grid%id , model_config_rec , config_flags )<a name='260'>
     CALL <A href='../../html_code/dyn_em/couple_or_uncouple_em.F.html#COUPLE_OR_UNCOUPLE_EM'>couple_or_uncouple_em</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COUPLE_OR_UNCOUPLE_EM_4"> ( grid , config_flags ,  .false.  &amp;<a name='261'>
<font color=#447700>!<a name='262'></font>
#          include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_18"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='263'>
<font color=#447700>!<a name='264'></font>
                                )<a name='265'>
     CALL <A href='../../html_code/frame/module_dm_stubs.F.html#POP_COMMUNICATORS_FOR_DOMAIN'>pop_communicators_for_domain</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="POP_COMMUNICATORS_FOR_DOMAIN_21"><a name='266'>
   ENDIF<a name='267'>
   IF ( nested_grid%first_force ) THEN<a name='268'>
      nested_grid%first_force = .FALSE.<a name='269'>
   ENDIF<a name='270'>
   nested_grid%dtbc = 0.<a name='271'>
<font color=#447700>!<a name='272'></font>
   grid =&gt; nested_grid%intermediate_grid<a name='273'>
#  if (defined(MOVE_NESTS) || ((<font color=#447700>!defined(KEEP_INT_AROUND)) &amp;&amp; (!defined(SGIALTIX)) &amp;&amp; (!defined(FUJITSU_FX10))))<a name='274'></font>
   IF ( intercomm_active(grid%id) ) THEN<a name='275'>
     CALL <A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD'>dealloc_space_field</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOC_SPACE_FIELD_5"> ( grid )<a name='276'>
   ENDIF<a name='277'>
#  endif<a name='278'>
# endif<a name='279'>
#endif<a name='280'>
<font color=#447700>! ------------------------------------------------------<a name='281'></font>
<font color=#447700>!    End of Forcing calls for EM CORE.<a name='282'></font>
<font color=#447700>! ------------------------------------------------------<a name='283'></font>
<font color=#447700>! ------------------------------------------------------<a name='284'></font>
<font color=#447700>! ------------------------------------------------------<a name='285'></font>
<font color=#447700>!    Forcing calls for NMM. (Placeholder)<a name='286'></font>
<font color=#447700>! ------------------------------------------------------<a name='287'></font>
# if (NMM_CORE == 1 &amp;&amp; NMM_NEST == 1)<a name='288'>
<font color=#447700>!=======================================================================<a name='289'></font>
<font color=#447700>!  Added for the NMM core. This is gopal's doing.<a name='290'></font>
<font color=#447700>!=======================================================================<a name='291'></font>
<a name='292'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_59"> ( nested_grid%id , model_config_rec , config_flags )<a name='293'>
<a name='294'>
   grid =&gt; nested_grid%intermediate_grid<a name='295'>
<font color=#447700>!dusan orig    CALL alloc_space_field ( grid, grid%id , 1 , 2 ,  .TRUE. ,    &amp;<a name='296'></font>
#  if (defined(MOVE_NESTS) || ((<font color=#447700>!defined(KEEP_INT_AROUND)) &amp;&amp; (!defined(SGIALTIX)) &amp;&amp; (!defined(FUJITSU_FX10))))<a name='297'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD'>ensure_space_field</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ENSURE_SPACE_FIELD_2"> &amp;<a name='298'>
                          ( grid, grid%id , 1 , 3 ,  .FALSE. , intercomm_active(grid%id),    &amp;<a name='299'>
                            grid%sd31, grid%ed31, grid%sd32, grid%ed32, grid%sd33, grid%ed33, &amp;<a name='300'>
                            grid%sm31,  grid%em31,  grid%sm32,  grid%em32,  grid%sm33,  grid%em33, &amp;<a name='301'>
                            grid%sp31,  grid%ep31,  grid%sp32,  grid%ep32,  grid%sp33,  grid%ep33, &amp;<a name='302'>
                            grid%sp31x, grid%ep31x, grid%sp32x, grid%ep32x, grid%sp33x, grid%ep33x,&amp;<a name='303'>
                            grid%sp31y, grid%ep31y, grid%sp32y, grid%ep32y, grid%sp33y, grid%ep33y,&amp;<a name='304'>
                            grid%sm31x, grid%em31x, grid%sm32x, grid%em32x, grid%sm33x, grid%em33x, &amp;   <font color=#447700>! x-xpose<a name='305'></font>
                            grid%sm31y, grid%em31y, grid%sm32y, grid%em32y, grid%sm33y, grid%em33y  &amp;   <font color=#447700>! y-xpose<a name='306'></font>
      )<a name='307'>
#endif<a name='308'>
   nested_grid%intermediate_grid%interp_mp=parent_grid%interp_mp .or. nested_grid%interp_mp<a name='309'>
#if (HWRF == 1)<a name='310'>
  nested_grid%intermediate_grid%pdyn_parent_age=parent_grid%pdyn_parent_age<a name='311'>
  nested_grid%intermediate_grid%pdyn_smooth_age=parent_grid%pdyn_smooth_age<a name='312'>
#endif<a name='313'>
<a name='314'>
<a name='315'>
    <font color=#447700>! couple parent domain<a name='316'></font>
 <font color=#447700>!   grid =&gt; parent_grid<a name='317'></font>
    <font color=#447700>! swich config_flags to point to parent rconfig info<a name='318'></font>
 <font color=#447700>!   CALL model_to_grid_config_rec ( grid%id , model_config_rec , config_flags )<a name='319'></font>
<a name='320'>
    <font color=#447700>! on restart do not force the nest the first time since it has already been forced<a name='321'></font>
    <font color=#447700>! prior to the writing of the restart file<a name='322'></font>
<font color=#447700>!    IF ( .NOT. ( config_flags%restart .AND. nested_grid%first_force ) ) THEN<a name='323'></font>
       <font color=#447700>! couple nested domain<a name='324'></font>
       grid =&gt; nested_grid<a name='325'>
IF ( grid%active_this_task ) THEN<a name='326'>
       CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_60"> ( grid%id , model_config_rec , config_flags )<a name='327'>
       <font color=#447700>! Apply halos on weights and indices:<a name='328'></font>
    call <A href='../../html_code/frame/module_dm.F.html#BEFORE_INTERP_HALOS_NMM'>before_interp_halos_nmm</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BEFORE_INTERP_HALOS_NMM_1">(grid,config_flags &amp;<a name='329'>
<font color=#447700>!<a name='330'></font>
#   include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_19"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='331'>
<font color=#447700>!<a name='332'></font>
                                )<a name='333'>
ENDIF<a name='334'>
<a name='335'>
   <font color=#447700>! Copy interpolation information from parent grid to intermediate grid:<a name='336'></font>
 <font color=#447700>!  grid =&gt; parent_grid<a name='337'></font>
 <font color=#447700>!  call parent_to_inter_part1(parent_grid, nested_grid%intermediate_grid, &amp;<a name='338'></font>
 <font color=#447700>!                             nested_grid, config_flags)<a name='339'></font>
<a name='340'>
 <font color=#447700>!  grid =&gt; nested_grid%intermediate_grid<a name='341'></font>
 <font color=#447700>!  call parent_to_inter_part2(nested_grid%intermediate_grid, config_flags)<a name='342'></font>
<a name='343'>
   <font color=#447700>! Transfer remaining information from parent to intermediate grid:<a name='344'></font>
   grid =&gt; parent_grid<a name='345'>
IF ( grid%active_this_task .OR. nested_grid%active_this_task ) THEN<a name='346'>
   CALL <A href='../../html_code/frame/module_dm.F.html#WRF_DM_NESTEXCHANGE_INIT'>wrf_dm_nestexchange_init</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_NESTEXCHANGE_INIT_5"><a name='347'>
   CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_61"> ( grid%id , model_config_rec , config_flags )<a name='348'>
   CALL <A href='../../html_code/frame/module_dm.F.html#FORCE_DOMAIN_NMM_PART1'>force_domain_nmm_part1</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FORCE_DOMAIN_NMM_PART1_1"> ( grid , nested_grid%intermediate_grid,  &amp;<a name='349'>
                                 nested_grid, config_flags    &amp;<a name='350'>
<font color=#447700>!<a name='351'></font>
#         include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_20"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='352'>
<font color=#447700>!<a name='353'></font>
                                     )<a name='354'>
ENDIF<a name='355'>
IF ( nested_grid%active_this_task ) THEN<a name='356'>
    grid =&gt; nested_grid%intermediate_grid<a name='357'>
    <font color=#447700>! Finish transfering information from parent to intermediate<a name='358'></font>
    <font color=#447700>! grid, then run interpolation on the intermediate domain and<a name='359'></font>
    <font color=#447700>! compute the values for the nest boundaries.<a name='360'></font>
    CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_62"> ( nested_grid%id , model_config_rec , config_flags )<a name='361'>
    CALL <A href='../../html_code/frame/module_dm.F.html#FORCE_DOMAIN_NMM_PART2'>force_domain_nmm_part2</A><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FORCE_DOMAIN_NMM_PART2_1"> ( grid, nested_grid, config_flags    &amp;<a name='362'>
<font color=#447700>!<a name='363'></font>
#         include "<A href='../../html_code/include/actual_new_args.inc.html'>actual_new_args.inc</A>"<A NAME="actual_new_args.inc_21"><A href='../../html_code/share/mediation_force_domain.F.html#MED_FORCE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='364'>
<font color=#447700>!<a name='365'></font>
)<a name='366'>
ENDIF<a name='367'>
<a name='368'>
    IF ( nested_grid%first_force ) THEN<a name='369'>
       nested_grid%first_force = .FALSE.<a name='370'>
    ENDIF<a name='371'>
    nested_grid%dtbc = 0.<a name='372'>
<font color=#447700>!<a name='373'></font>
    grid =&gt; nested_grid%intermediate_grid<a name='374'>
<font color=#447700>!=======================================================================<a name='375'></font>
<font color=#447700>!  End of gopal's doing.<a name='376'></font>
<font color=#447700>!=======================================================================<a name='377'></font>
# endif<a name='378'>
<font color=#447700>! ------------------------------------------------------<a name='379'></font>
<font color=#447700>!    End of Forcing calls for NMM.<a name='380'></font>
<font color=#447700>! ------------------------------------------------------<a name='381'></font>
<font color=#447700>! ------------------------------------------------------<a name='382'></font>
<font color=#447700>! ------------------------------------------------------<a name='383'></font>
<font color=#447700>!    Forcing calls for COAMPS. (Placeholder)<a name='384'></font>
<font color=#447700>! ------------------------------------------------------<a name='385'></font>
# if (COAMPS_CORE == 1)<a name='386'>
# endif<a name='387'>
<font color=#447700>! ------------------------------------------------------<a name='388'></font>
<font color=#447700>!    End of Forcing calls for COAMPS.<a name='389'></font>
<font color=#447700>! ------------------------------------------------------<a name='390'></font>
   RETURN<a name='391'>
END SUBROUTINE med_force_domain<a name='392'>
<a name='393'>
<a name='394'>
</pre></body></html>