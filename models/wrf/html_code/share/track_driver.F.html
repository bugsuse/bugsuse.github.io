<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='2'></font>
<font color=#447700>! This routine prints out the current value of variables at all specified<a name='3'></font>
<font color=#447700>!   track locations that are within the current patch.<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>! Jeff Lee -- 25 June 2009<a name='6'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='7'></font>
<A NAME='TRACK_DRIVER'><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>track_driver</font>( grid ) <A href='../../call_to/TRACK_DRIVER.html' TARGET='index'>1</A>,<A href='../../call_from/TRACK_DRIVER.html' TARGET='index'>10</A><a name='9'>
<a name='10'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_450"><a name='11'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_288"><a name='12'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_205"><a name='13'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_SCALAR_TABLES'>module_scalar_tables</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SCALAR_TABLES_6"><a name='14'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_121"><a name='15'>
   USE <A href='../../html_code/share/module_date_time.F.html#MODULE_DATE_TIME'>module_date_time</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DATE_TIME_29"><a name='16'>
<a name='17'>
   IMPLICIT NONE<a name='18'>
<a name='19'>
   <font color=#447700>! Arguments<a name='20'></font>
   TYPE (domain), INTENT(INOUT) :: grid<a name='21'>
#if ( EM_CORE == 1 )<a name='22'>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='23'>
<a name='24'>
   <font color=#447700>! Local variables<a name='25'></font>
<a name='26'>
   INTEGER :: level<a name='27'>
   INTEGER :: level_stag<a name='28'>
   INTEGER :: level_zref<a name='29'>
   INTEGER :: num_tuv<a name='30'>
   INTEGER :: num_rad<a name='31'>
   INTEGER :: m, n, i<a name='32'>
   INTEGER :: ix, iy<a name='33'>
   TYPE(WRFU_Time) :: xcurrent_time, track_time_test <a name='34'>
   CHARACTER (LEN=132) :: message<a name='35'>
   CHARACTER (LEN=19) :: xcurrent_timestr<a name='36'>
   CHARACTER (LEN=19) :: chem_name<a name='37'>
   <a name='38'>
<font color=#447700>!============================================================================================<a name='39'></font>
   <a name='40'>
   IF ( grid%track_loc_domain &lt;= 0 ) RETURN     <font color=#447700>! no valid location<a name='41'></font>
<a name='42'>
#if ( DA_CORE <font color=#447700>!= 1 )<a name='43'></font>
   IF ( grid%dfi_opt /= DFI_NODFI .AND. grid%dfi_stage /= DFI_FST ) RETURN<a name='44'>
#endif<a name='45'>
<a name='46'>
<font color=#447700>! get the next valid track time<a name='47'></font>
<a name='48'>
   n = grid%track_next_time<a name='49'>
<a name='50'>
   IF ( grid%track_next_time &gt; grid%track_loc_domain ) RETURN   <font color=#447700>! all track locations done<a name='51'></font>
<a name='52'>
<font color=#447700>! get the track time<a name='53'></font>
<a name='54'>
   CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_23">( grid%track_time_domain(n), track_time_test )<a name='55'>
<a name='56'>
<font color=#447700>! get the current time<a name='57'></font>
<a name='58'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_84">( grid, current_time=xcurrent_time, current_timestr=xcurrent_timestr )<a name='59'>
<a name='60'>
   IF ( track_time_test .NE. xcurrent_time ) RETURN  <font color=#447700>! track time does not match current time<a name='61'></font>
<a name='62'>
<font color=#447700>! track time matches current time<a name='63'></font>
<a name='64'>
   write(message,*) 'track_driver: current_time = ',xcurrent_timestr <a name='65'>
   call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1394">( trim(message) )<a name='66'>
<a name='67'>
   level      = grid%em32-grid%sm32<a name='68'>
   level_stag = grid%em32-grid%sm32+1<a name='69'>
#if (WRF_CHEM == 1)<a name='70'>
   level_zref = model_config_rec%track_tuv_lev<a name='71'>
   num_tuv    = model_config_rec%track_tuv_num<a name='72'>
   num_rad    = model_config_rec%track_rad_num <a name='73'>
#endif<a name='74'>
<a name='75'>
   ix = grid%track_i(n)<a name='76'>
   iy = grid%track_j(n)<a name='77'>
  <a name='78'>
      IF (grid%sp31 &lt;= ix .AND. ix &lt;= grid%ep31 .AND. &amp;<a name='79'>
          grid%sp33 &lt;= iy .AND. iy &lt;= grid%ep33) THEN<a name='80'>
<a name='81'>
<font color=#447700>!-- output chemical species<a name='82'></font>
<a name='83'>
#if ( WRF_CHEM == 1 )<a name='84'>
         IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='85'>
           do m= 1,grid%track_chem_num<a name='86'>
            chem_name = TRIM(model_config_rec%track_chem_name(m))<a name='87'>
              do i = 1, num_chem<a name='88'>
                if (chem_name .eq. TRIM(chem_dname_table( grid%id, i ))) then<a name='89'>
                  grid%track_chem(m,n,grid%sm32:grid%em32-1) = grid%chem(ix,grid%sm32:grid%em32-1,iy,i)<a name='90'>
<a name='91'>
<font color=#447700>!                 print*,'track_chem_name,pointer = ',chem_name, i<a name='92'></font>
<font color=#447700>!                 print*,'track_chem =',grid%track_chem(m,n,grid%sm32:grid%em32-1)<a name='93'></font>
                  exit<a name='94'>
                end if<a name='95'>
              end do<a name='96'>
           end do<a name='97'>
<a name='98'>
           grid%track_o31d  (n,grid%sm32:grid%em32-1) = grid%ph_o31d  (ix,grid%sm32:grid%em32-1,iy)<a name='99'>
           grid%track_o33p  (n,grid%sm32:grid%em32-1) = grid%ph_o33p  (ix,grid%sm32:grid%em32-1,iy)<a name='100'>
           grid%track_no2   (n,grid%sm32:grid%em32-1) = grid%ph_no2   (ix,grid%sm32:grid%em32-1,iy)<a name='101'>
           grid%track_hno2  (n,grid%sm32:grid%em32-1) = grid%ph_hno2  (ix,grid%sm32:grid%em32-1,iy)<a name='102'>
           grid%track_hno3  (n,grid%sm32:grid%em32-1) = grid%ph_hno3  (ix,grid%sm32:grid%em32-1,iy)<a name='103'>
           grid%track_h2o2  (n,grid%sm32:grid%em32-1) = grid%ph_h2o2  (ix,grid%sm32:grid%em32-1,iy)<a name='104'>
           grid%track_ch3o2h(n,grid%sm32:grid%em32-1) = grid%ph_ch3o2h(ix,grid%sm32:grid%em32-1,iy)<a name='105'>
<a name='106'>
           if (model_config_rec%phot_opt(grid%id) == 3) then<a name='107'>
             do i = 1, num_rad<a name='108'>
               grid%track_radfld(n,i,1:level_zref) = grid%radfld(ix,1:level_zref,iy,i)<a name='109'>
             end do<a name='110'>
<a name='111'>
             do i = 1, num_tuv<a name='112'>
               grid%track_adjcoe(n,i,1:level_zref) = grid%adjcoe(ix,1:level_zref,iy,i)<a name='113'>
               grid%track_phrate(n,i,1:level_zref) = grid%phrate(ix,1:level_zref,iy,i)<a name='114'>
             end do<a name='115'>
           endif<a name='116'>
         END IF         <a name='117'>
#endif<a name='118'>
<a name='119'>
<font color=#447700>!-- output met<a name='120'></font>
<a name='121'>
         grid%track_z(n,grid%sm32:grid%em32-1)      = grid%z(ix,grid%sm32:grid%em32-1,iy)<a name='122'>
         grid%track_p(n,grid%sm32:grid%em32-1)      = grid%p(ix,grid%sm32:grid%em32-1,iy) + &amp;<a name='123'>
                                                    grid%pb(ix,grid%sm32:grid%em32-1,iy)<a name='124'>
         grid%track_t(n,grid%sm32:grid%em32-1)      = (grid%t_2(ix,grid%sm32:grid%em32-1,iy) + t0 ) * &amp;<a name='125'>
                                                    (grid%track_p(n,grid%sm32:grid%em32-1)/p1000mb)**rcp<a name='126'>
         grid%track_u(n,grid%sm32:grid%em32-1)      = (grid%u_2(ix,grid%sm32:grid%em32-1,iy) + &amp;<a name='127'>
                                                     grid%u_2(ix+1,grid%sm32:grid%em32-1,iy) )*0.5<a name='128'>
         grid%track_v(n,grid%sm32:grid%em32-1)      = (grid%v_2(ix,grid%sm32:grid%em32-1,iy) + &amp;<a name='129'>
                                                     grid%v_2(ix,grid%sm32:grid%em32-1,iy+1) )*0.5<a name='130'>
         grid%track_w(n,grid%sm32:grid%em32)      = grid%w_2(ix,grid%sm32:grid%em32,iy)<a name='131'>
         grid%track_rh(n,grid%sm32:grid%em32-1)     = MIN( 1.00,grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QV) /      &amp;<a name='132'>
                                                    (3.80*exp(17.27*(grid%track_t(n,grid%sm32:grid%em32-1)-273.)/ &amp;<a name='133'>
                                                    (grid%track_t(n,grid%sm32:grid%em32-1)-36.))/                 &amp;<a name='134'>
                                                    (.01*grid%track_p(n,grid%sm32:grid%em32-1)))   )<a name='135'>
         grid%track_alt(n,grid%sm32:grid%em32-1)    = grid%alt(ix,grid%sm32:grid%em32-1,iy)<a name='136'>
         grid%track_qcloud(n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QC)<a name='137'>
         grid%track_qrain (n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QR)<a name='138'>
         grid%track_qice  (n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QI)<a name='139'>
         grid%track_qsnow (n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QS)<a name='140'>
         grid%track_qgraup(n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QG)<a name='141'>
         grid%track_qvapor(n,grid%sm32:grid%em32-1) = grid%moist(ix,grid%sm32:grid%em32-1,iy,P_QV)<a name='142'>
<a name='143'>
<font color=#447700>!        print*,'track_z =',grid%track_z(n,grid%sm32:grid%em32-1)<a name='144'></font>
       <a name='145'>
      ELSE<a name='146'>
<a name='147'>
<font color=#447700>!--      this section must have.<a name='148'></font>
<a name='149'>
<font color=#447700>!-- output chem<a name='150'></font>
<a name='151'>
#if ( WRF_CHEM == 1 )<a name='152'>
<a name='153'>
         IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='154'>
           do m= 1,grid%track_chem_num<a name='155'>
            grid%track_chem(m,n,grid%sm32:grid%em32-1) = 1.E30<a name='156'>
           end do<a name='157'>
<a name='158'>
           grid%track_o31d  (n,grid%sm32:grid%em32-1) = 1.E30<a name='159'>
           grid%track_o33p  (n,grid%sm32:grid%em32-1) = 1.E30<a name='160'>
           grid%track_no2   (n,grid%sm32:grid%em32-1) = 1.E30<a name='161'>
           grid%track_hno2  (n,grid%sm32:grid%em32-1) = 1.E30<a name='162'>
           grid%track_hno3  (n,grid%sm32:grid%em32-1) = 1.E30<a name='163'>
           grid%track_h2o2  (n,grid%sm32:grid%em32-1) = 1.E30<a name='164'>
           grid%track_ch3o2h(n,grid%sm32:grid%em32-1) = 1.E30<a name='165'>
<a name='166'>
           if (model_config_rec%phot_opt(grid%id) == 3) then<a name='167'>
             grid%track_radfld(n,1:num_rad,1:level_zref) = 1.E30<a name='168'>
             grid%track_adjcoe(n,1:num_tuv,1:level_zref) = 1.E30<a name='169'>
             grid%track_phrate(n,1:num_tuv,1:level_zref) = 1.E30<a name='170'>
           end if<a name='171'>
         ENDIF     <a name='172'>
#endif<a name='173'>
<a name='174'>
<font color=#447700>!-- output met<a name='175'></font>
<a name='176'>
         grid%track_z     (n,grid%sm32:grid%em32-1) = 1.E30<a name='177'>
         grid%track_p     (n,grid%sm32:grid%em32-1) = 1.E30<a name='178'>
         grid%track_t     (n,grid%sm32:grid%em32-1) = 1.E30<a name='179'>
         grid%track_u     (n,grid%sm32:grid%em32-1) = 1.E30<a name='180'>
         grid%track_v     (n,grid%sm32:grid%em32-1) = 1.E30<a name='181'>
         grid%track_w     (n,grid%sm32:grid%em32) = 1.E30<a name='182'>
         grid%track_rh    (n,grid%sm32:grid%em32-1) = 1.E30<a name='183'>
         grid%track_alt   (n,grid%sm32:grid%em32-1) = 1.E30<a name='184'>
<a name='185'>
         grid%track_qcloud(n,grid%sm32:grid%em32-1) = 1.E30<a name='186'>
         grid%track_qrain (n,grid%sm32:grid%em32-1) = 1.E30<a name='187'>
         grid%track_qice  (n,grid%sm32:grid%em32-1) = 1.E30<a name='188'>
         grid%track_qsnow (n,grid%sm32:grid%em32-1) = 1.E30<a name='189'>
         grid%track_qgraup(n,grid%sm32:grid%em32-1) = 1.E30<a name='190'>
         grid%track_qvapor(n,grid%sm32:grid%em32-1) = 1.E30<a name='191'>
 <a name='192'>
      END IF<a name='193'>
 <a name='194'>
<font color=#447700>!-- write output to file<a name='195'></font>
<a name='196'>
<font color=#447700>!     write (*,*) 'grid%track_next_time = ', grid%track_next_time<a name='197'></font>
<a name='198'>
   if ( grid%track_next_time == grid%track_loc_domain ) then<a name='199'>
<font color=#447700>!     write (*,*) 'grid%track_loc_domain = ', grid%track_loc_domain<a name='200'></font>
<font color=#447700>!     write (*,*) 'track_driver: calling write_track'<a name='201'></font>
<a name='202'>
      call <A href='../../html_code/share/track_driver.F.html#WRITE_TRACK'>write_track</A><A href='../../html_code/share/track_driver.F.html#TRACK_DRIVER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRITE_TRACK_1">(grid)<a name='203'>
<a name='204'>
      write (*,*) 'track_driver: DONE write_track'<a name='205'>
   end if<a name='206'>
 <a name='207'>
   grid%track_next_time = grid%track_next_time + 1<a name='208'>
<a name='209'>
#endif<a name='210'>
<a name='211'>
END SUBROUTINE track_driver<a name='212'>
<a name='213'>
<a name='214'>
<A NAME='WRITE_TRACK'><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='215'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>write_track</font>( grid ) <A href='../../call_to/WRITE_TRACK.html' TARGET='index'>1</A>,<A href='../../call_from/WRITE_TRACK.html' TARGET='index'>29</A><a name='216'>
<a name='217'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_199"><a name='218'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_451"><a name='219'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_289"><a name='220'>
<a name='221'>
   IMPLICIT NONE<a name='222'>
<a name='223'>
   <font color=#447700>! Arguments<a name='224'></font>
<a name='225'>
   TYPE (domain), INTENT(INOUT) :: grid<a name='226'>
#if ( EM_CORE == 1 )<a name='227'>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='228'>
   INTEGER, EXTERNAL :: get_unused_unit<a name='229'>
<a name='230'>
   <font color=#447700>! Local variables<a name='231'></font>
<a name='232'>
   INTEGER :: level<a name='233'>
   INTEGER :: level_stag<a name='234'>
   INTEGER :: level_zref<a name='235'>
   INTEGER :: num_tuv<a name='236'>
   INTEGER :: num_rad<a name='237'>
   INTEGER :: m,n<a name='238'>
   INTEGER :: i<a name='239'>
   INTEGER :: ncid<a name='240'>
   INTEGER :: astat<a name='241'>
   CHARACTER (LEN=19) :: track_output<a name='242'>
   CHARACTER (LEN=19) :: chem_name<a name='243'>
<a name='244'>
   character (len=40) :: description<a name='245'>
   character (len=40) :: units<a name='246'>
<a name='247'>
   integer, parameter :: DateStrLen = 19<a name='248'>
   integer            :: time_dim<a name='249'>
   integer            :: level_dim<a name='250'>
   integer            :: level_stag_dim<a name='251'>
   integer            :: level_zref_dim<a name='252'>
   integer            :: rad_dim<a name='253'>
   integer            :: tuv_dim<a name='254'>
   integer            :: Times_dim<a name='255'>
   integer            :: var_dim(3)<a name='256'>
   integer            :: var_id<a name='257'>
   integer            :: start(3)<a name='258'>
   integer            :: count(3) <a name='259'>
<a name='260'>
#ifdef DM_PARALLEL<a name='261'>
   REAL, ALLOCATABLE, DIMENSION(:,:)   :: track_buf2<a name='262'>
#if ( WRF_CHEM == 1 )<a name='263'>
   REAL, ALLOCATABLE, DIMENSION(:,:,:) :: track_buf3<a name='264'>
#endif<a name='265'>
#endif<a name='266'>
<a name='267'>
<font color=#447700>!====================================================================================<a name='268'></font>
#if 1<a name='269'>
<font color=#447700>!We actually always need to include 'netcdf.inc',<a name='270'></font>
<font color=#447700>!as this routine won't compile without netcdf.<a name='271'></font>
include 'netcdf.inc'<a name='272'>
#else<a name='273'>
#ifdef NETCDF<a name='274'>
include 'netcdf.inc'<a name='275'>
#endif<a name='276'>
#endif<a name='277'>
<a name='278'>
<a name='279'>
   IF ( grid%track_loc_domain .LE. 0 ) RETURN<a name='280'>
<a name='281'>
#if ( DA_CORE <font color=#447700>!= 1 )<a name='282'></font>
   IF ( grid%dfi_opt /= DFI_NODFI .AND. grid%dfi_stage /= DFI_FST ) RETURN<a name='283'>
#endif<a name='284'>
<a name='285'>
   level      = grid%em32 - grid%sm32<a name='286'>
   level_stag = grid%em32 - grid%sm32 + 1  <a name='287'>
#if (WRF_CHEM == 1)<a name='288'>
   level_zref = model_config_rec%track_tuv_lev<a name='289'>
   num_tuv    = model_config_rec%track_tuv_num<a name='290'>
   num_rad    = model_config_rec%track_rad_num<a name='291'>
#endif<a name='292'>
<a name='293'>
#ifdef DM_PARALLEL<a name='294'>
<a name='295'>
   ALLOCATE(track_buf2(grid%track_loc_in, level))<a name='296'>
<a name='297'>
<font color=#447700>!--put z output in grid%track_z(:,:)<a name='298'></font>
<font color=#447700>!z <a name='299'></font>
   track_buf2(:,:) = grid%track_z(:,:)<a name='300'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_1">(track_buf2(:,:),grid%track_z(:,:),grid%track_loc_in*level)<a name='301'>
<font color=#447700>!p<a name='302'></font>
   track_buf2(:,:) = grid%track_p(:,:)<a name='303'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_2">(track_buf2(:,:),grid%track_p(:,:),grid%track_loc_in*level)<a name='304'>
<font color=#447700>!t<a name='305'></font>
   track_buf2(:,:) = grid%track_t(:,:)<a name='306'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_3">(track_buf2(:,:),grid%track_t(:,:),grid%track_loc_in*level)<a name='307'>
<font color=#447700>!u<a name='308'></font>
   track_buf2(:,:) = grid%track_u(:,:)<a name='309'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_4">(track_buf2(:,:),grid%track_u(:,:),grid%track_loc_in*level)<a name='310'>
<font color=#447700>!v<a name='311'></font>
   track_buf2(:,:) = grid%track_v(:,:)<a name='312'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_5">(track_buf2(:,:),grid%track_v(:,:),grid%track_loc_in*level)<a name='313'>
<font color=#447700>!w<a name='314'></font>
<font color=#447700>!  track_buf2(:,:) = grid%track_w(:,:)<a name='315'></font>
<font color=#447700>!  CALL wrf_dm_min_reals(track_buf2(:,:),grid%track_w(:,:),grid%track_loc_in*level)<a name='316'></font>
<font color=#447700>!rh<a name='317'></font>
   track_buf2(:,:) = grid%track_rh(:,:)<a name='318'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_6">(track_buf2(:,:),grid%track_rh(:,:),grid%track_loc_in*level)<a name='319'>
<font color=#447700>!alt<a name='320'></font>
   track_buf2(:,:) = grid%track_alt(:,:)<a name='321'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_7">(track_buf2(:,:),grid%track_alt(:,:),grid%track_loc_in*level)<a name='322'>
<font color=#447700>!qcloud<a name='323'></font>
   track_buf2(:,:) = grid%track_qcloud(:,:)<a name='324'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_8">(track_buf2(:,:),grid%track_qcloud(:,:),grid%track_loc_in*level)<a name='325'>
<font color=#447700>!qrain<a name='326'></font>
   track_buf2(:,:) = grid%track_qrain(:,:)<a name='327'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_9">(track_buf2(:,:),grid%track_qrain(:,:),grid%track_loc_in*level)<a name='328'>
<font color=#447700>!qice<a name='329'></font>
   track_buf2(:,:) = grid%track_qice(:,:)<a name='330'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_10">(track_buf2(:,:),grid%track_qice(:,:),grid%track_loc_in*level)<a name='331'>
<font color=#447700>!qsnow<a name='332'></font>
   track_buf2(:,:) = grid%track_qsnow(:,:)<a name='333'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_11">(track_buf2(:,:),grid%track_qsnow(:,:),grid%track_loc_in*level)<a name='334'>
<font color=#447700>!qgraup<a name='335'></font>
   track_buf2(:,:) = grid%track_qgraup(:,:)<a name='336'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_12">(track_buf2(:,:),grid%track_qgraup(:,:),grid%track_loc_in*level)<a name='337'>
<font color=#447700>!qvapor<a name='338'></font>
   track_buf2(:,:) = grid%track_qvapor(:,:)<a name='339'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_13">(track_buf2(:,:),grid%track_qvapor(:,:),grid%track_loc_in*level)<a name='340'>
<a name='341'>
#if ( WRF_CHEM == 1 )<a name='342'>
   IF (model_config_rec%chem_opt(grid%id) &gt; 0) THEN<a name='343'>
<font color=#447700>!o31d<a name='344'></font>
   track_buf2(:,:) = grid%track_o31d(:,:)<a name='345'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_14">(track_buf2(:,:),grid%track_o31d(:,:),grid%track_loc_in*level)<a name='346'>
<font color=#447700>!o33p<a name='347'></font>
   track_buf2(:,:) = grid%track_o33p(:,:)<a name='348'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_15">(track_buf2(:,:),grid%track_o33p(:,:),grid%track_loc_in*level)<a name='349'>
<font color=#447700>!no2<a name='350'></font>
   track_buf2(:,:) = grid%track_no2(:,:)<a name='351'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_16">(track_buf2(:,:),grid%track_no2(:,:),grid%track_loc_in*level)<a name='352'>
<font color=#447700>!hno2<a name='353'></font>
   track_buf2(:,:) = grid%track_hno2(:,:)<a name='354'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_17">(track_buf2(:,:),grid%track_hno2(:,:),grid%track_loc_in*level)<a name='355'>
<font color=#447700>!hno3<a name='356'></font>
   track_buf2(:,:) = grid%track_hno3(:,:)<a name='357'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_18">(track_buf2(:,:),grid%track_hno3(:,:),grid%track_loc_in*level)<a name='358'>
<font color=#447700>!h2o2<a name='359'></font>
   track_buf2(:,:) = grid%track_h2o2(:,:)<a name='360'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_19">(track_buf2(:,:),grid%track_h2o2(:,:),grid%track_loc_in*level)<a name='361'>
<font color=#447700>!ch3o2h<a name='362'></font>
   track_buf2(:,:) = grid%track_ch3o2h(:,:)<a name='363'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_20">(track_buf2(:,:),grid%track_ch3o2h(:,:),grid%track_loc_in*level)<a name='364'>
<a name='365'>
   END IF<a name='366'>
#endif<a name='367'>
<a name='368'>
   DEALLOCATE(track_buf2)<a name='369'>
<a name='370'>
   ALLOCATE(track_buf2(grid%track_loc_in, level_stag))<a name='371'>
<font color=#447700>!w<a name='372'></font>
   track_buf2(:,:) = grid%track_w(:,:)<a name='373'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_21">(track_buf2(:,:),grid%track_w(:,:),grid%track_loc_in*level_stag)<a name='374'>
<a name='375'>
   DEALLOCATE(track_buf2)<a name='376'>
<a name='377'>
#if ( WRF_CHEM == 1 )<a name='378'>
<a name='379'>
<font color=#447700>!--put chem output in grid%track_chem(:,:,:)<a name='380'></font>
<font color=#447700>!chem<a name='381'></font>
   IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='382'>
<a name='383'>
   ALLOCATE(track_buf3(grid%track_chem_num, grid%track_loc_in, level))<a name='384'>
<a name='385'>
   track_buf3(:,:,:) = grid%track_chem(:,:,:)<a name='386'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_22">(track_buf3(:,:,:),grid%track_chem(:,:,:),grid%track_chem_num*grid%track_loc_in*level)<a name='387'>
<a name='388'>
   DEALLOCATE(track_buf3)<a name='389'>
<a name='390'>
   if (model_config_rec%phot_opt(grid%id) == 3) then<a name='391'>
<font color=#447700>!radfld<a name='392'></font>
   ALLOCATE(track_buf3(grid%track_loc_in, num_rad, level_zref))<a name='393'>
<a name='394'>
   track_buf3(:,:,:) = grid%track_radfld(:,:,:)<a name='395'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_23">(track_buf3(:,:,:),grid%track_radfld(:,:,:),grid%track_loc_in*num_rad*level_zref)<a name='396'>
<a name='397'>
   DEALLOCATE(track_buf3)<a name='398'>
<a name='399'>
   ALLOCATE(track_buf3(grid%track_loc_in, num_tuv, level_zref))<a name='400'>
<font color=#447700>!adjcoe<a name='401'></font>
   track_buf3(:,:,:) = grid%track_adjcoe(:,:,:)<a name='402'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_24">(track_buf3(:,:,:),grid%track_adjcoe(:,:,:),grid%track_loc_in*num_tuv*level_zref)<a name='403'>
<font color=#447700>!phrate<a name='404'></font>
   track_buf3(:,:,:) = grid%track_phrate(:,:,:)<a name='405'>
   CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REALS'>wrf_dm_min_reals</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REALS_25">(track_buf3(:,:,:),grid%track_phrate(:,:,:),grid%track_loc_in*num_tuv*level_zref)<a name='406'>
<a name='407'>
   DEALLOCATE(track_buf3)<a name='408'>
   <a name='409'>
   end if<a name='410'>
<a name='411'>
   END IF<a name='412'>
#endif<a name='413'>
<a name='414'>
#endif<a name='415'>
<a name='416'>
   IF ( wrf_dm_on_monitor() ) THEN<a name='417'>
<a name='418'>
<font color=#447700>!--   get output unit<a name='419'></font>
<a name='420'>
<font color=#447700>!     ncid = get_unused_unit()<a name='421'></font>
<font color=#447700>!     if ( ncid &lt;= 0 ) then<a name='422'></font>
<font color=#447700>!        call wrf_error_fatal('write_track: ERROR: could not find a free Fortran unit.')<a name='423'></font>
<font color=#447700>!     end if<a name='424'></font>
<a name='425'>
<font color=#447700>!--   get output file name<a name='426'></font>
<a name='427'>
      write (track_output,'(A)') trim('wrfout_track_d00')<a name='428'>
      i = len_trim(track_output)<a name='429'>
      write ( track_output(i-1:i), '(I2.2)') grid%id<a name='430'>
<a name='431'>
<font color=#447700>!--   create necdf file<a name='432'></font>
<a name='433'>
      astat = NF_CREATE(track_output, NF_CLOBBER, ncid)<a name='434'>
      if (astat .ne. NF_NOERR) then<a name='435'>
         call <A href='../../html_code/io_netcdf/vort.F90.html#WRF_ABORT'>wrf_abort</A><A href='../../html_code/share/track_driver.F.html#WRITE_TRACK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ABORT_3"><a name='436'>
      end if<a name='437'>
<a name='438'>
<font color=#447700>!--   define dimensions<a name='439'></font>
<a name='440'>
      astat = NF_DEF_DIM(ncid, 'time'       , NF_UNLIMITED , time_dim )<a name='441'>
      astat = NF_DEF_DIM(ncid, 'level'      , level        , level_dim)<a name='442'>
      astat = NF_DEF_DIM(ncid, 'DateStrLen' , DateStrLen   , Times_dim)<a name='443'>
      astat = NF_DEF_DIM(ncid, 'level_stag' , level_stag   , level_stag_dim)<a name='444'>
<a name='445'>
#if ( WRF_CHEM == 1 )<a name='446'>
      IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. model_config_rec%phot_opt(grid%id) == 3 ) THEN<a name='447'>
      astat = NF_DEF_DIM(ncid, 'level_zref' , level_zref   , level_zref_dim)<a name='448'>
      astat = NF_DEF_DIM(ncid, 'num_rad'    , num_rad      , rad_dim)<a name='449'>
      astat = NF_DEF_DIM(ncid, 'num_tuv'    , num_tuv      , tuv_dim)<a name='450'>
      END IF<a name='451'>
#endif<a name='452'>
<a name='453'>
<font color=#447700>!--   define Times variable<a name='454'></font>
<a name='455'>
      var_dim(1) = Times_dim<a name='456'>
      var_dim(2) = time_dim<a name='457'>
<a name='458'>
      astat = NF_DEF_VAR(ncid,'Times', NF_CHAR, 2, var_dim(1:2), var_id)<a name='459'>
<a name='460'>
<font color=#447700>!--   define 1-D variables<a name='461'></font>
<a name='462'>
#if ( WRF_CHEM == 1 )<a name='463'>
      IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. model_config_rec%phot_opt(grid%id) == 3 ) THEN<a name='464'>
<font color=#447700>!wc<a name='465'></font>
      description = 'Wavelength'<a name='466'>
      units       = ''<a name='467'>
      astat = NF_DEF_VAR(ncid, 'wc'   , NF_REAL, 1, rad_dim, var_id  )<a name='468'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='469'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='470'>
<font color=#447700>!zref<a name='471'></font>
      description = 'Reference height'<a name='472'>
      units       = 'km'<a name='473'>
      astat = NF_DEF_VAR(ncid, 'zref'   , NF_REAL, 1, level_zref_dim, var_id  )<a name='474'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='475'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='476'>
<a name='477'>
      END IF<a name='478'>
#endif<a name='479'>
<a name='480'>
<font color=#447700>!lat<a name='481'></font>
      description = 'LATITUDE, SOUTH IS NEGATIVE'<a name='482'>
      units       = 'degree_north'<a name='483'>
      astat = NF_DEF_VAR(ncid, 'lat'   , NF_REAL, 1, time_dim, var_id  )<a name='484'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='485'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='486'>
<font color=#447700>!lon<a name='487'></font>
      description = 'LONGITUDE, WEST IS NEGATIVE'<a name='488'>
      units       = 'degree_east'<a name='489'>
      astat = NF_DEF_VAR(ncid, 'lon'   , NF_REAL, 1, time_dim, var_id  )<a name='490'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='491'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='492'>
<font color=#447700>!grid_i<a name='493'></font>
      description = 'grid_i, longitude direction '<a name='494'>
      units       = ''<a name='495'>
      astat = NF_DEF_VAR(ncid, 'grid_i'   , NF_INT, 1, time_dim, var_id  )<a name='496'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='497'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='498'>
<font color=#447700>!grid_j<a name='499'></font>
      description = 'grid_j, latitude direction '<a name='500'>
      units       = ''<a name='501'>
      astat = NF_DEF_VAR(ncid, 'grid_j'   , NF_INT, 1, time_dim, var_id  )<a name='502'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='503'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='504'>
<font color=#447700>!ele<a name='505'></font>
      description = 'elevation'<a name='506'>
      units       = 'm'<a name='507'>
      astat = NF_DEF_VAR(ncid, 'ele'   , NF_REAL, 1, time_dim, var_id  )<a name='508'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='509'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='510'>
<a name='511'>
<font color=#447700>!--   define 2-D variables<a name='512'></font>
<a name='513'>
      var_dim(1) = level_dim<a name='514'>
      var_dim(2) = time_dim<a name='515'>
<font color=#447700>!z<a name='516'></font>
      description = 'height'<a name='517'>
      units       = 'm'<a name='518'>
      astat = NF_DEF_VAR(ncid, 'z', NF_REAL, 2 , var_dim(1:2), var_id )<a name='519'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='520'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='521'>
<font color=#447700>!p<a name='522'></font>
      description = 'pressure'<a name='523'>
      units       = 'Pa'<a name='524'>
      astat = NF_DEF_VAR(ncid, 'p', NF_REAL, 2 , var_dim(1:2), var_id )<a name='525'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='526'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='527'>
<font color=#447700>!t<a name='528'></font>
      description = 'temperature'<a name='529'>
      units       = 'K'<a name='530'>
      astat = NF_DEF_VAR(ncid, 't', NF_REAL, 2 , var_dim(1:2), var_id )<a name='531'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='532'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='533'>
<font color=#447700>!u<a name='534'></font>
      description = 'x-wind component'<a name='535'>
      units       = 'm s-1'<a name='536'>
      astat = NF_DEF_VAR(ncid, 'u', NF_REAL, 2 , var_dim(1:2), var_id )<a name='537'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='538'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='539'>
<font color=#447700>!v<a name='540'></font>
      description = 'y-wind component'<a name='541'>
      units       = 'm s-1'<a name='542'>
      astat = NF_DEF_VAR(ncid, 'v', NF_REAL, 2 , var_dim(1:2), var_id )<a name='543'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='544'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='545'>
<font color=#447700>!w<a name='546'></font>
<font color=#447700>!     description = 'z-wind component'<a name='547'></font>
<font color=#447700>!     units       = 'm s-1'<a name='548'></font>
<font color=#447700>!     astat = NF_DEF_VAR(ncid, 'w', NF_REAL, 2 , var_dim(1:2), var_id )<a name='549'></font>
<font color=#447700>!     astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='550'></font>
<font color=#447700>!     astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='551'></font>
<font color=#447700>!rh<a name='552'></font>
      description = 'relative humidity'<a name='553'>
      units       = 'fraction'<a name='554'>
      astat = NF_DEF_VAR(ncid, 'rh', NF_REAL, 2 , var_dim(1:2), var_id )<a name='555'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='556'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='557'>
<font color=#447700>!alt<a name='558'></font>
      description = 'inverse density'<a name='559'>
      units       = 'm3 Kg-1'<a name='560'>
      astat = NF_DEF_VAR(ncid, 'alt', NF_REAL, 2 , var_dim(1:2), var_id )<a name='561'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='562'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='563'>
<font color=#447700>!qcloud<a name='564'></font>
      description = 'Cloud water mixing ratio'<a name='565'>
      units       = 'kg kg-1'<a name='566'>
      astat = NF_DEF_VAR(ncid, 'qcloud', NF_REAL, 2 , var_dim(1:2), var_id )<a name='567'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='568'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='569'>
<font color=#447700>!qrain<a name='570'></font>
      description = 'Rain water mixing ratio'<a name='571'>
      units       = 'kg kg-1'<a name='572'>
      astat = NF_DEF_VAR(ncid, 'qrain', NF_REAL, 2 , var_dim(1:2), var_id )<a name='573'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='574'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='575'>
<font color=#447700>!qice<a name='576'></font>
      description = 'Ice mixing ratio'<a name='577'>
      units       = 'kg kg-1'<a name='578'>
      astat = NF_DEF_VAR(ncid, 'qice', NF_REAL, 2 , var_dim(1:2), var_id )<a name='579'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='580'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='581'>
<font color=#447700>!qsnow<a name='582'></font>
      description = 'Snow mixing ratio'<a name='583'>
      units       = 'kg kg-1'<a name='584'>
      astat = NF_DEF_VAR(ncid, 'qsnow', NF_REAL, 2 , var_dim(1:2), var_id )<a name='585'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='586'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='587'>
<font color=#447700>!qgraup<a name='588'></font>
      description = 'Graupel mixing ratio'<a name='589'>
      units       = 'kg kg-1'<a name='590'>
      astat = NF_DEF_VAR(ncid, 'qgraup', NF_REAL, 2 , var_dim(1:2), var_id )<a name='591'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='592'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='593'>
<font color=#447700>!qvapor<a name='594'></font>
      description = 'Water vapor mixing ratio'<a name='595'>
      units       = 'kg kg-1'<a name='596'>
      astat = NF_DEF_VAR(ncid, 'qvapor', NF_REAL, 2 , var_dim(1:2), var_id )<a name='597'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='598'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='599'>
<a name='600'>
#if ( WRF_CHEM == 1 )<a name='601'>
<a name='602'>
      IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='603'>
<font color=#447700>!chem<a name='604'></font>
      units       = 'ppmv'<a name='605'>
      do m= 1,grid%track_chem_num<a name='606'>
         chem_name = trim(model_config_rec%track_chem_name(m))<a name='607'>
         description = trim(chem_name) // ' concentration'<a name='608'>
         astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='609'>
         astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='610'>
         astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='611'>
      end do<a name='612'>
<a name='613'>
      units       = 'min-1'<a name='614'>
<font color=#447700>!o31d<a name='615'></font>
      chem_name   = 'photr_o31d' <a name='616'>
      description = 'O31D Photolysis Rate'<a name='617'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='618'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='619'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='620'>
<font color=#447700>!o33p<a name='621'></font>
      chem_name   = 'photr_o33p' <a name='622'>
      description = 'O33P Photolysis Rate'<a name='623'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='624'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='625'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='626'>
<font color=#447700>!no2<a name='627'></font>
      chem_name   = 'photr_no2' <a name='628'>
      description = 'NO2 Photolysis Rate'<a name='629'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='630'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='631'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='632'>
<font color=#447700>!hno2<a name='633'></font>
      chem_name   = 'photr_hno2' <a name='634'>
      description = 'HNO2 Photolysis Rate'<a name='635'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='636'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='637'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='638'>
<font color=#447700>!hno3<a name='639'></font>
      chem_name   = 'photr_hno3' <a name='640'>
      description = 'HNO3 Photolysis Rate'<a name='641'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='642'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='643'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='644'>
<font color=#447700>!h2o2<a name='645'></font>
      chem_name   = 'photr_h2o2' <a name='646'>
      description = 'H2O2 Photolysis Rate'<a name='647'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='648'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='649'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='650'>
<font color=#447700>!ch3o2h<a name='651'></font>
      chem_name   = 'photr_ch3o2h' <a name='652'>
      description = 'CH3O2H Photolysis Rate'<a name='653'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 2, var_dim(1:2), var_id )<a name='654'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='655'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='656'>
<a name='657'>
      if (model_config_rec%phot_opt(grid%id) == 3 ) then<a name='658'>
<a name='659'>
      units       = ''<a name='660'>
<font color=#447700>!radfld<a name='661'></font>
      var_dim(1) = level_zref_dim<a name='662'>
      var_dim(2) = rad_dim<a name='663'>
      var_dim(3) = time_dim<a name='664'>
      chem_name   = 'radfld' <a name='665'>
      description = 'radfld'<a name='666'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 3, var_dim(1:3), var_id )<a name='667'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='668'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='669'>
<font color=#447700>!adjcoe<a name='670'></font>
      var_dim(1) = level_zref_dim<a name='671'>
      var_dim(2) = tuv_dim<a name='672'>
      var_dim(3) = time_dim<a name='673'>
      chem_name   = 'adjcoe' <a name='674'>
      description = 'adjcoe'<a name='675'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 3, var_dim(1:3), var_id )<a name='676'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='677'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='678'>
<font color=#447700>!phrate<a name='679'></font>
      var_dim(1) = level_zref_dim<a name='680'>
      var_dim(2) = tuv_dim<a name='681'>
      var_dim(3) = time_dim<a name='682'>
      chem_name   = 'phrate' <a name='683'>
      description = 'phrate'<a name='684'>
      astat = NF_DEF_VAR(ncid, trim(chem_name), NF_REAL, 3, var_dim(1:3), var_id )<a name='685'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='686'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='687'>
<a name='688'>
      end if<a name='689'>
<a name='690'>
      END IF<a name='691'>
#endif<a name='692'>
<a name='693'>
<font color=#447700>!w<a name='694'></font>
      var_dim(1) = level_stag_dim<a name='695'>
      var_dim(2) = time_dim<a name='696'>
      description = 'z-wind component'<a name='697'>
      units       = 'm s-1'<a name='698'>
      astat = NF_DEF_VAR(ncid, 'w', NF_REAL, 2 , var_dim(1:2), var_id )<a name='699'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'description', len_trim(description),description)<a name='700'>
      astat = NF_PUT_ATT_TEXT(ncid,var_id,'units',       len_trim(units),      units      )<a name='701'>
<a name='702'>
<font color=#447700>! --  end define<a name='703'></font>
<a name='704'>
      astat = NF_ENDDEF(ncid)<a name='705'>
<a name='706'>
<font color=#447700>!--   write Times variable<a name='707'></font>
<font color=#447700>!Times<a name='708'></font>
      start(1) = 1<a name='709'>
      start(2) = 1<a name='710'>
      count(1) = DateStrLen<a name='711'>
      count(2) = 1<a name='712'>
<a name='713'>
      astat = NF_INQ_VARID(ncid,'Times',var_id)<a name='714'>
      do m= 1,grid%track_loc_domain<a name='715'>
         start(2) = m<a name='716'>
         astat = NF_PUT_VARA_TEXT(ncid,var_id,start,count,grid%track_time_domain(m))<a name='717'>
      end do<a name='718'>
      write (*,*) 'var_id,grid%track_time_domain = ', var_id,grid%track_time_domain<a name='719'>
<a name='720'>
<font color=#447700>!--   write 1-D variables<a name='721'></font>
<a name='722'>
#if ( WRF_CHEM == 1 )<a name='723'>
      IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='724'>
      if ( model_config_rec%phot_opt(grid%id) == 3 )then<a name='725'>
<font color=#447700>!wc<a name='726'></font>
      start(2) = 1<a name='727'>
      count(2) = num_rad<a name='728'>
<a name='729'>
      astat = NF_INQ_VARID(ncid,'wc',var_id)<a name='730'>
      astat = NF_PUT_VARA_REAL(ncid,var_id,start(2),count(2),grid%track_wc)<a name='731'>
<font color=#447700>!zref<a name='732'></font>
      start(2) = 1<a name='733'>
      count(2) = level_zref<a name='734'>
<a name='735'>
      astat = NF_INQ_VARID(ncid,'zref',var_id)<a name='736'>
      astat = NF_PUT_VARA_REAL(ncid,var_id,start(2),count(2),grid%track_zref)<a name='737'>
<a name='738'>
      end if<a name='739'>
<a name='740'>
      END IF<a name='741'>
#endif<a name='742'>
<a name='743'>
<font color=#447700>!lat<a name='744'></font>
      start(2) = 1<a name='745'>
      count(2) = grid%track_loc_domain<a name='746'>
<a name='747'>
      astat = NF_INQ_VARID(ncid,'lat',var_id)<a name='748'>
      astat = NF_PUT_VARA_REAL(ncid,var_id,start(2),count(2),grid%track_lat_domain)<a name='749'>
      write (*,*) 'var_id,grid%track_lat_domain = ', var_id,grid%track_lat_domain<a name='750'>
<font color=#447700>!lon<a name='751'></font>
      astat = NF_INQ_VARID(ncid,'lon',var_id)<a name='752'>
      astat = NF_PUT_VARA_REAL(ncid,var_id,start(2),count(2),grid%track_lon_domain)<a name='753'>
      write (*,*) 'var_id,grid%track_lon_domain = ', var_id,grid%track_lon_domain<a name='754'>
<font color=#447700>!grid_i<a name='755'></font>
      astat = NF_INQ_VARID(ncid,'grid_i',var_id)<a name='756'>
      astat = NF_PUT_VARA_INT(ncid,var_id,start(2),count(2),grid%track_i)<a name='757'>
<font color=#447700>!grid_j<a name='758'></font>
      astat = NF_INQ_VARID(ncid,'grid_j',var_id)<a name='759'>
      astat = NF_PUT_VARA_INT(ncid,var_id,start(2),count(2),grid%track_j)<a name='760'>
<font color=#447700>!ele<a name='761'></font>
      astat = NF_INQ_VARID(ncid,'ele',var_id)<a name='762'>
      astat = NF_PUT_VARA_REAL(ncid,var_id,start(2),count(2),grid%track_ele)<a name='763'>
      write (*,*) 'var_id,grid%track_ele = ', var_id,grid%track_ele<a name='764'>
<a name='765'>
<font color=#447700>!--   write 2-D variables<a name='766'></font>
<a name='767'>
      start(1) = 1<a name='768'>
      start(2) = 1<a name='769'>
      count(1) = level<a name='770'>
      count(2) = 1<a name='771'>
<font color=#447700>!z<a name='772'></font>
      astat = NF_INQ_VARID(ncid,'z',var_id)<a name='773'>
      do m= 1,grid%track_loc_domain<a name='774'>
         start(2) = m<a name='775'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_z(m,:))<a name='776'>
      end do<a name='777'>
<font color=#447700>!p<a name='778'></font>
      astat = NF_INQ_VARID(ncid,'p',var_id)<a name='779'>
      do m= 1,grid%track_loc_domain<a name='780'>
         start(2) = m<a name='781'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_p(m,:))<a name='782'>
      end do<a name='783'>
<font color=#447700>!t<a name='784'></font>
      astat = NF_INQ_VARID(ncid,'t',var_id)<a name='785'>
      do m= 1,grid%track_loc_domain<a name='786'>
         start(2) = m<a name='787'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_t(m,:))<a name='788'>
      end do<a name='789'>
<font color=#447700>!u<a name='790'></font>
      astat = NF_INQ_VARID(ncid,'u',var_id)<a name='791'>
      do m= 1,grid%track_loc_domain<a name='792'>
         start(2) = m<a name='793'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_u(m,:))<a name='794'>
      end do<a name='795'>
<font color=#447700>!v<a name='796'></font>
      astat = NF_INQ_VARID(ncid,'v',var_id)<a name='797'>
      do m= 1,grid%track_loc_domain<a name='798'>
         start(2) = m<a name='799'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_v(m,:))<a name='800'>
      end do<a name='801'>
<font color=#447700>!w<a name='802'></font>
<font color=#447700>!     astat = NF_INQ_VARID(ncid,'w',var_id)<a name='803'></font>
<font color=#447700>!     do m= 1,grid%track_loc_domain<a name='804'></font>
<font color=#447700>!        start(2) = m<a name='805'></font>
<font color=#447700>!        astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_w(m,:))<a name='806'></font>
<font color=#447700>!     end do<a name='807'></font>
<font color=#447700>!rh<a name='808'></font>
      astat = NF_INQ_VARID(ncid,'rh',var_id)<a name='809'>
      do m= 1,grid%track_loc_domain<a name='810'>
         start(2) = m<a name='811'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_rh(m,:))<a name='812'>
      end do<a name='813'>
<font color=#447700>!alt<a name='814'></font>
      astat = NF_INQ_VARID(ncid,'alt',var_id)<a name='815'>
      do m= 1,grid%track_loc_domain<a name='816'>
         start(2) = m<a name='817'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_alt(m,:))<a name='818'>
      end do<a name='819'>
<font color=#447700>!qcloud<a name='820'></font>
      astat = NF_INQ_VARID(ncid,'qcloud',var_id)<a name='821'>
      do m= 1,grid%track_loc_domain<a name='822'>
         start(2) = m<a name='823'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qcloud(m,:))<a name='824'>
      end do<a name='825'>
<font color=#447700>!qrain<a name='826'></font>
      astat = NF_INQ_VARID(ncid,'qrain',var_id)<a name='827'>
      do m= 1,grid%track_loc_domain<a name='828'>
         start(2) = m<a name='829'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qrain(m,:))<a name='830'>
      end do<a name='831'>
<font color=#447700>!qice<a name='832'></font>
      astat = NF_INQ_VARID(ncid,'qice',var_id)<a name='833'>
      do m= 1,grid%track_loc_domain<a name='834'>
         start(2) = m<a name='835'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qice(m,:))<a name='836'>
      end do<a name='837'>
<font color=#447700>!qsnow<a name='838'></font>
      astat = NF_INQ_VARID(ncid,'qsnow',var_id)<a name='839'>
      do m= 1,grid%track_loc_domain<a name='840'>
         start(2) = m<a name='841'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qsnow(m,:))<a name='842'>
      end do<a name='843'>
<font color=#447700>!qgraup<a name='844'></font>
      astat = NF_INQ_VARID(ncid,'qgraup',var_id)<a name='845'>
      do m= 1,grid%track_loc_domain<a name='846'>
         start(2) = m<a name='847'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qgraup(m,:))<a name='848'>
      end do<a name='849'>
<font color=#447700>!qvapor<a name='850'></font>
      astat = NF_INQ_VARID(ncid,'qvapor',var_id)<a name='851'>
      do m= 1,grid%track_loc_domain<a name='852'>
         start(2) = m<a name='853'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_qvapor(m,:))<a name='854'>
      end do<a name='855'>
<a name='856'>
#if ( WRF_CHEM == 1 )<a name='857'>
<font color=#447700>!chem<a name='858'></font>
      IF ( model_config_rec%chem_opt(grid%id) &gt; 0 .and. grid%track_chem_num &gt; 0 ) THEN<a name='859'>
<a name='860'>
      do n= 1,grid%track_chem_num<a name='861'>
         chem_name = trim(model_config_rec%track_chem_name(n))<a name='862'>
         astat = NF_INQ_VARID(ncid,trim(chem_name),var_id)<a name='863'>
<a name='864'>
         do m= 1,grid%track_loc_domain<a name='865'>
            start(2) = m<a name='866'>
            astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_chem(n,m,:))          <a name='867'>
         end do<a name='868'>
<a name='869'>
<font color=#447700>!        write (*,*) 'n, var_id, chem_name = ', n, var_id, trim(chem_name)<a name='870'></font>
      end do<a name='871'>
<a name='872'>
<font color=#447700>!o31d<a name='873'></font>
      astat = NF_INQ_VARID(ncid,'photr_o31d',var_id)<a name='874'>
      do m= 1,grid%track_loc_domain<a name='875'>
         start(2) = m<a name='876'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_o31d(m,:))<a name='877'>
      end do<a name='878'>
<font color=#447700>!o33p<a name='879'></font>
      astat = NF_INQ_VARID(ncid,'photr_o33p',var_id)<a name='880'>
      do m= 1,grid%track_loc_domain<a name='881'>
         start(2) = m<a name='882'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_o33p(m,:))<a name='883'>
      end do<a name='884'>
<font color=#447700>!no2<a name='885'></font>
      astat = NF_INQ_VARID(ncid,'photr_no2',var_id)<a name='886'>
      do m= 1,grid%track_loc_domain<a name='887'>
         start(2) = m<a name='888'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_no2(m,:))<a name='889'>
      end do<a name='890'>
<font color=#447700>!hno2<a name='891'></font>
      astat = NF_INQ_VARID(ncid,'photr_hno2',var_id)<a name='892'>
      do m= 1,grid%track_loc_domain<a name='893'>
         start(2) = m<a name='894'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_hno2(m,:))<a name='895'>
      end do<a name='896'>
<font color=#447700>!hno3<a name='897'></font>
      astat = NF_INQ_VARID(ncid,'photr_hno3',var_id)<a name='898'>
      do m= 1,grid%track_loc_domain<a name='899'>
         start(2) = m<a name='900'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_hno3(m,:))<a name='901'>
      end do<a name='902'>
<font color=#447700>!h2o2<a name='903'></font>
      astat = NF_INQ_VARID(ncid,'photr_h2o2',var_id)<a name='904'>
      do m= 1,grid%track_loc_domain<a name='905'>
         start(2) = m<a name='906'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_h2o2(m,:))<a name='907'>
      end do<a name='908'>
<font color=#447700>!ch3o2h<a name='909'></font>
      astat = NF_INQ_VARID(ncid,'photr_ch3o2h',var_id)<a name='910'>
      do m= 1,grid%track_loc_domain<a name='911'>
         start(2) = m<a name='912'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_ch3o2h(m,:))<a name='913'>
      end do<a name='914'>
<a name='915'>
      if (model_config_rec%phot_opt(grid%id) == 3 ) then<a name='916'>
<font color=#447700>!radfld<a name='917'></font>
      start(1) = 1<a name='918'>
      start(2) = 1<a name='919'>
      start(3) = 1<a name='920'>
      count(1) = level_zref<a name='921'>
      count(2) = 1<a name='922'>
      count(3) = 1<a name='923'>
<a name='924'>
      astat = NF_INQ_VARID(ncid,'radfld',var_id)<a name='925'>
      do m= 1,grid%track_loc_domain<a name='926'>
      do n= 1,num_rad<a name='927'>
         start(2) = n<a name='928'>
         start(3) = m<a name='929'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:3),count(1:3),grid%track_radfld(m,n,:))<a name='930'>
      end do<a name='931'>
      end do<a name='932'>
<font color=#447700>!adjcoe<a name='933'></font>
      astat = NF_INQ_VARID(ncid,'adjcoe',var_id)<a name='934'>
      do m= 1,grid%track_loc_domain<a name='935'>
      do n= 1,num_tuv<a name='936'>
         start(2) = n<a name='937'>
         start(3) = m<a name='938'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:3),count(1:3),grid%track_adjcoe(m,n,:))<a name='939'>
      end do<a name='940'>
      end do<a name='941'>
<font color=#447700>!phrate<a name='942'></font>
      astat = NF_INQ_VARID(ncid,'phrate',var_id)<a name='943'>
      do m= 1,grid%track_loc_domain<a name='944'>
      do n= 1,num_tuv<a name='945'>
         start(2) = n<a name='946'>
         start(3) = m<a name='947'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:3),count(1:3),grid%track_phrate(m,n,:))<a name='948'>
      end do<a name='949'>
      end do<a name='950'>
<a name='951'>
      end if<a name='952'>
<a name='953'>
      END IF<a name='954'>
#endif<a name='955'>
<a name='956'>
<font color=#447700>!w<a name='957'></font>
      start(1) = 1<a name='958'>
      start(2) = 1<a name='959'>
      count(1) = level_stag<a name='960'>
      count(2) = 1<a name='961'>
<a name='962'>
      astat = NF_INQ_VARID(ncid,'w',var_id)<a name='963'>
      do m= 1,grid%track_loc_domain<a name='964'>
         start(2) = m<a name='965'>
         astat = NF_PUT_VARA_REAL(ncid,var_id,start(1:2),count(1:2),grid%track_w(m,:))<a name='966'>
      end do<a name='967'>
<a name='968'>
<font color=#447700>!--   close output unit<a name='969'></font>
<a name='970'>
      astat = NF_CLOSE(ncid)<a name='971'>
<a name='972'>
   END IF<a name='973'>
<a name='974'>
   grid%track_next_time = 1<a name='975'>
#endif<a name='976'>
<a name='977'>
END SUBROUTINE write_track<a name='978'>
<a name='979'>
<A NAME='CALC_TRACK_LOCATIONS'><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='980'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>calc_track_locations</font>( grid ) <A href='../../call_to/CALC_TRACK_LOCATIONS.html' TARGET='index'>1</A>,<A href='../../call_from/CALC_TRACK_LOCATIONS.html' TARGET='index'>21</A><a name='981'>
<a name='982'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_452"><a name='983'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_290"><a name='984'>
   USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_200"><a name='985'>
   USE <A href='../../html_code/share/module_llxy.F.html#MODULE_LLXY'>module_llxy</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_LLXY_10"><a name='986'>
<a name='987'>
   IMPLICIT NONE<a name='988'>
<a name='989'>
   <font color=#447700>! Arguments<a name='990'></font>
   TYPE (domain), INTENT(INOUT) :: grid<a name='991'>
#if ( EM_CORE == 1 )<a name='992'>
   <font color=#447700>! Externals<a name='993'></font>
   LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='994'>
<a name='995'>
   <font color=#447700>! Local variables<a name='996'></font>
   INTEGER :: track_loc_temp<a name='997'>
   INTEGER :: i, k, iunit<a name='998'>
   REAL :: track_rx, track_ry<a name='999'>
   REAL :: known_lat, known_lon<a name='1000'>
   CHARACTER (LEN=132) :: message<a name='1001'>
   TYPE (PROJ_INFO) :: track_proj<a name='1002'>
   TYPE (grid_config_rec_type) :: config_flags<a name='1003'>
<a name='1004'>
   INTEGER :: ids, ide, jds, jde, kds, kde,        &amp;<a name='1005'>
              ims, ime, jms, jme, kms, kme,        &amp;<a name='1006'>
              ips, ipe, jps, jpe, kps, kpe,        &amp;<a name='1007'>
              imsx, imex, jmsx, jmex, kmsx, kmex,  &amp;<a name='1008'>
              ipsx, ipex, jpsx, jpex, kpsx, kpex,  &amp;<a name='1009'>
              imsy, imey, jmsy, jmey, kmsy, kmey,  &amp;<a name='1010'>
              ipsy, ipey, jpsy, jpey, kpsy, kpey<a name='1011'>
<a name='1012'>
   IF ( grid%track_loc &lt;= 0 ) then<a name='1013'>
     RETURN<a name='1014'>
   ENDIF<a name='1015'>
<a name='1016'>
#if ( DA_CORE <font color=#447700>!= 1 )<a name='1017'></font>
   IF ( grid%dfi_stage == DFI_FST ) THEN<a name='1018'>
#endif<a name='1019'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_120"> ( grid ,                               &amp;<a name='1020'>
                              ids, ide, jds, jde, kds, kde,        &amp;<a name='1021'>
                              ims, ime, jms, jme, kms, kme,        &amp;<a name='1022'>
                              ips, ipe, jps, jpe, kps, kpe,        &amp;<a name='1023'>
                              imsx, imex, jmsx, jmex, kmsx, kmex,  &amp;<a name='1024'>
                              ipsx, ipex, jpsx, jpex, kpsx, kpex,  &amp;<a name='1025'>
                              imsy, imey, jmsy, jmey, kmsy, kmey,  &amp;<a name='1026'>
                              ipsy, ipey, jpsy, jpey, kpsy, kpey )<a name='1027'>
   <a name='1028'>
     CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_86"> ( grid%id , model_config_rec , config_flags )<a name='1029'>
   <a name='1030'>
<font color=#447700>! Set up map transformation structure<a name='1031'></font>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_INIT'>map_init</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_INIT_5">(track_proj)<a name='1032'>
   <a name='1033'>
     IF (ips &lt;= 1 .AND. 1 &lt;= ipe .AND. &amp;<a name='1034'>
         jps &lt;= 1 .AND. 1 &lt;= jpe) THEN<a name='1035'>
        known_lat = grid%xlat(1,1)<a name='1036'>
        known_lon = grid%xlong(1,1)<a name='1037'>
     ELSE<a name='1038'>
        known_lat = 9999.<a name='1039'>
        known_lon = 9999.<a name='1040'>
     ENDIF<a name='1041'>
     known_lat = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REAL'>wrf_dm_min_real</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REAL_7">(known_lat)<a name='1042'>
     known_lon = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REAL'>wrf_dm_min_real</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REAL_8">(known_lon)<a name='1043'>
   <a name='1044'>
<font color=#447700>! Mercator<a name='1045'></font>
   IF (config_flags%map_proj == PROJ_MERC) THEN<a name='1046'>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_SET'>map_set</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_SET_17">(PROJ_MERC, track_proj,                &amp;<a name='1047'>
                      truelat1 = config_flags%truelat1, &amp;<a name='1048'>
                      lat1     = known_lat,             &amp;<a name='1049'>
                      lon1     = known_lon,             &amp;<a name='1050'>
                      knowni   = 1.,                    &amp;<a name='1051'>
                      knownj   = 1.,                    &amp;<a name='1052'>
                      dx       = config_flags%dx)<a name='1053'>
   <a name='1054'>
<font color=#447700>! Lambert conformal<a name='1055'></font>
   ELSE IF (config_flags%map_proj == PROJ_LC) THEN<a name='1056'>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_SET'>map_set</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_SET_18">(PROJ_LC, track_proj,                   &amp;<a name='1057'>
                      truelat1 = config_flags%truelat1,  &amp;<a name='1058'>
                      truelat2 = config_flags%truelat2,  &amp;<a name='1059'>
                      stdlon   = config_flags%stand_lon, &amp;<a name='1060'>
                      lat1     = known_lat,              &amp;<a name='1061'>
                      lon1     = known_lon,              &amp;<a name='1062'>
                      knowni   = 1.,                     &amp;<a name='1063'>
                      knownj   = 1.,                     &amp;<a name='1064'>
                      dx       = config_flags%dx)<a name='1065'>
   <a name='1066'>
<font color=#447700>! Polar stereographic<a name='1067'></font>
   ELSE IF (config_flags%map_proj == PROJ_PS) THEN<a name='1068'>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_SET'>map_set</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_SET_19">(PROJ_PS, track_proj,                   &amp;<a name='1069'>
                      truelat1 = config_flags%truelat1,  &amp;<a name='1070'>
                      stdlon   = config_flags%stand_lon, &amp;<a name='1071'>
                      lat1     = known_lat,              &amp;<a name='1072'>
                      lon1     = known_lon,              &amp;<a name='1073'>
                      knowni   = 1.,                     &amp;<a name='1074'>
                      knownj   = 1.,                     &amp;<a name='1075'>
                      dx       = config_flags%dx)<a name='1076'>
   <a name='1077'>
<font color=#447700>! Cassini (global ARW)<a name='1078'></font>
   ELSE IF (config_flags%map_proj == PROJ_CASSINI) THEN<a name='1079'>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_SET'>map_set</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_SET_20">(PROJ_CASSINI, track_proj,                             &amp;<a name='1080'>
                      latinc   = grid%dy*360.0/(2.0*EARTH_RADIUS_M*PI), &amp;<a name='1081'>
                      loninc   = grid%dx*360.0/(2.0*EARTH_RADIUS_M*PI), &amp; <a name='1082'>
                      lat1     = known_lat,                             &amp;<a name='1083'>
                      lon1     = known_lon,                             &amp;<a name='1084'>
<font color=#447700>! We still need to get POLE_LAT and POLE_LON metadata variables before<a name='1085'></font>
<font color=#447700>!   this will work for rotated poles.<a name='1086'></font>
                      lat0     = 90.0,                                  &amp;<a name='1087'>
                      lon0     = 0.0,                                   &amp;<a name='1088'>
                      knowni   = 1.,                                    &amp;<a name='1089'>
                      knownj   = 1.,                                    &amp;<a name='1090'>
                      stdlon   = config_flags%stand_lon)<a name='1091'>
<a name='1092'>
<font color=#447700>! Rotated latitude-longitude<a name='1093'></font>
   ELSE IF (config_flags%map_proj == PROJ_ROTLL) THEN<a name='1094'>
     CALL <A href='../../html_code/share/module_llxy.F.html#MAP_SET'>map_set</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MAP_SET_21">(PROJ_ROTLL, track_proj,                       &amp;<a name='1095'>
<font color=#447700>! I have no idea how this should work for NMM nested domains<a name='1096'></font>
                      ixdim    = grid%e_we-1,                   &amp;<a name='1097'>
                      jydim    = grid%e_sn-1,                   &amp;<a name='1098'>
                      phi      = real(grid%e_sn-2)*grid%dy/2.0, &amp;<a name='1099'>
                      lambda   = real(grid%e_we-2)*grid%dx,     &amp;<a name='1100'>
                      lat1     = config_flags%cen_lat,          &amp;<a name='1101'>
                      lon1     = config_flags%cen_lon,          &amp;<a name='1102'>
                      latinc   = grid%dy,                       &amp;<a name='1103'>
                      loninc   = grid%dx,                       &amp;<a name='1104'>
                      stagger  = HH)<a name='1105'>
   <a name='1106'>
   ENDIF<a name='1107'>
<a name='1108'>
   IF (.NOT. grid%track_have_calculated) THEN<a name='1109'>
     grid%track_have_calculated = .TRUE.<a name='1110'>
     WRITE(message, '(A46,I3)') 'Computing track locations inside model domain ', grid%id<a name='1111'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1395">(message)<a name='1112'>
<a name='1113'>
<font color=#447700>!--------------------------------------------------------<a name='1114'></font>
<font color=#447700>! initialize<a name='1115'></font>
<font color=#447700>!--------------------------------------------------------<a name='1116'></font>
<a name='1117'>
     grid%track_next_time = 1<a name='1118'>
<font color=#447700>!--------------------------------------------------------<a name='1119'></font>
<font color=#447700>! Determine track locations inside model domain and the corresponding model grid<a name='1120'></font>
<font color=#447700>!--------------------------------------------------------<a name='1121'></font>
     track_loc_temp = 0<a name='1122'>
     DO k = 1,grid%track_loc<a name='1123'>
       CALL <A href='../../html_code/share/module_llxy.F.html#LATLON_TO_IJ'>latlon_to_ij</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LATLON_TO_IJ_5">(track_proj, grid%track_lat_in(k), grid%track_lon_in(k), track_rx, track_ry)<a name='1124'>
       track_loc_temp = track_loc_temp + 1<a name='1125'>
<font color=#447700>!--------------------------------------------------------<a name='1126'></font>
<font color=#447700>! found the corresponding model grid<a name='1127'></font>
<font color=#447700>!--------------------------------------------------------<a name='1128'></font>
       grid%track_i(track_loc_temp) = NINT(track_rx)<a name='1129'>
       grid%track_j(track_loc_temp) = NINT(track_ry)<a name='1130'>
<font color=#447700>!--------------------------------------------------------<a name='1131'></font>
<font color=#447700>! found the corresponding track time<a name='1132'></font>
<font color=#447700>!--------------------------------------------------------<a name='1133'></font>
       grid%track_time_domain(track_loc_temp) = grid%track_time_in(k)<a name='1134'>
<font color=#447700>!--------------------------------------------------------<a name='1135'></font>
<font color=#447700>! Is point outside of domain (or on the edge of domain)? -- don't count<a name='1136'></font>
<font color=#447700>!--------------------------------------------------------<a name='1137'></font>
       IF (grid%track_i(track_loc_temp) &lt; ids .OR. grid%track_i(track_loc_temp) &gt; ide .OR. &amp;<a name='1138'>
           grid%track_j(track_loc_temp) &lt; jds .OR. grid%track_j(track_loc_temp) &gt; jde) THEN<a name='1139'>
         track_loc_temp = track_loc_temp - 1   <a name='1140'>
       ENDIF<a name='1141'>
     ENDDO<a name='1142'>
<a name='1143'>
<font color=#447700>!--------------------------------------------------------<a name='1144'></font>
<font color=#447700>! put the total valid track locations into grid%track_loc_domain<a name='1145'></font>
<font color=#447700>!--------------------------------------------------------<a name='1146'></font>
     grid%track_loc_domain = track_loc_temp<a name='1147'>
<font color=#447700>!--------------------------------------------------------<a name='1148'></font>
<font color=#447700>! found the corresponding model lat and lon and elevation<a name='1149'></font>
<font color=#447700>!--------------------------------------------------------<a name='1150'></font>
     DO k = 1,grid%track_loc_domain<a name='1151'>
<font color=#447700>!--------------------------------------------------------<a name='1152'></font>
<font color=#447700>! If location is outside of patch, we need to get lat/lon of track grid cell from another patch<a name='1153'></font>
<font color=#447700>!--------------------------------------------------------<a name='1154'></font>
       IF (grid%track_i(k) &lt; ips .OR. grid%track_i(k) &gt; ipe .OR. &amp;<a name='1155'>
           grid%track_j(k) &lt; jps .OR. grid%track_j(k) &gt; jpe) THEN<a name='1156'>
         grid%track_lat_domain(k) = 1.E30<a name='1157'>
         grid%track_lon_domain(k) = 1.E30<a name='1158'>
         grid%track_ele(k) = 1.E30<a name='1159'>
       ELSE<a name='1160'>
         grid%track_lat_domain(k) = grid%xlat(grid%track_i(k),grid%track_j(k))<a name='1161'>
         grid%track_lon_domain(k) = grid%xlong(grid%track_i(k),grid%track_j(k))<a name='1162'>
         grid%track_ele(k) = grid%ht(grid%track_i(k),grid%track_j(k))<a name='1163'>
       ENDIF<a name='1164'>
<a name='1165'>
#if DM_PARALLEL<a name='1166'>
       grid%track_ele(k)         = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REAL'>wrf_dm_min_real</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REAL_9">(grid%track_ele(k))<a name='1167'>
       grid%track_lat_domain(k)  = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REAL'>wrf_dm_min_real</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REAL_10">(grid%track_lat_domain(k))<a name='1168'>
       grid%track_lon_domain(k)  = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MIN_REAL'>wrf_dm_min_real</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MIN_REAL_11">(grid%track_lon_domain(k))<a name='1169'>
<a name='1170'>
       call <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_20">(grid%track_time_domain(k), 19)<a name='1171'>
#endif<a name='1172'>
     END DO<a name='1173'>
<a name='1174'>
     write(message,*) 'calc_track_locations: valid track locations in the model domain ', grid%track_loc_domain<a name='1175'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/track_driver.F.html#CALC_TRACK_LOCATIONS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1396">( trim(message) )<a name='1176'>
   <a name='1177'>
    ENDIF<a name='1178'>
#if ( DA_CORE <font color=#447700>!= 1 )<a name='1179'></font>
   ENDIF<a name='1180'>
#endif<a name='1181'>
#endif<a name='1182'>
<a name='1183'>
END SUBROUTINE calc_track_locations<a name='1184'>
</pre></body></html>