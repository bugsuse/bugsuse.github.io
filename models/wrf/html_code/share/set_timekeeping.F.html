<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='SETUP_TIMEKEEPING'><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>Setup_Timekeeping</font> ( grid ) <A href='../../call_to/SETUP_TIMEKEEPING.html' TARGET='index'>17</A>,<A href='../../call_from/SETUP_TIMEKEEPING.html' TARGET='index'>39</A><a name='3'>
   USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_445"><a name='4'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_285"><a name='5'>
   USE module_utility<a name='6'>
   IMPLICIT NONE<a name='7'>
   TYPE(domain), POINTER :: grid<a name='8'>
<font color=#447700>! Local<a name='9'></font>
   TYPE(WRFU_TimeInterval) :: begin_time, end_time, zero_time, one_minute, one_hour, forever, padding_interval<a name='10'>
   TYPE(WRFU_TimeInterval) :: interval, run_length, dfl_length<a name='11'>
   TYPE(WRFU_Time) :: startTime, stopTime, initialTime<a name='12'>
   TYPE(WRFU_TimeInterval) :: stepTime<a name='13'>
   TYPE(WRFU_TimeInterval) :: tmp_step<a name='14'>
   INTEGER :: start_year,start_month,start_day,start_hour,start_minute,start_second<a name='15'>
   INTEGER :: end_year,end_month,end_day,end_hour,end_minute,end_second<a name='16'>
   INTEGER :: vortex_interval<a name='17'>
#if ( HWRF == 1 )<a name='18'>
<font color=#447700>!zhang's doing<a name='19'></font>
   real (kind=8) :: day_in_sec<a name='20'>
   REAL :: tstart<a name='21'>
<font color=#447700>!end of zhang's doing<a name='22'></font>
#endif<a name='23'>
<a name='24'>
<font color=#447700>! #if (EM_CORE == 1)<a name='25'></font>
   INTEGER :: dfi_fwdstop_year,dfi_fwdstop_month,dfi_fwdstop_day,dfi_fwdstop_hour,dfi_fwdstop_minute,dfi_fwdstop_second<a name='26'>
   INTEGER :: dfi_bckstop_year,dfi_bckstop_month,dfi_bckstop_day,dfi_bckstop_hour,dfi_bckstop_minute,dfi_bckstop_second<a name='27'>
<font color=#447700>! #endif<a name='28'></font>
<a name='29'>
   INTEGER :: restart_interval_d<a name='30'>
   INTEGER :: inputout_interval_d<a name='31'>
   INTEGER :: inputout_begin_y<a name='32'>
   INTEGER :: inputout_end_y<a name='33'>
   INTEGER :: inputout_begin_m<a name='34'>
   INTEGER :: inputout_begin_s<a name='35'>
   INTEGER :: inputout_begin_d<a name='36'>
   INTEGER :: inputout_begin_h<a name='37'>
   INTEGER :: inputout_end_m<a name='38'>
   INTEGER :: inputout_end_s<a name='39'>
   INTEGER :: inputout_end_d<a name='40'>
   INTEGER :: inputout_end_h<a name='41'>
   INTEGER :: restart_interval_m<a name='42'>
   INTEGER :: restart_interval_s<a name='43'>
   INTEGER :: restart_interval<a name='44'>
   INTEGER :: restart_interval_h<a name='45'>
   INTEGER :: inputout_interval_m<a name='46'>
   INTEGER :: inputout_interval_s<a name='47'>
   INTEGER :: inputout_interval<a name='48'>
   INTEGER :: inputout_interval_h<a name='49'>
<a name='50'>
#  include "<A href='../../html_code/include/set_timekeeping_defs.inc.html'>set_timekeeping_defs.inc</A>"<A NAME="set_timekeeping_defs.inc_1"><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='51'>
<a name='52'>
   INTEGER :: grid_fdda, grid_sfdda<a name='53'>
<a name='54'>
   INTEGER :: run_days, run_hours, run_minutes, run_seconds<a name='55'>
   INTEGER :: time_step, time_step_fract_num, time_step_fract_den<a name='56'>
   INTEGER :: rc<a name='57'>
   REAL    :: dt<a name='58'>
<a name='59'>
   CALL WRFU_TimeIntervalSet ( zero_time, rc=rc )<a name='60'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_14">( WRFU_SUCCESS, rc, &amp;<a name='61'>
                         'WRFU_TimeIntervalSet(zero_time) FAILED', &amp;<a name='62'>
                         __FILE__ , &amp;<a name='63'>
                         __LINE__  )<a name='64'>
   CALL WRFU_TimeIntervalSet ( one_minute, M=1, rc=rc )<a name='65'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_15">( WRFU_SUCCESS, rc, &amp;<a name='66'>
                         'WRFU_TimeIntervalSet(one_minute) FAILED', &amp;<a name='67'>
                         __FILE__ , &amp;<a name='68'>
                         __LINE__  )<a name='69'>
   CALL WRFU_TimeIntervalSet ( one_hour, H=1, rc=rc )<a name='70'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_16">( WRFU_SUCCESS, rc, &amp;<a name='71'>
                         'WRFU_TimeIntervalSet(one_hour) FAILED', &amp;<a name='72'>
                         __FILE__ , &amp;<a name='73'>
                         __LINE__  )<a name='74'>
   CALL WRFU_TimeIntervalSet ( forever, S=1700000000, rc=rc )  <font color=#447700>! magic number; indicats an interval that is forever<a name='75'></font>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_17">( WRFU_SUCCESS, rc, &amp;<a name='76'>
                         'WRFU_TimeIntervalSet(forever) FAILED', &amp;<a name='77'>
                         __FILE__ , &amp;<a name='78'>
                         __LINE__  )<a name='79'>
<a name='80'>
<font color=#447700>! #if (EM_CORE == 1)<a name='81'></font>
   IF ( (grid%dfi_opt .EQ. DFI_NODFI) .OR. (grid%dfi_stage .EQ. DFI_SETUP) ) THEN<a name='82'>
<font color=#447700>! #endif<a name='83'></font>
      CALL nl_get_start_year(grid%id,start_year)<a name='84'>
      CALL nl_get_start_month(grid%id,start_month)<a name='85'>
      CALL nl_get_start_day(grid%id,start_day)<a name='86'>
      CALL nl_get_start_hour(grid%id,start_hour)<a name='87'>
      CALL nl_get_start_minute(grid%id,start_minute)<a name='88'>
      CALL nl_get_start_second(grid%id,start_second)<a name='89'>
#if ( HWRF == 1 )<a name='90'>
<font color=#447700>!zhang's doing - check with zhan before adding this bit<a name='91'></font>
<font color=#447700>!   CALL nl_get_tstart ( grid%id , tstart )<a name='92'></font>
<font color=#447700>!   CALL jdn_sec(day_in_sec,start_year,start_month,start_day,start_hour,start_minute,start_second)<a name='93'></font>
<font color=#447700>!   day_in_sec = day_in_sec + tstart*3600.<a name='94'></font>
<font color=#447700>!   CALL jdn_ymd_hms(day_in_sec,start_year,start_month,start_day,start_hour,start_minute,start_second)<a name='95'></font>
<font color=#447700>!end of zhang's doing<a name='96'></font>
#endif<a name='97'>
      CALL WRFU_TimeSet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='98'>
                                   H=start_hour, M=start_minute, S=start_second,&amp;<a name='99'>
                                   rc=rc)<a name='100'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_18">( WRFU_SUCCESS, rc, &amp;<a name='101'>
                            'WRFU_TimeSet(startTime) FAILED', &amp;<a name='102'>
                            __FILE__ , &amp;<a name='103'>
                            __LINE__  )<a name='104'>
<font color=#447700>! #if (EM_CORE == 1)<a name='105'></font>
   ELSE<a name='106'>
      IF ( grid%dfi_opt .EQ. DFI_DFL ) THEN<a name='107'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='108'>
            CALL nl_get_start_year(grid%id,start_year)<a name='109'>
            CALL nl_get_start_month(grid%id,start_month)<a name='110'>
            CALL nl_get_start_day(grid%id,start_day)<a name='111'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='112'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='113'>
            CALL nl_get_start_second(grid%id,start_second)<a name='114'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_FST ) THEN<a name='115'>
            CALL nl_get_start_year(grid%id,start_year)<a name='116'>
            CALL nl_get_start_month(grid%id,start_month)<a name='117'>
            CALL nl_get_start_day(grid%id,start_day)<a name='118'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='119'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='120'>
            CALL nl_get_start_second(grid%id,start_second)<a name='121'>
<a name='122'>
            run_length = grid%stop_subtime - grid%start_subtime<a name='123'>
            CALL WRFU_TimeIntervalGet( run_length, S=run_seconds, rc=rc )<a name='124'>
<font color=#447700>! What about fractional seconds?<a name='125'></font>
            run_seconds = run_seconds / 2<a name='126'>
            CALL WRFU_TimeIntervalSet ( run_length, S=run_seconds, rc=rc )<a name='127'>
            CALL WRFU_TimeSet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='128'>
                                         H=start_hour, M=start_minute, S=start_second,&amp;<a name='129'>
                                         rc=rc)<a name='130'>
            startTime = startTime + run_length<a name='131'>
            CALL WRFU_TimeGet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='132'>
                                         H=start_hour, M=start_minute, S=start_second,&amp;<a name='133'>
                                         rc=rc)<a name='134'>
         END IF<a name='135'>
<a name='136'>
      ELSE IF ( grid%dfi_opt .EQ. DFI_DDFI ) THEN<a name='137'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='138'>
            CALL nl_get_dfi_bckstop_year(grid%id,start_year)<a name='139'>
            CALL nl_get_dfi_bckstop_month(grid%id,start_month)<a name='140'>
            CALL nl_get_dfi_bckstop_day(grid%id,start_day)<a name='141'>
            CALL nl_get_dfi_bckstop_hour(grid%id,start_hour)<a name='142'>
            CALL nl_get_dfi_bckstop_minute(grid%id,start_minute)<a name='143'>
            CALL nl_get_dfi_bckstop_second(grid%id,start_second)<a name='144'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_BCK ) THEN<a name='145'>
            CALL nl_get_start_year(grid%id,start_year)<a name='146'>
            CALL nl_get_start_month(grid%id,start_month)<a name='147'>
            CALL nl_get_start_day(grid%id,start_day)<a name='148'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='149'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='150'>
            CALL nl_get_start_second(grid%id,start_second)<a name='151'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_FST ) THEN<a name='152'>
            CALL nl_get_start_year(grid%id,start_year)<a name='153'>
            CALL nl_get_start_month(grid%id,start_month)<a name='154'>
            CALL nl_get_start_day(grid%id,start_day)<a name='155'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='156'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='157'>
            CALL nl_get_start_second(grid%id,start_second)<a name='158'>
         END IF<a name='159'>
<a name='160'>
      ELSE IF ( grid%dfi_opt .EQ. DFI_TDFI ) THEN<a name='161'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='162'>
            CALL nl_get_dfi_bckstop_year(grid%id,start_year)<a name='163'>
            CALL nl_get_dfi_bckstop_month(grid%id,start_month)<a name='164'>
            CALL nl_get_dfi_bckstop_day(grid%id,start_day)<a name='165'>
            CALL nl_get_dfi_bckstop_hour(grid%id,start_hour)<a name='166'>
            CALL nl_get_dfi_bckstop_minute(grid%id,start_minute)<a name='167'>
            CALL nl_get_dfi_bckstop_second(grid%id,start_second)<a name='168'>
<a name='169'>
            <font color=#447700>! Here, we look at head_grid to determine run_length.<a name='170'></font>
            <font color=#447700>!   Since start_subtime and stop_subtime were<a name='171'></font>
            <font color=#447700>!   updated for nesting, they no longer bound the dfi<a name='172'></font>
            <font color=#447700>!   time window, so, start_subtime and stop_subtime from<a name='173'></font>
            <font color=#447700>!   from the grid structure won't work.  However, we can use<a name='174'></font>
            <font color=#447700>!   head_grid since the dfi time window is the same for all <a name='175'></font>
            <font color=#447700>!   domains.<a name='176'></font>
<a name='177'>
            run_length = head_grid%start_subtime - head_grid%stop_subtime<a name='178'>
            CALL WRFU_TimeIntervalGet( run_length, S=run_seconds, rc=rc )<a name='179'>
<font color=#447700>! What about fractional seconds?<a name='180'></font>
            run_seconds = run_seconds / 2<a name='181'>
            CALL WRFU_TimeIntervalSet ( run_length, S=run_seconds, rc=rc )<a name='182'>
            CALL WRFU_TimeSet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='183'>
                                         H=start_hour, M=start_minute, S=start_second,&amp;<a name='184'>
                                         rc=rc)<a name='185'>
            startTime = startTime + run_length<a name='186'>
            CALL WRFU_TimeGet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='187'>
                                         H=start_hour, M=start_minute, S=start_second,&amp;<a name='188'>
                                         rc=rc)<a name='189'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_BCK ) THEN<a name='190'>
            CALL nl_get_start_year(grid%id,start_year)<a name='191'>
            CALL nl_get_start_month(grid%id,start_month)<a name='192'>
            CALL nl_get_start_day(grid%id,start_day)<a name='193'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='194'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='195'>
            CALL nl_get_start_second(grid%id,start_second)<a name='196'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_FST ) THEN<a name='197'>
            CALL nl_get_start_year(grid%id,start_year)<a name='198'>
            CALL nl_get_start_month(grid%id,start_month)<a name='199'>
            CALL nl_get_start_day(grid%id,start_day)<a name='200'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='201'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='202'>
            CALL nl_get_start_second(grid%id,start_second)<a name='203'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_STARTFWD ) THEN<a name='204'>
            CALL nl_get_start_year(grid%id,start_year)<a name='205'>
            CALL nl_get_start_month(grid%id,start_month)<a name='206'>
            CALL nl_get_start_day(grid%id,start_day)<a name='207'>
            CALL nl_get_start_hour(grid%id,start_hour)<a name='208'>
            CALL nl_get_start_minute(grid%id,start_minute)<a name='209'>
            CALL nl_get_start_second(grid%id,start_second)<a name='210'>
         END IF<a name='211'>
      END IF<a name='212'>
<a name='213'>
      IF ( grid%dfi_stage .EQ. DFI_STARTBCK ) THEN<a name='214'>
         CALL WRFU_ClockGet( grid%domain_clock, CurrTime=startTime, rc=rc)<a name='215'>
      ELSE<a name='216'>
         CALL WRFU_TimeSet(startTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='217'>
              H=start_hour, M=start_minute, S=start_second,&amp;<a name='218'>
              rc=rc)<a name='219'>
      ENDIF<a name='220'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_19">( WRFU_SUCCESS, rc, &amp;<a name='221'>
                            'WRFU_TimeSet(startTime) FAILED', &amp;<a name='222'>
                            __FILE__ , &amp;<a name='223'>
                            __LINE__  )<a name='224'>
   END IF<a name='225'>
<font color=#447700>! #endif<a name='226'></font>
<a name='227'>
   CALL nl_get_run_days(1,run_days)<a name='228'>
   CALL nl_get_run_hours(1,run_hours)<a name='229'>
   CALL nl_get_run_minutes(1,run_minutes)<a name='230'>
   CALL nl_get_run_seconds(1,run_seconds)<a name='231'>
<a name='232'>
<font color=#447700>! #if (EM_CORE == 1)<a name='233'></font>
   IF ( (grid%dfi_opt .EQ. DFI_NODFI) .OR. (grid%dfi_stage .EQ. DFI_SETUP) .OR. (grid%dfi_stage .EQ. DFI_FST)) THEN<a name='234'>
<font color=#447700>! #endif<a name='235'></font>
<a name='236'>
      IF ( grid%id .EQ. head_grid%id .AND. &amp;<a name='237'>
           ( run_days .gt. 0 .or. run_hours .gt. 0 .or. run_minutes .gt. 0 .or. run_seconds .gt. 0 )) THEN<a name='238'>
        CALL WRFU_TimeIntervalSet ( run_length , D=run_days, H=run_hours, M=run_minutes, S=run_seconds, rc=rc )<a name='239'>
<font color=#447700>! #if (EM_CORE == 1)<a name='240'></font>
        IF ( grid%dfi_stage .EQ. DFI_FST .AND. grid%dfi_opt .EQ. DFI_DFL ) THEN<a name='241'>
           CALL nl_get_start_year(grid%id,start_year)<a name='242'>
           CALL nl_get_start_month(grid%id,start_month)<a name='243'>
           CALL nl_get_start_day(grid%id,start_day)<a name='244'>
           CALL nl_get_start_hour(grid%id,start_hour)<a name='245'>
           CALL nl_get_start_minute(grid%id,start_minute)<a name='246'>
           CALL nl_get_start_second(grid%id,start_second)<a name='247'>
           CALL WRFU_TimeSet(initialTime, YY=start_year, MM=start_month, DD=start_day, &amp;<a name='248'>
                                        H=start_hour, M=start_minute, S=start_second,&amp;<a name='249'>
                                        rc=rc)<a name='250'>
           dfl_length = startTime - initialTime<a name='251'>
           run_length = run_length - dfl_length<a name='252'>
        END IF<a name='253'>
<font color=#447700>! #endif<a name='254'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_20">( WRFU_SUCCESS, rc, &amp;<a name='255'>
                           'WRFU_TimeIntervalSet(run_length) FAILED', &amp;<a name='256'>
                           __FILE__ , &amp;<a name='257'>
                           __LINE__  )<a name='258'>
        stopTime = startTime + run_length<a name='259'>
      ELSE<a name='260'>
        CALL nl_get_end_year(grid%id,end_year)<a name='261'>
        CALL nl_get_end_month(grid%id,end_month)<a name='262'>
        CALL nl_get_end_day(grid%id,end_day)<a name='263'>
        CALL nl_get_end_hour(grid%id,end_hour)<a name='264'>
        CALL nl_get_end_minute(grid%id,end_minute)<a name='265'>
        CALL nl_get_end_second(grid%id,end_second)<a name='266'>
        CALL WRFU_TimeSet(stopTime, YY=end_year, MM=end_month, DD=end_day, &amp;<a name='267'>
                                 H=end_hour, M=end_minute, S=end_second,&amp;<a name='268'>
                                 rc=rc )<a name='269'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_21">( WRFU_SUCCESS, rc, &amp;<a name='270'>
                           'WRFU_TimeSet(stopTime) FAILED', &amp;<a name='271'>
                           __FILE__ , &amp;<a name='272'>
                           __LINE__  )<a name='273'>
        run_length = stopTime - startTime<a name='274'>
      ENDIF<a name='275'>
<a name='276'>
<font color=#447700>! #if (EM_CORE == 1)<a name='277'></font>
   ELSE IF ( grid%dfi_stage .EQ. DFI_STARTFWD ) THEN<a name='278'>
      CALL nl_get_time_step ( 1, time_step )<a name='279'>
      CALL nl_get_time_step_fract_num( 1, time_step_fract_num )<a name='280'>
      CALL nl_get_time_step_fract_den( 1, time_step_fract_den )<a name='281'>
      CALL WRFU_TimeIntervalSet( run_length, S=time_step, Sn=time_step_fract_num, Sd=time_step_fract_den, rc=rc)<a name='282'>
      stopTime = startTime + run_length<a name='283'>
   ELSE IF ( grid%dfi_stage .EQ. DFI_STARTBCK ) THEN<a name='284'>
      CALL nl_get_time_step ( 1, time_step )<a name='285'>
      CALL nl_get_time_step_fract_num( 1, time_step_fract_num )<a name='286'>
      CALL nl_get_time_step_fract_den( 1, time_step_fract_den )<a name='287'>
      CALL WRFU_TimeIntervalSet( run_length, S=time_step, Sn=time_step_fract_num, Sd=time_step_fract_den, rc=rc)<a name='288'>
      stopTime = startTime + run_length<a name='289'>
   ELSE<a name='290'>
      IF ( grid%dfi_opt .EQ. DFI_DFL ) THEN <a name='291'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='292'>
            CALL nl_get_dfi_fwdstop_year(grid%id,end_year)<a name='293'>
            CALL nl_get_dfi_fwdstop_month(grid%id,end_month)<a name='294'>
            CALL nl_get_dfi_fwdstop_day(grid%id,end_day)<a name='295'>
            CALL nl_get_dfi_fwdstop_hour(grid%id,end_hour)<a name='296'>
            CALL nl_get_dfi_fwdstop_minute(grid%id,end_minute)<a name='297'>
            CALL nl_get_dfi_fwdstop_second(grid%id,end_second)<a name='298'>
         END IF<a name='299'>
<a name='300'>
      ELSE IF ( grid%dfi_opt .EQ. DFI_DDFI ) THEN <a name='301'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='302'>
            CALL nl_get_dfi_fwdstop_year(grid%id,end_year)<a name='303'>
            CALL nl_get_dfi_fwdstop_month(grid%id,end_month)<a name='304'>
            CALL nl_get_dfi_fwdstop_day(grid%id,end_day)<a name='305'>
            CALL nl_get_dfi_fwdstop_hour(grid%id,end_hour)<a name='306'>
            CALL nl_get_dfi_fwdstop_minute(grid%id,end_minute)<a name='307'>
            CALL nl_get_dfi_fwdstop_second(grid%id,end_second)<a name='308'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_BCK ) THEN<a name='309'>
            CALL nl_get_dfi_bckstop_year(grid%id,end_year)<a name='310'>
            CALL nl_get_dfi_bckstop_month(grid%id,end_month)<a name='311'>
            CALL nl_get_dfi_bckstop_day(grid%id,end_day)<a name='312'>
            CALL nl_get_dfi_bckstop_hour(grid%id,end_hour)<a name='313'>
            CALL nl_get_dfi_bckstop_minute(grid%id,end_minute)<a name='314'>
            CALL nl_get_dfi_bckstop_second(grid%id,end_second)<a name='315'>
         END IF<a name='316'>
<a name='317'>
      ELSE IF ( grid%dfi_opt .EQ. DFI_TDFI ) THEN <a name='318'>
         IF ( grid%dfi_stage .EQ. DFI_FWD ) THEN<a name='319'>
            CALL nl_get_dfi_fwdstop_year(grid%id,end_year)<a name='320'>
            CALL nl_get_dfi_fwdstop_month(grid%id,end_month)<a name='321'>
            CALL nl_get_dfi_fwdstop_day(grid%id,end_day)<a name='322'>
            CALL nl_get_dfi_fwdstop_hour(grid%id,end_hour)<a name='323'>
            CALL nl_get_dfi_fwdstop_minute(grid%id,end_minute)<a name='324'>
            CALL nl_get_dfi_fwdstop_second(grid%id,end_second)<a name='325'>
         ELSE IF ( grid%dfi_stage .EQ. DFI_BCK ) THEN<a name='326'>
            CALL nl_get_dfi_bckstop_year(grid%id,end_year)<a name='327'>
            CALL nl_get_dfi_bckstop_month(grid%id,end_month)<a name='328'>
            CALL nl_get_dfi_bckstop_day(grid%id,end_day)<a name='329'>
            CALL nl_get_dfi_bckstop_hour(grid%id,end_hour)<a name='330'>
            CALL nl_get_dfi_bckstop_minute(grid%id,end_minute)<a name='331'>
            CALL nl_get_dfi_bckstop_second(grid%id,end_second)<a name='332'>
         END IF<a name='333'>
      END IF<a name='334'>
      CALL WRFU_TimeSet(stopTime, YY=end_year, MM=end_month, DD=end_day, &amp;<a name='335'>
                         H=end_hour, M=end_minute, S=end_second,&amp;<a name='336'>
                                rc=rc)<a name='337'>
<a name='338'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_22">( WRFU_SUCCESS, rc, &amp;<a name='339'>
                   'WRFU_TimeSet(dfistopfwdTime) FAILED', &amp;<a name='340'>
                   __FILE__ , &amp;<a name='341'>
                   __LINE__  )<a name='342'>
<a name='343'>
      run_length = stopTime - startTime<a name='344'>
<a name='345'>
   END IF<a name='346'>
<font color=#447700>! #endif<a name='347'></font>
<a name='348'>
   IF ( run_length .GT. zero_time ) THEN<a name='349'>
     padding_interval = forever<a name='350'>
   ELSE<a name='351'>
     padding_interval = zero_time - forever<a name='352'>
   ENDIF<a name='353'>
<a name='354'>
   IF ( grid%id .EQ. head_grid%id ) THEN<a name='355'>
      CALL nl_get_time_step ( 1, time_step )<a name='356'>
      CALL nl_get_time_step_fract_num( 1, time_step_fract_num )<a name='357'>
      CALL nl_get_time_step_fract_den( 1, time_step_fract_den )<a name='358'>
      dt = real(time_step) + real(time_step_fract_num) / real(time_step_fract_den)<a name='359'>
#ifdef PLANET<a name='360'>
      <font color=#447700>! 2004-12-08 ADT notes:<a name='361'></font>
      <font color=#447700>! We have gotten the timestep from integers in the namelist, and they have just<a name='362'></font>
      <font color=#447700>! been converted to the timestep, "dt", used by the physics code just above.<a name='363'></font>
      <font color=#447700>! After this point, the integers are only used to update the clock used for,<a name='364'></font>
      <font color=#447700>! and we want to leave that on a "24-hour" type schedule, so we don't need to<a name='365'></font>
      <font color=#447700>! modify those integers.  Theoretically they refer to a portion of the planet's<a name='366'></font>
      <font color=#447700>! solar day.  The only thing we have to do is convert the *real* timestep, dt,<a name='367'></font>
      <font color=#447700>! to useful SI units.  This is easily accomplished by multiplying it by the<a name='368'></font>
      <font color=#447700>! variable P2SI, which was designed for just this purpose.  After multiplication,<a name='369'></font>
      <font color=#447700>! make sure every subsequent part of the model knows what the value is.<a name='370'></font>
      dt = dt * P2SI<a name='371'>
#endif<a name='372'>
      CALL nl_set_dt( grid%id, dt )<a name='373'>
      grid%dt = dt<a name='374'>
      CALL WRFU_TimeIntervalSet(stepTime, S=time_step, Sn=time_step_fract_num, Sd=time_step_fract_den, rc=rc)<a name='375'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_23">( WRFU_SUCCESS, rc, &amp;<a name='376'>
                            'WRFU_TimeIntervalSet(stepTime) FAILED', &amp;<a name='377'>
                            __FILE__ , &amp;<a name='378'>
                            __LINE__  )<a name='379'>
   ELSE<a name='380'>
      tmp_step = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_STEP'>domain_get_time_step</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_TIME_STEP_2">( grid%parents(1)%ptr )<a name='381'>
      stepTime = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_STEP'>domain_get_time_step</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_TIME_STEP_3">( grid%parents(1)%ptr ) / &amp;<a name='382'>
           grid%parent_time_step_ratio<a name='383'>
      grid%dt = grid%parents(1)%ptr%dt / grid%parent_time_step_ratio<a name='384'>
      CALL nl_set_dt( grid%id, grid%dt )<a name='385'>
   ENDIF<a name='386'>
<a name='387'>
   <font color=#447700>! create grid%domain_clock and associated state<a name='388'></font>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_CREATE'>domain_clock_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_CREATE_1">( grid, TimeStep= stepTime,  &amp;<a name='389'>
                                   StartTime=startTime, &amp;<a name='390'>
                                   StopTime= stopTime )<a name='391'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_24"> ( 150, grid, &amp;<a name='392'>
          'DEBUG setup_timekeeping():  clock after creation,' )<a name='393'>
<a name='394'>
   <font color=#447700>! Set default value for SIMULATION_START_DATE.  <a name='395'></font>
   <font color=#447700>! This is overwritten later in input_wrf(), if needed.  <a name='396'></font>
   IF ( grid%id .EQ. head_grid%id ) THEN<a name='397'>
      CALL nl_set_simulation_start_year   ( 1 , start_year   )<a name='398'>
      CALL nl_set_simulation_start_month  ( 1 , start_month  )<a name='399'>
      CALL nl_set_simulation_start_day    ( 1 , start_day    )<a name='400'>
      CALL nl_set_simulation_start_hour   ( 1 , start_hour   )<a name='401'>
      CALL nl_set_simulation_start_minute ( 1 , start_minute )<a name='402'>
      CALL nl_set_simulation_start_second ( 1 , start_second )<a name='403'>
   ENDIF<a name='404'>
<a name='405'>
#include "<A href='../../html_code/include/set_timekeeping_alarms.inc.html'>set_timekeeping_alarms.inc</A>"<A NAME="set_timekeeping_alarms.inc_2"><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='406'>
<a name='407'>
<font color=#447700>! RESTART INTERVAL<a name='408'></font>
<font color=#447700>! restart_interval is left there (and means minutes) for consistency, but<a name='409'></font>
<font color=#447700>! restart_interval_m will take precedence if specified<a name='410'></font>
   CALL nl_get_restart_interval( 1, restart_interval )   <font color=#447700>! same as minutes<a name='411'></font>
   CALL nl_get_restart_interval_d( 1, restart_interval_d )<a name='412'>
   CALL nl_get_restart_interval_h( 1, restart_interval_h )<a name='413'>
   CALL nl_get_restart_interval_m( 1, restart_interval_m )<a name='414'>
   CALL nl_get_restart_interval_s( 1, restart_interval_s )<a name='415'>
   IF ( restart_interval_m .EQ. 0 ) restart_interval_m = restart_interval<a name='416'>
   IF ( MAX( restart_interval_d,   &amp;<a name='417'>
             restart_interval_h, restart_interval_m , restart_interval_s   ) .GT. 0 ) THEN<a name='418'>
     CALL WRFU_TimeIntervalSet( interval, D=restart_interval_d, &amp;<a name='419'>
                                        H=restart_interval_h, M=restart_interval_m, S=restart_interval_s, rc=rc )<a name='420'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_24">( WRFU_SUCCESS, rc, &amp;<a name='421'>
                           'WRFU_TimeIntervalSet(restart_interval) FAILED', &amp;<a name='422'>
                           __FILE__ , &amp;<a name='423'>
                           __LINE__  )<a name='424'>
   ELSE<a name='425'>
     interval =  padding_interval<a name='426'>
   ENDIF<a name='427'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE'>domain_alarm_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARM_CREATE_2">( grid, RESTART_ALARM, interval )<a name='428'>
<a name='429'>
<font color=#447700>! INPUTOUT INTERVAL<a name='430'></font>
   CALL nl_get_inputout_interval( grid%id, inputout_interval )   <font color=#447700>! same as minutes<a name='431'></font>
   CALL nl_get_inputout_interval_d( grid%id, inputout_interval_d )<a name='432'>
   CALL nl_get_inputout_interval_h( grid%id, inputout_interval_h )<a name='433'>
   CALL nl_get_inputout_interval_m( grid%id, inputout_interval_m )<a name='434'>
   CALL nl_get_inputout_interval_s( grid%id, inputout_interval_s )<a name='435'>
   IF ( inputout_interval_m .EQ. 0 ) inputout_interval_m = inputout_interval<a name='436'>
<a name='437'>
   IF ( MAX( inputout_interval_d,   &amp;<a name='438'>
             inputout_interval_h, inputout_interval_m , inputout_interval_s   ) .GT. 0 ) THEN<a name='439'>
     CALL WRFU_TimeIntervalSet( interval, D=inputout_interval_d, &amp;<a name='440'>
                                        H=inputout_interval_h, M=inputout_interval_m, S=inputout_interval_s, rc=rc )<a name='441'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_25">( WRFU_SUCCESS, rc, &amp;<a name='442'>
                           'WRFU_TimeIntervalSet(inputout_interval) FAILED', &amp;<a name='443'>
                           __FILE__ , &amp;<a name='444'>
                           __LINE__  )<a name='445'>
   ELSE<a name='446'>
     interval =  padding_interval<a name='447'>
   ENDIF<a name='448'>
<a name='449'>
   CALL nl_get_inputout_begin_y( grid%id, inputout_begin_y )<a name='450'>
   CALL nl_get_inputout_begin_d( grid%id, inputout_begin_d )<a name='451'>
   CALL nl_get_inputout_begin_h( grid%id, inputout_begin_h )<a name='452'>
   CALL nl_get_inputout_begin_m( grid%id, inputout_begin_m )<a name='453'>
   CALL nl_get_inputout_begin_s( grid%id, inputout_begin_s )<a name='454'>
   IF ( MAX( inputout_begin_y, inputout_begin_d,   &amp;<a name='455'>
             inputout_begin_h, inputout_begin_m , inputout_begin_s   ) .GT. 0 ) THEN<a name='456'>
      CALL WRFU_TimeIntervalSet( begin_time , D=inputout_begin_d, &amp;<a name='457'>
                                      H=inputout_begin_h, M=inputout_begin_m, S=inputout_begin_s, rc=rc )<a name='458'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_26">( WRFU_SUCCESS, rc, &amp;<a name='459'>
                            'WRFU_TimeIntervalSet(inputout_begin) FAILED', &amp;<a name='460'>
                            __FILE__ , &amp;<a name='461'>
                            __LINE__  )<a name='462'>
   ELSE<a name='463'>
      begin_time = zero_time<a name='464'>
   ENDIF<a name='465'>
<a name='466'>
   CALL nl_get_inputout_end_y( grid%id, inputout_end_y )<a name='467'>
   CALL nl_get_inputout_end_d( grid%id, inputout_end_d )<a name='468'>
   CALL nl_get_inputout_end_h( grid%id, inputout_end_h )<a name='469'>
   CALL nl_get_inputout_end_m( grid%id, inputout_end_m )<a name='470'>
   CALL nl_get_inputout_end_s( grid%id, inputout_end_s )<a name='471'>
   IF ( MAX( inputout_end_y, inputout_end_d,   &amp;<a name='472'>
             inputout_end_h, inputout_end_m , inputout_end_s   ) .GT. 0 ) THEN<a name='473'>
      CALL WRFU_TimeIntervalSet( end_time , D=inputout_end_d, &amp;<a name='474'>
                                     H=inputout_end_h, M=inputout_end_m, S=inputout_end_s, rc=rc )<a name='475'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_27">( WRFU_SUCCESS, rc, &amp;<a name='476'>
                            'WRFU_TimeIntervalSet(inputout_end) FAILED', &amp;<a name='477'>
                            __FILE__ , &amp;<a name='478'>
                            __LINE__  )<a name='479'>
   ELSE<a name='480'>
      end_time =  padding_interval<a name='481'>
   ENDIF<a name='482'>
<a name='483'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE'>domain_alarm_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARM_CREATE_3">( grid, INPUTOUT_ALARM, interval, begin_time, end_time )<a name='484'>
<a name='485'>
#if ( WRF_CHEM == 1 )<a name='486'>
<font color=#447700>! AUXINPUT5_ INTERVAL<a name='487'></font>
<font color=#447700>! auxinput5_interval is left there (and means minutes) for consistency, but<a name='488'></font>
<font color=#447700>! auxinput5_interval_m will take precedence if specified<a name='489'></font>
   CALL nl_get_auxinput5_interval( grid%id, auxinput5_interval )   <font color=#447700>! same as minutes<a name='490'></font>
   CALL nl_get_auxinput5_interval_d( grid%id, auxinput5_interval_d )<a name='491'>
   CALL nl_get_auxinput5_interval_h( grid%id, auxinput5_interval_h )<a name='492'>
   CALL nl_get_auxinput5_interval_m( grid%id, auxinput5_interval_m )<a name='493'>
   CALL nl_get_auxinput5_interval_s( grid%id, auxinput5_interval_s )<a name='494'>
   IF ( auxinput5_interval_m .EQ. 0 ) auxinput5_interval_m = auxinput5_interval<a name='495'>
<a name='496'>
   IF ( MAX( auxinput5_interval_d,   &amp;<a name='497'>
             auxinput5_interval_h, auxinput5_interval_m , auxinput5_interval_s   ) .GT. 0 ) THEN<a name='498'>
     CALL WRFU_TimeIntervalSet( interval, D=auxinput5_interval_d, &amp;<a name='499'>
                                        H=auxinput5_interval_h, M=auxinput5_interval_m, S=auxinput5_interval_s, rc=rc )<a name='500'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_28">( WRFU_SUCCESS, rc, &amp;<a name='501'>
                           'WRFU_TimeIntervalSet(auxinput5_interval) FAILED', &amp;<a name='502'>
                           __FILE__ , &amp;<a name='503'>
                           __LINE__  )<a name='504'>
   ELSE<a name='505'>
     interval =  padding_interval<a name='506'>
   ENDIF<a name='507'>
<a name='508'>
   CALL nl_get_auxinput5_begin_y( grid%id, auxinput5_begin_y )<a name='509'>
   CALL nl_get_auxinput5_begin_d( grid%id, auxinput5_begin_d )<a name='510'>
   CALL nl_get_auxinput5_begin_h( grid%id, auxinput5_begin_h )<a name='511'>
   CALL nl_get_auxinput5_begin_m( grid%id, auxinput5_begin_m )<a name='512'>
   CALL nl_get_auxinput5_begin_s( grid%id, auxinput5_begin_s )<a name='513'>
   IF ( MAX( auxinput5_begin_y, auxinput5_begin_d,   &amp;<a name='514'>
             auxinput5_begin_h, auxinput5_begin_m , auxinput5_begin_s   ) .GT. 0 ) THEN<a name='515'>
      CALL WRFU_TimeIntervalSet( begin_time , D=auxinput5_begin_d, &amp;<a name='516'>
                                      H=auxinput5_begin_h, M=auxinput5_begin_m, S=auxinput5_begin_s, rc=rc )<a name='517'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_29">( WRFU_SUCCESS, rc, &amp;<a name='518'>
                            'WRFU_TimeIntervalSet(auxinput5_begin) FAILED', &amp;<a name='519'>
                            __FILE__ , &amp;<a name='520'>
                            __LINE__  )<a name='521'>
   ELSE<a name='522'>
      begin_time = zero_time<a name='523'>
   ENDIF<a name='524'>
   CALL nl_get_auxinput5_end_y( grid%id, auxinput5_end_y )<a name='525'>
   CALL nl_get_auxinput5_end_d( grid%id, auxinput5_end_d )<a name='526'>
   CALL nl_get_auxinput5_end_h( grid%id, auxinput5_end_h )<a name='527'>
   CALL nl_get_auxinput5_end_m( grid%id, auxinput5_end_m )<a name='528'>
   CALL nl_get_auxinput5_end_s( grid%id, auxinput5_end_s )<a name='529'>
   IF ( MAX( auxinput5_end_y, auxinput5_end_d,   &amp;<a name='530'>
             auxinput5_end_h, auxinput5_end_m , auxinput5_end_s   ) .GT. 0 ) THEN<a name='531'>
      CALL WRFU_TimeIntervalSet( end_time , D=auxinput5_end_d, &amp;<a name='532'>
                                     H=auxinput5_end_h, M=auxinput5_end_m, S=auxinput5_end_s, rc=rc )<a name='533'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_30">( WRFU_SUCCESS, rc, &amp;<a name='534'>
                            'WRFU_TimeIntervalSet(auxinput5_end) FAILED', &amp;<a name='535'>
                            __FILE__ , &amp;<a name='536'>
                            __LINE__  )<a name='537'>
   ELSE<a name='538'>
      end_time =  padding_interval<a name='539'>
   ENDIF<a name='540'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE'>domain_alarm_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARM_CREATE_4">( grid, AUXINPUT5_ALARM, interval, begin_time, end_time )<a name='541'>
<font color=#447700>!TBH:  Should be OK to remove the "#else" section and the code it contains <a name='542'></font>
<font color=#447700>!TBH:  because later code overwrites grid%alarms( AUXINPUT5_ALARM )...  <a name='543'></font>
<font color=#447700>!TBH:  In fact, by setting namelist values for auxinput5 correctly, it ought <a name='544'></font>
<font color=#447700>!TBH:  to be possible to get rid of all "#if ( WRF_CHEM == 1 )" bits in this file...  <a name='545'></font>
   CALL WRFU_AlarmEnable( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='546'>
   CALL WRFU_AlarmRingerOn( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='547'>
<font color=#447700>! TBH:  NOTE:  Proper setting of namelist variables for auxinput5 ought to <a name='548'></font>
<font color=#447700>! TBH:         make this hard-coded bit unnecessary.  <a name='549'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='550'></font>
<font color=#447700>! add for wrf_chem emiss input<a name='551'></font>
   CALL WRFU_AlarmEnable( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='552'>
   CALL WRFU_AlarmRingerOn( grid%alarms( AUXINPUT5_ALARM ), rc=rc )<a name='553'>
<font color=#447700>! end for wrf chem emiss input<a name='554'></font>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='555'></font>
#endif<a name='556'>
<a name='557'>
<font color=#447700>! without this test, it's possible for the value of the WRF_ALARM_SECS_TIL_NEXT_RING<a name='558'></font>
<font color=#447700>! that is written as metadata to a restart file to be garbage for BOUNDARY_ALARM for <a name='559'></font>
<font color=#447700>! the nests.  Parallel NetCDF does a header check on all the metadata being written<a name='560'></font>
<font color=#447700>! from multiple processors and if it differs, it throws up an error. This avoids that.<a name='561'></font>
   IF ( grid%id .EQ. 1 ) THEN   <font color=#447700>! only moad can have specified boundaries<a name='562'></font>
     CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE'>domain_alarm_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARM_CREATE_5">( grid, BOUNDARY_ALARM, interval )<a name='563'>
     CALL WRFU_AlarmEnable( grid%alarms( BOUNDARY_ALARM ), rc=rc )<a name='564'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_31">( WRFU_SUCCESS, rc, &amp;<a name='565'>
                           'WRFU_AlarmEnable(BOUNDARY_ALARM) FAILED', &amp;<a name='566'>
                           __FILE__ , &amp;<a name='567'>
                           __LINE__  )<a name='568'>
     CALL WRFU_AlarmRingerOn( grid%alarms( BOUNDARY_ALARM ), rc=rc )<a name='569'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_32">( WRFU_SUCCESS, rc, &amp;<a name='570'>
                           'WRFU_AlarmRingerOn(BOUNDARY_ALARM) FAILED', &amp;<a name='571'>
                           __FILE__ , &amp;<a name='572'>
                           __LINE__  )<a name='573'>
   ENDIF<a name='574'>
<a name='575'>
<font color=#447700>! This is the interval at which the code in time_for_move in share/mediation_integrate.F<a name='576'></font>
<font color=#447700>! will recompute the center of the Vortex.  Other times, it will use the last position.<a name='577'></font>
<font color=#447700>!<a name='578'></font>
   vortex_interval = 0<a name='579'>
#ifdef MOVE_NESTS<a name='580'>
   CALL nl_get_vortex_interval ( grid%id , vortex_interval ) <a name='581'>
#endif<a name='582'>
   CALL WRFU_TimeIntervalSet( interval, M=vortex_interval, rc=rc )<a name='583'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_33">( WRFU_SUCCESS, rc, &amp;<a name='584'>
                           'WRFU_TimeIntervalSet(interval) for computing vortex center FAILED', &amp;<a name='585'>
                           __FILE__ , &amp;<a name='586'>
                           __LINE__  )<a name='587'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE'>domain_alarm_create</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARM_CREATE_6">( grid,  COMPUTE_VORTEX_CENTER_ALARM, interval  )<a name='588'>
#ifdef MOVE_NESTS<a name='589'>
   CALL WRFU_AlarmEnable( grid%alarms( COMPUTE_VORTEX_CENTER_ALARM ), rc=rc )<a name='590'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_34">( WRFU_SUCCESS, rc, &amp;<a name='591'>
                         'WRFU_AlarmEnable(COMPUTE_VORTEX_CENTER_ALARM) FAILED', &amp;<a name='592'>
                         __FILE__ , &amp;<a name='593'>
                         __LINE__  )<a name='594'>
   CALL WRFU_AlarmRingerOn( grid%alarms( COMPUTE_VORTEX_CENTER_ALARM ), rc=rc )<a name='595'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_35">( WRFU_SUCCESS, rc, &amp;<a name='596'>
                         'WRFU_AlarmRingerOn(COMPUTE_VORTEX_CENTER_ALARM) FAILED', &amp;<a name='597'>
                         __FILE__ , &amp;<a name='598'>
                         __LINE__  )<a name='599'>
#else<a name='600'>
<font color=#447700>! Go ahead and let the alarm be defined, but disable it, since we are not using moving nests here.<a name='601'></font>
   CALL WRFU_AlarmDisable( grid%alarms( COMPUTE_VORTEX_CENTER_ALARM ), rc=rc )<a name='602'>
   CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_36">( WRFU_SUCCESS, rc, &amp;<a name='603'>
                         'WRFU_AlarmDisable(COMPUTE_VORTEX_CENTER_ALARM) FAILED', &amp;<a name='604'>
                         __FILE__ , &amp;<a name='605'>
                         __LINE__  )<a name='606'>
#endif<a name='607'>
<a name='608'>
   grid%time_set = .TRUE.<a name='609'>
<a name='610'>
   <font color=#447700>! Initialize derived time quantities in grid state.  <a name='611'></font>
   <font color=#447700>! These are updated in domain_clockadvance().  <a name='612'></font>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_82">( grid, minutesSinceSimulationStart=grid%xtime )<a name='613'>
   CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_83">( grid, currentDayOfYearReal=grid%julian )<a name='614'>
   WRITE(wrf_err_message,*) 'setup_timekeeping:  set xtime to ',grid%xtime<a name='615'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1129"> ( 100, TRIM(wrf_err_message) )<a name='616'>
   WRITE(wrf_err_message,*) 'setup_timekeeping:  set julian to ',grid%julian<a name='617'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1130"> ( 100, TRIM(wrf_err_message) )<a name='618'>
<a name='619'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/set_timekeeping.F.html#SETUP_TIMEKEEPING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1131"> ( 100 , 'setup_timekeeping:  returning...' )<a name='620'>
<a name='621'>
END SUBROUTINE Setup_Timekeeping<a name='622'>
<a name='623'>
<a name='624'>
</pre></body></html>