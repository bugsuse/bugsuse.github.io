<HTML> <BODY BGCOLOR=#eedddd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
#if ( HYBRID_COORD==1 )<a name='2'>
#define mu_2(...) (c1(k)*XXPC2XX(__VA_ARGS__))<a name='3'>
#define XXPC2XX(...) mu_2(__VA_ARGS__)<a name='4'>
<a name='5'>
#define mub(...) (c1(k)*XXPCBXX(__VA_ARGS__)+c2(k))<a name='6'>
#define XXPCBXX(...) mub(__VA_ARGS__)<a name='7'>
<a name='8'>
#define mu(...) (c1(k)*XXPCXX(__VA_ARGS__)+c2(k))<a name='9'>
#define XXPCXX(...) mu(__VA_ARGS__)<a name='10'>
#endif<a name='11'>
<a name='12'>
<font color=#447700>!WRF:MODEL_LAYER:BOUNDARY<a name='13'></font>
<font color=#447700>!<a name='14'></font>
<a name='15'>
<A NAME='MODULE_BC'><A href='../../html_code/share/module_bc.F.html#MODULE_BC' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='16'>
<font color=#993300>MODULE </font><font color=#cc0000>module_bc</font> <A href='../../call_to/MODULE_BC.html' TARGET='index'>22</A><a name='17'>
<a name='18'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_263"><a name='19'>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_105"><a name='20'>
   USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_115"><a name='21'>
   IMPLICIT NONE<a name='22'>
<a name='23'>
<font color=#447700>!   TYPE bcs<a name='24'></font>
<font color=#447700>!<a name='25'></font>
<font color=#447700>!     LOGICAL                     :: periodic_x<a name='26'></font>
<font color=#447700>!     LOGICAL                     :: symmetric_xs<a name='27'></font>
<font color=#447700>!     LOGICAL                     :: symmetric_xe<a name='28'></font>
<font color=#447700>!     LOGICAL                     :: open_xs<a name='29'></font>
<font color=#447700>!     LOGICAL                     :: open_xe<a name='30'></font>
<font color=#447700>!     LOGICAL                     :: periodic_y<a name='31'></font>
<font color=#447700>!     LOGICAL                     :: symmetric_ys<a name='32'></font>
<font color=#447700>!     LOGICAL                     :: symmetric_ye<a name='33'></font>
<font color=#447700>!     LOGICAL                     :: open_ys<a name='34'></font>
<font color=#447700>!     LOGICAL                     :: open_ye<a name='35'></font>
<font color=#447700>!     LOGICAL                     :: nested<a name='36'></font>
<font color=#447700>!     LOGICAL                     :: specified<a name='37'></font>
<font color=#447700>!     LOGICAL                     :: top_radiation<a name='38'></font>
<font color=#447700>!<a name='39'></font>
<font color=#447700>!   END TYPE bcs<a name='40'></font>
<a name='41'>
<font color=#447700>!  set the bdyzone.  We are hardwiring this here and we'll<a name='42'></font>
<font color=#447700>!  decide later where it should be set and stored<a name='43'></font>
<a name='44'>
   INTEGER, PARAMETER            :: bdyzone = 4<a name='45'>
   INTEGER, PARAMETER            :: bdyzone_x = bdyzone<a name='46'>
   INTEGER, PARAMETER            :: bdyzone_y = bdyzone<a name='47'>
<a name='48'>
<A NAME='STUFF_BDY'><A href='../../html_code/share/module_bc.F.html#STUFF_BDY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='49'>
   <font color=#993300>INTERFACE </font><font color=#cc0000>stuff_bdy</font> <A href='../../call_to/STUFF_BDY.html' TARGET='index'>32</A><a name='50'>
     MODULE PROCEDURE <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_NEW'>stuff_bdy_new</A><A NAME="STUFF_BDY_NEW_1"><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/share/module_bc.F.html#STUFF_BDY_OLD'>stuff_bdy_old</A><A NAME="STUFF_BDY_OLD_1"><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='51'>
   END INTERFACE<a name='52'>
<a name='53'>
<A NAME='STUFF_BDYTEND'><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='54'>
   <font color=#993300>INTERFACE </font><font color=#cc0000>stuff_bdytend</font> <A href='../../call_to/STUFF_BDYTEND.html' TARGET='index'>24</A><a name='55'>
     MODULE PROCEDURE <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_NEW'>stuff_bdytend_new</A><A NAME="STUFF_BDYTEND_NEW_1"><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_OLD'>stuff_bdytend_old</A><A NAME="STUFF_BDYTEND_OLD_1"><A href='../../html_code/share/module_bc.F.html#module_bc.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='56'>
   END INTERFACE<a name='57'>
<a name='58'>
CONTAINS<a name='59'>
<a name='60'>
<A NAME='BOUNDARY_CONDITION_CHECK'><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='61'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>boundary_condition_check</font> ( config_flags, bzone, error, gn ) <A href='../../call_to/BOUNDARY_CONDITION_CHECK.html' TARGET='index'>2</A>,<A href='../../call_from/BOUNDARY_CONDITION_CHECK.html' TARGET='index'>25</A><a name='62'>
<a name='63'>
<font color=#447700>!  this routine checks the boundary condition logicals <a name='64'></font>
<font color=#447700>!  to make sure that the boundary conditions are not over<a name='65'></font>
<font color=#447700>!  or under specified.  The routine also checks that the<a name='66'></font>
<font color=#447700>!  boundary zone is sufficiently sized for the specified<a name='67'></font>
<font color=#447700>!  boundary conditions<a name='68'></font>
<a name='69'>
  IMPLICIT NONE<a name='70'>
<a name='71'>
  TYPE( grid_config_rec_type ) config_flags<a name='72'>
<a name='73'>
  INTEGER, INTENT(IN   ) :: bzone, gn<a name='74'>
  INTEGER, INTENT(INOUT) :: error<a name='75'>
<a name='76'>
<font color=#447700>! local variables<a name='77'></font>
<a name='78'>
  INTEGER :: xs_bc, xe_bc, ys_bc, ye_bc, bzone_min<a name='79'>
  INTEGER :: nprocx, nprocy<a name='80'>
<a name='81'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1006">( 100 , ' checking boundary conditions for grid ' )<a name='82'>
<a name='83'>
  error = 0<a name='84'>
  xs_bc = 0<a name='85'>
  xe_bc = 0<a name='86'>
  ys_bc = 0<a name='87'>
  ye_bc = 0<a name='88'>
<a name='89'>
<font color=#447700>!  sum the number of conditions specified for each lateral boundary.<a name='90'></font>
<font color=#447700>!  obviously, this number should be 1<a name='91'></font>
<a name='92'>
  IF( config_flags%periodic_x ) THEN<a name='93'>
    xs_bc = xs_bc+1<a name='94'>
    xe_bc = xe_bc+1<a name='95'>
  ENDIF<a name='96'>
<a name='97'>
  IF( config_flags%periodic_y ) THEN<a name='98'>
    ys_bc = ys_bc+1<a name='99'>
    ye_bc = ye_bc+1<a name='100'>
  ENDIF<a name='101'>
<a name='102'>
  IF( config_flags%symmetric_xs ) xs_bc = xs_bc + 1<a name='103'>
  IF( config_flags%symmetric_xe ) xe_bc = xe_bc + 1<a name='104'>
  IF( config_flags%open_xs )      xs_bc = xs_bc + 1<a name='105'>
  IF( config_flags%open_xe )      xe_bc = xe_bc + 1<a name='106'>
<a name='107'>
<a name='108'>
  IF( config_flags%symmetric_ys ) ys_bc = ys_bc + 1<a name='109'>
  IF( config_flags%symmetric_ye ) ye_bc = ye_bc + 1<a name='110'>
  IF( config_flags%open_ys )      ys_bc = ys_bc + 1<a name='111'>
  IF( config_flags%open_ye )      ye_bc = ye_bc + 1<a name='112'>
<a name='113'>
  IF( config_flags%nested ) THEN<a name='114'>
     xs_bc = xs_bc + 1<a name='115'>
     xe_bc = xe_bc + 1<a name='116'>
     ys_bc = ys_bc + 1<a name='117'>
     ye_bc = ye_bc + 1<a name='118'>
   ENDIF<a name='119'>
<a name='120'>
  IF( config_flags%specified ) THEN<a name='121'>
     IF( .NOT. config_flags%periodic_x)xs_bc = xs_bc + 1<a name='122'>
     IF( .NOT. config_flags%periodic_x)xe_bc = xe_bc + 1<a name='123'>
     ys_bc = ys_bc + 1<a name='124'>
     ye_bc = ye_bc + 1<a name='125'>
   ENDIF<a name='126'>
<a name='127'>
  IF( config_flags%polar ) THEN<a name='128'>
     ys_bc = ys_bc + 1<a name='129'>
     ye_bc = ye_bc + 1<a name='130'>
   ENDIF<a name='131'>
<a name='132'>
<font color=#447700>!  check the number of conditions for each boundary<a name='133'></font>
<a name='134'>
   IF( (xs_bc /= 1) .or. &amp;<a name='135'>
       (xe_bc /= 1) .or. &amp;<a name='136'>
       (ys_bc /= 1) .or. &amp;<a name='137'>
       (ye_bc /= 1)         ) THEN<a name='138'>
<a name='139'>
     error = 1<a name='140'>
<a name='141'>
     write( wrf_err_message ,*) ' *** Error in boundary condition specification '<a name='142'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1214"> ( wrf_err_message )<a name='143'>
     write( wrf_err_message ,*) ' boundary conditions at xs ', xs_bc<a name='144'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1215"> ( wrf_err_message )<a name='145'>
     write( wrf_err_message ,*) ' boundary conditions at xe ', xe_bc<a name='146'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1216"> ( wrf_err_message )<a name='147'>
     write( wrf_err_message ,*) ' boundary conditions at ys ', ys_bc<a name='148'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1217"> ( wrf_err_message )<a name='149'>
     write( wrf_err_message ,*) ' boundary conditions at ye ', ye_bc<a name='150'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1218"> ( wrf_err_message )<a name='151'>
     write( wrf_err_message ,*) ' boundary conditions logicals are '<a name='152'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1219"> ( wrf_err_message )<a name='153'>
     write( wrf_err_message ,*) ' periodic_x   ',config_flags%periodic_x<a name='154'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1220"> ( wrf_err_message )<a name='155'>
     write( wrf_err_message ,*) ' periodic_y   ',config_flags%periodic_y<a name='156'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1221"> ( wrf_err_message )<a name='157'>
     write( wrf_err_message ,*) ' symmetric_xs ',config_flags%symmetric_xs<a name='158'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1222"> ( wrf_err_message )<a name='159'>
     write( wrf_err_message ,*) ' symmetric_xe ',config_flags%symmetric_xe<a name='160'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1223"> ( wrf_err_message )<a name='161'>
     write( wrf_err_message ,*) ' symmetric_ys ',config_flags%symmetric_ys<a name='162'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1224"> ( wrf_err_message )<a name='163'>
     write( wrf_err_message ,*) ' symmetric_ye ',config_flags%symmetric_ye<a name='164'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1225"> ( wrf_err_message )<a name='165'>
     write( wrf_err_message ,*) ' open_xs      ',config_flags%open_xs<a name='166'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1226"> ( wrf_err_message )<a name='167'>
     write( wrf_err_message ,*) ' open_xe      ',config_flags%open_xe<a name='168'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1227"> ( wrf_err_message )<a name='169'>
     write( wrf_err_message ,*) ' open_ys      ',config_flags%open_ys<a name='170'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1228"> ( wrf_err_message )<a name='171'>
     write( wrf_err_message ,*) ' open_ye      ',config_flags%open_ye<a name='172'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1229"> ( wrf_err_message )<a name='173'>
     write( wrf_err_message ,*) ' polar        ',config_flags%polar<a name='174'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1230"> ( wrf_err_message )<a name='175'>
     write( wrf_err_message ,*) ' nested       ',config_flags%nested<a name='176'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1231"> ( wrf_err_message )<a name='177'>
     write( wrf_err_message ,*) ' specified    ',config_flags%specified<a name='178'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1232"> ( wrf_err_message )<a name='179'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1377">( ' *** Error in boundary condition specification ' )<a name='180'>
<a name='181'>
   ENDIF<a name='182'>
<a name='183'>
<font color=#447700>!  now check to see if boundary zone size is sufficient.<a name='184'></font>
<font color=#447700>!  we could have the necessary boundary zone size be returned<a name='185'></font>
<font color=#447700>!  to the calling routine.<a name='186'></font>
<a name='187'>
   IF( config_flags%periodic_x   .or. &amp;<a name='188'>
       config_flags%periodic_y   .or. &amp;<a name='189'>
       config_flags%symmetric_xs .or. &amp;<a name='190'>
       config_flags%symmetric_xe .or. &amp;<a name='191'>
       config_flags%symmetric_ys .or. &amp;<a name='192'>
       config_flags%symmetric_ye        )  THEN<a name='193'>
<a name='194'>
       bzone_min = MAX( 1,                                  &amp;<a name='195'>
                        (config_flags%h_mom_adv_order+1)/2, &amp;<a name='196'>
                        (config_flags%h_sca_adv_order+1)/2 )<a name='197'>
<a name='198'>
       IF( bzone &lt; bzone_min) THEN  <a name='199'>
<a name='200'>
         error = 2<a name='201'>
         WRITE ( wrf_err_message , * ) ' boundary zone not large enough '<a name='202'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1233"> ( wrf_err_message )<a name='203'>
         WRITE ( wrf_err_message , * ) ' boundary zone specified      ',bzone<a name='204'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1234"> ( wrf_err_message )<a name='205'>
         WRITE ( wrf_err_message , * ) ' minimum boundary zone needed ',bzone_min<a name='206'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_1378"> ( wrf_err_message )<a name='207'>
<a name='208'>
       ENDIF<a name='209'>
   ENDIF<a name='210'>
<a name='211'>
   CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/share/module_bc.F.html#BOUNDARY_CONDITION_CHECK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1007"> ( 100 , ' boundary conditions OK for grid ' )<a name='212'>
<a name='213'>
   END subroutine boundary_condition_check<a name='214'>
<a name='215'>
<font color=#447700>!--------------------------------------------------------------------------<a name='216'></font>
<A NAME='SET_PHYSICAL_BC2D'><A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='217'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_physical_bc2d</font>( dat, variable_in,  &amp; <A href='../../call_to/SET_PHYSICAL_BC2D.html' TARGET='index'>33</A>,<A href='../../call_from/SET_PHYSICAL_BC2D.html' TARGET='index'>2</A><a name='218'>
                                 config_flags,           &amp; <a name='219'>
                                 ids,ide, jds,jde,   &amp; <font color=#447700>! domain dims<a name='220'></font>
                                 ims,ime, jms,jme,   &amp; <font color=#447700>! memory dims<a name='221'></font>
                                 ips,ipe, jps,jpe,   &amp; <font color=#447700>! patch  dims<a name='222'></font>
                                 its,ite, jts,jte   )      <a name='223'>
<a name='224'>
<font color=#447700>!  This subroutine sets the data in the boundary region, by direct<a name='225'></font>
<font color=#447700>!  assignment if possible, for periodic and symmetric (wall)<a name='226'></font>
<font color=#447700>!  boundary conditions.  Currently, we are only doing 1 variable<a name='227'></font>
<font color=#447700>!  at a time - lots of overhead, so maybe this routine can be easily <a name='228'></font>
<font color=#447700>!  inlined later or we could pass multiple variables -<a name='229'></font>
<font color=#447700>!  would probably want a largestep and smallstep version.<a name='230'></font>
<a name='231'>
<font color=#447700>!  15 Jan 99, Dave<a name='232'></font>
<font color=#447700>!  Modified the incoming its,ite,jts,jte to truly be the tile size.<a name='233'></font>
<font color=#447700>!  This required modifying the loop limits when the "istag" or "jstag"<a name='234'></font>
<font color=#447700>!  is used, as this is only required at the end of the domain.<a name='235'></font>
<a name='236'>
      IMPLICIT NONE<a name='237'>
<a name='238'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde<a name='239'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme<a name='240'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe<a name='241'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte<a name='242'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='243'>
<a name='244'>
      CHARACTER                      :: variable<a name='245'>
<a name='246'>
      REAL,  DIMENSION( ims:ime , jms:jme ) :: dat<a name='247'>
      TYPE( grid_config_rec_type ) config_flags<a name='248'>
<a name='249'>
      INTEGER  :: i, j, istag, jstag, itime, istart, iend<a name='250'>
<a name='251'>
      LOGICAL  :: debug, open_bc_copy<a name='252'>
<a name='253'>
<font color=#447700>!------------<a name='254'></font>
<a name='255'>
      debug = .false.<a name='256'>
<a name='257'>
      open_bc_copy = .false.<a name='258'>
<a name='259'>
      variable = variable_in<a name='260'>
      IF ( variable_in .ge. 'A' .and. variable_in .le. 'Z' ) THEN<a name='261'>
        variable = CHAR( ICHAR(variable_in) - ICHAR('A') + ICHAR('a') )<a name='262'>
      ENDIF<a name='263'>
      IF ((variable == 'u') .or. (variable == 'v') .or.  &amp;<a name='264'>
          (variable == 'w') .or. (variable == 't') .or.  &amp;<a name='265'>
          (variable == 'x') .or. (variable == 'y') .or.  &amp;<a name='266'>
          (variable == 'r') .or. (variable == 'p') ) open_bc_copy = .true.<a name='267'>
<a name='268'>
<font color=#447700>!  begin, first set a staggering variable<a name='269'></font>
<a name='270'>
      istag = -1<a name='271'>
      jstag = -1<a name='272'>
<a name='273'>
      IF ((variable == 'u') .or. (variable == 'x')) istag = 0<a name='274'>
      IF ((variable == 'v') .or. (variable == 'y')) jstag = 0<a name='275'>
<a name='276'>
      if(debug) then<a name='277'>
        write(6,*) ' in bc2d, var is ',variable, istag, jstag<a name='278'>
        write(6,*) ' b.cs are ',  &amp;<a name='279'>
      config_flags%periodic_x,  &amp;<a name='280'>
      config_flags%periodic_y<a name='281'>
      end if<a name='282'>
      <a name='283'>
      IF ( variable == 'd' ) then  <font color=#447700>!JDM<a name='284'></font>
         istag = 0<a name='285'>
         jstag = 0<a name='286'>
      ENDIF<a name='287'>
      IF ( variable == 'e' ) then  <font color=#447700>!JDM<a name='288'></font>
         istag = 0<a name='289'>
      ENDIF<a name='290'>
      IF ( variable == 'f' ) then  <font color=#447700>!JDM<a name='291'></font>
         jstag = 0<a name='292'>
      ENDIF<a name='293'>
<a name='294'>
<font color=#447700>!  periodic conditions.<a name='295'></font>
<font color=#447700>!  note, patch must cover full range in periodic dir, or else<a name='296'></font>
<font color=#447700>!  its intra-patch communication that is handled elsewheres.<a name='297'></font>
<font color=#447700>!  symmetry conditions can always be handled here, because no<a name='298'></font>
<font color=#447700>!  outside patch communication is needed<a name='299'></font>
<a name='300'>
      periodicity_x:  IF( ( config_flags%periodic_x ) ) THEN <a name='301'>
        IF ( ( ids == ips ) .and.  ( ide == ipe ) ) THEN  <font color=#447700>! test if east and west both on-processor <a name='302'></font>
          IF ( its == ids ) THEN<a name='303'>
<a name='304'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='305'>
            DO i = 0,-(bdyzone-1),-1<a name='306'>
              dat(ids+i-1,j) = dat(ide+i-1,j)<a name='307'>
            ENDDO<a name='308'>
            ENDDO<a name='309'>
<a name='310'>
          ENDIF<a name='311'>
<a name='312'>
          IF ( ite == ide ) THEN<a name='313'>
<a name='314'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='315'>
<font color=#447700>!!          DO i = 1 , bdyzone<a name='316'></font>
            DO i = -istag , bdyzone<a name='317'>
              dat(ide+i+istag,j) = dat(ids+i+istag,j)<a name='318'>
            ENDDO<a name='319'>
            ENDDO<a name='320'>
<a name='321'>
          ENDIF<a name='322'>
        ENDIF<a name='323'>
<a name='324'>
      ELSE <a name='325'>
<a name='326'>
        symmetry_xs: IF( ( config_flags%symmetric_xs ) .and.  &amp;<a name='327'>
                         ( its == ids )                  )  THEN<a name='328'>
<a name='329'>
          IF ( (variable /= 'u') .and. (variable /= 'x') ) THEN<a name='330'>
<a name='331'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='332'>
            DO i = 1, bdyzone<a name='333'>
              dat(ids-i,j) = dat(ids+i-1,j) <font color=#447700>!  here, dat(0) = dat(1), etc<a name='334'></font>
            ENDDO                             <font color=#447700>!  symmetry about dat(0.5) (u=0 pt)<a name='335'></font>
            ENDDO<a name='336'>
<a name='337'>
          ELSE<a name='338'>
<a name='339'>
            IF( variable == 'u' ) THEN<a name='340'>
<a name='341'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='342'>
              DO i = 0, bdyzone-1<a name='343'>
                dat(ids-i,j) = - dat(ids+i,j) <font color=#447700>! here, u(0) = - u(2), etc<a name='344'></font>
              ENDDO                             <font color=#447700>!  normal b.c symmetry at u(1)<a name='345'></font>
              ENDDO<a name='346'>
<a name='347'>
            ELSE<a name='348'>
<a name='349'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='350'>
              DO i = 0, bdyzone-1<a name='351'>
                dat(ids-i,j) =   dat(ids+i,j) <font color=#447700>! here, phi(0) = <A href='../../html_code/phys/module_ra_cam_support.F.html#PHI'>phi</A><A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHI_2">(2), etc<a name='352'></font>
              ENDDO                             <font color=#447700>!  normal b.c symmetry at phi(1)<a name='353'></font>
              ENDDO<a name='354'>
<a name='355'>
            END IF<a name='356'>
<a name='357'>
          ENDIF<a name='358'>
<a name='359'>
        ENDIF symmetry_xs<a name='360'>
<a name='361'>
<a name='362'>
<font color=#447700>!  now the symmetry boundary at xe<a name='363'></font>
<a name='364'>
        symmetry_xe: IF( ( config_flags%symmetric_xe ) .and.  &amp;<a name='365'>
                         ( ite == ide )                  )  THEN<a name='366'>
<a name='367'>
          IF ( (variable /= 'u') .and. (variable /= 'x') ) THEN<a name='368'>
<a name='369'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='370'>
            DO i = 1, bdyzone<a name='371'>
              dat(ide+i-1,j) = dat(ide-i,j)  <font color=#447700>!  sym. about dat(ide-0.5)<a name='372'></font>
            ENDDO<a name='373'>
            ENDDO<a name='374'>
<a name='375'>
          ELSE<a name='376'>
<a name='377'>
            IF (variable == 'u' ) THEN<a name='378'>
<a name='379'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='380'>
              DO i = 0, bdyzone-1<a name='381'>
                dat(ide+i,j) = - dat(ide-i,j)  <font color=#447700>! u(ide+1) = - u(ide-1), etc.<a name='382'></font>
              ENDDO<a name='383'>
              ENDDO<a name='384'>
<a name='385'>
<a name='386'>
            ELSE<a name='387'>
<a name='388'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='389'>
              DO i = 0, bdyzone-1<a name='390'>
                dat(ide+i,j) = dat(ide-i,j)  <font color=#447700>!  phi(ide+1) = <A href='../../html_code/phys/module_ra_cam_support.F.html#PHI'>phi</A><A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC2D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHI_3">(ide-1), etc.<a name='391'></font>
              ENDDO<a name='392'>
              ENDDO<a name='393'>
<a name='394'>
            END IF<a name='395'>
<a name='396'>
          END IF <a name='397'>
<a name='398'>
        END IF symmetry_xe<a name='399'>
<a name='400'>
<a name='401'>
<font color=#447700>!  set open b.c in X copy into boundary zone here.  WCS, 19 March 2000<a name='402'></font>
<a name='403'>
        open_xs: IF( ( config_flags%open_xs   .or. &amp;<a name='404'>
                       config_flags%specified .or. &amp;<a name='405'>
                       config_flags%nested            ) .and.  &amp;<a name='406'>
                         ( its == ids ) .and. open_bc_copy  )  THEN<a name='407'>
<a name='408'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='409'>
              dat(ids-1,j) = dat(ids,j) <font color=#447700>!  here, dat(0) = dat(1)<a name='410'></font>
              dat(ids-2,j) = dat(ids,j)<a name='411'>
              dat(ids-3,j) = dat(ids,j)<a name='412'>
            ENDDO<a name='413'>
<a name='414'>
        ENDIF open_xs<a name='415'>
<a name='416'>
<a name='417'>
<font color=#447700>!  now the open boundary copy at xe<a name='418'></font>
<a name='419'>
        open_xe: IF( ( config_flags%open_xe   .or. &amp;<a name='420'>
                       config_flags%specified .or. &amp;<a name='421'>
                       config_flags%nested            ) .and.  &amp;<a name='422'>
                          ( ite == ide ) .and. open_bc_copy  )  THEN<a name='423'>
<a name='424'>
          IF ( variable /= 'u' .and. variable /= 'x') THEN<a name='425'>
<a name='426'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='427'>
              dat(ide  ,j) = dat(ide-1,j) <a name='428'>
              dat(ide+1,j) = dat(ide-1,j) <a name='429'>
              dat(ide+2,j) = dat(ide-1,j) <a name='430'>
            ENDDO<a name='431'>
<a name='432'>
          ELSE<a name='433'>
<a name='434'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='435'>
              dat(ide+1,j) = dat(ide,j)<a name='436'>
              dat(ide+2,j) = dat(ide,j)<a name='437'>
              dat(ide+3,j) = dat(ide,j)<a name='438'>
            ENDDO<a name='439'>
<a name='440'>
          END IF <a name='441'>
<a name='442'>
        END IF open_xe<a name='443'>
<a name='444'>
<font color=#447700>!  end open b.c in X copy into boundary zone addition.  WCS, 19 March 2000<a name='445'></font>
<a name='446'>
      END IF periodicity_x<a name='447'>
<a name='448'>
<font color=#447700>!  same procedure in y<a name='449'></font>
<a name='450'>
<font color=#447700>!  Set the starting and ending loop indexes in the 'i' direction, so that<a name='451'></font>
<font color=#447700>!  halo cells on the edge of the domain are also updated.  Begin with a default <a name='452'></font>
<font color=#447700>!  start and end index for inner tiles, and then modify if the tile is on the<a name='453'></font>
<font color=#447700>!  edge of the domain.  <a name='454'></font>
<a name='455'>
        istart = MAX(ids, its-1)<a name='456'>
        iend = MIN(ite+1, ide+istag)<a name='457'>
        IF ( its .eq. ids) THEN<a name='458'>
          istart = ims<a name='459'>
        END IF<a name='460'>
        IF ( ite .eq. ide) THEN<a name='461'>
          iend = ime<a name='462'>
        END IF<a name='463'>
<a name='464'>
      periodicity_y:  IF( ( config_flags%periodic_y ) ) THEN<a name='465'>
        IF ( ( jds == jps ) .and. ( jde == jpe ) )  THEN    <font color=#447700>! test of both north and south on processor<a name='466'></font>
<a name='467'>
          IF( jts == jds ) then<a name='468'>
<a name='469'>
            DO j = 0, -(bdyzone-1), -1<a name='470'>
              <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='471'></font>
              DO i = istart, iend<a name='472'>
                dat(i,jds+j-1) = dat(i,jde+j-1)<a name='473'>
              ENDDO<a name='474'>
            ENDDO<a name='475'>
<a name='476'>
          END IF<a name='477'>
<a name='478'>
          IF( jte == jde ) then<a name='479'>
<a name='480'>
            DO j = -jstag, bdyzone<a name='481'>
              <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='482'></font>
              DO i = istart, iend<a name='483'>
                dat(i,jde+j+jstag) = dat(i,jds+j+jstag)<a name='484'>
              ENDDO<a name='485'>
            ENDDO<a name='486'>
<a name='487'>
          END IF<a name='488'>
<a name='489'>
        END IF<a name='490'>
<a name='491'>
      ELSE<a name='492'>
<a name='493'>
        symmetry_ys: IF( ( config_flags%symmetric_ys ) .and.  &amp;<a name='494'>
                         ( jts == jds)                   )  THEN<a name='495'>
<a name='496'>
          IF ( (variable /= 'v') .and. (variable /= 'y') ) THEN<a name='497'>
<a name='498'>
            DO j = 1, bdyzone<a name='499'>
              <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='500'></font>
              DO i = istart, iend<a name='501'>
                dat(i,jds-j) = dat(i,jds+j-1) <a name='502'>
              ENDDO<a name='503'>
            ENDDO<a name='504'>
<a name='505'>
          ELSE<a name='506'>
<a name='507'>
            IF (variable == 'v') THEN<a name='508'>
<a name='509'>
              DO j = 1, bdyzone<a name='510'>
                <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='511'></font>
                DO i = istart, iend<a name='512'>
                  dat(i,jds-j) = - dat(i,jds+j) <a name='513'>
                ENDDO              <a name='514'>
              ENDDO<a name='515'>
<a name='516'>
            ELSE<a name='517'>
<a name='518'>
              DO j = 1, bdyzone<a name='519'>
                <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='520'></font>
                DO i = istart, iend<a name='521'>
                  dat(i,jds-j) = dat(i,jds+j) <a name='522'>
                ENDDO              <a name='523'>
              ENDDO<a name='524'>
<a name='525'>
            END IF<a name='526'>
<a name='527'>
          ENDIF<a name='528'>
<a name='529'>
        ENDIF symmetry_ys<a name='530'>
<a name='531'>
<font color=#447700>!  now the symmetry boundary at ye<a name='532'></font>
<a name='533'>
        symmetry_ye: IF( ( config_flags%symmetric_ye ) .and.  &amp;<a name='534'>
                         ( jte == jde )                  )  THEN<a name='535'>
<a name='536'>
          IF ( (variable /= 'v') .and. (variable /= 'y') ) THEN<a name='537'>
<a name='538'>
            DO j = 1, bdyzone<a name='539'>
              <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='540'></font>
              DO i = istart, iend<a name='541'>
                dat(i,jde+j-1) = dat(i,jde-j) <a name='542'>
              ENDDO                               <a name='543'>
            ENDDO<a name='544'>
<a name='545'>
          ELSE<a name='546'>
<a name='547'>
            IF (variable == 'v' ) THEN<a name='548'>
<a name='549'>
              DO j = 1, bdyzone<a name='550'>
                <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='551'></font>
                DO i = istart, iend<a name='552'>
                  dat(i,jde+j) = - dat(i,jde-j)    <font color=#447700>! bugfix: changed jds on rhs to jde , JM 20020410<a name='553'></font>
                ENDDO                               <a name='554'>
              ENDDO<a name='555'>
<a name='556'>
            ELSE<a name='557'>
<a name='558'>
              DO j = 1, bdyzone<a name='559'>
                <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='560'></font>
                DO i = istart, iend<a name='561'>
                  dat(i,jde+j) = dat(i,jde-j)<a name='562'>
                ENDDO                               <a name='563'>
              ENDDO<a name='564'>
<a name='565'>
            END IF<a name='566'>
<a name='567'>
          ENDIF<a name='568'>
<a name='569'>
        END IF symmetry_ye<a name='570'>
<a name='571'>
<font color=#447700>!  set open b.c in Y copy into boundary zone here.  WCS, 19 March 2000<a name='572'></font>
<a name='573'>
        open_ys: IF( ( config_flags%open_ys   .or. &amp;<a name='574'>
                       config_flags%polar     .or. &amp;<a name='575'>
                       config_flags%specified .or. &amp;<a name='576'>
                       config_flags%nested            ) .and.  &amp;<a name='577'>
                         ( jts == jds) .and. open_bc_copy )  THEN<a name='578'>
<a name='579'>
            <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='580'></font>
            DO i = istart, iend<a name='581'>
              dat(i,jds-1) = dat(i,jds) <a name='582'>
              dat(i,jds-2) = dat(i,jds) <a name='583'>
              dat(i,jds-3) = dat(i,jds) <a name='584'>
            ENDDO<a name='585'>
<a name='586'>
        ENDIF open_ys<a name='587'>
<a name='588'>
<font color=#447700>!  now the open boundary copy at ye<a name='589'></font>
<a name='590'>
        open_ye: IF( ( config_flags%open_ye   .or. &amp;<a name='591'>
                       config_flags%polar     .or. &amp;<a name='592'>
                       config_flags%specified .or. &amp;<a name='593'>
                       config_flags%nested            ) .and.  &amp;<a name='594'>
                         ( jte == jde ) .and. open_bc_copy )  THEN<a name='595'>
<a name='596'>
          IF  (variable /= 'v' .and. variable /= 'y' ) THEN<a name='597'>
<a name='598'>
            <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='599'></font>
            DO i = istart, iend<a name='600'>
              dat(i,jde  ) = dat(i,jde-1) <a name='601'>
              dat(i,jde+1) = dat(i,jde-1) <a name='602'>
              dat(i,jde+2) = dat(i,jde-1) <a name='603'>
            ENDDO                               <a name='604'>
<a name='605'>
          ELSE<a name='606'>
<a name='607'>
            <font color=#447700>!DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='608'></font>
            DO i = istart, iend<a name='609'>
              dat(i,jde+1) = dat(i,jde) <a name='610'>
              dat(i,jde+2) = dat(i,jde) <a name='611'>
              dat(i,jde+3) = dat(i,jde) <a name='612'>
            ENDDO                               <a name='613'>
<a name='614'>
          ENDIF<a name='615'>
<a name='616'>
        END IF open_ye<a name='617'>
      <a name='618'>
<font color=#447700>!  end open b.c in Y copy into boundary zone addition.  WCS, 19 March 2000<a name='619'></font>
<a name='620'>
      END IF periodicity_y<a name='621'>
<a name='622'>
<font color=#447700>!  fix corners for doubly periodic domains<a name='623'></font>
<a name='624'>
      IF ( config_flags%periodic_x .and. config_flags%periodic_y &amp;<a name='625'>
           .and. (ids == ips) .and. (ide == ipe)                 &amp;<a name='626'>
           .and. (jds == jps) .and. (jde == jpe)                   ) THEN<a name='627'>
<a name='628'>
         IF ( (its == ids) .and. (jts == jds) ) THEN  <font color=#447700>! lower left corner fill<a name='629'></font>
           DO j = 0, -(bdyzone-1), -1<a name='630'>
           DO i = 0, -(bdyzone-1), -1<a name='631'>
             dat(ids+i-1,jds+j-1) = dat(ide+i-1,jde+j-1)<a name='632'>
           ENDDO<a name='633'>
           ENDDO<a name='634'>
         END IF<a name='635'>
<a name='636'>
         IF ( (ite == ide) .and. (jts == jds) ) THEN  <font color=#447700>! lower right corner fill<a name='637'></font>
           DO j = 0, -(bdyzone-1), -1<a name='638'>
           DO i = 1, bdyzone<a name='639'>
             dat(ide+i+istag,jds+j-1) = dat(ids+i+istag,jde+j-1)<a name='640'>
           ENDDO<a name='641'>
           ENDDO<a name='642'>
         END IF<a name='643'>
<a name='644'>
         IF ( (ite == ide) .and. (jte == jde) ) THEN  <font color=#447700>! upper right corner fill<a name='645'></font>
           DO j = 1, bdyzone<a name='646'>
           DO i = 1, bdyzone<a name='647'>
             dat(ide+i+istag,jde+j+jstag) = dat(ids+i+istag,jds+j+jstag)<a name='648'>
           ENDDO<a name='649'>
           ENDDO<a name='650'>
         END IF<a name='651'>
<a name='652'>
         IF ( (its == ids) .and. (jte == jde) ) THEN  <font color=#447700>! upper left corner fill<a name='653'></font>
           DO j = 1, bdyzone<a name='654'>
           DO i = 0, -(bdyzone-1), -1<a name='655'>
             dat(ids+i-1,jde+j+jstag) = dat(ide+i-1,jds+j+jstag)<a name='656'>
           ENDDO<a name='657'>
           ENDDO<a name='658'>
         END IF<a name='659'>
<a name='660'>
       END IF<a name='661'>
<a name='662'>
   END SUBROUTINE set_physical_bc2d<a name='663'>
<a name='664'>
<font color=#447700>!-----------------------------------<a name='665'></font>
<a name='666'>
<A NAME='SET_PHYSICAL_BC3D'><A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='667'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_physical_bc3d</font>( dat, variable_in,        &amp; <A href='../../call_to/SET_PHYSICAL_BC3D.html' TARGET='index'>146</A>,<A href='../../call_from/SET_PHYSICAL_BC3D.html' TARGET='index'>1</A><a name='668'>
                               config_flags,                   &amp; <a name='669'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='670'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='671'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='672'></font>
                               its,ite, jts,jte, kts,kte )<a name='673'>
<a name='674'>
<font color=#447700>!  This subroutine sets the data in the boundary region, by direct<a name='675'></font>
<font color=#447700>!  assignment if possible, for periodic and symmetric (wall)<a name='676'></font>
<font color=#447700>!  boundary conditions.  Currently, we are only doing 1 variable<a name='677'></font>
<font color=#447700>!  at a time - lots of overhead, so maybe this routine can be easily <a name='678'></font>
<font color=#447700>!  inlined later or we could pass multiple variables -<a name='679'></font>
<font color=#447700>!  would probably want a largestep and smallstep version.<a name='680'></font>
<a name='681'>
<font color=#447700>!  15 Jan 99, Dave<a name='682'></font>
<font color=#447700>!  Modified the incoming its,ite,jts,jte to truly be the tile size.<a name='683'></font>
<font color=#447700>!  This required modifying the loop limits when the "istag" or "jstag"<a name='684'></font>
<font color=#447700>!  is used, as this is only required at the end of the domain.<a name='685'></font>
<a name='686'>
      IMPLICIT NONE<a name='687'>
<a name='688'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='689'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='690'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='691'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='692'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='693'>
<a name='694'>
      CHARACTER                      :: variable<a name='695'>
<a name='696'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ) :: dat<a name='697'>
      TYPE( grid_config_rec_type ) config_flags<a name='698'>
<a name='699'>
      INTEGER  :: i, j, k, istag, jstag, itime, k_end<a name='700'>
<a name='701'>
      LOGICAL  :: debug, open_bc_copy<a name='702'>
<a name='703'>
<font color=#447700>!------------<a name='704'></font>
<a name='705'>
      debug = .false.<a name='706'>
<a name='707'>
      open_bc_copy = .false.<a name='708'>
<a name='709'>
      variable = variable_in<a name='710'>
      IF ( variable_in .ge. 'A' .and. variable_in .le. 'Z' ) THEN<a name='711'>
        variable = CHAR( ICHAR(variable_in) - ICHAR('A') + ICHAR('a') )<a name='712'>
      ENDIF<a name='713'>
<a name='714'>
      IF ((variable == 'u') .or. (variable == 'v') .or.     &amp;<a name='715'>
          (variable == 'w') .or. (variable == 't') .or.     &amp;<a name='716'>
          (variable == 'd') .or. (variable == 'e') .or. &amp;<a name='717'>
          (variable == 'x') .or. (variable == 'y') .or. &amp;<a name='718'>
          (variable == 'f') .or. (variable == 'r') .or. &amp;<a name='719'>
          (variable == 'p')                        ) open_bc_copy = .true.<a name='720'>
<a name='721'>
<font color=#447700>!  begin, first set a staggering variable<a name='722'></font>
<a name='723'>
      istag = -1<a name='724'>
      jstag = -1<a name='725'>
      k_end = max(1,min(kde-1,kte))<a name='726'>
<a name='727'>
<a name='728'>
      IF ((variable == 'u') .or. (variable == 'x')) istag = 0<a name='729'>
      IF ((variable == 'v') .or. (variable == 'y')) jstag = 0<a name='730'>
      IF ((variable == 'd') .or. (variable == 'xy')) then<a name='731'>
         istag = 0<a name='732'>
         jstag = 0<a name='733'>
      ENDIF<a name='734'>
      IF ((variable == 'e') ) then<a name='735'>
         istag = 0<a name='736'>
         k_end = min(kde,kte)<a name='737'>
      ENDIF<a name='738'>
<a name='739'>
      IF ((variable == 'f') ) then<a name='740'>
         jstag = 0<a name='741'>
         k_end = min(kde,kte)<a name='742'>
      ENDIF<a name='743'>
<a name='744'>
      IF ( variable == 'w')  k_end = min(kde,kte)<a name='745'>
<a name='746'>
<font color=#447700>!      k_end = kte<a name='747'></font>
<a name='748'>
      if(debug) then<a name='749'>
        write(6,*) ' in bc, var is ',variable, istag, jstag, kte, k_end<a name='750'>
        write(6,*) ' b.cs are ',  &amp;<a name='751'>
      config_flags%periodic_x,  &amp;<a name='752'>
      config_flags%periodic_y<a name='753'>
      end if<a name='754'>
      <a name='755'>
<a name='756'>
<a name='757'>
<font color=#447700>!  periodic conditions.<a name='758'></font>
<font color=#447700>!  note, patch must cover full range in periodic dir, or else<a name='759'></font>
<font color=#447700>!  its intra-patch communication that is handled elsewheres.<a name='760'></font>
<font color=#447700>!  symmetry conditions can always be handled here, because no<a name='761'></font>
<font color=#447700>!  outside patch communication is needed<a name='762'></font>
<a name='763'>
      periodicity_x:  IF( ( config_flags%periodic_x ) ) THEN<a name='764'>
<a name='765'>
        IF ( ( ids == ips ) .and. ( ide == ipe ) ) THEN  <font color=#447700>! test if both east and west on-processor<a name='766'></font>
          IF ( its == ids ) THEN<a name='767'>
<a name='768'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='769'>
            DO k = kts, k_end<a name='770'>
            DO i = 0,-(bdyzone-1),-1<a name='771'>
              dat(ids+i-1,k,j) = dat(ide+i-1,k,j)<a name='772'>
            ENDDO<a name='773'>
            ENDDO<a name='774'>
            ENDDO<a name='775'>
<a name='776'>
          ENDIF<a name='777'>
<a name='778'>
<a name='779'>
          IF ( ite == ide ) THEN<a name='780'>
<a name='781'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='782'>
            DO k = kts, k_end<a name='783'>
            DO i = -istag , bdyzone<a name='784'>
              dat(ide+i+istag,k,j) = dat(ids+i+istag,k,j)<a name='785'>
            ENDDO<a name='786'>
            ENDDO<a name='787'>
            ENDDO<a name='788'>
<a name='789'>
          ENDIF<a name='790'>
<a name='791'>
        ENDIF<a name='792'>
<a name='793'>
      ELSE <a name='794'>
<a name='795'>
        symmetry_xs: IF( ( config_flags%symmetric_xs ) .and.  &amp;<a name='796'>
                         ( its == ids )                  )  THEN<a name='797'>
<a name='798'>
          IF ( (variable /= 'u') .and. (variable /= 'x') ) THEN<a name='799'>
<a name='800'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='801'>
            DO k = kts, k_end<a name='802'>
            DO i = 1, bdyzone<a name='803'>
              dat(ids-i,k,j) = dat(ids+i-1,k,j) <font color=#447700>!  here, dat(0) = dat(1), etc<a name='804'></font>
            ENDDO                                 <font color=#447700>!  symmetry about dat(0.5) (u = 0 pt)<a name='805'></font>
            ENDDO<a name='806'>
            ENDDO<a name='807'>
<a name='808'>
          ELSE<a name='809'>
<a name='810'>
            IF ( variable == 'u' ) THEN<a name='811'>
<a name='812'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='813'>
              DO k = kts, k_end<a name='814'>
              DO i = 1, bdyzone<a name='815'>
                dat(ids-i,k,j) = - dat(ids+i,k,j) <font color=#447700>! here, u(0) = - u(2), etc<a name='816'></font>
              ENDDO                                 <font color=#447700>!  normal b.c symmetry at u(1)<a name='817'></font>
              ENDDO<a name='818'>
              ENDDO<a name='819'>
<a name='820'>
            ELSE<a name='821'>
<a name='822'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='823'>
              DO k = kts, k_end<a name='824'>
              DO i = 1, bdyzone<a name='825'>
                dat(ids-i,k,j) = dat(ids+i,k,j) <font color=#447700>! here, phi(0) = <A href='../../html_code/phys/module_ra_cam_support.F.html#PHI'>phi</A><A href='../../html_code/share/module_bc.F.html#SET_PHYSICAL_BC3D' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHI_4">(2), etc<a name='826'></font>
              ENDDO                               <font color=#447700>!  normal b.c symmetry at phi(1)<a name='827'></font>
              ENDDO<a name='828'>
              ENDDO<a name='829'>
<a name='830'>
            END IF<a name='831'>
<a name='832'>
          ENDIF<a name='833'>
<a name='834'>
        ENDIF symmetry_xs<a name='835'>
<a name='836'>
<a name='837'>
<font color=#447700>!  now the symmetry boundary at xe<a name='838'></font>
<a name='839'>
        symmetry_xe: IF( ( config_flags%symmetric_xe ) .and.  &amp;<a name='840'>
                         ( ite == ide )                  )  THEN<a name='841'>
<a name='842'>
          IF ( (variable /= 'u') .and. (variable /= 'x') ) THEN<a name='843'>
<a name='844'>
            DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='845'>
            DO k = kts, k_end<a name='846'>
            DO i = 1, bdyzone<a name='847'>
              dat(ide+i-1,k,j) = dat(ide-i,k,j)  <font color=#447700>!  sym. about dat(ide-0.5)<a name='848'></font>
            ENDDO<a name='849'>
            ENDDO<a name='850'>
            ENDDO<a name='851'>
<a name='852'>
          ELSE<a name='853'>
<a name='854'>
            IF (variable == 'u') THEN<a name='855'>
<a name='856'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='857'>
              DO k = kts, k_end<a name='858'>
              DO i = 1, bdyzone<a name='859'>
                dat(ide+i,k,j) = - dat(ide-i,k,j)  <font color=#447700>! u(ide+1) = - u(ide-1), etc.<a name='860'></font>
              ENDDO<a name='861'>
              ENDDO<a name='862'>
              ENDDO<a name='863'>
<a name='864'>
            ELSE<a name='865'>
<a name='866'>
              DO j = MAX(jds,jts-1), MIN(jte+1,jde+jstag)<a name='867'>
              DO k = kts, k_end<a name='868'>
              DO i = 1, bdyzone<a name='869'>
                dat(ide+i,k,j) = dat(ide-i,k,j)  <font color=#447700>! phi(ide+1) = - phi(ide-1), etc.<a name='870'></font>
              ENDDO<a name='871'>
              ENDDO<a name='872'>
              ENDDO<a name='873'>
<a name='874'>
             END IF<a name='875'>
<a name='876'>
          END IF <a name='877'>
<a name='878'>
        END IF symmetry_xe<a name='879'>
<a name='880'>
<font color=#447700>!  set open b.c in X copy into boundary zone here.  WCS, 19 March 2000<a name='881'></font>
<a name='882'>
        open_xs: IF( ( config_flags%open_xs   .or. &amp;<a name='883'>
                       config_flags%specified .or. &amp;<a name='884'>
                       config_flags%nested            ) .and.  &amp;<a name='885'>
                         ( its == ids ) .and. open_bc_copy  )  THEN<a name='886'>
<a name='887'>
            DO j = jts-bdyzone, MIN(jte,jde+jstag)+bdyzone<a name='888'>
#if defined(INTEL_ALIGN64)<a name='889'>
<font color=#447700>!DEC$ ASSUME_ALIGNED dat:64<a name='890'></font>
<font color=#447700>!DEC$ UNROLL(4)<a name='891'></font>
<font color=#447700>!DEC$ IVDEP<a name='892'></font>
#endif<a name='893'>
            DO k = kts, k_end<a name='894'>
              dat(ids-1,k,j) = dat(ids,k,j) <font color=#447700>!  here, dat(0) = dat(1), etc<a name='895'></font>
              dat(ids-2,k,j) = dat(ids,k,j)<a name='896'>
              dat(ids-3,k,j) = dat(ids,k,j)<a name='897'>
            ENDDO<a name='898'>
            ENDDO<a name='899'>
<a name='900'>
        ENDIF open_xs<a name='901'>
<a name='902'>
<a name='903'>
<font color=#447700>!  now the open_xe boundary copy <a name='904'></font>
<a name='905'>
        open_xe: IF( ( config_flags%open_xe   .or. &amp;<a name='906'>
                       config_flags%specified .or. &amp;<a name='907'>
                       config_flags%nested            ) .and.  &amp;<a name='908'>
                         ( ite == ide ) .and. open_bc_copy )  THEN<a name='909'>
<a name='910'>
          IF (variable /= 'u' .and. variable /= 'x' ) THEN<a name='911'>
<a name='912'>
            DO j = jts-bdyzone, MIN(jte,jde+jstag)+bdyzone<a name='913'>
#if defined(INTEL_ALIGN64)<a name='914'>
<font color=#447700>!DEC$ ASSUME_ALIGNED dat:64<a name='915'></font>
<font color=#447700>!DEC$ UNROLL(4)<a name='916'></font>
<font color=#447700>!DEC$ IVDEP<a name='917'></font>
#endif<a name='918'>
            DO k = kts, k_end<a name='919'>
              dat(ide  ,k,j) = dat(ide-1,k,j)<a name='920'>
              dat(ide+1,k,j) = dat(ide-1,k,j)<a name='921'>
              dat(ide+2,k,j) = dat(ide-1,k,j)<a name='922'>
            ENDDO<a name='923'>
            ENDDO<a name='924'>
<a name='925'>
          ELSE<a name='926'>
<a name='927'>
<font color=#447700>!!!!!!! I am not sure about this one!  JM 20020402<a name='928'></font>
            DO j = MAX(jds,jts-1)-bdyzone, MIN(jte+1,jde+jstag)+bdyzone<a name='929'>
            DO k = kts, k_end<a name='930'>
              dat(ide+1,k,j) = dat(ide,k,j)<a name='931'>
              dat(ide+2,k,j) = dat(ide,k,j)<a name='932'>
              dat(ide+3,k,j) = dat(ide,k,j)<a name='933'>
            ENDDO<a name='934'>
            ENDDO<a name='935'>
<a name='936'>
          END IF <a name='937'>
<a name='938'>
        END IF open_xe<a name='939'>
<a name='940'>
<font color=#447700>!  end open b.c in X copy into boundary zone addition.  WCS, 19 March 2000<a name='941'></font>
<a name='942'>
      END IF periodicity_x<a name='943'>
<a name='944'>
<font color=#447700>!  same procedure in y<a name='945'></font>
<a name='946'>
      periodicity_y:  IF( ( config_flags%periodic_y ) ) THEN<a name='947'>
        IF ( ( jds == jps ) .and. ( jde == jpe ) )  THEN      <font color=#447700>! test if both north and south on processor<a name='948'></font>
          IF( jts == jds ) then<a name='949'>
<a name='950'>
            DO j = 0, -(bdyzone-1), -1<a name='951'>
            DO k = kts, k_end<a name='952'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='953'>
              dat(i,k,jds+j-1) = dat(i,k,jde+j-1)<a name='954'>
            ENDDO<a name='955'>
            ENDDO<a name='956'>
            ENDDO<a name='957'>
<a name='958'>
          END IF<a name='959'>
<a name='960'>
          IF( jte == jde ) then<a name='961'>
<a name='962'>
            DO j = -jstag, bdyzone<a name='963'>
            DO k = kts, k_end<a name='964'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='965'>
              dat(i,k,jde+j+jstag) = dat(i,k,jds+j+jstag)<a name='966'>
            ENDDO<a name='967'>
            ENDDO<a name='968'>
            ENDDO<a name='969'>
<a name='970'>
          END IF<a name='971'>
<a name='972'>
        END IF<a name='973'>
<a name='974'>
      ELSE<a name='975'>
<a name='976'>
        symmetry_ys: IF( ( config_flags%symmetric_ys ) .and.  &amp;<a name='977'>
                         ( jts == jds)                   )  THEN<a name='978'>
<a name='979'>
          IF ( (variable /= 'v') .and. (variable /= 'y') ) THEN<a name='980'>
<a name='981'>
            DO j = 1, bdyzone<a name='982'>
            DO k = kts, k_end<a name='983'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='984'>
              dat(i,k,jds-j) = dat(i,k,jds+j-1) <a name='985'>
            ENDDO                               <a name='986'>
            ENDDO<a name='987'>
            ENDDO<a name='988'>
<a name='989'>
          ELSE<a name='990'>
<a name='991'>
            IF (variable == 'v') THEN<a name='992'>
<a name='993'>
              DO j = 1, bdyzone<a name='994'>
              DO k = kts, k_end<a name='995'>
              DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='996'>
                dat(i,k,jds-j) = - dat(i,k,jds+j) <a name='997'>
              ENDDO              <a name='998'>
              ENDDO<a name='999'>
              ENDDO<a name='1000'>
<a name='1001'>
            ELSE<a name='1002'>
<a name='1003'>
              DO j = 1, bdyzone<a name='1004'>
              DO k = kts, k_end<a name='1005'>
              DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1006'>
                dat(i,k,jds-j) = dat(i,k,jds+j) <a name='1007'>
              ENDDO              <a name='1008'>
              ENDDO<a name='1009'>
              ENDDO<a name='1010'>
<a name='1011'>
            END IF<a name='1012'>
<a name='1013'>
          ENDIF<a name='1014'>
<a name='1015'>
        ENDIF symmetry_ys<a name='1016'>
<a name='1017'>
<font color=#447700>!  now the symmetry boundary at ye<a name='1018'></font>
<a name='1019'>
        symmetry_ye: IF( ( config_flags%symmetric_ye ) .and.  &amp;<a name='1020'>
                         ( jte == jde )                  )  THEN<a name='1021'>
<a name='1022'>
          IF ( (variable /= 'v') .and. (variable /= 'y') ) THEN<a name='1023'>
<a name='1024'>
            DO j = 1, bdyzone<a name='1025'>
            DO k = kts, k_end<a name='1026'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1027'>
              dat(i,k,jde+j-1) = dat(i,k,jde-j) <a name='1028'>
            ENDDO                               <a name='1029'>
            ENDDO<a name='1030'>
            ENDDO<a name='1031'>
<a name='1032'>
          ELSE<a name='1033'>
<a name='1034'>
            IF ( variable == 'v' ) THEN<a name='1035'>
<a name='1036'>
              DO j = 1, bdyzone<a name='1037'>
              DO k = kts, k_end<a name='1038'>
              DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1039'>
                dat(i,k,jde+j) = - dat(i,k,jde-j) <a name='1040'>
              ENDDO                               <a name='1041'>
              ENDDO<a name='1042'>
              ENDDO<a name='1043'>
<a name='1044'>
            ELSE<a name='1045'>
<a name='1046'>
              DO j = 1, bdyzone<a name='1047'>
              DO k = kts, k_end<a name='1048'>
              DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1049'>
                dat(i,k,jde+j) = dat(i,k,jde-j) <a name='1050'>
              ENDDO                               <a name='1051'>
              ENDDO<a name='1052'>
              ENDDO<a name='1053'>
<a name='1054'>
            END IF<a name='1055'>
<a name='1056'>
          ENDIF<a name='1057'>
<a name='1058'>
        END IF symmetry_ye<a name='1059'>
      <a name='1060'>
<font color=#447700>!  set open b.c in Y copy into boundary zone here.  WCS, 19 March 2000<a name='1061'></font>
<a name='1062'>
        open_ys: IF( ( config_flags%open_ys   .or. &amp;<a name='1063'>
                       config_flags%polar     .or. &amp;<a name='1064'>
                       config_flags%specified .or. &amp;<a name='1065'>
                       config_flags%nested            ) .and.  &amp;<a name='1066'>
                         ( jts == jds) .and. open_bc_copy )  THEN<a name='1067'>
<a name='1068'>
            DO k = kts, k_end<a name='1069'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1070'>
              dat(i,k,jds-1) = dat(i,k,jds) <a name='1071'>
              dat(i,k,jds-2) = dat(i,k,jds) <a name='1072'>
              dat(i,k,jds-3) = dat(i,k,jds) <a name='1073'>
            ENDDO<a name='1074'>
            ENDDO<a name='1075'>
<a name='1076'>
        ENDIF open_ys<a name='1077'>
<a name='1078'>
<font color=#447700>!  now the open boundary copy at ye<a name='1079'></font>
<a name='1080'>
        open_ye: IF( ( config_flags%open_ye   .or. &amp;<a name='1081'>
                       config_flags%polar     .or. &amp;<a name='1082'>
                       config_flags%specified .or. &amp;<a name='1083'>
                       config_flags%nested            ) .and.  &amp;<a name='1084'>
                         ( jte == jde ) .and. open_bc_copy )  THEN<a name='1085'>
<a name='1086'>
          IF (variable /= 'v' .and. variable /= 'y' ) THEN<a name='1087'>
<a name='1088'>
            DO k = kts, k_end<a name='1089'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1090'>
              dat(i,k,jde  ) = dat(i,k,jde-1) <a name='1091'>
              dat(i,k,jde+1) = dat(i,k,jde-1) <a name='1092'>
              dat(i,k,jde+2) = dat(i,k,jde-1) <a name='1093'>
            ENDDO                               <a name='1094'>
            ENDDO<a name='1095'>
<a name='1096'>
          ELSE<a name='1097'>
<a name='1098'>
            DO k = kts, k_end<a name='1099'>
            DO i = MAX(ids,its-1), MIN(ite+1,ide+istag)<a name='1100'>
              dat(i,k,jde+1) = dat(i,k,jde) <a name='1101'>
              dat(i,k,jde+2) = dat(i,k,jde) <a name='1102'>
              dat(i,k,jde+3) = dat(i,k,jde) <a name='1103'>
            ENDDO                               <a name='1104'>
            ENDDO<a name='1105'>
<a name='1106'>
          ENDIF<a name='1107'>
<a name='1108'>
      END IF open_ye<a name='1109'>
<a name='1110'>
<font color=#447700>!  end open b.c in Y copy into boundary zone addition.  WCS, 19 March 2000<a name='1111'></font>
<a name='1112'>
      END IF periodicity_y<a name='1113'>
<a name='1114'>
<font color=#447700>!  fix corners for doubly periodic domains<a name='1115'></font>
<a name='1116'>
      IF ( config_flags%periodic_x .and. config_flags%periodic_y &amp;<a name='1117'>
           .and. (ids == ips) .and. (ide == ipe)                 &amp;<a name='1118'>
           .and. (jds == jps) .and. (jde == jpe)                   ) THEN<a name='1119'>
<a name='1120'>
         IF ( (its == ids) .and. (jts == jds) ) THEN  <font color=#447700>! lower left corner fill<a name='1121'></font>
           DO j = 0, -(bdyzone-1), -1<a name='1122'>
           DO k = kts, k_end<a name='1123'>
           DO i = 0, -(bdyzone-1), -1<a name='1124'>
             dat(ids+i-1,k,jds+j-1) = dat(ide+i-1,k,jde+j-1)<a name='1125'>
           ENDDO<a name='1126'>
           ENDDO<a name='1127'>
           ENDDO<a name='1128'>
         END IF<a name='1129'>
<a name='1130'>
         IF ( (ite == ide) .and. (jts == jds) ) THEN  <font color=#447700>! lower right corner fill<a name='1131'></font>
           DO j = 0, -(bdyzone-1), -1<a name='1132'>
           DO k = kts, k_end<a name='1133'>
           DO i = 1, bdyzone<a name='1134'>
             dat(ide+i+istag,k,jds+j-1) = dat(ids+i+istag,k,jde+j-1)<a name='1135'>
           ENDDO<a name='1136'>
           ENDDO<a name='1137'>
           ENDDO<a name='1138'>
         END IF<a name='1139'>
<a name='1140'>
         IF ( (ite == ide) .and. (jte == jde) ) THEN  <font color=#447700>! upper right corner fill<a name='1141'></font>
           DO j = 1, bdyzone<a name='1142'>
           DO k = kts, k_end<a name='1143'>
           DO i = 1, bdyzone<a name='1144'>
             dat(ide+i+istag,k,jde+j+jstag) = dat(ids+i+istag,k,jds+j+jstag)<a name='1145'>
           ENDDO<a name='1146'>
           ENDDO<a name='1147'>
           ENDDO<a name='1148'>
         END IF<a name='1149'>
<a name='1150'>
         IF ( (its == ids) .and. (jte == jde) ) THEN  <font color=#447700>! upper left corner fill<a name='1151'></font>
           DO j = 1, bdyzone<a name='1152'>
           DO k = kts, k_end<a name='1153'>
           DO i = 0, -(bdyzone-1), -1<a name='1154'>
             dat(ids+i-1,k,jde+j+jstag) = dat(ide+i-1,k,jds+j+jstag)<a name='1155'>
           ENDDO<a name='1156'>
           ENDDO<a name='1157'>
           ENDDO<a name='1158'>
         END IF<a name='1159'>
<a name='1160'>
       END IF<a name='1161'>
<a name='1162'>
   END SUBROUTINE set_physical_bc3d<a name='1163'>
<a name='1164'>
<A NAME='INIT_MODULE_BC'><A href='../../html_code/share/module_bc.F.html#INIT_MODULE_BC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1165'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_bc</font> <A href='../../call_to/INIT_MODULE_BC.html' TARGET='index'>1</A><a name='1166'>
   END SUBROUTINE init_module_bc<a name='1167'>
<a name='1168'>
<font color=#447700>!------------------------------------------------------------------------<a name='1169'></font>
<a name='1170'>
<font color=#447700>! a couple versions of this call to allow a smaller-than-memory dimensioned field (e.g. tile sized)<a name='1171'></font>
<font color=#447700>! to be passed in as the first argument.  Both of these call the _core version defined below.<a name='1172'></font>
<A NAME='RELAX_BDYTEND'><A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1173'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>relax_bdytend</font>   ( field, field_tend,                     &amp; <A href='../../call_to/RELAX_BDYTEND.html' TARGET='index'>4</A>,<A href='../../call_from/RELAX_BDYTEND.html' TARGET='index'>1</A><a name='1174'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='1175'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='1176'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='1177'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='1178'>
                                variable_in, config_flags,             &amp;<a name='1179'>
                                spec_bdy_width, spec_zone, relax_zone, &amp;<a name='1180'>
                                dtbc, fcx, gcx,             &amp;<a name='1181'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1182'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1183'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1184'></font>
                                its,ite, jts,jte, kts,kte   &amp;<a name='1185'>
                                )<a name='1186'>
<a name='1187'>
      IMPLICIT NONE<a name='1188'>
<a name='1189'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1190'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='1191'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1192'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1193'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone, relax_zone<a name='1194'>
      REAL,         INTENT(IN   )    :: dtbc<a name='1195'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1196'>
<a name='1197'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: field<a name='1198'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field_tend<a name='1199'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='1200'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye<a name='1201'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='1202'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_ys, field_bdy_tend_ye<a name='1203'>
      REAL,  DIMENSION( spec_bdy_width ), INTENT(IN   ) :: fcx, gcx<a name='1204'>
      TYPE( grid_config_rec_type ) config_flags<a name='1205'>
<a name='1206'>
      CALL <A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND_CORE'>relax_bdytend_core</A><A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDYTEND_CORE_1">   ( field, field_tend,                     &amp;<a name='1207'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='1208'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='1209'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='1210'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='1211'>
                                variable_in, config_flags,             &amp;<a name='1212'>
                                spec_bdy_width, spec_zone, relax_zone, &amp;<a name='1213'>
                                dtbc, fcx, gcx,             &amp;<a name='1214'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1215'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1216'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1217'></font>
                                its,ite, jts,jte, kts,kte,  &amp; <font color=#447700>! patch  dims<a name='1218'></font>
                                ims,ime, jms,jme, kms,kme )  <font color=#447700>! dimension of the field argument<a name='1219'></font>
   END SUBROUTINE relax_bdytend<a name='1220'>
<a name='1221'>
<font color=#447700>! version that allows tile-sized version of field. Note, caller should define the<a name='1222'></font>
<font color=#447700>! field to be -+1 of tile size in each dimension because routine is going off onto halo<a name='1223'></font>
<font color=#447700>! for example, see relax_bdytend in dyn_em/module_bc_em.F <a name='1224'></font>
<A NAME='RELAX_BDYTEND_TILE'><A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND_TILE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1225'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>relax_bdytend_tile</font>   ( field, field_tend,                     &amp; <A href='../../call_to/RELAX_BDYTEND_TILE.html' TARGET='index'>3</A>,<A href='../../call_from/RELAX_BDYTEND_TILE.html' TARGET='index'>1</A><a name='1226'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='1227'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='1228'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='1229'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='1230'>
                                variable_in, config_flags,             &amp;<a name='1231'>
                                spec_bdy_width, spec_zone, relax_zone, &amp;<a name='1232'>
                                dtbc, fcx, gcx,             &amp;<a name='1233'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1234'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1235'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1236'></font>
                                its,ite, jts,jte, kts,kte,  &amp;<a name='1237'>
                                iXs,iXe, jXs,jXe, kXs,kXe   &amp;  <font color=#447700>! dims of first argument<a name='1238'></font>
                                )<a name='1239'>
<a name='1240'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1241'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='1242'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1243'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1244'>
      INTEGER,      INTENT(IN   )    :: iXs,iXe, jXs,jXe, kXs,kXe<a name='1245'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone, relax_zone<a name='1246'>
      REAL,         INTENT(IN   )    :: dtbc<a name='1247'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1248'>
<a name='1249'>
      REAL,  DIMENSION( iXs:iXe , kXs:kXe , jXs:jXe ), INTENT(IN   ) :: field<a name='1250'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field_tend<a name='1251'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='1252'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye<a name='1253'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='1254'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_ys, field_bdy_tend_ye<a name='1255'>
      REAL,  DIMENSION( spec_bdy_width ), INTENT(IN   ) :: fcx, gcx<a name='1256'>
      TYPE( grid_config_rec_type ) config_flags<a name='1257'>
<a name='1258'>
      CALL <A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND_CORE'>relax_bdytend_core</A><A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND_TILE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX_BDYTEND_CORE_2">   ( field, field_tend,                     &amp;<a name='1259'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='1260'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='1261'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='1262'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='1263'>
                                variable_in, config_flags,             &amp;<a name='1264'>
                                spec_bdy_width, spec_zone, relax_zone, &amp;<a name='1265'>
                                dtbc, fcx, gcx,             &amp;<a name='1266'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1267'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1268'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1269'></font>
                                its,ite, jts,jte, kts,kte,  &amp;<a name='1270'>
                                iXs,iXe, jXs,jXe, kXs,kXe )  <font color=#447700>! dimension of the field argument<a name='1271'></font>
   END SUBROUTINE relax_bdytend_tile<a name='1272'>
<a name='1273'>
<A NAME='RELAX_BDYTEND_CORE'><A href='../../html_code/share/module_bc.F.html#RELAX_BDYTEND_CORE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1274'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>relax_bdytend_core</font>   ( field, field_tend,                     &amp; <A href='../../call_to/RELAX_BDYTEND_CORE.html' TARGET='index'>2</A><a name='1275'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='1276'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='1277'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='1278'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='1279'>
                                variable_in, config_flags,             &amp;<a name='1280'>
                                spec_bdy_width, spec_zone, relax_zone, &amp;<a name='1281'>
                                dtbc, fcx, gcx,             &amp;<a name='1282'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1283'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1284'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1285'></font>
                                its,ite, jts,jte, kts,kte,  &amp; <font color=#447700>! patch  dims<a name='1286'></font>
                                iXs,iXe, jXs,jXe, kXs,kXe   &amp; <font color=#447700>! field (1st arg) dims; might be tile or patch<a name='1287'></font>
                                )<a name='1288'>
<a name='1289'>
<font color=#447700>!  This subroutine adds the tendencies in the boundary relaxation region, for specified<a name='1290'></font>
<font color=#447700>!  boundary conditions.  <a name='1291'></font>
<font color=#447700>!  spec_bdy_width is only used to dimension the boundary arrays.<a name='1292'></font>
<font color=#447700>!  relax_zone is the inner edge of the boundary relaxation zone treated here.<a name='1293'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are not changed here.<a name='1294'></font>
<font color=#447700>!  (JD July 2000)<a name='1295'></font>
<a name='1296'>
      IMPLICIT NONE<a name='1297'>
<a name='1298'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1299'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='1300'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1301'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1302'>
      INTEGER,      INTENT(IN   )    :: iXs,iXe, jXs,jXe, kXs,kXe<a name='1303'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone, relax_zone<a name='1304'>
      REAL,         INTENT(IN   )    :: dtbc<a name='1305'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1306'>
<a name='1307'>
<a name='1308'>
      REAL,  DIMENSION( iXs:iXe , kXs:kXe , jXs:jXe ), INTENT(IN   ) :: field<a name='1309'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field_tend<a name='1310'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='1311'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye<a name='1312'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='1313'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_ys, field_bdy_tend_ye<a name='1314'>
      REAL,  DIMENSION( spec_bdy_width ), INTENT(IN   ) :: fcx, gcx<a name='1315'>
      TYPE( grid_config_rec_type ) config_flags<a name='1316'>
<a name='1317'>
      CHARACTER  :: variable<a name='1318'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf, im1, ip1<a name='1319'>
      INTEGER    :: b_dist, b_limit<a name='1320'>
      REAL       :: fls0, fls1, fls2, fls3, fls4<a name='1321'>
      LOGICAL    :: periodic_x<a name='1322'>
<a name='1323'>
      periodic_x = config_flags%periodic_x<a name='1324'>
      variable = variable_in<a name='1325'>
<a name='1326'>
      IF (variable == 'U') variable = 'u'<a name='1327'>
      IF (variable == 'V') variable = 'v'<a name='1328'>
      IF (variable == 'M') variable = 'm'<a name='1329'>
      IF (variable == 'H') variable = 'h'<a name='1330'>
<a name='1331'>
      ibs = ids<a name='1332'>
      ibe = ide-1<a name='1333'>
      itf = min(ite,ide-1)<a name='1334'>
      jbs = jds<a name='1335'>
      jbe = jde-1<a name='1336'>
      jtf = min(jte,jde-1)<a name='1337'>
      ktf = kde-1<a name='1338'>
      IF (variable == 'u') ibe = ide<a name='1339'>
      IF (variable == 'u') itf = min(ite,ide)<a name='1340'>
      IF (variable == 'v') jbe = jde<a name='1341'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='1342'>
      IF (variable == 'm') ktf = kte<a name='1343'>
      IF (variable == 'h') ktf = kte<a name='1344'>
<a name='1345'>
<a name='1346'>
      IF (jts - jbs .lt. relax_zone) THEN<a name='1347'>
<font color=#447700>! Y-start boundary<a name='1348'></font>
        DO j = max(jts,jbs+spec_zone), min(jtf,jbs+relax_zone-1)<a name='1349'>
          b_dist = j - jbs<a name='1350'>
          b_limit = b_dist<a name='1351'>
          IF(periodic_x)b_limit = 0<a name='1352'>
          DO k = kts, ktf<a name='1353'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1354'>
              im1 = max(i-1,ibs)<a name='1355'>
              ip1 = min(i+1,ibe)<a name='1356'>
              fls0 = field_bdy_ys(i, k, b_dist+1) &amp;<a name='1357'>
                   + dtbc * field_bdy_tend_ys(i, k, b_dist+1) &amp;<a name='1358'>
                   - field(i,k,j)<a name='1359'>
              fls1 = field_bdy_ys(im1, k, b_dist+1) &amp;<a name='1360'>
                   + dtbc * field_bdy_tend_ys(im1, k, b_dist+1) &amp;<a name='1361'>
                   - field(im1,k,j)<a name='1362'>
              fls2 = field_bdy_ys(ip1, k, b_dist+1) &amp;<a name='1363'>
                   + dtbc * field_bdy_tend_ys(ip1, k, b_dist+1) &amp;<a name='1364'>
                   - field(ip1,k,j)<a name='1365'>
              fls3 = field_bdy_ys(i, k, b_dist) &amp;<a name='1366'>
                   + dtbc * field_bdy_tend_ys(i, k, b_dist) &amp;<a name='1367'>
                   - field(i,k,j-1)<a name='1368'>
              fls4 = field_bdy_ys(i, k, b_dist+2) &amp;<a name='1369'>
                   + dtbc * field_bdy_tend_ys(i, k, b_dist+2) &amp;<a name='1370'>
                   - field(i,k,j+1)<a name='1371'>
              field_tend(i,k,j) = field_tend(i,k,j) &amp;<a name='1372'>
                                + fcx(b_dist+1)*fls0 &amp;<a name='1373'>
                                - gcx(b_dist+1)*(fls1+fls2+fls3+fls4-4.*fls0)<a name='1374'>
            ENDDO<a name='1375'>
          ENDDO<a name='1376'>
        ENDDO<a name='1377'>
      ENDIF<a name='1378'>
<a name='1379'>
      IF (jbe - jtf .lt. relax_zone) THEN<a name='1380'>
<a name='1381'>
<a name='1382'>
<font color=#447700>! Y-end boundary<a name='1383'></font>
        DO j = max(jts,jbe-relax_zone+1), min(jtf,jbe-spec_zone)<a name='1384'>
          b_dist = jbe - j<a name='1385'>
          b_limit = b_dist<a name='1386'>
          IF(periodic_x)b_limit = 0<a name='1387'>
<a name='1388'>
<a name='1389'>
          DO k = kts, ktf<a name='1390'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1391'>
              im1 = max(i-1,ibs)<a name='1392'>
              ip1 = min(i+1,ibe)<a name='1393'>
              fls0 = field_bdy_ye(i, k, b_dist+1) &amp;<a name='1394'>
                   + dtbc * field_bdy_tend_ye(i, k, b_dist+1) &amp;<a name='1395'>
                   - field(i,k,j)<a name='1396'>
              fls1 = field_bdy_ye(im1, k, b_dist+1) &amp;<a name='1397'>
                   + dtbc * field_bdy_tend_ye(im1, k, b_dist+1) &amp;<a name='1398'>
                   - field(im1,k,j)<a name='1399'>
              fls2 = field_bdy_ye(ip1, k, b_dist+1) &amp;<a name='1400'>
                   + dtbc * field_bdy_tend_ye(ip1, k, b_dist+1) &amp;<a name='1401'>
                   - field(ip1,k,j)<a name='1402'>
              fls3 = field_bdy_ye(i, k, b_dist) &amp;<a name='1403'>
                   + dtbc * field_bdy_tend_ye(i, k, b_dist) &amp;<a name='1404'>
                   - field(i,k,j+1)<a name='1405'>
              fls4 = field_bdy_ye(i, k, b_dist+2) &amp;<a name='1406'>
                   + dtbc * field_bdy_tend_ye(i, k, b_dist+2) &amp;<a name='1407'>
                   - field(i,k,j-1)<a name='1408'>
              field_tend(i,k,j) = field_tend(i,k,j) &amp;<a name='1409'>
                                + fcx(b_dist+1)*fls0 &amp;<a name='1410'>
                                - gcx(b_dist+1)*(fls1+fls2+fls3+fls4-4.*fls0)<a name='1411'>
<a name='1412'>
            ENDDO<a name='1413'>
          ENDDO<a name='1414'>
        ENDDO<a name='1415'>
      ENDIF<a name='1416'>
<a name='1417'>
    IF(.NOT.periodic_x)THEN<a name='1418'>
      IF (its - ibs .lt. relax_zone) THEN<a name='1419'>
<font color=#447700>! X-start boundary<a name='1420'></font>
        DO i = max(its,ibs+spec_zone), min(itf,ibs+relax_zone-1)<a name='1421'>
          b_dist = i - ibs<a name='1422'>
          DO k = kts, ktf<a name='1423'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1424'>
              fls0 = field_bdy_xs(j, k, b_dist+1) &amp;<a name='1425'>
                   + dtbc * field_bdy_tend_xs(j, k, b_dist+1) &amp;<a name='1426'>
                   - field(i,k,j)<a name='1427'>
              fls1 = field_bdy_xs(j-1, k, b_dist+1) &amp;<a name='1428'>
                   + dtbc * field_bdy_tend_xs(j-1, k, b_dist+1) &amp;<a name='1429'>
                   - field(i,k,j-1)<a name='1430'>
              fls2 = field_bdy_xs(j+1, k, b_dist+1) &amp;<a name='1431'>
                   + dtbc * field_bdy_tend_xs(j+1, k, b_dist+1) &amp;<a name='1432'>
                   - field(i,k,j+1)<a name='1433'>
              fls3 = field_bdy_xs(j, k, b_dist) &amp;<a name='1434'>
                   + dtbc * field_bdy_tend_xs(j, k, b_dist) &amp;<a name='1435'>
                   - field(i-1,k,j)<a name='1436'>
              fls4 = field_bdy_xs(j, k, b_dist+2) &amp;<a name='1437'>
                   + dtbc * field_bdy_tend_xs(j, k, b_dist+2) &amp;<a name='1438'>
                   - field(i+1,k,j)<a name='1439'>
              field_tend(i,k,j) = field_tend(i,k,j) &amp;<a name='1440'>
                                + fcx(b_dist+1)*fls0 &amp;<a name='1441'>
                                - gcx(b_dist+1)*(fls1+fls2+fls3+fls4-4.*fls0)<a name='1442'>
<a name='1443'>
            ENDDO<a name='1444'>
          ENDDO<a name='1445'>
        ENDDO<a name='1446'>
      ENDIF<a name='1447'>
<a name='1448'>
      IF (ibe - itf .lt. relax_zone) THEN<a name='1449'>
<font color=#447700>! X-end boundary<a name='1450'></font>
        DO i = max(its,ibe-relax_zone+1), min(itf,ibe-spec_zone)<a name='1451'>
          b_dist = ibe - i<a name='1452'>
          DO k = kts, ktf<a name='1453'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1454'>
              fls0 = field_bdy_xe(j, k, b_dist+1) &amp;<a name='1455'>
                   + dtbc * field_bdy_tend_xe(j, k, b_dist+1) &amp;<a name='1456'>
                   - field(i,k,j)<a name='1457'>
              fls1 = field_bdy_xe(j-1, k, b_dist+1) &amp;<a name='1458'>
                   + dtbc * field_bdy_tend_xe(j-1, k, b_dist+1) &amp;<a name='1459'>
                   - field(i,k,j-1)<a name='1460'>
              fls2 = field_bdy_xe(j+1, k, b_dist+1) &amp;<a name='1461'>
                   + dtbc * field_bdy_tend_xe(j+1, k, b_dist+1) &amp;<a name='1462'>
                   - field(i,k,j+1)<a name='1463'>
              fls3 = field_bdy_xe(j, k, b_dist) &amp;<a name='1464'>
                   + dtbc * field_bdy_tend_xe(j, k, b_dist) &amp;<a name='1465'>
                   - field(i+1,k,j)<a name='1466'>
              fls4 = field_bdy_xe(j, k, b_dist+2) &amp;<a name='1467'>
                   + dtbc * field_bdy_tend_xe(j, k, b_dist+2) &amp;<a name='1468'>
                   - field(i-1,k,j)<a name='1469'>
              field_tend(i,k,j) = field_tend(i,k,j) &amp;<a name='1470'>
                                + fcx(b_dist+1)*fls0 &amp;<a name='1471'>
                                - gcx(b_dist+1)*(fls1+fls2+fls3+fls4-4.*fls0)<a name='1472'>
            ENDDO<a name='1473'>
          ENDDO<a name='1474'>
        ENDDO<a name='1475'>
      ENDIF<a name='1476'>
    ENDIF<a name='1477'>
<a name='1478'>
<a name='1479'>
<a name='1480'>
   END SUBROUTINE relax_bdytend_core<a name='1481'>
<font color=#447700>!------------------------------------------------------------------------<a name='1482'></font>
<a name='1483'>
<A NAME='SPEC_BDYTEND'><A href='../../html_code/share/module_bc.F.html#SPEC_BDYTEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1484'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdytend</font>   ( field_tend,                           &amp; <A href='../../call_to/SPEC_BDYTEND.html' TARGET='index'>7</A><a name='1485'>
                               field_bdy_xs, field_bdy_xe,           &amp;<a name='1486'>
                               field_bdy_ys, field_bdy_ye,           &amp;<a name='1487'>
                               field_bdy_tend_xs, field_bdy_tend_xe, &amp;<a name='1488'>
                               field_bdy_tend_ys, field_bdy_tend_ye, &amp;<a name='1489'>
                               variable_in, config_flags, &amp; <a name='1490'>
                               spec_bdy_width, spec_zone, &amp;<a name='1491'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1492'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1493'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1494'></font>
                               its,ite, jts,jte, kts,kte )<a name='1495'>
<a name='1496'>
<font color=#447700>!  This subroutine sets the tendencies in the boundary specified region.<a name='1497'></font>
<font color=#447700>!  spec_bdy_width is only used to dimension the boundary arrays.<a name='1498'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='1499'></font>
<font color=#447700>!  (JD July 2000)<a name='1500'></font>
<a name='1501'>
      IMPLICIT NONE<a name='1502'>
<a name='1503'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1504'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='1505'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1506'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1507'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone<a name='1508'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1509'>
<a name='1510'>
<a name='1511'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(OUT  ) :: field_tend<a name='1512'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='1513'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye <a name='1514'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='1515'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_ys, field_bdy_tend_ye <a name='1516'>
      TYPE( grid_config_rec_type ) config_flags<a name='1517'>
<a name='1518'>
      CHARACTER  :: variable<a name='1519'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf<a name='1520'>
      INTEGER    :: b_dist, b_limit<a name='1521'>
      LOGICAL    :: periodic_x<a name='1522'>
<a name='1523'>
      periodic_x = config_flags%periodic_x<a name='1524'>
<a name='1525'>
      variable = variable_in<a name='1526'>
<a name='1527'>
      IF (variable == 'U') variable = 'u'<a name='1528'>
      IF (variable == 'V') variable = 'v'<a name='1529'>
      IF (variable == 'M') variable = 'm'<a name='1530'>
      IF (variable == 'H') variable = 'h'<a name='1531'>
<a name='1532'>
      ibs = ids<a name='1533'>
      ibe = ide-1<a name='1534'>
      itf = min(ite,ide-1)<a name='1535'>
      jbs = jds<a name='1536'>
      jbe = jde-1<a name='1537'>
      jtf = min(jte,jde-1)<a name='1538'>
      ktf = kde-1<a name='1539'>
      IF (variable == 'u') ibe = ide<a name='1540'>
      IF (variable == 'u') itf = min(ite,ide)<a name='1541'>
      IF (variable == 'v') jbe = jde<a name='1542'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='1543'>
      IF (variable == 'm') ktf = kte<a name='1544'>
      IF (variable == 'h') ktf = kte<a name='1545'>
<a name='1546'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='1547'>
<font color=#447700>! Y-start boundary<a name='1548'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='1549'>
          b_dist = j - jbs<a name='1550'>
          b_limit = b_dist<a name='1551'>
          IF(periodic_x)b_limit = 0<a name='1552'>
          DO k = kts, ktf<a name='1553'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1554'>
              field_tend(i,k,j) = field_bdy_tend_ys(i, k, b_dist+1)<a name='1555'>
            ENDDO<a name='1556'>
          ENDDO<a name='1557'>
        ENDDO<a name='1558'>
      ENDIF <a name='1559'>
      IF (jbe - jtf .lt. spec_zone) THEN <a name='1560'>
<a name='1561'>
<a name='1562'>
<font color=#447700>! Y-end boundary <a name='1563'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf <a name='1564'>
          b_dist = jbe - j <a name='1565'>
          b_limit = b_dist<a name='1566'>
          IF(periodic_x)b_limit = 0<a name='1567'>
<a name='1568'>
<a name='1569'>
          DO k = kts, ktf <a name='1570'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1571'>
              field_tend(i,k,j) = field_bdy_tend_ye(i, k, b_dist+1)<a name='1572'>
            ENDDO<a name='1573'>
          ENDDO<a name='1574'>
        ENDDO<a name='1575'>
      ENDIF <a name='1576'>
<a name='1577'>
    IF(.NOT.periodic_x)THEN<a name='1578'>
      IF (its - ibs .lt. spec_zone) THEN<a name='1579'>
<font color=#447700>! X-start boundary<a name='1580'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='1581'>
          b_dist = i - ibs<a name='1582'>
          DO k = kts, ktf<a name='1583'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1584'>
              field_tend(i,k,j) = field_bdy_tend_xs(j, k, b_dist+1)<a name='1585'>
            ENDDO<a name='1586'>
          ENDDO<a name='1587'>
        ENDDO<a name='1588'>
      ENDIF <a name='1589'>
<a name='1590'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='1591'>
<font color=#447700>! X-end boundary<a name='1592'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='1593'>
          b_dist = ibe - i<a name='1594'>
          DO k = kts, ktf<a name='1595'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1596'>
              field_tend(i,k,j) = field_bdy_tend_xe(j, k, b_dist+1)<a name='1597'>
            ENDDO<a name='1598'>
          ENDDO<a name='1599'>
        ENDDO<a name='1600'>
      ENDIF <a name='1601'>
    ENDIF<a name='1602'>
<a name='1603'>
   END SUBROUTINE spec_bdytend<a name='1604'>
   <a name='1605'>
<font color=#447700>!------------------------------------------------------------------------<a name='1606'></font>
<font color=#447700>! KRS 9/13/2012: New subroutine spec_bdytend_perturb. <a name='1607'></font>
<font color=#447700>! Reads in field_tend_perturb from dyn_em/module_bc_em.F  <a name='1608'></font>
<font color=#447700>! field_tend_perturb=r*_tendf_stoch if perturb_bdy=1<a name='1609'></font>
<font color=#447700>! field_tend_perturb=User provided pattern if perturb_bdy=2<a name='1610'></font>
<font color=#447700>! User can fill array in this subroutine.   <a name='1611'></font>
<font color=#447700>! Adds perturbations to boundaries. Outputs field_tend (e.g. ru_tend). <a name='1612'></font>
<font color=#447700>! mu_2, mub, and msf* passed into subrountine couple variables.<a name='1613'></font>
<font color=#447700>!------------------------------------------------------------------------<a name='1614'></font>
<A NAME='SPEC_BDYTEND_PERTURB'><A href='../../html_code/share/module_bc.F.html#SPEC_BDYTEND_PERTURB' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1615'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdytend_perturb</font>   ( field_tend,                   &amp; <A href='../../call_to/SPEC_BDYTEND_PERTURB.html' TARGET='index'>3</A><a name='1616'>
                                       field_tend_perturb,           &amp;<a name='1617'>
                                       mu_2, mub, c1, c2,            &amp;<a name='1618'>
                                       variable_in,                  &amp;<a name='1619'>
                                       msf, config_flags,            &amp; <a name='1620'>
                                       spec_bdy_width, spec_zone,    &amp;<a name='1621'>
                                       kme_stoch,                    &amp; <font color=#447700>! stoch  dims<a name='1622'></font>
                                       ids,ide, jds,jde, kds,kde,    &amp; <font color=#447700>! domain dims<a name='1623'></font>
                                       ims,ime, jms,jme, kms,kme,    &amp; <font color=#447700>! memory dims<a name='1624'></font>
                                       ips,ipe, jps,jpe, kps,kpe,    &amp; <font color=#447700>! patch  dims<a name='1625'></font>
                                       its,ite, jts,jte, kts,kte )<a name='1626'>
<a name='1627'>
<font color=#447700>!  This subroutine sets the tendencies in the boundary specified region.<a name='1628'></font>
<font color=#447700>!  spec_bdy_width is only used to dimension the boundary arrays.<a name='1629'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='1630'></font>
<font color=#447700>!  (JD July 2000)<a name='1631'></font>
<a name='1632'>
      IMPLICIT NONE<a name='1633'>
<a name='1634'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1635'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme, kme_stoch<a name='1636'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1637'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1638'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone<a name='1639'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1640'>
<a name='1641'>
<a name='1642'>
      REAL,  DIMENSION( ims:ime , kms:kme       , jms:jme ), INTENT(INOUT  ) :: field_tend<a name='1643'>
      REAL,  DIMENSION( ims:ime , kms:kme_stoch , jms:kme ), INTENT(IN   )   :: field_tend_perturb<a name='1644'>
      REAL,  DIMENSION( ims:ime ,                 jms:jme ), INTENT(IN   )   :: mu_2	<a name='1645'>
      REAL,  DIMENSION( ims:ime ,                 jms:jme ), INTENT(IN   )   :: mub<a name='1646'>
      REAL,  DIMENSION( ims:ime ,                 jms:jme ), INTENT(IN   )   :: msf<a name='1647'>
      REAL,  DIMENSION(           kms:kme                 ), INTENT(IN   )   :: c1, c2<a name='1648'>
	  <a name='1649'>
      TYPE( grid_config_rec_type ) config_flags<a name='1650'>
<a name='1651'>
      CHARACTER  :: variable<a name='1652'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf<a name='1653'>
      INTEGER    :: b_dist, b_limit<a name='1654'>
      LOGICAL    :: periodic_x<a name='1655'>
<a name='1656'>
      periodic_x = config_flags%periodic_x<a name='1657'>
<a name='1658'>
      variable = variable_in<a name='1659'>
<a name='1660'>
      IF (variable == 'U') variable = 'u'<a name='1661'>
      IF (variable == 'V') variable = 'v'<a name='1662'>
      IF (variable == 'T') variable = 't'<a name='1663'>
      IF (variable == 'H') variable = 'h'<a name='1664'>
<a name='1665'>
      ibs = ids<a name='1666'>
      ibe = ide-1<a name='1667'>
      itf = min(ite,ide-1)<a name='1668'>
      jbs = jds<a name='1669'>
      jbe = jde-1<a name='1670'>
      jtf = min(jte,jde-1)<a name='1671'>
      ktf = kde-1<a name='1672'>
      IF (variable == 'u') ibe = ide<a name='1673'>
      IF (variable == 'u') itf = min(ite,ide)<a name='1674'>
      IF (variable == 'v') jbe = jde<a name='1675'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='1676'>
      IF (variable == 'h') ktf = kte<a name='1677'>
<a name='1678'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='1679'>
<a name='1680'>
<font color=#447700>! Y-start boundary<a name='1681'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='1682'>
          b_dist = j - jbs<a name='1683'>
          b_limit = b_dist<a name='1684'>
          IF(periodic_x)b_limit = 0<a name='1685'>
          DO k = kts, ktf<a name='1686'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1687'>
            IF (variable == 't') THEN<a name='1688'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1689'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * &amp; <a name='1690'>
                                  (mu_2(i,j)+mub(i,j)) <a name='1691'>
            ENDIF<a name='1692'>
            IF (variable == 'u') THEN<a name='1693'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1694'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * &amp; <a name='1695'>
                                  0.5*(mu_2(i,j)+mu_2(i-1,j) + mub(i,j)+mub(i-1,j)) / msf(i,j)<a name='1696'>
            ENDIF<a name='1697'>
            IF (variable == 'v') THEN<a name='1698'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1699'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * &amp; <a name='1700'>
                                  0.5*(mu_2(i,j)+mu_2(i,j-1) + mub(i,j)+mub(i,j-1)) / msf(i,j)<a name='1701'>
            ENDIF<a name='1702'>
            ENDDO<a name='1703'>
          ENDDO<a name='1704'>
        ENDDO<a name='1705'>
      ENDIF <a name='1706'>
      IF (jbe - jtf .lt. spec_zone) THEN <a name='1707'>
<a name='1708'>
<a name='1709'>
<font color=#447700>! Y-end boundary <a name='1710'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf <a name='1711'>
          b_dist = jbe - j <a name='1712'>
          b_limit = b_dist<a name='1713'>
          IF(periodic_x)b_limit = 0<a name='1714'>
          DO k = kts, ktf <a name='1715'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1716'>
            IF (variable == 't') THEN<a name='1717'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1718'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * (mu_2(i,j)+mub(i,j))<a name='1719'>
            ENDIF<a name='1720'>
            IF (variable == 'u') THEN<a name='1721'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1722'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i-1,j) + mub(i,j)+mub(i-1,j)) / msf(i,j)<a name='1723'>
            ENDIF<a name='1724'>
            IF (variable == 'v') THEN<a name='1725'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1726'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i,j-1) + mub(i,j)+mub(i,j-1)) / msf(i,j)<a name='1727'>
            ENDIF<a name='1728'>
	    ENDDO<a name='1729'>
          ENDDO<a name='1730'>
        ENDDO<a name='1731'>
      ENDIF <a name='1732'>
<a name='1733'>
    IF(.NOT.periodic_x)THEN<a name='1734'>
      IF (its - ibs .lt. spec_zone) THEN<a name='1735'>
<font color=#447700>! X-start boundary<a name='1736'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='1737'>
          b_dist = i - ibs<a name='1738'>
          DO k = kts, ktf<a name='1739'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1740'>
            IF (variable == 't') THEN<a name='1741'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1742'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * (mu_2(i,j)+mub(i,j))<a name='1743'>
            ENDIF<a name='1744'>
            IF (variable == 'u') THEN<a name='1745'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1746'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i-1,j) + mub(i,j)+mub(i-1,j)) / msf(i,j)<a name='1747'>
            ENDIF<a name='1748'>
            IF (variable == 'v') THEN<a name='1749'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1750'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i,j-1) + mub(i,j)+mub(i,j-1)) / msf(i,j)<a name='1751'>
            ENDIF<a name='1752'>
            ENDDO<a name='1753'>
          ENDDO<a name='1754'>
        ENDDO<a name='1755'>
      ENDIF <a name='1756'>
<a name='1757'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='1758'>
<font color=#447700>! X-end boundary<a name='1759'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='1760'>
          b_dist = ibe - i<a name='1761'>
          DO k = kts, ktf<a name='1762'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1763'>
            IF (variable == 't') THEN<a name='1764'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1765'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * (mu_2(i,j)+mub(i,j))<a name='1766'>
            ENDIF<a name='1767'>
            IF (variable == 'u') THEN<a name='1768'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1769'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i-1,j) + mub(i,j)+mub(i-1,j)) / msf(i,j)<a name='1770'>
            ENDIF<a name='1771'>
            IF (variable == 'v') THEN<a name='1772'>
              field_tend(i,k,j) = field_tend(i,k,j) + &amp;<a name='1773'>
                                  field_tend_perturb(i,min(k,kme_stoch),j) * 0.5*(mu_2(i,j)+mu_2(i,j-1) + mub(i,j)+mub(i,j-1)) / msf(i,j)<a name='1774'>
            ENDIF<a name='1775'>
            ENDDO<a name='1776'>
          ENDDO<a name='1777'>
        ENDDO<a name='1778'>
      ENDIF <a name='1779'>
    ENDIF<a name='1780'>
<a name='1781'>
   END SUBROUTINE spec_bdytend_perturb<a name='1782'>
<a name='1783'>
<a name='1784'>
<font color=#447700>!------------------------------------------------------------------------<a name='1785'></font>
<a name='1786'>
<A NAME='SPEC_BDYTEND_PERTURB_CHEM'><A href='../../html_code/share/module_bc.F.html#SPEC_BDYTEND_PERTURB_CHEM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1787'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdytend_perturb_chem</font>   ( field_bdy_tend_xs, field_bdy_tend_xe, &amp; <A href='../../call_to/SPEC_BDYTEND_PERTURB_CHEM.html' TARGET='index'>1</A>,<A href='../../call_from/SPEC_BDYTEND_PERTURB_CHEM.html' TARGET='index'>1</A><a name='1788'>
                                            field_bdy_tend_ys, field_bdy_tend_ye, &amp;<a name='1789'>
                                            field_scalar_perturb,         &amp;<a name='1790'>
                                            variable_in,                &amp;<a name='1791'>
                                            periodic_x,                 &amp;<a name='1792'>
                                            spec_bdy_width, spec_zone,  &amp;<a name='1793'>
                                            kme_stoch,                  &amp; <a name='1794'>
                                            ids,ide, jds,jde, kds,kde,  &amp;<a name='1795'>
                                            ims,ime, jms,jme, kms,kme,  &amp;<a name='1796'>
                                            ips,ipe, jps,jpe, kps,kpe,  &amp;<a name='1797'>
                                            its,ite, jts,jte, kts,kte )<a name='1798'>
<a name='1799'>
      IMPLICIT NONE<a name='1800'>
<a name='1801'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1802'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme, kme_stoch<a name='1803'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1804'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1805'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone<a name='1806'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1807'>
      LOGICAL,      INTENT(IN   )    :: periodic_x<a name='1808'>
<a name='1809'>
      REAL,  DIMENSION( ims:ime , kms:kme_stoch , jms:kme ) , INTENT(IN   ) :: field_scalar_perturb<a name='1810'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(INOUT) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='1811'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(INOUT) :: field_bdy_tend_ys, field_bdy_tend_ye<a name='1812'>
<a name='1813'>
      CHARACTER  :: variable<a name='1814'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf<a name='1815'>
      INTEGER    :: b_dist, b_limit<a name='1816'>
<a name='1817'>
      variable = variable_in<a name='1818'>
      IF (variable == 'C') variable = 'c'<a name='1819'>
<a name='1820'>
      IF (variable /= 'c') THEN<a name='1821'>
          write( wrf_err_message ,*) ' *** Error in spec_bdytend_perturb_chem'<a name='1822'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/share/module_bc.F.html#SPEC_BDYTEND_PERTURB_CHEM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1235"> ( wrf_err_message )<a name='1823'>
      ENDIF<a name='1824'>
<a name='1825'>
      ibs = ids<a name='1826'>
      ibe = ide-1<a name='1827'>
      itf = min(ite,ide-1)<a name='1828'>
      jbs = jds<a name='1829'>
      jbe = jde-1<a name='1830'>
      jtf = min(jte,jde-1)<a name='1831'>
      ktf = kde-1<a name='1832'>
      <font color=#447700>!ktf = kte<a name='1833'></font>
<a name='1834'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='1835'>
<font color=#447700>! Y-start boundary<a name='1836'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='1837'>
           b_dist = j - jbs<a name='1838'>
           b_limit = b_dist<a name='1839'>
           IF(periodic_x)b_limit = 0<a name='1840'>
           DO k = kts, ktf<a name='1841'>
              DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1842'>
                 field_bdy_tend_ys(i,k,b_dist+1) = field_bdy_tend_ys(i,k,b_dist+1) * &amp; <a name='1843'>
                                                   (1.0 + field_scalar_perturb(i,min(k,kme_stoch),j))<a name='1844'>
              ENDDO<a name='1845'>
           ENDDO<a name='1846'>
        ENDDO<a name='1847'>
      ENDIF<a name='1848'>
<a name='1849'>
      IF (jbe - jtf .lt. spec_zone) THEN<a name='1850'>
<font color=#447700>! Y-end boundary<a name='1851'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf<a name='1852'>
           b_dist = jbe - j<a name='1853'>
           b_limit = b_dist<a name='1854'>
           IF(periodic_x)b_limit = 0<a name='1855'>
           DO k = kts, ktf<a name='1856'>
              DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1857'>
                 field_bdy_tend_ye(i,k,b_dist+1) = field_bdy_tend_ye(i,k,b_dist+1) * &amp; <a name='1858'>
                                                   (1.0 + field_scalar_perturb(i,min(k,kme_stoch),j))<a name='1859'>
              ENDDO<a name='1860'>
           ENDDO<a name='1861'>
        ENDDO<a name='1862'>
      ENDIF<a name='1863'>
<a name='1864'>
    IF(.NOT.periodic_x)THEN<a name='1865'>
<a name='1866'>
      IF (its - ibs .lt. spec_zone) THEN<a name='1867'>
<font color=#447700>! X-start boundary<a name='1868'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='1869'>
           b_dist = i - ibs<a name='1870'>
           DO k = kts, ktf<a name='1871'>
              DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1872'>
                 field_bdy_tend_xs(j,k,b_dist+1) = field_bdy_tend_xs(j,k,b_dist+1) * &amp; <a name='1873'>
                                                   (1.0 + field_scalar_perturb(i,min(k,kme_stoch),j))<a name='1874'>
              ENDDO<a name='1875'>
           ENDDO<a name='1876'>
        ENDDO<a name='1877'>
      ENDIF<a name='1878'>
<a name='1879'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='1880'>
<font color=#447700>! X-end boundary<a name='1881'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='1882'>
           b_dist = ibe - i<a name='1883'>
           DO k = kts, ktf<a name='1884'>
             DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1885'>
                 field_bdy_tend_xe(j,k,b_dist+1) = field_bdy_tend_xe(j,k,b_dist+1) * (1.0 + field_scalar_perturb(i,k,j))<a name='1886'>
              ENDDO<a name='1887'>
           ENDDO<a name='1888'>
        ENDDO<a name='1889'>
      ENDIF<a name='1890'>
<a name='1891'>
    ENDIF  <font color=#447700>!  IF(.NOT.periodic_x)THEN<a name='1892'></font>
<a name='1893'>
   END SUBROUTINE spec_bdytend_perturb_chem<a name='1894'>
<a name='1895'>
<font color=#447700>!------------------------------------------------------------------------<a name='1896'></font>
<a name='1897'>
<A NAME='SPEC_BDYFIELD'><A href='../../html_code/share/module_bc.F.html#SPEC_BDYFIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1898'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdyfield</font>   ( field,                     &amp; <A href='../../call_to/SPEC_BDYFIELD.html' TARGET='index'>1</A><a name='1899'>
                               field_bdy_xs, field_bdy_xe,           &amp;<a name='1900'>
                               field_bdy_ys, field_bdy_ye,           &amp;<a name='1901'>
                               variable_in, config_flags,  &amp; <a name='1902'>
                               spec_bdy_width, spec_zone, &amp;<a name='1903'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='1904'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='1905'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='1906'></font>
                               its,ite, jts,jte, kts,kte )<a name='1907'>
<a name='1908'>
<font color=#447700>!  This subroutine sets the tendencies in the boundary specified region.<a name='1909'></font>
<font color=#447700>!  spec_bdy_width is only used to dimension the boundary arrays.<a name='1910'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='1911'></font>
<font color=#447700>!  (JD July 2000)<a name='1912'></font>
<a name='1913'>
      IMPLICIT NONE<a name='1914'>
<a name='1915'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='1916'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='1917'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='1918'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='1919'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone<a name='1920'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='1921'>
<a name='1922'>
<a name='1923'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(OUT  ) :: field<a name='1924'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='1925'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye<a name='1926'>
      TYPE( grid_config_rec_type ) config_flags<a name='1927'>
<a name='1928'>
      CHARACTER  :: variable<a name='1929'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf<a name='1930'>
      INTEGER    :: b_dist, b_limit<a name='1931'>
      LOGICAL    :: periodic_x<a name='1932'>
<a name='1933'>
      periodic_x = config_flags%periodic_x<a name='1934'>
<a name='1935'>
      variable = variable_in<a name='1936'>
<a name='1937'>
      IF (variable == 'U') variable = 'u'<a name='1938'>
      IF (variable == 'V') variable = 'v'<a name='1939'>
      IF (variable == 'M') variable = 'm'<a name='1940'>
      IF (variable == 'H') variable = 'h'<a name='1941'>
<a name='1942'>
      ibs = ids<a name='1943'>
      ibe = ide-1<a name='1944'>
      itf = min(ite,ide-1)<a name='1945'>
      jbs = jds<a name='1946'>
      jbe = jde-1<a name='1947'>
      jtf = min(jte,jde-1)<a name='1948'>
      ktf = kde-1<a name='1949'>
      IF (variable == 'u') ibe = ide<a name='1950'>
      IF (variable == 'u') itf = min(ite,ide)<a name='1951'>
      IF (variable == 'v') jbe = jde<a name='1952'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='1953'>
      IF (variable == 'm') ktf = kte<a name='1954'>
      IF (variable == 'h') ktf = kte<a name='1955'>
<a name='1956'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='1957'>
<font color=#447700>! Y-start boundary<a name='1958'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='1959'>
          b_dist = j - jbs<a name='1960'>
          b_limit = b_dist<a name='1961'>
          IF(periodic_x)b_limit = 0<a name='1962'>
          DO k = kts, ktf<a name='1963'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1964'>
              field(i,k,j) = field_bdy_ys(i, k, b_dist+1)<a name='1965'>
            ENDDO<a name='1966'>
          ENDDO<a name='1967'>
        ENDDO<a name='1968'>
      ENDIF<a name='1969'>
      IF (jbe - jtf .lt. spec_zone) THEN<a name='1970'>
<font color=#447700>! Y-end boundary<a name='1971'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf<a name='1972'>
          b_dist = jbe - j<a name='1973'>
          b_limit = b_dist<a name='1974'>
          IF(periodic_x)b_limit = 0<a name='1975'>
          DO k = kts, ktf<a name='1976'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='1977'>
              field(i,k,j) = field_bdy_ye(i, k, b_dist+1)<a name='1978'>
            ENDDO<a name='1979'>
          ENDDO<a name='1980'>
        ENDDO<a name='1981'>
      ENDIF<a name='1982'>
<a name='1983'>
    IF(.NOT.periodic_x)THEN<a name='1984'>
      IF (its - ibs .lt. spec_zone) THEN<a name='1985'>
<font color=#447700>! X-start boundary<a name='1986'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='1987'>
          b_dist = i - ibs<a name='1988'>
          DO k = kts, ktf<a name='1989'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='1990'>
              field(i,k,j) = field_bdy_xs(j, k, b_dist+1)<a name='1991'>
            ENDDO<a name='1992'>
          ENDDO<a name='1993'>
        ENDDO<a name='1994'>
      ENDIF<a name='1995'>
<a name='1996'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='1997'>
<font color=#447700>! X-end boundary<a name='1998'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='1999'>
          b_dist = ibe - i<a name='2000'>
          DO k = kts, ktf<a name='2001'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2002'>
              field(i,k,j) = field_bdy_xe(j, k, b_dist+1)<a name='2003'>
            ENDDO<a name='2004'>
          ENDDO<a name='2005'>
        ENDDO<a name='2006'>
      ENDIF<a name='2007'>
    ENDIF<a name='2008'>
<a name='2009'>
   END SUBROUTINE spec_bdyfield<a name='2010'>
<font color=#447700>!------------------------------------------------------------------------<a name='2011'></font>
<a name='2012'>
<A NAME='SPEC_BDYUPDATE'><A href='../../html_code/share/module_bc.F.html#SPEC_BDYUPDATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2013'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdyupdate</font>(  field,      &amp; <A href='../../call_to/SPEC_BDYUPDATE.html' TARGET='index'>6</A><a name='2014'>
                               field_tend, dt,            &amp;<a name='2015'>
                               variable_in, config_flags, &amp; <a name='2016'>
                               spec_zone,                  &amp;<a name='2017'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2018'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2019'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2020'></font>
                               its,ite, jts,jte, kts,kte )<a name='2021'>
<a name='2022'>
<font color=#447700>!  This subroutine adds the tendencies in the boundary specified region.<a name='2023'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='2024'></font>
<font color=#447700>!  (JD August 2000)<a name='2025'></font>
<a name='2026'>
      IMPLICIT NONE<a name='2027'>
<a name='2028'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='2029'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='2030'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='2031'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='2032'>
      INTEGER,      INTENT(IN   )    :: spec_zone<a name='2033'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='2034'>
      REAL,         INTENT(IN   )    :: dt<a name='2035'>
<a name='2036'>
<a name='2037'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field<a name='2038'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: field_tend<a name='2039'>
      TYPE( grid_config_rec_type ) config_flags<a name='2040'>
<a name='2041'>
      CHARACTER  :: variable<a name='2042'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf<a name='2043'>
      INTEGER    :: b_dist, b_limit<a name='2044'>
      LOGICAL    :: periodic_x<a name='2045'>
<a name='2046'>
      periodic_x = config_flags%periodic_x<a name='2047'>
<a name='2048'>
      variable = variable_in<a name='2049'>
<a name='2050'>
      IF (variable == 'U') variable = 'u'<a name='2051'>
      IF (variable == 'V') variable = 'v'<a name='2052'>
      IF (variable == 'M') variable = 'm'<a name='2053'>
      IF (variable == 'H') variable = 'h'<a name='2054'>
<a name='2055'>
      ibs = ids<a name='2056'>
      ibe = ide-1<a name='2057'>
      itf = min(ite,ide-1)<a name='2058'>
      jbs = jds<a name='2059'>
      jbe = jde-1<a name='2060'>
      jtf = min(jte,jde-1)<a name='2061'>
      ktf = kde-1<a name='2062'>
      IF (variable == 'u') ibe = ide<a name='2063'>
      IF (variable == 'u') itf = min(ite,ide)<a name='2064'>
      IF (variable == 'v') jbe = jde<a name='2065'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='2066'>
      IF (variable == 'm') ktf = kte<a name='2067'>
      IF (variable == 'h') ktf = kte<a name='2068'>
<a name='2069'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='2070'>
<font color=#447700>! Y-start boundary<a name='2071'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='2072'>
          b_dist = j - jbs<a name='2073'>
          b_limit = b_dist<a name='2074'>
          IF(periodic_x)b_limit = 0<a name='2075'>
          DO k = kts, ktf<a name='2076'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2077'>
              field(i,k,j) = field(i,k,j) + dt*field_tend(i,k,j) <a name='2078'>
            ENDDO<a name='2079'>
          ENDDO<a name='2080'>
        ENDDO<a name='2081'>
      ENDIF <a name='2082'>
      IF (jbe - jtf .lt. spec_zone) THEN <a name='2083'>
<font color=#447700>! Y-end boundary <a name='2084'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf <a name='2085'>
          b_dist = jbe - j <a name='2086'>
          b_limit = b_dist<a name='2087'>
          IF(periodic_x)b_limit = 0<a name='2088'>
          DO k = kts, ktf <a name='2089'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2090'>
              field(i,k,j) = field(i,k,j) + dt*field_tend(i,k,j) <a name='2091'>
            ENDDO<a name='2092'>
          ENDDO<a name='2093'>
        ENDDO<a name='2094'>
      ENDIF <a name='2095'>
<a name='2096'>
    IF(.NOT.periodic_x)THEN<a name='2097'>
      IF (its - ibs .lt. spec_zone) THEN<a name='2098'>
<font color=#447700>! X-start boundary<a name='2099'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='2100'>
          b_dist = i - ibs<a name='2101'>
          DO k = kts, ktf<a name='2102'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2103'>
              field(i,k,j) = field(i,k,j) + dt*field_tend(i,k,j) <a name='2104'>
            ENDDO<a name='2105'>
          ENDDO<a name='2106'>
        ENDDO<a name='2107'>
      ENDIF <a name='2108'>
<a name='2109'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='2110'>
<font color=#447700>! X-end boundary<a name='2111'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='2112'>
          b_dist = ibe - i<a name='2113'>
          DO k = kts, ktf<a name='2114'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2115'>
              field(i,k,j) = field(i,k,j) + dt*field_tend(i,k,j) <a name='2116'>
            ENDDO<a name='2117'>
          ENDDO<a name='2118'>
        ENDDO<a name='2119'>
      ENDIF <a name='2120'>
    ENDIF<a name='2121'>
<a name='2122'>
   END SUBROUTINE spec_bdyupdate<a name='2123'>
<font color=#447700>!------------------------------------------------------------------------<a name='2124'></font>
<A NAME='SPEC_BDY_FINAL'><A href='../../html_code/share/module_bc.F.html#SPEC_BDY_FINAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2125'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>spec_bdy_final</font>   ( field, mu, c1, c2, msf,               &amp; <A href='../../call_to/SPEC_BDY_FINAL.html' TARGET='index'>10</A><a name='2126'>
                                field_bdy_xs, field_bdy_xe,            &amp;<a name='2127'>
                                field_bdy_ys, field_bdy_ye,            &amp;<a name='2128'>
                                field_bdy_tend_xs, field_bdy_tend_xe,  &amp;<a name='2129'>
                                field_bdy_tend_ys, field_bdy_tend_ye,  &amp;<a name='2130'>
                                variable_in, config_flags,             &amp;<a name='2131'>
                                spec_bdy_width, spec_zone,             &amp;<a name='2132'>
                                dtbc,                       &amp;<a name='2133'>
                                ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2134'></font>
                                ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2135'></font>
                                ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2136'></font>
                                its,ite, jts,jte, kts,kte   )<a name='2137'>
<a name='2138'>
<font color=#447700>!  This subroutine forces the boundary to match the boundary file value for specified<a name='2139'></font>
<font color=#447700>!  boundary conditions. Added to avoid drift due to round-off error using just tendencies. <a name='2140'></font>
<font color=#447700>!  Boundary-file coupling is u,v,w:mu/msf  other fields:mu<a name='2141'></font>
<font color=#447700>!  Correctly  staggered mu and msf are passed in (as seen in small_step_finish)<a name='2142'></font>
<font color=#447700>!  spec_bdy_width is only used to dimension the boundary arrays.<a name='2143'></font>
<font color=#447700>!  relax_zone is the inner edge of the boundary relaxation zone treated here.<a name='2144'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are not changed here.<a name='2145'></font>
<font color=#447700>!  (JD Jan 2015)<a name='2146'></font>
<a name='2147'>
      IMPLICIT NONE<a name='2148'>
<a name='2149'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='2150'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='2151'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='2152'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='2153'>
      INTEGER,      INTENT(IN   )    :: spec_bdy_width, spec_zone<a name='2154'>
      REAL,         INTENT(IN   )    :: dtbc<a name='2155'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='2156'>
<a name='2157'>
<a name='2158'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field<a name='2159'>
      REAL,  DIMENSION( ims:ime , jms:jme), INTENT(IN   ) :: mu, msf<a name='2160'>
      REAL,  DIMENSION( kms:kme ), INTENT(IN   ) :: c1, c2<a name='2161'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_xs, field_bdy_xe<a name='2162'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_ys, field_bdy_ye<a name='2163'>
      REAL,  DIMENSION( jms:jme , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_xs, field_bdy_tend_xe<a name='2164'>
      REAL,  DIMENSION( ims:ime , kds:kde , spec_bdy_width ), INTENT(IN   ) :: field_bdy_tend_ys, field_bdy_tend_ye<a name='2165'>
      TYPE( grid_config_rec_type ) config_flags<a name='2166'>
<a name='2167'>
      CHARACTER  :: variable<a name='2168'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf, im1, ip1<a name='2169'>
      INTEGER    :: b_dist, b_limit<a name='2170'>
      REAL       :: bfield, xmsf, xmu<a name='2171'>
      LOGICAL    :: periodic_x, msfcouple, mucouple<a name='2172'>
<a name='2173'>
      periodic_x = config_flags%periodic_x<a name='2174'>
      variable = variable_in<a name='2175'>
<a name='2176'>
      IF (variable == 'U') variable = 'u'<a name='2177'>
      IF (variable == 'V') variable = 'v'<a name='2178'>
      IF (variable == 'W') variable = 'w'<a name='2179'>
      IF (variable == 'M') variable = 'm'<a name='2180'>
      IF (variable == 'T') variable = 't'<a name='2181'>
      IF (variable == 'H') variable = 'h'<a name='2182'>
<a name='2183'>
      ibs = ids<a name='2184'>
      ibe = ide-1<a name='2185'>
      itf = min(ite,ide-1)<a name='2186'>
      jbs = jds<a name='2187'>
      jbe = jde-1<a name='2188'>
      jtf = min(jte,jde-1)<a name='2189'>
      ktf = kde-1<a name='2190'>
      IF (variable == 'u') ibe = ide<a name='2191'>
      IF (variable == 'u') itf = min(ite,ide)<a name='2192'>
      IF (variable == 'v') jbe = jde<a name='2193'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='2194'>
      IF (variable == 'm') ktf = kde<a name='2195'>
      IF (variable == 'h') ktf = kde<a name='2196'>
      IF (variable == 'w') ktf = kde<a name='2197'>
<a name='2198'>
      msfcouple = .false.<a name='2199'>
      mucouple = .true.<a name='2200'>
      IF (variable == 'u' .OR. variable == 'v' .OR. variable == 'w')msfcouple = .true.<a name='2201'>
      IF (variable == 'm' )mucouple = .false.<a name='2202'>
      xmsf = 1.<a name='2203'>
      xmu = 1.<a name='2204'>
<a name='2205'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='2206'>
<font color=#447700>! Y-start boundary<a name='2207'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='2208'>
          b_dist = j - jbs<a name='2209'>
          b_limit = b_dist<a name='2210'>
          IF(periodic_x)b_limit = 0<a name='2211'>
          DO k = kts, ktf<a name='2212'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2213'>
              bfield = field_bdy_ys(i, k, b_dist+1) &amp;<a name='2214'>
                   + dtbc * field_bdy_tend_ys(i, k, b_dist+1) <a name='2215'>
              if(msfcouple)xmsf = msf(i,j)<a name='2216'>
              if(mucouple)xmu = mu(i,j)<a name='2217'>
              field(i,k,j) = xmsf*bfield/xmu<a name='2218'>
            ENDDO<a name='2219'>
          ENDDO<a name='2220'>
        ENDDO<a name='2221'>
      ENDIF<a name='2222'>
<a name='2223'>
      IF (jbe - jtf .lt. spec_zone) THEN<a name='2224'>
<font color=#447700>! Y-end boundary<a name='2225'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf<a name='2226'>
          b_dist = jbe - j<a name='2227'>
          b_limit = b_dist<a name='2228'>
          IF(periodic_x)b_limit = 0<a name='2229'>
          DO k = kts, ktf<a name='2230'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2231'>
              bfield = field_bdy_ye(i, k, b_dist+1) &amp;<a name='2232'>
                   + dtbc * field_bdy_tend_ye(i, k, b_dist+1) <a name='2233'>
              if(msfcouple)xmsf = msf(i,j)<a name='2234'>
              if(mucouple)xmu = mu(i,j)<a name='2235'>
              field(i,k,j) = xmsf*bfield/xmu<a name='2236'>
            ENDDO<a name='2237'>
          ENDDO<a name='2238'>
        ENDDO<a name='2239'>
      ENDIF<a name='2240'>
<a name='2241'>
    IF(.NOT.periodic_x)THEN<a name='2242'>
      IF (its - ibs .lt. spec_zone) THEN<a name='2243'>
<font color=#447700>! X-start boundary<a name='2244'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='2245'>
          b_dist = i - ibs<a name='2246'>
          DO k = kts, ktf<a name='2247'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2248'>
              bfield = field_bdy_xs(j, k, b_dist+1) &amp;<a name='2249'>
                   + dtbc * field_bdy_tend_xs(j, k, b_dist+1) <a name='2250'>
              if(msfcouple)xmsf = msf(i,j)<a name='2251'>
              if(mucouple)xmu = mu(i,j)<a name='2252'>
              field(i,k,j) = xmsf*bfield/xmu<a name='2253'>
            ENDDO<a name='2254'>
          ENDDO<a name='2255'>
        ENDDO<a name='2256'>
      ENDIF<a name='2257'>
<a name='2258'>
     IF (ibe - itf .lt. spec_zone) THEN<a name='2259'>
<font color=#447700>! X-end boundary<a name='2260'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='2261'>
          b_dist = ibe - i<a name='2262'>
          DO k = kts, ktf<a name='2263'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2264'>
              bfield = field_bdy_xe(j, k, b_dist+1) &amp;<a name='2265'>
                   + dtbc * field_bdy_tend_xe(j, k, b_dist+1) <a name='2266'>
              if(msfcouple)xmsf = msf(i,j)<a name='2267'>
              if(mucouple)xmu = mu(i,j)<a name='2268'>
              field(i,k,j) = xmsf*bfield/xmu<a name='2269'>
            ENDDO<a name='2270'>
          ENDDO<a name='2271'>
        ENDDO<a name='2272'>
      ENDIF<a name='2273'>
    ENDIF<a name='2274'>
<a name='2275'>
   END SUBROUTINE spec_bdy_final<a name='2276'>
<font color=#447700>!------------------------------------------------------------------------<a name='2277'></font>
<a name='2278'>
<A NAME='ZERO_GRAD_BDY'><A href='../../html_code/share/module_bc.F.html#ZERO_GRAD_BDY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2279'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>zero_grad_bdy</font> (  field,                     &amp; <A href='../../call_to/ZERO_GRAD_BDY.html' TARGET='index'>1</A><a name='2280'>
                               variable_in, config_flags, &amp; <a name='2281'>
                               spec_zone,                  &amp;<a name='2282'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2283'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2284'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2285'></font>
                               its,ite, jts,jte, kts,kte )<a name='2286'>
<a name='2287'>
<font color=#447700>!  This subroutine sets zero gradient conditions in the boundary specified region.<a name='2288'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='2289'></font>
<font color=#447700>!  (JD August 2000)<a name='2290'></font>
<a name='2291'>
      IMPLICIT NONE<a name='2292'>
<a name='2293'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='2294'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='2295'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='2296'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='2297'>
      INTEGER,      INTENT(IN   )    :: spec_zone<a name='2298'>
      CHARACTER,    INTENT(IN   )    :: variable_in<a name='2299'>
<a name='2300'>
<a name='2301'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field<a name='2302'>
      TYPE( grid_config_rec_type ) config_flags<a name='2303'>
<a name='2304'>
      CHARACTER  :: variable<a name='2305'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf, i_inner, j_inner<a name='2306'>
      INTEGER    :: b_dist, b_limit<a name='2307'>
      LOGICAL    :: periodic_x<a name='2308'>
<a name='2309'>
      periodic_x = config_flags%periodic_x<a name='2310'>
<a name='2311'>
      variable = variable_in<a name='2312'>
<a name='2313'>
      IF (variable == 'U') variable = 'u'<a name='2314'>
      IF (variable == 'V') variable = 'v'<a name='2315'>
<a name='2316'>
      ibs = ids<a name='2317'>
      ibe = ide-1<a name='2318'>
      itf = min(ite,ide-1)<a name='2319'>
      jbs = jds<a name='2320'>
      jbe = jde-1<a name='2321'>
      jtf = min(jte,jde-1)<a name='2322'>
      ktf = kde-1<a name='2323'>
      IF (variable == 'u') ibe = ide<a name='2324'>
      IF (variable == 'u') itf = min(ite,ide)<a name='2325'>
      IF (variable == 'v') jbe = jde<a name='2326'>
      IF (variable == 'v') jtf = min(jte,jde)<a name='2327'>
      IF (variable == 'w') ktf = kde<a name='2328'>
<a name='2329'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='2330'>
<font color=#447700>! Y-start boundary<a name='2331'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='2332'>
          b_dist = j - jbs<a name='2333'>
          b_limit = b_dist<a name='2334'>
          IF(periodic_x)b_limit = 0<a name='2335'>
          DO k = kts, ktf<a name='2336'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2337'>
              i_inner = max(i,ibs+spec_zone)<a name='2338'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2339'>
              IF(periodic_x)i_inner = i<a name='2340'>
              field(i,k,j) = field(i_inner,k,jbs+spec_zone)<a name='2341'>
            ENDDO<a name='2342'>
          ENDDO<a name='2343'>
        ENDDO<a name='2344'>
      ENDIF <a name='2345'>
      IF (jbe - jtf .lt. spec_zone) THEN <a name='2346'>
<font color=#447700>! Y-end boundary <a name='2347'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf <a name='2348'>
          b_dist = jbe - j <a name='2349'>
          b_limit = b_dist<a name='2350'>
          IF(periodic_x)b_limit = 0<a name='2351'>
          DO k = kts, ktf <a name='2352'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2353'>
              i_inner = max(i,ibs+spec_zone)<a name='2354'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2355'>
              IF(periodic_x)i_inner = i<a name='2356'>
              field(i,k,j) = field(i_inner,k,jbe-spec_zone)<a name='2357'>
            ENDDO<a name='2358'>
          ENDDO<a name='2359'>
        ENDDO<a name='2360'>
      ENDIF <a name='2361'>
<a name='2362'>
    IF(.NOT.periodic_x)THEN<a name='2363'>
      IF (its - ibs .lt. spec_zone) THEN<a name='2364'>
<font color=#447700>! X-start boundary<a name='2365'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='2366'>
          b_dist = i - ibs<a name='2367'>
          DO k = kts, ktf<a name='2368'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2369'>
              j_inner = max(j,jbs+spec_zone)<a name='2370'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2371'>
              field(i,k,j) = field(ibs+spec_zone,k,j_inner)<a name='2372'>
            ENDDO<a name='2373'>
          ENDDO<a name='2374'>
        ENDDO<a name='2375'>
      ENDIF <a name='2376'>
<a name='2377'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='2378'>
<font color=#447700>! X-end boundary<a name='2379'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='2380'>
          b_dist = ibe - i<a name='2381'>
          DO k = kts, ktf<a name='2382'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2383'>
              j_inner = max(j,jbs+spec_zone)<a name='2384'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2385'>
              field(i,k,j) = field(ibe-spec_zone,k,j_inner)<a name='2386'>
            ENDDO<a name='2387'>
          ENDDO<a name='2388'>
        ENDDO<a name='2389'>
      ENDIF <a name='2390'>
    ENDIF<a name='2391'>
<a name='2392'>
   END SUBROUTINE zero_grad_bdy<a name='2393'>
<font color=#447700>!------------------------------------------------------------------------<a name='2394'></font>
<a name='2395'>
<A NAME='FLOW_DEP_BDY'><A href='../../html_code/share/module_bc.F.html#FLOW_DEP_BDY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2396'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>flow_dep_bdy</font>  (  field,                     &amp; <A href='../../call_to/FLOW_DEP_BDY.html' TARGET='index'>4</A><a name='2397'>
                               u, v, config_flags, &amp; <a name='2398'>
                               spec_zone,                  &amp;<a name='2399'>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2400'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2401'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2402'></font>
                               its,ite, jts,jte, kts,kte )<a name='2403'>
<a name='2404'>
<font color=#447700>!  This subroutine sets zero gradient conditions for outflow and zero value<a name='2405'></font>
<font color=#447700>!  for inflow in the boundary specified region. Note that field must be unstaggered.<a name='2406'></font>
<font color=#447700>!  The velocities, u and v, will only be used to check their sign (coupled vels OK)<a name='2407'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='2408'></font>
<font color=#447700>!  (JD August 2000)<a name='2409'></font>
<a name='2410'>
      IMPLICIT NONE<a name='2411'>
<a name='2412'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='2413'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='2414'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='2415'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='2416'>
      INTEGER,      INTENT(IN   )    :: spec_zone<a name='2417'>
<a name='2418'>
<a name='2419'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field<a name='2420'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: u<a name='2421'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: v<a name='2422'>
      TYPE( grid_config_rec_type ) config_flags<a name='2423'>
<a name='2424'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf, i_inner, j_inner<a name='2425'>
      INTEGER    :: b_dist, b_limit<a name='2426'>
      LOGICAL    :: periodic_x<a name='2427'>
<a name='2428'>
      periodic_x = config_flags%periodic_x<a name='2429'>
<a name='2430'>
      ibs = ids<a name='2431'>
      ibe = ide-1<a name='2432'>
      itf = min(ite,ide-1)<a name='2433'>
      jbs = jds<a name='2434'>
      jbe = jde-1<a name='2435'>
      jtf = min(jte,jde-1)<a name='2436'>
      ktf = kde-1<a name='2437'>
<a name='2438'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='2439'>
<font color=#447700>! Y-start boundary<a name='2440'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='2441'>
          b_dist = j - jbs<a name='2442'>
          b_limit = b_dist<a name='2443'>
          IF(periodic_x)b_limit = 0<a name='2444'>
          DO k = kts, ktf<a name='2445'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2446'>
              i_inner = max(i,ibs+spec_zone)<a name='2447'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2448'>
              IF(periodic_x)i_inner = i<a name='2449'>
              IF(v(i,k,j) .lt. 0.)THEN<a name='2450'>
                field(i,k,j) = field(i_inner,k,jbs+spec_zone)<a name='2451'>
              ELSE<a name='2452'>
                field(i,k,j) = 0.<a name='2453'>
              ENDIF<a name='2454'>
            ENDDO<a name='2455'>
          ENDDO<a name='2456'>
        ENDDO<a name='2457'>
      ENDIF <a name='2458'>
      IF (jbe - jtf .lt. spec_zone) THEN <a name='2459'>
<font color=#447700>! Y-end boundary <a name='2460'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf <a name='2461'>
          b_dist = jbe - j <a name='2462'>
          b_limit = b_dist<a name='2463'>
          IF(periodic_x)b_limit = 0<a name='2464'>
          DO k = kts, ktf <a name='2465'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2466'>
              i_inner = max(i,ibs+spec_zone)<a name='2467'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2468'>
              IF(periodic_x)i_inner = i<a name='2469'>
              IF(v(i,k,j+1) .gt. 0.)THEN<a name='2470'>
                field(i,k,j) = field(i_inner,k,jbe-spec_zone)<a name='2471'>
              ELSE<a name='2472'>
                field(i,k,j) = 0.<a name='2473'>
              ENDIF<a name='2474'>
            ENDDO<a name='2475'>
          ENDDO<a name='2476'>
        ENDDO<a name='2477'>
      ENDIF <a name='2478'>
<a name='2479'>
    IF(.NOT.periodic_x)THEN<a name='2480'>
      IF (its - ibs .lt. spec_zone) THEN<a name='2481'>
<font color=#447700>! X-start boundary<a name='2482'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='2483'>
          b_dist = i - ibs<a name='2484'>
          DO k = kts, ktf<a name='2485'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2486'>
              j_inner = max(j,jbs+spec_zone)<a name='2487'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2488'>
              IF(u(i,k,j) .lt. 0.)THEN<a name='2489'>
                field(i,k,j) = field(ibs+spec_zone,k,j_inner)<a name='2490'>
              ELSE<a name='2491'>
                field(i,k,j) = 0.<a name='2492'>
              ENDIF<a name='2493'>
            ENDDO<a name='2494'>
          ENDDO<a name='2495'>
        ENDDO<a name='2496'>
      ENDIF <a name='2497'>
<a name='2498'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='2499'>
<font color=#447700>! X-end boundary<a name='2500'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='2501'>
          b_dist = ibe - i<a name='2502'>
          DO k = kts, ktf<a name='2503'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2504'>
              j_inner = max(j,jbs+spec_zone)<a name='2505'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2506'>
              IF(u(i+1,k,j) .gt. 0.)THEN<a name='2507'>
                field(i,k,j) = field(ibe-spec_zone,k,j_inner)<a name='2508'>
              ELSE<a name='2509'>
                field(i,k,j) = 0.<a name='2510'>
              ENDIF<a name='2511'>
            ENDDO<a name='2512'>
          ENDDO<a name='2513'>
        ENDDO<a name='2514'>
      ENDIF <a name='2515'>
    ENDIF<a name='2516'>
<a name='2517'>
   END SUBROUTINE flow_dep_bdy<a name='2518'>
<a name='2519'>
<font color=#447700>!------------------------------------------------------------------------------<a name='2520'></font>
<a name='2521'>
<A NAME='FLOW_DEP_BDY_QNN'><A href='../../html_code/share/module_bc.F.html#FLOW_DEP_BDY_QNN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2522'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>flow_dep_bdy_qnn</font>  (  field,          &amp; <A href='../../call_to/FLOW_DEP_BDY_QNN.html' TARGET='index'>1</A><a name='2523'>
                               u, v, config_flags, &amp;<a name='2524'>
                               spec_zone,                  &amp;<a name='2525'>
                               ccn_conc,                   &amp; <font color=#447700>! RAS<a name='2526'></font>
                               ids,ide, jds,jde, kds,kde,  &amp; <font color=#447700>! domain dims<a name='2527'></font>
                               ims,ime, jms,jme, kms,kme,  &amp; <font color=#447700>! memory dims<a name='2528'></font>
                               ips,ipe, jps,jpe, kps,kpe,  &amp; <font color=#447700>! patch  dims<a name='2529'></font>
                               its,ite, jts,jte, kts,kte )<a name='2530'>
<a name='2531'>
<font color=#447700>!  This subroutine sets zero gradient conditions for outflow and zero value<a name='2532'></font>
<font color=#447700>!  for inflow in the boundary specified region. Note that field must be unstaggered.<a name='2533'></font>
<font color=#447700>!  The velocities, u and v, will only be used to check their sign (coupled vels OK)<a name='2534'></font>
<font color=#447700>!  spec_zone is the width of the outer specified b.c.s that are set here.<a name='2535'></font>
<font color=#447700>!  (JD August 2000)<a name='2536'></font>
<a name='2537'>
      IMPLICIT NONE<a name='2538'>
<a name='2539'>
      INTEGER,      INTENT(IN   )    :: ids,ide, jds,jde, kds,kde<a name='2540'>
      INTEGER,      INTENT(IN   )    :: ims,ime, jms,jme, kms,kme<a name='2541'>
      INTEGER,      INTENT(IN   )    :: ips,ipe, jps,jpe, kps,kpe<a name='2542'>
      INTEGER,      INTENT(IN   )    :: its,ite, jts,jte, kts,kte<a name='2543'>
      INTEGER,      INTENT(IN   )    :: spec_zone<a name='2544'>
      REAL,         INTENT(IN   )    :: ccn_conc <font color=#447700>! RAS<a name='2545'></font>
<a name='2546'>
<a name='2547'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(INOUT) :: field<a name='2548'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: u<a name='2549'>
      REAL,  DIMENSION( ims:ime , kms:kme , jms:jme ), INTENT(IN   ) :: v<a name='2550'>
      TYPE( grid_config_rec_type ) config_flags<a name='2551'>
<a name='2552'>
      INTEGER    :: i, j, k, ibs, ibe, jbs, jbe, itf, jtf, ktf, i_inner, j_inner<a name='2553'>
      INTEGER    :: b_dist, b_limit<a name='2554'>
      LOGICAL    :: periodic_x<a name='2555'>
<a name='2556'>
      periodic_x = config_flags%periodic_x<a name='2557'>
<a name='2558'>
      ibs = ids<a name='2559'>
      ibe = ide-1<a name='2560'>
      itf = min(ite,ide-1)<a name='2561'>
      jbs = jds<a name='2562'>
      jbe = jde-1<a name='2563'>
      jtf = min(jte,jde-1)<a name='2564'>
      ktf = kde-1<a name='2565'>
<a name='2566'>
      IF (jts - jbs .lt. spec_zone) THEN<a name='2567'>
<font color=#447700>! Y-start boundary<a name='2568'></font>
        DO j = jts, min(jtf,jbs+spec_zone-1)<a name='2569'>
          b_dist = j - jbs<a name='2570'>
          b_limit = b_dist<a name='2571'>
          IF(periodic_x)b_limit = 0<a name='2572'>
          DO k = kts, ktf<a name='2573'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2574'>
              i_inner = max(i,ibs+spec_zone)<a name='2575'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2576'>
              IF(periodic_x)i_inner = i<a name='2577'>
              IF(v(i,k,j) .lt. 0.)THEN<a name='2578'>
                field(i,k,j) = field(i_inner,k,jbs+spec_zone)<a name='2579'>
              ELSE<a name='2580'>
                field(i,k,j) = ccn_conc <font color=#447700>! RAS<a name='2581'></font>
              ENDIF<a name='2582'>
            ENDDO<a name='2583'>
          ENDDO<a name='2584'>
        ENDDO <a name='2585'>
      ENDIF   <a name='2586'>
      IF (jbe - jtf .lt. spec_zone) THEN<a name='2587'>
<font color=#447700>! Y-end boundary<a name='2588'></font>
        DO j = max(jts,jbe-spec_zone+1), jtf<a name='2589'>
          b_dist = jbe - j<a name='2590'>
          b_limit = b_dist<a name='2591'>
          IF(periodic_x)b_limit = 0<a name='2592'>
          DO k = kts, ktf<a name='2593'>
            DO i = max(its,b_limit+ibs), min(itf,ibe-b_limit)<a name='2594'>
              i_inner = max(i,ibs+spec_zone)<a name='2595'>
              i_inner = min(i_inner,ibe-spec_zone)<a name='2596'>
              IF(periodic_x)i_inner = i<a name='2597'>
              IF(v(i,k,j+1) .gt. 0.)THEN<a name='2598'>
                field(i,k,j) = field(i_inner,k,jbe-spec_zone)<a name='2599'>
              ELSE<a name='2600'>
                field(i,k,j) = ccn_conc <font color=#447700>! RAS<a name='2601'></font>
              ENDIF<a name='2602'>
            ENDDO<a name='2603'>
          ENDDO<a name='2604'>
        ENDDO<a name='2605'>
      ENDIF<a name='2606'>
<a name='2607'>
    IF(.NOT.periodic_x)THEN<a name='2608'>
      IF (its - ibs .lt. spec_zone) THEN<a name='2609'>
<font color=#447700>! X-start boundary<a name='2610'></font>
        DO i = its, min(itf,ibs+spec_zone-1)<a name='2611'>
          b_dist = i - ibs<a name='2612'>
          DO k = kts, ktf<a name='2613'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2614'>
              j_inner = max(j,jbs+spec_zone)<a name='2615'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2616'>
              IF(u(i,k,j) .lt. 0.)THEN<a name='2617'>
                field(i,k,j) = field(ibs+spec_zone,k,j_inner)<a name='2618'>
              ELSE<a name='2619'>
                field(i,k,j) = ccn_conc <font color=#447700>! RAS<a name='2620'></font>
              ENDIF<a name='2621'>
            ENDDO<a name='2622'>
          ENDDO<a name='2623'>
        ENDDO<a name='2624'>
      ENDIF<a name='2625'>
<a name='2626'>
      IF (ibe - itf .lt. spec_zone) THEN<a name='2627'>
<font color=#447700>! X-end boundary<a name='2628'></font>
        DO i = max(its,ibe-spec_zone+1), itf<a name='2629'>
          b_dist = ibe - i<a name='2630'>
          DO k = kts, ktf<a name='2631'>
            DO j = max(jts,b_dist+jbs+1), min(jtf,jbe-b_dist-1)<a name='2632'>
              j_inner = max(j,jbs+spec_zone)<a name='2633'>
              j_inner = min(j_inner,jbe-spec_zone)<a name='2634'>
              IF(u(i+1,k,j) .gt. 0.)THEN<a name='2635'>
                field(i,k,j) = field(ibe-spec_zone,k,j_inner)<a name='2636'>
              ELSE<a name='2637'>
                field(i,k,j) = ccn_conc <font color=#447700>! RAS<a name='2638'></font>
              ENDIF<a name='2639'>
            ENDDO<a name='2640'>
          ENDDO<a name='2641'>
        ENDDO<a name='2642'>
      ENDIF<a name='2643'>
    ENDIF<a name='2644'>
<a name='2645'>
   END SUBROUTINE flow_dep_bdy_qnn<a name='2646'>
<a name='2647'>
<font color=#447700>!------------------------------------------------------------------------------<a name='2648'></font>
<a name='2649'>
<A NAME='STUFF_BDY_NEW'><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2650'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdy_new</font> ( data3d , space_bdy_xs, space_bdy_xe, space_bdy_ys, space_bdy_ye, &amp; <A href='../../call_to/STUFF_BDY_NEW.html' TARGET='index'>1</A>,<A href='../../call_from/STUFF_BDY_NEW.html' TARGET='index'>1</A><a name='2651'>
                             char_stagger , &amp;<a name='2652'>
                             spec_bdy_width , &amp;<a name='2653'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='2654'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='2655'>
                             its, ite, jts, jte, kts, kte )<a name='2656'>
 <a name='2657'>
 <font color=#447700>!  This routine puts the data in the 3d arrays into the proper locations<a name='2658'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='2659'></font>
 <a name='2660'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_185"><a name='2661'>
    <a name='2662'>
    IMPLICIT NONE<a name='2663'>
 <a name='2664'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='2665'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='2666'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='2667'>
    INTEGER , INTENT(IN) :: spec_bdy_width<a name='2668'>
    REAL , DIMENSION(ims:ime,kms:kme,jms:jme) , INTENT(IN) :: data3d<a name='2669'>
    REAL , DIMENSION(jms:jme,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_xs, space_bdy_xe<a name='2670'>
    REAL , DIMENSION(ims:ime,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_ys, space_bdy_ye<a name='2671'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='2672'>
 <a name='2673'>
    INTEGER :: i , ii , j , jj , k<a name='2674'>
 <a name='2675'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='2676'></font>
 <a name='2677'>
    <font color=#447700>!  X start boundary<a name='2678'></font>
 <a name='2679'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='2680'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2681'>
       DO k = kds , kde<a name='2682'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2683'>
          space_bdy_xs(j,k,i) = data3d(i,k,j)<a name='2684'>
       END DO<a name='2685'>
       END DO<a name='2686'>
       END DO<a name='2687'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2688'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2689'>
       DO k = kds , kde<a name='2690'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2691'>
          space_bdy_xs(j,k,i) = data3d(i,k,j)<a name='2692'>
       END DO<a name='2693'>
       END DO<a name='2694'>
       END DO<a name='2695'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='2696'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='2697'>
       DO k = kds , kde - 1<a name='2698'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2699'>
          space_bdy_xs(j,k,i) = data3d(i,k,j)<a name='2700'>
       END DO<a name='2701'>
       END DO<a name='2702'>
       END DO<a name='2703'>
    ELSE<a name='2704'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2705'>
       DO k = kds , kde - 1<a name='2706'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2707'>
          space_bdy_xs(j,k,i) = data3d(i,k,j)<a name='2708'>
       END DO<a name='2709'>
       END DO<a name='2710'>
       END DO<a name='2711'>
    END IF<a name='2712'>
 <a name='2713'>
    <font color=#447700>!  X end boundary<a name='2714'></font>
 <a name='2715'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='2716'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2717'>
       DO k = kds , kde - 1<a name='2718'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='2719'>
          ii = ide - i + 1<a name='2720'>
          space_bdy_xe(j,k,ii) = data3d(i,k,j)<a name='2721'>
       END DO<a name='2722'>
       END DO<a name='2723'>
       END DO<a name='2724'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='2725'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='2726'>
       DO k = kds , kde - 1<a name='2727'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2728'>
          ii = ide - i<a name='2729'>
          space_bdy_xe(j,k,ii) = data3d(i,k,j)<a name='2730'>
       END DO<a name='2731'>
       END DO<a name='2732'>
       END DO<a name='2733'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='2734'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2735'>
       DO k = kds , kde<a name='2736'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2737'>
          ii = ide - i<a name='2738'>
          space_bdy_xe(j,k,ii) = data3d(i,k,j)<a name='2739'>
       END DO<a name='2740'>
       END DO<a name='2741'>
       END DO<a name='2742'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2743'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2744'>
       DO k = kds , kde<a name='2745'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2746'>
          ii = ide - i<a name='2747'>
          space_bdy_xe(j,k,ii) = data3d(i,k,j)<a name='2748'>
       END DO<a name='2749'>
       END DO<a name='2750'>
       END DO<a name='2751'>
    ELSE<a name='2752'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2753'>
       DO k = kds , kde - 1<a name='2754'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2755'>
          ii = ide - i<a name='2756'>
          space_bdy_xe(j,k,ii) = data3d(i,k,j)<a name='2757'>
       END DO<a name='2758'>
       END DO<a name='2759'>
       END DO<a name='2760'>
    END IF<a name='2761'>
 <a name='2762'>
    <font color=#447700>!  Y start boundary<a name='2763'></font>
 <a name='2764'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='2765'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2766'>
       DO k = kds , kde<a name='2767'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2768'>
          space_bdy_ys(i,k,j) = data3d(i,k,j)<a name='2769'>
       END DO<a name='2770'>
       END DO<a name='2771'>
       END DO<a name='2772'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2773'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2774'>
       DO k = kds , kde<a name='2775'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2776'>
          space_bdy_ys(i,k,j) = data3d(i,k,j)<a name='2777'>
       END DO<a name='2778'>
       END DO<a name='2779'>
       END DO<a name='2780'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='2781'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2782'>
       DO k = kds , kde - 1<a name='2783'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='2784'>
          space_bdy_ys(i,k,j) = data3d(i,k,j)<a name='2785'>
       END DO<a name='2786'>
       END DO<a name='2787'>
       END DO<a name='2788'>
    ELSE<a name='2789'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2790'>
       DO k = kds , kde - 1<a name='2791'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2792'>
          space_bdy_ys(i,k,j) = data3d(i,k,j)<a name='2793'>
       END DO<a name='2794'>
       END DO<a name='2795'>
       END DO<a name='2796'>
    END IF<a name='2797'>
 <a name='2798'>
    <font color=#447700>!  Y end boundary<a name='2799'></font>
 <a name='2800'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='2801'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='2802'>
       DO k = kds , kde - 1<a name='2803'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2804'>
          jj = jde - j + 1<a name='2805'>
          space_bdy_ye(i,k,jj) = data3d(i,k,j)<a name='2806'>
       END DO<a name='2807'>
       END DO<a name='2808'>
       END DO<a name='2809'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='2810'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='2811'>
       DO k = kds , kde - 1<a name='2812'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='2813'>
          jj = jde - j<a name='2814'>
          space_bdy_ye(i,k,jj) = data3d(i,k,j)<a name='2815'>
       END DO<a name='2816'>
       END DO<a name='2817'>
       END DO<a name='2818'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='2819'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='2820'>
       DO k = kds , kde<a name='2821'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2822'>
          jj = jde - j<a name='2823'>
          space_bdy_ye(i,k,jj) = data3d(i,k,j)<a name='2824'>
       END DO<a name='2825'>
       END DO<a name='2826'>
       END DO<a name='2827'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2828'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='2829'>
       DO k = kds , kde<a name='2830'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2831'>
          jj = jde - j<a name='2832'>
          space_bdy_ye(i,k,jj) = data3d(i,k,j)<a name='2833'>
       END DO<a name='2834'>
       END DO<a name='2835'>
       END DO<a name='2836'>
    ELSE<a name='2837'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='2838'>
       DO k = kds , kde - 1<a name='2839'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2840'>
          jj = jde - j<a name='2841'>
          space_bdy_ye(i,k,jj) = data3d(i,k,j)<a name='2842'>
       END DO<a name='2843'>
       END DO<a name='2844'>
       END DO<a name='2845'>
    END IF<a name='2846'>
    <a name='2847'>
 END SUBROUTINE stuff_bdy_new<a name='2848'>
 <a name='2849'>
<A NAME='STUFF_BDYTEND_NEW'><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_NEW' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2850'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdytend_new</font> ( data3dnew , data3dold , time_diff , &amp; <A href='../../call_to/STUFF_BDYTEND_NEW.html' TARGET='index'>1</A>,<A href='../../call_from/STUFF_BDYTEND_NEW.html' TARGET='index'>1</A><a name='2851'>
                             space_bdy_xs, space_bdy_xe, space_bdy_ys, space_bdy_ye, &amp;<a name='2852'>
                             char_stagger , &amp;<a name='2853'>
                             spec_bdy_width , &amp;<a name='2854'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='2855'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='2856'>
                             its, ite, jts, jte, kts, kte )<a name='2857'>
 <a name='2858'>
 <font color=#447700>!  This routine puts the tendency data into the proper locations<a name='2859'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='2860'></font>
 <a name='2861'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_NEW' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_186"><a name='2862'>
    <a name='2863'>
    IMPLICIT NONE<a name='2864'>
 <a name='2865'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='2866'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='2867'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='2868'>
    INTEGER , INTENT(IN) :: spec_bdy_width<a name='2869'>
    REAL , DIMENSION(ims:ime,kms:kme,jms:jme) , INTENT(IN) :: data3dnew , data3dold<a name='2870'>
    REAL , DIMENSION(jms:jme,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_xs, space_bdy_xe<a name='2871'>
    REAL , DIMENSION(ims:ime,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_ys, space_bdy_ye<a name='2872'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='2873'>
    REAL , INTENT(IN) :: time_diff <font color=#447700>! seconds<a name='2874'></font>
 <a name='2875'>
    INTEGER :: i , ii , j , jj , k<a name='2876'>
<a name='2877'>
#if 0<a name='2878'>
    <font color=#447700>!  Here is the easy way to zero out the boundary tendencies for<a name='2879'></font>
    <font color=#447700>!  time-dependent boundaries.<a name='2880'></font>
<a name='2881'>
    space_bdy_xs = 0.<a name='2882'>
    space_bdy_xe = 0.<a name='2883'>
    space_bdy_ys = 0.<a name='2884'>
    space_bdy_ye = 0.<a name='2885'>
    return<a name='2886'>
#else<a name='2887'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='2888'></font>
 <a name='2889'>
    <font color=#447700>!  X start boundary<a name='2890'></font>
 <a name='2891'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='2892'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2893'>
       DO k = kds , kde<a name='2894'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2895'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2896'>
       END DO<a name='2897'>
       END DO<a name='2898'>
       END DO<a name='2899'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2900'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2901'>
       DO k = kds , kde<a name='2902'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2903'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2904'>
       END DO<a name='2905'>
       END DO<a name='2906'>
       END DO<a name='2907'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='2908'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='2909'>
       DO k = kds , kde - 1<a name='2910'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2911'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2912'>
       END DO<a name='2913'>
       END DO<a name='2914'>
       END DO<a name='2915'>
    ELSE<a name='2916'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2917'>
       DO k = kds , kde - 1<a name='2918'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='2919'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2920'>
       END DO<a name='2921'>
       END DO<a name='2922'>
       END DO<a name='2923'>
    END IF<a name='2924'>
 <a name='2925'>
    <font color=#447700>!  X end boundary<a name='2926'></font>
 <a name='2927'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='2928'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2929'>
       DO k = kds , kde - 1<a name='2930'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='2931'>
          ii = ide - i + 1<a name='2932'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2933'>
       END DO<a name='2934'>
       END DO<a name='2935'>
       END DO<a name='2936'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='2937'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='2938'>
       DO k = kds , kde - 1<a name='2939'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2940'>
          ii = ide - i<a name='2941'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2942'>
       END DO<a name='2943'>
       END DO<a name='2944'>
       END DO<a name='2945'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='2946'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2947'>
       DO k = kds , kde<a name='2948'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2949'>
          ii = ide - i<a name='2950'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2951'>
       END DO<a name='2952'>
       END DO<a name='2953'>
       END DO<a name='2954'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2955'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2956'>
       DO k = kds , kde<a name='2957'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2958'>
          ii = ide - i<a name='2959'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2960'>
       END DO<a name='2961'>
       END DO<a name='2962'>
       END DO<a name='2963'>
    ELSE<a name='2964'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='2965'>
       DO k = kds , kde - 1<a name='2966'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='2967'>
          ii = ide - i<a name='2968'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2969'>
       END DO<a name='2970'>
       END DO<a name='2971'>
       END DO<a name='2972'>
    END IF<a name='2973'>
 <a name='2974'>
    <font color=#447700>!  Y start boundary<a name='2975'></font>
 <a name='2976'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='2977'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2978'>
       DO k = kds , kde<a name='2979'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2980'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2981'>
       END DO<a name='2982'>
       END DO<a name='2983'>
       END DO<a name='2984'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='2985'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2986'>
       DO k = kds , kde<a name='2987'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='2988'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2989'>
       END DO<a name='2990'>
       END DO<a name='2991'>
       END DO<a name='2992'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='2993'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='2994'>
       DO k = kds , kde - 1<a name='2995'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='2996'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='2997'>
       END DO<a name='2998'>
       END DO<a name='2999'>
       END DO<a name='3000'>
    ELSE<a name='3001'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3002'>
       DO k = kds , kde - 1<a name='3003'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3004'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3005'>
       END DO<a name='3006'>
       END DO<a name='3007'>
       END DO<a name='3008'>
    END IF<a name='3009'>
 <a name='3010'>
    <font color=#447700>!  Y end boundary<a name='3011'></font>
 <a name='3012'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='3013'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='3014'>
       DO k = kds , kde - 1<a name='3015'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3016'>
          jj = jde - j + 1<a name='3017'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3018'>
       END DO<a name='3019'>
       END DO<a name='3020'>
       END DO<a name='3021'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3022'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3023'>
       DO k = kds , kde - 1<a name='3024'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3025'>
          jj = jde - j<a name='3026'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3027'>
       END DO<a name='3028'>
       END DO<a name='3029'>
       END DO<a name='3030'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3031'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3032'>
       DO k = kds , kde<a name='3033'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3034'>
          jj = jde - j<a name='3035'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3036'>
       END DO<a name='3037'>
       END DO<a name='3038'>
       END DO<a name='3039'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3040'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3041'>
       DO k = kds , kde<a name='3042'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3043'>
          jj = jde - j<a name='3044'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3045'>
       END DO<a name='3046'>
       END DO<a name='3047'>
       END DO<a name='3048'>
    ELSE<a name='3049'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3050'>
       DO k = kds , kde - 1<a name='3051'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3052'>
          jj = jde - j<a name='3053'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3054'>
       END DO<a name='3055'>
       END DO<a name='3056'>
       END DO<a name='3057'>
    END IF<a name='3058'>
#endif<a name='3059'>
    <a name='3060'>
 END SUBROUTINE stuff_bdytend_new<a name='3061'>
<a name='3062'>
<font color=#447700>!--- old versions for use with modules that use the old bdy data structures ---<a name='3063'></font>
<a name='3064'>
<A NAME='STUFF_BDY_OLD'><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_OLD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3065'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdy_old</font> ( data3d , space_bdy , char_stagger , &amp; <A href='../../call_to/STUFF_BDY_OLD.html' TARGET='index'>1</A>,<A href='../../call_from/STUFF_BDY_OLD.html' TARGET='index'>1</A><a name='3066'>
                             ijds , ijde , spec_bdy_width , &amp;<a name='3067'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='3068'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='3069'>
                             its, ite, jts, jte, kts, kte )<a name='3070'>
 <a name='3071'>
 <font color=#447700>!  This routine puts the data in the 3d arrays into the proper locations<a name='3072'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='3073'></font>
 <a name='3074'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_OLD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_187"><a name='3075'>
    <a name='3076'>
    IMPLICIT NONE<a name='3077'>
 <a name='3078'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='3079'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='3080'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='3081'>
    INTEGER , INTENT(IN) :: ijds , ijde , spec_bdy_width<a name='3082'>
    REAL , DIMENSION(ims:ime,kms:kme,jms:jme) , INTENT(IN) :: data3d<a name='3083'>
    REAL , DIMENSION(ijds:ijde,kds:kde,spec_bdy_width,4) , INTENT(OUT) :: space_bdy<a name='3084'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='3085'>
 <a name='3086'>
    INTEGER :: i , ii , j , jj , k<a name='3087'>
 <a name='3088'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='3089'></font>
 <a name='3090'>
    <font color=#447700>!  X start boundary<a name='3091'></font>
 <a name='3092'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3093'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3094'>
       DO k = kds , kde<a name='3095'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3096'>
          space_bdy(j,k,i,P_XSB) = data3d(i,k,j)<a name='3097'>
       END DO<a name='3098'>
       END DO<a name='3099'>
       END DO<a name='3100'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3101'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3102'>
       DO k = kds , kde<a name='3103'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3104'>
          space_bdy(j,k,i,P_XSB) = data3d(i,k,j)<a name='3105'>
       END DO<a name='3106'>
       END DO<a name='3107'>
       END DO<a name='3108'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3109'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3110'>
       DO k = kds , kde - 1<a name='3111'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3112'>
          space_bdy(j,k,i,P_XSB) = data3d(i,k,j)<a name='3113'>
       END DO<a name='3114'>
       END DO<a name='3115'>
       END DO<a name='3116'>
    ELSE<a name='3117'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3118'>
       DO k = kds , kde - 1<a name='3119'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3120'>
          space_bdy(j,k,i,P_XSB) = data3d(i,k,j)<a name='3121'>
       END DO<a name='3122'>
       END DO<a name='3123'>
       END DO<a name='3124'>
    END IF<a name='3125'>
 <a name='3126'>
    <font color=#447700>!  X end boundary<a name='3127'></font>
 <a name='3128'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='3129'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3130'>
       DO k = kds , kde - 1<a name='3131'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='3132'>
          ii = ide - i + 1<a name='3133'>
          space_bdy(j,k,ii,P_XEB) = data3d(i,k,j)<a name='3134'>
       END DO<a name='3135'>
       END DO<a name='3136'>
       END DO<a name='3137'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3138'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3139'>
       DO k = kds , kde - 1<a name='3140'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3141'>
          ii = ide - i<a name='3142'>
          space_bdy(j,k,ii,P_XEB) = data3d(i,k,j)<a name='3143'>
       END DO<a name='3144'>
       END DO<a name='3145'>
       END DO<a name='3146'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3147'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3148'>
       DO k = kds , kde<a name='3149'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3150'>
          ii = ide - i<a name='3151'>
          space_bdy(j,k,ii,P_XEB) = data3d(i,k,j)<a name='3152'>
       END DO<a name='3153'>
       END DO<a name='3154'>
       END DO<a name='3155'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3156'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3157'>
       DO k = kds , kde<a name='3158'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3159'>
          ii = ide - i<a name='3160'>
          space_bdy(j,k,ii,P_XEB) = data3d(i,k,j)<a name='3161'>
       END DO<a name='3162'>
       END DO<a name='3163'>
       END DO<a name='3164'>
    ELSE<a name='3165'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3166'>
       DO k = kds , kde - 1<a name='3167'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3168'>
          ii = ide - i<a name='3169'>
          space_bdy(j,k,ii,P_XEB) = data3d(i,k,j)<a name='3170'>
       END DO<a name='3171'>
       END DO<a name='3172'>
       END DO<a name='3173'>
    END IF<a name='3174'>
 <a name='3175'>
    <font color=#447700>!  Y start boundary<a name='3176'></font>
 <a name='3177'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3178'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3179'>
       DO k = kds , kde<a name='3180'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3181'>
          space_bdy(i,k,j,P_YSB) = data3d(i,k,j)<a name='3182'>
       END DO<a name='3183'>
       END DO<a name='3184'>
       END DO<a name='3185'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3186'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3187'>
       DO k = kds , kde<a name='3188'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3189'>
          space_bdy(i,k,j,P_YSB) = data3d(i,k,j)<a name='3190'>
       END DO<a name='3191'>
       END DO<a name='3192'>
       END DO<a name='3193'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3194'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3195'>
       DO k = kds , kde - 1<a name='3196'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3197'>
          space_bdy(i,k,j,P_YSB) = data3d(i,k,j)<a name='3198'>
       END DO<a name='3199'>
       END DO<a name='3200'>
       END DO<a name='3201'>
    ELSE<a name='3202'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3203'>
       DO k = kds , kde - 1<a name='3204'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3205'>
          space_bdy(i,k,j,P_YSB) = data3d(i,k,j)<a name='3206'>
       END DO<a name='3207'>
       END DO<a name='3208'>
       END DO<a name='3209'>
    END IF<a name='3210'>
 <a name='3211'>
    <font color=#447700>!  Y end boundary<a name='3212'></font>
 <a name='3213'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='3214'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='3215'>
       DO k = kds , kde - 1<a name='3216'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3217'>
          jj = jde - j + 1<a name='3218'>
          space_bdy(i,k,jj,P_YEB) = data3d(i,k,j)<a name='3219'>
       END DO<a name='3220'>
       END DO<a name='3221'>
       END DO<a name='3222'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3223'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3224'>
       DO k = kds , kde - 1<a name='3225'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3226'>
          jj = jde - j<a name='3227'>
          space_bdy(i,k,jj,P_YEB) = data3d(i,k,j)<a name='3228'>
       END DO<a name='3229'>
       END DO<a name='3230'>
       END DO<a name='3231'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3232'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3233'>
       DO k = kds , kde<a name='3234'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3235'>
          jj = jde - j<a name='3236'>
          space_bdy(i,k,jj,P_YEB) = data3d(i,k,j)<a name='3237'>
       END DO<a name='3238'>
       END DO<a name='3239'>
       END DO<a name='3240'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3241'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3242'>
       DO k = kds , kde<a name='3243'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3244'>
          jj = jde - j<a name='3245'>
          space_bdy(i,k,jj,P_YEB) = data3d(i,k,j)<a name='3246'>
       END DO<a name='3247'>
       END DO<a name='3248'>
       END DO<a name='3249'>
    ELSE<a name='3250'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3251'>
       DO k = kds , kde - 1<a name='3252'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3253'>
          jj = jde - j<a name='3254'>
          space_bdy(i,k,jj,P_YEB) = data3d(i,k,j)<a name='3255'>
       END DO<a name='3256'>
       END DO<a name='3257'>
       END DO<a name='3258'>
    END IF<a name='3259'>
    <a name='3260'>
 END SUBROUTINE stuff_bdy_old<a name='3261'>
 <a name='3262'>
<A NAME='STUFF_BDYTEND_OLD'><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_OLD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3263'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdytend_old</font> ( data3dnew , data3dold , time_diff , space_bdy , char_stagger , &amp; <A href='../../call_to/STUFF_BDYTEND_OLD.html' TARGET='index'>1</A>,<A href='../../call_from/STUFF_BDYTEND_OLD.html' TARGET='index'>1</A><a name='3264'>
                             ijds , ijde , spec_bdy_width , &amp;<a name='3265'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='3266'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='3267'>
                             its, ite, jts, jte, kts, kte )<a name='3268'>
 <a name='3269'>
 <font color=#447700>!  This routine puts the tendency data into the proper locations<a name='3270'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='3271'></font>
 <a name='3272'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_OLD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_188"><a name='3273'>
    <a name='3274'>
    IMPLICIT NONE<a name='3275'>
 <a name='3276'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='3277'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='3278'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='3279'>
    INTEGER , INTENT(IN) :: ijds , ijde , spec_bdy_width<a name='3280'>
    REAL , DIMENSION(ims:ime,kms:kme,jms:jme) , INTENT(IN) :: data3dnew , data3dold<a name='3281'>
<font color=#447700>!    REAL , DIMENSION(:,:,:,:) , INTENT(OUT) :: space_bdy<a name='3282'></font>
    REAL , DIMENSION(ijds:ijde,kds:kde,spec_bdy_width,4) , INTENT(OUT) :: space_bdy<a name='3283'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='3284'>
    REAL , INTENT(IN) :: time_diff <font color=#447700>! seconds<a name='3285'></font>
 <a name='3286'>
    INTEGER :: i , ii , j , jj , k<a name='3287'>
 <a name='3288'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='3289'></font>
 <a name='3290'>
    <font color=#447700>!  X start boundary<a name='3291'></font>
 <a name='3292'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3293'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3294'>
       DO k = kds , kde<a name='3295'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3296'>
          space_bdy(j,k,i,P_XSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3297'>
<font color=#447700>!         space_bdy(j,k,i,P_XSB) = 0. ! zeroout<a name='3298'></font>
       END DO<a name='3299'>
       END DO<a name='3300'>
       END DO<a name='3301'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3302'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3303'>
       DO k = kds , kde<a name='3304'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3305'>
          space_bdy(j,k,i,P_XSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3306'>
<font color=#447700>!         space_bdy(j,k,i,P_XSB) = 0. ! zeroout<a name='3307'></font>
       END DO<a name='3308'>
       END DO<a name='3309'>
       END DO<a name='3310'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3311'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3312'>
       DO k = kds , kde - 1<a name='3313'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3314'>
          space_bdy(j,k,i,P_XSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3315'>
<font color=#447700>!         space_bdy(j,k,i,P_XSB) = 0. ! zeroout<a name='3316'></font>
       END DO<a name='3317'>
       END DO<a name='3318'>
       END DO<a name='3319'>
    ELSE<a name='3320'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3321'>
       DO k = kds , kde - 1<a name='3322'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3323'>
          space_bdy(j,k,i,P_XSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3324'>
<font color=#447700>!         space_bdy(j,k,i,P_XSB) = 0. ! zeroout<a name='3325'></font>
       END DO<a name='3326'>
       END DO<a name='3327'>
       END DO<a name='3328'>
    END IF<a name='3329'>
 <a name='3330'>
    <font color=#447700>!  X end boundary<a name='3331'></font>
 <a name='3332'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='3333'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3334'>
       DO k = kds , kde - 1<a name='3335'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='3336'>
          ii = ide - i + 1<a name='3337'>
          space_bdy(j,k,ii,P_XEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3338'>
<font color=#447700>!         space_bdy(j,k,ii,P_XEB) = 0. ! zeroout<a name='3339'></font>
       END DO<a name='3340'>
       END DO<a name='3341'>
       END DO<a name='3342'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3343'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3344'>
       DO k = kds , kde - 1<a name='3345'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3346'>
          ii = ide - i<a name='3347'>
          space_bdy(j,k,ii,P_XEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3348'>
<font color=#447700>!         space_bdy(j,k,ii,P_XEB) = 0. ! zeroout<a name='3349'></font>
       END DO<a name='3350'>
       END DO<a name='3351'>
       END DO<a name='3352'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3353'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3354'>
       DO k = kds , kde<a name='3355'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3356'>
          ii = ide - i<a name='3357'>
          space_bdy(j,k,ii,P_XEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3358'>
<font color=#447700>!         space_bdy(j,k,ii,P_XEB) = 0. ! zeroout<a name='3359'></font>
       END DO<a name='3360'>
       END DO<a name='3361'>
       END DO<a name='3362'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3363'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3364'>
       DO k = kds , kde<a name='3365'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3366'>
          ii = ide - i<a name='3367'>
          space_bdy(j,k,ii,P_XEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3368'>
<font color=#447700>!         space_bdy(j,k,ii,P_XEB) = 0. ! zeroout<a name='3369'></font>
       END DO<a name='3370'>
       END DO<a name='3371'>
       END DO<a name='3372'>
    ELSE<a name='3373'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3374'>
       DO k = kds , kde - 1<a name='3375'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3376'>
          ii = ide - i<a name='3377'>
          space_bdy(j,k,ii,P_XEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3378'>
<font color=#447700>!         space_bdy(j,k,ii,P_XEB) = 0. ! zeroout<a name='3379'></font>
       END DO<a name='3380'>
       END DO<a name='3381'>
       END DO<a name='3382'>
    END IF<a name='3383'>
 <a name='3384'>
    <font color=#447700>!  Y start boundary<a name='3385'></font>
 <a name='3386'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3387'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3388'>
       DO k = kds , kde<a name='3389'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3390'>
          space_bdy(i,k,j,P_YSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3391'>
<font color=#447700>!         space_bdy(i,k,j,P_YSB) = 0. ! zeroout<a name='3392'></font>
       END DO<a name='3393'>
       END DO<a name='3394'>
       END DO<a name='3395'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3396'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3397'>
       DO k = kds , kde<a name='3398'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3399'>
          space_bdy(i,k,j,P_YSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3400'>
<font color=#447700>!         space_bdy(i,k,j,P_YSB) = 0. ! zeroout<a name='3401'></font>
       END DO<a name='3402'>
       END DO<a name='3403'>
       END DO<a name='3404'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3405'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3406'>
       DO k = kds , kde - 1<a name='3407'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3408'>
          space_bdy(i,k,j,P_YSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3409'>
<font color=#447700>!         space_bdy(i,k,j,P_YSB) = 0. ! zeroout<a name='3410'></font>
       END DO<a name='3411'>
       END DO<a name='3412'>
       END DO<a name='3413'>
    ELSE<a name='3414'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3415'>
       DO k = kds , kde - 1<a name='3416'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3417'>
          space_bdy(i,k,j,P_YSB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3418'>
<font color=#447700>!         space_bdy(i,k,j,P_YSB) = 0. ! zeroout<a name='3419'></font>
       END DO<a name='3420'>
       END DO<a name='3421'>
       END DO<a name='3422'>
    END IF<a name='3423'>
 <a name='3424'>
    <font color=#447700>!  Y end boundary<a name='3425'></font>
 <a name='3426'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='3427'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='3428'>
       DO k = kds , kde - 1<a name='3429'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3430'>
          jj = jde - j + 1<a name='3431'>
          space_bdy(i,k,jj,P_YEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3432'>
<font color=#447700>!         space_bdy(i,k,jj,P_YEB) = 0. ! zeroout<a name='3433'></font>
       END DO<a name='3434'>
       END DO<a name='3435'>
       END DO<a name='3436'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3437'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3438'>
       DO k = kds , kde - 1<a name='3439'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3440'>
          jj = jde - j<a name='3441'>
          space_bdy(i,k,jj,P_YEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3442'>
<font color=#447700>!         space_bdy(i,k,jj,P_YEB) = 0. ! zeroout<a name='3443'></font>
       END DO<a name='3444'>
       END DO<a name='3445'>
       END DO<a name='3446'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3447'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3448'>
       DO k = kds , kde<a name='3449'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3450'>
          jj = jde - j<a name='3451'>
          space_bdy(i,k,jj,P_YEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3452'>
<font color=#447700>!         space_bdy(i,k,jj,P_YEB) = 0. ! zeroout<a name='3453'></font>
       END DO<a name='3454'>
       END DO<a name='3455'>
       END DO<a name='3456'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3457'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3458'>
       DO k = kds , kde<a name='3459'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3460'>
          jj = jde - j<a name='3461'>
          space_bdy(i,k,jj,P_YEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3462'>
<font color=#447700>!         space_bdy(i,k,jj,P_YEB) = 0. ! zeroout<a name='3463'></font>
       END DO<a name='3464'>
       END DO<a name='3465'>
       END DO<a name='3466'>
    ELSE<a name='3467'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3468'>
       DO k = kds , kde - 1<a name='3469'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3470'>
          jj = jde - j<a name='3471'>
          space_bdy(i,k,jj,P_YEB) = ( data3dnew(i,k,j) - data3dold(i,k,j) ) / time_diff<a name='3472'>
<font color=#447700>!         space_bdy(i,k,jj,P_YEB) = 0. ! zeroout<a name='3473'></font>
       END DO<a name='3474'>
       END DO<a name='3475'>
       END DO<a name='3476'>
    END IF<a name='3477'>
    <a name='3478'>
 END SUBROUTINE stuff_bdytend_old<a name='3479'>
<a name='3480'>
<A NAME='STUFF_BDY_IJK'><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3481'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdy_ijk</font> ( data3d , space_bdy_xs, space_bdy_xe, &amp; <A href='../../call_to/STUFF_BDY_IJK.html' TARGET='index'>28</A>,<A href='../../call_from/STUFF_BDY_IJK.html' TARGET='index'>1</A><a name='3482'>
                             space_bdy_ys, space_bdy_ye, &amp;<a name='3483'>
                             char_stagger , spec_bdy_width, &amp;<a name='3484'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='3485'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='3486'>
                             its, ite, jts, jte, kts, kte )<a name='3487'>
 <a name='3488'>
 <font color=#447700>!  This routine puts the data in the 3d arrays into the proper locations<a name='3489'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='3490'></font>
 <a name='3491'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDY_IJK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_189"><a name='3492'>
    <a name='3493'>
    IMPLICIT NONE<a name='3494'>
 <a name='3495'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='3496'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='3497'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='3498'>
    INTEGER , INTENT(IN) :: spec_bdy_width<a name='3499'>
    REAL , DIMENSION(ims:ime,jms:jme,kms:kme) , INTENT(IN) :: data3d<a name='3500'>
<font color=#447700>!    REAL , DIMENSION(:,:,:,:) , INTENT(OUT) :: space_bdy<a name='3501'></font>
<font color=#447700>!    REAL , DIMENSION(ijds:ijde,kds:kde,spec_bdy_width,4,1) , INTENT(OUT) :: space_bdy<a name='3502'></font>
    REAL , DIMENSION(jms:jme,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_xs, space_bdy_xe<a name='3503'>
    REAL , DIMENSION(ims:ime,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_ys, space_bdy_ye<a name='3504'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='3505'>
 <a name='3506'>
    INTEGER :: i , ii , j , jj , k<a name='3507'>
 <a name='3508'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='3509'></font>
 <a name='3510'>
    <font color=#447700>!  X start boundary<a name='3511'></font>
 <a name='3512'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3513'>
       DO k = kds , kde<a name='3514'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3515'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3516'>
          space_bdy_xs(j,k,i) = data3d(i,j,k)<a name='3517'>
       END DO<a name='3518'>
       END DO<a name='3519'>
       END DO<a name='3520'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3521'>
       DO k = kds , kde<a name='3522'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3523'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3524'>
          space_bdy_xs(j,k,i) = data3d(i,j,k)<a name='3525'>
       END DO<a name='3526'>
       END DO<a name='3527'>
       END DO<a name='3528'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3529'>
       DO k = kds , kde - 1<a name='3530'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3531'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3532'>
          space_bdy_xs(j,k,i) = data3d(i,j,k)<a name='3533'>
       END DO<a name='3534'>
       END DO<a name='3535'>
       END DO<a name='3536'>
    ELSE<a name='3537'>
       DO k = kds , kde - 1<a name='3538'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3539'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3540'>
          space_bdy_xs(j,k,i) = data3d(i,j,k)<a name='3541'>
       END DO<a name='3542'>
       END DO<a name='3543'>
       END DO<a name='3544'>
    END IF<a name='3545'>
 <a name='3546'>
    <font color=#447700>!  X end boundary<a name='3547'></font>
 <a name='3548'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='3549'>
       DO k = kds , kde - 1<a name='3550'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3551'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='3552'>
          ii = ide - i + 1<a name='3553'>
          space_bdy_xe(j,k,ii) = data3d(i,j,k)<a name='3554'>
       END DO<a name='3555'>
       END DO<a name='3556'>
       END DO<a name='3557'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3558'>
       DO k = kds , kde - 1<a name='3559'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3560'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3561'>
          ii = ide - i<a name='3562'>
          space_bdy_xe(j,k,ii) = data3d(i,j,k)<a name='3563'>
       END DO<a name='3564'>
       END DO<a name='3565'>
       END DO<a name='3566'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3567'>
       DO k = kds , kde<a name='3568'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3569'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3570'>
          ii = ide - i<a name='3571'>
          space_bdy_xe(j,k,ii) = data3d(i,j,k)<a name='3572'>
       END DO<a name='3573'>
       END DO<a name='3574'>
       END DO<a name='3575'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3576'>
       DO k = kds , kde<a name='3577'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3578'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3579'>
          ii = ide - i<a name='3580'>
          space_bdy_xe(j,k,ii) = data3d(i,j,k)<a name='3581'>
       END DO<a name='3582'>
       END DO<a name='3583'>
       END DO<a name='3584'>
    ELSE<a name='3585'>
       DO k = kds , kde - 1<a name='3586'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3587'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3588'>
          ii = ide - i<a name='3589'>
          space_bdy_xe(j,k,ii) = data3d(i,j,k)<a name='3590'>
       END DO<a name='3591'>
       END DO<a name='3592'>
       END DO<a name='3593'>
    END IF<a name='3594'>
 <a name='3595'>
    <font color=#447700>!  Y start boundary<a name='3596'></font>
 <a name='3597'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3598'>
       DO k = kds , kde<a name='3599'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3600'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3601'>
          space_bdy_ys(i,k,j) = data3d(i,j,k)<a name='3602'>
       END DO<a name='3603'>
       END DO<a name='3604'>
       END DO<a name='3605'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3606'>
       DO k = kds , kde<a name='3607'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3608'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3609'>
          space_bdy_ys(i,k,j) = data3d(i,j,k)<a name='3610'>
       END DO<a name='3611'>
       END DO<a name='3612'>
       END DO<a name='3613'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3614'>
       DO k = kds , kde - 1<a name='3615'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3616'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3617'>
          space_bdy_ys(i,k,j) = data3d(i,j,k)<a name='3618'>
       END DO<a name='3619'>
       END DO<a name='3620'>
       END DO<a name='3621'>
    ELSE<a name='3622'>
       DO k = kds , kde - 1<a name='3623'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3624'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3625'>
          space_bdy_ys(i,k,j) = data3d(i,j,k)<a name='3626'>
       END DO<a name='3627'>
       END DO<a name='3628'>
       END DO<a name='3629'>
    END IF<a name='3630'>
 <a name='3631'>
    <font color=#447700>!  Y end boundary<a name='3632'></font>
 <a name='3633'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='3634'>
       DO k = kds , kde - 1<a name='3635'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='3636'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3637'>
          jj = jde - j + 1<a name='3638'>
          space_bdy_ye(i,k,jj) = data3d(i,j,k)<a name='3639'>
       END DO<a name='3640'>
       END DO<a name='3641'>
       END DO<a name='3642'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3643'>
       DO k = kds , kde - 1<a name='3644'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3645'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3646'>
          jj = jde - j<a name='3647'>
          space_bdy_ye(i,k,jj) = data3d(i,j,k)<a name='3648'>
       END DO<a name='3649'>
       END DO<a name='3650'>
       END DO<a name='3651'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3652'>
       DO k = kds , kde<a name='3653'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3654'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3655'>
          jj = jde - j<a name='3656'>
          space_bdy_ye(i,k,jj) = data3d(i,j,k)<a name='3657'>
       END DO<a name='3658'>
       END DO<a name='3659'>
       END DO<a name='3660'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3661'>
       DO k = kds , kde<a name='3662'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3663'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3664'>
          jj = jde - j<a name='3665'>
          space_bdy_ye(i,k,jj) = data3d(i,j,k)<a name='3666'>
       END DO<a name='3667'>
       END DO<a name='3668'>
       END DO<a name='3669'>
    ELSE<a name='3670'>
       DO k = kds , kde - 1<a name='3671'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3672'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3673'>
          jj = jde - j<a name='3674'>
          space_bdy_ye(i,k,jj) = data3d(i,j,k)<a name='3675'>
<font color=#447700>!        if (K .eq. 54 .and. I .eq. 369) then<a name='3676'></font>
<font color=#447700>!	write(0,*) 'N bound i,k,jj,P_YEB,data3d,space_bdy: ', i,k,jj,P_YEB,data3d(I,j,k),space_bdy(i,k,jj,P_YEB,1)<a name='3677'></font>
<font color=#447700>!	endif<a name='3678'></font>
<a name='3679'>
       END DO<a name='3680'>
       END DO<a name='3681'>
       END DO<a name='3682'>
    END IF<a name='3683'>
    <a name='3684'>
 END SUBROUTINE stuff_bdy_ijk<a name='3685'>
 <a name='3686'>
<A NAME='STUFF_BDYTEND_IJK'><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3687'>
 <font color=#993300>SUBROUTINE </font><font color=#cc0000>stuff_bdytend_ijk</font> ( data3dnew , data3dold , time_diff , &amp; <A href='../../call_to/STUFF_BDYTEND_IJK.html' TARGET='index'>14</A>,<A href='../../call_from/STUFF_BDYTEND_IJK.html' TARGET='index'>1</A><a name='3688'>
                             space_bdy_xs, space_bdy_xe, space_bdy_ys, space_bdy_ye, &amp;<a name='3689'>
                             char_stagger , &amp;<a name='3690'>
                             spec_bdy_width , &amp;<a name='3691'>
                             ids, ide, jds, jde, kds, kde , &amp;<a name='3692'>
                             ims, ime, jms, jme, kms, kme , &amp; <a name='3693'>
                             its, ite, jts, jte, kts, kte )<a name='3694'>
 <a name='3695'>
 <font color=#447700>!  This routine puts the tendency data into the proper locations<a name='3696'></font>
 <font color=#447700>!  for the lateral boundary arrays.<a name='3697'></font>
 <a name='3698'>
    USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/share/module_bc.F.html#STUFF_BDYTEND_IJK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_190"><a name='3699'>
    <a name='3700'>
    IMPLICIT NONE<a name='3701'>
 <a name='3702'>
    INTEGER , INTENT(IN) :: ids, ide, jds, jde, kds, kde<a name='3703'>
    INTEGER , INTENT(IN) :: ims, ime, jms, jme, kms, kme<a name='3704'>
    INTEGER , INTENT(IN) :: its, ite, jts, jte, kts, kte<a name='3705'>
    INTEGER , INTENT(IN) :: spec_bdy_width<a name='3706'>
<font color=#447700>!    REAL , DIMENSION(ims:ime,kms:kme,jms:jme) , INTENT(IN) :: data3dnew , data3dold<a name='3707'></font>
    REAL , DIMENSION(ims:ime,jms:jme,kms:kme) , INTENT(IN) :: data3dnew , data3dold<a name='3708'>
    REAL , DIMENSION(jms:jme,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_xs, space_bdy_xe<a name='3709'>
    REAL , DIMENSION(ims:ime,kds:kde,spec_bdy_width) , INTENT(OUT) :: space_bdy_ys, space_bdy_ye<a name='3710'>
<a name='3711'>
    CHARACTER (LEN=1) , INTENT(IN) :: char_stagger<a name='3712'>
    REAL , INTENT(IN) :: time_diff <font color=#447700>! seconds<a name='3713'></font>
 <a name='3714'>
    INTEGER :: i , ii , j , jj , k<a name='3715'>
 <a name='3716'>
    <font color=#447700>!  There are four lateral boundary locations that are stored.<a name='3717'></font>
 <a name='3718'>
    <font color=#447700>!  X start boundary<a name='3719'></font>
 <a name='3720'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3721'>
       DO k = kds , kde<a name='3722'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3723'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3724'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3725'>
       END DO<a name='3726'>
       END DO<a name='3727'>
       END DO<a name='3728'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3729'>
       DO k = kds , kde<a name='3730'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3731'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3732'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3733'>
       END DO<a name='3734'>
       END DO<a name='3735'>
       END DO<a name='3736'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3737'>
       DO k = kds , kde - 1<a name='3738'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3739'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3740'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3741'>
       END DO<a name='3742'>
       END DO<a name='3743'>
       END DO<a name='3744'>
    ELSE<a name='3745'>
       DO k = kds , kde - 1<a name='3746'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3747'>
       DO i = MAX(ids,its) , MIN(ids + spec_bdy_width - 1,ite)<a name='3748'>
          space_bdy_xs(j,k,i) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3749'>
       END DO<a name='3750'>
       END DO<a name='3751'>
       END DO<a name='3752'>
    END IF<a name='3753'>
 <a name='3754'>
    <font color=#447700>!  X end boundary<a name='3755'></font>
 <a name='3756'>
    IF      ( char_stagger .EQ. 'U' ) THEN<a name='3757'>
       DO k = kds , kde - 1<a name='3758'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3759'>
       DO i = MIN(ide,ite) , MAX(ide - spec_bdy_width + 1,its) , -1<a name='3760'>
          ii = ide - i + 1<a name='3761'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3762'>
       END DO<a name='3763'>
       END DO<a name='3764'>
       END DO<a name='3765'>
    ELSE IF ( char_stagger .EQ. 'V' ) THEN<a name='3766'>
       DO k = kds , kde - 1<a name='3767'>
       DO j = MAX(jds,jts) , MIN(jde,jte)<a name='3768'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3769'>
          ii = ide - i<a name='3770'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3771'>
       END DO<a name='3772'>
       END DO<a name='3773'>
       END DO<a name='3774'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3775'>
       DO k = kds , kde<a name='3776'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3777'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3778'>
          ii = ide - i<a name='3779'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3780'>
       END DO<a name='3781'>
       END DO<a name='3782'>
       END DO<a name='3783'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3784'>
       DO k = kds , kde<a name='3785'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3786'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3787'>
          ii = ide - i<a name='3788'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3789'>
       END DO<a name='3790'>
       END DO<a name='3791'>
       END DO<a name='3792'>
    ELSE<a name='3793'>
       DO k = kds , kde - 1<a name='3794'>
       DO j = MAX(jds,jts) , MIN(jde-1,jte)<a name='3795'>
       DO i = MIN(ide - 1,ite) , MAX(ide - spec_bdy_width,its) , -1<a name='3796'>
          ii = ide - i<a name='3797'>
          space_bdy_xe(j,k,ii) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3798'>
       END DO<a name='3799'>
       END DO<a name='3800'>
       END DO<a name='3801'>
    END IF<a name='3802'>
 <a name='3803'>
    <font color=#447700>!  Y start boundary<a name='3804'></font>
 <a name='3805'>
    IF ( char_stagger .EQ. 'W' ) THEN<a name='3806'>
       DO k = kds , kde<a name='3807'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3808'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3809'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3810'>
       END DO<a name='3811'>
       END DO<a name='3812'>
       END DO<a name='3813'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3814'>
       DO k = kds , kde<a name='3815'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3816'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3817'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3818'>
       END DO<a name='3819'>
       END DO<a name='3820'>
       END DO<a name='3821'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3822'>
       DO k = kds , kde - 1<a name='3823'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3824'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3825'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3826'>
       END DO<a name='3827'>
       END DO<a name='3828'>
       END DO<a name='3829'>
    ELSE<a name='3830'>
       DO k = kds , kde - 1<a name='3831'>
       DO j = MAX(jds,jts) , MIN(jds + spec_bdy_width - 1,jte)<a name='3832'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3833'>
          space_bdy_ys(i,k,j) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3834'>
       END DO<a name='3835'>
       END DO<a name='3836'>
       END DO<a name='3837'>
    END IF<a name='3838'>
 <a name='3839'>
    <font color=#447700>!  Y end boundary<a name='3840'></font>
 <a name='3841'>
    IF      ( char_stagger .EQ. 'V' ) THEN<a name='3842'>
       DO k = kds , kde - 1<a name='3843'>
       DO j = MIN(jde,jte) , MAX(jde - spec_bdy_width + 1,jts) , -1<a name='3844'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3845'>
          jj = jde - j + 1<a name='3846'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3847'>
       END DO<a name='3848'>
       END DO<a name='3849'>
       END DO<a name='3850'>
    ELSE IF ( char_stagger .EQ. 'U' ) THEN<a name='3851'>
       DO k = kds , kde - 1<a name='3852'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3853'>
       DO i = MAX(ids,its) , MIN(ide,ite)<a name='3854'>
          jj = jde - j<a name='3855'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3856'>
       END DO<a name='3857'>
       END DO<a name='3858'>
       END DO<a name='3859'>
    ELSE IF ( char_stagger .EQ. 'W' ) THEN<a name='3860'>
       DO k = kds , kde<a name='3861'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3862'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3863'>
          jj = jde - j<a name='3864'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3865'>
       END DO<a name='3866'>
       END DO<a name='3867'>
       END DO<a name='3868'>
    ELSE IF ( char_stagger .EQ. 'M' ) THEN<a name='3869'>
       DO k = kds , kde<a name='3870'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3871'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3872'>
          jj = jde - j<a name='3873'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3874'>
       END DO<a name='3875'>
       END DO<a name='3876'>
       END DO<a name='3877'>
    ELSE<a name='3878'>
       DO k = kds , kde - 1<a name='3879'>
       DO j = MIN(jde-1,jte) , MAX(jde - spec_bdy_width,jts) , -1<a name='3880'>
       DO i = MAX(ids,its) , MIN(ide-1,ite)<a name='3881'>
          jj = jde - j<a name='3882'>
          space_bdy_ye(i,k,jj) = ( data3dnew(i,j,k) - data3dold(i,j,k) ) / time_diff<a name='3883'>
<font color=#447700>!        if (K .eq. 54 .and. I .eq. 369) then<a name='3884'></font>
<font color=#447700>!	write(0,*) 'N bound i,k,jj,data3dnew,data3dold: ', i,k,jj,data3dnew(I,j,k),data3dold(i,j,k)<a name='3885'></font>
<font color=#447700>!	endif<a name='3886'></font>
       END DO<a name='3887'>
       END DO<a name='3888'>
       END DO<a name='3889'>
    END IF<a name='3890'>
    <a name='3891'>
 END SUBROUTINE stuff_bdytend_ijk<a name='3892'>
<a name='3893'>
END MODULE module_bc<a name='3894'>
<a name='3895'>
<A NAME='GET_BDYZONE_X'><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_X' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3896'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_bdyzone_x</font> ( bzx ) <A href='../../call_to/GET_BDYZONE_X.html' TARGET='index'>1</A>,<A href='../../call_from/GET_BDYZONE_X.html' TARGET='index'>1</A><a name='3897'>
  USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_X' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_20"><a name='3898'>
  IMPLICIT NONE<a name='3899'>
  INTEGER bzx<a name='3900'>
  bzx = bdyzone_x<a name='3901'>
END SUBROUTINE get_bdyzone_x<a name='3902'>
<a name='3903'>
<A NAME='GET_BDYZONE_Y'><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_Y' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3904'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_bdyzone_y</font> ( bzy) <A href='../../call_to/GET_BDYZONE_Y.html' TARGET='index'>1</A>,<A href='../../call_from/GET_BDYZONE_Y.html' TARGET='index'>1</A><a name='3905'>
  USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_Y' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_21"><a name='3906'>
  IMPLICIT NONE<a name='3907'>
  INTEGER bzy<a name='3908'>
  bzy = bdyzone_y<a name='3909'>
END SUBROUTINE get_bdyzone_y<a name='3910'>
<a name='3911'>
<A NAME='GET_BDYZONE'><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3912'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_bdyzone</font> ( bz),<A href='../../call_from/GET_BDYZONE.html' TARGET='index'>1</A><a name='3913'>
  USE <A href='../../html_code/share/module_bc.F.html#MODULE_BC'>module_bc</A><A href='../../html_code/share/module_bc.F.html#GET_BDYZONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_BC_22"><a name='3914'>
  IMPLICIT NONE<a name='3915'>
  INTEGER bz<a name='3916'>
  bz = bdyzone<a name='3917'>
END SUBROUTINE get_bdyzone<a name='3918'>
</pre></body></html>