<HTML> <BODY BGCOLOR=#bbeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!-----------------------------------------------------------------------<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!NCEP_MESO:MODEL_LAYER: BOUNDARY CONDITION UPDATES<a name='4'></font>
<font color=#447700>!<a name='5'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='6'></font>
<font color=#447700>!<a name='7'></font>
#include "<A href='../../html_code/include/nmm_loop_basemacros.h.html'>nmm_loop_basemacros.h</A>"<A NAME="nmm_loop_basemacros.h_1"><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#module_BNDRY_COND.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='8'>
#include "<A href='../../html_code/include/nmm_loop_macros.h.html'>nmm_loop_macros.h</A>"<A NAME="nmm_loop_macros.h_2"><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#module_BNDRY_COND.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='9'>
<font color=#447700>!<a name='10'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='11'></font>
<font color=#447700>!<a name='12'></font>
<A NAME='MODULE_BNDRY_COND'><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MODULE_BNDRY_COND' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='13'>
      <font color=#993300>MODULE </font><font color=#cc0000>MODULE_BNDRY_COND</font> <A href='../../call_to/MODULE_BNDRY_COND.html' TARGET='index'>1</A><a name='14'>
<font color=#447700>!<a name='15'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='16'></font>
      USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>MODULE_STATE_DESCRIPTION</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#module_BNDRY_COND.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_21"><a name='17'>
      USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>MODULE_MODEL_CONSTANTS</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#module_BNDRY_COND.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_22"><a name='18'>
<font color=#447700>!-----------------------------------------------------------------------<a name='19'></font>
      REAL :: D06666=0.06666666<a name='20'>
<font color=#447700>!-----------------------------------------------------------------------<a name='21'></font>
<font color=#447700>!<a name='22'></font>
      CONTAINS<a name='23'>
<font color=#447700>!<a name='24'></font>
<font color=#447700>!***********************************************************************<a name='25'></font>
<A NAME='MASS_BOUNDARY'><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='26'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>MASS_BOUNDARY</font>(GRIDID,NTSD,DT0,NEST,NBC,NBOCO,LAST_TIME,TSPH    &amp;  <A href='../../call_to/MASS_BOUNDARY.html' TARGET='index'>1</A>,<A href='../../call_from/MASS_BOUNDARY.html' TARGET='index'>24</A><a name='27'>
     &amp;                ,LB,ETA1,ETA2,PDTOP,PT,RES                        &amp;<a name='28'>
     &amp;                ,PD_BXS, PD_BXE, PD_BYS, PD_BYE                   &amp;<a name='29'>
     &amp;                ,T_BXS, T_BXE, T_BYS, T_BYE                       &amp;<a name='30'>
     &amp;                ,Q_BXS, Q_BXE, Q_BYS, Q_BYE                       &amp;<a name='31'>
     &amp;                ,U_BXS, U_BXE, U_BYS, U_BYE                       &amp;<a name='32'>
     &amp;                ,V_BXS, V_BXE, V_BYS, V_BYE                       &amp;<a name='33'>
     &amp;                ,Q2_BXS, Q2_BXE, Q2_BYS, Q2_BYE                   &amp;<a name='34'>
     &amp;                ,PD_BTXS, PD_BTXE, PD_BTYS, PD_BTYE               &amp;<a name='35'>
     &amp;                ,T_BTXS, T_BTXE, T_BTYS, T_BTYE                   &amp;<a name='36'>
     &amp;                ,Q_BTXS, Q_BTXE, Q_BTYS, Q_BTYE                   &amp;<a name='37'>
     &amp;                ,U_BTXS, U_BTXE, U_BTYS, U_BTYE                   &amp;<a name='38'>
     &amp;                ,V_BTXS, V_BTXE, V_BTYS, V_BTYE                   &amp;<a name='39'>
     &amp;                ,Q2_BTXS, Q2_BTXE, Q2_BTYS, Q2_BTYE               &amp;<a name='40'>
     &amp;                ,PD,T,Q,Q2,PINT                                   &amp;<a name='41'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='42'></font>
#ifdef IDEAL_NMM_TC<a name='43'>
     &amp;                ,SM_BXS, SM_BXE, SM_BYS, SM_BYE                   &amp;<a name='44'>
     &amp;                ,SM_BTXS, SM_BTXE, SM_BTYS, SM_BTYE               &amp;<a name='45'>
     &amp;                ,SM                                               &amp;<a name='46'>
     &amp;                ,TH                                               &amp;<a name='47'>
#endif<a name='48'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='49'></font>
     &amp;                ,SPEC_BDY_WIDTH,Z                                 &amp;  <a name='50'>
     &amp;                ,IHE,IHW,IVE,IVW                                  &amp;<a name='51'>
     &amp;                ,IDS,IDE,JDS,JDE,KDS,KDE                          &amp;<a name='52'>
     &amp;                ,IMS,IME,JMS,JME,KMS,KME                          &amp;<a name='53'>
     &amp;                ,ITS,ITE,JTS,JTE,KTS,KTE)<a name='54'>
<font color=#447700>!***********************************************************************<a name='55'></font>
<font color=#447700>!$$$  SUBPROGRAM DOCUMENTATION BLOCK<a name='56'></font>
<font color=#447700>!                .      .    .     <a name='57'></font>
<font color=#447700>! SUBPROGRAM:    BOCOH       UPDATE MASS POINTS ON BOUNDARY<a name='58'></font>
<font color=#447700>!   PRGRMMR: JANJIC          ORG: W/NP22     DATE: 94-03-08<a name='59'></font>
<font color=#447700>!     <a name='60'></font>
<font color=#447700>! ABSTRACT:<a name='61'></font>
<font color=#447700>!     TEMPERATURE, SPECIFIC HUMIDITY, AND SURFACE PRESSURE<a name='62'></font>
<font color=#447700>!     ARE UPDATED ON THE DOMAIN BOUNDARY BY APPLYING THE<a name='63'></font>
<font color=#447700>!     PRE-COMPUTED TENDENCIES AT EACH TIME STEP.<a name='64'></font>
<font color=#447700>!     <a name='65'></font>
<font color=#447700>! PROGRAM HISTORY LOG:<a name='66'></font>
<font color=#447700>!   87-??-??  MESINGER   - ORIGINATOR<a name='67'></font>
<font color=#447700>!   95-03-25  BLACK      - CONVERSION FROM 1-D TO 2-D in HORIZONTAL<a name='68'></font>
<font color=#447700>!   96-12-13  BLACK      - FINAL MODIFICATION FOR NESTED RUNS<a name='69'></font>
<font color=#447700>!   98-10-30  BLACK      - MODIFIED FOR DISTRIBUTED MEMORY<a name='70'></font>
<font color=#447700>!   00-01-06  BLACK      - MODIFIED FOR JANJIC NONHYDROSTATIC CODE<a name='71'></font>
<font color=#447700>!   00-09-14  BLACK      - MODIFIED FOR DIRECT ACCESS READ<a name='72'></font>
<font color=#447700>!   01-03-12  BLACK      - CONVERTED TO WRF STRUCTURE<a name='73'></font>
<font color=#447700>!   02-08-29  MICHALAKES - CHANGED II=I-MY_IS_GLB+1 TO II=I<a name='74'></font>
<font color=#447700>!                          ADDED CONDITIONAL COMPILATION AROUND MPI<a name='75'></font>
<font color=#447700>!                          CONVERT INDEXING FROM LOCAL TO GLOBAL<a name='76'></font>
<font color=#447700>!   02-09-06  WOLFE      - MORE CONVERSION TO GLOBAL INDEXING <a name='77'></font>
<font color=#447700>!   04-11-18  BLACK      - THREADED<a name='78'></font>
<font color=#447700>!   05-12-19  BLACK      - CONVERTED FROM IKJ TO IJK<a name='79'></font>
<font color=#447700>!   06-06-02  GOPAL      - MODIFICATIONS FOR NESTING<a name='80'></font>
<font color=#447700>!   07-11-14  PYLE       - UPDATED FOR NEW WRF BOUNDARY FILE STRUCTURE<a name='81'></font>
<font color=#447700>!     <a name='82'></font>
<font color=#447700>! USAGE: CALL BOCOH FROM SUBROUTINE SOLVE_NMM<a name='83'></font>
<font color=#447700>!   INPUT ARGUMENT LIST:<a name='84'></font>
<font color=#447700>!<a name='85'></font>
<font color=#447700>!     NOTE THAT IDE AND JDE INSIDE ROUTINE SHOULD BE PASSED IN<a name='86'></font>
<font color=#447700>!     AS WHAT WRF CONSIDERS THE UNSTAGGERED GRID DIMENSIONS; THAT<a name='87'></font>
<font color=#447700>!     IS, 1 LESS THAN THE IDE AND JDE SET BY WRF FRAMEWORK, JM<a name='88'></font>
<font color=#447700>!  <a name='89'></font>
<font color=#447700>!   OUTPUT ARGUMENT LIST: <a name='90'></font>
<font color=#447700>!     <a name='91'></font>
<font color=#447700>!   OUTPUT FILES:<a name='92'></font>
<font color=#447700>!     NONE<a name='93'></font>
<font color=#447700>!     <a name='94'></font>
<font color=#447700>!   SUBPROGRAMS CALLED:<a name='95'></font>
<font color=#447700>!  <a name='96'></font>
<font color=#447700>!     UNIQUE: NONE<a name='97'></font>
<font color=#447700>!  <a name='98'></font>
<font color=#447700>!     LIBRARY: NONE<a name='99'></font>
<font color=#447700>!  <a name='100'></font>
<font color=#447700>! ATTRIBUTES:<a name='101'></font>
<font color=#447700>!   LANGUAGE: FORTRAN 90<a name='102'></font>
<font color=#447700>!   MACHINE : IBM <a name='103'></font>
<font color=#447700>!$$$  <a name='104'></font>
<font color=#447700>!***********************************************************************<a name='105'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='106'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='107'></font>
<font color=#447700>!<a name='108'></font>
      IMPLICIT NONE<a name='109'>
<font color=#447700>!<a name='110'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='111'></font>
      LOGICAL,INTENT(IN) :: NEST<a name='112'>
<font color=#447700>!<a name='113'></font>
      INTEGER,INTENT(IN) :: IDS,IDE,JDS,JDE,KDS,KDE                     &amp;<a name='114'>
     &amp;                     ,IMS,IME,JMS,JME,KMS,KME                     &amp;<a name='115'>
     &amp;                     ,ITS,ITE,JTS,JTE,KTS,KTE<a name='116'>
      INTEGER,INTENT(IN) :: SPEC_BDY_WIDTH<a name='117'>
<font color=#447700>!<a name='118'></font>
      INTEGER,DIMENSION(JMS:JME),INTENT(IN) :: IHE,IHW,IVE,IVW<a name='119'>
<font color=#447700>!<a name='120'></font>
      INTEGER,INTENT(IN) :: GRIDID<a name='121'>
      INTEGER,INTENT(IN) :: LB,NBC,NTSD<a name='122'>
      LOGICAL,INTENT(IN) :: LAST_TIME<a name='123'>
      INTEGER,INTENT(INOUT) :: NBOCO<a name='124'>
<font color=#447700>!<a name='125'></font>
      REAL,INTENT(IN) :: DT0,PDTOP,PT,TSPH<a name='126'>
<font color=#447700>!<a name='127'></font>
      REAL,DIMENSION(KMS:KME),INTENT(IN) :: ETA1,ETA2<a name='128'>
<font color=#447700>!<a name='129'></font>
      REAL,DIMENSION(IMS:IME,1,SPEC_BDY_WIDTH)                          &amp;<a name='130'>
     &amp;                           ,INTENT(INOUT) :: PD_BYS, PD_BYE       &amp;<a name='131'>
     &amp;                                            ,PD_BTYS,PD_BTYE<a name='132'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='133'></font>
#ifdef IDEAL_NMM_TC<a name='134'>
      REAL,DIMENSION(IMS:IME,1,SPEC_BDY_WIDTH)                          &amp;<a name='135'>
     &amp;                           ,INTENT(INOUT) :: SM_BYS, SM_BYE       &amp;<a name='136'>
     &amp;                                            ,SM_BTYS,SM_BTYE<a name='137'>
#endif<a name='138'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='139'></font>
      REAL,DIMENSION(IMS:IME,KMS:KME,SPEC_BDY_WIDTH)                   &amp;<a name='140'>
     &amp;                           ,INTENT(INOUT) :: T_BYS, T_BYE        &amp;<a name='141'>
     &amp;                                            ,U_BYS, U_BYE        &amp;<a name='142'>
     &amp;                                            ,V_BYS, V_BYE        &amp;<a name='143'>
     &amp;                                            ,Q_BYS, Q_BYE        &amp;<a name='144'>
     &amp;                                            ,Q2_BYS, Q2_BYE      &amp;<a name='145'>
     &amp;                                            ,T_BTYS, T_BTYE      &amp;<a name='146'>
     &amp;                                            ,U_BTYS, U_BTYE      &amp;<a name='147'>
     &amp;                                            ,V_BTYS, V_BTYE      &amp;<a name='148'>
     &amp;                                            ,Q_BTYS, Q_BTYE      &amp;<a name='149'>
     &amp;                                            ,Q2_BTYS, Q2_BTYE    <a name='150'>
<a name='151'>
      REAL,DIMENSION(JMS:JME,1,SPEC_BDY_WIDTH)                         &amp;<a name='152'>
     &amp;                           ,INTENT(INOUT) :: PD_BXS, PD_BXE      &amp;<a name='153'>
     &amp;                                            ,PD_BTXS,PD_BTXE<a name='154'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='155'></font>
#ifdef IDEAL_NMM_TC<a name='156'>
      REAL,DIMENSION(JMS:JME,1,SPEC_BDY_WIDTH)                         &amp;<a name='157'>
     &amp;                           ,INTENT(INOUT) :: SM_BXS, SM_BXE      &amp;<a name='158'>
     &amp;                                            ,SM_BTXS,SM_BTXE<a name='159'>
#endif<a name='160'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='161'></font>
      REAL,DIMENSION(JMS:JME,KMS:KME,SPEC_BDY_WIDTH)                   &amp;<a name='162'>
     &amp;                           ,INTENT(INOUT) :: T_BXS, T_BXE        &amp;<a name='163'>
     &amp;                                            ,U_BXS, U_BXE        &amp;<a name='164'>
     &amp;                                            ,V_BXS, V_BXE        &amp;<a name='165'>
     &amp;                                            ,Q_BXS, Q_BXE        &amp;<a name='166'>
     &amp;                                            ,Q2_BXS, Q2_BXE      &amp;<a name='167'>
     &amp;                                            ,T_BTXS, T_BTXE      &amp;<a name='168'>
     &amp;                                            ,U_BTXS, U_BTXE      &amp;<a name='169'>
     &amp;                                            ,V_BTXS, V_BTXE      &amp;<a name='170'>
     &amp;                                            ,Q_BTXS, Q_BTXE      &amp;<a name='171'>
     &amp;                                            ,Q2_BTXS, Q2_BTXE    <a name='172'>
                                               <a name='173'>
<font color=#447700>!<a name='174'></font>
      REAL,DIMENSION(IMS:IME,JMS:JME),INTENT(IN) :: RES<a name='175'>
      REAL,DIMENSION(IMS:IME,JMS:JME),INTENT(INOUT) :: PD<a name='176'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='177'></font>
#ifdef IDEAL_NMM_TC<a name='178'>
      REAL,DIMENSION(IMS:IME,JMS:JME),INTENT(INOUT) :: SM,TH<a name='179'>
#endif<a name='180'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='181'></font>
      REAL,DIMENSION(IMS:IME,JMS:JME,KMS:KME),INTENT(INOUT) ::          &amp;<a name='182'>
     &amp;                                                         PINT,Q   &amp;<a name='183'>
     &amp;                                                        ,Q2,T,Z<a name='184'>
<font color=#447700>!<a name='185'></font>
<font color=#447700>!<a name='186'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='187'></font>
<font color=#447700>!<a name='188'></font>
<font color=#447700>!***  LOCAL VARIABLES<a name='189'></font>
<font color=#447700>!<a name='190'></font>
      INTEGER :: I,IB,IBDY,II,IIM,IM,IRTN,ISIZ1,ISIZ2                &amp;<a name='191'>
     &amp;          ,J,JB,JJ,JJM,JM,K,KK,N,NN,NREC,NUMGAS,NV,REC<a name='192'>
      INTEGER :: MY_IS_GLB,MY_JS_GLB,MY_IE_GLB,MY_JE_GLB  <a name='193'>
      INTEGER :: I_M,ILPAD1,IRPAD1,JBPAD1,JTPAD1<a name='194'>
<font color=#447700>!<a name='195'></font>
      REAL :: BCHR,CONVFAC,CWK,DT,PLYR,RRI<a name='196'>
<font color=#447700>!<a name='197'></font>
      LOGICAL :: E_BDY,W_BDY,N_BDY,S_BDY, activate<a name='198'>
<font color=#447700>!<a name='199'></font>
      CHARACTER(LEN=255) :: message<a name='200'>
<font color=#447700>!-----------------------------------------------------------------------<a name='201'></font>
<font color=#447700>!***********************************************************************<a name='202'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='203'></font>
<font color=#447700>!<a name='204'></font>
      IM=IDE-IDS+1<a name='205'>
      JM=JDE-JDS+1<a name='206'>
      IIM=IM<a name='207'>
      JJM=JM<a name='208'>
<font color=#447700>!<a name='209'></font>
      ISIZ1=2*LB<a name='210'>
      ISIZ2=2*LB*(KME-KMS)<a name='211'>
<font color=#447700>!<a name='212'></font>
      W_BDY=(ITS==IDS)<a name='213'>
      E_BDY=(ITE==IDE)<a name='214'>
      S_BDY=(JTS==JDS)<a name='215'>
      N_BDY=(JTE==JDE)<a name='216'>
<font color=#447700>!<a name='217'></font>
      ILPAD1=1<a name='218'>
      IF(W_BDY)ILPAD1=0<a name='219'>
      IRPAD1=1<a name='220'>
      IF(E_BDY)IRPAD1=0<a name='221'>
      JBPAD1=1<a name='222'>
      IF(S_BDY)JBPAD1=0<a name='223'>
      JTPAD1=1<a name='224'>
      IF(N_BDY)JTPAD1=0<a name='225'>
<font color=#447700>!<a name='226'></font>
      MY_IS_GLB=ITS<a name='227'>
      MY_IE_GLB=ITE<a name='228'>
      MY_JS_GLB=JTS<a name='229'>
      MY_JE_GLB=JTE<a name='230'>
<font color=#447700>!<a name='231'></font>
      DT=DT0<a name='232'>
<a name='233'>
<font color=#447700>!<a name='234'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='235'></font>
<font color=#447700>!***  SOUTH AND NORTH BOUNDARIES<a name='236'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='237'></font>
<font color=#447700>!<a name='238'></font>
<font color=#447700>!***  USE IBDY=1 FOR SOUTH; 2 FOR NORTH<a name='239'></font>
<font color=#447700>!<a name='240'></font>
      ns_do: DO IBDY=1,2 <a name='241'>
<font color=#447700>!<a name='242'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='243'></font>
<font color=#447700>!<a name='244'></font>
        activate=.false.<a name='245'>
        ns_if: IF(S_BDY.AND.IBDY==1) THEN <a name='246'>
            JB=1         <font color=#447700>! Which cell in from boundary<a name='247'></font>
            JJ=1         <font color=#447700>! Which cell in the domain<a name='248'></font>
            activate=.true.<a name='249'>
          DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='250'>
            PD_BYS(I,1,JB)=PD_BYS(I,1,JB)+PD_BTYS(I,1,JB)*DT<a name='251'>
            PD(I,JJ)=PD_BYS(I,1,JB)<a name='252'>
          ENDDO<a name='253'>
<a name='254'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='255'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='256'></font>
          DO K=KTS,KTE<a name='257'>
            DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='258'>
              T_BYS(I,K,JB)=T_BYS(I,K,JB)+T_BTYS(I,K,JB)*DT<a name='259'>
              Q_BYS(I,K,JB)=Q_BYS(I,K,JB)+Q_BTYS(I,K,JB)*DT<a name='260'>
              Q2_BYS(I,K,JB)=Q2_BYS(I,K,JB)+Q2_BTYS(I,K,JB)*DT<a name='261'>
<font color=#447700>!<a name='262'></font>
              T(I,JJ,K)=T_BYS(I,K,JB)<a name='263'>
              Q(I,JJ,K)=Q_BYS(I,K,JB)<a name='264'>
              Q2(I,JJ,K)=Q2_BYS(I,K,JB)<a name='265'>
              PINT(I,JJ,K)=ETA1(K)*PDTOP                                &amp;<a name='266'>
     &amp;                    +ETA2(K)*PD(I,JJ)*RES(I,JJ)+PT<a name='267'>
            ENDDO<a name='268'>
           ENDDO<a name='269'>
<a name='270'>
          ELSEIF(N_BDY.AND.IBDY==2) THEN<a name='271'>
            JB=1         <font color=#447700>! Which cell in from boundary<a name='272'></font>
            JJ=JJM       <font color=#447700>! Which cell in the domain<a name='273'></font>
            activate=.true.<a name='274'>
<font color=#447700>!<a name='275'></font>
          DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='276'>
            PD_BYE(I,1,JB)=PD_BYE(I,1,JB)+PD_BTYE(I,1,JB)*DT<a name='277'>
            PD(I,JJ)=PD_BYE(I,1,JB)<a name='278'>
          ENDDO<a name='279'>
<font color=#447700>!<a name='280'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='281'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='282'></font>
          DO K=KTS,KTE<a name='283'>
            DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='284'>
              T_BYE(I,K,JB)=T_BYE(I,K,JB)+T_BTYE(I,K,JB)*DT<a name='285'>
              Q_BYE(I,K,JB)=Q_BYE(I,K,JB)+Q_BTYE(I,K,JB)*DT<a name='286'>
              Q2_BYE(I,K,JB)=Q2_BYE(I,K,JB)+Q2_BTYE(I,K,JB)*DT<a name='287'>
<font color=#447700>!<a name='288'></font>
              T(I,JJ,K)=T_BYE(I,K,JB)<a name='289'>
              Q(I,JJ,K)=Q_BYE(I,K,JB)<a name='290'>
              Q2(I,JJ,K)=Q2_BYE(I,K,JB)<a name='291'>
              PINT(I,JJ,K)=ETA1(K)*PDTOP                                &amp;<a name='292'>
     &amp;                    +ETA2(K)*PD(I,JJ)*RES(I,JJ)+PT<a name='293'>
            ENDDO<a name='294'>
          ENDDO<a name='295'>
        ENDIF ns_if<a name='296'>
<a name='297'>
      ENDDO ns_do<a name='298'>
<font color=#447700>!<a name='299'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='300'></font>
<font color=#447700>!***  WEST AND EAST BOUNDARIES<a name='301'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='302'></font>
<font color=#447700>!<a name='303'></font>
<font color=#447700>!***  USE IBDY=1 FOR WEST; 2 FOR EAST. <a name='304'></font>
<font color=#447700>!<a name='305'></font>
      ew_do: DO IBDY=1,2 <a name='306'>
<font color=#447700>!<a name='307'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='308'></font>
<font color=#447700>!<a name='309'></font>
        activate=.false.<a name='310'>
        ew_if: IF(W_BDY.AND.IBDY==1) THEN  <a name='311'>
            IB=1         <font color=#447700>! Which cell in from boundary <a name='312'></font>
            II=1         <font color=#447700>! Which cell in the domain<a name='313'></font>
            activate=.true.<a name='314'>
          DO J=MAX(JTS-1,JDS+3-1),MIN(JTE+1,JDE-2)<a name='315'>
            IF(MOD(J,2)==1)THEN<a name='316'>
              PD_BXS(J,1,IB)=PD_BXS(J,1,IB)+PD_BTXS(J,1,IB)*DT<a name='317'>
              PD(II,J)=PD_BXS(J,1,IB)<a name='318'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='319'></font>
#ifdef IDEAL_NMM_TC<a name='320'>
              IF(GRIDID.GT.1)THEN<a name='321'>
                SM(II,J)=SM_BXS(J,1,IB)   <font color=#447700>! for W-E motion<a name='322'></font>
<font color=#447700>!               TH(II,J)=TH_BXS(J,1,IB)<a name='323'></font>
              ENDIF<a name='324'>
#endif<a name='325'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='326'></font>
            ENDIF<a name='327'>
          ENDDO<a name='328'>
<font color=#447700>!<a name='329'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='330'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='331'></font>
          DO K=KTS,KTE<a name='332'>
            DO J=MAX(JTS-1,JDS+3-1),MIN(JTE+1,JDE-2)<a name='333'>
<font color=#447700>!<a name='334'></font>
              IF(MOD(J,2)==1)THEN<a name='335'>
                T_BXS(J,K,IB)=T_BXS(J,K,IB)+T_BTXS(J,K,IB)*DT<a name='336'>
                Q_BXS(J,K,IB)=Q_BXS(J,K,IB)+Q_BTXS(J,K,IB)*DT<a name='337'>
                Q2_BXS(J,K,IB)=Q2_BXS(J,K,IB)+Q2_BTXS(J,K,IB)*DT<a name='338'>
<font color=#447700>!<a name='339'></font>
                T(II,J,K)=T_BXS(J,K,IB)<a name='340'>
                Q(II,J,K)=Q_BXS(J,K,IB)<a name='341'>
                Q2(II,J,K)=Q2_BXS(J,K,IB)<a name='342'>
                PINT(II,J,K)=ETA1(K)*PDTOP                              &amp;<a name='343'>
     &amp;                      +ETA2(K)*PD(II,J)*RES(II,J)+PT<a name='344'>
              ENDIF<a name='345'>
<font color=#447700>!<a name='346'></font>
            ENDDO<a name='347'>
          ENDDO<a name='348'>
<a name='349'>
          ELSEIF(E_BDY.AND.IBDY==2) THEN<a name='350'>
            IB=1         <font color=#447700>! Which cell in from boundary<a name='351'></font>
            II=IIM       <font color=#447700>! Which cell in the domain<a name='352'></font>
            activate=.true.<a name='353'>
          DO J=MAX(JTS-1,JDS+3-1),MIN(JTE+1,JDE-2)<a name='354'>
            IF(MOD(J,2)==1)THEN<a name='355'>
              PD_BXE(J,1,IB)=PD_BXE(J,1,IB)+PD_BTXE(J,1,IB)*DT<a name='356'>
              PD(II,J)=PD_BXE(J,1,IB)<a name='357'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='358'></font>
#ifdef IDEAL_NMM_TC<a name='359'>
              IF(GRIDID.GT.1)THEN<a name='360'>
                 SM(II,J)=SM_BXE(J,1,IB)    <font color=#447700>! for E-W motion<a name='361'></font>
<font color=#447700>!                TH(II,J)=TH_BXE(J,1,IB)<a name='362'></font>
              ENDIF<a name='363'>
#endif<a name='364'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='365'></font>
            ENDIF<a name='366'>
          ENDDO<a name='367'>
<font color=#447700>!<a name='368'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='369'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='370'></font>
          DO K=KTS,KTE<a name='371'>
            DO J=MAX(JTS-1,JDS+3-1),MIN(JTE+1,JDE-2)<a name='372'>
<font color=#447700>!<a name='373'></font>
              IF(MOD(J,2)==1)THEN<a name='374'>
                T_BXE(J,K,IB)=T_BXE(J,K,IB)+T_BTXE(J,K,IB)*DT<a name='375'>
                Q_BXE(J,K,IB)=Q_BXE(J,K,IB)+Q_BTXE(J,K,IB)*DT<a name='376'>
                Q2_BXE(J,K,IB)=Q2_BXE(J,K,IB)+Q2_BTXE(J,K,IB)*DT<a name='377'>
<font color=#447700>!<a name='378'></font>
                T(II,J,K)=T_BXE(J,K,IB)<a name='379'>
                Q(II,J,K)=Q_BXE(J,K,IB)<a name='380'>
                Q2(II,J,K)=Q2_BXE(J,K,IB)<a name='381'>
                PINT(II,J,K)=ETA1(K)*PDTOP                              &amp;<a name='382'>
     &amp;                      +ETA2(K)*PD(II,J)*RES(II,J)+PT<a name='383'>
              ENDIF<a name='384'>
<font color=#447700>!<a name='385'></font>
            ENDDO<a name='386'>
          ENDDO<a name='387'>
<a name='388'>
       ENDIF ew_if<a name='389'>
<a name='390'>
      ENDDO ew_do<a name='391'>
<font color=#447700>!<a name='392'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='393'></font>
<font color=#447700>!***  SPACE INTERPOLATION OF PD THEN REMAINING MASS VARIABLES<a name='394'></font>
<font color=#447700>!***  AT INNER BOUNDARY<a name='395'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='396'></font>
<font color=#447700>!<a name='397'></font>
<font color=#447700>!***  ONE ROW NORTH OF SOUTHERN BOUNDARY<a name='398'></font>
<font color=#447700>!<a name='399'></font>
      IF(S_BDY)THEN<a name='400'>
        DO I=MYIS,MYIE1<a name='401'>
          CWK=PD(I,2)<a name='402'>
          PD(I,2)=0.25*(PD(I,1)+PD(I+1,1)+PD(I,3)+PD(I+1,3))<a name='403'>
<font color=#447700>!<a name='404'></font>
<font color=#447700>!***  NESTING TEST<a name='405'></font>
<font color=#447700>!<a name='406'></font>
          IF(I&lt;=IDE-1.AND.ABS(CWK-PD(I,2))&gt;=300.)THEN<a name='407'>
            WRITE(message,*)'PSEUDO HYDROSTATIC IMBALANCE AT THE SOUTHERN BOUNDARY AT',I,2,'GRID #',GRIDID<a name='408'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_62">(trim(message))<a name='409'>
            WRITE(message,*)'             ',CWK/100.<a name='410'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_63">(trim(message))<a name='411'>
            WRITE(message,*)PD(I,3)/100.,'               ',PD(I+1,3)/100.<a name='412'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_64">(trim(message))<a name='413'>
            WRITE(message,*)'             ',PD(I,2)/100.<a name='414'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_65">(trim(message))<a name='415'>
            WRITE(message,*)PD(I,1)/100.,'             ',PD(I+1,1)/100.<a name='416'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_66">(trim(message))<a name='417'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_67">('   ')<a name='418'>
          ENDIF<a name='419'>
<a name='420'>
        ENDDO<a name='421'>
      ENDIF<a name='422'>
<font color=#447700>!<a name='423'></font>
<font color=#447700>!***  ONE ROW SOUTH OF NORTHERN BOUNDARY<a name='424'></font>
<font color=#447700>!<a name='425'></font>
      IF(N_BDY)THEN<a name='426'>
<a name='427'>
        DO I=MYIS,MYIE1<a name='428'>
          CWK=PD(I,JJM-1)<a name='429'>
<font color=#447700>!!        write(message,*)'I, PD is:', PD(I,JJM), PD(I,JJM-2),PD(I+1,JJM-2),PD(I+1,JJM)<a name='430'></font>
<font color=#447700>!!        call wrf_message(trim(message))<a name='431'></font>
          PD(I,JJM-1)=0.25*(PD(I,JJM-2)+PD(I+1,JJM-2)                   &amp;<a name='432'>
     &amp;                     +PD(I,JJM)+PD(I+1,JJM))<a name='433'>
<font color=#447700>!<a name='434'></font>
<font color=#447700>!***  NESTING TEST<a name='435'></font>
<font color=#447700>!<a name='436'></font>
          IF(I&lt;=IDE-1.AND.ABS(CWK-PD(I,JJM-1))&gt;=300.)THEN<a name='437'>
            WRITE(message,*)'PSEUDO HYDROSTATIC IMBALANCE AT THE NORTHERN BOUNDARY AT',I,JJM-1,'GRID #',GRIDID<a name='438'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_68">(trim(message))<a name='439'>
            WRITE(message,*)'             ',CWK/100.<a name='440'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_69">(trim(message))<a name='441'>
            WRITE(message,*)PD(I,JJM)/100.,'               ',PD(I+1,JJM)/100.<a name='442'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_70">(trim(message))<a name='443'>
            WRITE(message,*)'             ',PD(I,JJM-1)/100.<a name='444'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_71">(trim(message))<a name='445'>
            WRITE(message,*)PD(I,JJM-2)/100.,'             ',PD(I+1,JJM-2)/100.<a name='446'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_72">(trim(message))<a name='447'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_73">('   ')<a name='448'>
          ENDIF<a name='449'>
<a name='450'>
        ENDDO<a name='451'>
      ENDIF<a name='452'>
<font color=#447700>!<a name='453'></font>
<font color=#447700>!***  ONE ROW EAST OF WESTERN BOUNDARY<a name='454'></font>
<font color=#447700>!<a name='455'></font>
      IF(W_BDY)THEN<a name='456'>
        DO J=4,JM-3,2<a name='457'>
<font color=#447700>!<a name='458'></font>
          IF(W_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='459'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='460'>
            CWK=PD(1,J)<a name='461'>
            JJ=J<a name='462'>
            PD(1,JJ)=0.25*(PD(1,JJ-1)+PD(2,JJ-1)+PD(1,JJ+1)+PD(2,JJ+1))<a name='463'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='464'></font>
#ifdef IDEAL_NMM_TC<a name='465'>
           IF(GRIDID.GT.1)THEN<a name='466'>
             SM(1,JJ)=0.5*(SM(1,JJ-1)+SM(1,JJ+1))  <font color=#447700>! updates only along W Boundary<a name='467'></font>
<font color=#447700>!            TH(IIM-1,JJ)=0.5*(TH(IIM,JJ-1)+TH(IIM,JJ+1))<a name='468'></font>
           ENDIF<a name='469'>
#endif<a name='470'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='471'></font>
<font color=#447700>!<a name='472'></font>
<font color=#447700>!***  NESTING TEST<a name='473'></font>
<font color=#447700>!<a name='474'></font>
             IF(ABS(CWK-PD(1,JJ))&gt;300.)THEN<a name='475'>
              WRITE(message,*)'PSEUDO HYDROSTATIC IMBALANCE AT THE WESTERN BOUNDARY AT',1,JJ,'GRID #',GRIDID<a name='476'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_74">(trim(message))<a name='477'>
              WRITE(message,*)'             ',CWK/100.<a name='478'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_75">(trim(message))<a name='479'>
              WRITE(message,*)PD(1,JJ+1)/100.,'               ',PD(2,JJ+1)/100.<a name='480'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_76">(trim(message))<a name='481'>
              WRITE(message,*)'             ',PD(1,JJ)/100.<a name='482'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_77">(trim(message))<a name='483'>
              WRITE(message,*)PD(1,JJ-1)/100.,'               ',PD(2,JJ-1)/100.<a name='484'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_78">(trim(message))<a name='485'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_79">('   ')<a name='486'>
            ENDIF<a name='487'>
<a name='488'>
          ENDIF<a name='489'>
<font color=#447700>!<a name='490'></font>
        ENDDO<a name='491'>
      ENDIF<a name='492'>
<font color=#447700>!<a name='493'></font>
<font color=#447700>!***  ONE ROW WEST OF EASTERN BOUNDARY<a name='494'></font>
<font color=#447700>!<a name='495'></font>
      IF(E_BDY)THEN<a name='496'>
        DO J=4,JM-3,2<a name='497'>
<font color=#447700>!<a name='498'></font>
          IF(E_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='499'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='500'>
            CWK=PD(IIM-1,J)<a name='501'>
            JJ=J<a name='502'>
            PD(IIM-1,JJ)=0.25*(PD(IIM-1,JJ-1)+PD(IIM,JJ-1)              &amp;<a name='503'>
     &amp;                        +PD(IIM-1,JJ+1)+PD(IIM,JJ+1))<a name='504'>
<font color=#447700>!!BEGIN: LSM changes for LANDFALL: Subashini 7/27/2016<a name='505'></font>
#ifdef IDEAL_NMM_TC<a name='506'>
           IF(GRIDID.GT.1)THEN<a name='507'>
             SM(IIM-1,JJ)=0.5*(SM(IIM,JJ-1)+SM(IIM,JJ+1))  <font color=#447700>! updates only along E Boundary<a name='508'></font>
<font color=#447700>!            TH(IIM-1,JJ)=0.5*(TH(IIM,JJ-1)+TH(IIM,JJ+1))<a name='509'></font>
           ENDIF<a name='510'>
#endif<a name='511'>
<font color=#447700>!!END: LSM changes for LANDFALL : Subashini 7/27/2016<a name='512'></font>
<font color=#447700>!<a name='513'></font>
<font color=#447700>!***  NESTING TEST<a name='514'></font>
<font color=#447700>!<a name='515'></font>
             IF(ABS(CWK-PD(IIM-1,JJ))&gt;300.)THEN<a name='516'>
              WRITE(message,*)'PSEUDO HYDROSTATIC IMBALANCE AT THE EASTERN BOUNDARY AT',IIM-1,JJ,'GRID #',GRIDID<a name='517'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_80">(trim(message))<a name='518'>
              WRITE(message,*)'             ',CWK/100.<a name='519'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_81">(trim(message))<a name='520'>
              WRITE(message,*)PD(IIM-1,JJ+1)/100.,'               ',PD(IIM,JJ+1)/100.<a name='521'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_82">(trim(message))<a name='522'>
              WRITE(message,*)'             ',PD(IIM-1,JJ)/100.<a name='523'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_83">(trim(message))<a name='524'>
              WRITE(message,*)PD(IIM-1,JJ-1)/100.,'               ',PD(IIM,JJ-1)/100.<a name='525'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_84">(trim(message))<a name='526'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MASS_BOUNDARY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_85">('   ')<a name='527'>
            ENDIF<a name='528'>
<a name='529'>
          ENDIF<a name='530'>
<font color=#447700>!<a name='531'></font>
        ENDDO<a name='532'>
      ENDIF<a name='533'>
<font color=#447700>!<a name='534'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='535'></font>
<font color=#447700>!<a name='536'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='537'></font>
<font color=#447700>!$omp&amp; private(i,j,jj,k)<a name='538'></font>
      DO 200 K=KTS,KTE<a name='539'>
<font color=#447700>!<a name='540'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='541'></font>
<font color=#447700>!<a name='542'></font>
<font color=#447700>!***  ONE ROW NORTH OF SOUTHERN BOUNDARY<a name='543'></font>
<font color=#447700>!<a name='544'></font>
      IF(S_BDY)THEN<a name='545'>
        DO I=MYIS,MYIE1<a name='546'>
          T(I,2,K)=(T(I,1,K)+T(I+1,1,K)+T(I,3,K)+T(I+1,3,K))*0.25<a name='547'>
          Q(I,2,K)=(Q(I,1,K)+Q(I+1,1,K)+Q(I,3,K)+Q(I+1,3,K))*0.25<a name='548'>
          Q2(I,2,K)=(Q2(I,1,K)+Q2(I+1,1,K)+Q2(I,3,K)+Q2(I+1,3,K))*0.25<a name='549'>
          PINT(I,2,K)=ETA1(K)*PDTOP+ETA2(K)*PD(I,2)*RES(I,2)+PT<a name='550'>
        ENDDO<a name='551'>
<font color=#447700>!<a name='552'></font>
      ENDIF<a name='553'>
<font color=#447700>!<a name='554'></font>
<font color=#447700>!***  ONE ROW SOUTH OF NORTHERN BOUNDARY<a name='555'></font>
<font color=#447700>!<a name='556'></font>
      IF(N_BDY)THEN<a name='557'>
        DO I=MYIS,MYIE1<a name='558'>
          T(I,JJM-1,K)=(T(I,JJM-2,K)+T(I+1,JJM-2,K)                     &amp;<a name='559'>
     &amp;                 +T(I,JJM,K)+T(I+1,JJM,K))                        &amp;<a name='560'>
     &amp;                 *0.25<a name='561'>
          Q(I,JJM-1,K)=(Q(I,JJM-2,K)+Q(I+1,JJM-2,K)                     &amp;<a name='562'>
     &amp;                 +Q(I,JJM,K)+Q(I+1,JJM,K))                        &amp;<a name='563'>
     &amp;                 *0.25<a name='564'>
          Q2(I,JJM-1,K)=(Q2(I,JJM-2,K)+Q2(I+1,JJM-2,K)                  &amp;<a name='565'>
     &amp;                  +Q2(I,JJM,K)+Q2(I+1,JJM,K))                     &amp;<a name='566'>
     &amp;                  *0.25<a name='567'>
          PINT(I,JJM-1,K)=ETA1(K)*PDTOP                                 &amp;<a name='568'>
     &amp;                   +ETA2(K)*PD(I,JJM-1)*RES(I,JJM-1)+PT<a name='569'>
        ENDDO<a name='570'>
<font color=#447700>!<a name='571'></font>
      ENDIF<a name='572'>
<font color=#447700>!<a name='573'></font>
<font color=#447700>!***  ONE ROW EAST OF WESTERN BOUNDARY<a name='574'></font>
<font color=#447700>!<a name='575'></font>
      IF(W_BDY)THEN<a name='576'>
        DO J=4,JM-3,2<a name='577'>
<font color=#447700>!<a name='578'></font>
          IF(W_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='579'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='580'>
            JJ=J<a name='581'>
            T(1,JJ,K)=(T(1,JJ-1,K)+T(2,JJ-1,K)                          &amp;<a name='582'>
     &amp;                +T(1,JJ+1,K)+T(2,JJ+1,K))                         &amp;<a name='583'>
     &amp;                *0.25<a name='584'>
            Q(1,JJ,K)=(Q(1,JJ-1,K)+Q(2,JJ-1,K)                          &amp;<a name='585'>
     &amp;                +Q(1,JJ+1,K)+Q(2,JJ+1,K))                         &amp;<a name='586'>
     &amp;                *0.25<a name='587'>
            Q2(1,JJ,K)=(Q2(1,JJ-1,K)+Q2(2,JJ-1,K)                       &amp;<a name='588'>
     &amp;                 +Q2(1,JJ+1,K)+Q2(2,JJ+1,K))                      &amp;<a name='589'>
     &amp;                 *0.25<a name='590'>
            PINT(1,JJ,K)=ETA1(K)*PDTOP                                  &amp;<a name='591'>
     &amp;                  +ETA2(K)*PD(1,JJ)*RES(1,JJ)+PT<a name='592'>
<font color=#447700>!<a name='593'></font>
          ENDIF<a name='594'>
<font color=#447700>!<a name='595'></font>
        ENDDO<a name='596'>
<font color=#447700>!<a name='597'></font>
      ENDIF<a name='598'>
<font color=#447700>!<a name='599'></font>
<font color=#447700>!***  ONE ROW WEST OF EASTERN BOUNDARY<a name='600'></font>
<font color=#447700>!<a name='601'></font>
      IF(E_BDY)THEN<a name='602'>
        DO J=4,JM-3,2<a name='603'>
<font color=#447700>!<a name='604'></font>
          IF(E_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='605'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='606'>
            JJ=J<a name='607'>
            T(IIM-1,JJ,K)=(T(IIM-1,JJ-1,K)+T(IIM,JJ-1,K)                &amp;<a name='608'>
     &amp;                    +T(IIM-1,JJ+1,K)+T(IIM,JJ+1,K))               &amp;<a name='609'>
     &amp;                    *0.25<a name='610'>
            Q(IIM-1,JJ,K)=(Q(IIM-1,JJ-1,K)+Q(IIM,JJ-1,K)                &amp;<a name='611'>
     &amp;                    +Q(IIM-1,JJ+1,K)+Q(IIM,JJ+1,K))               &amp;<a name='612'>
     &amp;                    *0.25<a name='613'>
            Q2(IIM-1,JJ,K)=(Q2(IIM-1,JJ-1,K)+Q2(IIM,JJ-1,K)             &amp;<a name='614'>
     &amp;                     +Q2(IIM-1,JJ+1,K)+Q2(IIM,JJ+1,K))            &amp;<a name='615'>
     &amp;                     *0.25<a name='616'>
            PINT(IIM-1,JJ,K)=ETA1(K)*PDTOP                              &amp;<a name='617'>
     &amp;                      +ETA2(K)*PD(IIM-1,JJ)*RES(IIM-1,JJ)+PT<a name='618'>
<font color=#447700>!<a name='619'></font>
          ENDIF<a name='620'>
<font color=#447700>!<a name='621'></font>
        ENDDO<a name='622'>
      ENDIF<a name='623'>
<font color=#447700>!-----------------------------------------------------------------------<a name='624'></font>
<font color=#447700>!<a name='625'></font>
  200 CONTINUE<a name='626'>
<font color=#447700>!<a name='627'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='628'></font>
      END SUBROUTINE MASS_BOUNDARY<a name='629'>
<A NAME='MP_BULK_BOUNDARY'><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MP_BULK_BOUNDARY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='630'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>MP_BULK_BOUNDARY</font>(GRIDID,NTSD,DT0    &amp;  <A href='../../call_to/MP_BULK_BOUNDARY.html' TARGET='index'>1</A><a name='631'>
     &amp;                ,LB,ETA1,ETA2,PDTOP,PT                            &amp;<a name='632'>
     &amp;                ,CWM_BXS, CWM_BXE, CWM_BYS, CWM_BYE               &amp;<a name='633'>
     &amp;                ,CWM_BTXS, CWM_BTXE, CWM_BTYS, CWM_BTYE           &amp;<a name='634'>
     &amp;                ,Q,CWM                                            &amp;<a name='635'>
     &amp;                ,MOIST,N_MOIST,SCALAR,N_SCALAR                    &amp;<a name='636'>
     &amp;                ,SPEC_BDY_WIDTH                                   &amp;  <a name='637'>
     &amp;                ,IDS,IDE,JDS,JDE,KDS,KDE                          &amp;<a name='638'>
     &amp;                ,IMS,IME,JMS,JME,KMS,KME                          &amp;<a name='639'>
     &amp;                ,ITS,ITE,JTS,JTE,KTS,KTE)<a name='640'>
<font color=#447700>!***********************************************************************<a name='641'></font>
<font color=#447700>!$$$  SUBPROGRAM DOCUMENTATION BLOCK<a name='642'></font>
<font color=#447700>!                .      .    .     <a name='643'></font>
<font color=#447700>! SUBPROGRAM:    BOCOH       UPDATE MASS POINTS ON BOUNDARY<a name='644'></font>
<font color=#447700>!   PRGRMMR: JANJIC          ORG: W/NP22     DATE: 94-03-08<a name='645'></font>
<font color=#447700>!     <a name='646'></font>
<font color=#447700>! ABSTRACT:<a name='647'></font>
<font color=#447700>!     TEMPERATURE, SPECIFIC HUMIDITY, AND SURFACE PRESSURE<a name='648'></font>
<font color=#447700>!     ARE UPDATED ON THE DOMAIN BOUNDARY BY APPLYING THE<a name='649'></font>
<font color=#447700>!     PRE-COMPUTED TENDENCIES AT EACH TIME STEP.<a name='650'></font>
<font color=#447700>!     <a name='651'></font>
<font color=#447700>! PROGRAM HISTORY LOG:<a name='652'></font>
<font color=#447700>!   87-??-??  MESINGER   - ORIGINATOR<a name='653'></font>
<font color=#447700>!   95-03-25  BLACK      - CONVERSION FROM 1-D TO 2-D in HORIZONTAL<a name='654'></font>
<font color=#447700>!   96-12-13  BLACK      - FINAL MODIFICATION FOR NESTED RUNS<a name='655'></font>
<font color=#447700>!   98-10-30  BLACK      - MODIFIED FOR DISTRIBUTED MEMORY<a name='656'></font>
<font color=#447700>!   00-01-06  BLACK      - MODIFIED FOR JANJIC NONHYDROSTATIC CODE<a name='657'></font>
<font color=#447700>!   00-09-14  BLACK      - MODIFIED FOR DIRECT ACCESS READ<a name='658'></font>
<font color=#447700>!   01-03-12  BLACK      - CONVERTED TO WRF STRUCTURE<a name='659'></font>
<font color=#447700>!   02-08-29  MICHALAKES - CHANGED II=I-MY_IS_GLB+1 TO II=I<a name='660'></font>
<font color=#447700>!                          ADDED CONDITIONAL COMPILATION AROUND MPI<a name='661'></font>
<font color=#447700>!                          CONVERT INDEXING FROM LOCAL TO GLOBAL<a name='662'></font>
<font color=#447700>!   02-09-06  WOLFE      - MORE CONVERSION TO GLOBAL INDEXING <a name='663'></font>
<font color=#447700>!   04-11-18  BLACK      - THREADED<a name='664'></font>
<font color=#447700>!   05-12-19  BLACK      - CONVERTED FROM IKJ TO IJK<a name='665'></font>
<font color=#447700>!   06-06-02  GOPAL      - MODIFICATIONS FOR NESTING<a name='666'></font>
<font color=#447700>!   07-11-14  PYLE       - UPDATED FOR NEW WRF BOUNDARY FILE STRUCTURE<a name='667'></font>
<font color=#447700>!     <a name='668'></font>
<font color=#447700>! USAGE: CALL BOCOH FROM SUBROUTINE SOLVE_NMM<a name='669'></font>
<font color=#447700>!   INPUT ARGUMENT LIST:<a name='670'></font>
<font color=#447700>!<a name='671'></font>
<font color=#447700>!     NOTE THAT IDE AND JDE INSIDE ROUTINE SHOULD BE PASSED IN<a name='672'></font>
<font color=#447700>!     AS WHAT WRF CONSIDERS THE UNSTAGGERED GRID DIMENSIONS; THAT<a name='673'></font>
<font color=#447700>!     IS, 1 LESS THAN THE IDE AND JDE SET BY WRF FRAMEWORK, JM<a name='674'></font>
<font color=#447700>!  <a name='675'></font>
<font color=#447700>!   OUTPUT ARGUMENT LIST: <a name='676'></font>
<font color=#447700>!     <a name='677'></font>
<font color=#447700>!   OUTPUT FILES:<a name='678'></font>
<font color=#447700>!     NONE<a name='679'></font>
<font color=#447700>!     <a name='680'></font>
<font color=#447700>!   SUBPROGRAMS CALLED:<a name='681'></font>
<font color=#447700>!  <a name='682'></font>
<font color=#447700>!     UNIQUE: NONE<a name='683'></font>
<font color=#447700>!  <a name='684'></font>
<font color=#447700>!     LIBRARY: NONE<a name='685'></font>
<font color=#447700>!  <a name='686'></font>
<font color=#447700>! ATTRIBUTES:<a name='687'></font>
<font color=#447700>!   LANGUAGE: FORTRAN 90<a name='688'></font>
<font color=#447700>!   MACHINE : IBM <a name='689'></font>
<font color=#447700>!$$$  <a name='690'></font>
<font color=#447700>!***********************************************************************<a name='691'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='692'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='693'></font>
<font color=#447700>!<a name='694'></font>
      IMPLICIT NONE<a name='695'>
<font color=#447700>!<a name='696'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='697'></font>
      INTEGER,INTENT(IN) :: IDS,IDE,JDS,JDE,KDS,KDE                     &amp;<a name='698'>
     &amp;                     ,IMS,IME,JMS,JME,KMS,KME                     &amp;<a name='699'>
     &amp;                     ,ITS,ITE,JTS,JTE,KTS,KTE<a name='700'>
      INTEGER,INTENT(IN) :: SPEC_BDY_WIDTH<a name='701'>
      INTEGER,INTENT(IN) :: N_MOIST, N_SCALAR<a name='702'>
<font color=#447700>!<a name='703'></font>
      INTEGER,INTENT(IN) :: GRIDID<a name='704'>
      INTEGER,INTENT(IN) :: LB,NTSD<a name='705'>
<font color=#447700>!<a name='706'></font>
      REAL,INTENT(IN) :: DT0,PDTOP,PT<a name='707'>
<font color=#447700>!<a name='708'></font>
      REAL,DIMENSION(KMS:KME),INTENT(IN) :: ETA1,ETA2<a name='709'>
<font color=#447700>!<a name='710'></font>
      REAL,DIMENSION(IMS:IME,KMS:KME,SPEC_BDY_WIDTH)                   &amp;<a name='711'>
     &amp;                           ,INTENT(INOUT) :: CWM_BYS, CWM_BYE    &amp;<a name='712'>
     &amp;                                            ,CWM_BTYS, CWM_BTYE  <a name='713'>
<a name='714'>
      REAL,DIMENSION(JMS:JME,KMS:KME,SPEC_BDY_WIDTH)                   &amp;<a name='715'>
     &amp;                           ,INTENT(INOUT) :: CWM_BXS, CWM_BXE    &amp;<a name='716'>
     &amp;                                            ,CWM_BTXS, CWM_BTXE  <a name='717'>
                                               <a name='718'>
<font color=#447700>!<a name='719'></font>
      REAL,DIMENSION(IMS:IME,JMS:JME,KMS:KME),INTENT(INOUT) :: CWM,Q<a name='720'>
<font color=#447700>!<a name='721'></font>
      REAL,DIMENSION(IMS:IME,JMS:JME,KMS:KME,NUM_MOIST)                 &amp;<a name='722'>
     &amp;                                           ,INTENT(INOUT) :: MOIST<a name='723'>
      REAL,DIMENSION(IMS:IME,JMS:JME,KMS:KME,NUM_SCALAR)                &amp;<a name='724'>
     &amp;                                          ,INTENT(INOUT) :: SCALAR<a name='725'>
<font color=#447700>!<a name='726'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='727'></font>
<font color=#447700>!<a name='728'></font>
<font color=#447700>!***  LOCAL VARIABLES<a name='729'></font>
<font color=#447700>!<a name='730'></font>
      INTEGER :: I,IB,IBDY,II,IIM,IM,IRTN,ISIZ1,ISIZ2                &amp;<a name='731'>
     &amp;          ,J,JB,JJ,JJM,JM,K,KK,N,NN,NREC,NUMGAS,NV,REC<a name='732'>
      INTEGER :: MY_IS_GLB,MY_JS_GLB,MY_IE_GLB,MY_JE_GLB  <a name='733'>
      INTEGER :: I_M,ILPAD1,IRPAD1,JBPAD1,JTPAD1<a name='734'>
      INTEGER :: I1,I2,J1,J2,J1B,J2B<a name='735'>
<font color=#447700>!<a name='736'></font>
      REAL :: BCHR,CONVFAC,CWK,DT,PLYR,RRI<a name='737'>
<font color=#447700>!<a name='738'></font>
      LOGICAL :: E_BDY,W_BDY,N_BDY,S_BDY,ACTIVATE<a name='739'>
<font color=#447700>!<a name='740'></font>
      CHARACTER(LEN=255) :: message<a name='741'>
<font color=#447700>!-----------------------------------------------------------------------<a name='742'></font>
<font color=#447700>!***********************************************************************<a name='743'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='744'></font>
<font color=#447700>!<a name='745'></font>
      IM=IDE-IDS+1<a name='746'>
      JM=JDE-JDS+1<a name='747'>
      IIM=IM<a name='748'>
      JJM=JM<a name='749'>
<font color=#447700>!<a name='750'></font>
      ISIZ1=2*LB<a name='751'>
      ISIZ2=2*LB*(KME-KMS)<a name='752'>
<font color=#447700>!<a name='753'></font>
      W_BDY=(ITS==IDS)<a name='754'>
      E_BDY=(ITE==IDE)<a name='755'>
      S_BDY=(JTS==JDS)<a name='756'>
      N_BDY=(JTE==JDE)<a name='757'>
<font color=#447700>!<a name='758'></font>
      ILPAD1=1<a name='759'>
      IF(W_BDY)ILPAD1=0<a name='760'>
      IRPAD1=1<a name='761'>
      IF(E_BDY)IRPAD1=0<a name='762'>
      JBPAD1=1<a name='763'>
      IF(S_BDY)JBPAD1=0<a name='764'>
      JTPAD1=1<a name='765'>
      IF(N_BDY)JTPAD1=0<a name='766'>
<font color=#447700>!<a name='767'></font>
      MY_IS_GLB=ITS<a name='768'>
      MY_IE_GLB=ITE<a name='769'>
      MY_JS_GLB=JTS<a name='770'>
      MY_JE_GLB=JTE<a name='771'>
<font color=#447700>!<a name='772'></font>
      DT=DT0<a name='773'>
<a name='774'>
      <font color=#447700>! I loop ends for N/S bdy copying:<a name='775'></font>
      I1=MAX(ITS-1,IDS)<a name='776'>
      I2=MIN(ITE+1,IDE)<a name='777'>
<a name='778'>
      <font color=#447700>! J loop ends for E/W bdy copying:<a name='779'></font>
      J1=MAX(JTS-1,JDS+3-1)<a name='780'>
      IF(MOD(J1,2)/=1) J1=J1+1<a name='781'>
      J2=MIN(JTE+1,JDE-2)<a name='782'>
      IF(MOD(J2,2)/=1) J2=J2-1<a name='783'>
<a name='784'>
      <font color=#447700>! J loop ends for E/W bdy 4-point averaging:<a name='785'></font>
      J1B=MAX(4,MY_JS_GLB-JBPAD1)<a name='786'>
      IF(MOD(J1B,2)/=0) J1B=J1B+1<a name='787'>
      J2B=MIN(JM-3,MY_JE_GLB+JTPAD1)<a name='788'>
      IF(MOD(J2B,2)/=0) J2B=J2B-1<a name='789'>
<font color=#447700>!<a name='790'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='791'></font>
<font color=#447700>!***  SOUTH AND NORTH BOUNDARIES<a name='792'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='793'></font>
<font color=#447700>!<a name='794'></font>
<font color=#447700>!***  USE IBDY=1 FOR SOUTH; 2 FOR NORTH<a name='795'></font>
<font color=#447700>!<a name='796'></font>
      ns_do: DO IBDY=1,2 <a name='797'>
<font color=#447700>!<a name='798'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='799'></font>
<font color=#447700>!<a name='800'></font>
        activate=.false.<a name='801'>
        if_ns: IF(S_BDY.AND.IBDY==1) THEN <a name='802'>
            JB=1         <font color=#447700>! Which cell in from boundary<a name='803'></font>
            JJ=1         <font color=#447700>! Which cell in the domain<a name='804'></font>
            activate=.true.<a name='805'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='806'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='807'></font>
          DO K=KTS,KTE<a name='808'>
            DO I=I1,I2<a name='809'>
              CWM_BYS(I,K,JB)=CWM_BYS(I,K,JB)+CWM_BTYS(I,K,JB)*DT<a name='810'>
              CWM(I,JJ,K)=CWM_BYS(I,K,JB)<a name='811'>
            ENDDO<a name='812'>
           ENDDO<a name='813'>
<a name='814'>
          ELSEIF(N_BDY.AND.IBDY==2) THEN<a name='815'>
            JB=1         <font color=#447700>! Which cell in from boundary<a name='816'></font>
            JJ=JJM       <font color=#447700>! Which cell in the domain<a name='817'></font>
            activate=.true.<a name='818'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='819'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='820'></font>
          DO K=KTS,KTE<a name='821'>
            DO I=I1,I2<a name='822'>
              CWM_BYE(I,K,JB)=CWM_BYE(I,K,JB)+CWM_BTYE(I,K,JB)*DT<a name='823'>
              CWM(I,JJ,K)=CWM_BYE(I,K,JB)<a name='824'>
            ENDDO<a name='825'>
          ENDDO<a name='826'>
<a name='827'>
       ENDIF if_ns   <font color=#447700>! for N/S boundaries<a name='828'></font>
<a name='829'>
       ns_moist: IF(activate) then<a name='830'>
          DO I_M=1,N_MOIST<a name='831'>
            IF(I_M==P_QV)THEN<a name='832'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='833'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='834'></font>
              DO K=KTS,KTE<a name='835'>
              DO I=I1,I2<a name='836'>
                MOIST(I,JJ,K,I_M)=Q(I,JJ,K)/(1.-Q(I,JJ,K))<a name='837'>
              ENDDO<a name='838'>
              ENDDO<a name='839'>
            ELSE<a name='840'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='841'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='842'></font>
              DO K=KTS,KTE<a name='843'>
              DO I=I1,I2<a name='844'>
                MOIST(I,JJ,K,I_M)=0.<a name='845'>
              ENDDO<a name='846'>
              ENDDO<a name='847'>
            ENDIF<a name='848'>
          ENDDO<a name='849'>
          DO I_M=2,N_SCALAR<a name='850'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='851'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='852'></font>
            DO K=KTS,KTE<a name='853'>
            DO I=I1,I2<a name='854'>
              SCALAR(I,JJ,K,I_M)=0.<a name='855'>
            ENDDO<a name='856'>
            ENDDO<a name='857'>
          ENDDO<a name='858'>
       ENDIF ns_moist<a name='859'>
      ENDDO ns_do<a name='860'>
<font color=#447700>!<a name='861'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='862'></font>
<font color=#447700>!***  WEST AND EAST BOUNDARIES<a name='863'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='864'></font>
<font color=#447700>!<a name='865'></font>
<font color=#447700>!***  USE IBDY=1 FOR WEST; 2 FOR EAST. <a name='866'></font>
<font color=#447700>!<a name='867'></font>
      ew_do: DO IBDY=1,2 <a name='868'>
<font color=#447700>!<a name='869'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='870'></font>
<font color=#447700>!<a name='871'></font>
         activate=.false.<a name='872'>
         if_ew: IF(W_BDY.AND.IBDY==1) THEN  <a name='873'>
            IB=1         <font color=#447700>! Which cell in from boundary <a name='874'></font>
            II=1         <font color=#447700>! Which cell in the domain<a name='875'></font>
            activate=.true.<a name='876'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='877'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='878'></font>
          DO K=KTS,KTE<a name='879'>
            DO J=J1,J2,2<a name='880'>
<font color=#447700>!<a name='881'></font>
              IF(MOD(J,2)==1)THEN<a name='882'>
                CWM_BXS(J,K,IB)=CWM_BXS(J,K,IB)+CWM_BTXS(J,K,IB)*DT<a name='883'>
                CWM(II,J,K)=CWM_BXS(J,K,IB)<a name='884'>
              ENDIF<a name='885'>
<font color=#447700>!<a name='886'></font>
            ENDDO<a name='887'>
          ENDDO<a name='888'>
<a name='889'>
          ELSEIF(E_BDY.AND.IBDY==2) THEN<a name='890'>
            IB=1         <font color=#447700>! Which cell in from boundary<a name='891'></font>
            II=IIM       <font color=#447700>! Which cell in the domain<a name='892'></font>
            activate=.true.<a name='893'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='894'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='895'></font>
          DO K=KTS,KTE<a name='896'>
            DO J=J1,J2,2<a name='897'>
<font color=#447700>!<a name='898'></font>
              IF(MOD(J,2)==1)THEN<a name='899'>
                CWM_BXE(J,K,IB)=CWM_BXE(J,K,IB)+CWM_BTXE(J,K,IB)*DT<a name='900'>
                CWM(II,J,K)=CWM_BXE(J,K,IB)<a name='901'>
              ENDIF<a name='902'>
<font color=#447700>!<a name='903'></font>
            ENDDO<a name='904'>
          ENDDO<a name='905'>
<font color=#447700>!<a name='906'></font>
       ENDIF if_ew  <font color=#447700>! for W/E boundaries<a name='907'></font>
       ew_moist: if(activate) then<a name='908'>
          DO I_M=1,N_MOIST<a name='909'>
            IF(I_M==P_QV)THEN<a name='910'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='911'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='912'></font>
              DO K=KTS,KTE<a name='913'>
              DO J=J1,J2,2<a name='914'>
                IF(MOD(J,2)==1)THEN<a name='915'>
                  MOIST(II,J,K,I_M)=Q(II,J,K)/(1.-Q(II,J,K))<a name='916'>
                ENDIF<a name='917'>
              ENDDO<a name='918'>
              ENDDO<a name='919'>
<font color=#447700>!<a name='920'></font>
            ELSE<a name='921'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='922'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='923'></font>
              DO K=KTS,KTE<a name='924'>
              DO J=J1,J2,2<a name='925'>
                IF(MOD(J,2)==1)THEN<a name='926'>
                  MOIST(II,J,K,I_M)=0.<a name='927'>
                ENDIF<a name='928'>
              ENDDO<a name='929'>
              ENDDO<a name='930'>
<font color=#447700>!<a name='931'></font>
            ENDIF<a name='932'>
          ENDDO<a name='933'>
<font color=#447700>!<a name='934'></font>
          DO I_M=2,N_SCALAR<a name='935'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='936'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='937'></font>
            DO K=KTS,KTE<a name='938'>
            DO J=J1,J2,2<a name='939'>
              IF(MOD(J,2)==1)THEN<a name='940'>
                SCALAR(II,J,K,I_M)=0.<a name='941'>
              ENDIF<a name='942'>
            ENDDO<a name='943'>
            ENDDO<a name='944'>
         ENDDO<a name='945'>
      ENDIF ew_moist<a name='946'>
   ENDDO ew_do<a name='947'>
<font color=#447700>!<a name='948'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='949'></font>
<font color=#447700>!***  SPACE INTERPOLATION OF PD THEN REMAINING MASS VARIABLES<a name='950'></font>
<font color=#447700>!***  AT INNER BOUNDARY<a name='951'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='952'></font>
<font color=#447700>!<a name='953'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='954'></font>
<font color=#447700>!<a name='955'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='956'></font>
<font color=#447700>!$omp&amp; private(i,j,jj,k)<a name='957'></font>
      DO 200 K=KTS,KTE<a name='958'>
<font color=#447700>!<a name='959'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='960'></font>
<font color=#447700>!<a name='961'></font>
<font color=#447700>!***  ONE ROW NORTH OF SOUTHERN BOUNDARY<a name='962'></font>
<font color=#447700>!<a name='963'></font>
      IF(S_BDY)THEN<a name='964'>
        DO I=MYIS,MYIE1<a name='965'>
          CWM(I,2,K)=(CWM(I,1,K)+CWM(I+1,1,K)+CWM(I,3,K)+CWM(I+1,3,K))  &amp;<a name='966'>
     &amp;               *0.25<a name='967'>
        ENDDO<a name='968'>
<font color=#447700>!<a name='969'></font>
        DO I_M=1,N_MOIST<a name='970'>
          IF(I_M==P_QV)THEN<a name='971'>
            DO I=MYIS,MYIE1<a name='972'>
              MOIST(I,2,K,I_M)=Q(I,2,K)/(1.-Q(I,2,K))<a name='973'>
            ENDDO<a name='974'>
          ELSE<a name='975'>
            DO I=MYIS,MYIE1<a name='976'>
              MOIST(I,2,K,I_M)=(MOIST(I,1,K,I_M)                        &amp;<a name='977'>
     &amp;                         +MOIST(I+1,1,K,I_M)                      &amp;<a name='978'>
     &amp;                         +MOIST(I,3,K,I_M)                        &amp;<a name='979'>
     &amp;                         +MOIST(I+1,3,K,I_M))*0.25<a name='980'>
            ENDDO<a name='981'>
          ENDIF<a name='982'>
        ENDDO<a name='983'>
<font color=#447700>!<a name='984'></font>
        DO I_M=2,N_SCALAR<a name='985'>
          DO I=MYIS,MYIE1<a name='986'>
            SCALAR(I,2,K,I_M)=(SCALAR(I,1,K,I_M)                        &amp;<a name='987'>
     &amp;                        +SCALAR(I+1,1,K,I_M)                      &amp;<a name='988'>
     &amp;                        +SCALAR(I,3,K,I_M)                        &amp;<a name='989'>
     &amp;                        +SCALAR(I+1,3,K,I_M))*0.25<a name='990'>
          ENDDO<a name='991'>
        ENDDO<a name='992'>
<font color=#447700>!<a name='993'></font>
      ENDIF<a name='994'>
<font color=#447700>!<a name='995'></font>
<font color=#447700>!***  ONE ROW SOUTH OF NORTHERN BOUNDARY<a name='996'></font>
<font color=#447700>!<a name='997'></font>
      IF(N_BDY)THEN<a name='998'>
        DO I=MYIS,MYIE1<a name='999'>
          CWM(I,JJM-1,K)=(CWM(I,JJM-2,K)+CWM(I+1,JJM-2,K)               &amp;<a name='1000'>
     &amp;                   +CWM(I,JJM,K)+CWM(I+1,JJM,K))                  &amp;<a name='1001'>
     &amp;                   *0.25<a name='1002'>
        ENDDO<a name='1003'>
<font color=#447700>!<a name='1004'></font>
        DO I_M=1,N_MOIST<a name='1005'>
          IF(I_M==P_QV)THEN<a name='1006'>
            DO I=MYIS,MYIE1<a name='1007'>
              MOIST(I,JJM-1,K,I_M)=Q(I,JJM-1,K)/(1.-Q(I,JJM-1,K))<a name='1008'>
            ENDDO<a name='1009'>
          ELSE<a name='1010'>
            DO I=MYIS,MYIE1<a name='1011'>
              MOIST(I,JJM-1,K,I_M)=(MOIST(I,JJM-2,K,I_M)                &amp;<a name='1012'>
     &amp;                             +MOIST(I+1,JJM-2,K,I_M)              &amp;<a name='1013'>
     &amp;                             +MOIST(I,JJM,K,I_M)                  &amp;<a name='1014'>
     &amp;                             +MOIST(I+1,JJM,K,I_M))*0.25<a name='1015'>
            ENDDO<a name='1016'>
<a name='1017'>
          ENDIF<a name='1018'>
        ENDDO<a name='1019'>
<font color=#447700>!<a name='1020'></font>
        DO I_M=2,N_SCALAR<a name='1021'>
          DO I=MYIS,MYIE1<a name='1022'>
            SCALAR(I,JJM-1,K,I_M)=(SCALAR(I,JJM-2,K,I_M)                &amp;<a name='1023'>
     &amp;                            +SCALAR(I+1,JJM-2,K,I_M)              &amp;<a name='1024'>
     &amp;                            +SCALAR(I,JJM,K,I_M)                  &amp;<a name='1025'>
     &amp;                            +SCALAR(I+1,JJM,K,I_M))*0.25<a name='1026'>
          ENDDO<a name='1027'>
        ENDDO<a name='1028'>
<font color=#447700>!<a name='1029'></font>
      ENDIF<a name='1030'>
<font color=#447700>!<a name='1031'></font>
<font color=#447700>!***  ONE ROW EAST OF WESTERN BOUNDARY<a name='1032'></font>
<font color=#447700>!<a name='1033'></font>
      IF(W_BDY)THEN<a name='1034'>
        DO J=J1B,J2B,2<a name='1035'>
            JJ=J<a name='1036'>
            CWM(1,JJ,K)=(CWM(1,JJ-1,K)+CWM(2,JJ-1,K)                    &amp;<a name='1037'>
     &amp;                  +CWM(1,JJ+1,K)+CWM(2,JJ+1,K))                   &amp;<a name='1038'>
     &amp;                  *0.25<a name='1039'>
<font color=#447700>!<a name='1040'></font>
            DO I_M=1,N_MOIST<a name='1041'>
              IF(I_M==P_QV)THEN<a name='1042'>
                MOIST(1,JJ,K,I_M)=Q(1,JJ,K)/(1.-Q(1,JJ,K))     <a name='1043'>
              ELSE  <a name='1044'>
                MOIST(1,JJ,K,I_M)=(MOIST(1,JJ-1,K,I_M)                  &amp;<a name='1045'>
     &amp;                            +MOIST(2,JJ-1,K,I_M)                  &amp;<a name='1046'>
     &amp;                            +MOIST(1,JJ+1,K,I_M)                  &amp;<a name='1047'>
     &amp;                            +MOIST(2,JJ+1,K,I_M))*0.25<a name='1048'>
              ENDIF<a name='1049'>
            ENDDO    <a name='1050'>
<font color=#447700>!<a name='1051'></font>
            DO I_M=2,N_SCALAR<a name='1052'>
              SCALAR(1,JJ,K,I_M)=(SCALAR(1,JJ-1,K,I_M)                  &amp;<a name='1053'>
     &amp;                           +SCALAR(2,JJ-1,K,I_M)                  &amp;<a name='1054'>
     &amp;                           +SCALAR(1,JJ+1,K,I_M)                  &amp;<a name='1055'>
     &amp;                           +SCALAR(2,JJ+1,K,I_M))*0.25<a name='1056'>
            ENDDO<a name='1057'>
<font color=#447700>!<a name='1058'></font>
        ENDDO<a name='1059'>
<font color=#447700>!<a name='1060'></font>
      ENDIF<a name='1061'>
<font color=#447700>!<a name='1062'></font>
<font color=#447700>!***  ONE ROW WEST OF EASTERN BOUNDARY<a name='1063'></font>
<font color=#447700>!<a name='1064'></font>
      IF(E_BDY)THEN<a name='1065'>
        DO J=J1B,J2B,2<a name='1066'>
            JJ=J<a name='1067'>
            CWM(IIM-1,JJ,K)=(CWM(IIM-1,JJ-1,K)+CWM(IIM,JJ-1,K)          &amp;<a name='1068'>
     &amp;                      +CWM(IIM-1,JJ+1,K)+CWM(IIM,JJ+1,K))         &amp;<a name='1069'>
     &amp;                      *0.25<a name='1070'>
<font color=#447700>!<a name='1071'></font>
            DO I_M=1,N_MOIST<a name='1072'>
              IF(I_M==P_QV)THEN<a name='1073'>
                MOIST(IIM-1,JJ,K,I_M)=Q(IIM-1,JJ,K)/(1.-Q(IIM-1,JJ,K))<a name='1074'>
              ELSE<a name='1075'>
                MOIST(IIM-1,JJ,K,I_M)=(MOIST(IIM-1,JJ-1,K,I_M)                   &amp;<a name='1076'>
     &amp;                                +MOIST(IIM,JJ-1,K,I_M)                     &amp;<a name='1077'>
     &amp;                                +MOIST(IIM-1,JJ+1,K,I_M)                   &amp;<a name='1078'>
     &amp;                                +MOIST(IIM,JJ+1,K,I_M))*0.25<a name='1079'>
                ENDIF<a name='1080'>
              ENDDO<a name='1081'>
<font color=#447700>!<a name='1082'></font>
              DO I_M=2,N_SCALAR<a name='1083'>
                SCALAR(IIM-1,JJ,K,I_M)=(SCALAR(IIM-1,JJ-1,K,I_M)                    &amp;<a name='1084'>
     &amp;                                 +SCALAR(IIM,JJ-1,K,I_M)                      &amp;<a name='1085'>
     &amp;                                 +SCALAR(IIM-1,JJ+1,K,I_M)                    &amp;<a name='1086'>
     &amp;                                 +SCALAR(IIM,JJ+1,K,I_M))*0.25<a name='1087'>
              ENDDO<a name='1088'>
<font color=#447700>!<a name='1089'></font>
        ENDDO<a name='1090'>
      ENDIF<a name='1091'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1092'></font>
<font color=#447700>!<a name='1093'></font>
  200 CONTINUE<a name='1094'>
<font color=#447700>!<a name='1095'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1096'></font>
      END SUBROUTINE MP_BULK_BOUNDARY<a name='1097'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1098'></font>
<font color=#447700>!***********************************************************************<a name='1099'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1100'></font>
<A NAME='BOCOV'><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#BOCOV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1101'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>BOCOV</font>(GRIDID,NTSD,DT,LB                                &amp; <A href='../../call_to/BOCOV.html' TARGET='index'>1</A><a name='1102'>
     &amp;                ,U_BXS,U_BXE,U_BYS,U_BYE                         &amp;  <a name='1103'>
     &amp;                ,V_BXS,V_BXE,V_BYS,V_BYE                         &amp;  <a name='1104'>
     &amp;                ,U_BTXS,U_BTXE,U_BTYS,U_BTYE                     &amp;  <a name='1105'>
     &amp;                ,V_BTXS,V_BTXE,V_BTYS,V_BTYE                     &amp;  <a name='1106'>
     &amp;                ,U,V                                              &amp;<a name='1107'>
     &amp;                ,SPEC_BDY_WIDTH                                   &amp;  <a name='1108'>
     &amp;                ,IHE,IHW,IVE,IVW                                  &amp;<a name='1109'>
     &amp;                ,IDS,IDE,JDS,JDE,KDS,KDE                          &amp;<a name='1110'>
     &amp;                ,IMS,IME,JMS,JME,KMS,KME                          &amp;<a name='1111'>
     &amp;                ,ITS,ITE,JTS,JTE,KTS,KTE)<a name='1112'>
<font color=#447700>!***********************************************************************<a name='1113'></font>
<font color=#447700>!$$$  SUBPROGRAM DOCUMENTATION BLOCK<a name='1114'></font>
<font color=#447700>!                .      .    .     <a name='1115'></font>
<font color=#447700>! SUBPROGRAM:    BOCOV       UPDATE WIND POINTS ON BOUNDARY<a name='1116'></font>
<font color=#447700>!   PRGRMMR: JANJIC          ORG: W/NP22     DATE: 94-03-08<a name='1117'></font>
<font color=#447700>!     <a name='1118'></font>
<font color=#447700>! ABSTRACT:<a name='1119'></font>
<font color=#447700>!     U AND V COMPONENTS OF THE WIND ARE UPDATED ON THE<a name='1120'></font>
<font color=#447700>!     DOMAIN BOUNDARY BY APPLYING THE PRE-COMPUTED<a name='1121'></font>
<font color=#447700>!     TENDENCIES AT EACH TIME STEP.  AN EXTRAPOLATION FROM<a name='1122'></font>
<font color=#447700>!     INSIDE THE DOMAIN IS USED FOR THE COMPONENT TANGENTIAL<a name='1123'></font>
<font color=#447700>!     TO THE BOUNDARY IF THE NORMAL COMPONENT IS OUTWARD.<a name='1124'></font>
<font color=#447700>!     <a name='1125'></font>
<font color=#447700>! PROGRAM HISTORY LOG:<a name='1126'></font>
<font color=#447700>!   87-??-??  MESINGER   - ORIGINATOR<a name='1127'></font>
<font color=#447700>!   95-03-25  BLACK      - CONVERSION FROM 1-D TO 2-D IN HORIZONTAL<a name='1128'></font>
<font color=#447700>!   98-10-30  BLACK      - MODIFIED FOR DISTRIBUTED MEMORY<a name='1129'></font>
<font color=#447700>!   01-03-13  BLACK      - CONVERTED TO WRF STRUCTURE<a name='1130'></font>
<font color=#447700>!   02-09-06  WOLFE      - MORE CONVERSION TO GLOBAL INDEXING <a name='1131'></font>
<font color=#447700>!   04-11-23  BLACK      - THREADED<a name='1132'></font>
<font color=#447700>!   05-12-19  BLACK      - CONVERTED FROM IKJ TO IJK<a name='1133'></font>
<font color=#447700>!   06-06-02  GOPAL      - MODIFICATIONS FOR NESTING<a name='1134'></font>
<font color=#447700>!     <a name='1135'></font>
<font color=#447700>! USAGE: CALL BOCOH FROM SUBROUTINE SOLVE_NMM<a name='1136'></font>
<font color=#447700>!   INPUT ARGUMENT LIST:<a name='1137'></font>
<font color=#447700>!<a name='1138'></font>
<font color=#447700>!     NOTE THAT IDE AND JDE INSIDE ROUTINE SHOULD BE PASSED IN<a name='1139'></font>
<font color=#447700>!     AS WHAT WRF CONSIDERS THE UNSTAGGERED GRID DIMENSIONS; THAT<a name='1140'></font>
<font color=#447700>!     IS, 1 LESS THAN THE IDE AND JDE SET BY WRF FRAMEWORK, JM<a name='1141'></font>
<font color=#447700>!  <a name='1142'></font>
<font color=#447700>!   OUTPUT ARGUMENT LIST: <a name='1143'></font>
<font color=#447700>!     <a name='1144'></font>
<font color=#447700>!   OUTPUT FILES:<a name='1145'></font>
<font color=#447700>!     NONE<a name='1146'></font>
<font color=#447700>!     <a name='1147'></font>
<font color=#447700>!   SUBPROGRAMS CALLED:<a name='1148'></font>
<font color=#447700>!  <a name='1149'></font>
<font color=#447700>!     UNIQUE: NONE<a name='1150'></font>
<font color=#447700>!  <a name='1151'></font>
<font color=#447700>!     LIBRARY: NONE<a name='1152'></font>
<font color=#447700>!  <a name='1153'></font>
<font color=#447700>! ATTRIBUTES:<a name='1154'></font>
<font color=#447700>!   LANGUAGE: FORTRAN 90<a name='1155'></font>
<font color=#447700>!   MACHINE : IBM <a name='1156'></font>
<font color=#447700>!$$$  <a name='1157'></font>
<font color=#447700>!***********************************************************************<a name='1158'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1159'></font>
<font color=#447700>!<a name='1160'></font>
      IMPLICIT NONE<a name='1161'>
<font color=#447700>!<a name='1162'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1163'></font>
      INTEGER,INTENT(IN) :: IDS,IDE,JDS,JDE,KDS,KDE                     &amp;<a name='1164'>
     &amp;                     ,IMS,IME,JMS,JME,KMS,KME                     &amp;<a name='1165'>
     &amp;                     ,ITS,ITE,JTS,JTE,KTS,KTE<a name='1166'>
      INTEGER,INTENT(IN) :: SPEC_BDY_WIDTH<a name='1167'>
<font color=#447700>!<a name='1168'></font>
      INTEGER,DIMENSION(JMS:JME),INTENT(IN) :: IHE,IHW,IVE,IVW<a name='1169'>
<font color=#447700>!<a name='1170'></font>
      INTEGER,INTENT(IN) :: GRIDID<a name='1171'>
      INTEGER,INTENT(IN) :: LB,NTSD<a name='1172'>
<font color=#447700>!<a name='1173'></font>
      REAL,INTENT(IN) :: DT<a name='1174'>
<font color=#447700>!<a name='1175'></font>
      REAL,DIMENSION(IMS:IME,KMS:KME,SPEC_BDY_WIDTH),INTENT(INOUT) ::     &amp;<a name='1176'>
     &amp;                                          U_BYS,U_BYE,V_BYS,V_BYE &amp;<a name='1177'>
     &amp;                                         ,U_BTYS,U_BTYE           &amp;<a name='1178'>
     &amp;                                         ,V_BTYS,V_BTYE           <a name='1179'>
<a name='1180'>
      REAL,DIMENSION(JMS:JME,KMS:KME,SPEC_BDY_WIDTH),INTENT(INOUT) ::     &amp;<a name='1181'>
     &amp;                                          U_BXS,U_BXE,V_BXS,V_BXE &amp;<a name='1182'>
     &amp;                                         ,U_BTXS,U_BTXE           &amp;<a name='1183'>
     &amp;                                         ,V_BTXS,V_BTXE <a name='1184'>
<font color=#447700>!<a name='1185'></font>
      REAL,DIMENSION(IMS:IME,JMS:JME,KMS:KME),INTENT(INOUT) :: U,V<a name='1186'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1187'></font>
<font color=#447700>!<a name='1188'></font>
<font color=#447700>!***  LOCAL VARIABLES<a name='1189'></font>
<font color=#447700>!<a name='1190'></font>
      INTEGER :: I,II,IIM,IM,J,JJ,JJM,JM,K,N<a name='1191'>
      INTEGER :: MY_IS_GLB, MY_JS_GLB,MY_IE_GLB,MY_JE_GLB  <a name='1192'>
      INTEGER :: IBDY,JB,IB<a name='1193'>
      INTEGER :: ILPAD1,IRPAD1,JBPAD1,JTPAD1<a name='1194'>
      LOGICAL :: E_BDY,W_BDY,N_BDY,S_BDY<a name='1195'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1196'></font>
<font color=#447700>!***********************************************************************<a name='1197'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1198'></font>
<font color=#447700>!<a name='1199'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1200'></font>
<font color=#447700>!***  TIME INTERPOLATION OF U AND V AT THE OUTER BOUNDARY<a name='1201'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1202'></font>
<font color=#447700>!<a name='1203'></font>
      IM=IDE-IDS+1<a name='1204'>
      JM=JDE-JDS+1<a name='1205'>
      IIM=IM<a name='1206'>
      JJM=JM<a name='1207'>
<font color=#447700>!<a name='1208'></font>
      W_BDY=(ITS==IDS)<a name='1209'>
      E_BDY=(ITE==IDE)<a name='1210'>
      S_BDY=(JTS==JDS)<a name='1211'>
      N_BDY=(JTE==JDE)<a name='1212'>
<font color=#447700>!<a name='1213'></font>
      ILPAD1=1<a name='1214'>
      IF(ITS==IDS)ILPAD1=0<a name='1215'>
      IRPAD1=1<a name='1216'>
      IF(ITE==IDE)ILPAD1=0<a name='1217'>
      JBPAD1=1<a name='1218'>
      IF(JTS==JDS)JBPAD1=0<a name='1219'>
      JTPAD1=1<a name='1220'>
      IF(JTE==JDE)JTPAD1=0<a name='1221'>
<font color=#447700>!<a name='1222'></font>
      MY_IS_GLB=ITS<a name='1223'>
      MY_IE_GLB=ITE<a name='1224'>
      MY_JS_GLB=JTS<a name='1225'>
      MY_JE_GLB=JTE<a name='1226'>
<font color=#447700>!<a name='1227'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1228'></font>
<font color=#447700>!***  SOUTH AND NORTH BOUNDARIES<a name='1229'></font>
<font color=#447700>!***  USE IBDY=1 FOR SOUTH; 2 FOR NORTH.<a name='1230'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1231'></font>
<font color=#447700>!<a name='1232'></font>
      DO IBDY=1,2  <a name='1233'>
<font color=#447700>!<a name='1234'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='1235'></font>
<font color=#447700>!<a name='1236'></font>
        IF(S_BDY.AND.IBDY==1) THEN<a name='1237'>
<font color=#447700>!<a name='1238'></font>
            JB=1         <font color=#447700>! Which cell in from Boundary <a name='1239'></font>
            JJ=1         <font color=#447700>! Which cell in the Domain<a name='1240'></font>
<font color=#447700>!<a name='1241'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1242'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='1243'></font>
          DO K=KTS,KTE<a name='1244'>
            DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='1245'>
              U_BYS(I,K,JB)=U_BYS(I,K,JB)+U_BTYS(I,K,JB)*DT<a name='1246'>
              V_BYS(I,K,JB)=V_BYS(I,K,JB)+V_BTYS(I,K,JB)*DT<a name='1247'>
              U(I,JJ,K)=U_BYS(I,K,JB)<a name='1248'>
              V(I,JJ,K)=V_BYS(I,K,JB)<a name='1249'>
            ENDDO<a name='1250'>
          ENDDO<a name='1251'>
<font color=#447700>!<a name='1252'></font>
<a name='1253'>
          ELSEIF(N_BDY.AND.IBDY==2) THEN<a name='1254'>
            JB=1         <font color=#447700>! Which cell in from Boundary<a name='1255'></font>
            JJ=JJM       <font color=#447700>! Which cell in the Domain<a name='1256'></font>
<a name='1257'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1258'></font>
<font color=#447700>!$omp&amp; private(i,k)<a name='1259'></font>
          DO K=KTS,KTE<a name='1260'>
            DO I=MAX(ITS-1,IDS),MIN(ITE+1,IDE)<a name='1261'>
              U_BYE(I,K,JB)=U_BYE(I,K,JB)+U_BTYE(I,K,JB)*DT<a name='1262'>
              V_BYE(I,K,JB)=V_BYE(I,K,JB)+V_BTYE(I,K,JB)*DT<a name='1263'>
              U(I,JJ,K)=U_BYE(I,K,JB)<a name='1264'>
              V(I,JJ,K)=V_BYE(I,K,JB)<a name='1265'>
            ENDDO<a name='1266'>
          ENDDO<a name='1267'>
<a name='1268'>
<a name='1269'>
          ENDIF<a name='1270'>
      ENDDO<a name='1271'>
<a name='1272'>
<font color=#447700>!<a name='1273'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1274'></font>
<font color=#447700>!***  WEST AND EAST BOUNDARIES<a name='1275'></font>
<font color=#447700>!***  USE IBDY=1 FOR WEST; 2 FOR EAST.<a name='1276'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1277'></font>
<font color=#447700>!<a name='1278'></font>
      DO IBDY=1,2    <a name='1279'>
<font color=#447700>!<a name='1280'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='1281'></font>
<font color=#447700>!<a name='1282'></font>
        IF(W_BDY.AND.IBDY==1) THEN<a name='1283'>
            IB=1         <font color=#447700>! Which cell in from boundary<a name='1284'></font>
            II=1         <font color=#447700>! Which cell in the domain<a name='1285'></font>
<font color=#447700>!<a name='1286'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1287'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='1288'></font>
          DO K=KTS,KTE<a name='1289'>
            DO J=MAX(JTS-1,JDS+2-1),MIN(JTE+1,JDE-1)<a name='1290'>
              IF(MOD(J,2)==0)THEN<a name='1291'>
                U_BXS(J,K,IB)=U_BXS(J,K,IB)+U_BTXS(J,K,IB)*DT<a name='1292'>
                V_BXS(J,K,IB)=V_BXS(J,K,IB)+V_BTXS(J,K,IB)*DT<a name='1293'>
                U(II,J,K)=U_BXS(J,K,IB)<a name='1294'>
                V(II,J,K)=V_BXS(J,K,IB)<a name='1295'>
              ENDIF<a name='1296'>
            ENDDO<a name='1297'>
          ENDDO<a name='1298'>
<a name='1299'>
        ELSEIF (E_BDY.AND.IBDY==2) THEN<a name='1300'>
            IB=1         <font color=#447700>! Which cell in from boundary<a name='1301'></font>
            II=IIM       <font color=#447700>! Which cell in the domain<a name='1302'></font>
<a name='1303'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1304'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='1305'></font>
          DO K=KTS,KTE<a name='1306'>
            DO J=MAX(JTS-1,JDS+2-1),MIN(JTE+1,JDE-1)<a name='1307'>
              IF(MOD(J,2)==0)THEN<a name='1308'>
                U_BXE(J,K,IB)=U_BXE(J,K,IB)+U_BTXE(J,K,IB)*DT<a name='1309'>
                V_BXE(J,K,IB)=V_BXE(J,K,IB)+V_BTXE(J,K,IB)*DT<a name='1310'>
                U(II,J,K)=U_BXE(J,K,IB)<a name='1311'>
                V(II,J,K)=V_BXE(J,K,IB)<a name='1312'>
              ENDIF<a name='1313'>
            ENDDO<a name='1314'>
          ENDDO<a name='1315'>
<a name='1316'>
<font color=#447700>!<a name='1317'></font>
        ENDIF<a name='1318'>
<a name='1319'>
<a name='1320'>
<a name='1321'>
      ENDDO<a name='1322'>
<a name='1323'>
<font color=#447700>!<a name='1324'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1325'></font>
<font color=#447700>!***  EXTRAPOLATION OF TANGENTIAL VELOCITY AT OUTFLOW POINTS<a name='1326'></font>
<font color=#447700>!***  BASED ON SOME DISCUSSIONS WITH ZAVISA, AND MY EXPERIMENTS<a name='1327'></font>
<font color=#447700>!***  ON GRAVITY PULSE FOR NESTED DOMAIN.<a name='1328'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1329'></font>
<font color=#447700>!<a name='1330'></font>
      IF(GRIDID/=1)GO TO 201<a name='1331'>
<font color=#447700>!<a name='1332'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1333'></font>
<font color=#447700>!<a name='1334'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1335'></font>
<font color=#447700>!$omp&amp; private(i,j,jj,k)<a name='1336'></font>
      DO 200 K=KTS,KTE<a name='1337'>
<font color=#447700>!<a name='1338'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1339'></font>
<font color=#447700>!<a name='1340'></font>
<font color=#447700>!***  SOUTHERN BOUNDARY<a name='1341'></font>
<font color=#447700>!<a name='1342'></font>
      IF(S_BDY)THEN<a name='1343'>
        DO I=MYIS1_P1,MYIE2_P1<a name='1344'>
          IF(V(I,1,K)&lt;0.)U(I,1,K)=2.*U(I,3,K)-U(I,5,K)<a name='1345'>
        ENDDO<a name='1346'>
      ENDIF<a name='1347'>
<font color=#447700>!<a name='1348'></font>
<font color=#447700>!***  NORTHERN BOUNDARY<a name='1349'></font>
<font color=#447700>!<a name='1350'></font>
      IF(N_BDY)THEN<a name='1351'>
        DO I=MYIS1_P1,MYIE2_P1<a name='1352'>
          IF(V(I,JJM,K)&gt;0.)                                             &amp;<a name='1353'>
     &amp;        U(I,JJM,K)=2.*U(I,JJM-2,K)-U(I,JJM-4,K)<a name='1354'>
        ENDDO<a name='1355'>
      ENDIF<a name='1356'>
<font color=#447700>!<a name='1357'></font>
<font color=#447700>!***  WESTERN BOUNDARY<a name='1358'></font>
<font color=#447700>!<a name='1359'></font>
      DO J=4,JM-3,2<a name='1360'>
        IF(W_BDY)THEN<a name='1361'>
<font color=#447700>!<a name='1362'></font>
          IF(W_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='1363'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='1364'>
            JJ=J<a name='1365'>
            IF(U(1,JJ,K)&lt;0.)                                            &amp;<a name='1366'>
     &amp;          V(1,JJ,K)=2.*V(2,JJ,K)-V(3,JJ,K)<a name='1367'>
          ENDIF<a name='1368'>
<font color=#447700>!<a name='1369'></font>
        ENDIF<a name='1370'>
      ENDDO<a name='1371'>
<font color=#447700>!<a name='1372'></font>
<font color=#447700>!***  EASTERN BOUNDARY<a name='1373'></font>
<font color=#447700>!<a name='1374'></font>
      DO J=4,JM-3,2<a name='1375'>
        IF(E_BDY)THEN<a name='1376'>
<font color=#447700>!<a name='1377'></font>
          IF(E_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='1378'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='1379'>
            JJ=J<a name='1380'>
            IF(U(IIM,JJ,K)&gt;0.)                                          &amp;<a name='1381'>
     &amp;          V(IIM,JJ,K)=2.*V(IIM-1,JJ,K)-V(IIM-2,JJ,K)<a name='1382'>
          ENDIF<a name='1383'>
<font color=#447700>!<a name='1384'></font>
        ENDIF<a name='1385'>
      ENDDO<a name='1386'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1387'></font>
<font color=#447700>!<a name='1388'></font>
  200 CONTINUE<a name='1389'>
<a name='1390'>
  201 CONTINUE<a name='1391'>
<font color=#447700>!<a name='1392'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1393'></font>
<font color=#447700>!<a name='1394'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1395'></font>
<font color=#447700>!***  SPACE INTERPOLATION OF U AND V AT THE INNER BOUNDARY<a name='1396'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1397'></font>
<font color=#447700>!<a name='1398'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1399'></font>
<font color=#447700>!<a name='1400'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1401'></font>
<font color=#447700>!$omp&amp; private(i,j,jj,k)<a name='1402'></font>
      DO 300 K=KTS,KTE<a name='1403'>
<font color=#447700>!<a name='1404'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1405'></font>
<font color=#447700>!<a name='1406'></font>
<font color=#447700>!***  SOUTHWEST CORNER<a name='1407'></font>
<font color=#447700>!<a name='1408'></font>
      IF(S_BDY.AND.W_BDY)THEN<a name='1409'>
        U(2,2,K)=D06666*(4.*(U(1,1,K)+U(2,1,K)+U(2,3,K))                &amp;<a name='1410'>
     &amp;                     + U(1,2,K)+U(1,4,K)+U(2,4,K))<a name='1411'>
        V(2,2,K)=D06666*(4.*(V(1,1,K)+V(2,1,K)+V(2,3,K))                &amp;<a name='1412'>
     &amp;                      +V(1,2,K)+V(1,4,K)+V(2,4,K))<a name='1413'>
      ENDIF<a name='1414'>
<font color=#447700>!<a name='1415'></font>
<font color=#447700>!***  SOUTHEAST CORNER<a name='1416'></font>
<font color=#447700>!<a name='1417'></font>
      IF(S_BDY.AND.E_BDY)THEN<a name='1418'>
        U(IIM-1,2,K)=D06666*(4.*(U(IIM-2,1,K)+U(IIM-1,1,K)              &amp;<a name='1419'>
     &amp;                          +U(IIM-2,3,K))                          &amp;<a name='1420'>
     &amp;                          +U(IIM,2,K)+U(IIM,4,K)+U(IIM-1,4,K))<a name='1421'>
        V(IIM-1,2,K)=D06666*(4.*(V(IIM-2,1,K)+V(IIM-1,1,K)              &amp;<a name='1422'>
     &amp;                          +V(IIM-2,3,K))                          &amp;<a name='1423'>
     &amp;                          +V(IIM,2,K)+V(IIM,4,K)+V(IIM-1,4,K))<a name='1424'>
      ENDIF<a name='1425'>
<font color=#447700>!<a name='1426'></font>
<font color=#447700>!***  NORTHWEST CORNER<a name='1427'></font>
<font color=#447700>!<a name='1428'></font>
      IF(N_BDY.AND.W_BDY)THEN<a name='1429'>
        U(2,JJM-1,K)=D06666*(4.*(U(1,JJM,K)+U(2,JJM,K)+U(2,JJM-2,K))    &amp;<a name='1430'>
     &amp;                          +U(1,JJM-1,K)+U(1,JJM-3,K)              &amp;<a name='1431'>
     &amp;                          +U(2,JJM-3,K))<a name='1432'>
        V(2,JJM-1,K)=D06666*(4.*(V(1,JJM,K)+V(2,JJM,K)+V(2,JJM-2,K))    &amp;<a name='1433'>
     &amp;                          +V(1,JJM-1,K)+V(1,JJM-3,K)              &amp;<a name='1434'>
     &amp;                          +V(2,JJM-3,K))<a name='1435'>
      ENDIF<a name='1436'>
<font color=#447700>!<a name='1437'></font>
<font color=#447700>!***  NORTHEAST CORNER<a name='1438'></font>
<font color=#447700>!<a name='1439'></font>
      IF(N_BDY.AND.E_BDY)THEN<a name='1440'>
        U(IIM-1,JJM-1,K)=                                               &amp;<a name='1441'>
     &amp;    D06666*(4.*(U(IIM-2,JJM,K)+U(IIM-1,JJM,K)+U(IIM-2,JJM-2,K))   &amp;<a name='1442'>
     &amp;               +U(IIM,JJM-1,K)+U(IIM,JJM-3,K)+U(IIM-1,JJM-3,K))<a name='1443'>
        V(IIM-1,JJM-1,K)=                                               &amp;<a name='1444'>
     &amp;    D06666*(4.*(V(IIM-2,JJM,K)+V(IIM-1,JJM,K)+V(IIM-2,JJM-2,K))   &amp;<a name='1445'>
     &amp;               +V(IIM,JJM-1,K)+V(IIM,JJM-3,K)+V(IIM-1,JJM-3,K))<a name='1446'>
      ENDIF<a name='1447'>
<font color=#447700>!<a name='1448'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1449'></font>
<font color=#447700>!***  SPACE INTERPOLATION OF U AND V AT THE INNER BOUNDARY<a name='1450'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1451'></font>
<font color=#447700>!<a name='1452'></font>
<font color=#447700>!***  ONE ROW NORTH OF SOUTHERN BOUNDARY<a name='1453'></font>
<font color=#447700>!<a name='1454'></font>
      IF(S_BDY)THEN<a name='1455'>
        DO I=MYIS2,MYIE2<a name='1456'>
          U(I,2,K)=(U(I-1,1,K)+U(I,1,K)+U(I-1,3,K)+U(I,3,K))*0.25<a name='1457'>
          V(I,2,K)=(V(I-1,1,K)+V(I,1,K)+V(I-1,3,K)+V(I,3,K))*0.25<a name='1458'>
        ENDDO<a name='1459'>
      ENDIF<a name='1460'>
<font color=#447700>!<a name='1461'></font>
<font color=#447700>!***  ONE ROW SOUTH OF NORTHERN BOUNDARY<a name='1462'></font>
<font color=#447700>!<a name='1463'></font>
      IF(N_BDY)THEN<a name='1464'>
        DO I=MYIS2,MYIE2<a name='1465'>
          U(I,JJM-1,K)=(U(I-1,JJM-2,K)+U(I,JJM-2,K)                     &amp;<a name='1466'>
     &amp;                 +U(I-1,JJM,K)+U(I,JJM,K))*0.25<a name='1467'>
          V(I,JJM-1,K)=(V(I-1,JJM-2,K)+V(I,JJM-2,K)                     &amp;<a name='1468'>
     &amp;                 +V(I-1,JJM,K)+V(I,JJM,K))*0.25<a name='1469'>
        ENDDO<a name='1470'>
      ENDIF<a name='1471'>
<font color=#447700>!<a name='1472'></font>
<font color=#447700>!***  ONE ROW EAST OF WESTERN BOUNDARY<a name='1473'></font>
<font color=#447700>!<a name='1474'></font>
      DO J=3,JM-2,2<a name='1475'>
        IF(W_BDY)THEN<a name='1476'>
          IF(W_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='1477'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='1478'>
            JJ=J<a name='1479'>
            U(1,JJ,K)=(U(1,JJ-1,K)+U(2,JJ-1,K)                          &amp;<a name='1480'>
     &amp;                +U(1,JJ+1,K)+U(2,JJ+1,K))*0.25<a name='1481'>
            V(1,JJ,K)=(V(1,JJ-1,K)+V(2,JJ-1,K)                          &amp;<a name='1482'>
     &amp;                +V(1,JJ+1,K)+V(2,JJ+1,K))*0.25<a name='1483'>
<a name='1484'>
<a name='1485'>
          ENDIF<a name='1486'>
        ENDIF<a name='1487'>
      ENDDO<a name='1488'>
<font color=#447700>!<a name='1489'></font>
<font color=#447700>!***  ONE ROW WEST OF EASTERN BOUNDARY<a name='1490'></font>
<font color=#447700>!<a name='1491'></font>
      IF(E_BDY)THEN<a name='1492'>
        DO J=3,JM-2,2<a name='1493'>
          IF(E_BDY.AND.J&gt;=MY_JS_GLB-JBPAD1                              &amp;<a name='1494'>
     &amp;            .AND.J&lt;=MY_JE_GLB+JTPAD1)THEN<a name='1495'>
            JJ=J<a name='1496'>
            U(IIM-1,JJ,K)=0.25*(U(IIM-1,JJ-1,K)+U(IIM,JJ-1,K)           &amp;<a name='1497'>
     &amp;                         +U(IIM-1,JJ+1,K)+U(IIM,JJ+1,K))<a name='1498'>
            V(IIM-1,JJ,K)=0.25*(V(IIM-1,JJ-1,K)+V(IIM,JJ-1,K)           &amp;<a name='1499'>
     &amp;                         +V(IIM-1,JJ+1,K)+V(IIM,JJ+1,K))<a name='1500'>
          ENDIF<a name='1501'>
        ENDDO<a name='1502'>
      ENDIF<a name='1503'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1504'></font>
<font color=#447700>!<a name='1505'></font>
  300 CONTINUE<a name='1506'>
<font color=#447700>!<a name='1507'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1508'></font>
<font color=#447700>!<a name='1509'></font>
      END SUBROUTINE BOCOV<a name='1510'>
<font color=#447700>!<a name='1511'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1512'></font>
<font color=#447700>!<a name='1513'></font>
    <font color=#447700>! ------------------------------------------------------------<a name='1514'></font>
    <font color=#447700>! Non-bulk boundary/tendancy function (mass points)<a name='1515'></font>
    <font color=#447700>! ------------------------------------------------------------<a name='1516'></font>
<a name='1517'>
<A NAME='MP_SPECIES_BDY'><A href='../../html_code/dyn_nmm/module_BNDRY_COND.F.html#MP_SPECIES_BDY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1518'>
    <font color=#993300>SUBROUTINE </font><font color=#cc0000>MP_SPECIES_BDY</font>(gridid, spec_bdy_width, dt,    &amp; <A href='../../call_to/MP_SPECIES_BDY.html' TARGET='index'>1</A><a name='1519'>
             CWM,Q,                                          &amp;<a name='1520'>
             MOIST,N_MOIST,                                  &amp;<a name='1521'>
             MOIST_bxs,MOIST_bxe,MOIST_bys,MOIST_bye,        &amp;<a name='1522'>
             MOIST_btxs,MOIST_btxe,MOIST_btys,MOIST_btye,    &amp;<a name='1523'>
             SCALAR,N_SCALAR,                                &amp;<a name='1524'>
             SCALAR_bxs,SCALAR_bxe,SCALAR_bys,SCALAR_bye,    &amp;<a name='1525'>
             SCALAR_btxs,SCALAR_btxe,SCALAR_btys,SCALAR_btye,&amp;<a name='1526'>
             ids,ide,jds,jde,kds,kde,                        &amp;<a name='1527'>
             ims,ime,jms,jme,kms,kme,                        &amp;<a name='1528'>
             its,ite,jts,jte,kts,kte)<a name='1529'>
<a name='1530'>
          implicit none<a name='1531'>
<a name='1532'>
          integer, intent(in) :: N_MOIST,N_SCALAR,           &amp;<a name='1533'>
               ids,ide,jds,jde,kds,kde,                      &amp;<a name='1534'>
               ims,ime,jms,jme,kms,kme,                      &amp;<a name='1535'>
               its,ite,jts,jte,kts,kte<a name='1536'>
          integer, intent(in) :: spec_bdy_width,gridid<a name='1537'>
          real, intent(in) :: dt<a name='1538'>
<a name='1539'>
          real, intent(inout),dimension(ims:ime,jms:jme,kms:kme) :: &amp;<a name='1540'>
               CWM,Q<a name='1541'>
<a name='1542'>
          real,dimension(ims:ime,kms:kme,spec_bdy_width,n_moist), &amp;<a name='1543'>
               intent(inout) :: MOIST_bys,MOIST_bye,MOIST_btys,MOIST_btye<a name='1544'>
<a name='1545'>
          real,dimension(jms:jme,kms:kme,spec_bdy_width,n_moist), &amp;<a name='1546'>
               intent(inout) :: MOIST_bxs,MOIST_bxe,MOIST_btxs,MOIST_btxe<a name='1547'>
<a name='1548'>
          real,dimension(ims:ime,kms:kme,spec_bdy_width,n_scalar), &amp;<a name='1549'>
               intent(inout) :: SCALAR_bys,SCALAR_bye,SCALAR_btys,SCALAR_btye<a name='1550'>
<a name='1551'>
          real,dimension(jms:jme,kms:kme,spec_bdy_width,n_scalar), &amp;<a name='1552'>
               intent(inout) :: SCALAR_bxs,SCALAR_bxe,SCALAR_btxs,SCALAR_btxe<a name='1553'>
<a name='1554'>
          real,intent(inout) :: MOIST(ims:ime,jms:jme,kms:kme,N_MOIST)<a name='1555'>
          real,intent(inout) :: SCALAR(ims:ime,jms:jme,kms:kme,N_SCALAR)<a name='1556'>
<a name='1557'>
          <font color=#447700>! ------------------------------------------------------------<a name='1558'></font>
          <font color=#447700>! LOCAL VARIABLES<a name='1559'></font>
          <font color=#447700>! ------------------------------------------------------------<a name='1560'></font>
<a name='1561'>
          INTEGER :: I,IB,IBDY,II,IIM,IM,IRTN,ISIZ1,ISIZ2                &amp;<a name='1562'>
         &amp;          ,J,JB,JJ,JJM,JM,K,KK,N,NN,NREC,NUMGAS,NV,REC<a name='1563'>
          INTEGER :: MY_IS_GLB,MY_JS_GLB,MY_IE_GLB,MY_JE_GLB  <a name='1564'>
          INTEGER :: I_M,ILPAD1,IRPAD1,JBPAD1,JTPAD1<a name='1565'>
          REAL :: BCHR,CONVFAC,CWK,PLYR,RRI<a name='1566'>
          LOGICAL :: E_BDY,W_BDY,N_BDY,S_BDY<a name='1567'>
          INTEGER :: i1,i2,j1,j2,j1b,j2b<a name='1568'>
<a name='1569'>
          <font color=#447700>! ------------------------------------------------------------<a name='1570'></font>
<a name='1571'>
          IM=IDE-IDS+1<a name='1572'>
          JM=JDE-JDS+1<a name='1573'>
          IIM=IM<a name='1574'>
          JJM=JM<a name='1575'>
<font color=#447700>!<a name='1576'></font>
      W_BDY=(ITS==IDS)<a name='1577'>
      E_BDY=(ITE==IDE)<a name='1578'>
      S_BDY=(JTS==JDS)<a name='1579'>
      N_BDY=(JTE==JDE)<a name='1580'>
<font color=#447700>!<a name='1581'></font>
      ILPAD1=1<a name='1582'>
      IF(W_BDY)ILPAD1=0<a name='1583'>
      IRPAD1=1<a name='1584'>
      IF(E_BDY)IRPAD1=0<a name='1585'>
      JBPAD1=1<a name='1586'>
      IF(S_BDY)JBPAD1=0<a name='1587'>
      JTPAD1=1<a name='1588'>
      IF(N_BDY)JTPAD1=0<a name='1589'>
<font color=#447700>!<a name='1590'></font>
      MY_IS_GLB=ITS<a name='1591'>
      MY_IE_GLB=ITE<a name='1592'>
      MY_JS_GLB=JTS<a name='1593'>
      MY_JE_GLB=JTE<a name='1594'>
<a name='1595'>
          <font color=#447700>! I loop ends for N/S bdy copying:<a name='1596'></font>
          i1=MAX(ITS-1,IDS)<a name='1597'>
          i2=MIN(ITE+1,IDE)<a name='1598'>
          <a name='1599'>
          <font color=#447700>! J loop ends for E/W bdy copying:<a name='1600'></font>
          j1=MAX(JTS-1,JDS+3-1)<a name='1601'>
          if(mod(j1,2)/=1) j1=j1+1<a name='1602'>
          j2=MIN(JTE+1,JDE-2)<a name='1603'>
          if(mod(j2,2)/=1) j2=j2-1<a name='1604'>
<a name='1605'>
          <font color=#447700>! J loop ends for E/W bdy 4-point averaging:<a name='1606'></font>
          J1B=MAX(4,MY_JS_GLB-JBPAD1)<a name='1607'>
          IF(MOD(J1B,2)/=0) J1B=J1B+1<a name='1608'>
          J2B=MIN(JM-3,MY_JE_GLB+JTPAD1)<a name='1609'>
          IF(MOD(J2B,2)/=0) J2B=J2B-1<a name='1610'>
<a name='1611'>
<a name='1612'>
          <font color=#447700>!<a name='1613'></font>
          <font color=#447700>!-----------------------------------------------------------------------<a name='1614'></font>
          <font color=#447700>!***  SOUTH AND NORTH BOUNDARIES<a name='1615'></font>
          <font color=#447700>!-----------------------------------------------------------------------<a name='1616'></font>
          <font color=#447700>!<a name='1617'></font>
          <font color=#447700>!***  USE IBDY=1 FOR SOUTH; 2 FOR NORTH<a name='1618'></font>
          <font color=#447700>!<a name='1619'></font>
          n_s_bdy: DO IBDY=1,2 <a name='1620'>
             <font color=#447700>!<a name='1621'></font>
             <font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='1622'></font>
             <font color=#447700>!<a name='1623'></font>
             if_n_s_bdy: IF(S_BDY.AND.IBDY==1) THEN <a name='1624'>
                JB=1         <font color=#447700>! Which cell in from boundary<a name='1625'></font>
                JJ=1         <font color=#447700>! Which cell in the domain<a name='1626'></font>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1627'></font>
                <font color=#447700>!$omp&amp; private(i,k)<a name='1628'></font>
                DO K=KTS,KTE<a name='1629'>
                   DO I=i1,i2<a name='1630'>
                      cwm(i,jj,k)=0.<a name='1631'>
                   END DO<a name='1632'>
                END DO<a name='1633'>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1634'></font>
                <font color=#447700>!$omp&amp; private(i,k,im)<a name='1635'></font>
                sbdy_type: DO IM=1,N_MOIST<a name='1636'>
                   if(IM==P_QV) cycle sbdy_type<a name='1637'>
                   DO K=KTS,KTE<a name='1638'>
                      DO I=i1,i2<a name='1639'>
                         MOIST_BYS(I,K,JB,IM)=MOIST_BYS(I,K,JB,IM)+MOIST_BTYS(I,K,JB,IM)*DT<a name='1640'>
                         MOIST(I,JJ,K,IM)=MOIST_BYS(I,K,JB,IM)<a name='1641'>
                         CWM(I,JJ,K)=CWM(I,JJ,K) + MOIST(I,JJ,K,IM)<a name='1642'>
                      ENDDO<a name='1643'>
                   ENDDO<a name='1644'>
                ENDDO sbdy_type<a name='1645'>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1646'></font>
                <font color=#447700>!$omp&amp; private(i,k,im)<a name='1647'></font>
                sbdy_Stype: DO IM=2,N_SCALAR<a name='1648'>
                   DO K=KTS,KTE<a name='1649'>
                      DO I=i1,i2<a name='1650'>
                         SCALAR_BYS(I,K,JB,IM)=SCALAR_BYS(I,K,JB,IM)+SCALAR_BTYS(I,K,JB,IM)*DT<a name='1651'>
                         SCALAR(I,JJ,K,IM)=SCALAR_BYS(I,K,JB,IM)<a name='1652'>
                      ENDDO<a name='1653'>
                   ENDDO<a name='1654'>
                ENDDO sbdy_Stype<a name='1655'>
<a name='1656'>
             ELSEIF(N_BDY.AND.IBDY==2) THEN<a name='1657'>
                JB=1         <font color=#447700>! Which cell in from boundary<a name='1658'></font>
                JJ=JJM       <font color=#447700>! Which cell in the domain<a name='1659'></font>
<a name='1660'>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1661'></font>
                <font color=#447700>!$omp&amp; private(i,k)<a name='1662'></font>
                DO K=KTS,KTE<a name='1663'>
                   DO I=i1,i2<a name='1664'>
                      CWM(i,jj,k)=0.<a name='1665'>
                   END DO<a name='1666'>
                END DO<a name='1667'>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1668'></font>
                <font color=#447700>!$omp&amp; private(i,k)<a name='1669'></font>
                nbdy_type: DO IM=1,N_MOIST<a name='1670'>
                   if(IM==P_QV) cycle nbdy_type<a name='1671'>
                   DO K=KTS,KTE<a name='1672'>
                      DO I=i1,i2<a name='1673'>
                         MOIST_BYE(I,K,JB,IM)=MOIST_BYE(I,K,JB,IM)+MOIST_BTYE(I,K,JB,IM)*DT<a name='1674'>
                         MOIST(I,JJ,K,IM)=MOIST_BYE(I,K,JB,IM)<a name='1675'>
                         CWM(I,JJ,K)=CWM(I,JJ,K) + MOIST(I,JJ,K,IM)<a name='1676'>
                      ENDDO<a name='1677'>
                   ENDDO<a name='1678'>
                ENDDO nbdy_type<a name='1679'>
                <font color=#447700>!$omp parallel do                        &amp;<a name='1680'></font>
                <font color=#447700>!$omp&amp; private(i,k)<a name='1681'></font>
                nbdy_Stype: DO IM=1,N_SCALAR<a name='1682'>
                   DO K=KTS,KTE<a name='1683'>
                      DO I=i1,i2<a name='1684'>
                         SCALAR_BYE(I,K,JB,IM)=SCALAR_BYE(I,K,JB,IM)+SCALAR_BTYE(I,K,JB,IM)*DT<a name='1685'>
                         SCALAR(I,JJ,K,IM)=SCALAR_BYE(I,K,JB,IM)<a name='1686'>
                      ENDDO<a name='1687'>
                   ENDDO<a name='1688'>
                ENDDO nbdy_Stype<a name='1689'>
             ENDIF if_n_s_bdy<a name='1690'>
          ENDDO n_s_bdy<a name='1691'>
<font color=#447700>!<a name='1692'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1693'></font>
<font color=#447700>!***  WEST AND EAST BOUNDARIES<a name='1694'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1695'></font>
<font color=#447700>!<a name='1696'></font>
<font color=#447700>!***  USE IBDY=1 FOR WEST; 2 FOR EAST. <a name='1697'></font>
<font color=#447700>!<a name='1698'></font>
      east_west_bt: DO IBDY=1,2 <a name='1699'>
<font color=#447700>!<a name='1700'></font>
<font color=#447700>!***  MAKE SURE THE PROCESSOR HAS THIS BOUNDARY.<a name='1701'></font>
<font color=#447700>!<a name='1702'></font>
         if_e_w_bt: IF(W_BDY.AND.IBDY==1) THEN  <a name='1703'>
            IB=1         <font color=#447700>! Which cell in from boundary <a name='1704'></font>
            II=1         <font color=#447700>! Which cell in the domain<a name='1705'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1706'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='1707'></font>
            DO K=KTS,KTE<a name='1708'>
               DO J=MAX(JTS-1,JDS+3-1),MIN(JTE+1,JDE-2)<a name='1709'>
                  cwm(ii,j,k)=0.<a name='1710'>
               ENDDO<a name='1711'>
            ENDDO<a name='1712'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1713'></font>
<font color=#447700>!$omp&amp; private(j,k,im)<a name='1714'></font>
            w_bdy_type: DO IM=1,N_MOIST<a name='1715'>
               if(IM==P_QV) cycle w_bdy_type<a name='1716'>
               DO K=KTS,KTE<a name='1717'>
                  DO J=j1,j2,2<a name='1718'>
                     MOIST_BXS(J,K,IB,IM)=MOIST_BXS(J,K,IB,IM)+MOIST_BTXS(J,K,IB,IM)*DT<a name='1719'>
                     MOIST(II,J,K,IM)=MOIST_BXS(J,K,IB,IM)<a name='1720'>
                     CWM(II,J,K)=CWM(II,J,K)+MOIST(II,J,K,IM)<a name='1721'>
                  ENDDO<a name='1722'>
               ENDDO<a name='1723'>
            ENDDO w_bdy_type<a name='1724'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1725'></font>
<font color=#447700>!$omp&amp; private(j,k,im)<a name='1726'></font>
            w_bdy_Stype: DO IM=2,N_SCALAR<a name='1727'>
               DO K=KTS,KTE<a name='1728'>
                  DO J=j1,j2,2<a name='1729'>
                     SCALAR_BXS(J,K,IB,IM)=SCALAR_BXS(J,K,IB,IM)+SCALAR_BTXS(J,K,IB,IM)*DT<a name='1730'>
                     SCALAR(II,J,K,IM)=SCALAR_BXS(J,K,IB,IM)<a name='1731'>
                  ENDDO<a name='1732'>
               ENDDO<a name='1733'>
            ENDDO w_bdy_Stype<a name='1734'>
          ELSEIF(E_BDY.AND.IBDY==2) THEN<a name='1735'>
            IB=1         <font color=#447700>! Which cell in from boundary<a name='1736'></font>
            II=IIM       <font color=#447700>! Which cell in the domain<a name='1737'></font>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1738'></font>
<font color=#447700>!$omp&amp; private(j,k)<a name='1739'></font>
          DO K=KTS,KTE<a name='1740'>
            DO J=j1,j2<a name='1741'>
               CWM(II,J,K)=0.<a name='1742'>
            ENDDO<a name='1743'>
         ENDDO<a name='1744'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1745'></font>
<font color=#447700>!$omp&amp; private(j,k,im)<a name='1746'></font>
         e_bdy_type: DO IM=1,N_MOIST<a name='1747'>
            if(IM==P_QV) cycle e_bdy_type<a name='1748'>
            DO K=KTS,KTE<a name='1749'>
               DO J=j1,j2<a name='1750'>
                  MOIST_BXE(J,K,IB,IM)=MOIST_BXE(J,K,IB,IM)+MOIST_BTXE(J,K,IB,IM)*DT<a name='1751'>
                  MOIST(II,J,K,IM)=MOIST_BXE(J,K,IB,IM)<a name='1752'>
                  CWM(II,J,K)=CWM(II,J,K)+MOIST(II,J,K,IM)<a name='1753'>
               ENDDO<a name='1754'>
            ENDDO<a name='1755'>
         ENDDO e_bdy_type<a name='1756'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1757'></font>
<font color=#447700>!$omp&amp; private(j,k,im)<a name='1758'></font>
         e_bdy_Stype: DO IM=2,N_SCALAR<a name='1759'>
            DO K=KTS,KTE<a name='1760'>
               DO J=j1,j2<a name='1761'>
                  SCALAR_BXE(J,K,IB,IM)=SCALAR_BXE(J,K,IB,IM)+SCALAR_BTXE(J,K,IB,IM)*DT<a name='1762'>
                  SCALAR(II,J,K,IM)=SCALAR_BXE(J,K,IB,IM)<a name='1763'>
               ENDDO<a name='1764'>
            ENDDO<a name='1765'>
         ENDDO e_bdy_Stype<a name='1766'>
      ENDIF if_e_w_bt<a name='1767'>
   ENDDO east_west_bt<a name='1768'>
<a name='1769'>
<a name='1770'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1771'></font>
<font color=#447700>!***  SPACE INTERPOLATION OF MICROPHYSICS VARIABLES<a name='1772'></font>
<font color=#447700>!***  AT INNER BOUNDARY<a name='1773'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1774'></font>
<a name='1775'>
<a name='1776'>
<font color=#447700>!<a name='1777'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1778'></font>
<font color=#447700>!<a name='1779'></font>
<font color=#447700>!***  ONE ROW NORTH OF SOUTHERN BOUNDARY<a name='1780'></font>
<font color=#447700>!<a name='1781'></font>
     s_bdy_avg: IF(S_BDY)THEN<a name='1782'>
        DO K=KTS,KTE<a name='1783'>
         DO I=MYIS,MYIE1<a name='1784'>
          CWM(I,2,K)=(CWM(I,1,K)+CWM(I+1,1,K)+CWM(I,3,K)+CWM(I+1,3,K))  &amp;<a name='1785'>
     &amp;               *0.25<a name='1786'>
         ENDDO<a name='1787'>
        ENDDO<a name='1788'>
<font color=#447700>!<a name='1789'></font>
        DO I_M=1,N_MOIST<a name='1790'>
          IF(I_M==P_QV)THEN<a name='1791'>
           DO K=KTS,KTE<a name='1792'>
            DO I=MYIS,MYIE1<a name='1793'>
              MOIST(I,2,K,I_M)=Q(I,2,K)/(1.-Q(I,2,K))<a name='1794'>
            ENDDO<a name='1795'>
           ENDDO<a name='1796'>
          ELSE<a name='1797'>
           DO K=KTS,KTE<a name='1798'>
            DO I=MYIS,MYIE1<a name='1799'>
              MOIST(I,2,K,I_M)=(MOIST(I,1,K,I_M)                        &amp;<a name='1800'>
     &amp;                         +MOIST(I+1,1,K,I_M)                      &amp;<a name='1801'>
     &amp;                         +MOIST(I,3,K,I_M)                        &amp;<a name='1802'>
     &amp;                         +MOIST(I+1,3,K,I_M))*0.25<a name='1803'>
            ENDDO<a name='1804'>
           ENDDO<a name='1805'>
          ENDIF<a name='1806'>
        ENDDO<a name='1807'>
<font color=#447700>!<a name='1808'></font>
        DO I_M=2,N_SCALAR<a name='1809'>
         DO K=KTS,KTE<a name='1810'>
          DO I=MYIS,MYIE1<a name='1811'>
            SCALAR(I,2,K,I_M)=(SCALAR(I,1,K,I_M)                        &amp;<a name='1812'>
     &amp;                        +SCALAR(I+1,1,K,I_M)                      &amp;<a name='1813'>
     &amp;                        +SCALAR(I,3,K,I_M)                        &amp;<a name='1814'>
     &amp;                        +SCALAR(I+1,3,K,I_M))*0.25<a name='1815'>
          ENDDO<a name='1816'>
         ENDDO<a name='1817'>
        ENDDO<a name='1818'>
<font color=#447700>!<a name='1819'></font>
     ENDIF s_bdy_avg<a name='1820'>
<font color=#447700>!<a name='1821'></font>
<font color=#447700>!***  ONE ROW SOUTH OF NORTHERN BOUNDARY<a name='1822'></font>
<font color=#447700>!<a name='1823'></font>
     n_bdy_avg: IF(N_BDY)THEN<a name='1824'>
        DO K=KTS,KTE<a name='1825'>
         DO I=MYIS,MYIE1<a name='1826'>
          CWM(I,JJM-1,K)=(CWM(I,JJM-2,K)+CWM(I+1,JJM-2,K)               &amp;<a name='1827'>
     &amp;                   +CWM(I,JJM,K)+CWM(I+1,JJM,K))                  &amp;<a name='1828'>
     &amp;                   *0.25<a name='1829'>
         ENDDO<a name='1830'>
        ENDDO<a name='1831'>
<font color=#447700>!<a name='1832'></font>
        DO I_M=1,N_MOIST<a name='1833'>
          IF(I_M==P_QV)THEN<a name='1834'>
           DO K=KTS,KTE<a name='1835'>
            DO I=MYIS,MYIE1<a name='1836'>
              MOIST(I,JJM-1,K,I_M)=Q(I,JJM-1,K)/(1.-Q(I,JJM-1,K))<a name='1837'>
            ENDDO<a name='1838'>
           ENDDO<a name='1839'>
          ELSE<a name='1840'>
           DO K=KTS,KTE<a name='1841'>
            DO I=MYIS,MYIE1<a name='1842'>
              MOIST(I,JJM-1,K,I_M)=(MOIST(I,JJM-2,K,I_M)                &amp;<a name='1843'>
     &amp;                             +MOIST(I+1,JJM-2,K,I_M)              &amp;<a name='1844'>
     &amp;                             +MOIST(I,JJM,K,I_M)                  &amp;<a name='1845'>
     &amp;                             +MOIST(I+1,JJM,K,I_M))*0.25<a name='1846'>
            ENDDO<a name='1847'>
           ENDDO<a name='1848'>
          ENDIF<a name='1849'>
        ENDDO<a name='1850'>
<font color=#447700>!<a name='1851'></font>
        DO I_M=2,N_SCALAR<a name='1852'>
         DO K=KTS,KTE<a name='1853'>
          DO I=MYIS,MYIE1<a name='1854'>
            SCALAR(I,JJM-1,K,I_M)=(SCALAR(I,JJM-2,K,I_M)                &amp;<a name='1855'>
     &amp;                            +SCALAR(I+1,JJM-2,K,I_M)              &amp;<a name='1856'>
     &amp;                            +SCALAR(I,JJM,K,I_M)                  &amp;<a name='1857'>
     &amp;                            +SCALAR(I+1,JJM,K,I_M))*0.25<a name='1858'>
          ENDDO<a name='1859'>
         ENDDO<a name='1860'>
        ENDDO<a name='1861'>
<font color=#447700>!<a name='1862'></font>
     ENDIF n_bdy_avg<a name='1863'>
<font color=#447700>!<a name='1864'></font>
<font color=#447700>!***  ONE ROW EAST OF WESTERN BOUNDARY<a name='1865'></font>
<font color=#447700>!<a name='1866'></font>
     w_bdy_avg:IF(W_BDY)THEN<a name='1867'>
       DO K=KTS,KTE<a name='1868'>
          DO J=J1B,J2B<a name='1869'>
             CWM(1,J,K)=(CWM(1,J-1,K)+CWM(2,J-1,K) &amp;<a name='1870'>
                       +CWM(1,J+1,K)+CWM(2,J+1,K)) &amp;<a name='1871'>
                       *0.25<a name='1872'>
          ENDDO<a name='1873'>
       ENDDO<a name='1874'>
       DO I_M=1,N_MOIST<a name='1875'>
          IF(I_M==P_QV)THEN<a name='1876'>
             DO K=KTS,KTE<a name='1877'>
                DO J=J1B,J2B<a name='1878'>
                   MOIST(1,J,K,I_M)=Q(1,J,K)/(1.-Q(1,J,K))     <a name='1879'>
                ENDDO<a name='1880'>
             ENDDO<a name='1881'>
          ELSE  <a name='1882'>
             DO K=KTS,KTE<a name='1883'>
                DO J=J1B,J2B<a name='1884'>
                   MOIST(1,J,K,I_M)=(MOIST(1,J-1,K,I_M) &amp;<a name='1885'>
                                  +MOIST(2,J-1,K,I_M) &amp;<a name='1886'>
                                  +MOIST(1,J+1,K,I_M) &amp;<a name='1887'>
                                  +MOIST(2,J+1,K,I_M))*0.25<a name='1888'>
                ENDDO<a name='1889'>
             ENDDO<a name='1890'>
          ENDIF<a name='1891'>
       ENDDO<a name='1892'>
       DO I_M=2,N_SCALAR<a name='1893'>
          DO K=KTS,KTE<a name='1894'>
             DO J=J1B,J2B<a name='1895'>
              SCALAR(1,J,K,I_M)=(SCALAR(1,J-1,K,I_M)                  &amp;<a name='1896'>
     &amp;                           +SCALAR(2,J-1,K,I_M)                  &amp;<a name='1897'>
     &amp;                           +SCALAR(1,J+1,K,I_M)                  &amp;<a name='1898'>
     &amp;                           +SCALAR(2,J+1,K,I_M))*0.25<a name='1899'>
             ENDDO<a name='1900'>
          ENDDO<a name='1901'>
       ENDDO<a name='1902'>
     ENDIF w_bdy_avg<a name='1903'>
<font color=#447700>!<a name='1904'></font>
<font color=#447700>!***  ONE ROW WEST OF EASTERN BOUNDARY<a name='1905'></font>
<font color=#447700>!<a name='1906'></font>
     e_bdy_avg:IF(E_BDY)THEN<a name='1907'>
        DO K=KTS,KTE<a name='1908'>
           DO J=J1B,J2B<a name='1909'>
            CWM(IIM-1,J,K)=(CWM(IIM-1,J-1,K)+CWM(IIM,J-1,K) &amp;<a name='1910'>
                           +CWM(IIM-1,J+1,K)+CWM(IIM,J+1,K)) &amp;<a name='1911'>
                           *0.25<a name='1912'>
           ENDDO<a name='1913'>
        ENDDO<a name='1914'>
        DO I_M=1,N_MOIST<a name='1915'>
          IF(I_M==P_QV)THEN<a name='1916'>
             DO K=KTS,KTE<a name='1917'>
                DO J=J1B,J2B<a name='1918'>
                   MOIST(IIM-1,J,K,I_M)=Q(IIM-1,J,K)/(1.-Q(IIM-1,J,K))<a name='1919'>
                ENDDO<a name='1920'>
             ENDDO<a name='1921'>
          ELSE<a name='1922'>
             DO K=KTS,KTE<a name='1923'>
                DO J=J1B,J2B<a name='1924'>
                   MOIST(IIM-1,J,K,I_M)=(MOIST(IIM-1,J-1,K,I_M)   &amp;<a name='1925'>
                                      +MOIST(IIM,J-1,K,I_M)        &amp;<a name='1926'>
                                      +MOIST(IIM-1,J+1,K,I_M)      &amp;<a name='1927'>
                                      +MOIST(IIM,J+1,K,I_M))*0.25<a name='1928'>
                ENDDO<a name='1929'>
             ENDDO<a name='1930'>
          ENDIF<a name='1931'>
        ENDDO<a name='1932'>
        DO I_M=2,N_SCALAR<a name='1933'>
          DO K=KTS,KTE<a name='1934'>
             DO J=J1B,J2B<a name='1935'>
                SCALAR(IIM-1,J,K,I_M)=(SCALAR(IIM-1,J-1,K,I_M)     &amp;<a name='1936'>
                                       +SCALAR(IIM,J-1,K,I_M)       &amp;<a name='1937'>
                                       +SCALAR(IIM-1,J+1,K,I_M)     &amp;<a name='1938'>
                                       +SCALAR(IIM,J+1,K,I_M))*0.25<a name='1939'>
             ENDDO<a name='1940'>
          ENDDO<a name='1941'>
        ENDDO<a name='1942'>
     ENDIF e_bdy_avg<a name='1943'>
       <a name='1944'>
      END SUBROUTINE MP_SPECIES_BDY<a name='1945'>
<font color=#447700>!<a name='1946'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1947'></font>
<font color=#447700>!<a name='1948'></font>
      END MODULE MODULE_BNDRY_COND<a name='1949'>
<font color=#447700>!<a name='1950'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1951'></font>
</pre></body></html>