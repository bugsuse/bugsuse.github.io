<HTML> <BODY BGCOLOR=#bbeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_TRACKER'><A href='../../html_code/dyn_nmm/module_tracker.F.html#MODULE_TRACKER' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>module </font><font color=#cc0000>module_tracker</font> <A href='../../call_to/MODULE_TRACKER.html' TARGET='index'>4</A><a name='3'>
  implicit none<a name='4'>
  private<a name='5'>
#if ( HWRF == 1 )<a name='6'>
  public :: ncep_tracker_center, ncep_tracker_init, update_tracker_post_move<a name='7'>
<a name='8'>
  real, parameter :: invE=0.36787944117 <font color=#447700>! 1/e<a name='9'></font>
<a name='10'>
  <font color=#447700>! Copied from tracker:<a name='11'></font>
  real,parameter :: searchrad_6=250.0 <font color=#447700>! km - ignore data more than this far from domain center<a name='12'></font>
  real,parameter :: searchrad_7=200.0 <font color=#447700>! km - ignore data more than this far from domain center<a name='13'></font>
  integer, parameter :: maxtp=11 <font color=#447700>! number of tracker parameters<a name='14'></font>
  real, parameter :: uverrmax = 225.0  <font color=#447700>! For use in get_uv_guess<a name='15'></font>
  real, parameter :: ecircum = 40030.2  <font color=#447700>! Earth's circumference<a name='16'></font>
  <font color=#447700>! (km) using erad=6371.e3<a name='17'></font>
  real, parameter :: rads_vmag=120.0 <font color=#447700>! max search radius for wind minimum<a name='18'></font>
  real, parameter :: err_reg_init=300.0 <font color=#447700>! max err at initial time (km)<a name='19'></font>
  real, parameter :: err_reg_max=225.0 <font color=#447700>! max err at other times (km)<a name='20'></font>
<a name='21'>
  real, parameter :: errpmax=485.0 <font color=#447700>! max stddev of track parameters<a name='22'></font>
  real, parameter :: errpgro=1.25 <font color=#447700>! stddev multiplier<a name='23'></font>
<a name='24'>
  real, parameter :: max_wind_search_radius=searchrad_7 <font color=#447700>! max radius for vmax search<a name='25'></font>
  real, parameter :: min_mlsp_search_radius=searchrad_7 <font color=#447700>! max radius for pmin search<a name='26'></font>
<a name='27'>
  <font color=#447700>! Also used:<a name='28'></font>
  real, parameter :: km2nmi = 0.539957, kn2mps=0.514444, mps2kn=1./kn2mps, pi180=0.01745329251<a name='29'>
contains<a name='30'>
<a name='31'>
  <font color=#447700>!----------------------------------------------------------------------------------<a name='32'></font>
  <font color=#447700>! These two simple routines return an N, S, E or W for the<a name='33'></font>
  <font color=#447700>! hemisphere of a latitude or longitude.  They are copied from<a name='34'></font>
  <font color=#447700>! module_HIFREQ to avoid a relatively pointless compiler dependency.<a name='35'></font>
<a name='36'>
<A NAME='GET_LAT_NS'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LAT_NS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='37'>
  character(1) <font color=#993300>function </font><font color=#cc0000>get_lat_ns</font>(lat)<a name='38'>
    <font color=#447700>! This could be written simply as merge('N','S',lat&gt;=0) if WRF allowed F95<a name='39'></font>
    implicit none ; real lat<a name='40'>
    if(lat&gt;=0) then<a name='41'>
       get_lat_ns='N'<a name='42'>
    else<a name='43'>
       get_lat_ns='S'<a name='44'>
    endif<a name='45'>
  end function get_lat_ns<a name='46'>
<A NAME='GET_LON_EW'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LON_EW' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='47'>
  character(1) <font color=#993300>function </font><font color=#cc0000>get_lon_ew</font>(lon)<a name='48'>
    <font color=#447700>! This could be written simply as merge('E','W',lon&gt;=0) if WRF allowed F95<a name='49'></font>
    implicit none ; real lon<a name='50'>
    if(lon&gt;=0) then<a name='51'>
       get_lon_ew='E'<a name='52'>
    else<a name='53'>
       get_lon_ew='W'<a name='54'>
    endif<a name='55'>
  end function get_lon_ew<a name='56'>
<a name='57'>
<A NAME='NCEP_TRACKER_INIT'><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_INIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='58'>
  <font color=#993300>subroutine </font><font color=#cc0000>ncep_tracker_init</font>(grid) <A href='../../call_to/NCEP_TRACKER_INIT.html' TARGET='index'>1</A>,<A href='../../call_from/NCEP_TRACKER_INIT.html' TARGET='index'>2</A><a name='59'>
    <font color=#447700>! Initialize tracker variables in the grid structure.<a name='60'></font>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_61">, only: domain<a name='61'>
    implicit none<a name='62'>
    type(domain), intent(inout) :: grid<a name='63'>
    call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_INIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_138">('ncep_tracker_init')<a name='64'>
    grid%track_stderr_m1=-99.9<a name='65'>
    grid%track_stderr_m2=-99.9<a name='66'>
    grid%track_stderr_m3=-99.9<a name='67'>
    grid%track_n_old=0<a name='68'>
    grid%track_old_lon=0<a name='69'>
    grid%track_old_lat=0<a name='70'>
    grid%track_old_ntsd=0<a name='71'>
<a name='72'>
    grid%tracker_angle=0<a name='73'>
    grid%tracker_fixlon=-999.0<a name='74'>
    grid%tracker_fixlat=-999.0<a name='75'>
    grid%tracker_ifix=-99<a name='76'>
    grid%tracker_jfix=-99<a name='77'>
    grid%tracker_havefix=.false.<a name='78'>
    grid%tracker_gave_up=.false.<a name='79'>
    grid%tracker_pmin=-99999.<a name='80'>
    grid%tracker_vmax=-99.<a name='81'>
    grid%tracker_rmw=-99.<a name='82'>
<a name='83'>
    grid%track_have_guess=.false.<a name='84'>
    grid%track_guess_lat=-999.0<a name='85'>
    grid%track_guess_lon=-999.0<a name='86'>
  end subroutine ncep_tracker_init<a name='87'>
<a name='88'>
<A NAME='NCEP_TRACKER_CENTER'><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_CENTER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='89'>
  <font color=#993300>subroutine </font><font color=#cc0000>ncep_tracker_center</font>(grid) <A href='../../call_to/NCEP_TRACKER_CENTER.html' TARGET='index'>1</A>,<A href='../../call_from/NCEP_TRACKER_CENTER.html' TARGET='index'>3</A><a name='90'>
    <font color=#447700>! Top-level entry to the inline ncep tracker.  Finds the center of<a name='91'></font>
    <font color=#447700>! the storm in the specified grid and updates the grid variables.<a name='92'></font>
    <font color=#447700>! Will do nothing and return immediately if<a name='93'></font>
    <font color=#447700>! grid%tracker_gave_up=.true.<a name='94'></font>
<a name='95'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_62">, ONLY : domain,get_ijk_from_grid<a name='96'>
    implicit none<a name='97'>
    type(domain), intent(inout) :: grid<a name='98'>
    character*255 :: message<a name='99'>
<a name='100'>
    integer :: IDS,IDE,JDS,JDE,KDS,KDE<a name='101'>
    integer :: IMS,IME,JMS,JME,KMS,KME<a name='102'>
    integer :: IPS,IPE,JPS,JPE,KPS,KPE<a name='103'>
<a name='104'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_22"> (  grid ,      &amp;<a name='105'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='106'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='107'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='108'>
<a name='109'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL'>ntc_impl</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NCEP_TRACKER_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="NTC_IMPL_1">(grid,                &amp;<a name='110'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='111'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='112'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='113'>
  end subroutine ncep_tracker_center<a name='114'>
<a name='115'>
<A NAME='NTC_IMPL'><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='116'>
  <font color=#993300>subroutine </font><font color=#cc0000>ntc_impl</font>(grid, &amp; <A href='../../call_to/NTC_IMPL.html' TARGET='index'>1</A>,<A href='../../call_from/NTC_IMPL.html' TARGET='index'>29</A><a name='117'>
       IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='118'>
       IMS,IME,JMS,JME,KMS,KME, &amp;<a name='119'>
       IPS,IPE,JPS,JPE,KPS,KPE)<a name='120'>
    <font color=#447700>! This is the main entry point to the tracker.  It is most similar<a name='121'></font>
    <font color=#447700>! to the function "tracker" in the GFDL/NCEP vortex tracker.<a name='122'></font>
<a name='123'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_63">, ONLY : domain,get_ijk_from_grid<a name='124'>
#ifdef DM_PARALLEL<a name='125'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_46">, only: wrf_dm_sum_real<a name='126'>
#endif<a name='127'>
    implicit none<a name='128'>
    logical, external :: wrf_dm_on_monitor<a name='129'>
    type(domain), intent(inout) :: grid<a name='130'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='131'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='132'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='133'>
<a name='134'>
    real :: dxdymean, sum<a name='135'>
    integer :: i,j, iweights,ip<a name='136'>
<a name='137'>
<a name='138'>
    integer :: iguess, jguess <font color=#447700>! first guess location<a name='139'></font>
    real :: latguess, longuess <font color=#447700>! same, but in lat &amp; lon<a name='140'></font>
<a name='141'>
    integer :: iuvguess, juvguess <font color=#447700>! "second guess" location using everything except wind maxima<a name='142'></font>
    real :: srsq<a name='143'>
    integer :: ifinal,jfinal<a name='144'>
    real :: latfinal,lonfinal<a name='145'>
    integer :: ierr<a name='146'>
    integer :: icen(maxtp), jcen(maxtp) <font color=#447700>! center locations for each parameter<a name='147'></font>
    real :: loncen(maxtp), latcen(maxtp) <font color=#447700>! lat, lon locations in degrees<a name='148'></font>
    logical :: calcparm(maxtp) <font color=#447700>! do we have a valid center location for this parameter?<a name='149'></font>
    real :: max_wind,min_pres <font color=#447700>! for ATCF output<a name='150'></font>
    real :: rcen(maxtp) <font color=#447700>! center value (max wind, min mslp, etc.)<a name='151'></font>
    character*255 :: message<a name='152'>
    logical :: north_hemi <font color=#447700>! true = northern hemisphere<a name='153'></font>
    logical :: have_guess <font color=#447700>! first guess is available<a name='154'></font>
    real :: guessdist,guessdeg <font color=#447700>! first guess distance to nearest point on grid<a name='155'></font>
    real :: latnear, lonnear <font color=#447700>! nearest point in grid to first guess<a name='156'></font>
<a name='157'>
    <font color=#447700>! icen,jcen: Same meaning as clon, clat in tracker, but uses i and<a name='158'></font>
    <font color=#447700>! j indexes of the center instead of lat/lon.  Tracker comment:<a name='159'></font>
    <font color=#447700>!            Holds the coordinates for the center positions for<a name='160'></font>
    <font color=#447700>!            all storms at all times for all parameters.<a name='161'></font>
    <font color=#447700>!            (max_#_storms, max_fcst_times, max_#_parms).<a name='162'></font>
    <font color=#447700>!            For the third position (max_#_parms), here they are:<a name='163'></font>
    <font color=#447700>!             1: Relative vorticity at 850 mb<a name='164'></font>
    <font color=#447700>!             2: Relative vorticity at 700 mb<a name='165'></font>
    <font color=#447700>!             3: Vector wind magnitude at 850 mb<a name='166'></font>
    <font color=#447700>!             4: NOT CURRENTLY USED<a name='167'></font>
    <font color=#447700>!             5: Vector wind magnitude at 700 mb<a name='168'></font>
    <font color=#447700>!             6: NOT CURRENTLY USED<a name='169'></font>
    <font color=#447700>!             7: Geopotential height at 850 mb<a name='170'></font>
    <font color=#447700>!             8: Geopotential height at 700 mb<a name='171'></font>
    <font color=#447700>!             9: Mean Sea Level Pressure<a name='172'></font>
    <font color=#447700>!            10: Vector wind magnitude at 10 m<a name='173'></font>
    <font color=#447700>!            11: Relative vorticity at 10 m<a name='174'></font>
<a name='175'>
    call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_139">('ncep_tracker_center')<a name='176'>
<a name='177'>
    <font color=#447700>! Initialize center information to invalid values for all centers:<a name='178'></font>
    icen=-99<a name='179'>
    jcen=-99<a name='180'>
    latcen=9e9<a name='181'>
    loncen=9e9<a name='182'>
    rcen=9e9<a name='183'>
    calcparm=.false.<a name='184'>
    if(grid%vortex_tracker==6) then<a name='185'>
       srsq=searchrad_6*searchrad_6*1e6<a name='186'>
    else<a name='187'>
       srsq=searchrad_7*searchrad_7*1e6<a name='188'>
    endif<a name='189'>
<a name='190'>
    <font color=#447700>! Get the first guess from the prior nest motion timestep:<a name='191'></font>
    have_guess=grid%track_have_guess<a name='192'>
    if(have_guess) then<a name='193'>
       <font color=#447700>! We have a first guess center.  We have to translate it to gridpoint space.<a name='194'></font>
       longuess=grid%track_guess_lon<a name='195'>
       latguess=grid%track_guess_lat<a name='196'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT'>get_nearest_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_NEAREST_LONLAT_1">(grid,iguess,jguess,ierr,longuess,latguess, &amp;<a name='197'>
            ids,ide, jds,jde, kds,kde, &amp;<a name='198'>
            ims,ime, jms,jme, kms,kme, &amp;<a name='199'>
            ips,ipe, jps,jpe, kps,kpe,     lonnear, latnear)<a name='200'>
       if(ierr==0) then<a name='201'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_1">(longuess,latguess, lonnear,latnear, guessdist,guessdeg)<a name='202'>
          if(guessdist*1e3&gt;3*grid%dy) then<a name='203'>
108          format('WARNING: guess lon=',F0.3,',lat=',F0.3, &amp;<a name='204'>
                  ' too far (',F0.3,'km) from nearest point lon=',F0.3,',lat=',F0.3, &amp;<a name='205'>
                  '.  Will use domain center as first guess.')<a name='206'>
             write(message,108) grid%track_guess_lon,grid%track_guess_lat, &amp;<a name='207'>
                  guessdist,lonnear,latnear<a name='208'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_140">(message)<a name='209'>
             have_guess=.false. <font color=#447700>! indicate that the first guess is unusable<a name='210'></font>
          else<a name='211'>
             latguess=latnear<a name='212'>
             longuess=lonnear<a name='213'>
          endif<a name='214'>
       else<a name='215'>
          have_guess=.false. <font color=#447700>! indicate that the first guess is unusable.<a name='216'></font>
109       format('WARNING: guess lon=',F0.3,',lat=',F0.3, &amp;<a name='217'>
                  ' does not exist in this domain.  Will use domain center as first guess.')<a name='218'>
          write(message,109) grid%track_guess_lon,grid%track_guess_lat<a name='219'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_141">(message)<a name='220'>
       endif<a name='221'>
   endif<a name='222'>
<a name='223'>
   <font color=#447700>! If we could not get the first guess from the prior nest motion<a name='224'></font>
   <font color=#447700>! timestep, then use the default first guess: the domain center.<a name='225'></font>
    if(grid%vortex_tracker==6 .or. .not.have_guess) then<a name='226'>
       <font color=#447700>! vt=6: hard coded first-guess center is domain center:<a name='227'></font>
       <font color=#447700>! vt=7: first guess comes from prior timestep<a name='228'></font>
       <font color=#447700>!     Initial first guess is domain center.<a name='229'></font>
       <font color=#447700>!     Backup first guess is domain center if first guess is unusable.<a name='230'></font>
       iguess=ide/2<a name='231'>
       jguess=jde/2<a name='232'>
       if(grid%vortex_tracker==7) then<a name='233'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_142">('Using domain center as first guess since no valid first guess is available.')<a name='234'>
       endif<a name='235'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_1">(grid,iguess,jguess,longuess,latguess,ierr, &amp;<a name='236'>
            ids,ide, jds,jde, kds,kde, &amp;<a name='237'>
            ims,ime, jms,jme, kms,kme, &amp;<a name='238'>
            ips,ipe, jps,jpe, kps,kpe)<a name='239'>
       if(ierr/=0) then<a name='240'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_106">("ERROR: center of domain is not inside the domain")<a name='241'>
       endif<a name='242'>
       have_guess=.true.<a name='243'>
    endif<a name='244'>
<a name='245'>
    if(.not.have_guess) then<a name='246'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_107">("INTERNAL ERROR: No first guess is available (should never happen).")<a name='247'>
    endif<a name='248'>
<a name='249'>
    north_hemi = latguess&gt;0.0<a name='250'>
<a name='251'>
    <font color=#447700>! Get the mean V-to-H point-to-point distance:<a name='252'></font>
    sum=0<a name='253'>
    do j=jps,min(jde-1,jpe)<a name='254'>
       do i=ips,min(ide-1,ipe)<a name='255'>
          sum=sum+grid%dx_nmm(i,j)<a name='256'>
       enddo<a name='257'>
    enddo<a name='258'>
#ifdef DM_PARALLEL<a name='259'>
    sum=<A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_SUM_REAL'>wrf_dm_sum_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SUM_REAL_10">(sum)<a name='260'>
#endif<a name='261'>
    dxdymean=0.5*(grid%dy_nmm + sum/( (ide-ids) * (jde-jds) ))/1000.0<a name='262'>
33  format ('dxdymean=',F0.3,' dx=',F0.3,' dy=',F0.3,' sum=',F0.3,' count=',I0)<a name='263'>
    <font color=#447700>!write(0,33) dxdymean,grid%dx_nmm((ips+ipe)/2,(jps+jpe)/2),grid%dy_nmm, &amp;<a name='264'></font>
    <font color=#447700>!     sum,(ide-ids) * (jde-jds)<a name='265'></font>
<a name='266'>
    <font color=#447700>! Find the centers of all fields except the wind minima:<a name='267'></font>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_1">(grid,grid%p850rv,grid%sp850rv,srsq, &amp;<a name='268'>
         icen(1),jcen(1),rcen(1),calcparm(1),loncen(1),latcen(1),dxdymean,'zeta', &amp;<a name='269'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='270'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='271'>
         IPS,IPE,JPS,JPE,KPS,KPE, north_hemi=north_hemi)<a name='272'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_2">(grid,grid%p700rv,grid%sp700rv,srsq, &amp;<a name='273'>
         icen(2),jcen(2),rcen(2),calcparm(2),loncen(2),latcen(2),dxdymean,'zeta', &amp;<a name='274'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='275'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='276'>
         IPS,IPE,JPS,JPE,KPS,KPE, north_hemi=north_hemi)<a name='277'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_3">(grid,grid%p850z,grid%sp850z,srsq, &amp;<a name='278'>
         icen(7),jcen(7),rcen(7),calcparm(7),loncen(7),latcen(7),dxdymean,'hgt', &amp;<a name='279'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='280'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='281'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='282'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_4">(grid,grid%p700z,grid%sp700z,srsq, &amp;<a name='283'>
         icen(8),jcen(8),rcen(8),calcparm(8),loncen(8),latcen(8),dxdymean,'hgt', &amp;<a name='284'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='285'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='286'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='287'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_5">(grid,grid%membrane_mslp,grid%smslp,srsq, &amp;<a name='288'>
         icen(9),jcen(9),rcen(9),calcparm(9),loncen(9),latcen(9),dxdymean,'slp', &amp;<a name='289'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='290'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='291'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='292'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_6">(grid,grid%m10rv,grid%sm10rv,srsq, &amp;<a name='293'>
         icen(11),jcen(11),rcen(11),calcparm(11),loncen(11),latcen(11),dxdymean,'zeta', &amp;<a name='294'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='295'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='296'>
         IPS,IPE,JPS,JPE,KPS,KPE, north_hemi=north_hemi)<a name='297'>
<a name='298'>
    <font color=#447700>! Get a guess center location for the wind minimum searches:<a name='299'></font>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_GUESS'>get_uv_guess</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_UV_GUESS_1">(grid,icen,jcen,loncen,latcen,calcparm, &amp;<a name='300'>
         iguess,jguess,longuess,latguess,iuvguess,juvguess, &amp;<a name='301'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='302'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='303'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='304'>
<a name='305'>
    <font color=#447700>! Find wind minima.  Requires a first guess center:<a name='306'></font>
    windmin: if(grid%vortex_tracker==6) then<a name='307'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_7">(grid,grid%p850wind,grid%sp850wind,srsq, &amp;<a name='308'>
            icen(3),jcen(3),rcen(3),calcparm(3),loncen(3),latcen(3),dxdymean,'wind', &amp;<a name='309'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='310'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='311'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='312'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='313'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_8">(grid,grid%p700wind,grid%sp700wind,srsq, &amp;<a name='314'>
            icen(5),jcen(5),rcen(5),calcparm(5),loncen(5),latcen(5),dxdymean,'wind', &amp;<a name='315'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='316'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='317'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='318'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='319'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER'>find_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_CENTER_9">(grid,grid%m10wind,grid%sm10wind,srsq, &amp;<a name='320'>
            icen(10),jcen(10),rcen(10),calcparm(10),loncen(10),latcen(10),dxdymean,'wind', &amp;<a name='321'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='322'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='323'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='324'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='325'>
    else<a name='326'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER'>get_uv_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_UV_CENTER_1">(grid,grid%p850wind, &amp;<a name='327'>
            icen(3),jcen(3),rcen(3),calcparm(3),loncen(3),latcen(3),dxdymean,'wind', &amp;<a name='328'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='329'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='330'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='331'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='332'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER'>get_uv_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_UV_CENTER_2">(grid,grid%p700wind, &amp;<a name='333'>
            icen(5),jcen(5),rcen(5),calcparm(5),loncen(5),latcen(5),dxdymean,'wind', &amp;<a name='334'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='335'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='336'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='337'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='338'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER'>get_uv_center</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_UV_CENTER_3">(grid,grid%m10wind, &amp;<a name='339'>
            icen(10),jcen(10),rcen(10),calcparm(10),loncen(10),latcen(10),dxdymean,'wind', &amp;<a name='340'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='341'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='342'>
            IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='343'>
            iuvguess=iuvguess, juvguess=juvguess)<a name='344'>
    endif windmin<a name='345'>
<a name='346'>
    <font color=#447700>! Get a final guess center location:<a name='347'></font>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER'>fixcenter</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIXCENTER_1">(grid,icen,jcen,calcparm,loncen,latcen, &amp;<a name='348'>
         iguess,jguess,longuess,latguess, &amp;<a name='349'>
         ifinal,jfinal,lonfinal,latfinal, &amp;<a name='350'>
         north_hemi, &amp;<a name='351'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='352'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='353'>
         ips,ipe, jps,jpe, kps,kpe)<a name='354'>
<a name='355'>
    grid%tracker_fixes=0<a name='356'>
    do ip=1,maxtp<a name='357'>
       if(calcparm(ip)) then<a name='358'>
300       format('Parameter ',I0,': i=',I0,' j=',I0,' lon=',F0.2,' lat=',F0.2)<a name='359'>
          <font color=#447700>!write(0,300) ip,icen(ip),jcen(ip),loncen(ip),latcen(ip)<a name='360'></font>
          if(icen(ip)&gt;=ips .and. icen(ip)&lt;=ipe &amp;<a name='361'>
               .and. jcen(ip)&gt;=jps .and. jcen(ip)&lt;=jpe) then<a name='362'>
             grid%tracker_fixes(icen(ip),jcen(ip))=ip<a name='363'>
          endif<a name='364'>
       else<a name='365'>
301       format('Parameter ',I0,' invalid')<a name='366'>
          <font color=#447700>!write(0,301) ip<a name='367'></font>
       endif<a name='368'>
    enddo<a name='369'>
<a name='370'>
    if(iguess&gt;=ips .and. iguess&lt;=ipe .and. jguess&gt;=jps .and. jguess&lt;=jpe) then<a name='371'>
       grid%tracker_fixes(iguess,jguess)=-1<a name='372'>
201    format('First guess: i=',I0,' j=',I0,' lon=',F0.2,' lat=',F0.2)<a name='373'>
       <font color=#447700>!write(0,201) iguess,jguess,longuess,latguess<a name='374'></font>
    endif<a name='375'>
<a name='376'>
    if(iuvguess&gt;=ips .and. iuvguess&lt;=ipe .and. juvguess&gt;=jps .and. juvguess&lt;=jpe) then<a name='377'>
       grid%tracker_fixes(iuvguess,juvguess)=-2<a name='378'>
202    format('UV guess: i=',I0,' j=',I0)<a name='379'>
       <font color=#447700>!write(0,202) iguess,jguess<a name='380'></font>
    endif<a name='381'>
<a name='382'>
1000 format('Back with final lat/lon at i=',I0,' j=',I0,' lon=',F0.3,' lat=',F0.3)<a name='383'>
    <font color=#447700>!write(0,1000) ifinal,jfinal,lonfinal,latfinal<a name='384'></font>
<a name='385'>
    if(ifinal&gt;=ips .and. ifinal&lt;=ipe .and. jfinal&gt;=jps .and. jfinal&lt;=jpe) then<a name='386'>
       grid%tracker_fixes(ifinal,jfinal)=-3<a name='387'>
203    format('Final fix: i=',I0,' j=',I0,' lon=',F0.2,' lat=',F0.2)<a name='388'>
       <font color=#447700>!write(0,201) ifinal,jfinal,lonfinal,latfinal<a name='389'></font>
    endif<a name='390'>
<a name='391'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ'>get_tracker_distsq</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_TRACKER_DISTSQ_1">(grid, &amp;<a name='392'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='393'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='394'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='395'>
<a name='396'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY'>get_wind_pres_intensity</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_WIND_PRES_INTENSITY_1">(grid, &amp;<a name='397'>
         grid%tracker_pmin,grid%tracker_vmax,grid%tracker_rmw, &amp;<a name='398'>
         max_wind_search_radius, min_mlsp_search_radius, &amp;<a name='399'>
         lonfinal,latfinal, &amp;<a name='400'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='401'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='402'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='403'>
<a name='404'>
#ifdef DM_PARALLEL<a name='405'>
    if(wrf_dm_on_monitor()) then<a name='406'>
#endif<a name='407'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#OUTPUT_PARTIAL_ATCFUNIX'>output_partial_atcfunix</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NTC_IMPL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="OUTPUT_PARTIAL_ATCFUNIX_1">(grid, &amp;<a name='408'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='409'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='410'>
            IPS,IPE,JPS,JPE,KPS,KPE)<a name='411'>
#ifdef DM_PARALLEL<a name='412'>
    endif<a name='413'>
#endif<a name='414'>
<a name='415'>
<font color=#447700>!     if(grid%vortex_tracker==7) then<a name='416'></font>
<font color=#447700>!        call get_first_ges(grid,iguess,jguess,longuess,latguess, &amp;<a name='417'></font>
<font color=#447700>!             IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='418'></font>
<font color=#447700>!             IMS,IME,JMS,JME,KMS,KME, &amp;<a name='419'></font>
<font color=#447700>!             IPS,IPE,JPS,JPE,KPS,KPE)<a name='420'></font>
       <a name='421'>
<font color=#447700>!        call store_old_fixes(grid, &amp;<a name='422'></font>
<font color=#447700>!             IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='423'></font>
<font color=#447700>!             IMS,IME,JMS,JME,KMS,KME, &amp;<a name='424'></font>
<font color=#447700>!             IPS,IPE,JPS,JPE,KPS,KPE)<a name='425'></font>
<a name='426'>
<font color=#447700>!        ! Store the first guess:<a name='427'></font>
<font color=#447700>!        grid%track_have_guess=.true.<a name='428'></font>
<font color=#447700>!        grid%track_guess_lat=latguess<a name='429'></font>
<font color=#447700>!        grid%track_guess_lon=longuess<a name='430'></font>
<font color=#447700>! 3011   format('First guess: lon=',F0.3,' lat=',F0.3)<a name='431'></font>
<font color=#447700>!        write(message,3011) grid%track_guess_lon,grid%track_guess_lat<a name='432'></font>
<font color=#447700>!        call wrf_debug(1,message)<a name='433'></font>
<font color=#447700>!     endif<a name='434'></font>
<a name='435'>
  end subroutine ntc_impl<a name='436'>
<a name='437'>
<A NAME='GET_FIRST_GES'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='438'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_first_ges</font>(grid,  &amp;,<A href='../../call_from/GET_FIRST_GES.html' TARGET='index'>23</A><a name='439'>
         iguess,jguess,longuess,latguess, &amp;<a name='440'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='441'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='442'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='443'>
    <font color=#447700>! This replicates the functionality of the tracker get_first_ges<a name='444'></font>
    <font color=#447700>! routine, whose purpose is to analyze the storm and guess where<a name='445'></font>
    <font color=#447700>! it will be at the next nest motion timestep.  It does that using<a name='446'></font>
    <font color=#447700>! two different methods, similar to the GFDL/NCEP Tracker's<a name='447'></font>
    <font color=#447700>! methods:<a name='448'></font>
    <font color=#447700>!<a name='449'></font>
    <font color=#447700>!  1. Use the present, and past few, fix locations and extrapolate<a name='450'></font>
    <font color=#447700>!  to the next location.<a name='451'></font>
    <font color=#447700>!  <a name='452'></font>
    <font color=#447700>!  2. Calculate the mean motion and extrapolate to get the<a name='453'></font>
    <font color=#447700>!  location at the next nest motion timestep.<a name='454'></font>
    <font color=#447700>!<a name='455'></font>
    <font color=#447700>! The average of the two results is used.<a name='456'></font>
<a name='457'>
#ifdef DM_PARALLEL<a name='458'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_47">, only: wrf_dm_maxval_real<a name='459'>
#endif<a name='460'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_64">, ONLY : domain,get_ijk_from_grid<a name='461'>
    use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_11">, only: wrf_at_debug_level<a name='462'>
    implicit none<a name='463'>
    type(domain), intent(inout) :: grid<a name='464'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='465'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='466'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='467'>
    integer, intent(out) :: iguess,jguess<a name='468'>
    real, intent(out) :: longuess,latguess<a name='469'>
<a name='470'>
    character*255 message<a name='471'>
    integer :: iold, inew, jold, jnew<a name='472'>
    integer :: ifix,jfix,jrot,irot,ierr, pinky,brain, n, tsum, ntsd_plus_1, i, told<a name='473'>
    real :: motion_grideast, motion_gridnorth, fixdx<a name='474'>
    real :: dxeast,dynorth, xeast, ynorth<a name='475'>
    real :: dxrot, dyrot, tracker_dt, xsum, ysum, ytsum, xtsum, xxsum, yysum, ttsum<a name='476'>
    real :: mx, my, bx, by <font color=#447700>! x=mx*t+bx ; y=my*t+by<a name='477'></font>
    real :: xrot,yrot<a name='478'>
    logical :: have_motion_guess, have_line_guess<a name='479'>
<a name='480'>
    have_motion_guess=.false.<a name='481'>
    have_line_guess=.false.<a name='482'>
<a name='483'>
    if(grid%tracker_havefix) then<a name='484'>
       ifix=grid%tracker_ifix<a name='485'>
       jfix=grid%tracker_jfix<a name='486'>
<a name='487'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION'>mean_motion</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MEAN_MOTION_1">(grid, motion_grideast, motion_gridnorth, &amp;<a name='488'>
            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='489'>
            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='490'>
            IPS,IPE,JPS,JPE,KPS,KPE)<a name='491'>
<a name='492'>
#ifdef DM_PARALLEL<a name='493'>
       fixdx=0<a name='494'>
       if(ifix&gt;=ips .and. ifix&lt;=ipe .and. jfix&gt;=jps .and. jfix&lt;=jpe) then<a name='495'>
          fixdx=grid%dx_nmm(ifix,jfix)<a name='496'>
       endif<a name='497'>
       pinky=2 ; brain=308<a name='498'>
       call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_5">(fixdx,pinky,brain)<a name='499'>
#else<a name='500'>
       fixdx=grid%dx_nmm(ifix,jfix)<a name='501'>
#endif<a name='502'>
<a name='503'>
       <font color=#447700>! Rotated east and north motion in gridpoints per second, on the combined H+V grid:<a name='504'></font>
       tracker_dt=grid%dt*grid%nphs*grid%ntrack<a name='505'>
       dxeast = motion_grideast * tracker_dt / fixdx<a name='506'>
       dynorth = motion_gridnorth * tracker_dt / grid%dy_nmm<a name='507'>
<a name='508'>
       <font color=#447700>! Combine the H &amp; V coordinate systems and rotate 45 degrees.<a name='509'></font>
       <font color=#447700>! This puts the H points on a rectangular grid.  Add storm motion<a name='510'></font>
       <font color=#447700>! to the rotated coordinates and round to nearest H point<a name='511'></font>
       xeast=ifix*2<a name='512'>
       ynorth=jfix<a name='513'>
       if(mod(jfix,2)==0) xeast=xeast+1<a name='514'>
       jrot=nint((xeast+ynorth)/2 + (dxeast+dynorth)/2)<a name='515'>
       irot=nint((ynorth-xeast)/2 + ((jde-1)/2) + (dynorth-dxeast)/2)<a name='516'>
<a name='517'>
       <font color=#447700>! Translate back to usual E grid H points<a name='518'></font>
       iguess=irot-jrot+((jde-1)/2)<a name='519'>
       jguess=irot+jrot-((jde-1)/2)<a name='520'>
       if(mod(jguess,2)==0) then<a name='521'>
          iguess=(iguess-1)/2<a name='522'>
       else<a name='523'>
          iguess=iguess/2<a name='524'>
       endif<a name='525'>
<a name='526'>
       <font color=#447700>! This last step should not be necessary but done just in case:<a name='527'></font>
       have_motion_guess = .not.(iguess&lt;ide/4 .or. iguess&gt;ide*3/4 .or. jguess&lt;jde/4 .or. jguess&gt;jde*3/4)<a name='528'>
<a name='529'>
       <font color=#447700>!print *,'got have_motion_guess=',have_motion_guess<a name='530'></font>
    endif<a name='531'>
<a name='532'>
    if(.not.have_motion_guess) then<a name='533'>
       <font color=#447700>! Could not find the storm, so give the domain center as the<a name='534'></font>
       <font color=#447700>! next first guess location.<a name='535'></font>
       iguess=ide/2<a name='536'>
       jguess=jde/2<a name='537'>
       <font color=#447700>!print *,'cannot find storm, so using domain center for motion guess'<a name='538'></font>
    endif<a name='539'>
<a name='540'>
    if(grid%track_n_old&gt;0) then<a name='541'>
       <font color=#447700>!print *,'line guess: have old'<a name='542'></font>
       n=1<a name='543'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#TO_ROT45_GRID'>to_rot45_grid</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TO_ROT45_GRID_1">(grid%tracker_ifix,grid%tracker_jfix,jde,xrot,yrot)<a name='544'>
       xsum=xrot<a name='545'>
       ysum=yrot<a name='546'>
       tsum=grid%ntsd<a name='547'>
       xtsum=xsum*tsum<a name='548'>
       xxsum=xsum*xsum<a name='549'>
       yysum=ysum*ysum<a name='550'>
       ytsum=ysum*tsum<a name='551'>
       ttsum=tsum*tsum<a name='552'>
       <a name='553'>
       do i=1,grid%track_n_old<a name='554'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT'>get_nearest_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_NEAREST_LONLAT_2">(grid,iold,jold,ierr, &amp;<a name='555'>
               grid%track_old_lon(i),grid%track_old_lat(i), &amp;<a name='556'>
               ids,ide, jds,jde, kds,kde, &amp;<a name='557'>
               ims,ime, jms,jme, kms,kme, &amp;<a name='558'>
               ips,ipe, jps,jpe, kps,kpe)<a name='559'>
          if(ierr==0) then<a name='560'>
             <font color=#447700>!print *,'insert: i=',iold,' j=',jold,' lon=',grid%track_old_lon(i),' lat=',grid%track_old_lat(i),' t=',grid%track_old_ntsd(i)<a name='561'></font>
             call <A href='../../html_code/dyn_nmm/module_tracker.F.html#TO_ROT45_GRID'>to_rot45_grid</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TO_ROT45_GRID_2">(iold,jold,jde,xrot,yrot)<a name='562'>
             n=n+1<a name='563'>
             xsum=xsum+xrot<a name='564'>
             ysum=ysum+yrot<a name='565'>
             told=grid%track_old_ntsd(i)<a name='566'>
             tsum=tsum+told<a name='567'>
             xtsum=xtsum+xrot*told<a name='568'>
             xxsum=xxsum+xrot*xrot<a name='569'>
             ytsum=ytsum+yrot*told<a name='570'>
             yysum=xxsum+yrot*yrot<a name='571'>
             ttsum=ttsum+told*told<a name='572'>
          endif<a name='573'>
       enddo<a name='574'>
       <font color=#447700>!print *,'line guess: n=',n<a name='575'></font>
<a name='576'>
       if(n&gt;1) then<a name='577'>
          ntsd_plus_1 = grid%ntsd + grid%ntrack*grid%nphs<a name='578'>
          mx=(xtsum-(xsum*tsum)/real(n))/(ttsum-(tsum*tsum)/real(n))<a name='579'>
          my=(ytsum-(ysum*tsum)/real(n))/(ttsum-(tsum*tsum)/real(n))<a name='580'>
          bx=(xsum-mx*tsum)/real(n)<a name='581'>
          by=(ysum-my*tsum)/real(n)<a name='582'>
          <font color=#447700>!print *,'mx=',mx,' my=',my,' bx=',bx,' by=',by,' t+1=',ntsd_plus_1<a name='583'></font>
          xrot=nint(mx*ntsd_plus_1+bx)<a name='584'>
          yrot=nint(my*ntsd_plus_1+by)<a name='585'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#FROM_ROT45_GRID'>from_rot45_grid</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FROM_ROT45_GRID_1">(inew,jnew,jde,xrot,yrot)<a name='586'>
          <font color=#447700>!print *,'inew=',inew,' jnew=',jnew,' xrot=',xrot,' yrot=',yrot<a name='587'></font>
          have_line_guess=.not.(inew&lt;ide/4 .or. inew&gt;ide*3/4 &amp;<a name='588'>
               .or. jnew&lt;jde/4 .or. jnew&gt;jde*3/4)<a name='589'>
       else<a name='590'>
          have_line_guess=.false.<a name='591'>
       endif<a name='592'>
    endif<a name='593'>
<a name='594'>
    print_locs: if(wrf_at_debug_level(2)) then<a name='595'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_2">(grid,iguess,jguess,longuess,latguess,ierr, &amp;<a name='596'>
            ids,ide, jds,jde, kds,kde, &amp;<a name='597'>
            ims,ime, jms,jme, kms,kme, &amp;<a name='598'>
            ips,ipe, jps,jpe, kps,kpe)<a name='599'>
       if(ierr==0) then<a name='600'>
          if(have_motion_guess) then<a name='601'>
3088         format('Motion Guess: lon=',F0.3,' lat=',F0.3)<a name='602'>
             write(message,3088) longuess,latguess<a name='603'>
             call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_99">(2,message)<a name='604'>
          else<a name='605'>
3089         format('Motion Guess failed; use domain center: lon=',F0.3,' lat=',F0.3)<a name='606'>
             write(message,3089) longuess,latguess<a name='607'>
             call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_100">(2,message)<a name='608'>
          endif<a name='609'>
       else<a name='610'>
3090      format('Motion guess ierr=',I0)<a name='611'>
          write(message,3090) ierr<a name='612'>
          call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_101">(2,message)<a name='613'>
       endif<a name='614'>
       if(have_line_guess) then<a name='615'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_3">(grid,inew,jnew,longuess,latguess,ierr, &amp;<a name='616'>
               ids,ide, jds,jde, kds,kde, &amp;<a name='617'>
               ims,ime, jms,jme, kms,kme, &amp;<a name='618'>
               ips,ipe, jps,jpe, kps,kpe)<a name='619'>
          if(ierr==0) then<a name='620'>
3091         format('Line guess: lon=',F0.3,' lat=',F0.3)<a name='621'>
             write(message,3091) longuess,latguess<a name='622'>
             call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_102">(2,message)<a name='623'>
          else<a name='624'>
3092         format('Line guess ierr=',I0)<a name='625'>
             write(message,3092) ierr<a name='626'>
             call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_103">(2,message)<a name='627'>
          endif<a name='628'>
       endif<a name='629'>
    endif print_locs<a name='630'>
<a name='631'>
    if(have_line_guess) then<a name='632'>
       if(have_motion_guess) then<a name='633'>
          call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_104">(1,'get_first_ges: have MOTION and LINE guesses')<a name='634'>
          iguess=(iguess+inew)/2<a name='635'>
          jguess=(jguess+jnew)/2<a name='636'>
       else<a name='637'>
          call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_105">(1,'get_first_ges: have LINE guess only')<a name='638'>
          iguess=inew<a name='639'>
          jguess=jnew<a name='640'>
       endif<a name='641'>
    elseif(have_motion_guess) then<a name='642'>
       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_106">(1,'get_first_ges: have MOTION guess only')<a name='643'>
    else<a name='644'>
       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_107">(1,'get_first_ges: have no guesses; will use domain center')<a name='645'>
    endif<a name='646'>
<a name='647'>
    <font color=#447700>! Now get lats &amp; lons:<a name='648'></font>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_4">(grid,iguess,jguess,longuess,latguess,ierr, &amp;<a name='649'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='650'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='651'>
         ips,ipe, jps,jpe, kps,kpe)<a name='652'>
    if(ierr/=0) then<a name='653'>
       <font color=#447700>! Should never get here due to max/min check before.<a name='654'></font>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_108">("ERROR: domain is not inside the domain in get_first_ges (<font color=#447700>!?)")<a name='655'></font>
    endif<a name='656'>
<a name='657'>
38  format('First guess: i=',I0,' j=',I0,' lat=',F8.3,' lon=',F8.3)<a name='658'>
    write(message,38) iguess,jguess,latguess,longuess<a name='659'>
    call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_FIRST_GES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_143">(message)<a name='660'>
  end subroutine get_first_ges<a name='661'>
<a name='662'>
<A NAME='STORE_OLD_FIXES'><A href='../../html_code/dyn_nmm/module_tracker.F.html#STORE_OLD_FIXES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='663'>
  <font color=#993300>subroutine </font><font color=#cc0000>store_old_fixes</font>(grid,  &amp;,<A href='../../call_from/STORE_OLD_FIXES.html' TARGET='index'>1</A><a name='664'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='665'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='666'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='667'>
    <font color=#447700>! This stores old fix locations for later use in the get_first_ges<a name='668'></font>
    <font color=#447700>! routine's line of best fit.<a name='669'></font>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#STORE_OLD_FIXES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_65">, ONLY : domain,get_ijk_from_grid<a name='670'>
    implicit none<a name='671'>
    type(domain), intent(inout) :: grid<a name='672'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='673'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='674'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='675'>
    integer i<a name='676'>
    if(grid%tracker_havefix) then<a name='677'>
       <font color=#447700>!print *,'in store old, have fix'<a name='678'></font>
       if(grid%track_n_old&gt;0) then<a name='679'>
          <font color=#447700>!print *,'in store old, shifting old'<a name='680'></font>
          do i=1,grid%num_old_fixes-1<a name='681'>
             grid%track_old_lon(i+1)=grid%track_old_lon(i)<a name='682'>
             grid%track_old_lat(i+1)=grid%track_old_lat(i)<a name='683'>
             grid%track_old_ntsd(i+1)=grid%track_old_ntsd(i)<a name='684'>
          enddo<a name='685'>
       endif<a name='686'>
       grid%track_old_lon(1)=grid%tracker_fixlon<a name='687'>
       grid%track_old_lat(1)=grid%tracker_fixlat<a name='688'>
       grid%track_old_ntsd(1)=grid%ntsd<a name='689'>
       grid%track_n_old=min(grid%num_old_fixes,grid%track_n_old+1)<a name='690'>
       <font color=#447700>!print *,'in store old, now have ',grid%track_n_old<a name='691'></font>
    endif<a name='692'>
  end subroutine store_old_fixes<a name='693'>
<a name='694'>
<A NAME='TO_ROT45_GRID'><A href='../../html_code/dyn_nmm/module_tracker.F.html#TO_ROT45_GRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='695'>
  <font color=#993300>subroutine </font><font color=#cc0000>to_rot45_grid</font>(i,j,jde,x,y) <A href='../../call_to/TO_ROT45_GRID.html' TARGET='index'>2</A><a name='696'>
    implicit none<a name='697'>
    integer, intent(in) :: i,j,jde<a name='698'>
    real, intent(inout) :: x,y<a name='699'>
    real :: a,b<a name='700'>
    a=i*2<a name='701'>
    b=j<a name='702'>
    if(mod(j,2)==0) a=a+1<a name='703'>
    x=(a+b)/2<a name='704'>
    y=(b-a)/2+((jde-1)/2)<a name='705'>
  end subroutine to_rot45_grid<a name='706'>
<a name='707'>
<A NAME='FROM_ROT45_GRID'><A href='../../html_code/dyn_nmm/module_tracker.F.html#FROM_ROT45_GRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='708'>
  <font color=#993300>subroutine </font><font color=#cc0000>from_rot45_grid</font>(i,j,jde,x,y) <A href='../../call_to/FROM_ROT45_GRID.html' TARGET='index'>1</A><a name='709'>
    implicit none<a name='710'>
    integer, intent(inout) :: i,j<a name='711'>
    integer, intent(in) :: jde<a name='712'>
    real, intent(in) :: x,y<a name='713'>
    i=x-y+((jde-1)/2)<a name='714'>
    j=x+y-((jde-1)/2)<a name='715'>
    if(mod(j,2)==0) then<a name='716'>
       i=(i-1)/2<a name='717'>
    else<a name='718'>
       i=i/2<a name='719'>
    endif<a name='720'>
  end subroutine from_rot45_grid<a name='721'>
<a name='722'>
<A NAME='GET_NEAREST_LONLAT'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='723'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_nearest_lonlat</font>(grid,iloc,jloc,ierr,lon,lat, &amp; <A href='../../call_to/GET_NEAREST_LONLAT.html' TARGET='index'>3</A>,<A href='../../call_from/GET_NEAREST_LONLAT.html' TARGET='index'>3</A><a name='724'>
               ids,ide, jds,jde, kds,kde, &amp;<a name='725'>
               ims,ime, jms,jme, kms,kme, &amp;<a name='726'>
               ips,ipe, jps,jpe, kps,kpe, &amp;<a name='727'>
               lonnear, latnear)<a name='728'>
    <font color=#447700>! Finds the nearest point in the domain to the specified lon,lat<a name='729'></font>
    <font color=#447700>! location.<a name='730'></font>
#ifdef DM_PARALLEL<a name='731'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_48">, only: wrf_dm_minloc_real<a name='732'>
#endif<a name='733'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_66">, ONLY : domain,get_ijk_from_grid<a name='734'>
    implicit none<a name='735'>
    type(domain), intent(inout) :: grid<a name='736'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='737'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='738'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='739'>
    integer, intent(out) :: iloc,jloc,ierr<a name='740'>
    real, intent(in) :: lon,lat<a name='741'>
    real :: dx,dy,d,dmin, zdummy, latmin,lonmin<a name='742'>
    integer :: i,j,imin,jmin<a name='743'>
    real, intent(out), optional :: latnear, lonnear<a name='744'>
<a name='745'>
    zdummy=42<a name='746'>
    dmin=9e9<a name='747'>
    imin=-99<a name='748'>
    jmin=-99<a name='749'>
    latmin=9e9<a name='750'>
    lonmin=9e9<a name='751'>
    ierr=0<a name='752'>
    do j=jps,min(jde-1,jpe)<a name='753'>
       do i=ips,min(ide-1,ipe)<a name='754'>
          dy=abs(lat-grid%hlat(i,j))<a name='755'>
          dx=abs(mod(3600.+180.+(lon-grid%hlon(i,j)),360.)-180.)<a name='756'>
          d=dx*dx+dy*dy<a name='757'>
          if(d&lt;dmin) then<a name='758'>
             dmin=d<a name='759'>
             imin=i<a name='760'>
             jmin=j<a name='761'>
             latmin=grid%hlat(i,j)<a name='762'>
             lonmin=grid%hlon(i,j)<a name='763'>
          endif<a name='764'>
       enddo<a name='765'>
    enddo<a name='766'>
<a name='767'>
#ifdef DM_PARALLEL<a name='768'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINLOC_REAL'>wrf_dm_minloc_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINLOC_REAL_1">(dmin,latmin,lonmin,zdummy,imin,jmin)<a name='769'>
#endif<a name='770'>
    if(imin&lt;0 .or. jmin&lt;0) then<a name='771'>
       ierr=-99<a name='772'>
    else<a name='773'>
       iloc=imin ; jloc=jmin<a name='774'>
    endif<a name='775'>
    if(present(latnear)) latnear=latmin<a name='776'>
    if(present(lonnear)) lonnear=lonmin<a name='777'>
  end subroutine get_nearest_lonlat<a name='778'>
<a name='779'>
<A NAME='OUTPUT_PARTIAL_ATCFUNIX'><A href='../../html_code/dyn_nmm/module_tracker.F.html#OUTPUT_PARTIAL_ATCFUNIX' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='780'>
  <font color=#993300>subroutine </font><font color=#cc0000>output_partial_atcfunix</font>(grid, &amp; <A href='../../call_to/OUTPUT_PARTIAL_ATCFUNIX.html' TARGET='index'>1</A>,<A href='../../call_from/OUTPUT_PARTIAL_ATCFUNIX.html' TARGET='index'>1</A><a name='781'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='782'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='783'>
         ITS,ITE,JTS,JTE,KTS,KTE)<a name='784'>
    <font color=#447700>! This outputs to a format that can be easily converted to ATCF,<a name='785'></font>
    <font color=#447700>! using units used by ATCF.<a name='786'></font>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#OUTPUT_PARTIAL_ATCFUNIX' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_67">, ONLY : domain,get_ijk_from_grid<a name='787'>
    implicit none<a name='788'>
    type(domain), intent(inout) :: grid<a name='789'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='790'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='791'>
    integer, intent(in) :: ITS,ITE,JTS,JTE,KTS,KTE<a name='792'>
    character*255 message<a name='793'>
313 format(F11.2,", ",                                  &amp;<a name='794'>
           "W10 = ",F7.3," kn, PMIN = ",F8.3," mbar, ", &amp;<a name='795'>
           "LAT = ",F6.3,A1,", LON = ",F7.3,A1,", ",    &amp;<a name='796'>
           "RMW = ",F7.3," nmi")<a name='797'>
    write(grid%outatcf_lun,313) grid%dt*grid%ntsd,                 &amp;<a name='798'>
         grid%tracker_vmax*mps2kn,grid%tracker_pmin/100.,          &amp;<a name='799'>
         abs(grid%tracker_fixlat),get_lat_ns(grid%tracker_fixlat), &amp;<a name='800'>
         abs(grid%tracker_fixlon),get_lon_ew(grid%tracker_fixlon), &amp;<a name='801'>
         grid%tracker_rmw*km2nmi<a name='802'>
    <font color=#447700>! write(message,313) grid%dt*grid%ntsd,                 &amp;<a name='803'></font>
    <font color=#447700>!      grid%tracker_vmax*mps2kn,grid%tracker_pmin/100.,          &amp;<a name='804'></font>
    <font color=#447700>!      abs(grid%tracker_fixlat),get_lat_ns(grid%tracker_fixlat), &amp;<a name='805'></font>
    <font color=#447700>!      abs(grid%tracker_fixlon),get_lon_ew(grid%tracker_fixlon), &amp;<a name='806'></font>
    <font color=#447700>!      grid%tracker_rmw*km2nmi<a name='807'></font>
    <font color=#447700>! call wrf_message(message)<a name='808'></font>
  end subroutine output_partial_atcfunix<a name='809'>
<a name='810'>
<A NAME='GET_WIND_PRES_INTENSITY'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='811'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_wind_pres_intensity</font>(grid, &amp; <A href='../../call_to/GET_WIND_PRES_INTENSITY.html' TARGET='index'>1</A>,<A href='../../call_from/GET_WIND_PRES_INTENSITY.html' TARGET='index'>9</A><a name='812'>
       min_mslp,max_wind,rmw, &amp;<a name='813'>
       max_wind_search_radius, min_mlsp_search_radius, clon,clat, &amp;<a name='814'>
       IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='815'>
       IMS,IME,JMS,JME,KMS,KME, &amp;<a name='816'>
       ITS,ITE,JTS,JTE,KTS,KTE)<a name='817'>
    <font color=#447700>! This determines the maximum wind, RMW and minimum mslp in the domain.<a name='818'></font>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_68">, ONLY : domain,get_ijk_from_grid<a name='819'>
#ifdef DM_PARALLEL<a name='820'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_49">, only: wrf_dm_maxval_real,wrf_dm_minval_real<a name='821'>
#endif<a name='822'>
    implicit none<a name='823'>
    type(domain), intent(inout) :: grid<a name='824'>
    real, intent(out) :: min_mslp,max_wind,rmw<a name='825'>
    real, intent(in) :: max_wind_search_radius, min_mlsp_search_radius,clon,clat<a name='826'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='827'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='828'>
    integer, intent(in) :: ITS,ITE,JTS,JTE,KTS,KTE<a name='829'>
<a name='830'>
    real :: localextreme,globalextreme, sdistsq,windsq<a name='831'>
    real :: globallat,globallon,degrees<a name='832'>
    integer :: locali,localj,globali,globalj,ierr,i,j<a name='833'>
<a name='834'>
    <font color=#447700>! Get the MSLP minimum location and determine if what we found is<a name='835'></font>
    <font color=#447700>! still a storm:<a name='836'></font>
    localextreme=9e9<a name='837'>
    locali=-1<a name='838'>
    localj=-1<a name='839'>
    sdistsq=min_mlsp_search_radius*min_mlsp_search_radius*1e6<a name='840'>
    do j=jts,min(jte,jde-1)<a name='841'>
       do i=its,min(ite,ide-1)<a name='842'>
          if(grid%membrane_mslp(i,j)&lt;localextreme .and. &amp;<a name='843'>
               grid%tracker_distsq(i,j)&lt;sdistsq) then<a name='844'>
             localextreme=grid%membrane_mslp(i,j)<a name='845'>
             locali=i<a name='846'>
             localj=j<a name='847'>
          endif<a name='848'>
       enddo<a name='849'>
    enddo<a name='850'>
<a name='851'>
    globalextreme=localextreme<a name='852'>
    globali=locali<a name='853'>
    globalj=localj<a name='854'>
#ifdef DM_PARALLEL<a name='855'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_5">(globalextreme,globali,globalj)<a name='856'>
#endif<a name='857'>
    min_mslp=globalextreme<a name='858'>
    if(globali&lt;0 .or. globalj&lt;0) then<a name='859'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_144">("WARNING: No membrane mslp values found that were less than 9*10^9.")<a name='860'>
       min_mslp=-999<a name='861'>
    endif<a name='862'>
<a name='863'>
    <font color=#447700>! Get the wind maximum location.  Note that we're using the square<a name='864'></font>
    <font color=#447700>! of the wind until after the loop to avoid the sqrt() call.<a name='865'></font>
    localextreme=-9e9<a name='866'>
    locali=-1<a name='867'>
    localj=-1<a name='868'>
    sdistsq=max_wind_search_radius*max_wind_search_radius*1e6<a name='869'>
    do j=jts,min(jte,jde-1)<a name='870'>
       do i=its,min(ite,ide-1)<a name='871'>
          if(grid%tracker_distsq(i,j)&lt;sdistsq) then<a name='872'>
             windsq=grid%u10(i,j)*grid%u10(i,j) + &amp;<a name='873'>
                    grid%v10(i,j)*grid%v10(i,j)<a name='874'>
             if(windsq&gt;localextreme) then<a name='875'>
                localextreme=windsq<a name='876'>
                locali=i<a name='877'>
                localj=j<a name='878'>
             endif<a name='879'>
          endif<a name='880'>
       enddo<a name='881'>
    enddo<a name='882'>
    if(localextreme&gt;0) localextreme=sqrt(localextreme)<a name='883'>
<a name='884'>
    globalextreme=localextreme<a name='885'>
    globali=locali<a name='886'>
    globalj=localj<a name='887'>
#ifdef DM_PARALLEL<a name='888'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_6">(globalextreme,globali,globalj)<a name='889'>
#endif<a name='890'>
<a name='891'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_5">(grid,globali,globalj,globallon,globallat,ierr, &amp;<a name='892'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='893'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='894'>
         its,ite, jts,jte, kts,kte)<a name='895'>
    if(ierr/=0) then<a name='896'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_145">("WARNING: Unable to find location of wind maximum.")<a name='897'>
       rmw=-99<a name='898'>
    else<a name='899'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_2">(clon,clat,globallon,globallat,rmw,degrees)<a name='900'>
    end if<a name='901'>
<a name='902'>
    <font color=#447700>! Get the guess location for the next time:<a name='903'></font>
    max_wind=globalextreme<a name='904'>
    if(globali&lt;0 .or. globalj&lt;0) then<a name='905'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_WIND_PRES_INTENSITY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_146">("WARNING: No wind values found that were greater than -9*10^9.")<a name='906'>
       min_mslp=-999<a name='907'>
    endif<a name='908'>
<a name='909'>
  end subroutine get_wind_pres_intensity<a name='910'>
<a name='911'>
<A NAME='MEAN_MOTION'><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='912'>
  <font color=#993300>subroutine </font><font color=#cc0000>mean_motion</font>(grid,motion_grideast,motion_gridnorth, &amp; <A href='../../call_to/MEAN_MOTION.html' TARGET='index'>1</A>,<A href='../../call_from/MEAN_MOTION.html' TARGET='index'>6</A><a name='913'>
       ids,ide, jds,jde, kds,kde, &amp;<a name='914'>
       ims,ime, jms,jme, kms,kme, &amp;<a name='915'>
       its,ite, jts,jte, kts,kte)<a name='916'>
    <font color=#447700>! This calculates the mean motion of the storm by calculating the<a name='917'></font>
    <font color=#447700>! average wind vector at 850, 700 and 500 mbars.<a name='918'></font>
<a name='919'>
#ifdef DM_PARALLEL<a name='920'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_50">, only: wrf_dm_sum_real8, wrf_dm_sum_integer<a name='921'>
#endif<a name='922'>
    use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_12"><a name='923'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_69">, ONLY : domain, domain_clock_get<a name='924'>
    implicit none<a name='925'>
    integer, intent(in) :: &amp;<a name='926'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='927'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='928'>
         its,ite, jts,jte, kts,kte<a name='929'>
    type(domain), intent(in) :: grid<a name='930'>
    real, intent(out) :: motion_grideast,motion_gridnorth<a name='931'>
    integer :: count,i,j,ierr<a name='932'>
    real :: distsq, dist<a name='933'>
    real*8 :: e,n<a name='934'>
<a name='935'>
    e=0 ; n=0 ; count=0 <font color=#447700>! east sum, north sum, count<a name='936'></font>
<a name='937'>
    dist = min(grid%tracker_edge_dist, max(50e3, 3e3*grid%tracker_rmw))<a name='938'>
    distsq = dist * dist<a name='939'>
<a name='940'>
    <font color=#447700>! print *,'motion search radius (m) = ',dist<a name='941'></font>
    <font color=#447700>! print *,'  considered edge dist = ',grid%tracker_edge_dist<a name='942'></font>
    <font color=#447700>! print *,'  considered 3e3*rmw = ',3e3*grid%tracker_rmw<a name='943'></font>
    <font color=#447700>! print *,'  considered 50e3.'<a name='944'></font>
<a name='945'>
    do j=jts,min(jte,jde-1)<a name='946'>
       do i=its,min(ite,ide-1)<a name='947'>
          if(grid%tracker_distsq(i,j)&lt;distsq) then<a name='948'>
             count = count + 3<a name='949'>
             e = e + (grid%p500u(i,j) + grid%p700u(i,j) + grid%p850u(i,j))<a name='950'>
             n = n + (grid%p500v(i,j) + grid%p700v(i,j) + grid%p850v(i,j))<a name='951'>
          endif<a name='952'>
       enddo<a name='953'>
    enddo<a name='954'>
<a name='955'>
#ifdef DM_PARALLEL<a name='956'>
    e=<A href='../../html_code/frame/module_dm.F.html#WRF_DM_SUM_REAL8'>wrf_dm_sum_real8</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SUM_REAL8_1">(e)<a name='957'>
    n=<A href='../../html_code/frame/module_dm.F.html#WRF_DM_SUM_REAL8'>wrf_dm_sum_real8</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SUM_REAL8_2">(n)<a name='958'>
    count=<A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_SUM_INTEGER'>wrf_dm_sum_integer</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#MEAN_MOTION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_SUM_INTEGER_3">(count)<a name='959'>
#endif<a name='960'>
<a name='961'>
    motion_grideast=e/count<a name='962'>
    motion_gridnorth=n/count<a name='963'>
<a name='964'>
    <font color=#447700>! print *,'e=',e,' n=',n,' count=',count<a name='965'></font>
    <font color=#447700>! print *,'motion: east=',motion_grideast,' north=',motion_gridnorth<a name='966'></font>
  end subroutine mean_motion<a name='967'>
<a name='968'>
<A NAME='FIXCENTER'><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='969'>
  <font color=#993300>subroutine </font><font color=#cc0000>fixcenter</font>(grid,icen,jcen,calcparm,loncen,latcen, &amp; <A href='../../call_to/FIXCENTER.html' TARGET='index'>1</A>,<A href='../../call_from/FIXCENTER.html' TARGET='index'>18</A><a name='970'>
       iguess,jguess,longuess,latguess, &amp;<a name='971'>
       ifinal,jfinal,lonfinal,latfinal, &amp;<a name='972'>
       north_hemi, &amp;<a name='973'>
       ids,ide, jds,jde, kds,kde, &amp;<a name='974'>
       ims,ime, jms,jme, kms,kme, &amp;<a name='975'>
       ips,ipe, jps,jpe, kps,kpe)<a name='976'>
    <font color=#447700>! This is the same as "fixcenter" in gettrk_main.  Original comment:<a name='977'></font>
    <font color=#447700>!<a name='978'></font>
    <font color=#447700>! ABSTRACT: This subroutine loops through the different parameters<a name='979'></font>
    <font color=#447700>!           for the input storm number (ist) and calculates the <a name='980'></font>
    <font color=#447700>!           center position of the storm by taking an average of<a name='981'></font>
    <font color=#447700>!           the center positions obtained for those parameters.<a name='982'></font>
    <font color=#447700>!           First we check to see which parameters are within a <a name='983'></font>
    <font color=#447700>!           max error range (errmax), and we discard those that are<a name='984'></font>
    <font color=#447700>!           not within that range.  Of the remaining parms, we get <a name='985'></font>
    <font color=#447700>!           a mean position, and then we re-calculate the position<a name='986'></font>
    <font color=#447700>!           by giving more weight to those estimates that are closer<a name='987'></font>
    <font color=#447700>!           to this mean first-guess position estimate.<a name='988'></font>
<a name='989'>
    <font color=#447700>! Arguments: Input:<a name='990'></font>
    <font color=#447700>! grid - the grid being processed<a name='991'></font>
    <font color=#447700>! icen,jcen - arrays of center gridpoint locations<a name='992'></font>
    <font color=#447700>! calcperm - array of center validity flags (true = center is valid)<a name='993'></font>
    <font color=#447700>! loncen,latcen - center geographic locations<a name='994'></font>
    <font color=#447700>! iguess,jguess - first guess gridpoint location<a name='995'></font>
    <font color=#447700>! longuess,latguess - first guess geographic location<a name='996'></font>
<a name='997'>
    <font color=#447700>! Arguments: Output:<a name='998'></font>
    <font color=#447700>! ifinal,jfinal - final center gridpoint location<a name='999'></font>
    <font color=#447700>! lonfinal,latfinal - final center geographic location<a name='1000'></font>
<a name='1001'>
    <font color=#447700>! Arguments: Optional input:<a name='1002'></font>
    <font color=#447700>! north_hemi - true = northern hemisphere, false=south<a name='1003'></font>
<a name='1004'>
    use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_13"><a name='1005'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_70">, ONLY : domain, domain_clock_get<a name='1006'>
    implicit none<a name='1007'>
    integer, intent(in) :: &amp;<a name='1008'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='1009'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='1010'>
         ips,ipe, jps,jpe, kps,kpe<a name='1011'>
    type(domain), intent(inout) :: grid<a name='1012'>
    integer, intent(in) :: icen(maxtp), jcen(maxtp)<a name='1013'>
    real, intent(in) :: loncen(maxtp), latcen(maxtp)<a name='1014'>
    logical, intent(inout) :: calcparm(maxtp)<a name='1015'>
<a name='1016'>
    integer, intent(in) :: iguess,jguess<a name='1017'>
    real, intent(in) :: latguess,longuess<a name='1018'>
<a name='1019'>
    integer, intent(inout) :: ifinal,jfinal<a name='1020'>
    real, intent(inout) :: lonfinal,latfinal<a name='1021'>
<a name='1022'>
    logical, intent(in), optional :: north_hemi<a name='1023'>
<a name='1024'>
    character*255 :: message<a name='1025'>
    real :: errdist(maxtp),avgerr,errmax,errinit,xavg_stderr<a name='1026'>
    real :: dist,degrees, total<a name='1027'>
    real :: minutes,hours,trkerr_avg, dist_from_mean(maxtp),wsum<a name='1028'>
    integer :: ip,itot4next,iclose,count,ifound,ierr<a name='1029'>
    integer(kind=8) :: isum,jsum<a name='1030'>
    real :: irsum,jrsum,errtmp,devia,wtpos<a name='1031'>
    real :: xmn_dist_from_mean, stderr_close<a name='1032'>
    logical use4next(maxtp)<a name='1033'>
<a name='1034'>
    <font color=#447700>! Determine forecast hour:<a name='1035'></font>
    call <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_8">(grid,minutesSinceSimulationStart=minutes)<a name='1036'>
    hours=minutes/60.<a name='1037'>
<a name='1038'>
    <font color=#447700>! Decide maximum values for distance and std. dev.:<a name='1039'></font>
    if(hours&lt;0.5) then<a name='1040'>
       errmax=err_reg_init<a name='1041'>
       errinit=err_reg_init<a name='1042'>
    else<a name='1043'>
       errmax=err_reg_max<a name='1044'>
       errinit=err_reg_max<a name='1045'>
    endif<a name='1046'>
<a name='1047'>
    if(hours&gt;4.) then<a name='1048'>
       xavg_stderr = ( grid%track_stderr_m1 + &amp;<a name='1049'>
            grid%track_stderr_m2 + grid%track_stderr_m3 ) / 3.0<a name='1050'>
    elseif(hours&gt;3.) then<a name='1051'>
       xavg_stderr = ( grid%track_stderr_m1 + grid%track_stderr_m2 ) / 2.0<a name='1052'>
    elseif(hours&gt;2.) then<a name='1053'>
       xavg_stderr = grid%track_stderr_m1<a name='1054'>
    endif<a name='1055'>
<a name='1056'>
    if(hours&gt;2.) then<a name='1057'>
       errtmp = 3.0*xavg_stderr*errpgro<a name='1058'>
       errmax = max(errtmp,errinit)<a name='1059'>
       errtmp = errpmax<a name='1060'>
       errmax = min(errmax,errtmp)<a name='1061'>
    endif<a name='1062'>
<a name='1063'>
    <font color=#447700>! Initialize loop variables:<a name='1064'></font>
    errdist=0.0<a name='1065'>
    use4next=.false.<a name='1066'>
    trkerr_avg=0<a name='1067'>
    itot4next=0<a name='1068'>
    iclose=0<a name='1069'>
    isum=0<a name='1070'>
    jsum=0<a name='1071'>
    ifound=0<a name='1072'>
<a name='1073'>
    <font color=#447700>!write(0,*) 'errpmax=',errpmax<a name='1074'></font>
    <font color=#447700>!write(0,*) 'errmax=',errmax<a name='1075'></font>
<a name='1076'>
500 format('Parm ip=',I0,' dist=',F0.3)<a name='1077'>
501 format('  too far, but discard')<a name='1078'>
    do ip=1,maxtp<a name='1079'>
       if(ip==4 .or. ip==6) then<a name='1080'>
          calcparm(ip)=.false.<a name='1081'>
          cycle<a name='1082'>
       elseif(calcparm(ip)) then<a name='1083'>
          ifound=ifound+1<a name='1084'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_3">(longuess,latguess,loncen(ip),latcen(ip),dist,degrees)<a name='1085'>
          errdist(ip)=dist<a name='1086'>
          <font color=#447700>!write(0,500) ip,dist<a name='1087'></font>
          if(dist&lt;=errpmax) then<a name='1088'>
             if(ip==3 .or. ip==5 .or. ip==10) then<a name='1089'>
                use4next(ip)=.false.<a name='1090'>
                <font color=#447700>!write(0,'(A)') '  within range but discard: errpmax'<a name='1091'></font>
             else<a name='1092'>
                <font color=#447700>!write(0,'(A)') '  within range and keep: errpmax'<a name='1093'></font>
                use4next(ip)=.true.<a name='1094'>
                trkerr_avg=trkerr_avg+dist<a name='1095'>
                itot4next=itot4next+1<a name='1096'>
             endif<a name='1097'>
          endif<a name='1098'>
          if(dist&lt;=errmax) then<a name='1099'>
502          format('  apply i=',I0,' j=',I0)<a name='1100'>
             <font color=#447700>!write(0,502) icen(ip),jcen(ip)<a name='1101'></font>
             iclose=iclose+1<a name='1102'>
             isum=isum+icen(ip)<a name='1103'>
             jsum=jsum+jcen(ip)<a name='1104'>
503          format(' added things isum=',I0,' jsum=',I0,' iclose=',I0)<a name='1105'>
             <font color=#447700>!write(0,503) isum,jsum,iclose<a name='1106'></font>
          else<a name='1107'>
             <font color=#447700>!write(0,*) '  discard; too far: errmax'<a name='1108'></font>
             calcparm(ip)=.false.<a name='1109'>
          endif<a name='1110'>
       endif<a name='1111'>
    enddo<a name='1112'>
<a name='1113'>
    if(ifound&lt;=0) then<a name='1114'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_147">('The tracker could not find the centers for any parameters.  Thus,')<a name='1115'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_148">('a center position could not be obtained for this storm.')<a name='1116'>
       goto 999<a name='1117'>
    endif<a name='1118'>
<a name='1119'>
    if(iclose&lt;=0) then<a name='1120'>
200    format('No storms are within errmax=',F0.1,'km of the parameters')<a name='1121'>
       <font color=#447700>!write(message,200) errmax<a name='1122'></font>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_149">(message)<a name='1123'>
       goto 999<a name='1124'>
    endif<a name='1125'>
<a name='1126'>
    ifinal=real(isum)/real(iclose)<a name='1127'>
    jfinal=real(jsum)/real(iclose)<a name='1128'>
<a name='1129'>
504 format(' calculated ifinal, jfinal: ifinal=',I0,' jfinal=',I0,' isum=',I0,' jsum=',I0,' iclose=',I0)<a name='1130'>
    <font color=#447700>!write(0,504) ifinal,jfinal,isum,jsum,iclose<a name='1131'></font>
<a name='1132'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_6">(grid,ifinal,jfinal,lonfinal,latfinal,ierr, &amp;<a name='1133'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='1134'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='1135'>
         ips,ipe, jps,jpe, kps,kpe)<a name='1136'>
    if(ierr/=0) then<a name='1137'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_150">('Gave up on finding the storm location due to error in get_lonlat (1).')<a name='1138'>
       goto 999<a name='1139'>
    endif<a name='1140'>
<a name='1141'>
    count=0<a name='1142'>
    dist_from_mean=0.0<a name='1143'>
    total=0.0<a name='1144'>
    do ip=1,maxtp<a name='1145'>
       if(calcparm(ip)) then<a name='1146'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_4">(lonfinal,latfinal,loncen(ip),latcen(ip),dist,degrees)<a name='1147'>
          dist_from_mean(ip)=dist<a name='1148'>
          total=total+dist<a name='1149'>
          count=count+1<a name='1150'>
       endif<a name='1151'>
    enddo<a name='1152'>
    xmn_dist_from_mean=total/real(count)<a name='1153'>
<a name='1154'>
    do ip=1,maxtp<a name='1155'>
       if(calcparm(ip)) then<a name='1156'>
          total=total+(xmn_dist_from_mean-dist_from_mean(ip))**2<a name='1157'>
       endif<a name='1158'>
    enddo<a name='1159'>
    if(count&lt;2) then<a name='1160'>
       stderr_close=0.0<a name='1161'>
    else<a name='1162'>
       stderr_close=max(1.0,sqrt(1./(count-1) * total))<a name='1163'>
    endif<a name='1164'>
<a name='1165'>
    if(calcparm(1) .or. calcparm(2) .or. calcparm(7) .or. &amp;<a name='1166'>
         calcparm(8) .or. calcparm(9) .or. calcparm(11)) then<a name='1167'>
       continue<a name='1168'>
    else<a name='1169'>
       <font color=#447700>! Message copied straight from tracker:<a name='1170'></font>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_151">('In fixcenter, STOPPING PROCESSING for this storm.  The reason is that')<a name='1171'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_152">('none of the fix locations for parms z850, z700, zeta 850, zeta 700')<a name='1172'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_153">('MSLP or sfc zeta were within a reasonable distance of the guess location.')<a name='1173'>
       goto 999<a name='1174'>
    endif<a name='1175'>
<a name='1176'>
    <font color=#447700>! Recalculate the final center location using weights<a name='1177'></font>
    if(stderr_close&lt;5.0) then<a name='1178'>
       <font color=#447700>! Old code forced a minimum of 5.0 stddev<a name='1179'></font>
       stderr_close=5.0<a name='1180'>
    endif<a name='1181'>
    irsum=0<a name='1182'>
    jrsum=0<a name='1183'>
    wsum=0<a name='1184'>
    do ip=1,maxtp<a name='1185'>
       if(calcparm(ip)) then<a name='1186'>
          devia=max(1.0,dist_from_mean(ip)/stderr_close)<a name='1187'>
          wtpos=exp(-devia/3.)<a name='1188'>
          irsum=icen(ip)*wtpos+irsum<a name='1189'>
          jrsum=jcen(ip)*wtpos+jrsum<a name='1190'>
          wsum=wtpos+wsum<a name='1191'>
1100      format(' Adding parm: devia=',F0.3,' wtpos=',F0.3,' irsum=',F0.3,' jrsum=',F0.3,' wsum=',F0.3)<a name='1192'>
          <font color=#447700>!write(0,1100) devia,wtpos,irsum,jrsum,wsum<a name='1193'></font>
       endif<a name='1194'>
    enddo<a name='1195'>
    ifinal=nint(real(irsum)/real(wsum))<a name='1196'>
    jfinal=nint(real(jrsum)/real(wsum))<a name='1197'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_7">(grid,ifinal,jfinal,lonfinal,latfinal,ierr, &amp;<a name='1198'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='1199'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='1200'>
         ips,ipe, jps,jpe, kps,kpe)<a name='1201'>
    if(ierr/=0) then<a name='1202'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_154">('Gave up on finding the storm location due to error in get_lonlat (2).')<a name='1203'>
       goto 999<a name='1204'>
    endif<a name='1205'>
<a name='1206'>
    <font color=#447700>! Store the lat/lon location:<a name='1207'></font>
    grid%tracker_fixlon=lonfinal<a name='1208'>
    grid%tracker_fixlat=latfinal<a name='1209'>
    grid%tracker_ifix=ifinal<a name='1210'>
    grid%tracker_jfix=jfinal<a name='1211'>
    grid%tracker_havefix=.true.<a name='1212'>
<a name='1213'>
1000 format('Stored lat/lon at i=',I0,' j=',I0,' lon=',F0.3,' lat=',F0.3)<a name='1214'>
    <font color=#447700>!write(0,1000) ifinal,jfinal,lonfinal,latfinal<a name='1215'></font>
    <a name='1216'>
<a name='1217'>
    if(nint(hours) &gt; grid%track_last_hour ) then<a name='1218'>
       <font color=#447700>! It is time to recalculate the std. dev. of the track:<a name='1219'></font>
       count=0<a name='1220'>
       dist_from_mean=0.0<a name='1221'>
       total=0.0<a name='1222'>
       do ip=1,maxtp<a name='1223'>
          if(calcparm(ip)) then<a name='1224'>
             call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_5">(lonfinal,latfinal,loncen(ip),loncen(ip),dist,degrees)<a name='1225'>
             dist_from_mean(ip)=dist<a name='1226'>
             total=total+dist<a name='1227'>
             count=count+1<a name='1228'>
          endif<a name='1229'>
       enddo<a name='1230'>
       xmn_dist_from_mean=total/real(count)<a name='1231'>
<a name='1232'>
       do ip=1,maxtp<a name='1233'>
          if(calcparm(ip)) then<a name='1234'>
             total=total+(xmn_dist_from_mean-dist_from_mean(ip))**2<a name='1235'>
          endif<a name='1236'>
       enddo<a name='1237'>
       if(count&lt;2) then<a name='1238'>
          stderr_close=0.0<a name='1239'>
       else<a name='1240'>
          stderr_close=max(1.0,sqrt(1./(count-1) * total))<a name='1241'>
       endif<a name='1242'>
<a name='1243'>
       grid%track_stderr_m3=grid%track_stderr_m2<a name='1244'>
       grid%track_stderr_m2=grid%track_stderr_m1<a name='1245'>
       grid%track_stderr_m1=stderr_close<a name='1246'>
       grid%track_last_hour=nint(hours)<a name='1247'>
    endif<a name='1248'>
<a name='1249'>
    <font color=#447700>!write(0,*) 'got to return'<a name='1250'></font>
    return<a name='1251'>
<a name='1252'>
    <font color=#447700>! We jump here if we're giving up on finding the center<a name='1253'></font>
999 continue<a name='1254'>
    <font color=#447700>! Use domain center as storm location<a name='1255'></font>
    grid%tracker_ifix=ide/2<a name='1256'>
    grid%tracker_jfix=jde/2<a name='1257'>
    grid%tracker_havefix=.false.<a name='1258'>
    grid%tracker_gave_up=.true.<a name='1259'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_8">(grid,ifinal,jfinal,lonfinal,latfinal,ierr, &amp;<a name='1260'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='1261'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='1262'>
         ips,ipe, jps,jpe, kps,kpe)<a name='1263'>
    if(ierr/=0) then<a name='1264'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIXCENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_109">('Center of domain is not in domain (<font color=#447700>!?)')<a name='1265'></font>
       goto 999<a name='1266'>
    endif<a name='1267'>
<a name='1268'>
    grid%tracker_fixlon=-999.0<a name='1269'>
    grid%tracker_fixlat=-999.0<a name='1270'>
    <a name='1271'>
  end subroutine fixcenter<a name='1272'>
<a name='1273'>
<A NAME='GET_UV_GUESS'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_GUESS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1274'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_uv_guess</font>(grid,icen,jcen,loncen,latcen,calcparm, &amp; <A href='../../call_to/GET_UV_GUESS.html' TARGET='index'>1</A>,<A href='../../call_from/GET_UV_GUESS.html' TARGET='index'>3</A><a name='1275'>
       iguess,jguess,longuess,latguess,iout,jout, &amp;<a name='1276'>
       IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1277'>
       IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1278'>
       ITS,ITE,JTS,JTE,KTS,KTE)<a name='1279'>
    <font color=#447700>! This is a rewrite of the gettrk_main.f get_uv_guess.  Original comment:<a name='1280'></font>
    <font color=#447700>! ABSTRACT: The purpose of this subroutine is to get a modified <a name='1281'></font>
    <font color=#447700>!           first guess lat/lon position before searching for the <a name='1282'></font>
    <font color=#447700>!           minimum in the wind field.  The reason for doing this is<a name='1283'></font>
    <font color=#447700>!           to better refine the guess and avoid picking up a wind<a name='1284'></font>
    <font color=#447700>!           wind minimum far away from the center.  So, use the <a name='1285'></font>
    <font color=#447700>!           first guess position (and give it strong weighting), and<a name='1286'></font>
    <font color=#447700>!           then also use the  fix positions for the current time<a name='1287'></font>
    <font color=#447700>!           (give the vorticity centers stronger weighting as well),<a name='1288'></font>
    <font color=#447700>!           and then take the average of these positions.<a name='1289'></font>
<a name='1290'>
    <font color=#447700>! Arguments: Input:<a name='1291'></font>
    <font color=#447700>!  grid - grid being searched<a name='1292'></font>
    <font color=#447700>!  icen,jcen - tracker parameter center gridpoints<a name='1293'></font>
    <font color=#447700>!  loncen,latcen - tracker parameter centers' geographic locations<a name='1294'></font>
    <font color=#447700>!  calcparm - is each center valid?<a name='1295'></font>
    <font color=#447700>!  iguess, jguess - first guess gridpoint location<a name='1296'></font>
    <font color=#447700>!  longuess,latguess - first guess geographic location<a name='1297'></font>
<a name='1298'>
    <font color=#447700>! Arguments: Output:<a name='1299'></font>
    <font color=#447700>!  iout,jout - uv guess center location<a name='1300'></font>
<a name='1301'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_GUESS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_71">, ONLY : domain,get_ijk_from_grid<a name='1302'>
#ifdef DM_PARALLEL<a name='1303'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_GUESS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_51">, only: wrf_dm_sum_real<a name='1304'>
#endif<a name='1305'>
    implicit none<a name='1306'>
    type(domain), intent(inout) :: grid<a name='1307'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='1308'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='1309'>
    integer, intent(in) :: ITS,ITE,JTS,JTE,KTS,KTE<a name='1310'>
<a name='1311'>
    integer, intent(in) :: icen(maxtp), jcen(maxtp)<a name='1312'>
    real, intent(in) :: loncen(maxtp), latcen(maxtp)<a name='1313'>
    logical, intent(in) :: calcparm(maxtp)<a name='1314'>
<a name='1315'>
    integer, intent(in) :: iguess,jguess<a name='1316'>
    real, intent(in) :: latguess,longuess<a name='1317'>
<a name='1318'>
    integer, intent(inout) :: iout,jout<a name='1319'>
    real :: degrees,dist<a name='1320'>
    integer :: ip,ict<a name='1321'>
    integer(kind=8) :: isum,jsum<a name='1322'>
<a name='1323'>
    ict=2<a name='1324'>
    isum=2*iguess<a name='1325'>
    jsum=2*jguess<a name='1326'>
<a name='1327'>
    <font color=#447700>! Get a guess storm center location for searching for the wind centers:<a name='1328'></font>
    do ip=1,maxtp<a name='1329'>
       if ((ip &gt; 2 .and. ip &lt; 7) .or. ip == 10) then<a name='1330'>
          cycle   <font color=#447700>! because 3-6 are for 850 &amp; 700 u &amp; v and 10 is <a name='1331'></font>
          <font color=#447700>! for surface wind magnitude.<a name='1332'></font>
       elseif(calcparm(ip)) then<a name='1333'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST'>calcdist</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_GUESS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CALCDIST_6"> (longuess,latguess,loncen(ip),latcen(ip),dist,degrees)<a name='1334'>
          if(dist&lt;uverrmax) then<a name='1335'>
             if(ip==1 .or. ip==2 .or. ip==11) then<a name='1336'>
                isum=isum+2*icen(ip)<a name='1337'>
                jsum=jsum+2*jcen(ip)<a name='1338'>
                ict=ict+2<a name='1339'>
             else<a name='1340'>
                isum=isum+icen(ip)<a name='1341'>
                jsum=jsum+jcen(ip)<a name='1342'>
                ict=ict+1<a name='1343'>
             endif<a name='1344'>
          endif<a name='1345'>
       endif<a name='1346'>
    enddo<a name='1347'>
<a name='1348'>
    iout=nint(real(isum)/real(ict))<a name='1349'>
    jout=nint(real(jsum)/real(ict))<a name='1350'>
  end subroutine get_uv_guess<a name='1351'>
<a name='1352'>
<A NAME='GET_UV_CENTER'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1353'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_uv_center</font>(grid,orig, &amp; <A href='../../call_to/GET_UV_CENTER.html' TARGET='index'>3</A>,<A href='../../call_from/GET_UV_CENTER.html' TARGET='index'>6</A><a name='1354'>
       iout,jout,rout,calcparm,lonout,latout, &amp;<a name='1355'>
       dxdymean,cparm, &amp;<a name='1356'>
       IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1357'>
       IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1358'>
       IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='1359'>
       iuvguess,juvguess) <a name='1360'>
<a name='1361'>
    use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_14"><a name='1362'>
#ifdef DM_PARALLEL<a name='1363'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_52">, only: wrf_dm_minval_real, wrf_dm_maxval_real, wrf_dm_sum_real<a name='1364'>
#endif<a name='1365'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_72">, ONLY : domain,get_ijk_from_grid<a name='1366'>
    use <A href='../../html_code/dyn_nmm/module_relax.F.html#MODULE_RELAX'>module_relax</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RELAX_3"><a name='1367'>
    implicit none<a name='1368'>
<a name='1369'>
    integer, intent(in) :: iuvguess,juvguess<a name='1370'>
    type(domain), intent(inout) :: grid<a name='1371'>
    character*(*), intent(in) :: cparm<a name='1372'>
    real, intent(in) :: dxdymean<a name='1373'>
    real, intent(inout) :: rout<a name='1374'>
    integer, intent(inout) :: iout,jout<a name='1375'>
    logical, intent(inout) :: calcparm<a name='1376'>
    real, intent(inout) :: latout,lonout<a name='1377'>
    real, intent(in) :: orig(ims:ime,jms:jme)<a name='1378'>
<a name='1379'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='1380'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='1381'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='1382'>
<a name='1383'>
    integer :: icen,jcen, i,j, istart,istop, jstart,jstop, ierr<a name='1384'>
    real :: rcen, srsq<a name='1385'>
<a name='1386'>
    <font color=#447700>! Restrict the search area.  By default, we search everywhere except the boundary:<a name='1387'></font>
    istart=max(ids+1,ips)<a name='1388'>
    istop=min(ide-2,ipe)<a name='1389'>
    jstart=max(jds+2,jps)<a name='1390'>
    jstop=min(jde-3,jpe)<a name='1391'>
<a name='1392'>
    <font color=#447700>! If the guess location is given, then further restrict the search area:<a name='1393'></font>
    istart=max(istart,iuvguess-nint(rads_vmag/(2.*dxdymean)))<a name='1394'>
    istop=min(istop,iuvguess+nint(rads_vmag/(2.*dxdymean)))<a name='1395'>
    jstart=max(jstart,juvguess-nint(rads_vmag/(2.*dxdymean)))<a name='1396'>
    jstop=min(jstop,juvguess+nint(rads_vmag/(2.*dxdymean)))<a name='1397'>
    <a name='1398'>
    srsq=rads_vmag*rads_vmag*1e6<a name='1399'>
<a name='1400'>
    icen=-99<a name='1401'>
    jcen=-99<a name='1402'>
    rcen=9e9<a name='1403'>
    do j=jstart,jstop<a name='1404'>
       do i=istart,istop<a name='1405'>
          if(orig(i,j)&lt;rcen .and. grid%distsq(i,j)&lt;srsq) then<a name='1406'>
             rcen=orig(i,j)<a name='1407'>
             icen=i<a name='1408'>
             jcen=j<a name='1409'>
          endif<a name='1410'>
       enddo<a name='1411'>
    enddo<a name='1412'>
<a name='1413'>
#ifdef DM_PARALLEL<a name='1414'>
       call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_6">(rcen,icen,jcen)<a name='1415'>
       <font color=#447700>!write(0,*) 'global',icen,jcen,rcen<a name='1416'></font>
#endif<a name='1417'>
<a name='1418'>
    <font color=#447700>! Return result:<a name='1419'></font>
    resultif: if(icen==-99 .or. jcen==-99) then<a name='1420'>
       <font color=#447700>! No center found.<a name='1421'></font>
       calcparm=.false.<a name='1422'>
       <font color=#447700>!write(0,*) 'no center found'<a name='1423'></font>
    else<a name='1424'>
       iout=icen<a name='1425'>
       jout=jcen<a name='1426'>
       rout=rcen<a name='1427'>
       calcparm=.true.<a name='1428'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_UV_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_9">(grid,iout,jout,lonout,latout,ierr, &amp;<a name='1429'>
            ids,ide, jds,jde, kds,kde, &amp;<a name='1430'>
            ims,ime, jms,jme, kms,kme, &amp;<a name='1431'>
            ips,ipe, jps,jpe, kps,kpe) <a name='1432'>
       if(ierr/=0) then<a name='1433'>
          <font color=#447700>!write(0,*) 'bad lonlat'<a name='1434'></font>
          calcparm=.false.<a name='1435'>
          return<a name='1436'>
       endif<a name='1437'>
       <font color=#447700>!write(0,*) 'center found; lon=',lonout,' lat=',latout<a name='1438'></font>
    endif resultif<a name='1439'>
  end subroutine get_uv_center<a name='1440'>
<a name='1441'>
<A NAME='FIND_CENTER'><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1442'>
  <font color=#993300>subroutine </font><font color=#cc0000>find_center</font>(grid,orig,smooth,srsq, &amp; <A href='../../call_to/FIND_CENTER.html' TARGET='index'>9</A>,<A href='../../call_from/FIND_CENTER.html' TARGET='index'>10</A><a name='1443'>
       iout,jout,rout,calcparm,lonout,latout, &amp;<a name='1444'>
       dxdymean,cparm, &amp;<a name='1445'>
       IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1446'>
       IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1447'>
       IPS,IPE,JPS,JPE,KPS,KPE, &amp;<a name='1448'>
       iuvguess,juvguess,north_hemi)<a name='1449'>
    <font color=#447700>! This routine replaces the gettrk_main functions find_maxmin and<a name='1450'></font>
    <font color=#447700>! get_uv_center.<a name='1451'></font>
<a name='1452'>
    <font color=#447700>! Finds the minimum or maximum value of the smoothed version<a name='1453'></font>
    <font color=#447700>! (smooth) of the given field (orig).  If a center cannot be<a name='1454'></font>
    <font color=#447700>! found, sets calcparm=.false., otherwise places the longitude in<a name='1455'></font>
    <font color=#447700>! lonout and latitude in latout, gridpoint location in (iout,jout)<a name='1456'></font>
<a name='1457'>
    <font color=#447700>! Mandatory arguments:<a name='1458'></font>
<a name='1459'>
    <font color=#447700>! grid - grid to search<a name='1460'></font>
    <font color=#447700>! orig - field to search<a name='1461'></font>
    <font color=#447700>! smooth - smoothed version of the field (smoothed via relax4e)<a name='1462'></font>
    <font color=#447700>! iout,jout - center location<a name='1463'></font>
    <font color=#447700>! rout - center value (min MSLP, min wind, max or min zeta, etc.)<a name='1464'></font>
    <font color=#447700>! calcparm - true if a center was found, false otherwise<a name='1465'></font>
    <font color=#447700>! lonout,latout - geographic location of the center<a name='1466'></font>
    <font color=#447700>! dxdymean - mean H-to-V gridpoint distance of the entire domain<a name='1467'></font>
    <font color=#447700>! cparm - which type of field: zeta, hgt, wind, slp<a name='1468'></font>
    <font color=#447700>! srsq - square of the maximum radius from domain center to search<a name='1469'></font>
    <font color=#447700>! ids, ..., kpe - grid, memory and patch dimensions<a name='1470'></font>
<a name='1471'>
    <font color=#447700>! Optional arguments:<a name='1472'></font>
<a name='1473'>
    <font color=#447700>! iuvguess,juvguess - first guess center location to restrict search<a name='1474'></font>
    <font color=#447700>! to a subset of the grid.<a name='1475'></font>
    <font color=#447700>! north_hemi - we're in the northern hemisphere: true or false?<a name='1476'></font>
<a name='1477'>
    use <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_15"><a name='1478'>
#ifdef DM_PARALLEL<a name='1479'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_53">, only: wrf_dm_minval_real, wrf_dm_maxval_real, wrf_dm_sum_real<a name='1480'>
#endif<a name='1481'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_73">, ONLY : domain,get_ijk_from_grid<a name='1482'>
    use <A href='../../html_code/dyn_nmm/module_relax.F.html#MODULE_RELAX'>module_relax</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RELAX_4"><a name='1483'>
    implicit none<a name='1484'>
<a name='1485'>
    integer, intent(in), optional :: iuvguess,juvguess<a name='1486'>
    type(domain), intent(inout) :: grid<a name='1487'>
    character*(*), intent(in) :: cparm<a name='1488'>
    real, intent(in) :: dxdymean, srsq<a name='1489'>
    real, intent(inout) :: rout<a name='1490'>
    integer, intent(inout) :: iout,jout<a name='1491'>
    logical, intent(inout) :: calcparm<a name='1492'>
    real, intent(inout) :: latout,lonout<a name='1493'>
    real, intent(in) :: orig(ims:ime,jms:jme)<a name='1494'>
    real, intent(out) :: smooth(ims:ime,jms:jme)<a name='1495'>
    character*255 :: message<a name='1496'>
    logical, optional :: north_hemi<a name='1497'>
<a name='1498'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='1499'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='1500'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='1501'>
<a name='1502'>
    integer :: icen,jcen,i,j,ismooth,ierr<a name='1503'>
    real :: rcen, here, sum, mean, cendist, heredist<a name='1504'>
<a name='1505'>
    integer :: istart,istop, jstart,jstop,itemp<a name='1506'>
<a name='1507'>
    logical :: findmin<a name='1508'>
<a name='1509'>
    <font color=#447700>! Emulate the tracker's barnes analysis with a 1/e iterative smoother:<a name='1510'></font>
    grid%relaxmask=.false.<a name='1511'>
    do j=max(jds+2,jps),min(jde-3,jpe)<a name='1512'>
       do i=max(ids+2,ips),min(ide-3,ipe)<a name='1513'>
          grid%relaxmask(i,j)=.true.<a name='1514'>
       enddo<a name='1515'>
    enddo<a name='1516'>
    do j=jps,min(jde-1,jpe)<a name='1517'>
       do i=ips,min(ide-1,ipe)<a name='1518'>
          grid%relaxwork(i,j)=orig(i,j)<a name='1519'>
       enddo<a name='1520'>
    enddo<a name='1521'>
<a name='1522'>
    <font color=#447700>! Decide how many smoother iterations to do based on the parameter<a name='1523'></font>
    <font color=#447700>! and grid spacing:<a name='1524'></font>
    if(trim(cparm)=='wind') then<a name='1525'>
       itemp=nint(1.2*111./(dxdymean*sqrt(2.)))<a name='1526'>
       ismooth=min(30,max(2,itemp))<a name='1527'>
       <font color=#447700>!write(0,*) 'wind itemp=',itemp,' ismooth=',ismooth,' dxdymean=',dxdymean<a name='1528'></font>
    elseif(grid%vortex_tracker==6) then<a name='1529'>
       itemp=nint(0.3*111./(dxdymean*sqrt(2.)))<a name='1530'>
       ismooth=min(15,max(1,itemp))<a name='1531'>
       <font color=#447700>!write(0,*) 'non-wind itemp=',itemp,' ismooth=',ismooth,' dxdymean=',dxdymean<a name='1532'></font>
    else<a name='1533'>
       itemp=nint(150./(dxdymean*sqrt(2.)))<a name='1534'>
       ismooth=min(50,max(2,itemp))<a name='1535'>
    endif<a name='1536'>
<a name='1537'>
    <font color=#447700>! Restrict the search area.  By default, we search everywhere except the boundary:<a name='1538'></font>
    istart=max(ids+1,ips)<a name='1539'>
    istop=min(ide-2,ipe)<a name='1540'>
    jstart=max(jds+2,jps)<a name='1541'>
    jstop=min(jde-3,jpe)<a name='1542'>
<a name='1543'>
    <font color=#447700>! If the guess location is given, then further restrict the search area:<a name='1544'></font>
    if(present(iuvguess)) then<a name='1545'>
       istart=max(istart,iuvguess-nint(rads_vmag/(2.*dxdymean)))<a name='1546'>
       istop=min(istop,iuvguess+nint(rads_vmag/(2.*dxdymean)))<a name='1547'>
    endif<a name='1548'>
    if(present(juvguess)) then<a name='1549'>
       jstart=max(jstart,juvguess-nint(rads_vmag/(2.*dxdymean)))<a name='1550'>
       jstop=min(jstop,juvguess+nint(rads_vmag/(2.*dxdymean)))<a name='1551'>
    endif<a name='1552'>
<a name='1553'>
    <font color=#447700>! Call the smoother:<a name='1554'></font>
    <font color=#447700>!write(0,*) 'SMOOTH: ',ismooth<a name='1555'></font>
    call <A href='../../html_code/dyn_nmm/module_relax.F.html#RELAX4E'>relax4e</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RELAX4E_3">(grid,real(0.59539032480831),ismooth,0, &amp;<a name='1556'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1557'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1558'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='1559'>
    <a name='1560'>
    <font color=#447700>! Copy the smoothed data back in:<a name='1561'></font>
    do j=jps,min(jde-1,jpe)<a name='1562'>
       do i=ips,min(ide-1,ipe)<a name='1563'>
          smooth(i,j)=grid%relaxwork(i,j)<a name='1564'>
       enddo<a name='1565'>
    enddo<a name='1566'>
       <a name='1567'>
    <font color=#447700>! Figure out whether we're finding a min or max:<a name='1568'></font>
    ifmin: if(trim(cparm)=='zeta') then<a name='1569'>
       if(.not.present(north_hemi)) then<a name='1570'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_110">('When calling module_tracker find_center for zeta, you must specify the hemisphere parameter.')<a name='1571'>
       endif<a name='1572'>
       findmin=.not.north_hemi<a name='1573'>
    elseif(trim(cparm)=='hgt') then<a name='1574'>
       findmin=.true.<a name='1575'>
    elseif(trim(cparm)=='slp') then<a name='1576'>
       findmin=.true.<a name='1577'>
    elseif(trim(cparm)=='wind') then<a name='1578'>
       findmin=.true.<a name='1579'>
    else<a name='1580'>
100    format('Invalid parameter cparm="',A,'" in module_tracker find_center')<a name='1581'>
       <font color=#447700>!write(message,100) trim(cparm)<a name='1582'></font>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_111">(message)<a name='1583'>
    endif ifmin<a name='1584'>
<a name='1585'>
3011 format('ips=',I0,' ipe=',I0,' istart=',I0,' istop=',I0)<a name='1586'>
3012 format('jps=',I0,' jpe=',I0,' jstart=',I0,' jstop=',I0)<a name='1587'>
    <font color=#447700>!write(0,3011) ips,ipe,istart,istop<a name='1588'></font>
    <font color=#447700>!write(0,3012) jps,jpe,jstart,jstop<a name='1589'></font>
<a name='1590'>
    <font color=#447700>! Find the extremum:<a name='1591'></font>
    icen=-99<a name='1592'>
    jcen=-99<a name='1593'>
    findminmax: if(findmin) then <font color=#447700>! Find a minimum<a name='1594'></font>
       rcen=9e9<a name='1595'>
       do j=jstart,jstop<a name='1596'>
          do i=istart,istop<a name='1597'>
             if(grid%relaxwork(i,j)&lt;rcen .and. grid%distsq(i,j)&lt;srsq) then<a name='1598'>
                rcen=grid%relaxwork(i,j)<a name='1599'>
                icen=i<a name='1600'>
                jcen=j<a name='1601'>
             endif<a name='1602'>
          enddo<a name='1603'>
       enddo<a name='1604'>
3013   format(A,' minval i=',I0,' j=',I0,' r=',F0.3)<a name='1605'>
       <font color=#447700>!write(0,3013) 'local',icen,jcen,rcen<a name='1606'></font>
#ifdef DM_PARALLEL<a name='1607'>
       call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_7">(rcen,icen,jcen)<a name='1608'>
       <font color=#447700>!write(0,3013) 'global',icen,jcen,rcen<a name='1609'></font>
#endif<a name='1610'>
    else <font color=#447700>! Find a maximum<a name='1611'></font>
3014   format(A,' maxval i=',I0,' j=',I0,' r=',F0.3)<a name='1612'>
       rcen=-9e9<a name='1613'>
       do j=jstart,jstop<a name='1614'>
          do i=istart,istop<a name='1615'>
             if(grid%relaxwork(i,j)&gt;rcen .and. grid%distsq(i,j)&lt;srsq) then<a name='1616'>
                rcen=grid%relaxwork(i,j)<a name='1617'>
                icen=i<a name='1618'>
                jcen=j<a name='1619'>
             endif<a name='1620'>
          enddo<a name='1621'>
       enddo<a name='1622'>
       <font color=#447700>!write(0,3014) 'local',icen,jcen,rcen<a name='1623'></font>
#ifdef DM_PARALLEL<a name='1624'>
       call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_7">(rcen,icen,jcen)<a name='1625'>
       <font color=#447700>!write(0,3014) 'global',icen,jcen,rcen<a name='1626'></font>
#endif<a name='1627'>
    endif findminmax<a name='1628'>
<a name='1629'>
    <font color=#447700>! Return result:<a name='1630'></font>
    resultif: if(icen==-99 .or. jcen==-99) then<a name='1631'>
       <font color=#447700>! No center found.<a name='1632'></font>
       calcparm=.false.<a name='1633'>
       <font color=#447700>!write(0,*) 'no center found'<a name='1634'></font>
    else<a name='1635'>
       iout=icen<a name='1636'>
       jout=jcen<a name='1637'>
       rout=rcen<a name='1638'>
       calcparm=.true.<a name='1639'>
       call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#FIND_CENTER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_10">(grid,iout,jout,lonout,latout,ierr, &amp;<a name='1640'>
            ids,ide, jds,jde, kds,kde, &amp;<a name='1641'>
            ims,ime, jms,jme, kms,kme, &amp;<a name='1642'>
            ips,ipe, jps,jpe, kps,kpe) <a name='1643'>
       if(ierr/=0) then<a name='1644'>
          <font color=#447700>!write(0,*) 'bad lonlat'<a name='1645'></font>
          calcparm=.false.<a name='1646'>
          return<a name='1647'>
       endif<a name='1648'>
       <font color=#447700>!write(0,*) 'center found; lon=',lonout,' lat=',latout<a name='1649'></font>
    endif resultif<a name='1650'>
  end subroutine find_center<a name='1651'>
<a name='1652'>
<A NAME='GET_TRACKER_DISTSQ'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1653'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_tracker_distsq</font>(grid, &amp; <A href='../../call_to/GET_TRACKER_DISTSQ.html' TARGET='index'>2</A>,<A href='../../call_from/GET_TRACKER_DISTSQ.html' TARGET='index'>8</A><a name='1654'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1655'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1656'>
         ITS,ITE,JTS,JTE,KTS,KTE)<a name='1657'>
    <font color=#447700>! This computes approximate distances in km from the tracker<a name='1658'></font>
    <font color=#447700>! center of the various points in the domain.  It uses the same<a name='1659'></font>
    <font color=#447700>! computation as used for distsq: the calculation is done in<a name='1660'></font>
    <font color=#447700>! gridpoint space, approximating the domain as flat.<a name='1661'></font>
    <font color=#447700>! Point-to-point distances come from grid%dx_nmm and grid%dy_nmm.<a name='1662'></font>
    <font color=#447700>! This routine also determines the distance from the tracker<a name='1663'></font>
    <font color=#447700>! center location to the nearest point in the domain edge.<a name='1664'></font>
#ifdef DM_PARALLEL<a name='1665'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_54">, only: wrf_dm_minval_real<a name='1666'>
#endif<a name='1667'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_74">, ONLY : domain,get_ijk_from_grid<a name='1668'>
    implicit none<a name='1669'>
    type(domain), intent(inout) :: grid<a name='1670'>
    character*255 message<a name='1671'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='1672'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='1673'>
    integer, intent(in) :: ITS,ITE,JTS,JTE,KTS,KTE<a name='1674'>
    integer i,j,cx,cy,ierr<a name='1675'>
    integer wilbur,harvey <font color=#447700>! filler variables for a function call<a name='1676'></font>
    real xfar,yfar,far,xshift,max_edge_distsq,clatr,clonr<a name='1677'>
    real ylat1,ylat2,xlon1,xlon2,mindistsq<a name='1678'>
<a name='1679'>
    cx=grid%tracker_ifix<a name='1680'>
    cy=grid%tracker_jfix<a name='1681'>
<a name='1682'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT'>get_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_LONLAT_11">(grid,cx,cy,clonr,clatr,ierr, &amp;<a name='1683'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1684'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1685'>
         ITS,ITE,JTS,JTE,KTS,KTE)<a name='1686'>
    if(ierr/=0) then<a name='1687'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_112">('Tracker fix location is not inside domain.')<a name='1688'>
    end if<a name='1689'>
<a name='1690'>
    do j=jts,min(jte,jde-1)<a name='1691'>
       if(mod(j,2)==1) then<a name='1692'>
          xshift=1.<a name='1693'>
       else<a name='1694'>
          xshift=-1.<a name='1695'>
       endif<a name='1696'>
       do i=its,min(ite,ide-1)<a name='1697'>
          xfar=(i-cx)*grid%dx_nmm(i,j)*2<a name='1698'>
          yfar=(j-cy)*grid%dy_nmm<a name='1699'>
          if(mod(cy-j,2) /= 0) then<a name='1700'>
             xfar=xfar + grid%dx_nmm(i,j)*xshift<a name='1701'>
          endif<a name='1702'>
          far = xfar*xfar + yfar*yfar<a name='1703'>
          GRID%tracker_distsq(i,j)=far<a name='1704'>
       enddo<a name='1705'>
    enddo<a name='1706'>
<a name='1707'>
    <font color=#447700>! Determine angle.  Note that this is mathematical angle, not<a name='1708'></font>
    <font color=#447700>! compass angle, and is in geographic lat/lon, not rotated<a name='1709'></font>
    <font color=#447700>! lat/lon.  (Geographic East=0, geographic North=pi/2.)<a name='1710'></font>
    xlon1=clonr ; ylat1=clatr<a name='1711'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CLEAN_LON_LAT'>clean_lon_lat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLEAN_LON_LAT_1">(xlon1,ylat1)<a name='1712'>
    xlon1=xlon1*pi180<a name='1713'>
    ylat1=ylat1*pi180<a name='1714'>
    do j=jts,min(jte,jde-1)<a name='1715'>
       do i=its,min(ite,ide-1)<a name='1716'>
          xlon2=grid%glon(i,j)<a name='1717'>
          ylat2=grid%glat(i,j)<a name='1718'>
          call <A href='../../html_code/dyn_nmm/module_tracker.F.html#CLEAN_LON_LAT'>clean_lon_lat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLEAN_LON_LAT_2">(xlon2,ylat2)<a name='1719'>
          xlon2=xlon2*pi180<a name='1720'>
          ylat2=ylat2*pi180<a name='1721'>
          grid%tracker_angle(i,j)=atan2(xlon2-xlon1,ylat2-ylat1)<a name='1722'>
       enddo<a name='1723'>
    enddo<a name='1724'>
<a name='1725'>
    <font color=#447700>! Determine the distance between the center location and the<a name='1726'></font>
    <font color=#447700>! domain edge.<a name='1727'></font>
    mindistsq=9e19<a name='1728'>
    if(jts==jds) then<a name='1729'>
       mindistsq=min(mindistsq,minval(grid%tracker_distsq(its:min(ite,ide-1),jds)))<a name='1730'>
    endif<a name='1731'>
    if(jte==jde) then<a name='1732'>
       mindistsq=min(mindistsq,minval(grid%tracker_distsq(its:min(ite,ide-1),jde-1)))<a name='1733'>
    endif<a name='1734'>
    if(its==ids) then<a name='1735'>
       mindistsq=min(mindistsq,minval(grid%tracker_distsq(ids,jts:min(jte,jde-1))))<a name='1736'>
    endif<a name='1737'>
    if(ite==ide) then<a name='1738'>
       mindistsq=min(mindistsq,minval(grid%tracker_distsq(ide-1,jts:min(jte,jde-1))))<a name='1739'>
    endif<a name='1740'>
#ifdef DM_PARALLEL<a name='1741'>
    wilbur=1<a name='1742'>
    harvey=2<a name='1743'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_8">(mindistsq,wilbur,harvey)<a name='1744'>
#endif<a name='1745'>
<a name='1746'>
    grid%tracker_edge_dist=sqrt(mindistsq)<a name='1747'>
<a name='1748'>
17  format('Min distance from lon=',F9.3,', lat=',F9.3,' to center is ',F19.3)<a name='1749'>
    <font color=#447700>!print *,'Min distance from edge to center is ',grid%tracker_edge_dist<a name='1750'></font>
    write(message,17) clonr, clatr, grid%tracker_edge_dist<a name='1751'>
    call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_155">(message)<a name='1752'>
  end subroutine get_tracker_distsq<a name='1753'>
<a name='1754'>
<A NAME='CLEAN_LON_LAT'><A href='../../html_code/dyn_nmm/module_tracker.F.html#CLEAN_LON_LAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1755'>
  <font color=#993300>subroutine </font><font color=#cc0000>clean_lon_lat</font>(xlon1,ylat1) <A href='../../call_to/CLEAN_LON_LAT.html' TARGET='index'>2</A><a name='1756'>
    real, intent(inout) :: xlon1,ylat1<a name='1757'>
    <font color=#447700>! This modifies a (lat,lon) pair so that the longitude fits<a name='1758'></font>
    <font color=#447700>! between [-180,180] and the latitude between [-90,90], taking<a name='1759'></font>
    <font color=#447700>! into account spherical geometry.<a name='1760'></font>
    <font color=#447700>! NOTE: inputs and outputs are in degrees<a name='1761'></font>
    xlon1=(mod(xlon1+3600.+180.,360.)-180.)<a name='1762'>
    ylat1=(mod(ylat1+3600.+180.,360.)-180.)<a name='1763'>
    if(ylat1&gt;90.) then<a name='1764'>
       ylat1=180.-ylat1<a name='1765'>
       xlon1=mod(xlon1+360.,360.)-180.<a name='1766'>
    elseif(ylat1&lt;-90.) then<a name='1767'>
       ylat1=-180. - ylat1<a name='1768'>
       xlon1=mod(xlon1+360.,360.)-180.<a name='1769'>
    endif<a name='1770'>
  end subroutine clean_lon_lat<a name='1771'>
<a name='1772'>
<A NAME='CALCDIST'><A href='../../html_code/dyn_nmm/module_tracker.F.html#CALCDIST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1773'>
  <font color=#993300>subroutine </font><font color=#cc0000>calcdist</font>(rlonb,rlatb,rlonc,rlatc,xdist,degrees) <A href='../../call_to/CALCDIST.html' TARGET='index'>6</A><a name='1774'>
    <font color=#447700>! Copied from gettrk_main.f<a name='1775'></font>
    <font color=#447700>!<a name='1776'></font>
    <font color=#447700>!     ABSTRACT: This subroutine computes the distance between two <a name='1777'></font>
    <font color=#447700>!               lat/lon points by using spherical coordinates to <a name='1778'></font>
    <font color=#447700>!               calculate the great circle distance between the points.<a name='1779'></font>
    <font color=#447700>!                       Figure out the angle (a) between pt.B and pt.C,<a name='1780'></font>
    <font color=#447700>!             N. Pole   then figure out how much of a % of a great <a name='1781'></font>
    <font color=#447700>!               x       circle distance that angle represents.<a name='1782'></font>
    <font color=#447700>!              / \<a name='1783'></font>
    <font color=#447700>!            b/   \     cos(a) = (cos b)(cos c) + (sin b)(sin c)(cos A)<a name='1784'></font>
    <font color=#447700>!            /     \                                             .<a name='1785'></font>
    <font color=#447700>!        pt./&lt;--A--&gt;\c     NOTE: The latitude arguments passed to the<a name='1786'></font>
    <font color=#447700>!        B /         \           subr are the actual lat vals, but in<a name='1787'></font>
    <font color=#447700>!                     \          the calculation we use 90-lat.<a name='1788'></font>
    <font color=#447700>!               a      \                                      .<a name='1789'></font>
    <font color=#447700>!                       \pt.  NOTE: You may get strange results if you:<a name='1790'></font>
    <font color=#447700>!                         C    (1) use positive values for SH lats AND<a name='1791'></font>
    <font color=#447700>!                              you try computing distances across the <a name='1792'></font>
    <font color=#447700>!                              equator, or (2) use lon values of 0 to<a name='1793'></font>
    <font color=#447700>!                              -180 for WH lons AND you try computing<a name='1794'></font>
    <font color=#447700>!                              distances across the 180E meridian.<a name='1795'></font>
    <font color=#447700>!    <a name='1796'></font>
    <font color=#447700>!     NOTE: In the diagram above, (a) is the angle between pt. B and<a name='1797'></font>
    <font color=#447700>!     pt. C (with pt. x as the vertex), and (A) is the difference in<a name='1798'></font>
    <font color=#447700>!     longitude (in degrees, absolute value) between pt. B and pt. C.<a name='1799'></font>
    <font color=#447700>!<a name='1800'></font>
    <font color=#447700>!     !!! NOTE !!! -- THE PARAMETER ecircum IS DEFINED (AS OF THE <a name='1801'></font>
    <font color=#447700>!     ORIGINAL WRITING OF THIS SYSTEM) IN KM, NOT M, SO BE AWARE THAT<a name='1802'></font>
    <font color=#447700>!     THE DISTANCE RETURNED FROM THIS SUBROUTINE IS ALSO IN KM.<a name='1803'></font>
    <font color=#447700>!<a name='1804'></font>
    implicit none<a name='1805'>
<a name='1806'>
    real, intent(inout) :: degrees<a name='1807'>
    real, intent(out) :: xdist<a name='1808'>
    real, intent(in) :: rlonb,rlatb,rlonc,rlatc<a name='1809'>
    real, parameter :: dtr = 0.0174532925199433<a name='1810'>
    real :: distlatb,distlatc,pole,difflon,cosanga,circ_fract<a name='1811'>
    <font color=#447700>!<a name='1812'></font>
    if (rlatb &lt; 0.0 .or. rlatc &lt; 0.0) then<a name='1813'>
       pole = -90.<a name='1814'>
    else<a name='1815'>
       pole = 90.<a name='1816'>
    endif<a name='1817'>
    <font color=#447700>!<a name='1818'></font>
    distlatb = (pole - rlatb) * dtr<a name='1819'>
    distlatc = (pole - rlatc) * dtr<a name='1820'>
    difflon  = abs( (rlonb - rlonc)*dtr )<a name='1821'>
    <font color=#447700>!<a name='1822'></font>
    cosanga = ( cos(distlatb) * cos(distlatc) + &amp;<a name='1823'>
         sin(distlatb) * sin(distlatc) * cos(difflon))<a name='1824'>
<a name='1825'>
    <font color=#447700>!     This next check of cosanga is needed since I have had ACOS crash<a name='1826'></font>
    <font color=#447700>!     when calculating the distance between 2 identical points (should<a name='1827'></font>
    <font color=#447700>!     = 0), but the input for ACOS was just slightly over 1<a name='1828'></font>
    <font color=#447700>!     (e.g., 1.00000000007), due to (I'm guessing) rounding errors.<a name='1829'></font>
<a name='1830'>
    if (cosanga &gt; 1.0) then<a name='1831'>
       cosanga = 1.0<a name='1832'>
    endif<a name='1833'>
<a name='1834'>
    degrees    = acos(cosanga) / dtr<a name='1835'>
    circ_fract = degrees / 360.<a name='1836'>
    xdist      = circ_fract * ecircum<a name='1837'>
    <font color=#447700>!<a name='1838'></font>
    <font color=#447700>!     NOTE: whether this subroutine returns the value of the distance<a name='1839'></font>
    <font color=#447700>!           in km or m depends on the scale of the parameter ecircum. <a name='1840'></font>
    <font color=#447700>!           At the original writing of this subroutine (7/97), ecircum<a name='1841'></font>
    <font color=#447700>!           was given in km.<a name='1842'></font>
    <font color=#447700>!<a name='1843'></font>
    return<a name='1844'>
  end subroutine calcdist<a name='1845'>
<a name='1846'>
  <font color=#447700>! subroutine get_lonlat(grid,iguess,jguess,longuess,latguess, &amp;<a name='1847'></font>
  <font color=#447700>!       ids,ide, jds,jde, kds,kde, &amp;<a name='1848'></font>
  <font color=#447700>!       ims,ime, jms,jme, kms,kme, &amp;<a name='1849'></font>
  <font color=#447700>!       ips,ipe, jps,jpe, kps,kpe)<a name='1850'></font>
  <font color=#447700>!   ! Returns the latitude (latguess) and longitude (longuess) of the<a name='1851'></font>
  <font color=#447700>!   ! specified location (iguess,jguess) in the specified grid.<a name='1852'></font>
  <font color=#447700>!   USE MODULE_DOMAIN, ONLY : domain,get_ijk_from_grid<a name='1853'></font>
  <font color=#447700>!   USE MODULE_DM, ONLY: wrf_dm_at_ij_real<a name='1854'></font>
  <font color=#447700>!   implicit none<a name='1855'></font>
  <font color=#447700>!   integer, intent(in) :: &amp;<a name='1856'></font>
  <font color=#447700>!       ids,ide, jds,jde, kds,kde, &amp;<a name='1857'></font>
  <font color=#447700>!       ims,ime, jms,jme, kms,kme, &amp;<a name='1858'></font>
  <font color=#447700>!       ips,ipe, jps,jpe, kps,kpe<a name='1859'></font>
  <font color=#447700>!   type(domain), intent(inout) :: grid<a name='1860'></font>
  <font color=#447700>!   integer, intent(in) :: iguess,jguess<a name='1861'></font>
  <font color=#447700>!   real, intent(inout) :: longuess,latguess<a name='1862'></font>
<a name='1863'>
  <font color=#447700>!   call wrf_dm_at_ij_real(grid,iguess,jguess,ims,ime, jms,jme, &amp;<a name='1864'></font>
  <font color=#447700>!        longuess,grid%hlon, &amp;<a name='1865'></font>
  <font color=#447700>!       val2=latguess,field2=grid%hlat)<a name='1866'></font>
  <font color=#447700>! end subroutine get_lonlat<a name='1867'></font>
<a name='1868'>
<a name='1869'>
<A NAME='GET_LONLAT'><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1870'>
  <font color=#993300>subroutine </font><font color=#cc0000>get_lonlat</font>(grid,iguess,jguess,longuess,latguess,ierr, &amp; <A href='../../call_to/GET_LONLAT.html' TARGET='index'>11</A>,<A href='../../call_from/GET_LONLAT.html' TARGET='index'>3</A><a name='1871'>
       ids,ide, jds,jde, kds,kde, &amp;<a name='1872'>
       ims,ime, jms,jme, kms,kme, &amp;<a name='1873'>
       ips,ipe, jps,jpe, kps,kpe)<a name='1874'>
    <font color=#447700>! Returns the latitude (latguess) and longitude (longuess) of the<a name='1875'></font>
    <font color=#447700>! specified location (iguess,jguess) in the specified grid.<a name='1876'></font>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_75">, ONLY : domain,get_ijk_from_grid<a name='1877'>
    USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>MODULE_DM</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_55">, ONLY: wrf_dm_maxloc_real<a name='1878'>
    implicit none<a name='1879'>
    integer, intent(in) :: &amp;<a name='1880'>
         ids,ide, jds,jde, kds,kde, &amp;<a name='1881'>
         ims,ime, jms,jme, kms,kme, &amp;<a name='1882'>
         ips,ipe, jps,jpe, kps,kpe<a name='1883'>
    integer, intent(out) :: ierr<a name='1884'>
    type(domain), intent(inout) :: grid<a name='1885'>
    integer, intent(in) :: iguess,jguess<a name='1886'>
    real, intent(inout) :: longuess,latguess<a name='1887'>
    real :: weight,zjunk<a name='1888'>
    integer :: itemp,jtemp<a name='1889'>
<a name='1890'>
    ierr=0<a name='1891'>
    zjunk=1<a name='1892'>
    if(iguess&gt;=ips .and. iguess&lt;=ipe .and. jguess&gt;=jps .and. jguess&lt;=jpe) then<a name='1893'>
       weight=1<a name='1894'>
       longuess=grid%hlon(iguess,jguess)<a name='1895'>
       latguess=grid%hlat(iguess,jguess)<a name='1896'>
       itemp=iguess<a name='1897'>
       jtemp=jguess<a name='1898'>
    else<a name='1899'>
       weight=0<a name='1900'>
       longuess=-999.9<a name='1901'>
       latguess=-999.9<a name='1902'>
       itemp=-99<a name='1903'>
       jtemp=-99<a name='1904'>
    endif<a name='1905'>
<a name='1906'>
#ifdef DM_PARALLEL<a name='1907'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXLOC_REAL'>wrf_dm_maxloc_real</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_LONLAT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXLOC_REAL_1">(weight,latguess,longuess,zjunk,itemp,jtemp)<a name='1908'>
#endif<a name='1909'>
<a name='1910'>
    if(itemp==-99 .and. jtemp==-99) then<a name='1911'>
       ierr=95<a name='1912'>
    endif<a name='1913'>
  end subroutine get_lonlat<a name='1914'>
<a name='1915'>
<A NAME='UPDATE_TRACKER_POST_MOVE'><A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1916'>
  <font color=#993300>subroutine </font><font color=#cc0000>update_tracker_post_move</font>(grid) <A href='../../call_to/UPDATE_TRACKER_POST_MOVE.html' TARGET='index'>1</A>,<A href='../../call_from/UPDATE_TRACKER_POST_MOVE.html' TARGET='index'>4</A><a name='1917'>
    <font color=#447700>! This updates the tracker i/j fix location and square of the<a name='1918'></font>
    <font color=#447700>! distance to the tracker center after a nest move.<a name='1919'></font>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_76">, ONLY : domain,get_ijk_from_grid<a name='1920'>
    type(domain), intent(inout) :: grid<a name='1921'>
    integer :: ierr, &amp;<a name='1922'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1923'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1924'>
         IPS,IPE,JPS,JPE,KPS,KPE<a name='1925'>
<a name='1926'>
    <font color=#447700>! Get the grid bounds:<a name='1927'></font>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_23"> (  grid ,      &amp;<a name='1928'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='1929'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='1930'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='1931'>
<a name='1932'>
    <font color=#447700>! Get the i/j center location from the fix location:<a name='1933'></font>
    ierr=0<a name='1934'>
    call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_NEAREST_LONLAT'>get_nearest_lonlat</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_NEAREST_LONLAT_3">(grid,grid%tracker_ifix,grid%tracker_jfix, &amp;<a name='1935'>
         ierr,grid%tracker_fixlon,grid%tracker_fixlat, &amp;<a name='1936'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1937'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1938'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='1939'>
<a name='1940'>
    <font color=#447700>! Get the square of the approximate distance to the tracker center<a name='1941'></font>
    <font color=#447700>! at all points:<a name='1942'></font>
    if(ierr==0) &amp;<a name='1943'>
         call <A href='../../html_code/dyn_nmm/module_tracker.F.html#GET_TRACKER_DISTSQ'>get_tracker_distsq</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_TRACKER_DISTSQ_2">(grid, &amp;<a name='1944'>
         IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='1945'>
         IMS,IME,JMS,JME,KMS,KME, &amp;<a name='1946'>
         IPS,IPE,JPS,JPE,KPS,KPE)<a name='1947'>
  end subroutine update_tracker_post_move<a name='1948'>
#endif<a name='1949'>
end module module_tracker<a name='1950'>
<a name='1951'>
#if (HWRF == 1)<a name='1952'>
<A NAME='NMM_MED_TRACKER_POST_MOVE'><A href='../../html_code/dyn_nmm/module_tracker.F.html#NMM_MED_TRACKER_POST_MOVE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1953'>
<font color=#993300>subroutine </font><font color=#cc0000>nmm_med_tracker_post_move</font>(grid) <A href='../../call_to/NMM_MED_TRACKER_POST_MOVE.html' TARGET='index'>1</A>,<A href='../../call_from/NMM_MED_TRACKER_POST_MOVE.html' TARGET='index'>3</A><a name='1954'>
  <font color=#447700>! This updates the tracker i/j fix location and square of the<a name='1955'></font>
  <font color=#447700>! distance to the tracker center after a nest move.<a name='1956'></font>
  use <A href='../../html_code/dyn_nmm/module_tracker.F.html#MODULE_TRACKER'>module_tracker</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NMM_MED_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TRACKER_4">, only: update_tracker_post_move<a name='1957'>
  use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NMM_MED_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_77">, only : domain<a name='1958'>
  type(domain), intent(inout) :: grid<a name='1959'>
  call <A href='../../html_code/dyn_nmm/module_tracker.F.html#UPDATE_TRACKER_POST_MOVE'>update_tracker_post_move</A><A href='../../html_code/dyn_nmm/module_tracker.F.html#NMM_MED_TRACKER_POST_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_TRACKER_POST_MOVE_1">(grid)<a name='1960'>
end subroutine nmm_med_tracker_post_move<a name='1961'>
#endif<a name='1962'>
</pre></body></html>