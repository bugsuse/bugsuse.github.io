<HTML> <BODY BGCOLOR=#bbeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!#define NO_RESTRICT_ACCEL<a name='2'></font>
<font color=#447700>!#define NO_GFDLETAINIT<a name='3'></font>
<font color=#447700>!#define NO_UPSTREAM_ADVECTION<a name='4'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='5'></font>
<font color=#447700>!<a name='6'></font>
#if ( HWRF == 1 )<a name='7'>
<A NAME='GUESS_COUPLING_TIMESTEP'><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='8'>
        <font color=#993300>SUBROUTINE </font><font color=#cc0000>GUESS_COUPLING_TIMESTEP</font>(gridid,DTC) <A href='../../call_to/GUESS_COUPLING_TIMESTEP.html' TARGET='index'>1</A>,<A href='../../call_from/GUESS_COUPLING_TIMESTEP.html' TARGET='index'>9</A><a name='9'>
          USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_54"><a name='10'>
          implicit none<a name='11'>
          real, intent(out) :: DTC<a name='12'>
          integer, intent(in) :: gridid<a name='13'>
          type(grid_config_rec_type) :: config_flags<a name='14'>
          character*255 :: message<a name='15'>
<a name='16'>
          real :: dt<a name='17'>
          integer :: nphs,ntrack<a name='18'>
          if(model_config_rec%max_dom&gt;=2) then<a name='19'>
             <font color=#447700>! Normally, in an HWRF simulation, domain 2 has<a name='20'></font>
             <font color=#447700>! dt*nphs*ntrack = coupling timestep<a name='21'></font>
             <font color=#447700>! So if there is a domain 2, we'll use that to<a name='22'></font>
             <font color=#447700>! guess the coupling timestep.<a name='23'></font>
             if(gridid==1) then<a name='24'>
                <font color=#447700>! The first time this routine is called, it is for domain 1,<a name='25'></font>
                <font color=#447700>! and domain 2 has not been created yet.  That means domain<a name='26'></font>
                <font color=#447700>! 2 still has its dt set to the internal WRF default of 2.<a name='27'></font>
                <font color=#447700>! To get domain 2's correct dt, we get domain 1's dt and<a name='28'></font>
                <font color=#447700>! divide by 3<a name='29'></font>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_241">('Guessing coupling timestep from d01''s dt/3 and d02''s nphs and ntrack...')<a name='30'>
                call <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_8">(1,model_config_rec,config_flags)<a name='31'>
                dt=config_flags%dt/3<a name='32'>
                call <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_9">(2,model_config_rec,config_flags)<a name='33'>
             else<a name='34'>
                call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_242">('Guessing coupling timestep from d02 settings...')<a name='35'>
                call <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_10">(2,model_config_rec,config_flags)<a name='36'>
                dt=config_flags%dt<a name='37'>
             endif<a name='38'>
          else<a name='39'>
             <font color=#447700>! Someone is doing a single domain run, so guess the<a name='40'></font>
             <font color=#447700>! coupling timestep using the<a name='41'></font>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_243">('Guessing coupling timestep from d01 settings because there is no d02...')<a name='42'>
             call <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_11">(1,model_config_rec,config_flags)<a name='43'>
             dt=config_flags%dt<a name='44'>
          endif<a name='45'>
          nphs=config_flags%nphs<a name='46'>
          ntrack=config_flags%ntrack<a name='47'>
<a name='48'>
          dtc = dt*nphs*ntrack<a name='49'>
388       format("dtc=dt*nphs*ntrack = ",F0.3,"=",F0.3,"*",I0,"*",I0)<a name='50'>
          write(message,388) dtc,dt,nphs,ntrack<a name='51'>
          call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_244">(message)<a name='52'>
        END SUBROUTINE GUESS_COUPLING_TIMESTEP<a name='53'>
#endif<a name='54'>
<font color=#447700>!<a name='55'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='56'></font>
<font color=#447700>!<a name='57'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='58'></font>
<font color=#447700>!<a name='59'></font>
<A NAME='START_DOMAIN_NMM'><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='60'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>START_DOMAIN_NMM</font>(GRID, allowed_to_read                &amp; <A href='../../call_to/START_DOMAIN_NMM.html' TARGET='index'>1</A>,<A href='../../call_from/START_DOMAIN_NMM.html' TARGET='index'>98</A><a name='61'>
<font color=#447700>!<a name='62'></font>
#include "<A href='../../html_code/include/dummy_new_args.inc.html'>dummy_new_args.inc</A>"<A NAME="dummy_new_args.inc_1"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='63'>
<font color=#447700>!<a name='64'></font>
     &amp;           )<a name='65'>
<font color=#447700>!----------------------------------------------------------------------<a name='66'></font>
<font color=#447700>!<a name='67'></font>
#if ( HWRF == 1 )<a name='68'>
      USE <A href='../../html_code/frame/module_clear_halos.F.html#MODULE_CLEAR_HALOS'>MODULE_CLEAR_HALOS</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CLEAR_HALOS_1">, only: clear_ij_halos<a name='69'>
      USE <A href='../../html_code/dyn_nmm/module_STATS_FOR_MOVE.F.html#MODULE_STATS_FOR_MOVE'>MODULE_STATS_FOR_MOVE</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATS_FOR_MOVE_2">, only: vorttrak_init<a name='70'>
      USE <A href='../../html_code/dyn_nmm/module_swath.F.html#MODULE_SWATH'>MODULE_SWATH</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SWATH_2">, only: init_swath<a name='71'>
      USE <A href='../../html_code/phys/module_sf_exchcoef.F.html#MODULE_SF_EXCHCOEF'>MODULE_SF_EXCHCOEF</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SF_EXCHCOEF_1">, only: znot_wind10m<a name='72'>
#endif<a name='73'>
      USE <A href='../../html_code/frame/module_timing.F.html#MODULE_TIMING'>MODULE_TIMING</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TIMING_18"><a name='74'>
#if ( HWRF == 1 )<a name='75'>
      USE <A href='../../html_code/dyn_nmm/module_HIFREQ.F.html#MODULE_HIFREQ'>MODULE_HIFREQ</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_HIFREQ_2">, only : hifreq_open<a name='76'>
#endif<a name='77'>
      USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>MODULE_DOMAIN</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_90"><a name='78'>
      USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>MODULE_STATE_DESCRIPTION</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_32"><a name='79'>
      USE <A href='../../html_code/share/module_random.F.html#MODULE_RANDOM'>MODULE_RANDOM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_RANDOM_2">, only : srand_grid, rand_grid_r4<a name='80'>
      USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>MODULE_DRIVER_CONSTANTS</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_10"><a name='81'>
      USE <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_35"><a name='82'>
      USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>MODULE_CONFIGURE</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_55"><a name='83'>
      USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>MODULE_WRF_ERROR</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_16"><a name='84'>
      USE <A href='../../html_code/share/module_MPP.F.html#MODULE_MPP'>MODULE_MPP</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MPP_6"><a name='85'>
      USE <A href='../../html_code/dyn_nmm/module_CTLBLK.F.html#MODULE_CTLBLK'>MODULE_CTLBLK</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CTLBLK_2"><a name='86'>
#ifdef DM_PARALLEL<a name='87'>
      USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>MODULE_DM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_63">,                    ONLY : LOCAL_COMMUNICATOR       &amp;<a name='88'>
                                              ,MYTASK,NTASKS,NTASKS_X   &amp;<a name='89'>
                                              ,NTASKS_Y<a name='90'>
      USE <A href='../../html_code/frame/module_comm_dm.F.html#MODULE_COMM_DM'>MODULE_COMM_DM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_COMM_DM_23"><a name='91'>
#else<a name='92'>
      USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>MODULE_DM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_64"><a name='93'>
#endif<a name='94'>
<font color=#447700>!<a name='95'></font>
      USE <A href='../../html_code/dyn_nmm/module_IGWAVE_ADJUST.F.html#MODULE_IGWAVE_ADJUST'>MODULE_IGWAVE_ADJUST</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IGWAVE_ADJUST_2">,ONLY: PDTE, PFDHT, DDAMP<a name='96'>
      USE <A href='../../html_code/dyn_nmm/module_ADVECTION.F.html#MODULE_ADVECTION'>MODULE_ADVECTION</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ADVECTION_2">,    ONLY: ADVE, VAD2, HAD2<a name='97'>
      USE <A href='../../html_code/dyn_nmm/module_NONHY_DYNAM.F.html#MODULE_NONHY_DYNAM'>MODULE_NONHY_DYNAM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_NONHY_DYNAM_2">,  ONLY: VADZ, HADZ<a name='98'>
      USE <A href='../../html_code/dyn_nmm/module_DIFFUSION_NMM.F.html#MODULE_DIFFUSION_NMM'>MODULE_DIFFUSION_NMM</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DIFFUSION_NMM_2">,ONLY: HDIFF<a name='99'>
      USE <A href='../../html_code/phys/module_physics_init.F.html#MODULE_PHYSICS_INIT'>MODULE_PHYSICS_INIT</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_PHYSICS_INIT_2"><a name='100'>
      USE <A href='../../html_code/dyn_nmm/module_GWD.F.html#MODULE_GWD'>MODULE_GWD</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_GWD_2"><a name='101'>
<font color=#447700>!     USE MODULE_RA_GFDLETA<a name='102'></font>
<font color=#447700>!<a name='103'></font>
      USE MODULE_EXT_INTERNAL<a name='104'>
<font color=#447700>!<a name='105'></font>
   USE <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#MODULE_TORNADO_GENESIS'>module_tornado_genesis</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TORNADO_GENESIS_3">, only: init_tornado_genesis<a name='106'>
<a name='107'>
<font color=#447700>!<a name='108'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='109'></font>
<font color=#447700>!<a name='110'></font>
      IMPLICIT NONE<a name='111'>
<font color=#447700>!<a name='112'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='113'></font>
   INTERFACE<a name='114'>
      SUBROUTINE med_set_egrid_locs ( parent , nest )<a name='115'>
        use <A href='../../html_code/frame/module_domain_type.F.html#MODULE_DOMAIN_TYPE'>module_domain_type</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_TYPE_4">, only: domain<a name='116'>
        type(domain) :: parent,nest<a name='117'>
      END SUBROUTINE med_set_egrid_locs<a name='118'>
   END INTERFACE<a name='119'>
<font color=#447700>!***<a name='120'></font>
<font color=#447700>!***  Arguments<a name='121'></font>
<font color=#447700>!***<a name='122'></font>
      TYPE(DOMAIN),INTENT(INOUT) :: GRID<a name='123'>
      LOGICAL , INTENT(IN)       :: allowed_to_read<a name='124'>
<font color=#447700>!<a name='125'></font>
#include "<A href='../../html_code/include/dummy_new_decl.inc.html'>dummy_new_decl.inc</A>"<A NAME="dummy_new_decl.inc_2"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='126'>
<font color=#447700>!<a name='127'></font>
      TYPE(GRID_CONFIG_REC_TYPE) :: CONFIG_FLAGS<a name='128'>
<font color=#447700>!<a name='129'></font>
<font color=#447700>!<a name='130'></font>
<font color=#447700>!***<a name='131'></font>
<font color=#447700>!***  LOCAL DATA<a name='132'></font>
<font color=#447700>!***<a name='133'></font>
  LOGICAL :: ANAL   <font color=#447700>!added for analysis option<a name='134'></font>
<a name='135'>
  integer(kind=4) :: random_seed<a name='136'>
  INTEGER :: parent_id, nestid, max_dom,one<a name='137'>
  LOGICAL :: grid_allowed, nestless<a name='138'>
<a name='139'>
      INTEGER :: IDS,IDE,JDS,JDE,KDS,KDE                               &amp;<a name='140'>
     &amp;          ,IMS,IME,JMS,JME,KMS,KME                                &amp;<a name='141'>
     &amp;          ,IPS,IPE,JPS,JPE,KPS,KPE<a name='142'>
<font color=#447700>!<a name='143'></font>
      INTEGER :: ERROR,LOOP<a name='144'>
<a name='145'>
      REAL,ALLOCATABLE,DIMENSION(:) :: PHALF<a name='146'>
<font color=#447700>!<a name='147'></font>
      REAL :: EPSB=0.1,EPSIN=9.8<a name='148'>
<font color=#447700>!<a name='149'></font>
      INTEGER :: JHL=7<a name='150'>
<font color=#447700>!<a name='151'></font>
      INTEGER :: I,IEND,IER,IFE,IFS,IHH,IHL,IHRSTB,II,IRTN          &amp;<a name='152'>
     &amp;          ,ISIZ1,ISIZ2,ISTART,ISTAT,IX,J,J00,JFE,JFS,JHH,JJ       &amp;<a name='153'>
     &amp;          ,JM1,JM2,JM3,JP1,JP2,JP3,JX,KK                          &amp;<a name='154'>
     &amp;          ,K,K400,KBI,KBI2,KCCO2,KNT,KNTI                         &amp;<a name='155'>
     &amp;          ,LB,LRECBC,L                                            &amp;<a name='156'>
     &amp;          ,N,NMAP,NRADLH,NRADSH,NREC,NS,RECL,STAT                 &amp;<a name='157'>
     &amp;          ,STEPBL,STEPCU,STEPRA, KFE,KFS<a name='158'>
<font color=#447700>!<a name='159'></font>
      INTEGER :: MY_E,MY_N,MY_S,MY_W                                    &amp;<a name='160'>
     &amp;          ,MY_NE,MY_NW,MY_SE,MY_SW,MYI,MYJ,NPE<a name='161'>
<font color=#447700>!<a name='162'></font>
      INTEGER :: I_M<a name='163'>
<font color=#447700>!<a name='164'></font>
      INTEGER :: ILPAD2,IRPAD2,JBPAD2,JTPAD2<a name='165'>
      INTEGER :: ITS,ITE,JTS,JTE,KTS,KTE, nhki, nhkj<a name='166'>
<font color=#447700>!<a name='167'></font>
      INTEGER,DIMENSION(3) :: LPTOP<a name='168'>
<font color=#447700>!<a name='169'></font>
      REAL :: ADDL,APELM,APELMNW,APEM1,CAPA,CLOGES,DPLM,DZLM,EPS,ESE   &amp;<a name='170'>
     &amp;       ,FAC1,FAC2,PDIF,PLM,PM1,PSFCK,PSS,PSUM,QLM,RANG           &amp;<a name='171'>
     &amp;       ,SLPM,TERM1,THLM,TIME,TLM,TSFCK,ULM,VLM<a name='172'>
<font color=#447700>!<a name='173'></font>
<font color=#447700>!!!   REAL :: BLDT,CWML,EXNSFC,G_INV,PLYR,PSFC,ROG,SFCZ,THSIJ,TL<a name='174'></font>
      REAL :: CWML,EXNSFC,G_INV,PLYR,PSURF,ROG,SFCZ,THSIJ,TL<a name='175'>
      REAL :: TEND, TEMPDX,TEMPDY<a name='176'>
#if ( HWRF == 1 )<a name='177'>
<font color=#447700>! For calculating 10-m wind from lowest model level wind<a name='178'></font>
      INTEGER :: ITER<a name='179'>
      REAL :: windlmtmp,wind10tmp,wind10new,znotmtmp,znotttmp<a name='180'>
<font color=#447700>!zhang's doing <a name='181'></font>
      REAL :: TSTART<a name='182'>
<font color=#447700>!zhang's doing ends<a name='183'></font>
#endif<a name='184'>
#if ( HWRF == 1 )<a name='185'>
<font color=#447700>!     gopal's doing for the moving nest (MSLP computation)<a name='186'></font>
<font color=#447700>!-----------------------------------------------------------------------------------------------------<a name='187'></font>
      REAL, PARAMETER                                       :: LAPSR=6.5E-3, GI=1./G,D608=0.608<a name='188'>
      REAL, PARAMETER                                       :: COEF3=287.05*GI*LAPSR, COEF2=-1./COEF3<a name='189'>
      REAL, PARAMETER                                       :: TRG=2.0*R_D*GI,LAPSI=1.0/LAPSR<a name='190'>
      REAL                                                  :: RTOPP,APELP,DZ,SFCT,A<a name='191'>
<font color=#447700>!-----------------------------------------------------------------------------------------------------<a name='192'></font>
#endif<a name='193'>
<a name='194'>
<font color=#447700>!<a name='195'></font>
<font color=#447700>!!!   REAL,ALLOCATABLE,DIMENSION(:,:) :: RAINBL,RAINNC,RAINNC           &amp;<a name='196'></font>
      INTEGER,ALLOCATABLE,DIMENSION(:,:) :: ITEMP,LOWLYR<a name='197'>
      REAL,ALLOCATABLE,DIMENSION(:) :: SFULL,SMID<a name='198'>
      REAL,ALLOCATABLE,DIMENSION(:) :: DZS,ZS<a name='199'>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: RQCBLTEN,RQIBLTEN            &amp;<a name='200'>
     &amp;                                    ,RQVBLTEN,RTHBLTEN            &amp;<a name='201'>
     &amp;                                    ,RUBLTEN,RVBLTEN              &amp;<a name='202'>
     &amp;                                    ,RQCCUTEN,RQICUTEN,RQRCUTEN   &amp;<a name='203'>
     &amp;                                    ,RQSCUTEN,RQVCUTEN,RTHCUTEN   &amp;<a name='204'>
     &amp;                                    ,RUSHTEN,RVSHTEN              &amp;<a name='205'>
     &amp;                                    ,RQCSHTEN,RQISHTEN,RQRSHTEN   &amp;<a name='206'>
     &amp;                                    ,RQSSHTEN,RQVSHTEN,RTHSHTEN   &amp;<a name='207'>
     &amp;                                    ,RQGSHTEN                     &amp;<a name='208'>
     &amp;                                    ,RTHRATEN                     &amp;<a name='209'>
     &amp;                                    ,RTHRATENLW,RTHRATENSW<a name='210'>
      REAL,ALLOCATABLE,DIMENSION(:,:) :: EMISS,EMTEMP,GLW,HFX           &amp;<a name='211'>
     &amp;                                  ,NCA                            &amp;<a name='212'>
     &amp;                                  ,QFX,RAINBL,RAINC,RAINNC        &amp;<a name='213'>
     &amp;                                  ,RAINNCV                        &amp;<a name='214'>
     &amp;                                  ,SNOWNC,SNOWNCV                 &amp;<a name='215'>
     &amp;                                  ,GRAUPELNC,GRAUPELNCV           &amp;<a name='216'>
     &amp;                                  ,SNOWC,THC,TMN,TSFC<a name='217'>
<a name='218'>
      REAL,ALLOCATABLE,DIMENSION(:,:) :: Z0_DUM, ALBEDO_DUM<a name='219'>
<font color=#447700>!<a name='220'></font>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: ZINT,RRI,CONVFAC,ZMID<a name='221'>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: T_TRANS,PINT_TRANS<a name='222'>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: CLDFRA_TRANS<a name='223'>
      REAL,DIMENSION(:,:,:,:),ALLOCATABLE :: SCALAR_TRANS<a name='224'>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: CLDFRA_OLD<a name='225'>
<font color=#447700>!..Need to fill special height var for setting up initial condition.  G. Thompson<a name='226'></font>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: z_at_q<a name='227'>
<a name='228'>
#if 0<a name='229'>
      REAL,ALLOCATABLE,DIMENSION(:,:,:) :: w0avg<a name='230'>
#endif<a name='231'>
      LOGICAL :: E_BDY,N_BDY,S_BDY,W_BDY,WARM_RAIN,ADV_MOIST_COND<a name='232'>
      LOGICAL :: START_OF_SIMULATION<a name='233'>
      LOGICAL :: LRESTART, nestmove<a name='234'>
      LOGICAL :: ETAMP_Regional, ICE1_indx, ICE2_indx<a name='235'>
      LOGICAL :: IS_CAMMGMP_USED=.FALSE.<a name='236'>
<a name='237'>
<a name='238'>
      integer :: jam,retval<a name='239'>
      CHARACTER(LEN=255) :: message<a name='240'>
      integer myproc<a name='241'>
      real :: dsig,dsigsum,pdbot,pdtot,rpdtot<a name='242'>
      real :: fisx,ht,prodx,rg<a name='243'>
      integer :: i_t=096,j_t=195,n_t=11<a name='244'>
      integer :: i_u=49,j_u=475,n_u=07<a name='245'>
      integer :: i_v=49,j_v=475,n_v=07<a name='246'>
      integer :: num_aerosolc<a name='247'>
      real :: cen_lat,cen_lon,dtphs   <font color=#447700>! GWD<a name='248'></font>
      integer :: num_urban_layers,num_urban_hi<a name='249'>
<font color=#447700>!Rogers GMT<a name='250'></font>
      INTEGER :: hr, mn, sec, ms, rc<a name='251'>
      TYPE(WRFU_Time) :: currentTime<a name='252'>
<a name='253'>
      INTEGER :: interval_seconds, restart_interval<a name='254'>
<a name='255'>
#if ( HWRF == 1 )<a name='256'>
      REAL :: xshift,xfar,yfar,dfar,close2edge<a name='257'>
      REAL :: fedge,fmid,fdiff<a name='258'>
#endif<a name='259'>
<a name='260'>
<font color=#447700>! z0base new<a name='261'></font>
 <a name='262'>
      REAL,DIMENSION(0:30) :: VZ0TBL_24<a name='263'>
      VZ0TBL_24= (/0.,                                                 &amp;<a name='264'>
     &amp;            1.00,  0.07,  0.07,  0.07,  0.07,  0.15,             &amp;<a name='265'>
     &amp;            0.08,  0.03,  0.05,  0.86,  0.80,  0.85,             &amp;<a name='266'>
     &amp;            2.65,  1.09,  0.80,  0.001, 0.04,  0.05,             &amp;<a name='267'>
     &amp;            0.01,  0.04,  0.06,  0.05,  0.03,  0.001,            &amp;<a name='268'>
     &amp;            0.000, 0.000, 0.000, 0.000, 0.000, 0.000/)<a name='269'>
 <a name='270'>
<font color=#447700>! end z0base new<a name='271'></font>
<font color=#447700>!<a name='272'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='273'></font>
<font color=#447700>!#define COPY_IN<a name='274'></font>
<font color=#447700>!#include "scalar_derefs.inc"<a name='275'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='276'></font>
<font color=#447700>!**********************************************************************<a name='277'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='278'></font>
<font color=#447700>!<a name='279'></font>
<a name='280'>
      call <A href='../../html_code/frame/module_timing.F.html#START_TIMING'>start_timing</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="START_TIMING_3"><a name='281'>
<a name='282'>
#if ( HWRF == 1 )<a name='283'>
      call <A href='../../html_code/frame/module_clear_halos.F.html#CLEAR_IJ_HALOS'>clear_ij_halos</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CLEAR_IJ_HALOS_1">(grid,config_flags%halo_debug)<a name='284'>
      if(grid%id==3) then<a name='285'>
         grid%force_sst=1<a name='286'>
      else<a name='287'>
         grid%force_sst=2<a name='288'>
      endif<a name='289'>
#endif<a name='290'>
<a name='291'>
      CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>GET_IJK_FROM_GRID</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_27">(GRID,                                     &amp;<a name='292'>
     &amp;                       IDS,IDE,JDS,JDE,KDS,KDE,                  &amp;<a name='293'>
     &amp;                       IMS,IME,JMS,JME,KMS,KME,                  &amp;<a name='294'>
     &amp;                       IPS,IPE,JPS,JPE,KPS,KPE)<a name='295'>
<font color=#447700>!<a name='296'></font>
      ITS=IPS<a name='297'>
      ITE=IPE<a name='298'>
      JTS=JPS<a name='299'>
      JTE=JPE<a name='300'>
      KTS=KPS<a name='301'>
      KTE=KPE<a name='302'>
<a name='303'>
#if ( HWRF == 1 )<a name='304'>
      call <A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#GUESS_COUPLING_TIMESTEP'>guess_coupling_timestep</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GUESS_COUPLING_TIMESTEP_1">(grid%id,grid%guessdtc)<a name='305'>
      grid%dtc=0<a name='306'>
#endif<a name='307'>
<a name='308'>
      CALL <A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC'>model_to_grid_config_rec</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODEL_TO_GRID_CONFIG_REC_12">(grid%id,model_config_rec           &amp;<a name='309'>
     &amp;                             ,config_flags)<a name='310'>
<font color=#447700>!<a name='311'></font>
        RESTRT=config_flags%restart<a name='312'>
        ANAL=config_flags%analysis                <a name='313'>
        nestmove=RESTRT .and. .not. allowed_to_read<a name='314'>
<a name='315'>
#if ( HWRF == 1 )<a name='316'>
<font color=#447700>! Sam's doing for hour 0 &amp; 6 nest movement safeguards<a name='317'></font>
        grid%nomove_freq_hr=config_flags%nomove_freq<a name='318'>
#endif<a name='319'>
<a name='320'>
      <font color=#447700>! Recalculate grid bounds, regardless of reason for<a name='321'></font>
      <font color=#447700>! start_domain_nmm call, or version of NMM:<a name='322'></font>
      has_parent: if(grid%id /= 1) then <font color=#447700>! NOTE REQUIREMENT: MOAD IS GRID 1!!<a name='323'></font>
         <font color=#447700>! Nest gets dx &amp; dy from parent and grid ratio.<a name='324'></font>
3302     format('Grid ',I0,' calculating west/south bounds relative to parent grid ',I0)<a name='325'>
         write(message,3302) grid%id, grid%parents(1)%ptr%id<a name='326'>
         call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_136">(2,message)<a name='327'>
         tempdx=grid%parents(1)%ptr%dx/grid%parent_grid_ratio<a name='328'>
         tempdy=grid%parents(1)%ptr%dy/grid%parent_grid_ratio<a name='329'>
         grid%wbd0var = grid%parents(1)%ptr%wbd0var + (grid%i_parent_start-1)*2.*grid%parents(1)%ptr%dx + mod(grid%j_parent_start+1,2)*grid%parents(1)%ptr%dx<a name='330'>
         grid%sbd0var = grid%parents(1)%ptr%sbd0var + (grid%j_parent_start-1)*grid%parents(1)%ptr%dy<a name='331'>
3303     format('Parent wbd0=',F0.3,' sbd0=',F0.3,' i_parent_start=',I0,' j_parent_start=',I0)<a name='332'>
         write(message,3303) grid%parents(1)%ptr%wbd0var, &amp;<a name='333'>
              grid%parents(1)%ptr%sbd0var, grid%i_parent_start,grid%j_parent_start<a name='334'>
         call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_137">(2,message)<a name='335'>
      else<a name='336'>
         <font color=#447700>! MOAD gets dx &amp; dy from namelist.<a name='337'></font>
3305     format('Grid ',I0,' calculating west/south bounds as MOAD')<a name='338'>
         write(message,3305) grid%id<a name='339'>
         call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_138">(2,message)<a name='340'>
         call nl_get_dx(grid%id,tempdx)<a name='341'>
         call nl_get_dy(grid%id,tempdy)<a name='342'>
         grid%wbd0var = -(IDE-2)*tempdx<a name='343'>
         grid%sbd0var = -((JDE-1)/2)*tempdy<a name='344'>
#if <font color=#447700>! ( NMM_NEST == 1 )<a name='345'></font>
         <font color=#447700>! When NMM is compiled without nesting support, we need to<a name='346'></font>
         <font color=#447700>! update the bound metadata here:<a name='347'></font>
         grid%wbd0 = grid%wbd0var<a name='348'>
         grid%sbd0 = grid%sbd0var<a name='349'>
#endif<a name='350'>
      endif has_parent<a name='351'>
      if(tempdx&lt;1e-5 .or. tempdy&lt;1e-5) then<a name='352'>
         <font color=#447700>! Should never reach here unless someone adds a bug to NMM.<a name='353'></font>
         <font color=#447700>! The meaning of grid%dx varies during nest initialization<a name='354'></font>
         <font color=#447700>! (sometimes it is MOAD dx, sometimes nest dx), so this check<a name='355'></font>
         <font color=#447700>! is here just in case someone screws up the code later on.<a name='356'></font>
         write(message,1045) tempdx,tempdy<a name='357'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_245">('WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING ')<a name='358'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_246">('Warning: dx or dy are invalid after parent calculation or namelist check.')<a name='359'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_247">(message)<a name='360'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_248">('WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING WARNING ')<a name='361'>
1045     format('Must be &gt;1e-5.  dx=',F0.7,' dy=',F0.7,'.  Grid bounds will be wrong.')<a name='362'>
      endif<a name='363'>
      write(message,3011) grid%id,tempdx,tempdy,grid%wbd0var,grid%sbd0var<a name='364'>
      call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_139">(2,message)<a name='365'>
3011  format('Grid ',I0,': dx=',F0.3,' dy=',F0.3,' wbd0=',F0.3,' sbd0=',F0.3)<a name='366'>
#if 1<a name='367'>
      IF(IME&gt;NMM_MAX_DIM )THEN<a name='368'>
        WRITE(wrf_err_message,*)                                       &amp;<a name='369'>
         'start_domain_nmm ime (',ime,') &gt; ',NMM_MAX_DIM,    &amp;<a name='370'>
         '. Increase NMM_MAX_DIM in configure.wrf, clean, and recompile.'<a name='371'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_146">(wrf_err_message)<a name='372'>
      ENDIF<a name='373'>
<font color=#447700>!<a name='374'></font>
      IF(JME&gt;NMM_MAX_DIM )THEN<a name='375'>
        WRITE(wrf_err_message,*)                                       &amp;<a name='376'>
         'start_domain_nmm jme (',jme,') &gt; ',NMM_MAX_DIM,    &amp;<a name='377'>
         '. Increase NMM_MAX_DIM in configure.wrf, clean, and recompile.'<a name='378'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_147">(wrf_err_message)<a name='379'>
      ENDIF<a name='380'>
#else<a name='381'>
      IF(IMS&gt;-2.OR.IME&gt;NMM_MAX_DIM )THEN<a name='382'>
        WRITE(wrf_err_message,*)                                       &amp;<a name='383'>
         'start_domain_nmm ims(',ims,' &gt; -2 or ime (',ime,') &gt; ',NMM_MAX_DIM,    &amp;<a name='384'>
         '. Increase NMM_MAX_DIM in configure.wrf, clean, and recompile.'<a name='385'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_148">(wrf_err_message)<a name='386'>
      ENDIF<a name='387'>
<font color=#447700>!<a name='388'></font>
      IF(JMS&gt;-2.OR.JME&gt;NMM_MAX_DIM )THEN<a name='389'>
        WRITE(wrf_err_message,*)                                       &amp;<a name='390'>
         'start_domain_nmm jms(',jms,' &gt; -2 or jme (',jme,') &gt; ',NMM_MAX_DIM,    &amp;<a name='391'>
         '. Increase NMM_MAX_DIM in configure.wrf, clean, and recompile.'<a name='392'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_149">(wrf_err_message)<a name='393'>
      ENDIF<a name='394'>
#endif<a name='395'>
<font color=#447700>!<a name='396'></font>
<font color=#447700>!---------------------------------------------------------------------- <a name='397'></font>
<font color=#447700>!<a name='398'></font>
      WRITE(message,196)IHRST,IDAT<a name='399'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_249">(trim(message))<a name='400'>
  196 FORMAT(' FORECAST BEGINS ',I2,' GMT ',2(I2,'/'),I4)<a name='401'>
<a name='402'>
<a name='403'>
<font color=#447700>!!    Restarts must be made from times for which boundary data is available<a name='404'></font>
<a name='405'>
      CALL nl_get_interval_seconds(GRID%ID, interval_seconds)<a name='406'>
      CALL nl_get_restart_interval(GRID%ID, restart_interval)<a name='407'>
      IF (MOD(restart_interval*60,interval_seconds) /= 0) THEN<a name='408'>
         WRITE(wrf_err_message,*)' restart_interval is not integer multiplier of interval_seconds'<a name='409'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_150">(wrf_err_message)<a name='410'>
      END IF<a name='411'>
<a name='412'>
<font color=#447700>!!!!!!tlb<a name='413'></font>
<font color=#447700>!!!! For now, set NPES to 1<a name='414'></font>
      NPES=1<a name='415'>
<font color=#447700>!!!!!!tlb<a name='416'></font>
      MY_IS_GLB=IPS<a name='417'>
      MY_IE_GLB=IPE-1<a name='418'>
      MY_JS_GLB=JPS<a name='419'>
      MY_JE_GLB=JPE-1<a name='420'>
<font color=#447700>!<a name='421'></font>
      IM=IPE-1<a name='422'>
      JM=JPE-1<a name='423'>
<font color=#447700>!!!!!!!!!<a name='424'></font>
<font color=#447700>!! All "my" variables defined below have had the IDE or JDE specification<a name='425'></font>
<font color=#447700>!! reduced by 1<a name='426'></font>
<font color=#447700>!!!!!!!!!!!<a name='427'></font>
<a name='428'>
      MYIS=MAX(IDS,IPS)<a name='429'>
      MYIE=MIN(IDE-1,IPE)<a name='430'>
      MYJS=MAX(JDS,JPS)<a name='431'>
      MYJE=MIN(JDE-1,JPE)<a name='432'>
<a name='433'>
      MYIS1  =MAX(IDS+1,IPS)<a name='434'>
      MYIE1  =MIN(IDE-2,IPE)<a name='435'>
      MYJS2  =MAX(JDS+2,JPS)<a name='436'>
      MYJE2  =MIN(JDE-3,JPE)<a name='437'>
<font color=#447700>!<a name='438'></font>
      MYIS_P1=MAX(IDS,IPS-1)<a name='439'>
      MYIE_P1=MIN(IDE-1,IPE+1)<a name='440'>
      MYIS_P2=MAX(IDS,IPS-2)<a name='441'>
      MYIE_P2=MIN(IDE-1,IPE+2)<a name='442'>
      MYIS_P3=MAX(IDS,IPS-3)<a name='443'>
      MYIE_P3=MIN(IDE-1,IPE+3)<a name='444'>
      MYJS_P3=MAX(JDS,JPS-3)<a name='445'>
      MYJE_P3=MIN(JDE-1,JPE+3)<a name='446'>
      MYIS_P4=MAX(IDS,IPS-4)<a name='447'>
      MYIE_P4=MIN(IDE-1,IPE+4)<a name='448'>
      MYJS_P4=MAX(JDS,JPS-4)<a name='449'>
      MYJE_P4=MIN(JDE-1,JPE+4)<a name='450'>
      MYIS_P5=MAX(IDS,IPS-5)<a name='451'>
      MYIE_P5=MIN(IDE-1,IPE+5)<a name='452'>
      MYJS_P5=MAX(JDS,JPS-5)<a name='453'>
      MYJE_P5=MIN(JDE-1,JPE+5)<a name='454'>
<font color=#447700>!<a name='455'></font>
      MYIS1_P1=MAX(IDS+1,IPS-1)<a name='456'>
      MYIE1_P1=MIN(IDE-2,IPE+1)<a name='457'>
      MYIS1_P2=MAX(IDS+1,IPS-2)<a name='458'>
      MYIE1_P2=MIN(IDE-2,IPE+2)<a name='459'>
<font color=#447700>!<a name='460'></font>
      MYJS1_P1=MAX(JDS+1,JPS-1)<a name='461'>
      MYJS2_P1=MAX(JDS+2,JPS-1)<a name='462'>
      MYJE1_P1=MIN(JDE-2,JPE+1)<a name='463'>
      MYJE2_P1=MIN(JDE-3,JPE+1)<a name='464'>
      MYJS1_P2=MAX(JDS+1,JPS-2)<a name='465'>
      MYJE1_P2=MIN(JDE-2,JPE+2)<a name='466'>
      MYJS2_P2=MAX(JDS+2,JPS-2)<a name='467'>
      MYJE2_P2=MIN(JDE-3,JPE+2)<a name='468'>
      MYJS1_P3=MAX(JDS+1,JPS-3)<a name='469'>
      MYJE1_P3=MIN(JDE-2,JPE+3)<a name='470'>
      MYJS2_P3=MAX(JDS+2,JPS-3)<a name='471'>
      MYJE2_P3=MIN(JDE-3,JPE+3)<a name='472'>
<font color=#447700>!!!!!!!!!!!<a name='473'></font>
<font color=#447700>!<a name='474'></font>
#ifdef DM_PARALLEL<a name='475'>
<a name='476'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>WRF_GET_MYPROC</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_10">(MYPROC)<a name='477'>
      MYPE=MYPROC<a name='478'>
<a name='479'>
<font color=#447700>!<a name='480'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='481'></font>
<font color=#447700>!***  Let each task determine who its eight neighbors are because we<a name='482'></font>
<font color=#447700>!***  will need to know that for the halo exchanges.  The direction<a name='483'></font>
<font color=#447700>!***  to each neighbor will be designated by the following integers:<a name='484'></font>
<font color=#447700>!<a name='485'></font>
<font color=#447700>!***      north: 1<a name='486'></font>
<font color=#447700>!***       east: 2<a name='487'></font>
<font color=#447700>!***      south: 3<a name='488'></font>
<font color=#447700>!***       west: 4<a name='489'></font>
<font color=#447700>!***  northeast: 5<a name='490'></font>
<font color=#447700>!***  southeast: 6<a name='491'></font>
<font color=#447700>!***  southwest: 7<a name='492'></font>
<font color=#447700>!***  northwest: 8<a name='493'></font>
<font color=#447700>!<a name='494'></font>
<font color=#447700>!***  If a task has no neighbor in a particular direction because of<a name='495'></font>
<font color=#447700>!***  the presence of the global domain boundary then that element<a name='496'></font>
<font color=#447700>!***  of my_neb is set to -1.<a name='497'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='498'></font>
<font color=#447700>!<a name='499'></font>
      call <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROCX'>wrf_get_nprocx</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROCX_1">(inpes)<a name='500'>
      call <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROCY'>wrf_get_nprocy</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROCY_1">(jnpes)<a name='501'>
<font color=#447700>!<a name='502'></font>
      allocate(itemp(inpes,jnpes),stat=istat)<a name='503'>
      npe=0<a name='504'>
<font color=#447700>!<a name='505'></font>
      do j=1,jnpes<a name='506'>
      do i=1,inpes<a name='507'>
        itemp(i,j)=npe<a name='508'>
        if(npe==mype)then<a name='509'>
          myi=i<a name='510'>
          myj=j<a name='511'>
        endif<a name='512'>
        npe=npe+1<a name='513'>
      enddo<a name='514'>
      enddo<a name='515'>
<font color=#447700>!<a name='516'></font>
      my_n=-1<a name='517'>
      if(myj+1&lt;=jnpes)my_n=itemp(myi,myj+1)<a name='518'>
<font color=#447700>!<a name='519'></font>
      my_e=-1<a name='520'>
      if(myi+1&lt;=inpes)my_e=itemp(myi+1,myj)<a name='521'>
<font color=#447700>!<a name='522'></font>
      my_s=-1<a name='523'>
      if(myj-1&gt;=1)my_s=itemp(myi,myj-1)<a name='524'>
<font color=#447700>!<a name='525'></font>
      my_w=-1<a name='526'>
      if(myi-1&gt;=1)my_w=itemp(myi-1,myj)<a name='527'>
<font color=#447700>!<a name='528'></font>
      my_ne=-1<a name='529'>
      if((myi+1&lt;=inpes).and.(myj+1&lt;=jnpes)) &amp;<a name='530'>
         my_ne=itemp(myi+1,myj+1)<a name='531'>
<font color=#447700>!<a name='532'></font>
      my_se=-1<a name='533'>
      if((myi+1&lt;=inpes).and.(myj-1&gt;=1)) &amp;<a name='534'>
         my_se=itemp(myi+1,myj-1)<a name='535'>
<font color=#447700>!<a name='536'></font>
      my_sw=-1<a name='537'>
      if((myi-1&gt;=1).and.(myj-1&gt;=1)) &amp;<a name='538'>
         my_sw=itemp(myi-1,myj-1)<a name='539'>
<font color=#447700>!<a name='540'></font>
      my_nw=-1<a name='541'>
      if((myi-1&gt;=1).and.(myj+1&lt;=jnpes)) &amp;<a name='542'>
         my_nw=itemp(myi-1,myj+1)<a name='543'>
<font color=#447700>!<a name='544'></font>
<font color=#447700>!     my_neb(1)=my_n<a name='545'></font>
<font color=#447700>!     my_neb(2)=my_e<a name='546'></font>
<font color=#447700>!     my_neb(3)=my_s<a name='547'></font>
<font color=#447700>!     my_neb(4)=my_w<a name='548'></font>
<font color=#447700>!     my_neb(5)=my_ne<a name='549'></font>
<font color=#447700>!     my_neb(6)=my_se<a name='550'></font>
<font color=#447700>!     my_neb(7)=my_sw<a name='551'></font>
<font color=#447700>!     my_neb(8)=my_nw<a name='552'></font>
<font color=#447700>!<a name='553'></font>
      deallocate(itemp)<a name='554'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_1.inc.html'>HALO_NMM_INIT_1.inc</A>"<A NAME="HALO_NMM_INIT_1.inc_3"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='555'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_2.inc.html'>HALO_NMM_INIT_2.inc</A>"<A NAME="HALO_NMM_INIT_2.inc_4"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='556'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_3.inc.html'>HALO_NMM_INIT_3.inc</A>"<A NAME="HALO_NMM_INIT_3.inc_5"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='557'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_4.inc.html'>HALO_NMM_INIT_4.inc</A>"<A NAME="HALO_NMM_INIT_4.inc_6"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='558'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_5.inc.html'>HALO_NMM_INIT_5.inc</A>"<A NAME="HALO_NMM_INIT_5.inc_7"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='559'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_6.inc.html'>HALO_NMM_INIT_6.inc</A>"<A NAME="HALO_NMM_INIT_6.inc_8"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='560'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_7.inc.html'>HALO_NMM_INIT_7.inc</A>"<A NAME="HALO_NMM_INIT_7.inc_9"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='561'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_8.inc.html'>HALO_NMM_INIT_8.inc</A>"<A NAME="HALO_NMM_INIT_8.inc_10"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='562'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_9.inc.html'>HALO_NMM_INIT_9.inc</A>"<A NAME="HALO_NMM_INIT_9.inc_11"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='563'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_10.inc.html'>HALO_NMM_INIT_10.inc</A>"<A NAME="HALO_NMM_INIT_10.inc_12"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='564'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_11.inc.html'>HALO_NMM_INIT_11.inc</A>"<A NAME="HALO_NMM_INIT_11.inc_13"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='565'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_12.inc.html'>HALO_NMM_INIT_12.inc</A>"<A NAME="HALO_NMM_INIT_12.inc_14"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='566'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_13.inc.html'>HALO_NMM_INIT_13.inc</A>"<A NAME="HALO_NMM_INIT_13.inc_15"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='567'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_14.inc.html'>HALO_NMM_INIT_14.inc</A>"<A NAME="HALO_NMM_INIT_14.inc_16"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='568'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_15.inc.html'>HALO_NMM_INIT_15.inc</A>"<A NAME="HALO_NMM_INIT_15.inc_17"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='569'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_16.inc.html'>HALO_NMM_INIT_16.inc</A>"<A NAME="HALO_NMM_INIT_16.inc_18"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='570'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_17.inc.html'>HALO_NMM_INIT_17.inc</A>"<A NAME="HALO_NMM_INIT_17.inc_19"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='571'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_18.inc.html'>HALO_NMM_INIT_18.inc</A>"<A NAME="HALO_NMM_INIT_18.inc_20"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='572'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_19.inc.html'>HALO_NMM_INIT_19.inc</A>"<A NAME="HALO_NMM_INIT_19.inc_21"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='573'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_20.inc.html'>HALO_NMM_INIT_20.inc</A>"<A NAME="HALO_NMM_INIT_20.inc_22"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='574'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_21.inc.html'>HALO_NMM_INIT_21.inc</A>"<A NAME="HALO_NMM_INIT_21.inc_23"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='575'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_22.inc.html'>HALO_NMM_INIT_22.inc</A>"<A NAME="HALO_NMM_INIT_22.inc_24"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='576'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_23.inc.html'>HALO_NMM_INIT_23.inc</A>"<A NAME="HALO_NMM_INIT_23.inc_25"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='577'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_24.inc.html'>HALO_NMM_INIT_24.inc</A>"<A NAME="HALO_NMM_INIT_24.inc_26"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='578'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_25.inc.html'>HALO_NMM_INIT_25.inc</A>"<A NAME="HALO_NMM_INIT_25.inc_27"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='579'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_26.inc.html'>HALO_NMM_INIT_26.inc</A>"<A NAME="HALO_NMM_INIT_26.inc_28"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='580'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_27.inc.html'>HALO_NMM_INIT_27.inc</A>"<A NAME="HALO_NMM_INIT_27.inc_29"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='581'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_28.inc.html'>HALO_NMM_INIT_28.inc</A>"<A NAME="HALO_NMM_INIT_28.inc_30"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='582'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_29.inc.html'>HALO_NMM_INIT_29.inc</A>"<A NAME="HALO_NMM_INIT_29.inc_31"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='583'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_30.inc.html'>HALO_NMM_INIT_30.inc</A>"<A NAME="HALO_NMM_INIT_30.inc_32"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='584'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_31.inc.html'>HALO_NMM_INIT_31.inc</A>"<A NAME="HALO_NMM_INIT_31.inc_33"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='585'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_32.inc.html'>HALO_NMM_INIT_32.inc</A>"<A NAME="HALO_NMM_INIT_32.inc_34"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='586'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_33.inc.html'>HALO_NMM_INIT_33.inc</A>"<A NAME="HALO_NMM_INIT_33.inc_35"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='587'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_34.inc.html'>HALO_NMM_INIT_34.inc</A>"<A NAME="HALO_NMM_INIT_34.inc_36"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='588'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_35.inc.html'>HALO_NMM_INIT_35.inc</A>"<A NAME="HALO_NMM_INIT_35.inc_37"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='589'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_36.inc.html'>HALO_NMM_INIT_36.inc</A>"<A NAME="HALO_NMM_INIT_36.inc_38"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='590'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_37.inc.html'>HALO_NMM_INIT_37.inc</A>"<A NAME="HALO_NMM_INIT_37.inc_39"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='591'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_38.inc.html'>HALO_NMM_INIT_38.inc</A>"<A NAME="HALO_NMM_INIT_38.inc_40"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='592'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_39.inc.html'>HALO_NMM_INIT_39.inc</A>"<A NAME="HALO_NMM_INIT_39.inc_41"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='593'>
#endif<a name='594'>
<font color=#447700>!<a name='595'></font>
      if((allowed_to_read .and. .not. restrt) .or. anal) then<a name='596'>
         call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_250">("Fill REFL_10CM with -35 dBZ")<a name='597'>
         if(size(grid%refl_10cm,1)*size(grid%refl_10cm,3)&gt;1) then<a name='598'>
            do J=JPS,JPE<a name='599'>
               do K=KPS,KPE<a name='600'>
                  do I=IPS,IPE<a name='601'>
                     grid%refl_10cm(i,k,j)=-35.0<a name='602'>
                  enddo<a name='603'>
               enddo<a name='604'>
               do I=IPS,IPE<a name='605'>
                  grid%refd_max(i,j)=-35.0<a name='606'>
               enddo<a name='607'>
            enddo<a name='608'>
         endif<a name='609'>
      endif<a name='610'>
         <a name='611'>
      DO J=MYJS_P4,MYJE_P4<a name='612'>
        grid%iheg(J)=MOD(J+1,2)<a name='613'>
        grid%ihwg(J)=grid%iheg(J)-1<a name='614'>
        grid%iveg(J)=MOD(J,2)<a name='615'>
        grid%ivwg(J)=grid%iveg(J)-1<a name='616'>
      ENDDO<a name='617'>
<font color=#447700>!<a name='618'></font>
      DO J=MYJS_P4,MYJE_P4<a name='619'>
        grid%ivw(J)=grid%ivwg(J)<a name='620'>
        grid%ive(J)=grid%iveg(J)<a name='621'>
        grid%ihe(J)=grid%iheg(J)<a name='622'>
        grid%ihw(J)=grid%ihwg(J)<a name='623'>
      ENDDO<a name='624'>
<font color=#447700>!<a name='625'></font>
      CAPA=R_D/CP<a name='626'>
      LM=KPE-KPS+1<a name='627'>
<font color=#447700>!<a name='628'></font>
      IFS=IPS<a name='629'>
      JFS=JPS<a name='630'>
      KFS=KPS<a name='631'>
      JFE=MIN(JPE,JDE-1)<a name='632'>
      IFE=MIN(IPE,IDE-1)<a name='633'>
      KFE=MIN(KPE,KDE-1)<a name='634'>
<a name='635'>
      if((allowed_to_read.and..not.(restrt)) .or. .not.allowed_to_read) then<a name='636'>
         randif: IF(in_use_for_config(grid%id,'random'))THEN<a name='637'>
            <font color=#447700>! Reset random number generator at first initialization,<a name='638'></font>
            <font color=#447700>! or after a nest move.  (Need to reset after a nest move<a name='639'></font>
            <font color=#447700>! or the leading edge will be filled with 3x3 areas with<a name='640'></font>
            <font color=#447700>! the same random number generator state.)<a name='641'></font>
            random_seed=config_flags%random_seed + grid%ntsd<a name='642'>
            <a name='643'>
            write(message,'(A,I0,A,I0)') 'Resetting random number for domain ',grid%id,' with seed ',random_seed<a name='644'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_251">(message)<a name='645'>
            one=1<a name='646'>
            call <A href='../../html_code/share/module_random.F.html#SRAND_GRID'>srand_grid</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SRAND_GRID_1">(grid%randstate1,grid%randstate2, &amp;<a name='647'>
                            grid%randstate3,grid%randstate4, &amp;<a name='648'>
                            IDS,IDE,JDS,JDE,one,one, &amp;<a name='649'>
                            IMS,IME,JMS,JME,one,one, &amp;<a name='650'>
                            IPS,IPE,JPS,JPE,one,one,random_seed)<a name='651'>
            call <A href='../../html_code/share/module_random.F.html#RAND_GRID_R4'>rand_grid_r4</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RAND_GRID_R4_2">(grid%randstate1,grid%randstate2, &amp;<a name='652'>
                              grid%randstate3,grid%randstate4, &amp;<a name='653'>
                              grid%random, &amp;<a name='654'>
                              IDS,IDE,JDS,JDE,one,one, &amp;<a name='655'>
                              IMS,IME,JMS,JME,one,one, &amp;<a name='656'>
                              IPS,IPE,JPS,JPE,one,one)<a name='657'>
         else<a name='658'>
            grid%random = 0.0<a name='659'>
         endif randif<a name='660'>
      endif<a name='661'>
<font color=#447700>! Begin HWRF update for high-frequency output<a name='662'></font>
#if ( HWRF == 1 )<a name='663'>
      if(allowed_to_read .and. config_flags%high_freq) then<a name='664'>
        if(grid%id==config_flags%high_dom) then<a name='665'>
           <font color=#447700>! Open HTCF LUN:<a name='666'></font>
           call <A href='../../html_code/dyn_nmm/module_HIFREQ.F.html#HIFREQ_OPEN'>HIFREQ_OPEN</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HIFREQ_OPEN_1">(grid,config_flags)<a name='667'>
           <font color=#447700>! Open per-nest-move ATCF LUN:<a name='668'></font>
           call <A href='../../html_code/dyn_nmm/module_HIFREQ.F.html#HIFREQ_OPEN'>HIFREQ_OPEN</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HIFREQ_OPEN_2">(grid,config_flags,atcf=.true.)<a name='669'>
        elseif(config_flags%high_dom==-99) then<a name='670'>
          nestless=.true.<a name='671'>
           CALL nl_get_max_dom( 1, max_dom )<a name='672'>
           nestdo: do nestid=2,max_dom<a name='673'>
              call nl_get_grid_allowed(nestid,grid_allowed)<a name='674'>
              if(grid_allowed) then<a name='675'>
                 call nl_get_parent_id(nestid,parent_id)<a name='676'>
                 if(parent_id==grid%id) then<a name='677'>
                    write(message,'("Domain ",I0," does not have hifreq out (can have a child).")') grid%id<a name='678'>
                    nestless=.false.<a name='679'>
                    exit nestdo<a name='680'>
                 endif<a name='681'>
              endif<a name='682'>
           enddo nestdo<a name='683'>
           if(nestless) then<a name='684'>
              <font color=#447700>! Open HTCF LUN:<a name='685'></font>
               call <A href='../../html_code/dyn_nmm/module_HIFREQ.F.html#HIFREQ_OPEN'>HIFREQ_OPEN</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HIFREQ_OPEN_3">(grid,config_flags)<a name='686'>
              <font color=#447700>! Open per-nest-move ATCF LUN:<a name='687'></font>
              call <A href='../../html_code/dyn_nmm/module_HIFREQ.F.html#HIFREQ_OPEN'>HIFREQ_OPEN</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="HIFREQ_OPEN_4">(grid,config_flags,atcf=.true.)<a name='688'>
           endif<a name='689'>
        else<a name='690'>
           write(message,'("Domain ",I0," does not have hifreq out.")') grid%id<a name='691'>
        endif<a name='692'>
      else<a name='693'>
          write(message,'("Domain ",I0," is not being initialized.")') grid%id<a name='694'>
      endif<a name='695'>
<font color=#447700>! end of high-freq output<a name='696'></font>
#endif<a name='697'>
<a name='698'>
<font color=#447700>! Begin Sam Trahan's doing for Tornado Genesis (SPC) products<a name='699'></font>
      if(anal .or. (allowed_to_read .and. .not. restrt)) then<a name='700'>
         call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS'>init_tornado_genesis</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_TORNADO_GENESIS_1">(grid,config_flags)<a name='701'>
      endif<a name='702'>
<font color=#447700>! End Sam Trahan's doing for Tornado Genesis (SPC) products<a name='703'></font>
<a name='704'>
#if ( HWRF == 1 )<a name='705'>
<font color=#447700>! Begin Sam Trahan's doing for vortex tracker initialization<a name='706'></font>
    IF ( program_name(1:8) .NE. "REAL_NMM" ) THEN<a name='707'>
         call <A href='../../html_code/dyn_nmm/module_STATS_FOR_MOVE.F.html#VORTTRAK_INIT'>VORTTRAK_INIT</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="VORTTRAK_INIT_1">(grid,config_flags,       &amp;<a name='708'>
                            (allowed_to_read .and. .not. restrt), &amp;<a name='709'>
                            IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='710'>
                            IMS,IME,JMS,JME,KMS,KME, &amp;<a name='711'>
                            ITS,ITE,JTS,JTE,KTS,KTE)<a name='712'>
         call <A href='../../html_code/dyn_nmm/module_swath.F.html#INIT_SWATH'>init_swath</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_SWATH_1">(grid, config_flags, &amp;<a name='713'>
              (allowed_to_read .and. .not. restrt),&amp;<a name='714'>
              allowed_to_read)<a name='715'>
    ENDIF<a name='716'>
    IF(ANAL .or. allowed_to_read) THEN<a name='717'>
       call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_140">(1,'Request update to area of interest in start_domain_nmm.')<a name='718'>
       grid%update_interest=.true.<a name='719'>
    ENDIF<a name='720'>
<font color=#447700>! End Sam Trahan's doing for vortex tracker initialization<a name='721'></font>
#endif<a name='722'>
#if ( HWRF == 1 )<a name='723'>
<font color=#447700>! Begin Sam Trahan's change to merge two log messages for WRF_NMM<a name='724'></font>
    IF(allowed_to_read .and. .not. restrt) THEN<a name='725'>
       grid%avgPchg=0<a name='726'>
    ENDIF<a name='727'>
<font color=#447700>! End Sam Trahan's change to merge two log messages for WRF_NMM<a name='728'></font>
<a name='729'>
<font color=#447700>!zhang's doing<a name='730'></font>
  IF((.NOT.RESTRT .AND. .NOT.ANAL) .OR. .NOT.allowed_to_read)THEN<a name='731'>
<font color=#447700>!end of zhang's doing<a name='732'></font>
#else<a name='733'>
      IF(.NOT.RESTRT)THEN<a name='734'>
#endif<a name='735'>
        DO J=JFS,JFE<a name='736'>
        DO I=IFS,IFE<a name='737'>
          grid%pdsl(I,J)  =grid%pd(I,J)*grid%res(I,J)<a name='738'>
          grid%prec(I,J)  =0.<a name='739'>
          IF(allowed_to_read)grid%acprec(I,J)=0.  <font color=#447700>! This is gopal's inclusion for moving nest<a name='740'></font>
          grid%cuprec(I,J)=0.<a name='741'>
          rg=1./g<a name='742'>
          ht=grid%fis(i,j)*rg<a name='743'>
<font color=#447700>!!!       fisx=ht*g<a name='744'></font>
<font color=#447700>!          fisx=max(grid%fis(i,j),0.)<a name='745'></font>
<font color=#447700>!          prodx=grid%z0(I,J)*Z0MAX<a name='746'></font>
<font color=#447700>!          grid%z0(I,J)    =grid%sm(I,J)*Z0SEA+(1.-grid%sm(I,J))*                      &amp;<a name='747'></font>
<font color=#447700>!     &amp;                (grid%z0(I,J)*Z0MAX+FISx    *FCM+Z0LAND)<a name='748'></font>
<font color=#447700>!!!  &amp;                (prodx        +FISx    *FCM+Z0LAND)<a name='749'></font>
          grid%qsh(I,J)   =0.<a name='750'>
          grid%akms(I,J)  =0.<a name='751'>
          grid%akhs(I,J)  =0.<a name='752'>
          grid%twbs(I,J)  =0.<a name='753'>
          grid%qwbs(I,J)  =0.<a name='754'>
          IF(allowed_to_read)THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='755'></font>
          grid%cldefi(I,J)=1.<a name='756'>
          grid%htop(I,J)  =REAL(KTS)<a name='757'>
          grid%htopd(I,J) =REAL(KTS)<a name='758'>
          grid%htops(I,J) =REAL(KTS)<a name='759'>
          grid%hbot(I,J)  =REAL(KTE)<a name='760'>
          grid%hbotd(I,J) =REAL(KTE)<a name='761'>
          grid%hbots(I,J) =REAL(KTE)<a name='762'>
          ENDIF<a name='763'>
<font color=#447700>!***<a name='764'></font>
<font color=#447700>!***  AT THIS POINT, WE MUST CALCULATE THE INITIAL POTENTIAL TEMPERATURE<a name='765'></font>
<font color=#447700>!***  OF THE SURFACE AND OF THE SUBGROUND.<a name='766'></font>
<font color=#447700>!***  EXTRAPOLATE DOWN FOR INITIAL SURFACE POTENTIAL TEMPERATURE.<a name='767'></font>
<font color=#447700>!***  ALSO DO THE SHELTER PRESSURE.<a name='768'></font>
<font color=#447700>!***<a name='769'></font>
<font color=#447700>!<a name='770'></font>
<font color=#447700>!***  BECAUSE WE REINITIALIZE TOPOGRAPHY, LAND SEA MASK AND FIND THE TEMPERATURE<a name='771'></font>
<font color=#447700>!***  FIELD OVER THE NEW TOPOGRAPHY, AFTER THE MOVE, I THINK IT MORE APPROPRIATE<a name='772'></font>
<font color=#447700>!***  TO USE grid%nmm_tsk OR grid%sst TO RE-DERIVE grid%ths AND QS (AND CONSEQUENTLY grid%thz0 AND grid%qz0).<a name='773'></font>
<font color=#447700>!***  THIS MAY BE MORE CONSISTENT WITH THE PSEUDO-HYDROSTATIC BALANCING THAT IS<a name='774'></font>
<font color=#447700>!***  DONE OVER THE NEW TERRAIN (AND WITH NEW grid%sm). gopal!<a name='775'></font>
<font color=#447700>!***<a name='776'></font>
<font color=#447700>!***<a name='777'></font>
<a name='778'>
      IF(allowed_to_read)THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='779'></font>
<a name='780'>
          PM1=grid%aeta1(KTS)*grid%pdtop+grid%aeta2(KTS)*grid%pdsl(I,J)+grid%pt<a name='781'>
          APEM1=(1.E5/PM1)**CAPA<a name='782'>
<a name='783'>
        IF(grid%nmm_tsk(I,J)&gt;=200.)THEN         <font color=#447700>! have a specific skin temp, use it<a name='784'></font>
#if ( HWRF == 1 )<a name='785'>
          grid%ths(I,J)=grid%nmm_tsk(I,J)*(1.+P608*grid%q(I,J,KTS+1))*APEM1<a name='786'>
          TSFCK=grid%nmm_tsk(I,J)*(1.+P608*grid%q(I,J,KTS+1))<a name='787'>
#else<a name='788'>
          grid%ths(I,J)=grid%nmm_tsk(I,J)*APEM1<a name='789'>
          TSFCK=grid%nmm_tsk(I,J)<a name='790'>
#endif<a name='791'>
<a name='792'>
	ELSE                               <font color=#447700>! use lowest layer as a proxy<a name='793'></font>
#if ( HWRF == 1 )<a name='794'>
          grid%ths(I,J)=grid%t(I,J,KTS)*(1.+P608*grid%q(I,J,KTS+1))*APEM1<a name='795'>
          TSFCK=grid%t(I,J,KTS)*(1.+P608*grid%q(I,J,KTS+1))<a name='796'>
#else<a name='797'>
          grid%ths(I,J)=grid%t(I,J,KTS)*APEM1<a name='798'>
          TSFCK=grid%t(I,J,KTS)<a name='799'>
#endif<a name='800'>
	ENDIF<a name='801'>
<a name='802'>
          PSFCK=grid%pd(I,J)+grid%pdtop+grid%pt<a name='803'>
<font color=#447700>!<a name='804'></font>
          IF(grid%sm(I,J)&lt;0.5) THEN<a name='805'>
            grid%qsh(I,J)=PQ0/PSFCK*EXP(A2*(TSFCK-A3)/(TSFCK-A4))<a name='806'>
          ELSEIF(grid%sm(I,J)&gt;0.5) THEN<a name='807'>
            grid%ths(I,J)=grid%sst(I,J)*(1.E5/(grid%pd(I,J)+grid%pdtop+grid%pt))**CAPA<a name='808'>
          ENDIF<a name='809'>
<font color=#447700>!<a name='810'></font>
          TERM1=-0.068283/grid%t(I,J,KTS)<a name='811'>
          grid%pshltr(I,J)=(grid%pd(I,J)+grid%pdtop+grid%pt)*EXP(TERM1)<a name='812'>
<font color=#447700>!<a name='813'></font>
          grid%ustar(I,J)=0.1<a name='814'>
          grid%thz0(I,J)=grid%ths(I,J)<a name='815'>
          grid%qz0(I,J)=grid%qsh(I,J)<a name='816'>
          grid%uz0(I,J)=0.<a name='817'>
          grid%vz0(I,J)=0.<a name='818'>
<a name='819'>
      ENDIF  <font color=#447700>! endif for allowed to read<a name='820'></font>
<font color=#447700>! <a name='821'></font>
        ENDDO<a name='822'>
        ENDDO<a name='823'>
<a name='824'>
<font color=#447700>!***<a name='825'></font>
<font color=#447700>!***  INITIALIZE CLOUD FIELDS<a name='826'></font>
<font color=#447700>!***<a name='827'></font>
      IF (MAXVAL(grid%cwm(ips:ipe,jps:jpe,:)) .gt. 0. .and. MAXVAL(grid%cwm(ips:ipe,jps:jpe,:)) .lt. 1.) then<a name='828'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_252">('appear to have grid%cwm values...do not zero')<a name='829'>
      ELSE<a name='830'>
        IF(allowed_to_read)THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='831'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_253">('zeroing grid%cwm')<a name='832'>
        DO K=KPS,KPE<a name='833'>
          DO J=JFS,JFE<a name='834'>
          DO I=IFS,IFE<a name='835'>
            grid%cwm(I,J,K)=0.<a name='836'>
          ENDDO<a name='837'>
          ENDDO<a name='838'>
        ENDDO<a name='839'>
        ENDIF<a name='840'>
      ENDIF<a name='841'>
<font color=#447700>!***<a name='842'></font>
<font color=#447700>!***  INITIALIZE ACCUMULATOR ARRAYS TO ZERO.<a name='843'></font>
<font color=#447700>!***<a name='844'></font>
        grid%ardsw=0.0<a name='845'>
        grid%ardlw=0.0<a name='846'>
        grid%asrfc=0.0<a name='847'>
        grid%avrain=0.0<a name='848'>
        grid%avcnvc=0.0<a name='849'>
<font color=#447700>!<a name='850'></font>
        DO J=JFS,JFE<a name='851'>
        DO I=IFS,IFE<a name='852'>
          grid%acfrcv(I,J)=0.<a name='853'>
          grid%ncfrcv(I,J)=0<a name='854'>
          grid%acfrst(I,J)=0.<a name='855'>
          grid%ncfrst(I,J)=0<a name='856'>
          grid%acsnow(I,J)=0.<a name='857'>
          grid%acsnom(I,J)=0.<a name='858'>
          grid%ssroff(I,J)=0.<a name='859'>
          grid%bgroff(I,J)=0.<a name='860'>
          grid%alwin(I,J) =0.<a name='861'>
          grid%alwout(I,J)=0.<a name='862'>
          grid%alwtoa(I,J)=0.<a name='863'>
          grid%aswin(I,J) =0.<a name='864'>
          grid%aswout(I,J)=0.<a name='865'>
          grid%aswtoa(I,J)=0.<a name='866'>
          grid%sfcshx(I,J)=0.<a name='867'>
          grid%sfclhx(I,J)=0.<a name='868'>
          grid%subshx(I,J)=0.<a name='869'>
          grid%snopcx(I,J)=0.<a name='870'>
          grid%sfcuvx(I,J)=0.<a name='871'>
          grid%sfcevp(I,J)=0.<a name='872'>
          grid%potevp(I,J)=0.<a name='873'>
          grid%potflx(I,J)=0.<a name='874'>
        ENDDO<a name='875'>
        ENDDO<a name='876'>
<font color=#447700>!***<a name='877'></font>
<font color=#447700>!***  INITIALIZE SATURATION SPECIFIC HUMIDITY OVER THE WATER.<a name='878'></font>
<font color=#447700>!***<a name='879'></font>
        EPS=R_D/R_V<a name='880'>
<font color=#447700>!<a name='881'></font>
      IF(allowed_to_read)THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='882'></font>
        DO J=JFS,JFE<a name='883'>
        DO I=IFS,IFE<a name='884'>
          IF(grid%sm(I,J)&gt;0.5)THEN<a name='885'>
            CLOGES =-CM1/grid%sst(I,J)-CM2*ALOG10(grid%sst(I,J))+CM3<a name='886'>
            ESE    = 10.**(CLOGES+2.)<a name='887'>
            grid%qsh(I,J)= grid%sm(I,J)*EPS*ESE/(grid%pd(I,J)+grid%pdtop+grid%pt-ESE*(1.-EPS))<a name='888'>
          ENDIF<a name='889'>
        ENDDO<a name='890'>
        ENDDO<a name='891'>
      ENDIF<a name='892'>
      if(allowed_to_read .and. (anal .or. .not. restrt)) then<a name='893'>
         call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_141">(1,'Initialize DKU3D and DKT3D to 0.')<a name='894'>
         do j=jfs,jfe<a name='895'>
            do i=ifs,ife<a name='896'>
               grid%dku3d(i,j,:) = 0<a name='897'>
               grid%dkt3d(i,j,:) = 0<a name='898'>
            enddo<a name='899'>
         enddo<a name='900'>
      endif<a name='901'>
<a name='902'>
<font color=#447700>!***  <a name='903'></font>
<font color=#447700>!***  INITIALIZE TURBULENT KINETIC ENERGY (TKE) TO A SMALL<a name='904'></font>
<font color=#447700>!***  VALUE (EPSQ2) ABOVE GROUND.  SET TKE TO ZERO IN THE<a name='905'></font>
<font color=#447700>!***  THE LOWEST MODEL LAYER.  IN THE LOWEST TWO ATMOSPHERIC<a name='906'></font>
<font color=#447700>!***  ETA LAYERS SET TKE TO A SMALL VALUE (Q2INI).<a name='907'></font>
<font color=#447700>!***<a name='908'></font>
<font color=#447700>!***EROGERS: add check for realistic values of grid%q2<a name='909'></font>
<font color=#447700>!<a name='910'></font>
      IF (MAXVAL(grid%q2(ips:ipe,jps:jpe,:)) .gt. epsq2 .and. MAXVAL(grid%q2(ips:ipe,jps:jpe,:)) .lt. 200.) then<a name='911'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_254">('appear to have grid%q2 values...do not zero')<a name='912'>
      ELSE<a name='913'>
      IF(allowed_to_read)THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='914'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_255">('zeroing grid%q2')<a name='915'>
        DO K=KPS,KPE-1<a name='916'>
        DO J=JFS,JFE<a name='917'>
        DO I=IFS,IFE<a name='918'>
#if ( HWRF == 1 )<a name='919'>
          grid%q2(I,J,K)=0.<a name='920'>
#else<a name='921'>
          grid%q2(I,J,K)=grid%hbm2(I,J)*EPSQ2<a name='922'>
#endif<a name='923'>
        ENDDO<a name='924'>
        ENDDO<a name='925'>
        ENDDO<a name='926'>
<font color=#447700>!<a name='927'></font>
        DO J=JFS,JFE<a name='928'>
        DO I=IFS,IFE<a name='929'>
          grid%q2(I,J,LM)    = 0.<a name='930'>
#if ( HWRF == 1 )<a name='931'>
          grid%q2(I,J,KTE-2)= 0.<a name='932'>
          grid%q2(I,J,KTE-1)= 0.<a name='933'>
#else<a name='934'>
          grid%q2(I,J,KTE-2)= grid%hbm2(I,J)*Q2INI<a name='935'>
          grid%q2(I,J,KTE-1)= grid%hbm2(I,J)*Q2INI<a name='936'>
#endif<a name='937'>
        ENDDO<a name='938'>
        ENDDO<a name='939'>
      ENDIF<a name='940'>
      ENDIF<a name='941'>
<font color=#447700>!***  <a name='942'></font>
<font color=#447700>!***  PAD ABOVE GROUND SPECIFIC HUMIDITY IF IT IS TOO SMALL.<a name='943'></font>
<font color=#447700>!***  INITIALIZE LATENT HEATING ACCUMULATION ARRAYS.<a name='944'></font>
<font color=#447700>!***<a name='945'></font>
        DO K=KPS,KPE<a name='946'>
        DO J=JFS,JFE<a name='947'>
        DO I=IFS,IFE<a name='948'>
          IF(grid%q(I,J,K)&lt;EPSQ)grid%q(I,J,K)=EPSQ<a name='949'>
          grid%train(I,J,K)=0.<a name='950'>
          grid%tcucn(I,J,K)=0.<a name='951'>
        ENDDO<a name='952'>
        ENDDO<a name='953'>
        ENDDO<a name='954'>
<font color=#447700>!<a name='955'></font>
<font color=#447700>!***<a name='956'></font>
<font color=#447700>!***  INITIALIZE MAX/MIN TEMPERATURES.<a name='957'></font>
<font color=#447700>!***<a name='958'></font>
        DO J=JFS,JFE<a name='959'>
        DO I=IFS,IFE<a name='960'>
          grid%tlmax(I,J)=grid%t(I,J,KPS)<a name='961'>
          grid%tlmin(I,J)=grid%t(I,J,KPS)<a name='962'>
        ENDDO<a name='963'>
        ENDDO<a name='964'>
<font color=#447700>!<a name='965'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='966'></font>
<font color=#447700>!***  END OF SCRATCH START INITIALIZATION BLOCK.<a name='967'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='968'></font>
<font color=#447700>!<a name='969'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_256">('INIT:  INITIALIZED ARRAYS FOR CLEAN START')<a name='970'>
      ENDIF <font color=#447700>! &lt;--- (not restart)<a name='971'></font>
<a name='972'>
      IF(NEST)THEN<a name='973'>
        DO J=JFS,JFE<a name='974'>
        DO I=IFS,IFE<a name='975'>
<font color=#447700>!<a name='976'></font>
          IF(grid%t(I,J,KTS)==0.)THEN<a name='977'>
            grid%t(I,J,KTS)=grid%t(I,J,KTS+1)<a name='978'>
          ENDIF<a name='979'>
<font color=#447700>!<a name='980'></font>
          TERM1=-0.068283/grid%t(I,J,KTS)<a name='981'>
          grid%pshltr(I,J)=(grid%pd(I,J)+grid%pdtop+grid%pt)*EXP(TERM1)<a name='982'>
        ENDDO<a name='983'>
        ENDDO<a name='984'>
      ENDIF<a name='985'>
<font color=#447700>!<a name='986'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='987'></font>
<font color=#447700>!***  RESTART INITIALIZING.  CHECK TO SEE IF WE NEED TO ZERO<a name='988'></font>
<font color=#447700>!***  ACCUMULATION ARRAYS.<a name='989'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='990'></font>
<a name='991'>
      TSPH=3600./GRID%DT <font color=#447700>! needed?<a name='992'></font>
      grid%nphs0=GRID%NPHS<a name='993'>
#if ( HWRF == 1 )<a name='994'>
<font color=#447700>!zhang's doing<a name='995'></font>
      tstart = grid%TSTART<a name='996'>
<font color=#447700>!zhang's doing ends<a name='997'></font>
#endif<a name='998'>
<a name='999'>
      IF(MYPE==0)THEN<a name='1000'>
        WRITE( wrf_err_message, * )' start_nmm TSTART=',grid%tstart<a name='1001'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_142">( 1, TRIM(wrf_err_message) )<a name='1002'>
        WRITE( wrf_err_message, * )' start_nmm TPREC=',grid%tprec<a name='1003'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_143">( 1, TRIM(wrf_err_message) )<a name='1004'>
        WRITE( wrf_err_message, * )' start_nmm THEAT=',grid%theat<a name='1005'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_144">( 1, TRIM(wrf_err_message) )<a name='1006'>
        WRITE( wrf_err_message, * )' start_nmm TCLOD=',grid%tclod<a name='1007'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_145">( 1, TRIM(wrf_err_message) )<a name='1008'>
        WRITE( wrf_err_message, * )' start_nmm TRDSW=',grid%trdsw<a name='1009'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_146">( 1, TRIM(wrf_err_message) )<a name='1010'>
        WRITE( wrf_err_message, * )' start_nmm TRDLW=',grid%trdlw<a name='1011'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_147">( 1, TRIM(wrf_err_message) )<a name='1012'>
        WRITE( wrf_err_message, * )' start_nmm TSRFC=',grid%tsrfc<a name='1013'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_148">( 1, TRIM(wrf_err_message) )<a name='1014'>
        WRITE( wrf_err_message, * )' start_nmm PCPFLG=',grid%pcpflg<a name='1015'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_149">( 1, TRIM(wrf_err_message) )<a name='1016'>
      ENDIF<a name='1017'>
<a name='1018'>
      NSTART = INT(grid%TSTART*TSPH+0.5)<a name='1019'>
<font color=#447700>!<a name='1020'></font>
      grid%ntsd = NSTART<a name='1021'>
<a name='1022'>
<font color=#447700>!! want non-zero values for grid%nprec, grid%nheat type vars to avoid problems<a name='1023'></font>
<font color=#447700>!! with mod statements below.<a name='1024'></font>
<a name='1025'>
      grid%nprec  = INT(grid%TPREC *TSPH+0.5)<a name='1026'>
      grid%nheat  = INT(grid%THEAT *TSPH+0.5)<a name='1027'>
      grid%nclod  = INT(grid%TCLOD *TSPH+0.5)<a name='1028'>
      grid%nrdsw  = INT(grid%TRDSW *TSPH+0.5)<a name='1029'>
      grid%nrdlw  = INT(grid%TRDLW *TSPH+0.5)<a name='1030'>
      grid%nsrfc  = INT(grid%TSRFC *TSPH+0.5)<a name='1031'>
#if ( HWRF == 1 )<a name='1032'>
<font color=#447700>!zhang's dong for analysis option:<a name='1033'></font>
      grid%NCNVC0  = grid%NCNVC<a name='1034'>
      grid%NPHS0   = grid%NPHS<a name='1035'>
#endif<a name='1036'>
<font color=#447700>!<a name='1037'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1038'></font>
<font color=#447700>!<a name='1039'></font>
<font color=#447700>!***  FLAG FOR INITIALIZING ARRAYS, LOOKUP TABLES, &amp; CONSTANTS USED IN<a name='1040'></font>
<font color=#447700>!***  MICROPHYSICS AND RADIATION<a name='1041'></font>
<font color=#447700>!<a name='1042'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1043'></font>
<font color=#447700>!<a name='1044'></font>
      grid%micro_start=.TRUE.<a name='1045'>
<font color=#447700>!<a name='1046'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1047'></font>
<font color=#447700>!***<a name='1048'></font>
<font color=#447700>!***  INITIALIZE ADVECTION TENDENCIES TO ZERO SO THAT<a name='1049'></font>
<font color=#447700>!***  BOUNDARY POINTS WILL ALWAYS BE ZERO<a name='1050'></font>
<font color=#447700>!***<a name='1051'></font>
      DO J=JFS,JFE<a name='1052'>
      DO I=IFS,IFE<a name='1053'>
        grid%adt(I,J)=0.<a name='1054'>
        grid%adu(I,J)=0.<a name='1055'>
        grid%adv(I,J)=0.<a name='1056'>
      ENDDO<a name='1057'>
      ENDDO<a name='1058'>
<font color=#447700>!----------------------------------------------------------------------<a name='1059'></font>
<font color=#447700>!***<a name='1060'></font>
<font color=#447700>!***  SET INDEX ARRAYS FOR UPSTREAM ADVECTION<a name='1061'></font>
<font color=#447700>!***<a name='1062'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1063'></font>
      DO J=JFS,JFE<a name='1064'>
        grid%n_iup_h(J)=0<a name='1065'>
        grid%n_iup_v(J)=0<a name='1066'>
        grid%n_iup_adh(J)=0<a name='1067'>
        grid%n_iup_adv(J)=0<a name='1068'>
<font color=#447700>!<a name='1069'></font>
        DO I=IFS,IFE<a name='1070'>
          grid%iup_h(I,J)=-999<a name='1071'>
          grid%iup_v(I,J)=-999<a name='1072'>
          grid%iup_adh(I,J)=-999<a name='1073'>
          grid%iup_adv(I,J)=-999<a name='1074'>
        ENDDO<a name='1075'>
<font color=#447700>!<a name='1076'></font>
      ENDDO<a name='1077'>
<a name='1078'>
#ifndef NO_UPSTREAM_ADVECTION<a name='1079'>
<font color=#447700>!<a name='1080'></font>
<font color=#447700>!***  n_iup_h HOLDS THE NUMBER OF MASS POINTS NEEDED IN EACH ROW<a name='1081'></font>
<font color=#447700>!***  FOR UPSTREAM ADVECTION (FULL ROWS IN THE 3RD THROUGH 7TH<a name='1082'></font>
<font color=#447700>!***  ROWS FROM THE SOUTH AND NORTH GLOBAL BOUNDARIES AND <a name='1083'></font>
<font color=#447700>!***  FOUR POINTS ADJACENT TO THE WEST AND EAST GLOBAL BOUNDARIES<a name='1084'></font>
<font color=#447700>!***  ON ALL OTHER INTERNAL ROWS).  SIMILARLY FOR n_iup_v.<a name='1085'></font>
<font color=#447700>!***  BECAUSE OF HORIZONTAL OPERATIONS, THESE POINTS EXTEND OUTSIDE <a name='1086'></font>
<font color=#447700>!***  OF THE UPSTREAM REGION SOMEWHAT.<a name='1087'></font>
<font color=#447700>!***  n_iup_adh HOLDS THE NUMBER OF MASS POINTS NEEDED IN EACH ROW<a name='1088'></font>
<font color=#447700>!***  FOR THE COMPUTATION OF THE TENDENCIES THEMSELVES (adt, ADQ2M<a name='1089'></font>
<font color=#447700>!***  AND ADQ2L); SPECIFICALLY THESE TENDENCIES ARE ONLY DONE IN<a name='1090'></font>
<font color=#447700>!***  THE UPSTREAM REGION.<a name='1091'></font>
<font color=#447700>!***  n_iup_adv HOLDS THE NUMBER OF MASS POINTS NEEDED IN EACH ROW<a name='1092'></font>
<font color=#447700>!***  FOR THE VELOCITY POINT TENDENCIES.<a name='1093'></font>
<font color=#447700>!***  iup_h AND iup_v HOLD THE ACTUAL I VALUES USED IN EACH ROW.<a name='1094'></font>
<font color=#447700>!***  LIKEWISE FOR iup_adh AND iup_adv. <a name='1095'></font>
<font color=#447700>!***  ALSO, SET upstrm FOR THOSE TASKS AROUND THE GLOBAL EDGE.<a name='1096'></font>
<font color=#447700>!<a name='1097'></font>
      grid%upstrm=.FALSE.<a name='1098'>
<font color=#447700>!<a name='1099'></font>
      S_BDY=(JPS==JDS)<a name='1100'>
      N_BDY=(JPE==JDE)<a name='1101'>
      W_BDY=(IPS==IDS)<a name='1102'>
      E_BDY=(IPE==IDE)<a name='1103'>
<font color=#447700>!<a name='1104'></font>
      JTPAD2=2<a name='1105'>
      JBPAD2=2<a name='1106'>
      IRPAD2=2<a name='1107'>
      ILPAD2=2<a name='1108'>
<font color=#447700>!<a name='1109'></font>
      IF(S_BDY)THEN<a name='1110'>
        grid%upstrm=.TRUE.<a name='1111'>
        JBPAD2=0<a name='1112'>
<font color=#447700>!<a name='1113'></font>
        DO JJ=1,7<a name='1114'>
          J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1115'></font>
          KNTI=0<a name='1116'>
          DO I=MYIS_P2,MYIE_P2<a name='1117'>
            grid%iup_h(IMS+KNTI,J)=I<a name='1118'>
            grid%iup_v(IMS+KNTI,J)=I<a name='1119'>
            KNTI=KNTI+1<a name='1120'>
          ENDDO<a name='1121'>
          grid%n_iup_h(J)=KNTI<a name='1122'>
          grid%n_iup_v(J)=KNTI<a name='1123'>
        ENDDO<a name='1124'>
<font color=#447700>!<a name='1125'></font>
        DO JJ=3,5<a name='1126'>
          J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1127'></font>
          KNTI=0<a name='1128'>
          ISTART=MYIS1_P2<a name='1129'>
          IEND=MYIE1_P2<a name='1130'>
          IF(E_BDY)IEND=IEND-MOD(JJ+1,2)<a name='1131'>
          DO I=ISTART,IEND<a name='1132'>
            grid%iup_adh(IMS+KNTI,J)=I<a name='1133'>
            KNTI=KNTI+1<a name='1134'>
          ENDDO<a name='1135'>
          grid%n_iup_adh(J)=KNTI<a name='1136'>
<font color=#447700>!<a name='1137'></font>
          KNTI=0<a name='1138'>
          ISTART=MYIS1_P2<a name='1139'>
          IEND=MYIE1_P2<a name='1140'>
          IF(E_BDY)IEND=IEND-MOD(JJ,2)<a name='1141'>
          DO I=ISTART,IEND<a name='1142'>
            grid%iup_adv(IMS+KNTI,J)=I<a name='1143'>
            KNTI=KNTI+1<a name='1144'>
          ENDDO<a name='1145'>
          grid%n_iup_adv(J)=KNTI<a name='1146'>
        ENDDO<a name='1147'>
      ENDIF<a name='1148'>
<font color=#447700>!<a name='1149'></font>
      IF(N_BDY)THEN<a name='1150'>
        grid%upstrm=.TRUE.<a name='1151'>
        JTPAD2=0<a name='1152'>
<font color=#447700>!<a name='1153'></font>
        DO JJ=JDE-7, JDE-1 <font color=#447700>! JM-6,JM<a name='1154'></font>
          J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1155'></font>
          KNTI=0<a name='1156'>
          DO I=MYIS_P2,MYIE_P2<a name='1157'>
            grid%iup_h(IMS+KNTI,J)=I<a name='1158'>
            grid%iup_v(IMS+KNTI,J)=I<a name='1159'>
            KNTI=KNTI+1<a name='1160'>
          ENDDO<a name='1161'>
          grid%n_iup_h(J)=KNTI<a name='1162'>
          grid%n_iup_v(J)=KNTI<a name='1163'>
        ENDDO<a name='1164'>
<font color=#447700>!<a name='1165'></font>
        DO JJ=JDE-5, JDE-3 <font color=#447700>! JM-4,JM-2<a name='1166'></font>
          J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1167'></font>
          KNTI=0<a name='1168'>
          ISTART=MYIS1_P2<a name='1169'>
          IEND=MYIE1_P2<a name='1170'>
          IF(E_BDY)IEND=IEND-MOD(JJ+1,2)<a name='1171'>
          DO I=ISTART,IEND<a name='1172'>
            grid%iup_adh(IMS+KNTI,J)=I<a name='1173'>
            KNTI=KNTI+1<a name='1174'>
          ENDDO<a name='1175'>
          grid%n_iup_adh(J)=KNTI<a name='1176'>
<font color=#447700>!<a name='1177'></font>
          KNTI=0<a name='1178'>
          ISTART=MYIS1_P2<a name='1179'>
          IEND=MYIE1_P2<a name='1180'>
          IF(E_BDY)IEND=IEND-MOD(JJ,2)<a name='1181'>
          DO I=ISTART,IEND<a name='1182'>
            grid%iup_adv(IMS+KNTI,J)=I<a name='1183'>
            KNTI=KNTI+1<a name='1184'>
          ENDDO<a name='1185'>
          grid%n_iup_adv(J)=KNTI<a name='1186'>
        ENDDO<a name='1187'>
      ENDIF<a name='1188'>
<font color=#447700>!<a name='1189'></font>
      IF(W_BDY)THEN<a name='1190'>
        grid%upstrm=.TRUE.<a name='1191'>
        ILPAD2=0<a name='1192'>
        DO JJ=8,JDE-8   <font color=#447700>! JM-7<a name='1193'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1194'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1195'></font>
<font color=#447700>!<a name='1196'></font>
            DO I=1,4<a name='1197'>
              grid%iup_h(IMS+I-1,J)=I<a name='1198'>
              grid%iup_v(IMS+I-1,J)=I<a name='1199'>
            ENDDO<a name='1200'>
            grid%n_iup_h(J)=4<a name='1201'>
            grid%n_iup_v(J)=4<a name='1202'>
          ENDIF<a name='1203'>
        ENDDO<a name='1204'>
<font color=#447700>!<a name='1205'></font>
        DO JJ=6,JDE-6   <font color=#447700>! JM-5<a name='1206'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1207'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1208'></font>
            KNTI=0<a name='1209'>
            IEND=2+MOD(JJ,2)<a name='1210'>
            DO I=2,IEND<a name='1211'>
              grid%iup_adh(IMS+KNTI,J)=I<a name='1212'>
              KNTI=KNTI+1<a name='1213'>
            ENDDO<a name='1214'>
            grid%n_iup_adh(J)=KNTI<a name='1215'>
<font color=#447700>!<a name='1216'></font>
            KNTI=0<a name='1217'>
            IEND=2+MOD(JJ+1,2)<a name='1218'>
            DO I=2,IEND<a name='1219'>
              grid%iup_adv(IMS+KNTI,J)=I<a name='1220'>
              KNTI=KNTI+1<a name='1221'>
            ENDDO<a name='1222'>
            grid%n_iup_adv(J)=KNTI<a name='1223'>
<font color=#447700>!<a name='1224'></font>
          ENDIF<a name='1225'>
        ENDDO<a name='1226'>
      ENDIF<a name='1227'>
<font color=#447700>!<a name='1228'></font>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROCX'>WRF_GET_NPROCX</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROCX_2">(INPES)<a name='1229'>
<font color=#447700>!<a name='1230'></font>
      IF(E_BDY)THEN<a name='1231'>
        grid%upstrm=.TRUE.<a name='1232'>
        IRPAD2=0<a name='1233'>
        DO JJ=8,JDE-8   <font color=#447700>! JM-7<a name='1234'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1235'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1236'></font>
            IEND=IM-MOD(JJ+1,2)<a name='1237'>
            ISTART=IEND-3<a name='1238'>
<font color=#447700>!<a name='1239'></font>
<font color=#447700>!***  IN CASE THERE IS ONLY A SINGLE GLOBAL TASK IN THE<a name='1240'></font>
<font color=#447700>!***  I DIRECTION THEN WE MUST ADD THE WESTSIDE UPSTREAM<a name='1241'></font>
<font color=#447700>!***  POINTS TO THE EASTSIDE POINTS IN EACH ROW.<a name='1242'></font>
<font color=#447700>!<a name='1243'></font>
            KNTI=0<a name='1244'>
            IF(INPES.EQ.1)KNTI=grid%n_iup_h(J)<a name='1245'>
<font color=#447700>!<a name='1246'></font>
            DO II=ISTART,IEND<a name='1247'>
              I=II      <font color=#447700>! -MY_IS_GLB+1<a name='1248'></font>
              grid%iup_h(IMS+KNTI,J)=I<a name='1249'>
              KNTI=KNTI+1<a name='1250'>
            ENDDO<a name='1251'>
            grid%n_iup_h(J)=KNTI<a name='1252'>
          ENDIF<a name='1253'>
        ENDDO<a name='1254'>
<font color=#447700>!<a name='1255'></font>
        DO JJ=6,JDE-6   <font color=#447700>! JM-5<a name='1256'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1257'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1258'></font>
            IEND=IM-1-MOD(JJ+1,2)<a name='1259'>
            ISTART=IEND-MOD(JJ,2)<a name='1260'>
            KNTI=0<a name='1261'>
            IF(INPES==1)KNTI=grid%n_iup_adh(J)<a name='1262'>
            DO II=ISTART,IEND<a name='1263'>
              I=II      <font color=#447700>! -MY_IS_GLB+1<a name='1264'></font>
              grid%iup_adh(IMS+KNTI,J)=I<a name='1265'>
              KNTI=KNTI+1<a name='1266'>
            ENDDO<a name='1267'>
            grid%n_iup_adh(J)=KNTI<a name='1268'>
          ENDIF<a name='1269'>
        ENDDO<a name='1270'>
<font color=#447700>!***<a name='1271'></font>
        DO JJ=8,JDE-8  <font color=#447700>! JM-7<a name='1272'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1273'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1274'></font>
            IEND=IM-MOD(JJ,2)<a name='1275'>
            ISTART=IEND-3<a name='1276'>
            KNTI=0<a name='1277'>
            IF(INPES==1)KNTI=grid%n_iup_v(J)<a name='1278'>
<font color=#447700>!<a name='1279'></font>
            DO II=ISTART,IEND<a name='1280'>
              I=II      <font color=#447700>! -MY_IS_GLB+1<a name='1281'></font>
              grid%iup_v(IMS+KNTI,J)=I<a name='1282'>
              KNTI=KNTI+1<a name='1283'>
            ENDDO<a name='1284'>
            grid%n_iup_v(J)=KNTI<a name='1285'>
          ENDIF<a name='1286'>
        ENDDO<a name='1287'>
<font color=#447700>!<a name='1288'></font>
        DO JJ=6,JDE-6  <font color=#447700>!  JM-5<a name='1289'></font>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1290'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1291'></font>
            IEND=IM-1-MOD(JJ,2)<a name='1292'>
            ISTART=IEND-MOD(JJ+1,2)<a name='1293'>
            KNTI=0<a name='1294'>
            IF(INPES==1)KNTI=grid%n_iup_adv(J)<a name='1295'>
            DO II=ISTART,IEND<a name='1296'>
              I=II      <font color=#447700>! -MY_IS_GLB+1<a name='1297'></font>
              grid%iup_adv(IMS+KNTI,J)=I<a name='1298'>
              KNTI=KNTI+1<a name='1299'>
            ENDDO<a name='1300'>
            grid%n_iup_adv(J)=KNTI<a name='1301'>
          ENDIF<a name='1302'>
        ENDDO<a name='1303'>
      ENDIF<a name='1304'>
<font color=#447700>!----------------------------------------------------------------------<a name='1305'></font>
      jam=6+2*(JDE-JDS-1-9)<a name='1306'>
<font color=#447700>!<a name='1307'></font>
<font color=#447700>!***  EXTRACT em AND emt FOR THE LOCAL SUBDOMAINS<a name='1308'></font>
<font color=#447700>!<a name='1309'></font>
      DO J=MYJS_P5,MYJE_P5<a name='1310'>
        grid%em_loc(J)=-9.E9<a name='1311'>
        grid%emt_loc(J)=-9.E9<a name='1312'>
      ENDDO<a name='1313'>
<font color=#447700>!!!   IF(IBROW==1)THEN<a name='1314'></font>
      IF(S_BDY)THEN<a name='1315'>
        DO J=3,5<a name='1316'>
          grid%em_loc(J)=grid%em(J-2)<a name='1317'>
          grid%emt_loc(J)=grid%emt(J-2)<a name='1318'>
        ENDDO<a name='1319'>
      ENDIF<a name='1320'>
<font color=#447700>!!!   IF(ITROW==1)THEN<a name='1321'></font>
      IF(N_BDY)THEN<a name='1322'>
        KNT=3<a name='1323'>
        DO JJ=JDE-5,JDE-3 <font color=#447700>! JM-4,JM-2<a name='1324'></font>
          KNT=KNT+1<a name='1325'>
          J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1326'></font>
          grid%em_loc(J)=grid%em(KNT)<a name='1327'>
          grid%emt_loc(J)=grid%emt(KNT)<a name='1328'>
        ENDDO<a name='1329'>
      ENDIF<a name='1330'>
<font color=#447700>!!!   IF(ILCOL==1)THEN<a name='1331'></font>
      IF(W_BDY)THEN<a name='1332'>
        KNT=6<a name='1333'>
        DO JJ=6,JDE-6 <font color=#447700>! JM-5<a name='1334'></font>
          KNT=KNT+1<a name='1335'>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1336'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1337'></font>
            grid%em_loc(J)=grid%em(KNT)<a name='1338'>
            grid%emt_loc(J)=grid%emt(KNT)<a name='1339'>
          ENDIF<a name='1340'>
        ENDDO<a name='1341'>
      ENDIF<a name='1342'>
<font color=#447700>!!!   IF(IRCOL==1)THEN<a name='1343'></font>
      IF(E_BDY)THEN<a name='1344'>
        KNT=6+JDE-11 <font color=#447700>! JM-10<a name='1345'></font>
        DO JJ=6,JDE-6 <font color=#447700>! JM-5<a name='1346'></font>
          KNT=KNT+1<a name='1347'>
          IF(JJ&gt;=MY_JS_GLB-2.AND.JJ&lt;=MY_JE_GLB+2)THEN<a name='1348'>
            J=JJ      <font color=#447700>! -MY_JS_GLB+1<a name='1349'></font>
            grid%em_loc(J)=grid%em(KNT)<a name='1350'>
            grid%emt_loc(J)=grid%emt(KNT)<a name='1351'>
          ENDIF<a name='1352'>
        ENDDO<a name='1353'>
      ENDIF<a name='1354'>
#else<a name='1355'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_257">( 'start_domain_nmm: upstream advection commented out')<a name='1356'>
#endif<a name='1357'>
<font color=#447700>!<a name='1358'></font>
<font color=#447700>!***<a name='1359'></font>
<font color=#447700>!*** SET ZERO-VALUE FOR SOME OUTPUT DIAGNOSTIC ARRAYS<a name='1360'></font>
<font color=#447700>!***<a name='1361'></font>
#if ( HWRF == 1 )<a name='1362'>
<font color=#447700>!zhang'sdoing       IF(NSTART.EQ.0)THEN<a name='1363'></font>
      IF(NSTART.EQ.0 .or. .not.allowed_to_read )THEN<a name='1364'>
<font color=#447700>!zhang's doing ends<a name='1365'></font>
#else<a name='1366'>
      IF(NSTART.EQ.0)THEN<a name='1367'>
#endif<a name='1368'>
<font color=#447700>!<a name='1369'></font>
         GRID%NSOIL= GRID%NUM_SOIL_LAYERS<a name='1370'>
        DO J=JFS,JFE<a name='1371'>
        DO I=IFS,IFE<a name='1372'>
          grid%pctsno(I,J)=-999.0<a name='1373'>
          IF(grid%sm(I,J)&lt;0.5)THEN<a name='1374'>
              grid%cmc(I,J)=0.0<a name='1375'>
<font color=#447700>!              grid%cmc(I,J)=grid%canwat(i,j)   ! tgs<a name='1376'></font>
            IF(grid%sice(I,J)&gt;0.5)THEN<a name='1377'>
<font color=#447700>!***<a name='1378'></font>
<font color=#447700>!***  SEA-ICE CASE<a name='1379'></font>
<font color=#447700>!***<a name='1380'></font>
              grid%smstav(I,J)=1.0<a name='1381'>
              grid%smstot(I,J)=1.0<a name='1382'>
              grid%ssroff(I,J)=0.0<a name='1383'>
              grid%bgroff(I,J)=0.0<a name='1384'>
              grid%cmc(I,J)=0.0<a name='1385'>
              DO NS=1,GRID%NSOIL<a name='1386'>
                grid%smc(I,NS,J)=1.0<a name='1387'>
<font color=#447700>!               grid%sh2o(I,NS,J)=0.05<a name='1388'></font>
                grid%sh2o(I,NS,J)=1.0<a name='1389'>
              ENDDO<a name='1390'>
            ENDIF<a name='1391'>
          ELSE<a name='1392'>
<font color=#447700>!***<a name='1393'></font>
<font color=#447700>!***  WATER CASE<a name='1394'></font>
<font color=#447700>!***<a name='1395'></font>
            grid%smstav(I,J)=1.0<a name='1396'>
            grid%smstot(I,J)=1.0<a name='1397'>
            grid%ssroff(I,J)=0.0<a name='1398'>
            grid%bgroff(I,J)=0.0<a name='1399'>
            grid%soiltb(I,J)=273.16<a name='1400'>
            grid%grnflx(I,J)=0.<a name='1401'>
            grid%subshx(I,J)=0.0<a name='1402'>
            grid%acsnow(I,J)=0.0<a name='1403'>
            grid%acsnom(I,J)=0.0<a name='1404'>
            grid%snopcx(I,J)=0.0<a name='1405'>
            grid%cmc(I,J)=0.0<a name='1406'>
            grid%sno(I,J)=0.0<a name='1407'>
            DO NS=1,GRID%NSOIL<a name='1408'>
              grid%smc(I,NS,J)=1.0<a name='1409'>
              grid%stc(I,NS,J)=273.16<a name='1410'>
<font color=#447700>!             grid%sh2o(I,NS,J)=0.05<a name='1411'></font>
              grid%sh2o(I,NS,J)=1.0<a name='1412'>
            ENDDO<a name='1413'>
          ENDIF<a name='1414'>
<font color=#447700>!<a name='1415'></font>
        ENDDO<a name='1416'>
        ENDDO<a name='1417'>
<font color=#447700>!<a name='1418'></font>
        grid%aphtim=0.0<a name='1419'>
        grid%aratim=0.0<a name='1420'>
        grid%acutim=0.0<a name='1421'>
<font color=#447700>!<a name='1422'></font>
      ENDIF<a name='1423'>
<font color=#447700>!<a name='1424'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1425'></font>
<font color=#447700>!***  INITIALIZE RADTN VARIABLES<a name='1426'></font>
<font color=#447700>!***  CALCULATE THE NUMBER OF STEPS AT EACH POINT.<a name='1427'></font>
<font color=#447700>!***  THE ARRAY 'lvl' WILL COORDINATE VERTICAL LOCATIONS BETWEEN<a name='1428'></font>
<font color=#447700>!***  THE LIFTED WORKING ARRAYS AND THE FUNDAMENTAL MODEL ARRAYS.<a name='1429'></font>
<font color=#447700>!***  lvl HOLDS THE HEIGHT (IN MODEL LAYERS) OF THE TOPOGRAPHY AT<a name='1430'></font>
<font color=#447700>!***  EACH GRID POINT.<a name='1431'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1432'></font>
<font color=#447700>!   <a name='1433'></font>
      DO J=JFS,JFE<a name='1434'>
      DO I=IFS,IFE<a name='1435'>
        grid%lvl(I,J)=LM-KTE<a name='1436'>
      ENDDO<a name='1437'>
      ENDDO<a name='1438'>
<font color=#447700>!***<a name='1439'></font>
<font color=#447700>!***  DETERMINE MODEL LAYER LIMITS FOR HIGH(3), MIDDLE(2),<a name='1440'></font>
<font color=#447700>!***  AND LOW(1) CLOUDS.  ALSO FIND MODEL LAYER THAT IS JUST BELOW<a name='1441'></font>
<font color=#447700>!***  (HEIGHT-WISE) 400 MB. (K400)<a name='1442'></font>
<font color=#447700>!*** <a name='1443'></font>
      K400=0<a name='1444'>
      PSUM=grid%pt<a name='1445'>
      SLPM=101325.<a name='1446'>
      PDIF=SLPM-grid%pt<a name='1447'>
      DO K=1,LM<a name='1448'>
        PSUM=PSUM+grid%deta(K)*PDIF<a name='1449'>
        IF(LPTOP(3)==0)THEN<a name='1450'>
          IF(PSUM&gt;PHITP)LPTOP(3)=K<a name='1451'>
        ELSEIF(LPTOP(2)==0)THEN<a name='1452'>
          IF(PSUM&gt;PMDHI)LPTOP(2)=K<a name='1453'>
        ELSEIF(K400==0)THEN<a name='1454'>
          IF(PSUM&gt;P400)K400=K<a name='1455'>
        ELSEIF(LPTOP(1)==0)THEN<a name='1456'>
          IF(PSUM&gt;PLOMD)LPTOP(1)=K<a name='1457'>
        ENDIF<a name='1458'>
      ENDDO<a name='1459'>
<font color=#447700>!***<a name='1460'></font>
<font color=#447700>!*** CALL GRADFS ONCE TO CALC. CONSTANTS AND GET O3 DATA<a name='1461'></font>
<font color=#447700>!***<a name='1462'></font>
      KCCO2=0<a name='1463'>
<font color=#447700>!***<a name='1464'></font>
<font color=#447700>!*** CALCULATE THE MIDLAYER PRESSURES IN THE STANDARD ATMOSPHERE<a name='1465'></font>
<font color=#447700>!***<a name='1466'></font>
      PSS=101325.<a name='1467'>
      PDIF=PSS-grid%pt<a name='1468'>
<font color=#447700>!<a name='1469'></font>
      ALLOCATE(PHALF(LM+1),STAT=I)<a name='1470'>
<font color=#447700>!<a name='1471'></font>
      DO K=KPS,KPE-1<a name='1472'>
        PHALF(K+1)=grid%aeta(K)*PDIF+grid%pt<a name='1473'>
      ENDDO<a name='1474'>
      <a name='1475'>
<font color=#447700>!<a name='1476'></font>
      PHALF(1)=0.<a name='1477'>
      PHALF(LM+1)=PSS<a name='1478'>
<font color=#447700>!***<a name='1479'></font>
<font color=#447700>!!!   CALL GRADFS(PHALF,KCCO2,NUNIT_CO2)<a name='1480'></font>
<font color=#447700>!***<a name='1481'></font>
<font color=#447700>!***  CALL SOLARD TO CALCULATE NON-DIMENSIONAL SUN-EARTH DISTANCE<a name='1482'></font>
<font color=#447700>!***<a name='1483'></font>
<font color=#447700>!!!   IF(MYPE==0)CALL SOLARD(SUN_DIST)<a name='1484'></font>
<font color=#447700>!!!   CALL MPI_BCAST(SUN_DIST,1,MPI_REAL,0,MPI_COMM_COMP,IRTN)<a name='1485'></font>
<a name='1486'>
<font color=#447700>!***<a name='1487'></font>
<font color=#447700>!***  CALL ZENITH SIMPLY TO GET THE DAY OF THE YEAR FOR<a name='1488'></font>
<font color=#447700>!***  THE SETUP OF THE OZONE DATA<a name='1489'></font>
<font color=#447700>!***<a name='1490'></font>
      TIME=(grid%ntsd-1)*GRID%DT<a name='1491'>
<font color=#447700>!<a name='1492'></font>
<font color=#447700>!!!   CALL ZENITH(TIME,DAYI,HOUR)<a name='1493'></font>
<font color=#447700>!<a name='1494'></font>
      ADDL=0.<a name='1495'>
      IF(MOD(IDAT(3),4)==0)ADDL=1.<a name='1496'>
<font color=#447700>!<a name='1497'></font>
<font color=#447700>!!!   CALL O3CLIM<a name='1498'></font>
<font color=#447700>!<a name='1499'></font>
<font color=#447700>!<a name='1500'></font>
      DEALLOCATE(PHALF)<a name='1501'>
<font color=#447700>!----------------------------------------------------------------------<a name='1502'></font>
<font color=#447700>!***  SOME INITIAL VALUES RELATED TO TURBULENCE SCHEME<a name='1503'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1504'></font>
<font color=#447700>!<a name='1505'></font>
      IF(allowed_to_read.and.(.NOT.RESTRT))THEN       <font color=#447700>! This is gopal's inclusion for moving nest<a name='1506'></font>
<a name='1507'>
      DO J=JFS,JFE<a name='1508'>
      DO I=IFS,IFE<a name='1509'>
<font color=#447700>!***<a name='1510'></font>
<font color=#447700>!***  TRY A SIMPLE LINEAR INTERP TO GET 2/10 M VALUES<a name='1511'></font>
<font color=#447700>!***<a name='1512'></font>
#if ( HWRF == 1 )<a name='1513'>
<font color=#447700>!zhang's doing<a name='1514'></font>
        IF(.NOT.RESTRT .OR. .NOT.allowed_to_read) then<a name='1515'>
        grid%PDSL(I,J)=grid%PD(I,J)*grid%RES(I,J)<a name='1516'>
        endif<a name='1517'>
<font color=#447700>!end of zhang's doing<a name='1518'></font>
#else<a name='1519'>
        grid%PDSL(I,J)=grid%PD(I,J)*grid%RES(I,J)<a name='1520'>
#endif<a name='1521'>
<font color=#447700>!<a name='1522'></font>
        ULM=grid%u(I,J,KTS)<a name='1523'>
        VLM=grid%v(I,J,KTS)<a name='1524'>
        TLM=grid%t(I,J,KTS)<a name='1525'>
        QLM=grid%q(I,J,KTS)<a name='1526'>
        PLM=grid%aeta1(KTS)*grid%pdtop+grid%aeta2(KTS)*grid%pdsl(I,J)+grid%pt<a name='1527'>
        APELM=(1.0E5/PLM)**CAPA<a name='1528'>
          TERM1=-0.068283/grid%t(I,J,KTS)<a name='1529'>
          grid%pshltr(I,J)=(grid%pd(I,J)+grid%pdtop+grid%pt)*EXP(TERM1)<a name='1530'>
        APELMNW=(1.0E5/grid%pshltr(I,J))**CAPA<a name='1531'>
        THLM=TLM*APELM<a name='1532'>
        DPLM=(grid%deta1(KTS)*grid%pdtop+grid%deta2(KTS)*grid%pdsl(I,J))*0.5<a name='1533'>
        DZLM=R_D*DPLM*TLM*(1.+P608*QLM)/(G*PLM)<a name='1534'>
        FAC1=10./DZLM<a name='1535'>
        FAC2=(DZLM-10.)/DZLM<a name='1536'>
        IF(DZLM&lt;=10.)THEN<a name='1537'>
          FAC1=1.<a name='1538'>
          FAC2=0.<a name='1539'>
        ENDIF<a name='1540'>
<font color=#447700>!<a name='1541'></font>
#if ( HWRF == 1 )<a name='1542'>
<font color=#447700>!zhang's doing<a name='1543'></font>
        IF(.NOT.RESTRT .OR. .NOT.allowed_to_read)THEN<a name='1544'>
<font color=#447700>!end of zhang's doing<a name='1545'></font>
#else<a name='1546'>
        IF(.NOT.RESTRT)THEN<a name='1547'>
#endif<a name='1548'>
          grid%th10(I,J)=FAC2*grid%ths(I,J)+FAC1*THLM<a name='1549'>
          grid%q10(I,J)=FAC2*grid%qsh(I,J)+FAC1*QLM<a name='1550'>
#if (HWRF == 1)<a name='1551'>
          IF(grid%sm(I,J).LT.0.5)THEN<a name='1552'>
              grid%u10(I,J)=ULM*(log(10./grid%z0(I,J))/log(DZLM/grid%z0(I,J)))<a name='1553'>
              grid%v10(I,J)=VLM*(log(10./grid%z0(I,J))/log(DZLM/grid%z0(I,J)))<a name='1554'>
          ELSE<a name='1555'>
             windlmtmp=SQRT(ULM*ULM+VLM*VLM)<a name='1556'>
             wind10tmp=windlmtmp<a name='1557'>
             DO ITER=1,10<a name='1558'>
               call <A href='../../html_code/phys/module_sf_exchcoef.F.html#ZNOT_WIND10M'>znot_wind10m</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ZNOT_WIND10M_1">(wind10tmp,znotttmp,znotmtmp,config_flags%icoef_sf)<a name='1559'>
               znotmtmp=MAX(znotmtmp,1.e-6)<a name='1560'>
               wind10new=windlmtmp*(log(10./znotmtmp))/log(DZLM/znotmtmp)<a name='1561'>
               IF (ABS(wind10new-wind10tmp) .LE. 1.e-3 ) EXIT<a name='1562'>
               wind10tmp=wind10new<a name='1563'>
               IF ( ITER .GE. 10 ) THEN<a name='1564'>
                 write(message,*) 'Warning: reached the 10th iteration step in calculating U10 from ULM'<a name='1565'>
                 CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_258">( message )<a name='1566'>
               ENDIF<a name='1567'>
             ENDDO<a name='1568'>
             grid%u10(I,J)=ULM*(log(10./znotmtmp))/log(DZLM/znotmtmp)<a name='1569'>
             grid%v10(I,J)=VLM*(log(10./znotmtmp))/log(DZLM/znotmtmp)<a name='1570'>
          ENDIF<a name='1571'>
#else<a name='1572'>
          grid%u10(I,J)=ULM<a name='1573'>
          grid%v10(I,J)=VLM<a name='1574'>
#endif<a name='1575'>
        ENDIF<a name='1576'>
<font color=#447700>!<a name='1577'></font>
<font color=#447700>!        FAC1=2./DZLM<a name='1578'></font>
<font color=#447700>!        FAC2=(DZLM-2.)/DZLM<a name='1579'></font>
<font color=#447700>!        IF(DZLM.LE.2.)THEN<a name='1580'></font>
<font color=#447700>!          FAC1=1.<a name='1581'></font>
<font color=#447700>!          FAC2=0.<a name='1582'></font>
<font color=#447700>!        ENDIF<a name='1583'></font>
<font color=#447700>!<a name='1584'></font>
        IF(.NOT.RESTRT.OR.NEST)THEN<a name='1585'>
<font color=#447700>!<a name='1586'></font>
          IF ( (THLM-grid%ths(I,J))&gt;2.0) THEN  <font color=#447700>! weight differently in different scenarios<a name='1587'></font>
            FAC1=0.3<a name='1588'>
            FAC2=0.7<a name='1589'>
          ELSE<a name='1590'>
            FAC1=0.8<a name='1591'>
            FAC2=0.2<a name='1592'>
          ENDIF<a name='1593'>
<a name='1594'>
#if ( HWRF == 1 )<a name='1595'>
          grid%tshltr(I,J)=0.2*grid%ths(I,J)+0.8*THLM<a name='1596'>
          grid%qshltr(I,J)=0.2*grid%qsh(I,J)+0.8*QLM<a name='1597'>
#else<a name='1598'>
          grid%tshltr(I,J)=FAC2*grid%ths(I,J)+FAC1*THLM<a name='1599'>
          grid%qshltr(I,J)=FAC2*grid%qsh(I,J)+FAC1*QLM<a name='1600'>
#endif<a name='1601'>
        ENDIF<a name='1602'>
<font color=#447700>!***<a name='1603'></font>
<font color=#447700>!***  NEED TO CONVERT TO THETA IF IS THE RESTART CASE<a name='1604'></font>
<font color=#447700>!***  AS CHKOUT.f WILL CONVERT TO TEMPERATURE<a name='1605'></font>
<font color=#447700>!***<a name='1606'></font>
<font color=#447700>!EROGERS: COMMENT OUT IN WRF-NMM<a name='1607'></font>
<font color=#447700>!***<a name='1608'></font>
<font color=#447700>!       IF(RESTRT)THEN<a name='1609'></font>
<font color=#447700>!         grid%tshltr(I,J)=grid%tshltr(I,J)*APELMNW<a name='1610'></font>
<font color=#447700>!       ENDIF<a name='1611'></font>
      ENDDO<a name='1612'>
      ENDDO<a name='1613'>
<a name='1614'>
      END IF <font color=#447700>! IF(allowed_to_read)THEN<a name='1615'></font>
<font color=#447700>!<a name='1616'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1617'></font>
<font color=#447700>!***  INITIALIZE TAU-1 VALUES FOR ADAMS-BASHFORTH <a name='1618'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1619'></font>
<font color=#447700>!<a name='1620'></font>
#if ( HWRF == 1 )<a name='1621'>
<font color=#447700>!zhang's doing<a name='1622'></font>
      IF(.NOT.RESTRT .OR. .NOT.allowed_to_read)THEN <font color=#447700>!zhang's doing<a name='1623'></font>
#else<a name='1624'>
      IF(.NOT.RESTRT)THEN<a name='1625'>
#endif<a name='1626'>
        DO K=KPS,KPE<a name='1627'>
          DO J=JFS,JFE<a name='1628'>
          DO I=ifs,ife<a name='1629'>
          grid%told(I,J,K)=grid%t(I,J,K)   <font color=#447700>! grid%t AT TAU-1<a name='1630'></font>
          grid%uold(I,J,K)=grid%u(I,J,K)   <font color=#447700>! grid%u AT TAU-1<a name='1631'></font>
          grid%vold(I,J,K)=grid%v(I,J,K)   <font color=#447700>! grid%v AT TAU-1<a name='1632'></font>
          ENDDO<a name='1633'>
          ENDDO<a name='1634'>
        ENDDO<a name='1635'>
      ENDIF<a name='1636'>
<font color=#447700>!<a name='1637'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1638'></font>
<font color=#447700>!***  INITIALIZE NONHYDROSTATIC QUANTITIES<a name='1639'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1640'></font>
<font color=#447700>!<a name='1641'></font>
<font color=#447700>!!!!	SHOULD grid%dwdt BE REDEFINED IF RESTRT?<a name='1642'></font>
<a name='1643'>
      if(grid%nhmove&lt;0) then<a name='1644'>
         nhki=1<a name='1645'>
         nhkj=1<a name='1646'>
      elseif(grid%nhmove&gt;0) then<a name='1647'>
         nhki=3<a name='1648'>
         nhkj=6<a name='1649'>
      endif<a name='1650'>
<a name='1651'>
      IF((.NOT.RESTRT.OR.NEST).AND. allowed_to_read)THEN <font color=#447700>! This is gopal's inclusion for moving nest<a name='1652'></font>
        DO K=KPS,KPE<a name='1653'>
          DO J=JFS,JFE<a name='1654'>
             if(grid%nhmove==0 .or. .not. nestmove .or. j&lt;nhkj+1 .or. j+nhkj&gt;jfe) then<a name='1655'>
                DO I=IFS,IFE<a name='1656'>
                   grid%dwdt(I,J,K)=1.<a name='1657'>
                ENDDO<a name='1658'>
             else<a name='1659'>
                grid%dwdt(1:nhki,j,k)=1.<a name='1660'>
                grid%dwdt(ife-nhki+1:ife,j,k)=1.<a name='1661'>
             endif<a name='1662'>
          ENDDO<a name='1663'>
        ENDDO<a name='1664'>
      ENDIF<a name='1665'>
<font color=#447700>!***<a name='1666'></font>
#if ( HWRF == 1 )<a name='1667'>
      IF(.NOT.RESTRT .OR. .NOT.allowed_to_read) THEN <font color=#447700>!zhang's doing<a name='1668'></font>
#endif<a name='1669'>
      IF(GRID%SIGMA==1)THEN<a name='1670'>
        DO J=JFS,JFE<a name='1671'>
        DO I=IFS,IFE<a name='1672'>
          grid%pdsl(I,J)=grid%pd(I,J)<a name='1673'>
        ENDDO<a name='1674'>
        ENDDO<a name='1675'>
      ELSE<a name='1676'>
        DO J=JFS,JFE<a name='1677'>
        DO I=IFS,IFE<a name='1678'>
          grid%pdsl(I,J)=grid%res(I,J)*grid%pd(I,J)<a name='1679'>
        ENDDO<a name='1680'>
        ENDDO<a name='1681'>
      ENDIF<a name='1682'>
#if ( HWRF == 1 )<a name='1683'>
      ENDIF <font color=#447700>!zhang's doing<a name='1684'></font>
#endif<a name='1685'>
<font color=#447700>!<a name='1686'></font>
<font color=#447700>!***<a name='1687'></font>
<font color=#447700>!<a name='1688'></font>
<font color=#447700>!<a name='1689'></font>
<font color=#447700>!!!!	SHOULD pint,z,w BE REDEFINED IF RESTRT?<a name='1690'></font>
<a name='1691'>
      WRITE( wrf_err_message, * )' restrt=',restrt,' nest=',nest<a name='1692'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_150">( 0, TRIM(wrf_err_message) )<a name='1693'>
      WRITE( wrf_err_message, * )' grid%pdtop=',grid%pdtop,' grid%pt=',grid%pt<a name='1694'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_151">( 0, TRIM(wrf_err_message) )<a name='1695'>
#if ( HWRF == 1 )<a name='1696'>
<font color=#447700>!zhang's doing<a name='1697'></font>
        IF(.NOT.RESTRT.OR.NEST .OR. .NOT.allowed_to_read)THEN<a name='1698'>
<font color=#447700>!end of zhang's doing<a name='1699'></font>
#else<a name='1700'>
      IF(.NOT.RESTRT.OR.NEST)THEN<a name='1701'>
#endif<a name='1702'>
#ifdef IDEAL_NMM_TC<a name='1703'>
        do k=kps,kpe<a name='1704'>
          do j=jfs,jfe<a name='1705'>
           do i=ifs,ife<a name='1706'>
             grid%f(I,J)=0.5*GRID%DT*3.15656e-5 <font color=#447700>! IDEAL CASE 0.5*DT*f (and not f!)<a name='1707'></font>
           enddo<a name='1708'>
          enddo<a name='1709'>
        enddo<a name='1710'>
#endif<a name='1711'>
        if(nestmove) then<a name='1712'>
           if(grid%nhmove==0) then<a name='1713'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_259">('Discarding non-hydrostatic state at nest move.  Set nhmove=-1 to retain the state everywhere or nhmove=1 to discard only at the boundaries.')<a name='1714'>
           elseif(grid%nhmove&gt;0) then<a name='1715'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_260">('Retaining non-hydrostatic state at nest move except at nest boundaries.')<a name='1716'>
           else<a name='1717'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_261">('Retaining non-hydrostatic state at nest move.')<a name='1718'>
           endif<a name='1719'>
        endif<a name='1720'>
<a name='1721'>
        if(grid%nhmove&lt;0) then<a name='1722'>
           nhki=1<a name='1723'>
           nhkj=1<a name='1724'>
        elseif(grid%nhmove&gt;0) then<a name='1725'>
           nhki=3<a name='1726'>
           nhkj=6<a name='1727'>
        endif<a name='1728'>
<a name='1729'>
        DO K=KPS,KPE<a name='1730'>
        DO J=JFS,JFE<a name='1731'>
           if(grid%nhmove==0 .or. .not.nestmove .or. j&lt;nhkj+1 .or. j+nhkj&gt;=jfe) then<a name='1732'>
              DO I=IFS,IFE<a name='1733'>
                 grid%pint(I,J,K)=grid%eta1(K)*grid%pdtop+grid%eta2(K)*grid%pdsl(I,J)+grid%pt<a name='1734'>
                 grid%z(I,J,K)=grid%pint(I,J,K)<a name='1735'>
                 grid%w(I,J,K)=0.<a name='1736'>
              ENDDO<a name='1737'>
           else<a name='1738'>
              <font color=#447700>! Rotated West boundary:<a name='1739'></font>
              do I=1,nhki<a name='1740'>
                 grid%pint(I,J,K)=grid%eta1(K)*grid%pdtop+grid%eta2(K)*grid%pdsl(I,J)+grid%pt<a name='1741'>
                 grid%z(I,J,K)=grid%pint(I,J,K)<a name='1742'>
                 grid%w(I,J,K)=0.<a name='1743'>
              enddo<a name='1744'>
              <font color=#447700>! Rotated East boundary:<a name='1745'></font>
              do I=ife-nhki+1,ife<a name='1746'>
                 grid%pint(I,J,K)=grid%eta1(K)*grid%pdtop+grid%eta2(K)*grid%pdsl(I,J)+grid%pt<a name='1747'>
                 grid%z(I,J,K)=grid%pint(I,J,K)<a name='1748'>
                 grid%w(I,J,K)=0.<a name='1749'>
              enddo<a name='1750'>
           endif<a name='1751'>
        ENDDO<a name='1752'>
        ENDDO<a name='1753'>
      ENDIF<a name='1754'>
#if ( HWRF == 1 )<a name='1755'>
<font color=#447700>!zhang's doing<a name='1756'></font>
      IF(.NOT.RESTRT.OR.NEST .OR. .NOT.allowed_to_read)THEN<a name='1757'>
#endif<a name='1758'>
<a name='1759'>
        DO K=KTS,KTE-1<a name='1760'>
        DO J=JFS,JFE<a name='1761'>
        DO I=IFS,IFE<a name='1762'>
          grid%rtop(I,J,K)=(grid%q(I,J,K)*P608-grid%cwm(I,J,K)+1.)*grid%t(I,J,K)*R_D/ &amp;<a name='1763'>
                      ((grid%pint(I,J,K+1)+grid%pint(I,J,K))*0.5)<a name='1764'>
        ENDDO<a name='1765'>
        ENDDO<a name='1766'>
        ENDDO<a name='1767'>
#if ( HWRF == 1 )<a name='1768'>
      ENDIF    <font color=#447700>!zhang <a name='1769'></font>
#endif<a name='1770'>
<a name='1771'>
#if ( HWRF == 1 )<a name='1772'>
      hwrfx_mslp: if(grid%vortex_tracker /= 1) then<a name='1773'>
     DO J=JFS,JFE<a name='1774'>
      DO I=IFS,IFE<a name='1775'>
         grid%Z(I,J,KFS)=grid%FIS(I,J)*GI<a name='1776'>
      ENDDO<a name='1777'>
     ENDDO<a name='1778'>
<a name='1779'>
     <font color=#447700>! Z now correctly calculated after nest move.  Needed by membrane MSLP.<a name='1780'></font>
     DO K=KFS,KFE<a name='1781'>
      DO J=JFS,JFE<a name='1782'>
       DO I=IFS,IFE<a name='1783'>
          APELP      = (grid%PINT(I,J,K+1)+grid%PINT(I,J,K))<a name='1784'>
          RTOPP      = TRG*grid%T(I,J,K)*(1.0+grid%Q(I,J,K)*P608)/APELP<a name='1785'>
          DZ         = RTOPP*(grid%DETA1(K)*grid%PDTOP+grid%DETA2(K)*grid%PD(I,J))<a name='1786'>
          grid%Z(I,J,K+1) = grid%Z(I,J,K) + DZ<a name='1787'>
       ENDDO<a name='1788'>
      ENDDO<a name='1789'>
     ENDDO<a name='1790'>
<a name='1791'>
     DO K=KFS,KFE<a name='1792'>
      DO J=JFS,JFE<a name='1793'>
       DO I=IFS,IFE<a name='1794'>
          grid%Z(i,j,k)=(grid%Z(i,j,k)+grid%Z(i,j,k+1))*0.5<a name='1795'>
       ENDDO<a name='1796'>
      ENDDO<a name='1797'>
     ENDDO<a name='1798'>
<a name='1799'>
     grid%MSLP=-9999.99<a name='1800'>
     DO J=JFS,JFE<a name='1801'>
      DO I=IFS,IFE<a name='1802'>
         SFCT      = grid%T(I,J,1)*(1.+D608*grid%Q(I,J,1)) + LAPSR*grid%Z(I,J,1)<a name='1803'>
         A         = LAPSR*grid%FIS(i,j)*gi/SFCT<a name='1804'>
         grid%MSLP(I,J) = grid%PINT(I,J,1)*(1-A)**COEF2<a name='1805'>
      ENDDO<a name='1806'>
     ENDDO<a name='1807'>
<a name='1808'>
  endif hwrfx_mslp<a name='1809'>
#endif<a name='1810'>
<a name='1811'>
<a name='1812'>
#ifndef NO_RESTRICT_ACCEL<a name='1813'>
<font color=#447700>!----------------------------------------------------------------------<a name='1814'></font>
<font color=#447700>!***  RESTRICTING THE ACCELERATION ALONG THE BOUNDARIES<a name='1815'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='1816'></font>
<font color=#447700>!<a name='1817'></font>
      DO J=JFS,JFE<a name='1818'>
      DO I=IFS,IFE<a name='1819'>
        grid%dwdtmn(I,J)=-EPSIN<a name='1820'>
        grid%dwdtmx(I,J)= EPSIN<a name='1821'>
      ENDDO<a name='1822'>
      ENDDO<a name='1823'>
<font color=#447700>!<a name='1824'></font>
<font color=#447700>!***<a name='1825'></font>
      IF(JHL&gt;1)THEN<a name='1826'>
        JHH=JDE-1-JHL+1 <font color=#447700>! JM-JHL+1<a name='1827'></font>
        IHL=JHL/2+1<a name='1828'>
<font color=#447700>!<a name='1829'></font>
        DO J=1,JHL<a name='1830'>
          IF(J&gt;=MY_JS_GLB-JBPAD2.AND.J&lt;=MY_JE_GLB+JTPAD2)THEN<a name='1831'>
            JX=J      <font color=#447700>! -MY_JS_GLB+1<a name='1832'></font>
            DO I=1,IDE-1 <font color=#447700>! IM<a name='1833'></font>
              IF(I&gt;=MY_IS_GLB-ILPAD2.AND.I&lt;=MY_IE_GLB+IRPAD2)THEN<a name='1834'>
                IX=I      <font color=#447700>! -MY_IS_GLB+1<a name='1835'></font>
                grid%dwdtmn(IX,JX)=-EPSB<a name='1836'>
                grid%dwdtmx(IX,JX)= EPSB<a name='1837'>
              ENDIF<a name='1838'>
            ENDDO<a name='1839'>
          ENDIF<a name='1840'>
        ENDDO<a name='1841'>
<font color=#447700>!<a name='1842'></font>
        DO J=JHH,JDE-1   <font color=#447700>! JM<a name='1843'></font>
          IF(J&gt;=MY_JS_GLB-JBPAD2.AND.J&lt;=MY_JE_GLB+JTPAD2)THEN<a name='1844'>
            JX=J      <font color=#447700>! -MY_JS_GLB+1<a name='1845'></font>
            DO I=1,IDE-1 <font color=#447700>! IM<a name='1846'></font>
              IF(I&gt;=MY_IS_GLB-ILPAD2.AND.I&lt;=MY_IE_GLB+IRPAD2)THEN<a name='1847'>
                IX=I      <font color=#447700>! -MY_IS_GLB+1<a name='1848'></font>
                grid%dwdtmn(IX,JX)=-EPSB<a name='1849'>
                grid%dwdtmx(IX,JX)= EPSB<a name='1850'>
              ENDIF<a name='1851'>
            ENDDO<a name='1852'>
          ENDIF<a name='1853'>
        ENDDO<a name='1854'>
<font color=#447700>!<a name='1855'></font>
        DO J=1,JDE-1 <font color=#447700>! JM<a name='1856'></font>
          IF(J&gt;=MY_JS_GLB-JBPAD2.AND.J&lt;=MY_JE_GLB+JTPAD2)THEN<a name='1857'>
            JX=J      <font color=#447700>! -MY_JS_GLB+1<a name='1858'></font>
            DO I=1,IHL<a name='1859'>
              IF(I&gt;=MY_IS_GLB-ILPAD2.AND.I&lt;=MY_IE_GLB+IRPAD2)THEN<a name='1860'>
                IX=I      <font color=#447700>! -MY_IS_GLB+1<a name='1861'></font>
                grid%dwdtmn(IX,JX)=-EPSB<a name='1862'>
                grid%dwdtmx(IX,JX)= EPSB<a name='1863'>
              ENDIF<a name='1864'>
            ENDDO<a name='1865'>
          ENDIF<a name='1866'>
        ENDDO<a name='1867'>
<font color=#447700>!<a name='1868'></font>
        DO J=1,JDE-1 <font color=#447700>! JM<a name='1869'></font>
          IF(J&gt;=MY_JS_GLB-JBPAD2.AND.J&lt;=MY_JE_GLB+JTPAD2)THEN<a name='1870'>
            JX=J      <font color=#447700>! -MY_JS_GLB+1<a name='1871'></font>
             <font color=#447700>! moved this line to inside the J-loop, 20030429, jm<a name='1872'></font>
            IHH=IDE-1-IHL+MOD(J,2) <font color=#447700>! IM-IHL+MOD(J,2)<a name='1873'></font>
            DO I=IHH,IDE-1 <font color=#447700>! IM<a name='1874'></font>
              IF(I&gt;=MY_IS_GLB-ILPAD2.AND.I&lt;=MY_IE_GLB+IRPAD2)THEN<a name='1875'>
                IX=I      <font color=#447700>! -MY_IS_GLB+1<a name='1876'></font>
                grid%dwdtmn(IX,JX)=-EPSB<a name='1877'>
                grid%dwdtmx(IX,JX)= EPSB<a name='1878'>
              ENDIF<a name='1879'>
            ENDDO<a name='1880'>
          ENDIF<a name='1881'>
        ENDDO<a name='1882'>
<font color=#447700>!<a name='1883'></font>
      ENDIF<a name='1884'>
<a name='1885'>
#else<a name='1886'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_262">('start_domain_nmm: NO_RESTRICT_ACCEL')<a name='1887'>
#endif<a name='1888'>
<a name='1889'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1890'></font>
<font color=#447700>!***  CALL THE GENERAL PHYSICS INITIALIZATION<a name='1891'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='1892'></font>
<font color=#447700>!<a name='1893'></font>
<a name='1894'>
      ALLOCATE(SFULL(KMS:KME),STAT=I)           ; SFULL    = 0.<a name='1895'>
      ALLOCATE(SMID(KMS:KME),STAT=I)            ; SMID     = 0.<a name='1896'>
      ALLOCATE(EMISS(IMS:IME,JMS:JME),STAT=I)   ; EMISS    = 0.<a name='1897'>
      ALLOCATE(EMTEMP(IMS:IME,JMS:JME),STAT=I)  ; EMTEMP   = 0.<a name='1898'>
      ALLOCATE(GLW(IMS:IME,JMS:JME),STAT=I)     ; GLW      = 0.<a name='1899'>
      ALLOCATE(HFX(IMS:IME,JMS:JME),STAT=I)     ; HFX      = 0.<a name='1900'>
      ALLOCATE(LOWLYR(IMS:IME,JMS:JME),STAT=I)  ; LOWLYR   = 0.<a name='1901'>
<font color=#447700>!     ALLOCATE(grid%mavail(IMS:IME,JMS:JME),STAT=I)  ; grid%mavail   = 0.<a name='1902'></font>
      ALLOCATE(NCA(IMS:IME,JMS:JME),STAT=I)     ; NCA      = 0.<a name='1903'>
      ALLOCATE(QFX(IMS:IME,JMS:JME),STAT=I)     ; QFX      = 0.<a name='1904'>
      ALLOCATE(RAINBL(IMS:IME,JMS:JME),STAT=I)  ; RAINBL   = 0.<a name='1905'>
      ALLOCATE(RAINC(IMS:IME,JMS:JME),STAT=I)   ; RAINC    = 0.<a name='1906'>
      ALLOCATE(RAINNC(IMS:IME,JMS:JME),STAT=I)  ; RAINNC   = 0.<a name='1907'>
      ALLOCATE(RAINNCV(IMS:IME,JMS:JME),STAT=I) ; RAINNCV  = 0.<a name='1908'>
      ALLOCATE(SNOWNC(IMS:IME,JMS:JME),STAT=I)  ; SNOWNC   = 0.<a name='1909'>
      ALLOCATE(SNOWNCV(IMS:IME,JMS:JME),STAT=I) ; SNOWNCV  = 0.<a name='1910'>
      ALLOCATE(GRAUPELNC(IMS:IME,JMS:JME),STAT=I)  ; GRAUPELNC   = 0.<a name='1911'>
      ALLOCATE(GRAUPELNCV(IMS:IME,JMS:JME),STAT=I) ; GRAUPELNCV  = 0.<a name='1912'>
<a name='1913'>
      ALLOCATE(ZS(KMS:KME),STAT=I)              ; ZS       = 0.<a name='1914'>
      ALLOCATE(SNOWC(IMS:IME,JMS:JME),STAT=I)   ; SNOWC    = 0.<a name='1915'>
      ALLOCATE(THC(IMS:IME,JMS:JME),STAT=I)     ; THC      = 0.<a name='1916'>
      ALLOCATE(TMN(IMS:IME,JMS:JME),STAT=I)     ; TMN      = 0.<a name='1917'>
      ALLOCATE(TSFC(IMS:IME,JMS:JME),STAT=I)    ; TSFC     = 0.<a name='1918'>
      ALLOCATE(Z0_DUM(IMS:IME,JMS:JME),STAT=I)  ; Z0_DUM   = 0.<a name='1919'>
      ALLOCATE(ALBEDO_DUM(IMS:IME,JMS:JME),STAT=I)  ; ALBEDO_DUM   = 0.<a name='1920'>
<a name='1921'>
      ALLOCATE(DZS(KMS:KME),STAT=I)                         ; DZS = 0.<a name='1922'>
      ALLOCATE(RQCBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQCBLTEN = 0.<a name='1923'>
      ALLOCATE(RQIBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQIBLTEN = 0.<a name='1924'>
      ALLOCATE(RQVBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQVBLTEN =  0.<a name='1925'>
      ALLOCATE(RTHBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RTHBLTEN =  0.<a name='1926'>
      ALLOCATE(RUBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ; RUBLTEN = 0.<a name='1927'>
      ALLOCATE(RVBLTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ; RVBLTEN = 0.<a name='1928'>
      ALLOCATE(RQCCUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQCCUTEN = 0.<a name='1929'>
      ALLOCATE(RQICUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQICUTEN  = 0.<a name='1930'>
      ALLOCATE(RQRCUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQRCUTEN = 0.<a name='1931'>
      ALLOCATE(RQSCUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQSCUTEN = 0.<a name='1932'>
      ALLOCATE(RQVCUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQVCUTEN = 0.<a name='1933'>
      ALLOCATE(RTHCUTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RTHCUTEN = 0.<a name='1934'>
      ALLOCATE(RUSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ; RUSHTEN = 0.<a name='1935'>
      ALLOCATE(RVSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ; RVSHTEN = 0.<a name='1936'>
      ALLOCATE(RQCSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQCSHTEN = 0.<a name='1937'>
      ALLOCATE(RQISHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQISHTEN  = 0.<a name='1938'>
      ALLOCATE(RQRSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQRSHTEN = 0.<a name='1939'>
      ALLOCATE(RQSSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQSSHTEN = 0.<a name='1940'>
      ALLOCATE(RQGSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQGSHTEN = 0.<a name='1941'>
      ALLOCATE(RQVSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RQVSHTEN = 0.<a name='1942'>
      ALLOCATE(RTHSHTEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RTHSHTEN = 0.<a name='1943'>
      ALLOCATE(RTHRATEN(IMS:IME,KMS:KME,JMS:JME),STAT=I)    ; RTHRATEN  = 0.<a name='1944'>
      ALLOCATE(RTHRATENLW(IMS:IME,KMS:KME,JMS:JME),STAT=I)  ; RTHRATENLW = 0.<a name='1945'>
      ALLOCATE(RTHRATENSW(IMS:IME,KMS:KME,JMS:JME),STAT=I)  ; RTHRATENSW = 0.<a name='1946'>
      ALLOCATE(ZINT(IMS:IME,KMS:KME,JMS:JME),STAT=I)        ; ZINT = 0.<a name='1947'>
      ALLOCATE(CONVFAC(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ; CONVFAC = 0.<a name='1948'>
      ALLOCATE(PINT_TRANS(IMS:IME,KMS:KME,JMS:JME),STAT=I)  ; PINT_TRANS = 0.<a name='1949'>
      ALLOCATE(T_TRANS(IMS:IME,KMS:KME,JMS:JME),STAT=I)     ;  T_TRANS = 0.<a name='1950'>
      ALLOCATE(RRI(IMS:IME,KMS:KME,JMS:JME),STAT=I)         ;  RRI = 0.<a name='1951'>
      ALLOCATE(CLDFRA_TRANS(IMS:IME,KMS:KME,JMS:JME),STAT=I); CLDFRA_TRANS = 0.<a name='1952'>
      ALLOCATE(SCALAR_TRANS(IMS:IME,KMS:KME,JMS:JME,NUM_SCALAR),STAT=I)<a name='1953'>
      ALLOCATE(CLDFRA_OLD(IMS:IME,KMS:KME,JMS:JME),STAT=I)  ; CLDFRA_OLD = 0.<a name='1954'>
      ALLOCATE(Z_AT_Q(IMS:IME,KMS:KME,JMS:JME),STAT=I)      ; z_at_q = 0.<a name='1955'>
#if 0<a name='1956'>
      ALLOCATE(w0avg(IMS:IME,KMS:KME,JMS:JME),STAT=I)       ; w0avg = 0.<a name='1957'>
#endif<a name='1958'>
<font color=#447700>!-----------------------------------------------------------------------<a name='1959'></font>
<font color=#447700>!jm added set of g_inv<a name='1960'></font>
      G_INV=1./G<a name='1961'>
      ROG=R_D*G_INV<a name='1962'>
      GRID%RADT=GRID%NRADS*GRID%DT/60.<a name='1963'>
      GRID%BLDT=GRID%NPHS*GRID%DT/60.<a name='1964'>
      GRID%CUDT=GRID%NCNVC*GRID%DT/60.<a name='1965'>
      GRID%GSMDT=GRID%NPHS*GRID%DT/60.<a name='1966'>
<font color=#447700>!<a name='1967'></font>
<font color=#447700>! translate scalar(i,j,k,n) to scalar_trans(i,k,j,n)<a name='1968'></font>
        DO N=1,NUM_SCALAR<a name='1969'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='1970'></font>
<font color=#447700>!$omp&amp; private(i,j,k)<a name='1971'></font>
          DO K=KMS,KME<a name='1972'>
          DO J=JMS,JME<a name='1973'>
          DO I=IMS,IME<a name='1974'>
            SCALAR_TRANS(I,K,J,N)=SCALAR(I,J,K,N)<a name='1975'>
          ENDDO<a name='1976'>
          ENDDO<a name='1977'>
          ENDDO<a name='1978'>
        ENDDO<a name='1979'>
<font color=#447700>!<a name='1980'></font>
      DO J=MYJS,MYJE<a name='1981'>
      DO I=MYIS,MYIE<a name='1982'>
        SFCZ=grid%fis(I,J)*G_INV<a name='1983'>
        ZINT(I,KTS,J)=SFCZ<a name='1984'>
#if ( HWRF == 1 )<a name='1985'>
<font color=#447700>!zhang's doing<a name='1986'></font>
        IF(.NOT.RESTRT .OR. .NOT.allowed_to_read) then<a name='1987'>
        grid%PDSL(I,J)=grid%PD(I,J)*grid%RES(I,J)<a name='1988'>
        endif<a name='1989'>
<font color=#447700>!end of zhang's doing<a name='1990'></font>
#else<a name='1991'>
        grid%pdsl(I,J)=grid%pd(I,J)*grid%res(I,J)<a name='1992'>
#endif<a name='1993'>
        PSURF=grid%pint(I,J,KTS)<a name='1994'>
        EXNSFC=(1.E5/PSURF)**CAPA<a name='1995'>
        grid%xland(I,J)=grid%sm(I,J)+1.<a name='1996'>
        THSIJ=(grid%sst(I,J)*EXNSFC)*(grid%xland(I,J)-1.)                         &amp;<a name='1997'>
     &amp;        +grid%ths(I,J)*(2.-grid%sm(I,J))<a name='1998'>
        TSFC(I,J)=THSIJ/EXNSFC<a name='1999'>
<font color=#447700>!<a name='2000'></font>
        DO K=KTS,KTE-1<a name='2001'>
          PLYR=(grid%pint(I,J,K)+grid%pint(I,J,K+1))*0.5<a name='2002'>
          TL=grid%t(I,J,K)<a name='2003'>
          CWML=grid%cwm(I,J,K)<a name='2004'>
          RRI(I,K,J)=R_D*TL*(1.+P608*grid%q(I,J,K))/PLYR<a name='2005'>
          ZINT(I,K+1,J)=ZINT(I,K,J)+TL/PLYR                             &amp; <a name='2006'>
                     *(grid%deta1(K)*grid%pdtop+grid%deta2(K)*grid%pdsl(I,J))*ROG        &amp; <a name='2007'>
                     *(grid%q(I,J,K)*P608-CWML+1.)<a name='2008'>
        ENDDO<a name='2009'>
<font color=#447700>!<a name='2010'></font>
<font color=#447700>!        DO K=KTS,KTE<a name='2011'></font>
<font color=#447700>!!!       ZMID(I,K,J)=0.5*(ZINT(I,K,J)+ZINT(I,K+1,J))<a name='2012'></font>
<font color=#447700>!        ENDDO<a name='2013'></font>
      ENDDO<a name='2014'>
      ENDDO<a name='2015'>
<font color=#447700>!<a name='2016'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2017'></font>
<font color=#447700>!***  RECREATE SIGMA VALUES AT LAYER INTERFACES FOR THE FULL VERTICAL<a name='2018'></font>
<font color=#447700>!***  DOMAIN FROM THICKNESS VALUES FOR THE TWO SUBDOMAINS.<a name='2019'></font>
<font color=#447700>!***  NOTE: KTE=NUMBER OF LAYERS PLUS ONE<a name='2020'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2021'></font>
<font color=#447700>!<a name='2022'></font>
      PDTOT=101325.-grid%pt<a name='2023'>
      RPDTOT=1./PDTOT<a name='2024'>
      PDBOT=PDTOT-grid%pdtop<a name='2025'>
      SFULL(KTS)=1.<a name='2026'>
      SFULL(KTE)=0.<a name='2027'>
      DSIGSUM = 0.<a name='2028'>
      DO K=KTS+1,KTE<a name='2029'>
        DSIG=(grid%deta1(K-1)*grid%pdtop+grid%deta2(K-1)*PDBOT)*RPDTOT<a name='2030'>
        DSIGSUM=DSIGSUM+DSIG<a name='2031'>
        SFULL(K)=SFULL(K-1)-DSIG<a name='2032'>
        SMID(K-1)=0.5*(SFULL(K-1)+SFULL(K))<a name='2033'>
      ENDDO<a name='2034'>
      DSIG=(grid%deta1(KTE-1)*grid%pdtop+grid%deta2(KTE-1)*PDBOT)*RPDTOT<a name='2035'>
      DSIGSUM=DSIGSUM+DSIG<a name='2036'>
      SMID(KTE-1)=0.5*(SFULL(KTE-1)+SFULL(KTE))<a name='2037'>
<font color=#447700>!<a name='2038'></font>
<font color=#447700>!-----------------------------------------------------------------------<a name='2039'></font>
<a name='2040'>
#if ( HWRF == 1 )<a name='2041'>
<font color=#447700>!zhang's doing<a name='2042'></font>
      if(.NOT.RESTRT .OR. .NOT.allowed_to_read)grid%LU_INDEX=grid%IVGTYP<a name='2043'>
<font color=#447700>!end of zhang's doing<a name='2044'></font>
#else<a name='2045'>
      grid%lu_index=grid%ivgtyp<a name='2046'>
#endif<a name='2047'>
<a name='2048'>
      IF(.NOT.RESTRT)THEN<a name='2049'>
        DO J=MYJS,MYJE<a name='2050'>
        DO I=MYIS,MYIE<a name='2051'>
          Z0_DUM(I,J)=grid%z0(I,J) <font color=#447700>! hold<a name='2052'></font>
          ALBEDO_DUM(I,J)=grid%albedo(I,J) <font color=#447700>! Save albedos<a name='2053'></font>
        ENDDO<a name='2054'>
        ENDDO<a name='2055'>
      ENDIF<a name='2056'>
<font color=#447700>!<a name='2057'></font>
<font color=#447700>!***  Always define the quantity grid%z0base<a name='2058'></font>
                                                                                                                                              <a name='2059'>
4041  format('Bounds: ip=',I0,',',I0,' jp=',I0,',',I0,' myi=',I0,',',I0,&amp;<a name='2060'>
             ' myj=',I0,',',I0)<a name='2061'>
      write(message,4041) ips,ipe,jps,jpe,myis,myie,myjs,myje<a name='2062'>
      call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_263">(message)<a name='2063'>
<a name='2064'>
      IF(.NOT.RESTRT)THEN<a name='2065'>
        DO J=MYJS,MYJE<a name='2066'>
        DO I=MYIS,MYIE<a name='2067'>
<font color=#447700>!<a name='2068'></font>
          IF(grid%sm(I,J)==0)then<a name='2069'>
            grid%z0base(I,J)=VZ0TBL_24(grid%ivgtyp(I,J))+Z0LAND<a name='2070'>
          ELSE<a name='2071'>
            grid%z0base(I,J)=VZ0TBL_24(grid%ivgtyp(I,J))+Z0SEA<a name='2072'>
          ENDIF<a name='2073'>
<font color=#447700>!<a name='2074'></font>
        ENDDO<a name='2075'>
        ENDDO<a name='2076'>
      ENDIF<a name='2077'>
<font color=#447700>!<a name='2078'></font>
<font color=#447700>! when allocating CAM radiation 4d arrays (ozmixm, aerosolc) these are not needed<a name='2079'></font>
      num_aerosolc=1<a name='2080'>
<a name='2081'>
<font color=#447700>! Set GMT, JULDAY, and JULYR outside of phy_init because it is no longer <a name='2082'></font>
<font color=#447700>! called inside phy_init due to moving nest changes.  (When nests move <a name='2083'></font>
<font color=#447700>! phy_init may not be called on a process if, for example, it is a moving <a name='2084'></font>
<font color=#447700>! nest and if this part of the domain is not being initialized (not the <a name='2085'></font>
<font color=#447700>! leading edge).)  Calling domain_setgmtetc() here will avoid this problem <a name='2086'></font>
<font color=#447700>! when NMM moves to moving nests.  <a name='2087'></font>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC'>domain_setgmtetc</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_SETGMTETC_2">( GRID, START_OF_SIMULATION )<a name='2088'>
<a name='2089'>
      if(restrt) then<a name='2090'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_10">( grid, current_time=currentTime )<a name='2091'>
        CALL WRFU_TimeGet( currentTime, YY=grid%julyr, dayOfYear=grid%julday, &amp;<a name='2092'>
                           H=hr, M=mn, S=sec, MS=ms, rc=rc)<a name='2093'>
        grid%gmt=hr+real(mn)/60.+real(sec)/3600.+real(ms)/(1000*3600)<a name='2094'>
        WRITE( wrf_err_message , * ) 'DEBUG start_domain_nmm():  gmt = ',grid%gmt<a name='2095'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_152">( 150, TRIM(wrf_err_message) )<a name='2096'>
      endif<a name='2097'>
<a name='2098'>
<font color=#447700>! Several arguments are RCONFIG entries in Registry.NMM. Registry no longer<a name='2099'></font>
<font color=#447700>! includes these as dummy arguments or declares them.  Access them from <a name='2100'></font>
<font color=#447700>! GRID.  JM 20050819<a name='2101'></font>
#ifndef WRF_NMM_NEST<a name='2102'>
    <font color=#447700>! NOTE: we always get here for all NMM configurations because the<a name='2103'></font>
    <font color=#447700>!       #if condition is wrong.  Leaving this as is, just in case<a name='2104'></font>
    <font color=#447700>!       there was a good reason for it.<a name='2105'></font>
      grid%moved = .FALSE.<a name='2106'>
#endif<a name='2107'>
<a name='2108'>
      IF (GRID%RESTART) THEN<a name='2109'>
         LRESTART = GRID%RESTART<a name='2110'>
      ELSE<a name='2111'>
         IF (grid%moved) THEN<a name='2112'>
            LRESTART = .TRUE.<a name='2113'>
         ELSE<a name='2114'>
            LRESTART = .FALSE.<a name='2115'>
         ENDIF<a name='2116'>
      END IF<a name='2117'>
<a name='2118'>
      if(allowed_to_read) then<a name='2119'>
         call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_153">(1,'Set E grid locations for PHY_INIT.')<a name='2120'>
         if(grid%id==1) then<a name='2121'>
            call <A href='../../html_code/dyn_nmm/NMM_NEST_UTILS1.F.html#MED_SET_EGRID_LOCS'>med_set_egrid_locs</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SET_EGRID_LOCS_1">(grid,grid)<a name='2122'>
         else<a name='2123'>
            call <A href='../../html_code/dyn_nmm/NMM_NEST_UTILS1.F.html#MED_SET_EGRID_LOCS'>med_set_egrid_locs</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_SET_EGRID_LOCS_2">(grid%parents(1)%ptr,grid)<a name='2124'>
         endif<a name='2125'>
      end if<a name='2126'>
      CALL <A href='../../html_code/phys/module_physics_init.F.html#PHY_INIT'>PHY_INIT</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="PHY_INIT_2">(GRID%ID,CONFIG_FLAGS,GRID%DT,LRESTART,SFULL,SMID    &amp;<a name='2127'>
     &amp;             ,grid%pt,TSFC,GRID%RADT,GRID%BLDT,GRID%CUDT,GRID%GSMDT    &amp;<a name='2128'>
     &amp;             ,grid%DUCUDT, grid%DVCUDT                            &amp;<a name='2129'>
     &amp;             ,RTHCUTEN, RQVCUTEN, RQRCUTEN                        &amp;<a name='2130'>
     &amp;             ,RQCCUTEN, RQSCUTEN, RQICUTEN                        &amp;<a name='2131'>
     &amp;             ,RUSHTEN,  RVSHTEN,  RTHSHTEN                        &amp;<a name='2132'>
     &amp;             ,RQVSHTEN, RQRSHTEN, RQCSHTEN                        &amp;<a name='2133'>
     &amp;             ,RQSSHTEN, RQISHTEN, RQGSHTEN                        &amp;<a name='2134'>
     &amp;             ,RUBLTEN,RVBLTEN,RTHBLTEN                            &amp;<a name='2135'>
     &amp;             ,RQVBLTEN,RQCBLTEN,RQIBLTEN                          &amp;<a name='2136'>
     &amp;             ,RTHRATEN,RTHRATENLW,RTHRATENSW                      &amp;<a name='2137'>
     &amp;             ,STEPBL,STEPRA,STEPCU                                &amp;<a name='2138'>
     &amp;             ,grid%w0avg, RAINNC, RAINC, grid%raincv, RAINNCV               &amp;<a name='2139'>
     &amp;             ,SNOWNC, SNOWNCV, GRAUPELNC, GRAUPELNCV              &amp;<a name='2140'>
     &amp;             ,z_at_q, grid%qnwfa2d                                &amp;<a name='2141'>
<font color=#447700>!     &amp;             ,scalar_trans(ims,kms,jms,1),num_scalar              &amp;<a name='2142'></font>
     &amp;             ,scalar_trans,num_scalar              &amp;<a name='2143'>
     &amp;             ,grid%re_cloud, grid%re_ice, grid%re_snow            &amp; <font color=#447700>! G. Thompson<a name='2144'></font>
     &amp;             ,grid%has_reqc,grid%has_reqi,grid%has_reqs           &amp; <font color=#447700>! G. Thompson<a name='2145'></font>
     &amp;             ,NCA,GRID%SWRAD_SCAT                                 &amp;<a name='2146'>
     &amp;             ,grid%cldefi,LOWLYR                                       &amp;<a name='2147'>
     &amp;             ,grid%mass_flux                                           &amp;<a name='2148'>
     &amp;             ,grid%rthften, grid%rqvften                                    &amp;<a name='2149'>
     &amp;             ,CLDFRA_TRANS,CLDFRA_OLD,GLW,grid%gsw,EMISS,EMTEMP,grid%lu_index&amp;<a name='2150'>
     &amp;             ,GRID%LANDUSE_ISICE, GRID%LANDUSE_LUCATS             &amp;<a name='2151'>
     &amp;             ,GRID%LANDUSE_LUSEAS, GRID%LANDUSE_ISN               &amp;<a name='2152'>
     &amp;             ,GRID%LU_STATE                                       &amp;<a name='2153'>
     &amp;             ,grid%hlat,grid%hlon,grid%glat,grid%glon&amp;<a name='2154'>
     &amp;             ,grid%albedo,grid%albbck                             &amp;<a name='2155'>
     &amp;             ,GRID%GMT,GRID%JULYR,GRID%JULDAY                     &amp;<a name='2156'>
     &amp;             ,GRID%LEVSIZ, NUM_OZMIXM, NUM_AEROSOLC, GRID%PAERLEV &amp;<a name='2157'>
     &amp;             ,grid%alevsiz, grid%no_src_types                     &amp;<a name='2158'>
     &amp;             ,TMN,grid%xland,grid%znt,grid%z0,grid%ustar,grid%mol,grid%pblh,grid%tke_pbl             &amp;<a name='2159'>
     &amp;             ,grid%exch_h,THC,SNOWC,grid%mavail,HFX,QFX,RAINBL              &amp;<a name='2160'>
     &amp;             ,grid%stc,grid%sldpth,grid%DZSoil,GRID%NUM_SOIL_LAYERS,WARM_RAIN           &amp;<a name='2161'>
     &amp;             ,ADV_MOIST_COND,IS_CAMMGMP_USED                      &amp;<a name='2162'>
     &amp;             ,grid%apr_gr,grid%apr_w,grid%apr_mc,grid%apr_st,grid%apr_as                   &amp;<a name='2163'>
     &amp;             ,grid%apr_capma,grid%apr_capme,grid%apr_capmi                       &amp;<a name='2164'>
     &amp;             ,grid%xice,grid%xice,grid%vegfra,grid%snow,grid%canwat,grid%smstav                 &amp;<a name='2165'>
     &amp;             ,grid%smstot, grid%sfcrunoff,grid%udrunoff,grid%grdflx,grid%acsnow            &amp;<a name='2166'>
     &amp;             ,grid%acsnom,grid%ivgtyp,grid%isltyp,grid%sfcevp,grid%smc                     &amp;<a name='2167'>
     &amp;             ,grid%sh2o, grid%snowh, grid%smfr3d                                 &amp;  <font color=#447700>! temporary<a name='2168'></font>
     &amp;             ,grid%SNOALB                                         &amp;<a name='2169'>
     &amp;             ,GRID%DX,GRID%DY,grid%f_ice_phy,grid%f_rain_phy,grid%f_rimef_phy    &amp;<a name='2170'>
     &amp;             ,grid%mp_restart_state,grid%tbpvs_state,grid%tbpvs0_state           &amp;<a name='2171'>
     &amp;             ,ALLOWED_TO_READ,grid%moved,START_OF_SIMULATION                    &amp;<a name='2172'>
     &amp;             ,1                                                   &amp; <font color=#447700>! lagday<a name='2173'></font>
     &amp;             ,IDS, IDE, JDS, JDE, KDS, KDE                        &amp;<a name='2174'>
     &amp;             ,IMS, IME, JMS, JME, KMS, KME                        &amp;<a name='2175'>
     &amp;             ,ITS, ITE, JTS, JTE, KTS, KTE                        &amp;<a name='2176'>
     &amp;             ,NUM_URBAN_LAYERS,NUM_URBAN_HI                       &amp;<a name='2177'>
     &amp;             ,GRID%RAINCV_A,GRID%RAINCV_B                         &amp;<a name='2178'>
     &amp;               ,ISNOWXY=grid%ISNOWXY, ZSNSOXY=grid%ZSNSOXY, TSNOXY=grid%TSNOXY,    &amp; <font color=#447700>! Optional Noah-MP<a name='2179'></font>
     &amp;                SNICEXY=grid%SNICEXY, SNLIQXY=grid%SNLIQXY, TVXY=grid%TVXY,        &amp; <font color=#447700>! Optional Noah-MP<a name='2180'></font>
     &amp;                TGXY=grid%TGXY, CANICEXY=grid%CANICEXY,                            &amp; <font color=#447700>! Optional Noah-MP<a name='2181'></font>
     &amp;                CANLIQXY=grid%CANLIQXY, EAHXY=grid%EAHXY,                          &amp; <font color=#447700>! Optional Noah-MP<a name='2182'></font>
     &amp;                TAHXY=grid%TAHXY, CMXY=grid%CMXY,                                  &amp; <font color=#447700>! Optional Noah-MP<a name='2183'></font>
     &amp;                CHXY=grid%CHXY, FWETXY=grid%FWETXY, SNEQVOXY=grid%SNEQVOXY,        &amp; <font color=#447700>! Optional Noah-MP<a name='2184'></font>
     &amp;                ALBOLDXY=grid%ALBOLDXY, QSNOWXY=grid%QSNOWXY,                      &amp; <font color=#447700>! Optional Noah-MP<a name='2185'></font>
     &amp;                WSLAKEXY=grid%WSLAKEXY, ZWTXY=grid%ZWTXY, WAXY=grid%WAXY,          &amp; <font color=#447700>! Optional Noah-MP<a name='2186'></font>
     &amp;                WTXY=grid%WTXY, LFMASSXY=grid%LFMASSXY, RTMASSXY=grid%RTMASSXY,    &amp; <font color=#447700>! Optional Noah-MP<a name='2187'></font>
     &amp;                STMASSXY=grid%STMASSXY, WOODXY=grid%WOODXY,                        &amp; <font color=#447700>! Optional Noah-MP<a name='2188'></font>
     &amp;                GRAINXY=grid%GRAINXY, GDDXY=grid%GDDXY,                            &amp; <font color=#447700>! Optional Noah-MP<a name='2189'></font>
     &amp;                CROPTYPE=grid%CROPTYPE, CROPCAT=grid%CROPCAT,                      &amp; <font color=#447700>! Optional Noah-MP<a name='2190'></font>
     &amp;                STBLCPXY=grid%STBLCPXY, FASTCPXY=grid%FASTCPXY,                    &amp; <font color=#447700>! Optional Noah-MP<a name='2191'></font>
     &amp;                XSAIXY=grid%XSAIXY,LAI=grid%LAI,                                   &amp; <font color=#447700>! Optional Noah-MP<a name='2192'></font>
     &amp;                T2MVXY=grid%T2MVXY, T2MBXY=grid%T2MBXY, CHSTARXY=grid%CHSTARXY,    &amp; <font color=#447700>! Optional Noah-MP<a name='2193'></font>
     &amp;                smoiseq=grid%smoiseq, smcwtdxy=grid%smcwtdxy, rechxy=grid%rechxy,   &amp;<a name='2194'>
     &amp;                deeprechxy=grid%deeprechxy,                                         &amp;<a name='2195'>
     &amp;                lakedepth2d=grid%lakedepth2d,  savedtke12d=grid%savedtke12d,  snowdp2d=grid%snowdp2d,   h2osno2d=grid%h2osno2d,               &amp; <font color=#447700>!lake<a name='2196'></font>
     &amp;                snl2d= grid%snl2d, t_grnd2d=grid%t_grnd2d, t_lake3d=grid%t_lake3d, lake_icefrac3d=grid%lake_icefrac3d,                        &amp; <font color=#447700>!lake<a name='2197'></font>
     &amp;                z_lake3d=grid%z_lake3d, dz_lake3d=grid%dz_lake3d, t_soisno3d=grid%t_soisno3d, h2osoi_ice3d=grid%h2osoi_ice3d,                 &amp; <font color=#447700>!lake<a name='2198'></font>
     &amp;                h2osoi_liq3d=grid%h2osoi_liq3d, h2osoi_vol3d=grid%h2osoi_vol3d, z3d=grid%z3d, dz3d=grid%dz3d,                                 &amp; <font color=#447700>!lake<a name='2199'></font>
     &amp;                zi3d=grid%zi3d, watsat3d=grid%watsat3d, csol3d=grid%csol3d, tkmg3d=grid%tkmg3d,                                               &amp; <font color=#447700>!lake<a name='2200'></font>
     &amp;                tkdry3d=grid%tkdry3d, tksatu3d=grid%tksatu3d, lake2d=grid%lake2d,                                                             &amp; <font color=#447700>!lake<a name='2201'></font>
     &amp;                lakedepth_default=config_flags%lakedepth_default, lake_min_elev=config_flags%lake_min_elev, lake_depth=grid%lake_depth,               &amp; <font color=#447700>!lake<a name='2202'></font>
     &amp;                lake_depth_flag=grid%LAKE_DEPTH_FLAG, use_lakedepth=grid%use_lakedepth,                                                      &amp; <font color=#447700>!lake<a name='2203'></font>
     &amp;                sf_surface_mosaic=config_flags%sf_surface_mosaic, mosaic_cat=config_flags%mosaic_cat, nlcat=1,     &amp; <font color=#447700>! Noah tiling<a name='2204'></font>
     &amp;                nssl_cccn=config_flags%nssl_cccn,                                 &amp;<a name='2205'>
     &amp;                nssl_alphah=config_flags%nssl_alphah, nssl_alphahl=config_flags%nssl_alphahl,    &amp;<a name='2206'>
     &amp;                nssl_cnoh=config_flags%nssl_cnoh, nssl_cnohl=config_flags%nssl_cnohl,        &amp;<a name='2207'>
     &amp;                nssl_cnor=config_flags%nssl_cnor, nssl_cnos=config_flags%nssl_cnos,         &amp;<a name='2208'>
     &amp;                nssl_rho_qh=config_flags%nssl_rho_qh, nssl_rho_qhl=config_flags%nssl_rho_qhl,    &amp;<a name='2209'>
     &amp;                nssl_rho_qs=config_flags%nssl_rho_qs,                               &amp;<a name='2210'>
     &amp;                nssl_ipelec=config_flags%nssl_ipelec,                               &amp;<a name='2211'>
     &amp;                nssl_isaund=config_flags%nssl_isaund,                               &amp; <a name='2212'>
     &amp;                MAXPATCH=1,ccn_conc=config_flags%ccn_conc, &amp; <font color=#447700>! CLM<a name='2213'></font>
     &amp;                pin=grid%pin,ozmixm=grid%ozmixm &amp;<a name='2214'>
     &amp;                )<a name='2215'>
<a name='2216'>
#if ( HWRF == 1 )<a name='2217'>
<font color=#447700>!zhang's doing<a name='2218'></font>
      grid%julyr_rst=grid%julyr_rst<a name='2219'>
      grid%julday_rst=grid%julday_rst<a name='2220'>
      grid%gmt_rst=grid%gmt_rst<a name='2221'>
<font color=#447700>!end of zhang's doing<a name='2222'></font>
#endif<a name='2223'>
<a name='2224'>
<font color=#447700>!<a name='2225'></font>
<font color=#447700>! computes ct and ct2 for topo_wind=1 or topo_wind=2<a name='2226'></font>
<font color=#447700>! NOTE: not yet implemented for NMM: =1.0 will have no effect<a name='2227'></font>
<font color=#447700>!<a name='2228'></font>
       grid%ctopo=1.<a name='2229'>
       grid%ctopo2=1.<a name='2230'>
<font color=#447700>!<a name='2231'></font>
<a name='2232'>
<font color=#447700>!-----------------------------------------------------------------------<a name='2233'></font>
<font color=#447700>!---- Initialization for gravity wave drag (GWD) &amp; mountain blocking (MB)<a name='2234'></font>
<font color=#447700>!<a name='2235'></font>
#if (HWRF == 1)<a name='2236'>
   IF(grid%gwd_opt .eq. 2 .AND. grid%id .eq. 1 .AND. allowed_to_read) THEN<a name='2237'>
#else<a name='2238'>
   IF(grid%gwd_opt .eq. 2 ) THEN<a name='2239'>
#endif<a name='2240'>
        CALL nl_get_cen_lat(GRID%ID, CEN_LAT)    <font color=#447700>!-- CEN_LAT in deg<a name='2241'></font>
        CALL nl_get_cen_lon(GRID%ID, CEN_LON)    <font color=#447700>!-- CEN_LON in deg<a name='2242'></font>
        DTPHS=grid%dt*grid%nphs<a name='2243'>
        CALL <A href='../../html_code/dyn_nmm/module_GWD.F.html#GWD_INIT'>GWD_init</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GWD_INIT_1">(DTPHS,GRID%DX,GRID%DY,CEN_LAT,CEN_LON,RESTRT        &amp;<a name='2244'>
     &amp;              ,grid%glat,grid%glon,grid%crot,grid%srot,grid%hangl                          &amp;<a name='2245'>
     &amp;              ,IDS,IDE,JDS,JDE,KDS,KDE                            &amp;<a name='2246'>
     &amp;              ,IMS,IME,JMS,JME,KMS,KME                            &amp;<a name='2247'>
     &amp;              ,ITS,ITE,JTS,JTE,KTS,KTE )<a name='2248'>
      ENDIF<a name='2249'>
      IF(.NOT.RESTRT)THEN<a name='2250'>
        DO J=MYJS,MYJE<a name='2251'>
        DO I=MYIS,MYIE<a name='2252'>
          grid%ugwdsfc(I,J)=0.<a name='2253'>
          grid%vgwdsfc(I,J)=0.<a name='2254'>
        ENDDO<a name='2255'>
        ENDDO<a name='2256'>
      ENDIF<a name='2257'>
<a name='2258'>
<font color=#447700>!-----------------------------------------------------------------------<a name='2259'></font>
<font color=#447700>!<a name='2260'></font>
#if ( HWRF == 1 )<a name='2261'>
      IF(NSTART.EQ.0 .or. .not.allowed_to_read )THEN<a name='2262'>
#else<a name='2263'>
       IF(NSTART==0)THEN<a name='2264'>
#endif<a name='2265'>
<a name='2266'>
        DO J=JMS,JME<a name='2267'>
        DO I=IMS,IME<a name='2268'>
          grid%z0(I,J)=grid%z0base(I,J)<a name='2269'>
        ENDDO<a name='2270'>
        ENDDO<a name='2271'>
<a name='2272'>
        DO K=KMS,KME<a name='2273'>
        DO J=JMS,JME<a name='2274'>
        DO I=IMS,IME<a name='2275'>
          grid%cldfra(I,J,K)=CLDFRA_TRANS(I,K,J)<a name='2276'>
        ENDDO<a name='2277'>
        ENDDO<a name='2278'>
        ENDDO<a name='2279'>
<a name='2280'>
      ENDIF<a name='2281'>
<a name='2282'>
<font color=#447700>!<a name='2283'></font>
<font color=#447700>!<a name='2284'></font>
<font color=#447700>!mp replace F*_PHY with values defined in module_initialize_real.F?<a name='2285'></font>
#if ( HWRF == 1 )<a name='2286'>
      IF (.NOT. RESTRT .and. ALLOWED_TO_READ) THEN   <font color=#447700>!zhang<a name='2287'></font>
        moist = 0.0<a name='2288'>
        if(size(grid%f_ice)&gt;1) grid%f_ice = grid%f_ice_phy<a name='2289'>
        if(size(grid%f_rimef)&gt;1) grid%f_rimef = grid%f_rimef_phy<a name='2290'>
        if(size(grid%f_rain)&gt;1) grid%f_rain = grid%f_rain_phy<a name='2291'>
      ENDIF                  <font color=#447700>!zhang<a name='2292'></font>
#endif<a name='2293'>
<a name='2294'>
      IF (.NOT. RESTRT .and. ALLOWED_TO_READ) THEN<a name='2295'>
<font color=#447700>! Added by Greg Thompson, NCAR-RAL, for initializing water vapor<a name='2296'></font>
<font color=#447700>! mixing ratio (from NMM's specific humidity var) into moist array.<a name='2297'></font>
<a name='2298'>
<font color=#447700>!!mp<a name='2299'></font>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_264">('Initializng moist(:,:,:, Qv) from q')<a name='2300'>
        DO K=KPS,KPE<a name='2301'>
        DO J=JFS,JFE<a name='2302'>
        DO I=IFS,IFE<a name='2303'>
           moist(I,J,K,P_QV) = grid%q(I,J,K) / (1.-grid%q(I,J,K))                 <a name='2304'>
        enddo      <a name='2305'>
        enddo      <a name='2306'>
        enddo      <a name='2307'>
     <a name='2308'>
<font color=#447700>! Also sum cloud water, ice, rain, snow, graupel into Ferrier cwm       <a name='2309'></font>
<font color=#447700>! array (if any hydrometeors found and non-zero from initialization     <a name='2310'></font>
<font color=#447700>! package).  Then, determine fractions ice and rain from species.       <a name='2311'></font>
     <a name='2312'>
        IF (.not. (MAXVAL(grid%cwm(ips:ipe,jps:jpe,:)).gt.0. .and. MAXVAL(grid%cwm(ips:ipe,jps:jpe,:)).lt.1.) ) then    <a name='2313'>
          do i_m = 2, num_moist<a name='2314'>
          if (i_m.ne.p_qv) &amp;<a name='2315'>
     &amp;       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_265">(' summing moist(:,:,:,i_m) into cwm array')<a name='2316'>
          DO K=KPS,KPE<a name='2317'>
          DO J=JFS,JFE<a name='2318'>
          DO I=IFS,IFE<a name='2319'>
            IF ( (moist(I,J,K,i_m).gt.EPSQ) .and. (i_m.ne.p_qv) ) THEN  <a name='2320'>
               grid%cwm(I,J,K) = grid%cwm(I,J,K) + moist(I,J,K,i_m)               <a name='2321'>
            ENDIF  <a name='2322'>
          enddo    <a name='2323'>
          enddo<a name='2324'>
          enddo<a name='2325'>
          enddo<a name='2326'>
<a name='2327'>
          IF (size(grid%f_ice)&gt;1 .and. size(grid%f_rain)&gt;1) then<a name='2328'>
           IF( .not. ( (maxval(grid%f_ice(ips:ipe,:,jps:jpe)) &amp;<a name='2329'>
               +maxval(grid%f_rain(ips:ipe,:,jps:jpe))) .gt. EPSQ) ) THEN<a name='2330'>
            ETAMP_Regional=.FALSE.    <font color=#447700>!-- Regional NAM or HRW (Ferrier) microphysics<a name='2331'></font>
            if (model_config_rec%mp_physics(grid%id).EQ.FER_MP_HIRES .OR.          &amp;<a name='2332'>
     &amp;          model_config_rec%mp_physics(grid%id).EQ.ETAMPNEW )             &amp;<a name='2333'>
     &amp;          ETAMP_Regional=.TRUE.<a name='2334'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_266">(' computing grid%f_ice')<a name='2335'>
            do i_m = 2, num_moist<a name='2336'>
               ICE1_indx=.FALSE.<a name='2337'>
               IF (i_m==P_qi .or. i_m==P_qg ) ICE1_indx=.TRUE.<a name='2338'>
               ICE2_indx=ICE1_indx<a name='2339'>
               IF (i_m==P_qs) ICE2_indx=.TRUE.<a name='2340'>
              IF (ETAMP_Regional .AND. ICE1_indx) THEN<a name='2341'>
            DO J=JFS,JFE<a name='2342'>
            DO K=KPS,KPE<a name='2343'>
            DO I=IFS,IFE<a name='2344'>
                 moist(I,J,K,p_qs)=moist(I,J,K,p_qs)+moist(I,J,K,i_m)<a name='2345'>
                 moist(I,J,K,i_m) =0.<a name='2346'>
            enddo<a name='2347'>
            enddo<a name='2348'>
            enddo<a name='2349'>
            if(size(grid%f_ice)&gt;1) then<a name='2350'>
               DO J=JFS,JFE<a name='2351'>
                  DO K=KPS,KPE<a name='2352'>
                     DO I=IFS,IFE<a name='2353'>
                        grid%f_ice(I,K,J) = grid%f_ice(I,K,J) + moist(I,J,K,i_m)<a name='2354'>
                     enddo<a name='2355'>
                  enddo<a name='2356'>
               enddo<a name='2357'>
            endif<a name='2358'>
              ENDIF<a name='2359'>
            enddo<a name='2360'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_267">(' computing f_rain')<a name='2361'>
<font color=#447700>!<a name='2362'></font>
            if(size(grid%f_ice)&gt;1 .and. size(grid%f_rain)&gt;1) then<a name='2363'>
            DO J=JFS,JFE<a name='2364'>
            DO K=KPS,KPE<a name='2365'>
            DO I=IFS,IFE<a name='2366'>
              IF(grid%f_ice(i,k,j)&lt;=EPSQ)THEN<a name='2367'>
                grid%f_ice(I,K,J)=0.<a name='2368'>
              ELSE<a name='2369'>
                grid%f_ice(I,K,J) = grid%f_ice(I,K,J)/grid%cwm(I,J,K)<a name='2370'>
              ENDIF<a name='2371'>
              IF ( (moist(I,J,K,p_qr)+moist(I,J,K,p_qc)).gt.EPSQ) THEN<a name='2372'>
                IF(moist(i,j,k,p_qr)&lt;=EPSQ)THEN<a name='2373'>
                  grid%f_rain(I,K,J)=0.<a name='2374'>
                ELSE<a name='2375'>
                  grid%f_rain(I,K,J) = moist(i,j,k,p_qr) &amp;<a name='2376'>
     &amp;                    / (moist(i,j,k,p_qr)+moist(i,j,k,p_qc))<a name='2377'>
                ENDIF<a name='2378'>
              ENDIF<a name='2379'>
            enddo<a name='2380'>
            enddo<a name='2381'>
            enddo<a name='2382'>
           endif<a name='2383'>
           ENDIF<a name='2384'>
          ENDIF<a name='2385'>
        ENDIF<a name='2386'>
<font color=#447700>! End addition by Greg Thompson<a name='2387'></font>
<a name='2388'>
        if(size(grid%f_ice)&gt;1) then<a name='2389'>
           IF (maxval(grid%f_ice(ips:ipe,:,jps:jpe)) .gt. 0.) THEN<a name='2390'>
              do J=JMS,JME<a name='2391'>
                 do K=KMS,KME<a name='2392'>
                    do I=IMS,IME<a name='2393'>
                       grid%f_ice_phy(I,K,J)=grid%f_ice(I,K,J)<a name='2394'>
                    enddo<a name='2395'>
                 enddo<a name='2396'>
              enddo<a name='2397'>
           ENDIF<a name='2398'>
        endif<a name='2399'>
<a name='2400'>
        if(size(grid%f_rain)&gt;1) then<a name='2401'>
           IF (maxval(grid%f_rain(ips:ipe,:,jps:jpe)) .gt. 0.) THEN<a name='2402'>
              do J=JMS,JME<a name='2403'>
                 do K=KMS,KME<a name='2404'>
                    do I=IMS,IME<a name='2405'>
                       grid%f_rain_phy(I,K,J)=grid%f_rain(I,K,J)<a name='2406'>
                    enddo<a name='2407'>
                 enddo<a name='2408'>
              enddo<a name='2409'>
           ENDIF<a name='2410'>
        endif<a name='2411'>
<a name='2412'>
        if(size(grid%f_rimef)&gt;1) then<a name='2413'>
           IF (maxval(grid%f_rimef(ips:ipe,:,jps:jpe)) .gt. 0.) THEN<a name='2414'>
              do J=JMS,JME<a name='2415'>
                 do K=KMS,KME<a name='2416'>
                    do I=IMS,IME<a name='2417'>
                       grid%f_rimef_phy(I,K,J)=grid%f_rimef(I,K,J)<a name='2418'>
                    enddo<a name='2419'>
                 enddo<a name='2420'>
              enddo<a name='2421'>
           ENDIF<a name='2422'>
        endif<a name='2423'>
      ENDIF<a name='2424'>
<font color=#447700>!<a name='2425'></font>
      IF (.NOT. RESTRT) THEN<a name='2426'>
  <font color=#447700>!-- Replace albedos if original albedos are nonzero<a name='2427'></font>
        IF(MAXVAL(ALBEDO_DUM(ips:ipe,jps:jpe))&gt;0.)THEN<a name='2428'>
          DO J=JMS,JME<a name='2429'>
          DO I=IMS,IME<a name='2430'>
            grid%albedo(I,J)=ALBEDO_DUM(I,J)<a name='2431'>
          ENDDO<a name='2432'>
          ENDDO<a name='2433'>
        ENDIF<a name='2434'>
      ENDIF<a name='2435'>
<a name='2436'>
#if ( HWRF == 1 )<a name='2437'>
      if(.NOT. RESTRT .OR. .NOT.allowed_to_read) then <font color=#447700>!zhang's doing<a name='2438'></font>
<font color=#447700>!zhang's doing<a name='2439'></font>
#else<a name='2440'>
      IF(.NOT.RESTRT)THEN<a name='2441'>
#endif<a name='2442'>
        DO J=jps,min(jpe,jde-1)<a name='2443'>
        DO I=ips,min(ipe,ide-1)<a name='2444'>
          grid%aprec(I,J)=RAINNC(I,J)*1.E-3<a name='2445'>
          grid%cuprec(I,J)=grid%raincv(I,J)*1.E-3<a name='2446'>
        ENDDO<a name='2447'>
        ENDDO<a name='2448'>
      ENDIF<a name='2449'>
<a name='2450'>
<a name='2451'>
<font color=#447700>!<a name='2452'></font>
<font color=#447700>! translate scalar_trans(i,k,j,n) back to scalar(i,j,k,n)<a name='2453'></font>
        DO N=1,NUM_SCALAR<a name='2454'>
<font color=#447700>!$omp parallel do                                                       &amp;<a name='2455'></font>
<font color=#447700>!$omp&amp; private(i,j,k)<a name='2456'></font>
          DO K=KMS,KME<a name='2457'>
          DO J=JMS,JME<a name='2458'>
          DO I=IMS,IME<a name='2459'>
            SCALAR(I,J,K,N)=SCALAR_TRANS(I,K,J,N)<a name='2460'>
          ENDDO<a name='2461'>
          ENDDO<a name='2462'>
          ENDDO<a name='2463'>
        ENDDO<a name='2464'>
<font color=#447700>!<a name='2465'></font>
      DEALLOCATE(SFULL)<a name='2466'>
      DEALLOCATE(SMID)<a name='2467'>
      DEALLOCATE(DZS)<a name='2468'>
      DEALLOCATE(EMISS)<a name='2469'>
      DEALLOCATE(EMTEMP)<a name='2470'>
      DEALLOCATE(GLW)<a name='2471'>
      DEALLOCATE(HFX)<a name='2472'>
      DEALLOCATE(LOWLYR)<a name='2473'>
<font color=#447700>!     DEALLOCATE(grid%mavail)<a name='2474'></font>
      DEALLOCATE(NCA)<a name='2475'>
      DEALLOCATE(QFX)<a name='2476'>
      DEALLOCATE(RAINBL)<a name='2477'>
      DEALLOCATE(RAINC)<a name='2478'>
      DEALLOCATE(RAINNC)<a name='2479'>
      DEALLOCATE(RAINNCV)<a name='2480'>
      DEALLOCATE(RQCBLTEN)<a name='2481'>
      DEALLOCATE(RQIBLTEN)<a name='2482'>
      DEALLOCATE(RQVBLTEN)<a name='2483'>
      DEALLOCATE(RTHBLTEN)<a name='2484'>
      DEALLOCATE(RUBLTEN)<a name='2485'>
      DEALLOCATE(RVBLTEN)<a name='2486'>
      DEALLOCATE(RQCCUTEN)<a name='2487'>
      DEALLOCATE(RQICUTEN)<a name='2488'>
      DEALLOCATE(RQRCUTEN)<a name='2489'>
      DEALLOCATE(RQSCUTEN)<a name='2490'>
      DEALLOCATE(RQVCUTEN)<a name='2491'>
      DEALLOCATE(RTHCUTEN)<a name='2492'>
      DEALLOCATE(RUSHTEN)<a name='2493'>
      DEALLOCATE(RVSHTEN)<a name='2494'>
      DEALLOCATE(RQCSHTEN)<a name='2495'>
      DEALLOCATE(RQISHTEN)<a name='2496'>
      DEALLOCATE(RQRSHTEN)<a name='2497'>
      DEALLOCATE(RQSSHTEN)<a name='2498'>
      DEALLOCATE(RQGSHTEN)<a name='2499'>
      DEALLOCATE(RQVSHTEN)<a name='2500'>
      DEALLOCATE(RTHSHTEN)<a name='2501'>
      DEALLOCATE(RTHRATEN)<a name='2502'>
      DEALLOCATE(RTHRATENLW)<a name='2503'>
      DEALLOCATE(RTHRATENSW)<a name='2504'>
      DEALLOCATE(ZINT)<a name='2505'>
      DEALLOCATE(CONVFAC)<a name='2506'>
      DEALLOCATE(RRI)<a name='2507'>
      DEALLOCATE(SNOWC)<a name='2508'>
      DEALLOCATE(THC)<a name='2509'>
      DEALLOCATE(TMN)<a name='2510'>
      DEALLOCATE(TSFC)<a name='2511'>
      DEALLOCATE(ZS)<a name='2512'>
      DEALLOCATE(PINT_TRANS)<a name='2513'>
      DEALLOCATE(T_TRANS)<a name='2514'>
      DEALLOCATE(CLDFRA_TRANS)<a name='2515'>
      DEALLOCATE(CLDFRA_OLD)<a name='2516'>
      DEALLOCATE(Z_AT_Q)<a name='2517'>
      DEALLOCATE(SCALAR_TRANS)<a name='2518'>
#if 0<a name='2519'>
      DEALLOCATE(w0avg)<a name='2520'>
#endif<a name='2521'>
<font color=#447700>!-----------------------------------------------------------------------<a name='2522'></font>
<font color=#447700>!----------------------------------------------------------------------<a name='2523'></font>
        DO J=jfs,jfe<a name='2524'>
        DO I=ifs,ife<a name='2525'>
          grid%dwdtmn(I,J)=grid%dwdtmn(I,J)*grid%hbm3(I,J)<a name='2526'>
          grid%dwdtmx(I,J)=grid%dwdtmx(I,J)*grid%hbm3(I,J)<a name='2527'>
        ENDDO<a name='2528'>
        ENDDO<a name='2529'>
<font color=#447700>!----------------------------------------------------------------------<a name='2530'></font>
<a name='2531'>
#ifdef DM_PARALLEL<a name='2532'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_1.inc.html'>HALO_NMM_INIT_1.inc</A>"<A NAME="HALO_NMM_INIT_1.inc_42"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2533'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_2.inc.html'>HALO_NMM_INIT_2.inc</A>"<A NAME="HALO_NMM_INIT_2.inc_43"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2534'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_3.inc.html'>HALO_NMM_INIT_3.inc</A>"<A NAME="HALO_NMM_INIT_3.inc_44"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2535'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_4.inc.html'>HALO_NMM_INIT_4.inc</A>"<A NAME="HALO_NMM_INIT_4.inc_45"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2536'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_5.inc.html'>HALO_NMM_INIT_5.inc</A>"<A NAME="HALO_NMM_INIT_5.inc_46"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2537'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_6.inc.html'>HALO_NMM_INIT_6.inc</A>"<A NAME="HALO_NMM_INIT_6.inc_47"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2538'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_7.inc.html'>HALO_NMM_INIT_7.inc</A>"<A NAME="HALO_NMM_INIT_7.inc_48"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2539'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_8.inc.html'>HALO_NMM_INIT_8.inc</A>"<A NAME="HALO_NMM_INIT_8.inc_49"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2540'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_9.inc.html'>HALO_NMM_INIT_9.inc</A>"<A NAME="HALO_NMM_INIT_9.inc_50"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2541'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_10.inc.html'>HALO_NMM_INIT_10.inc</A>"<A NAME="HALO_NMM_INIT_10.inc_51"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2542'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_11.inc.html'>HALO_NMM_INIT_11.inc</A>"<A NAME="HALO_NMM_INIT_11.inc_52"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2543'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_12.inc.html'>HALO_NMM_INIT_12.inc</A>"<A NAME="HALO_NMM_INIT_12.inc_53"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2544'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_13.inc.html'>HALO_NMM_INIT_13.inc</A>"<A NAME="HALO_NMM_INIT_13.inc_54"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2545'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_14.inc.html'>HALO_NMM_INIT_14.inc</A>"<A NAME="HALO_NMM_INIT_14.inc_55"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2546'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_15.inc.html'>HALO_NMM_INIT_15.inc</A>"<A NAME="HALO_NMM_INIT_15.inc_56"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2547'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_15B.inc.html'>HALO_NMM_INIT_15B.inc</A>"<A NAME="HALO_NMM_INIT_15B.inc_57"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2548'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_16.inc.html'>HALO_NMM_INIT_16.inc</A>"<A NAME="HALO_NMM_INIT_16.inc_58"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2549'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_17.inc.html'>HALO_NMM_INIT_17.inc</A>"<A NAME="HALO_NMM_INIT_17.inc_59"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2550'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_18.inc.html'>HALO_NMM_INIT_18.inc</A>"<A NAME="HALO_NMM_INIT_18.inc_60"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2551'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_19.inc.html'>HALO_NMM_INIT_19.inc</A>"<A NAME="HALO_NMM_INIT_19.inc_61"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2552'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_20.inc.html'>HALO_NMM_INIT_20.inc</A>"<A NAME="HALO_NMM_INIT_20.inc_62"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2553'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_21.inc.html'>HALO_NMM_INIT_21.inc</A>"<A NAME="HALO_NMM_INIT_21.inc_63"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2554'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_22.inc.html'>HALO_NMM_INIT_22.inc</A>"<A NAME="HALO_NMM_INIT_22.inc_64"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2555'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_23.inc.html'>HALO_NMM_INIT_23.inc</A>"<A NAME="HALO_NMM_INIT_23.inc_65"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2556'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_24.inc.html'>HALO_NMM_INIT_24.inc</A>"<A NAME="HALO_NMM_INIT_24.inc_66"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2557'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_25.inc.html'>HALO_NMM_INIT_25.inc</A>"<A NAME="HALO_NMM_INIT_25.inc_67"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2558'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_26.inc.html'>HALO_NMM_INIT_26.inc</A>"<A NAME="HALO_NMM_INIT_26.inc_68"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2559'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_27.inc.html'>HALO_NMM_INIT_27.inc</A>"<A NAME="HALO_NMM_INIT_27.inc_69"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2560'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_28.inc.html'>HALO_NMM_INIT_28.inc</A>"<A NAME="HALO_NMM_INIT_28.inc_70"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2561'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_29.inc.html'>HALO_NMM_INIT_29.inc</A>"<A NAME="HALO_NMM_INIT_29.inc_71"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2562'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_30.inc.html'>HALO_NMM_INIT_30.inc</A>"<A NAME="HALO_NMM_INIT_30.inc_72"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2563'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_31.inc.html'>HALO_NMM_INIT_31.inc</A>"<A NAME="HALO_NMM_INIT_31.inc_73"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2564'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_32.inc.html'>HALO_NMM_INIT_32.inc</A>"<A NAME="HALO_NMM_INIT_32.inc_74"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2565'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_33.inc.html'>HALO_NMM_INIT_33.inc</A>"<A NAME="HALO_NMM_INIT_33.inc_75"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2566'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_34.inc.html'>HALO_NMM_INIT_34.inc</A>"<A NAME="HALO_NMM_INIT_34.inc_76"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2567'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_35.inc.html'>HALO_NMM_INIT_35.inc</A>"<A NAME="HALO_NMM_INIT_35.inc_77"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2568'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_36.inc.html'>HALO_NMM_INIT_36.inc</A>"<A NAME="HALO_NMM_INIT_36.inc_78"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2569'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_37.inc.html'>HALO_NMM_INIT_37.inc</A>"<A NAME="HALO_NMM_INIT_37.inc_79"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2570'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_38.inc.html'>HALO_NMM_INIT_38.inc</A>"<A NAME="HALO_NMM_INIT_38.inc_80"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2571'>
#  include "<A href='../../html_code/include/HALO_NMM_INIT_39.inc.html'>HALO_NMM_INIT_39.inc</A>"<A NAME="HALO_NMM_INIT_39.inc_81"><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2572'>
#endif<a name='2573'>
<font color=#447700>!#define COPY_OUT<a name='2574'></font>
<font color=#447700>!#include "scalar_derefs.inc"<a name='2575'></font>
<a name='2576'>
   write(message,*) "Timing for start_domain on d",grid%id<a name='2577'>
   call <A href='../../html_code/frame/module_timing.F.html#END_TIMING'>end_timing</A><A href='../../html_code/dyn_nmm/start_domain_nmm.F.html#START_DOMAIN_NMM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="END_TIMING_3">(message)<a name='2578'>
<a name='2579'>
   RETURN<a name='2580'>
<a name='2581'>
<a name='2582'>
END SUBROUTINE START_DOMAIN_NMM<a name='2583'>
<a name='2584'>
</pre></body></html>