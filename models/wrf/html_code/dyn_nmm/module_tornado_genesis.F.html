<HTML> <BODY BGCOLOR=#bbeeee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_TORNADO_GENESIS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#MODULE_TORNADO_GENESIS' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>module </font><font color=#cc0000>module_tornado_genesis</font> <A href='../../call_to/MODULE_TORNADO_GENESIS.html' TARGET='index'>3</A><a name='3'>
  implicit none<a name='4'>
  private<a name='5'>
<a name='6'>
  public :: init_tornado_genesis, calc_tornado_genesis, &amp;<a name='7'>
       reset_tornado_genesis, request_tg_reset<a name='8'>
<a name='9'>
  real, parameter :: wwind_cutoff = 40000.0 <font color=#447700>! pascals<a name='10'></font>
<a name='11'>
contains<a name='12'>
<a name='13'>
<A NAME='UPDATE_TG_TIME'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#UPDATE_TG_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='14'>
  <font color=#993300>subroutine </font><font color=#cc0000>update_tg_time</font>(grid,init) <A href='../../call_to/UPDATE_TG_TIME.html' TARGET='index'>2</A>,<A href='../../call_from/UPDATE_TG_TIME.html' TARGET='index'>2</A><a name='15'>
    <font color=#447700>! Helper function that updates the three time interval variables<a name='16'></font>
    <font color=#447700>! based on the grid's clock.  If init=.true. then both times<a name='17'></font>
    <font color=#447700>! (interval start and end) are set to the current time, otherwise<a name='18'></font>
    <font color=#447700>! only the interval end is updated.  In either case, tg_duration<a name='19'></font>
    <font color=#447700>! is set to the length in seconds of the interval.<a name='20'></font>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#UPDATE_TG_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_53">, only: domain, domain_get_time_since_sim_start<a name='21'>
    use module_symbols_util, only: WRFU_TimeIntervalGet, WRFU_TimeInterval<a name='22'>
    type(domain), intent(inout) :: grid<a name='23'>
    type(WRFU_TimeInterval) :: since_start<a name='24'>
    logical, intent(in) :: init<a name='25'>
    integer :: s_i, s_n, s_d<a name='26'>
<a name='27'>
    since_start=<A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_SINCE_SIM_START'>domain_get_time_since_sim_start</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#UPDATE_TG_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_TIME_SINCE_SIM_START_1">(grid)<a name='28'>
    s_i=0<a name='29'>
    s_n=0<a name='30'>
    s_d=1<a name='31'>
    call WRFU_TimeIntervalGet(since_start,S=s_i,Sn=s_n,Sd=s_d)<a name='32'>
    if(s_d==0) s_d=1<a name='33'>
    grid%tg_interval_end=real(s_i) + real(s_n)/real(s_d)<a name='34'>
    if(init)  grid%tg_interval_start=grid%tg_interval_end<a name='35'>
    grid%tg_duration=grid%tg_interval_end-grid%tg_interval_start<a name='36'>
  end subroutine update_tg_time<a name='37'>
<a name='38'>
<A NAME='INIT_TG_VARS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='39'>
  <font color=#993300>subroutine </font><font color=#cc0000>init_tg_vars</font>(grid,config_flags, &amp; <A href='../../call_to/INIT_TG_VARS.html' TARGET='index'>2</A>,<A href='../../call_from/INIT_TG_VARS.html' TARGET='index'>4</A><a name='40'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='41'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='42'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='43'>
    <font color=#447700>! Helper function that resets all min/max accumulation arrays to 0<a name='44'></font>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_54">, only: domain, get_ijk_from_grid<a name='45'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_36">, only : grid_config_rec_type<a name='46'>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_26">, only: tg_emc2014spc<a name='47'>
    type(domain), intent(inout) :: grid<a name='48'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='49'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='50'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='51'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='52'>
    integer :: i,j, istart,iend, jstart,jend<a name='53'>
    character*255 message<a name='54'>
<a name='55'>
    if(config_flags%tg_option/=tg_emc2014spc) return<a name='56'>
    jstart=max(jds,jps)<a name='57'>
    jend=min(jpe,jde-1)<a name='58'>
    istart=max(ids,ips)<a name='59'>
    iend=min(ipe,ide-1)<a name='60'>
<a name='61'>
3012 format("Grid ",I2,": filling tornado genesis data with zeros")<a name='62'>
    write(message,3012) grid%id<a name='63'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_97">(1,message)<a name='64'>
<a name='65'>
    do j=jstart,jend<a name='66'>
       do i=istart,iend<a name='67'>
          grid%tg_max_m10wind(i,j)=0<a name='68'>
          grid%tg_max_wwind(i,j)=0<a name='69'>
          grid%tg_min_wwind(i,j)=0<a name='70'>
          grid%tg_max_zhel_25(i,j)=0<a name='71'>
          grid%tg_min_zhel_25(i,j)=0<a name='72'>
          grid%tg_max_zhel_03(i,j)=0<a name='73'>
          grid%tg_min_zhel_03(i,j)=0<a name='74'>
          grid%tg_max_updhel03(i,j)=0<a name='75'>
          grid%tg_max_updhel25(i,j)=0<a name='76'>
          grid%tg_updhel03(i,j)=0<a name='77'>
          grid%tg_updhel25(i,j)=0<a name='78'>
          grid%tg_total_precip(i,j)=0<a name='79'>
       enddo<a name='80'>
    enddo<a name='81'>
<a name='82'>
    if(size(grid%tlow)&gt;1 .and. size(grid%zlow)&gt;1) then<a name='83'>
    do j=jstart,jend<a name='84'>
       do i=istart,iend<a name='85'>
          grid%tlow(i,j)=0<a name='86'>
          grid%zlow(i,j)=0<a name='87'>
       enddo<a name='88'>
    enddo<a name='89'>
    endif<a name='90'>
<a name='91'>
    if(size(grid%rotangle)&gt;1) then<a name='92'>
       do j=jstart,jend<a name='93'>
          do i=istart,iend<a name='94'>
             grid%rotangle(i,j)=0<a name='95'>
          end do<a name='96'>
       end do<a name='97'>
    endif<a name='98'>
<a name='99'>
    grid%tg_interval_end=grid%tg_interval_start<a name='100'>
    grid%tg_duration=0.0<a name='101'>
    grid%tg_want_reset=0<a name='102'>
#if (HWRF == 1)<a name='103'>
<font color=#447700>!   this flag is used by HWRF with moving nests... N/A for NMM<a name='104'></font>
    grid%update_interest=.true.<a name='105'>
#endif<a name='106'>
<a name='107'>
  end subroutine init_tg_vars<a name='108'>
<a name='109'>
<A NAME='INIT_TORNADO_GENESIS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='110'>
  <font color=#993300>subroutine </font><font color=#cc0000>init_tornado_genesis</font>(grid,config_flags) <A href='../../call_to/INIT_TORNADO_GENESIS.html' TARGET='index'>1</A>,<A href='../../call_from/INIT_TORNADO_GENESIS.html' TARGET='index'>7</A><a name='111'>
    <font color=#447700>! Called to initialize tornado genesis data arrays.  Should only<a name='112'></font>
    <font color=#447700>! be called at initial time.<a name='113'></font>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_55">, only: domain, get_ijk_from_grid<a name='114'>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_27">, only: tg_emc2014spc<a name='115'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_37">, only : grid_config_rec_type<a name='116'>
    type(domain), intent(inout) :: grid<a name='117'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='118'>
    integer :: IDS,IDE,JDS,JDE,KDS,KDE<a name='119'>
    integer :: IMS,IME,JMS,JME,KMS,KME<a name='120'>
    integer :: IPS,IPE,JPS,JPE,KPS,KPE<a name='121'>
<a name='122'>
    grid%tg_want_reset=0  <font color=#447700>! to avoid needless calls to reset_tornado_genesis<a name='123'></font>
    if(config_flags%tg_option/=tg_emc2014spc) return<a name='124'>
<a name='125'>
    if(grid%hydro) then<a name='126'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_104">('Tornado genesis products require non-hydrostatic integration.')<a name='127'>
    endif<a name='128'>
<a name='129'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_19"> (  grid ,      &amp;<a name='130'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='131'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='132'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='133'>
    call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS'>init_tg_vars</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_TG_VARS_1">(grid,config_flags, &amp;<a name='134'>
         ids, ide, jds, jde, kds, kde,   &amp;<a name='135'>
         ims, ime, jms, jme, kms, kme,   &amp;<a name='136'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='137'>
    call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#UPDATE_TG_TIME'>update_tg_time</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_TG_TIME_1">(grid,.true.)<a name='138'>
  end subroutine init_tornado_genesis<a name='139'>
<a name='140'>
<A NAME='REQUEST_TG_RESET'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='141'>
  <font color=#993300>subroutine </font><font color=#cc0000>request_tg_reset</font>(grid,config_flags,stream) <A href='../../call_to/REQUEST_TG_RESET.html' TARGET='index'>1</A>,<A href='../../call_from/REQUEST_TG_RESET.html' TARGET='index'>5</A><a name='142'>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_28">, only: tg_emc2014spc<a name='143'>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_56">, only: domain, get_ijk_from_grid<a name='144'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_38">, only : grid_config_rec_type<a name='145'>
    use <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_2">, only: first_history<a name='146'>
    type(domain), intent(inout) :: grid<a name='147'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='148'>
    integer, intent(in) :: stream<a name='149'>
    character*255 :: message<a name='150'>
    integer :: histnum<a name='151'>
<a name='152'>
    if(config_flags%tg_option/=tg_emc2014spc) return<a name='153'>
<a name='154'>
    histnum=stream-first_history<a name='155'>
    if(config_flags%tg_reset_stream == histnum) then<a name='156'>
3012   format('Grid ',I2,': resetting tornado genesis data after stream ',I0,' output')<a name='157'>
       write(message,3012) grid%id,histnum<a name='158'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_136">(trim(message))<a name='159'>
       grid%tg_want_reset=1<a name='160'>
    endif<a name='161'>
  end subroutine request_tg_reset<a name='162'>
<a name='163'>
<A NAME='RESET_TORNADO_GENESIS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='164'>
  <font color=#993300>subroutine </font><font color=#cc0000>reset_tornado_genesis</font>(grid,config_flags) <A href='../../call_to/RESET_TORNADO_GENESIS.html' TARGET='index'>1</A>,<A href='../../call_from/RESET_TORNADO_GENESIS.html' TARGET='index'>7</A><a name='165'>
    <font color=#447700>! Called after writing output for a given stream.  Resets all<a name='166'></font>
    <font color=#447700>! min/max information for all fields if the stream is the<a name='167'></font>
    <font color=#447700>! tg_reset_stream.  <a name='168'></font>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_29">, only: tg_emc2014spc<a name='169'>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_57">, only: domain, get_ijk_from_grid<a name='170'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_39">, only : grid_config_rec_type<a name='171'>
    use <A href='../../html_code/share/module_io_domain.F.html#MODULE_IO_DOMAIN'>module_io_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_DOMAIN_3">, only: first_history<a name='172'>
    type(domain), intent(inout) :: grid<a name='173'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='174'>
    integer :: IDS,IDE,JDS,JDE,KDS,KDE<a name='175'>
    integer :: IMS,IME,JMS,JME,KMS,KME<a name='176'>
    integer :: IPS,IPE,JPS,JPE,KPS,KPE<a name='177'>
    character*255 :: message<a name='178'>
    integer :: histnum<a name='179'>
<a name='180'>
    if(config_flags%tg_option/=tg_emc2014spc) return<a name='181'>
    if(grid%tg_want_reset==0) return<a name='182'>
<a name='183'>
3012 format('Grid ',I2,': resetting tornado genesis data')<a name='184'>
    write(message,3012) grid%id<a name='185'>
    call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_137">(trim(message))<a name='186'>
<a name='187'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_20"> (  grid ,      &amp;<a name='188'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='189'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='190'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='191'>
<a name='192'>
    <font color=#447700>! Previous interval end time is now this interval's start time<a name='193'></font>
    <font color=#447700>! since we're entering the next interval:<a name='194'></font>
    grid%tg_interval_start=grid%tg_interval_end<a name='195'>
<a name='196'>
    call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#INIT_TG_VARS'>init_tg_vars</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#RESET_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_TG_VARS_2">(grid,config_flags, &amp;<a name='197'>
         ids, ide, jds, jde, kds, kde,   &amp;<a name='198'>
         ims, ime, jms, jme, kms, kme,   &amp;<a name='199'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='200'>
  end subroutine reset_tornado_genesis<a name='201'>
<a name='202'>
<A NAME='ROTATE_WINDS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#ROTATE_WINDS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='203'>
  <font color=#993300>subroutine </font><font color=#cc0000>rotate_winds</font>(grid,config_flags, &amp; <A href='../../call_to/ROTATE_WINDS.html' TARGET='index'>1</A>,<A href='../../call_from/ROTATE_WINDS.html' TARGET='index'>3</A><a name='204'>
         ids, ide, jds, jde, kds, kde,   &amp;<a name='205'>
         ims, ime, jms, jme, kms, kme,   &amp;<a name='206'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='207'>
    <font color=#447700>! Compute wind rotation angle<a name='208'></font>
    use <A href='../../html_code/share/module_model_constants.F.html#MODULE_MODEL_CONSTANTS'>module_model_constants</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#ROTATE_WINDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MODEL_CONSTANTS_32">, only: DEGRAD<a name='209'>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#ROTATE_WINDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_58">, only: domain<a name='210'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#ROTATE_WINDS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_40">, only : grid_config_rec_type<a name='211'>
    type(domain), intent(inout) :: grid<a name='212'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='213'>
    integer, intent(in) :: IDS,IDE,JDS,JDE,KDS,KDE<a name='214'>
    integer, intent(in) :: IMS,IME,JMS,JME,KMS,KME<a name='215'>
    integer, intent(in) :: IPS,IPE,JPS,JPE,KPS,KPE<a name='216'>
    integer :: i,j<a name='217'>
    real :: cenlat,cenlon, lmbd0,phi0, cos_phi0,sin_phi0<a name='218'>
    real :: big_denom, relm, lat, lon, cos_alpha, sin_alpha<a name='219'>
<a name='220'>
    <font color=#447700>! Get the projection center from the MOAD center:<a name='221'></font>
    call nl_get_cen_lat(1,cenlat)<a name='222'>
    call nl_get_cen_lon(1,cenlon)<a name='223'>
    if(cenlon&lt;0) cenlon=cenlon+360.<a name='224'>
    lmbd0=cenlon*DEGRAD<a name='225'>
    phi0=cenlat*DEGRAD<a name='226'>
    <a name='227'>
    cos_phi0=cos(phi0)<a name='228'>
    sin_phi0=sin(phi0)<a name='229'>
    do j=max(jps,jds),min(jpe,jde-1)<a name='230'>
       do i=max(ips,ids),min(ipe,ide-1)<a name='231'>
          lon=grid%GLON(i,j)<a name='232'>
          lat=grid%GLAT(i,j)<a name='233'>
          relm=lon-lmbd0<a name='234'>
          big_denom=cos(asin( cos_phi0*sin(lat) - sin_phi0*cos(lat)*cos(relm) ))<a name='235'>
          sin_alpha=sin_phi0*sin(relm)/big_denom<a name='236'>
          cos_alpha=(cos_phi0*cos(lat)+sin_phi0*sin(lat)*cos(relm))/big_denom<a name='237'>
          grid%rotangle(i,j) = atan2(sin_alpha,cos_alpha)<a name='238'>
       enddo<a name='239'>
    enddo<a name='240'>
  end subroutine rotate_winds<a name='241'>
<a name='242'>
<A NAME='CALC_TORNADO_GENESIS'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='243'>
  <font color=#993300>subroutine </font><font color=#cc0000>calc_tornado_genesis</font>(grid,config_flags) <A href='../../call_to/CALC_TORNADO_GENESIS.html' TARGET='index'>1</A>,<A href='../../call_from/CALC_TORNADO_GENESIS.html' TARGET='index'>15</A><a name='244'>
    <font color=#447700>! Updates max/min information for tornado genesis wind fields from<a name='245'></font>
    <font color=#447700>! grid data at the current time.  The tg_total_precip is handled<a name='246'></font>
    <font color=#447700>! in module_PHYSICS_CALLS instead.<a name='247'></font>
    use <A href='../../html_code/frame/module_comm_dm.F.html#MODULE_COMM_DM'>module_comm_dm</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_COMM_DM_20">, only: HALO_NMM_C_sub<a name='248'>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_30">, only: tg_emc2014spc<a name='249'>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_59">, only: domain, get_ijk_from_grid<a name='250'>
    use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_41">, only : grid_config_rec_type<a name='251'>
#ifdef DM_PARALLEL<a name='252'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_45">, only: wrf_dm_maxval_real, wrf_dm_minval_real, &amp;<a name='253'>
         ntasks_x, ntasks_y, mytask, ntasks, local_communicator<a name='254'>
#endif<a name='255'>
    type(domain), intent(inout) :: grid<a name='256'>
    type(grid_config_rec_type), intent(in) :: config_flags<a name='257'>
    integer :: IDS,IDE,JDS,JDE,KDS,KDE<a name='258'>
    integer :: IMS,IME,JMS,JME,KMS,KME<a name='259'>
    integer :: IPS,IPE,JPS,JPE,KPS,KPE<a name='260'>
    integer :: i,j,k, istart,iend, jstart,jend, a, imin,imax<a name='261'>
    real :: dudy, dvdx, w, zhel, maxmaxwind, minminw, maxmaxw, sec, updhel03, updhel25<a name='262'>
    real :: height, height1, height2, height0, maxmaxzhel, minminzhel, updhelpart<a name='263'>
    character*255 :: message<a name='264'>
<a name='265'>
    if(config_flags%tg_option/=tg_emc2014spc) return<a name='266'>
    if(grid%hydro) then<a name='267'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_105">('Tornado genesis products require non-hydrostatic integration.')<a name='268'>
    endif<a name='269'>
<a name='270'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_21"> (  grid ,      &amp;<a name='271'>
         ids, ide, jds, jde, kds, kde,    &amp;<a name='272'>
         ims, ime, jms, jme, kms, kme,    &amp;<a name='273'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='274'>
    jstart=max(jps,jds+1)<a name='275'>
    jend=min(jpe,jde-2)<a name='276'>
    istart=max(ips,ids+1)<a name='277'>
    iend=min(ipe,ide-2)<a name='278'>
    imin=max(ips,ids)<a name='279'>
    imax=min(ipe,ide-1)<a name='280'>
<a name='281'>
#ifdef DM_PARALLEL<a name='282'>
#    include "<A href='../../html_code/include/HALO_NMM_C.inc.html'>HALO_NMM_C.inc</A>"<A NAME="HALO_NMM_C.inc_1"><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='283'>
#endif<a name='284'>
<a name='285'>
    if(size(grid%tlow)&gt;1 .and. size(grid%zlow)&gt;1) then<a name='286'>
       <font color=#447700>! Near surface Z &amp; T for wave model:<a name='287'></font>
       do j=max(jps,jds),min(jpe,jde-1)<a name='288'>
          do i=max(ips,ids),min(ipe,ide-1)<a name='289'>
             grid%tlow(i,j)=grid%T(i,j,kds)<a name='290'>
             grid%zlow(i,j)=(grid%Z(i,j,kds+1)-grid%Z(i,j,kds))/2<a name='291'>
          enddo<a name='292'>
       enddo<a name='293'>
    endif<a name='294'>
<a name='295'>
    if(size(grid%rotangle)&gt;1) then<a name='296'>
       call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#ROTATE_WINDS'>rotate_winds</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ROTATE_WINDS_1">(grid,config_flags, &amp;<a name='297'>
         ids, ide, jds, jde, kds, kde,   &amp;<a name='298'>
         ims, ime, jms, jme, kms, kme,   &amp;<a name='299'>
         ips, ipe, jps, jpe, kps, kpe    )<a name='300'>
    endif<a name='301'>
<a name='302'>
    <font color=#447700>! Maximum 10m wind vector magnitude:<a name='303'></font>
    maxmaxwind=0.0<a name='304'>
    do j=jstart,jend<a name='305'>
       do i=istart,iend<a name='306'>
          grid%tg_max_m10wind(i,j)=max(grid%tg_max_m10wind(i,j), &amp;<a name='307'>
               sqrt(grid%u10(i,j)*grid%u10(i,j) + grid%v10(i,j)*grid%v10(i,j)))<a name='308'>
          maxmaxwind=max(maxmaxwind,grid%tg_max_m10wind(i,j))<a name='309'>
       enddo<a name='310'>
    enddo<a name='311'>
<a name='312'>
#ifdef DM_PARALLEL<a name='313'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_2">(maxmaxwind,i,j)<a name='314'>
#endif<a name='315'>
<a name='316'>
    <font color=#447700>! Min/max vertical wind below 400mbar:<a name='317'></font>
    minminw=0.0<a name='318'>
    maxmaxw=0.0<a name='319'>
    do j=jstart,jend<a name='320'>
       do i=istart,iend<a name='321'>
          kloop: do k=kds+1,kde-1<a name='322'>
             if(grid%pint(i,j,1)-grid%pint(i,j,k)&gt;wwind_cutoff) exit kloop<a name='323'>
             w=grid%w(i,j,k)<a name='324'>
             grid%tg_min_wwind(i,j)=min(grid%tg_min_wwind(i,j),w)<a name='325'>
             minminw=min(minminw,grid%tg_min_wwind(i,j))<a name='326'>
             grid%tg_max_wwind(i,j)=max(grid%tg_max_wwind(i,j),w)<a name='327'>
             maxmaxw=max(maxmaxw,grid%tg_max_wwind(i,j))<a name='328'>
          enddo kloop<a name='329'>
       enddo<a name='330'>
    enddo<a name='331'>
<a name='332'>
#ifdef DM_PARALLEL<a name='333'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_3">(maxmaxw,i,j)<a name='334'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_3">(minminw,i,j)<a name='335'>
#endif<a name='336'>
<a name='337'>
    <font color=#447700>! Min/max helicity for 0-3km layer and 2-5km layer.  Note this is<a name='338'></font>
    <font color=#447700>! X km above ground (lowest interface level geopotential height),<a name='339'></font>
    <font color=#447700>! not above sea level.<a name='340'></font>
    minminzhel=0.0<a name='341'>
    maxmaxzhel=0.0<a name='342'>
    do j=jstart,jend<a name='343'>
       a=mod(j,2)<a name='344'>
       do i=istart,iend<a name='345'>
          k=kds<a name='346'>
          height0=grid%Z(i,j,k)   <font color=#447700>! height0=lowest interface level height<a name='347'></font>
          height1=0.0             <font color=#447700>! height1=lower height bound for layer<a name='348'></font>
          updhel03=0<a name='349'>
          updhel25=0<a name='350'>
          do while(k&lt;kde-1 .and. height1&lt;5000.0)<a name='351'>
             height2=grid%Z(i,j,k+1)-height0 <font color=#447700>! height2=layer upper height bound<a name='352'></font>
<a name='353'>
             dvdx = (grid%v(i+1-a,j,k)-grid%v(i-a,j,k))/(2.*grid%dx_nmm(i,j))<a name='354'>
             dudy = (grid%u(i,j+1,k)-grid%u(i,j-1,k))/(2.*grid%dy_nmm)<a name='355'>
             zhel = (dvdx-dudy) * (grid%w(i,j,k) + grid%w(i,j,k+1))/2<a name='356'>
             <a name='357'>
             if(height1&lt;3000.0) then<a name='358'>
                grid%tg_max_zhel_03(i,j)=max(grid%tg_max_zhel_03(i,j),zhel)<a name='359'>
                grid%tg_min_zhel_03(i,j)=min(grid%tg_min_zhel_03(i,j),zhel)<a name='360'>
                minminzhel=min(grid%tg_min_zhel_03(i,j),minminzhel)<a name='361'>
                maxmaxzhel=max(grid%tg_max_zhel_03(i,j),maxmaxzhel)<a name='362'>
                updhelpart=max(zhel*(height2-height1),0.)<a name='363'>
                if(grid%glat(i,j)&lt;0) updhelpart=-updhelpart<a name='364'>
                if(updhelpart&gt;0) then<a name='365'>
                   updhel03=updhel03+updhelpart<a name='366'>
                endif<a name='367'>
             endif<a name='368'>
             if(height2&gt;2000.0) then<a name='369'>
                grid%tg_max_zhel_25(i,j)=max(grid%tg_max_zhel_25(i,j),zhel)<a name='370'>
                grid%tg_min_zhel_25(i,j)=min(grid%tg_min_zhel_25(i,j),zhel)<a name='371'>
                minminzhel=min(grid%tg_min_zhel_25(i,j),minminzhel)<a name='372'>
                maxmaxzhel=max(grid%tg_max_zhel_25(i,j),maxmaxzhel)<a name='373'>
                updhelpart=max(zhel*(height2-height1),0.)<a name='374'>
                if(grid%glat(i,j)&lt;0) updhelpart=-updhelpart<a name='375'>
                if(updhelpart&gt;0) then<a name='376'>
                   updhel25=updhel25+updhelpart<a name='377'>
                endif<a name='378'>
             endif<a name='379'>
<a name='380'>
             k=k+1<a name='381'>
             height1=height2<a name='382'>
          enddo<a name='383'>
          grid%tg_updhel25(i,j)=updhel25<a name='384'>
          grid%tg_updhel03(i,j)=updhel03<a name='385'>
          if(updhel25&gt;grid%tg_max_updhel25(i,j)) &amp;<a name='386'>
               grid%tg_max_updhel25(i,j)=updhel25<a name='387'>
          if(updhel03&gt;grid%tg_max_updhel03(i,j)) &amp;<a name='388'>
               grid%tg_max_updhel03(i,j)=updhel03<a name='389'>
       enddo<a name='390'>
    enddo<a name='391'>
<a name='392'>
#ifdef DM_PARALLEL<a name='393'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MAXVAL_REAL'>wrf_dm_maxval_real</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MAXVAL_REAL_4">(maxmaxzhel,i,j)<a name='394'>
    call <A href='../../html_code/frame/module_dm.F.html#WRF_DM_MINVAL_REAL'>wrf_dm_minval_real</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MINVAL_REAL_4">(minminzhel,i,j)<a name='395'>
#endif<a name='396'>
<a name='397'>
    <font color=#447700>! I boundaries copy from nearest point that has data, excluding corner points:<a name='398'></font>
    if(ips&lt;=ids) then<a name='399'>
       grid%tg_max_zhel_25(ids,jstart:jend)=grid%tg_max_zhel_25(ids+1,jstart:jend)<a name='400'>
       grid%tg_max_zhel_03(ids,jstart:jend)=grid%tg_max_zhel_03(ids+1,jstart:jend)<a name='401'>
       grid%tg_min_zhel_25(ids,jstart:jend)=grid%tg_min_zhel_25(ids+1,jstart:jend)<a name='402'>
       grid%tg_min_zhel_03(ids,jstart:jend)=grid%tg_min_zhel_03(ids+1,jstart:jend)<a name='403'>
       grid%tg_updhel25(ids,jstart:jend)=grid%tg_updhel25(ids+1,jstart:jend)<a name='404'>
       grid%tg_updhel03(ids,jstart:jend)=grid%tg_updhel03(ids+1,jstart:jend)<a name='405'>
       grid%tg_max_updhel25(ids,jstart:jend)=grid%tg_max_updhel25(ids+1,jstart:jend)<a name='406'>
       grid%tg_max_updhel03(ids,jstart:jend)=grid%tg_max_updhel03(ids+1,jstart:jend)<a name='407'>
       grid%tg_max_wwind(ids,jstart:jend)=grid%tg_max_wwind(ids+1,jstart:jend)<a name='408'>
       grid%tg_min_wwind(ids,jstart:jend)=grid%tg_min_wwind(ids+1,jstart:jend)<a name='409'>
       grid%tg_max_m10wind(ids,jstart:jend)=grid%tg_max_m10wind(ids+1,jstart:jend)<a name='410'>
    endif<a name='411'>
<a name='412'>
    if(ipe&gt;=ide-2) then<a name='413'>
       grid%tg_max_zhel_25(ide-1,jstart:jend)=grid%tg_max_zhel_25(ide-2,jstart:jend)<a name='414'>
       grid%tg_max_zhel_03(ide-1,jstart:jend)=grid%tg_max_zhel_03(ide-2,jstart:jend)<a name='415'>
       grid%tg_min_zhel_25(ide-1,jstart:jend)=grid%tg_min_zhel_25(ide-2,jstart:jend)<a name='416'>
       grid%tg_min_zhel_03(ide-1,jstart:jend)=grid%tg_min_zhel_03(ide-2,jstart:jend)<a name='417'>
       grid%tg_updhel25(ide-1,jstart:jend)=grid%tg_updhel25(ide-2,jstart:jend)<a name='418'>
       grid%tg_updhel03(ide-1,jstart:jend)=grid%tg_updhel03(ide-2,jstart:jend)<a name='419'>
       grid%tg_max_updhel25(ide-1,jstart:jend)=grid%tg_max_updhel25(ide-2,jstart:jend)<a name='420'>
       grid%tg_max_updhel03(ide-1,jstart:jend)=grid%tg_max_updhel03(ide-2,jstart:jend)<a name='421'>
       grid%tg_max_wwind(ide-1,jstart:jend)=grid%tg_max_wwind(ide-2,jstart:jend)<a name='422'>
       grid%tg_min_wwind(ide-1,jstart:jend)=grid%tg_min_wwind(ide-2,jstart:jend)<a name='423'>
       grid%tg_max_m10wind(ide-1,jstart:jend)=grid%tg_max_m10wind(ide-2,jstart:jend)<a name='424'>
    endif<a name='425'>
<a name='426'>
    <font color=#447700>! J boundaries: copy from nearest point that has data.  We use<a name='427'></font>
    <font color=#447700>! imin:imax instead of istart:iend to get the corner points.<a name='428'></font>
    if(jps&lt;=jds) then<a name='429'>
       grid%tg_max_zhel_25(imin:imax,jds)=grid%tg_max_zhel_25(imin:imax,jds+1)<a name='430'>
       grid%tg_max_zhel_03(imin:imax,jds)=grid%tg_max_zhel_03(imin:imax,jds+1)<a name='431'>
       grid%tg_min_zhel_25(imin:imax,jds)=grid%tg_min_zhel_25(imin:imax,jds+1)<a name='432'>
       grid%tg_min_zhel_03(imin:imax,jds)=grid%tg_min_zhel_03(imin:imax,jds+1)<a name='433'>
       grid%tg_updhel25(imin:imax,jds)=grid%tg_updhel25(imin:imax,jds+1)<a name='434'>
       grid%tg_updhel03(imin:imax,jds)=grid%tg_updhel03(imin:imax,jds+1)<a name='435'>
       grid%tg_max_updhel25(imin:imax,jds)=grid%tg_max_updhel25(imin:imax,jds+1)<a name='436'>
       grid%tg_max_updhel03(imin:imax,jds)=grid%tg_max_updhel03(imin:imax,jds+1)<a name='437'>
       grid%tg_max_wwind(imin:imax,jds)=grid%tg_max_wwind(imin:imax,jds+1)<a name='438'>
       grid%tg_min_wwind(imin:imax,jds)=grid%tg_min_wwind(imin:imax,jds+1)<a name='439'>
       grid%tg_max_m10wind(imin:imax,jds)=grid%tg_max_m10wind(imin:imax,jds+1)<a name='440'>
    endif<a name='441'>
<a name='442'>
    if(jpe&gt;=jde-2) then<a name='443'>
       grid%tg_max_zhel_25(imin:imax,jde-1)=grid%tg_max_zhel_25(imin:imax,jde-2)<a name='444'>
       grid%tg_max_zhel_03(imin:imax,jde-1)=grid%tg_max_zhel_03(imin:imax,jde-2)<a name='445'>
       grid%tg_min_zhel_25(imin:imax,jde-1)=grid%tg_min_zhel_25(imin:imax,jde-2)<a name='446'>
       grid%tg_min_zhel_03(imin:imax,jde-1)=grid%tg_min_zhel_03(imin:imax,jde-2)<a name='447'>
       grid%tg_updhel25(imin:imax,jde-1)=grid%tg_updhel25(imin:imax,jde-2)<a name='448'>
       grid%tg_updhel03(imin:imax,jde-1)=grid%tg_updhel03(imin:imax,jde-2)<a name='449'>
       grid%tg_max_updhel25(imin:imax,jde-1)=grid%tg_max_updhel25(imin:imax,jde-2)<a name='450'>
       grid%tg_max_updhel03(imin:imax,jde-1)=grid%tg_max_updhel03(imin:imax,jde-2)<a name='451'>
       grid%tg_max_wwind(imin:imax,jde-1)=grid%tg_max_wwind(imin:imax,jde-2)<a name='452'>
       grid%tg_min_wwind(imin:imax,jde-1)=grid%tg_min_wwind(imin:imax,jde-2)<a name='453'>
       grid%tg_max_m10wind(imin:imax,jde-1)=grid%tg_max_m10wind(imin:imax,jde-2)<a name='454'>
    endif<a name='455'>
<a name='456'>
    call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#UPDATE_TG_TIME'>update_tg_time</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="UPDATE_TG_TIME_2">(grid,.false.)<a name='457'>
<a name='458'>
3313 format('TG extrema: max(wind)=',F0.2,' max(w)=',F0.2,' min(w)=',F0.2,'  max(zhel)=',F0.4,' min(zhel)=',F0.4)<a name='459'>
    write(message,3313) maxmaxwind,maxmaxw,minminw,maxmaxzhel,minminzhel<a name='460'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#CALC_TORNADO_GENESIS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_98">(1,message)<a name='461'>
  end subroutine calc_tornado_genesis<a name='462'>
<a name='463'>
end module module_tornado_genesis<a name='464'>
<a name='465'>
<A NAME='NMM_REQUEST_TG_RESET'><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#NMM_REQUEST_TG_RESET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='466'>
<font color=#993300>subroutine </font><font color=#cc0000>nmm_request_tg_reset</font>(grid,config_flags,stream) <A href='../../call_to/NMM_REQUEST_TG_RESET.html' TARGET='index'>1</A>,<A href='../../call_from/NMM_REQUEST_TG_RESET.html' TARGET='index'>4</A><a name='467'>
  <font color=#447700>! This subroutine is a wrapper kludge to work around the WRF build<a name='468'></font>
  <font color=#447700>! order and limitations of make.  The module_tornado_genesis module<a name='469'></font>
  <font color=#447700>! file does not exist when mediation_integrate is compiled, so<a name='470'></font>
  <font color=#447700>! med_hist_out has to call a non-module function instead.<a name='471'></font>
  use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#NMM_REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_60">, only: domain<a name='472'>
  use <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#NMM_REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_42">, only : grid_config_rec_type <a name='473'>
  use <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#MODULE_TORNADO_GENESIS'>module_tornado_genesis</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#NMM_REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_TORNADO_GENESIS_1">, only: request_tg_reset<a name='474'>
  implicit none<a name='475'>
  integer, intent(in) :: stream<a name='476'>
  type(domain), intent(inout) :: grid<a name='477'>
  type(grid_config_rec_type), intent(in) :: config_flags<a name='478'>
  call <A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#REQUEST_TG_RESET'>request_tg_reset</A><A href='../../html_code/dyn_nmm/module_tornado_genesis.F.html#NMM_REQUEST_TG_RESET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="REQUEST_TG_RESET_1">(grid,config_flags,stream)<a name='479'>
end subroutine nmm_request_tg_reset<a name='480'>
</pre></body></html>