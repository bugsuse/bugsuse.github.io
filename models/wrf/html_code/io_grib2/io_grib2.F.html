<HTML> <BODY BGCOLOR=#bbccdd LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!*-----------------------------------------------------------------------------<a name='2'></font>
<font color=#447700>!*<a name='3'></font>
<font color=#447700>!*  Todd Hutchinson<a name='4'></font>
<font color=#447700>!*  WSI<a name='5'></font>
<font color=#447700>!*  400 Minuteman Road<a name='6'></font>
<font color=#447700>!*  Andover, MA     01810<a name='7'></font>
<font color=#447700>!*  thutchinson@wsi.com<a name='8'></font>
<font color=#447700>!*<a name='9'></font>
<font color=#447700>!*  August, 2005<a name='10'></font>
<font color=#447700>!*-----------------------------------------------------------------------------<a name='11'></font>
<a name='12'>
<font color=#447700>!*<a name='13'></font>
<font color=#447700>!* This io_grib2 API is designed to read WRF input and write WRF output data<a name='14'></font>
<font color=#447700>!*   in grib version 2 format.  <a name='15'></font>
<font color=#447700>!*<a name='16'></font>
<a name='17'>
<a name='18'>
#include "<A href='../../html_code/include/wrf_projection.h.html'>wrf_projection.h</A>"<A NAME="wrf_projection.h_1"><A href='../../html_code/io_grib2/io_grib2.F.html#io_grib2.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='19'>
<a name='20'>
<A NAME='GR2_DATA_INFO'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='21'>
<font color=#993300>module </font><font color=#cc0000>gr2_data_info</font> <A href='../../call_to/GR2_DATA_INFO.html' TARGET='index'>74</A>,<A href='../../call_from/GR2_DATA_INFO.html' TARGET='index'>1</A><a name='22'>
<a name='23'>
<font color=#447700>!*<a name='24'></font>
<font color=#447700>!* This module will hold data internal to this I/O implementation.<a name='25'></font>
<font color=#447700>!*   The variables will be accessible by all functions (provided they have a<a name='26'></font>
<font color=#447700>!*   "USE gr2_data_info" line).<a name='27'></font>
<font color=#447700>!*<a name='28'></font>
<a name='29'>
  USE <A href='../../html_code/io_grib2/grib2tbls_types.F.html#GRIB2TBLS_TYPES'>grib2tbls_types</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GRIB2TBLS_TYPES_1"><a name='30'>
<a name='31'>
  integer                , parameter       :: FATAL            = 1<a name='32'>
  integer                , parameter       :: DEBUG            = 100<a name='33'>
  integer                , parameter       :: DateStrLen       = 19<a name='34'>
  integer                , parameter       :: maxMsgSize       = 300<a name='35'>
  integer                , parameter       :: firstFileHandle  = 8<a name='36'>
  integer                , parameter       :: maxFileHandles   = 200<a name='37'>
  integer                , parameter       :: maxLevels        = 1000<a name='38'>
  integer                , parameter       :: maxSoilLevels    = 100<a name='39'>
  integer                , parameter       :: maxDomains       = 500<a name='40'>
  character(200)                           :: mapfilename = 'grib2map.tbl'<a name='41'>
<a name='42'>
  integer                , parameter       :: JIDSSIZE = 13<a name='43'>
  integer                , parameter       :: JPDTSIZE = 15<a name='44'>
  integer                , parameter       :: JGDTSIZE = 30<a name='45'>
<a name='46'>
  logical                                  :: grib2map_table_filled = .FALSE.<a name='47'>
<a name='48'>
  logical                                  :: WrfIOnotInitialized = .true.<a name='49'>
<a name='50'>
  integer, dimension(maxDomains)           :: domains<a name='51'>
  integer                                  :: max_domain = 0<a name='52'>
<a name='53'>
  character*24                             :: StartDate = ''<a name='54'>
  character*24                             :: InputProgramName = ''<a name='55'>
  real                                     :: timestep<a name='56'>
  integer                                  :: full_xsize, full_ysize<a name='57'>
  REAL,          dimension(maxSoilLevels)  :: soil_depth, soil_thickness<a name='58'>
  REAL,          dimension(maxLevels)      :: half_eta, full_eta<a name='59'>
<a name='60'>
  integer                                  :: wrf_projection<a name='61'>
  integer                                  :: background_proc_id<a name='62'>
  integer                                  :: forecast_proc_id<a name='63'>
  integer                                  :: production_status<a name='64'>
  integer                                  :: compression<a name='65'>
  real                                     :: center_lat, center_lon<a name='66'>
  real                                     :: dx,dy<a name='67'>
  real                                     :: truelat1, truelat2<a name='68'>
  real                                     :: proj_central_lon<a name='69'>
<a name='70'>
  TYPE :: HandleVar<a name='71'>
     character, dimension(:), pointer      :: fileindex(:)<a name='72'>
     integer                               :: CurrentTime<a name='73'>
     integer                               :: NumberTimes<a name='74'>
     integer                               :: sizeAllocated = 0<a name='75'>
     logical                               :: write = .FALSE.<a name='76'>
     character (DateStrLen), dimension(:),allocatable  :: Times(:)<a name='77'>
     logical                               :: committed, opened, used<a name='78'>
     character*128                         :: DataFile<a name='79'>
     integer                               :: FileFd<a name='80'>
     integer                               :: FileStatus<a name='81'>
     integer                               :: recnum<a name='82'>
     real                                  :: last_scalar_time_written<a name='83'>
  ENDTYPE<a name='84'>
  TYPE (HandleVar), dimension(maxFileHandles),SAVE :: fileinfo<a name='85'>
<a name='86'>
  character(len=30000), dimension(maxFileHandles) :: td_output<a name='87'>
  character(len=30000), dimension(maxFileHandles) :: ti_output<a name='88'>
  character(len=30000), dimension(maxFileHandles) :: scalar_output<a name='89'>
  character(len=30000), dimension(maxFileHandles) :: global_input = ''<a name='90'>
  character(len=30000), dimension(maxFileHandles) :: scalar_input = ''<a name='91'>
<a name='92'>
  real                                     :: last_fcst_secs<a name='93'>
  real                                     :: fcst_secs<a name='94'>
<a name='95'>
  logical                                  :: half_eta_init       = .FALSE.<a name='96'>
  logical                                  :: full_eta_init       = .FALSE.<a name='97'>
  logical                                  :: soil_thickness_init = .FALSE.<a name='98'>
  logical                                  :: soil_depth_init     = .FALSE.<a name='99'>
<a name='100'>
end module gr2_data_info<a name='101'>
<a name='102'>
<a name='103'>
<font color=#447700>!*****************************************************************************<a name='104'></font>
<a name='105'>
<A NAME='EXT_GR2_IOINIT'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='106'>
<font color=#993300>subroutine </font><font color=#cc0000>ext_gr2_ioinit</font>(SysDepInfo,Status) <A href='../../call_to/EXT_GR2_IOINIT.html' TARGET='index'>5</A>,<A href='../../call_from/EXT_GR2_IOINIT.html' TARGET='index'>2</A><a name='107'>
<a name='108'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_1"><a name='109'>
  implicit none<a name='110'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_2"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='111'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_3"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='112'>
  CHARACTER*(*), INTENT(IN) :: SysDepInfo<a name='113'>
  integer ,intent(out) :: Status<a name='114'>
  integer :: i<a name='115'>
  CHARACTER (LEN=300) :: wrf_err_message<a name='116'>
<a name='117'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1232"> ( DEBUG , 'Entering ext_gr2_ioinit')<a name='118'>
<a name='119'>
  do i=firstFileHandle, maxFileHandles<a name='120'>
        fileinfo(i)%used = .false.<a name='121'>
        fileinfo(i)%committed = .false.<a name='122'>
        fileinfo(i)%opened = .false.<a name='123'>
        td_output(i) = ''<a name='124'>
        ti_output(i) = ''<a name='125'>
        scalar_output(i) = ''<a name='126'>
  enddo<a name='127'>
  domains(:) = -1<a name='128'>
  last_fcst_secs = -1.0<a name='129'>
<a name='130'>
  fileinfo(1:maxFileHandles)%FileStatus = WRF_FILE_NOT_OPENED<a name='131'>
  WrfIOnotInitialized = .false.<a name='132'>
<a name='133'>
  Status = WRF_NO_ERR<a name='134'>
<a name='135'>
  return<a name='136'>
end subroutine ext_gr2_ioinit<a name='137'>
<a name='138'>
<font color=#447700>!*****************************************************************************<a name='139'></font>
<a name='140'>
<A NAME='EXT_GR2_IOEXIT'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='141'>
<font color=#993300>subroutine </font><font color=#cc0000>ext_gr2_ioexit</font>(Status) <A href='../../call_to/EXT_GR2_IOEXIT.html' TARGET='index'>5</A>,<A href='../../call_from/EXT_GR2_IOEXIT.html' TARGET='index'>3</A><a name='142'>
<a name='143'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_2"><a name='144'>
  implicit none<a name='145'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_4"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='146'>
  integer ,intent(out) :: Status<a name='147'>
<a name='148'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1233"> ( DEBUG , 'Entering ext_gr2_ioexit')<a name='149'>
<a name='150'>
  Status = WRF_NO_ERR<a name='151'>
<a name='152'>
  if (grib2map_table_filled) then<a name='153'>
     call <A href='../../html_code/io_grib2/read_grib2map.F.html#FREE_GRIB2MAP'>free_grib2map</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FREE_GRIB2MAP_1">()<a name='154'>
     grib2map_table_filled = .FALSE.<a name='155'>
  endif<a name='156'>
<a name='157'>
  return<a name='158'>
end subroutine ext_gr2_ioexit<a name='159'>
<a name='160'>
<font color=#447700>!*****************************************************************************<a name='161'></font>
<a name='162'>
<A NAME='EXT_GR2_OPEN_FOR_READ_BEGIN'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='163'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_open_for_read_begin</font> ( FileName , Comm_compute, Comm_io, &amp; <A href='../../call_to/EXT_GR2_OPEN_FOR_READ_BEGIN.html' TARGET='index'>2</A>,<A href='../../call_from/EXT_GR2_OPEN_FOR_READ_BEGIN.html' TARGET='index'>27</A><a name='164'>
     SysDepInfo, DataHandle , Status )<a name='165'>
<a name='166'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_3"><a name='167'>
  USE <A href='../../html_code/io_grib2/grib2tbls_types.F.html#GRIB2TBLS_TYPES'>grib2tbls_types</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GRIB2TBLS_TYPES_2"><a name='168'>
  USE grib_mod<a name='169'>
  IMPLICIT NONE<a name='170'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_5"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='171'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_6"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='172'>
  CHARACTER*(*) :: FileName<a name='173'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='174'>
  CHARACTER*(*) :: SysDepInfo<a name='175'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='176'>
  INTEGER ,       INTENT(OUT) :: Status<a name='177'>
  CHARACTER (LEN=maxMsgSize) :: msg<a name='178'>
<a name='179'>
  integer :: center, subcenter, MasterTblV, &amp;<a name='180'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl<a name='181'>
<a name='182'>
  integer :: fields_to_skip<a name='183'>
  integer :: JIDS(JIDSSIZE), JPDTN, JPDT(JPDTSIZE), JGDTN, &amp;<a name='184'>
       JGDT(JGDTSIZE)<a name='185'>
  logical :: UNPACK<a name='186'>
  character*(100) :: VarName<a name='187'>
  type(gribfield) :: gfld<a name='188'>
  integer         :: idx<a name='189'>
  character(len=DateStrLen) :: theTime,refTime<a name='190'>
  integer         :: time_range_convert(13)<a name='191'>
  integer         :: fcstsecs<a name='192'>
  integer         :: endchar<a name='193'>
  integer         :: ierr<a name='194'>
<a name='195'>
  INTERFACE<a name='196'>
     Subroutine load_grib2map (filename, message, status)<a name='197'>
       USE <A href='../../html_code/io_grib2/grib2tbls_types.F.html#GRIB2TBLS_TYPES'>grib2tbls_types</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GRIB2TBLS_TYPES_3"><a name='198'>
       character*(*), intent(in)                   :: filename<a name='199'>
       character*(*), intent(inout)                :: message<a name='200'>
       integer      , intent(out)                  :: status<a name='201'>
     END subroutine load_grib2map<a name='202'>
  END INTERFACE<a name='203'>
<a name='204'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1234"> ( DEBUG , &amp;<a name='205'>
       'Entering ext_gr2_open_for_read_begin, opening '//trim(FileName))<a name='206'>
<a name='207'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_NEW_HANDLE'>gr2_get_new_handle</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_NEW_HANDLE_1">(DataHandle)<a name='208'>
<a name='209'>
  <font color=#447700>!<a name='210'></font>
  <font color=#447700>! Open grib file<a name='211'></font>
  <font color=#447700>!<a name='212'></font>
  if (DataHandle .GT. 0) then<a name='213'>
     <a name='214'>
     call baopenr(DataHandle,trim(FileName),status)<a name='215'>
<a name='216'>
     if (status .ne. 0) then<a name='217'>
        Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='218'>
     else<a name='219'>
        fileinfo(DataHandle)%opened = .true.<a name='220'>
        fileinfo(DataHandle)%DataFile = TRIM(FileName)<a name='221'>
        fileinfo(DataHandle)%FileStatus = WRF_FILE_OPENED_NOT_COMMITTED<a name='222'>
<font color=#447700>!        fileinfo(DataHandle)%CurrentTime = 1<a name='223'></font>
     endif<a name='224'>
  else<a name='225'>
     Status = WRF_WARN_TOO_MANY_FILES<a name='226'>
     return<a name='227'>
  endif<a name='228'>
 <a name='229'>
  fileinfo(DataHandle)%recnum = -1<a name='230'>
<a name='231'>
  <font color=#447700>!<a name='232'></font>
  <font color=#447700>! Fill up the grib2tbls structure from data in the grib2map file.<a name='233'></font>
  <font color=#447700>!<a name='234'></font>
  if (.NOT. grib2map_table_filled) then<a name='235'>
     grib2map_table_filled = .TRUE.<a name='236'>
     CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#LOAD_GRIB2MAP'>load_grib2map</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOAD_GRIB2MAP_1">(mapfilename, msg, status)<a name='237'>
     if (status .ne. 0) then<a name='238'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1492">(trim(msg))<a name='239'>
        Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='240'>
        return<a name='241'>
     endif<a name='242'>
  endif<a name='243'>
<a name='244'>
<a name='245'>
  <font color=#447700>!<a name='246'></font>
  <font color=#447700>! Get the parameter info for metadata<a name='247'></font>
  <font color=#447700>!<a name='248'></font>
  VarName = "WRF_GLOBAL"<a name='249'>
  CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_1">(VarName, center, subcenter, MasterTblV, &amp;<a name='250'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='251'>
  if (status .ne. 0) then<a name='252'>
     write(msg,*) 'Could not find parameter for '//   &amp;<a name='253'>
          trim(VarName)//'   Skipping output of '//trim(VarName)<a name='254'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1493">(trim(msg))<a name='255'>
     Status =  WRF_GRIB2_ERR_GRIB2MAP<a name='256'>
     return<a name='257'>
  endif<a name='258'>
<a name='259'>
  <font color=#447700>!<a name='260'></font>
  <font color=#447700>! Read the metadata<a name='261'></font>
  <font color=#447700>!<a name='262'></font>
  fields_to_skip = 0<a name='263'>
  <a name='264'>
  <font color=#447700>!<a name='265'></font>
  <font color=#447700>! First, set all values to the wildcard, then reset values that we wish<a name='266'></font>
  <font color=#447700>!    to specify.<a name='267'></font>
  <font color=#447700>!<a name='268'></font>
  call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD'>gr2_g2lib_wildcard</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_G2LIB_WILDCARD_1">(JIDS, JPDT, JGDT)<a name='269'>
  <a name='270'>
  JIDS(1) = center<a name='271'>
  JIDS(2) = subcenter<a name='272'>
  JIDS(3) = MasterTblV<a name='273'>
  JIDS(4) = LocalTblV<a name='274'>
  JIDS(5) = 1           <font color=#447700>! Indicates that time is "Start of Forecast"<a name='275'></font>
  JIDS(13) = 1          <font color=#447700>! Type of processed data (1 for forecast products)<a name='276'></font>
  <a name='277'>
  JPDTN = 0             <font color=#447700>! Product definition template number<a name='278'></font>
  JPDT(1) = Category<a name='279'>
  JPDT(2) = ParmNum<a name='280'>
  JPDT(3) = 2           <font color=#447700>! Generating process id<a name='281'></font>
  JPDT(9) = 0           <font color=#447700>! Forecast time <a name='282'></font>
<a name='283'>
  JGDTN    = -1         <font color=#447700>! Indicates that any Grid Display Template is a match<a name='284'></font>
  <a name='285'>
  UNPACK   = .FALSE.    <font color=#447700>! Dont unpack bitmap and data values<a name='286'></font>
<a name='287'>
  CALL GETGB2(DataHandle, DataHandle, fields_to_skip, -1, Disc, JIDS, JPDTN, &amp;<a name='288'>
       JPDT, JGDTN, JGDT, UNPACK, fileinfo(DataHandle)%recnum, gfld, status)<a name='289'>
  if (status .ne. 0) then<a name='290'>
     if (status .eq. 99) then<a name='291'>
        write(msg,*)'Could not find metadata field named '//trim(VarName)<a name='292'>
     else<a name='293'>
        write(msg,*)'Retrieving grib field '//trim(VarName)//' failed, ',status<a name='294'>
     endif<a name='295'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1494">(trim(msg))<a name='296'>
     status = WRF_GRIB2_ERR_GETGB2<a name='297'>
     return<a name='298'>
  endif<a name='299'>
<a name='300'>
  global_input(DataHandle) = transfer(gfld%local,global_input(DataHandle))<a name='301'>
  global_input(DataHandle)(gfld%locallen+1:30000) = ' '<a name='302'>
<a name='303'>
  call gf_free(gfld)<a name='304'>
<a name='305'>
  <font color=#447700>!<a name='306'></font>
  <font color=#447700>! Read and index all scalar data<a name='307'></font>
  <font color=#447700>!<a name='308'></font>
  VarName = "WRF_SCALAR"<a name='309'>
  CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_2">(VarName, center, subcenter, MasterTblV, &amp;<a name='310'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='311'>
  if (status .ne. 0) then<a name='312'>
     write(msg,*) 'Could not find parameter for '//   &amp;<a name='313'>
          trim(VarName)//'   Skipping reading of '//trim(VarName)<a name='314'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1495">(trim(msg))<a name='315'>
     Status =  WRF_GRIB2_ERR_GRIB2MAP<a name='316'>
     return<a name='317'>
  endif<a name='318'>
<a name='319'>
  <font color=#447700>!<a name='320'></font>
  <font color=#447700>! Read the metadata<a name='321'></font>
  <font color=#447700>!<a name='322'></font>
  <font color=#447700>! First, set all values to wild, then specify necessary values<a name='323'></font>
  <font color=#447700>!<a name='324'></font>
  call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD'>gr2_g2lib_wildcard</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_G2LIB_WILDCARD_2">(JIDS, JPDT, JGDT)<a name='325'>
<a name='326'>
  JIDS(1) = center<a name='327'>
  JIDS(2) = subcenter<a name='328'>
  JIDS(3) = MasterTblV<a name='329'>
  JIDS(4) = LocalTblV<a name='330'>
<a name='331'>
  JIDS(5) = 1           <font color=#447700>! Indicates that time is "Start of Forecast"<a name='332'></font>
  JIDS(13) = 1          <font color=#447700>! Type of processed data (1 for forecast products)<a name='333'></font>
  <a name='334'>
  JPDTN = 0             <font color=#447700>! Product definition template number<a name='335'></font>
  JPDT(1) = Category<a name='336'>
  JPDT(2) = ParmNum<a name='337'>
  JPDT(3) = 2           <font color=#447700>! Generating process id<a name='338'></font>
<a name='339'>
  JGDTN    = -1         <font color=#447700>! Indicates that any Grid Display Template is a match<a name='340'></font>
  <a name='341'>
  UNPACK   = .FALSE.    <font color=#447700>! Dont unpack bitmap and data values<a name='342'></font>
<a name='343'>
  fields_to_skip = 0<a name='344'>
  do while (status .eq. 0) <a name='345'>
     CALL GETGB2(DataHandle, 0, fields_to_skip, -1, -1, JIDS, JPDTN, &amp;<a name='346'>
          JPDT, JGDTN, JGDT, UNPACK, fileinfo(DataHandle)%recnum, &amp;<a name='347'>
          gfld, status)<a name='348'>
     if (status .eq. 99) then<a name='349'>
        exit<a name='350'>
     else if (status .ne. 0) then<a name='351'>
        write(msg,*)'Finding data field '//trim(VarName)//' failed 1.'<a name='352'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1496">(trim(msg))<a name='353'>
        Status = WRF_GRIB2_ERR_READ<a name='354'>
        return<a name='355'>
     endif<a name='356'>
     <a name='357'>
     <font color=#447700>! Build times list here<a name='358'></font>
     write(refTime,'(I4,A,I2.2,A,I2.2,A,I2.2,A,I2.2,A,I2.2)')      &amp;<a name='359'>
          gfld%idsect(6),'-',gfld%idsect(7),'-',gfld%idsect(8),'_',&amp;<a name='360'>
          gfld%idsect(9),':',gfld%idsect(10),':',gfld%idsect(11)<a name='361'>
<a name='362'>
     time_range_convert(:) = -1<a name='363'>
     time_range_convert(1) = 60<a name='364'>
     time_range_convert(2) = 60*60<a name='365'>
     time_range_convert(3) = 24*60*60<a name='366'>
     time_range_convert(10) = 3*60*60<a name='367'>
     time_range_convert(11) = 6*60*60<a name='368'>
     time_range_convert(12) = 12*60*60<a name='369'>
     time_range_convert(13) = 1<a name='370'>
     <a name='371'>
     if (time_range_convert(gfld%ipdtmpl(8)) .gt. 0) then<a name='372'>
        fcstsecs = gfld%ipdtmpl(9)*time_range_convert(gfld%ipdtmpl(8))<a name='373'>
     else <a name='374'>
        write(msg,*)'Invalid time range in input data: ',gfld%ipdtmpl(8),&amp;<a name='375'>
             ' Skipping'<a name='376'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1497">(trim(msg))<a name='377'>
        call gf_free(gfld)<a name='378'>
        cycle<a name='379'>
     endif<a name='380'>
     call <A href='../../html_code/io_grib_share/io_grib_share.F.html#ADVANCE_WRF_TIME'>advance_wrf_time</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADVANCE_WRF_TIME_1">(refTime,fcstsecs,theTime)<a name='381'>
<a name='382'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADD_TIME'>gr2_add_time</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_ADD_TIME_1">(DataHandle,theTime)<a name='383'>
<a name='384'>
     fields_to_skip = fields_to_skip + fileinfo(DataHandle)%recnum<a name='385'>
<a name='386'>
     scalar_input(DataHandle) = transfer(gfld%local,scalar_input(DataHandle))<a name='387'>
     scalar_input(DataHandle)(gfld%locallen+1:30000) = ' '<a name='388'>
     <a name='389'>
     call gf_free(gfld)<a name='390'>
  enddo<a name='391'>
<a name='392'>
  <font color=#447700>!<a name='393'></font>
  <font color=#447700>! Fill up the eta levels variables<a name='394'></font>
  <font color=#447700>!<a name='395'></font>
<a name='396'>
  if (.not. full_eta_init) then<a name='397'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS'>gr2_fill_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LEVELS_1">(DataHandle, "ZNW", full_eta, ierr)<a name='398'>
     if (ierr .eq. 0) then<a name='399'>
        full_eta_init = .TRUE.<a name='400'>
     endif<a name='401'>
  endif<a name='402'>
  if (.not. half_eta_init) then<a name='403'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS'>gr2_fill_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LEVELS_2">(DataHandle, "ZNU", half_eta, ierr)<a name='404'>
     if (ierr .eq. 0) then <a name='405'>
        half_eta_init = .TRUE.<a name='406'>
     endif<a name='407'>
  endif<a name='408'>
  <font color=#447700>!<a name='409'></font>
  <font color=#447700>! Fill up the soil levels<a name='410'></font>
  <font color=#447700>!<a name='411'></font>
  if (.not. soil_depth_init) then<a name='412'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS'>gr2_fill_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LEVELS_3">(DataHandle,"ZS",soil_depth, ierr)<a name='413'>
     if (ierr .eq. 0) then<a name='414'>
        soil_depth_init = .TRUE.<a name='415'>
     endif<a name='416'>
  endif<a name='417'>
  if (.not. soil_thickness_init) then<a name='418'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS'>gr2_fill_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LEVELS_4">(DataHandle,"DZS",soil_thickness, ierr)<a name='419'>
     if (ierr .eq. 0) then<a name='420'>
        soil_thickness_init = .TRUE.<a name='421'>
     endif<a name='422'>
  endif<a name='423'>
<a name='424'>
  <font color=#447700>! <a name='425'></font>
  <font color=#447700>! Fill up any variables from the global metadata<a name='426'></font>
  <font color=#447700>!<a name='427'></font>
<a name='428'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_1">(global_input(DataHandle), &amp;<a name='429'>
       'START_DATE', StartDate, status)<a name='430'>
  if (status .ne. 0) then<a name='431'>
     write(msg,*)'Could not find metadata value for START_DATE, continuing'<a name='432'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1498">(trim(msg))<a name='433'>
  endif<a name='434'>
 <a name='435'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_2">(global_input(DataHandle), &amp;<a name='436'>
       'PROGRAM_NAME', InputProgramName, status)<a name='437'>
  if (status .ne. 0) then<a name='438'>
     write(msg,*)'Could not find metadata value for PROGRAM_NAME, continuing'<a name='439'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1499">(trim(msg))<a name='440'>
  else<a name='441'>
     endchar = SCAN(InputProgramName," ")<a name='442'>
     InputProgramName = InputProgramName(1:endchar)<a name='443'>
  endif<a name='444'>
<a name='445'>
<a name='446'>
  Status = WRF_NO_ERR<a name='447'>
<a name='448'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1235"> ( DEBUG , 'Exiting ext_gr2_open_for_read_begin')<a name='449'>
<a name='450'>
  RETURN<a name='451'>
END SUBROUTINE ext_gr2_open_for_read_begin<a name='452'>
<a name='453'>
<font color=#447700>!*****************************************************************************<a name='454'></font>
<a name='455'>
<A NAME='EXT_GR2_OPEN_FOR_READ_COMMIT'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='456'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_open_for_read_commit</font>( DataHandle , Status ) <A href='../../call_to/EXT_GR2_OPEN_FOR_READ_COMMIT.html' TARGET='index'>2</A>,<A href='../../call_from/EXT_GR2_OPEN_FOR_READ_COMMIT.html' TARGET='index'>3</A><a name='457'>
<a name='458'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_4"><a name='459'>
  IMPLICIT NONE<a name='460'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_7"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='461'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_8"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='462'>
  character(len=maxMsgSize) :: msg<a name='463'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='464'>
  INTEGER ,       INTENT(OUT) :: Status<a name='465'>
<a name='466'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1236"> ( DEBUG , 'Entering ext_gr2_open_for_read_commit')<a name='467'>
<a name='468'>
  Status = WRF_NO_ERR<a name='469'>
  if(WrfIOnotInitialized) then<a name='470'>
    Status = WRF_IO_NOT_INITIALIZED<a name='471'>
    write(msg,*) 'ext_gr2_ioinit was not called ',__FILE__,', line', __LINE__<a name='472'>
    call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1237"> ( FATAL , msg)<a name='473'>
    return<a name='474'>
  endif<a name='475'>
  fileinfo(DataHandle)%committed = .true.<a name='476'>
  fileinfo(DataHandle)%FileStatus = WRF_FILE_OPENED_FOR_READ<a name='477'>
<a name='478'>
  Status = WRF_NO_ERR<a name='479'>
<a name='480'>
  RETURN<a name='481'>
END SUBROUTINE ext_gr2_open_for_read_commit<a name='482'>
<a name='483'>
<font color=#447700>!*****************************************************************************<a name='484'></font>
<a name='485'>
<A NAME='EXT_GR2_OPEN_FOR_READ'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='486'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_open_for_read</font> ( FileName , Comm_compute, Comm_io, &amp; <A href='../../call_to/EXT_GR2_OPEN_FOR_READ.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_OPEN_FOR_READ.html' TARGET='index'>4</A><a name='487'>
     SysDepInfo, DataHandle , Status )<a name='488'>
<a name='489'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_5"><a name='490'>
  IMPLICIT NONE<a name='491'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_9"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='492'>
  CHARACTER*(*) :: FileName<a name='493'>
  INTEGER ,       INTENT(IN)  :: Comm_compute , Comm_io<a name='494'>
  CHARACTER*(*) :: SysDepInfo<a name='495'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='496'>
  INTEGER ,       INTENT(OUT) :: Status<a name='497'>
<a name='498'>
<a name='499'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1238"> ( DEBUG , 'Entering ext_gr2_open_for_read')<a name='500'>
<a name='501'>
  DataHandle = 0   <font color=#447700>! dummy setting to quiet warning message<a name='502'></font>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN'>ext_gr2_open_for_read_begin</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_READ_BEGIN_2">( FileName, Comm_compute, Comm_io, &amp;<a name='503'>
       SysDepInfo, DataHandle, Status )<a name='504'>
  IF ( Status .EQ. WRF_NO_ERR ) THEN<a name='505'>
    CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT'>ext_gr2_open_for_read_commit</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_READ_COMMIT_2">( DataHandle, Status )<a name='506'>
  ENDIF<a name='507'>
  return<a name='508'>
<a name='509'>
  RETURN  <a name='510'>
END SUBROUTINE ext_gr2_open_for_read<a name='511'>
<a name='512'>
<font color=#447700>!*****************************************************************************<a name='513'></font>
<a name='514'>
<A NAME='EXT_GR2_OPEN_FOR_WRITE_BEGIN'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='515'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_open_for_write_begin</font>(FileName, Comm, IOComm, SysDepInfo, &amp; <A href='../../call_to/EXT_GR2_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>5</A>,<A href='../../call_from/EXT_GR2_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>6</A><a name='516'>
     DataHandle, Status)<a name='517'>
  <a name='518'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_6"><a name='519'>
  implicit none<a name='520'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_10"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='521'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_11"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='522'>
<a name='523'>
  character*(*)        ,intent(in)  :: FileName<a name='524'>
  integer              ,intent(in)  :: Comm<a name='525'>
  integer              ,intent(in)  :: IOComm<a name='526'>
  character*(*)        ,intent(in)  :: SysDepInfo<a name='527'>
  integer              ,intent(out) :: DataHandle<a name='528'>
  integer              ,intent(out) :: Status<a name='529'>
  integer :: ierr<a name='530'>
  CHARACTER (LEN=maxMsgSize) :: msg<a name='531'>
<a name='532'>
  INTERFACE<a name='533'>
     Subroutine load_grib2map (filename, message, status)<a name='534'>
       USE <A href='../../html_code/io_grib2/grib2tbls_types.F.html#GRIB2TBLS_TYPES'>grib2tbls_types</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GRIB2TBLS_TYPES_4"><a name='535'>
       character*(*), intent(in)                   :: filename<a name='536'>
       character*(*), intent(inout)                :: message<a name='537'>
       integer      , intent(out)                  :: status<a name='538'>
     END subroutine load_grib2map<a name='539'>
  END INTERFACE<a name='540'>
<a name='541'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1239"> ( DEBUG , 'Entering ext_gr2_open_for_write_begin')<a name='542'>
<a name='543'>
  Status = WRF_NO_ERR<a name='544'>
<a name='545'>
  if (.NOT. grib2map_table_filled) then<a name='546'>
     grib2map_table_filled = .TRUE.<a name='547'>
     CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#LOAD_GRIB2MAP'>load_grib2map</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOAD_GRIB2MAP_2">(mapfilename, msg, status)<a name='548'>
     if (status .ne. 0) then<a name='549'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1500">(trim(msg))<a name='550'>
        Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='551'>
        return<a name='552'>
     endif<a name='553'>
  endif<a name='554'>
<a name='555'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_NEW_HANDLE'>gr2_get_new_handle</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_NEW_HANDLE_2">(DataHandle)<a name='556'>
<a name='557'>
  if (DataHandle .GT. 0) then<a name='558'>
<a name='559'>
     call baopenw(DataHandle,trim(FileName),ierr)<a name='560'>
<a name='561'>
     if (ierr .ne. 0) then<a name='562'>
        Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='563'>
     else<a name='564'>
        fileinfo(DataHandle)%opened = .true.<a name='565'>
        fileinfo(DataHandle)%DataFile = TRIM(FileName)<a name='566'>
        fileinfo(DataHandle)%FileStatus = WRF_FILE_OPENED_NOT_COMMITTED<a name='567'>
     endif<a name='568'>
     fileinfo(DataHandle)%last_scalar_time_written = -1<a name='569'>
     fileinfo(DataHandle)%committed = .false.<a name='570'>
     td_output(DataHandle) = ''<a name='571'>
     ti_output(DataHandle) = ''<a name='572'>
     scalar_output(DataHandle) = ''<a name='573'>
     fileinfo(DataHandle)%write = .true.<a name='574'>
  else<a name='575'>
     Status = WRF_WARN_TOO_MANY_FILES<a name='576'>
  endif<a name='577'>
<a name='578'>
  RETURN  <a name='579'>
END SUBROUTINE ext_gr2_open_for_write_begin<a name='580'>
<a name='581'>
<font color=#447700>!*****************************************************************************<a name='582'></font>
<a name='583'>
<A NAME='EXT_GR2_OPEN_FOR_WRITE_COMMIT'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='584'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_open_for_write_commit</font>( DataHandle , Status ) <A href='../../call_to/EXT_GR2_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>5</A>,<A href='../../call_from/EXT_GR2_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>2</A><a name='585'>
<a name='586'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_7"><a name='587'>
  IMPLICIT NONE<a name='588'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_12"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='589'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_13"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='590'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='591'>
  INTEGER ,       INTENT(OUT) :: Status<a name='592'>
<a name='593'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1240"> ( DEBUG , 'Entering ext_gr2_open_for_write_commit')<a name='594'>
<a name='595'>
  IF ( fileinfo(DataHandle)%opened ) THEN<a name='596'>
    IF ( fileinfo(DataHandle)%used ) THEN<a name='597'>
      fileinfo(DataHandle)%committed = .true.<a name='598'>
      fileinfo(DataHandle)%FileStatus = WRF_FILE_OPENED_FOR_WRITE<a name='599'>
    ENDIF<a name='600'>
  ENDIF<a name='601'>
<a name='602'>
  Status = WRF_NO_ERR<a name='603'>
<a name='604'>
  RETURN  <a name='605'>
END SUBROUTINE ext_gr2_open_for_write_commit<a name='606'>
<a name='607'>
<font color=#447700>!*****************************************************************************<a name='608'></font>
<a name='609'>
<A NAME='EXT_GR2_INQUIRY'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='610'>
<font color=#993300>subroutine </font><font color=#cc0000>ext_gr2_inquiry</font> (Inquiry, Result, Status),<A href='../../call_from/EXT_GR2_INQUIRY.html' TARGET='index'>1</A><a name='611'>
  use <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_8"><a name='612'>
  implicit none<a name='613'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_14"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='614'>
  character *(*), INTENT(IN)    :: Inquiry<a name='615'>
  character *(*), INTENT(OUT)   :: Result<a name='616'>
  integer        ,INTENT(INOUT) :: Status<a name='617'>
  SELECT CASE (Inquiry)<a name='618'>
  CASE ("RANDOM_WRITE","RANDOM_READ")<a name='619'>
     Result='ALLOW'<a name='620'>
  CASE ("SEQUENTIAL_WRITE","SEQUENTIAL_READ")<a name='621'>
     Result='NO'<a name='622'>
  CASE ("OPEN_READ", "OPEN_WRITE", "OPEN_COMMIT_WRITE")<a name='623'>
     Result='REQUIRE'<a name='624'>
  CASE ("OPEN_COMMIT_READ","PARALLEL_IO")<a name='625'>
     Result='NO'<a name='626'>
  CASE ("SELF_DESCRIBING","SUPPORT_METADATA","SUPPORT_3D_FIELDS")<a name='627'>
     Result='YES'<a name='628'>
  CASE ("MEDIUM")<a name='629'>
     Result ='FILE'<a name='630'>
  CASE DEFAULT<a name='631'>
     Result = 'No Result for that inquiry<font color=#447700>!'<a name='632'></font>
  END SELECT<a name='633'>
  Status=WRF_NO_ERR<a name='634'>
  return<a name='635'>
end subroutine ext_gr2_inquiry<a name='636'>
<a name='637'>
<font color=#447700>!*****************************************************************************<a name='638'></font>
<a name='639'>
<A NAME='EXT_GR2_INQUIRE_OPENED'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='640'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_inquire_opened</font> ( DataHandle, FileName , FileStat, Status ) <A href='../../call_to/EXT_GR2_INQUIRE_OPENED.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_INQUIRE_OPENED.html' TARGET='index'>2</A><a name='641'>
<a name='642'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_9"><a name='643'>
  IMPLICIT NONE<a name='644'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_15"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='645'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_16"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='646'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='647'>
  CHARACTER*(*) :: FileName<a name='648'>
  INTEGER ,       INTENT(OUT) :: FileStat<a name='649'>
  INTEGER ,       INTENT(OUT) :: Status<a name='650'>
<a name='651'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1241"> ( DEBUG , 'Entering ext_gr2_inquire_opened')<a name='652'>
<a name='653'>
  FileStat = WRF_NO_ERR<a name='654'>
  if ((DataHandle .ge. firstFileHandle) .and. &amp;<a name='655'>
       (DataHandle .le. maxFileHandles)) then<a name='656'>
     FileStat = fileinfo(DataHandle)%FileStatus<a name='657'>
  else<a name='658'>
     FileStat = WRF_FILE_NOT_OPENED<a name='659'>
  endif<a name='660'>
  <a name='661'>
  Status = FileStat<a name='662'>
<a name='663'>
  RETURN<a name='664'>
END SUBROUTINE ext_gr2_inquire_opened<a name='665'>
<a name='666'>
<font color=#447700>!*****************************************************************************<a name='667'></font>
<a name='668'>
<A NAME='EXT_GR2_IOCLOSE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='669'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_ioclose</font> ( DataHandle, Status ) <A href='../../call_to/EXT_GR2_IOCLOSE.html' TARGET='index'>5</A>,<A href='../../call_from/EXT_GR2_IOCLOSE.html' TARGET='index'>7</A><a name='670'>
<a name='671'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_10"><a name='672'>
  IMPLICIT NONE<a name='673'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_17"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='674'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_18"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='675'>
  INTEGER DataHandle, Status<a name='676'>
  INTEGER istat<a name='677'>
  character(len=1000) :: outstring<a name='678'>
  character :: lf<a name='679'>
  character*(maxMsgSize) :: msg<a name='680'>
  integer   :: idx<a name='681'>
<a name='682'>
  lf=char(10)<a name='683'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1242"> ( DEBUG , 'Entering ext_gr2_ioclose')<a name='684'>
<a name='685'>
  Status = WRF_NO_ERR<a name='686'>
<a name='687'>
  if (fileinfo(DataHandle)%write .eqv. .TRUE.) then<a name='688'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE'>gr2_fill_local_use</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LOCAL_USE_1">(DataHandle,scalar_output(DataHandle),&amp;<a name='689'>
          "WRF_SCALAR",fcst_secs,msg,status)<a name='690'>
     if (status .ne. 0) then<a name='691'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1501">(trim(msg))<a name='692'>
        return<a name='693'>
     endif<a name='694'>
     fileinfo(DataHandle)%last_scalar_time_written = fcst_secs<a name='695'>
     scalar_output(DataHandle) = ''<a name='696'>
     <a name='697'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE'>gr2_fill_local_use</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LOCAL_USE_2">(DataHandle,&amp;<a name='698'>
          trim(ti_output(DataHandle))//trim(td_output(DataHandle)),&amp;<a name='699'>
          "WRF_GLOBAL",0,msg,status)<a name='700'>
     if (status .ne. 0) then<a name='701'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1502">(trim(msg))<a name='702'>
        return<a name='703'>
     endif<a name='704'>
     ti_output(DataHandle) = ''<a name='705'>
     td_output(DataHandle) = ''<a name='706'>
  endif<a name='707'>
<a name='708'>
  do idx = 1,fileinfo(DataHandle)%NumberTimes <a name='709'>
     if (allocated(fileinfo(DataHandle)%Times)) then<a name='710'>
        deallocate(fileinfo(DataHandle)%Times)<a name='711'>
     endif<a name='712'>
  enddo<a name='713'>
  fileinfo(DataHandle)%NumberTimes = 0<a name='714'>
  fileinfo(DataHandle)%sizeAllocated = 0<a name='715'>
  fileinfo(DataHandle)%CurrentTime = 0<a name='716'>
  fileinfo(DataHandle)%write = .FALSE.<a name='717'>
<a name='718'>
  call baclose(DataHandle,status)<a name='719'>
  if (status .ne. 0) then<a name='720'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1503">("Closing file failed, continuing")<a name='721'>
  else<a name='722'>
     fileinfo(DataHandle)%opened = .true.<a name='723'>
     fileinfo(DataHandle)%DataFile = ''<a name='724'>
     fileinfo(DataHandle)%FileStatus = WRF_FILE_NOT_OPENED<a name='725'>
  endif<a name='726'>
<a name='727'>
  fileinfo(DataHandle)%used = .false.<a name='728'>
<a name='729'>
  RETURN<a name='730'>
END SUBROUTINE ext_gr2_ioclose<a name='731'>
<a name='732'>
<font color=#447700>!*****************************************************************************<a name='733'></font>
<a name='734'>
<A NAME='EXT_GR2_WRITE_FIELD'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='735'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_write_field</font>( DataHandle , DateStrIn , VarName , &amp; <A href='../../call_to/EXT_GR2_WRITE_FIELD.html' TARGET='index'>2</A>,<A href='../../call_from/EXT_GR2_WRITE_FIELD.html' TARGET='index'>26</A><a name='736'>
     Field , FieldType , Comm , IOComm, &amp;<a name='737'>
     DomainDesc , MemoryOrder , Stagger , &amp;<a name='738'>
     DimNames , &amp;<a name='739'>
     DomainStart , DomainEnd , &amp;<a name='740'>
     MemoryStart , MemoryEnd , &amp;<a name='741'>
     PatchStart , PatchEnd , &amp;<a name='742'>
     Status )<a name='743'>
<a name='744'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_11"><a name='745'>
  USE <A href='../../html_code/io_grib2/grib2tbls_types.F.html#GRIB2TBLS_TYPES'>grib2tbls_types</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GRIB2TBLS_TYPES_5"><a name='746'>
  IMPLICIT NONE<a name='747'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_19"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='748'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_20"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='749'>
  integer                       ,intent(in)    :: DataHandle <a name='750'>
  character*(*)                 ,intent(in)    :: DateStrIn<a name='751'>
  character*(*)                 ,intent(in)    :: VarName<a name='752'>
  integer                       ,intent(in)    :: FieldType<a name='753'>
  integer                       ,intent(inout) :: Comm<a name='754'>
  integer                       ,intent(inout) :: IOComm<a name='755'>
  integer                       ,intent(in)    :: DomainDesc<a name='756'>
  character*(*)                 ,intent(in)    :: MemoryOrder<a name='757'>
  character*(*)                 ,intent(in)    :: Stagger<a name='758'>
  character*(*) , dimension (*) ,intent(in)    :: DimNames<a name='759'>
  integer ,dimension(*)         ,intent(in)    :: DomainStart, DomainEnd<a name='760'>
  integer ,dimension(*)         ,intent(in)    :: MemoryStart, MemoryEnd<a name='761'>
  integer ,dimension(*)         ,intent(in)    :: PatchStart,  PatchEnd<a name='762'>
  integer                       ,intent(out)   :: Status<a name='763'>
<a name='764'>
  real                          , intent(in), &amp;<a name='765'>
       dimension( 1:1,MemoryStart(1):MemoryEnd(1), &amp;<a name='766'>
       MemoryStart(2):MemoryEnd(2), &amp;<a name='767'>
       MemoryStart(3):MemoryEnd(3) )           :: Field<a name='768'>
<a name='769'>
<a name='770'>
  character (120)                              :: DateStr<a name='771'>
<a name='772'>
  character (maxMsgSize)                       :: msg<a name='773'>
  integer                                      :: xsize, ysize, zsize<a name='774'>
  integer                                      :: x, y, z<a name='775'>
  integer                                      :: &amp;<a name='776'>
       x_start,x_end,y_start,y_end,z_start,z_end<a name='777'>
  integer                                      :: idx<a name='778'>
  integer                                      :: proj_center_flag<a name='779'>
  logical                                      :: vert_stag = .false.<a name='780'>
  real,    dimension(:,:), pointer             :: data<a name='781'>
  integer                                      :: istat<a name='782'>
  integer                                      :: accum_period<a name='783'>
  integer, dimension(maxLevels)                :: level1, level2<a name='784'>
  integer, dimension(maxLevels)                :: grib_levels<a name='785'>
  logical                                      :: soil_layers, fraction<a name='786'>
  integer                                      :: vert_unit1, vert_unit2<a name='787'>
  integer                                      :: vert_sclFctr1, vert_sclFctr2<a name='788'>
  integer                                      :: this_domain<a name='789'>
  logical                                      :: new_domain<a name='790'>
  real                                         :: &amp;<a name='791'>
       region_center_lat, region_center_lon<a name='792'>
  integer                                      :: dom_xsize, dom_ysize;<a name='793'>
  integer , parameter                          :: lcgrib = 2000000<a name='794'>
  character (lcgrib)                           :: cgrib<a name='795'>
  integer                                      :: ierr<a name='796'>
  integer                                      :: lengrib<a name='797'>
<a name='798'>
  integer                                     :: center, subcenter, &amp;<a name='799'>
       MasterTblV, LocalTblV, Disc, Category, ParmNum, DecScl, BinScl<a name='800'>
  CHARACTER(len=100)  :: tmpstr<a name='801'>
  integer             :: ndims<a name='802'>
  integer             :: dim1size, dim2size, dim3size, dim3<a name='803'>
  integer             :: numlevels<a name='804'>
  integer             :: ngrdpts<a name='805'>
  integer             :: bytes_written<a name='806'>
  <a name='807'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1243"> ( DEBUG , 'Entering ext_gr2_write_field for parameter '//&amp;<a name='808'>
       VarName)<a name='809'>
<a name='810'>
  <font color=#447700>!<a name='811'></font>
  <font color=#447700>! If DateStr is all 0s, we reset it to StartDate.  For some reason, <a name='812'></font>
  <font color=#447700>!   in idealized simulations, StartDate is 0001-01-01_00:00:00 while<a name='813'></font>
  <font color=#447700>!   the first DateStr is 0000-00-00_00:00:00.  <a name='814'></font>
  <font color=#447700>!<a name='815'></font>
  if (DateStrIn .eq. '0000-00-00_00:00:00') then<a name='816'>
     DateStr = TRIM(StartDate)<a name='817'>
  else<a name='818'>
     DateStr = DateStrIn<a name='819'>
  endif<a name='820'>
<a name='821'>
  <font color=#447700>!<a name='822'></font>
  <font color=#447700>! Check if this is a domain that we haven t seen yet.  If so, add it to <a name='823'></font>
  <font color=#447700>!   the list of domains.<a name='824'></font>
  <font color=#447700>!<a name='825'></font>
  this_domain = 0<a name='826'>
  new_domain = .false.<a name='827'>
  do idx = 1, max_domain<a name='828'>
     if (DomainDesc .eq. domains(idx)) then<a name='829'>
        this_domain = idx<a name='830'>
     endif<a name='831'>
  enddo<a name='832'>
  if (this_domain .eq. 0) then<a name='833'>
     max_domain = max_domain + 1<a name='834'>
     domains(max_domain) = DomainDesc<a name='835'>
     this_domain = max_domain<a name='836'>
     new_domain = .true.<a name='837'>
  endif<a name='838'>
<a name='839'>
  zsize = 1<a name='840'>
  xsize = 1<a name='841'>
  ysize = 1<a name='842'>
  soil_layers = .false.<a name='843'>
  fraction = .false.<a name='844'>
<a name='845'>
  <font color=#447700>! First, handle then special cases for the boundary data.<a name='846'></font>
<a name='847'>
  CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GET_DIMS'>get_dims</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_DIMS_4">(MemoryOrder, PatchStart, PatchEnd, ndims, x_start, x_end, &amp;<a name='848'>
       y_start, y_end,z_start,z_end)<a name='849'>
  xsize = x_end - x_start + 1<a name='850'>
  ysize = y_end - y_start + 1<a name='851'>
  zsize = z_end - z_start + 1<a name='852'>
<a name='853'>
  do idx = 1, len(MemoryOrder)<a name='854'>
     if ((MemoryOrder(idx:idx) .eq. 'Z') .and. &amp;<a name='855'>
          (DimNames(idx) .eq. 'soil_layers_stag')) then<a name='856'>
        soil_layers = .true.<a name='857'>
     else if ((VarName .eq. 'LANDUSEF') .or. (VarName .eq. 'SOILCBOT') .or. &amp;<a name='858'>
          (VarName .eq. 'SOILCTOP')) then<a name='859'>
        fraction = .true.<a name='860'>
     endif<a name='861'>
  enddo<a name='862'>
<a name='863'>
  if (zsize .eq. 0) then <a name='864'>
     zsize = 1<a name='865'>
  endif<a name='866'>
<a name='867'>
  <font color=#447700>!<a name='868'></font>
  <font color=#447700>! Fill up the variables that hold the vertical coordinate data<a name='869'></font>
  <font color=#447700>!<a name='870'></font>
<a name='871'>
  if (VarName .eq. 'ZNU') then<a name='872'>
     do idx = 1, zsize<a name='873'>
        half_eta(idx) = Field(1,idx,1,1)<a name='874'>
     enddo<a name='875'>
     half_eta_init = .TRUE.<a name='876'>
  endif<a name='877'>
<a name='878'>
  if (VarName .eq. 'ZNW') then<a name='879'>
     do idx = 1, zsize<a name='880'>
        full_eta(idx) = Field(1,idx,1,1)<a name='881'>
     enddo<a name='882'>
     full_eta_init = .TRUE.<a name='883'>
  endif<a name='884'>
  <a name='885'>
  if (VarName .eq. 'ZS') then<a name='886'>
     do idx = 1, zsize<a name='887'>
        soil_depth(idx) = Field(1,idx,1,1)<a name='888'>
     enddo<a name='889'>
     soil_depth_init = .TRUE.<a name='890'>
  endif<a name='891'>
<a name='892'>
  if (VarName .eq. 'DZS') then<a name='893'>
     do idx = 1, zsize<a name='894'>
        soil_thickness(idx) = Field(1,idx,1,1)<a name='895'>
     enddo<a name='896'>
     soil_thickness_init = .TRUE.<a name='897'>
  endif<a name='898'>
<a name='899'>
  <font color=#447700>! <a name='900'></font>
  <font color=#447700>! Check to assure that dimensions are valid<a name='901'></font>
  <font color=#447700>!<a name='902'></font>
<a name='903'>
  if ((xsize .lt. 1) .or. (ysize .lt. 1) .or. (zsize .lt. 1)) then<a name='904'>
     write(msg,*) 'Cannot output field with memory order: ', &amp;<a name='905'>
          MemoryOrder,Varname<a name='906'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1504">(trim(msg))<a name='907'>
     return<a name='908'>
  endif<a name='909'>
     <a name='910'>
<a name='911'>
  if (fileinfo(DataHandle)%opened .and. fileinfo(DataHandle)%committed) then<a name='912'>
<a name='913'>
     if (StartDate == '') then<a name='914'>
        StartDate = DateStr<a name='915'>
     endif<a name='916'>
     <a name='917'>
     CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GETH_IDTS'>geth_idts</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_IDTS_4">(DateStr,StartDate,fcst_secs)<a name='918'>
<a name='919'>
     <font color=#447700>!<a name='920'></font>
     <font color=#447700>! If this is a new forecast time, and we have not written the <a name='921'></font>
     <font color=#447700>!   last_fcst_secs scalar output yet, then write it here.<a name='922'></font>
     <font color=#447700>!<a name='923'></font>
<a name='924'>
     if ((abs(fcst_secs - 0.0) .gt. 0.01) .and. &amp;<a name='925'>
          (last_fcst_secs .ge. 0) .and. &amp;<a name='926'>
          (abs(fcst_secs - last_fcst_secs) .gt. 0.01) .and. &amp;<a name='927'>
          (abs(last_fcst_secs - fileinfo(DataHandle)%last_scalar_time_written) .gt. 0.01) ) then<a name='928'>
        call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE'>gr2_fill_local_use</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_FILL_LOCAL_USE_3">(DataHandle,scalar_output(DataHandle),&amp;<a name='929'>
             "WRF_SCALAR",last_fcst_secs,msg,status)<a name='930'>
        if (status .ne. 0) then<a name='931'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1505">(trim(msg))<a name='932'>
           return<a name='933'>
        endif<a name='934'>
        fileinfo(DataHandle)%last_scalar_time_written = last_fcst_secs<a name='935'>
        scalar_output(DataHandle) = ''<a name='936'>
     endif<a name='937'>
<a name='938'>
     call <A href='../../html_code/io_grib_share/io_grib_share.F.html#GET_VERT_STAG'>get_vert_stag</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VERT_STAG_3">(VarName,Stagger,vert_stag)<a name='939'>
     <a name='940'>
     do idx = 1, zsize<a name='941'>
        call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_LEVELS'>gr2_get_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_LEVELS_1">(VarName, idx, zsize, soil_layers, vert_stag, &amp;<a name='942'>
             fraction, vert_unit1, vert_unit2, vert_sclFctr1, &amp;<a name='943'>
             vert_sclFctr2, level1(idx), level2(idx))<a name='944'>
     enddo<a name='945'>
     <a name='946'>
     <font color=#447700>! <a name='947'></font>
     <font color=#447700>! Get the center lat/lon for the area being output.  For some cases (such<a name='948'></font>
     <font color=#447700>!    as for boundary areas, the center of the area is different from the<a name='949'></font>
     <font color=#447700>!    center of the model grid.<a name='950'></font>
     <font color=#447700>!<a name='951'></font>
     if (index(Stagger,'X') .le. 0) then<a name='952'>
        dom_xsize = full_xsize - 1<a name='953'>
     else<a name='954'>
        dom_xsize = full_xsize<a name='955'>
     endif<a name='956'>
     if (index(Stagger,'Y') .le. 0) then<a name='957'>
        dom_ysize = full_ysize - 1<a name='958'>
     else<a name='959'>
        dom_ysize = full_ysize<a name='960'>
     endif<a name='961'>
     <a name='962'>
<a name='963'>
     CALL get_region_center(MemoryOrder, wrf_projection, center_lat, &amp;<a name='964'>
          center_lon, dom_xsize, dom_ysize, dx, dy, proj_central_lon, &amp;<a name='965'>
          proj_center_flag, truelat1, truelat2, xsize, ysize, &amp;<a name='966'>
          region_center_lat, region_center_lon)<a name='967'>
     <a name='968'>
<a name='969'>
     if (ndims .eq. 0) then        <font color=#447700>! Scalar quantity<a name='970'></font>
<a name='971'>
        ALLOCATE(data(1:1,1:1), STAT=istat)<a name='972'>
<a name='973'>
        call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_RETRIEVE_DATA'>gr2_retrieve_data</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_RETRIEVE_DATA_1">(MemoryOrder, MemoryStart, MemoryEnd, &amp;<a name='974'>
             xsize, ysize, zsize, z, FieldType, Field, data)<a name='975'>
        write(tmpstr,'(G17.10)')data(1,1)<a name='976'>
        CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_1"> (scalar_output(DataHandle), &amp;<a name='977'>
             trim(adjustl(VarName)), tmpstr, 1, Status)<a name='978'>
<a name='979'>
        DEALLOCATE(data)<a name='980'>
<a name='981'>
     else if (ndims .ge. 1) then   <font color=#447700>! Vector (1-D) and 2/3 D quantities<a name='982'></font>
<a name='983'>
        if (ndims .eq. 1) then     <font color=#447700>! Handle Vector (1-D) parameters<a name='984'></font>
           dim1size = zsize<a name='985'>
           dim2size = 1<a name='986'>
           dim3size = 1<a name='987'>
        else                       <font color=#447700>! Handle 2/3 D parameters<a name='988'></font>
           dim1size = xsize<a name='989'>
           dim2size = ysize<a name='990'>
           dim3size = zsize<a name='991'>
        endif<a name='992'>
        <a name='993'>
        ALLOCATE(data(1:dim1size,1:dim2size), STAT=istat)<a name='994'>
<a name='995'>
        CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_3">(VarName, center, subcenter, MasterTblV, &amp;<a name='996'>
             LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='997'>
        if (status .ne. 0) then<a name='998'>
           write(msg,*) 'Could not find parameter for '//   &amp;<a name='999'>
                trim(VarName)//'   Skipping output of '//trim(VarName)<a name='1000'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1506">(trim(msg))<a name='1001'>
           Status =  WRF_GRIB2_ERR_GRIB2MAP<a name='1002'>
           return<a name='1003'>
        endif<a name='1004'>
<a name='1005'>
        VERTDIM : do dim3 = 1, dim3size<a name='1006'>
<a name='1007'>
           call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_RETRIEVE_DATA'>gr2_retrieve_data</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_RETRIEVE_DATA_2">(MemoryOrder, MemoryStart, MemoryEnd, xsize, &amp;<a name='1008'>
                ysize, zsize, dim3, FieldType, Field, data)<a name='1009'>
        <a name='1010'>
           <font color=#447700>! <a name='1011'></font>
           <font color=#447700>! Here, we do any necessary conversions to the data.<a name='1012'></font>
           <font color=#447700>!<a name='1013'></font>
           <a name='1014'>
           <font color=#447700>! Potential temperature is sometimes passed in as perturbation <a name='1015'></font>
           <font color=#447700>!   potential temperature (i.e., POT-300).  Other times (i.e., from <a name='1016'></font>
           <font color=#447700>!   WRF SI), it is passed in as full potential temperature.<a name='1017'></font>
           <font color=#447700>! Here, we convert to full potential temperature by adding 300<a name='1018'></font>
           <font color=#447700>!   only if POT &lt; 200 K.<a name='1019'></font>
           <font color=#447700>!<a name='1020'></font>
           if (VarName == 'T') then<a name='1021'>
              if ((data(1,1) &lt; 200) .and. (data(1,1) .ne. 0)) then<a name='1022'>
                 data = data + 300<a name='1023'>
              endif<a name='1024'>
           endif<a name='1025'>
           <a name='1026'>
           <font color=#447700>! <a name='1027'></font>
           <font color=#447700>! For precip, we setup the accumulation period, and output a precip<a name='1028'></font>
           <font color=#447700>!    rate for time-step precip.<a name='1029'></font>
           <font color=#447700>!<a name='1030'></font>
           if ((VarName .eq. 'RAINCV') .or. (VarName .eq. 'RAINNCV')) then<a name='1031'>
              <font color=#447700>! Convert time-step precip to precip rate.<a name='1032'></font>
              data = data/timestep<a name='1033'>
              accum_period = 0<a name='1034'>
           else<a name='1035'>
              accum_period = 0<a name='1036'>
           endif<a name='1037'>
           <a name='1038'>
           <font color=#447700>!<a name='1039'></font>
           <font color=#447700>! Create indicator and identification sections (sections 0 and 1)<a name='1040'></font>
           <font color=#447700>!<a name='1041'></font>
           CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CREATE_W'>gr2_create_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CREATE_W_1">(StartDate, cgrib, lcgrib, production_status, &amp;<a name='1042'>
                Disc, center, subcenter, MasterTblV, LocalTblV, ierr, msg)<a name='1043'>
           if (ierr .ne. 0) then<a name='1044'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1507">(trim(msg))<a name='1045'>
              Status = WRF_GRIB2_ERR_GRIBCREATE<a name='1046'>
              return<a name='1047'>
           endif<a name='1048'>
<a name='1049'>
           <font color=#447700>!<a name='1050'></font>
           <font color=#447700>! Add the grid definition section (section 3) using a 1x1 grid<a name='1051'></font>
           <font color=#447700>!<a name='1052'></font>
           call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W'>gr2_addgrid_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_ADDGRID_W_1">(cgrib, lcgrib, center_lat, proj_central_lon,  &amp;<a name='1053'>
                wrf_projection, truelat1, truelat2, xsize, ysize, dx, dy, &amp;<a name='1054'>
                region_center_lat, region_center_lon, ierr, msg)<a name='1055'>
           if (ierr .ne. 0) then<a name='1056'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1508">(trim(msg))<a name='1057'>
              Status = WRF_GRIB2_ERR_ADDGRIB<a name='1058'>
              return<a name='1059'>
           endif<a name='1060'>
<a name='1061'>
           if (ndims .eq. 1) then<a name='1062'>
              numlevels = zsize<a name='1063'>
              grib_levels(:) = level1(:)<a name='1064'>
              ngrdpts = zsize<a name='1065'>
           else<a name='1066'>
              numlevels = 2<a name='1067'>
              grib_levels(1) = level1(dim3)<a name='1068'>
              grib_levels(2) = level2(dim3)<a name='1069'>
              ngrdpts = xsize*ysize<a name='1070'>
           endif<a name='1071'>
           <a name='1072'>
           <font color=#447700>!<a name='1073'></font>
           <font color=#447700>! Add the Product Definition, Data representation, bitmap <a name='1074'></font>
           <font color=#447700>!      and data sections (sections 4-7)<a name='1075'></font>
           <font color=#447700>!<a name='1076'></font>
           <a name='1077'>
           call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDFIELD_W'>gr2_addfield_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_ADDFIELD_W_1">(cgrib, lcgrib, VarName, Category, ParmNum, &amp;<a name='1078'>
                DecScl, BinScl, fcst_secs, vert_unit1, vert_unit2, &amp;<a name='1079'>
                vert_sclFctr1, vert_sclFctr2, numlevels, &amp;<a name='1080'>
                grib_levels, ngrdpts,  background_proc_id, forecast_proc_id, &amp;<a name='1081'>
                compression, data, ierr, msg)<a name='1082'>
           if (ierr .eq. 11) then<a name='1083'>
              write(msg,'(A,I7,A)') 'WARNING: decimal scale for field '//&amp;<a name='1084'>
                   trim(VarName)//' at level ',grib_levels(1),&amp;<a name='1085'>
                   ' was reduced to fit field into 24 bits.  '//&amp;<a name='1086'>
                   ' Some precision may be lost<font color=#447700>!'//&amp;<a name='1087'></font>
                   '     To prevent this message, reduce decimal scale '//&amp;<a name='1088'>
                   'factor in '//trim(mapfilename)<a name='1089'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1509">(trim(msg))<a name='1090'>
           else if (ierr .eq. 12) then<a name='1091'>
              write(msg,'(A,I7,A)') 'WARNING: binary scale for field '//&amp;<a name='1092'>
                   trim(VarName)//' at level ',grib_levels(1), &amp;<a name='1093'>
                   ' was reduced to fit field into 24 bits.  '//&amp;<a name='1094'>
                   ' Some precision may be lost<font color=#447700>!'//&amp;<a name='1095'></font>
                   '     To prevent this message, reduce binary scale '//&amp;<a name='1096'>
                   'factor in '//trim(mapfilename)<a name='1097'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1510">(trim(msg))<a name='1098'>
           else if (ierr .ne. 0) then<a name='1099'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1511">(trim(msg))<a name='1100'>
              Status = WRF_GRIB2_ERR_ADDFIELD<a name='1101'>
              return<a name='1102'>
           endif<a name='1103'>
<a name='1104'>
           <font color=#447700>!<a name='1105'></font>
           <font color=#447700>! Close out the message<a name='1106'></font>
           <font color=#447700>!<a name='1107'></font>
           <a name='1108'>
           call gribend(cgrib,lcgrib,lengrib,ierr)<a name='1109'>
           if (ierr .ne. 0) then<a name='1110'>
              write(msg,*) 'gribend failed with ierr: ',ierr     <a name='1111'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1512">(trim(msg))<a name='1112'>
              Status = WRF_GRIB2_ERR_GRIBEND<a name='1113'>
              return<a name='1114'>
           endif<a name='1115'>
<a name='1116'>
           <font color=#447700>! <a name='1117'></font>
           <font color=#447700>! Write the data to the file<a name='1118'></font>
           <font color=#447700>!<a name='1119'></font>
           <a name='1120'>
<font color=#447700>!           call write_file_n(fileinfo(DataHandle)%FileFd, cgrib, lengrib, ierr)<a name='1121'></font>
           call bawrite(DataHandle, -1, lengrib, bytes_written, cgrib)<a name='1122'>
           if (bytes_written .ne. lengrib) then<a name='1123'>
              write(msg,*) '1 Error writing cgrib to file, wrote: ', &amp;<a name='1124'>
                   bytes_written, ' bytes.  Tried to write ', lengrib, ' bytes'<a name='1125'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1513">(trim(msg))<a name='1126'>
              Status = WRF_GRIB2_ERR_WRITE<a name='1127'>
              return<a name='1128'>
           endif<a name='1129'>
<a name='1130'>
        ENDDO VERTDIM<a name='1131'>
        <a name='1132'>
        DEALLOCATE(data)<a name='1133'>
<a name='1134'>
     endif<a name='1135'>
<a name='1136'>
     last_fcst_secs = fcst_secs<a name='1137'>
<a name='1138'>
  endif<a name='1139'>
<a name='1140'>
  deallocate(data, STAT = istat)<a name='1141'>
<a name='1142'>
  Status = WRF_NO_ERR<a name='1143'>
<a name='1144'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1244"> ( DEBUG , 'Leaving ext_gr2_write_field')<a name='1145'>
<a name='1146'>
  RETURN<a name='1147'>
END SUBROUTINE ext_gr2_write_field<a name='1148'>
<a name='1149'>
<font color=#447700>!*****************************************************************************<a name='1150'></font>
<a name='1151'>
<A NAME='EXT_GR2_READ_FIELD'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1152'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_read_field</font> ( DataHandle , DateStr , VarName , Field , &amp;,<A href='../../call_from/EXT_GR2_READ_FIELD.html' TARGET='index'>20</A><a name='1153'>
     FieldType , Comm , IOComm, DomainDesc , MemoryOrder , Stagger ,     &amp;<a name='1154'>
     DimNames , DomainStart , DomainEnd , MemoryStart , MemoryEnd ,      &amp;<a name='1155'>
     PatchStart , PatchEnd ,  Status )<a name='1156'>
<a name='1157'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_12"><a name='1158'>
  USE grib_mod<a name='1159'>
  IMPLICIT NONE  <a name='1160'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_21"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1161'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_22"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1162'>
  INTEGER                       ,intent(in)       :: DataHandle <a name='1163'>
  CHARACTER*(*)                 ,intent(in)       :: DateStr<a name='1164'>
  CHARACTER*(*)                 ,intent(in)       :: VarName<a name='1165'>
  integer                       ,intent(inout)    :: FieldType<a name='1166'>
  integer                       ,intent(inout)    :: Comm<a name='1167'>
  integer                       ,intent(inout)    :: IOComm<a name='1168'>
  integer                       ,intent(inout)    :: DomainDesc<a name='1169'>
  character*(*)                 ,intent(inout)    :: MemoryOrder<a name='1170'>
  character*(*)                 ,intent(inout)    :: Stagger<a name='1171'>
  character*(*) , dimension (*) ,intent(inout)    :: DimNames<a name='1172'>
  integer ,dimension(*)         ,intent(inout)    :: DomainStart, DomainEnd<a name='1173'>
  integer ,dimension(*)         ,intent(inout)    :: MemoryStart, MemoryEnd<a name='1174'>
  integer ,dimension(*)         ,intent(inout)    :: PatchStart,  PatchEnd<a name='1175'>
  integer                       ,intent(out)      :: Status<a name='1176'>
  INTEGER                       ,intent(out)      :: Field(*)<a name='1177'>
  integer                       :: xsize,ysize,zsize<a name='1178'>
  integer                       :: x_start,x_end,y_start,y_end,z_start,z_end<a name='1179'>
  integer                       :: ndims<a name='1180'>
  character (len=1000)          :: Value<a name='1181'>
  character (maxMsgSize)        :: msg<a name='1182'>
  integer                       :: ierr<a name='1183'>
  real                          :: Data<a name='1184'>
  integer                       :: center, subcenter, MasterTblV, &amp;<a name='1185'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl<a name='1186'>
  integer                       :: dim1size,dim2size,dim3size,dim3<a name='1187'>
<a name='1188'>
  integer :: idx<a name='1189'>
  integer :: fields_to_skip<a name='1190'>
  integer :: JIDS(JIDSSIZE), JPDTN, JPDT(JPDTSIZE), JGDTN, &amp;<a name='1191'>
       JGDT(JGDTSIZE)<a name='1192'>
  logical :: UNPACK<a name='1193'>
  type(gribfield) :: gfld<a name='1194'>
  logical                                      :: soil_layers, fraction<a name='1195'>
  logical                                      :: vert_stag = .false.<a name='1196'>
  integer                                      :: vert_unit1, vert_unit2<a name='1197'>
  integer                                      :: vert_sclFctr1, vert_sclFctr2<a name='1198'>
  integer                                      :: level1, level2<a name='1199'>
  integer                                      :: di<a name='1200'>
  real                                         :: tmpreal<a name='1201'>
<a name='1202'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1245"> ( DEBUG , 'Entering ext_gr2_read_field'//fileinfo(DataHandle)%DataFile)<a name='1203'>
  <a name='1204'>
  CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GET_DIMS'>get_dims</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_DIMS_5">(MemoryOrder, PatchStart, PatchEnd, ndims, x_start, x_end, &amp;<a name='1205'>
       y_start, y_end,z_start,z_end)<a name='1206'>
  xsize = x_end - x_start + 1<a name='1207'>
  ysize = y_end - y_start + 1<a name='1208'>
  zsize = z_end - z_start + 1<a name='1209'>
<a name='1210'>
  <font color=#447700>! <a name='1211'></font>
  <font color=#447700>! Check to assure that dimensions are valid<a name='1212'></font>
  <font color=#447700>!<a name='1213'></font>
<a name='1214'>
  if ((xsize .lt. 1) .or. (ysize .lt. 1) .or. (zsize .lt. 1)) then<a name='1215'>
     write(msg,*) 'Cannot retrieve field with memory order: ', &amp;<a name='1216'>
          MemoryOrder,Varname<a name='1217'>
     Status = WRF_GRIB2_ERR_READ<a name='1218'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1514">(trim(msg))<a name='1219'>
     return<a name='1220'>
  endif<a name='1221'>
     <a name='1222'>
<a name='1223'>
  if (ndims .eq. 0) then    <font color=#447700>! Scalar quantity<a name='1224'></font>
<a name='1225'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_3">(scalar_input(DataHandle),trim(VarName),&amp;<a name='1226'>
          Value,ierr)<a name='1227'>
     if (ierr /= 0) then<a name='1228'>
        Status = WRF_GRIB2_ERR_READ<a name='1229'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1515"> ( &amp;<a name='1230'>
             "gr2_get_metadata_value failed for Scalar variable "//&amp;<a name='1231'>
             trim(VarName))<a name='1232'>
        return<a name='1233'>
     endif<a name='1234'>
<a name='1235'>
     READ(Value,*,IOSTAT=ierr)Data<a name='1236'>
     if (ierr .ne. 0) then<a name='1237'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1516">("Reading data from "//trim(VarName)//" failed")<a name='1238'>
        Status = WRF_GRIB2_ERR_READ<a name='1239'>
        return<a name='1240'>
     endif<a name='1241'>
<a name='1242'>
     if (FieldType .eq. WRF_INTEGER) then<a name='1243'>
        Field(1:1) = data<a name='1244'>
     else if ((FieldType .eq. WRF_REAL) .or. (FieldType .eq. WRF_DOUBLE)) then<a name='1245'>
        Field(1:1) = TRANSFER(data,Field(1),1)<a name='1246'>
     else<a name='1247'>
        write (msg,*)'Reading of type ',FieldType,'from grib data not supported, not reading ',VarName<a name='1248'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1517">(msg)<a name='1249'>
     endif<a name='1250'>
<a name='1251'>
  else if (ndims .ge. 1) then   <font color=#447700>! Vector (1-D) and 2/3 D quantities<a name='1252'></font>
     <a name='1253'>
     if (ndims .eq. 1) then     <font color=#447700>! Handle Vector (1-D) parameters<a name='1254'></font>
        dim1size = zsize<a name='1255'>
        dim2size = 1<a name='1256'>
        dim3size = 1<a name='1257'>
     else                       <font color=#447700>! Handle 2/3 D parameters<a name='1258'></font>
        dim1size = xsize<a name='1259'>
        dim2size = ysize<a name='1260'>
        dim3size = zsize<a name='1261'>
     endif<a name='1262'>
     <a name='1263'>
     CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_4">(VarName, center, subcenter, MasterTblV, &amp;<a name='1264'>
          LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='1265'>
     if (status .ne. 0) then<a name='1266'>
        write(msg,*) 'Could not find parameter for '//   &amp;<a name='1267'>
             trim(VarName)//'   Skipping output of '//trim(VarName)<a name='1268'>
        call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1518">(trim(msg))<a name='1269'>
        Status =  WRF_GRIB2_ERR_GRIB2MAP<a name='1270'>
        return<a name='1271'>
     endif<a name='1272'>
     <a name='1273'>
     CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GET_VERT_STAG'>get_vert_stag</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VERT_STAG_4">(VarName,Stagger,vert_stag)<a name='1274'>
     CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GET_SOIL_LAYERS'>get_soil_layers</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_SOIL_LAYERS_2">(VarName,soil_layers)<a name='1275'>
<a name='1276'>
     VERTDIM : do dim3 = 1, dim3size<a name='1277'>
<a name='1278'>
        fields_to_skip = 0<a name='1279'>
<a name='1280'>
        <font color=#447700>!<a name='1281'></font>
        <font color=#447700>! First, set all values to wild, then specify necessary values<a name='1282'></font>
        <font color=#447700>!<a name='1283'></font>
        call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD'>gr2_g2lib_wildcard</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_G2LIB_WILDCARD_3">(JIDS, JPDT, JGDT)<a name='1284'>
<a name='1285'>
        JIDS(1) = center<a name='1286'>
        JIDS(2) = subcenter<a name='1287'>
        JIDS(3) = MasterTblV<a name='1288'>
        JIDS(4) = LocalTblV<a name='1289'>
        JIDS(5) = 1           <font color=#447700>! Indicates that time is "Start of Forecast"<a name='1290'></font>
        <a name='1291'>
        READ (StartDate,'(I4.4,1X,I2.2,1X,I2.2,1X,I2.2,1X,I2.2,1X,I2.2)') &amp;<a name='1292'>
             (JIDS(idx),idx=6,11)<a name='1293'>
        JIDS(13) = 1          <font color=#447700>! Type of processed data(1 for forecast products)<a name='1294'></font>
        <a name='1295'>
        JPDT(1) = Category<a name='1296'>
        JPDT(2) = ParmNum<a name='1297'>
        JPDT(3) = 2           <font color=#447700>! Generating process id<a name='1298'></font>
<a name='1299'>
        CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#GETH_IDTS'>geth_idts</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GETH_IDTS_5">(DateStr,StartDate,tmpreal)  <font color=#447700>! Forecast time <a name='1300'></font>
        <a name='1301'>
        JPDT(9) = NINT(tmpreal)<a name='1302'>
<a name='1303'>
        if (ndims .eq. 1) then<a name='1304'>
           jpdtn = 1000       <font color=#447700>! Product definition tmplate (1000 for cross-sxn)<a name='1305'></font>
        else<a name='1306'>
           call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_LEVELS'>gr2_get_levels</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_LEVELS_2">(VarName, dim3, dim3size, soil_layers, &amp;<a name='1307'>
                vert_stag, .false., vert_unit1, vert_unit2, vert_sclFctr1, &amp;<a name='1308'>
                vert_sclFctr2, level1, level2)<a name='1309'>
           <a name='1310'>
           jpdtn = 0          <font color=#447700>! Product definition template (0 for horiz grid)<a name='1311'></font>
           JPDT(10) = vert_unit1     <font color=#447700>! Type of first surface<a name='1312'></font>
           JPDT(11) = vert_sclFctr1  <font color=#447700>! Scale factor first surface<a name='1313'></font>
           JPDT(12) = level1         <font color=#447700>! First surface<a name='1314'></font>
           JPDT(13) = vert_unit2     <font color=#447700>! Type of second surface<a name='1315'></font>
           JPDT(14) = vert_sclFctr2  <font color=#447700>! Scale factor second surface<a name='1316'></font>
           JPDT(15) = level2         <font color=#447700>! Second fixed surface<a name='1317'></font>
        endif<a name='1318'>
<a name='1319'>
        JGDTN    = -1    <font color=#447700>! Indicates that any Grid Display Template is a match<a name='1320'></font>
        <a name='1321'>
        UNPACK   = .TRUE.<font color=#447700>! Unpack bitmap and data values<a name='1322'></font>
        <a name='1323'>
        fields_to_skip = 0<a name='1324'>
        CALL GETGB2(DataHandle, 0, fields_to_skip, &amp;<a name='1325'>
             fileinfo(DataHandle)%recnum+1, &amp;<a name='1326'>
             Disc, JIDS, JPDTN, JPDT, JGDTN, JGDT, UNPACK, &amp;<a name='1327'>
             fileinfo(DataHandle)%recnum, gfld, status)<a name='1328'>
        if (status .eq. 99) then<a name='1329'>
           write(msg,*)'Could not find data for field '//trim(VarName)//&amp;<a name='1330'>
                ' in file '//trim(fileinfo(DataHandle)%DataFile)<a name='1331'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1519">(trim(msg))<a name='1332'>
           Status = WRF_GRIB2_ERR_READ<a name='1333'>
           return<a name='1334'>
        else if (status .ne. 0) then<a name='1335'>
           write(msg,*)'Retrieving data field '//trim(VarName)//' failed 2.',status,dim3,DataHandle<a name='1336'>
           call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1520">(trim(msg))<a name='1337'>
           Status = WRF_GRIB2_ERR_READ<a name='1338'>
           return<a name='1339'>
        endif<a name='1340'>
<a name='1341'>
        if(FieldType == WRF_DOUBLE) then<a name='1342'>
           di = 2<a name='1343'>
        else <a name='1344'>
           di = 1<a name='1345'>
        endif<a name='1346'>
<a name='1347'>
        <font color=#447700>! <a name='1348'></font>
        <font color=#447700>! Here, we do any necessary conversions to the data.<a name='1349'></font>
        <font color=#447700>!<a name='1350'></font>
        <font color=#447700>! The WRF executable (wrf.exe) expects perturbation potential<a name='1351'></font>
        <font color=#447700>!   temperature.  However, real.exe expects full potential T.<a name='1352'></font>
        <font color=#447700>! So, if the program is WRF, subtract 300 from Potential Temperature <a name='1353'></font>
        <font color=#447700>!   to get perturbation potential temperature.<a name='1354'></font>
        <font color=#447700>!<a name='1355'></font>
        if (VarName == 'T') then<a name='1356'>
           if ( &amp;<a name='1357'>
                (InputProgramName .eq. 'REAL_EM') .or. &amp;<a name='1358'>
                (InputProgramName .eq. 'IDEAL') .or. &amp;<a name='1359'>
                (InputProgramName .eq. 'NDOWN_EM')) then<a name='1360'>
              gfld%fld = gfld%fld - 300<a name='1361'>
           endif<a name='1362'>
        endif<a name='1363'>
<a name='1364'>
<a name='1365'>
        if (ndims .eq. 1) then<a name='1366'>
           CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#TRANSPOSE1D_GRIB'>Transpose1D_grib</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRANSPOSE1D_GRIB_1">(MemoryOrder, di, FieldType, Field, &amp;<a name='1367'>
                MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), &amp;<a name='1368'>
                MemoryStart(3), MemoryEnd(3), &amp;<a name='1369'>
                gfld%fld, zsize)<a name='1370'>
        else<a name='1371'>
           CALL <A href='../../html_code/io_grib_share/io_grib_share.F.html#TRANSPOSE_GRIB'>Transpose_grib</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TRANSPOSE_GRIB_2">(MemoryOrder, di, FieldType, Field, &amp;<a name='1372'>
                MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), &amp;<a name='1373'>
                MemoryStart(3), MemoryEnd(3), &amp;<a name='1374'>
                gfld%fld, dim3, ysize,xsize)<a name='1375'>
        endif<a name='1376'>
<a name='1377'>
        call gf_free(gfld)<a name='1378'>
        <a name='1379'>
     enddo VERTDIM<a name='1380'>
  endif<a name='1381'>
<a name='1382'>
  Status = WRF_NO_ERR<a name='1383'>
<a name='1384'>
<a name='1385'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1246"> ( DEBUG , 'Leaving ext_gr2_read_field')<a name='1386'>
<a name='1387'>
  RETURN<a name='1388'>
END SUBROUTINE ext_gr2_read_field<a name='1389'>
<a name='1390'>
<font color=#447700>!*****************************************************************************<a name='1391'></font>
<a name='1392'>
<A NAME='EXT_GR2_GET_NEXT_VAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_VAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1393'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_next_var</font> ( DataHandle, VarName, Status ) <A href='../../call_to/EXT_GR2_GET_NEXT_VAR.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_GET_NEXT_VAR.html' TARGET='index'>2</A><a name='1394'>
<a name='1395'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_13"><a name='1396'>
  IMPLICIT NONE<a name='1397'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_23"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1398'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1399'>
  CHARACTER*(*) :: VarName<a name='1400'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1401'>
<a name='1402'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1247"> ( DEBUG , 'Entering ext_gr2_get_next_var')<a name='1403'>
<a name='1404'>
  Status = WRF_WARN_NOOP<a name='1405'>
<a name='1406'>
  RETURN<a name='1407'>
END SUBROUTINE ext_gr2_get_next_var<a name='1408'>
<a name='1409'>
<font color=#447700>!*****************************************************************************<a name='1410'></font>
<a name='1411'>
<A NAME='EXT_GR2_END_OF_FRAME'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_END_OF_FRAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1412'>
<font color=#993300>subroutine </font><font color=#cc0000>ext_gr2_end_of_frame</font>(DataHandle, Status),<A href='../../call_from/EXT_GR2_END_OF_FRAME.html' TARGET='index'>2</A><a name='1413'>
<a name='1414'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_END_OF_FRAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_14"><a name='1415'>
  implicit none<a name='1416'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_24"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_END_OF_FRAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1417'>
  integer               ,intent(in)     :: DataHandle<a name='1418'>
  integer               ,intent(out)    :: Status<a name='1419'>
<a name='1420'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_END_OF_FRAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1248"> ( DEBUG , 'Entering ext_gr2_end_of_frame')<a name='1421'>
<a name='1422'>
  Status = WRF_WARN_NOOP<a name='1423'>
<a name='1424'>
  return<a name='1425'>
end subroutine ext_gr2_end_of_frame<a name='1426'>
<a name='1427'>
<font color=#447700>!*****************************************************************************<a name='1428'></font>
<a name='1429'>
<A NAME='EXT_GR2_IOSYNC'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOSYNC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1430'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_iosync</font> ( DataHandle, Status ) <A href='../../call_to/EXT_GR2_IOSYNC.html' TARGET='index'>3</A>,<A href='../../call_from/EXT_GR2_IOSYNC.html' TARGET='index'>2</A><a name='1431'>
<a name='1432'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_15">  <a name='1433'>
  IMPLICIT NONE<a name='1434'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_25"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1435'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1436'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1437'>
  integer                     :: ierror<a name='1438'>
<a name='1439'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1249"> ( DEBUG , 'Entering ext_gr2_iosync')<a name='1440'>
<a name='1441'>
  Status = WRF_NO_ERR<a name='1442'>
  if (DataHandle .GT. 0) then<a name='1443'>
     CALL flush_file(fileinfo(DataHandle)%FileFd)<a name='1444'>
  else<a name='1445'>
     Status = WRF_WARN_TOO_MANY_FILES<a name='1446'>
  endif<a name='1447'>
<a name='1448'>
  RETURN<a name='1449'>
END SUBROUTINE ext_gr2_iosync<a name='1450'>
<a name='1451'>
<font color=#447700>!*****************************************************************************<a name='1452'></font>
<a name='1453'>
<A NAME='EXT_GR2_INQUIRE_FILENAME'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1454'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_inquire_filename</font> ( DataHandle, FileName , FileStat, &amp; <A href='../../call_to/EXT_GR2_INQUIRE_FILENAME.html' TARGET='index'>9</A>,<A href='../../call_from/EXT_GR2_INQUIRE_FILENAME.html' TARGET='index'>2</A><a name='1455'>
     Status )<a name='1456'>
<a name='1457'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_16"><a name='1458'>
  IMPLICIT NONE<a name='1459'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_26"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1460'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_27"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1461'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1462'>
  CHARACTER*(*) :: FileName<a name='1463'>
  INTEGER ,       INTENT(OUT) :: FileStat<a name='1464'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1465'>
  CHARACTER *80   SysDepInfo<a name='1466'>
<a name='1467'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1250"> ( DEBUG , 'Entering ext_gr2_inquire_filename')<a name='1468'>
<a name='1469'>
  FileName = fileinfo(DataHandle)%DataFile <a name='1470'>
<a name='1471'>
  if ((DataHandle .ge. firstFileHandle) .and. &amp;<a name='1472'>
       (DataHandle .le. maxFileHandles)) then<a name='1473'>
     FileStat = fileinfo(DataHandle)%FileStatus<a name='1474'>
  else<a name='1475'>
     FileStat = WRF_FILE_NOT_OPENED<a name='1476'>
  endif<a name='1477'>
  Status = WRF_NO_ERR<a name='1478'>
<a name='1479'>
  RETURN<a name='1480'>
END SUBROUTINE ext_gr2_inquire_filename<a name='1481'>
<a name='1482'>
<font color=#447700>!*****************************************************************************<a name='1483'></font>
<a name='1484'>
<A NAME='EXT_GR2_GET_VAR_INFO'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1485'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_info</font> ( DataHandle , VarName , NDim , &amp; <A href='../../call_to/EXT_GR2_GET_VAR_INFO.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_GET_VAR_INFO.html' TARGET='index'>3</A><a name='1486'>
     MemoryOrder , Stagger , DomainStart , DomainEnd , WrfType, Status )<a name='1487'>
<a name='1488'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_17"><a name='1489'>
  IMPLICIT NONE<a name='1490'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_28"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1491'>
  integer               ,intent(in)     :: DataHandle<a name='1492'>
  character*(*)         ,intent(in)     :: VarName<a name='1493'>
  integer               ,intent(out)    :: NDim<a name='1494'>
  character*(*)         ,intent(out)    :: MemoryOrder<a name='1495'>
  character*(*)         ,intent(out)    :: Stagger<a name='1496'>
  integer ,dimension(*) ,intent(out)    :: DomainStart, DomainEnd<a name='1497'>
  integer               ,intent(out)    :: WrfType<a name='1498'>
  integer               ,intent(out)    :: Status<a name='1499'>
<a name='1500'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1251"> ( DEBUG , 'Entering ext_gr2_get_var_info')<a name='1501'>
<a name='1502'>
  MemoryOrder = ""<a name='1503'>
  Stagger = ""<a name='1504'>
  DomainStart(1) = 0<a name='1505'>
  DomainEnd(1) = 0<a name='1506'>
  WrfType = 0<a name='1507'>
  NDim = 0<a name='1508'>
<a name='1509'>
  CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1521">('ext_gr2_get_var_info not supported for grib version2 data')<a name='1510'>
  Status = WRF_NO_ERR<a name='1511'>
<a name='1512'>
  RETURN<a name='1513'>
END SUBROUTINE ext_gr2_get_var_info<a name='1514'>
<a name='1515'>
<font color=#447700>!*****************************************************************************<a name='1516'></font>
<a name='1517'>
<A NAME='EXT_GR2_SET_TIME'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_SET_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1518'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_set_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/EXT_GR2_SET_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_SET_TIME.html' TARGET='index'>2</A><a name='1519'>
<a name='1520'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_18"><a name='1521'>
  IMPLICIT NONE<a name='1522'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_29"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1523'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1524'>
  CHARACTER*(*) :: DateStr<a name='1525'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1526'>
  integer       :: found_time<a name='1527'>
  integer       :: idx<a name='1528'>
<a name='1529'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1252"> ( DEBUG , 'Entering ext_gr2_set_time')<a name='1530'>
<a name='1531'>
  found_time = 0<a name='1532'>
  do idx = 1,fileinfo(DataHandle)%NumberTimes<a name='1533'>
     if (fileinfo(DataHandle)%Times(idx) == DateStr) then<a name='1534'>
        found_time = 1<a name='1535'>
        fileinfo(DataHandle)%CurrentTime = idx<a name='1536'>
     endif<a name='1537'>
  enddo<a name='1538'>
  if (found_time == 0) then <a name='1539'>
     Status = WRF_WARN_TIME_NF<a name='1540'>
  else<a name='1541'>
     Status = WRF_NO_ERR<a name='1542'>
  endif<a name='1543'>
<a name='1544'>
  RETURN<a name='1545'>
END SUBROUTINE ext_gr2_set_time<a name='1546'>
<a name='1547'>
<font color=#447700>!*****************************************************************************<a name='1548'></font>
<a name='1549'>
<A NAME='EXT_GR2_GET_NEXT_TIME'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1550'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_next_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/EXT_GR2_GET_NEXT_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_GET_NEXT_TIME.html' TARGET='index'>3</A><a name='1551'>
<a name='1552'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_19"><a name='1553'>
  IMPLICIT NONE<a name='1554'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_30"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1555'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1556'>
  CHARACTER*(*) , INTENT(OUT) :: DateStr<a name='1557'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1558'>
<a name='1559'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1253"> ( DEBUG , 'Entering ext_gr2_get_next_time')<a name='1560'>
<a name='1561'>
  if (fileinfo(DataHandle)%CurrentTime == fileinfo(DataHandle)%NumberTimes) then<a name='1562'>
     Status = WRF_WARN_TIME_EOF<a name='1563'>
  else<a name='1564'>
     fileinfo(DataHandle)%CurrentTime = fileinfo(DataHandle)%CurrentTime + 1<a name='1565'>
     DateStr = fileinfo(DataHandle)%Times(fileinfo(DataHandle)%CurrentTime)<a name='1566'>
     Status = WRF_NO_ERR<a name='1567'>
  endif<a name='1568'>
<a name='1569'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1254"> ( DEBUG , 'Leaving ext_gr2_get_next_time, got time '//DateStr)<a name='1570'>
<a name='1571'>
  RETURN<a name='1572'>
END SUBROUTINE ext_gr2_get_next_time<a name='1573'>
<a name='1574'>
<font color=#447700>!*****************************************************************************<a name='1575'></font>
<a name='1576'>
<A NAME='EXT_GR2_GET_PREVIOUS_TIME'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_PREVIOUS_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1577'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_previous_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/EXT_GR2_GET_PREVIOUS_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/EXT_GR2_GET_PREVIOUS_TIME.html' TARGET='index'>2</A><a name='1578'>
<a name='1579'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_20"><a name='1580'>
  IMPLICIT NONE<a name='1581'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_31"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1582'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1583'>
  CHARACTER*(*) :: DateStr<a name='1584'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1585'>
<a name='1586'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1255"> ( DEBUG , 'Entering ext_gr2_get_previous_time')<a name='1587'>
<a name='1588'>
  if (fileinfo(DataHandle)%CurrentTime &lt;= 0) then<a name='1589'>
     Status = WRF_WARN_TIME_EOF<a name='1590'>
  else<a name='1591'>
     fileinfo(DataHandle)%CurrentTime = fileinfo(DataHandle)%CurrentTime - 1<a name='1592'>
     DateStr = fileinfo(DataHandle)%Times(fileinfo(DataHandle)%CurrentTime)<a name='1593'>
     Status = WRF_NO_ERR<a name='1594'>
  endif<a name='1595'>
<a name='1596'>
  RETURN<a name='1597'>
END SUBROUTINE ext_gr2_get_previous_time<a name='1598'>
<a name='1599'>
<font color=#447700>!******************************************************************************<a name='1600'></font>
<font color=#447700>!* Start of get_var_ti_* routines<a name='1601'></font>
<font color=#447700>!******************************************************************************<a name='1602'></font>
<a name='1603'>
<A NAME='EXT_GR2_GET_VAR_TI_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1604'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_real</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_REAL.html' TARGET='index'>5</A><a name='1605'>
     Count, Outcount, Status )<a name='1606'>
<a name='1607'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_21"><a name='1608'>
  IMPLICIT NONE<a name='1609'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_32"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1610'>
  INTEGER ,       INTENT(IN)    :: DataHandle<a name='1611'>
  CHARACTER*(*) :: Element<a name='1612'>
  CHARACTER*(*) :: VarName <a name='1613'>
  real ,          INTENT(OUT)   :: Data(*)<a name='1614'>
  INTEGER ,       INTENT(IN)    :: Count<a name='1615'>
  INTEGER ,       INTENT(OUT)   :: OutCount<a name='1616'>
  INTEGER ,       INTENT(OUT)   :: Status<a name='1617'>
  INTEGER          :: idx<a name='1618'>
  INTEGER          :: stat<a name='1619'>
  CHARACTER(len=100)  :: Value<a name='1620'>
<a name='1621'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1256"> ( DEBUG , 'Entering ext_gr2_get_var_ti_real')<a name='1622'>
<a name='1623'>
  Status = WRF_NO_ERR<a name='1624'>
  <a name='1625'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_4">(global_input(DataHandle), &amp;<a name='1626'>
       trim(VarName)//';'//trim(Element), Value, stat)<a name='1627'>
  if (stat /= 0) then<a name='1628'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1257"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1629'>
     Status = WRF_WARN_VAR_NF<a name='1630'>
     RETURN<a name='1631'>
  endif<a name='1632'>
<a name='1633'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='1634'>
  if (stat .ne. 0) then<a name='1635'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1522">("Reading data from"//Value//"failed")<a name='1636'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='1637'>
     RETURN<a name='1638'>
  endif<a name='1639'>
  Outcount = idx<a name='1640'>
 <a name='1641'>
  RETURN<a name='1642'>
END SUBROUTINE ext_gr2_get_var_ti_real <a name='1643'>
<a name='1644'>
<font color=#447700>!*****************************************************************************<a name='1645'></font>
<a name='1646'>
<A NAME='EXT_GR2_GET_VAR_TI_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1647'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_real8</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_REAL8.html' TARGET='index'>5</A><a name='1648'>
     Count, Outcount, Status )<a name='1649'>
<a name='1650'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_22"><a name='1651'>
  IMPLICIT NONE<a name='1652'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_33"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1653'>
  INTEGER ,       INTENT(IN)      :: DataHandle<a name='1654'>
  CHARACTER*(*) :: Element<a name='1655'>
  CHARACTER*(*) :: VarName <a name='1656'>
  real*8 ,        INTENT(OUT)     :: Data(*)<a name='1657'>
  INTEGER ,       INTENT(IN)      :: Count<a name='1658'>
  INTEGER ,       INTENT(OUT)     :: OutCount<a name='1659'>
  INTEGER ,       INTENT(OUT)     :: Status<a name='1660'>
  INTEGER          :: idx<a name='1661'>
  INTEGER          :: stat<a name='1662'>
  CHARACTER*(100)  :: VALUE<a name='1663'>
<a name='1664'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1258"> ( DEBUG , 'Entering ext_gr2_get_var_ti_real8')<a name='1665'>
<a name='1666'>
  Status = WRF_NO_ERR<a name='1667'>
  <a name='1668'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_5">(global_input(DataHandle), &amp;<a name='1669'>
       trim(VarName)//';'//trim(Element), Value, stat)<a name='1670'>
  if (stat /= 0) then<a name='1671'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1259"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1672'>
     Status = WRF_WARN_VAR_NF<a name='1673'>
     RETURN<a name='1674'>
  endif<a name='1675'>
<a name='1676'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='1677'>
  if (stat .ne. 0) then<a name='1678'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1523">("Reading data from"//Value//"failed")<a name='1679'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='1680'>
     RETURN<a name='1681'>
  endif<a name='1682'>
  Outcount = idx<a name='1683'>
 <a name='1684'>
  RETURN<a name='1685'>
END SUBROUTINE ext_gr2_get_var_ti_real8 <a name='1686'>
<a name='1687'>
<font color=#447700>!*****************************************************************************<a name='1688'></font>
<a name='1689'>
<A NAME='EXT_GR2_GET_VAR_TI_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1690'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_double</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_DOUBLE.html' TARGET='index'>5</A><a name='1691'>
     Count, Outcount, Status )<a name='1692'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_23"><a name='1693'>
  IMPLICIT NONE<a name='1694'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_34"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1695'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1696'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1697'>
  CHARACTER*(*) , INTENT(IN)  :: VarName<a name='1698'>
  real*8 ,            INTENT(OUT) :: Data(*)<a name='1699'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1700'>
  INTEGER ,       INTENT(OUT)  :: OutCount<a name='1701'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1702'>
  INTEGER          :: idx<a name='1703'>
  INTEGER          :: stat<a name='1704'>
  CHARACTER*(100)  :: VALUE<a name='1705'>
<a name='1706'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1260"> ( DEBUG , 'Entering ext_gr2_get_var_ti_double')<a name='1707'>
<a name='1708'>
  Status = WRF_NO_ERR<a name='1709'>
  <a name='1710'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_6">(global_input(DataHandle), &amp;<a name='1711'>
       trim(VarName)//';'//trim(Element), Value, stat)<a name='1712'>
  if (stat /= 0) then<a name='1713'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1261"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1714'>
     Status = WRF_WARN_VAR_NF<a name='1715'>
     RETURN<a name='1716'>
  endif<a name='1717'>
<a name='1718'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='1719'>
  if (stat .ne. 0) then<a name='1720'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1524">("Reading data from"//Value//"failed")<a name='1721'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='1722'>
     RETURN<a name='1723'>
  endif<a name='1724'>
  Outcount = idx<a name='1725'>
<a name='1726'>
  RETURN<a name='1727'>
END SUBROUTINE ext_gr2_get_var_ti_double<a name='1728'>
<a name='1729'>
<font color=#447700>!*****************************************************************************<a name='1730'></font>
<a name='1731'>
<A NAME='EXT_GR2_GET_VAR_TI_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1732'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_integer</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_INTEGER.html' TARGET='index'>5</A><a name='1733'>
     Count, Outcount, Status )<a name='1734'>
<a name='1735'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_24"><a name='1736'>
  IMPLICIT NONE<a name='1737'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_35"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1738'>
  INTEGER ,       INTENT(IN)       :: DataHandle<a name='1739'>
  CHARACTER*(*) :: Element<a name='1740'>
  CHARACTER*(*) :: VarName <a name='1741'>
  integer ,       INTENT(OUT)      :: Data(*)<a name='1742'>
  INTEGER ,       INTENT(IN)       :: Count<a name='1743'>
  INTEGER ,       INTENT(OUT)      :: OutCount<a name='1744'>
  INTEGER ,       INTENT(OUT)      :: Status<a name='1745'>
  INTEGER          :: idx<a name='1746'>
  INTEGER          :: stat<a name='1747'>
  CHARACTER*(1000) :: VALUE<a name='1748'>
<a name='1749'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1262"> ( DEBUG , 'Entering ext_gr2_get_var_ti_integer')<a name='1750'>
<a name='1751'>
  Status = WRF_NO_ERR<a name='1752'>
  <a name='1753'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_7">(global_input(DataHandle), &amp;<a name='1754'>
       trim(VarName)//';'//trim(Element), Value, stat)<a name='1755'>
  if (stat /= 0) then<a name='1756'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1263"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1757'>
     Status = WRF_WARN_VAR_NF<a name='1758'>
     RETURN<a name='1759'>
  endif<a name='1760'>
<a name='1761'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='1762'>
  if (stat .ne. 0) then<a name='1763'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1525">("Reading data from"//Value//"failed")<a name='1764'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='1765'>
     RETURN<a name='1766'>
  endif<a name='1767'>
  Outcount = idx<a name='1768'>
<a name='1769'>
  RETURN<a name='1770'>
END SUBROUTINE ext_gr2_get_var_ti_integer <a name='1771'>
<a name='1772'>
<font color=#447700>!*****************************************************************************<a name='1773'></font>
<a name='1774'>
<A NAME='EXT_GR2_GET_VAR_TI_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1775'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_logical</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_LOGICAL.html' TARGET='index'>5</A><a name='1776'>
     Count, Outcount, Status )<a name='1777'>
<a name='1778'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_25"><a name='1779'>
  IMPLICIT NONE<a name='1780'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_36"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1781'>
  INTEGER ,       INTENT(IN)       :: DataHandle<a name='1782'>
  CHARACTER*(*) :: Element<a name='1783'>
  CHARACTER*(*) :: VarName <a name='1784'>
  logical ,       INTENT(OUT)      :: Data(*)<a name='1785'>
  INTEGER ,       INTENT(IN)       :: Count<a name='1786'>
  INTEGER ,       INTENT(OUT)      :: OutCount<a name='1787'>
  INTEGER ,       INTENT(OUT)      :: Status<a name='1788'>
  INTEGER          :: idx<a name='1789'>
  INTEGER          :: stat<a name='1790'>
  CHARACTER*(100) :: VALUE<a name='1791'>
<a name='1792'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1264"> ( DEBUG , 'Entering ext_gr2_get_var_ti_logical')<a name='1793'>
<a name='1794'>
  Status = WRF_NO_ERR<a name='1795'>
  <a name='1796'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_8">(global_input(DataHandle), &amp;<a name='1797'>
       trim(VarName)//';'//trim(Element), Value, stat)<a name='1798'>
  if (stat /= 0) then<a name='1799'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1265"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1800'>
     Status = WRF_WARN_VAR_NF<a name='1801'>
     RETURN<a name='1802'>
  endif<a name='1803'>
<a name='1804'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='1805'>
  if (stat .ne. 0) then<a name='1806'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1526">("Reading data from"//Value//"failed")<a name='1807'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='1808'>
     RETURN<a name='1809'>
  endif<a name='1810'>
  Outcount = idx<a name='1811'>
<a name='1812'>
  RETURN<a name='1813'>
END SUBROUTINE ext_gr2_get_var_ti_logical <a name='1814'>
<a name='1815'>
<font color=#447700>!*****************************************************************************<a name='1816'></font>
<a name='1817'>
<A NAME='EXT_GR2_GET_VAR_TI_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1818'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_ti_char</font> ( DataHandle,Element,  Varname, Data,  &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TI_CHAR.html' TARGET='index'>4</A><a name='1819'>
     Status )<a name='1820'>
<a name='1821'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_26"><a name='1822'>
  IMPLICIT NONE<a name='1823'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_37"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1824'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1825'>
  CHARACTER*(*) :: Element<a name='1826'>
  CHARACTER*(*) :: VarName <a name='1827'>
  CHARACTER*(*) :: Data<a name='1828'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1829'>
  INTEGER       :: stat<a name='1830'>
<a name='1831'>
  Status = WRF_NO_ERR<a name='1832'>
  <a name='1833'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1266"> ( DEBUG , 'Entering ext_gr2_get_var_ti_char')<a name='1834'>
<a name='1835'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_9">(global_input(DataHandle), &amp;<a name='1836'>
       trim(VarName)//';'//trim(Element), Data, stat)<a name='1837'>
  if (stat /= 0) then<a name='1838'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1267"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(Element))<a name='1839'>
     Status = WRF_WARN_VAR_NF<a name='1840'>
     RETURN<a name='1841'>
  endif<a name='1842'>
<a name='1843'>
  RETURN<a name='1844'>
END SUBROUTINE ext_gr2_get_var_ti_char <a name='1845'>
<a name='1846'>
<font color=#447700>!******************************************************************************<a name='1847'></font>
<font color=#447700>!* End of get_var_ti_* routines<a name='1848'></font>
<font color=#447700>!******************************************************************************<a name='1849'></font>
<a name='1850'>
<a name='1851'>
<font color=#447700>!******************************************************************************<a name='1852'></font>
<font color=#447700>!* Start of put_var_ti_* routines<a name='1853'></font>
<font color=#447700>!******************************************************************************<a name='1854'></font>
<a name='1855'>
<A NAME='EXT_GR2_PUT_VAR_TI_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1856'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_real</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_REAL.html' TARGET='index'>3</A><a name='1857'>
     Count,  Status )<a name='1858'>
<a name='1859'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_27"><a name='1860'>
  IMPLICIT NONE<a name='1861'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_38"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1862'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1863'>
  CHARACTER*(*) :: Element<a name='1864'>
  CHARACTER*(*) :: VarName <a name='1865'>
  real ,          INTENT(IN)  :: Data(*)<a name='1866'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1867'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1868'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='1869'>
  INTEGER             :: idx<a name='1870'>
<a name='1871'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1268"> ( DEBUG , 'Entering ext_gr2_put_var_ti_real')<a name='1872'>
<a name='1873'>
  if (fileinfo(DataHandle)%committed) then<a name='1874'>
<a name='1875'>
     do idx = 1,Count<a name='1876'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='1877'>
     enddo<a name='1878'>
<a name='1879'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_2"> (ti_output(DataHandle), &amp;<a name='1880'>
          trim(VarName)//';'//trim(Element), tmpstr, Count, Status)<a name='1881'>
<a name='1882'>
  endif<a name='1883'>
<a name='1884'>
  RETURN<a name='1885'>
END SUBROUTINE ext_gr2_put_var_ti_real <a name='1886'>
<a name='1887'>
<font color=#447700>!*****************************************************************************<a name='1888'></font>
<a name='1889'>
<A NAME='EXT_GR2_PUT_VAR_TI_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1890'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_double</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_DOUBLE.html' TARGET='index'>3</A><a name='1891'>
     Count,  Status )<a name='1892'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_28"><a name='1893'>
  IMPLICIT NONE<a name='1894'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_39"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1895'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1896'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='1897'>
  CHARACTER*(*) , INTENT(IN)  :: VarName<a name='1898'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='1899'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1900'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1901'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='1902'>
  INTEGER             :: idx<a name='1903'>
<a name='1904'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1269"> ( DEBUG , 'Entering ext_gr2_put_var_ti_double')<a name='1905'>
<a name='1906'>
  if (fileinfo(DataHandle)%committed) then<a name='1907'>
<a name='1908'>
     do idx = 1,Count<a name='1909'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='1910'>
     enddo<a name='1911'>
     <a name='1912'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_3"> (ti_output(DataHandle), &amp;<a name='1913'>
          trim(VarName)//';'//trim(Element), tmpstr, Count, Status)<a name='1914'>
  endif<a name='1915'>
<a name='1916'>
  RETURN<a name='1917'>
END SUBROUTINE ext_gr2_put_var_ti_double<a name='1918'>
<a name='1919'>
<font color=#447700>!*****************************************************************************<a name='1920'></font>
<a name='1921'>
<A NAME='EXT_GR2_PUT_VAR_TI_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1922'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_real8</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_REAL8.html' TARGET='index'>3</A><a name='1923'>
     Count,  Status )<a name='1924'>
<a name='1925'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_29"><a name='1926'>
  IMPLICIT NONE<a name='1927'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_40"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1928'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1929'>
  CHARACTER*(*) :: Element<a name='1930'>
  CHARACTER*(*) :: VarName <a name='1931'>
  real*8 ,        INTENT(IN)  :: Data(*)<a name='1932'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1933'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1934'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='1935'>
  INTEGER             :: idx<a name='1936'>
<a name='1937'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1270"> ( DEBUG , 'Entering ext_gr2_put_var_ti_real8')<a name='1938'>
<a name='1939'>
  if (fileinfo(DataHandle)%committed) then<a name='1940'>
<a name='1941'>
     do idx = 1,Count<a name='1942'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='1943'>
     enddo<a name='1944'>
     <a name='1945'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_4"> (ti_output(DataHandle), &amp;<a name='1946'>
          trim(VarName)//';'//trim(Element), tmpstr, Count, Status)<a name='1947'>
  endif<a name='1948'>
<a name='1949'>
  RETURN<a name='1950'>
END SUBROUTINE ext_gr2_put_var_ti_real8 <a name='1951'>
<a name='1952'>
<font color=#447700>!*****************************************************************************<a name='1953'></font>
<a name='1954'>
<A NAME='EXT_GR2_PUT_VAR_TI_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1955'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_integer</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_INTEGER.html' TARGET='index'>3</A><a name='1956'>
     Count,  Status )<a name='1957'>
<a name='1958'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_30"><a name='1959'>
  IMPLICIT NONE<a name='1960'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_41"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1961'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1962'>
  CHARACTER*(*) :: Element<a name='1963'>
  CHARACTER*(*) :: VarName <a name='1964'>
  integer ,       INTENT(IN)  :: Data(*)<a name='1965'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1966'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1967'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='1968'>
  INTEGER             :: idx<a name='1969'>
<a name='1970'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1271"> ( DEBUG , 'Entering ext_gr2_put_var_ti_integer')<a name='1971'>
<a name='1972'>
  if (fileinfo(DataHandle)%committed) then<a name='1973'>
<a name='1974'>
     do idx = 1,Count<a name='1975'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='1976'>
     enddo<a name='1977'>
     <a name='1978'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_5"> (ti_output(DataHandle), &amp;<a name='1979'>
          trim(VarName)//';'//trim(Element), tmpstr, Count, Status)<a name='1980'>
  endif<a name='1981'>
<a name='1982'>
  RETURN<a name='1983'>
END SUBROUTINE ext_gr2_put_var_ti_integer <a name='1984'>
<a name='1985'>
<font color=#447700>!*****************************************************************************<a name='1986'></font>
<a name='1987'>
<A NAME='EXT_GR2_PUT_VAR_TI_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1988'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_logical</font> ( DataHandle,Element,  Varname, Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_LOGICAL.html' TARGET='index'>3</A><a name='1989'>
     Count,  Status )<a name='1990'>
<a name='1991'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_31"><a name='1992'>
  IMPLICIT NONE<a name='1993'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_42"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1994'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1995'>
  CHARACTER*(*) :: Element<a name='1996'>
  CHARACTER*(*) :: VarName <a name='1997'>
  logical ,       INTENT(IN)  :: Data(*)<a name='1998'>
  INTEGER ,       INTENT(IN)  :: Count<a name='1999'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2000'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2001'>
  INTEGER             :: idx<a name='2002'>
<a name='2003'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1272"> ( DEBUG , 'Entering ext_gr2_put_var_ti_logical')<a name='2004'>
<a name='2005'>
  if (fileinfo(DataHandle)%committed) then<a name='2006'>
<a name='2007'>
     do idx = 1,Count<a name='2008'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2009'>
     enddo<a name='2010'>
     <a name='2011'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_6"> (ti_output(DataHandle), &amp;<a name='2012'>
          trim(Varname)//';'//trim(Element), tmpstr, Count, Status)<a name='2013'>
<a name='2014'>
  endif<a name='2015'>
<a name='2016'>
RETURN<a name='2017'>
END SUBROUTINE ext_gr2_put_var_ti_logical <a name='2018'>
<a name='2019'>
<font color=#447700>!*****************************************************************************<a name='2020'></font>
<a name='2021'>
<A NAME='EXT_GR2_PUT_VAR_TI_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2022'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_ti_char</font> ( DataHandle,Element,  Varname, Data,  &amp; <A href='../../call_to/EXT_GR2_PUT_VAR_TI_CHAR.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_VAR_TI_CHAR.html' TARGET='index'>3</A><a name='2023'>
     Status )<a name='2024'>
<a name='2025'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_32"><a name='2026'>
  IMPLICIT NONE<a name='2027'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_43"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2028'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2029'>
  CHARACTER(len=*) :: Element<a name='2030'>
  CHARACTER(len=*) :: VarName <a name='2031'>
  CHARACTER(len=*) :: Data<a name='2032'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2033'>
  REAL dummy<a name='2034'>
  INTEGER                     :: Count<a name='2035'>
  CHARACTER(len=1000) :: tmpstr(1)<a name='2036'>
  INTEGER             :: idx<a name='2037'>
<a name='2038'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1273"> ( DEBUG , 'Entering ext_gr2_put_var_ti_char')<a name='2039'>
<a name='2040'>
  if (fileinfo(DataHandle)%committed) then<a name='2041'>
<a name='2042'>
     write(tmpstr(1),*)trim(Data)<a name='2043'>
<a name='2044'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_7"> (ti_output(DataHandle), &amp;<a name='2045'>
          trim(VarName)//';'//trim(Element), tmpstr, 1, Status)<a name='2046'>
<a name='2047'>
  endif<a name='2048'>
<a name='2049'>
  RETURN<a name='2050'>
END SUBROUTINE ext_gr2_put_var_ti_char <a name='2051'>
<a name='2052'>
<font color=#447700>!******************************************************************************<a name='2053'></font>
<font color=#447700>!* End of put_var_ti_* routines<a name='2054'></font>
<font color=#447700>!******************************************************************************<a name='2055'></font>
<a name='2056'>
<font color=#447700>!******************************************************************************<a name='2057'></font>
<font color=#447700>!* Start of get_var_td_* routines<a name='2058'></font>
<font color=#447700>!******************************************************************************<a name='2059'></font>
<a name='2060'>
<A NAME='EXT_GR2_GET_VAR_TD_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2061'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_double</font> ( DataHandle,Element,  DateStr, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_DOUBLE.html' TARGET='index'>5</A><a name='2062'>
     Varname, Data, Count, Outcount, Status )<a name='2063'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_33"><a name='2064'>
  IMPLICIT NONE<a name='2065'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_44"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2066'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2067'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2068'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2069'>
  CHARACTER*(*) , INTENT(IN)  :: VarName<a name='2070'>
  real*8 ,            INTENT(OUT) :: Data(*)<a name='2071'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2072'>
  INTEGER ,       INTENT(OUT)  :: OutCount<a name='2073'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2074'>
  INTEGER          :: idx<a name='2075'>
  INTEGER          :: stat<a name='2076'>
  CHARACTER*(1000) :: VALUE<a name='2077'>
<a name='2078'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1274"> ( DEBUG , 'Entering ext_gr2_get_var_td_double')<a name='2079'>
<a name='2080'>
  Status = WRF_NO_ERR<a name='2081'>
  <a name='2082'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_10">(global_input(DataHandle), &amp;<a name='2083'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Value, stat)<a name='2084'>
  if (stat /= 0) then<a name='2085'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1275"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2086'>
     Status = WRF_WARN_VAR_NF<a name='2087'>
     RETURN<a name='2088'>
  endif<a name='2089'>
<a name='2090'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2091'>
  if (stat .ne. 0) then<a name='2092'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1527">("Reading data from"//Value//"failed")<a name='2093'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2094'>
     RETURN<a name='2095'>
  endif<a name='2096'>
  Outcount = idx<a name='2097'>
<a name='2098'>
RETURN<a name='2099'>
END SUBROUTINE ext_gr2_get_var_td_double<a name='2100'>
<a name='2101'>
<font color=#447700>!*****************************************************************************<a name='2102'></font>
<a name='2103'>
<A NAME='EXT_GR2_GET_VAR_TD_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2104'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_real</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_REAL.html' TARGET='index'>5</A><a name='2105'>
     Data, Count, Outcount, Status )<a name='2106'>
<a name='2107'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_34"><a name='2108'>
  IMPLICIT NONE<a name='2109'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_45"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2110'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2111'>
  CHARACTER*(*) :: Element<a name='2112'>
  CHARACTER*(*) :: DateStr<a name='2113'>
  CHARACTER*(*) :: VarName <a name='2114'>
  real ,          INTENT(OUT) :: Data(*)<a name='2115'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2116'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2117'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2118'>
  INTEGER          :: idx<a name='2119'>
  INTEGER          :: stat<a name='2120'>
  CHARACTER*(1000) :: VALUE<a name='2121'>
<a name='2122'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1276"> ( DEBUG , 'Entering ext_gr2_get_var_td_real')<a name='2123'>
<a name='2124'>
  Status = WRF_NO_ERR<a name='2125'>
  <a name='2126'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_11">(global_input(DataHandle), &amp;<a name='2127'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Value, stat)<a name='2128'>
  if (stat /= 0) then<a name='2129'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1277"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2130'>
     Status = WRF_WARN_VAR_NF<a name='2131'>
     RETURN<a name='2132'>
  endif<a name='2133'>
<a name='2134'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2135'>
  if (stat .ne. 0) then<a name='2136'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1528">("Reading data from"//Value//"failed")<a name='2137'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2138'>
     RETURN<a name='2139'>
  endif<a name='2140'>
  Outcount = idx<a name='2141'>
<a name='2142'>
  RETURN<a name='2143'>
END SUBROUTINE ext_gr2_get_var_td_real <a name='2144'>
<a name='2145'>
<font color=#447700>!*****************************************************************************<a name='2146'></font>
<a name='2147'>
<A NAME='EXT_GR2_GET_VAR_TD_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2148'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_real8</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_REAL8.html' TARGET='index'>5</A><a name='2149'>
     Data, Count, Outcount, Status )<a name='2150'>
<a name='2151'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_35"><a name='2152'>
  IMPLICIT NONE<a name='2153'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_46"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2154'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2155'>
  CHARACTER*(*) :: Element<a name='2156'>
  CHARACTER*(*) :: DateStr<a name='2157'>
  CHARACTER*(*) :: VarName <a name='2158'>
  real*8 ,        INTENT(OUT) :: Data(*)<a name='2159'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2160'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2161'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2162'>
  INTEGER          :: idx<a name='2163'>
  INTEGER          :: stat<a name='2164'>
  CHARACTER*(1000) :: VALUE<a name='2165'>
<a name='2166'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1278"> ( DEBUG , 'Entering ext_gr2_get_var_td_real8')<a name='2167'>
<a name='2168'>
  Status = WRF_NO_ERR<a name='2169'>
  <a name='2170'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_12">(global_input(DataHandle), &amp;<a name='2171'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Value, stat)<a name='2172'>
  if (stat /= 0) then<a name='2173'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1279"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2174'>
     Status = WRF_WARN_VAR_NF<a name='2175'>
     RETURN<a name='2176'>
  endif<a name='2177'>
<a name='2178'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2179'>
  if (stat .ne. 0) then<a name='2180'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1529">("Reading data from"//Value//"failed")<a name='2181'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2182'>
     RETURN<a name='2183'>
  endif<a name='2184'>
  Outcount = idx<a name='2185'>
<a name='2186'>
  RETURN<a name='2187'>
END SUBROUTINE ext_gr2_get_var_td_real8 <a name='2188'>
<a name='2189'>
<font color=#447700>!*****************************************************************************<a name='2190'></font>
<a name='2191'>
<A NAME='EXT_GR2_GET_VAR_TD_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2192'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_integer</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_INTEGER.html' TARGET='index'>5</A><a name='2193'>
     Data, Count, Outcount, Status )<a name='2194'>
<a name='2195'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_36"><a name='2196'>
  IMPLICIT NONE<a name='2197'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_47"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2198'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2199'>
  CHARACTER*(*) :: Element<a name='2200'>
  CHARACTER*(*) :: DateStr<a name='2201'>
  CHARACTER*(*) :: VarName <a name='2202'>
  integer ,       INTENT(OUT) :: Data(*)<a name='2203'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2204'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2205'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2206'>
  INTEGER          :: idx<a name='2207'>
  INTEGER          :: stat<a name='2208'>
  CHARACTER*(1000) :: VALUE<a name='2209'>
<a name='2210'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1280"> ( DEBUG , 'Entering ext_gr2_get_var_td_integer')<a name='2211'>
<a name='2212'>
  Status = WRF_NO_ERR<a name='2213'>
  <a name='2214'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_13">(global_input(DataHandle), &amp;<a name='2215'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Value, stat)<a name='2216'>
  if (stat /= 0) then<a name='2217'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1281"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2218'>
     Status = WRF_WARN_VAR_NF<a name='2219'>
     RETURN<a name='2220'>
  endif<a name='2221'>
<a name='2222'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2223'>
  if (stat .ne. 0) then<a name='2224'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1530">("Reading data from"//Value//"failed")<a name='2225'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2226'>
     RETURN<a name='2227'>
  endif<a name='2228'>
  Outcount = idx<a name='2229'>
<a name='2230'>
  RETURN<a name='2231'>
END SUBROUTINE ext_gr2_get_var_td_integer <a name='2232'>
<a name='2233'>
<font color=#447700>!*****************************************************************************<a name='2234'></font>
<a name='2235'>
<A NAME='EXT_GR2_GET_VAR_TD_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2236'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_logical</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_LOGICAL.html' TARGET='index'>5</A><a name='2237'>
     Data, Count, Outcount, Status )<a name='2238'>
  <a name='2239'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_37"><a name='2240'>
  IMPLICIT NONE<a name='2241'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_48"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2242'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2243'>
  CHARACTER*(*) :: Element<a name='2244'>
  CHARACTER*(*) :: DateStr<a name='2245'>
  CHARACTER*(*) :: VarName <a name='2246'>
  logical ,       INTENT(OUT) :: Data(*)<a name='2247'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2248'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2249'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2250'>
  INTEGER          :: idx<a name='2251'>
  INTEGER          :: stat<a name='2252'>
  CHARACTER*(1000) :: VALUE<a name='2253'>
<a name='2254'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1282"> ( DEBUG , 'Entering ext_gr2_get_var_td_logical')<a name='2255'>
<a name='2256'>
  Status = WRF_NO_ERR<a name='2257'>
  <a name='2258'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_14">(global_input(DataHandle), &amp;<a name='2259'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Value, stat)<a name='2260'>
  if (stat /= 0) then<a name='2261'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1283"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2262'>
     Status = WRF_WARN_VAR_NF<a name='2263'>
     RETURN<a name='2264'>
  endif<a name='2265'>
<a name='2266'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2267'>
  if (stat .ne. 0) then<a name='2268'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1531">("Reading data from"//Value//"failed")<a name='2269'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2270'>
     RETURN<a name='2271'>
  endif<a name='2272'>
  Outcount = idx<a name='2273'>
<a name='2274'>
  RETURN<a name='2275'>
END SUBROUTINE ext_gr2_get_var_td_logical <a name='2276'>
<a name='2277'>
<font color=#447700>!*****************************************************************************<a name='2278'></font>
<a name='2279'>
<A NAME='EXT_GR2_GET_VAR_TD_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2280'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_var_td_char</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_GET_VAR_TD_CHAR.html' TARGET='index'>4</A><a name='2281'>
     Data,  Status )<a name='2282'>
<a name='2283'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_38"><a name='2284'>
  IMPLICIT NONE<a name='2285'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_49"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2286'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2287'>
  CHARACTER*(*) :: Element<a name='2288'>
  CHARACTER*(*) :: DateStr<a name='2289'>
  CHARACTER*(*) :: VarName <a name='2290'>
  CHARACTER*(*) :: Data<a name='2291'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2292'>
  INTEGER       :: stat<a name='2293'>
<a name='2294'>
  Status = WRF_NO_ERR<a name='2295'>
  <a name='2296'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1284"> ( DEBUG , 'Entering ext_gr2_get_var_td_char')<a name='2297'>
<a name='2298'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_15">(global_input(DataHandle), &amp;<a name='2299'>
       trim(VarName)//';'//trim(DateStr)//';'//trim(Element), Data, stat)<a name='2300'>
  if (stat /= 0) then<a name='2301'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1285"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(VarName)//';'//trim(DateStr)//';'//trim(Element))<a name='2302'>
     Status = WRF_WARN_VAR_NF<a name='2303'>
     RETURN<a name='2304'>
  endif<a name='2305'>
<a name='2306'>
  RETURN<a name='2307'>
END SUBROUTINE ext_gr2_get_var_td_char <a name='2308'>
<a name='2309'>
<font color=#447700>!******************************************************************************<a name='2310'></font>
<font color=#447700>!* End of get_var_td_* routines<a name='2311'></font>
<font color=#447700>!******************************************************************************<a name='2312'></font>
<a name='2313'>
<font color=#447700>!******************************************************************************<a name='2314'></font>
<font color=#447700>!* Start of put_var_td_* routines<a name='2315'></font>
<font color=#447700>!******************************************************************************<a name='2316'></font>
<a name='2317'>
<A NAME='EXT_GR2_PUT_VAR_TD_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2318'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_double</font> ( DataHandle, Element, DateStr, Varname, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_DOUBLE.html' TARGET='index'>3</A><a name='2319'>
     Data, Count,  Status )<a name='2320'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_39"><a name='2321'>
  IMPLICIT NONE<a name='2322'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_50"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2323'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2324'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2325'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='2326'>
  CHARACTER*(*) , INTENT(IN)  :: VarName<a name='2327'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='2328'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2329'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2330'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2331'>
  INTEGER             :: idx<a name='2332'>
<a name='2333'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1286"> ( DEBUG , 'Entering ext_gr2_put_var_td_double')<a name='2334'>
<a name='2335'>
<a name='2336'>
  if (fileinfo(DataHandle)%committed) then<a name='2337'>
<a name='2338'>
     do idx = 1,Count<a name='2339'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2340'>
     enddo<a name='2341'>
<a name='2342'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_8"> (td_output(DataHandle), &amp;<a name='2343'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2344'>
          tmpstr, Count, Status)<a name='2345'>
<a name='2346'>
  endif<a name='2347'>
<a name='2348'>
RETURN<a name='2349'>
END SUBROUTINE ext_gr2_put_var_td_double<a name='2350'>
<a name='2351'>
<font color=#447700>!*****************************************************************************<a name='2352'></font>
<a name='2353'>
<A NAME='EXT_GR2_PUT_VAR_TD_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2354'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_integer</font> ( DataHandle,Element,  DateStr, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_INTEGER.html' TARGET='index'>3</A><a name='2355'>
     Varname, Data, Count,  Status )<a name='2356'>
<a name='2357'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_40"><a name='2358'>
  IMPLICIT NONE<a name='2359'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_51"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2360'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2361'>
  CHARACTER*(*) :: Element<a name='2362'>
  CHARACTER*(*) :: DateStr<a name='2363'>
  CHARACTER*(*) :: VarName <a name='2364'>
  integer ,       INTENT(IN)  :: Data(*)<a name='2365'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2366'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2367'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2368'>
  INTEGER             :: idx<a name='2369'>
<a name='2370'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1287"> ( DEBUG , 'Entering ext_gr2_put_var_td_integer')<a name='2371'>
<a name='2372'>
  if (fileinfo(DataHandle)%committed) then<a name='2373'>
<a name='2374'>
     do idx = 1,Count<a name='2375'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2376'>
     enddo<a name='2377'>
     <a name='2378'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_9"> (td_output(DataHandle), &amp;<a name='2379'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2380'>
          tmpstr, Count, Status)<a name='2381'>
<a name='2382'>
  endif<a name='2383'>
<a name='2384'>
RETURN<a name='2385'>
END SUBROUTINE ext_gr2_put_var_td_integer <a name='2386'>
<a name='2387'>
<font color=#447700>!*****************************************************************************<a name='2388'></font>
<a name='2389'>
<A NAME='EXT_GR2_PUT_VAR_TD_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2390'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_real</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_REAL.html' TARGET='index'>3</A><a name='2391'>
     Data, Count,  Status )<a name='2392'>
<a name='2393'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_41"><a name='2394'>
  IMPLICIT NONE<a name='2395'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_52"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2396'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2397'>
  CHARACTER*(*) :: Element<a name='2398'>
  CHARACTER*(*) :: DateStr<a name='2399'>
  CHARACTER*(*) :: VarName <a name='2400'>
  real ,          INTENT(IN)  :: Data(*)<a name='2401'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2402'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2403'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2404'>
  INTEGER             :: idx<a name='2405'>
<a name='2406'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1288"> ( DEBUG , 'Entering ext_gr2_put_var_td_real')<a name='2407'>
<a name='2408'>
  if (fileinfo(DataHandle)%committed) then<a name='2409'>
<a name='2410'>
     do idx = 1,Count<a name='2411'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2412'>
     enddo<a name='2413'>
     <a name='2414'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_10"> (td_output(DataHandle), &amp;<a name='2415'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2416'>
          tmpstr, Count, Status)<a name='2417'>
<a name='2418'>
  endif<a name='2419'>
<a name='2420'>
  RETURN<a name='2421'>
END SUBROUTINE ext_gr2_put_var_td_real <a name='2422'>
<a name='2423'>
<font color=#447700>!*****************************************************************************<a name='2424'></font>
<a name='2425'>
<A NAME='EXT_GR2_PUT_VAR_TD_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2426'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_real8</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_REAL8.html' TARGET='index'>3</A><a name='2427'>
     Data, Count,  Status )<a name='2428'>
<a name='2429'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_42"><a name='2430'>
  IMPLICIT NONE<a name='2431'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_53"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2432'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2433'>
  CHARACTER*(*) :: Element<a name='2434'>
  CHARACTER*(*) :: DateStr<a name='2435'>
  CHARACTER*(*) :: VarName <a name='2436'>
  real*8 ,        INTENT(IN)  :: Data(*)<a name='2437'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2438'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2439'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2440'>
  INTEGER             :: idx<a name='2441'>
<a name='2442'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1289"> ( DEBUG , 'Entering ext_gr2_put_var_td_real8')<a name='2443'>
<a name='2444'>
  if (fileinfo(DataHandle)%committed) then<a name='2445'>
     do idx = 1,Count<a name='2446'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2447'>
     enddo<a name='2448'>
     <a name='2449'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_11"> (td_output(DataHandle), &amp;<a name='2450'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2451'>
          tmpstr, Count, Status)<a name='2452'>
  endif<a name='2453'>
<a name='2454'>
  RETURN<a name='2455'>
END SUBROUTINE ext_gr2_put_var_td_real8 <a name='2456'>
<a name='2457'>
<font color=#447700>!*****************************************************************************<a name='2458'></font>
<a name='2459'>
<A NAME='EXT_GR2_PUT_VAR_TD_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2460'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_logical</font> ( DataHandle,Element,  DateStr, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_LOGICAL.html' TARGET='index'>3</A><a name='2461'>
     Varname, Data, Count,  Status )<a name='2462'>
<a name='2463'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_43"><a name='2464'>
  IMPLICIT NONE<a name='2465'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_54"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2466'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2467'>
  CHARACTER*(*) :: Element<a name='2468'>
  CHARACTER*(*) :: DateStr<a name='2469'>
  CHARACTER*(*) :: VarName <a name='2470'>
  logical ,       INTENT(IN)  :: Data(*)<a name='2471'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2472'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2473'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2474'>
  INTEGER             :: idx<a name='2475'>
<a name='2476'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1290"> ( DEBUG , 'Entering ext_gr2_put_var_td_logical')<a name='2477'>
<a name='2478'>
  if (fileinfo(DataHandle)%committed) then<a name='2479'>
<a name='2480'>
     do idx = 1,Count<a name='2481'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2482'>
     enddo<a name='2483'>
<a name='2484'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_12"> (td_output(DataHandle), &amp;<a name='2485'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2486'>
          tmpstr, Count, Status)<a name='2487'>
<a name='2488'>
  endif<a name='2489'>
<a name='2490'>
  RETURN<a name='2491'>
END SUBROUTINE ext_gr2_put_var_td_logical <a name='2492'>
<a name='2493'>
<font color=#447700>!*****************************************************************************<a name='2494'></font>
<a name='2495'>
<A NAME='EXT_GR2_PUT_VAR_TD_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2496'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_var_td_char</font> ( DataHandle,Element,  DateStr,Varname, &amp;,<A href='../../call_from/EXT_GR2_PUT_VAR_TD_CHAR.html' TARGET='index'>3</A><a name='2497'>
     Data,  Status )<a name='2498'>
<a name='2499'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_44"><a name='2500'>
  IMPLICIT NONE<a name='2501'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_55"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2502'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2503'>
  CHARACTER*(*) :: Element<a name='2504'>
  CHARACTER*(*) :: DateStr<a name='2505'>
  CHARACTER*(*) :: VarName <a name='2506'>
  CHARACTER*(*) :: Data<a name='2507'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2508'>
  CHARACTER(len=1000) :: tmpstr(1)<a name='2509'>
  INTEGER             :: idx<a name='2510'>
<a name='2511'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1291"> ( DEBUG , 'Entering ext_gr2_put_var_td_char')<a name='2512'>
<a name='2513'>
  if (fileinfo(DataHandle)%committed) then<a name='2514'>
<a name='2515'>
     write(tmpstr(idx),*)Data<a name='2516'>
<a name='2517'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_VAR_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_13"> (td_output(DataHandle), &amp;<a name='2518'>
          trim(Varname)//';'//trim(DateStr)//';'//trim(Element), &amp;<a name='2519'>
          tmpstr, 1, Status)<a name='2520'>
<a name='2521'>
  endif<a name='2522'>
<a name='2523'>
  RETURN<a name='2524'>
END SUBROUTINE ext_gr2_put_var_td_char <a name='2525'>
<a name='2526'>
<font color=#447700>!******************************************************************************<a name='2527'></font>
<font color=#447700>!* End of put_var_td_* routines<a name='2528'></font>
<font color=#447700>!******************************************************************************<a name='2529'></font>
<a name='2530'>
<a name='2531'>
<font color=#447700>!******************************************************************************<a name='2532'></font>
<font color=#447700>!* Start of get_dom_ti_* routines<a name='2533'></font>
<font color=#447700>!******************************************************************************<a name='2534'></font>
<a name='2535'>
<A NAME='EXT_GR2_GET_DOM_TI_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2536'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_real</font> ( DataHandle,Element,   Data, Count, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TI_REAL.html' TARGET='index'>5</A><a name='2537'>
     Outcount, Status )<a name='2538'>
<a name='2539'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_45"><a name='2540'>
  IMPLICIT NONE<a name='2541'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_56"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2542'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2543'>
  CHARACTER*(*) :: Element<a name='2544'>
  real ,          INTENT(OUT) :: Data(*)<a name='2545'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2546'>
  INTEGER ,       INTENT(OUT) :: Outcount<a name='2547'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2548'>
  INTEGER          :: idx<a name='2549'>
  INTEGER          :: stat<a name='2550'>
  CHARACTER*(1000) :: VALUE<a name='2551'>
<a name='2552'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1292"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_real')<a name='2553'>
<a name='2554'>
  Status = WRF_NO_ERR<a name='2555'>
<a name='2556'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_16">(global_input(DataHandle), &amp;<a name='2557'>
       trim(Element), Value, stat)<a name='2558'>
  if (stat /= 0) then<a name='2559'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1293"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2560'>
     Status = WRF_WARN_VAR_NF<a name='2561'>
     RETURN<a name='2562'>
  endif<a name='2563'>
<a name='2564'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2565'>
  if (stat .ne. 0) then<a name='2566'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1532">("Reading data from"//Value//"failed")<a name='2567'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2568'>
     RETURN<a name='2569'>
  endif<a name='2570'>
  Outcount = idx<a name='2571'>
<a name='2572'>
  RETURN<a name='2573'>
END SUBROUTINE ext_gr2_get_dom_ti_real <a name='2574'>
<a name='2575'>
<font color=#447700>!*****************************************************************************<a name='2576'></font>
<a name='2577'>
<A NAME='EXT_GR2_GET_DOM_TI_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2578'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_real8</font> ( DataHandle,Element,   Data, Count, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TI_REAL8.html' TARGET='index'>5</A><a name='2579'>
     Outcount, Status )<a name='2580'>
<a name='2581'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_46"><a name='2582'>
  IMPLICIT NONE<a name='2583'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_57"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2584'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2585'>
  CHARACTER*(*) :: Element<a name='2586'>
  real*8 ,        INTENT(OUT) :: Data(*)<a name='2587'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2588'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2589'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2590'>
  INTEGER          :: idx<a name='2591'>
  INTEGER          :: stat<a name='2592'>
  CHARACTER*(1000) :: VALUE<a name='2593'>
<a name='2594'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1294"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_real8')<a name='2595'>
<a name='2596'>
  Status = WRF_NO_ERR<a name='2597'>
  <a name='2598'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_17">(global_input(DataHandle), &amp;<a name='2599'>
       trim(Element), Value, stat)<a name='2600'>
  if (stat /= 0) then<a name='2601'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1295"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2602'>
     Status = WRF_WARN_VAR_NF<a name='2603'>
     RETURN<a name='2604'>
  endif<a name='2605'>
<a name='2606'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2607'>
  if (stat .ne. 0) then<a name='2608'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1533">("Reading data from"//Value//"failed")<a name='2609'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2610'>
     RETURN<a name='2611'>
  endif<a name='2612'>
  Outcount = idx<a name='2613'>
 <a name='2614'>
  RETURN<a name='2615'>
END SUBROUTINE ext_gr2_get_dom_ti_real8 <a name='2616'>
<a name='2617'>
<font color=#447700>!*****************************************************************************<a name='2618'></font>
<a name='2619'>
<A NAME='EXT_GR2_GET_DOM_TI_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2620'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_integer</font> ( DataHandle,Element,   Data, Count, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TI_INTEGER.html' TARGET='index'>5</A><a name='2621'>
     Outcount, Status )<a name='2622'>
<a name='2623'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_47"><a name='2624'>
  IMPLICIT NONE<a name='2625'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_58"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2626'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2627'>
  CHARACTER*(*) :: Element<a name='2628'>
  integer ,       INTENT(OUT) :: Data(*)<a name='2629'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2630'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2631'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2632'>
  INTEGER          :: idx<a name='2633'>
  INTEGER          :: stat<a name='2634'>
  CHARACTER*(1000) :: VALUE<a name='2635'>
  <a name='2636'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1296"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_integer Element: '//Element)<a name='2637'>
<a name='2638'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_18">(global_input(DataHandle), &amp;<a name='2639'>
       trim(Element), Value, stat)<a name='2640'>
  if (stat /= 0) then<a name='2641'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1297"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2642'>
     Status = WRF_WARN_VAR_NF<a name='2643'>
     RETURN<a name='2644'>
  endif<a name='2645'>
<a name='2646'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2647'>
  if (stat .ne. 0) then<a name='2648'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1534">("Reading data from"//Value//"failed")<a name='2649'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2650'>
     RETURN<a name='2651'>
  endif<a name='2652'>
  Outcount = Count<a name='2653'>
 <a name='2654'>
  RETURN<a name='2655'>
END SUBROUTINE ext_gr2_get_dom_ti_integer <a name='2656'>
<a name='2657'>
<font color=#447700>!*****************************************************************************<a name='2658'></font>
<a name='2659'>
<A NAME='EXT_GR2_GET_DOM_TI_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2660'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_logical</font> ( DataHandle,Element,   Data, Count, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TI_LOGICAL.html' TARGET='index'>5</A><a name='2661'>
     Outcount, Status )<a name='2662'>
<a name='2663'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_48"><a name='2664'>
  IMPLICIT NONE<a name='2665'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_59"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2666'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2667'>
  CHARACTER*(*) :: Element<a name='2668'>
  logical ,       INTENT(OUT) :: Data(*)<a name='2669'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2670'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='2671'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2672'>
  INTEGER          :: idx<a name='2673'>
  INTEGER          :: stat<a name='2674'>
  CHARACTER*(1000) :: VALUE<a name='2675'>
<a name='2676'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1298"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_logical')<a name='2677'>
<a name='2678'>
  Status = WRF_NO_ERR<a name='2679'>
  <a name='2680'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_19">(global_input(DataHandle), &amp;<a name='2681'>
       trim(Element), Value, stat)<a name='2682'>
  if (stat /= 0) then<a name='2683'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1299"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2684'>
     Status = WRF_WARN_VAR_NF<a name='2685'>
     RETURN<a name='2686'>
  endif<a name='2687'>
<a name='2688'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2689'>
  if (stat .ne. 0) then<a name='2690'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1535">("Reading data from"//Value//"failed")<a name='2691'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2692'>
     RETURN<a name='2693'>
  endif<a name='2694'>
  Outcount = idx<a name='2695'>
 <a name='2696'>
  RETURN<a name='2697'>
END SUBROUTINE ext_gr2_get_dom_ti_logical <a name='2698'>
<a name='2699'>
<font color=#447700>!*****************************************************************************<a name='2700'></font>
<a name='2701'>
<A NAME='EXT_GR2_GET_DOM_TI_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2702'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_char</font> ( DataHandle,Element,   Data,  Status ),<A href='../../call_from/EXT_GR2_GET_DOM_TI_CHAR.html' TARGET='index'>4</A><a name='2703'>
<a name='2704'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_49"><a name='2705'>
  IMPLICIT NONE<a name='2706'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_60"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2707'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2708'>
  CHARACTER*(*) :: Element<a name='2709'>
  CHARACTER*(*) :: Data<a name='2710'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2711'>
  INTEGER       :: stat<a name='2712'>
  INTEGER       :: endchar<a name='2713'>
<a name='2714'>
  Status = WRF_NO_ERR<a name='2715'>
  <a name='2716'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1300"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_char')<a name='2717'>
<a name='2718'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_20">(global_input(DataHandle), &amp;<a name='2719'>
       trim(Element), Data, stat)<a name='2720'>
  if (stat /= 0) then<a name='2721'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1301"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2722'>
     Status = WRF_WARN_VAR_NF<a name='2723'>
     RETURN<a name='2724'>
  endif<a name='2725'>
<a name='2726'>
  RETURN<a name='2727'>
END SUBROUTINE ext_gr2_get_dom_ti_char <a name='2728'>
<a name='2729'>
<font color=#447700>!*****************************************************************************<a name='2730'></font>
<a name='2731'>
<A NAME='EXT_GR2_GET_DOM_TI_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2732'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_ti_double</font> ( DataHandle,Element,   Data, Count, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TI_DOUBLE.html' TARGET='index'>5</A><a name='2733'>
     Outcount, Status )<a name='2734'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_50"><a name='2735'>
  IMPLICIT NONE<a name='2736'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_61"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2737'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2738'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='2739'>
  real*8 ,            INTENT(OUT) :: Data(*)<a name='2740'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2741'>
  INTEGER ,       INTENT(OUT)  :: OutCount<a name='2742'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2743'>
  INTEGER          :: idx<a name='2744'>
  INTEGER          :: stat<a name='2745'>
  CHARACTER*(1000) :: VALUE<a name='2746'>
<a name='2747'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1302"> ( DEBUG , 'Entering ext_gr2_get_dom_ti_double')<a name='2748'>
<a name='2749'>
  Status = WRF_NO_ERR<a name='2750'>
   <a name='2751'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_21">(global_input(DataHandle), &amp;<a name='2752'>
       trim(Element), Value, stat)<a name='2753'>
  if (stat /= 0) then<a name='2754'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1303"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(Element))<a name='2755'>
     Status = WRF_WARN_VAR_NF<a name='2756'>
     RETURN<a name='2757'>
  endif<a name='2758'>
<a name='2759'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='2760'>
  if (stat .ne. 0) then<a name='2761'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1536">("Reading data from"//Value//"failed")<a name='2762'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='2763'>
     RETURN<a name='2764'>
  endif<a name='2765'>
  Outcount = idx<a name='2766'>
 <a name='2767'>
RETURN<a name='2768'>
END SUBROUTINE ext_gr2_get_dom_ti_double<a name='2769'>
<a name='2770'>
<font color=#447700>!******************************************************************************<a name='2771'></font>
<font color=#447700>!* End of get_dom_ti_* routines<a name='2772'></font>
<font color=#447700>!******************************************************************************<a name='2773'></font>
<a name='2774'>
<a name='2775'>
<font color=#447700>!******************************************************************************<a name='2776'></font>
<font color=#447700>!* Start of put_dom_ti_* routines<a name='2777'></font>
<font color=#447700>!******************************************************************************<a name='2778'></font>
<a name='2779'>
<A NAME='EXT_GR2_PUT_DOM_TI_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2780'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_real</font> ( DataHandle,Element,   Data, Count,  &amp; <A href='../../call_to/EXT_GR2_PUT_DOM_TI_REAL.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_REAL.html' TARGET='index'>3</A><a name='2781'>
     Status )<a name='2782'>
<a name='2783'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_51"><a name='2784'>
  IMPLICIT NONE<a name='2785'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_62"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2786'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2787'>
  CHARACTER*(*) :: Element<a name='2788'>
  real ,          INTENT(IN)  :: Data(*)<a name='2789'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2790'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2791'>
  REAL dummy<a name='2792'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2793'>
  character(len=2)    :: lf<a name='2794'>
  integer             :: idx<a name='2795'>
<a name='2796'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1304"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_real')<a name='2797'>
<a name='2798'>
  if (Element .eq. 'DX') then<a name='2799'>
     dx = Data(1)/1000.<a name='2800'>
  endif<a name='2801'>
  if (Element .eq. 'DY') then<a name='2802'>
     dy = Data(1)/1000.<a name='2803'>
  endif<a name='2804'>
  if (Element .eq. 'CEN_LAT') then<a name='2805'>
     center_lat = Data(1)<a name='2806'>
  endif<a name='2807'>
  if (Element .eq. 'CEN_LON') then<a name='2808'>
     center_lon = Data(1)<a name='2809'>
  endif  <a name='2810'>
  if (Element .eq. 'TRUELAT1') then<a name='2811'>
     truelat1 = Data(1)<a name='2812'>
  endif<a name='2813'>
  if (Element .eq. 'TRUELAT2') then<a name='2814'>
     truelat2 = Data(1)<a name='2815'>
  endif<a name='2816'>
  if (Element == 'STAND_LON') then<a name='2817'>
     proj_central_lon = Data(1)<a name='2818'>
  endif<a name='2819'>
  if (Element == 'DT') then<a name='2820'>
     timestep = Data(1)<a name='2821'>
  endif<a name='2822'>
<a name='2823'>
  if (fileinfo(DataHandle)%committed) then<a name='2824'>
<a name='2825'>
     do idx = 1,Count<a name='2826'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2827'>
     enddo<a name='2828'>
     <a name='2829'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_14"> (ti_output(DataHandle), Element, &amp;<a name='2830'>
          tmpstr, Count, Status)<a name='2831'>
<a name='2832'>
  endif<a name='2833'>
<a name='2834'>
  RETURN<a name='2835'>
END SUBROUTINE ext_gr2_put_dom_ti_real <a name='2836'>
<a name='2837'>
<font color=#447700>!*****************************************************************************<a name='2838'></font>
<a name='2839'>
<A NAME='EXT_GR2_PUT_DOM_TI_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2840'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_real8</font> ( DataHandle,Element,   Data, Count,  &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_REAL8.html' TARGET='index'>3</A><a name='2841'>
     Status )<a name='2842'>
<a name='2843'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_52"><a name='2844'>
  IMPLICIT NONE<a name='2845'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_63"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2846'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2847'>
  CHARACTER*(*) :: Element<a name='2848'>
  real*8 ,        INTENT(IN)  :: Data(*)<a name='2849'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2850'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2851'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2852'>
  INTEGER             :: idx<a name='2853'>
<a name='2854'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1305"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_real8')<a name='2855'>
<a name='2856'>
  if (fileinfo(DataHandle)%committed) then<a name='2857'>
<a name='2858'>
     do idx = 1,Count<a name='2859'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2860'>
     enddo<a name='2861'>
     <a name='2862'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_15"> (ti_output(DataHandle), Element, &amp;<a name='2863'>
          tmpstr, Count, Status)<a name='2864'>
<a name='2865'>
  endif<a name='2866'>
<a name='2867'>
  RETURN<a name='2868'>
END SUBROUTINE ext_gr2_put_dom_ti_real8 <a name='2869'>
<a name='2870'>
<font color=#447700>!*****************************************************************************<a name='2871'></font>
<a name='2872'>
<A NAME='EXT_GR2_PUT_DOM_TI_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2873'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_integer</font> ( DataHandle,Element,   Data, Count,  &amp; <A href='../../call_to/EXT_GR2_PUT_DOM_TI_INTEGER.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_INTEGER.html' TARGET='index'>4</A><a name='2874'>
     Status )<a name='2875'>
<a name='2876'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_53"><a name='2877'>
  IMPLICIT NONE<a name='2878'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_64"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2879'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2880'>
  CHARACTER*(*) :: Element<a name='2881'>
  INTEGER ,       INTENT(IN)  :: Data(*)<a name='2882'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2883'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2884'>
  REAL dummy<a name='2885'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2886'>
  INTEGER             :: idx<a name='2887'>
<a name='2888'>
<a name='2889'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1306"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_integer')<a name='2890'>
<a name='2891'>
  if (Element == 'WEST-EAST_GRID_DIMENSION') then<a name='2892'>
     full_xsize = Data(1)<a name='2893'>
  else if (Element == 'SOUTH-NORTH_GRID_DIMENSION') then<a name='2894'>
     full_ysize = Data(1)<a name='2895'>
  else if (Element == 'MAP_PROJ') then<a name='2896'>
     wrf_projection = Data(1)<a name='2897'>
  else if (Element == 'BACKGROUND_PROC_ID') then<a name='2898'>
     background_proc_id = Data(1)<a name='2899'>
  else if (Element == 'FORECAST_PROC_ID') then<a name='2900'>
     forecast_proc_id = Data(1)<a name='2901'>
  else if (Element == 'PRODUCTION_STATUS') then<a name='2902'>
     production_status = Data(1)<a name='2903'>
  else if (Element == 'COMPRESSION') then<a name='2904'>
     compression = Data(1)<a name='2905'>
  endif<a name='2906'>
<a name='2907'>
  if (fileinfo(DataHandle)%committed) then<a name='2908'>
<a name='2909'>
     do idx = 1,Count<a name='2910'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2911'>
     enddo<a name='2912'>
     <a name='2913'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_16"> (ti_output(DataHandle), Element, &amp;<a name='2914'>
          tmpstr, Count, Status)<a name='2915'>
<a name='2916'>
  endif<a name='2917'>
<a name='2918'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1307"> ( DEBUG , 'Leaving ext_gr2_put_dom_ti_integer')<a name='2919'>
<a name='2920'>
  RETURN<a name='2921'>
END SUBROUTINE ext_gr2_put_dom_ti_integer <a name='2922'>
<a name='2923'>
<font color=#447700>!*****************************************************************************<a name='2924'></font>
<a name='2925'>
<A NAME='EXT_GR2_PUT_DOM_TI_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2926'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_logical</font> ( DataHandle,Element,   Data, Count,  &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_LOGICAL.html' TARGET='index'>3</A><a name='2927'>
     Status )<a name='2928'>
<a name='2929'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_54"><a name='2930'>
  IMPLICIT NONE<a name='2931'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_65"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2932'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2933'>
  CHARACTER*(*) :: Element<a name='2934'>
  logical ,       INTENT(IN)  :: Data(*)<a name='2935'>
  INTEGER ,       INTENT(IN)  :: Count<a name='2936'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2937'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='2938'>
  INTEGER             :: idx<a name='2939'>
<a name='2940'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1308"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_logical')<a name='2941'>
<a name='2942'>
  if (fileinfo(DataHandle)%committed) then<a name='2943'>
<a name='2944'>
     do idx = 1,Count<a name='2945'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='2946'>
     enddo<a name='2947'>
     <a name='2948'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_17"> (ti_output(DataHandle), Element, &amp;<a name='2949'>
          tmpstr, Count, Status)<a name='2950'>
<a name='2951'>
  endif<a name='2952'>
<a name='2953'>
  RETURN<a name='2954'>
END SUBROUTINE ext_gr2_put_dom_ti_logical <a name='2955'>
<a name='2956'>
<font color=#447700>!*****************************************************************************<a name='2957'></font>
<a name='2958'>
<A NAME='EXT_GR2_PUT_DOM_TI_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2959'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_char</font> ( DataHandle,Element,   Data,  &amp; <A href='../../call_to/EXT_GR2_PUT_DOM_TI_CHAR.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_CHAR.html' TARGET='index'>3</A><a name='2960'>
     Status )<a name='2961'>
<a name='2962'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_55"><a name='2963'>
  IMPLICIT NONE<a name='2964'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_66"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2965'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='2966'>
  CHARACTER*(*) :: Element<a name='2967'>
  CHARACTER*(*),     INTENT(IN)  :: Data<a name='2968'>
  INTEGER ,       INTENT(OUT) :: Status<a name='2969'>
  REAL dummy<a name='2970'>
  CHARACTER(len=1000) :: tmpstr<a name='2971'>
<a name='2972'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1309"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_char')<a name='2973'>
<a name='2974'>
  if (Element .eq. 'START_DATE') then<a name='2975'>
<a name='2976'>
     <font color=#447700>!<a name='2977'></font>
     <font color=#447700>! This is just a hack to fix a problem when outputting restart.  WRF<a name='2978'></font>
     <font color=#447700>!   outputs both the initialization time and the time of the restart <a name='2979'></font>
     <font color=#447700>!   as the StartDate.  So, we ll just take the earliest.<a name='2980'></font>
     <font color=#447700>!<a name='2981'></font>
     if ((StartDate .eq. '') .or. (Data .le. StartDate)) then<a name='2982'>
        StartDate = Data<a name='2983'>
     endif<a name='2984'>
<a name='2985'>
  endif<a name='2986'>
<a name='2987'>
  if (fileinfo(DataHandle)%committed) then<a name='2988'>
<a name='2989'>
     write(tmpstr,*)trim(Data)<a name='2990'>
     <a name='2991'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_18"> (ti_output(DataHandle), Element, &amp;<a name='2992'>
          tmpstr, 1, Status)<a name='2993'>
<a name='2994'>
  endif<a name='2995'>
<a name='2996'>
  RETURN<a name='2997'>
END SUBROUTINE ext_gr2_put_dom_ti_char<a name='2998'>
<a name='2999'>
<font color=#447700>!*****************************************************************************<a name='3000'></font>
<a name='3001'>
<A NAME='EXT_GR2_PUT_DOM_TI_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3002'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_ti_double</font> ( DataHandle,Element, Data, Count, &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TI_DOUBLE.html' TARGET='index'>3</A><a name='3003'>
     Status )<a name='3004'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_56"><a name='3005'>
  IMPLICIT NONE<a name='3006'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_67"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3007'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3008'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='3009'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='3010'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3011'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3012'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3013'>
  INTEGER             :: idx<a name='3014'>
<a name='3015'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1310"> ( DEBUG , 'Entering ext_gr2_put_dom_ti_double')<a name='3016'>
<a name='3017'>
  if (fileinfo(DataHandle)%committed) then<a name='3018'>
<a name='3019'>
     do idx = 1,Count<a name='3020'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3021'>
     enddo<a name='3022'>
<a name='3023'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TI_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_19"> (ti_output(DataHandle), Element, &amp;<a name='3024'>
          tmpstr, Count, Status)<a name='3025'>
<a name='3026'>
  endif<a name='3027'>
  <a name='3028'>
  RETURN<a name='3029'>
END SUBROUTINE ext_gr2_put_dom_ti_double<a name='3030'>
<a name='3031'>
<font color=#447700>!******************************************************************************<a name='3032'></font>
<font color=#447700>!* End of put_dom_ti_* routines<a name='3033'></font>
<font color=#447700>!******************************************************************************<a name='3034'></font>
<a name='3035'>
<a name='3036'>
<font color=#447700>!******************************************************************************<a name='3037'></font>
<font color=#447700>!* Start of get_dom_td_* routines<a name='3038'></font>
<font color=#447700>!******************************************************************************<a name='3039'></font>
<a name='3040'>
<A NAME='EXT_GR2_GET_DOM_TD_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3041'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_real</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_REAL.html' TARGET='index'>5</A><a name='3042'>
     Count, Outcount, Status )<a name='3043'>
<a name='3044'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_57"><a name='3045'>
  IMPLICIT NONE<a name='3046'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_68"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3047'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3048'>
  CHARACTER*(*) :: Element<a name='3049'>
  CHARACTER*(*) :: DateStr<a name='3050'>
  real ,          INTENT(OUT) :: Data(*)<a name='3051'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3052'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='3053'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3054'>
  INTEGER          :: idx<a name='3055'>
  INTEGER          :: stat<a name='3056'>
  CHARACTER*(1000) :: VALUE<a name='3057'>
<a name='3058'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1311"> ( DEBUG , 'Entering ext_gr2_get_dom_td_real')<a name='3059'>
<a name='3060'>
  Status = WRF_NO_ERR<a name='3061'>
  <a name='3062'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_22">(global_input(DataHandle), &amp;<a name='3063'>
       trim(DateStr)//';'//trim(Element), Value, stat)<a name='3064'>
  if (stat /= 0) then<a name='3065'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1312"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3066'>
     Status = WRF_WARN_VAR_NF<a name='3067'>
     RETURN<a name='3068'>
  endif<a name='3069'>
<a name='3070'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='3071'>
  if (stat .ne. 0) then<a name='3072'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1537">("Reading data from"//Value//"failed")<a name='3073'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='3074'>
     RETURN<a name='3075'>
  endif<a name='3076'>
  Outcount = idx<a name='3077'>
<a name='3078'>
  RETURN<a name='3079'>
END SUBROUTINE ext_gr2_get_dom_td_real <a name='3080'>
<a name='3081'>
<font color=#447700>!*****************************************************************************<a name='3082'></font>
<a name='3083'>
<A NAME='EXT_GR2_GET_DOM_TD_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3084'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_real8</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_REAL8.html' TARGET='index'>5</A><a name='3085'>
     Count, Outcount, Status )<a name='3086'>
<a name='3087'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_58"><a name='3088'>
  IMPLICIT NONE<a name='3089'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_69"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3090'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3091'>
  CHARACTER*(*) :: Element<a name='3092'>
  CHARACTER*(*) :: DateStr<a name='3093'>
  real*8 ,        INTENT(OUT) :: Data(*)<a name='3094'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3095'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='3096'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3097'>
  INTEGER          :: idx<a name='3098'>
  INTEGER          :: stat<a name='3099'>
  CHARACTER*(1000) :: VALUE<a name='3100'>
<a name='3101'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1313"> ( DEBUG , 'Entering ext_gr2_get_dom_td_real8')<a name='3102'>
<a name='3103'>
  Status = WRF_NO_ERR<a name='3104'>
  <a name='3105'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_23">(global_input(DataHandle), &amp;<a name='3106'>
       trim(DateStr)//';'//trim(Element), Value, stat)<a name='3107'>
  if (stat /= 0) then<a name='3108'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1314"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3109'>
     Status = WRF_WARN_VAR_NF<a name='3110'>
     RETURN<a name='3111'>
  endif<a name='3112'>
<a name='3113'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='3114'>
  if (stat .ne. 0) then<a name='3115'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1538">("Reading data from"//Value//"failed")<a name='3116'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='3117'>
     RETURN<a name='3118'>
  endif<a name='3119'>
  Outcount = idx<a name='3120'>
<a name='3121'>
  RETURN<a name='3122'>
END SUBROUTINE ext_gr2_get_dom_td_real8 <a name='3123'>
<a name='3124'>
<font color=#447700>!*****************************************************************************<a name='3125'></font>
<a name='3126'>
<A NAME='EXT_GR2_GET_DOM_TD_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3127'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_integer</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_INTEGER.html' TARGET='index'>5</A><a name='3128'>
     Count, Outcount, Status )<a name='3129'>
<a name='3130'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_59"><a name='3131'>
  IMPLICIT NONE<a name='3132'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_70"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3133'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3134'>
  CHARACTER*(*) :: Element<a name='3135'>
  CHARACTER*(*) :: DateStr<a name='3136'>
  integer ,       INTENT(OUT) :: Data(*)<a name='3137'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3138'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='3139'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3140'>
  INTEGER          :: idx<a name='3141'>
  INTEGER          :: stat<a name='3142'>
  CHARACTER*(1000) :: VALUE<a name='3143'>
<a name='3144'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1315"> ( DEBUG , 'Entering ext_gr2_get_dom_td_integer')<a name='3145'>
<a name='3146'>
  Status = WRF_NO_ERR<a name='3147'>
  <a name='3148'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_24">(global_input(DataHandle), &amp;<a name='3149'>
       trim(DateStr)//';'//trim(Element), Value, stat)<a name='3150'>
  if (stat /= 0) then<a name='3151'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1316"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3152'>
     Status = WRF_WARN_VAR_NF<a name='3153'>
     RETURN<a name='3154'>
  endif<a name='3155'>
<a name='3156'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='3157'>
  if (stat .ne. 0) then<a name='3158'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1539">("Reading data from"//Value//"failed")<a name='3159'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='3160'>
     RETURN<a name='3161'>
  endif<a name='3162'>
  Outcount = idx<a name='3163'>
<a name='3164'>
  RETURN<a name='3165'>
END SUBROUTINE ext_gr2_get_dom_td_integer <a name='3166'>
<a name='3167'>
<font color=#447700>!*****************************************************************************<a name='3168'></font>
<a name='3169'>
<A NAME='EXT_GR2_GET_DOM_TD_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3170'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_logical</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_LOGICAL.html' TARGET='index'>5</A><a name='3171'>
     Count, Outcount, Status )<a name='3172'>
<a name='3173'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_60"><a name='3174'>
  IMPLICIT NONE<a name='3175'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_71"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3176'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3177'>
  CHARACTER*(*) :: Element<a name='3178'>
  CHARACTER*(*) :: DateStr<a name='3179'>
  logical ,       INTENT(OUT) :: Data(*)<a name='3180'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3181'>
  INTEGER ,       INTENT(OUT) :: OutCount<a name='3182'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3183'>
  INTEGER          :: idx<a name='3184'>
  INTEGER          :: stat<a name='3185'>
  CHARACTER*(1000) :: VALUE<a name='3186'>
<a name='3187'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1317"> ( DEBUG , 'Entering ext_gr2_get_dom_td_logical')<a name='3188'>
<a name='3189'>
  Status = WRF_NO_ERR<a name='3190'>
  <a name='3191'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_25">(global_input(DataHandle), &amp;<a name='3192'>
       trim(DateStr)//';'//trim(Element), Value, stat)<a name='3193'>
  if (stat /= 0) then<a name='3194'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1318"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3195'>
     Status = WRF_WARN_VAR_NF<a name='3196'>
     RETURN<a name='3197'>
  endif<a name='3198'>
<a name='3199'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='3200'>
  if (stat .ne. 0) then<a name='3201'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1540">("Reading data from"//Value//"failed")<a name='3202'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='3203'>
     RETURN<a name='3204'>
  endif<a name='3205'>
  Outcount = idx<a name='3206'>
<a name='3207'>
  RETURN<a name='3208'>
END SUBROUTINE ext_gr2_get_dom_td_logical <a name='3209'>
<a name='3210'>
<font color=#447700>!*****************************************************************************<a name='3211'></font>
<a name='3212'>
<A NAME='EXT_GR2_GET_DOM_TD_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3213'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_char</font> ( DataHandle,Element, DateStr,  Data,  &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_CHAR.html' TARGET='index'>4</A><a name='3214'>
     Status )<a name='3215'>
<a name='3216'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_61"><a name='3217'>
  IMPLICIT NONE<a name='3218'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_72"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3219'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3220'>
  CHARACTER*(*) :: Element<a name='3221'>
  CHARACTER*(*) :: DateStr<a name='3222'>
  CHARACTER*(*) :: Data<a name='3223'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3224'>
  INTEGER       :: stat<a name='3225'>
<a name='3226'>
  Status = WRF_NO_ERR<a name='3227'>
  <a name='3228'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1319"> ( DEBUG , 'Entering ext_gr2_get_dom_td_char')<a name='3229'>
<a name='3230'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_26">(global_input(DataHandle), &amp;<a name='3231'>
       trim(DateStr)//';'//trim(Element), Data, stat)<a name='3232'>
  if (stat /= 0) then<a name='3233'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1320"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3234'>
     Status = WRF_WARN_VAR_NF<a name='3235'>
     RETURN<a name='3236'>
  endif<a name='3237'>
<a name='3238'>
  RETURN<a name='3239'>
END SUBROUTINE ext_gr2_get_dom_td_char <a name='3240'>
<a name='3241'>
<font color=#447700>!*****************************************************************************<a name='3242'></font>
<a name='3243'>
<A NAME='EXT_GR2_GET_DOM_TD_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3244'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_get_dom_td_double</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_GET_DOM_TD_DOUBLE.html' TARGET='index'>5</A><a name='3245'>
     Count, Outcount, Status )<a name='3246'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_62"><a name='3247'>
  IMPLICIT NONE<a name='3248'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_73"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3249'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3250'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='3251'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='3252'>
  real*8 ,            INTENT(OUT) :: Data(*)<a name='3253'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3254'>
  INTEGER ,       INTENT(OUT)  :: OutCount<a name='3255'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3256'>
  INTEGER          :: idx<a name='3257'>
  INTEGER          :: stat<a name='3258'>
  CHARACTER*(1000) :: VALUE<a name='3259'>
<a name='3260'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1321"> ( DEBUG , 'Entering ext_gr2_get_dom_td_double')<a name='3261'>
<a name='3262'>
  Status = WRF_NO_ERR<a name='3263'>
  <a name='3264'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE'>gr2_get_metadata_value</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_GET_METADATA_VALUE_27">(global_input(DataHandle), &amp;<a name='3265'>
       trim(DateStr)//';'//trim(Element), Value, stat)<a name='3266'>
  if (stat /= 0) then<a name='3267'>
     CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1322"> ( DEBUG , "gr2_get_metadata_value failed for "//trim(DateStr)//';'//trim(Element))<a name='3268'>
     Status = WRF_WARN_VAR_NF<a name='3269'>
     RETURN<a name='3270'>
  endif<a name='3271'>
<a name='3272'>
  READ(Value,*,IOSTAT=stat)(Data(idx),idx=1,Count)<a name='3273'>
  if (stat .ne. 0) then<a name='3274'>
     CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1541">("Reading data from"//Value//"failed")<a name='3275'>
     Status = WRF_WARN_COUNT_TOO_LONG<a name='3276'>
     RETURN<a name='3277'>
  endif<a name='3278'>
  Outcount = idx<a name='3279'>
<a name='3280'>
RETURN<a name='3281'>
END SUBROUTINE ext_gr2_get_dom_td_double<a name='3282'>
<a name='3283'>
<font color=#447700>!******************************************************************************<a name='3284'></font>
<font color=#447700>!* End of get_dom_td_* routines<a name='3285'></font>
<font color=#447700>!******************************************************************************<a name='3286'></font>
<a name='3287'>
<a name='3288'>
<font color=#447700>!******************************************************************************<a name='3289'></font>
<font color=#447700>!* Start of put_dom_td_* routines<a name='3290'></font>
<font color=#447700>!******************************************************************************<a name='3291'></font>
<a name='3292'>
<a name='3293'>
<A NAME='EXT_GR2_PUT_DOM_TD_REAL8'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL8' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3294'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_real8</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_REAL8.html' TARGET='index'>3</A><a name='3295'>
     Count,  Status )<a name='3296'>
<a name='3297'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_63"><a name='3298'>
  IMPLICIT NONE<a name='3299'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_74"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3300'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3301'>
  CHARACTER*(*) :: Element<a name='3302'>
  CHARACTER*(*) :: DateStr<a name='3303'>
  real*8 ,        INTENT(IN)  :: Data(*)<a name='3304'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3305'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3306'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3307'>
  INTEGER             :: idx<a name='3308'>
<a name='3309'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1323"> ( DEBUG , 'Entering ext_gr2_put_dom_td_real8')<a name='3310'>
<a name='3311'>
  if (fileinfo(DataHandle)%committed) then<a name='3312'>
<a name='3313'>
     do idx = 1,Count<a name='3314'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3315'>
     enddo<a name='3316'>
<a name='3317'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL8' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_20"> (td_output(DataHandle), &amp;<a name='3318'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3319'>
          Count, Status)<a name='3320'>
<a name='3321'>
  endif<a name='3322'>
<a name='3323'>
  RETURN<a name='3324'>
END SUBROUTINE ext_gr2_put_dom_td_real8 <a name='3325'>
<a name='3326'>
<font color=#447700>!*****************************************************************************<a name='3327'></font>
<a name='3328'>
<A NAME='EXT_GR2_PUT_DOM_TD_INTEGER'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3329'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_integer</font> ( DataHandle,Element, DateStr,  Data, &amp; <A href='../../call_to/EXT_GR2_PUT_DOM_TD_INTEGER.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_INTEGER.html' TARGET='index'>3</A><a name='3330'>
     Count,  Status )<a name='3331'>
<a name='3332'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_64"><a name='3333'>
  IMPLICIT NONE<a name='3334'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_75"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3335'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3336'>
  CHARACTER*(*) :: Element<a name='3337'>
  CHARACTER*(*) :: DateStr<a name='3338'>
  integer ,       INTENT(IN)  :: Data(*)<a name='3339'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3340'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3341'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3342'>
  INTEGER             :: idx<a name='3343'>
<a name='3344'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1324"> ( DEBUG , 'Entering ext_gr2_put_dom_td_integer')<a name='3345'>
<a name='3346'>
  if (fileinfo(DataHandle)%committed) then<a name='3347'>
<a name='3348'>
     do idx = 1,Count<a name='3349'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3350'>
     enddo<a name='3351'>
     <a name='3352'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_INTEGER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_21"> (td_output(DataHandle), &amp;<a name='3353'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3354'>
          Count, Status)<a name='3355'>
<a name='3356'>
  endif<a name='3357'>
<a name='3358'>
  RETURN<a name='3359'>
END SUBROUTINE ext_gr2_put_dom_td_integer<a name='3360'>
<a name='3361'>
<font color=#447700>!*****************************************************************************<a name='3362'></font>
<a name='3363'>
<A NAME='EXT_GR2_PUT_DOM_TD_LOGICAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3364'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_logical</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_LOGICAL.html' TARGET='index'>3</A><a name='3365'>
     Count,  Status )<a name='3366'>
<a name='3367'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_65"><a name='3368'>
  IMPLICIT NONE<a name='3369'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_76"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3370'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3371'>
  CHARACTER*(*) :: Element<a name='3372'>
  CHARACTER*(*) :: DateStr<a name='3373'>
  logical ,       INTENT(IN)  :: Data(*)<a name='3374'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3375'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3376'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3377'>
  INTEGER             :: idx<a name='3378'>
<a name='3379'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1325"> ( DEBUG , 'Entering ext_gr2_put_dom_td_logical')<a name='3380'>
<a name='3381'>
  if (fileinfo(DataHandle)%committed) then<a name='3382'>
<a name='3383'>
     do idx = 1,Count<a name='3384'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3385'>
     enddo<a name='3386'>
     <a name='3387'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_LOGICAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_22"> (td_output(DataHandle), &amp;<a name='3388'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3389'>
          Count, Status)<a name='3390'>
<a name='3391'>
  endif<a name='3392'>
<a name='3393'>
  RETURN<a name='3394'>
END SUBROUTINE ext_gr2_put_dom_td_logical<a name='3395'>
<a name='3396'>
<font color=#447700>!*****************************************************************************<a name='3397'></font>
<a name='3398'>
<A NAME='EXT_GR2_PUT_DOM_TD_CHAR'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3399'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_char</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_CHAR.html' TARGET='index'>3</A><a name='3400'>
     Status )<a name='3401'>
<a name='3402'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_66"><a name='3403'>
  IMPLICIT NONE<a name='3404'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_77"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3405'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3406'>
  CHARACTER*(*) :: Element<a name='3407'>
  CHARACTER*(*) :: DateStr<a name='3408'>
  CHARACTER(len=*), INTENT(IN)  :: Data<a name='3409'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3410'>
  CHARACTER(len=1000) :: tmpstr(1)<a name='3411'>
<a name='3412'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1326"> ( DEBUG , 'Entering ext_gr2_put_dom_td_char')<a name='3413'>
<a name='3414'>
  if (fileinfo(DataHandle)%committed) then<a name='3415'>
<a name='3416'>
     write(tmpstr(1),*)Data<a name='3417'>
<a name='3418'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_23"> (td_output(DataHandle), &amp;<a name='3419'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3420'>
          1, Status)<a name='3421'>
<a name='3422'>
  endif<a name='3423'>
<a name='3424'>
  RETURN<a name='3425'>
END SUBROUTINE ext_gr2_put_dom_td_char <a name='3426'>
<a name='3427'>
<font color=#447700>!*****************************************************************************<a name='3428'></font>
<a name='3429'>
<A NAME='EXT_GR2_PUT_DOM_TD_DOUBLE'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3430'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_double</font> ( DataHandle,Element, DateStr,  Data, &amp;,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_DOUBLE.html' TARGET='index'>3</A><a name='3431'>
     Count,  Status )<a name='3432'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_67"><a name='3433'>
  IMPLICIT NONE<a name='3434'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_78"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3435'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3436'>
  CHARACTER*(*) , INTENT(IN)  :: Element<a name='3437'>
  CHARACTER*(*) , INTENT(IN)  :: DateStr<a name='3438'>
  real*8 ,            INTENT(IN) :: Data(*)<a name='3439'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3440'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3441'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3442'>
  INTEGER             :: idx<a name='3443'>
<a name='3444'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1327"> ( DEBUG , 'Entering ext_gr2_put_dom_td_double')<a name='3445'>
<a name='3446'>
  if (fileinfo(DataHandle)%committed) then<a name='3447'>
<a name='3448'>
     do idx = 1,Count<a name='3449'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3450'>
     enddo<a name='3451'>
<a name='3452'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_DOUBLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_24"> (td_output(DataHandle), &amp;<a name='3453'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3454'>
          Count, Status)<a name='3455'>
<a name='3456'>
  endif<a name='3457'>
<a name='3458'>
RETURN<a name='3459'>
END SUBROUTINE ext_gr2_put_dom_td_double<a name='3460'>
<a name='3461'>
<font color=#447700>!*****************************************************************************<a name='3462'></font>
<a name='3463'>
<A NAME='EXT_GR2_PUT_DOM_TD_REAL'><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3464'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>ext_gr2_put_dom_td_real</font> ( DataHandle,Element, DateStr,  Data, &amp; <A href='../../call_to/EXT_GR2_PUT_DOM_TD_REAL.html' TARGET='index'>4</A>,<A href='../../call_from/EXT_GR2_PUT_DOM_TD_REAL.html' TARGET='index'>3</A><a name='3465'>
     Count,  Status )<a name='3466'>
<a name='3467'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_68"><a name='3468'>
  IMPLICIT NONE<a name='3469'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_79"><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3470'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='3471'>
  CHARACTER*(*) :: Element<a name='3472'>
  CHARACTER*(*) :: DateStr<a name='3473'>
  real ,          INTENT(IN)  :: Data(*)<a name='3474'>
  INTEGER ,       INTENT(IN)  :: Count<a name='3475'>
  INTEGER ,       INTENT(OUT) :: Status<a name='3476'>
  CHARACTER(len=1000) :: tmpstr(1000)<a name='3477'>
  INTEGER             :: idx<a name='3478'>
<a name='3479'>
  call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_1328"> ( DEBUG , 'Entering ext_gr2_put_dom_td_real')<a name='3480'>
<a name='3481'>
  if (fileinfo(DataHandle)%committed) then<a name='3482'>
<a name='3483'>
     do idx = 1,Count<a name='3484'>
        write(tmpstr(idx),'(G17.10)')Data(idx)<a name='3485'>
     enddo<a name='3486'>
     <a name='3487'>
     CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING'>gr2_build_string</A><A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_PUT_DOM_TD_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_BUILD_STRING_25"> (td_output(DataHandle), &amp;<a name='3488'>
          trim(DateStr)//';'//trim(Element), tmpstr, &amp;<a name='3489'>
          Count, Status)<a name='3490'>
<a name='3491'>
  endif<a name='3492'>
<a name='3493'>
  RETURN<a name='3494'>
END SUBROUTINE ext_gr2_put_dom_td_real <a name='3495'>
<a name='3496'>
<a name='3497'>
<font color=#447700>!******************************************************************************<a name='3498'></font>
<font color=#447700>!* End of put_dom_td_* routines<a name='3499'></font>
<font color=#447700>!******************************************************************************<a name='3500'></font>
<a name='3501'>
<a name='3502'>
<A NAME='GR2_GET_NEW_HANDLE'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_NEW_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3503'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>gr2_get_new_handle</font>(DataHandle) <A href='../../call_to/GR2_GET_NEW_HANDLE.html' TARGET='index'>2</A>,<A href='../../call_from/GR2_GET_NEW_HANDLE.html' TARGET='index'>1</A><a name='3504'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_69"><a name='3505'>
  IMPLICIT NONE<a name='3506'>
  <a name='3507'>
  INTEGER ,       INTENT(OUT)  :: DataHandle<a name='3508'>
  INTEGER :: i<a name='3509'>
<a name='3510'>
  DataHandle = -1<a name='3511'>
  do i=firstFileHandle, maxFileHandles<a name='3512'>
     if (.NOT. fileinfo(i)%used) then<a name='3513'>
        DataHandle = i<a name='3514'>
        fileinfo(i)%used = .true.<a name='3515'>
        exit<a name='3516'>
     endif<a name='3517'>
  enddo<a name='3518'>
<a name='3519'>
  RETURN<a name='3520'>
END SUBROUTINE gr2_get_new_handle<a name='3521'>
<a name='3522'>
<font color=#447700>!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!<a name='3523'></font>
<a name='3524'>
<a name='3525'>
<font color=#447700>!*****************************************************************************<a name='3526'></font>
<a name='3527'>
<A NAME='GR2_RETRIEVE_DATA'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_RETRIEVE_DATA' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3528'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>gr2_retrieve_data</font> (MemoryOrder, MemoryStart, MemoryEnd, xsize, ysize, &amp; <A href='../../call_to/GR2_RETRIEVE_DATA.html' TARGET='index'>2</A><a name='3529'>
     zsize, z, FieldType, Field, data)<a name='3530'>
  <a name='3531'>
  IMPLICIT NONE<a name='3532'>
<a name='3533'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_80"><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_RETRIEVE_DATA' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3534'>
<a name='3535'>
  character*(*)                 ,intent(in)    :: MemoryOrder<a name='3536'>
  integer                       ,intent(in)    :: xsize, ysize, zsize<a name='3537'>
  integer                       ,intent(in)    :: z<a name='3538'>
  integer,dimension(*)          ,intent(in)    :: MemoryStart, MemoryEnd<a name='3539'>
  integer                       ,intent(in)    :: FieldType<a name='3540'>
  real                          ,intent(in),       &amp;<a name='3541'>
       dimension( 1:1,MemoryStart(1):MemoryEnd(1), &amp;<a name='3542'>
       MemoryStart(2):MemoryEnd(2), &amp;<a name='3543'>
       MemoryStart(3):MemoryEnd(3) )           :: Field<a name='3544'>
  real   ,dimension(1:xsize,1:ysize),intent(inout) :: data<a name='3545'>
<a name='3546'>
  integer                                      :: x, y, idx<a name='3547'>
  integer, dimension(:,:),   pointer           :: mold<a name='3548'>
  integer                                      :: istat<a name='3549'>
  integer                                      :: dim1<a name='3550'>
  <a name='3551'>
  ALLOCATE(mold(1:xsize,1:ysize), STAT=istat)<a name='3552'>
  if (istat .ne. 0) then<a name='3553'>
     print *,'Could not allocate space for mold, returning'<a name='3554'>
     return<a name='3555'>
  endif<a name='3556'>
<a name='3557'>
  <font color=#447700>!<a name='3558'></font>
  <font color=#447700>! Set the size of the first dimension of the data array (dim1) to xsize.  <a name='3559'></font>
  <font color=#447700>!    If the MemoryOrder is Z or z, dim1 is overridden below.<a name='3560'></font>
  <font color=#447700>!<a name='3561'></font>
  dim1 = xsize<a name='3562'>
<a name='3563'>
  SELECT CASE (MemoryOrder)<a name='3564'>
  CASE ('XYZ')<a name='3565'>
     data = Field(1,1:xsize,1:ysize,z)<a name='3566'>
  CASE ('C')<a name='3567'>
     data = Field(1,1:xsize,1:ysize,z)<a name='3568'>
  CASE ('XZY')<a name='3569'>
     data = Field(1,1:xsize,z,1:ysize)<a name='3570'>
  CASE ('YXZ')<a name='3571'>
     do x = 1,xsize<a name='3572'>
        do y = 1,ysize<a name='3573'>
           data(x,y) = Field(1,y,x,z)<a name='3574'>
        enddo<a name='3575'>
     enddo<a name='3576'>
  CASE ('YZX')<a name='3577'>
     do x = 1,xsize<a name='3578'>
        do y = 1,ysize<a name='3579'>
           data(x,y) = Field(1,y,z,x)<a name='3580'>
        enddo<a name='3581'>
     enddo<a name='3582'>
  CASE ('ZXY')<a name='3583'>
     data = Field(1,z,1:xsize,1:ysize)<a name='3584'>
  CASE ('ZYX')<a name='3585'>
     do x = 1,xsize<a name='3586'>
        do y = 1,ysize<a name='3587'>
           data(x,y) = Field(1,z,y,x)<a name='3588'>
        enddo<a name='3589'>
     enddo<a name='3590'>
  CASE ('XY')<a name='3591'>
     data = Field(1,1:xsize,1:ysize,1)<a name='3592'>
  CASE ('YX')<a name='3593'>
     do x = 1,xsize<a name='3594'>
        do y = 1,ysize<a name='3595'>
           data(x,y) = Field(1,y,x,1)<a name='3596'>
        enddo<a name='3597'>
     enddo<a name='3598'>
     <a name='3599'>
  CASE ('XSZ')<a name='3600'>
     do x = 1,xsize<a name='3601'>
        do y = 1,ysize<a name='3602'>
           data(x,y) = Field(1,y,z,x)<a name='3603'>
        enddo<a name='3604'>
     enddo<a name='3605'>
  CASE ('XEZ')<a name='3606'>
     do x = 1,xsize<a name='3607'>
        do y = 1,ysize<a name='3608'>
           data(x,y) = Field(1,y,z,x)<a name='3609'>
        enddo<a name='3610'>
     enddo<a name='3611'>
  CASE ('YSZ')<a name='3612'>
     do x = 1,xsize<a name='3613'>
        do y = 1,ysize<a name='3614'>
           data(x,y) = Field(1,x,z,y)<a name='3615'>
        enddo<a name='3616'>
     enddo<a name='3617'>
  CASE ('YEZ')<a name='3618'>
     do x = 1,xsize<a name='3619'>
        do y = 1,ysize<a name='3620'>
           data(x,y) = Field(1,x,z,y)<a name='3621'>
        enddo<a name='3622'>
     enddo<a name='3623'>
     <a name='3624'>
  CASE ('XS')<a name='3625'>
     do x = 1,xsize<a name='3626'>
        do y = 1,ysize<a name='3627'>
           data(x,y) = Field(1,y,x,1)<a name='3628'>
        enddo<a name='3629'>
     enddo<a name='3630'>
  CASE ('XE')<a name='3631'>
     do x = 1,xsize<a name='3632'>
        do y = 1,ysize<a name='3633'>
           data(x,y) = Field(1,y,x,1)<a name='3634'>
        enddo<a name='3635'>
     enddo<a name='3636'>
  CASE ('YS')<a name='3637'>
     do x = 1,xsize<a name='3638'>
        do y = 1,ysize<a name='3639'>
           data(x,y) = Field(1,x,y,1)<a name='3640'>
        enddo<a name='3641'>
     enddo<a name='3642'>
  CASE ('YE')<a name='3643'>
     do x = 1,xsize<a name='3644'>
        do y = 1,ysize<a name='3645'>
           data(x,y) = Field(1,x,y,1)<a name='3646'>
        enddo<a name='3647'>
     enddo<a name='3648'>
  CASE ('Z')<a name='3649'>
     data(1:zsize,1) = Field(1,1:zsize,1,1)<a name='3650'>
     dim1 = zsize<a name='3651'>
  CASE ('z')<a name='3652'>
     data(1:zsize,1) = Field(1,zsize:1,1,1)<a name='3653'>
     dim1 = zsize<a name='3654'>
  CASE ('0')<a name='3655'>
     data(1,1) = Field(1,1,1,1)<a name='3656'>
  END SELECT<a name='3657'>
  <a name='3658'>
  <font color=#447700>! <a name='3659'></font>
  <font color=#447700>! Here, we convert any integer fields to real<a name='3660'></font>
  <font color=#447700>!<a name='3661'></font>
  if (FieldType == WRF_INTEGER) then<a name='3662'>
     mold = 0<a name='3663'>
     do idx=1,dim1<a name='3664'>
        <font color=#447700>!<a name='3665'></font>
        <font color=#447700>! The parentheses around data(idx,:) are needed in order<a name='3666'></font>
        <font color=#447700>!   to fix a bug with transfer with the xlf compiler on NCARs<a name='3667'></font>
        <font color=#447700>!   IBM (bluesky).<a name='3668'></font>
        <font color=#447700>!<a name='3669'></font>
        data(idx,:)=transfer((data(idx,:)),mold)<a name='3670'>
     enddo<a name='3671'>
  endif<a name='3672'>
<a name='3673'>
  deallocate(mold)<a name='3674'>
  <a name='3675'>
  return<a name='3676'>
<a name='3677'>
end subroutine gr2_retrieve_data<a name='3678'>
<a name='3679'>
<font color=#447700>!*****************************************************************************<a name='3680'></font>
<a name='3681'>
<A NAME='GR2_GET_LEVELS'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_LEVELS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3682'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>gr2_get_levels</font>(VarName, zidx, zsize, soil_layers, vert_stag, &amp; <A href='../../call_to/GR2_GET_LEVELS.html' TARGET='index'>2</A>,<A href='../../call_from/GR2_GET_LEVELS.html' TARGET='index'>1</A><a name='3683'>
     fraction, vert_unit1, vert_unit2, vert_sclFctr1, vert_sclFctr2, &amp;<a name='3684'>
     level1, level2)<a name='3685'>
<a name='3686'>
  use <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_70"><a name='3687'>
  IMPLICIT NONE<a name='3688'>
<a name='3689'>
  integer :: zidx<a name='3690'>
  integer :: zsize<a name='3691'>
  logical :: soil_layers<a name='3692'>
  logical :: vert_stag<a name='3693'>
  logical :: fraction<a name='3694'>
  integer :: vert_unit1, vert_unit2<a name='3695'>
  integer :: vert_sclFctr1, vert_sclFctr2<a name='3696'>
  integer :: level1<a name='3697'>
  integer :: level2<a name='3698'>
  character (LEN=*) :: VarName<a name='3699'>
<a name='3700'>
  <font color=#447700>! Setup vert_unit, and vertical levels in grib units<a name='3701'></font>
<a name='3702'>
  if ((VarName .eq. 'LANDUSEF') .or. (VarName .eq. 'SOILCTOP') &amp;<a name='3703'>
       .or. (VarName .eq. 'SOILCBOT')) then<a name='3704'>
     vert_unit1 = 105;<a name='3705'>
     vert_unit2 = 255;<a name='3706'>
     vert_sclFctr1 = 0<a name='3707'>
     vert_sclFctr2 = 0<a name='3708'>
     level1 = zidx<a name='3709'>
     level2 = 0<a name='3710'>
  else if ((zsize .gt. 1) .and. (.not. soil_layers) .and. (.not. fraction)) &amp;<a name='3711'>
       then<a name='3712'>
     vert_unit1 = 111;<a name='3713'>
     vert_unit2 = 255;<a name='3714'>
     vert_sclFctr1 = 4<a name='3715'>
     vert_sclFctr2 = 4<a name='3716'>
     if (vert_stag) then<a name='3717'>
        level1 = (10000*full_eta(zidx)+0.5)<a name='3718'>
     else<a name='3719'>
        level1 = (10000*half_eta(zidx)+0.5)<a name='3720'>
     endif<a name='3721'>
     level2 = 0<a name='3722'>
  else<a name='3723'>
     <font color=#447700>! Set the vertical coordinate and level for soil and 2D fields<a name='3724'></font>
     if (fraction) then<a name='3725'>
        vert_unit1 = 105<a name='3726'>
        vert_unit2 = 255<a name='3727'>
        level1 = zidx<a name='3728'>
        level2 = 0<a name='3729'>
        vert_sclFctr1 = 0<a name='3730'>
        vert_sclFctr2 = 0<a name='3731'>
     else if (soil_layers) then<a name='3732'>
        vert_unit1 = 106<a name='3733'>
        vert_unit2 = 106<a name='3734'>
        level1 = 100*(soil_depth(zidx) - 0.5*soil_thickness(zidx))+0.5<a name='3735'>
        level2 = 100*(soil_depth(zidx) + 0.5*soil_thickness(zidx))+0.5<a name='3736'>
        vert_sclFctr1 = 2<a name='3737'>
        vert_sclFctr2 = 2<a name='3738'>
     else if (VarName .eq. 'mu') then<a name='3739'>
        vert_unit1 = 105<a name='3740'>
        vert_unit2 = 255<a name='3741'>
        level1 = 0<a name='3742'>
        level2 = 0<a name='3743'>
        vert_sclFctr1 = 0<a name='3744'>
        vert_sclFctr2 = 0<a name='3745'>
     else if ((VarName .eq. 'Q2') .or. (VarName .eq. 'TH2') .or. &amp;<a name='3746'>
        (VarName .eq. 'T2')) then<a name='3747'>
        vert_unit1 = 103<a name='3748'>
        vert_unit2 = 255<a name='3749'>
        level1 = 2<a name='3750'>
        level2 = 0<a name='3751'>
        vert_sclFctr1 = 0<a name='3752'>
        vert_sclFctr2 = 0<a name='3753'>
     else if ((VarName .eq. 'Q10') .or. (VarName .eq. 'TH10') .or. &amp;<a name='3754'>
          (VarName .eq. 'U10') .or. (VarName .eq. 'V10')) then<a name='3755'>
        vert_unit1 = 103<a name='3756'>
        vert_unit2 = 255<a name='3757'>
        level1 = 10<a name='3758'>
        level2 = 0<a name='3759'>
        vert_sclFctr1 = 0<a name='3760'>
        vert_sclFctr2 = 0<a name='3761'>
     else <a name='3762'>
        vert_unit1 = 1<a name='3763'>
        vert_unit2 = 255<a name='3764'>
        level1 = 0<a name='3765'>
        level2 = 0<a name='3766'>
        vert_sclFctr1 = 0<a name='3767'>
        vert_sclFctr2 = 0<a name='3768'>
     endif<a name='3769'>
  endif<a name='3770'>
<a name='3771'>
end SUBROUTINE gr2_get_levels<a name='3772'>
<a name='3773'>
<font color=#447700>!*****************************************************************************<a name='3774'></font>
<a name='3775'>
<A NAME='GR2_CREATE_W'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CREATE_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3776'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_create_w</font>(StartDate, cgrib, lcgrib, production_status, Disc, &amp; <A href='../../call_to/GR2_CREATE_W.html' TARGET='index'>2</A><a name='3777'>
     center, subcenter, MasterTblV, LocalTblV, ierr, msg)<a name='3778'>
<a name='3779'>
  implicit none<a name='3780'>
<a name='3781'>
  character*24 ,intent(in)     :: StartDate<a name='3782'>
  character*(*),intent(inout)  :: cgrib<a name='3783'>
  integer      ,intent(in)     :: lcgrib<a name='3784'>
  integer      ,intent(in)     :: production_status<a name='3785'>
  integer      ,intent(out)    :: ierr<a name='3786'>
  character*(*),intent(out)    :: msg<a name='3787'>
  integer , dimension(13)      :: listsec1<a name='3788'>
  integer , dimension(2)       :: listsec0<a name='3789'>
  integer                      :: slen<a name='3790'>
  integer , intent(in)         :: Disc, center, subcenter, MasterTblV, LocalTblV<a name='3791'>
<a name='3792'>
  <font color=#447700>! <a name='3793'></font>
  <font color=#447700>! Create the grib message<a name='3794'></font>
  <font color=#447700>!<a name='3795'></font>
  listsec0(1) = Disc       <font color=#447700>! Discipline (Table 0.0)<a name='3796'></font>
  listsec0(2) = 2          <font color=#447700>! Grib edition number<a name='3797'></font>
<a name='3798'>
  listsec1(1) = center     <font color=#447700>! Id of Originating Center (255 for missing)<a name='3799'></font>
  listsec1(2) = subcenter  <font color=#447700>! Id of originating sub-center (255 for missing)<a name='3800'></font>
  listsec1(3) = MasterTblV <font color=#447700>! Master Table Version #<a name='3801'></font>
  listsec1(4) = LocalTblV  <font color=#447700>! Local table version #<a name='3802'></font>
  listsec1(5) = 1          <font color=#447700>! Significance of reference time, 1 indicates start of forecast<a name='3803'></font>
<a name='3804'>
  READ(StartDate(1:4),  '(I4)') listsec1(6) <font color=#447700>! Year of reference<a name='3805'></font>
<a name='3806'>
  READ(StartDate(6:7),  '(I2)') listsec1(7) <font color=#447700>! Month of reference<a name='3807'></font>
<a name='3808'>
  READ(StartDate(9:10), '(I2)') listsec1(8) <font color=#447700>! Day of reference<a name='3809'></font>
<a name='3810'>
  slen = LEN(StartDate)<a name='3811'>
<a name='3812'>
  if (slen.GE.13) then<a name='3813'>
     read(StartDate(12:13),'(I2)') listsec1(9)<a name='3814'>
  else<a name='3815'>
     listsec1(9) = 0<a name='3816'>
  endif<a name='3817'>
<a name='3818'>
  if (slen.GE.16) then<a name='3819'>
     read(StartDate(15:16),'(I2)') listsec1(10)<a name='3820'>
  else<a name='3821'>
     listsec1(10) = 0<a name='3822'>
  endif<a name='3823'>
<a name='3824'>
  if (slen.GE.19) then<a name='3825'>
     read(StartDate(18:19),'(I2)') listsec1(11)<a name='3826'>
  else<a name='3827'>
     listsec1(11) = 0<a name='3828'>
  end if<a name='3829'>
<a name='3830'>
  listsec1(12) = production_status  <font color=#447700>! Production status of data<a name='3831'></font>
  listsec1(13) = 1     <font color=#447700>! Type of data (1 indicates forecast products)<a name='3832'></font>
<a name='3833'>
  call gribcreate(cgrib,lcgrib,listsec0,listsec1,ierr)<a name='3834'>
<a name='3835'>
  if (ierr .ne. 0) then<a name='3836'>
     write(msg,*) 'gribcreate failed with ierr: ',ierr<a name='3837'>
  else<a name='3838'>
     msg = ''<a name='3839'>
  endif<a name='3840'>
  <a name='3841'>
end SUBROUTINE gr2_create_w<a name='3842'>
<a name='3843'>
<a name='3844'>
<font color=#447700>!*****************************************************************************<a name='3845'></font>
<A NAME='GR2_ADDGRID_W'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3846'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_addgrid_w</font>(cgrib, lcgrib, central_lat, central_lon, wrf_projection, &amp; <A href='../../call_to/GR2_ADDGRID_W.html' TARGET='index'>2</A>,<A href='../../call_from/GR2_ADDGRID_W.html' TARGET='index'>9</A><a name='3847'>
     latin1, latin2, nx, ny, dx, dy, center_lat, center_lon, ierr,msg)<a name='3848'>
  <a name='3849'>
  implicit none<a name='3850'>
<a name='3851'>
  character*(*)            ,intent(inout)   :: cgrib<a name='3852'>
  integer                  ,intent(in)      :: lcgrib<a name='3853'>
  real                     ,intent(in)      :: central_lat<a name='3854'>
  real                     ,intent(in)      :: central_lon<a name='3855'>
  integer                  ,intent(in)      :: wrf_projection<a name='3856'>
  real                     ,intent(in)      :: latin1<a name='3857'>
  real                     ,intent(in)      :: latin2<a name='3858'>
  integer                  ,intent(in)      :: nx<a name='3859'>
  integer                  ,intent(in)      :: ny<a name='3860'>
  real                     ,intent(in)      :: dx<a name='3861'>
  real                     ,intent(in)      :: dy<a name='3862'>
  real                     ,intent(in)      :: center_lat<a name='3863'>
  real                     ,intent(in)      :: center_lon<a name='3864'>
  integer                  ,intent(out)     :: ierr<a name='3865'>
  character*(*)            ,intent(out)     :: msg<a name='3866'>
  integer, dimension(5)                     :: igds<a name='3867'>
  integer, parameter                        :: igdstmplen = 25<a name='3868'>
  integer, dimension(igdstmplen)            :: igdstmpl<a name='3869'>
  integer, parameter                        :: idefnum = 0<a name='3870'>
  integer, dimension(idefnum)               :: ideflist<a name='3871'>
  real                                      :: LLLa, LLLo, URLa, URLo<a name='3872'>
  real                                      :: incrx, incry<a name='3873'>
  real, parameter                           :: deg_to_microdeg = 1e6<a name='3874'>
  real, parameter                           :: km_to_mm = 1e6<a name='3875'>
  real, parameter                           :: km_to_m = 1e3<a name='3876'>
  real, parameter                           :: DEG_TO_RAD = PI/180<a name='3877'>
  real, parameter                           :: RAD_TO_DEG = 180/PI<a name='3878'>
  real, parameter                           :: ERADIUS = 6370.0<a name='3879'>
<a name='3880'>
  igds(1) = 0      <font color=#447700>! Source of grid definition<a name='3881'></font>
  igds(2) = nx*ny  <font color=#447700>! Number of points in grid<a name='3882'></font>
  igds(3) = 0      <font color=#447700>! <a name='3883'></font>
  igds(4) = 0<a name='3884'>
<a name='3885'>
  <font color=#447700>! Here, setup the parameters that are common to all WRF projections<a name='3886'></font>
<a name='3887'>
  igdstmpl(1) = 1       <font color=#447700>! Shape of earth (1 for spherical with specified radius)<a name='3888'></font>
  igdstmpl(2) = 0       <font color=#447700>! Scale factor for earth radius<a name='3889'></font>
  igdstmpl(3) = ERADIUS*km_to_m <font color=#447700>! Radius of earth<a name='3890'></font>
  igdstmpl(4) = 0       <font color=#447700>! Scale factor for major axis<a name='3891'></font>
  igdstmpl(5) = 0       <font color=#447700>! Major axis<a name='3892'></font>
  igdstmpl(6) = 0       <font color=#447700>! Scale factor for minor axis<a name='3893'></font>
  igdstmpl(7) = 0       <font color=#447700>! Minor axis<a name='3894'></font>
  igdstmpl(8) = nx      <font color=#447700>! Number of points along x axis<a name='3895'></font>
  igdstmpl(9) = ny      <font color=#447700>! Number of points along y axis<a name='3896'></font>
  <a name='3897'>
  <font color=#447700>!<a name='3898'></font>
  <font color=#447700>! Setup increments in "x" and "y" direction.  For LATLON projection<a name='3899'></font>
  <font color=#447700>!   increments need to be in degrees.  For all other projections, <a name='3900'></font>
  <font color=#447700>!   increments are in km.<a name='3901'></font>
  <font color=#447700>!<a name='3902'></font>
  if ((wrf_projection .eq. WRF_LATLON) &amp;<a name='3903'>
       .or. (wrf_projection .eq. WRF_CASSINI)) then<a name='3904'>
     incrx = (dx/ERADIUS) * RAD_TO_DEG<a name='3905'>
     incry = (dy/ERADIUS) * RAD_TO_DEG<a name='3906'>
  else<a name='3907'>
     incrx = dx<a name='3908'>
     incry = dy<a name='3909'>
  endif<a name='3910'>
<a name='3911'>
  <font color=#447700>! Latitude and longitude of first (i.e., lower left) grid point<a name='3912'></font>
  call get_ll_latlon(central_lat, central_lon, wrf_projection, &amp;<a name='3913'>
       latin1, latin2, nx, ny, incrx, incry, center_lat, center_lon, &amp;<a name='3914'>
       LLLa, LLLo, URLa, URLo, ierr);<a name='3915'>
<a name='3916'>
  select case (wrf_projection)<a name='3917'>
<a name='3918'>
  case(WRF_LATLON,WRF_CASSINI)<a name='3919'>
     igds(5) = 0<a name='3920'>
     igdstmpl(10) = 0    <font color=#447700>! Basic Angle of init projection (not important to us)<a name='3921'></font>
     igdstmpl(11) = 0    <font color=#447700>! Subdivision of basic angle<a name='3922'></font>
     igdstmpl(12) = LLLa*deg_to_microdeg<a name='3923'>
     igdstmpl(13) = LLLo*deg_to_microdeg<a name='3924'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_1">(igdstmpl(13))<a name='3925'>
     igdstmpl(14) = 128  <font color=#447700>! Resolution and component flags<a name='3926'></font>
     igdstmpl(15) = URLa*deg_to_microdeg<a name='3927'>
     igdstmpl(16) = URLo*deg_to_microdeg<a name='3928'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_2">(igdstmpl(16))<a name='3929'>
<a name='3930'>
     <font color=#447700>! Warning, the following assumes that dx and dy are valid at the equator.<a name='3931'></font>
     <font color=#447700>!    It is not clear in WRF where dx and dy are valid for latlon projections<a name='3932'></font>
     igdstmpl(17) = incrx*deg_to_microdeg <font color=#447700>! i-direction increment in micro degs<a name='3933'></font>
     igdstmpl(18) = incry*deg_to_microdeg <font color=#447700>! j-direction increment in micro degs<a name='3934'></font>
<a name='3935'>
     igdstmpl(19) = 64   <font color=#447700>! Scanning mode<a name='3936'></font>
  case(WRF_MERCATOR)<a name='3937'>
     igds(5) = 10<a name='3938'>
     igdstmpl(10) = LLLa*deg_to_microdeg<a name='3939'>
     igdstmpl(11) = LLLo*deg_to_microdeg<a name='3940'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_3">(igdstmpl(11))<a name='3941'>
     igdstmpl(12) = 128  <font color=#447700>! Resolution and component flags<a name='3942'></font>
     igdstmpl(13) = latin1*deg_to_microdeg  <font color=#447700>! "True" latitude<a name='3943'></font>
     igdstmpl(14) = URLa*deg_to_microdeg<a name='3944'>
     igdstmpl(15) = URLo*deg_to_microdeg<a name='3945'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_4">(igdstmpl(15))<a name='3946'>
     igdstmpl(16) = 64   <font color=#447700>! Scanning mode<a name='3947'></font>
     igdstmpl(17) = 0    <font color=#447700>! Orientation of grid between i-direction and equator<a name='3948'></font>
     igdstmpl(18) = dx*km_to_mm   <font color=#447700>! i-direction increment<a name='3949'></font>
     igdstmpl(19) = dy*km_to_mm   <font color=#447700>! j-direction increment<a name='3950'></font>
  case(WRF_LAMBERT)<a name='3951'>
     igds(5) = 30<a name='3952'>
     <a name='3953'>
     igdstmpl(10) = LLLa*deg_to_microdeg<a name='3954'>
     igdstmpl(11) = LLLo*deg_to_microdeg<a name='3955'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_5">(igdstmpl(11))<a name='3956'>
     igdstmpl(12) = 128 <font color=#447700>! Resolution and component flag<a name='3957'></font>
     igdstmpl(13) = latin1*deg_to_microdeg <font color=#447700>! Latitude where Dx and Dy are specified<a name='3958'></font>
     igdstmpl(14) = central_lon*deg_to_microdeg<a name='3959'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_6">(igdstmpl(14))<a name='3960'>
     igdstmpl(15) = dx*km_to_mm  <font color=#447700>! x-dimension grid-spacing  in units of m^-3<a name='3961'></font>
     igdstmpl(16) = dy*km_to_mm<a name='3962'>
     if (center_lat .lt. 0) then<a name='3963'>
        igdstmpl(17) = 1<a name='3964'>
     else<a name='3965'>
        igdstmpl(17) = 0<a name='3966'>
     endif<a name='3967'>
     igdstmpl(18) = 64   <font color=#447700>! Scanning mode<a name='3968'></font>
     igdstmpl(19) = latin1*deg_to_microdeg<a name='3969'>
     igdstmpl(20) = latin2*deg_to_microdeg<a name='3970'>
     igdstmpl(21) = -90*deg_to_microdeg<a name='3971'>
     igdstmpl(22) = central_lon*deg_to_microdeg<a name='3972'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_7">(igdstmpl(22))<a name='3973'>
<a name='3974'>
  case(WRF_POLAR_STEREO)<a name='3975'>
     igds(5) = 20<a name='3976'>
     igdstmpl(10) = LLLa*deg_to_microdeg<a name='3977'>
     igdstmpl(11) = LLLo*deg_to_microdeg<a name='3978'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_8">(igdstmpl(11))<a name='3979'>
     igdstmpl(12) = 128 <font color=#447700>! Resolution and component flag<a name='3980'></font>
     igdstmpl(13) = latin1*deg_to_microdeg <font color=#447700>! Latitude where Dx and Dy are specified<a name='3981'></font>
     igdstmpl(14) = central_lon*deg_to_microdeg<a name='3982'>
     call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON'>gr2_convert_lon</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CONVERT_LON_9">(igdstmpl(14))<a name='3983'>
     igdstmpl(15) = dx*km_to_mm  <font color=#447700>! x-dimension grid-spacing  in units of m^-3<a name='3984'></font>
     igdstmpl(16) = dy*km_to_mm<a name='3985'>
     if (center_lat .lt. 0) then<a name='3986'>
        igdstmpl(17) = 1<a name='3987'>
     else<a name='3988'>
        igdstmpl(17) = 0<a name='3989'>
     endif<a name='3990'>
     igdstmpl(18) = 64   <font color=#447700>! Scanning mode<a name='3991'></font>
<a name='3992'>
  case default<a name='3993'>
     write(msg,*) 'invalid WRF projection: ',wrf_projection<a name='3994'>
     ierr = -1<a name='3995'>
     return<a name='3996'>
  end select<a name='3997'>
<a name='3998'>
<a name='3999'>
  call addgrid(cgrib,lcgrib,igds,igdstmpl,igdstmplen,ideflist,idefnum,ierr)<a name='4000'>
  if (ierr .ne. 0) then<a name='4001'>
     write(msg,*) 'addgrid failed with ierr: ',ierr<a name='4002'>
  else<a name='4003'>
     msg = ''<a name='4004'>
  endif<a name='4005'>
<a name='4006'>
end subroutine gr2_addgrid_w<a name='4007'>
<a name='4008'>
<font color=#447700>!*****************************************************************************<a name='4009'></font>
<a name='4010'>
<A NAME='GR2_ADDFIELD_W'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDFIELD_W' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4011'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_addfield_w</font>(cgrib, lcgrib, VarName, parmcat, parmnum, DecScl, &amp; <A href='../../call_to/GR2_ADDFIELD_W.html' TARGET='index'>2</A><a name='4012'>
     BinScl, fcst_secs, vert_unit1, vert_unit2, vert_sclFctr1, vert_sclFctr2, &amp;<a name='4013'>
     numlevels, levels, ngrdpts, background_proc_id, forecast_proc_id, &amp;<a name='4014'>
     compression, fld, ierr, msg)<a name='4015'>
  <a name='4016'>
  implicit none<a name='4017'>
<a name='4018'>
  character*(*)            ,intent(inout)   :: cgrib<a name='4019'>
  integer                  ,intent(in)      :: lcgrib<a name='4020'>
  character (LEN=*)        ,intent(in)      :: VarName<a name='4021'>
  integer                  ,intent(in)      :: parmcat,parmnum,DecScl,BinScl<a name='4022'>
  real                     ,intent(in)      :: fcst_secs<a name='4023'>
  integer                  ,intent(in)      :: vert_unit1, vert_unit2<a name='4024'>
  integer                  ,intent(in)      :: vert_sclFctr1, vert_sclFctr2<a name='4025'>
  integer                  ,intent(in)      :: numlevels<a name='4026'>
  integer, dimension(*)    ,intent(in)      :: levels<a name='4027'>
  integer                  ,intent(in)      :: ngrdpts<a name='4028'>
  real                     ,intent(in)      :: fld(ngrdpts)<a name='4029'>
  integer                  ,intent(in)      :: background_proc_id<a name='4030'>
  integer                  ,intent(in)      :: forecast_proc_id<a name='4031'>
  integer                  ,intent(in)      :: compression<a name='4032'>
  integer                  ,intent(out)     :: ierr<a name='4033'>
  character*(*)            ,intent(out)     :: msg<a name='4034'>
  integer                                   :: ipdsnum<a name='4035'>
  integer, parameter                        :: ipdstmplen = 15<a name='4036'>
  integer, dimension(ipdstmplen)            :: ipdstmpl<a name='4037'>
  integer                                   :: numcoord<a name='4038'>
  integer, dimension(numlevels)             :: coordlist<a name='4039'>
  integer                                   :: idrsnum<a name='4040'>
  integer, parameter                        :: idrstmplen = 7<a name='4041'>
  integer, dimension(idrstmplen)            :: idrstmpl<a name='4042'>
  integer                                   :: ibmap<a name='4043'>
  integer, dimension(1)                     :: bmap<a name='4044'>
<a name='4045'>
  if (numlevels .gt. 2) then<a name='4046'>
     ipdsnum = 1000           <font color=#447700>! Product definition tmplate (1000 for cross-sxn)<a name='4047'></font>
  else<a name='4048'>
     ipdsnum = 0              <font color=#447700>! Product definition template (0 for horiz grid)<a name='4049'></font>
  endif<a name='4050'>
<a name='4051'>
  ipdstmpl(1) = parmcat    <font color=#447700>! Parameter category<a name='4052'></font>
  ipdstmpl(2) = parmnum    <font color=#447700>! Parameter number<a name='4053'></font>
  ipdstmpl(3) = 2          <font color=#447700>! Type of generating process (2 for forecast)<a name='4054'></font>
  ipdstmpl(4) = background_proc_id <font color=#447700>! Background generating process id<a name='4055'></font>
  ipdstmpl(5) = forecast_proc_id   <font color=#447700>! Analysis or forecast generating process id<a name='4056'></font>
  ipdstmpl(6) = 0          <font color=#447700>! Data cutoff period (Hours)<a name='4057'></font>
  ipdstmpl(7) = 0          <font color=#447700>! Data cutoff period (minutes)<a name='4058'></font>
  ipdstmpl(8) = 13         <font color=#447700>! Time range indicator (13 for seconds)<a name='4059'></font>
  ipdstmpl(9) = NINT(fcst_secs) <font color=#447700>! Forecast time<a name='4060'></font>
<a name='4061'>
  if (ipdsnum .eq. 1000) then<a name='4062'>
     numcoord = numlevels<a name='4063'>
     coordlist = levels(1:numlevels)<a name='4064'>
<a name='4065'>
     <font color=#447700>!<a name='4066'></font>
     <font color=#447700>! Set Data Representation templ (Use 0 for vertical cross sections,<a name='4067'></font>
     <font color=#447700>!    since there seems to be a bug in g2lib for JPEG2000 and PNG)<a name='4068'></font>
     <font color=#447700>!<a name='4069'></font>
     idrsnum = 0<a name='4070'>
<a name='4071'>
  else if (ipdsnum .eq. 0) then<a name='4072'>
     ipdstmpl(10) = vert_unit1    <font color=#447700>! Type of first surface (111 for Eta level)<a name='4073'></font>
     ipdstmpl(11) = vert_sclFctr1 <font color=#447700>! Scale factor for 1st surface<a name='4074'></font>
     ipdstmpl(12) = levels(1)     <font color=#447700>! First fixed surface<a name='4075'></font>
     ipdstmpl(13) = vert_unit2    <font color=#447700>! Type of second fixed surface<a name='4076'></font>
     ipdstmpl(14) = vert_sclFctr2 <font color=#447700>! Scale factor for 2nd surface<a name='4077'></font>
     if (numlevels .eq. 2) then <a name='4078'>
        ipdstmpl(15) = levels(2)<a name='4079'>
     else<a name='4080'>
        ipdstmpl(15) = 0<a name='4081'>
     endif<a name='4082'>
     numcoord = 0<a name='4083'>
     coordlist(1) = 0<a name='4084'>
<a name='4085'>
     <font color=#447700>! Set Data Representation templ (40 for JPEG2000, 41 for PNG)  <a name='4086'></font>
     idrsnum = compression<a name='4087'>
<a name='4088'>
  endif<a name='4089'>
<a name='4090'>
<a name='4091'>
  if (idrsnum == 40) then    <font color=#447700>! JPEG 2000<a name='4092'></font>
<a name='4093'>
     idrstmpl(1) = 255       <font color=#447700>! Reference value - ignored on input<a name='4094'></font>
     idrstmpl(2) = BinScl    <font color=#447700>! Binary scale factor<a name='4095'></font>
     idrstmpl(3) = DecScl    <font color=#447700>! Decimal scale factor <a name='4096'></font>
     idrstmpl(4) = 0         <font color=#447700>! number of bits for each data value - ignored on input<a name='4097'></font>
     idrstmpl(5) = 0         <font color=#447700>! Original field type - ignored on input<a name='4098'></font>
     idrstmpl(6) = 0         <font color=#447700>! 0 for lossless compression<a name='4099'></font>
     idrstmpl(7) = 255       <font color=#447700>! Desired compression ratio if idrstmpl(6) != 0<a name='4100'></font>
<a name='4101'>
  else if (idrsnum == 41) then <font color=#447700>! PNG<a name='4102'></font>
<a name='4103'>
     idrstmpl(1) = 255       <font color=#447700>! Reference value - ignored on input<a name='4104'></font>
     idrstmpl(2) = BinScl    <font color=#447700>! Binary scale factor<a name='4105'></font>
     idrstmpl(3) = DecScl    <font color=#447700>! Decimal scale factor <a name='4106'></font>
     idrstmpl(4) = 0         <font color=#447700>! number of bits for each data value - ignored on input<a name='4107'></font>
     idrstmpl(5) = 0         <font color=#447700>! Original field type - ignored on input<a name='4108'></font>
<a name='4109'>
  else if (idrsnum == 0) then<font color=#447700>! Simple packing <a name='4110'></font>
<a name='4111'>
     idrstmpl(1) = 255       <font color=#447700>! Reference value - ignored on input<a name='4112'></font>
     idrstmpl(2) = BinScl    <font color=#447700>! Binary scale factor<a name='4113'></font>
     idrstmpl(3) = DecScl    <font color=#447700>! Decimal scale factor <a name='4114'></font>
     idrstmpl(4) = 0         <font color=#447700>! number of bits for each data value - ignored on input<a name='4115'></font>
     idrstmpl(5) = 0         <font color=#447700>! Original field type - ignored on input<a name='4116'></font>
     <a name='4117'>
  else<a name='4118'>
     <a name='4119'>
     write (msg,*) 'addfield failed because Data Representation template',&amp;<a name='4120'>
          idrsnum,' is invalid'<a name='4121'>
     ierr = 1<a name='4122'>
     return<a name='4123'>
<a name='4124'>
  endif<a name='4125'>
<a name='4126'>
  ibmap = 255                <font color=#447700>! Flag for bitmap<a name='4127'></font>
  <a name='4128'>
  call addfield(cgrib, lcgrib, ipdsnum, ipdstmpl, ipdstmplen, coordlist,      &amp;<a name='4129'>
       numcoord, idrsnum, idrstmpl, idrstmplen, fld, ngrdpts, ibmap,          &amp;<a name='4130'>
       bmap, ierr)<a name='4131'>
<a name='4132'>
  if (ierr .ne. 0) then<a name='4133'>
     write(msg,*) 'addfield failed with ierr: ',ierr<a name='4134'>
  else<a name='4135'>
     msg = ''<a name='4136'>
  endif<a name='4137'>
<a name='4138'>
end subroutine gr2_addfield_w<a name='4139'>
<a name='4140'>
<font color=#447700>!*****************************************************************************<a name='4141'></font>
<a name='4142'>
<A NAME='GR2_FILL_LOCAL_USE'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4143'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_fill_local_use</font>(DataHandle,string,VarName,fcsts,msg,status) <A href='../../call_to/GR2_FILL_LOCAL_USE.html' TARGET='index'>3</A>,<A href='../../call_from/GR2_FILL_LOCAL_USE.html' TARGET='index'>12</A><a name='4144'>
<a name='4145'>
  use <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_71"><a name='4146'>
  IMPLICIT NONE<a name='4147'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_81"><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4148'>
<a name='4149'>
  integer,         intent(in)    :: DataHandle<a name='4150'>
  character*(*)   ,intent(inout) :: string<a name='4151'>
  character*(*)   ,intent(in)    :: VarName<a name='4152'>
  integer                        :: center, subcenter, MasterTblV, LocalTblV, &amp;<a name='4153'>
       Disc, Category, ParmNum, DecScl, BinScl<a name='4154'>
  integer         ,intent(out)   :: status<a name='4155'>
  character*(*)   ,intent(out)   :: msg<a name='4156'>
  integer , parameter            :: lcgrib = 1000000<a name='4157'>
  character (lcgrib)             :: cgrib<a name='4158'>
  real, dimension(1,1)           :: data<a name='4159'>
  integer                        :: lengrib<a name='4160'>
  integer                        :: lcsec2<a name='4161'>
  integer                        :: fcsts<a name='4162'>
  integer                        :: bytes_written<a name='4163'>
  <a name='4164'>
  <font color=#447700>! <a name='4165'></font>
  <font color=#447700>! Set data to a default dummy value.<a name='4166'></font>
  <font color=#447700>!<a name='4167'></font>
  data = 1.0<a name='4168'>
<a name='4169'>
  <font color=#447700>!<a name='4170'></font>
  <font color=#447700>! This statement prevents problems when calling addlocal in the grib2<a name='4171'></font>
  <font color=#447700>!   library.  Basically, if addlocal is called with an empty string, it<a name='4172'></font>
  <font color=#447700>!   will be encoded correctly by the grib2 routine, but the grib2 routines<a name='4173'></font>
  <font color=#447700>!   that read the data (i.e., getgb2) will segfault.  This prevents that <a name='4174'></font>
  <font color=#447700>!   segfault.<a name='4175'></font>
  <font color=#447700>!<a name='4176'></font>
<a name='4177'>
  if (string .eq. '') string = 'none'<a name='4178'>
<a name='4179'>
  CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_5">(VarName, center, subcenter, MasterTblV, &amp;<a name='4180'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='4181'>
  if (status .ne. 0) then<a name='4182'>
     write(msg,*) 'Could not find parameter for '//   &amp;<a name='4183'>
          trim(VarName)//'   Skipping output of '//trim(VarName)<a name='4184'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1542">(trim(msg))<a name='4185'>
     Status =  WRF_GRIB2_ERR_GRIB2MAP<a name='4186'>
     return<a name='4187'>
  endif<a name='4188'>
<a name='4189'>
  <font color=#447700>!<a name='4190'></font>
  <font color=#447700>! Create the indicator and identification sections (sections 0 and 1)<a name='4191'></font>
  <font color=#447700>!<a name='4192'></font>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CREATE_W'>gr2_create_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_CREATE_W_2">(StartDate, cgrib, lcgrib, production_status, Disc, &amp;<a name='4193'>
             center, subcenter, MasterTblV, LocalTblV, status, msg)<a name='4194'>
  if (status .ne. 0) then<a name='4195'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1543">(trim(msg))<a name='4196'>
     Status = WRF_GRIB2_ERR_GRIBCREATE<a name='4197'>
     return<a name='4198'>
  endif<a name='4199'>
<a name='4200'>
  <font color=#447700>! <a name='4201'></font>
  <font color=#447700>! Add the local use section<a name='4202'></font>
  <font color=#447700>!<a name='4203'></font>
  lcsec2 = len_trim(string)<a name='4204'>
  call addlocal(cgrib,lcgrib,string,lcsec2,status)<a name='4205'>
  if (status .ne. 0) then<a name='4206'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1544">(trim(msg))<a name='4207'>
     Status = WRF_GRIB2_ERR_ADDLOCAL<a name='4208'>
     return<a name='4209'>
  endif<a name='4210'>
<a name='4211'>
  <font color=#447700>!<a name='4212'></font>
  <font color=#447700>! Add the grid definition section (section 3) using a 1x1 grid<a name='4213'></font>
  <font color=#447700>!<a name='4214'></font>
  call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDGRID_W'>gr2_addgrid_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_ADDGRID_W_2">(cgrib, lcgrib, center_lat, proj_central_lon,  &amp;<a name='4215'>
       wrf_projection, truelat1, truelat2, 1, 1, dx, dy,       &amp;<a name='4216'>
       center_lat, center_lon, status, msg)<a name='4217'>
  if (status .ne. 0) then<a name='4218'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1545">(trim(msg))<a name='4219'>
     Status = WRF_GRIB2_ERR_ADDGRIB<a name='4220'>
     return<a name='4221'>
  endif<a name='4222'>
<a name='4223'>
  <font color=#447700>!<a name='4224'></font>
  <font color=#447700>! Add the Product Definition, Data representation, bitmap <a name='4225'></font>
  <font color=#447700>!      and data sections (sections 4-7)<a name='4226'></font>
  <font color=#447700>!<a name='4227'></font>
  call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADDFIELD_W'>gr2_addfield_w</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_ADDFIELD_W_2">(cgrib, lcgrib, VarName, Category, ParmNum, DecScl, &amp;<a name='4228'>
       BinScl, fcsts, 1, 255, 0, 0, 1, 0, 1, &amp;<a name='4229'>
       background_proc_id, forecast_proc_id, compression, data, status, msg)<a name='4230'>
  if (status .ne. 0) then<a name='4231'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1546">(trim(msg))<a name='4232'>
     Status = WRF_GRIB2_ERR_ADDFIELD<a name='4233'>
     return<a name='4234'>
  endif<a name='4235'>
<a name='4236'>
  <font color=#447700>!<a name='4237'></font>
  <font color=#447700>! Close out the message<a name='4238'></font>
  <font color=#447700>!<a name='4239'></font>
  <a name='4240'>
  call gribend(cgrib,lcgrib,lengrib,status)<a name='4241'>
  if (status .ne. 0) then<a name='4242'>
     write(msg,*) 'gribend failed with status: ',status     <a name='4243'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1547">(trim(msg))<a name='4244'>
     Status = WRF_GRIB2_ERR_GRIBEND<a name='4245'>
     return<a name='4246'>
  endif<a name='4247'>
<a name='4248'>
  <font color=#447700>! <a name='4249'></font>
  <font color=#447700>! Write the data to the file<a name='4250'></font>
  <font color=#447700>!<a name='4251'></font>
  <a name='4252'>
  call bawrite(DataHandle, -1, lengrib, bytes_written, cgrib)<a name='4253'>
<font color=#447700>!!  call write_file_n(fileinfo(DataHandle)%FileFd, cgrib, lengrib, status)<a name='4254'></font>
  if (bytes_written .ne. lengrib) then<a name='4255'>
     write(msg,*) '2 Error writing cgrib to file, wrote: ', &amp;<a name='4256'>
          bytes_written, ' bytes.  Tried to write ', lengrib, ' bytes'<a name='4257'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LOCAL_USE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1548">(trim(msg))<a name='4258'>
     Status = WRF_GRIB2_ERR_WRITE<a name='4259'>
     return<a name='4260'>
  endif<a name='4261'>
<a name='4262'>
  <font color=#447700>! Set string back to the original blank value<a name='4263'></font>
  if (string .eq. '') string = ''<a name='4264'>
<a name='4265'>
  return<a name='4266'>
<a name='4267'>
end subroutine gr2_fill_local_use<a name='4268'>
<a name='4269'>
<font color=#447700>!*****************************************************************************<a name='4270'></font>
<font color=#447700>!<a name='4271'></font>
<font color=#447700>! Set longitude to be in the range of 0-360 degrees.<a name='4272'></font>
<font color=#447700>!<a name='4273'></font>
<font color=#447700>!*****************************************************************************<a name='4274'></font>
<a name='4275'>
<A NAME='GR2_CONVERT_LON'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_CONVERT_LON' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4276'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_convert_lon</font>(value) <A href='../../call_to/GR2_CONVERT_LON.html' TARGET='index'>9</A><a name='4277'>
<a name='4278'>
  IMPLICIT NONE<a name='4279'>
<a name='4280'>
  integer, intent(inout) :: value<a name='4281'>
  real, parameter                           :: deg_to_microdeg = 1e6<a name='4282'>
<a name='4283'>
  do while (value .lt. 0) <a name='4284'>
     value = value + 360*deg_to_microdeg<a name='4285'>
  enddo<a name='4286'>
<a name='4287'>
  do while (value .gt. 360*deg_to_microdeg) <a name='4288'>
     value = value - 360*deg_to_microdeg<a name='4289'>
  enddo<a name='4290'>
<a name='4291'>
end subroutine gr2_convert_lon<a name='4292'>
<a name='4293'>
<a name='4294'>
<font color=#447700>!*****************************************************************************<a name='4295'></font>
<font color=#447700>!<a name='4296'></font>
<font color=#447700>! Add a time to the list of times<a name='4297'></font>
<font color=#447700>!<a name='4298'></font>
<font color=#447700>!*****************************************************************************<a name='4299'></font>
<a name='4300'>
<A NAME='GR2_ADD_TIME'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADD_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4301'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_add_time</font>(DataHandle,addTime) <A href='../../call_to/GR2_ADD_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/GR2_ADD_TIME.html' TARGET='index'>3</A><a name='4302'>
<a name='4303'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADD_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_72"><a name='4304'>
  IMPLICIT NONE<a name='4305'>
<a name='4306'>
  integer           :: DataHandle<a name='4307'>
  character (len=*) :: addTime<a name='4308'>
  integer           :: idx<a name='4309'>
  logical           :: already_have = .false.<a name='4310'>
  logical           :: swap<a name='4311'>
  character (len=len(addTime)) :: tmp<a name='4312'>
  character (DateStrLen), dimension(:),pointer  :: tmpTimes(:)<a name='4313'>
  integer,parameter :: allsize = 50<a name='4314'>
  integer           :: ierr<a name='4315'>
  <a name='4316'>
  already_have = .false.<a name='4317'>
  do idx = 1,fileinfo(DataHandle)%NumberTimes <a name='4318'>
     if (addTime .eq. fileinfo(DataHandle)%Times(idx)) then<a name='4319'>
        already_have = .true.<a name='4320'>
     endif<a name='4321'>
  enddo<a name='4322'>
  <a name='4323'>
  if (.not. already_have) then<a name='4324'>
     fileinfo(DataHandle)%NumberTimes = fileinfo(DataHandle)%NumberTimes + 1<a name='4325'>
<a name='4326'>
     if (fileinfo(DataHandle)%NumberTimes .gt. &amp;<a name='4327'>
          fileinfo(DataHandle)%sizeAllocated) then<a name='4328'>
<a name='4329'>
        if (fileinfo(DataHandle)%NumberTimes .eq. 1) then<a name='4330'>
<a name='4331'>
           if (allocated(fileinfo(DataHandle)%Times)) &amp;<a name='4332'>
                deallocate(fileinfo(DataHandle)%Times)<a name='4333'>
<a name='4334'>
           allocate(fileinfo(DataHandle)%Times(allsize), stat = ierr)<a name='4335'>
           if (ierr .ne. 0) then<a name='4336'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADD_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1549">('Could not allocate space for Times 1, exiting')<a name='4337'>
              stop<a name='4338'>
           endif<a name='4339'>
<a name='4340'>
           fileinfo(DataHandle)%sizeAllocated = allsize<a name='4341'>
<a name='4342'>
        else<a name='4343'>
<a name='4344'>
           allocate(tmpTimes(fileinfo(DataHandle)%NumberTimes), stat=ierr)<a name='4345'>
<a name='4346'>
           tmpTimes = &amp;<a name='4347'>
                fileinfo(DataHandle)%Times(1:fileinfo(DataHandle)%NumberTimes)<a name='4348'>
<a name='4349'>
           deallocate(fileinfo(DataHandle)%Times)<a name='4350'>
<a name='4351'>
           allocate(&amp;<a name='4352'>
                fileinfo(DataHandle)%Times(fileinfo(DataHandle)%sizeAllocated+allsize), stat=ierr)<a name='4353'>
<a name='4354'>
           if (ierr .ne. 0) then<a name='4355'>
              call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_ADD_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1550">('Could not allocate space for Times 2, exiting')<a name='4356'>
              stop<a name='4357'>
           endif<a name='4358'>
<a name='4359'>
           fileinfo(DataHandle)%Times(1:fileinfo(DataHandle)%NumberTimes) = &amp;<a name='4360'>
                tmpTimes<a name='4361'>
<a name='4362'>
           deallocate(tmpTimes)<a name='4363'>
           <a name='4364'>
        endif<a name='4365'>
        <a name='4366'>
     endif<a name='4367'>
<a name='4368'>
     fileinfo(DataHandle)%Times(fileinfo(DataHandle)%NumberTimes) = addTime<a name='4369'>
  <a name='4370'>
     <font color=#447700>! Sort the Times array<a name='4371'></font>
<a name='4372'>
     swap = .true.<a name='4373'>
     do while (swap)<a name='4374'>
        swap = .false.<a name='4375'>
        do idx = 1,fileinfo(DataHandle)%NumberTimes - 1<a name='4376'>
           if (fileinfo(DataHandle)%Times(idx) .gt. fileinfo(DataHandle)%Times(idx+1)) then<a name='4377'>
              tmp = fileinfo(DataHandle)%Times(idx)<a name='4378'>
              fileinfo(DataHandle)%Times(idx) = fileinfo(DataHandle)%Times(idx+1)<a name='4379'>
              fileinfo(DataHandle)%Times(idx+1) = tmp<a name='4380'>
              swap = .true.<a name='4381'>
           endif<a name='4382'>
        enddo<a name='4383'>
     enddo<a name='4384'>
<a name='4385'>
  endif<a name='4386'>
<a name='4387'>
  return<a name='4388'>
<a name='4389'>
end subroutine gr2_add_time<a name='4390'>
<a name='4391'>
<a name='4392'>
<font color=#447700>!*****************************************************************************<a name='4393'></font>
<font color=#447700>!<a name='4394'></font>
<font color=#447700>! Fill an array of levels<a name='4395'></font>
<font color=#447700>!<a name='4396'></font>
<font color=#447700>!*****************************************************************************<a name='4397'></font>
<a name='4398'>
<A NAME='GR2_FILL_LEVELS'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4399'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_fill_levels</font>(DataHandle,VarName,levels,ierr) <A href='../../call_to/GR2_FILL_LEVELS.html' TARGET='index'>4</A>,<A href='../../call_from/GR2_FILL_LEVELS.html' TARGET='index'>6</A><a name='4400'>
<a name='4401'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_73"><a name='4402'>
  USE grib_mod<a name='4403'>
  IMPLICIT NONE<a name='4404'>
<a name='4405'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_82"><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4406'>
<a name='4407'>
<a name='4408'>
  integer            :: DataHandle<a name='4409'>
  character (len=*)  :: VarName<a name='4410'>
  REAL,DIMENSION(*)  :: levels<a name='4411'>
  integer            :: ierr<a name='4412'>
  integer :: JIDS(JIDSSIZE), JPDTN, JPDT(JPDTSIZE), JGDTN, &amp;<a name='4413'>
       JGDT(JGDTSIZE)<a name='4414'>
  type(gribfield)    :: gfld<a name='4415'>
  integer            :: status, fields_to_skip<a name='4416'>
  logical            :: unpack<a name='4417'>
  integer            :: center, subcenter, MasterTblV, LocalTblV, &amp;<a name='4418'>
       Disc, Category, ParmNum, DecScl, BinScl<a name='4419'>
  CHARACTER (LEN=maxMsgSize) :: msg<a name='4420'>
<a name='4421'>
<a name='4422'>
  CALL <A href='../../html_code/io_grib2/read_grib2map.F.html#GET_PARMINFO'>get_parminfo</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_PARMINFO_6">(VarName, center, subcenter, MasterTblV, &amp;<a name='4423'>
       LocalTblV, Disc, Category, ParmNum, DecScl, BinScl, status)<a name='4424'>
  if (status .ne. 0) then<a name='4425'>
     write(msg,*) 'Could not find parameter for '//   &amp;<a name='4426'>
          trim(VarName)//'   Skipping output of '//trim(VarName)<a name='4427'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1551">(trim(msg))<a name='4428'>
     ierr = -1<a name='4429'>
     return<a name='4430'>
  endif<a name='4431'>
<a name='4432'>
<a name='4433'>
  <font color=#447700>!<a name='4434'></font>
  <font color=#447700>! First, set all values to wild, then specify necessary values<a name='4435'></font>
  <font color=#447700>!<a name='4436'></font>
  call <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD'>gr2_g2lib_wildcard</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_G2LIB_WILDCARD_4">(JIDS, JPDT, JGDT)<a name='4437'>
<a name='4438'>
  JIDS(1) = center<a name='4439'>
  JIDS(2) = subcenter<a name='4440'>
  JIDS(3) = MasterTblV<a name='4441'>
  JIDS(4) = LocalTblV<a name='4442'>
  JIDS(5) = 1           <font color=#447700>! Indicates that time is "Start of Forecast"<a name='4443'></font>
  JIDS(13) = 1          <font color=#447700>! Type of processed data (1 for forecast products)<a name='4444'></font>
  <a name='4445'>
  JPDTN = 1000          <font color=#447700>! Product definition template number<a name='4446'></font>
  JPDT(1) = Category<a name='4447'>
  JPDT(2) = ParmNum<a name='4448'>
  JPDT(3) = 2           <font color=#447700>! Generating process id<a name='4449'></font>
<a name='4450'>
  JGDTN    = -1         <font color=#447700>! Indicates that any Grid Display Template is a match<a name='4451'></font>
  <a name='4452'>
  UNPACK   = .TRUE.     <font color=#447700>! Unpack bitmap and data values<a name='4453'></font>
<a name='4454'>
<a name='4455'>
  fields_to_skip = 0<a name='4456'>
<a name='4457'>
  CALL GETGB2(DataHandle, 0, fields_to_skip, -1, Disc, JIDS, JPDTN, &amp;<a name='4458'>
       JPDT, JGDTN, JGDT, UNPACK, fileinfo(DataHandle)%recnum, &amp;<a name='4459'>
       gfld, status)<a name='4460'>
  if (status .eq. 99) then<a name='4461'>
     write(msg,*)'Could not find field '//trim(VarName)//&amp;<a name='4462'>
          ' continuing.'<a name='4463'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1552">(trim(msg))<a name='4464'>
     ierr = -1<a name='4465'>
     return<a name='4466'>
  else if (status .ne. 0) then<a name='4467'>
     write(msg,*)'Retrieving scalar data field '//trim(VarName)//&amp;<a name='4468'>
          ' failed, continuing.'<a name='4469'>
     call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_FILL_LEVELS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_1553">(trim(msg))<a name='4470'>
     ierr = -1<a name='4471'>
     return<a name='4472'>
  endif<a name='4473'>
  <a name='4474'>
  levels(1:gfld%ndpts) = gfld%fld(1:gfld%ndpts)<a name='4475'>
  ierr = 0<a name='4476'>
  <a name='4477'>
end subroutine gr2_fill_levels<a name='4478'>
<a name='4479'>
<a name='4480'>
<font color=#447700>!*****************************************************************************<a name='4481'></font>
<font color=#447700>!<a name='4482'></font>
<font color=#447700>! Set values for search array arguments for getgb2 to missing.<a name='4483'></font>
<font color=#447700>!<a name='4484'></font>
<font color=#447700>!*****************************************************************************<a name='4485'></font>
<a name='4486'>
<A NAME='GR2_G2LIB_WILDCARD'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4487'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_g2lib_wildcard</font>(JIDS, JPDT, JGDT) <A href='../../call_to/GR2_G2LIB_WILDCARD.html' TARGET='index'>4</A>,<A href='../../call_from/GR2_G2LIB_WILDCARD.html' TARGET='index'>1</A><a name='4488'>
<a name='4489'>
  USE <A href='../../html_code/io_grib2/io_grib2.F.html#GR2_DATA_INFO'>gr2_data_info</A><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_G2LIB_WILDCARD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GR2_DATA_INFO_74"><a name='4490'>
  integer :: JIDS(*), JPDT(*), JGDT(*)<a name='4491'>
<a name='4492'>
  do idx = 1,JIDSSIZE<a name='4493'>
     JIDS(idx) = -9999<a name='4494'>
  enddo<a name='4495'>
  <a name='4496'>
  do idx=1,JPDTSIZE<a name='4497'>
     JPDT(idx) = -9999<a name='4498'>
  enddo<a name='4499'>
  <a name='4500'>
  do idx = 1,JGDTSIZE<a name='4501'>
     JGDT(idx) = -9999<a name='4502'>
  enddo<a name='4503'>
<a name='4504'>
  return<a name='4505'>
<a name='4506'>
end subroutine gr2_g2lib_wildcard<a name='4507'>
<font color=#447700>!*****************************************************************************<a name='4508'></font>
<font color=#447700>!<a name='4509'></font>
<font color=#447700>! Retrieve a metadata value from the input string<a name='4510'></font>
<font color=#447700>!<a name='4511'></font>
<font color=#447700>!*****************************************************************************<a name='4512'></font>
<a name='4513'>
<A NAME='GR2_GET_METADATA_VALUE'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_GET_METADATA_VALUE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4514'>
<font color=#993300>subroutine </font><font color=#cc0000>gr2_get_metadata_value</font>(instring, Key, Value, stat) <A href='../../call_to/GR2_GET_METADATA_VALUE.html' TARGET='index'>27</A><a name='4515'>
  character(len=*),intent(in)  :: instring<a name='4516'>
  character(len=*),intent(in)  :: Key<a name='4517'>
  character(len=*),intent(out) :: Value<a name='4518'>
  integer         ,intent(out) :: stat<a name='4519'>
  integer :: Key_pos, equals_pos, line_end<a name='4520'>
  character :: lf<a name='4521'>
<a name='4522'>
  lf=char(10)<a name='4523'>
<a name='4524'>
  Value = 'abc'<a name='4525'>
<a name='4526'>
  <font color=#447700>!<a name='4527'></font>
  <font color=#447700>! Find Starting position of Key<a name='4528'></font>
  <font color=#447700>!<a name='4529'></font>
  Key_pos = index(instring, lf//' '//Key//' =')<a name='4530'>
  if (Key_pos .eq. 0) then<a name='4531'>
     stat = -1<a name='4532'>
     return<a name='4533'>
  endif<a name='4534'>
<a name='4535'>
  <font color=#447700>!<a name='4536'></font>
  <font color=#447700>! Find position of the "=" after the Key<a name='4537'></font>
  <font color=#447700>!<a name='4538'></font>
  equals_pos = index(instring(Key_pos:len(instring)), "=") + Key_pos<a name='4539'>
  if (equals_pos .eq. Key_pos) then<a name='4540'>
     stat = -1<a name='4541'>
     return<a name='4542'>
  endif<a name='4543'>
<a name='4544'>
  <font color=#447700>!<a name='4545'></font>
  <font color=#447700>! Find end of line<a name='4546'></font>
  <font color=#447700>!<a name='4547'></font>
  line_end = index(instring(equals_pos:len(instring)), lf) + equals_pos<a name='4548'>
<a name='4549'>
  <font color=#447700>!<a name='4550'></font>
  <font color=#447700>! Handle the case for the last line in the string<a name='4551'></font>
  <font color=#447700>!<a name='4552'></font>
  if (line_end .eq. equals_pos) then<a name='4553'>
     line_end = len(trim(instring))<a name='4554'>
  endif<a name='4555'>
<a name='4556'>
  <font color=#447700>!<a name='4557'></font>
  <font color=#447700>! Set value<a name='4558'></font>
  <font color=#447700>!<a name='4559'></font>
  if ( (equals_pos + 1) .le. (line_end - 2) ) then<a name='4560'>
     Value = trim(adjustl(instring(equals_pos+1:line_end-2)))<a name='4561'>
  else<a name='4562'>
     Value = ""<a name='4563'>
  endif<a name='4564'>
  <a name='4565'>
  stat = 0<a name='4566'>
  <a name='4567'>
<a name='4568'>
end subroutine gr2_get_metadata_value<a name='4569'>
<a name='4570'>
<font color=#447700>!*****************************************************************************<a name='4571'></font>
<font color=#447700>!<a name='4572'></font>
<font color=#447700>! Build onto a metadata string with the input value<a name='4573'></font>
<font color=#447700>!<a name='4574'></font>
<font color=#447700>!*****************************************************************************<a name='4575'></font>
<a name='4576'>
<A NAME='GR2_BUILD_STRING'><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4577'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>gr2_build_string</font> (string, Element, Value, Count, Status) <A href='../../call_to/GR2_BUILD_STRING.html' TARGET='index'>25</A><a name='4578'>
<a name='4579'>
  IMPLICIT NONE<a name='4580'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_83"><A href='../../html_code/io_grib2/io_grib2.F.html#GR2_BUILD_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='4581'>
<a name='4582'>
  CHARACTER (LEN=*) , INTENT(INOUT) :: string<a name='4583'>
  CHARACTER (LEN=*) , INTENT(IN)    :: Element<a name='4584'>
  CHARACTER (LEN=*) , INTENT(IN)    :: Value(*)<a name='4585'>
  INTEGER ,           INTENT(IN)    :: Count<a name='4586'>
  INTEGER ,           INTENT(OUT)   :: Status<a name='4587'>
<a name='4588'>
  CHARACTER (LEN=2)                 :: lf<a name='4589'>
  INTEGER                           :: IDX<a name='4590'>
<a name='4591'>
  lf=char(10)//' '<a name='4592'>
<a name='4593'>
  if (index(string,lf//Element//' =') .gt. 0) then<a name='4594'>
     <font color=#447700>! We do nothing, since we dont want to add the same variable twice.<a name='4595'></font>
  else <a name='4596'>
     if (len_trim(string) == 0) then<a name='4597'>
        string = lf//Element//' = '<a name='4598'>
     else<a name='4599'>
        string = trim(string)//lf//Element//' = '<a name='4600'>
     endif<a name='4601'>
     do idx = 1,Count<a name='4602'>
        if (idx &gt; 1) then<a name='4603'>
           string = trim(string)//','<a name='4604'>
        endif<a name='4605'>
        string = trim(string)//' '//trim(adjustl(Value(idx)))<a name='4606'>
     enddo<a name='4607'>
  endif<a name='4608'>
<a name='4609'>
  Status = WRF_NO_ERR<a name='4610'>
<a name='4611'>
END SUBROUTINE gr2_build_string<a name='4612'>
<a name='4613'>
</pre></body></html>