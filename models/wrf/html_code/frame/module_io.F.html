<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:DRIVER_LAYER:IO<a name='2'></font>
<font color=#447700>!<a name='3'></font>
#define DEBUG_LVL 500<a name='4'>
<a name='5'>
<A NAME='MODULE_IO'><A href='../../html_code/frame/module_io.F.html#MODULE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='6'>
<font color=#993300>MODULE </font><font color=#cc0000>module_io</font> <A href='../../call_to/MODULE_IO.html' TARGET='index'>22</A><a name='7'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='8'></font>
<font color=#447700>!&lt;PRE&gt;<a name='9'></font>
<font color=#447700>! WRF-specific package-independent interface to package-dependent WRF-specific<a name='10'></font>
<font color=#447700>! I/O packages.<a name='11'></font>
<font color=#447700>!<a name='12'></font>
<font color=#447700>! These routines have the same names as those specified in the WRF I/O API <a name='13'></font>
<font color=#447700>! except that:<a name='14'></font>
<font color=#447700>! - Routines defined in this file and called by users of this module have <a name='15'></font>
<font color=#447700>!   the "wrf_" prefix.  <a name='16'></font>
<font color=#447700>! - Routines defined in the I/O packages and called from routines in this <a name='17'></font>
<font color=#447700>!   file have the "ext_" prefix.  <a name='18'></font>
<font color=#447700>! - Routines called from routines in this file to initiate communication <a name='19'></font>
<font color=#447700>!   with I/O quilt servers have the "wrf_quilt_" prefix.  <a name='20'></font>
<font color=#447700>!<a name='21'></font>
<font color=#447700>! See http://www.mmm.ucar.edu/wrf/WG2/software_2.0/IOAPI.doc for the latest <a name='22'></font>
<font color=#447700>! version of the WRF I/O API.  This document includes detailed descriptions <a name='23'></font>
<font color=#447700>! of subroutines and their arguments that are not duplicated in this file.  <a name='24'></font>
<font color=#447700>!<a name='25'></font>
<font color=#447700>! We wish to be able to link to different packages depending on whether<a name='26'></font>
<font color=#447700>! the I/O is restart, initial, history, or boundary.  <a name='27'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='28'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='29'></font>
<a name='30'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#module_io.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_101"><a name='31'>
<a name='32'>
  LOGICAL :: is_inited = .FALSE.<a name='33'>
  INTEGER, PARAMETER, PRIVATE :: MAX_WRF_IO_HANDLE = 1000<a name='34'>
  INTEGER :: wrf_io_handles(MAX_WRF_IO_HANDLE)<a name='35'>
  INTEGER :: how_opened(MAX_WRF_IO_HANDLE) <a name='36'>
  LOGICAL :: for_output(MAX_WRF_IO_HANDLE), first_operation(MAX_WRF_IO_HANDLE)<a name='37'>
  INTEGER :: filtno = 0<a name='38'>
  LOGICAL, PRIVATE :: bdy_dist_flag = .TRUE.   <font color=#447700>! false is old style undecomposed boundary data structs,<a name='39'></font>
                                                <font color=#447700>! true is new style decomposed boundary data structs<a name='40'></font>
                                                <font color=#447700>! are_bdys_distributed, bdys_are_distributed and<a name='41'></font>
                                                <font color=#447700>! bdys_not_distributed routines access this flag<a name='42'></font>
  CHARACTER*256 extradims<a name='43'>
<a name='44'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='45'></font>
<font color=#447700>!&lt;PRE&gt;<a name='46'></font>
<font color=#447700>!<a name='47'></font>
<font color=#447700>! include the file generated from md_calls.m4 using the m4 preprocessor<a name='48'></font>
<font color=#447700>! note that this file also includes the CONTAINS declaration for the module<a name='49'></font>
<font color=#447700>!<a name='50'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='51'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='52'></font>
#include "<A href='../../html_code/include/md_calls.inc.html'>md_calls.inc</A>"<A NAME="md_calls.inc_1"><A href='../../html_code/frame/module_io.F.html#module_io.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='53'>
<a name='54'>
<font color=#447700>!--- registry-generated routine that gets the io format being used for a dataset<a name='55'></font>
<a name='56'>
<A NAME='IO_FORM_FOR_DATASET'><A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_DATASET' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='57'>
  INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>io_form_for_dataset</font> ( DataSet ) <A href='../../call_to/IO_FORM_FOR_DATASET.html' TARGET='index'>3</A><a name='58'>
    IMPLICIT NONE<a name='59'>
    CHARACTER*(*), INTENT(IN)  :: DataSet<a name='60'>
    INTEGER                    :: io_form <a name='61'>
#include "<A href='../../html_code/include/io_form_for_dataset.inc.html'>io_form_for_dataset.inc</A>"<A NAME="io_form_for_dataset.inc_2"><A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_DATASET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='62'>
    io_form_for_dataset = io_form<a name='63'>
    RETURN<a name='64'>
  END FUNCTION io_form_for_dataset<a name='65'>
<a name='66'>
<A NAME='IO_FORM_FOR_STREAM'><A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_STREAM' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='67'>
  INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>io_form_for_stream</font> ( stream ) <A href='../../call_to/IO_FORM_FOR_STREAM.html' TARGET='index'>1</A>,<A href='../../call_from/IO_FORM_FOR_STREAM.html' TARGET='index'>1</A><a name='68'>
    USE <A href='../../html_code/frame/module_streams.F.html#MODULE_STREAMS'>module_streams</A><A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_STREAM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STREAMS_2"><a name='69'>
    IMPLICIT NONE<a name='70'>
    INTEGER,       INTENT(IN)  :: stream<a name='71'>
    INTEGER                    :: io_form <a name='72'>
#include "<A href='../../html_code/include/io_form_for_stream.inc.html'>io_form_for_stream.inc</A>"<A NAME="io_form_for_stream.inc_3"><A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_STREAM' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='73'>
    io_form_for_stream = io_form<a name='74'>
    RETURN<a name='75'>
  END FUNCTION io_form_for_stream<a name='76'>
<a name='77'>
<font color=#447700>!--- ioinit<a name='78'></font>
<a name='79'>
<A NAME='WRF_IOINIT'><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='80'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioinit</font>( Status ) <A href='../../call_to/WRF_IOINIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_IOINIT.html' TARGET='index'>6</A><a name='81'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='82'></font>
<font color=#447700>!&lt;PRE&gt;<a name='83'></font>
<font color=#447700>! Initialize the WRF I/O system.<a name='84'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='85'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='86'></font>
  IMPLICIT NONE<a name='87'>
  INTEGER, INTENT(INOUT) :: Status<a name='88'>
<font color=#447700>!Local<a name='89'></font>
  CHARACTER(len=80) :: SysDepInfo<a name='90'>
  INTEGER :: ierr(100), minerr, maxerr<a name='91'>
<font color=#447700>!<a name='92'></font>
  Status = 0<a name='93'>
  ierr = 0<a name='94'>
  SysDepInfo = " "<a name='95'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_246">( DEBUG_LVL, 'module_io.F: in wrf_ioinit' )<a name='96'>
  CALL <A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES'>init_io_handles</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_IO_HANDLES_1">    <font color=#447700>! defined below<a name='97'></font>
#ifdef NETCDF<a name='98'>
  if ( model_config_rec%use_netcdf_classic ) SysDepInfo="use_netcdf_classic"<a name='99'>
  CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_IOINIT'>ext_ncd_ioinit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_IOINIT_1">  ( SysDepInfo, ierr( 1) )<a name='100'>
  SysDepInfo = " "<a name='101'>
#endif<a name='102'>
#ifdef INTIO<a name='103'>
  CALL ext_int_ioinit  ( SysDepInfo, ierr( 2) )<a name='104'>
#endif<a name='105'>
#ifdef PHDF5<a name='106'>
  CALL ext_phdf5_ioinit( SysDepInfo, ierr( 3) )<a name='107'>
#endif<a name='108'>
#ifdef MCELIO<a name='109'>
  CALL ext_mcel_ioinit ( SysDepInfo, ierr( 4) )<a name='110'>
#endif<a name='111'>
#ifdef XXX<a name='112'>
  CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOINIT'>ext_xxx_ioinit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOINIT_1">  ( SysDepInfo, ierr( 5) )<a name='113'>
#endif<a name='114'>
#ifdef YYY<a name='115'>
  CALL ext_yyy_ioinit  ( SysDepInfo, ierr( 6) )<a name='116'>
#endif<a name='117'>
#ifdef ZZZ<a name='118'>
  CALL ext_zzz_ioinit  ( SysDepInfo, ierr( 7) )<a name='119'>
#endif<a name='120'>
#ifdef ESMFIO<a name='121'>
  CALL ext_esmf_ioinit ( SysDepInfo, ierr( 8) )<a name='122'>
#endif<a name='123'>
#ifdef GRIB1<a name='124'>
  CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_IOINIT'>ext_gr1_ioinit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_IOINIT_1">  ( SysDepInfo, ierr( 9) )<a name='125'>
#endif<a name='126'>
#ifdef GRIB2<a name='127'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOINIT'>ext_gr2_ioinit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOINIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_IOINIT_1">  ( SysDepInfo, ierr(10) )<a name='128'>
#endif<a name='129'>
#ifdef PNETCDF<a name='130'>
  CALL ext_pnc_ioinit  ( SysDepInfo, ierr(11) )<a name='131'>
#endif<a name='132'>
#ifdef PIO<a name='133'>
  CALL ext_pio_ioinit  ( SysDepInfo, ierr(12) )<a name='134'>
#endif<a name='135'>
  minerr = MINVAL(ierr)<a name='136'>
  maxerr = MAXVAL(ierr)<a name='137'>
  IF ( minerr &lt; 0 ) THEN<a name='138'>
    Status = minerr<a name='139'>
  ELSE IF ( maxerr &gt; 0 ) THEN<a name='140'>
    Status = maxerr<a name='141'>
  ELSE<a name='142'>
    Status = 0<a name='143'>
  ENDIF<a name='144'>
END SUBROUTINE wrf_ioinit<a name='145'>
<a name='146'>
<font color=#447700>!--- ioexit<a name='147'></font>
<a name='148'>
<A NAME='WRF_IOEXIT'><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='149'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioexit</font>( Status ) <A href='../../call_to/WRF_IOEXIT.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_IOEXIT.html' TARGET='index'>6</A><a name='150'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='151'></font>
<font color=#447700>!&lt;PRE&gt;<a name='152'></font>
<font color=#447700>! Shut down the WRF I/O system.  <a name='153'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='154'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='155'></font>
  IMPLICIT NONE<a name='156'>
  INTEGER, INTENT(INOUT) :: Status<a name='157'>
<font color=#447700>!Local<a name='158'></font>
  LOGICAL, EXTERNAL :: use_output_servers<a name='159'>
  INTEGER :: ierr(100), minerr, maxerr<a name='160'>
<font color=#447700>!<a name='161'></font>
  Status = 0<a name='162'>
  ierr = 0<a name='163'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_247">( DEBUG_LVL, 'module_io.F: in wrf_ioexit' )<a name='164'>
#ifdef NETCDF<a name='165'>
  CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_IOEXIT'>ext_ncd_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_IOEXIT_1">  ( ierr( 1) )<a name='166'>
#endif<a name='167'>
#ifdef INTIO<a name='168'>
  CALL ext_int_ioexit  ( ierr( 2) )<a name='169'>
#endif<a name='170'>
#ifdef PHDF5<a name='171'>
  CALL ext_phdf5_ioexit( ierr( 3) )<a name='172'>
#endif<a name='173'>
#ifdef MCELIO<a name='174'>
  CALL ext_mcel_ioexit ( ierr( 4) )<a name='175'>
#endif<a name='176'>
#ifdef XXX<a name='177'>
  CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOEXIT'>ext_xxx_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOEXIT_1">  ( ierr( 5) )<a name='178'>
#endif<a name='179'>
#ifdef YYY<a name='180'>
  CALL ext_yyy_ioexit  ( ierr( 6) )<a name='181'>
#endif<a name='182'>
#ifdef ZZZ<a name='183'>
  CALL ext_zzz_ioexit  ( ierr( 7) )<a name='184'>
#endif<a name='185'>
#ifdef ESMFIO<a name='186'>
  CALL ext_esmf_ioexit ( ierr( 8) )<a name='187'>
#endif<a name='188'>
#ifdef GRIB1<a name='189'>
  CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_IOEXIT'>ext_gr1_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_IOEXIT_1">  ( ierr( 9) )<a name='190'>
#endif<a name='191'>
#ifdef GRIB2<a name='192'>
  CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOEXIT'>ext_gr2_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_IOEXIT_1">  ( ierr(10) )<a name='193'>
#endif<a name='194'>
#ifdef PNETCDF<a name='195'>
  CALL ext_pnc_ioexit  ( ierr(11) )<a name='196'>
#endif<a name='197'>
#ifdef PIO<a name='198'>
  CALL ext_pio_ioexit  ( ierr(12) )<a name='199'>
#endif<a name='200'>
 <a name='201'>
  IF ( use_output_servers() ) THEN<a name='202'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_IOEXIT'>wrf_quilt_ioexit</A><A href='../../html_code/frame/module_io.F.html#WRF_IOEXIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOEXIT_1">( ierr(11) )<a name='203'>
  ENDIF<a name='204'>
  minerr = MINVAL(ierr)<a name='205'>
  maxerr = MAXVAL(ierr)<a name='206'>
  IF ( minerr &lt; 0 ) THEN<a name='207'>
    Status = minerr<a name='208'>
  ELSE IF ( maxerr &gt; 0 ) THEN<a name='209'>
    Status = maxerr<a name='210'>
  ELSE<a name='211'>
    Status = 0<a name='212'>
  ENDIF<a name='213'>
END SUBROUTINE wrf_ioexit<a name='214'>
<a name='215'>
<font color=#447700>!--- open_for_write_begin<a name='216'></font>
<a name='217'>
<A NAME='WRF_OPEN_FOR_WRITE_BEGIN'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='218'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_write_begin</font>( FileName , grid, SysDepInfo, &amp; <A href='../../call_to/WRF_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_WRITE_BEGIN.html' TARGET='index'>37</A><a name='219'>
                                     DataHandle , Status )<a name='220'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='221'></font>
<font color=#447700>!&lt;PRE&gt;<a name='222'></font>
<font color=#447700>! Begin data definition ("training") phase for writing to WRF dataset <a name='223'></font>
<font color=#447700>! FileName.  <a name='224'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='225'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='226'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_65"><a name='227'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_156"><a name='228'>
#ifdef DM_PARALLEL<a name='229'>
  USE <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_125">, ONLY :  ntasks_x, mytask_x, local_communicator_x<a name='230'>
#endif<a name='231'>
  IMPLICIT NONE<a name='232'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_4"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='233'>
  CHARACTER*(*) :: FileName<a name='234'>
  type(domain)                :: grid<a name='235'>
  CHARACTER*(*), INTENT(INOUT):: SysDepInfo<a name='236'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='237'>
  INTEGER ,       INTENT(OUT) :: Status<a name='238'>
 <font color=#447700>!Local <a name='239'></font>
  CHARACTER*128               :: DataSet<a name='240'>
  INTEGER                     :: io_form<a name='241'>
  INTEGER                     :: Hndl<a name='242'>
  INTEGER, EXTERNAL           :: use_package<a name='243'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files<a name='244'>
  LOGICAL, EXTERNAL :: use_output_servers_for<a name='245'>
  CHARACTER*512     :: LocFilename   <font color=#447700>! for appending the process ID if necessary<a name='246'></font>
  INTEGER           :: myproc<a name='247'>
  CHARACTER*512     :: mess<a name='248'>
  CHARACTER*1028    :: tstr, t1<a name='249'>
  INTEGER           :: i,j<a name='250'>
  INTEGER           :: Comm_compute , Comm_io<a name='251'>
  LOGICAL ncd_nofill<a name='252'>
<a name='253'>
  WRITE(mess,*) 'module_io.F: in wrf_open_for_write_begin, FileName = ',TRIM(FileName)<a name='254'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_248">( 100, mess )<a name='255'>
<a name='256'>
  Comm_compute = grid%communicator<a name='257'>
  Comm_io = grid%iocommunicator<a name='258'>
<a name='259'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_1"> ( "DATASET" , SysDepInfo , DataSet )<a name='260'>
<a name='261'>
  CALL nl_get_ncd_nofill( 1 , ncd_nofill )<a name='262'>
<a name='263'>
  io_form = <A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_DATASET'>io_form_for_dataset</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IO_FORM_FOR_DATASET_1">( DataSet )<a name='264'>
<a name='265'>
  Status = 0<a name='266'>
  Hndl = -1<a name='267'>
  IF ( .not. use_output_servers_for(io_form) ) THEN<a name='268'>
    SELECT CASE ( use_package(io_form) )<a name='269'>
#ifdef NETCDF<a name='270'>
      CASE ( IO_NETCDF   )<a name='271'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='272'>
          IF ( multi_files(io_form) ) THEN<a name='273'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_21"> ( myproc )<a name='274'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_1"> ( LocFilename , FileName , myproc, 4 )<a name='275'>
          ELSE<a name='276'>
            LocFilename = FileName<a name='277'>
          ENDIF<a name='278'>
          IF ( ncd_nofill ) THEN<a name='279'>
            CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_WRITE_BEGIN'>ext_ncd_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_WRITE_BEGIN_1"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo // ",NOFILL=.TRUE.", &amp;<a name='280'>
                                                Hndl , Status )<a name='281'>
          ELSE<a name='282'>
            CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_WRITE_BEGIN'>ext_ncd_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_WRITE_BEGIN_2"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='283'>
                                                Hndl , Status )<a name='284'>
          ENDIF<a name='285'>
        ENDIF<a name='286'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='287'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_9">( Hndl, IWORDSIZE )<a name='288'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_10">( Status, IWORDSIZE )<a name='289'>
        ENDIF<a name='290'>
#endif<a name='291'>
#ifdef PHDF5<a name='292'>
      CASE (IO_PHDF5  )<a name='293'>
        CALL ext_phdf5_open_for_write_begin( FileName, Comm_compute, Comm_io, SysDepInfo, &amp;<a name='294'>
                                            Hndl, Status)<a name='295'>
#endif<a name='296'>
#ifdef PNETCDF<a name='297'>
      CASE (IO_PNETCDF  )<a name='298'>
        WRITE(tstr,"(A,',NTASKS_X=',i10,',MYTASK_X=',i10,',LOCAL_COMMUNICATOR_X=',i10)") &amp;<a name='299'>
              TRIM(SysDepInfo),ntasks_x,mytask_x,local_communicator_x<a name='300'>
        j=1<a name='301'>
        t1 = " "<a name='302'>
        DO i=1,len(TRIM(tstr))<a name='303'>
          IF ( tstr(i:i) .NE. ' ' ) THEN<a name='304'>
            t1(j:j) = tstr(i:i)<a name='305'>
            j = j + 1<a name='306'>
          ENDIF<a name='307'>
        ENDDO<a name='308'>
        tstr = t1<a name='309'>
        CALL ext_pnc_open_for_write_begin( FileName, Comm_compute, Comm_io, tstr, &amp;<a name='310'>
                                            Hndl, Status)<a name='311'>
#endif<a name='312'>
#ifdef PIO<a name='313'>
      CASE ( IO_PIO )<a name='314'>
        WRITE(tstr,"(A,',NTASKS_X=',i10,',MYTASK_X=',i10,',LOCAL_COMMUNICATOR_X=',i10)") &amp;<a name='315'>
              TRIM(SysDepInfo),ntasks_x,mytask_x,local_communicator_x<a name='316'>
        j=1<a name='317'>
        t1 = " "<a name='318'>
        DO i=1,len(TRIM(tstr))<a name='319'>
          IF ( tstr(i:i) .NE. ' ' ) THEN<a name='320'>
            t1(j:j) = tstr(i:i)<a name='321'>
            j = j + 1<a name='322'>
          ENDIF<a name='323'>
        ENDDO<a name='324'>
        tstr = t1<a name='325'>
        CALL ext_pio_open_for_write_begin( FileName, grid, tstr, Hndl, Status)<a name='326'>
#endif<a name='327'>
#ifdef XXX<a name='328'>
      CASE ( IO_XXX   )<a name='329'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_WRITE_BEGIN'>ext_xxx_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_WRITE_BEGIN_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='330'>
                                            Hndl , Status )<a name='331'>
#endif<a name='332'>
#ifdef YYY<a name='333'>
      CASE ( IO_YYY   )<a name='334'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='335'>
          IF ( multi_files(io_form) ) THEN<a name='336'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_22"> ( myproc )<a name='337'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_2"> ( LocFilename , FileName , myproc, 4 )<a name='338'>
          ELSE<a name='339'>
            LocFilename = FileName<a name='340'>
          ENDIF<a name='341'>
          CALL ext_yyy_open_for_write_begin ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='342'>
                                              Hndl , Status )<a name='343'>
        ENDIF<a name='344'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='345'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_11">( Hndl, IWORDSIZE )<a name='346'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_12">( Status, IWORDSIZE )<a name='347'>
        ENDIF<a name='348'>
#endif<a name='349'>
#ifdef ZZZ<a name='350'>
      CASE ( IO_ZZZ   )<a name='351'>
        CALL ext_zzz_open_for_write_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='352'>
                                            Hndl , Status )<a name='353'>
#endif<a name='354'>
#ifdef GRIB1<a name='355'>
      CASE ( IO_GRIB1   )<a name='356'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='357'>
          IF ( multi_files(io_form) ) THEN<a name='358'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_23"> ( myproc )<a name='359'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_3"> ( LocFilename , FileName , myproc, 4 )<a name='360'>
          ELSE<a name='361'>
            LocFilename = FileName<a name='362'>
          ENDIF<a name='363'>
          CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_OPEN_FOR_WRITE_BEGIN'>ext_gr1_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_OPEN_FOR_WRITE_BEGIN_1"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='364'>
                                              Hndl , Status )<a name='365'>
        ENDIF<a name='366'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='367'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_13">( Hndl, IWORDSIZE )<a name='368'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_14">( Status, IWORDSIZE )<a name='369'>
        ENDIF<a name='370'>
#endif<a name='371'>
#ifdef GRIB2<a name='372'>
      CASE ( IO_GRIB2   )<a name='373'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='374'>
          IF ( multi_files(io_form) ) THEN<a name='375'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_24"> ( myproc )<a name='376'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_4"> ( LocFilename , FileName , myproc, 4 )<a name='377'>
          ELSE<a name='378'>
            LocFilename = FileName<a name='379'>
          ENDIF<a name='380'>
          CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_BEGIN'>ext_gr2_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_WRITE_BEGIN_1"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='381'>
                                              Hndl , Status )<a name='382'>
        ENDIF<a name='383'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='384'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_15">( Hndl, IWORDSIZE )<a name='385'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_16">( Status, IWORDSIZE )<a name='386'>
        ENDIF<a name='387'>
#endif<a name='388'>
#ifdef MCELIO<a name='389'>
      CASE ( IO_MCEL )<a name='390'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='391'>
          tstr = TRIM(SysDepInfo) // ',' // 'LAT_R=XLAT,LON_R=XLONG,LANDMASK_I=LU_MASK'<a name='392'>
          CALL ext_mcel_open_for_write_begin ( FileName , Comm_compute, Comm_io, tstr, &amp;<a name='393'>
                                               Hndl , Status )<a name='394'>
        ENDIF<a name='395'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_17">( Hndl, IWORDSIZE )<a name='396'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_18">( Status, IWORDSIZE )<a name='397'>
#endif<a name='398'>
#ifdef ESMFIO<a name='399'>
      CASE ( IO_ESMF )<a name='400'>
        CALL ext_esmf_open_for_write_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='401'>
                                             Hndl , Status )<a name='402'>
#endif<a name='403'>
#ifdef INTIO<a name='404'>
      CASE ( IO_INTIO   )<a name='405'>
        IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='406'>
          IF ( multi_files(io_form) ) THEN<a name='407'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_25"> ( myproc )<a name='408'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_5"> ( LocFilename , FileName , myproc, 4 )<a name='409'>
          ELSE<a name='410'>
            LocFilename = FileName<a name='411'>
          ENDIF<a name='412'>
          CALL ext_int_open_for_write_begin ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='413'>
                                              Hndl , Status )<a name='414'>
        ENDIF<a name='415'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='416'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_19">( Hndl, IWORDSIZE )<a name='417'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_20">( Status, IWORDSIZE )<a name='418'>
        ENDIF<a name='419'>
#endif<a name='420'>
      CASE DEFAULT<a name='421'>
        IF ( io_form .NE. 0 ) THEN<a name='422'>
          WRITE(mess,*)'Tried to open ',FileName,' writing: no valid io_form (',io_form,')'<a name='423'>
          CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_249">(1, mess)<a name='424'>
          Status = WRF_FILE_NOT_OPENED<a name='425'>
        ENDIF<a name='426'>
    END SELECT<a name='427'>
  ELSE <font color=#447700>! use_output_servers_for(io_form)<a name='428'></font>
    IF ( io_form .GT. 0 ) THEN<a name='429'>
      IF ( ncd_nofill ) THEN<a name='430'>
        CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN'>wrf_quilt_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_OPEN_FOR_WRITE_BEGIN_1"> ( FileName , grid%id, Comm_compute, Comm_io, TRIM(SysDepInfo) // ",NOFILL=.TRUE.", &amp;<a name='431'>
                                              Hndl , io_form, Status )<a name='432'>
      ELSE<a name='433'>
        CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_OPEN_FOR_WRITE_BEGIN'>wrf_quilt_open_for_write_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_OPEN_FOR_WRITE_BEGIN_2"> ( FileName , grid%id, Comm_compute, Comm_io, SysDepInfo, &amp;<a name='434'>
                                              Hndl , io_form, Status )<a name='435'>
      ENDIF<a name='436'>
    ENDIF<a name='437'>
  ENDIF<a name='438'>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_1">( Hndl, io_form, .TRUE., DataHandle )<a name='439'>
END SUBROUTINE wrf_open_for_write_begin<a name='440'>
<a name='441'>
<font color=#447700>!--- open_for_write_commit<a name='442'></font>
<a name='443'>
<A NAME='WRF_OPEN_FOR_WRITE_COMMIT'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='444'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_write_commit</font>( DataHandle , Status ) <A href='../../call_to/WRF_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_WRITE_COMMIT.html' TARGET='index'>14</A><a name='445'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='446'></font>
<font color=#447700>!&lt;PRE&gt;<a name='447'></font>
<font color=#447700>! This routine switches an internal flag to enable output for the data set <a name='448'></font>
<font color=#447700>! referenced by DataHandle. The call to wrf_open_for_write_commit() must be <a name='449'></font>
<font color=#447700>! paired with a call to wrf_open_for_write_begin().<a name='450'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='451'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='452'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_66"><a name='453'>
  IMPLICIT NONE<a name='454'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='455'>
  INTEGER ,       INTENT(OUT) :: Status<a name='456'>
 <a name='457'>
  CHARACTER (128)             :: DataSet<a name='458'>
  INTEGER                     :: io_form<a name='459'>
  INTEGER                     :: Hndl<a name='460'>
  LOGICAL                     :: for_out<a name='461'>
  INTEGER, EXTERNAL           :: use_package<a name='462'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='463'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_5"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='464'>
<a name='465'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_250">( DEBUG_LVL, 'module_io.F: in wrf_open_for_write_commit' )<a name='466'>
<a name='467'>
  Status = 0<a name='468'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_1"> ( Hndl, io_form , for_out, DataHandle )<a name='469'>
  CALL <A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION'>set_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_FIRST_OPERATION_1">( DataHandle )<a name='470'>
  IF ( Hndl .GT. -1 ) THEN<a name='471'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='472'>
      SELECT CASE ( use_package(io_form) )<a name='473'>
#ifdef NETCDF<a name='474'>
        CASE ( IO_NETCDF   )<a name='475'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='476'>
            CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_WRITE_COMMIT'>ext_ncd_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='477'>
          ENDIF<a name='478'>
          IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_21">( Status, IWORDSIZE )<a name='479'>
#endif<a name='480'>
#ifdef MCELIO<a name='481'>
        CASE ( IO_MCEL   )<a name='482'>
          IF ( wrf_dm_on_monitor() ) THEN<a name='483'>
            CALL ext_mcel_open_for_write_commit ( Hndl , Status )<a name='484'>
          ENDIF<a name='485'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_22">( Status, IWORDSIZE )<a name='486'>
#endif<a name='487'>
#ifdef ESMFIO<a name='488'>
        CASE ( IO_ESMF )<a name='489'>
          CALL ext_esmf_open_for_write_commit ( Hndl , Status )<a name='490'>
#endif<a name='491'>
#ifdef PHDF5<a name='492'>
      CASE ( IO_PHDF5  )<a name='493'>
        CALL ext_phdf5_open_for_write_commit ( Hndl , Status )<a name='494'>
#endif<a name='495'>
#ifdef PNETCDF<a name='496'>
      CASE ( IO_PNETCDF  )<a name='497'>
        CALL ext_pnc_open_for_write_commit ( Hndl , Status )<a name='498'>
#endif<a name='499'>
#ifdef PIO<a name='500'>
      CASE ( IO_PIO )<a name='501'>
        CALL ext_pio_open_for_write_commit ( Hndl , Status )<a name='502'>
#endif<a name='503'>
#ifdef XXX<a name='504'>
      CASE ( IO_XXX   )<a name='505'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_WRITE_COMMIT'>ext_xxx_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='506'>
#endif<a name='507'>
#ifdef YYY<a name='508'>
      CASE ( IO_YYY   )<a name='509'>
         IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='510'>
            CALL ext_yyy_open_for_write_commit ( Hndl , Status )<a name='511'>
         ENDIF<a name='512'>
         IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_23">( Status, IWORDSIZE )<a name='513'>
#endif<a name='514'>
#ifdef ZZZ<a name='515'>
      CASE ( IO_ZZZ   )<a name='516'>
        CALL ext_zzz_open_for_write_commit ( Hndl , Status )<a name='517'>
#endif<a name='518'>
#ifdef GRIB1<a name='519'>
      CASE ( IO_GRIB1   )<a name='520'>
         IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='521'>
            CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_OPEN_FOR_WRITE_COMMIT'>ext_gr1_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='522'>
         ENDIF<a name='523'>
         IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_24">( Status, IWORDSIZE )<a name='524'>
#endif<a name='525'>
#ifdef GRIB2<a name='526'>
      CASE ( IO_GRIB2   )<a name='527'>
         IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='528'>
            CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_WRITE_COMMIT'>ext_gr2_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='529'>
         ENDIF<a name='530'>
         IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_25">( Status, IWORDSIZE )<a name='531'>
#endif<a name='532'>
#ifdef INTIO<a name='533'>
      CASE ( IO_INTIO   )<a name='534'>
        CALL ext_int_open_for_write_commit ( Hndl , Status )<a name='535'>
#endif<a name='536'>
        CASE DEFAULT<a name='537'>
          Status = 0<a name='538'>
      END SELECT<a name='539'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='540'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_OPEN_FOR_WRITE_COMMIT'>wrf_quilt_open_for_write_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_WRITE_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_OPEN_FOR_WRITE_COMMIT_1"> ( Hndl , Status )<a name='541'>
    ELSE<a name='542'>
      Status = 0<a name='543'>
    ENDIF<a name='544'>
  ELSE<a name='545'>
    Status = 0<a name='546'>
  ENDIF<a name='547'>
  RETURN<a name='548'>
END SUBROUTINE wrf_open_for_write_commit<a name='549'>
<a name='550'>
<font color=#447700>!--- open_for_read_begin<a name='551'></font>
<a name='552'>
<A NAME='WRF_OPEN_FOR_READ_BEGIN'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='553'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read_begin</font>( FileName , grid, SysDepInfo, &amp; <A href='../../call_to/WRF_OPEN_FOR_READ_BEGIN.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_READ_BEGIN.html' TARGET='index'>25</A><a name='554'>
                                     DataHandle , Status )<a name='555'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='556'></font>
<font color=#447700>!&lt;PRE&gt;<a name='557'></font>
<font color=#447700>! Begin data definition ("training") phase for reading from WRF dataset <a name='558'></font>
<font color=#447700>! FileName.  <a name='559'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='560'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='561'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_67"><a name='562'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_157"><a name='563'>
  IMPLICIT NONE<a name='564'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_6"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='565'>
  CHARACTER*(*) :: FileName<a name='566'>
  TYPE (domain) :: grid<a name='567'>
  CHARACTER*(*) :: SysDepInfo<a name='568'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='569'>
  INTEGER ,       INTENT(OUT) :: Status<a name='570'>
  <a name='571'>
  CHARACTER*128               :: DataSet<a name='572'>
  INTEGER                     :: io_form<a name='573'>
  INTEGER                     :: Hndl<a name='574'>
  LOGICAL                     :: also_for_out<a name='575'>
  INTEGER, EXTERNAL           :: use_package<a name='576'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='577'>
<a name='578'>
  CHARACTER*128     :: LocFilename   <font color=#447700>! for appending the process ID if necessary<a name='579'></font>
  INTEGER     myproc<a name='580'>
  CHARACTER*128     :: mess, fhand<a name='581'>
  CHARACTER*1028    :: tstr<a name='582'>
  INTEGER           :: Comm_compute , Comm_io<a name='583'>
<a name='584'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_251">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read_begin' )<a name='585'>
<a name='586'>
  Comm_compute = grid%communicator<a name='587'>
  Comm_io = grid%iocommunicator<a name='588'>
<a name='589'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_2"> ( "DATASET" , SysDepInfo , DataSet )<a name='590'>
<a name='591'>
  io_form = <A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_DATASET'>io_form_for_dataset</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IO_FORM_FOR_DATASET_2">( DataSet )<a name='592'>
<a name='593'>
  Status = 0<a name='594'>
  Hndl = -1<a name='595'>
  also_for_out = .FALSE.<a name='596'>
<font color=#447700>!  IF ( .NOT. use_output_servers_for(io_form) ) THEN<a name='597'></font>
    SELECT CASE ( use_package(io_form) )<a name='598'>
#ifdef NETCDF<a name='599'>
      CASE ( IO_NETCDF   )<a name='600'>
        IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='601'>
          IF ( multi_files(io_form) ) THEN<a name='602'>
              CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_26"> ( myproc )<a name='603'>
              CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_6"> ( LocFilename , FileName , myproc, 4 )<a name='604'>
          ELSE<a name='605'>
              LocFilename = FileName<a name='606'>
          ENDIF<a name='607'>
          CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_READ_BEGIN'>ext_ncd_open_for_read_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_READ_BEGIN_1"> ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='608'>
                                       Hndl , Status )<a name='609'>
        ENDIF<a name='610'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='611'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_26">( Status, IWORDSIZE )<a name='612'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_27">( Hndl, IWORDSIZE )<a name='613'>
        ENDIF<a name='614'>
#endif<a name='615'>
#ifdef PNETCDF<a name='616'>
      CASE ( IO_PNETCDF   )<a name='617'>
        CALL ext_pnc_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='618'>
                                            Hndl , Status )<a name='619'>
#endif<a name='620'>
#ifdef PIO<a name='621'>
      CASE ( IO_PIO )<a name='622'>
        CALL ext_pio_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='623'>
                                            Hndl , Status )<a name='624'>
#endif<a name='625'>
#ifdef XXX<a name='626'>
      CASE ( IO_XXX   )<a name='627'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ_BEGIN'>ext_xxx_open_for_read_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_BEGIN_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='628'>
                                            Hndl , Status )<a name='629'>
#endif<a name='630'>
#ifdef YYY<a name='631'>
      CASE ( IO_YYY   )<a name='632'>
        CALL ext_yyy_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='633'>
                                            Hndl , Status )<a name='634'>
#endif<a name='635'>
#ifdef ZZZ<a name='636'>
      CASE ( IO_ZZZ   )<a name='637'>
        CALL ext_zzz_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='638'>
                                            Hndl , Status )<a name='639'>
#endif<a name='640'>
#ifdef MCELIO<a name='641'>
      CASE ( IO_MCEL )<a name='642'>
        also_for_out = .TRUE.<a name='643'>
        IF ( wrf_dm_on_monitor() ) THEN<a name='644'>
          <a name='645'>
        WRITE(fhand,'(a,i0)')"filter_",filtno<a name='646'>
        filtno = filtno + 1<a name='647'>
tstr = TRIM(SysDepInfo) // ',' // 'READ_MODE=UPDATE,LAT_R=XLAT,LON_R=XLONG,LANDMASK_I=LU_MASK,FILTER_HANDLE=' // TRIM(fhand)<a name='648'>
          CALL ext_mcel_open_for_read_begin ( FileName , Comm_compute, Comm_io, tstr, &amp;<a name='649'>
                                               Hndl , Status )<a name='650'>
        ENDIF<a name='651'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_28">( Hndl, IWORDSIZE )<a name='652'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_29">( Status, IWORDSIZE )<a name='653'>
#endif<a name='654'>
#ifdef ESMFIO<a name='655'>
      CASE ( IO_ESMF )<a name='656'>
        also_for_out = .TRUE.<a name='657'>
        CALL ext_esmf_open_for_read_begin ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='658'>
                                            Hndl , Status )<a name='659'>
#endif<a name='660'>
#ifdef GRIB1<a name='661'>
      CASE ( IO_GRIB1   )<a name='662'>
        IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='663'>
          IF ( multi_files(io_form) ) THEN<a name='664'>
              CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_27"> ( myproc )<a name='665'>
              CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_7"> ( LocFilename , FileName , myproc, 4 )<a name='666'>
          ELSE<a name='667'>
              LocFilename = FileName<a name='668'>
          ENDIF<a name='669'>
          CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_OPEN_FOR_READ_BEGIN'>ext_gr1_open_for_read_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_OPEN_FOR_READ_BEGIN_1"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='670'>
               Hndl , Status )<a name='671'>
        ENDIF<a name='672'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='673'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_30">( Status, IWORDSIZE )<a name='674'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_31">( Hndl, IWORDSIZE )<a name='675'>
        ENDIF<a name='676'>
#endif<a name='677'>
#ifdef GRIB2<a name='678'>
      CASE ( IO_GRIB2   )<a name='679'>
        IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='680'>
          IF ( multi_files(io_form) ) THEN<a name='681'>
              CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_28"> ( myproc )<a name='682'>
              CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_8"> ( LocFilename , FileName , myproc, 4 )<a name='683'>
          ELSE<a name='684'>
              LocFilename = FileName<a name='685'>
          ENDIF<a name='686'>
          CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_BEGIN'>ext_gr2_open_for_read_begin</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_READ_BEGIN_1"> ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='687'>
               Hndl , Status )<a name='688'>
        ENDIF<a name='689'>
        IF ( .NOT. multi_files(io_form) ) THEN<a name='690'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_32">( Status, IWORDSIZE )<a name='691'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_33">( Hndl, IWORDSIZE )<a name='692'>
        ENDIF<a name='693'>
#endif<a name='694'>
#ifdef INTIO<a name='695'>
      CASE ( IO_INTIO   )<a name='696'>
#endif<a name='697'>
      CASE DEFAULT<a name='698'>
        IF ( io_form .NE. 0 ) THEN<a name='699'>
          WRITE(mess,*)'Tried to open ',FileName,' reading: no valid io_form (',io_form,')'<a name='700'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_336">(mess)<a name='701'>
        ENDIF<a name='702'>
        Status = WRF_FILE_NOT_OPENED<a name='703'>
    END SELECT<a name='704'>
<font color=#447700>!  ELSE<a name='705'></font>
<font color=#447700>!    Status = 0<a name='706'></font>
<font color=#447700>!  ENDIF<a name='707'></font>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_BEGIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_2">( Hndl, io_form, also_for_out, DataHandle )<a name='708'>
END SUBROUTINE wrf_open_for_read_begin<a name='709'>
<a name='710'>
<font color=#447700>!--- open_for_read_commit<a name='711'></font>
<a name='712'>
<A NAME='WRF_OPEN_FOR_READ_COMMIT'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='713'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read_commit</font>( DataHandle , Status ) <A href='../../call_to/WRF_OPEN_FOR_READ_COMMIT.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_OPEN_FOR_READ_COMMIT.html' TARGET='index'>10</A><a name='714'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='715'></font>
<font color=#447700>!&lt;PRE&gt;<a name='716'></font>
<font color=#447700>! End "training" phase for WRF dataset FileName.  The call to <a name='717'></font>
<font color=#447700>! wrf_open_for_read_commit() must be paired with a call to <a name='718'></font>
<font color=#447700>! wrf_open_for_read_begin().<a name='719'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='720'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='721'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_68"><a name='722'>
  IMPLICIT NONE<a name='723'>
  INTEGER ,       INTENT(IN ) :: DataHandle<a name='724'>
  INTEGER ,       INTENT(OUT) :: Status<a name='725'>
 <a name='726'>
  CHARACTER (128)             :: DataSet<a name='727'>
  INTEGER                     :: io_form<a name='728'>
  INTEGER                     :: Hndl<a name='729'>
  LOGICAL                     :: for_out<a name='730'>
  INTEGER, EXTERNAL           :: use_package<a name='731'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='732'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_7"><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='733'>
<a name='734'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_252">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read_commit' )<a name='735'>
<a name='736'>
  Status = 0<a name='737'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_2"> ( Hndl, io_form , for_out, DataHandle )<a name='738'>
  CALL <A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION'>set_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_FIRST_OPERATION_2">( DataHandle )<a name='739'>
  IF ( Hndl .GT. -1 ) THEN<a name='740'>
    IF ( .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='741'>
      SELECT CASE ( use_package(io_form) )<a name='742'>
#ifdef NETCDF<a name='743'>
        CASE ( IO_NETCDF   )<a name='744'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) THEN<a name='745'>
            CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_READ_COMMIT'>ext_ncd_open_for_read_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_READ_COMMIT_1"> ( Hndl , Status )<a name='746'>
          ENDIF<a name='747'>
          IF ( .NOT. multi_files(io_form) ) CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_34">( Status, IWORDSIZE )<a name='748'>
#endif<a name='749'>
#ifdef MCELIO<a name='750'>
        CASE ( IO_MCEL   )<a name='751'>
          IF ( wrf_dm_on_monitor() ) THEN<a name='752'>
            CALL ext_mcel_open_for_read_commit ( Hndl , Status )<a name='753'>
          ENDIF<a name='754'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_35">( Status, IWORDSIZE )<a name='755'>
#endif<a name='756'>
#ifdef ESMFIO<a name='757'>
        CASE ( IO_ESMF )<a name='758'>
          CALL ext_esmf_open_for_read_commit ( Hndl , Status )<a name='759'>
#endif<a name='760'>
#ifdef PNETCDF<a name='761'>
        CASE ( IO_PNETCDF )<a name='762'>
          CALL ext_pnc_open_for_read_commit ( Hndl , Status )<a name='763'>
#endif<a name='764'>
#ifdef PIO<a name='765'>
        CASE ( IO_PIO )<a name='766'>
          CALL ext_pio_open_for_read_commit ( Hndl , Status )<a name='767'>
#endif<a name='768'>
#ifdef XXX<a name='769'>
      CASE ( IO_XXX   )<a name='770'>
        CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ_COMMIT'>ext_xxx_open_for_read_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_COMMIT_1"> ( Hndl , Status )<a name='771'>
#endif<a name='772'>
#ifdef YYY<a name='773'>
      CASE ( IO_YYY   )<a name='774'>
        CALL ext_yyy_open_for_read_commit ( Hndl , Status )<a name='775'>
#endif<a name='776'>
#ifdef ZZZ<a name='777'>
      CASE ( IO_ZZZ   )<a name='778'>
        CALL ext_zzz_open_for_read_commit ( Hndl , Status )<a name='779'>
#endif<a name='780'>
#ifdef GRIB1<a name='781'>
      CASE ( IO_GRIB1   )<a name='782'>
        CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_OPEN_FOR_READ_COMMIT'>ext_gr1_open_for_read_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_OPEN_FOR_READ_COMMIT_1"> ( Hndl , Status )<a name='783'>
#endif<a name='784'>
#ifdef GRIB2<a name='785'>
      CASE ( IO_GRIB2   )<a name='786'>
        CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ_COMMIT'>ext_gr2_open_for_read_commit</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ_COMMIT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_READ_COMMIT_1"> ( Hndl , Status )<a name='787'>
#endif<a name='788'>
#ifdef INTIO<a name='789'>
      CASE ( IO_INTIO   )<a name='790'>
#endif<a name='791'>
        CASE DEFAULT<a name='792'>
          Status = 0<a name='793'>
      END SELECT<a name='794'>
    ELSE<a name='795'>
      Status = 0<a name='796'>
    ENDIF<a name='797'>
  ELSE<a name='798'>
    Status = WRF_FILE_NOT_OPENED<a name='799'>
  ENDIF<a name='800'>
  RETURN<a name='801'>
END SUBROUTINE wrf_open_for_read_commit<a name='802'>
<a name='803'>
<font color=#447700>!--- open_for_read <a name='804'></font>
<a name='805'>
<A NAME='WRF_OPEN_FOR_READ'><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='806'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_open_for_read</font> ( FileName , grid, SysDepInfo, &amp; <A href='../../call_to/WRF_OPEN_FOR_READ.html' TARGET='index'>3</A>,<A href='../../call_from/WRF_OPEN_FOR_READ.html' TARGET='index'>30</A><a name='807'>
                               DataHandle , Status )<a name='808'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='809'></font>
<font color=#447700>!&lt;PRE&gt;<a name='810'></font>
<font color=#447700>! Opens a WRF dataset for reading.  <a name='811'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='812'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='813'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_69"><a name='814'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_158"><a name='815'>
  IMPLICIT NONE<a name='816'>
  CHARACTER*(*) :: FileName<a name='817'>
  TYPE (domain) :: grid<a name='818'>
  CHARACTER*(*) :: SysDepInfo<a name='819'>
  INTEGER ,       INTENT(OUT) :: DataHandle<a name='820'>
  INTEGER ,       INTENT(OUT) :: Status<a name='821'>
<a name='822'>
  CHARACTER (128)             :: DataSet, LocFileName<a name='823'>
  INTEGER                     :: io_form, myproc<a name='824'>
  INTEGER                     :: Hndl<a name='825'>
  INTEGER, EXTERNAL           :: use_package<a name='826'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='827'>
  INTEGER                     :: Comm_compute, Comm_io<a name='828'>
<a name='829'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_253">( DEBUG_LVL, 'module_io.F: in wrf_open_for_read' )<a name='830'>
<a name='831'>
  Comm_compute = grid%communicator<a name='832'>
  Comm_io = grid%iocommunicator<a name='833'>
<a name='834'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS'>get_value_from_pairs</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_VALUE_FROM_PAIRS_3"> ( "DATASET" , SysDepInfo , DataSet )<a name='835'>
<a name='836'>
  io_form = <A href='../../html_code/frame/module_io.F.html#IO_FORM_FOR_DATASET'>io_form_for_dataset</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="IO_FORM_FOR_DATASET_3">( DataSet )<a name='837'>
<a name='838'>
  Hndl = -1<a name='839'>
  Status = 0<a name='840'>
  SELECT CASE ( use_package(io_form) )<a name='841'>
#ifdef NETCDF<a name='842'>
    CASE ( IO_NETCDF   )<a name='843'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='844'>
        IF ( multi_files(io_form) ) THEN<a name='845'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_29"> ( myproc )<a name='846'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_9"> ( LocFilename , FileName , myproc, 4 )<a name='847'>
        ELSE<a name='848'>
            LocFilename = FileName<a name='849'>
        ENDIF<a name='850'>
<a name='851'>
        CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_OPEN_FOR_READ'>ext_ncd_open_for_read</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_OPEN_FOR_READ_2"> ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='852'>
                                     Hndl , Status )<a name='853'>
      ENDIF<a name='854'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='855'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_36">( Status, IWORDSIZE )<a name='856'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_37">( Hndl, IWORDSIZE )<a name='857'>
      ENDIF<a name='858'>
#endif<a name='859'>
#ifdef PNETCDF<a name='860'>
    CASE ( IO_PNETCDF  )<a name='861'>
      CALL ext_pnc_open_for_read ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='862'>
                               Hndl , Status )<a name='863'>
#endif<a name='864'>
#ifdef PIO<a name='865'>
    CASE ( IO_PIO )<a name='866'>
      CALL ext_pio_open_for_read ( FileName , grid, SysDepInfo, Hndl , Status )<a name='867'>
#endif<a name='868'>
#ifdef PHDF5<a name='869'>
    CASE ( IO_PHDF5  )<a name='870'>
      CALL ext_phdf5_open_for_read ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='871'>
                               Hndl , Status )<a name='872'>
#endif<a name='873'>
#ifdef XXX<a name='874'>
    CASE ( IO_XXX   )<a name='875'>
      CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_OPEN_FOR_READ'>ext_xxx_open_for_read</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_OPEN_FOR_READ_1"> ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='876'>
                               Hndl , Status )<a name='877'>
#endif<a name='878'>
#ifdef YYY<a name='879'>
    CASE ( IO_YYY   )<a name='880'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='881'>
        IF ( multi_files(io_form) ) THEN<a name='882'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_30"> ( myproc )<a name='883'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_10"> ( LocFilename , FileName , myproc, 4 )<a name='884'>
        ELSE<a name='885'>
            LocFilename = FileName<a name='886'>
        ENDIF<a name='887'>
<a name='888'>
        CALL ext_yyy_open_for_read ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='889'>
                                     Hndl , Status )<a name='890'>
      ENDIF<a name='891'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='892'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_38">( Status, IWORDSIZE )<a name='893'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_39">( Hndl, IWORDSIZE )<a name='894'>
      ENDIF<a name='895'>
#endif<a name='896'>
#ifdef ZZZ<a name='897'>
    CASE ( IO_ZZZ   )<a name='898'>
      CALL ext_zzz_open_for_read ( FileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='899'>
                               Hndl , Status )<a name='900'>
#endif<a name='901'>
#ifdef GRIB1<a name='902'>
    CASE ( IO_GRIB1   )<a name='903'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='904'>
        IF ( multi_files(io_form) ) THEN<a name='905'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_31"> ( myproc )<a name='906'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_11"> ( LocFilename , FileName , myproc, 4 )<a name='907'>
        ELSE<a name='908'>
            LocFilename = FileName<a name='909'>
        ENDIF<a name='910'>
<a name='911'>
        CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_OPEN_FOR_READ'>ext_gr1_open_for_read</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_OPEN_FOR_READ_1"> ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='912'>
                                     Hndl , Status )<a name='913'>
      ENDIF<a name='914'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='915'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_40">( Status, IWORDSIZE )<a name='916'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_41">( Hndl, IWORDSIZE )<a name='917'>
      ENDIF<a name='918'>
#endif<a name='919'>
#ifdef GRIB2<a name='920'>
    CASE ( IO_GRIB2   )<a name='921'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='922'>
        IF ( multi_files(io_form) ) THEN<a name='923'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_32"> ( myproc )<a name='924'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_12"> ( LocFilename , FileName , myproc, 4 )<a name='925'>
        ELSE<a name='926'>
            LocFilename = FileName<a name='927'>
        ENDIF<a name='928'>
<a name='929'>
        CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_OPEN_FOR_READ'>ext_gr2_open_for_read</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_OPEN_FOR_READ_1"> ( LocFilename , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='930'>
                                     Hndl , Status )<a name='931'>
      ENDIF<a name='932'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='933'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_42">( Status, IWORDSIZE )<a name='934'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_43">( Hndl, IWORDSIZE )<a name='935'>
      ENDIF<a name='936'>
#endif<a name='937'>
#ifdef INTIO<a name='938'>
    CASE ( IO_INTIO   )<a name='939'>
      IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) THEN<a name='940'>
        IF ( multi_files(io_form) ) THEN<a name='941'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_MYPROC'>wrf_get_myproc</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_MYPROC_33"> ( myproc )<a name='942'>
            CALL <A href='../../html_code/share/module_io_domain.F.html#APPEND_TO_FILENAME'>append_to_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="APPEND_TO_FILENAME_13"> ( LocFilename , FileName , myproc, 4 )<a name='943'>
        ELSE<a name='944'>
            LocFilename = FileName<a name='945'>
        ENDIF<a name='946'>
        CALL ext_int_open_for_read ( LocFileName , Comm_compute, Comm_io, SysDepInfo, &amp;<a name='947'>
                                     Hndl , Status )<a name='948'>
      ENDIF<a name='949'>
      IF ( .NOT. multi_files(io_form) ) THEN<a name='950'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_44">( Status, IWORDSIZE )<a name='951'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_45">( Hndl, IWORDSIZE )<a name='952'>
      ENDIF<a name='953'>
#endif<a name='954'>
    CASE DEFAULT<a name='955'>
        Status = 0<a name='956'>
  END SELECT<a name='957'>
  CALL <A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE'>add_new_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_OPEN_FOR_READ' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADD_NEW_HANDLE_3">( Hndl, io_form, .FALSE., DataHandle )<a name='958'>
  RETURN  <a name='959'>
END SUBROUTINE wrf_open_for_read<a name='960'>
<a name='961'>
<font color=#447700>!--- inquire_opened<a name='962'></font>
<a name='963'>
<A NAME='WRF_INQUIRE_OPENED'><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='964'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_inquire_opened</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_INQUIRE_OPENED.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_INQUIRE_OPENED.html' TARGET='index'>18</A><a name='965'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='966'></font>
<font color=#447700>!&lt;PRE&gt;<a name='967'></font>
<font color=#447700>! Inquire if the dataset referenced by DataHandle is open.  <a name='968'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='969'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='970'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_70"><a name='971'>
  IMPLICIT NONE<a name='972'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='973'>
  CHARACTER*(*) :: FileName<a name='974'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='975'>
  INTEGER ,       INTENT(OUT) :: Status<a name='976'>
  LOGICAL                     :: for_out<a name='977'>
  INTEGER, EXTERNAL           :: use_package<a name='978'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='979'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_8"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='980'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_9"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='981'>
<a name='982'>
  INTEGER io_form<a name='983'>
  INTEGER            :: Hndl<a name='984'>
<a name='985'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_254">( DEBUG_LVL, 'module_io.F: in wrf_inquire_opened' )<a name='986'>
<a name='987'>
  Status = 0<a name='988'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_3"> ( Hndl, io_form , for_out, DataHandle )<a name='989'>
  IF ( Hndl .GT. -1 ) THEN<a name='990'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='991'>
      SELECT CASE ( use_package(io_form) )<a name='992'>
#ifdef NETCDF<a name='993'>
        CASE ( IO_NETCDF   )<a name='994'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_INQUIRE_OPENED'>ext_ncd_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='995'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_46">( FileStatus, IWORDSIZE )<a name='996'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_47">( Status    , IWORDSIZE )<a name='997'>
#endif<a name='998'>
#ifdef PHDF5<a name='999'>
      CASE ( IO_PHDF5   )<a name='1000'>
          CALL ext_phdf5_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1001'>
#endif<a name='1002'>
#ifdef PNETCDF<a name='1003'>
      CASE ( IO_PNETCDF   )<a name='1004'>
          CALL ext_pnc_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1005'>
#endif<a name='1006'>
#ifdef PIO<a name='1007'>
      CASE ( IO_PIO )<a name='1008'>
          CALL ext_pio_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1009'>
#endif<a name='1010'>
#ifdef XXX<a name='1011'>
      CASE ( IO_XXX   )<a name='1012'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_INQUIRE_OPENED'>ext_xxx_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='1013'>
#endif<a name='1014'>
#ifdef YYY<a name='1015'>
      CASE ( IO_YYY   )<a name='1016'>
          IF (wrf_dm_on_monitor()) CALL ext_yyy_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1017'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_48">( FileStatus, IWORDSIZE )<a name='1018'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_49">( Status    , IWORDSIZE )<a name='1019'>
#endif<a name='1020'>
#ifdef ZZZ<a name='1021'>
      CASE ( IO_ZZZ   )<a name='1022'>
          CALL ext_zzz_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1023'>
#endif<a name='1024'>
#ifdef GRIB1<a name='1025'>
      CASE ( IO_GRIB1   )<a name='1026'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_INQUIRE_OPENED'>ext_gr1_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='1027'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_50">( FileStatus, IWORDSIZE )<a name='1028'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_51">( Status    , IWORDSIZE )<a name='1029'>
#endif<a name='1030'>
#ifdef GRIB2<a name='1031'>
      CASE ( IO_GRIB2   )<a name='1032'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_OPENED'>ext_gr2_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='1033'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_52">( FileStatus, IWORDSIZE )<a name='1034'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_53">( Status    , IWORDSIZE )<a name='1035'>
#endif<a name='1036'>
#ifdef INTIO<a name='1037'>
      CASE ( IO_INTIO   )<a name='1038'>
          IF (wrf_dm_on_monitor()) CALL ext_int_inquire_opened ( Hndl, FileName , FileStatus, Status )<a name='1039'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_54">( FileStatus, IWORDSIZE )<a name='1040'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_55">( Status    , IWORDSIZE )<a name='1041'>
#endif<a name='1042'>
        CASE DEFAULT<a name='1043'>
          FileStatus = WRF_FILE_NOT_OPENED<a name='1044'>
          Status = 0<a name='1045'>
      END SELECT<a name='1046'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1047'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_INQUIRE_OPENED'>wrf_quilt_inquire_opened</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_OPENED' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_INQUIRE_OPENED_1"> ( Hndl, FileName , FileStatus, Status )<a name='1048'>
    ENDIF<a name='1049'>
  ELSE<a name='1050'>
    FileStatus = WRF_FILE_NOT_OPENED<a name='1051'>
    Status = 0<a name='1052'>
  ENDIF<a name='1053'>
  RETURN<a name='1054'>
END SUBROUTINE wrf_inquire_opened<a name='1055'>
<a name='1056'>
<font color=#447700>!--- inquire_filename<a name='1057'></font>
<a name='1058'>
<a name='1059'>
<A NAME='WRF_INQUIRE_FILENAME'><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1060'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_inquire_filename</font> ( DataHandle, FileName , FileStatus, Status ) <A href='../../call_to/WRF_INQUIRE_FILENAME.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_INQUIRE_FILENAME.html' TARGET='index'>18</A><a name='1061'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1062'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1063'></font>
<font color=#447700>! Returns the Filename and FileStatus associated with DataHandle.  <a name='1064'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1065'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1066'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_71"><a name='1067'>
  IMPLICIT NONE<a name='1068'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1069'>
  CHARACTER*(*) :: FileName<a name='1070'>
  INTEGER ,       INTENT(OUT) :: FileStatus<a name='1071'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1072'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_10"><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1073'>
  INTEGER, EXTERNAL           :: use_package<a name='1074'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1075'>
  LOGICAL                     :: for_out<a name='1076'>
<a name='1077'>
  INTEGER                     :: io_form<a name='1078'>
  INTEGER                     :: str_length , str_count<a name='1079'>
  INTEGER                     :: Hndl<a name='1080'>
<a name='1081'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_255">( 300, 'module_io.F: in wrf_inquire_filename' )<a name='1082'>
<a name='1083'>
  Status = 0<a name='1084'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_4"> ( Hndl, io_form , for_out, DataHandle )<a name='1085'>
<a name='1086'>
  IF ( Hndl .GT. -1 ) THEN<a name='1087'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1088'>
      SELECT CASE ( use_package( io_form ) )<a name='1089'>
#ifdef NETCDF<a name='1090'>
        CASE ( IO_NETCDF   )<a name='1091'>
          str_length = LEN ( FileName )<a name='1092'>
          DO str_count = 1 , str_length<a name='1093'>
            FileName(str_count:str_count) = ' '<a name='1094'>
          END DO<a name='1095'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_INQUIRE_FILENAME'>ext_ncd_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='1096'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_56">( FileStatus, IWORDSIZE )<a name='1097'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_57">( Status    , IWORDSIZE )<a name='1098'>
#endif<a name='1099'>
#ifdef PHDF5<a name='1100'>
        CASE ( IO_PHDF5   )<a name='1101'>
          CALL ext_phdf5_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1102'>
#endif<a name='1103'>
#ifdef PNETCDF<a name='1104'>
        CASE ( IO_PNETCDF   )<a name='1105'>
          CALL ext_pnc_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1106'>
#endif<a name='1107'>
#ifdef PIO<a name='1108'>
        CASE ( IO_PIO )<a name='1109'>
          CALL ext_pio_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1110'>
#endif<a name='1111'>
#ifdef XXX<a name='1112'>
        CASE ( IO_XXX   )<a name='1113'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_INQUIRE_FILENAME'>ext_xxx_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='1114'>
#endif<a name='1115'>
#ifdef YYY<a name='1116'>
        CASE ( IO_YYY   )<a name='1117'>
          IF (wrf_dm_on_monitor()) CALL ext_yyy_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1118'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_58">( FileStatus, IWORDSIZE )<a name='1119'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_59">( Status    , IWORDSIZE )<a name='1120'>
#endif<a name='1121'>
#ifdef ZZZ<a name='1122'>
        CASE ( IO_ZZZ   )<a name='1123'>
            CALL ext_zzz_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1124'>
#endif<a name='1125'>
#ifdef GRIB1<a name='1126'>
        CASE ( IO_GRIB1   )<a name='1127'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_INQUIRE_FILENAME'>ext_gr1_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='1128'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_60">( FileStatus, IWORDSIZE )<a name='1129'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_61">( Status    , IWORDSIZE )<a name='1130'>
#endif<a name='1131'>
#ifdef GRIB2<a name='1132'>
        CASE ( IO_GRIB2   )<a name='1133'>
          IF (wrf_dm_on_monitor()) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_INQUIRE_FILENAME'>ext_gr2_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='1134'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_62">( FileStatus, IWORDSIZE )<a name='1135'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_63">( Status    , IWORDSIZE )<a name='1136'>
#endif<a name='1137'>
#ifdef INTIO<a name='1138'>
        CASE ( IO_INTIO   )<a name='1139'>
          IF (wrf_dm_on_monitor()) CALL ext_int_inquire_filename ( Hndl, FileName , FileStatus, Status )<a name='1140'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_64">( FileStatus, IWORDSIZE )<a name='1141'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_65">( Status    , IWORDSIZE )<a name='1142'>
#endif<a name='1143'>
        CASE DEFAULT<a name='1144'>
          Status = 0<a name='1145'>
      END SELECT<a name='1146'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1147'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_INQUIRE_FILENAME'>wrf_quilt_inquire_filename</A><A href='../../html_code/frame/module_io.F.html#WRF_INQUIRE_FILENAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_INQUIRE_FILENAME_1"> ( Hndl, FileName , FileStatus, Status )<a name='1148'>
    ENDIF<a name='1149'>
  ELSE<a name='1150'>
    FileName = ""<a name='1151'>
    Status = 0<a name='1152'>
  ENDIF<a name='1153'>
  RETURN<a name='1154'>
END SUBROUTINE wrf_inquire_filename<a name='1155'>
<a name='1156'>
<font color=#447700>!--- sync<a name='1157'></font>
<a name='1158'>
<A NAME='WRF_IOSYNC'><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1159'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_iosync</font> ( DataHandle, Status ) <A href='../../call_to/WRF_IOSYNC.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_IOSYNC.html' TARGET='index'>13</A><a name='1160'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1161'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1162'></font>
<font color=#447700>! Synchronize the disk copy of a dataset with memory buffers.  <a name='1163'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1164'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1165'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_72"><a name='1166'>
  IMPLICIT NONE<a name='1167'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1168'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1169'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_11"><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1170'>
  INTEGER, EXTERNAL           :: use_package<a name='1171'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1172'>
  LOGICAL                     :: for_out<a name='1173'>
<a name='1174'>
  INTEGER                     :: io_form<a name='1175'>
  INTEGER                     :: Hndl<a name='1176'>
<a name='1177'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_256">( DEBUG_LVL, 'module_io.F: in wrf_iosync' )<a name='1178'>
<a name='1179'>
  Status = 0<a name='1180'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_5"> ( Hndl, io_form , for_out, DataHandle )<a name='1181'>
  IF ( Hndl .GT. -1 ) THEN<a name='1182'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1183'>
      SELECT CASE ( use_package(io_form) )<a name='1184'>
#ifdef NETCDF<a name='1185'>
        CASE ( IO_NETCDF   )<a name='1186'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_IOSYNC'>ext_ncd_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_IOSYNC_1">( Hndl, Status )<a name='1187'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_66">( Status    , IWORDSIZE )<a name='1188'>
#endif<a name='1189'>
#ifdef XXX<a name='1190'>
        CASE ( IO_XXX   )<a name='1191'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOSYNC'>ext_xxx_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOSYNC_1">( Hndl, Status )<a name='1192'>
#endif<a name='1193'>
#ifdef YYY<a name='1194'>
        CASE ( IO_YYY   )<a name='1195'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL ext_yyy_iosync( Hndl, Status )<a name='1196'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_67">( Status    , IWORDSIZE )<a name='1197'>
#endif<a name='1198'>
#ifdef GRIB1<a name='1199'>
        CASE ( IO_GRIB1   )<a name='1200'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_IOSYNC'>ext_gr1_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_IOSYNC_1">( Hndl, Status )<a name='1201'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_68">( Status    , IWORDSIZE )<a name='1202'>
#endif<a name='1203'>
#ifdef GRIB2<a name='1204'>
        CASE ( IO_GRIB2   )<a name='1205'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOSYNC'>ext_gr2_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_IOSYNC_1">( Hndl, Status )<a name='1206'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_69">( Status    , IWORDSIZE )<a name='1207'>
#endif<a name='1208'>
#ifdef ZZZ<a name='1209'>
        CASE ( IO_ZZZ   )<a name='1210'>
          CALL ext_zzz_iosync( Hndl, Status )<a name='1211'>
#endif<a name='1212'>
#ifdef INTIO<a name='1213'>
        CASE ( IO_INTIO   )<a name='1214'>
          IF ( multi_files(io_form) .OR. wrf_dm_on_monitor() ) CALL ext_int_iosync( Hndl, Status )<a name='1215'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_70">( Status    , IWORDSIZE )<a name='1216'>
#endif<a name='1217'>
        CASE DEFAULT<a name='1218'>
          Status = 0<a name='1219'>
      END SELECT<a name='1220'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1221'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_IOSYNC'>wrf_quilt_iosync</A><A href='../../html_code/frame/module_io.F.html#WRF_IOSYNC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOSYNC_1">( Hndl, Status )<a name='1222'>
    ELSE<a name='1223'>
      Status = 0<a name='1224'>
    ENDIF<a name='1225'>
  ELSE<a name='1226'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1227'>
  ENDIF<a name='1228'>
  RETURN<a name='1229'>
END SUBROUTINE wrf_iosync<a name='1230'>
<a name='1231'>
<font color=#447700>!--- close<a name='1232'></font>
<a name='1233'>
<A NAME='WRF_IOCLOSE'><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1234'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_ioclose</font> ( DataHandle, Status ) <A href='../../call_to/WRF_IOCLOSE.html' TARGET='index'>3</A>,<A href='../../call_from/WRF_IOCLOSE.html' TARGET='index'>14</A><a name='1235'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1236'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1237'></font>
<font color=#447700>! Close the dataset referenced by DataHandle.  <a name='1238'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1239'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1240'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_73"><a name='1241'>
  IMPLICIT NONE<a name='1242'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1243'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1244'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_12"><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1245'>
  INTEGER, EXTERNAL           :: use_package<a name='1246'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1247'>
  INTEGER                     :: io_form<a name='1248'>
  LOGICAL                     :: for_out<a name='1249'>
  INTEGER                     :: Hndl<a name='1250'>
<a name='1251'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_257">( DEBUG_LVL, 'module_io.F: in wrf_ioclose' )<a name='1252'>
<a name='1253'>
  Status = 0<a name='1254'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_6"> ( Hndl, io_form , for_out, DataHandle )<a name='1255'>
  CALL <A href='../../html_code/frame/module_io.F.html#FREE_HANDLE'>free_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FREE_HANDLE_1">( DataHandle )<a name='1256'>
  IF ( Hndl .GT. -1 ) THEN<a name='1257'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1258'>
      SELECT CASE ( use_package(io_form) )<a name='1259'>
#ifdef NETCDF<a name='1260'>
        CASE ( IO_NETCDF   )<a name='1261'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_IOCLOSE'>ext_ncd_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_IOCLOSE_2">( Hndl, Status )<a name='1262'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_71">( Status, IWORDSIZE )<a name='1263'>
#endif<a name='1264'>
#ifdef PHDF5<a name='1265'>
        CASE ( IO_PHDF5  )<a name='1266'>
          CALL ext_phdf5_ioclose( Hndl, Status )<a name='1267'>
#endif<a name='1268'>
#ifdef PNETCDF<a name='1269'>
        CASE ( IO_PNETCDF  )<a name='1270'>
          CALL ext_pnc_ioclose( Hndl, Status )<a name='1271'>
#endif<a name='1272'>
#ifdef PIO<a name='1273'>
        CASE ( IO_PIO )<a name='1274'>
          CALL ext_pio_ioclose( Hndl, Status )<a name='1275'>
#endif<a name='1276'>
#ifdef XXX<a name='1277'>
        CASE ( IO_XXX   )<a name='1278'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_IOCLOSE'>ext_xxx_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_IOCLOSE_1">( Hndl, Status )<a name='1279'>
#endif<a name='1280'>
#ifdef YYY<a name='1281'>
        CASE ( IO_YYY   )<a name='1282'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_ioclose( Hndl, Status )<a name='1283'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_72">( Status, IWORDSIZE )<a name='1284'>
#endif<a name='1285'>
#ifdef ZZZ<a name='1286'>
        CASE ( IO_ZZZ   )<a name='1287'>
          CALL ext_zzz_ioclose( Hndl, Status )<a name='1288'>
#endif<a name='1289'>
#ifdef GRIB1<a name='1290'>
        CASE ( IO_GRIB1   )<a name='1291'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_IOCLOSE'>ext_gr1_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_IOCLOSE_1">( Hndl, Status )<a name='1292'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_73">( Status, IWORDSIZE )<a name='1293'>
#endif<a name='1294'>
#ifdef GRIB2<a name='1295'>
        CASE ( IO_GRIB2   )<a name='1296'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_IOCLOSE'>ext_gr2_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_IOCLOSE_1">( Hndl, Status )<a name='1297'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_74">( Status, IWORDSIZE )<a name='1298'>
#endif<a name='1299'>
#ifdef MCELIO<a name='1300'>
        CASE ( IO_MCEL   )<a name='1301'>
          CALL ext_mcel_ioclose( Hndl, Status )<a name='1302'>
#endif<a name='1303'>
#ifdef ESMFIO<a name='1304'>
        CASE ( IO_ESMF )<a name='1305'>
          CALL ext_esmf_ioclose( Hndl, Status )<a name='1306'>
#endif<a name='1307'>
#ifdef INTIO<a name='1308'>
        CASE ( IO_INTIO   )<a name='1309'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_ioclose( Hndl, Status )<a name='1310'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_75">( Status, IWORDSIZE )<a name='1311'>
#endif<a name='1312'>
        CASE DEFAULT<a name='1313'>
          Status = 0<a name='1314'>
      END SELECT<a name='1315'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1316'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_IOCLOSE'>wrf_quilt_ioclose</A><A href='../../html_code/frame/module_io.F.html#WRF_IOCLOSE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_IOCLOSE_1">( Hndl, Status )<a name='1317'>
    ELSE<a name='1318'>
      Status = 0<a name='1319'>
    ENDIF<a name='1320'>
  ELSE<a name='1321'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1322'>
  ENDIF<a name='1323'>
  RETURN<a name='1324'>
END SUBROUTINE wrf_ioclose<a name='1325'>
<a name='1326'>
<font color=#447700>!--- get_next_time (not defined for IntIO )<a name='1327'></font>
<a name='1328'>
<A NAME='WRF_GET_NEXT_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1329'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_next_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_GET_NEXT_TIME.html' TARGET='index'>5</A>,<A href='../../call_from/WRF_GET_NEXT_TIME.html' TARGET='index'>22</A><a name='1330'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1331'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1332'></font>
<font color=#447700>! Returns the next time stamp.  <a name='1333'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1334'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1335'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_74"><a name='1336'>
  IMPLICIT NONE<a name='1337'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1338'>
  CHARACTER*(*) :: DateStr<a name='1339'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1340'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_13"><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1341'>
<a name='1342'>
  INTEGER, EXTERNAL           :: use_package<a name='1343'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1344'>
  INTEGER                     :: io_form, len_of_str<a name='1345'>
  LOGICAL                     :: for_out<a name='1346'>
  INTEGER                     :: Hndl<a name='1347'>
<a name='1348'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_258">( DEBUG_LVL, 'module_io.F: in wrf_get_next_time' )<a name='1349'>
<a name='1350'>
  Status = 0<a name='1351'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_7"> ( Hndl, io_form , for_out, DataHandle )<a name='1352'>
  IF ( Hndl .GT. -1 ) THEN<a name='1353'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1354'>
      SELECT CASE ( use_package(io_form) )<a name='1355'>
#ifdef NETCDF<a name='1356'>
        CASE ( IO_NETCDF   )<a name='1357'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_GET_NEXT_TIME'>ext_ncd_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1358'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1359'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_76">( Status, IWORDSIZE )<a name='1360'>
            len_of_str = LEN(DateStr)<a name='1361'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_1"> ( DateStr , len_of_str )<a name='1362'>
          ENDIF<a name='1363'>
#endif<a name='1364'>
#ifdef PNETCDF<a name='1365'>
        CASE ( IO_PNETCDF   )<a name='1366'>
          IF ( multi_files(io_form) ) THEN<a name='1367'>
            CALL ext_pnc_get_next_time( Hndl, DateStr, Status )<a name='1368'>
          ELSE<a name='1369'>
            IF ( wrf_dm_on_monitor() ) THEN<a name='1370'>
              CALL ext_pnc_get_next_time( Hndl, DateStr, Status )<a name='1371'>
            ENDIF<a name='1372'>
<a name='1373'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_77">( Status, IWORDSIZE )<a name='1374'>
            len_of_str = LEN(DateStr)<a name='1375'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_2"> ( DateStr , len_of_str )<a name='1376'>
          ENDIF<a name='1377'>
#endif<a name='1378'>
#ifdef PIO<a name='1379'>
        CASE ( IO_PIO )<a name='1380'>
          IF ( multi_files(io_form) ) THEN<a name='1381'>
            CALL ext_pio_get_next_time( Hndl, DateStr, Status )<a name='1382'>
          ELSE<a name='1383'>
            IF ( wrf_dm_on_monitor() ) THEN<a name='1384'>
              CALL ext_pio_get_next_time( Hndl, DateStr, Status )<a name='1385'>
            ENDIF<a name='1386'>
<a name='1387'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_78">( Status, IWORDSIZE )<a name='1388'>
            len_of_str = LEN(DateStr)<a name='1389'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_3"> ( DateStr , len_of_str )<a name='1390'>
          ENDIF<a name='1391'>
#endif<a name='1392'>
#ifdef PHDF5<a name='1393'>
        CASE ( IO_PHDF5   )<a name='1394'>
          CALL ext_phdf5_get_next_time( Hndl, DateStr, Status )<a name='1395'>
#endif<a name='1396'>
#ifdef XXX<a name='1397'>
        CASE ( IO_XXX   )<a name='1398'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_NEXT_TIME'>ext_xxx_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1399'>
#endif<a name='1400'>
#ifdef YYY<a name='1401'>
        CASE ( IO_YYY   )<a name='1402'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_next_time( Hndl, DateStr, Status )<a name='1403'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1404'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_79">( Status, IWORDSIZE )<a name='1405'>
            len_of_str = LEN(DateStr)<a name='1406'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_4"> ( DateStr , len_of_str )<a name='1407'>
          ENDIF<a name='1408'>
#endif<a name='1409'>
#ifdef ZZZ<a name='1410'>
        CASE ( IO_ZZZ   )<a name='1411'>
          CALL ext_zzz_get_next_time( Hndl, DateStr, Status )<a name='1412'>
#endif<a name='1413'>
#ifdef GRIB1<a name='1414'>
        CASE ( IO_GRIB1   )<a name='1415'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_GET_NEXT_TIME'>ext_gr1_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1416'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1417'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_80">( Status, IWORDSIZE )<a name='1418'>
            len_of_str = LEN(DateStr)<a name='1419'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_5"> ( DateStr , len_of_str )<a name='1420'>
          ENDIF<a name='1421'>
#endif<a name='1422'>
#ifdef GRIB2<a name='1423'>
        CASE ( IO_GRIB2   )<a name='1424'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_TIME'>ext_gr2_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1425'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1426'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_81">( Status, IWORDSIZE )<a name='1427'>
            len_of_str = LEN(DateStr)<a name='1428'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_6"> ( DateStr , len_of_str )<a name='1429'>
          ENDIF<a name='1430'>
#endif<a name='1431'>
#ifdef INTIO<a name='1432'>
        CASE ( IO_INTIO   )<a name='1433'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_get_next_time( Hndl, DateStr, Status )<a name='1434'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1435'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_82">( Status, IWORDSIZE )<a name='1436'>
            len_of_str = LEN(DateStr)<a name='1437'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_7"> ( DateStr , len_of_str )<a name='1438'>
          ENDIF<a name='1439'>
#endif<a name='1440'>
        CASE DEFAULT<a name='1441'>
          Status = 0<a name='1442'>
      END SELECT<a name='1443'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1444'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_GET_NEXT_TIME'>wrf_quilt_get_next_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_NEXT_TIME_1">( Hndl, DateStr, Status )<a name='1445'>
    ELSE<a name='1446'>
      Status = 0<a name='1447'>
    ENDIF<a name='1448'>
  ELSE<a name='1449'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1450'>
  ENDIF<a name='1451'>
  RETURN<a name='1452'>
END SUBROUTINE wrf_get_next_time<a name='1453'>
<a name='1454'>
<font color=#447700>!--- get_previous_time (not defined for IntIO )<a name='1455'></font>
<a name='1456'>
<A NAME='WRF_GET_PREVIOUS_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1457'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_previous_time</font> ( DataHandle, DateStr, Status ) <A href='../../call_to/WRF_GET_PREVIOUS_TIME.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_GET_PREVIOUS_TIME.html' TARGET='index'>16</A><a name='1458'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1459'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1460'></font>
<font color=#447700>! Returns the previous time stamp.  <a name='1461'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1462'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1463'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_75"><a name='1464'>
  IMPLICIT NONE<a name='1465'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1466'>
  CHARACTER*(*) :: DateStr<a name='1467'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1468'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_14"><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1469'>
<a name='1470'>
  INTEGER, EXTERNAL           :: use_package<a name='1471'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1472'>
  INTEGER                     :: io_form, len_of_str<a name='1473'>
  LOGICAL                     :: for_out<a name='1474'>
  INTEGER                     :: Hndl<a name='1475'>
<a name='1476'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_259">( DEBUG_LVL, 'module_io.F: in wrf_get_previous_time' )<a name='1477'>
<a name='1478'>
  Status = 0<a name='1479'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_8"> ( Hndl, io_form , for_out, DataHandle )<a name='1480'>
  IF ( Hndl .GT. -1 ) THEN<a name='1481'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1482'>
      SELECT CASE ( use_package(io_form) )<a name='1483'>
#ifdef NETCDF<a name='1484'>
        CASE ( IO_NETCDF   )<a name='1485'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_GET_PREVIOUS_TIME'>ext_ncd_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1486'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1487'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_83">( Status, IWORDSIZE )<a name='1488'>
            len_of_str = LEN(DateStr)<a name='1489'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_8"> ( DateStr , len_of_str )<a name='1490'>
          ENDIF<a name='1491'>
#endif<a name='1492'>
#ifdef PNETCDF<a name='1493'>
        CASE ( IO_PNETCDF   )<a name='1494'>
          CALL ext_pnc_get_previous_time( Hndl, DateStr, Status )<a name='1495'>
#endif<a name='1496'>
#ifdef PIO<a name='1497'>
        CASE ( IO_PIO )<a name='1498'>
          CALL ext_pio_get_previous_time( Hndl, DateStr, Status )<a name='1499'>
#endif<a name='1500'>
#ifdef PHDF5<a name='1501'>
        CASE ( IO_PHDF5   )<a name='1502'>
          CALL ext_phdf5_get_previous_time( Hndl, DateStr, Status )<a name='1503'>
#endif<a name='1504'>
#ifdef XXX<a name='1505'>
        CASE ( IO_XXX   )<a name='1506'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_PREVIOUS_TIME'>ext_xxx_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1507'>
#endif<a name='1508'>
#ifdef YYY<a name='1509'>
        CASE ( IO_YYY   )<a name='1510'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_previous_time( Hndl, DateStr, Status )<a name='1511'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1512'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_84">( Status, IWORDSIZE )<a name='1513'>
            len_of_str = LEN(DateStr)<a name='1514'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_9"> ( DateStr , len_of_str )<a name='1515'>
         ENDIF<a name='1516'>
#endif<a name='1517'>
#ifdef ZZZ<a name='1518'>
        CASE ( IO_ZZZ   )<a name='1519'>
          CALL ext_zzz_get_previous_time( Hndl, DateStr, Status )<a name='1520'>
#endif<a name='1521'>
#ifdef GRIB1<a name='1522'>
        CASE ( IO_GRIB1   )<a name='1523'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_GET_PREVIOUS_TIME'>ext_gr1_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1524'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1525'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_85">( Status, IWORDSIZE )<a name='1526'>
            len_of_str = LEN(DateStr)<a name='1527'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_10"> ( DateStr , len_of_str )<a name='1528'>
         ENDIF<a name='1529'>
#endif<a name='1530'>
#ifdef GRIB2<a name='1531'>
        CASE ( IO_GRIB2   )<a name='1532'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_PREVIOUS_TIME'>ext_gr2_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1533'>
          IF ( .NOT. multi_files(io_form) ) THEN<a name='1534'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_86">( Status, IWORDSIZE )<a name='1535'>
            len_of_str = LEN(DateStr)<a name='1536'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_STRING'>wrf_dm_bcast_string</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_STRING_11"> ( DateStr , len_of_str )<a name='1537'>
         ENDIF<a name='1538'>
#endif<a name='1539'>
#ifdef INTIO<a name='1540'>
#endif<a name='1541'>
        CASE DEFAULT<a name='1542'>
          Status = 0<a name='1543'>
      END SELECT<a name='1544'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1545'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_GET_PREVIOUS_TIME'>wrf_quilt_get_previous_time</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_PREVIOUS_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_PREVIOUS_TIME_1">( Hndl, DateStr, Status )<a name='1546'>
    ELSE<a name='1547'>
      Status = 0<a name='1548'>
    ENDIF<a name='1549'>
  ELSE<a name='1550'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1551'>
  ENDIF<a name='1552'>
  RETURN<a name='1553'>
END SUBROUTINE wrf_get_previous_time<a name='1554'>
<a name='1555'>
<font color=#447700>!--- set_time<a name='1556'></font>
<a name='1557'>
<A NAME='WRF_SET_TIME'><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1558'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_set_time</font> ( DataHandle, DateStr, Status ),<A href='../../call_from/WRF_SET_TIME.html' TARGET='index'>13</A><a name='1559'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1560'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1561'></font>
<font color=#447700>! Sets the time stamp.  <a name='1562'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1563'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1564'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_76"><a name='1565'>
  IMPLICIT NONE<a name='1566'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1567'>
  CHARACTER*(*) :: DateStr<a name='1568'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1569'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_15"><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1570'>
<a name='1571'>
  INTEGER, EXTERNAL           :: use_package<a name='1572'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1573'>
  INTEGER                     :: io_form<a name='1574'>
  LOGICAL                     :: for_out<a name='1575'>
  INTEGER                     :: Hndl<a name='1576'>
<a name='1577'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_260">( DEBUG_LVL, 'module_io.F: in wrf_set_time' )<a name='1578'>
<a name='1579'>
  Status = 0<a name='1580'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_9"> ( Hndl, io_form , for_out, DataHandle )<a name='1581'>
  IF ( Hndl .GT. -1 ) THEN<a name='1582'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1583'>
      SELECT CASE ( use_package( io_form ) )<a name='1584'>
#ifdef NETCDF<a name='1585'>
        CASE ( IO_NETCDF   )<a name='1586'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_SET_TIME'>ext_ncd_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_SET_TIME_1">( Hndl, DateStr, Status )<a name='1587'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_87">( Status, IWORDSIZE )<a name='1588'>
#endif<a name='1589'>
#ifdef PHDF5<a name='1590'>
        CASE ( IO_PHDF5  )<a name='1591'>
          CALL ext_phdf5_set_time( Hndl, DateStr, Status )<a name='1592'>
#endif<a name='1593'>
#ifdef PNETCDF<a name='1594'>
        CASE ( IO_PNETCDF  )<a name='1595'>
          CALL ext_pnc_set_time( Hndl, DateStr, Status )<a name='1596'>
#endif<a name='1597'>
#ifdef PIO<a name='1598'>
        CASE ( IO_PIO )<a name='1599'>
          CALL ext_pio_set_time( Hndl, DateStr, Status )<a name='1600'>
#endif<a name='1601'>
#ifdef XXX<a name='1602'>
        CASE ( IO_XXX   )<a name='1603'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_SET_TIME'>ext_xxx_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_SET_TIME_1">( Hndl, DateStr, Status )<a name='1604'>
#endif<a name='1605'>
#ifdef YYY<a name='1606'>
        CASE ( IO_YYY   )<a name='1607'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_set_time( Hndl, DateStr, Status )<a name='1608'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_88">( Status, IWORDSIZE )<a name='1609'>
#endif<a name='1610'>
#ifdef ZZZ<a name='1611'>
        CASE ( IO_ZZZ   )<a name='1612'>
          CALL ext_zzz_set_time( Hndl, DateStr, Status )<a name='1613'>
#endif<a name='1614'>
#ifdef GRIB1<a name='1615'>
        CASE ( IO_GRIB1   )<a name='1616'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_SET_TIME'>ext_gr1_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_SET_TIME_1">( Hndl, DateStr, Status )<a name='1617'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_89">( Status, IWORDSIZE )<a name='1618'>
#endif<a name='1619'>
#ifdef GRIB2<a name='1620'>
        CASE ( IO_GRIB2   )<a name='1621'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_SET_TIME'>ext_gr2_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_SET_TIME_1">( Hndl, DateStr, Status )<a name='1622'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_90">( Status, IWORDSIZE )<a name='1623'>
#endif<a name='1624'>
#ifdef INTIO<a name='1625'>
        CASE ( IO_INTIO   )<a name='1626'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_set_time( Hndl, DateStr, Status )<a name='1627'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_91">( Status, IWORDSIZE )<a name='1628'>
#endif<a name='1629'>
        CASE DEFAULT<a name='1630'>
          Status = 0<a name='1631'>
      END SELECT<a name='1632'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1633'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_SET_TIME'>wrf_quilt_set_time</A><A href='../../html_code/frame/module_io.F.html#WRF_SET_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_SET_TIME_1">( Hndl, DateStr, Status )<a name='1634'>
    ELSE<a name='1635'>
      Status = 0<a name='1636'>
    ENDIF<a name='1637'>
  ELSE<a name='1638'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1639'>
  ENDIF<a name='1640'>
  RETURN<a name='1641'>
END SUBROUTINE wrf_set_time<a name='1642'>
<a name='1643'>
<font color=#447700>!--- get_next_var  (not defined for IntIO)<a name='1644'></font>
<a name='1645'>
<A NAME='WRF_GET_NEXT_VAR'><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1646'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_next_var</font> ( DataHandle, VarName, Status ),<A href='../../call_from/WRF_GET_NEXT_VAR.html' TARGET='index'>13</A><a name='1647'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1648'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1649'></font>
<font color=#447700>! On reading, this routine returns the name of the next variable in the <a name='1650'></font>
<font color=#447700>! current time frame.  <a name='1651'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1652'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1653'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_77"><a name='1654'>
  IMPLICIT NONE<a name='1655'>
  INTEGER ,       INTENT(IN)  :: DataHandle<a name='1656'>
  CHARACTER*(*) :: VarName<a name='1657'>
  INTEGER ,       INTENT(OUT) :: Status<a name='1658'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_16"><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1659'>
<a name='1660'>
  INTEGER, EXTERNAL           :: use_package<a name='1661'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1662'>
  INTEGER                     :: io_form<a name='1663'>
  LOGICAL                     :: for_out<a name='1664'>
  INTEGER                     :: Hndl<a name='1665'>
<a name='1666'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_261">( DEBUG_LVL, 'module_io.F: in wrf_get_next_var' )<a name='1667'>
<a name='1668'>
  Status = 0<a name='1669'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_10"> ( Hndl, io_form , for_out, DataHandle )<a name='1670'>
  IF ( Hndl .GT. -1 ) THEN<a name='1671'>
    IF ( multi_files( io_form ) .OR. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1672'>
      SELECT CASE ( use_package( io_form ) )<a name='1673'>
#ifdef NETCDF<a name='1674'>
        CASE ( IO_NETCDF   )<a name='1675'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_GET_NEXT_VAR'>ext_ncd_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1676'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_92">( Status, IWORDSIZE )<a name='1677'>
#endif<a name='1678'>
#ifdef XXX<a name='1679'>
        CASE ( IO_XXX   )<a name='1680'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_NEXT_VAR'>ext_xxx_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1681'>
#endif<a name='1682'>
#ifdef YYY<a name='1683'>
        CASE ( IO_YYY   )<a name='1684'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_yyy_get_next_var( Hndl, VarName, Status )<a name='1685'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_93">( Status, IWORDSIZE )<a name='1686'>
#endif<a name='1687'>
#ifdef ZZZ<a name='1688'>
        CASE ( IO_ZZZ   )<a name='1689'>
          CALL ext_zzz_get_next_var( Hndl, VarName, Status )<a name='1690'>
#endif<a name='1691'>
#ifdef GRIB1<a name='1692'>
        CASE ( IO_GRIB1   )<a name='1693'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_GET_NEXT_VAR'>ext_gr1_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1694'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_94">( Status, IWORDSIZE )<a name='1695'>
#endif<a name='1696'>
#ifdef GRIB2<a name='1697'>
        CASE ( IO_GRIB2   )<a name='1698'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_NEXT_VAR'>ext_gr2_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1699'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_95">( Status, IWORDSIZE )<a name='1700'>
#endif<a name='1701'>
#ifdef INTIO<a name='1702'>
        CASE ( IO_INTIO   )<a name='1703'>
          IF ( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) CALL ext_int_get_next_var( Hndl, VarName, Status )<a name='1704'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_96">( Status, IWORDSIZE )<a name='1705'>
#endif<a name='1706'>
        CASE DEFAULT<a name='1707'>
          Status = 0<a name='1708'>
      END SELECT<a name='1709'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1710'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_GET_NEXT_VAR'>wrf_quilt_get_next_var</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_NEXT_VAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_NEXT_VAR_1">( Hndl, VarName, Status )<a name='1711'>
    ELSE<a name='1712'>
      Status = 0<a name='1713'>
    ENDIF<a name='1714'>
  ELSE<a name='1715'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1716'>
  ENDIF<a name='1717'>
  RETURN<a name='1718'>
END SUBROUTINE wrf_get_next_var<a name='1719'>
<a name='1720'>
<a name='1721'>
<font color=#447700>! wrf_get_var_info  (not implemented for IntIO)<a name='1722'></font>
<a name='1723'>
<A NAME='WRF_GET_VAR_INFO'><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1724'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_get_var_info</font> ( DataHandle , VarName , NDim , MemoryOrder , Stagger , &amp;,<A href='../../call_from/WRF_GET_VAR_INFO.html' TARGET='index'>8</A><a name='1725'>
                              DomainStart , DomainEnd , Status )<a name='1726'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1727'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1728'></font>
<font color=#447700>! This routine applies only to a dataset that is open for read.  It returns <a name='1729'></font>
<font color=#447700>! information about a variable.  <a name='1730'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1731'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1732'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_78"><a name='1733'>
  IMPLICIT NONE<a name='1734'>
  INTEGER               ,INTENT(IN)     :: DataHandle<a name='1735'>
  CHARACTER*(*)         ,INTENT(IN)     :: VarName<a name='1736'>
  INTEGER               ,INTENT(OUT)    :: NDim<a name='1737'>
  CHARACTER*(*)         ,INTENT(OUT)    :: MemoryOrder<a name='1738'>
  CHARACTER*(*)         ,INTENT(OUT)    :: Stagger<a name='1739'>
  INTEGER ,dimension(*) ,INTENT(OUT)    :: DomainStart, DomainEnd<a name='1740'>
  INTEGER               ,INTENT(OUT)    :: Status<a name='1741'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_17"><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1742'>
  INTEGER                     :: io_form<a name='1743'>
  LOGICAL                     :: for_out<a name='1744'>
  INTEGER, EXTERNAL           :: use_package<a name='1745'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers_for<a name='1746'>
  INTEGER                     :: Hndl<a name='1747'>
<a name='1748'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_262">( DEBUG_LVL, 'module_io.F: in wrf_get_var_info' )<a name='1749'>
<a name='1750'>
  Status = 0<a name='1751'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_11"> ( Hndl, io_form , for_out, DataHandle )<a name='1752'>
  IF ( Hndl .GT. -1 ) THEN<a name='1753'>
    IF (( multi_files(io_form) .OR.  wrf_dm_on_monitor() ) .AND. .NOT. (for_out .AND. use_output_servers_for(io_form)) ) THEN<a name='1754'>
      SELECT CASE ( use_package( io_form ) )<a name='1755'>
#ifdef NETCDF<a name='1756'>
        CASE ( IO_NETCDF   )<a name='1757'>
          CALL <A href='../../html_code/io_netcdf/wrf_io.F90.html#EXT_NCD_GET_VAR_INFO'>ext_ncd_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_NCD_GET_VAR_INFO_2"> ( Hndl , VarName , NDim ,            &amp;<a name='1758'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1759'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1760'>
                                      Status )<a name='1761'>
#endif<a name='1762'>
#ifdef PHDF5<a name='1763'>
        CASE ( IO_PHDF5)<a name='1764'>
          CALL ext_phdf5_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1765'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1766'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1767'>
                                      Status )<a name='1768'>
#endif<a name='1769'>
#ifdef PNETCDF<a name='1770'>
        CASE ( IO_PNETCDF)<a name='1771'>
          CALL ext_pnc_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1772'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1773'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1774'>
                                      Status )<a name='1775'>
#endif<a name='1776'>
#ifdef PIO<a name='1777'>
        CASE ( IO_PIO )<a name='1778'>
          CALL ext_pio_get_var_info ( Hndl , VarName , NDim ,                  &amp;<a name='1779'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1780'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1781'>
                                      Status )<a name='1782'>
#endif<a name='1783'>
#ifdef XXX<a name='1784'>
        CASE ( IO_XXX )<a name='1785'>
          CALL <A href='../../html_code/frame/xxx_template_ioapi.F.html#EXT_XXX_GET_VAR_INFO'>ext_xxx_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_XXX_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1786'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1787'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1788'>
                                      Status )<a name='1789'>
#endif<a name='1790'>
#ifdef YYY<a name='1791'>
        CASE ( IO_YYY )<a name='1792'>
          CALL ext_yyy_get_var_info ( Hndl , VarName , NDim ,            &amp;<a name='1793'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1794'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1795'>
                                      Status )<a name='1796'>
#endif<a name='1797'>
#ifdef GRIB1<a name='1798'>
        CASE ( IO_GRIB1 )<a name='1799'>
          CALL <A href='../../html_code/io_grib1/io_grib1.F.html#EXT_GR1_GET_VAR_INFO'>ext_gr1_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR1_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1800'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1801'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1802'>
                                      Status )<a name='1803'>
#endif<a name='1804'>
#ifdef GRIB2<a name='1805'>
        CASE ( IO_GRIB2 )<a name='1806'>
          CALL <A href='../../html_code/io_grib2/io_grib2.F.html#EXT_GR2_GET_VAR_INFO'>ext_gr2_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="EXT_GR2_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1807'>
                                      MemoryOrder , Stagger ,                  &amp;<a name='1808'>
                                      DomainStart , DomainEnd ,                &amp;<a name='1809'>
                                      Status )<a name='1810'>
#endif<a name='1811'>
        CASE DEFAULT<a name='1812'>
          Status = 0<a name='1813'>
      END SELECT<a name='1814'>
    ELSE IF ( io_form .GT. 0 .AND. for_out .AND. use_output_servers_for(io_form) ) THEN<a name='1815'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_GET_VAR_INFO'>wrf_quilt_get_var_info</A><A href='../../html_code/frame/module_io.F.html#WRF_GET_VAR_INFO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_GET_VAR_INFO_1"> ( Hndl , VarName , NDim ,            &amp;<a name='1816'>
                                    MemoryOrder , Stagger ,                  &amp;<a name='1817'>
                                    DomainStart , DomainEnd ,                &amp;<a name='1818'>
                                    Status )<a name='1819'>
    ELSE<a name='1820'>
      Status = 0<a name='1821'>
    ENDIF<a name='1822'>
  ELSE<a name='1823'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='1824'>
  ENDIF<a name='1825'>
  RETURN<a name='1826'>
<a name='1827'>
END SUBROUTINE wrf_get_var_info<a name='1828'>
<a name='1829'>
<a name='1830'>
<a name='1831'>
<font color=#447700>!---------------------------------------------------------------------------------<a name='1832'></font>
<a name='1833'>
<a name='1834'>
<A NAME='INIT_IO_HANDLES'><A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1835'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_io_handles</font>() <A href='../../call_to/INIT_IO_HANDLES.html' TARGET='index'>2</A><a name='1836'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1837'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1838'></font>
<font color=#447700>! Initialize all I/O handles.  <a name='1839'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1840'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1841'></font>
  IMPLICIT NONE<a name='1842'>
  INTEGER i<a name='1843'>
  IF ( .NOT. is_inited ) THEN<a name='1844'>
    DO i = 1, MAX_WRF_IO_HANDLE<a name='1845'>
      wrf_io_handles(i) = -999319<a name='1846'>
    ENDDO<a name='1847'>
    is_inited = .TRUE.<a name='1848'>
  ENDIF<a name='1849'>
  RETURN<a name='1850'>
END SUBROUTINE init_io_handles<a name='1851'>
<a name='1852'>
<A NAME='ADD_NEW_HANDLE'><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1853'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>add_new_handle</font>( Hndl, Hopened, for_out, DataHandle ) <A href='../../call_to/ADD_NEW_HANDLE.html' TARGET='index'>3</A>,<A href='../../call_from/ADD_NEW_HANDLE.html' TARGET='index'>7</A><a name='1854'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1855'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1856'></font>
<font color=#447700>! Stash the package-specific I/O handle (Hndl) and return a WRF I/O handle <a name='1857'></font>
<font color=#447700>! (DataHandle).  <a name='1858'></font>
<font color=#447700>! File format ID is passed in via Hopened.  <a name='1859'></font>
<font color=#447700>! for_out will be .TRUE. if this routine was called from an <a name='1860'></font>
<font color=#447700>! open-for-read/write-begin operation and .FALSE. otherwise.  <a name='1861'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1862'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1863'></font>
  IMPLICIT NONE<a name='1864'>
  INTEGER, INTENT(IN)     :: Hndl<a name='1865'>
  INTEGER, INTENT(IN)     :: Hopened<a name='1866'>
  LOGICAL, INTENT(IN)     :: for_out<a name='1867'>
  INTEGER, INTENT(OUT)    :: DataHandle<a name='1868'>
  INTEGER i<a name='1869'>
  INTEGER, EXTERNAL       :: use_package<a name='1870'>
  LOGICAL, EXTERNAL       :: multi_files<a name='1871'>
  IF ( .NOT. is_inited ) THEN<a name='1872'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_248">( 'add_new_handle: not initialized' )<a name='1873'>
  ENDIF<a name='1874'>
  IF ( multi_files( Hopened ) ) THEN<a name='1875'>
    SELECT CASE ( use_package( Hopened ) )<a name='1876'>
#ifdef PHDF5<a name='1877'>
      CASE ( IO_PHDF5  )<a name='1878'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_249">( 'add_new_handle:  multiple output files not supported for PHDF5' )<a name='1879'>
#endif<a name='1880'>
#ifdef PNETCDF<a name='1881'>
      CASE ( IO_PNETCDF  )<a name='1882'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_250">( 'add_new_handle:  multiple output files not supported for PNETCDF' )<a name='1883'>
#endif<a name='1884'>
#ifdef PIO<a name='1885'>
      CASE ( IO_PIO )<a name='1886'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_251">( 'add_new_handle:  multiple output files not supported for PIO' )<a name='1887'>
#endif<a name='1888'>
#ifdef MCELIO<a name='1889'>
      CASE ( IO_MCEL   )<a name='1890'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_252">( 'add_new_handle:  multiple output files not supported for MCEL' )<a name='1891'>
#endif<a name='1892'>
#ifdef ESMFIO<a name='1893'>
      CASE ( IO_ESMF )<a name='1894'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_253">( 'add_new_handle:  multiple output files not supported for ESMF' )<a name='1895'>
#endif<a name='1896'>
    END SELECT<a name='1897'>
  ENDIF<a name='1898'>
  DataHandle = -1<a name='1899'>
  DO i = 1, MAX_WRF_IO_HANDLE<a name='1900'>
    IF ( wrf_io_handles(i) .EQ. -999319 ) THEN<a name='1901'>
      DataHandle = i <a name='1902'>
      wrf_io_handles(i) = Hndl<a name='1903'>
      how_opened(i)     = Hopened<a name='1904'>
      for_output(DataHandle) = for_out<a name='1905'>
      first_operation(DataHandle) = .TRUE.<a name='1906'>
      EXIT<a name='1907'>
    ENDIF<a name='1908'>
  ENDDO<a name='1909'>
  IF ( DataHandle .EQ. -1 ) THEN<a name='1910'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#ADD_NEW_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_254">( 'add_new_handle: no handles left' )<a name='1911'>
  ENDIF<a name='1912'>
  RETURN<a name='1913'>
END SUBROUTINE add_new_handle<a name='1914'>
<a name='1915'>
<A NAME='GET_HANDLE'><A href='../../html_code/frame/module_io.F.html#GET_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1916'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_handle</font> ( Hndl, Hopened, for_out, DataHandle ) <A href='../../call_to/GET_HANDLE.html' TARGET='index'>14</A>,<A href='../../call_from/GET_HANDLE.html' TARGET='index'>1</A><a name='1917'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1918'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1919'></font>
<font color=#447700>! Return the package-specific handle (Hndl) from a WRF handle <a name='1920'></font>
<font color=#447700>! (DataHandle).  <a name='1921'></font>
<font color=#447700>! Return file format ID via Hopened.  <a name='1922'></font>
<font color=#447700>! Also, for_out will be set to .TRUE. if the file was opened <a name='1923'></font>
<font color=#447700>! with an open-for-read/write-begin operation and .FALSE. <a name='1924'></font>
<font color=#447700>! otherwise.  <a name='1925'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1926'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1927'></font>
  IMPLICIT NONE<a name='1928'>
  INTEGER, INTENT(OUT)     :: Hndl<a name='1929'>
  INTEGER, INTENT(OUT)     :: Hopened<a name='1930'>
  LOGICAL, INTENT(OUT)     :: for_out<a name='1931'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1932'>
  CHARACTER*128 mess<a name='1933'>
  INTEGER i<a name='1934'>
  IF ( .NOT. is_inited ) THEN<a name='1935'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#GET_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_255">( 'module_io.F: get_handle: not initialized' )<a name='1936'>
  ENDIF<a name='1937'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1938'>
    Hndl = wrf_io_handles(DataHandle)<a name='1939'>
    Hopened = how_opened(DataHandle)<a name='1940'>
    for_out = for_output(DataHandle)<a name='1941'>
  ELSE<a name='1942'>
    Hndl = -1<a name='1943'>
  ENDIF<a name='1944'>
  RETURN<a name='1945'>
END SUBROUTINE get_handle<a name='1946'>
<a name='1947'>
<A NAME='SET_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1948'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>set_first_operation</font>( DataHandle ) <A href='../../call_to/SET_FIRST_OPERATION.html' TARGET='index'>2</A>,<A href='../../call_from/SET_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1949'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1950'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1951'></font>
<font color=#447700>! Sets internal flag to indicate that the first read or write has not yet <a name='1952'></font>
<font color=#447700>! happened for the dataset referenced by DataHandle.  <a name='1953'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1954'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1955'></font>
  IMPLICIT NONE<a name='1956'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1957'>
  IF ( .NOT. is_inited ) THEN<a name='1958'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#SET_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_256">( 'module_io.F: get_handle: not initialized' )<a name='1959'>
  ENDIF<a name='1960'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1961'>
    first_operation(DataHandle) = .TRUE.<a name='1962'>
  ENDIF<a name='1963'>
  RETURN<a name='1964'>
END SUBROUTINE set_first_operation<a name='1965'>
<a name='1966'>
<A NAME='RESET_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1967'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>reset_first_operation</font>( DataHandle ) <A href='../../call_to/RESET_FIRST_OPERATION.html' TARGET='index'>2</A>,<A href='../../call_from/RESET_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1968'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1969'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1970'></font>
<font color=#447700>! Resets internal flag to indicate that the first read or write has already <a name='1971'></font>
<font color=#447700>! happened for the dataset referenced by DataHandle.  <a name='1972'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1973'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1974'></font>
  IMPLICIT NONE<a name='1975'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1976'>
  IF ( .NOT. is_inited ) THEN<a name='1977'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_257">( 'module_io.F: get_handle: not initialized' )<a name='1978'>
  ENDIF<a name='1979'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1980'>
    first_operation(DataHandle) = .FALSE.<a name='1981'>
  ENDIF<a name='1982'>
  RETURN<a name='1983'>
END SUBROUTINE reset_first_operation<a name='1984'>
<a name='1985'>
<A NAME='IS_FIRST_OPERATION'><A href='../../html_code/frame/module_io.F.html#IS_FIRST_OPERATION' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1986'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>is_first_operation</font>( DataHandle ),<A href='../../call_from/IS_FIRST_OPERATION.html' TARGET='index'>1</A><a name='1987'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1988'></font>
<font color=#447700>!&lt;PRE&gt;<a name='1989'></font>
<font color=#447700>! Returns .TRUE. the first read or write has not yet happened for the dataset <a name='1990'></font>
<font color=#447700>! referenced by DataHandle.  <a name='1991'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='1992'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1993'></font>
  IMPLICIT NONE<a name='1994'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='1995'>
  IF ( .NOT. is_inited ) THEN<a name='1996'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#IS_FIRST_OPERATION' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_258">( 'module_io.F: get_handle: not initialized' )<a name='1997'>
  ENDIF<a name='1998'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='1999'>
    is_first_operation = first_operation(DataHandle)<a name='2000'>
  ENDIF<a name='2001'>
  RETURN<a name='2002'>
END FUNCTION is_first_operation<a name='2003'>
<a name='2004'>
<A NAME='FREE_HANDLE'><A href='../../html_code/frame/module_io.F.html#FREE_HANDLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2005'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>free_handle</font> ( DataHandle ) <A href='../../call_to/FREE_HANDLE.html' TARGET='index'>1</A>,<A href='../../call_from/FREE_HANDLE.html' TARGET='index'>1</A><a name='2006'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2007'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2008'></font>
<font color=#447700>! Trash a handle and return to "unused" pool.  <a name='2009'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2010'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2011'></font>
  IMPLICIT NONE<a name='2012'>
  INTEGER, INTENT(IN)    :: DataHandle<a name='2013'>
  INTEGER i<a name='2014'>
  IF ( .NOT. is_inited ) THEN<a name='2015'>
    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#FREE_HANDLE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_259">( 'free_handle: not initialized' )<a name='2016'>
  ENDIF<a name='2017'>
  IF ( DataHandle .GE. 1 .AND. DataHandle .LE. MAX_WRF_IO_HANDLE ) THEN<a name='2018'>
    wrf_io_handles(DataHandle) = -999319<a name='2019'>
  ENDIF<a name='2020'>
  RETURN<a name='2021'>
END SUBROUTINE free_handle<a name='2022'>
<a name='2023'>
<font color=#447700>!--------------------------------------------------------------<a name='2024'></font>
<a name='2025'>
<A NAME='INIT_MODULE_IO'><A href='../../html_code/frame/module_io.F.html#INIT_MODULE_IO' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2026'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_io</font> <A href='../../call_to/INIT_MODULE_IO.html' TARGET='index'>2</A>,<A href='../../call_from/INIT_MODULE_IO.html' TARGET='index'>1</A><a name='2027'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2028'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2029'></font>
<font color=#447700>! Initialize this module.  Must be called before any other operations are <a name='2030'></font>
<font color=#447700>! attempted.  <a name='2031'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2032'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2033'></font>
  CALL <A href='../../html_code/frame/module_io.F.html#INIT_IO_HANDLES'>init_io_handles</A><A href='../../html_code/frame/module_io.F.html#INIT_MODULE_IO' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_IO_HANDLES_2"><a name='2034'>
END SUBROUTINE init_module_io<a name='2035'>
<a name='2036'>
<A NAME='ARE_BDYS_DISTRIBUTED'><A href='../../html_code/frame/module_io.F.html#ARE_BDYS_DISTRIBUTED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2037'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>are_bdys_distributed</font>( res ) <A href='../../call_to/ARE_BDYS_DISTRIBUTED.html' TARGET='index'>2</A><a name='2038'>
  IMPLICIT NONE<a name='2039'>
  LOGICAL, INTENT(OUT) :: res<a name='2040'>
  res = bdy_dist_flag<a name='2041'>
END SUBROUTINE are_bdys_distributed<a name='2042'>
<a name='2043'>
<A NAME='BDYS_NOT_DISTRIBUTED'><A href='../../html_code/frame/module_io.F.html#BDYS_NOT_DISTRIBUTED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2044'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>bdys_not_distributed</font><a name='2045'>
  IMPLICIT NONE<a name='2046'>
  bdy_dist_flag = .FALSE.<a name='2047'>
END SUBROUTINE bdys_not_distributed<a name='2048'>
<a name='2049'>
<A NAME='BDYS_ARE_DISTRIBUTED'><A href='../../html_code/frame/module_io.F.html#BDYS_ARE_DISTRIBUTED' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2050'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>bdys_are_distributed</font><a name='2051'>
  IMPLICIT NONE<a name='2052'>
  bdy_dist_flag = .TRUE.<a name='2053'>
END SUBROUTINE bdys_are_distributed<a name='2054'>
<a name='2055'>
<A NAME='ON_STREAM'><A href='../../html_code/frame/module_io.F.html#ON_STREAM' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2056'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>on_stream</font> ( mask , switch )<a name='2057'>
  IMPLICIT NONE<a name='2058'>
  INTEGER, INTENT(IN) :: mask(*), switch<a name='2059'>
  INTEGER             :: result<a name='2060'>
<font color=#447700>! get_mask is a C routine defined in frame/pack_utils.c<a name='2061'></font>
<font color=#447700>! switch is decremented from its fortran value so it is zero based<a name='2062'></font>
  CALL get_mask( mask, switch-1, result )<a name='2063'>
  on_stream = ( result .NE. 0 )<a name='2064'>
END FUNCTION on_stream<a name='2065'>
<a name='2066'>
END MODULE module_io<a name='2067'>
<a name='2068'>
<a name='2069'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2070'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2071'></font>
<font color=#447700>! Remaining routines in this file are defined outside of the module to <a name='2072'></font>
<font color=#447700>! defeat arg/param type checking.  <a name='2073'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2074'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2075'></font>
<A NAME='WRF_READ_FIELD'><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2076'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_read_field</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_READ_FIELD.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_READ_FIELD.html' TARGET='index'>5</A><a name='2077'>
                            grid ,                                                       &amp;<a name='2078'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2079'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='2080'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='2081'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='2082'>
                            Status )<a name='2083'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2084'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2085'></font>
<font color=#447700>! Read the variable named VarName from the dataset pointed to by DataHandle.<a name='2086'></font>
<font color=#447700>! This routine is a wrapper that ensures uniform treatment of logicals across <a name='2087'></font>
<font color=#447700>! platforms by reading as integer and then converting to logical.  <a name='2088'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2089'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2090'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_79"><a name='2091'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_102"><a name='2092'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_159"><a name='2093'>
  IMPLICIT NONE<a name='2094'>
  INTEGER ,       INTENT(IN)    :: DataHandle<a name='2095'>
  CHARACTER*(*) :: DateStr<a name='2096'>
  CHARACTER*(*) :: VarName<a name='2097'>
  LOGICAL ,       INTENT(INOUT) :: Field(*)<a name='2098'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2099'>
  TYPE(domain)                                 :: grid<a name='2100'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2101'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2102'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2103'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2104'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2105'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2106'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2107'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2108'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2109'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_18"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2110'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_19"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2111'>
  INTEGER, ALLOCATABLE        :: ICAST(:)<a name='2112'>
  LOGICAL perturb_input<a name='2113'>
  IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2114'>
    ALLOCATE(ICAST((MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)))<a name='2115'>
<a name='2116'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1'>wrf_read_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_READ_FIELD1_1"> ( DataHandle , DateStr , VarName , ICAST , WRF_INTEGER ,       &amp;<a name='2117'>
                           grid ,                                                       &amp;<a name='2118'>
                           DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2119'>
                           DomainStart , DomainEnd ,                                    &amp;<a name='2120'>
                           MemoryStart , MemoryEnd ,                                    &amp;<a name='2121'>
                           PatchStart , PatchEnd ,                                      &amp;<a name='2122'>
                           Status )<a name='2123'>
    Field(1:(MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)) = ICAST == 1<a name='2124'>
    DEALLOCATE(ICAST)<a name='2125'>
  ELSE<a name='2126'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1'>wrf_read_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_READ_FIELD1_2"> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp;<a name='2127'>
                           grid ,                                                       &amp;<a name='2128'>
                           DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2129'>
                           DomainStart , DomainEnd ,                                    &amp;<a name='2130'>
                           MemoryStart , MemoryEnd ,                                    &amp;<a name='2131'>
                           PatchStart , PatchEnd ,                                      &amp;<a name='2132'>
                           Status )<a name='2133'>
    CALL nl_get_perturb_input( 1, perturb_input )<a name='2134'>
    IF ( perturb_input .AND. FieldType .EQ. WRF_FLOAT .AND. TRIM(MemoryOrder) .EQ. 'XZY' ) THEN<a name='2135'>
       CALL perturb_real ( Field, DomainStart, DomainEnd,        &amp;<a name='2136'>
                                  MemoryStart, MemoryEnd,        &amp;<a name='2137'>
                                  PatchStart, PatchEnd )<a name='2138'>
    ENDIF<a name='2139'>
  ENDIF<a name='2140'>
END SUBROUTINE wrf_read_field<a name='2141'>
<a name='2142'>
<A NAME='WRF_READ_FIELD1'><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2143'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_read_field1</font> ( DataHandle , DateStr , VarName , Field , FieldType ,        &amp; <A href='../../call_to/WRF_READ_FIELD1.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_READ_FIELD1.html' TARGET='index'>8</A><a name='2144'>
                            grid ,                                                       &amp;<a name='2145'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2146'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='2147'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='2148'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='2149'>
                            Status )<a name='2150'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2151'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2152'></font>
<font color=#447700>! Read the variable named VarName from the dataset pointed to by DataHandle.<a name='2153'></font>
<font color=#447700>! Calls ext_pkg_read_field() via call_pkg_and_dist().  <a name='2154'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2155'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2156'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_80"><a name='2157'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_103"><a name='2158'>
  USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_2"><a name='2159'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_160"><a name='2160'>
  IMPLICIT NONE<a name='2161'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='2162'>
  CHARACTER*(*) :: DateStr<a name='2163'>
  CHARACTER*(*) :: VarName<a name='2164'>
  INTEGER ,       INTENT(INOUT) :: Field(*)<a name='2165'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2166'>
  TYPE(domain)                                 :: grid<a name='2167'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2168'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2169'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2170'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2171'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2172'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2173'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2174'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2175'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2176'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_20"><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2177'>
  INTEGER                     :: io_form<a name='2178'>
  LOGICAL                     :: for_out<a name='2179'>
  INTEGER, EXTERNAL           :: use_package<a name='2180'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers, use_input_servers, use_output_servers_for<a name='2181'>
#ifdef NETCDF<a name='2182'>
  EXTERNAL     ext_ncd_read_field<a name='2183'>
#endif<a name='2184'>
#ifdef PNETCDF<a name='2185'>
  EXTERNAL     ext_pnc_read_field<a name='2186'>
#endif<a name='2187'>
#ifdef PIO<a name='2188'>
  EXTERNAL     ext_pio_read_field<a name='2189'>
#endif<a name='2190'>
#ifdef MCELIO<a name='2191'>
  EXTERNAL     ext_mcel_read_field<a name='2192'>
#endif<a name='2193'>
#ifdef ESMFIO<a name='2194'>
  EXTERNAL     ext_esmf_read_field<a name='2195'>
#endif<a name='2196'>
#ifdef INTIO<a name='2197'>
  EXTERNAL     ext_int_read_field<a name='2198'>
#endif<a name='2199'>
#ifdef XXX<a name='2200'>
  EXTERNAL ext_xxx_read_field<a name='2201'>
#endif<a name='2202'>
#ifdef YYY<a name='2203'>
  EXTERNAL ext_yyy_read_field<a name='2204'>
#endif<a name='2205'>
#ifdef GRIB1<a name='2206'>
  EXTERNAL ext_gr1_read_field<a name='2207'>
#endif<a name='2208'>
#ifdef GRIB2<a name='2209'>
  EXTERNAL ext_gr2_read_field<a name='2210'>
#endif<a name='2211'>
<a name='2212'>
  INTEGER                     :: Hndl<a name='2213'>
  INTEGER                     :: Comm <a name='2214'>
  INTEGER                     :: IOComm <a name='2215'>
<a name='2216'>
  Comm = grid%communicator<a name='2217'>
  IOComm = grid%iocommunicator<a name='2218'>
<a name='2219'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_263">( DEBUG_LVL, 'module_io.F: in wrf_read_field' )<a name='2220'>
<a name='2221'>
  Status = 0<a name='2222'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_12"> ( Hndl, io_form , for_out, DataHandle )<a name='2223'>
  CALL <A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION'>reset_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RESET_FIRST_OPERATION_1">( DataHandle )<a name='2224'>
  IF ( Hndl .GT. -1 ) THEN<a name='2225'>
    IF ( .NOT. io_form .GT. 0 ) THEN<a name='2226'>
      Status = 0 <a name='2227'>
    ELSE IF ( .NOT. use_input_servers() ) THEN<a name='2228'>
      SELECT CASE ( use_package( io_form ) )<a name='2229'>
#ifdef NETCDF<a name='2230'>
        CASE ( IO_NETCDF   )<a name='2231'>
<a name='2232'>
          CALL call_pkg_and_dist   ( ext_ncd_read_field, multi_files(io_form), .false. ,        &amp;<a name='2233'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2234'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2235'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2236'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2237'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2238'>
                                     Status )<a name='2239'>
<a name='2240'>
#endif<a name='2241'>
#ifdef PHDF5<a name='2242'>
        CASE ( IO_PHDF5)<a name='2243'>
          CALL ext_phdf5_read_field   (                   &amp;<a name='2244'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2245'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2246'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2247'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2248'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2249'>
                                     Status )<a name='2250'>
#endif<a name='2251'>
#ifdef PNETCDF<a name='2252'>
        CASE ( IO_PNETCDF)<a name='2253'>
          CALL ext_pnc_read_field   (                   &amp;<a name='2254'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2255'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2256'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2257'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2258'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2259'>
                                     Status )<a name='2260'>
#endif<a name='2261'>
#ifdef PIO<a name='2262'>
        CASE ( IO_PIO)<a name='2263'>
          CALL ext_pio_read_field(Hndl , DateStr , VarName , Field , FieldType , grid , &amp;<a name='2264'>
                                  DomainDesc , MemoryOrder , Stagger , DimNames ,       &amp;<a name='2265'>
                                  DomainStart , DomainEnd ,                             &amp;<a name='2266'>
                                  MemoryStart , MemoryEnd ,                             &amp;<a name='2267'>
                                  PatchStart , PatchEnd ,                               &amp;<a name='2268'>
                                  Status)<a name='2269'>
#endif<a name='2270'>
#ifdef MCELIO<a name='2271'>
        CASE ( IO_MCEL   )<a name='2272'>
          CALL call_pkg_and_dist   ( ext_mcel_read_field, multi_files(io_form), .true. ,         &amp;<a name='2273'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2274'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2275'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2276'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2277'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2278'>
                                     Status )<a name='2279'>
#endif<a name='2280'>
#ifdef ESMFIO<a name='2281'>
        CASE ( IO_ESMF )<a name='2282'>
          CALL ext_esmf_read_field( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2283'>
                                    DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2284'>
                                    DomainStart , DomainEnd ,                                    &amp;<a name='2285'>
                                    MemoryStart , MemoryEnd ,                                    &amp;<a name='2286'>
                                    PatchStart , PatchEnd ,                                      &amp;<a name='2287'>
                                    Status )<a name='2288'>
#endif<a name='2289'>
#ifdef XXX<a name='2290'>
        CASE ( IO_XXX )<a name='2291'>
          CALL call_pkg_and_dist   ( ext_xxx_read_field, multi_files(io_form), .false.,         &amp;<a name='2292'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2293'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2294'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2295'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2296'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2297'>
                                     Status )<a name='2298'>
#endif<a name='2299'>
#ifdef YYY<a name='2300'>
        CASE ( IO_YYY )<a name='2301'>
          CALL call_pkg_and_dist   ( ext_yyy_read_field, multi_files(io_form), .false.,         &amp;<a name='2302'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2303'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2304'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2305'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2306'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2307'>
                                     Status )<a name='2308'>
#endif<a name='2309'>
#ifdef INTIO<a name='2310'>
        CASE ( IO_INTIO )<a name='2311'>
          CALL call_pkg_and_dist   ( ext_int_read_field, multi_files(io_form), .false.,         &amp;<a name='2312'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2313'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2314'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2315'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2316'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2317'>
                                     Status )<a name='2318'>
#endif<a name='2319'>
#ifdef GRIB1<a name='2320'>
        CASE ( IO_GRIB1 )<a name='2321'>
          CALL call_pkg_and_dist   ( ext_gr1_read_field, multi_files(io_form), .false.,         &amp;<a name='2322'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2323'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2324'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2325'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2326'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2327'>
                                     Status )<a name='2328'>
#endif<a name='2329'>
#ifdef GRIB2<a name='2330'>
        CASE ( IO_GRIB2 )<a name='2331'>
          CALL call_pkg_and_dist   ( ext_gr2_read_field, multi_files(io_form), .false.,         &amp;<a name='2332'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2333'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2334'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2335'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2336'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2337'>
                                     Status )<a name='2338'>
#endif<a name='2339'>
        CASE DEFAULT<a name='2340'>
          Status = 0<a name='2341'>
      END SELECT<a name='2342'>
    ELSE<a name='2343'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#WRF_READ_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_260">('module_io.F: wrf_read_field: input_servers not implemented yet')<a name='2344'>
    ENDIF<a name='2345'>
  ELSE<a name='2346'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='2347'>
  ENDIF<a name='2348'>
  RETURN<a name='2349'>
END SUBROUTINE wrf_read_field1<a name='2350'>
<a name='2351'>
<A NAME='WRF_WRITE_FIELD'><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2352'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_write_field</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_WRITE_FIELD.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_WRITE_FIELD.html' TARGET='index'>5</A><a name='2353'>
                             grid ,                                                       &amp;<a name='2354'>
                             DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2355'>
                             DomainStart , DomainEnd ,                                    &amp;<a name='2356'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='2357'>
                             PatchStart , PatchEnd ,                                      &amp;<a name='2358'>
                             Status )<a name='2359'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2360'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2361'></font>
<font color=#447700>! Write the variable named VarName to the dataset pointed to by DataHandle.<a name='2362'></font>
<font color=#447700>! This routine is a wrapper that ensures uniform treatment of logicals across <a name='2363'></font>
<font color=#447700>! platforms by converting to integer before writing.  <a name='2364'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2365'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2366'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_81"><a name='2367'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_104"><a name='2368'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_161"><a name='2369'>
  IMPLICIT NONE<a name='2370'>
  INTEGER ,       INTENT(IN)    :: DataHandle<a name='2371'>
  CHARACTER*(*) :: DateStr<a name='2372'>
  CHARACTER*(*) :: VarName<a name='2373'>
  LOGICAL ,       INTENT(IN)    :: Field(*)<a name='2374'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2375'>
  TYPE(domain)                                 :: grid<a name='2376'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2377'>
  LOGICAL, DIMENSION(4)         ,INTENT(IN)    :: bdy_mask<a name='2378'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2379'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2380'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2381'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2382'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2383'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2384'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2385'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_21"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2386'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_22"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2387'>
  INTEGER, ALLOCATABLE        :: ICAST(:)<a name='2388'>
  IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2389'>
      ALLOCATE(ICAST((MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)))<a name='2390'>
      ICAST = 0<a name='2391'>
      WHERE ( Field(1:(MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)) )<a name='2392'>
        ICAST = 1<a name='2393'>
      END WHERE<a name='2394'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1'>wrf_write_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_WRITE_FIELD1_1"> ( DataHandle , DateStr , VarName , ICAST , WRF_INTEGER ,         &amp;<a name='2395'>
                            grid ,                                                       &amp;<a name='2396'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2397'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='2398'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='2399'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='2400'>
                            Status )<a name='2401'>
      DEALLOCATE(ICAST)<a name='2402'>
  ELSE<a name='2403'>
    CALL <A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1'>wrf_write_field1</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_WRITE_FIELD1_2"> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp;<a name='2404'>
                            grid ,                                                       &amp;<a name='2405'>
                            DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2406'>
                            DomainStart , DomainEnd ,                                    &amp;<a name='2407'>
                            MemoryStart , MemoryEnd ,                                    &amp;<a name='2408'>
                            PatchStart , PatchEnd ,                                      &amp;<a name='2409'>
                            Status )<a name='2410'>
  ENDIF<a name='2411'>
END SUBROUTINE wrf_write_field<a name='2412'>
<a name='2413'>
<A NAME='WRF_WRITE_FIELD1'><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2414'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_write_field1</font> ( DataHandle , DateStr , VarName , Field , FieldType ,         &amp; <A href='../../call_to/WRF_WRITE_FIELD1.html' TARGET='index'>2</A>,<A href='../../call_from/WRF_WRITE_FIELD1.html' TARGET='index'>17</A><a name='2415'>
                             grid ,                                                        &amp;<a name='2416'>
                             DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2417'>
                             DomainStart , DomainEnd ,                                    &amp;<a name='2418'>
                             MemoryStart , MemoryEnd ,                                    &amp;<a name='2419'>
                             PatchStart , PatchEnd ,                                      &amp;<a name='2420'>
                             Status )<a name='2421'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2422'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2423'></font>
<font color=#447700>! Write the variable named VarName to the dataset pointed to by DataHandle.<a name='2424'></font>
<font color=#447700>! Calls ext_pkg_write_field() via collect_fld_and_call_pkg().  <a name='2425'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2426'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2427'></font>
<a name='2428'>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_82"><a name='2429'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_105"><a name='2430'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_162"><a name='2431'>
  USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_3"><a name='2432'>
  IMPLICIT NONE<a name='2433'>
  INTEGER ,       INTENT(IN)    :: DataHandle <a name='2434'>
  CHARACTER*(*) :: DateStr<a name='2435'>
  CHARACTER*(*) :: VarName<a name='2436'>
  INTEGER ,       INTENT(IN)    :: Field(*)<a name='2437'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2438'>
  TYPE(domain)                                 :: grid<a name='2439'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2440'>
  LOGICAL, DIMENSION(4)         ,INTENT(IN)    :: bdy_mask<a name='2441'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2442'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2443'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2444'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2445'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2446'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2447'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2448'>
#include "<A href='../../html_code/include/wrf_status_codes.h.html'>wrf_status_codes.h</A>"<A NAME="wrf_status_codes.h_23"><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2449'>
  INTEGER, DIMENSION(3) :: starts, ends<a name='2450'>
  INTEGER               :: io_form<a name='2451'>
  CHARACTER*3 MemOrd<a name='2452'>
  LOGICAL                     :: for_out, okay_to_call<a name='2453'>
  INTEGER, EXTERNAL           :: use_package<a name='2454'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor, multi_files, use_output_servers, use_output_servers_for<a name='2455'>
#ifdef NETCDF<a name='2456'>
  EXTERNAL     ext_ncd_write_field<a name='2457'>
#endif<a name='2458'>
#ifdef PNETCDF<a name='2459'>
  EXTERNAL     ext_pnc_write_field<a name='2460'>
#endif<a name='2461'>
#ifdef PIO<a name='2462'>
  EXTERNAL     ext_pio_write_field<a name='2463'>
#endif<a name='2464'>
#ifdef MCELIO<a name='2465'>
  EXTERNAL     ext_mcel_write_field<a name='2466'>
#endif<a name='2467'>
#ifdef ESMFIO<a name='2468'>
  EXTERNAL     ext_esmf_write_field<a name='2469'>
#endif<a name='2470'>
#ifdef INTIO<a name='2471'>
  EXTERNAL     ext_int_write_field<a name='2472'>
#endif<a name='2473'>
#ifdef XXX<a name='2474'>
  EXTERNAL ext_xxx_write_field<a name='2475'>
#endif<a name='2476'>
#ifdef YYY<a name='2477'>
  EXTERNAL ext_yyy_write_field<a name='2478'>
#endif<a name='2479'>
#ifdef GRIB1<a name='2480'>
  EXTERNAL ext_gr1_write_field<a name='2481'>
#endif<a name='2482'>
#ifdef GRIB2<a name='2483'>
  EXTERNAL ext_gr2_write_field<a name='2484'>
#endif<a name='2485'>
<a name='2486'>
  INTEGER                     :: Hndl<a name='2487'>
  INTEGER                     :: Comm <a name='2488'>
  INTEGER                     :: IOComm <a name='2489'>
<a name='2490'>
  Comm = grid%communicator<a name='2491'>
  IOComm = grid%iocommunicator<a name='2492'>
<a name='2493'>
  CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_264">( DEBUG_LVL, 'module_io.F: in wrf_write_field' )<a name='2494'>
<a name='2495'>
  Status = 0<a name='2496'>
  CALL <A href='../../html_code/frame/module_io.F.html#GET_HANDLE'>get_handle</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_HANDLE_13"> ( Hndl, io_form , for_out, DataHandle )<a name='2497'>
  CALL <A href='../../html_code/frame/module_io.F.html#RESET_FIRST_OPERATION'>reset_first_operation</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="RESET_FIRST_OPERATION_2"> ( DataHandle )<a name='2498'>
  IF ( Hndl .GT. -1 ) THEN<a name='2499'>
    IF ( multi_files( io_form ) .OR. .NOT. use_output_servers_for(io_form) ) THEN<a name='2500'>
      SELECT CASE ( use_package( io_form ) )<a name='2501'>
#ifdef NETCDF<a name='2502'>
        CASE ( IO_NETCDF   )<a name='2503'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_1"> ( ext_ncd_write_field, multi_files(io_form),                  &amp;<a name='2504'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2505'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2506'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2507'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2508'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2509'>
                                     Status )<a name='2510'>
#endif<a name='2511'>
#ifdef MCELIO<a name='2512'>
        CASE ( IO_MCEL   )<a name='2513'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_2"> ( ext_mcel_write_field, multi_files(io_form),                  &amp;<a name='2514'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2515'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2516'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2517'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2518'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2519'>
                                     Status )<a name='2520'>
#endif<a name='2521'>
#ifdef ESMFIO<a name='2522'>
        CASE ( IO_ESMF )<a name='2523'>
          CALL ext_esmf_write_field( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2524'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2525'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2526'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2527'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2528'>
                                     Status )<a name='2529'>
#endif<a name='2530'>
#ifdef PHDF5<a name='2531'>
        CASE ( IO_PHDF5 )<a name='2532'>
          CALL ext_phdf5_write_field(                  &amp;<a name='2533'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2534'>
                                     DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2535'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2536'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2537'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2538'>
                                     Status )<a name='2539'>
#endif<a name='2540'>
#ifdef PNETCDF<a name='2541'>
        CASE ( IO_PNETCDF )<a name='2542'>
          CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_1">( MemoryOrder, MemOrd )<a name='2543'>
          okay_to_call = .TRUE.<a name='2544'>
          IF ((TRIM(MemOrd).EQ.'xsz' .OR. TRIM(MemOrd).EQ.'xs').AND. .NOT. bdy_mask(P_XSB)) okay_to_call = .FALSE.<a name='2545'>
          IF ((TRIM(MemOrd).EQ.'xez' .OR. TRIM(MemOrd).EQ.'xe').AND. .NOT. bdy_mask(P_XEB)) okay_to_call = .FALSE.<a name='2546'>
          IF ((TRIM(MemOrd).EQ.'ysz' .OR. TRIM(MemOrd).EQ.'ys').AND. .NOT. bdy_mask(P_YSB)) okay_to_call = .FALSE.<a name='2547'>
          IF ((TRIM(MemOrd).EQ.'yez' .OR. TRIM(MemOrd).EQ.'ye').AND. .NOT. bdy_mask(P_YEB)) okay_to_call = .FALSE.<a name='2548'>
          IF ( okay_to_call ) THEN<a name='2549'>
             starts(1:3) = PatchStart(1:3) ; ends(1:3) = PatchEnd(1:3)<a name='2550'>
          ELSE<a name='2551'>
             starts(1:3) = PatchStart(1:3) ; ends(1:3) = PatchStart(1:3)-1<a name='2552'>
          ENDIF<a name='2553'>
<a name='2554'>
               CALL ext_pnc_write_field(                  &amp;<a name='2555'>
                                       Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2556'>
                                       DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2557'>
                                       DomainStart , DomainEnd ,                                    &amp;<a name='2558'>
                                       MemoryStart , MemoryEnd ,                                    &amp;<a name='2559'>
                                       starts , ends ,                                      &amp;<a name='2560'>
                                       Status )<a name='2561'>
#endif<a name='2562'>
#ifdef PIO<a name='2563'>
        CASE ( IO_PIO )<a name='2564'>
          CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_2">( MemoryOrder, MemOrd )<a name='2565'>
          okay_to_call = .TRUE.<a name='2566'>
          IF ((TRIM(MemOrd).EQ.'xsz' .OR. TRIM(MemOrd).EQ.'xs').AND. .NOT. bdy_mask(P_XSB)) okay_to_call = .FALSE.<a name='2567'>
          IF ((TRIM(MemOrd).EQ.'xez' .OR. TRIM(MemOrd).EQ.'xe').AND. .NOT. bdy_mask(P_XEB)) okay_to_call = .FALSE.<a name='2568'>
          IF ((TRIM(MemOrd).EQ.'ysz' .OR. TRIM(MemOrd).EQ.'ys').AND. .NOT. bdy_mask(P_YSB)) okay_to_call = .FALSE.<a name='2569'>
          IF ((TRIM(MemOrd).EQ.'yez' .OR. TRIM(MemOrd).EQ.'ye').AND. .NOT. bdy_mask(P_YEB)) okay_to_call = .FALSE.<a name='2570'>
          IF ( okay_to_call ) THEN<a name='2571'>
             starts(1:3) = PatchStart(1:3) ; ends(1:3) = PatchEnd(1:3)<a name='2572'>
          ELSE<a name='2573'>
             starts(1:3) = PatchStart(1:3) ; ends(1:3) = PatchStart(1:3)-1<a name='2574'>
          ENDIF<a name='2575'>
<a name='2576'>
          CALL ext_pio_write_field( Hndl , DateStr , VarName , Field , FieldType , grid , &amp;<a name='2577'>
                                    DomainDesc , MemoryOrder , Stagger , DimNames ,       &amp;<a name='2578'>
                                    DomainStart , DomainEnd ,                             &amp;<a name='2579'>
                                    MemoryStart , MemoryEnd ,                             &amp;<a name='2580'>
                                    starts , ends , Status )<a name='2581'>
#endif<a name='2582'>
#ifdef XXX<a name='2583'>
        CASE ( IO_XXX )<a name='2584'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_3"> ( ext_xxx_write_field, multi_files(io_form),                  &amp;<a name='2585'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2586'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2587'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2588'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2589'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2590'>
                                     Status )<a name='2591'>
#endif<a name='2592'>
#ifdef YYY<a name='2593'>
        CASE ( IO_YYY )<a name='2594'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_4"> ( ext_yyy_write_field, multi_files(io_form),                  &amp;<a name='2595'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2596'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2597'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2598'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2599'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2600'>
                                     Status )<a name='2601'>
#endif<a name='2602'>
#ifdef GRIB1<a name='2603'>
        CASE ( IO_GRIB1 )<a name='2604'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_5"> ( ext_gr1_write_field, multi_files(io_form),                  &amp;<a name='2605'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2606'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2607'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2608'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2609'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2610'>
                                     Status )<a name='2611'>
#endif<a name='2612'>
#ifdef GRIB2<a name='2613'>
        CASE ( IO_GRIB2 )<a name='2614'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_6"> ( ext_gr2_write_field, multi_files(io_form),                  &amp;<a name='2615'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2616'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2617'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2618'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2619'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2620'>
                                     Status )<a name='2621'>
#endif<a name='2622'>
#ifdef INTIO<a name='2623'>
        CASE ( IO_INTIO )<a name='2624'>
          CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG'>collect_fld_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_FLD_AND_CALL_PKG_7"> ( ext_int_write_field, multi_files(io_form),                  &amp;<a name='2625'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2626'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2627'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2628'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2629'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2630'>
                                     Status )<a name='2631'>
#endif<a name='2632'>
        CASE DEFAULT<a name='2633'>
          Status = 0<a name='2634'>
      END SELECT<a name='2635'>
    ELSE IF ( use_output_servers_for(io_form) ) THEN<a name='2636'>
      IF ( io_form .GT. 0 ) THEN<a name='2637'>
      CALL <A href='../../html_code/frame/module_io_quilt_old.F.html#WRF_QUILT_WRITE_FIELD'>wrf_quilt_write_field</A><A href='../../html_code/frame/module_io.F.html#WRF_WRITE_FIELD1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_QUILT_WRITE_FIELD_1"> ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2638'>
                                   DomainDesc , MemoryOrder , Stagger , DimNames ,              &amp;<a name='2639'>
                                   DomainStart , DomainEnd ,                                    &amp;<a name='2640'>
                                   MemoryStart , MemoryEnd ,                                    &amp;<a name='2641'>
                                   PatchStart , PatchEnd ,                                      &amp;<a name='2642'>
                                   Status )<a name='2643'>
      ENDIF<a name='2644'>
    ENDIF<a name='2645'>
  ELSE<a name='2646'>
    Status = WRF_ERR_FATAL_BAD_FILE_STATUS<a name='2647'>
  ENDIF<a name='2648'>
  RETURN<a name='2649'>
END SUBROUTINE wrf_write_field1<a name='2650'>
<a name='2651'>
<A NAME='GET_VALUE_FROM_PAIRS'><A href='../../html_code/frame/module_io.F.html#GET_VALUE_FROM_PAIRS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2652'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_value_from_pairs</font> ( varname , str , retval ) <A href='../../call_to/GET_VALUE_FROM_PAIRS.html' TARGET='index'>3</A><a name='2653'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2654'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2655'></font>
<font color=#447700>! parse comma separated list of VARIABLE=VALUE strings and return the<a name='2656'></font>
<font color=#447700>! value for the matching variable if such exists, otherwise return<a name='2657'></font>
<font color=#447700>! the empty string<a name='2658'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2659'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2660'></font>
  IMPLICIT NONE<a name='2661'>
  CHARACTER*(*) ::    varname<a name='2662'>
  CHARACTER*(*) ::    str<a name='2663'>
  CHARACTER*(*) ::    retval<a name='2664'>
<a name='2665'>
  CHARACTER (256) varstr, tstr<a name='2666'>
  INTEGER i,j,n,varstrn<a name='2667'>
  LOGICAL nobreak, nobreakouter<a name='2668'>
<a name='2669'>
  varstr = TRIM(varname)//"="<a name='2670'>
  varstrn = len(TRIM(varstr))<a name='2671'>
  n = len(str)<a name='2672'>
  retval = ""<a name='2673'>
  i = 1<a name='2674'>
  nobreakouter = .TRUE.<a name='2675'>
  DO WHILE ( nobreakouter )<a name='2676'>
    j = 1<a name='2677'>
    nobreak = .TRUE.<a name='2678'>
    tstr = ""<a name='2679'>
<font color=#447700>! Potential for out of bounds array ref on str(i:i) for i &gt; n; reported by jedwards<a name='2680'></font>
<font color=#447700>!    DO WHILE ( nobreak )<a name='2681'></font>
<font color=#447700>!      IF ( str(i:i) .NE. ',' .AND. i .LE. n ) THEN<a name='2682'></font>
<font color=#447700>!        tstr(j:j) = str(i:i)<a name='2683'></font>
<font color=#447700>!      ELSE<a name='2684'></font>
<font color=#447700>!        nobreak = .FALSE.<a name='2685'></font>
<font color=#447700>!      ENDIF<a name='2686'></font>
<font color=#447700>!      j = j + 1<a name='2687'></font>
<font color=#447700>!      i = i + 1<a name='2688'></font>
<font color=#447700>!    ENDDO<a name='2689'></font>
<font color=#447700>! fix 20021112, JM<a name='2690'></font>
    DO WHILE ( nobreak )<a name='2691'>
      nobreak = .FALSE.<a name='2692'>
      IF ( i .LE. n ) THEN<a name='2693'>
        IF (str(i:i) .NE. ',' ) THEN<a name='2694'>
           tstr(j:j) = str(i:i)<a name='2695'>
           nobreak = .TRUE.<a name='2696'>
        ENDIF<a name='2697'>
      ENDIF<a name='2698'>
      j = j + 1<a name='2699'>
      i = i + 1<a name='2700'>
    ENDDO<a name='2701'>
    IF ( i .GT. n ) nobreakouter = .FALSE.<a name='2702'>
    IF ( varstr(1:varstrn) .EQ. tstr(1:varstrn) ) THEN<a name='2703'>
      retval(1:) = TRIM(tstr(varstrn+1:))<a name='2704'>
      nobreakouter = .FALSE.<a name='2705'>
    ENDIF<a name='2706'>
  ENDDO<a name='2707'>
  RETURN<a name='2708'>
END SUBROUTINE get_value_from_pairs<a name='2709'>
<a name='2710'>
<A NAME='MULTI_FILES'><A href='../../html_code/frame/module_io.F.html#MULTI_FILES' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2711'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>multi_files</font> ( io_form )<a name='2712'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2713'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2714'></font>
<font color=#447700>! Returns .TRUE. iff io_form is a multi-file format.  A multi-file format <a name='2715'></font>
<font color=#447700>! results in one file for each compute process and can be used with any <a name='2716'></font>
<font color=#447700>! I/O package.  A multi-file dataset can only be read by the same number <a name='2717'></font>
<font color=#447700>! of tasks that were used to write it.  This feature can be useful for <a name='2718'></font>
<font color=#447700>! speeding up restarts on machines that support efficient parallel I/O.  <a name='2719'></font>
<font color=#447700>! Multi-file formats cannot be used with I/O quilt servers.  <a name='2720'></font>
<font color=#447700>!<a name='2721'></font>
<font color=#447700>! Note: multi-file is selected by adding 100 to the standard WRF I/O<a name='2722'></font>
<font color=#447700>! form.  If you add 200 instead, then single-file I/O is still done,<a name='2723'></font>
<font color=#447700>! but without I/O servers.<a name='2724'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2725'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2726'></font>
  IMPLICIT NONE<a name='2727'>
  INTEGER, INTENT(IN) :: io_form<a name='2728'>
#ifdef DM_PARALLEL<a name='2729'>
  multi_files = ( io_form &gt;= 100 .and. io_form&lt;200 )<a name='2730'>
#else<a name='2731'>
  multi_files = .FALSE.<a name='2732'>
#endif<a name='2733'>
END FUNCTION multi_files<a name='2734'>
<a name='2735'>
<A NAME='USE_PACKAGE'><A href='../../html_code/frame/module_io.F.html#USE_PACKAGE' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2736'>
INTEGER <font color=#993300>FUNCTION </font><font color=#cc0000>use_package</font> ( io_form )<a name='2737'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2738'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2739'></font>
<font color=#447700>! Returns the ID of the external I/O package referenced by io_form.  <a name='2740'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2741'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2742'></font>
  IMPLICIT NONE<a name='2743'>
  INTEGER, INTENT(IN) :: io_form<a name='2744'>
  use_package = MOD( io_form, 100 )<a name='2745'>
END FUNCTION use_package<a name='2746'>
<a name='2747'>
<a name='2748'>
<A NAME='COLLECT_FLD_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2749'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_fld_and_call_pkg</font> (    fcn, donotcollect_arg,                                       &amp; <A href='../../call_to/COLLECT_FLD_AND_CALL_PKG.html' TARGET='index'>7</A>,<A href='../../call_from/COLLECT_FLD_AND_CALL_PKG.html' TARGET='index'>6</A><a name='2750'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2751'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2752'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2753'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2754'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2755'>
                                     Status )<a name='2756'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2757'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2758'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2759'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2760'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2761'></font>
<font color=#447700>! This routine handle cases where collection can be skipped and deals with <a name='2762'></font>
<font color=#447700>! different data types for Field.  <a name='2763'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2764'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2765'></font>
  IMPLICIT NONE<a name='2766'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_24"><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='2767'>
  EXTERNAL fcn<a name='2768'>
  LOGICAL,        INTENT(IN)    :: donotcollect_arg<a name='2769'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2770'>
  CHARACTER*(*) :: DateStr<a name='2771'>
  CHARACTER*(*) :: VarName<a name='2772'>
  INTEGER ,       INTENT(IN)    :: Field(*)<a name='2773'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2774'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2775'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2776'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2777'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2778'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2779'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2780'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2781'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2782'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2783'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2784'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='2785'>
  LOGICAL donotcollect<a name='2786'>
  INTEGER ndims, nproc<a name='2787'>
<a name='2788'>
  CALL <A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER'>dim_from_memorder</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIM_FROM_MEMORDER_1">( MemoryOrder , ndims)<a name='2789'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_14">( nproc )<a name='2790'>
  donotcollect = donotcollect_arg .OR. (nproc .EQ. 1)<a name='2791'>
<a name='2792'>
  IF ( donotcollect ) THEN<a name='2793'>
<a name='2794'>
    CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2795'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,                &amp;<a name='2796'>
               DomainStart , DomainEnd ,                                      &amp;<a name='2797'>
               MemoryStart , MemoryEnd ,                                      &amp;<a name='2798'>
               PatchStart , PatchEnd ,                                        &amp;<a name='2799'>
               Status )<a name='2800'>
<a name='2801'>
  ELSE IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='2802'>
<a name='2803'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG'>collect_double_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_DOUBLE_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2804'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2805'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2806'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2807'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2808'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2809'>
               Status )<a name='2810'>
<a name='2811'>
  ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='2812'>
<a name='2813'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG'>collect_real_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_REAL_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2814'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2815'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2816'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2817'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2818'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2819'>
               Status )<a name='2820'>
<a name='2821'>
  ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='2822'>
<a name='2823'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG'>collect_int_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_INT_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2824'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2825'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2826'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2827'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2828'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2829'>
               Status )<a name='2830'>
<a name='2831'>
  ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='2832'>
<a name='2833'>
     CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG'>collect_logical_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_FLD_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_LOGICAL_AND_CALL_PKG_1"> ( fcn,                                        &amp;<a name='2834'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2835'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='2836'>
               DomainStart , DomainEnd ,                                    &amp;<a name='2837'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='2838'>
               PatchStart , PatchEnd ,                                      &amp;<a name='2839'>
               Status )<a name='2840'>
<a name='2841'>
  ENDIF<a name='2842'>
  RETURN<a name='2843'>
END SUBROUTINE collect_fld_and_call_pkg<a name='2844'>
<a name='2845'>
<A NAME='COLLECT_REAL_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2846'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_real_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_REAL_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_REAL_AND_CALL_PKG.html' TARGET='index'>3</A><a name='2847'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2848'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2849'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2850'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2851'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2852'>
                                     Status )<a name='2853'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2854'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2855'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2856'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2857'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2858'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big real buffer and <a name='2859'></font>
<font color=#447700>! pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='2860'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2861'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2862'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_83"><a name='2863'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_32"><a name='2864'>
  IMPLICIT NONE<a name='2865'>
  EXTERNAL fcn<a name='2866'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2867'>
  CHARACTER*(*) :: DateStr<a name='2868'>
  CHARACTER*(*) :: VarName<a name='2869'>
  REAL    ,       INTENT(IN)    :: Field(*)<a name='2870'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2871'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2872'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2873'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2874'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2875'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2876'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2877'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2878'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2879'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2880'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2881'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2882'>
  REAL, ALLOCATABLE :: globbuf (:)<a name='2883'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2884'>
<a name='2885'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2886'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2887'>
  ELSE<a name='2888'>
    ALLOCATE( globbuf( 1 ) )<a name='2889'>
  ENDIF<a name='2890'>
<a name='2891'>
#ifdef DEREF_KLUDGE<a name='2892'>
# define FRSTELEM (1)<a name='2893'>
#else<a name='2894'>
# define FRSTELEM<a name='2895'>
#endif<a name='2896'>
  <a name='2897'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_REAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_1"> (   fcn, globbuf FRSTELEM,                                    &amp;<a name='2898'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2899'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2900'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2901'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2902'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2903'>
                                     Status )<a name='2904'>
  DEALLOCATE ( globbuf )<a name='2905'>
  RETURN<a name='2906'>
<a name='2907'>
END SUBROUTINE collect_real_and_call_pkg<a name='2908'>
<a name='2909'>
<A NAME='COLLECT_INT_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2910'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_int_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_INT_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_INT_AND_CALL_PKG.html' TARGET='index'>3</A><a name='2911'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2912'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2913'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2914'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2915'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2916'>
                                     Status )<a name='2917'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2918'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2919'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2920'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2921'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2922'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big integer buffer and <a name='2923'></font>
<font color=#447700>! pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='2924'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2925'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2926'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_84"><a name='2927'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_33"><a name='2928'>
  IMPLICIT NONE<a name='2929'>
  EXTERNAL fcn<a name='2930'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2931'>
  CHARACTER*(*) :: DateStr<a name='2932'>
  CHARACTER*(*) :: VarName<a name='2933'>
  INTEGER    ,       INTENT(IN)    :: Field(*)<a name='2934'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2935'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2936'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2937'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2938'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2939'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2940'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='2941'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='2942'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='2943'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='2944'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='2945'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='2946'>
  INTEGER, ALLOCATABLE :: globbuf (:)<a name='2947'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='2948'>
<a name='2949'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='2950'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='2951'>
  ELSE<a name='2952'>
    ALLOCATE( globbuf( 1 ) )<a name='2953'>
  ENDIF<a name='2954'>
<a name='2955'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_INT_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_2"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='2956'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2957'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2958'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2959'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2960'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2961'>
                                     Status )<a name='2962'>
  DEALLOCATE ( globbuf )<a name='2963'>
  RETURN<a name='2964'>
<a name='2965'>
END SUBROUTINE collect_int_and_call_pkg<a name='2966'>
<a name='2967'>
<A NAME='COLLECT_DOUBLE_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2968'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_double_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_DOUBLE_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_DOUBLE_AND_CALL_PKG.html' TARGET='index'>3</A><a name='2969'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='2970'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='2971'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='2972'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='2973'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='2974'>
                                     Status )<a name='2975'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='2976'></font>
<font color=#447700>!&lt;PRE&gt;<a name='2977'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='2978'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='2979'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='2980'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big double precision <a name='2981'></font>
<font color=#447700>! buffer and pass it down to collect_generic_and_call_pkg() to do the <a name='2982'></font>
<font color=#447700>! actual work.  <a name='2983'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='2984'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='2985'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_85"><a name='2986'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_34"><a name='2987'>
  IMPLICIT NONE<a name='2988'>
  EXTERNAL fcn<a name='2989'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='2990'>
  CHARACTER*(*) :: DateStr<a name='2991'>
  CHARACTER*(*) :: VarName<a name='2992'>
  DOUBLE PRECISION    ,       INTENT(IN)    :: Field(*)<a name='2993'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='2994'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='2995'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='2996'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='2997'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='2998'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='2999'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3000'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3001'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3002'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3003'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3004'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3005'>
  DOUBLE PRECISION, ALLOCATABLE :: globbuf (:)<a name='3006'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='3007'>
<a name='3008'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3009'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3010'>
  ELSE<a name='3011'>
    ALLOCATE( globbuf( 1 ) )<a name='3012'>
  ENDIF<a name='3013'>
<a name='3014'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_DOUBLE_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_3"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='3015'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3016'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='3017'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3018'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3019'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3020'>
                                     Status )<a name='3021'>
  DEALLOCATE ( globbuf )<a name='3022'>
  RETURN<a name='3023'>
<a name='3024'>
END SUBROUTINE collect_double_and_call_pkg<a name='3025'>
<a name='3026'>
<A NAME='COLLECT_LOGICAL_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3027'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_logical_and_call_pkg</font> (   fcn,                                                     &amp; <A href='../../call_to/COLLECT_LOGICAL_AND_CALL_PKG.html' TARGET='index'>1</A>,<A href='../../call_from/COLLECT_LOGICAL_AND_CALL_PKG.html' TARGET='index'>3</A><a name='3028'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3029'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='3030'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3031'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3032'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3033'>
                                     Status )<a name='3034'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3035'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3036'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='3037'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='3038'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='3039'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big logical buffer <a name='3040'></font>
<font color=#447700>! and pass it down to collect_generic_and_call_pkg() to do the actual work.  <a name='3041'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3042'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3043'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_86"><a name='3044'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_35"><a name='3045'>
  IMPLICIT NONE<a name='3046'>
  EXTERNAL fcn<a name='3047'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3048'>
  CHARACTER*(*) :: DateStr<a name='3049'>
  CHARACTER*(*) :: VarName<a name='3050'>
  LOGICAL    ,       INTENT(IN)    :: Field(*)<a name='3051'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3052'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3053'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3054'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3055'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3056'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3057'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3058'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3059'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3060'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3061'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3062'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3063'>
  LOGICAL, ALLOCATABLE :: globbuf (:)<a name='3064'>
  LOGICAL, EXTERNAL           :: wrf_dm_on_monitor<a name='3065'>
<a name='3066'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3067'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3068'>
  ELSE<a name='3069'>
    ALLOCATE( globbuf( 1 ) )<a name='3070'>
  ENDIF<a name='3071'>
<a name='3072'>
  CALL <A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG'>collect_generic_and_call_pkg</A><A href='../../html_code/frame/module_io.F.html#COLLECT_LOGICAL_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="COLLECT_GENERIC_AND_CALL_PKG_4"> (   fcn, globbuf FRSTELEM ,                                   &amp;<a name='3073'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3074'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='3075'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3076'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3077'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3078'>
                                     Status )<a name='3079'>
  DEALLOCATE ( globbuf )<a name='3080'>
  RETURN<a name='3081'>
<a name='3082'>
END SUBROUTINE collect_logical_and_call_pkg<a name='3083'>
<a name='3084'>
<a name='3085'>
<A NAME='COLLECT_GENERIC_AND_CALL_PKG'><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3086'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>collect_generic_and_call_pkg</font> ( fcn, globbuf,                                           &amp; <A href='../../call_to/COLLECT_GENERIC_AND_CALL_PKG.html' TARGET='index'>4</A>,<A href='../../call_from/COLLECT_GENERIC_AND_CALL_PKG.html' TARGET='index'>23</A><a name='3087'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3088'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,    &amp;<a name='3089'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3090'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3091'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3092'>
                                     Status )<a name='3093'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3094'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3095'></font>
<font color=#447700>! The collect_*_and_call_pkg routines collect a distributed array onto one <a name='3096'></font>
<font color=#447700>! processor and then call an I/O function to write the result (or in the <a name='3097'></font>
<font color=#447700>! case of replicated data simply write monitor node's copy of the data)<a name='3098'></font>
<font color=#447700>! This routine calls the distributed memory communication routines that <a name='3099'></font>
<font color=#447700>! collect the array and then calls I/O function fcn to write it to disk.  <a name='3100'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3101'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3102'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_87"><a name='3103'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_36"><a name='3104'>
  IMPLICIT NONE<a name='3105'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_25"><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3106'>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined(STUBMPI)<a name='3107'></font>
include "<A href='../../html_code/include/mpif.h.html'>mpif.h</A>"<A NAME="mpif.h_26"><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3108'>
#endif<a name='3109'>
  EXTERNAL fcn<a name='3110'>
  REAL , DIMENSION(*) , INTENT(INOUT) :: globbuf<a name='3111'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3112'>
  CHARACTER*(*) :: DateStr<a name='3113'>
  CHARACTER*(*) :: VarName<a name='3114'>
  REAL    ,       INTENT(IN)    :: Field(*)<a name='3115'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3116'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3117'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3118'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3119'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3120'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3121'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3122'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3123'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3124'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3125'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3126'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='3127'>
  CHARACTER*3 MemOrd<a name='3128'>
  LOGICAL, EXTERNAL :: has_char<a name='3129'>
  INTEGER ids, ide, jds, jde, kds, kde<a name='3130'>
  INTEGER ims, ime, jms, jme, kms, kme<a name='3131'>
  INTEGER ips, ipe, jps, jpe, kps, kpe<a name='3132'>
  INTEGER, ALLOCATABLE :: counts(:), displs(:)<a name='3133'>
  INTEGER nproc, communicator, mpi_bdyslice_type, ierr, my_displ<a name='3134'>
  INTEGER my_count<a name='3135'>
  INTEGER , dimension(3)                       :: dom_end_rev<a name='3136'>
  LOGICAL, EXTERNAL         :: wrf_dm_on_monitor<a name='3137'>
  INTEGER, EXTERNAL         :: wrf_dm_monitor_rank<a name='3138'>
  LOGICAL     distributed_field<a name='3139'>
  INTEGER i,j,k,idx,lx,idx2,lx2<a name='3140'>
  INTEGER collective_root<a name='3141'>
<a name='3142'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_15">( nproc )<a name='3143'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_DM_COMMUNICATOR'>wrf_get_dm_communicator</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_DM_COMMUNICATOR_45"> ( communicator )<a name='3144'>
<a name='3145'>
  ALLOCATE( counts( nproc ) )<a name='3146'>
  ALLOCATE( displs( nproc ) )<a name='3147'>
  CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_3">( MemoryOrder, MemOrd )<a name='3148'>
<a name='3149'>
  collective_root = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MONITOR_RANK'>wrf_dm_monitor_rank</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MONITOR_RANK_1">()<a name='3150'>
<a name='3151'>
  dom_end_rev(1) = DomainEnd(1)<a name='3152'>
  dom_end_rev(2) = DomainEnd(2)<a name='3153'>
  dom_end_rev(3) = DomainEnd(3)<a name='3154'>
<a name='3155'>
  SELECT CASE (TRIM(MemOrd))<a name='3156'>
    CASE (  'xzy' )<a name='3157'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3158'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3159'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3160'>
    CASE (  'zxy' )<a name='3161'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3162'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3163'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3164'>
    CASE (  'xyz' )<a name='3165'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3166'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3167'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3168'>
    CASE (  'xy' )<a name='3169'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3170'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3171'>
    CASE (  'yxz' )<a name='3172'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3173'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3174'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3175'>
    CASE (  'yx' )<a name='3176'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3177'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3178'>
    CASE DEFAULT<a name='3179'>
      <font color=#447700>! do nothing; the boundary orders and others either dont care or set themselves<a name='3180'></font>
  END SELECT<a name='3181'>
<a name='3182'>
  SELECT CASE (TRIM(MemOrd))<a name='3183'>
#ifndef STUBMPI<a name='3184'>
    CASE (  'xzy','zxy','xyz','yxz','xy','yx' )<a name='3185'>
<a name='3186'>
      distributed_field = .TRUE.<a name='3187'>
      IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3188'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_DOUBLE'>wrf_patch_to_global_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_DOUBLE_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3189'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3190'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3191'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3192'>
      ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='3193'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_REAL'>wrf_patch_to_global_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_REAL_9"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3194'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3195'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3196'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3197'>
      ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3198'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_INTEGER'>wrf_patch_to_global_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_INTEGER_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3199'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3200'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3201'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3202'>
      ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3203'>
        CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_LOGICAL'>wrf_patch_to_global_logical</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_LOGICAL_1"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3204'>
           DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3205'>
           MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3206'>
           PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3207'>
      ENDIF<a name='3208'>
<a name='3209'>
#if defined(DM_PARALLEL) &amp;&amp; <font color=#447700>!defined(STUBMPI)<a name='3210'></font>
    CASE ( 'xsz', 'xez' )<a name='3211'>
      distributed_field = .FALSE.<a name='3212'>
      IF ( nproc .GT. 1 ) THEN<a name='3213'>
        jds = DomainStart(1) ; jde = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) jde = jde+1  <font color=#447700>! ns strip<a name='3214'></font>
        kds = DomainStart(2) ; kde = DomainEnd(2) ; IF ( .NOT. has_char( Stagger, 'z' ) ) kde = kde+1  <font color=#447700>! levels<a name='3215'></font>
        ids = DomainStart(3) ; ide = DomainEnd(3) ; <font color=#447700>!  bdy_width<a name='3216'></font>
        dom_end_rev(1) = jde<a name='3217'>
        dom_end_rev(2) = kde<a name='3218'>
        dom_end_rev(3) = ide<a name='3219'>
        distributed_field = .TRUE.<a name='3220'>
        IF ( (MemOrd .eq. 'xsz' .AND. bdy_mask( P_XSB )) .OR.     &amp;<a name='3221'>
             (MemOrd .eq. 'xez' .AND. bdy_mask( P_XEB ))       ) THEN<a name='3222'>
          my_displ = PatchStart(1)-1<a name='3223'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='3224'>
        ELSE<a name='3225'>
          my_displ = 0<a name='3226'>
          my_count = 0<a name='3227'>
        ENDIF<a name='3228'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3229'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3230'>
        do i = DomainStart(3),DomainEnd(3)    <font color=#447700>! bdy_width<a name='3231'></font>
        do k = DomainStart(2),DomainEnd(2)    <font color=#447700>! levels<a name='3232'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='3233'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='3234'>
           idx  = lx*((k-1)+(i-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='3235'>
           idx2 = lx2*((k-1)+(i-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='3236'>
           IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='3237'>
<a name='3238'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_DOUBLE'>wrf_gatherv_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_DOUBLE_1"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3239'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3240'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3241'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3242'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3243'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3244'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3245'></font>
                             ierr )<a name='3246'>
<a name='3247'>
           ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='3248'>
<a name='3249'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_REAL'>wrf_gatherv_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_REAL_1"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3250'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3251'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3252'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3253'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3254'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3255'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3256'></font>
                             ierr )<a name='3257'>
<a name='3258'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3259'>
<a name='3260'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_INTEGER'>wrf_gatherv_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_INTEGER_1"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3261'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3262'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3263'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3264'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3265'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3266'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3267'></font>
                             ierr )<a name='3268'>
           ENDIF<a name='3269'>
<a name='3270'>
        enddo<a name='3271'>
        enddo<a name='3272'>
      ENDIF<a name='3273'>
    CASE ( 'xs', 'xe' )<a name='3274'>
      distributed_field = .FALSE.<a name='3275'>
      IF ( nproc .GT. 1 ) THEN<a name='3276'>
        jds = DomainStart(1) ; jde = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) jde = jde+1  <font color=#447700>! ns strip<a name='3277'></font>
        ids = DomainStart(2) ; ide = DomainEnd(2) ; <font color=#447700>!  bdy_width<a name='3278'></font>
        dom_end_rev(1) = jde<a name='3279'>
        dom_end_rev(2) = ide<a name='3280'>
        distributed_field = .TRUE.<a name='3281'>
        IF ( (MemOrd .eq. 'xs' .AND. bdy_mask( P_XSB )) .OR.     &amp;<a name='3282'>
             (MemOrd .eq. 'xe' .AND. bdy_mask( P_XEB ))       ) THEN<a name='3283'>
          my_displ = PatchStart(1)-1<a name='3284'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='3285'>
        ELSE<a name='3286'>
          my_displ = 0<a name='3287'>
          my_count = 0<a name='3288'>
        ENDIF<a name='3289'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3290'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3291'>
        do i = DomainStart(2),DomainEnd(2)    <font color=#447700>! bdy_width<a name='3292'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='3293'>
           idx  = lx*(i-1)<a name='3294'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='3295'>
           idx2 = lx2*(i-1)<a name='3296'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3297'>
<a name='3298'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_DOUBLE'>wrf_gatherv_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_DOUBLE_2"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3299'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3300'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3301'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3302'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3303'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3304'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3305'></font>
                             ierr )<a name='3306'>
<a name='3307'>
           ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='3308'>
<a name='3309'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_REAL'>wrf_gatherv_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_REAL_2"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3310'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3311'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3312'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3313'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3314'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3315'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3316'></font>
                             ierr )<a name='3317'>
<a name='3318'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3319'>
<a name='3320'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_INTEGER'>wrf_gatherv_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_INTEGER_2"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx , &amp;<a name='3321'>
                             my_count ,                       &amp;    <font color=#447700>! sendcount<a name='3322'></font>
                             globbuf, 1+idx2 ,                &amp;    <font color=#447700>! recvbuf<a name='3323'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3324'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3325'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3326'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3327'></font>
                             ierr )<a name='3328'>
           ENDIF<a name='3329'>
<a name='3330'>
        enddo<a name='3331'>
      ENDIF<a name='3332'>
    CASE ( 'ysz', 'yez' )<a name='3333'>
      distributed_field = .FALSE.<a name='3334'>
      IF ( nproc .GT. 1 ) THEN<a name='3335'>
        ids = DomainStart(1) ; ide = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) ide = ide+1  <font color=#447700>! ns strip<a name='3336'></font>
        kds = DomainStart(2) ; kde = DomainEnd(2) ; IF ( .NOT. has_char( Stagger, 'z' ) ) kde = kde+1  <font color=#447700>! levels<a name='3337'></font>
        jds = DomainStart(3) ; jde = DomainEnd(3) ; <font color=#447700>!  bdy_width<a name='3338'></font>
        dom_end_rev(1) = ide<a name='3339'>
        dom_end_rev(2) = kde<a name='3340'>
        dom_end_rev(3) = jde<a name='3341'>
        distributed_field = .TRUE.<a name='3342'>
        IF ( (MemOrd .eq. 'ysz' .AND. bdy_mask( P_YSB )) .OR.     &amp;<a name='3343'>
             (MemOrd .eq. 'yez' .AND. bdy_mask( P_YEB ))       ) THEN<a name='3344'>
          my_displ = PatchStart(1)-1<a name='3345'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='3346'>
        ELSE<a name='3347'>
          my_displ = 0<a name='3348'>
          my_count = 0<a name='3349'>
        ENDIF<a name='3350'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3351'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3352'>
        do j = DomainStart(3),DomainEnd(3)    <font color=#447700>! bdy_width<a name='3353'></font>
        do k = DomainStart(2),DomainEnd(2)    <font color=#447700>! levels<a name='3354'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='3355'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='3356'>
           idx  = lx*((k-1)+(j-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='3357'>
           idx2 = lx2*((k-1)+(j-1)*(MemoryEnd(2)-MemoryStart(2)+1))<a name='3358'>
<a name='3359'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='3360'>
<a name='3361'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_DOUBLE'>wrf_gatherv_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_DOUBLE_3"> ( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3362'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3363'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3364'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3365'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3366'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3367'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3368'></font>
                             ierr )<a name='3369'>
<a name='3370'>
           ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='3371'>
<a name='3372'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_REAL'>wrf_gatherv_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_REAL_3">( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3373'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3374'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3375'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3376'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3377'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3378'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3379'></font>
                             ierr )<a name='3380'>
<a name='3381'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3382'>
<a name='3383'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_INTEGER'>wrf_gatherv_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_INTEGER_3">( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3384'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3385'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3386'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3387'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3388'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3389'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3390'></font>
                             ierr )<a name='3391'>
           ENDIF<a name='3392'>
<a name='3393'>
        enddo<a name='3394'>
        enddo<a name='3395'>
      ENDIF<a name='3396'>
    CASE ( 'ys', 'ye' )<a name='3397'>
      distributed_field = .FALSE.<a name='3398'>
      IF ( nproc .GT. 1 ) THEN<a name='3399'>
        ids = DomainStart(1) ; ide = DomainEnd(1) ; IF ( .NOT. has_char( Stagger, 'y' ) ) ide = ide+1  <font color=#447700>! ns strip<a name='3400'></font>
        jds = DomainStart(2) ; jde = DomainEnd(2) ; <font color=#447700>!  bdy_width<a name='3401'></font>
        dom_end_rev(1) = ide<a name='3402'>
        dom_end_rev(2) = jde<a name='3403'>
        distributed_field = .TRUE.<a name='3404'>
        IF ( (MemOrd .eq. 'ys' .AND. bdy_mask( P_YSB )) .OR.     &amp;<a name='3405'>
             (MemOrd .eq. 'ye' .AND. bdy_mask( P_YEB ))       ) THEN<a name='3406'>
          my_displ = PatchStart(1)-1<a name='3407'>
          my_count = PatchEnd(1)-PatchStart(1)+1<a name='3408'>
        ELSE<a name='3409'>
          my_displ = 0<a name='3410'>
          my_count = 0<a name='3411'>
        ENDIF<a name='3412'>
        CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3413'>
        CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='3414'>
        do j = DomainStart(2),DomainEnd(2)    <font color=#447700>! bdy_width<a name='3415'></font>
           lx   = MemoryEnd(1)-MemoryStart(1)+1<a name='3416'>
           idx  = lx*(j-1)<a name='3417'>
           lx2  = dom_end_rev(1)-DomainStart(1)+1<a name='3418'>
           idx2 = lx2*(j-1)<a name='3419'>
<a name='3420'>
           IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='3421'>
<a name='3422'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_DOUBLE'>wrf_gatherv_double</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_DOUBLE_4">( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3423'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3424'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3425'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3426'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3427'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3428'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3429'></font>
                             ierr )<a name='3430'>
<a name='3431'>
           ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='3432'>
<a name='3433'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_REAL'>wrf_gatherv_real</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_REAL_4">( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3434'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3435'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3436'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3437'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3438'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3439'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3440'></font>
                             ierr )<a name='3441'>
<a name='3442'>
           ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3443'>
<a name='3444'>
             CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GATHERV_INTEGER'>wrf_gatherv_integer</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GATHERV_INTEGER_4">( Field, PatchStart(1)-MemoryStart(1)+1+idx ,      &amp;    <font color=#447700>! sendbuf<a name='3445'></font>
                             my_count                       , &amp;    <font color=#447700>! sendcount<a name='3446'></font>
                             globbuf, 1+idx2                , &amp;    <font color=#447700>! recvbuf<a name='3447'></font>
                             counts                         , &amp;    <font color=#447700>! recvcounts<a name='3448'></font>
                             displs                         , &amp;    <font color=#447700>! displs<a name='3449'></font>
                             collective_root                , &amp;    <font color=#447700>! root<a name='3450'></font>
                             communicator                   , &amp;    <font color=#447700>! communicator<a name='3451'></font>
                             ierr )<a name='3452'>
           ENDIF<a name='3453'>
<a name='3454'>
        enddo<a name='3455'>
      ENDIF<a name='3456'>
#endif<a name='3457'>
#endif<a name='3458'>
    CASE DEFAULT<a name='3459'>
      distributed_field = .FALSE.<a name='3460'>
  END SELECT<a name='3461'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3462'>
    IF ( distributed_field ) THEN<a name='3463'>
      CALL fcn ( Hndl , DateStr , VarName , globbuf , FieldType , Comm , IOComm , &amp;<a name='3464'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='3465'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='3466'>
                 DomainStart , dom_end_rev ,                                      &amp;  <font color=#447700>! memory dims adjust out for unstag<a name='3467'></font>
                 DomainStart , DomainEnd ,                                        &amp;<a name='3468'>
                 Status )<a name='3469'>
    ELSE<a name='3470'>
      CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3471'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='3472'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='3473'>
                 MemoryStart , MemoryEnd ,                                        &amp;<a name='3474'>
                 PatchStart  , PatchEnd  ,                                        &amp;<a name='3475'>
                 Status )<a name='3476'>
    ENDIF<a name='3477'>
  ENDIF<a name='3478'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#COLLECT_GENERIC_AND_CALL_PKG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_97">( Status , IWORDSIZE )<a name='3479'>
  DEALLOCATE( counts )<a name='3480'>
  DEALLOCATE( displs )<a name='3481'>
  RETURN<a name='3482'>
END SUBROUTINE collect_generic_and_call_pkg<a name='3483'>
<a name='3484'>
<a name='3485'>
<A NAME='CALL_PKG_AND_DIST'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3486'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist</font> (       fcn, donotdist_arg, update_arg,                           &amp;,<A href='../../call_from/CALL_PKG_AND_DIST.html' TARGET='index'>2</A><a name='3487'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3488'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3489'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3490'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3491'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3492'>
                                     Status )<a name='3493'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3494'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3495'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3496'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3497'></font>
<font color=#447700>! This routine handle cases where distribution/replication can be skipped and <a name='3498'></font>
<font color=#447700>! deals with different data types for Field.<a name='3499'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3500'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3501'></font>
  IMPLICIT NONE<a name='3502'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_27"><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3503'>
  EXTERNAL fcn<a name='3504'>
  LOGICAL,        INTENT(IN)    :: donotdist_arg, update_arg  <font color=#447700>! update means collect old field update it and dist<a name='3505'></font>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3506'>
  CHARACTER*(*) :: DateStr<a name='3507'>
  CHARACTER*(*) :: VarName<a name='3508'>
  INTEGER                          :: Field(*)<a name='3509'>
  INTEGER                                      :: FieldType<a name='3510'>
  INTEGER                                      :: Comm<a name='3511'>
  INTEGER                                      :: IOComm<a name='3512'>
  INTEGER                                      :: DomainDesc<a name='3513'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3514'>
  CHARACTER*(*)                                :: MemoryOrder<a name='3515'>
  CHARACTER*(*)                                :: Stagger<a name='3516'>
  CHARACTER*(*) , dimension (*)                :: DimNames<a name='3517'>
  INTEGER ,dimension(*)                        :: DomainStart, DomainEnd<a name='3518'>
  INTEGER ,dimension(*)                        :: MemoryStart, MemoryEnd<a name='3519'>
  INTEGER ,dimension(*)                        :: PatchStart,  PatchEnd<a name='3520'>
  INTEGER                                      :: Status<a name='3521'>
  LOGICAL donotdist<a name='3522'>
  INTEGER ndims, nproc<a name='3523'>
<a name='3524'>
  CALL <A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER'>dim_from_memorder</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DIM_FROM_MEMORDER_2">( MemoryOrder , ndims)<a name='3525'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_16">( nproc )<a name='3526'>
  donotdist = donotdist_arg .OR. (nproc .EQ. 1)<a name='3527'>
<a name='3528'>
  IF ( donotdist ) THEN<a name='3529'>
    CALL fcn ( Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3530'>
               DomainDesc , MemoryOrder , Stagger , DimNames ,                &amp;<a name='3531'>
               DomainStart , DomainEnd ,                                      &amp;<a name='3532'>
               MemoryStart , MemoryEnd ,                                      &amp;<a name='3533'>
               PatchStart , PatchEnd ,                                        &amp;<a name='3534'>
               Status )<a name='3535'>
<a name='3536'>
  ELSE IF (FieldType .EQ. WRF_DOUBLE) THEN<a name='3537'>
<a name='3538'>
     CALL call_pkg_and_dist_double ( fcn, update_arg,                            &amp;<a name='3539'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3540'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3541'>
               DomainStart , DomainEnd ,                                    &amp;<a name='3542'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='3543'>
               PatchStart , PatchEnd ,                                      &amp;<a name='3544'>
               Status )<a name='3545'>
<a name='3546'>
  ELSE IF (FieldType .EQ. WRF_FLOAT) THEN<a name='3547'>
<a name='3548'>
     CALL call_pkg_and_dist_real ( fcn, update_arg,                            &amp;<a name='3549'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3550'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3551'>
               DomainStart , DomainEnd ,                                    &amp;<a name='3552'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='3553'>
               PatchStart , PatchEnd ,                                      &amp;<a name='3554'>
               Status )<a name='3555'>
<a name='3556'>
  ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3557'>
<a name='3558'>
     CALL call_pkg_and_dist_int ( fcn, update_arg,                            &amp;<a name='3559'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3560'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3561'>
               DomainStart , DomainEnd ,                                    &amp;<a name='3562'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='3563'>
               PatchStart , PatchEnd ,                                      &amp;<a name='3564'>
               Status )<a name='3565'>
<a name='3566'>
  ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3567'>
<a name='3568'>
     CALL call_pkg_and_dist_logical ( fcn, update_arg,                            &amp;<a name='3569'>
               Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3570'>
               DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3571'>
               DomainStart , DomainEnd ,                                    &amp;<a name='3572'>
               MemoryStart , MemoryEnd ,                                    &amp;<a name='3573'>
               PatchStart , PatchEnd ,                                      &amp;<a name='3574'>
               Status )<a name='3575'>
<a name='3576'>
  ENDIF<a name='3577'>
  RETURN<a name='3578'>
END SUBROUTINE call_pkg_and_dist<a name='3579'>
<a name='3580'>
<A NAME='CALL_PKG_AND_DIST_REAL'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3581'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_real</font> (  fcn, update_arg,                                             &amp;,<A href='../../call_from/CALL_PKG_AND_DIST_REAL.html' TARGET='index'>2</A><a name='3582'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3583'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3584'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3585'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3586'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3587'>
                                     Status )<a name='3588'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3589'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3590'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3591'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3592'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big real buffer and<a name='3593'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3594'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3595'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3596'></font>
  IMPLICIT NONE<a name='3597'>
  EXTERNAL fcn<a name='3598'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3599'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3600'>
  CHARACTER*(*) :: DateStr<a name='3601'>
  CHARACTER*(*) :: VarName<a name='3602'>
  REAL    ,       INTENT(INOUT)    :: Field(*)<a name='3603'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3604'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3605'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3606'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3607'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3608'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3609'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3610'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3611'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3612'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3613'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3614'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3615'>
  REAL, ALLOCATABLE :: globbuf (:)<a name='3616'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3617'>
  INTEGER test<a name='3618'>
  CHARACTER*128 mess<a name='3619'>
<a name='3620'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3621'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ), &amp;<a name='3622'>
              STAT=test )<a name='3623'>
    IF ( test .NE. 0 ) THEN<a name='3624'>
      write(mess,*)"module_io.b",'allocating globbuf ',&amp;<a name='3625'>
           (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3)<a name='3626'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_261">(mess)<a name='3627'>
    ENDIF<a name='3628'>
  ELSE<a name='3629'>
    ALLOCATE( globbuf( 1 ), STAT=test )<a name='3630'>
    IF ( test .NE. 0 ) THEN<a name='3631'>
      write(mess,*)"module_io.b",'allocating globbuf ',1<a name='3632'>
      CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_262">(mess)<a name='3633'>
    ENDIF<a name='3634'>
  ENDIF<a name='3635'>
<a name='3636'>
  globbuf = 0.<a name='3637'>
<a name='3638'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg,                          &amp;<a name='3639'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3640'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3641'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3642'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3643'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3644'>
                                     Status )<a name='3645'>
  DEALLOCATE ( globbuf )<a name='3646'>
  RETURN<a name='3647'>
END SUBROUTINE call_pkg_and_dist_real<a name='3648'>
<a name='3649'>
<a name='3650'>
<A NAME='CALL_PKG_AND_DIST_DOUBLE'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_DOUBLE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3651'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_double</font>  (  fcn, update_arg ,                                            &amp;<a name='3652'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3653'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3654'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3655'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3656'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3657'>
                                     Status )<a name='3658'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3659'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3660'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3661'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3662'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big double precision buffer <a name='3663'></font>
<font color=#447700>! and pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3664'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3665'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3666'></font>
  IMPLICIT NONE<a name='3667'>
  EXTERNAL fcn<a name='3668'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3669'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3670'>
  CHARACTER*(*) :: DateStr<a name='3671'>
  CHARACTER*(*) :: VarName<a name='3672'>
  DOUBLE PRECISION   ,       INTENT(INOUT)    :: Field(*)<a name='3673'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3674'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3675'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3676'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3677'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3678'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3679'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3680'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3681'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3682'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3683'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3684'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3685'>
  DOUBLE PRECISION , ALLOCATABLE :: globbuf (:)<a name='3686'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3687'>
<a name='3688'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3689'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3690'>
  ELSE<a name='3691'>
    ALLOCATE( globbuf( 1 ) )<a name='3692'>
  ENDIF<a name='3693'>
<a name='3694'>
  globbuf = 0<a name='3695'>
<a name='3696'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                         &amp;<a name='3697'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3698'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3699'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3700'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3701'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3702'>
                                     Status )<a name='3703'>
  DEALLOCATE ( globbuf )<a name='3704'>
  RETURN<a name='3705'>
END SUBROUTINE call_pkg_and_dist_double<a name='3706'>
<a name='3707'>
<a name='3708'>
<A NAME='CALL_PKG_AND_DIST_INT'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_INT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3709'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_int</font>  (  fcn, update_arg ,                                            &amp;<a name='3710'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3711'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3712'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3713'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3714'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3715'>
                                     Status )<a name='3716'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3717'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3718'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3719'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3720'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big integer buffer and <a name='3721'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3722'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3723'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3724'></font>
  IMPLICIT NONE<a name='3725'>
  EXTERNAL fcn<a name='3726'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3727'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3728'>
  CHARACTER*(*) :: DateStr<a name='3729'>
  CHARACTER*(*) :: VarName<a name='3730'>
  INTEGER    ,       INTENT(INOUT)    :: Field(*)<a name='3731'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3732'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3733'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3734'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3735'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3736'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3737'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3738'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3739'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3740'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3741'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3742'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3743'>
  INTEGER , ALLOCATABLE :: globbuf (:)<a name='3744'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3745'>
<a name='3746'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3747'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3748'>
  ELSE<a name='3749'>
    ALLOCATE( globbuf( 1 ) )<a name='3750'>
  ENDIF<a name='3751'>
<a name='3752'>
  globbuf = 0<a name='3753'>
<a name='3754'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                                  &amp;<a name='3755'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3756'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3757'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3758'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3759'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3760'>
                                     Status )<a name='3761'>
  DEALLOCATE ( globbuf )<a name='3762'>
  RETURN<a name='3763'>
END SUBROUTINE call_pkg_and_dist_int<a name='3764'>
<a name='3765'>
<a name='3766'>
<A NAME='CALL_PKG_AND_DIST_LOGICAL'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_LOGICAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3767'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_logical</font>  (  fcn, update_arg ,                                            &amp;<a name='3768'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3769'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3770'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3771'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3772'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3773'>
                                     Status )<a name='3774'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3775'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3776'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3777'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3778'></font>
<font color=#447700>! The sole purpose of this wrapper is to allocate a big logical buffer and <a name='3779'></font>
<font color=#447700>! pass it down to call_pkg_and_dist_generic() to do the actual work.<a name='3780'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3781'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3782'></font>
  IMPLICIT NONE<a name='3783'>
  EXTERNAL fcn<a name='3784'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3785'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3786'>
  CHARACTER*(*) :: DateStr<a name='3787'>
  CHARACTER*(*) :: VarName<a name='3788'>
  logical    ,       INTENT(INOUT)    :: Field(*)<a name='3789'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3790'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3791'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3792'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3793'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3794'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3795'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3796'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3797'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3798'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3799'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3800'>
  INTEGER                       ,INTENT(INOUT)   :: Status<a name='3801'>
  LOGICAL , ALLOCATABLE :: globbuf (:)<a name='3802'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3803'>
<a name='3804'>
  IF ( wrf_dm_on_monitor() ) THEN<a name='3805'>
    ALLOCATE( globbuf( (DomainEnd(1)-DomainStart(1)+3)*(DomainEnd(2)-DomainStart(2)+3)*(DomainEnd(3)-DomainStart(3)+3) ) )<a name='3806'>
  ELSE<a name='3807'>
    ALLOCATE( globbuf( 1 ) )<a name='3808'>
  ENDIF<a name='3809'>
<a name='3810'>
  globbuf = .false.<a name='3811'>
<a name='3812'>
  CALL call_pkg_and_dist_generic (   fcn, globbuf FRSTELEM , update_arg ,                         &amp;<a name='3813'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3814'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3815'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3816'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3817'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3818'>
                                     Status )<a name='3819'>
  DEALLOCATE ( globbuf )<a name='3820'>
  RETURN<a name='3821'>
END SUBROUTINE call_pkg_and_dist_logical<a name='3822'>
<a name='3823'>
<A NAME='CALL_PKG_AND_DIST_GENERIC'><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3824'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>call_pkg_and_dist_generic</font> (   fcn, globbuf , update_arg ,                                  &amp;,<A href='../../call_from/CALL_PKG_AND_DIST_GENERIC.html' TARGET='index'>34</A><a name='3825'>
                                     Hndl , DateStr , VarName , Field , FieldType , Comm , IOComm , &amp;<a name='3826'>
                                     DomainDesc , bdy_mask, MemoryOrder , Stagger , DimNames ,              &amp;<a name='3827'>
                                     DomainStart , DomainEnd ,                                    &amp;<a name='3828'>
                                     MemoryStart , MemoryEnd ,                                    &amp;<a name='3829'>
                                     PatchStart , PatchEnd ,                                      &amp;<a name='3830'>
                                     Status )<a name='3831'>
<a name='3832'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='3833'></font>
<font color=#447700>!&lt;PRE&gt;<a name='3834'></font>
<font color=#447700>! The call_pkg_and_dist* routines call an I/O function to read a field and then <a name='3835'></font>
<font color=#447700>! distribute or replicate the field across compute tasks.  <a name='3836'></font>
<font color=#447700>! This routine calls I/O function fcn to read the field from disk and then calls <a name='3837'></font>
<font color=#447700>! the distributed memory communication routines that distribute or replicate the <a name='3838'></font>
<font color=#447700>! array.  <a name='3839'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='3840'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='3841'></font>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_88"><a name='3842'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_37"><a name='3843'>
  USE <A href='../../html_code/frame/module_io.F.html#MODULE_IO'>module_io</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_IO_4"><a name='3844'>
  IMPLICIT NONE<a name='3845'>
#include "<A href='../../html_code/include/wrf_io_flags.h.html'>wrf_io_flags.h</A>"<A NAME="wrf_io_flags.h_28"><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3846'>
#if defined( DM_PARALLEL ) &amp;&amp; <font color=#447700>! defined(STUBMPI)<a name='3847'></font>
include "<A href='../../html_code/include/mpif.h.html'>mpif.h</A>"<A NAME="mpif.h_29"><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='3848'>
#endif<a name='3849'>
<a name='3850'>
  EXTERNAL fcn<a name='3851'>
  REAL, DIMENSION(*) ::  globbuf<a name='3852'>
  INTEGER ,       INTENT(IN)    :: Hndl<a name='3853'>
  LOGICAL ,       INTENT(IN)    :: update_arg<a name='3854'>
  CHARACTER*(*) :: DateStr<a name='3855'>
  CHARACTER*(*) :: VarName<a name='3856'>
  REAL                           :: Field(*)<a name='3857'>
  INTEGER                       ,INTENT(IN)    :: FieldType<a name='3858'>
  INTEGER                       ,INTENT(INOUT) :: Comm<a name='3859'>
  INTEGER                       ,INTENT(INOUT) :: IOComm<a name='3860'>
  INTEGER                       ,INTENT(IN)    :: DomainDesc<a name='3861'>
  LOGICAL, DIMENSION(4)                        :: bdy_mask<a name='3862'>
  CHARACTER*(*)                 ,INTENT(IN)    :: MemoryOrder<a name='3863'>
  CHARACTER*(*)                 ,INTENT(IN)    :: Stagger<a name='3864'>
  CHARACTER*(*) , dimension (*) ,INTENT(IN)    :: DimNames<a name='3865'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: DomainStart, DomainEnd<a name='3866'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: MemoryStart, MemoryEnd<a name='3867'>
  INTEGER ,dimension(*)         ,INTENT(IN)    :: PatchStart,  PatchEnd<a name='3868'>
  INTEGER                       ,INTENT(OUT)   :: Status<a name='3869'>
  CHARACTER*3 MemOrd<a name='3870'>
  LOGICAL, EXTERNAL :: has_char<a name='3871'>
  INTEGER ids, ide, jds, jde, kds, kde<a name='3872'>
  INTEGER ims, ime, jms, jme, kms, kme<a name='3873'>
  INTEGER ips, ipe, jps, jpe, kps, kpe<a name='3874'>
  INTEGER , dimension(3)                       :: dom_end_rev<a name='3875'>
  INTEGER memsize<a name='3876'>
  LOGICAL, EXTERNAL :: wrf_dm_on_monitor<a name='3877'>
  INTEGER, EXTERNAL :: wrf_dm_monitor_rank<a name='3878'>
<a name='3879'>
  INTEGER lx, lx2, i,j,k ,idx,idx2<a name='3880'>
  INTEGER my_count, nproc, communicator, ierr, my_displ<a name='3881'>
<a name='3882'>
  INTEGER, ALLOCATABLE :: counts(:), displs(:)<a name='3883'>
<a name='3884'>
  LOGICAL distributed_field<a name='3885'>
  INTEGER collective_root<a name='3886'>
<a name='3887'>
  CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_4">( MemoryOrder, MemOrd )<a name='3888'>
<a name='3889'>
  collective_root = <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_MONITOR_RANK'>wrf_dm_monitor_rank</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_MONITOR_RANK_2">()<a name='3890'>
<a name='3891'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_NPROC'>wrf_get_nproc</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_NPROC_17">( nproc )<a name='3892'>
  CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GET_DM_COMMUNICATOR'>wrf_get_dm_communicator</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_DM_COMMUNICATOR_46"> ( communicator )<a name='3893'>
<a name='3894'>
  ALLOCATE(displs( nproc ))<a name='3895'>
  ALLOCATE(counts( nproc ))<a name='3896'>
<a name='3897'>
  dom_end_rev(1) = DomainEnd(1)<a name='3898'>
  dom_end_rev(2) = DomainEnd(2)<a name='3899'>
  dom_end_rev(3) = DomainEnd(3)<a name='3900'>
<a name='3901'>
  SELECT CASE (TRIM(MemOrd))<a name='3902'>
    CASE (  'xzy' )<a name='3903'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3904'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3905'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3906'>
    CASE (  'zxy' )<a name='3907'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3908'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3909'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3910'>
    CASE (  'xyz' )<a name='3911'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3912'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3913'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3914'>
    CASE (  'xy' )<a name='3915'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3916'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3917'>
    CASE (  'yxz' )<a name='3918'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3919'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3920'>
      IF ( .NOT. has_char( Stagger, 'z' ) ) dom_end_rev(3) = dom_end_rev(3) + 1<a name='3921'>
    CASE (  'yx' )<a name='3922'>
      IF ( .NOT. has_char( Stagger, 'y' ) ) dom_end_rev(1) = dom_end_rev(1) + 1<a name='3923'>
      IF ( .NOT. has_char( Stagger, 'x' ) ) dom_end_rev(2) = dom_end_rev(2) + 1<a name='3924'>
    CASE DEFAULT<a name='3925'>
      <font color=#447700>! do nothing; the boundary orders and others either dont care or set themselves<a name='3926'></font>
  END SELECT<a name='3927'>
<a name='3928'>
  data_ordering : SELECT CASE ( model_data_order )<a name='3929'>
    CASE  ( DATA_ORDER_XYZ )<a name='3930'>
       ids=DomainStart(1); ide=dom_end_rev(1); jds=DomainStart(2); jde=dom_end_rev(2); kds=DomainStart(3); kde=dom_end_rev(3);<a name='3931'>
       ims=MemoryStart(1); ime=  MemoryEnd(1); jms=MemoryStart(2); jme=  MemoryEnd(2); kms=MemoryStart(3); kme=  MemoryEnd(3);<a name='3932'>
       ips= PatchStart(1); ipe=   PatchEnd(1); jps= PatchStart(2); jpe=   PatchEnd(2); kps= PatchStart(3); kpe=   PatchEnd(3);<a name='3933'>
    CASE  ( DATA_ORDER_YXZ )<a name='3934'>
       ids=DomainStart(2); ide=dom_end_rev(2); jds=DomainStart(1); jde=dom_end_rev(1); kds=DomainStart(3); kde=dom_end_rev(3);<a name='3935'>
       ims=MemoryStart(2); ime=  MemoryEnd(2); jms=MemoryStart(1); jme=  MemoryEnd(1); kms=MemoryStart(3); kme=  MemoryEnd(3);<a name='3936'>
       ips= PatchStart(2); ipe=   PatchEnd(2); jps= PatchStart(1); jpe=   PatchEnd(1); kps= PatchStart(3); kpe=   PatchEnd(3);<a name='3937'>
    CASE  ( DATA_ORDER_ZXY )<a name='3938'>
       ids=DomainStart(2); ide=dom_end_rev(2); jds=DomainStart(3); jde=dom_end_rev(3); kds=DomainStart(1); kde=dom_end_rev(1);<a name='3939'>
       ims=MemoryStart(2); ime=  MemoryEnd(2); jms=MemoryStart(3); jme=  MemoryEnd(3); kms=MemoryStart(1); kme=  MemoryEnd(1);<a name='3940'>
       ips= PatchStart(2); ipe=   PatchEnd(2); jps= PatchStart(3); jpe=   PatchEnd(3); kps= PatchStart(1); kpe=   PatchEnd(1);<a name='3941'>
    CASE  ( DATA_ORDER_ZYX )<a name='3942'>
       ids=DomainStart(3); ide=dom_end_rev(3); jds=DomainStart(2); jde=dom_end_rev(2); kds=DomainStart(1); kde=dom_end_rev(1);<a name='3943'>
       ims=MemoryStart(3); ime=  MemoryEnd(3); jms=MemoryStart(2); jme=  MemoryEnd(2); kms=MemoryStart(1); kme=  MemoryEnd(1);<a name='3944'>
       ips= PatchStart(3); ipe=   PatchEnd(3); jps= PatchStart(2); jpe=   PatchEnd(2); kps= PatchStart(1); kpe=   PatchEnd(1);<a name='3945'>
    CASE  ( DATA_ORDER_XZY )<a name='3946'>
       ids=DomainStart(1); ide=dom_end_rev(1); jds=DomainStart(3); jde=dom_end_rev(3); kds=DomainStart(2); kde=dom_end_rev(2);<a name='3947'>
       ims=MemoryStart(1); ime=  MemoryEnd(1); jms=MemoryStart(3); jme=  MemoryEnd(3); kms=MemoryStart(2); kme=  MemoryEnd(2);<a name='3948'>
       ips= PatchStart(1); ipe=   PatchEnd(1); jps= PatchStart(3); jpe=   PatchEnd(3); kps= PatchStart(2); kpe=   PatchEnd(2);<a name='3949'>
    CASE  ( DATA_ORDER_YZX )<a name='3950'>
       ids=DomainStart(3); ide=dom_end_rev(3); jds=DomainStart(1); jde=dom_end_rev(1); kds=DomainStart(2); kde=dom_end_rev(2);<a name='3951'>
       ims=MemoryStart(3); ime=  MemoryEnd(3); jms=MemoryStart(1); jme=  MemoryEnd(1); kms=MemoryStart(2); kme=  MemoryEnd(2);<a name='3952'>
       ips= PatchStart(3); ipe=   PatchEnd(3); jps= PatchStart(1); jpe=   PatchEnd(1); kps= PatchStart(2); kpe=   PatchEnd(2);<a name='3953'>
  END SELECT data_ordering<a name='3954'>
<a name='3955'>
<a name='3956'>
  SELECT CASE (MemOrd)<a name='3957'>
#ifndef STUBMPI<a name='3958'>
    CASE ( 'xzy', 'yzx', 'xyz', 'yxz', 'zxy', 'zyx', 'xy', 'yx' )<a name='3959'>
      distributed_field = .TRUE.<a name='3960'>
    CASE ( 'xsz', 'xez', 'xs', 'xe' )<a name='3961'>
      CALL <A href='../../html_code/frame/module_io.F.html#ARE_BDYS_DISTRIBUTED'>are_bdys_distributed</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ARE_BDYS_DISTRIBUTED_1">( distributed_field )<a name='3962'>
    CASE ( 'ysz', 'yez', 'ys', 'ye' )<a name='3963'>
      CALL <A href='../../html_code/frame/module_io.F.html#ARE_BDYS_DISTRIBUTED'>are_bdys_distributed</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ARE_BDYS_DISTRIBUTED_2">( distributed_field )<a name='3964'>
#endif<a name='3965'>
    CASE DEFAULT<a name='3966'>
      <font color=#447700>! all other memory orders are replicated<a name='3967'></font>
      distributed_field = .FALSE.<a name='3968'>
  END SELECT<a name='3969'>
<a name='3970'>
  IF ( distributed_field ) THEN<a name='3971'>
<a name='3972'>
<font color=#447700>! added 8/2004 for interfaces, like MCEL, that want the old values so they can be updated<a name='3973'></font>
    IF ( update_arg ) THEN<a name='3974'>
      SELECT CASE (TRIM(MemOrd))<a name='3975'>
        CASE (  'xzy','zxy','xyz','yxz','xy','yx' )<a name='3976'>
          IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='3977'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_DOUBLE'>wrf_patch_to_global_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_DOUBLE_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3978'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3979'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3980'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3981'>
          ELSE IF (  FieldType .EQ. WRF_FLOAT ) THEN<a name='3982'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_REAL'>wrf_patch_to_global_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_REAL_10"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3983'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3984'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3985'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3986'>
          ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='3987'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_INTEGER'>wrf_patch_to_global_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_INTEGER_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3988'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3989'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3990'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3991'>
          ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='3992'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_PATCH_TO_GLOBAL_LOGICAL'>wrf_patch_to_global_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_TO_GLOBAL_LOGICAL_2"> ( Field  , globbuf , DomainDesc, Stagger, MemOrd ,             &amp;<a name='3993'>
               DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='3994'>
               MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='3995'>
               PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3) )<a name='3996'>
          ENDIF<a name='3997'>
        CASE DEFAULT<a name='3998'>
      END SELECT<a name='3999'>
    ENDIF<a name='4000'>
<a name='4001'>
    IF ( wrf_dm_on_monitor()) THEN<a name='4002'>
      CALL fcn ( Hndl , DateStr , VarName , globbuf , FieldType , Comm , IOComm , &amp;<a name='4003'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='4004'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='4005'>
                 DomainStart , dom_end_rev ,                                        &amp;<a name='4006'>
                 DomainStart , DomainEnd ,                                          &amp;<a name='4007'>
                 Status )<a name='4008'>
    ENDIF<a name='4009'>
<a name='4010'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_98">( Status, IWORDSIZE )<a name='4011'>
<a name='4012'>
    CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_5">( MemoryOrder, MemOrd )<a name='4013'>
<a name='4014'>
#if defined(DM_PARALLEL) &amp;&amp; <font color=#447700>!defined(STUBMPI)<a name='4015'></font>
<font color=#447700>! handle boundaries separately<a name='4016'></font>
    IF ( TRIM(MemOrd) .EQ. 'xsz' .OR. TRIM(MemOrd) .EQ. 'xez' .OR. &amp;<a name='4017'>
         TRIM(MemOrd) .EQ. 'xs'  .OR. TRIM(MemOrd) .EQ. 'xe'  .OR. &amp;<a name='4018'>
         TRIM(MemOrd) .EQ. 'ysz' .OR. TRIM(MemOrd) .EQ. 'yez' .OR. &amp;<a name='4019'>
         TRIM(MemOrd) .EQ. 'ys'  .OR. TRIM(MemOrd) .EQ. 'ye'    ) THEN<a name='4020'>
<a name='4021'>
      IF ( TRIM(MemOrd) .EQ. 'xsz' .OR. TRIM(MemOrd) .EQ. 'xez' .OR. &amp;<a name='4022'>
           TRIM(MemOrd) .EQ. 'xs'  .OR. TRIM(MemOrd) .EQ. 'xe'    ) THEN<a name='4023'>
<a name='4024'>
       jds=DomainStart(1); jde=dom_end_rev(1); ids=DomainStart(3); ide=dom_end_rev(3); kds=DomainStart(2); kde=dom_end_rev(2);<a name='4025'>
       jms=MemoryStart(1); jme=  MemoryEnd(1); ims=MemoryStart(3); ime=  MemoryEnd(3); kms=MemoryStart(2); kme=  MemoryEnd(2);<a name='4026'>
       jps= PatchStart(1); jpe=   PatchEnd(1); ips= PatchStart(3); ipe=   PatchEnd(3); kps= PatchStart(2); kpe=   PatchEnd(2);<a name='4027'>
<a name='4028'>
        IF ( nproc .GT. 1 ) THEN<a name='4029'>
<a name='4030'>
<font color=#447700>! Will assume that the i,j, and k dimensions correspond to the model_data_order specified by the registry -- <a name='4031'></font>
<font color=#447700>! eg. i is (1), j is (3), and k is (2) for XZY -- and that when these are passed in for xs/xe boundary arrays (left and right<a name='4032'></font>
<font color=#447700>! sides of domain) the j is fully dimensioned, i is the bdy_width, and k is k. corresponding arrangement for ys/ye<a name='4033'></font>
<font color=#447700>! boundaries (bottom and top).  Note, however, that for the boundary arrays themselves, the innermost dimension is always<a name='4034'></font>
<font color=#447700>! the "full" dimension: for xs/xe, dimension 1 of the boundary arrays is j. For ys/ye, it's i. So there's a potential<a name='4035'></font>
<font color=#447700>! for confusion between the MODEL storage order, and which of the sd31:ed31/sd32:ed32/sd33:ed33 framework dimensions<a name='4036'></font>
<font color=#447700>! correspond to X/Y/Z as determined by the Registry dimespec definitions and what the storage order of the boundary<a name='4037'></font>
<font color=#447700>! slab arrays are (which depends on which boundaries they represent).  The k memory and domain dimensions must be set<a name='4038'></font>
<font color=#447700>! properly for 2d (ks=1, ke=1) versus 3d fields.<a name='4039'></font>
<a name='4040'>
#if 1<a name='4041'>
          IF ( (MemOrd(1:2) .EQ. 'xs' .AND. bdy_mask( P_XSB )) .OR.     &amp;<a name='4042'>
               (MemOrd(1:2) .EQ. 'xe' .AND. bdy_mask( P_XEB ))       ) THEN<a name='4043'>
            my_displ = jps-1         <a name='4044'>
            my_count = jpe-jps+1<a name='4045'>
          ELSE<a name='4046'>
            my_displ = 0<a name='4047'>
            my_count = 0<a name='4048'>
          ENDIF<a name='4049'>
#else<a name='4050'>
          IF ( (MemOrd(1:2) .EQ. 'xs' ) .OR.     &amp;<a name='4051'>
               (MemOrd(1:2) .EQ. 'xe' )       ) THEN<a name='4052'>
            my_displ = jps-1         <a name='4053'>
            my_count = jpe-jps+1<a name='4054'>
          ELSE<a name='4055'>
            my_displ = 0<a name='4056'>
            my_count = 0<a name='4057'>
          ENDIF<a name='4058'>
#endif<a name='4059'>
<a name='4060'>
          CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='4061'>
          CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='4062'>
<a name='4063'>
          do i = ips,ipe    <font color=#447700>! bdy_width<a name='4064'></font>
          do k = kds,kde    <font color=#447700>! levels<a name='4065'></font>
             lx   = jme-jms+1<a name='4066'>
             lx2  = jde-jds+1<a name='4067'>
             idx  = lx*((k-1)+(i-1)*(kme-kms+1))<a name='4068'>
             idx2 = lx2*((k-1)+(i-1)*(kde-kds+1))<a name='4069'>
             IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='4070'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_DOUBLE'>wrf_scatterv_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_DOUBLE_1"> (                        &amp;<a name='4071'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4072'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4073'></font>
                               Field, jps-jms+1+idx ,       &amp;<a name='4074'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4075'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4076'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4077'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4078'></font>
                               ierr )<a name='4079'>
             ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='4080'>
<a name='4081'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_REAL'>wrf_scatterv_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_REAL_1"> (                          &amp;<a name='4082'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4083'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4084'></font>
                               Field, jps-jms+1+idx ,       &amp;<a name='4085'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4086'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4087'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4088'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4089'></font>
                               ierr )<a name='4090'>
<a name='4091'>
             ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='4092'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_INTEGER'>wrf_scatterv_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_INTEGER_1"> (                       &amp;<a name='4093'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4094'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4095'></font>
                               Field, jps-jms+1+idx ,       &amp;<a name='4096'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4097'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4098'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4099'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4100'></font>
                               ierr )<a name='4101'>
             ENDIF<a name='4102'>
          enddo<a name='4103'>
          enddo<a name='4104'>
        ENDIF<a name='4105'>
      ENDIF<a name='4106'>
<a name='4107'>
      IF ( TRIM(MemOrd) .EQ. 'ysz' .OR. TRIM(MemOrd) .EQ. 'yez' .OR. &amp;<a name='4108'>
           TRIM(MemOrd) .EQ. 'ys'  .OR. TRIM(MemOrd) .EQ. 'ye'    ) THEN<a name='4109'>
<a name='4110'>
<a name='4111'>
       ids=DomainStart(1); ide=dom_end_rev(1); jds=DomainStart(3); jde=dom_end_rev(3); kds=DomainStart(2); kde=dom_end_rev(2);<a name='4112'>
       ims=MemoryStart(1); ime=  MemoryEnd(1); jms=MemoryStart(3); jme=  MemoryEnd(3); kms=MemoryStart(2); kme=  MemoryEnd(2);<a name='4113'>
       ips= PatchStart(1); ipe=   PatchEnd(1); jps= PatchStart(3); jpe=   PatchEnd(3); kps= PatchStart(2); kpe=   PatchEnd(2);<a name='4114'>
<a name='4115'>
        IF ( nproc .GT. 1 ) THEN<a name='4116'>
<a name='4117'>
#if 1<a name='4118'>
          IF ( (MemOrd(1:2) .EQ. 'ys' .AND. bdy_mask( P_YSB )) .OR.     &amp;<a name='4119'>
               (MemOrd(1:2) .EQ. 'ye' .AND. bdy_mask( P_YEB ))       ) THEN<a name='4120'>
            my_displ = ips-1<a name='4121'>
            my_count = ipe-ips+1<a name='4122'>
           ELSE<a name='4123'>
             my_displ = 0<a name='4124'>
             my_count = 0<a name='4125'>
          ENDIF<a name='4126'>
#else<a name='4127'>
          IF ( (MemOrd(1:2) .EQ. 'ys' ) .OR.     &amp;<a name='4128'>
               (MemOrd(1:2) .EQ. 'ye' )       ) THEN<a name='4129'>
            my_displ = ips-1<a name='4130'>
            my_count = ipe-ips+1<a name='4131'>
          ELSE<a name='4132'>
            my_displ = 0<a name='4133'>
            my_count = 0<a name='4134'>
          ENDIF<a name='4135'>
#endif<a name='4136'>
<a name='4137'>
          CALL mpi_gather( my_displ, 1, MPI_INTEGER, displs, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='4138'>
          CALL mpi_gather( my_count, 1, MPI_INTEGER, counts, 1, MPI_INTEGER, collective_root, communicator, ierr )<a name='4139'>
<a name='4140'>
          do j = jds,jde    <font color=#447700>! bdy_width<a name='4141'></font>
          do k = kds,kde    <font color=#447700>! levels<a name='4142'></font>
             lx   = ime-ims+1<a name='4143'>
             lx2  = ide-ids+1<a name='4144'>
             idx  = lx*((k-1)+(j-1)*(kme-kms+1))<a name='4145'>
             idx2 = lx2*((k-1)+(j-1)*(kde-kds+1))<a name='4146'>
<a name='4147'>
             IF ( FieldType .EQ. WRF_DOUBLE  ) THEN<a name='4148'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_DOUBLE'>wrf_scatterv_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_DOUBLE_2"> (                        &amp;<a name='4149'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4150'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4151'></font>
                               Field, ips-ims+1+idx ,       &amp;<a name='4152'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4153'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4154'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4155'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4156'></font>
                               ierr )<a name='4157'>
             ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='4158'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_REAL'>wrf_scatterv_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_REAL_2"> (                          &amp;<a name='4159'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4160'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4161'></font>
                               Field, ips-ims+1+idx ,       &amp;<a name='4162'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4163'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4164'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4165'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4166'></font>
                               ierr )<a name='4167'>
             ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='4168'>
               CALL <A href='../../html_code/frame/module_dm.F.html#WRF_SCATTERV_INTEGER'>wrf_scatterv_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_SCATTERV_INTEGER_2"> (                       &amp;<a name='4169'>
                               globbuf, 1+idx2 ,                &amp;    <font color=#447700>! sendbuf<a name='4170'></font>
                               counts                         , &amp;    <font color=#447700>! sendcounts<a name='4171'></font>
                               Field, ips-ims+1+idx ,       &amp;<a name='4172'>
                               my_count ,                       &amp;    <font color=#447700>! recvcount<a name='4173'></font>
                               displs                         , &amp;    <font color=#447700>! displs<a name='4174'></font>
                               collective_root                , &amp;    <font color=#447700>! root<a name='4175'></font>
                               communicator                   , &amp;    <font color=#447700>! communicator<a name='4176'></font>
                               ierr )<a name='4177'>
             ENDIF<a name='4178'>
          enddo<a name='4179'>
          enddo<a name='4180'>
        ENDIF<a name='4181'>
      ENDIF<a name='4182'>
<a name='4183'>
    ELSE  <font color=#447700>! not a boundary <a name='4184'></font>
  <a name='4185'>
      IF ( FieldType .EQ. WRF_DOUBLE ) THEN<a name='4186'>
<a name='4187'>
        SELECT CASE (MemOrd)<a name='4188'>
        CASE ( 'xzy','xyz','yxz','zxy' )<a name='4189'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_DOUBLE'>wrf_global_to_patch_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_DOUBLE_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='4190'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='4191'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='4192'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='4193'>
        CASE ( 'xy','yx' )<a name='4194'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_DOUBLE'>wrf_global_to_patch_double</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_DOUBLE_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='4195'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='4196'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='4197'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='4198'>
        END SELECT<a name='4199'>
<a name='4200'>
      ELSE IF ( FieldType .EQ. WRF_FLOAT ) THEN<a name='4201'>
<a name='4202'>
        SELECT CASE (MemOrd)<a name='4203'>
        CASE ( 'xzy','xyz','yxz','zxy' )<a name='4204'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_REAL'>wrf_global_to_patch_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_REAL_6"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='4205'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='4206'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='4207'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='4208'>
        CASE ( 'xy','yx' )<a name='4209'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_REAL'>wrf_global_to_patch_real</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_REAL_7"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='4210'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='4211'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='4212'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='4213'>
        END SELECT<a name='4214'>
<a name='4215'>
      ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='4216'>
<a name='4217'>
        SELECT CASE (MemOrd)<a name='4218'>
        CASE ( 'xzy','xyz','yxz','zxy' )<a name='4219'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_INTEGER'>wrf_global_to_patch_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_INTEGER_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='4220'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='4221'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='4222'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='4223'>
        CASE ( 'xy','yx' )<a name='4224'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_INTEGER'>wrf_global_to_patch_integer</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_INTEGER_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='4225'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='4226'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='4227'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='4228'>
        END SELECT<a name='4229'>
<a name='4230'>
      ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='4231'>
<a name='4232'>
        SELECT CASE (MemOrd)<a name='4233'>
        CASE ( 'xzy','xyz','yxz','zxy' )<a name='4234'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_LOGICAL'>wrf_global_to_patch_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_LOGICAL_1"> (  globbuf,  Field  , DomainDesc, Stagger, MemOrd ,    &amp;<a name='4235'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), DomainStart(3), DomainEnd(3), &amp;<a name='4236'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), MemoryStart(3), MemoryEnd(3), &amp;<a name='4237'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , PatchStart(3) , PatchEnd(3)  )<a name='4238'>
        CASE ( 'xy','yx' )<a name='4239'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_GLOBAL_TO_PATCH_LOGICAL'>wrf_global_to_patch_logical</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GLOBAL_TO_PATCH_LOGICAL_2"> (  globbuf, Field ,  DomainDesc, Stagger, MemOrd ,  &amp;<a name='4240'>
             DomainStart(1), DomainEnd(1), DomainStart(2), DomainEnd(2), 1            , 1 , &amp;<a name='4241'>
             MemoryStart(1), MemoryEnd(1), MemoryStart(2), MemoryEnd(2), 1            , 1 , &amp;<a name='4242'>
             PatchStart(1) , PatchEnd(1) , PatchStart(2) , PatchEnd(2) , 1            , 1   )<a name='4243'>
        END SELECT<a name='4244'>
<a name='4245'>
      ENDIF<a name='4246'>
    ENDIF<a name='4247'>
#endif<a name='4248'>
<a name='4249'>
  ELSE <font color=#447700>! not a distributed field<a name='4250'></font>
<a name='4251'>
    IF ( wrf_dm_on_monitor()) THEN<a name='4252'>
      CALL fcn ( Hndl , DateStr , VarName , Field   , FieldType , Comm , IOComm , &amp;<a name='4253'>
                 DomainDesc , MemoryOrder , Stagger , DimNames ,                  &amp;<a name='4254'>
                 DomainStart , DomainEnd ,                                        &amp;<a name='4255'>
                 MemoryStart , MemoryEnd ,                                        &amp;<a name='4256'>
                 PatchStart  , PatchEnd  ,                                        &amp;<a name='4257'>
                 Status )<a name='4258'>
    ENDIF<a name='4259'>
    CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_99">( Status, IWORDSIZE )<a name='4260'>
    memsize = (MemoryEnd(1)-MemoryStart(1)+1)*(MemoryEnd(2)-MemoryStart(2)+1)*(MemoryEnd(3)-MemoryStart(3)+1)<a name='4261'>
    IF ( FieldType .EQ. WRF_DOUBLE ) THEN <a name='4262'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_100">( Field , DWORDSIZE*memsize )<a name='4263'>
    ELSE IF ( FieldType .EQ. WRF_FLOAT) THEN<a name='4264'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_101">( Field , RWORDSIZE*memsize )<a name='4265'>
    ELSE IF ( FieldType .EQ. WRF_INTEGER ) THEN<a name='4266'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_102">( Field , IWORDSIZE*memsize )<a name='4267'>
    ELSE IF ( FieldType .EQ. WRF_LOGICAL ) THEN<a name='4268'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_BYTES'>wrf_dm_bcast_bytes</A><A href='../../html_code/frame/module_io.F.html#CALL_PKG_AND_DIST_GENERIC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_BYTES_103">( Field , LWORDSIZE*memsize )<a name='4269'>
    ENDIF<a name='4270'>
<a name='4271'>
  ENDIF<a name='4272'>
<a name='4273'>
  DEALLOCATE(displs)<a name='4274'>
  DEALLOCATE(counts)<a name='4275'>
  RETURN<a name='4276'>
END SUBROUTINE call_pkg_and_dist_generic<a name='4277'>
<a name='4278'>
<font color=#447700>!!!!!!  Miscellaneous routines<a name='4279'></font>
<a name='4280'>
<font color=#447700>! stole these routines from io_netcdf external package; changed names to avoid collisions<a name='4281'></font>
<A NAME='DIM_FROM_MEMORDER'><A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4282'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>dim_from_memorder</font>(MemoryOrder,NDim) <A href='../../call_to/DIM_FROM_MEMORDER.html' TARGET='index'>2</A>,<A href='../../call_from/DIM_FROM_MEMORDER.html' TARGET='index'>1</A><a name='4283'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='4284'></font>
<font color=#447700>!&lt;PRE&gt;<a name='4285'></font>
<font color=#447700>! Decodes array ranks from memory order.  <a name='4286'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='4287'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='4288'></font>
  CHARACTER*(*) ,INTENT(IN)  :: MemoryOrder<a name='4289'>
  INTEGER       ,INTENT(OUT) :: NDim<a name='4290'>
<font color=#447700>!Local<a name='4291'></font>
  CHARACTER*3                :: MemOrd<a name='4292'>
<font color=#447700>!<a name='4293'></font>
  CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>Lower_Case</A><A href='../../html_code/frame/module_io.F.html#DIM_FROM_MEMORDER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_6">(MemoryOrder,MemOrd)<a name='4294'>
  SELECT CASE (MemOrd)<a name='4295'>
    CASE ('xyz','xzy','yxz','yzx','zxy','zyx')<a name='4296'>
      NDim = 3<a name='4297'>
    CASE ('xy','yx')<a name='4298'>
      NDim = 2<a name='4299'>
    CASE ('z','c','0')<a name='4300'>
      NDim = 1<a name='4301'>
    CASE DEFAULT<a name='4302'>
      NDim = 0<a name='4303'>
      RETURN<a name='4304'>
  END SELECT<a name='4305'>
  RETURN<a name='4306'>
END SUBROUTINE dim_from_memorder<a name='4307'>
<a name='4308'>
<A NAME='LOWER_CASE'><A href='../../html_code/frame/module_io.F.html#LOWER_CASE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='4309'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>lower_case</font>(MemoryOrder,MemOrd) <A href='../../call_to/LOWER_CASE.html' TARGET='index'>10</A><a name='4310'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='4311'></font>
<font color=#447700>!&lt;PRE&gt;<a name='4312'></font>
<font color=#447700>! Translates upper-case characters to lower-case.  <a name='4313'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='4314'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='4315'></font>
  CHARACTER*(*) ,INTENT(IN)  :: MemoryOrder<a name='4316'>
  CHARACTER*(*) ,INTENT(OUT) :: MemOrd<a name='4317'>
<font color=#447700>!Local<a name='4318'></font>
  CHARACTER*1                :: c<a name='4319'>
  INTEGER       ,PARAMETER   :: upper_to_lower =IACHAR('a')-IACHAR('A')<a name='4320'>
  INTEGER                    :: i,n,n1<a name='4321'>
<font color=#447700>!<a name='4322'></font>
  MemOrd = ' '<a name='4323'>
  N = len(MemoryOrder)<a name='4324'>
  N1 = len(MemOrd)<a name='4325'>
  N = MIN(N,N1)<a name='4326'>
  MemOrd(1:N) = MemoryOrder(1:N)<a name='4327'>
  DO i=1,N<a name='4328'>
    c = MemoryOrder(i:i)<a name='4329'>
    if('A'&lt;=c .and. c &lt;='Z') MemOrd(i:i)=achar(iachar(c)+upper_to_lower)<a name='4330'>
  ENDDO<a name='4331'>
  RETURN<a name='4332'>
END SUBROUTINE Lower_Case<a name='4333'>
<a name='4334'>
<A NAME='HAS_CHAR'><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='4335'>
LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>has_char</font>( str, c ),<A href='../../call_from/HAS_CHAR.html' TARGET='index'>2</A><a name='4336'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='4337'></font>
<font color=#447700>!&lt;PRE&gt;<a name='4338'></font>
<font color=#447700>! Returns .TRUE. iff string str contains character c.  Ignores character case.  <a name='4339'></font>
<font color=#447700>!&lt;/PRE&gt;<a name='4340'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='4341'></font>
  IMPLICIT NONE<a name='4342'>
  CHARACTER*(*) str<a name='4343'>
  CHARACTER c, d<a name='4344'>
  CHARACTER*80 str1, str2, str3<a name='4345'>
  INTEGER i<a name='4346'>
<a name='4347'>
  CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_7">( TRIM(str), str1 )<a name='4348'>
  str2 = ""<a name='4349'>
  str2(1:1) = c<a name='4350'>
  CALL <A href='../../html_code/phys/module_cam_support.F.html#LOWER_CASE'>lower_case</A><A href='../../html_code/frame/module_io.F.html#HAS_CHAR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="LOWER_CASE_8">( str2, str3 )<a name='4351'>
  d = str3(1:1)<a name='4352'>
  DO i = 1, LEN(TRIM(str1))<a name='4353'>
    IF ( str1(i:i) .EQ. d ) THEN<a name='4354'>
      has_char = .TRUE.<a name='4355'>
      RETURN<a name='4356'>
    ENDIF<a name='4357'>
  ENDDO<a name='4358'>
  has_char = .FALSE.<a name='4359'>
  RETURN<a name='4360'>
END FUNCTION has_char<a name='4361'>
<a name='4362'>
</pre></body></html>