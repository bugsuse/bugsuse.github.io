<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:DRIVER_LAYER:CONFIGURATION<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<a name='4'>
<A NAME='MODULE_SCALAR_TABLES'><A href='../../html_code/frame/module_configure.F.html#MODULE_SCALAR_TABLES' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='5'>
<font color=#993300>MODULE </font><font color=#cc0000>module_scalar_tables</font> <A href='../../call_to/MODULE_SCALAR_TABLES.html' TARGET='index'>10</A><a name='6'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_configure.F.html#module_configure.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_18"><a name='7'>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_configure.F.html#module_configure.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_41"><a name='8'>
  USE <A href='../../html_code/frame/module_domain_type.F.html#MODULE_DOMAIN_TYPE'>module_domain_type</A><A href='../../html_code/frame/module_configure.F.html#module_configure.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_TYPE_6">, ONLY : streamrec<a name='9'>
#include "<A href='../../html_code/include/scalar_tables.inc.html'>scalar_tables.inc</A>"<A NAME="scalar_tables.inc_1"><A href='../../html_code/frame/module_configure.F.html#module_configure.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='10'>
CONTAINS<a name='11'>
<A NAME='INIT_MODULE_SCALAR_TABLES'><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='12'>
  <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_scalar_tables</font> <A href='../../call_to/INIT_MODULE_SCALAR_TABLES.html' TARGET='index'>1</A>,<A href='../../call_from/INIT_MODULE_SCALAR_TABLES.html' TARGET='index'>3</A><a name='13'>
     INTEGER i , j<a name='14'>
     DO j = 1, max_domains<a name='15'>
#include "<A href='../../html_code/include/scalar_tables_init.inc.html'>scalar_tables_init.inc</A>"<A NAME="scalar_tables_init.inc_2"><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='16'>
     END DO<a name='17'>
  END SUBROUTINE init_module_scalar_tables<a name='18'>
END MODULE module_scalar_tables<a name='19'>
<a name='20'>
<A NAME='MODULE_CONFIGURE'><A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='21'>
<font color=#993300>MODULE </font><font color=#cc0000>module_configure</font> <A href='../../call_to/MODULE_CONFIGURE.html' TARGET='index'>296</A><a name='22'>
<a name='23'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_19"><a name='24'>
   USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_42"><a name='25'>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_17"><a name='26'>
<a name='27'>
   TYPE model_config_rec_type<a name='28'>
      SEQUENCE<a name='29'>
<font color=#447700>! Statements that declare namelist variables are in this file<a name='30'></font>
<font color=#447700>! Note that the namelist is SEQUENCE and generated such that the first item is an<a name='31'></font>
<font color=#447700>! integer, first_item_in_struct and the last is an integer last_item_in_struct<a name='32'></font>
<font color=#447700>! this provides a way of converting this to a buffer for passing to and from<a name='33'></font>
<font color=#447700>! the driver.<a name='34'></font>
#include "<A href='../../html_code/include/namelist_defines.inc.html'>namelist_defines.inc</A>"<A NAME="namelist_defines.inc_3"><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='35'>
   END TYPE model_config_rec_type<a name='36'>
<a name='37'>
   TYPE grid_config_rec_type<a name='38'>
#include "<A href='../../html_code/include/namelist_defines2.inc.html'>namelist_defines2.inc</A>"<A NAME="namelist_defines2.inc_4"><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='39'>
   END TYPE grid_config_rec_type<a name='40'>
<a name='41'>
   TYPE(model_config_rec_type) :: model_config_rec<a name='42'>
<a name='43'>
<font color=#447700>!#include "scalar_tables.inc"<a name='44'></font>
<a name='45'>
<font color=#447700>! special entries (put here but not enshrined in Registry for one reason or other)<a name='46'></font>
<a name='47'>
<font color=#447700>!   CHARACTER (LEN=256) :: mminlu = ' '             ! character string for landuse table<a name='48'></font>
<a name='49'>
CONTAINS<a name='50'>
<a name='51'>
<a name='52'>
<font color=#447700>! Model layer, even though it does I/O -- special case of namelist I/O.<a name='53'></font>
<a name='54'>
<A NAME='INITIAL_CONFIG'><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='55'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>initial_config</font> <A href='../../call_to/INITIAL_CONFIG.html' TARGET='index'>18</A>,<A href='../../call_from/INITIAL_CONFIG.html' TARGET='index'>5</A><a name='56'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='57'></font>
<font color=#447700>! This routine reads in the namelist.input file and sets<a name='58'></font>
<font color=#447700>! module_config_rec, a structure of TYPE(model_config_rec_type), which is is seen via USE association by any<a name='59'></font>
<font color=#447700>! subprogram that uses module_configure.  The module_config_rec structure<a name='60'></font>
<font color=#447700>! contains all namelist settings for all domains.  Variables that apply<a name='61'></font>
<font color=#447700>! to the entire run and have only one value regardless of domain are<a name='62'></font>
<font color=#447700>! scalars.  Variables that allow different settings for each domain are<a name='63'></font>
<font color=#447700>! defined as arrays of dimension max_domains (defined in<a name='64'></font>
<font color=#447700>! frame/module_driver_constants.F, from a setting passed in from<a name='65'></font>
<font color=#447700>! configure.wrf). There is another type in WRF, TYPE(grid_config_rec_type), in which<a name='66'></font>
<font color=#447700>! all fields pertain only to a single domain (and are all scalars). The subroutine<a name='67'></font>
<font color=#447700>! model_to_grid_config_rec(), also in frame/module_configure.F, is used to retrieve<a name='68'></font>
<font color=#447700>! the settings for a given domain from a TYPE(module_config_rec_type) and put them into<a name='69'></font>
<font color=#447700>! a TYPE(grid_config_rec_type), variables of which type are often called &lt;em&gt;config_flags&lt;/em&gt;<a name='70'></font>
<font color=#447700>! in the WRF code.<a name='71'></font>
<font color=#447700>!<a name='72'></font>
<font color=#447700>! Most of the code in this routine is generated from the Registry file<a name='73'></font>
<font color=#447700>! rconfig entries and included from the following files (found in the inc directory):<a name='74'></font>
<font color=#447700>!<a name='75'></font>
<font color=#447700>! &lt;pre&gt;<a name='76'></font>
<font color=#447700>! namelist_defines.inc	declarations of namelist variables (local to this routine)<a name='77'></font>
<font color=#447700>! namelist_statements.inc	NAMELIST statements for each variable<a name='78'></font>
<font color=#447700>! namelist_defaults.inc	assignment to default values if specified in Registry<a name='79'></font>
<font color=#447700>! config_reads.inc		read statements for each namelist record<a name='80'></font>
<font color=#447700>! config_assigns.inc	assign each variable to field in module_config_rec<a name='81'></font>
<font color=#447700>! &lt;/pre&gt;<a name='82'></font>
<font color=#447700>!<a name='83'></font>
<font color=#447700>!NOTE: generated subroutines from Registry file rconfig entries are renamed nl_<a name='84'></font>
<font color=#447700>! instead of rconfig_ due to length limits for subroutine names.<a name='85'></font>
<font color=#447700>!<a name='86'></font>
<font color=#447700>! Note for version WRF 2.0: there is code here to force all domains to<a name='87'></font>
<font color=#447700>! have the same mp_physics setting. This is because different mp_physics<a name='88'></font>
<font color=#447700>! packages have different numbers of tracers but the nest forcing and<a name='89'></font>
<font color=#447700>! feedback code relies on the parent and nest having the same number and<a name='90'></font>
<font color=#447700>! kind of tracers. This means that the microphysics option<a name='91'></font>
<font color=#447700>! specified on the highest numbered domain is the microphysics<a name='92'></font>
<font color=#447700>! option for &lt;em&gt;all&lt;/em&gt; domains in the run. This will be revisited.<a name='93'></font>
<font color=#447700>!<a name='94'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='95'></font>
      IMPLICIT NONE<a name='96'>
<a name='97'>
      INTEGER              :: io_status<a name='98'>
      INTEGER              :: i<a name='99'>
<a name='100'>
      LOGICAL              :: nml_read_error<a name='101'>
<a name='102'>
      CHARACTER (LEN=1024) :: nml_name<a name='103'>
<a name='104'>
      INTEGER, PARAMETER :: nml_write_unit= 9<a name='105'>
      INTEGER, PARAMETER :: nml_read_unit = 10<a name='106'>
<a name='107'>
<a name='108'>
<font color=#447700>! define as temporaries<a name='109'></font>
#include "<A href='../../html_code/include/namelist_defines.inc.html'>namelist_defines.inc</A>"<A NAME="namelist_defines.inc_5"><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='110'>
<a name='111'>
<font color=#447700>! Statements that specify the namelists<a name='112'></font>
#include "<A href='../../html_code/include/namelist_statements.inc.html'>namelist_statements.inc</A>"<A NAME="namelist_statements.inc_6"><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='113'>
<a name='114'>
      OPEN ( UNIT   = nml_read_unit    ,      &amp;<a name='115'>
             FILE   = "namelist.input" ,      &amp;<a name='116'>
             FORM   = "FORMATTED"      ,      &amp;<a name='117'>
             STATUS = "OLD"            ,      &amp;<a name='118'>
             IOSTAT = io_status         )<a name='119'>
<a name='120'>
      IF ( io_status .NE. 0 ) THEN<a name='121'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_165"> ( 'ERROR OPENING namelist.input' )<a name='122'>
      ENDIF<a name='123'>
<a name='124'>
#ifndef NO_NAMELIST_PRINT<a name='125'>
      OPEN ( UNIT   = nml_write_unit    ,      &amp;<a name='126'>
#if (DA_CORE == 1)<a name='127'>
             FILE   = "namelist.output.da" ,      &amp;<a name='128'>
#else<a name='129'>
             FILE   = "namelist.output" ,      &amp;<a name='130'>
#endif<a name='131'>
             FORM   = "FORMATTED"      ,      &amp;<a name='132'>
             STATUS = "REPLACE"        ,      &amp;<a name='133'>
             IOSTAT = io_status         )<a name='134'>
<a name='135'>
      IF ( io_status .NE. 0 ) THEN<a name='136'>
#if (DA_CORE == 1)<a name='137'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_166"> ( 'ERROR OPENING namelist.output.da' )<a name='138'>
#else<a name='139'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_167"> ( 'ERROR OPENING namelist.output' )<a name='140'>
#endif<a name='141'>
      ENDIF<a name='142'>
#endif<a name='143'>
<a name='144'>
<font color=#447700>! Statements that set the namelist vars to default vals<a name='145'></font>
#  include "<A href='../../html_code/include/namelist_defaults.inc.html'>namelist_defaults.inc</A>"<A NAME="namelist_defaults.inc_7"><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='146'>
<a name='147'>
#if (DA_CORE == 1)<a name='148'>
<font color=#447700>! Override the default values, because we can not assigned a arrary with different values in registry.<a name='149'></font>
<a name='150'>
      as1(1:3) = (/ 0.25, 1.0, 1.5 /)<a name='151'>
      as2(1:3) = (/ 0.25, 1.0, 1.5 /)<a name='152'>
      as3(1:3) = (/ 0.25, 1.0, 1.5 /)<a name='153'>
      as4(1:3) = (/ 0.25, 1.0, 1.5 /)<a name='154'>
      as5(1:3) = (/ 0.25, 1.0, 1.5 /)<a name='155'>
#endif<a name='156'>
<a name='157'>
<font color=#447700>! Statements that read the namelist are in this file<a name='158'></font>
#  include "<A href='../../html_code/include/config_reads.inc.html'>config_reads.inc</A>"<A NAME="config_reads.inc_8"><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='159'>
<a name='160'>
<font color=#447700>! 2004/04/28  JM (with consensus by the group of developers)<a name='161'></font>
<font color=#447700>! This is needed to ensure that nesting will work, since<a name='162'></font>
<font color=#447700>! different mp_physics packages have different numbers of<a name='163'></font>
<font color=#447700>! tracers. Basically, this says that the microphysics option<a name='164'></font>
<font color=#447700>! specified on the highest numbered domain *is* the microphysics<a name='165'></font>
<font color=#447700>! option for the run. Not the best solution but okay for 2.0.<a name='166'></font>
<font color=#447700>!<a name='167'></font>
<a name='168'>
      DO i = 1, max_dom<a name='169'>
         mp_physics(i) = mp_physics(max_dom)<a name='170'>
      ENDDO<a name='171'>
<a name='172'>
<font color=#447700>! Statements that assign the variables to the cfg record are in this file<a name='173'></font>
<font color=#447700>! except the namelist_derived variables where are assigned below<a name='174'></font>
#undef SOURCE_RECORD<a name='175'>
#undef DEST_RECORD<a name='176'>
#undef SOURCE_REC_DEX<a name='177'>
#define SOURCE_RECORD<a name='178'>
#define DEST_RECORD model_config_rec %<a name='179'>
#define SOURCE_REC_DEX<a name='180'>
#include "<A href='../../html_code/include/config_assigns.inc.html'>config_assigns.inc</A>"<A NAME="config_assigns.inc_9"><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='181'>
<a name='182'>
<a name='183'>
      CLOSE ( UNIT = nml_read_unit , IOSTAT = io_status )<a name='184'>
<a name='185'>
      IF ( io_status .NE. 0 ) THEN<a name='186'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_168"> ( 'ERROR CLOSING namelist.input' )<a name='187'>
      ENDIF<a name='188'>
<a name='189'>
#ifndef NO_NAMELIST_PRINT<a name='190'>
      CLOSE ( UNIT = nml_write_unit , IOSTAT = io_status )<a name='191'>
<a name='192'>
      IF ( io_status .NE. 0 ) THEN<a name='193'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>WRF_ERROR_FATAL</A><A href='../../html_code/frame/module_configure.F.html#INITIAL_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_169"> ( 'ERROR CLOSING namelist.output' )<a name='194'>
      ENDIF<a name='195'>
#endif<a name='196'>
<a name='197'>
#ifdef _WIN32<a name='198'>
      model_config_rec%nocolons = .TRUE.   <font color=#447700>! always no colons for Windows<a name='199'></font>
#endif<a name='200'>
<a name='201'>
      RETURN<a name='202'>
<a name='203'>
   END SUBROUTINE initial_config<a name='204'>
<a name='205'>
#if 1<a name='206'>
<A NAME='GET_CONFIG_AS_BUFFER'><A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='207'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_config_as_buffer</font>( buffer, buflen, ncopied ) <A href='../../call_to/GET_CONFIG_AS_BUFFER.html' TARGET='index'>18</A>,<A href='../../call_from/GET_CONFIG_AS_BUFFER.html' TARGET='index'>2</A><a name='208'>
<font color=#447700>! note that model_config_rec_type must be defined as a sequence derived type<a name='209'></font>
      INTEGER,   INTENT(INOUT) ::  buffer(*)<a name='210'>
      INTEGER,   INTENT(IN)    ::  buflen<a name='211'>
      INTEGER,   INTENT(OUT)   ::  ncopied<a name='212'>
<font color=#447700>!      TYPE(model_config_rec_type) :: model_config_rec<a name='213'></font>
      INTEGER :: nbytes<a name='214'>
      CALL wrf_num_bytes_between ( model_config_rec%last_item_in_struct ,   &amp;<a name='215'>
                                   model_config_rec%first_item_in_struct ,  &amp;<a name='216'>
                                   nbytes )<a name='217'>
<font color=#447700>!      nbytes = loc(model_config_rec%last_item_in_struct) - &amp;<a name='218'></font>
<font color=#447700>!               loc(model_config_rec%first_item_in_struct)<a name='219'></font>
      IF ( nbytes .gt. buflen ) THEN<a name='220'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_170">( &amp;<a name='221'>
        "get_config_rec_as_buffer: buffer size too small for config_rec" )<a name='222'>
      ENDIF<a name='223'>
      CALL wrf_mem_copy( model_config_rec, buffer, nbytes )<a name='224'>
      ncopied = nbytes<a name='225'>
      RETURN<a name='226'>
   END SUBROUTINE get_config_as_buffer<a name='227'>
<a name='228'>
<A NAME='SET_CONFIG_AS_BUFFER'><A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='229'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_config_as_buffer</font>( buffer, buflen ) <A href='../../call_to/SET_CONFIG_AS_BUFFER.html' TARGET='index'>18</A>,<A href='../../call_from/SET_CONFIG_AS_BUFFER.html' TARGET='index'>2</A><a name='230'>
<font color=#447700>! note that model_config_rec_type must be defined as a sequence derived type<a name='231'></font>
      INTEGER,   INTENT(INOUT) ::  buffer(*)<a name='232'>
      INTEGER,   INTENT(IN)    ::  buflen<a name='233'>
<font color=#447700>!      TYPE(model_config_rec_type) :: model_config_rec<a name='234'></font>
      INTEGER :: nbytes<a name='235'>
      CALL wrf_num_bytes_between ( model_config_rec%last_item_in_struct ,  &amp;<a name='236'>
                                   model_config_rec%first_item_in_struct , &amp;<a name='237'>
                                   nbytes )<a name='238'>
<font color=#447700>!      nbytes = loc(model_config_rec%last_item_in_struct) - &amp;<a name='239'></font>
<font color=#447700>!               loc(model_config_rec%first_item_in_struct)<a name='240'></font>
      IF ( nbytes .gt. buflen ) THEN<a name='241'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_171">( &amp;<a name='242'>
        "set_config_rec_as_buffer: buffer length too small to fill model config record" )<a name='243'>
      ENDIF<a name='244'>
      CALL wrf_mem_copy( buffer, model_config_rec, nbytes )<a name='245'>
      RETURN<a name='246'>
   END SUBROUTINE set_config_as_buffer<a name='247'>
#else<a name='248'>
<A NAME='GET_CONFIG_AS_BUFFER'><A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='249'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_config_as_buffer</font>( buffer, buflen, ncopied ) <A href='../../call_to/GET_CONFIG_AS_BUFFER.html' TARGET='index'>18</A>,<A href='../../call_from/GET_CONFIG_AS_BUFFER.html' TARGET='index'>2</A><a name='250'>
<font color=#447700>! note that model_config_rec_type must be defined as a sequence derived type<a name='251'></font>
      INTEGER*1, INTENT(INOUT) ::  buffer(*)<a name='252'>
      INTEGER,   INTENT(IN)    ::  buflen<a name='253'>
      INTEGER,   INTENT(OUT)   ::  ncopied<a name='254'>
<font color=#447700>!      TYPE(model_config_rec_type) :: model_config_rec<a name='255'></font>
      INTEGER :: nbytes<a name='256'>
      nbytes = loc(model_config_rec%last_item_in_struct) - &amp;<a name='257'>
               loc(model_config_rec%first_item_in_struct)<a name='258'>
      IF ( nbytes .gt. buflen ) THEN<a name='259'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_configure.F.html#GET_CONFIG_AS_BUFFER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_172">( &amp;<a name='260'>
        "get_config_rec_as_buffer: buffer size too small for config_rec" )<a name='261'>
      ENDIF<a name='262'>
      CALL wrf_mem_copy( model_config_rec, buffer, nbytes )<a name='263'>
      ncopied = nbytes<a name='264'>
      RETURN<a name='265'>
   END SUBROUTINE get_config_as_buffer<a name='266'>
<a name='267'>
<A NAME='SET_CONFIG_AS_BUFFER'><A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='268'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_config_as_buffer</font>( buffer, buflen ) <A href='../../call_to/SET_CONFIG_AS_BUFFER.html' TARGET='index'>18</A>,<A href='../../call_from/SET_CONFIG_AS_BUFFER.html' TARGET='index'>2</A><a name='269'>
<font color=#447700>! note that model_config_rec_type must be defined as a sequence derived type<a name='270'></font>
      INTEGER*1, INTENT(INOUT) ::  buffer(*)<a name='271'>
      INTEGER,   INTENT(IN)    ::  buflen<a name='272'>
<font color=#447700>!      TYPE(model_config_rec_type) :: model_config_rec<a name='273'></font>
      INTEGER :: nbytes<a name='274'>
      nbytes = loc(model_config_rec%last_item_in_struct) - &amp;<a name='275'>
               loc(model_config_rec%first_item_in_struct)<a name='276'>
      IF ( nbytes .gt. buflen ) THEN<a name='277'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_configure.F.html#SET_CONFIG_AS_BUFFER' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_173">( &amp;<a name='278'>
        "set_config_rec_as_buffer: buffer length too small to fill model config record" )<a name='279'>
      ENDIF<a name='280'>
      CALL wrf_mem_copy( buffer, model_config_rec, nbytes )<a name='281'>
      RETURN<a name='282'>
   END SUBROUTINE set_config_as_buffer<a name='283'>
#endif<a name='284'>
<a name='285'>
<A NAME='MODEL_TO_GRID_CONFIG_REC'><A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='286'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>model_to_grid_config_rec</font> ( id_id , model_config_rec , grid_config_rec ) <A href='../../call_to/MODEL_TO_GRID_CONFIG_REC.html' TARGET='index'>87</A><a name='287'>
      INTEGER , INTENT(IN)                         ::  id_id<a name='288'>
      TYPE ( model_config_rec_type ) , INTENT(IN)  ::  model_config_rec<a name='289'>
      TYPE ( grid_config_rec_type  ) , INTENT(OUT) ::  grid_config_rec<a name='290'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='291'></font>
<font color=#447700>! This routine is called to populate a domain specific configuration<a name='292'></font>
<font color=#447700>! record of TYPE(grid_config_rec_type) with the configuration information<a name='293'></font>
<font color=#447700>! for that domain that is stored in TYPE(model_config_rec). Both types<a name='294'></font>
<font color=#447700>! are defined in frame/module_configure.F.  The input argument is the<a name='295'></font>
<font color=#447700>! record of type model_config_rec_type contains the model-wide<a name='296'></font>
<font color=#447700>! configuration information (that is, settings that apply to the model in<a name='297'></font>
<font color=#447700>! general) and configuration information for each individual domain.  The<a name='298'></font>
<font color=#447700>! output argument is the record of type grid_config_rec_type which<a name='299'></font>
<font color=#447700>! contains the model-wide configuration information and the<a name='300'></font>
<font color=#447700>! domain-specific information for this domain only.  In the<a name='301'></font>
<font color=#447700>! model_config_rec, the domain specific information is arrays, indexed by<a name='302'></font>
<font color=#447700>! the grid id's.  In the grid_config_rec the domain-specific information<a name='303'></font>
<font color=#447700>! is scalar and for the specific domain.  The first argument to this<a name='304'></font>
<font color=#447700>! routine is the grid id (top-most domain is always 1) as specified in<a name='305'></font>
<font color=#447700>! the domain-specific namelist variable grid_id.<a name='306'></font>
<font color=#447700>!<a name='307'></font>
<font color=#447700>! The actual assignments form the model_config_rec_type to the<a name='308'></font>
<font color=#447700>! grid_config_rec_type are generate from the rconfig entries in the<a name='309'></font>
<font color=#447700>! Registry file and included by this routine from the file<a name='310'></font>
<font color=#447700>! inc/config_assigns.inc.<a name='311'></font>
<font color=#447700>!<a name='312'></font>
<font color=#447700>!NOTE: generated subroutines from Registry file rconfig entries are renamed nl_<a name='313'></font>
<font color=#447700>! instead of rconfig_ due to length limits for subroutine names.<a name='314'></font>
<font color=#447700>!<a name='315'></font>
<font color=#447700>!<a name='316'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='317'></font>
#undef SOURCE_RECORD<a name='318'>
#undef SOURCE_REC_DEX<a name='319'>
#undef DEST_RECORD<a name='320'>
#define SOURCE_RECORD model_config_rec %<a name='321'>
#define SOURCE_REC_DEX (id_id)<a name='322'>
#define DEST_RECORD   grid_config_rec %<a name='323'>
#include "<A href='../../html_code/include/config_assigns.inc.html'>config_assigns.inc</A>"<A NAME="config_assigns.inc_10"><A href='../../html_code/frame/module_configure.F.html#MODEL_TO_GRID_CONFIG_REC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='324'>
   END SUBROUTINE model_to_grid_config_rec<a name='325'>
<a name='326'>
<a name='327'>
<A NAME='IN_USE_FOR_CONFIG'><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='328'>
   <font color=#993300>FUNCTION </font><font color=#cc0000>in_use_for_config</font> ( id, vname ) RESULT ( in_use )<a name='329'>
     INTEGER, INTENT(IN) :: id<a name='330'>
     CHARACTER*(*), INTENT(IN) :: vname<a name='331'>
     LOGICAL in_use<a name='332'>
     INTEGER uses<a name='333'>
<a name='334'>
     uses = 0<a name='335'>
     in_use = .TRUE.<a name='336'>
<a name='337'>
     IF      ( vname(1:1) .EQ. 'a' ) THEN<a name='338'>
#    include "<A href='../../html_code/include/in_use_for_config_a.inc.html'>in_use_for_config_a.inc</A>"<A NAME="in_use_for_config_a.inc_11"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='339'>
     ELSE IF ( vname(1:1) .EQ. 'b' ) THEN<a name='340'>
#    include "<A href='../../html_code/include/in_use_for_config_b.inc.html'>in_use_for_config_b.inc</A>"<A NAME="in_use_for_config_b.inc_12"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='341'>
     ELSE IF ( vname(1:1) .EQ. 'c' ) THEN<a name='342'>
#    include "<A href='../../html_code/include/in_use_for_config_c.inc.html'>in_use_for_config_c.inc</A>"<A NAME="in_use_for_config_c.inc_13"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='343'>
     ELSE IF ( vname(1:1) .EQ. 'd' ) THEN<a name='344'>
#    include "<A href='../../html_code/include/in_use_for_config_d.inc.html'>in_use_for_config_d.inc</A>"<A NAME="in_use_for_config_d.inc_14"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='345'>
     ELSE IF ( vname(1:1) .EQ. 'e' ) THEN<a name='346'>
#    include "<A href='../../html_code/include/in_use_for_config_e.inc.html'>in_use_for_config_e.inc</A>"<A NAME="in_use_for_config_e.inc_15"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='347'>
     ELSE IF ( vname(1:1) .EQ. 'f' ) THEN<a name='348'>
#    include "<A href='../../html_code/include/in_use_for_config_f.inc.html'>in_use_for_config_f.inc</A>"<A NAME="in_use_for_config_f.inc_16"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='349'>
     ELSE IF ( vname(1:1) .EQ. 'g' ) THEN<a name='350'>
#    include "<A href='../../html_code/include/in_use_for_config_g.inc.html'>in_use_for_config_g.inc</A>"<A NAME="in_use_for_config_g.inc_17"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='351'>
     ELSE IF ( vname(1:1) .EQ. 'h' ) THEN<a name='352'>
#    include "<A href='../../html_code/include/in_use_for_config_h.inc.html'>in_use_for_config_h.inc</A>"<A NAME="in_use_for_config_h.inc_18"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='353'>
     ELSE IF ( vname(1:1) .EQ. 'i' ) THEN<a name='354'>
#    include "<A href='../../html_code/include/in_use_for_config_i.inc.html'>in_use_for_config_i.inc</A>"<A NAME="in_use_for_config_i.inc_19"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='355'>
     ELSE IF ( vname(1:1) .EQ. 'j' ) THEN<a name='356'>
#    include "<A href='../../html_code/include/in_use_for_config_j.inc.html'>in_use_for_config_j.inc</A>"<A NAME="in_use_for_config_j.inc_20"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='357'>
     ELSE IF ( vname(1:1) .EQ. 'k' ) THEN<a name='358'>
#    include "<A href='../../html_code/include/in_use_for_config_k.inc.html'>in_use_for_config_k.inc</A>"<A NAME="in_use_for_config_k.inc_21"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='359'>
     ELSE IF ( vname(1:1) .EQ. 'l' ) THEN<a name='360'>
#    include "<A href='../../html_code/include/in_use_for_config_l.inc.html'>in_use_for_config_l.inc</A>"<A NAME="in_use_for_config_l.inc_22"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='361'>
     ELSE IF ( vname(1:1) .EQ. 'm' ) THEN<a name='362'>
#    include "<A href='../../html_code/include/in_use_for_config_m.inc.html'>in_use_for_config_m.inc</A>"<A NAME="in_use_for_config_m.inc_23"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='363'>
     ELSE IF ( vname(1:1) .EQ. 'n' ) THEN<a name='364'>
#    include "<A href='../../html_code/include/in_use_for_config_n.inc.html'>in_use_for_config_n.inc</A>"<A NAME="in_use_for_config_n.inc_24"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='365'>
     ELSE IF ( vname(1:1) .EQ. 'o' ) THEN<a name='366'>
#    include "<A href='../../html_code/include/in_use_for_config_o.inc.html'>in_use_for_config_o.inc</A>"<A NAME="in_use_for_config_o.inc_25"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='367'>
     ELSE IF ( vname(1:1) .EQ. 'p' ) THEN<a name='368'>
#    include "<A href='../../html_code/include/in_use_for_config_p.inc.html'>in_use_for_config_p.inc</A>"<A NAME="in_use_for_config_p.inc_26"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='369'>
     ELSE IF ( vname(1:1) .EQ. 'q' ) THEN<a name='370'>
#    include "<A href='../../html_code/include/in_use_for_config_q.inc.html'>in_use_for_config_q.inc</A>"<A NAME="in_use_for_config_q.inc_27"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='371'>
     ELSE IF ( vname(1:1) .EQ. 'r' ) THEN<a name='372'>
#    include "<A href='../../html_code/include/in_use_for_config_r.inc.html'>in_use_for_config_r.inc</A>"<A NAME="in_use_for_config_r.inc_28"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='373'>
     ELSE IF ( vname(1:1) .EQ. 's' ) THEN<a name='374'>
#    include "<A href='../../html_code/include/in_use_for_config_s.inc.html'>in_use_for_config_s.inc</A>"<A NAME="in_use_for_config_s.inc_29"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='375'>
     ELSE IF ( vname(1:1) .EQ. 't' ) THEN<a name='376'>
#    include "<A href='../../html_code/include/in_use_for_config_t.inc.html'>in_use_for_config_t.inc</A>"<A NAME="in_use_for_config_t.inc_30"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='377'>
     ELSE IF ( vname(1:1) .EQ. 'u' ) THEN<a name='378'>
#    include "<A href='../../html_code/include/in_use_for_config_u.inc.html'>in_use_for_config_u.inc</A>"<A NAME="in_use_for_config_u.inc_31"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='379'>
     ELSE IF ( vname(1:1) .EQ. 'v' ) THEN<a name='380'>
#    include "<A href='../../html_code/include/in_use_for_config_v.inc.html'>in_use_for_config_v.inc</A>"<A NAME="in_use_for_config_v.inc_32"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='381'>
     ELSE IF ( vname(1:1) .EQ. 'w' ) THEN<a name='382'>
#    include "<A href='../../html_code/include/in_use_for_config_w.inc.html'>in_use_for_config_w.inc</A>"<A NAME="in_use_for_config_w.inc_33"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='383'>
     ELSE IF ( vname(1:1) .EQ. 'x' ) THEN<a name='384'>
#    include "<A href='../../html_code/include/in_use_for_config_x.inc.html'>in_use_for_config_x.inc</A>"<A NAME="in_use_for_config_x.inc_34"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='385'>
     ELSE IF ( vname(1:1) .EQ. 'y' ) THEN<a name='386'>
#    include "<A href='../../html_code/include/in_use_for_config_y.inc.html'>in_use_for_config_y.inc</A>"<A NAME="in_use_for_config_y.inc_35"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='387'>
     ELSE IF ( vname(1:1) .EQ. 'z' ) THEN<a name='388'>
#    include "<A href='../../html_code/include/in_use_for_config_z.inc.html'>in_use_for_config_z.inc</A>"<A NAME="in_use_for_config_z.inc_36"><A href='../../html_code/frame/module_configure.F.html#IN_USE_FOR_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='389'>
     ENDIF<a name='390'>
<a name='391'>
     RETURN<a name='392'>
   END FUNCTION<a name='393'>
<a name='394'>
<a name='395'>
<font color=#447700>! Include the definitions of all the routines that return a namelist values<a name='396'></font>
<font color=#447700>! back to the driver. These are generated by the registry<a name='397'></font>
<a name='398'>
<A NAME='INIT_MODULE_CONFIGURE'><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_CONFIGURE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='399'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_configure</font> <A href='../../call_to/INIT_MODULE_CONFIGURE.html' TARGET='index'>2</A>,<A href='../../call_from/INIT_MODULE_CONFIGURE.html' TARGET='index'>2</A><a name='400'>
     USE <A href='../../html_code/frame/module_configure.F.html#MODULE_SCALAR_TABLES'>module_scalar_tables</A><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_CONFIGURE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SCALAR_TABLES_1"><a name='401'>
     IMPLICIT NONE<a name='402'>
     CALL <A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_SCALAR_TABLES'>init_module_scalar_tables</A><A href='../../html_code/frame/module_configure.F.html#INIT_MODULE_CONFIGURE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="INIT_MODULE_SCALAR_TABLES_1"><a name='403'>
   END SUBROUTINE init_module_configure<a name='404'>
<a name='405'>
<A NAME='WRF_ALT_NML_OBSOLETE'><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='406'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_alt_nml_obsolete</font> (nml_read_unit, nml_name),<A href='../../call_from/WRF_ALT_NML_OBSOLETE.html' TARGET='index'>15</A><a name='407'>
<font color=#447700>!<a name='408'></font>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='409'></font>
<font color=#447700>! If there is an error reading the "nml_name" namelist, this routine is<a name='410'></font>
<font color=#447700>! called to check for namelist variables that have been removed by the <a name='411'></font>
<font color=#447700>! developers and are still in user's namelists.<a name='412'></font>
<font color=#447700>! <a name='413'></font>
<font color=#447700>! The calls to this routine are in registry-generated code: inc/config_reads.inc<a name='414'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='415'></font>
<font color=#447700>!<a name='416'></font>
     IMPLICIT NONE<a name='417'>
     INTEGER, INTENT(IN)       :: nml_read_unit<a name='418'>
     CHARACTER*(*), INTENT(IN) :: nml_name<a name='419'>
     INTEGER                   :: nml_error<a name='420'>
<a name='421'>
#include "<A href='../../html_code/include/namelist_defines.inc.html'>namelist_defines.inc</A>"<A NAME="namelist_defines.inc_37"><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='422'>
#include "<A href='../../html_code/include/namelist_statements.inc.html'>namelist_statements.inc</A>"<A NAME="namelist_statements.inc_38"><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='423'>
<a name='424'>
<font color=#447700>! These are the variables that have been removed<a name='425'></font>
     logical , DIMENSION(max_domains) :: pd_moist, pd_chem, pd_tke, pd_scalar<a name='426'>
     NAMELIST /dynamics/                 pd_moist, pd_chem, pd_tke, pd_scalar<a name='427'>
<a name='428'>
     integer , DIMENSION(max_domains) :: ucmcall<a name='429'>
     NAMELIST /physics/                  ucmcall<a name='430'>
<a name='431'>
     integer , DIMENSION(max_domains) :: obs_nobs_prt<a name='432'>
     NAMELIST /fdda/                     obs_nobs_prt<a name='433'>
<a name='434'>
     LOGICAL ::         global, print_detail_airep, print_detail_timing<a name='435'>
     NAMELIST /wrfvar1/ global, print_detail_airep, print_detail_timing<a name='436'>
<a name='437'>
     LOGICAL ::         write_qcw, write_qrn, write_qci, write_qsn<a name='438'>
     NAMELIST /wrfvar2/ write_qcw, write_qrn, write_qci, write_qsn<a name='439'>
     LOGICAL ::          write_qgr, write_filtered_obs<a name='440'>
     NAMELIST /wrfvar2/  write_qgr, write_filtered_obs<a name='441'>
<a name='442'>
     LOGICAL ::         use_eos_radobs, use_3dvar_phy<a name='443'>
     NAMELIST /wrfvar4/ use_eos_radobs, use_3dvar_phy<a name='444'>
<a name='445'>
     LOGICAL             :: use_crtm_kmatrix_fast<a name='446'>
     NAMELIST /wrfvar14/    use_crtm_kmatrix_fast<a name='447'>
     CHARACTER (LEN=256) :: spccoeff_file, taucoeff_file, aerosolcoeff_file<a name='448'>
     NAMELIST /wrfvar14/    spccoeff_file, taucoeff_file, aerosolcoeff_file<a name='449'>
     CHARACTER (LEN=256) :: cloudcoeff_file, emiscoeff_file<a name='450'>
     NAMELIST /wrfvar14/    cloudcoeff_file, emiscoeff_file<a name='451'>
<a name='452'>
<a name='453'>
<a name='454'>
<font color=#447700>! Read the namelist again, if it succeeds after adding the above variables,<a name='455'></font>
<font color=#447700>! it probably failed because these are still in the namelist.  If it fails<a name='456'></font>
<font color=#447700>! again, we will return.<a name='457'></font>
<a name='458'>
     REWIND ( UNIT = nml_read_unit )<a name='459'>
<a name='460'>
<font color=#447700>!----------------------------- dynamics ---------------------------------<a name='461'></font>
     if ( TRIM(nml_name) .eq. "dynamics" ) then<a name='462'>
<a name='463'>
        READ   ( UNIT = nml_read_unit , NML = dynamics , iostat=nml_error )<a name='464'>
<a name='465'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='466'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_154">(0, "-- Are pd_moist, pd_chem, pd_tke, or pd_scalar still in your "// &amp;<a name='467'>
                               TRIM(nml_name)//" namelist?")<a name='468'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_155">(0, "-- Replace them with moist_adv_opt, chem_adv_opt, tke_adv_opt "// &amp;<a name='469'>
                             " and scalar_adv_opt, respectively.")<a name='470'>
        ENDIF<a name='471'>
<a name='472'>
<font color=#447700>!---------------------------------- physics -----------------------------<a name='473'></font>
     else if ( TRIM(nml_name) .eq. "physics" ) then<a name='474'>
<a name='475'>
        READ   ( UNIT = nml_read_unit , NML = physics , iostat=nml_error )<a name='476'>
<a name='477'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='478'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_156">(0, "-- Is ucmcall still in your "// TRIM(nml_name)//" namelist?")<a name='479'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_157">(0, "-- Replace it with sf_urban_physics")<a name='480'>
        ENDIF<a name='481'>
<a name='482'>
<font color=#447700>!---------------------------------- fdda --------------------------------<a name='483'></font>
     else if ( TRIM(nml_name) .eq. "fdda" ) then<a name='484'>
<a name='485'>
        READ   ( UNIT = nml_read_unit , NML = fdda , iostat=nml_error )<a name='486'>
<a name='487'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='488'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_158">(0, "-- Is obs_nobs_prt still in your "// TRIM(nml_name)//" namelist?")<a name='489'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_159">(0, "-- Replace it with obs_prt_max")<a name='490'>
        ENDIF<a name='491'>
<a name='492'>
<font color=#447700>!---------------------------------- wrfvar1 -----------------------------<a name='493'></font>
     else if ( TRIM(nml_name) .eq. "wrfvar1" ) then<a name='494'>
<a name='495'>
        READ   ( UNIT = nml_read_unit , NML = wrfvar1 , iostat=nml_error )<a name='496'>
<a name='497'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='498'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_160">(0, "-- Are global, print_detail_airep, print_detail_timing still in your "// &amp;<a name='499'>
                              TRIM(nml_name)//" namelist?")<a name='500'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_161">(0, "-- Remove global, print_detail_airep, print_detail_timing "// &amp;<a name='501'>
                             "from wrfvar1 namelist as they are obsolete.")<a name='502'>
        ENDIF<a name='503'>
<a name='504'>
<font color=#447700>!---------------------------------- wrfvar2 -----------------------------<a name='505'></font>
     else if ( TRIM(nml_name) .eq. "wrfvar2" ) then<a name='506'>
<a name='507'>
        READ   ( UNIT = nml_read_unit , NML = wrfvar2 , iostat=nml_error )<a name='508'>
<a name='509'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='510'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_162">(0, "-- Are write_qcw, write_qrn, write_qci, write_qsn, write_qgr, "// &amp;<a name='511'>
                             "write_filtered_obs still in your "// &amp;<a name='512'>
                              TRIM(nml_name)//" namelist?")<a name='513'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_163">(0, "-- Remove write_qcw, write_qrn, write_qci, write_qsn, write_qgr, "// &amp;<a name='514'>
                             "write_filtered_obs as they are obsolete.")<a name='515'>
        ENDIF<a name='516'>
<a name='517'>
<font color=#447700>!---------------------------------- wrfvar4 -----------------------------<a name='518'></font>
     else if ( TRIM(nml_name) .eq. "wrfvar4" ) then<a name='519'>
<a name='520'>
        READ   ( UNIT = nml_read_unit , NML = wrfvar4 , iostat=nml_error )<a name='521'>
<a name='522'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='523'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_164">(0, "-- Is use_3dvar_phy or use_eos_radobs still in your "// &amp;<a name='524'>
                              TRIM(nml_name)//" namelist?")<a name='525'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_165">(0, "-- Remove use_3dvar_phy, use_eos_radobs as they are obsolete.")<a name='526'>
        ENDIF<a name='527'>
<a name='528'>
<font color=#447700>!---------------------------------- wrfvar14 -----------------------------<a name='529'></font>
     else if ( TRIM(nml_name) .eq. "wrfvar14" ) then<a name='530'>
<a name='531'>
     READ   ( UNIT = nml_read_unit , NML = wrfvar14 , iostat=nml_error )<a name='532'>
<a name='533'>
        IF ( nml_error .EQ. 0 ) then    <font color=#447700>! Successul, rm variables must be problem<a name='534'></font>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_166">(0, "-- Are use_crtm_kmatrix_fast, spccoeff_file, taucoeff_file, "// &amp;<a name='535'>
                             "aerosolcoeff_file, cloudcoeff_file, emiscoeff_file still in your "// &amp;<a name='536'>
                              TRIM(nml_name)//" namelist?")<a name='537'>
           CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_167">(0, "-- Remove them as they are obsolete.")<a name='538'>
        ENDIF<a name='539'>
<a name='540'>
<font color=#447700>!---------------------------------- error -------------------------------<a name='541'></font>
     else<a name='542'>
         IF ( &amp;<a name='543'>
#include "<A href='../../html_code/include/namelist_nametest.inc.html'>namelist_nametest.inc</A>"<A NAME="namelist_nametest.inc_39"><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='544'>
              ) THEN<a name='545'>
            nml_error = 0<a name='546'>
         ELSE<a name='547'>
            CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_configure.F.html#WRF_ALT_NML_OBSOLETE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_168">(0, TRIM(nml_name)//" is not a valid namelist name")<a name='548'>
         ENDIF<a name='549'>
     end if<a name='550'>
<a name='551'>
     IF ( nml_error .NE. 0 ) then    <font color=#447700>! Still failed<a name='552'></font>
        return<a name='553'>
     ENDIF<a name='554'>
<a name='555'>
   END SUBROUTINE wrf_alt_nml_obsolete<a name='556'>
<a name='557'>
END MODULE module_configure<a name='558'>
<a name='559'>
<a name='560'>
<A NAME='SET_SCALAR_INDICES_FROM_CONFIG'><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='561'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>set_scalar_indices_from_config</font> ( idomain , dummy2, dummy1 ) <A href='../../call_to/SET_SCALAR_INDICES_FROM_CONFIG.html' TARGET='index'>22</A>,<A href='../../call_from/SET_SCALAR_INDICES_FROM_CONFIG.html' TARGET='index'>5</A><a name='562'>
  USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_20"><a name='563'>
  USE <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_43"><a name='564'>
  USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_18"><a name='565'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_64">, ONLY : model_config_rec<a name='566'>
  USE <A href='../../html_code/frame/module_configure.F.html#MODULE_SCALAR_TABLES'>module_scalar_tables</A><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_SCALAR_TABLES_2"><a name='567'>
  IMPLICIT NONE<a name='568'>
  INTEGER , INTENT(IN)  :: idomain<a name='569'>
  INTEGER               :: dummy1<a name='570'>
  INTEGER               :: dummy2<a name='571'>
<a name='572'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='573'></font>
<font color=#447700>!This routine is called to adjust the integer variables that are defined<a name='574'></font>
<font color=#447700>!in frame/module_state_description.F (Registry-generated) and that serve<a name='575'></font>
<font color=#447700>!as indices into 4D tracer arrays for moisture, chemistry, etc.<a name='576'></font>
<font color=#447700>!Different domains (different grid data structures) are allowed to have<a name='577'></font>
<font color=#447700>!different sets of tracers so these indices can vary from domain to<a name='578'></font>
<font color=#447700>!domain. However, since the indices are defined globally in<a name='579'></font>
<font color=#447700>!module_state_description (a shortcoming in the current software), it is<a name='580'></font>
<font color=#447700>!necessary that these indices be reset each time a different grid is to<a name='581'></font>
<font color=#447700>!be computed on.<a name='582'></font>
<font color=#447700>!<a name='583'></font>
<font color=#447700>!The scalar idices are set according to the particular physics<a name='584'></font>
<font color=#447700>!packages -- more specifically in the case of the moisture tracers, microphysics<a name='585'></font>
<font color=#447700>!packages -- that are stored for each domain in model_config_rec and<a name='586'></font>
<font color=#447700>!indexed by the grid id, passed in as an argument to this routine.  (The<a name='587'></font>
<font color=#447700>!initial_config() routine in module_configure is what reads the<a name='588'></font>
<font color=#447700>!namelist.input file and sets model_config_rec.)<a name='589'></font>
<font color=#447700>!<a name='590'></font>
<font color=#447700>!The actual code for calculating the scalar indices on a particular<a name='591'></font>
<font color=#447700>!domain is generated from the Registry state array definitions for the<a name='592'></font>
<font color=#447700>!4d tracers and from the package definitions that indicate which physics<a name='593'></font>
<font color=#447700>!packages use which tracers.<a name='594'></font>
<font color=#447700>!<a name='595'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='596'></font>
<a name='597'>
#include "<A href='../../html_code/include/scalar_indices.inc.html'>scalar_indices.inc</A>"<A NAME="scalar_indices.inc_40"><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='598'>
#include "<A href='../../html_code/include/scalar_indices_init.inc.html'>scalar_indices_init.inc</A>"<A NAME="scalar_indices_init.inc_41"><A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='599'>
  RETURN<a name='600'>
END SUBROUTINE set_scalar_indices_from_config<a name='601'>
<a name='602'>
</pre></body></html>