<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<font color=#447700>!WRF:DRIVER_LAYER:DOMAIN_OBJECT<a name='2'></font>
<font color=#447700>!<a name='3'></font>
<font color=#447700>!  Following are the routines contained within this MODULE:<a name='4'></font>
<a name='5'>
<font color=#447700>!  alloc_and_configure_domain        1. Allocate the space for a single domain (constants<a name='6'></font>
<font color=#447700>!                                       and null terminate pointers).<a name='7'></font>
<font color=#447700>!                                    2. Connect the domains as a linked list.<a name='8'></font>
<font color=#447700>!                                    3. Store all of the domain constants.<a name='9'></font>
<font color=#447700>!                                    4. CALL alloc_space_field.<a name='10'></font>
<a name='11'>
<font color=#447700>!  alloc_space_field                 1. Allocate space for the gridded data required for<a name='12'></font>
<font color=#447700>!                                       each domain.<a name='13'></font>
<a name='14'>
<font color=#447700>!  dealloc_space_domain              1. Reconnect linked list nodes since the current<a name='15'></font>
<font color=#447700>!                                       node is removed.<a name='16'></font>
<font color=#447700>!                                    2. CALL dealloc_space_field.<a name='17'></font>
<font color=#447700>!                                    3. Deallocate single domain.<a name='18'></font>
<a name='19'>
<font color=#447700>!  dealloc_space_field               1. Deallocate each of the fields for a particular<a name='20'></font>
<font color=#447700>!                                       domain.<a name='21'></font>
<a name='22'>
<font color=#447700>!  first_loc_integer                 1. Find the first incidence of a particular<a name='23'></font>
<font color=#447700>!                                       domain identifier from an array of domain<a name='24'></font>
<font color=#447700>!                                       identifiers.<a name='25'></font>
<a name='26'>
<A NAME='MODULE_DOMAIN'><A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='27'>
<font color=#993300>MODULE </font><font color=#cc0000>module_domain</font> <A href='../../call_to/MODULE_DOMAIN.html' TARGET='index'>468</A><a name='28'>
<a name='29'>
   USE <A href='../../html_code/frame/module_driver_constants.F.html#MODULE_DRIVER_CONSTANTS'>module_driver_constants</A><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DRIVER_CONSTANTS_27"><a name='30'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_8"><a name='31'>
   USE <A href='../../html_code/frame/module_configure.F.html#MODULE_CONFIGURE'>module_configure</A><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_CONFIGURE_85"><a name='32'>
   USE <A href='../../html_code/frame/module_wrf_error.F.html#MODULE_WRF_ERROR'>module_wrf_error</A><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_WRF_ERROR_21"><a name='33'>
   USE module_utility<a name='34'>
   USE <A href='../../html_code/frame/module_domain_type.F.html#MODULE_DOMAIN_TYPE'>module_domain_type</A><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_TYPE_7"><a name='35'>
<a name='36'>
   <font color=#447700>! In WRFV3, the module_domain_type is defined<a name='37'></font>
   <font color=#447700>! in a separaate source file, frame/module_domain_type.F<a name='38'></font>
   <font color=#447700>! This enables splitting off the alloc_space_field routine<a name='39'></font>
   <font color=#447700>! into a separate file, reducing the size of module_domain<a name='40'></font>
<a name='41'>
   <font color=#447700>!  Now that a "domain" TYPE exists, we can use it to store a few pointers<a name='42'></font>
   <font color=#447700>!  to this type.  These are primarily for use in traversing the linked list.<a name='43'></font>
   <font color=#447700>!  The "head_grid" is always the pointer to the first domain that is<a name='44'></font>
   <font color=#447700>!  allocated.  This is available and is not to be changed.  The others are<a name='45'></font>
   <font color=#447700>!  just temporary pointers.<a name='46'></font>
<a name='47'>
   TYPE(domain) , POINTER :: head_grid , new_grid , next_grid , old_grid<a name='48'>
<a name='49'>
   <font color=#447700>!  To facilitate an easy integration of each of the domains that are on the<a name='50'></font>
   <font color=#447700>!  same level, we have an array for the head pointer for each level.  This<a name='51'></font>
   <font color=#447700>!  removed the need to search through the linked list at each time step to<a name='52'></font>
   <font color=#447700>!  find which domains are to be active.<a name='53'></font>
<a name='54'>
   TYPE domain_levels<a name='55'>
      TYPE(domain) , POINTER                              :: first_domain<a name='56'>
   END TYPE domain_levels<a name='57'>
<a name='58'>
   TYPE(domain_levels) , DIMENSION(max_levels)            :: head_for_each_level<a name='59'>
<a name='60'>
   <font color=#447700>! Use this to support debugging features, giving easy access to clock, etc.  <a name='61'></font>
   TYPE(domain), POINTER :: current_grid<a name='62'>
   LOGICAL, SAVE :: current_grid_set = .FALSE.<a name='63'>
<a name='64'>
   <font color=#447700>! internal routines<a name='65'></font>
   PRIVATE domain_time_test_print<a name='66'>
   PRIVATE test_adjust_io_timestr<a name='67'>
<a name='68'>
<A NAME='GET_IJK_FROM_GRID'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='69'>
   <font color=#993300>INTERFACE </font><font color=#cc0000>get_ijk_from_grid</font> <A href='../../call_to/GET_IJK_FROM_GRID.html' TARGET='index'>126</A><a name='70'>
     MODULE PROCEDURE <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID1'>get_ijk_from_grid1</A><A NAME="GET_IJK_FROM_GRID1_1"><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a>, <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID2'>get_ijk_from_grid2</A><A NAME="GET_IJK_FROM_GRID2_1"><A href='../../html_code/frame/module_domain.F.html#module_domain.F' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='71'>
   END INTERFACE<a name='72'>
<a name='73'>
   INTEGER, PARAMETER :: max_hst_mods = 200<a name='74'>
<a name='75'>
CONTAINS<a name='76'>
<a name='77'>
<A NAME='ADJUST_DOMAIN_DIMS_FOR_MOVE'><A href='../../html_code/frame/module_domain.F.html#ADJUST_DOMAIN_DIMS_FOR_MOVE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='78'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>adjust_domain_dims_for_move</font>( grid , dx, dy ) <A href='../../call_to/ADJUST_DOMAIN_DIMS_FOR_MOVE.html' TARGET='index'>3</A>,<A href='../../call_from/ADJUST_DOMAIN_DIMS_FOR_MOVE.html' TARGET='index'>2</A><a name='79'>
    IMPLICIT NONE<a name='80'>
<a name='81'>
    TYPE( domain ), POINTER   :: grid<a name='82'>
    INTEGER, INTENT(IN) ::  dx, dy<a name='83'>
<a name='84'>
    data_ordering : SELECT CASE ( model_data_order )<a name='85'>
       CASE  ( DATA_ORDER_XYZ )<a name='86'>
            grid%sm31  = grid%sm31 + dx<a name='87'>
            grid%em31  = grid%em31 + dx<a name='88'>
            grid%sm32  = grid%sm32 + dy<a name='89'>
            grid%em32  = grid%em32 + dy<a name='90'>
            grid%sp31  = grid%sp31 + dx<a name='91'>
            grid%ep31  = grid%ep31 + dx<a name='92'>
            grid%sp32  = grid%sp32 + dy<a name='93'>
            grid%ep32  = grid%ep32 + dy<a name='94'>
            grid%sd31  = grid%sd31 + dx<a name='95'>
            grid%ed31  = grid%ed31 + dx<a name='96'>
            grid%sd32  = grid%sd32 + dy<a name='97'>
            grid%ed32  = grid%ed32 + dy<a name='98'>
<a name='99'>
       CASE  ( DATA_ORDER_YXZ )<a name='100'>
            grid%sm31  = grid%sm31 + dy<a name='101'>
            grid%em31  = grid%em31 + dy<a name='102'>
            grid%sm32  = grid%sm32 + dx<a name='103'>
            grid%em32  = grid%em32 + dx<a name='104'>
            grid%sp31  = grid%sp31 + dy<a name='105'>
            grid%ep31  = grid%ep31 + dy<a name='106'>
            grid%sp32  = grid%sp32 + dx<a name='107'>
            grid%ep32  = grid%ep32 + dx<a name='108'>
            grid%sd31  = grid%sd31 + dy<a name='109'>
            grid%ed31  = grid%ed31 + dy<a name='110'>
            grid%sd32  = grid%sd32 + dx<a name='111'>
            grid%ed32  = grid%ed32 + dx<a name='112'>
<a name='113'>
       CASE  ( DATA_ORDER_ZXY )<a name='114'>
            grid%sm32  = grid%sm32 + dx<a name='115'>
            grid%em32  = grid%em32 + dx<a name='116'>
            grid%sm33  = grid%sm33 + dy<a name='117'>
            grid%em33  = grid%em33 + dy<a name='118'>
            grid%sp32  = grid%sp32 + dx<a name='119'>
            grid%ep32  = grid%ep32 + dx<a name='120'>
            grid%sp33  = grid%sp33 + dy<a name='121'>
            grid%ep33  = grid%ep33 + dy<a name='122'>
            grid%sd32  = grid%sd32 + dx<a name='123'>
            grid%ed32  = grid%ed32 + dx<a name='124'>
            grid%sd33  = grid%sd33 + dy<a name='125'>
            grid%ed33  = grid%ed33 + dy<a name='126'>
<a name='127'>
       CASE  ( DATA_ORDER_ZYX )<a name='128'>
            grid%sm32  = grid%sm32 + dy<a name='129'>
            grid%em32  = grid%em32 + dy<a name='130'>
            grid%sm33  = grid%sm33 + dx<a name='131'>
            grid%em33  = grid%em33 + dx<a name='132'>
            grid%sp32  = grid%sp32 + dy<a name='133'>
            grid%ep32  = grid%ep32 + dy<a name='134'>
            grid%sp33  = grid%sp33 + dx<a name='135'>
            grid%ep33  = grid%ep33 + dx<a name='136'>
            grid%sd32  = grid%sd32 + dy<a name='137'>
            grid%ed32  = grid%ed32 + dy<a name='138'>
            grid%sd33  = grid%sd33 + dx<a name='139'>
            grid%ed33  = grid%ed33 + dx<a name='140'>
<a name='141'>
       CASE  ( DATA_ORDER_XZY )<a name='142'>
            grid%sm31  = grid%sm31 + dx<a name='143'>
            grid%em31  = grid%em31 + dx<a name='144'>
            grid%sm33  = grid%sm33 + dy<a name='145'>
            grid%em33  = grid%em33 + dy<a name='146'>
            grid%sp31  = grid%sp31 + dx<a name='147'>
            grid%ep31  = grid%ep31 + dx<a name='148'>
            grid%sp33  = grid%sp33 + dy<a name='149'>
            grid%ep33  = grid%ep33 + dy<a name='150'>
            grid%sd31  = grid%sd31 + dx<a name='151'>
            grid%ed31  = grid%ed31 + dx<a name='152'>
            grid%sd33  = grid%sd33 + dy<a name='153'>
            grid%ed33  = grid%ed33 + dy<a name='154'>
<a name='155'>
       CASE  ( DATA_ORDER_YZX )<a name='156'>
            grid%sm31  = grid%sm31 + dy<a name='157'>
            grid%em31  = grid%em31 + dy<a name='158'>
            grid%sm33  = grid%sm33 + dx<a name='159'>
            grid%em33  = grid%em33 + dx<a name='160'>
            grid%sp31  = grid%sp31 + dy<a name='161'>
            grid%ep31  = grid%ep31 + dy<a name='162'>
            grid%sp33  = grid%sp33 + dx<a name='163'>
            grid%ep33  = grid%ep33 + dx<a name='164'>
            grid%sd31  = grid%sd31 + dy<a name='165'>
            grid%ed31  = grid%ed31 + dy<a name='166'>
            grid%sd33  = grid%sd33 + dx<a name='167'>
            grid%ed33  = grid%ed33 + dx<a name='168'>
<a name='169'>
    END SELECT data_ordering<a name='170'>
<a name='171'>
#if 0<a name='172'>
    CALL <A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD'>dealloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#ADJUST_DOMAIN_DIMS_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOC_SPACE_FIELD_1"> ( grid )<a name='173'>
<a name='174'>
    CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD'>alloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#ADJUST_DOMAIN_DIMS_FOR_MOVE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_SPACE_FIELD_2"> ( grid, grid%id , 1 , 2 , .FALSE. ,     &amp;<a name='175'>
                             grid%sd31, grid%ed31, grid%sd32, grid%ed32, grid%sd33, grid%ed33, &amp;<a name='176'>
                             grid%sm31,  grid%em31,  grid%sm32,  grid%em32,  grid%sm33,  grid%em33, &amp;<a name='177'>
                             grid%sp31,  grid%ep31,  grid%sp32,  grid%ep32,  grid%sp33,  grid%ep33, &amp;<a name='178'>
                             grid%sp31x, grid%ep31x, grid%sp32x, grid%ep32x, grid%sp33x, grid%ep33x, &amp;<a name='179'>
                             grid%sp31y, grid%ep31y, grid%sp32y, grid%ep32y, grid%sp33y, grid%ep33y, &amp;<a name='180'>
                             grid%sm31x, grid%em31x, grid%sm32x, grid%em32x, grid%sm33x, grid%em33x, &amp;   <font color=#447700>! x-xpose<a name='181'></font>
                             grid%sm31y, grid%em31y, grid%sm32y, grid%em32y, grid%sm33y, grid%em33y  &amp;   <font color=#447700>! y-xpose<a name='182'></font>
      )<a name='183'>
#endif<a name='184'>
<a name='185'>
    RETURN<a name='186'>
   END SUBROUTINE adjust_domain_dims_for_move<a name='187'>
<a name='188'>
#if 1<a name='189'>
<A NAME='GET_IJK_FROM_GRID1'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='190'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_grid1</font> (  grid ,                   &amp; <A href='../../call_to/GET_IJK_FROM_GRID1.html' TARGET='index'>1</A>,<A href='../../call_from/GET_IJK_FROM_GRID1.html' TARGET='index'>1</A><a name='191'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='192'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='193'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='194'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='195'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='196'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='197'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey )<a name='198'>
    IMPLICIT NONE<a name='199'>
    TYPE( domain ), INTENT (IN)  :: grid<a name='200'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='201'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='202'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='203'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='204'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='205'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='206'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='207'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey<a name='208'>
<a name='209'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID2'>get_ijk_from_grid2</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID2_2"> (  grid ,                   &amp;<a name='210'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='211'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='212'>
                           ips, ipe, jps, jpe, kps, kpe )<a name='213'>
     data_ordering : SELECT CASE ( model_data_order )<a name='214'>
       CASE  ( DATA_ORDER_XYZ )<a name='215'>
           imsx = grid%sm31x ; imex = grid%em31x ; jmsx = grid%sm32x ; jmex = grid%em32x ; kmsx = grid%sm33x ; kmex = grid%em33x ;<a name='216'>
           ipsx = grid%sp31x ; ipex = grid%ep31x ; jpsx = grid%sp32x ; jpex = grid%ep32x ; kpsx = grid%sp33x ; kpex = grid%ep33x ;<a name='217'>
           imsy = grid%sm31y ; imey = grid%em31y ; jmsy = grid%sm32y ; jmey = grid%em32y ; kmsy = grid%sm33y ; kmey = grid%em33y ;<a name='218'>
           ipsy = grid%sp31y ; ipey = grid%ep31y ; jpsy = grid%sp32y ; jpey = grid%ep32y ; kpsy = grid%sp33y ; kpey = grid%ep33y ;<a name='219'>
       CASE  ( DATA_ORDER_YXZ )<a name='220'>
           imsx = grid%sm32x ; imex = grid%em32x ; jmsx = grid%sm31x ; jmex = grid%em31x ; kmsx = grid%sm33x ; kmex = grid%em33x ;<a name='221'>
           ipsx = grid%sp32x ; ipex = grid%ep32x ; jpsx = grid%sp31x ; jpex = grid%ep31x ; kpsx = grid%sp33x ; kpex = grid%ep33x ;<a name='222'>
           imsy = grid%sm32y ; imey = grid%em32y ; jmsy = grid%sm31y ; jmey = grid%em31y ; kmsy = grid%sm33y ; kmey = grid%em33y ;<a name='223'>
           ipsy = grid%sp32y ; ipey = grid%ep32y ; jpsy = grid%sp31y ; jpey = grid%ep31y ; kpsy = grid%sp33y ; kpey = grid%ep33y ;<a name='224'>
       CASE  ( DATA_ORDER_ZXY )<a name='225'>
           imsx = grid%sm32x ; imex = grid%em32x ; jmsx = grid%sm33x ; jmex = grid%em33x ; kmsx = grid%sm31x ; kmex = grid%em31x ;<a name='226'>
           ipsx = grid%sp32x ; ipex = grid%ep32x ; jpsx = grid%sp33x ; jpex = grid%ep33x ; kpsx = grid%sp31x ; kpex = grid%ep31x ;<a name='227'>
           imsy = grid%sm32y ; imey = grid%em32y ; jmsy = grid%sm33y ; jmey = grid%em33y ; kmsy = grid%sm31y ; kmey = grid%em31y ;<a name='228'>
           ipsy = grid%sp32y ; ipey = grid%ep32y ; jpsy = grid%sp33y ; jpey = grid%ep33y ; kpsy = grid%sp31y ; kpey = grid%ep31y ;<a name='229'>
       CASE  ( DATA_ORDER_ZYX )<a name='230'>
           imsx = grid%sm33x ; imex = grid%em33x ; jmsx = grid%sm32x ; jmex = grid%em32x ; kmsx = grid%sm31x ; kmex = grid%em31x ;<a name='231'>
           ipsx = grid%sp33x ; ipex = grid%ep33x ; jpsx = grid%sp32x ; jpex = grid%ep32x ; kpsx = grid%sp31x ; kpex = grid%ep31x ;<a name='232'>
           imsy = grid%sm33y ; imey = grid%em33y ; jmsy = grid%sm32y ; jmey = grid%em32y ; kmsy = grid%sm31y ; kmey = grid%em31y ;<a name='233'>
           ipsy = grid%sp33y ; ipey = grid%ep33y ; jpsy = grid%sp32y ; jpey = grid%ep32y ; kpsy = grid%sp31y ; kpey = grid%ep31y ;<a name='234'>
       CASE  ( DATA_ORDER_XZY )<a name='235'>
           imsx = grid%sm31x ; imex = grid%em31x ; jmsx = grid%sm33x ; jmex = grid%em33x ; kmsx = grid%sm32x ; kmex = grid%em32x ;<a name='236'>
           ipsx = grid%sp31x ; ipex = grid%ep31x ; jpsx = grid%sp33x ; jpex = grid%ep33x ; kpsx = grid%sp32x ; kpex = grid%ep32x ;<a name='237'>
           imsy = grid%sm31y ; imey = grid%em31y ; jmsy = grid%sm33y ; jmey = grid%em33y ; kmsy = grid%sm32y ; kmey = grid%em32y ;<a name='238'>
           ipsy = grid%sp31y ; ipey = grid%ep31y ; jpsy = grid%sp33y ; jpey = grid%ep33y ; kpsy = grid%sp32y ; kpey = grid%ep32y ;<a name='239'>
       CASE  ( DATA_ORDER_YZX )<a name='240'>
           imsx = grid%sm33x ; imex = grid%em33x ; jmsx = grid%sm31x ; jmex = grid%em31x ; kmsx = grid%sm32x ; kmex = grid%em32x ;<a name='241'>
           ipsx = grid%sp33x ; ipex = grid%ep33x ; jpsx = grid%sp31x ; jpex = grid%ep31x ; kpsx = grid%sp32x ; kpex = grid%ep32x ;<a name='242'>
           imsy = grid%sm33y ; imey = grid%em33y ; jmsy = grid%sm31y ; jmey = grid%em31y ; kmsy = grid%sm32y ; kmey = grid%em32y ;<a name='243'>
           ipsy = grid%sp33y ; ipey = grid%ep33y ; jpsy = grid%sp31y ; jpey = grid%ep31y ; kpsy = grid%sp32y ; kpey = grid%ep32y ;<a name='244'>
     END SELECT data_ordering<a name='245'>
   END SUBROUTINE get_ijk_from_grid1<a name='246'>
<a name='247'>
<A NAME='GET_IJK_FROM_GRID2'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID2' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='248'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_grid2</font> (  grid ,                   &amp; <A href='../../call_to/GET_IJK_FROM_GRID2.html' TARGET='index'>3</A><a name='249'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='250'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='251'>
                           ips, ipe, jps, jpe, kps, kpe )<a name='252'>
<a name='253'>
    IMPLICIT NONE<a name='254'>
<a name='255'>
    TYPE( domain ), INTENT (IN)  :: grid<a name='256'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='257'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='258'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='259'>
                           ips, ipe, jps, jpe, kps, kpe<a name='260'>
<a name='261'>
    data_ordering : SELECT CASE ( model_data_order )<a name='262'>
       CASE  ( DATA_ORDER_XYZ )<a name='263'>
           ids = grid%sd31 ; ide = grid%ed31 ; jds = grid%sd32 ; jde = grid%ed32 ; kds = grid%sd33 ; kde = grid%ed33 ;<a name='264'>
           ims = grid%sm31 ; ime = grid%em31 ; jms = grid%sm32 ; jme = grid%em32 ; kms = grid%sm33 ; kme = grid%em33 ;<a name='265'>
           ips = grid%sp31 ; ipe = grid%ep31 ; jps = grid%sp32 ; jpe = grid%ep32 ; kps = grid%sp33 ; kpe = grid%ep33 ; <a name='266'>
       CASE  ( DATA_ORDER_YXZ )<a name='267'>
           ids = grid%sd32  ; ide = grid%ed32  ; jds = grid%sd31  ; jde = grid%ed31  ; kds = grid%sd33  ; kde = grid%ed33  ; <a name='268'>
           ims = grid%sm32  ; ime = grid%em32  ; jms = grid%sm31  ; jme = grid%em31  ; kms = grid%sm33  ; kme = grid%em33  ; <a name='269'>
           ips = grid%sp32  ; ipe = grid%ep32  ; jps = grid%sp31  ; jpe = grid%ep31  ; kps = grid%sp33  ; kpe = grid%ep33  ; <a name='270'>
       CASE  ( DATA_ORDER_ZXY )<a name='271'>
           ids = grid%sd32  ; ide = grid%ed32  ; jds = grid%sd33  ; jde = grid%ed33  ; kds = grid%sd31  ; kde = grid%ed31  ; <a name='272'>
           ims = grid%sm32  ; ime = grid%em32  ; jms = grid%sm33  ; jme = grid%em33  ; kms = grid%sm31  ; kme = grid%em31  ; <a name='273'>
           ips = grid%sp32  ; ipe = grid%ep32  ; jps = grid%sp33  ; jpe = grid%ep33  ; kps = grid%sp31  ; kpe = grid%ep31  ; <a name='274'>
       CASE  ( DATA_ORDER_ZYX )<a name='275'>
           ids = grid%sd33  ; ide = grid%ed33  ; jds = grid%sd32  ; jde = grid%ed32  ; kds = grid%sd31  ; kde = grid%ed31  ; <a name='276'>
           ims = grid%sm33  ; ime = grid%em33  ; jms = grid%sm32  ; jme = grid%em32  ; kms = grid%sm31  ; kme = grid%em31  ; <a name='277'>
           ips = grid%sp33  ; ipe = grid%ep33  ; jps = grid%sp32  ; jpe = grid%ep32  ; kps = grid%sp31  ; kpe = grid%ep31  ; <a name='278'>
       CASE  ( DATA_ORDER_XZY )<a name='279'>
           ids = grid%sd31  ; ide = grid%ed31  ; jds = grid%sd33  ; jde = grid%ed33  ; kds = grid%sd32  ; kde = grid%ed32  ; <a name='280'>
           ims = grid%sm31  ; ime = grid%em31  ; jms = grid%sm33  ; jme = grid%em33  ; kms = grid%sm32  ; kme = grid%em32  ; <a name='281'>
           ips = grid%sp31  ; ipe = grid%ep31  ; jps = grid%sp33  ; jpe = grid%ep33  ; kps = grid%sp32  ; kpe = grid%ep32  ; <a name='282'>
       CASE  ( DATA_ORDER_YZX )<a name='283'>
           ids = grid%sd33  ; ide = grid%ed33  ; jds = grid%sd31  ; jde = grid%ed31  ; kds = grid%sd32  ; kde = grid%ed32  ; <a name='284'>
           ims = grid%sm33  ; ime = grid%em33  ; jms = grid%sm31  ; jme = grid%em31  ; kms = grid%sm32  ; kme = grid%em32  ; <a name='285'>
           ips = grid%sp33  ; ipe = grid%ep33  ; jps = grid%sp31  ; jpe = grid%ep31  ; kps = grid%sp32  ; kpe = grid%ep32  ; <a name='286'>
    END SELECT data_ordering<a name='287'>
   END SUBROUTINE get_ijk_from_grid2<a name='288'>
<a name='289'>
<font color=#447700>! return the values for subgrid whose refinement is in grid%sr<a name='290'></font>
<font color=#447700>! note when using this routine, it does not affect K. For K <a name='291'></font>
<font color=#447700>! (vertical), it just returns what get_ijk_from_grid does<a name='292'></font>
<A NAME='GET_IJK_FROM_SUBGRID'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='293'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_subgrid</font> (  grid ,                &amp; <A href='../../call_to/GET_IJK_FROM_SUBGRID.html' TARGET='index'>4</A>,<A href='../../call_from/GET_IJK_FROM_SUBGRID.html' TARGET='index'>1</A><a name='294'>
                           ids0, ide0, jds0, jde0, kds0, kde0,    &amp;<a name='295'>
                           ims0, ime0, jms0, jme0, kms0, kme0,    &amp;<a name='296'>
                           ips0, ipe0, jps0, jpe0, kps0, kpe0    )<a name='297'>
    TYPE( domain ), INTENT (IN)  :: grid<a name='298'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='299'>
                           ids0, ide0, jds0, jde0, kds0, kde0,    &amp;<a name='300'>
                           ims0, ime0, jms0, jme0, kms0, kme0,    &amp;<a name='301'>
                           ips0, ipe0, jps0, jpe0, kps0, kpe0<a name='302'>
   <font color=#447700>! Local<a name='303'></font>
    INTEGER              ::                                 &amp;<a name='304'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='305'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='306'>
                           ips, ipe, jps, jpe, kps, kpe<a name='307'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_88"> (  grid ,                         &amp;<a name='308'>
                             ids, ide, jds, jde, kds, kde,    &amp;<a name='309'>
                             ims, ime, jms, jme, kms, kme,    &amp;<a name='310'>
                             ips, ipe, jps, jpe, kps, kpe    )<a name='311'>
     ids0 = ids<a name='312'>
     ide0 = ide * grid%sr_x<a name='313'>
     ims0 = (ims-1)*grid%sr_x+1<a name='314'>
     ime0 = ime * grid%sr_x<a name='315'>
     ips0 = (ips-1)*grid%sr_x+1<a name='316'>
     ipe0 = ipe * grid%sr_x<a name='317'>
<a name='318'>
     jds0 = jds<a name='319'>
     jde0 = jde * grid%sr_y<a name='320'>
     jms0 = (jms-1)*grid%sr_y+1<a name='321'>
     jme0 = jme * grid%sr_y<a name='322'>
     jps0 = (jps-1)*grid%sr_y+1<a name='323'>
     jpe0 = jpe * grid%sr_y<a name='324'>
<a name='325'>
     kds0 = kds<a name='326'>
     kde0 = kde<a name='327'>
     kms0 = kms<a name='328'>
     kme0 = kme<a name='329'>
     kps0 = kps<a name='330'>
     kpe0 = kpe<a name='331'>
   RETURN<a name='332'>
   END SUBROUTINE get_ijk_from_subgrid<a name='333'>
#endif<a name='334'>
<a name='335'>
<a name='336'>
<font color=#447700>! Default version ; Otherwise module containing interface to DM library will provide<a name='337'></font>
<a name='338'>
<A NAME='WRF_PATCH_DOMAIN'><A href='../../html_code/frame/module_domain.F.html#WRF_PATCH_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='339'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>wrf_patch_domain</font>( id , domdesc , parent, parent_id , parent_domdesc , &amp; <A href='../../call_to/WRF_PATCH_DOMAIN.html' TARGET='index'>1</A>,<A href='../../call_from/WRF_PATCH_DOMAIN.html' TARGET='index'>2</A><a name='340'>
                            sd1 , ed1 , sp1 , ep1 , sm1 , em1 , &amp;<a name='341'>
                            sd2 , ed2 , sp2 , ep2 , sm2 , em2 , &amp;<a name='342'>
                            sd3 , ed3 , sp3 , ep3 , sm3 , em3 , &amp;<a name='343'>
                                        sp1x , ep1x , sm1x , em1x , &amp;<a name='344'>
                                        sp2x , ep2x , sm2x , em2x , &amp;<a name='345'>
                                        sp3x , ep3x , sm3x , em3x , &amp;<a name='346'>
                                        sp1y , ep1y , sm1y , em1y , &amp;<a name='347'>
                                        sp2y , ep2y , sm2y , em2y , &amp;<a name='348'>
                                        sp3y , ep3y , sm3y , em3y , &amp;<a name='349'>
                            bdx , bdy , bdy_mask )<a name='350'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='351'></font>
<font color=#447700>! Wrf_patch_domain is called as part of the process of initiating a new<a name='352'></font>
<font color=#447700>! domain.  Based on the global domain dimension information that is<a name='353'></font>
<font color=#447700>! passed in it computes the patch and memory dimensions on this<a name='354'></font>
<font color=#447700>! distributed-memory process for parallel compilation when DM_PARALLEL is<a name='355'></font>
<font color=#447700>! defined in configure.wrf.  In this case, it relies on an external<a name='356'></font>
<font color=#447700>! communications package-contributed routine, wrf_dm_patch_domain. For<a name='357'></font>
<font color=#447700>! non-parallel compiles, it returns the patch and memory dimensions based<a name='358'></font>
<font color=#447700>! on the entire domain. In either case, the memory dimensions will be<a name='359'></font>
<font color=#447700>! larger than the patch dimensions, since they allow for distributed<a name='360'></font>
<font color=#447700>! memory halo regions (DM_PARALLEL only) and for boundary regions around<a name='361'></font>
<font color=#447700>! the domain (used for idealized cases only).  The width of the boundary<a name='362'></font>
<font color=#447700>! regions to be accommodated is passed in as bdx and bdy.<a name='363'></font>
<font color=#447700>! <a name='364'></font>
<font color=#447700>! The bdy_mask argument is a four-dimensional logical array, each element<a name='365'></font>
<font color=#447700>! of which is set to true for any boundaries that this process's patch<a name='366'></font>
<font color=#447700>! contains (all four are true in the non-DM_PARALLEL case) and false<a name='367'></font>
<font color=#447700>! otherwise. The indices into the bdy_mask are defined in<a name='368'></font>
<font color=#447700>! frame/module_state_description.F. P_XSB corresponds boundary that<a name='369'></font>
<font color=#447700>! exists at the beginning of the X-dimension; ie. the western boundary;<a name='370'></font>
<font color=#447700>! P_XEB to the boundary that corresponds to the end of the X-dimension<a name='371'></font>
<font color=#447700>! (east). Likewise for Y (south and north respectively).<a name='372'></font>
<font color=#447700>! <a name='373'></font>
<font color=#447700>! The correspondence of the first, second, and third dimension of each<a name='374'></font>
<font color=#447700>! set (domain, memory, and patch) with the coordinate axes of the model<a name='375'></font>
<font color=#447700>! domain is based on the setting of the variable model_data_order, which<a name='376'></font>
<font color=#447700>! comes into this routine through USE association of<a name='377'></font>
<font color=#447700>! module_driver_constants in the enclosing module of this routine,<a name='378'></font>
<font color=#447700>! module_domain.  Model_data_order is defined by the Registry, based on<a name='379'></font>
<font color=#447700>! the dimspec entries which associate dimension specifiers (e.g. 'k') in<a name='380'></font>
<font color=#447700>! the Registry with a coordinate axis and specify which dimension of the<a name='381'></font>
<font color=#447700>! arrays they represent. For WRF, the sd1 , ed1 , sp1 , ep1 , sm1 , and<a name='382'></font>
<font color=#447700>! em1 correspond to the starts and ends of the global, patch, and memory<a name='383'></font>
<font color=#447700>! dimensions in X; those with 2 specify Z (vertical); and those with 3<a name='384'></font>
<font color=#447700>! specify Y.  Note that the WRF convention is to overdimension to allow<a name='385'></font>
<font color=#447700>! for staggered fields so that sd&lt;em&gt;n&lt;/em&gt;:ed&lt;em&gt;n&lt;/em&gt; are the starts<a name='386'></font>
<font color=#447700>! and ends of the staggered domains in X.  The non-staggered grid runs<a name='387'></font>
<font color=#447700>! sd&lt;em&gt;n&lt;/em&gt;:ed&lt;em&gt;n&lt;/em&gt;-1. The extra row or column on the north or<a name='388'></font>
<font color=#447700>! east boundaries is not used for non-staggered fields.<a name='389'></font>
<font color=#447700>! <a name='390'></font>
<font color=#447700>! The domdesc and parent_domdesc arguments are for external communication<a name='391'></font>
<font color=#447700>! packages (e.g. RSL) that establish and return to WRF integer handles<a name='392'></font>
<font color=#447700>! for referring to operations on domains.  These descriptors are not set<a name='393'></font>
<font color=#447700>! or used otherwise and they are opaque, which means they are never<a name='394'></font>
<font color=#447700>! accessed or modified in WRF; they are only only passed between calls to<a name='395'></font>
<font color=#447700>! the external package.<a name='396'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='397'></font>
<a name='398'>
   USE <A href='../../html_code/frame/module_machine.F.html#MODULE_MACHINE'>module_machine</A><A href='../../html_code/frame/module_domain.F.html#WRF_PATCH_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_MACHINE_9"><a name='399'>
   IMPLICIT NONE<a name='400'>
   LOGICAL, DIMENSION(4), INTENT(OUT)  :: bdy_mask<a name='401'>
   INTEGER, INTENT(IN)   :: sd1 , ed1 , sd2 , ed2 , sd3 , ed3 , bdx , bdy<a name='402'>
   INTEGER, INTENT(OUT)  :: sp1  , ep1  , sp2  , ep2  , sp3  , ep3  , &amp;  <font color=#447700>! z-xpose (std)<a name='403'></font>
                            sm1  , em1  , sm2  , em2  , sm3  , em3<a name='404'>
   INTEGER, INTENT(OUT)  :: sp1x , ep1x , sp2x , ep2x , sp3x , ep3x , &amp;  <font color=#447700>! x-xpose<a name='405'></font>
                            sm1x , em1x , sm2x , em2x , sm3x , em3x<a name='406'>
   INTEGER, INTENT(OUT)  :: sp1y , ep1y , sp2y , ep2y , sp3y , ep3y , &amp;  <font color=#447700>! y-xpose<a name='407'></font>
                            sm1y , em1y , sm2y , em2y , sm3y , em3y<a name='408'>
   INTEGER, INTENT(IN)   :: id , parent_id , parent_domdesc<a name='409'>
   INTEGER, INTENT(INOUT)  :: domdesc<a name='410'>
   TYPE(domain), POINTER :: parent<a name='411'>
<a name='412'>
<font color=#447700>!local data<a name='413'></font>
<a name='414'>
   INTEGER spec_bdy_width<a name='415'>
<a name='416'>
   CALL nl_get_spec_bdy_width( 1, spec_bdy_width )<a name='417'>
<a name='418'>
#ifndef DM_PARALLEL<a name='419'>
<a name='420'>
   bdy_mask = .true.     <font color=#447700>! only one processor so all 4 boundaries are there<a name='421'></font>
<a name='422'>
<font color=#447700>! this is a trivial version -- 1 patch per processor; <a name='423'></font>
<font color=#447700>! use version in module_dm to compute for DM<a name='424'></font>
   sp1 = sd1 ; sp2 = sd2 ; sp3 = sd3<a name='425'>
   ep1 = ed1 ; ep2 = ed2 ; ep3 = ed3<a name='426'>
   SELECT CASE ( model_data_order )<a name='427'>
      CASE ( DATA_ORDER_XYZ )<a name='428'>
         sm1  = sp1 - bdx ; em1 = ep1 + bdx<a name='429'>
         sm2  = sp2 - bdy ; em2 = ep2 + bdy<a name='430'>
         sm3  = sp3       ; em3 = ep3<a name='431'>
      CASE ( DATA_ORDER_YXZ )<a name='432'>
         sm1 = sp1 - bdy ; em1 = ep1 + bdy<a name='433'>
         sm2 = sp2 - bdx ; em2 = ep2 + bdx<a name='434'>
         sm3 = sp3       ; em3 = ep3<a name='435'>
      CASE ( DATA_ORDER_ZXY )<a name='436'>
         sm1 = sp1       ; em1 = ep1<a name='437'>
         sm2 = sp2 - bdx ; em2 = ep2 + bdx<a name='438'>
         sm3 = sp3 - bdy ; em3 = ep3 + bdy<a name='439'>
      CASE ( DATA_ORDER_ZYX )<a name='440'>
         sm1 = sp1       ; em1 = ep1<a name='441'>
         sm2 = sp2 - bdy ; em2 = ep2 + bdy<a name='442'>
         sm3 = sp3 - bdx ; em3 = ep3 + bdx<a name='443'>
      CASE ( DATA_ORDER_XZY )<a name='444'>
         sm1 = sp1 - bdx ; em1 = ep1 + bdx<a name='445'>
         sm2 = sp2       ; em2 = ep2<a name='446'>
         sm3 = sp3 - bdy ; em3 = ep3 + bdy<a name='447'>
      CASE ( DATA_ORDER_YZX )<a name='448'>
         sm1 = sp1 - bdy ; em1 = ep1 + bdy<a name='449'>
         sm2 = sp2       ; em2 = ep2<a name='450'>
         sm3 = sp3 - bdx ; em3 = ep3 + bdx<a name='451'>
   END SELECT<a name='452'>
   sm1x = sm1       ; em1x = em1    <font color=#447700>! just copy<a name='453'></font>
   sm2x = sm2       ; em2x = em2<a name='454'>
   sm3x = sm3       ; em3x = em3<a name='455'>
   sm1y = sm1       ; em1y = em1    <font color=#447700>! just copy<a name='456'></font>
   sm2y = sm2       ; em2y = em2<a name='457'>
   sm3y = sm3       ; em3y = em3<a name='458'>
<font color=#447700>! assigns mostly just to suppress warning messages that INTENT OUT vars not assigned<a name='459'></font>
   sp1x = sp1 ; ep1x = ep1 ; sp2x = sp2 ; ep2x = ep2 ; sp3x = sp3 ; ep3x = ep3<a name='460'>
   sp1y = sp1 ; ep1y = ep1 ; sp2y = sp2 ; ep2y = ep2 ; sp3y = sp3 ; ep3y = ep3<a name='461'>
<a name='462'>
#else<a name='463'>
<font color=#447700>! This is supplied by the package specific version of module_dm, which<a name='464'></font>
<font color=#447700>! is supplied by the external package and copied into the src directory<a name='465'></font>
<font color=#447700>! when the code is compiled. The cp command will be found in the externals<a name='466'></font>
<font color=#447700>! target of the configure.wrf file for this architecture.  Eg: for RSL<a name='467'></font>
<font color=#447700>! routine is defined in external/RSL/module_dm.F .<a name='468'></font>
<font color=#447700>! Note, it would be very nice to be able to pass parent to this routine;<a name='469'></font>
<font color=#447700>! however, there doesn't seem to be a way to do that in F90. That is because<a name='470'></font>
<font color=#447700>! to pass a pointer to a domain structure, this call requires an interface<a name='471'></font>
<font color=#447700>! definition for wrf_dm_patch_domain (otherwise it will try to convert the<a name='472'></font>
<font color=#447700>! pointer to something). In order to provide an interface definition, we<a name='473'></font>
<font color=#447700>! would need to either USE module_dm or use an interface block. In either<a name='474'></font>
<font color=#447700>! case it generates a circular USE reference, since module_dm uses<a name='475'></font>
<font color=#447700>! module_domain.  JM 20020416<a name='476'></font>
<a name='477'>
   CALL <A href='../../html_code/frame/module_dm.F.html#WRF_DM_PATCH_DOMAIN'>wrf_dm_patch_domain</A><A href='../../html_code/frame/module_domain.F.html#WRF_PATCH_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_PATCH_DOMAIN_1">( id , domdesc , parent_id , parent_domdesc , &amp;<a name='478'>
                             sd1 , ed1 , sp1 , ep1 , sm1 , em1 , &amp;<a name='479'>
                             sd2 , ed2 , sp2 , ep2 , sm2 , em2 , &amp;<a name='480'>
                             sd3 , ed3 , sp3 , ep3 , sm3 , em3 , &amp;<a name='481'>
                                         sp1x , ep1x , sm1x , em1x , &amp;<a name='482'>
                                         sp2x , ep2x , sm2x , em2x , &amp;<a name='483'>
                                         sp3x , ep3x , sm3x , em3x , &amp;<a name='484'>
                                         sp1y , ep1y , sm1y , em1y , &amp;<a name='485'>
                                         sp2y , ep2y , sm2y , em2y , &amp;<a name='486'>
                                         sp3y , ep3y , sm3y , em3y , &amp;<a name='487'>
                             bdx , bdy )<a name='488'>
<a name='489'>
   SELECT CASE ( model_data_order )<a name='490'>
      CASE ( DATA_ORDER_XYZ )<a name='491'>
   bdy_mask( P_XSB ) = ( sd1                  &lt;= sp1 .AND. sp1 &lt;= sd1+spec_bdy_width-1 )<a name='492'>
   bdy_mask( P_YSB ) = ( sd2                  &lt;= sp2 .AND. sp2 &lt;= sd2+spec_bdy_width-1 )<a name='493'>
   bdy_mask( P_XEB ) = ( ed1-spec_bdy_width-1 &lt;= ep1 .AND. ep1 &lt;= ed1                  )<a name='494'>
   bdy_mask( P_YEB ) = ( ed2-spec_bdy_width-1 &lt;= ep2 .AND. ep2 &lt;= ed2                  )<a name='495'>
      CASE ( DATA_ORDER_YXZ )<a name='496'>
   bdy_mask( P_XSB ) = ( sd2                  &lt;= sp2 .AND. sp2 &lt;= sd2+spec_bdy_width-1 )<a name='497'>
   bdy_mask( P_YSB ) = ( sd1                  &lt;= sp1 .AND. sp1 &lt;= sd1+spec_bdy_width-1 )<a name='498'>
   bdy_mask( P_XEB ) = ( ed2-spec_bdy_width-1 &lt;= ep2 .AND. ep2 &lt;= ed2                  )<a name='499'>
   bdy_mask( P_YEB ) = ( ed1-spec_bdy_width-1 &lt;= ep1 .AND. ep1 &lt;= ed1                  )<a name='500'>
      CASE ( DATA_ORDER_ZXY )<a name='501'>
   bdy_mask( P_XSB ) = ( sd2                  &lt;= sp2 .AND. sp2 &lt;= sd2+spec_bdy_width-1 )<a name='502'>
   bdy_mask( P_YSB ) = ( sd3                  &lt;= sp3 .AND. sp3 &lt;= sd3+spec_bdy_width-1 )<a name='503'>
   bdy_mask( P_XEB ) = ( ed2-spec_bdy_width-1 &lt;= ep2 .AND. ep2 &lt;= ed2                  )<a name='504'>
   bdy_mask( P_YEB ) = ( ed3-spec_bdy_width-1 &lt;= ep3 .AND. ep3 &lt;= ed3                  )<a name='505'>
      CASE ( DATA_ORDER_ZYX )<a name='506'>
   bdy_mask( P_XSB ) = ( sd3                  &lt;= sp3 .AND. sp3 &lt;= sd3+spec_bdy_width-1 )<a name='507'>
   bdy_mask( P_YSB ) = ( sd2                  &lt;= sp2 .AND. sp2 &lt;= sd2+spec_bdy_width-1 )<a name='508'>
   bdy_mask( P_XEB ) = ( ed3-spec_bdy_width-1 &lt;= ep3 .AND. ep3 &lt;= ed3                  )<a name='509'>
   bdy_mask( P_YEB ) = ( ed2-spec_bdy_width-1 &lt;= ep2 .AND. ep2 &lt;= ed2                  )<a name='510'>
      CASE ( DATA_ORDER_XZY )<a name='511'>
   bdy_mask( P_XSB ) = ( sd1                  &lt;= sp1 .AND. sp1 &lt;= sd1+spec_bdy_width-1 )<a name='512'>
   bdy_mask( P_YSB ) = ( sd3                  &lt;= sp3 .AND. sp3 &lt;= sd3+spec_bdy_width-1 )<a name='513'>
   bdy_mask( P_XEB ) = ( ed1-spec_bdy_width-1 &lt;= ep1 .AND. ep1 &lt;= ed1                  )<a name='514'>
   bdy_mask( P_YEB ) = ( ed3-spec_bdy_width-1 &lt;= ep3 .AND. ep3 &lt;= ed3                  )<a name='515'>
      CASE ( DATA_ORDER_YZX )<a name='516'>
   bdy_mask( P_XSB ) = ( sd3                  &lt;= sp3 .AND. sp3 &lt;= sd3+spec_bdy_width-1 )<a name='517'>
   bdy_mask( P_YSB ) = ( sd1                  &lt;= sp1 .AND. sp1 &lt;= sd1+spec_bdy_width-1 )<a name='518'>
   bdy_mask( P_XEB ) = ( ed3-spec_bdy_width-1 &lt;= ep3 .AND. ep3 &lt;= ed3                  )<a name='519'>
   bdy_mask( P_YEB ) = ( ed1-spec_bdy_width-1 &lt;= ep1 .AND. ep1 &lt;= ed1                  )<a name='520'>
   END SELECT<a name='521'>
<a name='522'>
#endif<a name='523'>
<a name='524'>
   RETURN<a name='525'>
   END SUBROUTINE wrf_patch_domain<a name='526'>
<font color=#447700>!<a name='527'></font>
<A NAME='ALLOC_AND_CONFIGURE_DOMAIN'><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='528'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>alloc_and_configure_domain</font> ( domain_id , active_this_task, grid , parent, kid ) <A href='../../call_to/ALLOC_AND_CONFIGURE_DOMAIN.html' TARGET='index'>14</A>,<A href='../../call_from/ALLOC_AND_CONFIGURE_DOMAIN.html' TARGET='index'>9</A><a name='529'>
<a name='530'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='531'></font>
<font color=#447700>! This subroutine is used to allocate a domain data structure of<a name='532'></font>
<font color=#447700>! TYPE(DOMAIN) pointed to by the argument &lt;em&gt;grid&lt;/em&gt;, link it into the<a name='533'></font>
<font color=#447700>! nested domain hierarchy, and set it's configuration information from<a name='534'></font>
<font color=#447700>! the appropriate settings in the WRF namelist file. Specifically, if the<a name='535'></font>
<font color=#447700>! domain being allocated and configured is nest, the &lt;em&gt;parent&lt;/em&gt;<a name='536'></font>
<font color=#447700>! argument will point to the already existing domain data structure for<a name='537'></font>
<font color=#447700>! the parent domain and the &lt;em&gt;kid&lt;/em&gt; argument will be set to an<a name='538'></font>
<font color=#447700>! integer indicating which child of the parent this grid will be (child<a name='539'></font>
<font color=#447700>! indices start at 1).  If this is the top-level domain, the parent and<a name='540'></font>
<font color=#447700>! kid arguments are ignored.  &lt;b&gt;WRF domains may have multiple children<a name='541'></font>
<font color=#447700>! but only ever have one parent.&lt;/b&gt;<a name='542'></font>
<font color=#447700>!<a name='543'></font>
<font color=#447700>! The &lt;em&gt;domain_id&lt;/em&gt; argument is the<a name='544'></font>
<font color=#447700>! integer handle by which this new domain will be referred; it comes from<a name='545'></font>
<font color=#447700>! the grid_id setting in the namelist, and these grid ids correspond to<a name='546'></font>
<font color=#447700>! the ordering of settings in the namelist, starting with 1 for the<a name='547'></font>
<font color=#447700>! top-level domain. The id of 1 always corresponds to the top-level<a name='548'></font>
<font color=#447700>! domain.  and these grid ids correspond to the ordering of settings in<a name='549'></font>
<font color=#447700>! the namelist, starting with 1 for the top-level domain.<a name='550'></font>
<font color=#447700>! <a name='551'></font>
<font color=#447700>! Model_data_order is provide by USE association of<a name='552'></font>
<font color=#447700>! module_driver_constants and is set from dimspec entries in the<a name='553'></font>
<font color=#447700>! Registry.<a name='554'></font>
<font color=#447700>! <a name='555'></font>
<font color=#447700>! The allocation of the TYPE(DOMAIN) itself occurs in this routine.<a name='556'></font>
<font color=#447700>! However, the numerous multi-dimensional arrays that make up the members<a name='557'></font>
<font color=#447700>! of the domain are allocated in the call to alloc_space_field, after<a name='558'></font>
<font color=#447700>! wrf_patch_domain has been called to determine the dimensions in memory<a name='559'></font>
<font color=#447700>! that should be allocated.  It bears noting here that arrays and code<a name='560'></font>
<font color=#447700>! that indexes these arrays are always global, regardless of how the<a name='561'></font>
<font color=#447700>! model is decomposed over patches. Thus, when arrays are allocated on a<a name='562'></font>
<font color=#447700>! given process, the start and end of an array dimension are the global<a name='563'></font>
<font color=#447700>! indices of the start and end of that process's subdomain.<a name='564'></font>
<font color=#447700>! <a name='565'></font>
<font color=#447700>! Configuration information for the domain (that is, information from the<a name='566'></font>
<font color=#447700>! namelist) is added by the call to &lt;a href=med_add_config_info_to_grid.html&gt;med_add_config_info_to_grid&lt;/a&gt;, defined<a name='567'></font>
<font color=#447700>! in share/mediation_wrfmain.F. <a name='568'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='569'></font>
<a name='570'>
      IMPLICIT NONE<a name='571'>
<a name='572'>
      <font color=#447700>!  Input data.<a name='573'></font>
<a name='574'>
      INTEGER , INTENT(IN)            :: domain_id<a name='575'>
      LOGICAL , OPTIONAL, INTENT(IN)  :: active_this_task <font color=#447700>! false if domain is being handled by other MPI tasks<a name='576'></font>
      TYPE( domain ) , POINTER        :: grid<a name='577'>
      TYPE( domain ) , POINTER        :: parent<a name='578'>
      INTEGER , INTENT(IN)            :: kid    <font color=#447700>! which kid of parent am I?<a name='579'></font>
<a name='580'>
      <font color=#447700>!  Local data.<a name='581'></font>
      INTEGER                     :: sd1 , ed1 , sp1 , ep1 , sm1 , em1<a name='582'>
      INTEGER                     :: sd2 , ed2 , sp2 , ep2 , sm2 , em2<a name='583'>
      INTEGER                     :: sd3 , ed3 , sp3 , ep3 , sm3 , em3<a name='584'>
<a name='585'>
      INTEGER                     :: sd1x , ed1x , sp1x , ep1x , sm1x , em1x<a name='586'>
      INTEGER                     :: sd2x , ed2x , sp2x , ep2x , sm2x , em2x<a name='587'>
      INTEGER                     :: sd3x , ed3x , sp3x , ep3x , sm3x , em3x<a name='588'>
<a name='589'>
      INTEGER                     :: sd1y , ed1y , sp1y , ep1y , sm1y , em1y<a name='590'>
      INTEGER                     :: sd2y , ed2y , sp2y , ep2y , sm2y , em2y<a name='591'>
      INTEGER                     :: sd3y , ed3y , sp3y , ep3y , sm3y , em3y<a name='592'>
<a name='593'>
      TYPE(domain) , POINTER      :: new_grid<a name='594'>
      INTEGER                     :: i<a name='595'>
      INTEGER                     :: parent_id , parent_domdesc , new_domdesc<a name='596'>
      INTEGER                     :: bdyzone_x , bdyzone_y<a name='597'>
      INTEGER                     :: nx, ny<a name='598'>
      LOGICAL :: active<a name='599'>
<a name='600'>
<font color=#447700>! <a name='601'></font>
      active = .TRUE.<a name='602'>
      IF ( PRESENT( active_this_task ) ) THEN<a name='603'>
         active = active_this_task<a name='604'>
      ENDIF<a name='605'>
<a name='606'>
<font color=#447700>! This next step uses information that is listed in the registry as namelist_derived<a name='607'></font>
<font color=#447700>! to properly size the domain and the patches; this in turn is stored in the new_grid<a name='608'></font>
<font color=#447700>! data structure<a name='609'></font>
<a name='610'>
<a name='611'>
      data_ordering : SELECT CASE ( model_data_order )<a name='612'>
        CASE  ( DATA_ORDER_XYZ )<a name='613'>
<a name='614'>
          CALL nl_get_s_we( domain_id , sd1 )<a name='615'>
          CALL nl_get_e_we( domain_id , ed1 )<a name='616'>
          CALL nl_get_s_sn( domain_id , sd2 )<a name='617'>
          CALL nl_get_e_sn( domain_id , ed2 )<a name='618'>
          CALL nl_get_s_vert( domain_id , sd3 )<a name='619'>
          CALL nl_get_e_vert( domain_id , ed3 )<a name='620'>
          nx = ed1-sd1+1<a name='621'>
          ny = ed2-sd2+1<a name='622'>
<a name='623'>
        CASE  ( DATA_ORDER_YXZ )<a name='624'>
<a name='625'>
          CALL nl_get_s_sn( domain_id , sd1 )<a name='626'>
          CALL nl_get_e_sn( domain_id , ed1 )<a name='627'>
          CALL nl_get_s_we( domain_id , sd2 )<a name='628'>
          CALL nl_get_e_we( domain_id , ed2 )<a name='629'>
          CALL nl_get_s_vert( domain_id , sd3 )<a name='630'>
          CALL nl_get_e_vert( domain_id , ed3 )<a name='631'>
          nx = ed2-sd2+1<a name='632'>
          ny = ed1-sd1+1<a name='633'>
<a name='634'>
        CASE  ( DATA_ORDER_ZXY )<a name='635'>
<a name='636'>
          CALL nl_get_s_vert( domain_id , sd1 )<a name='637'>
          CALL nl_get_e_vert( domain_id , ed1 )<a name='638'>
          CALL nl_get_s_we( domain_id , sd2 )<a name='639'>
          CALL nl_get_e_we( domain_id , ed2 )<a name='640'>
          CALL nl_get_s_sn( domain_id , sd3 )<a name='641'>
          CALL nl_get_e_sn( domain_id , ed3 )<a name='642'>
          nx = ed2-sd2+1<a name='643'>
          ny = ed3-sd3+1<a name='644'>
<a name='645'>
        CASE  ( DATA_ORDER_ZYX )<a name='646'>
<a name='647'>
          CALL nl_get_s_vert( domain_id , sd1 )<a name='648'>
          CALL nl_get_e_vert( domain_id , ed1 )<a name='649'>
          CALL nl_get_s_sn( domain_id , sd2 )<a name='650'>
          CALL nl_get_e_sn( domain_id , ed2 )<a name='651'>
          CALL nl_get_s_we( domain_id , sd3 )<a name='652'>
          CALL nl_get_e_we( domain_id , ed3 )<a name='653'>
          nx = ed3-sd3+1<a name='654'>
          ny = ed2-sd2+1<a name='655'>
<a name='656'>
        CASE  ( DATA_ORDER_XZY )<a name='657'>
<a name='658'>
          CALL nl_get_s_we( domain_id , sd1 )<a name='659'>
          CALL nl_get_e_we( domain_id , ed1 )<a name='660'>
          CALL nl_get_s_vert( domain_id , sd2 )<a name='661'>
          CALL nl_get_e_vert( domain_id , ed2 )<a name='662'>
          CALL nl_get_s_sn( domain_id , sd3 )<a name='663'>
          CALL nl_get_e_sn( domain_id , ed3 )<a name='664'>
          nx = ed1-sd1+1<a name='665'>
          ny = ed3-sd3+1<a name='666'>
<a name='667'>
        CASE  ( DATA_ORDER_YZX )<a name='668'>
<a name='669'>
          CALL nl_get_s_sn( domain_id , sd1 )<a name='670'>
          CALL nl_get_e_sn( domain_id , ed1 )<a name='671'>
          CALL nl_get_s_vert( domain_id , sd2 )<a name='672'>
          CALL nl_get_e_vert( domain_id , ed2 )<a name='673'>
          CALL nl_get_s_we( domain_id , sd3 )<a name='674'>
          CALL nl_get_e_we( domain_id , ed3 )<a name='675'>
          nx = ed3-sd3+1<a name='676'>
          ny = ed1-sd1+1<a name='677'>
<a name='678'>
      END SELECT data_ordering<a name='679'>
<a name='680'>
      IF ( num_time_levels &gt; 3 ) THEN<a name='681'>
        WRITE ( wrf_err_message , * ) 'alloc_and_configure_domain: ', &amp;<a name='682'>
          'Incorrect value for num_time_levels ', num_time_levels<a name='683'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_217"> ( TRIM ( wrf_err_message ) )<a name='684'>
      ENDIF<a name='685'>
<a name='686'>
      IF (ASSOCIATED(parent)) THEN<a name='687'>
        parent_id = parent%id<a name='688'>
        parent_domdesc = parent%domdesc<a name='689'>
      ELSE<a name='690'>
        parent_id = -1<a name='691'>
        parent_domdesc = -1<a name='692'>
      ENDIF<a name='693'>
<a name='694'>
<font color=#447700>! provided by application, WRF defines in share/module_bc.F<a name='695'></font>
      CALL <A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_X'>get_bdyzone_x</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_BDYZONE_X_1">( bdyzone_x )<a name='696'>
      CALL <A href='../../html_code/share/module_bc.F.html#GET_BDYZONE_Y'>get_bdyzone_y</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_BDYZONE_Y_1">( bdyzone_y )<a name='697'>
<a name='698'>
      ALLOCATE ( new_grid )<a name='699'>
      ALLOCATE( new_grid%head_statevars )<a name='700'>
      new_grid%head_statevars%Ndim = 0<a name='701'>
      NULLIFY( new_grid%head_statevars%next)<a name='702'>
      new_grid%tail_statevars =&gt; new_grid%head_statevars <a name='703'>
<a name='704'>
      ALLOCATE ( new_grid%parents( max_parents ) ) <a name='705'>
      ALLOCATE ( new_grid%nests( max_nests ) )<a name='706'>
      NULLIFY( new_grid%sibling )<a name='707'>
      DO i = 1, max_nests<a name='708'>
         NULLIFY( new_grid%nests(i)%ptr )<a name='709'>
      ENDDO<a name='710'>
      NULLIFY  (new_grid%next)<a name='711'>
      NULLIFY  (new_grid%same_level)<a name='712'>
      NULLIFY  (new_grid%i_start)<a name='713'>
      NULLIFY  (new_grid%j_start)<a name='714'>
      NULLIFY  (new_grid%i_end)<a name='715'>
      NULLIFY  (new_grid%j_end)<a name='716'>
      ALLOCATE( new_grid%domain_clock )<a name='717'>
      new_grid%domain_clock_created = .FALSE.<a name='718'>
      ALLOCATE( new_grid%alarms( MAX_WRF_ALARMS ) )    <font color=#447700>! initialize in setup_timekeeping<a name='719'></font>
      ALLOCATE( new_grid%alarms_created( MAX_WRF_ALARMS ) )<a name='720'>
      DO i = 1, MAX_WRF_ALARMS<a name='721'>
        new_grid%alarms_created( i ) = .FALSE.<a name='722'>
      ENDDO<a name='723'>
      new_grid%time_set = .FALSE.<a name='724'>
      new_grid%is_intermediate = .FALSE.<a name='725'>
      new_grid%have_displayed_alloc_stats = .FALSE.<a name='726'>
<a name='727'>
      new_grid%tiling_latch = .FALSE.  <font color=#447700>! 20121003<a name='728'></font>
<a name='729'>
      <font color=#447700>! set up the pointers that represent the nest hierarchy<a name='730'></font>
      <font color=#447700>! set this up *prior* to calling the patching or allocation<a name='731'></font>
      <font color=#447700>! routines so that implementations of these routines can<a name='732'></font>
      <font color=#447700>! traverse the nest hierarchy (through the root head_grid)<a name='733'></font>
      <font color=#447700>! if they need to <a name='734'></font>
<a name='735'>
 <a name='736'>
      IF ( domain_id .NE. 1 ) THEN<a name='737'>
         new_grid%parents(1)%ptr =&gt; parent<a name='738'>
         new_grid%num_parents = 1<a name='739'>
         parent%nests(kid)%ptr =&gt; new_grid<a name='740'>
         new_grid%child_of_parent(1) = kid    <font color=#447700>! note assumption that nest can have only 1 parent<a name='741'></font>
         parent%num_nests = parent%num_nests + 1<a name='742'>
#if ( NMM_CORE == 1 ) <a name='743'>
<font color=#447700>!jm 20150810, this replaces the compile-time logic associated with the CPP constant HRD_MULTIPLE_STORMS<a name='744'></font>
<font color=#447700>! used in solve_nmm of the HWRF version to decide whether or not to call the coupler.  If there is more than<a name='745'></font>
<font color=#447700>! one nest to a parent then that implies there are multiple storms, so we turn off the coupling.<a name='746'></font>
         IF ( parent%num_nests .GT. 1 ) THEN<a name='747'>
           CALL nl_set_multi_storm(1,.FALSE.)<a name='748'>
         ENDIF<a name='749'>
#endif<a name='750'>
      END IF<a name='751'>
      new_grid%id = domain_id                 <font color=#447700>! this needs to be assigned prior to calling wrf_patch_domain<a name='752'></font>
      new_grid%active_this_task = active<a name='753'>
<a name='754'>
      CALL <A href='../../html_code/frame/module_domain.F.html#WRF_PATCH_DOMAIN'>wrf_patch_domain</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_PATCH_DOMAIN_1">( domain_id  , new_domdesc , parent, parent_id, parent_domdesc , &amp;<a name='755'>
<a name='756'>
                             sd1 , ed1 , sp1 , ep1 , sm1 , em1 , &amp;     <font color=#447700>! z-xpose dims<a name='757'></font>
                             sd2 , ed2 , sp2 , ep2 , sm2 , em2 , &amp;     <font color=#447700>! (standard)<a name='758'></font>
                             sd3 , ed3 , sp3 , ep3 , sm3 , em3 , &amp;<a name='759'>
<a name='760'>
                                     sp1x , ep1x , sm1x , em1x , &amp;     <font color=#447700>! x-xpose dims<a name='761'></font>
                                     sp2x , ep2x , sm2x , em2x , &amp;<a name='762'>
                                     sp3x , ep3x , sm3x , em3x , &amp;<a name='763'>
<a name='764'>
                                     sp1y , ep1y , sm1y , em1y , &amp;     <font color=#447700>! y-xpose dims<a name='765'></font>
                                     sp2y , ep2y , sm2y , em2y , &amp;<a name='766'>
                                     sp3y , ep3y , sm3y , em3y , &amp;<a name='767'>
<a name='768'>
                         bdyzone_x  , bdyzone_y , new_grid%bdy_mask &amp;<a name='769'>
      ) <a name='770'>
<a name='771'>
<a name='772'>
      new_grid%domdesc = new_domdesc<a name='773'>
      new_grid%num_nests = 0<a name='774'>
      new_grid%num_siblings = 0<a name='775'>
      new_grid%num_parents = 0<a name='776'>
      new_grid%max_tiles   = 0<a name='777'>
      new_grid%num_tiles_spec   = 0<a name='778'>
      new_grid%nframes   = 0         <font color=#447700>! initialize the number of frames per file (array assignment)<a name='779'></font>
<font color=#447700>!BPR BEGIN<a name='780'></font>
<font color=#447700>!#if (EM_CORE == 1)<a name='781'></font>
<font color=#447700>!      new_grid%stepping_to_time = .FALSE.<a name='782'></font>
<font color=#447700>!      new_grid%adaptation_domain = 1<a name='783'></font>
<font color=#447700>!      new_grid%last_step_updated = -1<a name='784'></font>
<font color=#447700>!#endif<a name='785'></font>
<font color=#447700>!BPR BEGIN<a name='786'></font>
<a name='787'>
<font color=#447700>!      IF (active) THEN<a name='788'></font>
        <font color=#447700>! only allocate state if this set of tasks actually computes that domain, jm 20140822<a name='789'></font>
      new_grid%active_this_task = active<a name='790'>
      CALL <A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD'>alloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_SPACE_FIELD_3"> ( new_grid, domain_id , 3 , 3 , .FALSE. , active,     &amp;<a name='791'>
                               sd1, ed1, sd2, ed2, sd3, ed3,       &amp;<a name='792'>
                               sm1,  em1,  sm2,  em2,  sm3,  em3,  &amp;<a name='793'>
                               sp1,  ep1,  sp2,  ep2,  sp3,  ep3,  &amp;<a name='794'>
                               sp1x, ep1x, sp2x, ep2x, sp3x, ep3x, &amp;<a name='795'>
                               sp1y, ep1y, sp2y, ep2y, sp3y, ep3y, &amp;<a name='796'>
                               sm1x, em1x, sm2x, em2x, sm3x, em3x, &amp;   <font color=#447700>! x-xpose<a name='797'></font>
                               sm1y, em1y, sm2y, em2y, sm3y, em3y  &amp;   <font color=#447700>! y-xpose<a name='798'></font>
      )<a name='799'>
<font color=#447700>!      ELSE<a name='800'></font>
<font color=#447700>!        WRITE (wrf_err_message,*)"Not allocating storage for domain ",domain_id," on this set of tasks"<a name='801'></font>
<font color=#447700>!        CALL wrf_message(TRIM(wrf_err_message))<a name='802'></font>
<font color=#447700>!      ENDIF<a name='803'></font>
<a name='804'>
<font color=#447700>!BPR BEGIN<a name='805'></font>
#if (EM_CORE == 1)<a name='806'>
<font color=#447700>!Set these here, after alloc_space_field, which initializes at least last_step_updated to zero<a name='807'></font>
      new_grid%stepping_to_time = .FALSE.<a name='808'>
      new_grid%adaptation_domain = 1<a name='809'>
      new_grid%last_step_updated = -1<a name='810'>
#endif<a name='811'>
<font color=#447700>!BPR END<a name='812'></font>
<a name='813'>
#if MOVE_NESTS<a name='814'>
<font color=#447700>!set these here, after alloc_space_field, which initializes vc_i, vc_j to zero<a name='815'></font>
      new_grid%xi = -1.0<a name='816'>
      new_grid%xj = -1.0<a name='817'>
      new_grid%vc_i = -1.0<a name='818'>
      new_grid%vc_j = -1.0<a name='819'>
#endif<a name='820'>
<a name='821'>
      new_grid%sd31                            = sd1 <a name='822'>
      new_grid%ed31                            = ed1<a name='823'>
      new_grid%sp31                            = sp1 <a name='824'>
      new_grid%ep31                            = ep1 <a name='825'>
      new_grid%sm31                            = sm1 <a name='826'>
      new_grid%em31                            = em1<a name='827'>
      new_grid%sd32                            = sd2 <a name='828'>
      new_grid%ed32                            = ed2<a name='829'>
      new_grid%sp32                            = sp2 <a name='830'>
      new_grid%ep32                            = ep2 <a name='831'>
      new_grid%sm32                            = sm2 <a name='832'>
      new_grid%em32                            = em2<a name='833'>
      new_grid%sd33                            = sd3 <a name='834'>
      new_grid%ed33                            = ed3<a name='835'>
      new_grid%sp33                            = sp3 <a name='836'>
      new_grid%ep33                            = ep3 <a name='837'>
      new_grid%sm33                            = sm3 <a name='838'>
      new_grid%em33                            = em3<a name='839'>
<a name='840'>
      new_grid%sp31x                           = sp1x<a name='841'>
      new_grid%ep31x                           = ep1x<a name='842'>
      new_grid%sm31x                           = sm1x<a name='843'>
      new_grid%em31x                           = em1x<a name='844'>
      new_grid%sp32x                           = sp2x<a name='845'>
      new_grid%ep32x                           = ep2x<a name='846'>
      new_grid%sm32x                           = sm2x<a name='847'>
      new_grid%em32x                           = em2x<a name='848'>
      new_grid%sp33x                           = sp3x<a name='849'>
      new_grid%ep33x                           = ep3x<a name='850'>
      new_grid%sm33x                           = sm3x<a name='851'>
      new_grid%em33x                           = em3x<a name='852'>
<a name='853'>
      new_grid%sp31y                           = sp1y<a name='854'>
      new_grid%ep31y                           = ep1y<a name='855'>
      new_grid%sm31y                           = sm1y<a name='856'>
      new_grid%em31y                           = em1y<a name='857'>
      new_grid%sp32y                           = sp2y<a name='858'>
      new_grid%ep32y                           = ep2y<a name='859'>
      new_grid%sm32y                           = sm2y<a name='860'>
      new_grid%em32y                           = em2y<a name='861'>
      new_grid%sp33y                           = sp3y<a name='862'>
      new_grid%ep33y                           = ep3y<a name='863'>
      new_grid%sm33y                           = sm3y<a name='864'>
      new_grid%em33y                           = em3y<a name='865'>
<a name='866'>
      SELECT CASE ( model_data_order )<a name='867'>
         CASE  ( DATA_ORDER_XYZ )<a name='868'>
            new_grid%sd21 = sd1 ; new_grid%sd22 = sd2 ;<a name='869'>
            new_grid%ed21 = ed1 ; new_grid%ed22 = ed2 ;<a name='870'>
            new_grid%sp21 = sp1 ; new_grid%sp22 = sp2 ;<a name='871'>
            new_grid%ep21 = ep1 ; new_grid%ep22 = ep2 ;<a name='872'>
            new_grid%sm21 = sm1 ; new_grid%sm22 = sm2 ;<a name='873'>
            new_grid%em21 = em1 ; new_grid%em22 = em2 ;<a name='874'>
            new_grid%sd11 = sd1<a name='875'>
            new_grid%ed11 = ed1<a name='876'>
            new_grid%sp11 = sp1<a name='877'>
            new_grid%ep11 = ep1<a name='878'>
            new_grid%sm11 = sm1<a name='879'>
            new_grid%em11 = em1<a name='880'>
         CASE  ( DATA_ORDER_YXZ )<a name='881'>
            new_grid%sd21 = sd1 ; new_grid%sd22 = sd2 ;<a name='882'>
            new_grid%ed21 = ed1 ; new_grid%ed22 = ed2 ;<a name='883'>
            new_grid%sp21 = sp1 ; new_grid%sp22 = sp2 ;<a name='884'>
            new_grid%ep21 = ep1 ; new_grid%ep22 = ep2 ;<a name='885'>
            new_grid%sm21 = sm1 ; new_grid%sm22 = sm2 ;<a name='886'>
            new_grid%em21 = em1 ; new_grid%em22 = em2 ;<a name='887'>
            new_grid%sd11 = sd1<a name='888'>
            new_grid%ed11 = ed1<a name='889'>
            new_grid%sp11 = sp1<a name='890'>
            new_grid%ep11 = ep1<a name='891'>
            new_grid%sm11 = sm1<a name='892'>
            new_grid%em11 = em1<a name='893'>
         CASE  ( DATA_ORDER_ZXY )<a name='894'>
            new_grid%sd21 = sd2 ; new_grid%sd22 = sd3 ;<a name='895'>
            new_grid%ed21 = ed2 ; new_grid%ed22 = ed3 ;<a name='896'>
            new_grid%sp21 = sp2 ; new_grid%sp22 = sp3 ;<a name='897'>
            new_grid%ep21 = ep2 ; new_grid%ep22 = ep3 ;<a name='898'>
            new_grid%sm21 = sm2 ; new_grid%sm22 = sm3 ;<a name='899'>
            new_grid%em21 = em2 ; new_grid%em22 = em3 ;<a name='900'>
            new_grid%sd11 = sd2<a name='901'>
            new_grid%ed11 = ed2<a name='902'>
            new_grid%sp11 = sp2<a name='903'>
            new_grid%ep11 = ep2<a name='904'>
            new_grid%sm11 = sm2<a name='905'>
            new_grid%em11 = em2<a name='906'>
         CASE  ( DATA_ORDER_ZYX )<a name='907'>
            new_grid%sd21 = sd2 ; new_grid%sd22 = sd3 ;<a name='908'>
            new_grid%ed21 = ed2 ; new_grid%ed22 = ed3 ;<a name='909'>
            new_grid%sp21 = sp2 ; new_grid%sp22 = sp3 ;<a name='910'>
            new_grid%ep21 = ep2 ; new_grid%ep22 = ep3 ;<a name='911'>
            new_grid%sm21 = sm2 ; new_grid%sm22 = sm3 ;<a name='912'>
            new_grid%em21 = em2 ; new_grid%em22 = em3 ;<a name='913'>
            new_grid%sd11 = sd2<a name='914'>
            new_grid%ed11 = ed2<a name='915'>
            new_grid%sp11 = sp2<a name='916'>
            new_grid%ep11 = ep2<a name='917'>
            new_grid%sm11 = sm2<a name='918'>
            new_grid%em11 = em2<a name='919'>
         CASE  ( DATA_ORDER_XZY )<a name='920'>
            new_grid%sd21 = sd1 ; new_grid%sd22 = sd3 ;<a name='921'>
            new_grid%ed21 = ed1 ; new_grid%ed22 = ed3 ;<a name='922'>
            new_grid%sp21 = sp1 ; new_grid%sp22 = sp3 ;<a name='923'>
            new_grid%ep21 = ep1 ; new_grid%ep22 = ep3 ;<a name='924'>
            new_grid%sm21 = sm1 ; new_grid%sm22 = sm3 ;<a name='925'>
            new_grid%em21 = em1 ; new_grid%em22 = em3 ;<a name='926'>
            new_grid%sd11 = sd1<a name='927'>
            new_grid%ed11 = ed1<a name='928'>
            new_grid%sp11 = sp1<a name='929'>
            new_grid%ep11 = ep1<a name='930'>
            new_grid%sm11 = sm1<a name='931'>
            new_grid%em11 = em1<a name='932'>
         CASE  ( DATA_ORDER_YZX )<a name='933'>
            new_grid%sd21 = sd1 ; new_grid%sd22 = sd3 ;<a name='934'>
            new_grid%ed21 = ed1 ; new_grid%ed22 = ed3 ;<a name='935'>
            new_grid%sp21 = sp1 ; new_grid%sp22 = sp3 ;<a name='936'>
            new_grid%ep21 = ep1 ; new_grid%ep22 = ep3 ;<a name='937'>
            new_grid%sm21 = sm1 ; new_grid%sm22 = sm3 ;<a name='938'>
            new_grid%em21 = em1 ; new_grid%em22 = em3 ;<a name='939'>
            new_grid%sd11 = sd1<a name='940'>
            new_grid%ed11 = ed1<a name='941'>
            new_grid%sp11 = sp1<a name='942'>
            new_grid%ep11 = ep1<a name='943'>
            new_grid%sm11 = sm1<a name='944'>
            new_grid%em11 = em1<a name='945'>
      END SELECT<a name='946'>
<a name='947'>
      CALL <A href='../../html_code/share/mediation_wrfmain.F.html#MED_ADD_CONFIG_INFO_TO_GRID'>med_add_config_info_to_grid</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MED_ADD_CONFIG_INFO_TO_GRID_2"> ( new_grid )           <font color=#447700>! this is a mediation layer routine<a name='948'></font>
<a name='949'>
<font color=#447700>! Some miscellaneous state that is in the Registry but not namelist data<a name='950'></font>
<a name='951'>
      new_grid%tiled                           = .false.<a name='952'>
      new_grid%patched                         = .false.<a name='953'>
      NULLIFY(new_grid%mapping)<a name='954'>
<a name='955'>
<font color=#447700>! This next set of includes causes all but the namelist_derived variables to be<a name='956'></font>
<font color=#447700>! properly assigned to the new_grid record<a name='957'></font>
<a name='958'>
      grid =&gt; new_grid<a name='959'>
<font color=#447700>!debug write(0,*)__FILE__,__LINE__,'grid%mvnest ',grid%mvnest<a name='960'></font>
 <a name='961'>
<font color=#447700>!debug write(0,*)__FILE__,__LINE__,'grid%mvnest ',grid%mvnest<a name='962'></font>
      IF ( grid%active_this_task ) THEN<a name='963'>
<font color=#447700>! Allocate storage for time series metadata<a name='964'></font>
        ALLOCATE( grid%lattsloc( grid%max_ts_locs ) )<a name='965'>
        ALLOCATE( grid%lontsloc( grid%max_ts_locs ) )<a name='966'>
        ALLOCATE( grid%nametsloc( grid%max_ts_locs ) )<a name='967'>
        ALLOCATE( grid%desctsloc( grid%max_ts_locs ) )<a name='968'>
        ALLOCATE( grid%itsloc( grid%max_ts_locs ) )<a name='969'>
        ALLOCATE( grid%jtsloc( grid%max_ts_locs ) )<a name='970'>
        ALLOCATE( grid%id_tsloc( grid%max_ts_locs ) )<a name='971'>
        ALLOCATE( grid%ts_filename( grid%max_ts_locs ) )<a name='972'>
        grid%ntsloc        = 0<a name='973'>
        grid%ntsloc_domain = 0<a name='974'>
<a name='975'>
#if (EM_CORE == 1)<a name='976'>
<font color=#447700>! Allocate storage for track metadata<a name='977'></font>
        ALLOCATE( grid%track_time_in( grid%track_loc_in ) )<a name='978'>
        ALLOCATE( grid%track_lat_in( grid%track_loc_in ) )<a name='979'>
        ALLOCATE( grid%track_lon_in( grid%track_loc_in ) )<a name='980'>
  <a name='981'>
        ALLOCATE( grid%track_time_domain( grid%track_loc_in ) )<a name='982'>
        ALLOCATE( grid%track_lat_domain( grid%track_loc_in ) )<a name='983'>
        ALLOCATE( grid%track_lon_domain( grid%track_loc_in ) )<a name='984'>
        ALLOCATE( grid%track_i( grid%track_loc_in ) )<a name='985'>
        ALLOCATE( grid%track_j( grid%track_loc_in ) )<a name='986'>
<a name='987'>
      grid%track_loc        = 0<a name='988'>
      grid%track_loc_domain = 0<a name='989'>
      grid%track_have_calculated = .FALSE.<a name='990'>
      grid%track_have_input      = .FALSE.<a name='991'>
#endif<a name='992'>
      ELSE<a name='993'>
        WRITE (wrf_err_message,*)"Not allocating time series storage for domain ",domain_id," on this set of tasks"<a name='994'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_322">(TRIM(wrf_err_message))<a name='995'>
      ENDIF<a name='996'>
<font color=#447700>!debug write(0,*)__FILE__,__LINE__,'grid%mvnest ',grid%mvnest<a name='997'></font>
#ifdef DM_PARALLEL<a name='998'>
      CALL <A href='../../html_code/frame/module_dm.F.html#WRF_GET_DM_COMMUNICATOR_FOR_ID'>wrf_get_dm_communicator_for_id</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_GET_DM_COMMUNICATOR_FOR_ID_1">( grid%id, grid%communicator )<a name='999'>
      CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_DEFINE_COMMS'>wrf_dm_define_comms</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_AND_CONFIGURE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_DEFINE_COMMS_1">( grid )<a name='1000'>
#endif<a name='1001'>
<a name='1002'>
#if ( NMM_CORE==1 )<a name='1003'>
<font color=#447700>!      grid%interp_mp = .not. ( size(grid%f_ice)&gt;1 .or. size(grid%f_rain)&gt;1 .or. size(grid%f_rimef)&gt;1 )<a name='1004'></font>
      grid%interp_mp = .not. (in_use_for_config(grid%id,'f_ice')   .or.&amp;<a name='1005'>
                              in_use_for_config(grid%id,'f_rain')  .or. &amp; <a name='1006'>
                              in_use_for_config(grid%id,'f_rimef') )<a name='1007'>
#else<a name='1008'>
      grid%interp_mp = .true.<a name='1009'>
#endif<a name='1010'>
<a name='1011'>
   END SUBROUTINE alloc_and_configure_domain<a name='1012'>
<a name='1013'>
<A NAME='GET_FIELDSTR'><A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1014'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_fieldstr</font>(ix,c,instr,outstr,noutstr,noerr) <A href='../../call_to/GET_FIELDSTR.html' TARGET='index'>6</A><a name='1015'>
     IMPLICIT NONE<a name='1016'>
     INTEGER, INTENT(IN)          :: ix<a name='1017'>
     CHARACTER*(*), INTENT(IN)    :: c<a name='1018'>
     CHARACTER*(*), INTENT(IN)    :: instr<a name='1019'>
     CHARACTER*(*), INTENT(OUT)   :: outstr<a name='1020'>
     INTEGER,       INTENT(IN)    :: noutstr  <font color=#447700>! length of outstr<a name='1021'></font>
     LOGICAL,       INTENT(INOUT) :: noerr     <font color=#447700>! status<a name='1022'></font>
     <font color=#447700>!local<a name='1023'></font>
     INTEGER, PARAMETER :: MAX_DEXES = 100<a name='1024'>
     INTEGER I, PREV, IDEX<a name='1025'>
     INTEGER DEXES(MAX_DEXES)<a name='1026'>
     outstr = ""<a name='1027'>
     prev = 1<a name='1028'>
     dexes(1) = 1<a name='1029'>
     DO i = 2,MAX_DEXES<a name='1030'>
       idex = INDEX(instr(prev:LEN(TRIM(instr))),c)<a name='1031'>
       IF ( idex .GT. 0 ) THEN<a name='1032'>
         dexes(i) = idex+prev<a name='1033'>
         prev = dexes(i)+1<a name='1034'>
       ELSE<a name='1035'>
         dexes(i) = LEN(TRIM(instr))+2<a name='1036'>
       ENDIF<a name='1037'>
     ENDDO<a name='1038'>
<a name='1039'>
     IF     ( (dexes(ix+1)-2)-(dexes(ix)) .GT. noutstr ) THEN<a name='1040'>
       noerr = .FALSE.  <font color=#447700>! would overwrite<a name='1041'></font>
     ELSE IF( dexes(ix) .EQ. dexes(ix+1) ) THEN <a name='1042'>
       noerr = .FALSE.  <font color=#447700>! not found<a name='1043'></font>
     ELSE<a name='1044'>
       outstr = instr(dexes(ix):(dexes(ix+1)-2))<a name='1045'>
       noerr = noerr .AND. .TRUE.<a name='1046'>
     ENDIF<a name='1047'>
   END SUBROUTINE get_fieldstr<a name='1048'>
<a name='1049'>
<A NAME='CHANGE_TO_LOWER_CASE'><A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1050'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>change_to_lower_case</font>(instr,outstr) <A href='../../call_to/CHANGE_TO_LOWER_CASE.html' TARGET='index'>7</A><a name='1051'>
     CHARACTER*(*) ,INTENT(IN)  :: instr<a name='1052'>
     CHARACTER*(*) ,INTENT(OUT) :: outstr<a name='1053'>
<font color=#447700>!Local<a name='1054'></font>
     CHARACTER*1                :: c<a name='1055'>
     INTEGER       ,PARAMETER   :: upper_to_lower =IACHAR('a')-IACHAR('A')<a name='1056'>
     INTEGER                    :: i,n,n1<a name='1057'>
<font color=#447700>!<a name='1058'></font>
     outstr = ' '<a name='1059'>
     N = len(instr)<a name='1060'>
     N1 = len(outstr)<a name='1061'>
     N = MIN(N,N1)<a name='1062'>
     outstr(1:N) = instr(1:N)<a name='1063'>
     DO i=1,N<a name='1064'>
       c = instr(i:i)<a name='1065'>
       if('A'&lt;=c .and. c &lt;='Z') outstr(i:i)=achar(iachar(c)+upper_to_lower)<a name='1066'>
     ENDDO<a name='1067'>
     RETURN<a name='1068'>
   END SUBROUTINE change_to_lower_case<a name='1069'>
<a name='1070'>
<font color=#447700>!<a name='1071'></font>
<A NAME='MODIFY_IO_MASKS1'><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1072'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>modify_io_masks1</font> ( grid , id ) <A href='../../call_to/MODIFY_IO_MASKS1.html' TARGET='index'>1</A>,<A href='../../call_from/MODIFY_IO_MASKS1.html' TARGET='index'>26</A><a name='1073'>
      IMPLICIT NONE<a name='1074'>
#include "<A href='../../html_code/include/streams.h.html'>streams.h</A>"<A NAME="streams.h_1"><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1075'>
      INTEGER              , INTENT(IN  )  :: id<a name='1076'>
      TYPE(domain), POINTER                :: grid<a name='1077'>
      <font color=#447700>! Local<a name='1078'></font>
      TYPE(fieldlist), POINTER :: p, q<a name='1079'>
      INTEGER, PARAMETER :: read_unit = 10<a name='1080'>
      LOGICAL, EXTERNAL  :: wrf_dm_on_monitor<a name='1081'>
      CHARACTER*256      :: fname, inln, mess, dname, t1, lookee<a name='1082'>
      CHARACTER*256      :: fieldlst<a name='1083'>
      CHARACTER*1        :: op, strmtyp<a name='1084'>
      CHARACTER*3        :: strmid<a name='1085'>
      CHARACTER*10       :: strmtyp_name<a name='1086'>
      INTEGER            :: io_status<a name='1087'>
      INTEGER            :: strmtyp_int, count_em<a name='1088'>
      INTEGER            :: lineno, fieldno, istrm, retval, itrace<a name='1089'>
      LOGICAL            :: keepgoing, noerr, gavewarning, ignorewarning, found<a name='1090'>
      LOGICAL, SAVE      :: you_warned_me = .FALSE.<a name='1091'>
      LOGICAL, SAVE      :: you_warned_me2(max_hst_mods,max_domains) = .FALSE.<a name='1092'>
<a name='1093'>
      gavewarning = .FALSE.<a name='1094'>
<a name='1095'>
      CALL nl_get_iofields_filename( id, fname )<a name='1096'>
<a name='1097'>
      IF ( grid%is_intermediate ) RETURN                <font color=#447700>! short circuit<a name='1098'></font>
      IF ( TRIM(fname) .EQ. "NONE_SPECIFIED" ) RETURN   <font color=#447700>! short circuit<a name='1099'></font>
<a name='1100'>
      IF ( wrf_dm_on_monitor() ) THEN<a name='1101'>
        OPEN ( UNIT   = read_unit    ,      &amp;<a name='1102'>
               FILE   = TRIM(fname)      ,      &amp;<a name='1103'>
               FORM   = "FORMATTED"      ,      &amp;<a name='1104'>
               STATUS = "OLD"            ,      &amp;<a name='1105'>
               IOSTAT = io_status         )<a name='1106'>
        IF ( io_status .EQ. 0 ) THEN   <font color=#447700>! only on success<a name='1107'></font>
          keepgoing = .TRUE.<a name='1108'>
          lineno = 0<a name='1109'>
          count_em = 0    <font color=#447700>! Count the total number of fields<a name='1110'></font>
          DO WHILE ( keepgoing )<a name='1111'>
            READ(UNIT=read_unit,FMT='(A)',IOSTAT=io_status) inln<a name='1112'>
            keepgoing = (io_status .EQ. 0) .AND. (LEN(TRIM(inln)) .GT. 0)  <a name='1113'>
            IF ( keepgoing ) THEN<a name='1114'>
              lineno = lineno + 1<a name='1115'>
              IF ( .NOT. LEN(TRIM(inln)) .LT. LEN(inln) ) THEN<a name='1116'>
                WRITE(mess,*)'W A R N I N G : Line ',lineno,' of ',TRIM(fname),' is too long. Limit is ',LEN(inln),' characters.' <a name='1117'>
                gavewarning = .TRUE.<a name='1118'>
              ENDIF<a name='1119'>
              IF ( INDEX(inln,'#') .EQ. 0 ) THEN   <font color=#447700>! skip comments, which is a # anywhere on line<a name='1120'></font>
                IF ( keepgoing ) THEN<a name='1121'>
                  noerr = .TRUE.<a name='1122'>
                  CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_1">(1,':',inln,op,1,noerr)          <font color=#447700>! + is add, - is remove<a name='1123'></font>
                  IF ( TRIM(op) .NE. '+' .AND. TRIM(op) .NE. '-' ) THEN<a name='1124'>
                    WRITE(mess,*)'W A R N I N G : unknown operation ',TRIM(op),' (should be + or -). Line ',lineno<a name='1125'>
                    gavewarning = .TRUE.<a name='1126'>
                  ENDIF<a name='1127'>
                  CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_2">(2,':',inln,t1,1,noerr)          <font color=#447700>! i is input, h is history<a name='1128'></font>
                  CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_1">(t1,strmtyp) <a name='1129'>
<a name='1130'>
                  SELECT CASE (TRIM(strmtyp))<a name='1131'>
                  CASE ('h')<a name='1132'>
                     strmtyp_name = 'history'<a name='1133'>
                     strmtyp_int  = first_history<a name='1134'>
                  CASE ('i')<a name='1135'>
                     strmtyp_name = 'input'<a name='1136'>
                     strmtyp_int  = first_input<a name='1137'>
                  CASE DEFAULT<a name='1138'>
                     WRITE(mess,*)'W A R N I N G : unknown stream type ',TRIM(strmtyp),'. Line ',lineno<a name='1139'>
                     gavewarning = .TRUE.<a name='1140'>
                  END SELECT<a name='1141'>
<a name='1142'>
                  CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_3">(3,':',inln,strmid,3,noerr)      <font color=#447700>! number of stream (main input and hist are 0)<a name='1143'></font>
                  READ(strmid,'(I3)') istrm<a name='1144'>
                  IF ( istrm .LT. 0 .OR. istrm .GT. last_history ) THEN<a name='1145'>
                    WRITE(mess,*)'W A R N I N G : invalid stream id ',istrm,' (should be 0 &lt;= id &lt;= ',last_history,'). Line ',lineno<a name='1146'>
                    gavewarning = .TRUE.<a name='1147'>
                  ENDIF<a name='1148'>
                  CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_4">(4,':',inln,fieldlst,1024,noerr) <font color=#447700>! get list of fields<a name='1149'></font>
                  IF ( noerr ) THEN<a name='1150'>
                    fieldno = 1<a name='1151'>
                    CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_5">(fieldno,',',fieldlst,t1,256,noerr)<a name='1152'>
                    CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_2">(t1,lookee)<a name='1153'>
                    DO WHILE ( noerr )    <font color=#447700>! linear search, blargh...<a name='1154'></font>
                      p =&gt; grid%head_statevars%next<a name='1155'>
                      found = .FALSE.<a name='1156'>
                      count_em = count_em + 1<a name='1157'>
                      DO WHILE ( ASSOCIATED( p ) )<a name='1158'>
  <a name='1159'>
                        IF ( p%Ndim .EQ. 4 .AND. p%scalar_array ) THEN<a name='1160'>
  <a name='1161'>
                          DO itrace = PARAM_FIRST_SCALAR , p%num_table(grid%id)<a name='1162'>
                            CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_3">( p%dname_table( grid%id, itrace ) , dname ) <a name='1163'>
<a name='1164'>
                            IF ( TRIM(dname) .EQ. TRIM(lookee) ) &amp;<a name='1165'>
                            CALL <A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK'>warn_me_or_set_mask</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WARN_ME_OR_SET_MASK_1"> (id, istrm, lineno, strmtyp_int, count_em, op, &amp;<a name='1166'>
                                                      strmtyp_name, dname, fname, lookee,      &amp;<a name='1167'>
                                                      p%streams_table(grid%id,itrace)%stream,  &amp;<a name='1168'>
                                                      mess, found, you_warned_me2)<a name='1169'>
                          ENDDO<a name='1170'>
                        ELSE <a name='1171'>
                          IF ( p%Ntl .GT. 0 ) THEN<a name='1172'>
                            CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_4">(p%DataName(1:LEN(TRIM(p%DataName))-2),dname)<a name='1173'>
                          ELSE<a name='1174'>
                            CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_5">(p%DataName,dname)<a name='1175'>
                          ENDIF<a name='1176'>
  <a name='1177'>
                          IF ( TRIM(dname) .EQ. TRIM(lookee) ) &amp;<a name='1178'>
                          CALL <A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK'>warn_me_or_set_mask</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WARN_ME_OR_SET_MASK_2"> (id, istrm, lineno, strmtyp_int, count_em, op, &amp;<a name='1179'>
                                                    strmtyp_name, dname, fname, lookee,      &amp;<a name='1180'>
                                                    p%streams, mess, found, you_warned_me2)<a name='1181'>
                        ENDIF<a name='1182'>
                        p =&gt; p%next<a name='1183'>
                      ENDDO<a name='1184'>
                      IF ( .NOT. found ) THEN<a name='1185'>
                        WRITE(mess,*)'W A R N I N G : Unable to modify mask for ',TRIM(lookee),&amp;<a name='1186'>
                                     '.  Variable not found. File: ',TRIM(fname),' at line ',lineno<a name='1187'>
                        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_323">(mess)<a name='1188'>
                        gavewarning = .TRUE.<a name='1189'>
                      ENDIF<a name='1190'>
                      fieldno = fieldno + 1<a name='1191'>
                      CALL <A href='../../html_code/frame/module_domain.F.html#GET_FIELDSTR'>get_fieldstr</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_FIELDSTR_6">(fieldno,',',fieldlst,t1,256,noerr)<a name='1192'>
                      CALL <A href='../../html_code/frame/module_domain.F.html#CHANGE_TO_LOWER_CASE'>change_to_lower_case</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="CHANGE_TO_LOWER_CASE_6">(t1,lookee)<a name='1193'>
                    ENDDO<a name='1194'>
                  ELSE<a name='1195'>
                    WRITE(mess,*)'W A R N I N G : Problem reading ',TRIM(fname),' at line ',lineno<a name='1196'>
                    CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_324">(mess)<a name='1197'>
                    gavewarning = .TRUE.<a name='1198'>
                  ENDIF<a name='1199'>
                ENDIF  <font color=#447700>! keepgoing<a name='1200'></font>
              ENDIF    <font color=#447700>! skip comments<a name='1201'></font>
            ENDIF      <font color=#447700>! keepgoing<a name='1202'></font>
          ENDDO<a name='1203'>
        ELSE<a name='1204'>
          WRITE(mess,*)'W A R N I N G : Problem opening ',TRIM(fname)<a name='1205'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_325">(mess)<a name='1206'>
          gavewarning = .TRUE.<a name='1207'>
        ENDIF<a name='1208'>
        CLOSE( read_unit )<a name='1209'>
        IF ( gavewarning ) THEN<a name='1210'>
          CALL nl_get_ignore_iofields_warning(1,ignorewarning)<a name='1211'>
          IF ( .NOT. ignorewarning ) THEN<a name='1212'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_326">(mess)<a name='1213'>
            WRITE(mess,*)'modify_io_masks: problems reading ',TRIM(fname) <a name='1214'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_327">(mess)<a name='1215'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_218">('Set ignore_iofields_warn to true in namelist to ignore')<a name='1216'>
          ELSE<a name='1217'>
            IF ( .NOT. you_warned_me ) THEN<a name='1218'>
              if ( .NOT. you_warned_me2(count_em,id) ) CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_328">(mess)  <font color=#447700>! Don't repeat the W A R N I N G message<a name='1219'></font>
              WRITE(mess,*)'Ignoring problems reading ',TRIM(fname) <a name='1220'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_329">(mess)<a name='1221'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_330">('Continuing.  To make this a fatal error, set ignore_iofields_warn to false in namelist' )<a name='1222'>
              CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_331">(' ')<a name='1223'>
              you_warned_me = .TRUE.<a name='1224'>
            ENDIF<a name='1225'>
          ENDIF<a name='1226'>
        ENDIF<a name='1227'>
      ENDIF  <font color=#447700>! wrf_dm_on_monitor<a name='1228'></font>
<a name='1229'>
#ifdef DM_PARALLEL<a name='1230'>
<font color=#447700>! broadcast the new masks to the other tasks<a name='1231'></font>
      p =&gt; grid%head_statevars%next<a name='1232'>
      DO WHILE ( ASSOCIATED( p ) )<a name='1233'>
        IF ( p%Ndim .EQ. 4 .AND. p%scalar_array ) THEN<a name='1234'>
<a name='1235'>
          DO itrace = PARAM_FIRST_SCALAR , p%num_table(grid%id)<a name='1236'>
            CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_INTEGER'>wrf_dm_bcast_integer</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_INTEGER_3">( p%streams_table(grid%id,itrace)%stream, IO_MASK_SIZE )<a name='1237'>
          ENDDO<a name='1238'>
<a name='1239'>
        ELSE<a name='1240'>
          CALL <A href='../../html_code/frame/module_dm_stubs.F.html#WRF_DM_BCAST_INTEGER'>wrf_dm_bcast_integer</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_BCAST_INTEGER_4">( p%streams, IO_MASK_SIZE )<a name='1241'>
        ENDIF<a name='1242'>
        p =&gt; p%next<a name='1243'>
      ENDDO<a name='1244'>
#endif<a name='1245'>
      <a name='1246'>
   END SUBROUTINE modify_io_masks1<a name='1247'>
<a name='1248'>
<A NAME='WARN_ME_OR_SET_MASK'><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1249'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>warn_me_or_set_mask</font> (id, istrm, lineno, strmtyp_int, count_em, op, &amp; <A href='../../call_to/WARN_ME_OR_SET_MASK.html' TARGET='index'>2</A>,<A href='../../call_from/WARN_ME_OR_SET_MASK.html' TARGET='index'>5</A><a name='1250'>
                                   strmtyp_name, dname, fname, lookee,      &amp;<a name='1251'>
                                   p_stream, mess, found, you_warned_me2)<a name='1252'>
<a name='1253'>
      IMPLICIT NONE<a name='1254'>
<a name='1255'>
<font color=#447700>! See if a field that is requested to be added to or removed from the I/O stream<a name='1256'></font>
<font color=#447700>!    is already present or absent<a name='1257'></font>
<font color=#447700>! If the requested action has already been done, write a warning message<a name='1258'></font>
<font color=#447700>! If not, satisfy the request<a name='1259'></font>
<a name='1260'>
     INTEGER,       INTENT(IN )   :: id, istrm, lineno, strmtyp_int<a name='1261'>
     INTEGER,       INTENT(IN )   :: p_stream(*), count_em<a name='1262'>
     CHARACTER*1,   INTENT(IN )   :: op<a name='1263'>
     CHARACTER*10,  INTENT(IN )   :: strmtyp_name<a name='1264'>
     CHARACTER*256, INTENT(IN )   :: dname, fname, lookee<a name='1265'>
     CHARACTER*256, INTENT(OUT)   :: mess<a name='1266'>
     LOGICAL,       INTENT(OUT)   :: found<a name='1267'>
     LOGICAL,       INTENT(INOUT) :: you_warned_me2(max_hst_mods,max_domains)<a name='1268'>
   <font color=#447700>! Local<a name='1269'></font>
     INTEGER                      :: retval<a name='1270'>
<a name='1271'>
     found = .TRUE.<a name='1272'>
     IF      ( TRIM(op) .EQ. '+' ) THEN<a name='1273'>
       CALL get_mask( p_stream, strmtyp_int + istrm - 1, retval )<a name='1274'>
       IF ( retval .NE. 0 ) THEN<a name='1275'>
         WRITE(mess,*) 'Domain ',id, ' W A R N I N G : Variable ',TRIM(lookee),' already on ', &amp;<a name='1276'>
                       TRIM(strmtyp_name), ' stream ',istrm, '.  File: ', TRIM(fname),' at line ',lineno<a name='1277'>
       ELSE<a name='1278'>
         WRITE(mess,*) 'Domain ', id, ' Setting ', TRIM(strmtyp_name), ' stream ',istrm,' for ', &amp;<a name='1279'>
                                  TRIM(DNAME)  ; CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_228">(1,mess)<a name='1280'>
         CALL set_mask( p_stream, strmtyp_int + istrm - 1 )<a name='1281'>
       ENDIF<a name='1282'>
     ELSE IF ( TRIM(op) .EQ. '-' ) THEN<a name='1283'>
       CALL get_mask( p_stream, strmtyp_int + istrm - 1, retval )<a name='1284'>
       IF ( retval .EQ. 0 ) THEN<a name='1285'>
         WRITE(mess,*) 'Domain ',id, ' W A R N I N G : Variable ',TRIM(lookee),' already off ', &amp;<a name='1286'>
                       TRIM(strmtyp_name), ' stream ',istrm, '. File: ',TRIM(fname),' at line ',lineno<a name='1287'>
       ELSE<a name='1288'>
         WRITE(mess,*) 'Domain ', id, ' Resetting ', TRIM(strmtyp_name), ' stream ',istrm,' for ', &amp;<a name='1289'>
                                    TRIM(DNAME)  ; CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_229">(1,mess) <a name='1290'>
         CALL reset_mask( p_stream, strmtyp_int + istrm - 1)<a name='1291'>
       ENDIF<a name='1292'>
     ENDIF<a name='1293'>
     IF ( count_em &gt; max_hst_mods ) THEN<a name='1294'>
       WRITE(mess,*)'ERROR module_domain:  Array size for you_warned_me2 is fixed at ',max_hst_mods<a name='1295'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_332">(mess)<a name='1296'>
       CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_219">('Did you really type &gt; max_hst_mods fields into ', TRIM(fname) ,' ?')<a name='1297'>
     ELSE<a name='1298'>
       IF ( .NOT. you_warned_me2(count_em,id) ) THEN<a name='1299'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#WARN_ME_OR_SET_MASK' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_333">(mess)     <font color=#447700>! Write warning message once for each field<a name='1300'></font>
         you_warned_me2(count_em,id) = .TRUE.<a name='1301'>
       ENDIF<a name='1302'>
     ENDIF<a name='1303'>
<a name='1304'>
   END SUBROUTINE warn_me_or_set_mask <a name='1305'>
<a name='1306'>
<font color=#447700>!  This routine ALLOCATEs the required space for the meteorological fields<a name='1307'></font>
<font color=#447700>!  for a specific domain.  The fields are simply ALLOCATEd as an -1.  They<a name='1308'></font>
<font color=#447700>!  are referenced as wind, temperature, moisture, etc. in routines that are<a name='1309'></font>
<font color=#447700>!  below this top-level of data allocation and management (in the solve routine<a name='1310'></font>
<font color=#447700>!  and below).<a name='1311'></font>
<a name='1312'>
<A NAME='ALLOC_SPACE_FIELD'><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1313'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>alloc_space_field</font> ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in,  &amp; <A href='../../call_to/ALLOC_SPACE_FIELD.html' TARGET='index'>8</A>,<A href='../../call_from/ALLOC_SPACE_FIELD.html' TARGET='index'>14</A><a name='1314'>
                                  sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1315'>
                                  sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1316'>
                                  sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1317'>
                                  sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1318'>
                                  sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1319'>
                                  sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1320'>
                                  sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1321'>
<a name='1322'>
      USE <A href='../../html_code/frame/module_alloc_space_0.F.html#MODULE_ALLOC_SPACE_0'>module_alloc_space_0</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_0_1">, ONLY : alloc_space_field_core_0<a name='1323'>
      USE <A href='../../html_code/frame/module_alloc_space_1.F.html#MODULE_ALLOC_SPACE_1'>module_alloc_space_1</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_1_1">, ONLY : alloc_space_field_core_1<a name='1324'>
      USE <A href='../../html_code/frame/module_alloc_space_2.F.html#MODULE_ALLOC_SPACE_2'>module_alloc_space_2</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_2_1">, ONLY : alloc_space_field_core_2<a name='1325'>
      USE <A href='../../html_code/frame/module_alloc_space_3.F.html#MODULE_ALLOC_SPACE_3'>module_alloc_space_3</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_3_1">, ONLY : alloc_space_field_core_3<a name='1326'>
      USE <A href='../../html_code/frame/module_alloc_space_4.F.html#MODULE_ALLOC_SPACE_4'>module_alloc_space_4</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_4_1">, ONLY : alloc_space_field_core_4<a name='1327'>
      USE <A href='../../html_code/frame/module_alloc_space_5.F.html#MODULE_ALLOC_SPACE_5'>module_alloc_space_5</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_5_1">, ONLY : alloc_space_field_core_5<a name='1328'>
      USE <A href='../../html_code/frame/module_alloc_space_6.F.html#MODULE_ALLOC_SPACE_6'>module_alloc_space_6</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_6_1">, ONLY : alloc_space_field_core_6<a name='1329'>
      USE <A href='../../html_code/frame/module_alloc_space_7.F.html#MODULE_ALLOC_SPACE_7'>module_alloc_space_7</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_7_1">, ONLY : alloc_space_field_core_7<a name='1330'>
      USE <A href='../../html_code/frame/module_alloc_space_8.F.html#MODULE_ALLOC_SPACE_8'>module_alloc_space_8</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_8_1">, ONLY : alloc_space_field_core_8<a name='1331'>
      USE <A href='../../html_code/frame/module_alloc_space_9.F.html#MODULE_ALLOC_SPACE_9'>module_alloc_space_9</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_ALLOC_SPACE_9_1">, ONLY : alloc_space_field_core_9<a name='1332'>
<a name='1333'>
      IMPLICIT NONE<a name='1334'>
<a name='1335'>
      <font color=#447700>!  Input data.<a name='1336'></font>
<a name='1337'>
      TYPE(domain)               , POINTER          :: grid<a name='1338'>
      INTEGER , INTENT(IN)            :: id<a name='1339'>
      INTEGER , INTENT(IN)            :: setinitval_in   <font color=#447700>! 3 = everything, 1 = arrays only, 0 = none<a name='1340'></font>
      INTEGER , INTENT(IN)            :: sd31, ed31, sd32, ed32, sd33, ed33<a name='1341'>
      INTEGER , INTENT(IN)            :: sm31, em31, sm32, em32, sm33, em33<a name='1342'>
      INTEGER , INTENT(IN)            :: sp31, ep31, sp32, ep32, sp33, ep33<a name='1343'>
      INTEGER , INTENT(IN)            :: sp31x, ep31x, sp32x, ep32x, sp33x, ep33x<a name='1344'>
      INTEGER , INTENT(IN)            :: sp31y, ep31y, sp32y, ep32y, sp33y, ep33y<a name='1345'>
      INTEGER , INTENT(IN)            :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='1346'>
      INTEGER , INTENT(IN)            :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='1347'>
<a name='1348'>
      <font color=#447700>! this argument is a bitmask. First bit is time level 1, second is time level 2, and so on.<a name='1349'></font>
      <font color=#447700>! e.g. to set both 1st and second time level, use 3<a name='1350'></font>
      <font color=#447700>!      to set only 1st                        use 1<a name='1351'></font>
      <font color=#447700>!      to set only 2st                        use 2<a name='1352'></font>
      INTEGER , INTENT(IN)            :: tl_in<a name='1353'>
  <a name='1354'>
      <font color=#447700>! true if the allocation is for an intermediate domain (for nesting); only certain fields allocated<a name='1355'></font>
      <font color=#447700>! false otherwise (all allocated, modulo tl above)<a name='1356'></font>
      LOGICAL , INTENT(IN)            :: inter_domain_in, okay_to_alloc_in<a name='1357'>
<a name='1358'>
      <font color=#447700>! Local<a name='1359'></font>
      INTEGER(KIND=8)  num_bytes_allocated<a name='1360'>
      INTEGER  idum1, idum2<a name='1361'>
<a name='1362'>
#if (EM_CORE == 1)<a name='1363'>
      IF ( grid%id .EQ. 1 ) CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_334"> ( &amp;<a name='1364'>
          'DYNAMICS OPTION: Eulerian Mass Coordinate ')<a name='1365'>
#endif<a name='1366'>
#if (NMM_CORE == 1)<a name='1367'>
      IF ( grid%id .EQ. 1 ) &amp;<a name='1368'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_335"> ( 'DYNAMICS OPTION: nmm dyncore' )<a name='1369'>
#endif<a name='1370'>
<a name='1371'>
      CALL <A href='../../html_code/frame/module_configure.F.html#SET_SCALAR_INDICES_FROM_CONFIG'>set_scalar_indices_from_config</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_SCALAR_INDICES_FROM_CONFIG_7">( id , idum1 , idum2 )<a name='1372'>
<a name='1373'>
      num_bytes_allocated = 0 <a name='1374'>
<a name='1375'>
      <font color=#447700>! now separate modules to reduce the size of module_domain that the compiler sees<a name='1376'></font>
      CALL alloc_space_field_core_0 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated , &amp;<a name='1377'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1378'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1379'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1380'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1381'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1382'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1383'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1384'>
      CALL alloc_space_field_core_1 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1385'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1386'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1387'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1388'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1389'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1390'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1391'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1392'>
      CALL alloc_space_field_core_2 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1393'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1394'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1395'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1396'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1397'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1398'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1399'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1400'>
      CALL alloc_space_field_core_3 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1401'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1402'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1403'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1404'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1405'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1406'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1407'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1408'>
      CALL alloc_space_field_core_4 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1409'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1410'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1411'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1412'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1413'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1414'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1415'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1416'>
      CALL alloc_space_field_core_5 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1417'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1418'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1419'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1420'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1421'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1422'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1423'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1424'>
      CALL alloc_space_field_core_6 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1425'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1426'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1427'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1428'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1429'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1430'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1431'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1432'>
      CALL alloc_space_field_core_7 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1433'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1434'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1435'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1436'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1437'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1438'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1439'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1440'>
      CALL alloc_space_field_core_8 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1441'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1442'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1443'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1444'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1445'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1446'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1447'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1448'>
      CALL alloc_space_field_core_9 ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in, num_bytes_allocated ,  &amp;<a name='1449'>
                                    sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1450'>
                                    sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1451'>
                                    sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1452'>
                                    sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1453'>
                                    sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1454'>
                                    sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1455'>
                                    sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1456'>
<a name='1457'>
      IF ( .NOT. grid%have_displayed_alloc_stats ) THEN<a name='1458'>
        <font color=#447700>! we do not want to see this message more than once, as can happen with the allocation and<a name='1459'></font>
        <font color=#447700>! deallocation of intermediate domains used in nesting.<a name='1460'></font>
        WRITE(wrf_err_message,*)&amp;<a name='1461'>
            'alloc_space_field: domain ',id,', ',num_bytes_allocated,' bytes allocated'<a name='1462'>
        CALL  <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_230">( 0, wrf_err_message )<a name='1463'>
        grid%have_displayed_alloc_stats = .TRUE.   <a name='1464'>
      ENDIF<a name='1465'>
<a name='1466'>
<a name='1467'>
      grid%alloced_sd31=sd31<a name='1468'>
      grid%alloced_ed31=ed31<a name='1469'>
      grid%alloced_sd32=sd32<a name='1470'>
      grid%alloced_ed32=ed32<a name='1471'>
      grid%alloced_sd33=sd33<a name='1472'>
      grid%alloced_ed33=ed33<a name='1473'>
      grid%alloced_sm31=sm31<a name='1474'>
      grid%alloced_em31=em31<a name='1475'>
      grid%alloced_sm32=sm32<a name='1476'>
      grid%alloced_em32=em32<a name='1477'>
      grid%alloced_sm33=sm33<a name='1478'>
      grid%alloced_em33=em33<a name='1479'>
      grid%alloced_sm31x=sm31x<a name='1480'>
      grid%alloced_em31x=em31x<a name='1481'>
      grid%alloced_sm32x=sm32x<a name='1482'>
      grid%alloced_em32x=em32x<a name='1483'>
      grid%alloced_sm33x=sm33x<a name='1484'>
      grid%alloced_em33x=em33x<a name='1485'>
      grid%alloced_sm31y=sm31y<a name='1486'>
      grid%alloced_em31y=em31y<a name='1487'>
      grid%alloced_sm32y=sm32y<a name='1488'>
      grid%alloced_em32y=em32y<a name='1489'>
      grid%alloced_sm33y=sm33y<a name='1490'>
      grid%alloced_em33y=em33y<a name='1491'>
<a name='1492'>
      grid%allocated=.TRUE.<a name='1493'>
<a name='1494'>
   END SUBROUTINE alloc_space_field<a name='1495'>
<a name='1496'>
   <font color=#447700>! Ensure_space_field allocates a grid's arrays if they are not yet<a name='1497'></font>
   <font color=#447700>! allocated.  If they were already allocated, then it deallocates and<a name='1498'></font>
   <font color=#447700>! reallocates them if they were allocated with different dimensions.<a name='1499'></font>
   <font color=#447700>! If they were already allocated with the requested dimensions, then<a name='1500'></font>
   <font color=#447700>! ensure_space_field does nothing.<a name='1501'></font>
<a name='1502'>
<A NAME='ENSURE_SPACE_FIELD'><A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1503'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>ensure_space_field</font> ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in,  &amp; <A href='../../call_to/ENSURE_SPACE_FIELD.html' TARGET='index'>3</A>,<A href='../../call_from/ENSURE_SPACE_FIELD.html' TARGET='index'>4</A><a name='1504'>
                                  sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1505'>
                                  sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1506'>
                                  sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1507'>
                                  sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1508'>
                                  sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1509'>
                                  sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1510'>
                                  sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1511'>
<a name='1512'>
      IMPLICIT NONE<a name='1513'>
<a name='1514'>
      <font color=#447700>!  Input data.<a name='1515'></font>
<a name='1516'>
      TYPE(domain)               , POINTER          :: grid<a name='1517'>
      INTEGER , INTENT(IN)            :: id<a name='1518'>
      INTEGER , INTENT(IN)            :: setinitval_in   <font color=#447700>! 3 = everything, 1 = arrays only, 0 = none<a name='1519'></font>
      INTEGER , INTENT(IN)            :: sd31, ed31, sd32, ed32, sd33, ed33<a name='1520'>
      INTEGER , INTENT(IN)            :: sm31, em31, sm32, em32, sm33, em33<a name='1521'>
      INTEGER , INTENT(IN)            :: sp31, ep31, sp32, ep32, sp33, ep33<a name='1522'>
      INTEGER , INTENT(IN)            :: sp31x, ep31x, sp32x, ep32x, sp33x, ep33x<a name='1523'>
      INTEGER , INTENT(IN)            :: sp31y, ep31y, sp32y, ep32y, sp33y, ep33y<a name='1524'>
      INTEGER , INTENT(IN)            :: sm31x, em31x, sm32x, em32x, sm33x, em33x<a name='1525'>
      INTEGER , INTENT(IN)            :: sm31y, em31y, sm32y, em32y, sm33y, em33y<a name='1526'>
<a name='1527'>
      <font color=#447700>! this argument is a bitmask. First bit is time level 1, second is time level 2, and so on.<a name='1528'></font>
      <font color=#447700>! e.g. to set both 1st and second time level, use 3<a name='1529'></font>
      <font color=#447700>!      to set only 1st                        use 1<a name='1530'></font>
      <font color=#447700>!      to set only 2st                        use 2<a name='1531'></font>
      INTEGER , INTENT(IN)            :: tl_in<a name='1532'>
  <a name='1533'>
      <font color=#447700>! true if the allocation is for an intermediate domain (for nesting); only certain fields allocated<a name='1534'></font>
      <font color=#447700>! false otherwise (all allocated, modulo tl above)<a name='1535'></font>
      LOGICAL , INTENT(IN)            :: inter_domain_in, okay_to_alloc_in<a name='1536'>
      LOGICAL                         :: size_changed<a name='1537'>
<a name='1538'>
      size_changed=         .not. ( &amp;<a name='1539'>
         grid%alloced_sd31 .eq. sd31 .and. grid%alloced_ed31 .eq. ed31 .and. &amp;<a name='1540'>
         grid%alloced_sd32 .eq. sd32 .and. grid%alloced_ed32 .eq. ed32 .and. &amp;<a name='1541'>
         grid%alloced_sd33 .eq. sd33 .and. grid%alloced_ed33 .eq. ed33 .and. &amp;<a name='1542'>
         grid%alloced_sm31 .eq. sm31 .and. grid%alloced_em31 .eq. em31 .and. &amp;<a name='1543'>
         grid%alloced_sm32 .eq. sm32 .and. grid%alloced_em32 .eq. em32 .and. &amp;<a name='1544'>
         grid%alloced_sm33 .eq. sm33 .and. grid%alloced_em33 .eq. em33 .and. &amp;<a name='1545'>
         grid%alloced_sm31x .eq. sm31x .and. grid%alloced_em31x .eq. em31x .and. &amp;<a name='1546'>
         grid%alloced_sm32x .eq. sm32x .and. grid%alloced_em32x .eq. em32x .and. &amp;<a name='1547'>
         grid%alloced_sm33x .eq. sm33x .and. grid%alloced_em33x .eq. em33x .and. &amp;<a name='1548'>
         grid%alloced_sm31y .eq. sm31y .and. grid%alloced_em31y .eq. em31y .and. &amp;<a name='1549'>
         grid%alloced_sm32y .eq. sm32y .and. grid%alloced_em32y .eq. em32y .and. &amp;<a name='1550'>
         grid%alloced_sm33y .eq. sm33y .and. grid%alloced_em33y .eq. em33y &amp;<a name='1551'>
      )<a name='1552'>
      if(.not. grid%allocated .or. size_changed) then<a name='1553'>
         if(.not. grid%allocated) then<a name='1554'>
            call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_231">(1,'ensure_space_field: calling alloc_space_field because a grid was not allocated.')<a name='1555'>
         else<a name='1556'>
            if(size_changed) &amp;<a name='1557'>
                 call <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_232">(1,'ensure_space_field: deallocating and reallocating a grid because grid size changed.')<a name='1558'>
         end if<a name='1559'>
         if(grid%allocated) &amp;<a name='1560'>
              call <A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD'>dealloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOC_SPACE_FIELD_2">( grid )<a name='1561'>
         call <A href='../../html_code/frame/module_domain.F.html#ALLOC_SPACE_FIELD'>alloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#ENSURE_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ALLOC_SPACE_FIELD_4"> ( grid,   id, setinitval_in ,  tl_in , inter_domain_in , okay_to_alloc_in,  &amp;<a name='1562'>
                                  sd31, ed31, sd32, ed32, sd33, ed33, &amp;<a name='1563'>
                                  sm31 , em31 , sm32 , em32 , sm33 , em33 , &amp;<a name='1564'>
                                  sp31 , ep31 , sp32 , ep32 , sp33 , ep33 , &amp;<a name='1565'>
                                  sp31x, ep31x, sp32x, ep32x, sp33x, ep33x, &amp;<a name='1566'>
                                  sp31y, ep31y, sp32y, ep32y, sp33y, ep33y, &amp;<a name='1567'>
                                  sm31x, em31x, sm32x, em32x, sm33x, em33x, &amp;<a name='1568'>
                                  sm31y, em31y, sm32y, em32y, sm33y, em33y )<a name='1569'>
      end if<a name='1570'>
<a name='1571'>
   END SUBROUTINE ensure_space_field<a name='1572'>
<a name='1573'>
<font color=#447700>!  This routine is used to DEALLOCATE space for a single domain and remove <a name='1574'></font>
<font color=#447700>!  it from the linked list.  First the pointers in the linked list are fixed <a name='1575'></font>
<font color=#447700>!  (so the one in the middle can be removed).  Then the domain itself is <a name='1576'></font>
<font color=#447700>!  DEALLOCATEd via a call to domain_destroy().  <a name='1577'></font>
<a name='1578'>
<A NAME='DEALLOC_SPACE_DOMAIN'><A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1579'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>dealloc_space_domain</font> ( id ),<A href='../../call_from/DEALLOC_SPACE_DOMAIN.html' TARGET='index'>2</A><a name='1580'>
      <a name='1581'>
      IMPLICIT NONE<a name='1582'>
<a name='1583'>
      <font color=#447700>!  Input data.<a name='1584'></font>
<a name='1585'>
      INTEGER , INTENT(IN)            :: id<a name='1586'>
<a name='1587'>
      <font color=#447700>!  Local data.<a name='1588'></font>
<a name='1589'>
      TYPE(domain) , POINTER          :: grid<a name='1590'>
      LOGICAL                         :: found<a name='1591'>
<a name='1592'>
      <font color=#447700>!  Initializations required to start the routine.<a name='1593'></font>
<a name='1594'>
      grid =&gt; head_grid<a name='1595'>
      old_grid =&gt; head_grid<a name='1596'>
      found = .FALSE.<a name='1597'>
<a name='1598'>
      <font color=#447700>!  The identity of the domain to delete is based upon the "id".<a name='1599'></font>
      <font color=#447700>!  We search all of the possible grids.  It is required to find a domain<a name='1600'></font>
      <font color=#447700>!  otherwise it is a fatal error.  <a name='1601'></font>
<a name='1602'>
      find_grid : DO WHILE ( ASSOCIATED(grid) ) <a name='1603'>
         IF ( grid%id == id ) THEN<a name='1604'>
            found = .TRUE.<a name='1605'>
            old_grid%next =&gt; grid%next<a name='1606'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY'>domain_destroy</A><A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_DESTROY_1">( grid )<a name='1607'>
            EXIT find_grid<a name='1608'>
         END IF<a name='1609'>
         old_grid =&gt; grid<a name='1610'>
         grid     =&gt; grid%next<a name='1611'>
      END DO find_grid<a name='1612'>
<a name='1613'>
      IF ( .NOT. found ) THEN<a name='1614'>
         WRITE ( wrf_err_message , * ) 'module_domain: ', &amp;<a name='1615'>
           'dealloc_space_domain: Could not de-allocate grid id ',id<a name='1616'>
         CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_DOMAIN' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_220"> ( TRIM( wrf_err_message ) ) <a name='1617'>
      END IF<a name='1618'>
<a name='1619'>
   END SUBROUTINE dealloc_space_domain<a name='1620'>
<a name='1621'>
<a name='1622'>
<a name='1623'>
<font color=#447700>!  This routine is used to DEALLOCATE space for a single domain type.  <a name='1624'></font>
<font color=#447700>!  First, the field data are all removed through a CALL to the <a name='1625'></font>
<font color=#447700>!  dealloc_space_field routine.  Then the pointer to the domain<a name='1626'></font>
<font color=#447700>!  itself is DEALLOCATEd.<a name='1627'></font>
<a name='1628'>
<A NAME='DOMAIN_DESTROY'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1629'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_destroy</font> ( grid ) <A href='../../call_to/DOMAIN_DESTROY.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_DESTROY.html' TARGET='index'>4</A><a name='1630'>
      <a name='1631'>
      IMPLICIT NONE<a name='1632'>
<a name='1633'>
      <font color=#447700>!  Input data.<a name='1634'></font>
<a name='1635'>
      TYPE(domain) , POINTER          :: grid<a name='1636'>
<a name='1637'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD'>dealloc_space_field</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOC_SPACE_FIELD_3"> ( grid )<a name='1638'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DEALLOC_LINKED_LISTS'>dealloc_linked_lists</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DEALLOC_LINKED_LISTS_1">( grid )<a name='1639'>
      DEALLOCATE( grid%parents )<a name='1640'>
      DEALLOCATE( grid%nests )<a name='1641'>
      <font color=#447700>! clean up time manager bits<a name='1642'></font>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_DESTROY'>domain_clock_destroy</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_DESTROY_1">( grid )<a name='1643'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARMS_DESTROY'>domain_alarms_destroy</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_DESTROY' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_ALARMS_DESTROY_1">( grid )<a name='1644'>
      IF ( ASSOCIATED( grid%i_start ) ) THEN<a name='1645'>
        DEALLOCATE( grid%i_start ) <a name='1646'>
      ENDIF<a name='1647'>
      IF ( ASSOCIATED( grid%i_end ) ) THEN<a name='1648'>
        DEALLOCATE( grid%i_end )<a name='1649'>
      ENDIF<a name='1650'>
      IF ( ASSOCIATED( grid%j_start ) ) THEN<a name='1651'>
        DEALLOCATE( grid%j_start )<a name='1652'>
      ENDIF<a name='1653'>
      IF ( ASSOCIATED( grid%j_end ) ) THEN<a name='1654'>
        DEALLOCATE( grid%j_end )<a name='1655'>
      ENDIF<a name='1656'>
      IF ( ASSOCIATED( grid%itsloc ) ) THEN<a name='1657'>
        DEALLOCATE( grid%itsloc )<a name='1658'>
      ENDIF <a name='1659'>
      IF ( ASSOCIATED( grid%jtsloc ) ) THEN<a name='1660'>
        DEALLOCATE( grid%jtsloc )<a name='1661'>
      ENDIF <a name='1662'>
      IF ( ASSOCIATED( grid%id_tsloc ) ) THEN<a name='1663'>
        DEALLOCATE( grid%id_tsloc )<a name='1664'>
      ENDIF <a name='1665'>
      IF ( ASSOCIATED( grid%lattsloc ) ) THEN<a name='1666'>
        DEALLOCATE( grid%lattsloc )<a name='1667'>
      ENDIF <a name='1668'>
      IF ( ASSOCIATED( grid%lontsloc ) ) THEN<a name='1669'>
        DEALLOCATE( grid%lontsloc )<a name='1670'>
      ENDIF <a name='1671'>
      IF ( ASSOCIATED( grid%nametsloc ) ) THEN<a name='1672'>
        DEALLOCATE( grid%nametsloc )<a name='1673'>
      ENDIF <a name='1674'>
      IF ( ASSOCIATED( grid%desctsloc ) ) THEN<a name='1675'>
        DEALLOCATE( grid%desctsloc )<a name='1676'>
      ENDIF <a name='1677'>
      IF ( ASSOCIATED( grid%ts_filename ) ) THEN<a name='1678'>
        DEALLOCATE( grid%ts_filename )<a name='1679'>
      ENDIF <a name='1680'>
#if (EM_CORE == 1)<a name='1681'>
      IF ( ASSOCIATED( grid%track_time_in ) ) THEN<a name='1682'>
        DEALLOCATE( grid%track_time_in )<a name='1683'>
      ENDIF<a name='1684'>
 <a name='1685'>
      IF ( ASSOCIATED( grid%track_lat_in ) ) THEN<a name='1686'>
        DEALLOCATE( grid%track_lat_in )<a name='1687'>
      ENDIF<a name='1688'>
 <a name='1689'>
      IF ( ASSOCIATED( grid%track_lon_in ) ) THEN<a name='1690'>
        DEALLOCATE( grid%track_lon_in )<a name='1691'>
      ENDIF<a name='1692'>
 <a name='1693'>
      IF ( ASSOCIATED( grid%track_i ) ) THEN<a name='1694'>
        DEALLOCATE( grid%track_i )<a name='1695'>
      ENDIF<a name='1696'>
 <a name='1697'>
      IF ( ASSOCIATED( grid%track_j ) ) THEN<a name='1698'>
        DEALLOCATE( grid%track_j )<a name='1699'>
      ENDIF<a name='1700'>
<a name='1701'>
      IF ( ASSOCIATED( grid%track_time_domain ) ) THEN<a name='1702'>
        DEALLOCATE( grid%track_time_domain )<a name='1703'>
      ENDIF<a name='1704'>
 <a name='1705'>
      IF ( ASSOCIATED( grid%track_lat_domain ) ) THEN<a name='1706'>
        DEALLOCATE( grid%track_lat_domain )<a name='1707'>
      ENDIF<a name='1708'>
 <a name='1709'>
      IF ( ASSOCIATED( grid%track_lon_domain ) ) THEN<a name='1710'>
        DEALLOCATE( grid%track_lon_domain )<a name='1711'>
      ENDIF<a name='1712'>
#endif<a name='1713'>
      DEALLOCATE( grid )<a name='1714'>
      NULLIFY( grid )<a name='1715'>
<a name='1716'>
   END SUBROUTINE domain_destroy<a name='1717'>
<a name='1718'>
<A NAME='DEALLOC_LINKED_LISTS'><A href='../../html_code/frame/module_domain.F.html#DEALLOC_LINKED_LISTS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1719'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>dealloc_linked_lists</font> ( grid ) <A href='../../call_to/DEALLOC_LINKED_LISTS.html' TARGET='index'>1</A><a name='1720'>
      IMPLICIT NONE<a name='1721'>
      TYPE(domain), POINTER :: grid<a name='1722'>
      TYPE(fieldlist), POINTER :: p, q<a name='1723'>
      p =&gt; grid%head_statevars<a name='1724'>
      DO WHILE ( ASSOCIATED( p ) )<a name='1725'>
         q =&gt; p ; p =&gt; p%next ; DEALLOCATE(q)<a name='1726'>
      ENDDO<a name='1727'>
      NULLIFY(grid%head_statevars) ; NULLIFY( grid%tail_statevars)<a name='1728'>
#if (DA_CORE <font color=#447700>!= 1)<a name='1729'></font>
      IF ( .NOT. grid%is_intermediate ) THEN<a name='1730'>
        ALLOCATE( grid%head_statevars )<a name='1731'>
        NULLIFY( grid%head_statevars%next)<a name='1732'>
        grid%tail_statevars =&gt; grid%head_statevars<a name='1733'>
      ENDIF<a name='1734'>
#endif<a name='1735'>
   END SUBROUTINE dealloc_linked_lists<a name='1736'>
<a name='1737'>
<A NAME='SHOW_NEST_SUBTREE'><A href='../../html_code/frame/module_domain.F.html#SHOW_NEST_SUBTREE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1738'>
   RECURSIVE <font color=#993300>SUBROUTINE </font><font color=#cc0000>show_nest_subtree</font> ( grid ) <A href='../../call_to/SHOW_NEST_SUBTREE.html' TARGET='index'>1</A>,<A href='../../call_from/SHOW_NEST_SUBTREE.html' TARGET='index'>2</A><a name='1739'>
      TYPE(domain), POINTER :: grid<a name='1740'>
      INTEGER myid<a name='1741'>
      INTEGER kid<a name='1742'>
      IF ( .NOT. ASSOCIATED( grid ) ) RETURN<a name='1743'>
      myid = grid%id<a name='1744'>
      DO kid = 1, max_nests<a name='1745'>
        IF ( ASSOCIATED( grid%nests(kid)%ptr ) ) THEN<a name='1746'>
          IF ( grid%nests(kid)%ptr%id .EQ. myid ) THEN<a name='1747'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#SHOW_NEST_SUBTREE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_221">( 'show_nest_subtree: nest hierarchy corrupted' )<a name='1748'>
          ENDIF<a name='1749'>
          CALL <A href='../../html_code/frame/module_domain.F.html#SHOW_NEST_SUBTREE'>show_nest_subtree</A><A href='../../html_code/frame/module_domain.F.html#SHOW_NEST_SUBTREE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SHOW_NEST_SUBTREE_1">( grid%nests(kid)%ptr )<a name='1750'>
        ENDIF<a name='1751'>
      ENDDO<a name='1752'>
   END SUBROUTINE show_nest_subtree<a name='1753'>
   <a name='1754'>
<a name='1755'>
<font color=#447700>!<a name='1756'></font>
<a name='1757'>
<font color=#447700>!  This routine DEALLOCATEs each gridded field for this domain.  For each type of<a name='1758'></font>
<font color=#447700>!  different array (1d, 2d, 3d, etc.), the space for each pointer is DEALLOCATEd<a name='1759'></font>
<font color=#447700>!  for every -1 (i.e., each different meteorological field).<a name='1760'></font>
<a name='1761'>
<A NAME='DEALLOC_SPACE_FIELD'><A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1762'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>dealloc_space_field</font> ( grid ) <A href='../../call_to/DEALLOC_SPACE_FIELD.html' TARGET='index'>7</A><a name='1763'>
      <a name='1764'>
      IMPLICIT NONE<a name='1765'>
<a name='1766'>
      <font color=#447700>!  Input data.<a name='1767'></font>
<a name='1768'>
      TYPE(domain)              , POINTER :: grid<a name='1769'>
<a name='1770'>
      <font color=#447700>!  Local data.<a name='1771'></font>
<a name='1772'>
      INTEGER                             ::  ierr<a name='1773'>
<a name='1774'>
# include "<A href='../../html_code/include/deallocs.inc.html'>deallocs.inc</A>"<A NAME="deallocs.inc_2"><A href='../../html_code/frame/module_domain.F.html#DEALLOC_SPACE_FIELD' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><a name='1775'>
<a name='1776'>
   END SUBROUTINE dealloc_space_field<a name='1777'>
<a name='1778'>
<font color=#447700>!<a name='1779'></font>
<font color=#447700>!<a name='1780'></font>
<A NAME='FIND_GRID_BY_ID'><A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1781'>
   RECURSIVE <font color=#993300>SUBROUTINE </font><font color=#cc0000>find_grid_by_id</font> ( id, in_grid, result_grid ) <A href='../../call_to/FIND_GRID_BY_ID.html' TARGET='index'>7</A>,<A href='../../call_from/FIND_GRID_BY_ID.html' TARGET='index'>1</A><a name='1782'>
      IMPLICIT NONE<a name='1783'>
      INTEGER, INTENT(IN) :: id<a name='1784'>
      TYPE(domain), POINTER     :: in_grid <a name='1785'>
      TYPE(domain), POINTER     :: result_grid<a name='1786'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1787'></font>
<font color=#447700>! This is a recursive subroutine that traverses the domain hierarchy rooted<a name='1788'></font>
<font color=#447700>! at the input argument &lt;em&gt;in_grid&lt;/em&gt;, a pointer to TYPE(domain), and returns<a name='1789'></font>
<font color=#447700>! a pointer to the domain matching the integer argument &lt;em&gt;id&lt;/em&gt; if it exists.<a name='1790'></font>
<font color=#447700>!<a name='1791'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1792'></font>
      TYPE(domain), POINTER     :: grid_ptr<a name='1793'>
      INTEGER                   :: kid<a name='1794'>
      LOGICAL                   :: found<a name='1795'>
      found = .FALSE.<a name='1796'>
      NULLIFY(result_grid)<a name='1797'>
      IF ( ASSOCIATED( in_grid ) ) THEN<a name='1798'>
        IF ( in_grid%id .EQ. id ) THEN<a name='1799'>
           result_grid =&gt; in_grid<a name='1800'>
        ELSE<a name='1801'>
           grid_ptr =&gt; in_grid<a name='1802'>
           DO WHILE ( ASSOCIATED( grid_ptr ) .AND. .NOT. found )<a name='1803'>
              DO kid = 1, max_nests<a name='1804'>
                 IF ( ASSOCIATED( grid_ptr%nests(kid)%ptr ) .AND. .NOT. found ) THEN<a name='1805'>
                    CALL <A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID'>find_grid_by_id</A><A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_GRID_BY_ID_3"> ( id, grid_ptr%nests(kid)%ptr, result_grid )<a name='1806'>
                    IF ( ASSOCIATED( result_grid ) ) THEN<a name='1807'>
                      IF ( result_grid%id .EQ. id ) found = .TRUE.<a name='1808'>
                    ENDIF<a name='1809'>
                 ENDIF<a name='1810'>
              ENDDO<a name='1811'>
              IF ( .NOT. found ) grid_ptr =&gt; grid_ptr%sibling<a name='1812'>
           ENDDO<a name='1813'>
        ENDIF<a name='1814'>
      ENDIF<a name='1815'>
      RETURN<a name='1816'>
   END SUBROUTINE find_grid_by_id<a name='1817'>
<a name='1818'>
<a name='1819'>
<A NAME='FIRST_LOC_INTEGER'><A href='../../html_code/frame/module_domain.F.html#FIRST_LOC_INTEGER' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1820'>
   <font color=#993300>FUNCTION </font><font color=#cc0000>first_loc_integer</font> ( array , search ) RESULT ( loc ) <a name='1821'>
 <a name='1822'>
      IMPLICIT NONE<a name='1823'>
<a name='1824'>
      <font color=#447700>!  Input data.<a name='1825'></font>
<a name='1826'>
      INTEGER , INTENT(IN) , DIMENSION(:) :: array<a name='1827'>
      INTEGER , INTENT(IN)                :: search<a name='1828'>
<a name='1829'>
      <font color=#447700>!  Output data.<a name='1830'></font>
<a name='1831'>
      INTEGER                             :: loc<a name='1832'>
<a name='1833'>
<font color=#447700>!&lt;DESCRIPTION&gt;<a name='1834'></font>
<font color=#447700>!  This routine is used to find a specific domain identifier in an array<a name='1835'></font>
<font color=#447700>!  of domain identifiers.<a name='1836'></font>
<font color=#447700>!<a name='1837'></font>
<font color=#447700>!&lt;/DESCRIPTION&gt;<a name='1838'></font>
      <a name='1839'>
      <font color=#447700>!  Local data.<a name='1840'></font>
<a name='1841'>
      INTEGER :: loop<a name='1842'>
<a name='1843'>
      loc = -1<a name='1844'>
      find : DO loop = 1 , SIZE(array)<a name='1845'>
         IF ( search == array(loop) ) THEN         <a name='1846'>
            loc = loop<a name='1847'>
            EXIT find<a name='1848'>
         END IF<a name='1849'>
      END DO find<a name='1850'>
<a name='1851'>
   END FUNCTION first_loc_integer<a name='1852'>
<font color=#447700>!<a name='1853'></font>
<A NAME='INIT_MODULE_DOMAIN'><A href='../../html_code/frame/module_domain.F.html#INIT_MODULE_DOMAIN' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1854'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>init_module_domain</font> <A href='../../call_to/INIT_MODULE_DOMAIN.html' TARGET='index'>2</A><a name='1855'>
   END SUBROUTINE init_module_domain<a name='1856'>
<a name='1857'>
<a name='1858'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1859'></font>
<font color=#447700>!<a name='1860'></font>
<font color=#447700>! The following routines named domain_*() are convenience routines that <a name='1861'></font>
<font color=#447700>! eliminate many duplicated bits of code.  They provide shortcuts for the <a name='1862'></font>
<font color=#447700>! most common operations on the domain_clock field of TYPE(domain).  <a name='1863'></font>
<font color=#447700>!<a name='1864'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1865'></font>
<a name='1866'>
<A NAME='DOMAIN_GET_CURRENT_TIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_CURRENT_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1867'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_current_time</font> ( grid ) RESULT ( current_time )  <A href='../../call_to/DOMAIN_GET_CURRENT_TIME.html' TARGET='index'>3</A>,<A href='../../call_from/DOMAIN_GET_CURRENT_TIME.html' TARGET='index'>1</A><a name='1868'>
        IMPLICIT NONE<a name='1869'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1870'></font>
<font color=#447700>! This convenience function returns the current time for domain grid.  <a name='1871'></font>
<font color=#447700>!<a name='1872'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1873'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='1874'>
        <font color=#447700>! result<a name='1875'></font>
        TYPE(WRFU_Time) :: current_time<a name='1876'>
        <font color=#447700>! locals<a name='1877'></font>
        INTEGER :: rc<a name='1878'>
        CALL WRFU_ClockGet( grid%domain_clock, CurrTime=current_time, &amp;<a name='1879'>
                            rc=rc )<a name='1880'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='1881'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_CURRENT_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_222"> ( &amp;<a name='1882'>
            'domain_get_current_time:  WRFU_ClockGet failed' )<a name='1883'>
        ENDIF<a name='1884'>
      END FUNCTION domain_get_current_time<a name='1885'>
<a name='1886'>
<a name='1887'>
<A NAME='DOMAIN_GET_START_TIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_START_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1888'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_start_time</font> ( grid ) RESULT ( start_time ) ,<A href='../../call_from/DOMAIN_GET_START_TIME.html' TARGET='index'>1</A><a name='1889'>
        IMPLICIT NONE<a name='1890'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1891'></font>
<font color=#447700>! This convenience function returns the start time for domain grid.  <a name='1892'></font>
<font color=#447700>!<a name='1893'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1894'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='1895'>
        <font color=#447700>! result<a name='1896'></font>
        TYPE(WRFU_Time) :: start_time<a name='1897'>
        <font color=#447700>! locals<a name='1898'></font>
        INTEGER :: rc<a name='1899'>
        CALL WRFU_ClockGet( grid%domain_clock, StartTime=start_time, &amp;<a name='1900'>
                            rc=rc )<a name='1901'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='1902'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_START_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_223"> ( &amp;<a name='1903'>
            'domain_get_start_time:  WRFU_ClockGet failed' )<a name='1904'>
        ENDIF<a name='1905'>
      END FUNCTION domain_get_start_time<a name='1906'>
<a name='1907'>
<a name='1908'>
<A NAME='DOMAIN_GET_STOP_TIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_STOP_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1909'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_stop_time</font> ( grid ) RESULT ( stop_time )  <A href='../../call_to/DOMAIN_GET_STOP_TIME.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_GET_STOP_TIME.html' TARGET='index'>1</A><a name='1910'>
        IMPLICIT NONE<a name='1911'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1912'></font>
<font color=#447700>! This convenience function returns the stop time for domain grid.  <a name='1913'></font>
<font color=#447700>!<a name='1914'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1915'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='1916'>
        <font color=#447700>! result<a name='1917'></font>
        TYPE(WRFU_Time) :: stop_time<a name='1918'>
        <font color=#447700>! locals<a name='1919'></font>
        INTEGER :: rc<a name='1920'>
        CALL WRFU_ClockGet( grid%domain_clock, StopTime=stop_time, &amp;<a name='1921'>
                            rc=rc )<a name='1922'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='1923'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_STOP_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_224"> ( &amp;<a name='1924'>
            'domain_get_stop_time:  WRFU_ClockGet failed' )<a name='1925'>
        ENDIF<a name='1926'>
      END FUNCTION domain_get_stop_time<a name='1927'>
<a name='1928'>
<a name='1929'>
<A NAME='DOMAIN_GET_TIME_STEP'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_STEP' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1930'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_time_step</font> ( grid ) RESULT ( time_step )  <A href='../../call_to/DOMAIN_GET_TIME_STEP.html' TARGET='index'>3</A>,<A href='../../call_from/DOMAIN_GET_TIME_STEP.html' TARGET='index'>1</A><a name='1931'>
        IMPLICIT NONE<a name='1932'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1933'></font>
<font color=#447700>! This convenience function returns the time step for domain grid.  <a name='1934'></font>
<font color=#447700>!<a name='1935'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1936'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='1937'>
        <font color=#447700>! result<a name='1938'></font>
        TYPE(WRFU_TimeInterval) :: time_step<a name='1939'>
        <font color=#447700>! locals<a name='1940'></font>
        INTEGER :: rc<a name='1941'>
        CALL WRFU_ClockGet( grid%domain_clock, timeStep=time_step, &amp;<a name='1942'>
                            rc=rc )<a name='1943'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='1944'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_225"> ( &amp;<a name='1945'>
            'domain_get_time_step:  WRFU_ClockGet failed' )<a name='1946'>
        ENDIF<a name='1947'>
      END FUNCTION domain_get_time_step<a name='1948'>
<a name='1949'>
<a name='1950'>
<A NAME='DOMAIN_GET_ADVANCECOUNT'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_ADVANCECOUNT' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='1951'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_advanceCount</font> ( grid ) RESULT ( advanceCount ) ,<A href='../../call_from/DOMAIN_GET_ADVANCECOUNT.html' TARGET='index'>1</A><a name='1952'>
        IMPLICIT NONE<a name='1953'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1954'></font>
<font color=#447700>! This convenience function returns the time step for domain grid.  <a name='1955'></font>
<font color=#447700>! Also converts from INTEGER(WRFU_KIND_I8) to INTEGER.  <a name='1956'></font>
<font color=#447700>!<a name='1957'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1958'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='1959'>
        <font color=#447700>! result<a name='1960'></font>
        INTEGER :: advanceCount<a name='1961'>
        <font color=#447700>! locals<a name='1962'></font>
        INTEGER(WRFU_KIND_I8) :: advanceCountLcl<a name='1963'>
        INTEGER :: rc<a name='1964'>
        CALL WRFU_ClockGet( grid%domain_clock, &amp;<a name='1965'>
                            advanceCount=advanceCountLcl, &amp;<a name='1966'>
                            rc=rc )<a name='1967'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='1968'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_ADVANCECOUNT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_226"> ( &amp;<a name='1969'>
            'domain_get_advanceCount:  WRFU_ClockGet failed' )<a name='1970'>
        ENDIF<a name='1971'>
        advanceCount = advanceCountLcl<a name='1972'>
      END FUNCTION domain_get_advanceCount<a name='1973'>
<a name='1974'>
<a name='1975'>
<A NAME='DOMAIN_ALARMS_DESTROY'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARMS_DESTROY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='1976'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_alarms_destroy</font> ( grid ) <A href='../../call_to/DOMAIN_ALARMS_DESTROY.html' TARGET='index'>1</A><a name='1977'>
        IMPLICIT NONE<a name='1978'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='1979'></font>
<font color=#447700>! This convenience routine destroys and deallocates all alarms associated <a name='1980'></font>
<font color=#447700>! with grid.  <a name='1981'></font>
<font color=#447700>!<a name='1982'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='1983'></font>
        TYPE(domain), INTENT(INOUT) :: grid<a name='1984'>
        <font color=#447700>!  Local data.<a name='1985'></font>
        INTEGER                     :: alarmid<a name='1986'>
<a name='1987'>
        IF ( ASSOCIATED( grid%alarms ) .AND. &amp;<a name='1988'>
             ASSOCIATED( grid%alarms_created ) ) THEN<a name='1989'>
          DO alarmid = 1, MAX_WRF_ALARMS<a name='1990'>
            IF ( grid%alarms_created( alarmid ) ) THEN<a name='1991'>
              CALL WRFU_AlarmDestroy( grid%alarms( alarmid ) )<a name='1992'>
              grid%alarms_created( alarmid ) = .FALSE.<a name='1993'>
            ENDIF<a name='1994'>
          ENDDO<a name='1995'>
          DEALLOCATE( grid%alarms )<a name='1996'>
          NULLIFY( grid%alarms )<a name='1997'>
          DEALLOCATE( grid%alarms_created )<a name='1998'>
          NULLIFY( grid%alarms_created )<a name='1999'>
        ENDIF<a name='2000'>
      END SUBROUTINE domain_alarms_destroy<a name='2001'>
<a name='2002'>
<a name='2003'>
<A NAME='DOMAIN_CLOCK_DESTROY'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_DESTROY' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2004'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clock_destroy</font> ( grid ) <A href='../../call_to/DOMAIN_CLOCK_DESTROY.html' TARGET='index'>1</A><a name='2005'>
        IMPLICIT NONE<a name='2006'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2007'></font>
<font color=#447700>! This convenience routine destroys and deallocates the domain clock.  <a name='2008'></font>
<font color=#447700>!<a name='2009'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2010'></font>
        TYPE(domain), INTENT(INOUT) :: grid<a name='2011'>
        IF ( ASSOCIATED( grid%domain_clock ) ) THEN<a name='2012'>
          IF ( grid%domain_clock_created ) THEN<a name='2013'>
            CALL WRFU_ClockDestroy( grid%domain_clock )<a name='2014'>
            grid%domain_clock_created = .FALSE.<a name='2015'>
          ENDIF<a name='2016'>
          DEALLOCATE( grid%domain_clock )<a name='2017'>
          NULLIFY( grid%domain_clock )<a name='2018'>
        ENDIF<a name='2019'>
      END SUBROUTINE domain_clock_destroy<a name='2020'>
<a name='2021'>
<a name='2022'>
<A NAME='DOMAIN_LAST_TIME_STEP'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_LAST_TIME_STEP' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2023'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_last_time_step</font> ( grid ) RESULT ( LAST_TIME )  <A href='../../call_to/DOMAIN_LAST_TIME_STEP.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_LAST_TIME_STEP.html' TARGET='index'>1</A><a name='2024'>
        IMPLICIT NONE<a name='2025'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2026'></font>
<font color=#447700>! This convenience function returns .TRUE. if this is the last time <a name='2027'></font>
<font color=#447700>! step for domain grid.  Thanks to Tom Black.  <a name='2028'></font>
<font color=#447700>!<a name='2029'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2030'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2031'>
        <font color=#447700>! result<a name='2032'></font>
        LOGICAL :: LAST_TIME<a name='2033'>
        LAST_TIME =   <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_STOP_TIME'>domain_get_stop_time</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_LAST_TIME_STEP' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_STOP_TIME_1">( grid ) .EQ. &amp;<a name='2034'>
                    ( domain_get_current_time( grid ) + &amp;<a name='2035'>
                      domain_get_time_step( grid ) )<a name='2036'>
      END FUNCTION domain_last_time_step<a name='2037'>
<a name='2038'>
<a name='2039'>
<a name='2040'>
<A NAME='DOMAIN_CLOCKISSTOPTIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTOPTIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2041'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_clockisstoptime</font> ( grid ) RESULT ( is_stop_time )  <A href='../../call_to/DOMAIN_CLOCKISSTOPTIME.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_CLOCKISSTOPTIME.html' TARGET='index'>1</A><a name='2042'>
        IMPLICIT NONE<a name='2043'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2044'></font>
<font color=#447700>! This convenience function returns .TRUE. iff grid%clock has reached its <a name='2045'></font>
<font color=#447700>! stop time.  <a name='2046'></font>
<font color=#447700>!<a name='2047'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2048'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2049'>
        <font color=#447700>! result<a name='2050'></font>
        LOGICAL :: is_stop_time<a name='2051'>
        INTEGER :: rc<a name='2052'>
        is_stop_time = WRFU_ClockIsStopTime( grid%domain_clock , rc=rc )<a name='2053'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2054'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTOPTIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_227"> ( &amp;<a name='2055'>
            'domain_clockisstoptime:  WRFU_ClockIsStopTime() failed' )<a name='2056'>
        ENDIF<a name='2057'>
      END FUNCTION domain_clockisstoptime<a name='2058'>
<a name='2059'>
<a name='2060'>
<a name='2061'>
<A NAME='DOMAIN_CLOCKISSTOPSUBTIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTOPSUBTIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2062'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_clockisstopsubtime</font> ( grid ) RESULT ( is_stop_subtime ) ,<A href='../../call_from/DOMAIN_CLOCKISSTOPSUBTIME.html' TARGET='index'>1</A><a name='2063'>
        IMPLICIT NONE<a name='2064'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2065'></font>
<font color=#447700>! This convenience function returns .TRUE. iff grid%clock has reached its <a name='2066'></font>
<font color=#447700>! grid%stop_subtime.  <a name='2067'></font>
<font color=#447700>!<a name='2068'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2069'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2070'>
        <font color=#447700>! result<a name='2071'></font>
        LOGICAL :: is_stop_subtime<a name='2072'>
        INTEGER :: rc<a name='2073'>
        TYPE(WRFU_TimeInterval) :: timeStep<a name='2074'>
        TYPE(WRFU_Time) :: currentTime<a name='2075'>
        LOGICAL :: positive_timestep<a name='2076'>
        is_stop_subtime = .FALSE.<a name='2077'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTOPSUBTIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_13">( grid, time_step=timeStep, &amp;<a name='2078'>
                                     current_time=currentTime )<a name='2079'>
        positive_timestep = ESMF_TimeIntervalIsPositive( timeStep )<a name='2080'>
        IF ( positive_timestep ) THEN<a name='2081'>
<font color=#447700>! hack for bug in PGI 5.1-x<a name='2082'></font>
<font color=#447700>!        IF ( currentTime .GE. grid%stop_subtime ) THEN<a name='2083'></font>
          IF ( ESMF_TimeGE( currentTime, grid%stop_subtime ) ) THEN<a name='2084'>
            is_stop_subtime = .TRUE.<a name='2085'>
          ENDIF<a name='2086'>
        ELSE<a name='2087'>
<font color=#447700>! hack for bug in PGI 5.1-x<a name='2088'></font>
<font color=#447700>!        IF ( currentTime .LE. grid%stop_subtime ) THEN<a name='2089'></font>
          IF ( ESMF_TimeLE( currentTime, grid%stop_subtime ) ) THEN<a name='2090'>
            is_stop_subtime = .TRUE.<a name='2091'>
          ENDIF<a name='2092'>
        ENDIF<a name='2093'>
      END FUNCTION domain_clockisstopsubtime<a name='2094'>
<a name='2095'>
<a name='2096'>
<a name='2097'>
<a name='2098'>
<A NAME='DOMAIN_GET_SIM_START_TIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_SIM_START_TIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2099'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_sim_start_time</font> ( grid ) RESULT ( simulationStartTime )  <A href='../../call_to/DOMAIN_GET_SIM_START_TIME.html' TARGET='index'>3</A>,<A href='../../call_from/DOMAIN_GET_SIM_START_TIME.html' TARGET='index'>1</A><a name='2100'>
        IMPLICIT NONE<a name='2101'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2102'></font>
<font color=#447700>! This convenience routine returns simulation start time for domain grid as <a name='2103'></font>
<font color=#447700>! a time instant.  <a name='2104'></font>
<font color=#447700>!<a name='2105'></font>
<font color=#447700>! If this is not a restart run, the start_time of head_grid%clock is returned <a name='2106'></font>
<font color=#447700>! instead.  <a name='2107'></font>
<font color=#447700>!<a name='2108'></font>
<font color=#447700>! Note that simulation start time remains constant through restarts while <a name='2109'></font>
<font color=#447700>! the start_time of head_grid%clock always refers to the start time of the <a name='2110'></font>
<font color=#447700>! current run (restart or otherwise).  <a name='2111'></font>
<font color=#447700>!<a name='2112'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2113'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2114'>
        <font color=#447700>! result<a name='2115'></font>
        TYPE(WRFU_Time) :: simulationStartTime<a name='2116'>
        <font color=#447700>! Locals<a name='2117'></font>
        INTEGER :: rc<a name='2118'>
        INTEGER :: simulation_start_year,   simulation_start_month, &amp;<a name='2119'>
                   simulation_start_day,    simulation_start_hour , &amp;<a name='2120'>
                   simulation_start_minute, simulation_start_second<a name='2121'>
        CALL nl_get_simulation_start_year   ( 1, simulation_start_year   )<a name='2122'>
        CALL nl_get_simulation_start_month  ( 1, simulation_start_month  )<a name='2123'>
        CALL nl_get_simulation_start_day    ( 1, simulation_start_day    )<a name='2124'>
        CALL nl_get_simulation_start_hour   ( 1, simulation_start_hour   )<a name='2125'>
        CALL nl_get_simulation_start_minute ( 1, simulation_start_minute )<a name='2126'>
        CALL nl_get_simulation_start_second ( 1, simulation_start_second )<a name='2127'>
        CALL WRFU_TimeSet( simulationStartTime,       &amp;<a name='2128'>
                           YY=simulation_start_year,  &amp;<a name='2129'>
                           MM=simulation_start_month, &amp;<a name='2130'>
                           DD=simulation_start_day,   &amp;<a name='2131'>
                           H=simulation_start_hour,   &amp;<a name='2132'>
                           M=simulation_start_minute, &amp;<a name='2133'>
                           S=simulation_start_second, &amp;<a name='2134'>
                           rc=rc )<a name='2135'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2136'>
          CALL nl_get_start_year   ( 1, simulation_start_year   )<a name='2137'>
          CALL nl_get_start_month  ( 1, simulation_start_month  )<a name='2138'>
          CALL nl_get_start_day    ( 1, simulation_start_day    )<a name='2139'>
          CALL nl_get_start_hour   ( 1, simulation_start_hour   )<a name='2140'>
          CALL nl_get_start_minute ( 1, simulation_start_minute )<a name='2141'>
          CALL nl_get_start_second ( 1, simulation_start_second )<a name='2142'>
          CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_SIM_START_TIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_233">( 150, "WARNING:  domain_get_sim_start_time using head_grid start time from namelist" )<a name='2143'>
          CALL WRFU_TimeSet( simulationStartTime,       &amp;<a name='2144'>
                             YY=simulation_start_year,  &amp;<a name='2145'>
                             MM=simulation_start_month, &amp;<a name='2146'>
                             DD=simulation_start_day,   &amp;<a name='2147'>
                             H=simulation_start_hour,   &amp;<a name='2148'>
                             M=simulation_start_minute, &amp;<a name='2149'>
                             S=simulation_start_second, &amp;<a name='2150'>
                             rc=rc )<a name='2151'>
        ENDIF<a name='2152'>
        RETURN<a name='2153'>
      END FUNCTION domain_get_sim_start_time<a name='2154'>
<a name='2155'>
<A NAME='DOMAIN_GET_TIME_SINCE_SIM_START'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_SINCE_SIM_START' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2156'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_get_time_since_sim_start</font> ( grid ) RESULT ( time_since_sim_start )  <A href='../../call_to/DOMAIN_GET_TIME_SINCE_SIM_START.html' TARGET='index'>3</A>,<A href='../../call_from/DOMAIN_GET_TIME_SINCE_SIM_START.html' TARGET='index'>1</A><a name='2157'>
        IMPLICIT NONE<a name='2158'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2159'></font>
<font color=#447700>! This convenience function returns the time elapsed since start of <a name='2160'></font>
<font color=#447700>! simulation for domain grid.  <a name='2161'></font>
<font color=#447700>!<a name='2162'></font>
<font color=#447700>! Note that simulation start time remains constant through restarts while <a name='2163'></font>
<font color=#447700>! the start_time of grid%clock always refers to the start time of the <a name='2164'></font>
<font color=#447700>! current run (restart or otherwise).  <a name='2165'></font>
<font color=#447700>!<a name='2166'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2167'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2168'>
        <font color=#447700>! result<a name='2169'></font>
        TYPE(WRFU_TimeInterval) :: time_since_sim_start<a name='2170'>
        <font color=#447700>! locals<a name='2171'></font>
        TYPE(WRFU_Time) :: lcl_currtime, lcl_simstarttime<a name='2172'>
        lcl_simstarttime = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_SIM_START_TIME'>domain_get_sim_start_time</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_SINCE_SIM_START' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_SIM_START_TIME_1">( grid )<a name='2173'>
        lcl_currtime = domain_get_current_time ( grid )<a name='2174'>
        time_since_sim_start = lcl_currtime - lcl_simstarttime<a name='2175'>
      END FUNCTION domain_get_time_since_sim_start<a name='2176'>
<a name='2177'>
<a name='2178'>
<a name='2179'>
<a name='2180'>
<A NAME='DOMAIN_CLOCK_GET'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2181'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clock_get</font>( grid, current_time,                &amp; <A href='../../call_to/DOMAIN_CLOCK_GET.html' TARGET='index'>85</A>,<A href='../../call_from/DOMAIN_CLOCK_GET.html' TARGET='index'>14</A><a name='2182'>
                                         current_timestr,             &amp;<a name='2183'>
                                         current_timestr_frac,        &amp;<a name='2184'>
                                         start_time, start_timestr,   &amp;<a name='2185'>
                                         stop_time, stop_timestr,     &amp;<a name='2186'>
                                         time_step, time_stepstr,     &amp;<a name='2187'>
                                         time_stepstr_frac,           &amp;<a name='2188'>
                                         advanceCount,                &amp;<a name='2189'>
                                         currentDayOfYearReal,        &amp;<a name='2190'>
                                         minutesSinceSimulationStart, &amp;<a name='2191'>
                                         timeSinceSimulationStart,    &amp;<a name='2192'>
                                         simulationStartTime,         &amp;<a name='2193'>
                                         simulationStartTimeStr )<a name='2194'>
        IMPLICIT NONE<a name='2195'>
        TYPE(domain),            INTENT(IN)              :: grid<a name='2196'>
        TYPE(WRFU_Time),         INTENT(  OUT), OPTIONAL :: current_time<a name='2197'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: current_timestr<a name='2198'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: current_timestr_frac<a name='2199'>
        TYPE(WRFU_Time),         INTENT(  OUT), OPTIONAL :: start_time<a name='2200'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: start_timestr<a name='2201'>
        TYPE(WRFU_Time),         INTENT(  OUT), OPTIONAL :: stop_time<a name='2202'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: stop_timestr<a name='2203'>
        TYPE(WRFU_TimeInterval), INTENT(  OUT), OPTIONAL :: time_step<a name='2204'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: time_stepstr<a name='2205'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: time_stepstr_frac<a name='2206'>
        INTEGER,                 INTENT(  OUT), OPTIONAL :: advanceCount<a name='2207'>
        <font color=#447700>! currentDayOfYearReal = 0.0 at 0Z on 1 January, 0.5 at 12Z on <a name='2208'></font>
        <font color=#447700>! 1 January, etc.<a name='2209'></font>
        REAL,                    INTENT(  OUT), OPTIONAL :: currentDayOfYearReal<a name='2210'>
        <font color=#447700>! Time at which simulation started.  If this is not a restart run, <a name='2211'></font>
        <font color=#447700>! start_time is returned instead.  <a name='2212'></font>
        TYPE(WRFU_Time),         INTENT(  OUT), OPTIONAL :: simulationStartTime<a name='2213'>
        CHARACTER (LEN=*),       INTENT(  OUT), OPTIONAL :: simulationStartTimeStr<a name='2214'>
        <font color=#447700>! time interval since start of simulation, includes effects of <a name='2215'></font>
        <font color=#447700>! restarting even when restart uses a different timestep<a name='2216'></font>
        TYPE(WRFU_TimeInterval), INTENT(  OUT), OPTIONAL :: timeSinceSimulationStart<a name='2217'>
        <font color=#447700>! minutes since simulation start date<a name='2218'></font>
        REAL,                    INTENT(  OUT), OPTIONAL :: minutesSinceSimulationStart<a name='2219'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2220'></font>
<font color=#447700>! This convenience routine returns clock information for domain grid in <a name='2221'></font>
<font color=#447700>! various forms.  The caller is responsible for ensuring that character <a name='2222'></font>
<font color=#447700>! string actual arguments are big enough.  <a name='2223'></font>
<font color=#447700>!<a name='2224'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2225'></font>
        <font color=#447700>! Locals<a name='2226'></font>
        TYPE(WRFU_Time) :: lcl_currtime, lcl_stoptime, lcl_starttime<a name='2227'>
        TYPE(WRFU_Time) :: lcl_simulationStartTime<a name='2228'>
        TYPE(WRFU_TimeInterval) :: lcl_time_step, lcl_timeSinceSimulationStart<a name='2229'>
        INTEGER :: days, seconds, Sn, Sd, rc<a name='2230'>
        CHARACTER (LEN=256) :: tmp_str<a name='2231'>
        CHARACTER (LEN=256) :: frac_str<a name='2232'>
        REAL(WRFU_KIND_R8) :: currentDayOfYearR8<a name='2233'>
        IF ( PRESENT( start_time ) ) THEN<a name='2234'>
          start_time = domain_get_start_time ( grid )<a name='2235'>
        ENDIF<a name='2236'>
        IF ( PRESENT( start_timestr ) ) THEN<a name='2237'>
          lcl_starttime = domain_get_start_time ( grid )<a name='2238'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_1"> ( lcl_starttime, start_timestr )<a name='2239'>
        ENDIF<a name='2240'>
        IF ( PRESENT( time_step ) ) THEN<a name='2241'>
          time_step = domain_get_time_step ( grid )<a name='2242'>
        ENDIF<a name='2243'>
        IF ( PRESENT( time_stepstr ) ) THEN<a name='2244'>
          lcl_time_step = domain_get_time_step ( grid )<a name='2245'>
          CALL WRFU_TimeIntervalGet( lcl_time_step, &amp;<a name='2246'>
                                     timeString=time_stepstr, rc=rc )<a name='2247'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2248'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_228"> ( &amp;<a name='2249'>
              'domain_clock_get:  WRFU_TimeIntervalGet() failed' )<a name='2250'>
          ENDIF<a name='2251'>
        ENDIF<a name='2252'>
        IF ( PRESENT( time_stepstr_frac ) ) THEN<a name='2253'>
          lcl_time_step = domain_get_time_step ( grid )<a name='2254'>
          CALL WRFU_TimeIntervalGet( lcl_time_step, timeString=tmp_str, &amp;<a name='2255'>
                                     Sn=Sn, Sd=Sd, rc=rc )<a name='2256'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2257'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_229"> ( &amp;<a name='2258'>
              'domain_clock_get:  WRFU_TimeIntervalGet() failed' )<a name='2259'>
          ENDIF<a name='2260'>
          CALL fraction_to_string( Sn, Sd, frac_str )<a name='2261'>
          time_stepstr_frac = TRIM(tmp_str)//TRIM(frac_str)<a name='2262'>
        ENDIF<a name='2263'>
        IF ( PRESENT( advanceCount ) ) THEN<a name='2264'>
          advanceCount = domain_get_advanceCount ( grid )<a name='2265'>
        ENDIF<a name='2266'>
        <font color=#447700>! This duplication avoids assignment of time-manager objects <a name='2267'></font>
        <font color=#447700>! which works now in ESMF 2.2.0 but may not work in the future <a name='2268'></font>
        <font color=#447700>! if these objects become "deep".  We have already been bitten <a name='2269'></font>
        <font color=#447700>! by this when the clock objects were changed from "shallow" to <a name='2270'></font>
        <font color=#447700>! "deep".  Once again, adherence to orthodox canonical form by <a name='2271'></font>
        <font color=#447700>! ESMF would avoid all this crap.  <a name='2272'></font>
        IF ( PRESENT( current_time ) ) THEN<a name='2273'>
          current_time = domain_get_current_time ( grid )<a name='2274'>
        ENDIF<a name='2275'>
        IF ( PRESENT( current_timestr ) ) THEN<a name='2276'>
          lcl_currtime = domain_get_current_time ( grid )<a name='2277'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_2"> ( lcl_currtime, current_timestr )<a name='2278'>
        ENDIF<a name='2279'>
        <font color=#447700>! current time string including fractional part, if present<a name='2280'></font>
        IF ( PRESENT( current_timestr_frac ) ) THEN<a name='2281'>
          lcl_currtime = domain_get_current_time ( grid )<a name='2282'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_3"> ( lcl_currtime, tmp_str )<a name='2283'>
          CALL WRFU_TimeGet( lcl_currtime, Sn=Sn, Sd=Sd, rc=rc )<a name='2284'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2285'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_230"> ( &amp;<a name='2286'>
              'domain_clock_get:  WRFU_TimeGet() failed' )<a name='2287'>
          ENDIF<a name='2288'>
          CALL fraction_to_string( Sn, Sd, frac_str )<a name='2289'>
          current_timestr_frac = TRIM(tmp_str)//TRIM(frac_str)<a name='2290'>
        ENDIF<a name='2291'>
        IF ( PRESENT( stop_time ) ) THEN<a name='2292'>
          stop_time = domain_get_stop_time ( grid )<a name='2293'>
        ENDIF<a name='2294'>
        IF ( PRESENT( stop_timestr ) ) THEN<a name='2295'>
          lcl_stoptime = domain_get_stop_time ( grid )<a name='2296'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_4"> ( lcl_stoptime, stop_timestr )<a name='2297'>
        ENDIF<a name='2298'>
        IF ( PRESENT( currentDayOfYearReal ) ) THEN<a name='2299'>
          lcl_currtime = domain_get_current_time ( grid )<a name='2300'>
          CALL WRFU_TimeGet( lcl_currtime, dayOfYear_r8=currentDayOfYearR8, &amp;<a name='2301'>
                             rc=rc )<a name='2302'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2303'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_231"> ( &amp;<a name='2304'>
                   'domain_clock_get:  WRFU_TimeGet(dayOfYear_r8) failed' )<a name='2305'>
          ENDIF<a name='2306'>
          currentDayOfYearReal = REAL( currentDayOfYearR8 ) - 1.0<a name='2307'>
        ENDIF<a name='2308'>
        IF ( PRESENT( simulationStartTime ) ) THEN<a name='2309'>
          simulationStartTime = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_SIM_START_TIME'>domain_get_sim_start_time</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_SIM_START_TIME_2">( grid )<a name='2310'>
        ENDIF<a name='2311'>
        IF ( PRESENT( simulationStartTimeStr ) ) THEN<a name='2312'>
          lcl_simulationStartTime = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_SIM_START_TIME'>domain_get_sim_start_time</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_SIM_START_TIME_3">( grid )<a name='2313'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_TIMETOA'>wrf_timetoa</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_TIMETOA_5"> ( lcl_simulationStartTime, simulationStartTimeStr )<a name='2314'>
        ENDIF<a name='2315'>
        IF ( PRESENT( timeSinceSimulationStart ) ) THEN<a name='2316'>
          timeSinceSimulationStart = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_SINCE_SIM_START'>domain_get_time_since_sim_start</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_TIME_SINCE_SIM_START_2">( grid )<a name='2317'>
        ENDIF<a name='2318'>
        IF ( PRESENT( minutesSinceSimulationStart ) ) THEN<a name='2319'>
          lcl_timeSinceSimulationStart = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_GET_TIME_SINCE_SIM_START'>domain_get_time_since_sim_start</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_GET_TIME_SINCE_SIM_START_3">( grid )<a name='2320'>
          CALL WRFU_TimeIntervalGet( lcl_timeSinceSimulationStart, &amp;<a name='2321'>
                                     D=days, S=seconds, Sn=Sn, Sd=Sd, rc=rc )<a name='2322'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2323'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_232"> ( &amp;<a name='2324'>
                   'domain_clock_get:  WRFU_TimeIntervalGet() failed' )<a name='2325'>
          ENDIF<a name='2326'>
          <font color=#447700>! get rid of hard-coded constants<a name='2327'></font>
          minutesSinceSimulationStart = ( REAL( days ) * 24. * 60. ) + &amp;<a name='2328'>
                                        ( REAL( seconds ) / 60. )<a name='2329'>
          IF ( Sd /= 0 ) THEN<a name='2330'>
            minutesSinceSimulationStart = minutesSinceSimulationStart + &amp;<a name='2331'>
                                          ( ( REAL( Sn ) / REAL( Sd ) ) / 60. )<a name='2332'>
          ENDIF<a name='2333'>
        ENDIF<a name='2334'>
        RETURN<a name='2335'>
      END SUBROUTINE domain_clock_get<a name='2336'>
<a name='2337'>
<A NAME='DOMAIN_CLOCKISSTARTTIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTARTTIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2338'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_clockisstarttime</font> ( grid ) RESULT ( is_start_time ) ,<A href='../../call_from/DOMAIN_CLOCKISSTARTTIME.html' TARGET='index'>1</A><a name='2339'>
        IMPLICIT NONE<a name='2340'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2341'></font>
<font color=#447700>! This convenience function returns .TRUE. iff grid%clock is at its <a name='2342'></font>
<font color=#447700>! start time.  <a name='2343'></font>
<font color=#447700>!<a name='2344'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2345'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2346'>
        <font color=#447700>! result<a name='2347'></font>
        LOGICAL :: is_start_time<a name='2348'>
        TYPE(WRFU_Time) :: start_time, current_time<a name='2349'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSTARTTIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_14">( grid, current_time=current_time, &amp;<a name='2350'>
                                     start_time=start_time )<a name='2351'>
        is_start_time = ( current_time == start_time )<a name='2352'>
      END FUNCTION domain_clockisstarttime<a name='2353'>
<a name='2354'>
<A NAME='DOMAIN_CLOCKISSIMSTARTTIME'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSIMSTARTTIME' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2355'>
      <font color=#993300>FUNCTION </font><font color=#cc0000>domain_clockissimstarttime</font> ( grid ) RESULT ( is_sim_start_time )  <A href='../../call_to/DOMAIN_CLOCKISSIMSTARTTIME.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_CLOCKISSIMSTARTTIME.html' TARGET='index'>1</A><a name='2356'>
        IMPLICIT NONE<a name='2357'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2358'></font>
<font color=#447700>! This convenience function returns .TRUE. iff grid%clock is at the <a name='2359'></font>
<font color=#447700>! simulation start time.  (It returns .FALSE. during a restart run.)  <a name='2360'></font>
<font color=#447700>!<a name='2361'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2362'></font>
        TYPE(domain), INTENT(IN) :: grid<a name='2363'>
        <font color=#447700>! result<a name='2364'></font>
        LOGICAL :: is_sim_start_time<a name='2365'>
        TYPE(WRFU_Time) :: simulationStartTime, current_time<a name='2366'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSIMSTARTTIME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_15">( grid, current_time=current_time, &amp;<a name='2367'>
                                     simulationStartTime=simulationStartTime )<a name='2368'>
        is_sim_start_time = ( current_time == simulationStartTime )<a name='2369'>
      END FUNCTION domain_clockissimstarttime<a name='2370'>
<a name='2371'>
<a name='2372'>
<a name='2373'>
<a name='2374'>
<A NAME='DOMAIN_CLOCK_CREATE'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_CREATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2375'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clock_create</font>( grid, StartTime, &amp; <A href='../../call_to/DOMAIN_CLOCK_CREATE.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_CLOCK_CREATE.html' TARGET='index'>1</A><a name='2376'>
                                            StopTime,  &amp;<a name='2377'>
                                            TimeStep )<a name='2378'>
        IMPLICIT NONE<a name='2379'>
        TYPE(domain),            INTENT(INOUT) :: grid<a name='2380'>
        TYPE(WRFU_Time),         INTENT(IN   ) :: StartTime<a name='2381'>
        TYPE(WRFU_Time),         INTENT(IN   ) :: StopTime<a name='2382'>
        TYPE(WRFU_TimeInterval), INTENT(IN   ) :: TimeStep<a name='2383'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2384'></font>
<font color=#447700>! This convenience routine creates the domain_clock for domain grid and <a name='2385'></font>
<font color=#447700>! sets associated flags.  <a name='2386'></font>
<font color=#447700>!<a name='2387'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2388'></font>
        <font color=#447700>! Locals<a name='2389'></font>
        INTEGER :: rc<a name='2390'>
        grid%domain_clock = WRFU_ClockCreate( TimeStep= TimeStep,  &amp;<a name='2391'>
                                              StartTime=StartTime, &amp;<a name='2392'>
                                              StopTime= StopTime,  &amp;<a name='2393'>
                                              rc=rc )<a name='2394'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2395'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_CREATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_233"> ( &amp;<a name='2396'>
            'domain_clock_create:  WRFU_ClockCreate() failed' )<a name='2397'>
        ENDIF<a name='2398'>
        grid%domain_clock_created = .TRUE.<a name='2399'>
        RETURN<a name='2400'>
      END SUBROUTINE domain_clock_create<a name='2401'>
<a name='2402'>
<a name='2403'>
<a name='2404'>
<A NAME='DOMAIN_ALARM_CREATE'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2405'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_alarm_create</font>( grid, alarm_id, interval, &amp; <A href='../../call_to/DOMAIN_ALARM_CREATE.html' TARGET='index'>6</A>,<A href='../../call_from/DOMAIN_ALARM_CREATE.html' TARGET='index'>4</A><a name='2406'>
                                            begin_time, end_time )<a name='2407'>
        USE module_utility<a name='2408'>
        IMPLICIT NONE<a name='2409'>
        TYPE(domain), POINTER :: grid<a name='2410'>
        INTEGER, INTENT(IN) :: alarm_id<a name='2411'>
        TYPE(WRFU_TimeInterval), INTENT(IN), OPTIONAL :: interval<a name='2412'>
        TYPE(WRFU_TimeInterval), INTENT(IN), OPTIONAL :: begin_time<a name='2413'>
        TYPE(WRFU_TimeInterval), INTENT(IN), OPTIONAL :: end_time<a name='2414'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2415'></font>
<font color=#447700>! This convenience routine creates alarm alarm_id for domain grid and <a name='2416'></font>
<font color=#447700>! sets associated flags.  <a name='2417'></font>
<font color=#447700>!<a name='2418'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2419'></font>
        <font color=#447700>! Locals<a name='2420'></font>
        INTEGER :: rc<a name='2421'>
<font color=#447700>!$$$ TBH:  Ideally, this could be simplified by passing all optional actual <a name='2422'></font>
<font color=#447700>!$$$ TBH:  args into AlarmCreate.  However, since operations are performed on <a name='2423'></font>
<font color=#447700>!$$$ TBH:  the actual args in-place in the calls, they must be present for the <a name='2424'></font>
<font color=#447700>!$$$ TBH:  operations themselves to be defined.  Grrr...  <a name='2425'></font>
        LOGICAL :: interval_only, all_args, no_args<a name='2426'>
        TYPE(WRFU_Time) :: startTime<a name='2427'>
        interval_only = .FALSE.<a name='2428'>
        all_args = .FALSE.<a name='2429'>
        no_args = .FALSE.<a name='2430'>
        IF ( ( .NOT. PRESENT( begin_time ) ) .AND. &amp;<a name='2431'>
             ( .NOT. PRESENT( end_time   ) ) .AND. &amp;<a name='2432'>
             (       PRESENT( interval   ) ) ) THEN<a name='2433'>
           interval_only = .TRUE.<a name='2434'>
        ELSE IF ( ( .NOT. PRESENT( begin_time ) ) .AND. &amp;<a name='2435'>
                  ( .NOT. PRESENT( end_time   ) ) .AND. &amp;<a name='2436'>
                  ( .NOT. PRESENT( interval   ) ) ) THEN<a name='2437'>
           no_args = .TRUE.<a name='2438'>
        ELSE IF ( (       PRESENT( begin_time ) ) .AND. &amp;<a name='2439'>
                  (       PRESENT( end_time   ) ) .AND. &amp;<a name='2440'>
                  (       PRESENT( interval   ) ) ) THEN<a name='2441'>
           all_args = .TRUE.<a name='2442'>
        ELSE<a name='2443'>
           CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_234"> ( &amp;<a name='2444'>
             'ERROR in domain_alarm_create:  bad argument list' )<a name='2445'>
        ENDIF<a name='2446'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_16">( grid, start_time=startTime )<a name='2447'>
        IF ( interval_only ) THEN<a name='2448'>
           grid%io_intervals( alarm_id ) = interval<a name='2449'>
           grid%alarms( alarm_id ) = &amp;<a name='2450'>
             WRFU_AlarmCreate( clock=grid%domain_clock, &amp;<a name='2451'>
                               RingInterval=interval,   &amp;<a name='2452'>
                               rc=rc )<a name='2453'>
        ELSE IF ( no_args ) THEN<a name='2454'>
           grid%alarms( alarm_id ) = &amp;<a name='2455'>
             WRFU_AlarmCreate( clock=grid%domain_clock, &amp;<a name='2456'>
                               RingTime=startTime,      &amp;<a name='2457'>
                               rc=rc )<a name='2458'>
        ELSE IF ( all_args ) THEN<a name='2459'>
           grid%io_intervals( alarm_id ) = interval<a name='2460'>
           grid%alarms( alarm_id ) = &amp;<a name='2461'>
             WRFU_AlarmCreate( clock=grid%domain_clock,         &amp;<a name='2462'>
                               RingTime=startTime + begin_time, &amp;<a name='2463'>
                               RingInterval=interval,           &amp;<a name='2464'>
                               StopTime=startTime + end_time,   &amp;<a name='2465'>
                               rc=rc )<a name='2466'>
        ENDIF<a name='2467'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2468'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_235"> ( &amp;<a name='2469'>
            'domain_alarm_create:  WRFU_AlarmCreate() failed' )<a name='2470'>
        ENDIF<a name='2471'>
        CALL WRFU_AlarmRingerOff( grid%alarms( alarm_id ) , rc=rc )<a name='2472'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2473'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_ALARM_CREATE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_236"> ( &amp;<a name='2474'>
            'domain_alarm_create:  WRFU_AlarmRingerOff() failed' )<a name='2475'>
        ENDIF<a name='2476'>
        grid%alarms_created( alarm_id ) = .TRUE.<a name='2477'>
      END SUBROUTINE domain_alarm_create<a name='2478'>
<a name='2479'>
<a name='2480'>
<a name='2481'>
<A NAME='DOMAIN_CLOCK_SET'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2482'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clock_set</font>( grid, current_timestr, &amp; <A href='../../call_to/DOMAIN_CLOCK_SET.html' TARGET='index'>29</A>,<A href='../../call_from/DOMAIN_CLOCK_SET.html' TARGET='index'>6</A><a name='2483'>
                                         stop_timestr,    &amp;<a name='2484'>
                                         time_step_seconds )<a name='2485'>
        IMPLICIT NONE<a name='2486'>
        TYPE(domain),      INTENT(INOUT)           :: grid<a name='2487'>
        CHARACTER (LEN=*), INTENT(IN   ), OPTIONAL :: current_timestr<a name='2488'>
        CHARACTER (LEN=*), INTENT(IN   ), OPTIONAL :: stop_timestr<a name='2489'>
        INTEGER,           INTENT(IN   ), OPTIONAL :: time_step_seconds<a name='2490'>
<font color=#447700>! &lt;DESCRIPTION&gt;<a name='2491'></font>
<font color=#447700>! This convenience routine sets clock information for domain grid.  <a name='2492'></font>
<font color=#447700>! The caller is responsible for ensuring that character string actual <a name='2493'></font>
<font color=#447700>! arguments are big enough.  <a name='2494'></font>
<font color=#447700>!<a name='2495'></font>
<font color=#447700>! &lt;/DESCRIPTION&gt;<a name='2496'></font>
        <font color=#447700>! Locals<a name='2497'></font>
        TYPE(WRFU_Time) :: lcl_currtime, lcl_stoptime<a name='2498'>
        TYPE(WRFU_TimeInterval) :: tmpTimeInterval<a name='2499'>
        INTEGER :: rc<a name='2500'>
        IF ( PRESENT( current_timestr ) ) THEN<a name='2501'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_4">( current_timestr(1:19), lcl_currtime )<a name='2502'>
          CALL WRFU_ClockSet( grid%domain_clock, currTime=lcl_currtime, &amp;<a name='2503'>
                              rc=rc )<a name='2504'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2505'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_237"> ( &amp;<a name='2506'>
              'domain_clock_set:  WRFU_ClockSet(CurrTime) failed' )<a name='2507'>
          ENDIF<a name='2508'>
        ENDIF<a name='2509'>
        IF ( PRESENT( stop_timestr ) ) THEN<a name='2510'>
          CALL <A href='../../html_code/share/module_date_time.F.html#WRF_ATOTIME'>wrf_atotime</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ATOTIME_5">( stop_timestr(1:19), lcl_stoptime )<a name='2511'>
          CALL WRFU_ClockSet( grid%domain_clock, stopTime=lcl_stoptime, &amp;<a name='2512'>
                              rc=rc )<a name='2513'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2514'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_238"> ( &amp;<a name='2515'>
              'domain_clock_set:  WRFU_ClockSet(StopTime) failed' )<a name='2516'>
          ENDIF<a name='2517'>
        ENDIF<a name='2518'>
        IF ( PRESENT( time_step_seconds ) ) THEN<a name='2519'>
          CALL WRFU_TimeIntervalSet( tmpTimeInterval, &amp;<a name='2520'>
                                     S=time_step_seconds, rc=rc )<a name='2521'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2522'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_239"> ( &amp;<a name='2523'>
              'domain_clock_set:  WRFU_TimeIntervalSet failed' )<a name='2524'>
          ENDIF<a name='2525'>
          CALL WRFU_ClockSet ( grid%domain_clock,        &amp;<a name='2526'>
                               timeStep=tmpTimeInterval, &amp;<a name='2527'>
                               rc=rc )<a name='2528'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2529'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_SET' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_240"> ( &amp;<a name='2530'>
              'domain_clock_set:  WRFU_ClockSet(TimeStep) failed' )<a name='2531'>
          ENDIF<a name='2532'>
        ENDIF<a name='2533'>
        RETURN<a name='2534'>
      END SUBROUTINE domain_clock_set<a name='2535'>
<a name='2536'>
<a name='2537'>
      <font color=#447700>! Debug routine to print key clock information.  <a name='2538'></font>
      <font color=#447700>! Printed lines include pre_str.  <a name='2539'></font>
<A NAME='DOMAIN_CLOCKPRINT'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2540'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clockprint</font> ( level, grid, pre_str ) <A href='../../call_to/DOMAIN_CLOCKPRINT.html' TARGET='index'>24</A>,<A href='../../call_from/DOMAIN_CLOCKPRINT.html' TARGET='index'>1</A><a name='2541'>
        IMPLICIT NONE<a name='2542'>
        INTEGER,           INTENT( IN) :: level<a name='2543'>
        TYPE(domain),      INTENT( IN) :: grid<a name='2544'>
        CHARACTER (LEN=*), INTENT( IN) :: pre_str<a name='2545'>
        CALL <A href='../../html_code/share/module_date_time.F.html#WRF_CLOCKPRINT'>wrf_clockprint</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CLOCKPRINT_1"> ( level, grid%domain_clock, pre_str )<a name='2546'>
        RETURN<a name='2547'>
      END SUBROUTINE domain_clockprint<a name='2548'>
<a name='2549'>
<a name='2550'>
      <font color=#447700>! Advance the clock associated with grid.  <a name='2551'></font>
      <font color=#447700>! Also updates several derived time quantities in grid state.  <a name='2552'></font>
<A NAME='DOMAIN_CLOCKADVANCE'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2553'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_clockadvance</font> ( grid ) <A href='../../call_to/DOMAIN_CLOCKADVANCE.html' TARGET='index'>6</A>,<A href='../../call_from/DOMAIN_CLOCKADVANCE.html' TARGET='index'>5</A><a name='2554'>
        IMPLICIT NONE<a name='2555'>
        TYPE(domain), INTENT(INOUT) :: grid<a name='2556'>
        INTEGER :: rc<a name='2557'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_1"> ( 250, grid, &amp;<a name='2558'>
          'DEBUG domain_clockadvance():  before WRFU_ClockAdvance,' )<a name='2559'>
        CALL WRFU_ClockAdvance( grid%domain_clock, rc=rc )<a name='2560'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2561'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_241"> ( &amp;<a name='2562'>
            'domain_clockadvance:  WRFU_ClockAdvance() failed' )<a name='2563'>
        ENDIF<a name='2564'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_2"> ( 250, grid, &amp;<a name='2565'>
          'DEBUG domain_clockadvance():  after WRFU_ClockAdvance,' )<a name='2566'>
        <font color=#447700>! Update derived time quantities in grid state.<a name='2567'></font>
        <font color=#447700>! These are initialized in setup_timekeeping().<a name='2568'></font>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_17">( grid, minutesSinceSimulationStart=grid%xtime )<a name='2569'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKADVANCE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_18">( grid, currentDayOfYearReal=grid%julian )<a name='2570'>
        RETURN<a name='2571'>
      END SUBROUTINE domain_clockadvance<a name='2572'>
<a name='2573'>
<a name='2574'>
<a name='2575'>
      <font color=#447700>! Set grid%gmt, grid%julday, and grid%julyr from simulation-start-date.  <a name='2576'></font>
      <font color=#447700>! Set start_of_simulation to TRUE iff current_time == simulation_start_time<a name='2577'></font>
<A NAME='DOMAIN_SETGMTETC'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2578'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_setgmtetc</font> ( grid, start_of_simulation ) <A href='../../call_to/DOMAIN_SETGMTETC.html' TARGET='index'>2</A>,<A href='../../call_from/DOMAIN_SETGMTETC.html' TARGET='index'>7</A><a name='2579'>
        IMPLICIT NONE<a name='2580'>
        TYPE (domain), INTENT(INOUT) :: grid<a name='2581'>
        LOGICAL,       INTENT(  OUT) :: start_of_simulation<a name='2582'>
        <font color=#447700>! locals<a name='2583'></font>
        CHARACTER (LEN=132)          :: message<a name='2584'>
        TYPE(WRFU_Time)              :: simStartTime<a name='2585'>
        INTEGER                      :: hr, mn, sec, ms, rc<a name='2586'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKPRINT'>domain_clockprint</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKPRINT_3">(150, grid, &amp;<a name='2587'>
          'DEBUG domain_setgmtetc():  get simStartTime from clock,')<a name='2588'>
        CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_19">( grid, simulationStartTime=simStartTime, &amp;<a name='2589'>
                                     simulationStartTimeStr=message )<a name='2590'>
        CALL WRFU_TimeGet( simStartTime, YY=grid%julyr, dayOfYear=grid%julday, &amp;<a name='2591'>
                           H=hr, M=mn, S=sec, MS=ms, rc=rc)<a name='2592'>
        IF ( rc /= WRFU_SUCCESS ) THEN<a name='2593'>
          CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_242"> ( &amp;<a name='2594'>
            'domain_setgmtetc:  WRFU_TimeGet() failed' )<a name='2595'>
        ENDIF<a name='2596'>
        WRITE( wrf_err_message , * ) 'DEBUG domain_setgmtetc():  simulation start time = [',TRIM( message ),']'<a name='2597'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_234">( 150, TRIM(wrf_err_message) )<a name='2598'>
        grid%gmt=hr+real(mn)/60.+real(sec)/3600.+real(ms)/(1000*3600)<a name='2599'>
        WRITE( wrf_err_message , * ) 'DEBUG domain_setgmtetc():  julyr,hr,mn,sec,ms,julday = ', &amp;<a name='2600'>
                                     grid%julyr,hr,mn,sec,ms,grid%julday<a name='2601'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_235">( 150, TRIM(wrf_err_message) )<a name='2602'>
        WRITE( wrf_err_message , * ) 'DEBUG domain_setgmtetc():  gmt = ',grid%gmt<a name='2603'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_236">( 150, TRIM(wrf_err_message) )<a name='2604'>
        start_of_simulation = <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCKISSIMSTARTTIME'>domain_ClockIsSimStartTime</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_SETGMTETC' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCKISSIMSTARTTIME_1">(grid)<a name='2605'>
        RETURN<a name='2606'>
      END SUBROUTINE domain_setgmtetc<a name='2607'>
     <a name='2608'>
<a name='2609'>
<a name='2610'>
      <font color=#447700>! Set pointer to current grid.  <a name='2611'></font>
      <font color=#447700>! To begin with, current grid is not set.  <a name='2612'></font>
<A NAME='SET_CURRENT_GRID_PTR'><A href='../../html_code/frame/module_domain.F.html#SET_CURRENT_GRID_PTR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2613'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>set_current_grid_ptr</font>( grid_ptr ) <A href='../../call_to/SET_CURRENT_GRID_PTR.html' TARGET='index'>22</A><a name='2614'>
        IMPLICIT NONE<a name='2615'>
        TYPE(domain), POINTER :: grid_ptr<a name='2616'>
<font color=#447700>!PRINT *,'DEBUG:  begin set_current_grid_ptr()'<a name='2617'></font>
<font color=#447700>!IF ( ASSOCIATED( grid_ptr ) ) THEN<a name='2618'></font>
<font color=#447700>!  PRINT *,'DEBUG:  set_current_grid_ptr():  current_grid is associated'<a name='2619'></font>
<font color=#447700>!ELSE<a name='2620'></font>
<font color=#447700>!  PRINT *,'DEBUG:  set_current_grid_ptr():  current_grid is NOT associated'<a name='2621'></font>
<font color=#447700>!ENDIF<a name='2622'></font>
        current_grid_set = .TRUE.<a name='2623'>
        current_grid =&gt; grid_ptr<a name='2624'>
<font color=#447700>!PRINT *,'DEBUG:  end set_current_grid_ptr()'<a name='2625'></font>
      END SUBROUTINE set_current_grid_ptr<a name='2626'>
<a name='2627'>
<a name='2628'>
<a name='2629'>
<font color=#447700>!******************************************************************************<a name='2630'></font>
<font color=#447700>! From Uli Blahak (01 Dec 2006)<a name='2631'></font>
<font color=#447700>! UB: Function to determine if the next time step is an alarm-timestep for a certain grid:<a name='2632'></font>
<font color=#447700>!******************************************************************************<a name='2633'></font>
<a name='2634'>
<A NAME='IS_ALARM_TSTEP'><A href='../../html_code/frame/module_domain.F.html#IS_ALARM_TSTEP' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2635'>
      LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>Is_alarm_tstep</font>( grid_clock, alarm ) <A href='../../call_to/IS_ALARM_TSTEP.html' TARGET='index'>2</A><a name='2636'>
<a name='2637'>
        IMPLICIT NONE<a name='2638'>
<a name='2639'>
        TYPE (WRFU_Clock), INTENT(in)  :: grid_clock<a name='2640'>
        TYPE (WRFU_Alarm), INTENT(in)  :: alarm<a name='2641'>
<a name='2642'>
        LOGICAL :: pred1, pred2, pred3<a name='2643'>
<a name='2644'>
        Is_alarm_tstep = .FALSE.<a name='2645'>
<a name='2646'>
        IF ( ASSOCIATED( alarm%alarmint ) ) THEN<a name='2647'>
          IF ( alarm%alarmint%Enabled ) THEN<a name='2648'>
            IF ( alarm%alarmint%RingIntervalSet ) THEN<a name='2649'>
              pred1 = .FALSE. ; pred2 = .FALSE. ; pred3 = .FALSE.<a name='2650'>
              IF ( alarm%alarmint%StopTimeSet ) THEN<a name='2651'>
                 PRED1 = ( grid_clock%clockint%CurrTime + grid_clock%clockint%TimeStep &gt; &amp;<a name='2652'>
                      alarm%alarmint%StopTime )<a name='2653'>
              ENDIF<a name='2654'>
              IF ( alarm%alarmint%RingTimeSet ) THEN<a name='2655'>
                 PRED2 = ( ( alarm%alarmint%RingTime - &amp;<a name='2656'>
                      grid_clock%clockint%TimeStep &lt;= &amp;<a name='2657'>
                      grid_clock%clockint%CurrTime )     &amp;<a name='2658'>
                      .AND. ( grid_clock%clockint%CurrTime &lt; alarm%alarmint%RingTime ) )<a name='2659'>
              ENDIF<a name='2660'>
              IF ( alarm%alarmint%RingIntervalSet ) THEN<a name='2661'>
                 PRED3 = ( alarm%alarmint%PrevRingTime + &amp;<a name='2662'>
                      alarm%alarmint%RingInterval &lt;= &amp;<a name='2663'>
                      grid_clock%clockint%CurrTime + grid_clock%clockint%TimeStep )<a name='2664'>
              ENDIF<a name='2665'>
              IF ( ( .NOT. ( pred1 ) ) .AND. &amp;<a name='2666'>
                   ( ( pred2 ) .OR. ( pred3 ) ) ) THEN<a name='2667'>
                 Is_alarm_tstep = .TRUE.<a name='2668'>
              ENDIF<a name='2669'>
            ELSE IF ( alarm%alarmint%RingTimeSet ) THEN<a name='2670'>
              IF ( alarm%alarmint%RingTime -&amp;<a name='2671'>
                   grid_clock%clockint%TimeStep &lt;= &amp;<a name='2672'>
                   grid_clock%clockint%CurrTime ) THEN<a name='2673'>
                 Is_alarm_tstep = .TRUE.<a name='2674'>
              ENDIF<a name='2675'>
            ENDIF<a name='2676'>
          ENDIF<a name='2677'>
        ENDIF<a name='2678'>
<a name='2679'>
      END FUNCTION Is_alarm_tstep<a name='2680'>
<a name='2681'>
<a name='2682'>
#if (NMM_CORE==1)<a name='2683'>
<font color=#447700>!******************************************************************************<a name='2684'></font>
<font color=#447700>! Function to determine if the next NPHS time step is an alarm-timestep for<a name='2685'></font>
<font color=#447700>! a certain grid:<a name='2686'></font>
<font color=#447700>! NMM-only -- modify to check whether the next alarm coincides with the next<a name='2687'></font>
<font color=#447700>! NPHS time step!<a name='2688'></font>
<font color=#447700>!******************************************************************************<a name='2689'></font>
<a name='2690'>
<A NAME='IS_ALARM_TSTEP_NPHS'><A href='../../html_code/frame/module_domain.F.html#IS_ALARM_TSTEP_NPHS' TARGET='top_target'><IMG SRC="../../gif/bar_green.gif" border=0></A><a name='2691'>
      LOGICAL <font color=#993300>FUNCTION </font><font color=#cc0000>Is_alarm_tstep_nphs</font>( grid_clock, alarm, nphs )<a name='2692'>
<a name='2693'>
        IMPLICIT NONE<a name='2694'>
<a name='2695'>
        TYPE (WRFU_Clock), INTENT(in)  :: grid_clock<a name='2696'>
        TYPE (WRFU_Alarm), INTENT(in)  :: alarm<a name='2697'>
<a name='2698'>
        LOGICAL :: pred1, pred2, pred3<a name='2699'>
        INTEGER :: nphs<a name='2700'>
<a name='2701'>
        Is_alarm_tstep_nphs = .FALSE.<a name='2702'>
<a name='2703'>
        IF ( ASSOCIATED( alarm%alarmint ) ) THEN<a name='2704'>
          IF ( alarm%alarmint%Enabled ) THEN<a name='2705'>
            IF ( alarm%alarmint%RingIntervalSet ) THEN<a name='2706'>
              pred1 = .FALSE. ; pred2 = .FALSE. ; pred3 = .FALSE.<a name='2707'>
              IF ( alarm%alarmint%StopTimeSet ) THEN<a name='2708'>
                 PRED1 = ( grid_clock%clockint%CurrTime + grid_clock%clockint%TimeStep*nphs &gt; &amp;<a name='2709'>
                      alarm%alarmint%StopTime )<a name='2710'>
              ENDIF<a name='2711'>
              IF ( alarm%alarmint%RingTimeSet ) THEN<a name='2712'>
                 PRED2 = ( ( alarm%alarmint%RingTime - &amp;<a name='2713'>
                      grid_clock%clockint%TimeStep &lt;= &amp;<a name='2714'>
                      grid_clock%clockint%CurrTime )     &amp;<a name='2715'>
                      .AND. ( grid_clock%clockint%CurrTime &lt; alarm%alarmint%RingTime ) )<a name='2716'>
              ENDIF<a name='2717'>
              IF ( alarm%alarmint%RingIntervalSet ) THEN<a name='2718'>
                 PRED3 = ( alarm%alarmint%PrevRingTime + &amp;<a name='2719'>
                      alarm%alarmint%RingInterval &lt;= &amp;<a name='2720'>
                      grid_clock%clockint%CurrTime + grid_clock%clockint%TimeStep*nphs )<a name='2721'>
              ENDIF<a name='2722'>
              IF ( ( .NOT. ( pred1 ) ) .AND. &amp;<a name='2723'>
                   ( ( pred2 ) .OR. ( pred3 ) ) ) THEN<a name='2724'>
                 Is_alarm_tstep_nphs = .TRUE.<a name='2725'>
              ENDIF<a name='2726'>
            ELSE IF ( alarm%alarmint%RingTimeSet ) THEN<a name='2727'>
              IF ( alarm%alarmint%RingTime -&amp;<a name='2728'>
                   grid_clock%clockint%TimeStep*nphs &lt;= &amp;<a name='2729'>
                   grid_clock%clockint%CurrTime ) THEN<a name='2730'>
                 Is_alarm_tstep_nphs = .TRUE.<a name='2731'>
              ENDIF<a name='2732'>
            ENDIF<a name='2733'>
          ENDIF<a name='2734'>
        ENDIF<a name='2735'>
<a name='2736'>
      END FUNCTION Is_alarm_tstep_nphs<a name='2737'>
#endif<a name='2738'>
<a name='2739'>
<a name='2740'>
<font color=#447700>!******************************************************************************<a name='2741'></font>
<font color=#447700>! BEGIN TEST SECTION<a name='2742'></font>
<font color=#447700>!   Code in the test section is used to test domain methods.  <a name='2743'></font>
<font color=#447700>!   This code should probably be moved elsewhere, eventually.  <a name='2744'></font>
<font color=#447700>!******************************************************************************<a name='2745'></font>
<a name='2746'>
      <font color=#447700>! Private utility routines for domain_time_test.  <a name='2747'></font>
<A NAME='DOMAIN_TIME_TEST_PRINT'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2748'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_time_test_print</font> ( pre_str, name_str, res_str ) <A href='../../call_to/DOMAIN_TIME_TEST_PRINT.html' TARGET='index'>11</A>,<A href='../../call_from/DOMAIN_TIME_TEST_PRINT.html' TARGET='index'>1</A><a name='2749'>
        IMPLICIT NONE<a name='2750'>
        CHARACTER (LEN=*), INTENT(IN) :: pre_str<a name='2751'>
        CHARACTER (LEN=*), INTENT(IN) :: name_str<a name='2752'>
        CHARACTER (LEN=*), INTENT(IN) :: res_str<a name='2753'>
        CHARACTER (LEN=512) :: out_str<a name='2754'>
        WRITE (out_str,                                            &amp;<a name='2755'>
          FMT="('DOMAIN_TIME_TEST ',A,':  ',A,' = ',A)") &amp;<a name='2756'>
          TRIM(pre_str), TRIM(name_str), TRIM(res_str)<a name='2757'>
        CALL <A href='../../html_code/frame/wrf_debug.F.html#WRF_DEBUG'>wrf_debug</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DEBUG_237">( 0, TRIM(out_str) )<a name='2758'>
      END SUBROUTINE domain_time_test_print<a name='2759'>
<a name='2760'>
      <font color=#447700>! Test adjust_io_timestr <a name='2761'></font>
<A NAME='TEST_ADJUST_IO_TIMESTR'><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2762'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>test_adjust_io_timestr</font>( TI_h, TI_m, TI_s, &amp; <A href='../../call_to/TEST_ADJUST_IO_TIMESTR.html' TARGET='index'>1</A>,<A href='../../call_from/TEST_ADJUST_IO_TIMESTR.html' TARGET='index'>7</A><a name='2763'>
        CT_yy,  CT_mm,  CT_dd,  CT_h,  CT_m,  CT_s,        &amp;<a name='2764'>
        ST_yy,  ST_mm,  ST_dd,  ST_h,  ST_m,  ST_s,        &amp;<a name='2765'>
        res_str, testname )<a name='2766'>
        INTEGER, INTENT(IN) :: TI_H<a name='2767'>
        INTEGER, INTENT(IN) :: TI_M<a name='2768'>
        INTEGER, INTENT(IN) :: TI_S<a name='2769'>
        INTEGER, INTENT(IN) :: CT_YY<a name='2770'>
        INTEGER, INTENT(IN) :: CT_MM  <font color=#447700>! month<a name='2771'></font>
        INTEGER, INTENT(IN) :: CT_DD  <font color=#447700>! day of month<a name='2772'></font>
        INTEGER, INTENT(IN) :: CT_H<a name='2773'>
        INTEGER, INTENT(IN) :: CT_M<a name='2774'>
        INTEGER, INTENT(IN) :: CT_S<a name='2775'>
        INTEGER, INTENT(IN) :: ST_YY<a name='2776'>
        INTEGER, INTENT(IN) :: ST_MM  <font color=#447700>! month<a name='2777'></font>
        INTEGER, INTENT(IN) :: ST_DD  <font color=#447700>! day of month<a name='2778'></font>
        INTEGER, INTENT(IN) :: ST_H<a name='2779'>
        INTEGER, INTENT(IN) :: ST_M<a name='2780'>
        INTEGER, INTENT(IN) :: ST_S<a name='2781'>
        CHARACTER (LEN=*), INTENT(IN) :: res_str<a name='2782'>
        CHARACTER (LEN=*), INTENT(IN) :: testname<a name='2783'>
        <font color=#447700>! locals<a name='2784'></font>
        TYPE(WRFU_TimeInterval) :: TI<a name='2785'>
        TYPE(WRFU_Time) :: CT, ST<a name='2786'>
        LOGICAL :: test_passed<a name='2787'>
        INTEGER :: rc<a name='2788'>
        CHARACTER(LEN=WRFU_MAXSTR) :: TI_str, CT_str, ST_str, computed_str<a name='2789'>
        <font color=#447700>! TI<a name='2790'></font>
        CALL WRFU_TimeIntervalSet( TI, H=TI_H, M=TI_M, S=TI_S, rc=rc )<a name='2791'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_1">( WRFU_SUCCESS, rc, &amp;<a name='2792'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeIntervalSet() ', &amp;<a name='2793'>
                              __FILE__ , &amp;<a name='2794'>
                              __LINE__  )<a name='2795'>
        CALL WRFU_TimeIntervalGet( TI, timeString=TI_str, rc=rc )<a name='2796'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_2">( WRFU_SUCCESS, rc, &amp;<a name='2797'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeGet() ', &amp;<a name='2798'>
                              __FILE__ , &amp;<a name='2799'>
                              __LINE__  )<a name='2800'>
        <font color=#447700>! CT<a name='2801'></font>
        CALL WRFU_TimeSet( CT, YY=CT_YY, MM=CT_MM, DD=CT_DD , &amp;<a name='2802'>
                                H=CT_H,   M=CT_M,   S=CT_S, rc=rc )<a name='2803'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_3">( WRFU_SUCCESS, rc, &amp;<a name='2804'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeSet() ', &amp;<a name='2805'>
                              __FILE__ , &amp;<a name='2806'>
                              __LINE__  )<a name='2807'>
        CALL WRFU_TimeGet( CT, timeString=CT_str, rc=rc )<a name='2808'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_4">( WRFU_SUCCESS, rc, &amp;<a name='2809'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeGet() ', &amp;<a name='2810'>
                              __FILE__ , &amp;<a name='2811'>
                              __LINE__  )<a name='2812'>
        <font color=#447700>! ST<a name='2813'></font>
        CALL WRFU_TimeSet( ST, YY=ST_YY, MM=ST_MM, DD=ST_DD , &amp;<a name='2814'>
                                H=ST_H,   M=ST_M,   S=ST_S, rc=rc )<a name='2815'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_5">( WRFU_SUCCESS, rc, &amp;<a name='2816'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeSet() ', &amp;<a name='2817'>
                              __FILE__ , &amp;<a name='2818'>
                              __LINE__  )<a name='2819'>
        CALL WRFU_TimeGet( ST, timeString=ST_str, rc=rc )<a name='2820'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_CHECK_ERROR'>wrf_check_error</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_CHECK_ERROR_6">( WRFU_SUCCESS, rc, &amp;<a name='2821'>
                              'FAIL:  '//TRIM(testname)//'WRFU_TimeGet() ', &amp;<a name='2822'>
                              __FILE__ , &amp;<a name='2823'>
                              __LINE__  )<a name='2824'>
        <font color=#447700>! Test<a name='2825'></font>
        CALL <A href='../../html_code/share/module_io_domain.F.html#ADJUST_IO_TIMESTR'>adjust_io_timestr</A><A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="ADJUST_IO_TIMESTR_1"> ( TI, CT, ST, computed_str )<a name='2826'>
        <font color=#447700>! check result<a name='2827'></font>
        test_passed = .FALSE.<a name='2828'>
        IF ( LEN_TRIM(res_str) == LEN_TRIM(computed_str) ) THEN<a name='2829'>
          IF ( res_str(1:LEN_TRIM(res_str)) == computed_str(1:LEN_TRIM(computed_str)) ) THEN<a name='2830'>
            test_passed = .TRUE.<a name='2831'>
          ENDIF<a name='2832'>
        ENDIF<a name='2833'>
        <font color=#447700>! print result<a name='2834'></font>
        IF ( test_passed ) THEN<a name='2835'>
          WRITE(*,FMT='(A)') 'PASS:  '//TRIM(testname)<a name='2836'>
        ELSE<a name='2837'>
          WRITE(*,*) 'FAIL:  ',TRIM(testname),':  adjust_io_timestr(',    &amp;<a name='2838'>
            TRIM(TI_str),',',TRIM(CT_str),',',TRIM(ST_str),')  expected &lt;', &amp;<a name='2839'>
            TRIM(res_str),'&gt;  but computed &lt;',TRIM(computed_str),'&gt;'<a name='2840'>
        ENDIF<a name='2841'>
      END SUBROUTINE test_adjust_io_timestr<a name='2842'>
<a name='2843'>
      <font color=#447700>! Print lots of time-related information for testing and debugging.  <a name='2844'></font>
      <font color=#447700>! Printed lines include pre_str and special string DOMAIN_TIME_TEST <a name='2845'></font>
      <font color=#447700>! suitable for grepping by test scripts.  <a name='2846'></font>
      <font color=#447700>! Returns immediately unless self_test_domain has been set to .true. in <a name='2847'></font>
      <font color=#447700>! namelist /time_control/ .  <a name='2848'></font>
<A NAME='DOMAIN_TIME_TEST'><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2849'>
      <font color=#993300>SUBROUTINE </font><font color=#cc0000>domain_time_test</font> ( grid, pre_str ) <A href='../../call_to/DOMAIN_TIME_TEST.html' TARGET='index'>1</A>,<A href='../../call_from/DOMAIN_TIME_TEST.html' TARGET='index'>24</A><a name='2850'>
        IMPLICIT NONE<a name='2851'>
        TYPE(domain),      INTENT(IN) :: grid<a name='2852'>
        CHARACTER (LEN=*), INTENT(IN) :: pre_str<a name='2853'>
        <font color=#447700>! locals<a name='2854'></font>
        LOGICAL, SAVE :: one_time_tests_done = .FALSE.<a name='2855'>
        REAL :: minutesSinceSimulationStart<a name='2856'>
        INTEGER :: advance_count, rc<a name='2857'>
        REAL :: currentDayOfYearReal<a name='2858'>
        TYPE(WRFU_TimeInterval) :: timeSinceSimulationStart<a name='2859'>
        TYPE(WRFU_Time) :: simulationStartTime<a name='2860'>
        CHARACTER (LEN=512) :: res_str<a name='2861'>
        LOGICAL :: self_test_domain<a name='2862'>
        <font color=#447700>!<a name='2863'></font>
        <font color=#447700>! NOTE:  test_adjust_io_timestr() (see below) is a self-test that <a name='2864'></font>
        <font color=#447700>!        prints PASS/FAIL/ERROR messages in a standard format.  All <a name='2865'></font>
        <font color=#447700>!        of the other tests should be strucutred the same way, <a name='2866'></font>
        <font color=#447700>!        someday.  <a name='2867'></font>
        <font color=#447700>!<a name='2868'></font>
        CALL nl_get_self_test_domain( 1, self_test_domain )<a name='2869'>
        IF ( self_test_domain ) THEN<a name='2870'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_20">( grid, advanceCount=advance_count )<a name='2871'>
          WRITE ( res_str, FMT="(I8.8)" ) advance_count<a name='2872'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_1">( pre_str, 'advanceCount', res_str )<a name='2873'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_21">( grid, currentDayOfYearReal=currentDayOfYearReal )<a name='2874'>
          WRITE ( res_str, FMT='(F10.6)' ) currentDayOfYearReal<a name='2875'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_2">( pre_str, 'currentDayOfYearReal', res_str )<a name='2876'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_22">( grid, minutesSinceSimulationStart=minutesSinceSimulationStart )<a name='2877'>
          WRITE ( res_str, FMT='(F10.6)' ) minutesSinceSimulationStart<a name='2878'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_3">( pre_str, 'minutesSinceSimulationStart', res_str )<a name='2879'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_23">( grid, current_timestr=res_str )<a name='2880'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_4">( pre_str, 'current_timestr', res_str )<a name='2881'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_24">( grid, current_timestr_frac=res_str )<a name='2882'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_5">( pre_str, 'current_timestr_frac', res_str )<a name='2883'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_25">( grid, timeSinceSimulationStart=timeSinceSimulationStart )<a name='2884'>
          CALL WRFU_TimeIntervalGet( timeSinceSimulationStart, timeString=res_str, rc=rc )<a name='2885'>
          IF ( rc /= WRFU_SUCCESS ) THEN<a name='2886'>
            CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_243"> ( &amp;<a name='2887'>
              'domain_time_test:  WRFU_TimeIntervalGet() failed' )<a name='2888'>
          ENDIF<a name='2889'>
          CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_6">( pre_str, 'timeSinceSimulationStart', res_str )<a name='2890'>
          <font color=#447700>! The following tests should only be done once, the first time this <a name='2891'></font>
          <font color=#447700>! routine is called.  <a name='2892'></font>
          IF ( .NOT. one_time_tests_done ) THEN<a name='2893'>
            one_time_tests_done = .TRUE.<a name='2894'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_26">( grid, simulationStartTimeStr=res_str )<a name='2895'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_7">( pre_str, 'simulationStartTime', res_str )<a name='2896'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_27">( grid, start_timestr=res_str )<a name='2897'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_8">( pre_str, 'start_timestr', res_str )<a name='2898'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_28">( grid, stop_timestr=res_str )<a name='2899'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_9">( pre_str, 'stop_timestr', res_str )<a name='2900'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_29">( grid, time_stepstr=res_str )<a name='2901'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_10">( pre_str, 'time_stepstr', res_str )<a name='2902'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_30">( grid, time_stepstr_frac=res_str )<a name='2903'>
            CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST_PRINT'>domain_time_test_print</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_TIME_TEST_PRINT_11">( pre_str, 'time_stepstr_frac', res_str )<a name='2904'>
            <font color=#447700>! Test adjust_io_timestr()<a name='2905'></font>
            <font color=#447700>!     CT = 2000-01-26_00:00:00   (current time)<a name='2906'></font>
            <font color=#447700>!     ST = 2000-01-24_12:00:00   (start time)<a name='2907'></font>
            <font color=#447700>!     TI = 00000_03:00:00        (time interval)<a name='2908'></font>
            <font color=#447700>! the resulting time string should be:<a name='2909'></font>
            <font color=#447700>!     2000-01-26_00:00:00<a name='2910'></font>
            CALL <A href='../../html_code/frame/module_domain.F.html#TEST_ADJUST_IO_TIMESTR'>test_adjust_io_timestr</A><A href='../../html_code/frame/module_domain.F.html#DOMAIN_TIME_TEST' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="TEST_ADJUST_IO_TIMESTR_1">( TI_h=3, TI_m=0, TI_s=0,          &amp;<a name='2911'>
              CT_yy=2000,  CT_mm=1,  CT_dd=26,  CT_h=0,  CT_m=0,  CT_s=0, &amp;<a name='2912'>
              ST_yy=2000,  ST_mm=1,  ST_dd=24,  ST_h=12, ST_m=0,  ST_s=0, &amp;<a name='2913'>
              res_str='2000-01-26_00:00:00', testname='adjust_io_timestr_1' )<a name='2914'>
            <font color=#447700>! this should fail (and does)<a name='2915'></font>
            <font color=#447700>!  CALL test_adjust_io_timestr( TI_h=3, TI_m=0, TI_s=0,          &amp;<a name='2916'></font>
            <font color=#447700>!    CT_yy=2000,  CT_mm=1,  CT_dd=26,  CT_h=0,  CT_m=0,  CT_s=0, &amp;<a name='2917'></font>
            <font color=#447700>!    ST_yy=2000,  ST_mm=1,  ST_dd=24,  ST_h=12, ST_m=0,  ST_s=0, &amp;<a name='2918'></font>
            <font color=#447700>!    res_str='2000-01-26_00:00:01', testname='adjust_io_timestr_FAIL1' )<a name='2919'></font>
          ENDIF<a name='2920'>
        ENDIF<a name='2921'>
        RETURN<a name='2922'>
      END SUBROUTINE domain_time_test<a name='2923'>
<a name='2924'>
<font color=#447700>!******************************************************************************<a name='2925'></font>
<font color=#447700>! END TEST SECTION<a name='2926'></font>
<font color=#447700>!******************************************************************************<a name='2927'></font>
<a name='2928'>
<a name='2929'>
END MODULE module_domain<a name='2930'>
<a name='2931'>
<a name='2932'>
<font color=#447700>! The following routines are outside this module to avoid build dependences.  <a name='2933'></font>
<a name='2934'>
<a name='2935'>
<font color=#447700>! Get current time as a string (current time from clock attached to the <a name='2936'></font>
<font color=#447700>! current_grid).  Includes fractional part, if present.  <a name='2937'></font>
<font color=#447700>! Returns empty string if current_grid is not set or if timing has not yet <a name='2938'></font>
<font color=#447700>! been set up on current_grid.  <a name='2939'></font>
<A NAME='GET_CURRENT_TIME_STRING'><A href='../../html_code/frame/module_domain.F.html#GET_CURRENT_TIME_STRING' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2940'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_current_time_string</font>( time_str ) <A href='../../call_to/GET_CURRENT_TIME_STRING.html' TARGET='index'>2</A>,<A href='../../call_from/GET_CURRENT_TIME_STRING.html' TARGET='index'>5</A><a name='2941'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_TIME_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_131"><a name='2942'>
  IMPLICIT NONE<a name='2943'>
  CHARACTER (LEN=*), INTENT(OUT) :: time_str<a name='2944'>
  <font color=#447700>! locals<a name='2945'></font>
  INTEGER :: debug_level_lcl<a name='2946'>
<font color=#447700>!PRINT *,'DEBUG:  begin get_current_time_string()'<a name='2947'></font>
  time_str = ''<a name='2948'>
  IF ( current_grid_set ) THEN<a name='2949'>
<font color=#447700>!$$$DEBUG<a name='2950'></font>
<font color=#447700>!PRINT *,'DEBUG:  get_current_time_string():  checking association of current_grid...'<a name='2951'></font>
<font color=#447700>!IF ( ASSOCIATED( current_grid ) ) THEN<a name='2952'></font>
<font color=#447700>!  PRINT *,'DEBUG:  get_current_time_string():  current_grid is associated'<a name='2953'></font>
<font color=#447700>!ELSE<a name='2954'></font>
<font color=#447700>!  PRINT *,'DEBUG:  get_current_time_string():  current_grid is NOT associated'<a name='2955'></font>
<font color=#447700>!ENDIF<a name='2956'></font>
<font color=#447700>!$$$END DEBUG<a name='2957'></font>
    IF ( current_grid%time_set ) THEN<a name='2958'>
<font color=#447700>!PRINT *,'DEBUG:  get_current_time_string():  calling domain_clock_get()'<a name='2959'></font>
      <font color=#447700>! set debug_level to zero and clear current_grid_set to avoid recursion<a name='2960'></font>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#GET_WRF_DEBUG_LEVEL'>get_wrf_debug_level</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_TIME_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_WRF_DEBUG_LEVEL_2">( debug_level_lcl )<a name='2961'>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_TIME_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_1"> ( 0 )<a name='2962'>
      current_grid_set = .FALSE.<a name='2963'>
      CALL <A href='../../html_code/frame/module_domain.F.html#DOMAIN_CLOCK_GET'>domain_clock_get</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_TIME_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="DOMAIN_CLOCK_GET_31">( current_grid, current_timestr_frac=time_str )<a name='2964'>
      <font color=#447700>! restore debug_level and current_grid_set<a name='2965'></font>
      CALL <A href='../../html_code/frame/wrf_debug.F.html#SET_WRF_DEBUG_LEVEL'>set_wrf_debug_level</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_TIME_STRING' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="SET_WRF_DEBUG_LEVEL_2"> ( debug_level_lcl )<a name='2966'>
      current_grid_set = .TRUE.<a name='2967'>
<font color=#447700>!PRINT *,'DEBUG:  get_current_time_string():  back from domain_clock_get()'<a name='2968'></font>
    ENDIF<a name='2969'>
  ENDIF<a name='2970'>
<font color=#447700>!PRINT *,'DEBUG:  end get_current_time_string()'<a name='2971'></font>
END SUBROUTINE get_current_time_string<a name='2972'>
<a name='2973'>
<a name='2974'>
<font color=#447700>! Get current domain name as a string of form "d&lt;NN&gt;" where "&lt;NN&gt;" is <a name='2975'></font>
<font color=#447700>! grid%id printed in two characters, with leading zero if needed ("d01", <a name='2976'></font>
<font color=#447700>! "d02", etc.).  <a name='2977'></font>
<font color=#447700>! Return empty string if current_grid not set.  <a name='2978'></font>
<A NAME='GET_CURRENT_GRID_NAME'><A href='../../html_code/frame/module_domain.F.html#GET_CURRENT_GRID_NAME' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2979'>
<font color=#993300>SUBROUTINE </font><font color=#cc0000>get_current_grid_name</font>( grid_str ) <A href='../../call_to/GET_CURRENT_GRID_NAME.html' TARGET='index'>3</A>,<A href='../../call_from/GET_CURRENT_GRID_NAME.html' TARGET='index'>1</A><a name='2980'>
  USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/io_netcdf/diffwrf.F90.html#GET_CURRENT_GRID_NAME' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_132"><a name='2981'>
  IMPLICIT NONE<a name='2982'>
  CHARACTER (LEN=*), INTENT(OUT) :: grid_str<a name='2983'>
  grid_str = ''<a name='2984'>
  IF ( current_grid_set ) THEN<a name='2985'>
    WRITE(grid_str,FMT="('d',I2.2)") current_grid%id<a name='2986'>
  ENDIF<a name='2987'>
END SUBROUTINE get_current_grid_name<a name='2988'>
<a name='2989'>
<a name='2990'>
<font color=#447700>! moved these outside module domain to avoid circular reference from module_alloc_space which also uses<a name='2991'></font>
<a name='2992'>
<A NAME='GET_IJK_FROM_GRID_EXT'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_EXT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='2993'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_grid_ext</font> (  grid ,                   &amp;,<A href='../../call_from/GET_IJK_FROM_GRID_EXT.html' TARGET='index'>2</A><a name='2994'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='2995'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='2996'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='2997'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='2998'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='2999'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='3000'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey )<a name='3001'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_EXT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_133"><a name='3002'>
    IMPLICIT NONE<a name='3003'>
    TYPE( domain ), INTENT (IN)  :: grid<a name='3004'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='3005'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3006'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3007'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='3008'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='3009'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='3010'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='3011'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey<a name='3012'>
<a name='3013'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID2'>get_ijk_from_grid2</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_EXT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID2_3"> (  grid ,                   &amp;<a name='3014'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3015'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3016'>
                           ips, ipe, jps, jpe, kps, kpe )<a name='3017'>
     data_ordering : SELECT CASE ( model_data_order )<a name='3018'>
       CASE  ( DATA_ORDER_XYZ )<a name='3019'>
           imsx = grid%sm31x ; imex = grid%em31x ; jmsx = grid%sm32x ; jmex = grid%em32x ; kmsx = grid%sm33x ; kmex = grid%em33x ;<a name='3020'>
           ipsx = grid%sp31x ; ipex = grid%ep31x ; jpsx = grid%sp32x ; jpex = grid%ep32x ; kpsx = grid%sp33x ; kpex = grid%ep33x ;<a name='3021'>
           imsy = grid%sm31y ; imey = grid%em31y ; jmsy = grid%sm32y ; jmey = grid%em32y ; kmsy = grid%sm33y ; kmey = grid%em33y ;<a name='3022'>
           ipsy = grid%sp31y ; ipey = grid%ep31y ; jpsy = grid%sp32y ; jpey = grid%ep32y ; kpsy = grid%sp33y ; kpey = grid%ep33y ;<a name='3023'>
       CASE  ( DATA_ORDER_YXZ )<a name='3024'>
           imsx = grid%sm32x ; imex = grid%em32x ; jmsx = grid%sm31x ; jmex = grid%em31x ; kmsx = grid%sm33x ; kmex = grid%em33x ;<a name='3025'>
           ipsx = grid%sp32x ; ipex = grid%ep32x ; jpsx = grid%sp31x ; jpex = grid%ep31x ; kpsx = grid%sp33x ; kpex = grid%ep33x ;<a name='3026'>
           imsy = grid%sm32y ; imey = grid%em32y ; jmsy = grid%sm31y ; jmey = grid%em31y ; kmsy = grid%sm33y ; kmey = grid%em33y ;<a name='3027'>
           ipsy = grid%sp32y ; ipey = grid%ep32y ; jpsy = grid%sp31y ; jpey = grid%ep31y ; kpsy = grid%sp33y ; kpey = grid%ep33y ;<a name='3028'>
       CASE  ( DATA_ORDER_ZXY )<a name='3029'>
           imsx = grid%sm32x ; imex = grid%em32x ; jmsx = grid%sm33x ; jmex = grid%em33x ; kmsx = grid%sm31x ; kmex = grid%em31x ;<a name='3030'>
           ipsx = grid%sp32x ; ipex = grid%ep32x ; jpsx = grid%sp33x ; jpex = grid%ep33x ; kpsx = grid%sp31x ; kpex = grid%ep31x ;<a name='3031'>
           imsy = grid%sm32y ; imey = grid%em32y ; jmsy = grid%sm33y ; jmey = grid%em33y ; kmsy = grid%sm31y ; kmey = grid%em31y ;<a name='3032'>
           ipsy = grid%sp32y ; ipey = grid%ep32y ; jpsy = grid%sp33y ; jpey = grid%ep33y ; kpsy = grid%sp31y ; kpey = grid%ep31y ;<a name='3033'>
       CASE  ( DATA_ORDER_ZYX )<a name='3034'>
           imsx = grid%sm33x ; imex = grid%em33x ; jmsx = grid%sm32x ; jmex = grid%em32x ; kmsx = grid%sm31x ; kmex = grid%em31x ;<a name='3035'>
           ipsx = grid%sp33x ; ipex = grid%ep33x ; jpsx = grid%sp32x ; jpex = grid%ep32x ; kpsx = grid%sp31x ; kpex = grid%ep31x ;<a name='3036'>
           imsy = grid%sm33y ; imey = grid%em33y ; jmsy = grid%sm32y ; jmey = grid%em32y ; kmsy = grid%sm31y ; kmey = grid%em31y ;<a name='3037'>
           ipsy = grid%sp33y ; ipey = grid%ep33y ; jpsy = grid%sp32y ; jpey = grid%ep32y ; kpsy = grid%sp31y ; kpey = grid%ep31y ;<a name='3038'>
       CASE  ( DATA_ORDER_XZY )<a name='3039'>
           imsx = grid%sm31x ; imex = grid%em31x ; jmsx = grid%sm33x ; jmex = grid%em33x ; kmsx = grid%sm32x ; kmex = grid%em32x ;<a name='3040'>
           ipsx = grid%sp31x ; ipex = grid%ep31x ; jpsx = grid%sp33x ; jpex = grid%ep33x ; kpsx = grid%sp32x ; kpex = grid%ep32x ;<a name='3041'>
           imsy = grid%sm31y ; imey = grid%em31y ; jmsy = grid%sm33y ; jmey = grid%em33y ; kmsy = grid%sm32y ; kmey = grid%em32y ;<a name='3042'>
           ipsy = grid%sp31y ; ipey = grid%ep31y ; jpsy = grid%sp33y ; jpey = grid%ep33y ; kpsy = grid%sp32y ; kpey = grid%ep32y ;<a name='3043'>
       CASE  ( DATA_ORDER_YZX )<a name='3044'>
           imsx = grid%sm33x ; imex = grid%em33x ; jmsx = grid%sm31x ; jmex = grid%em31x ; kmsx = grid%sm32x ; kmex = grid%em32x ;<a name='3045'>
           ipsx = grid%sp33x ; ipex = grid%ep33x ; jpsx = grid%sp31x ; jpex = grid%ep31x ; kpsx = grid%sp32x ; kpex = grid%ep32x ;<a name='3046'>
           imsy = grid%sm33y ; imey = grid%em33y ; jmsy = grid%sm31y ; jmey = grid%em31y ; kmsy = grid%sm32y ; kmey = grid%em32y ;<a name='3047'>
           ipsy = grid%sp33y ; ipey = grid%ep33y ; jpsy = grid%sp31y ; jpey = grid%ep31y ; kpsy = grid%sp32y ; kpey = grid%ep32y ;<a name='3048'>
     END SELECT data_ordering<a name='3049'>
   END SUBROUTINE get_ijk_from_grid_ext<a name='3050'>
<a name='3051'>
<font color=#447700>! return the values for subgrid whose refinement is in grid%sr<a name='3052'></font>
<font color=#447700>! note when using this routine, it does not affect K. For K <a name='3053'></font>
<font color=#447700>! (vertical), it just returns what get_ijk_from_grid does<a name='3054'></font>
<A NAME='GET_IJK_FROM_SUBGRID_EXT'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID_EXT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3055'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_subgrid_ext</font> (  grid ,                &amp;,<A href='../../call_from/GET_IJK_FROM_SUBGRID_EXT.html' TARGET='index'>2</A><a name='3056'>
                           ids0, ide0, jds0, jde0, kds0, kde0,    &amp;<a name='3057'>
                           ims0, ime0, jms0, jme0, kms0, kme0,    &amp;<a name='3058'>
                           ips0, ipe0, jps0, jpe0, kps0, kpe0    )<a name='3059'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID_EXT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_134"><a name='3060'>
    IMPLICIT NONE<a name='3061'>
    TYPE( domain ), INTENT (IN)  :: grid<a name='3062'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='3063'>
                           ids0, ide0, jds0, jde0, kds0, kde0,    &amp;<a name='3064'>
                           ims0, ime0, jms0, jme0, kms0, kme0,    &amp;<a name='3065'>
                           ips0, ipe0, jps0, jpe0, kps0, kpe0<a name='3066'>
   <font color=#447700>! Local<a name='3067'></font>
    INTEGER              ::                                 &amp;<a name='3068'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3069'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3070'>
                           ips, ipe, jps, jpe, kps, kpe<a name='3071'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_SUBGRID_EXT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_89"> (  grid ,                         &amp;<a name='3072'>
                             ids, ide, jds, jde, kds, kde,    &amp;<a name='3073'>
                             ims, ime, jms, jme, kms, kme,    &amp;<a name='3074'>
                             ips, ipe, jps, jpe, kps, kpe    )<a name='3075'>
     ids0 = ids<a name='3076'>
     ide0 = ide * grid%sr_x<a name='3077'>
     ims0 = (ims-1)*grid%sr_x+1<a name='3078'>
     ime0 = ime * grid%sr_x<a name='3079'>
     ips0 = (ips-1)*grid%sr_x+1<a name='3080'>
     ipe0 = ipe * grid%sr_x<a name='3081'>
<a name='3082'>
     jds0 = jds<a name='3083'>
     jde0 = jde * grid%sr_y<a name='3084'>
     jms0 = (jms-1)*grid%sr_y+1<a name='3085'>
     jme0 = jme * grid%sr_y<a name='3086'>
     jps0 = (jps-1)*grid%sr_y+1<a name='3087'>
     jpe0 = jpe * grid%sr_y<a name='3088'>
<a name='3089'>
     kds0 = kds<a name='3090'>
     kde0 = kde<a name='3091'>
     kms0 = kms<a name='3092'>
     kme0 = kme<a name='3093'>
     kps0 = kps<a name='3094'>
     kpe0 = kpe<a name='3095'>
   RETURN<a name='3096'>
   END SUBROUTINE get_ijk_from_subgrid_ext<a name='3097'>
<a name='3098'>
<font color=#447700>! find the grid based on the id reference and return that<a name='3099'></font>
<A NAME='GET_DIMS_FROM_GRID_ID'><A href='../../html_code/frame/module_domain.F.html#GET_DIMS_FROM_GRID_ID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3100'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_dims_from_grid_id</font> (  id   &amp;,<A href='../../call_from/GET_DIMS_FROM_GRID_ID.html' TARGET='index'>3</A><a name='3101'>
                          ,ds, de           &amp;<a name='3102'>
                          ,ms, me           &amp;<a name='3103'>
                          ,ps, pe           &amp;<a name='3104'>
                          ,mxs, mxe         &amp;<a name='3105'>
                          ,pxs, pxe         &amp;<a name='3106'>
                          ,mys, mye         &amp;<a name='3107'>
                          ,pys, pye )<a name='3108'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_domain.F.html#GET_DIMS_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_135">, ONLY : domain, head_grid, find_grid_by_id<a name='3109'>
    IMPLICIT NONE<a name='3110'>
    TYPE( domain ), POINTER  :: grid<a name='3111'>
    INTEGER, INTENT(IN ) :: id<a name='3112'>
    INTEGER, DIMENSION(3), INTENT(INOUT) ::                   &amp;<a name='3113'>
                           ds, de           &amp;<a name='3114'>
                          ,ms, me           &amp;<a name='3115'>
                          ,ps, pe           &amp;<a name='3116'>
                          ,mxs, mxe         &amp;<a name='3117'>
                          ,pxs, pxe         &amp;<a name='3118'>
                          ,mys, mye         &amp;<a name='3119'>
                          ,pys, pye<a name='3120'>
<a name='3121'>
     <font color=#447700>!local<a name='3122'></font>
     CHARACTER*256 mess<a name='3123'>
<a name='3124'>
     NULLIFY( grid )<a name='3125'>
     CALL <A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID'>find_grid_by_id</A><A href='../../html_code/frame/module_domain.F.html#GET_DIMS_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_GRID_BY_ID_4"> ( id, head_grid, grid )<a name='3126'>
<a name='3127'>
     IF ( ASSOCIATED(grid) ) THEN<a name='3128'>
           ds(1) = grid%sd31 ; de(1) = grid%ed31 ; ds(2) = grid%sd32 ; de(2) = grid%ed32 ; ds(3) = grid%sd33 ; de(3) = grid%ed33 ;<a name='3129'>
           ms(1) = grid%sm31 ; me(1) = grid%em31 ; ms(2) = grid%sm32 ; me(2) = grid%em32 ; ms(3) = grid%sm33 ; me(3) = grid%em33 ;<a name='3130'>
           ps(1) = grid%sp31 ; pe(1) = grid%ep31 ; ps(2) = grid%sp32 ; pe(2) = grid%ep32 ; ps(3) = grid%sp33 ; pe(3) = grid%ep33 ;<a name='3131'>
           mxs(1) = grid%sm31x ; mxe(1) = grid%em31x <a name='3132'>
           mxs(2) = grid%sm32x ; mxe(2) = grid%em32x <a name='3133'>
           mxs(3) = grid%sm33x ; mxe(3) = grid%em33x <a name='3134'>
           pxs(1) = grid%sp31x ; pxe(1) = grid%ep31x <a name='3135'>
           pxs(2) = grid%sp32x ; pxe(2) = grid%ep32x <a name='3136'>
           pxs(3) = grid%sp33x ; pxe(3) = grid%ep33x<a name='3137'>
           mys(1) = grid%sm31y ; mye(1) = grid%em31y <a name='3138'>
           mys(2) = grid%sm32y ; mye(2) = grid%em32y <a name='3139'>
           mys(3) = grid%sm33y ; mye(3) = grid%em33y <a name='3140'>
           pys(1) = grid%sp31y ; pye(1) = grid%ep31y <a name='3141'>
           pys(2) = grid%sp32y ; pye(2) = grid%ep32y <a name='3142'>
           pys(3) = grid%sp33y ; pye(3) = grid%ep33y <a name='3143'>
     ELSE<a name='3144'>
        WRITE(mess,*)'internal error: get_ijk_from_grid_id: no such grid id:',id<a name='3145'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#GET_DIMS_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_244">(TRIM(mess))<a name='3146'>
     ENDIF<a name='3147'>
<a name='3148'>
   END SUBROUTINE get_dims_from_grid_id<a name='3149'>
<a name='3150'>
<font color=#447700>! find the grid based on the id reference and return that<a name='3151'></font>
<A NAME='GET_IJK_FROM_GRID_ID'><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_ID' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3152'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>get_ijk_from_grid_id</font> (  id ,                   &amp;,<A href='../../call_from/GET_IJK_FROM_GRID_ID.html' TARGET='index'>4</A><a name='3153'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3154'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3155'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='3156'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='3157'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='3158'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='3159'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey )<a name='3160'>
    USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_136">, ONLY : domain, head_grid, find_grid_by_id, get_ijk_from_grid<a name='3161'>
    IMPLICIT NONE<a name='3162'>
    TYPE( domain ), POINTER  :: grid<a name='3163'>
    INTEGER, INTENT(IN ) :: id<a name='3164'>
    INTEGER, INTENT(OUT) ::                                 &amp;<a name='3165'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3166'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3167'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='3168'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='3169'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='3170'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='3171'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey<a name='3172'>
     <font color=#447700>!local<a name='3173'></font>
     CHARACTER*256 mess<a name='3174'>
<a name='3175'>
     NULLIFY( grid )<a name='3176'>
     CALL <A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID'>find_grid_by_id</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_GRID_BY_ID_5"> ( id, head_grid, grid )<a name='3177'>
<a name='3178'>
     IF ( ASSOCIATED(grid) ) THEN<a name='3179'>
     CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>get_ijk_from_grid</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_90"> (  grid ,                   &amp;<a name='3180'>
                           ids, ide, jds, jde, kds, kde,    &amp;<a name='3181'>
                           ims, ime, jms, jme, kms, kme,    &amp;<a name='3182'>
                           ips, ipe, jps, jpe, kps, kpe,    &amp;<a name='3183'>
                           imsx, imex, jmsx, jmex, kmsx, kmex,    &amp;<a name='3184'>
                           ipsx, ipex, jpsx, jpex, kpsx, kpex,    &amp;<a name='3185'>
                           imsy, imey, jmsy, jmey, kmsy, kmey,    &amp;<a name='3186'>
                           ipsy, ipey, jpsy, jpey, kpsy, kpey )<a name='3187'>
     ELSE<a name='3188'>
        WRITE(mess,*)'internal error: get_ijk_from_grid_id: no such grid id:',id<a name='3189'>
        CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID_ID' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_245">(TRIM(mess))<a name='3190'>
     ENDIF<a name='3191'>
<a name='3192'>
   END SUBROUTINE get_ijk_from_grid_id<a name='3193'>
<a name='3194'>
<font color=#447700>! version of this routine that can be called from set_scalar_indices_from_config in<a name='3195'></font>
<font color=#447700>! module_configure, which can not USE module_domain without creating a circular use assocaition<a name='3196'></font>
<A NAME='MODIFY_IO_MASKS'><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='3197'>
   <font color=#993300>SUBROUTINE </font><font color=#cc0000>modify_io_masks</font> ( id ) <A href='../../call_to/MODIFY_IO_MASKS.html' TARGET='index'>2</A>,<A href='../../call_from/MODIFY_IO_MASKS.html' TARGET='index'>3</A><a name='3198'>
     USE <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_137">, ONLY : domain, modify_io_masks1, head_grid, find_grid_by_id<a name='3199'>
     IMPLICIT NONE<a name='3200'>
     INTEGER, INTENT(IN) :: id<a name='3201'>
     TYPE(domain), POINTER :: grid<a name='3202'>
     CALL <A href='../../html_code/frame/module_domain.F.html#FIND_GRID_BY_ID'>find_grid_by_id</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="FIND_GRID_BY_ID_6">( id, head_grid, grid )<a name='3203'>
     IF ( ASSOCIATED( grid ) ) CALL <A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS1'>modify_io_masks1</A><A href='../../html_code/frame/module_domain.F.html#MODIFY_IO_MASKS' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODIFY_IO_MASKS1_1">( grid, id ) <a name='3204'>
     RETURN <a name='3205'>
   END SUBROUTINE modify_io_masks<a name='3206'>
<a name='3207'>
</pre></body></html>