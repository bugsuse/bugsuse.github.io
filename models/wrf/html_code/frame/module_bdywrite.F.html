<HTML> <BODY BGCOLOR=#eeddee LINK=#0000aa VLINK=#0000ff ALINK=#ff0000 ><BASE TARGET="bottom_target"><PRE><a name='1'>
<A NAME='MODULE_BDYWRITE'><A href='../../html_code/frame/module_bdywrite.F.html#MODULE_BDYWRITE' TARGET='top_target'><IMG SRC="../../gif/bar_purple.gif" border=0></A><a name='2'>
<font color=#993300>module </font><font color=#cc0000>module_bdywrite</font> <A href='../../call_to/MODULE_BDYWRITE.html' TARGET='index'>1</A><a name='3'>
  implicit none<a name='4'>
#if (NMM_CORE==1 &amp;&amp; NMM_NEST==1)<a name='5'>
#ifdef EXTRA_HWRF_DEBUG_STUFF<a name='6'>
  private<a name='7'>
  public :: bdywrite<a name='8'>
  CHACARCTER (LEN=256) , PRIVATE :: a_message<a name='9'>
contains<a name='10'>
<A NAME='BDYWRITE'><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='11'>
  <font color=#993300>subroutine </font><font color=#cc0000>bdywrite</font>(grid,filename) <A href='../../call_to/BDYWRITE.html' TARGET='index'>1</A>,<A href='../../call_from/BDYWRITE.html' TARGET='index'>16</A><a name='12'>
    use <A href='../../html_code/frame/module_domain_type.F.html#MODULE_DOMAIN_TYPE'>module_domain_type</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_TYPE_5">, only: domain<a name='13'>
    use <A href='../../html_code/frame/module_domain.F.html#MODULE_DOMAIN'>module_domain</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DOMAIN_91">, only: get_ijk_from_grid<a name='14'>
    use <A href='../../html_code/frame/module_state_description.F.html#MODULE_STATE_DESCRIPTION'>module_state_description</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_STATE_DESCRIPTION_33">, only: &amp;<a name='15'>
         p_qv, p_qc, p_qs, p_qi, p_qr, p_qg, &amp;<a name='16'>
         f_qv, f_qc, f_qs, f_qi, f_qr, f_qg, &amp;<a name='17'>
         p_qnr, p_qni, f_qnr, f_qni,         &amp;<a name='18'>
         PARAM_FIRST_SCALAR,num_moist,num_scalar<a name='19'>
    implicit none<a name='20'>
<a name='21'>
    type(domain), intent(in) :: grid<a name='22'>
    character(*), intent(in) :: filename<a name='23'>
<a name='24'>
    include 'netcdf.inc'<a name='25'>
<a name='26'>
    integer :: fid,vid<a name='27'>
    integer :: dimi,dimj,dimk<a name='28'>
    integer :: ni,nj,nk<a name='29'>
    integer :: jk(2),ik(2)<a name='30'>
<a name='31'>
<font color=#447700>! Some temporary definitions to reduce code complexity:<a name='32'></font>
<a name='33'>
#define paste(x,y) x/**/y<a name='34'>
<a name='35'>
#define check(ST) call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_NF_ASSERT'>bdy_nf_assert</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_NF_ASSERT_1">(ST,filename,__FILE__,__LINE__,.false.)<a name='36'>
#define assert(ST) call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_NF_ASSERT'>bdy_nf_assert</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_NF_ASSERT_2">(ST,filename,__FILE__,__LINE__,.true.)<a name='37'>
<a name='38'>
#define declare_bdy(X) integer :: paste(X,_bxs), paste(X,_bxe), paste(X,_bys), paste(X,_bye)<a name='39'>
<a name='40'>
<font color=#447700>! NOTE: we should be able to do #X instead of using an additional "s"<a name='41'></font>
<font color=#447700>! argument in define_vars2d and define_vars1d, but some GNU cpp bug is<a name='42'></font>
<font color=#447700>! breaking that (and also breaking ##)<a name='43'></font>
<a name='44'>
#define define_vars2d(X,s) \<a name='45'>
    assert(nf_def_var(fid, s // '_bxs',NF_FLOAT,2,jk,paste(X,_bxs))) ; \<a name='46'>
    assert(nf_def_var(fid, s // '_bxe',NF_FLOAT,2,jk,paste(X,_bxe))) ; \<a name='47'>
    assert(nf_def_var(fid, s // '_bys',NF_FLOAT,2,ik,paste(X,_bys))) ; \<a name='48'>
    assert(nf_def_var(fid, s // '_bye',NF_FLOAT,2,ik,paste(X,_bye)))<a name='49'>
<a name='50'>
#define define_vars1d(X,s) \<a name='51'>
    assert(nf_def_var(fid, s // '_bxs',NF_FLOAT,1,dimj,paste(X,_bxs))) ; \<a name='52'>
    assert(nf_def_var(fid, s // '_bxe',NF_FLOAT,1,dimj,paste(X,_bxe))) ; \<a name='53'>
    assert(nf_def_var(fid, s // '_bys',NF_FLOAT,1,dimi,paste(X,_bys))) ; \<a name='54'>
    assert(nf_def_var(fid, s // '_bye',NF_FLOAT,1,dimi,paste(X,_bye)))<a name='55'>
<a name='56'>
#define copy_data2d(to,from,d1s,d1e,d2s,d2e)     \<a name='57'>
    do i2=d2s,d2e                              ; \<a name='58'>
       do i1=d1s,d1e                           ; \<a name='59'>
          to(i1+i2*(d1e-d1s+1))=from(i1,i2,1)  ; \<a name='60'>
       end do                                  ; \<a name='61'>
    end do<a name='62'>
<a name='63'>
#define copy_data1d(to,from,d1s,d1e)     \<a name='64'>
       do i1=d1s,d1e                   ; \<a name='65'>
          to(i1)=from(i1,1,1)          ; \<a name='66'>
       end do<a name='67'>
<a name='68'>
#define write_vars3d_part(L,G,type,I) \<a name='69'>
    call paste(bdy_write_,type)(fid,filename,                           \<a name='70'>
          paste(L,_bxs),paste(L,_bxe),paste(L,_bys),paste(L,_bye),      \<a name='71'>
          ids,ide,jds,jde,kds,kde,                                      \<a name='72'>
          ims,ime,jms,jme,kms,kme,                                      \<a name='73'>
          ips,ipe,jps,jpe,kps,kpe,                                      \<a name='74'>
          grid%paste(G,_bxs)(:,:,1,I), grid%paste(G,_bxe)(:,:,1,I),     \<a name='75'>
          grid%paste(G,_bys)(:,:,1,I), grid%paste(G,_bye)(:,:,1,I))<a name='76'>
<a name='77'>
#define write_vars2d(X,type) \<a name='78'>
    call paste(bdy_write_,type)(fid,filename,                           \<a name='79'>
          paste(X,_bxs),paste(X,_bxe),paste(X,_bys),paste(X,_bye),      \<a name='80'>
          ids,ide,jds,jde,kds,kde,                                      \<a name='81'>
          ims,ime,jms,jme,kms,kme,                                      \<a name='82'>
          ips,ipe,jps,jpe,kps,kpe,                                      \<a name='83'>
          grid%paste(X,_bxs), grid%paste(X,_bxe),                       \<a name='84'>
          grid%paste(X,_bys), grid%paste(X,_bye))<a name='85'>
<a name='86'>
#define write_vars1d(X,type) \<a name='87'>
    call paste(bdy_write_,type)(fid,filename,                           \<a name='88'>
          paste(X,_bxs),paste(X,_bxe),paste(X,_bys),paste(X,_bye),      \<a name='89'>
          ids,ide,jds,jde, 1 , 1 ,                                      \<a name='90'>
          ims,ime,jms,jme, 1 , 1 ,                                      \<a name='91'>
          ips,ipe,jps,jpe, 1 , 1 ,                                      \<a name='92'>
          grid%paste(X,_bxs), grid%paste(X,_bxe),                       \<a name='93'>
          grid%paste(X,_bys), grid%paste(X,_bye))<a name='94'>
<a name='95'>
<font color=#447700>! End of temporary definitions.<a name='96'></font>
<a name='97'>
    declare_bdy(u)<a name='98'>
    declare_bdy(v)<a name='99'>
    declare_bdy(t)<a name='100'>
    declare_bdy(q)<a name='101'>
    declare_bdy(cwm)<a name='102'>
    declare_bdy(pd)<a name='103'>
    declare_bdy(winfo)<a name='104'>
    declare_bdy(iinfo)<a name='105'>
    declare_bdy(qv)<a name='106'>
    declare_bdy(qc)<a name='107'>
    declare_bdy(qr)<a name='108'>
    declare_bdy(qi)<a name='109'>
    declare_bdy(qg)<a name='110'>
    declare_bdy(qs)<a name='111'>
    declare_bdy(qnr)<a name='112'>
    declare_bdy(qni)<a name='113'>
<font color=#447700>!    declare_bdy(utemp)<a name='114'></font>
<font color=#447700>!    declare_bdy(vtemp)<a name='115'></font>
<font color=#447700>!    declare_bdy(ttemp)<a name='116'></font>
<font color=#447700>!    declare_bdy(qtemp)<a name='117'></font>
<font color=#447700>!    declare_bdy(pdtemp)<a name='118'></font>
<font color=#447700>!    declare_bdy(cwmtemp)<a name='119'></font>
<a name='120'>
    INTEGER :: IDS,IDE,JDS,JDE,KDS,KDE, &amp;<a name='121'>
               IMS,IME,JMS,JME,KMS,KME, &amp;<a name='122'>
               IPS,IPE,JPS,JPE,KPS,KPE<a name='123'>
<a name='124'>
    <font color=#447700>! ---------- end of definitions ----------<a name='125'></font>
<a name='126'>
    IDS=-1; IDE=-1; JDS=-1; JDE=-1; KDS=-1; KDE=-1<a name='127'>
    IMS=-1; IME=-1; JMS=-1; JME=-1; KMS=-1; KME=-1<a name='128'>
    IPS=-1; IPE=-1; JPS=-1; JPE=-1; KPS=-1; KPE=-1<a name='129'>
    CALL <A href='../../html_code/frame/module_domain.F.html#GET_IJK_FROM_GRID'>GET_IJK_FROM_GRID</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="GET_IJK_FROM_GRID_28">(GRID                                       &amp;<a name='130'>
                          ,IDS,IDE,JDS,JDE,KDS,KDE                    &amp;<a name='131'>
                          ,IMS,IME,JMS,JME,KMS,KME                    &amp;<a name='132'>
                          ,IPS,IPE,JPS,JPE,KPS,KPE )<a name='133'>
<a name='134'>
    write(a_message,*) "Sam's special boundary output (TM) for domain ",grid%id ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_268"> ( a_message )<a name='135'>
    <font color=#447700>! call CHECK_MOIST('MOIST',grid%moist,PARAM_FIRST_SCALAR, num_moist, &amp;<a name='136'></font>
    <font color=#447700>!        grid%moist_bxs,grid%moist_bxe, &amp;<a name='137'></font>
    <font color=#447700>!        grid%moist_bys,grid%moist_bye, &amp;<a name='138'></font>
    <font color=#447700>!        ids,ide, jds,jde, kds,kde, &amp;<a name='139'></font>
    <font color=#447700>!        ims,ime, jms,jme, kms,kme, &amp;<a name='140'></font>
    <font color=#447700>!        ips,ipe, jps,jpe, kps,kpe)<a name='141'></font>
    <font color=#447700>! call CHECK_MOIST('SCALAR',grid%scalar,PARAM_FIRST_SCALAR, num_scalar, &amp;<a name='142'></font>
    <font color=#447700>!        grid%scalar_bxs,grid%scalar_bxe, &amp;<a name='143'></font>
    <font color=#447700>!        grid%scalar_bys,grid%scalar_bye, &amp;<a name='144'></font>
    <font color=#447700>!        ids,ide, jds,jde, kds,kde, &amp;<a name='145'></font>
    <font color=#447700>!        ims,ime, jms,jme, kms,kme, &amp;<a name='146'></font>
    <font color=#447700>!        ips,ipe, jps,jpe, kps,kpe)<a name='147'></font>
<a name='148'>
    assert(nf_create(trim(filename),NF_64BIT_OFFSET,fid))<a name='149'>
    assert(nf_def_dim(fid,'i',ide-ids+1,dimi))<a name='150'>
    assert(nf_def_dim(fid,'j',jde-jds+1,dimj))<a name='151'>
    assert(nf_def_dim(fid,'k',kde-kds+1,dimk))<a name='152'>
    <a name='153'>
    jk=(/ dimj,dimk /)<a name='154'>
    ik=(/ dimi,dimk /)<a name='155'>
<a name='156'>
    define_vars2d(u,'u')<a name='157'>
    define_vars2d(v,'v')<a name='158'>
    define_vars2d(t,'t')<a name='159'>
    define_vars2d(q,'q')<a name='160'>
    define_vars2d(cwm,'cwm')<a name='161'>
    define_vars1d(pd,'pd')<a name='162'>
    define_vars2d(winfo,'winfo')<a name='163'>
    define_vars2d(iinfo,'iinfo')<a name='164'>
    if(f_qv) define_vars2d(qv,'qv')<a name='165'>
    if(f_qc) define_vars2d(qc,'qc')<a name='166'>
    if(f_qr) define_vars2d(qr,'qr')<a name='167'>
    if(f_qi) define_vars2d(qi,'qi')<a name='168'>
    if(f_qg) define_vars2d(qg,'qg')<a name='169'>
    if(f_qs) define_vars2d(qs,'qs')<a name='170'>
    if(f_qnr) define_vars2d(qnr,'qnr')<a name='171'>
    if(f_qni) define_vars2d(qni,'qni')<a name='172'>
<font color=#447700>!    define_vars2d(utemp,'utemp')<a name='173'></font>
<font color=#447700>!    define_vars2d(vtemp,'vtemp')<a name='174'></font>
<font color=#447700>!    define_vars2d(ttemp,'ttemp')<a name='175'></font>
<font color=#447700>!    define_vars2d(qtemp,'qtemp')<a name='176'></font>
<font color=#447700>!    define_vars1d(pdtemp,'pdtemp')<a name='177'></font>
<font color=#447700>!    define_vars2d(cwmtemp,'cwmtemp')<a name='178'></font>
<a name='179'>
    assert(nf_enddef(fid))<a name='180'>
<a name='181'>
    write_vars2d(u,real)<a name='182'>
    write_vars2d(v,real)<a name='183'>
    write_vars2d(t,real)<a name='184'>
    write_vars2d(q,real)<a name='185'>
    write_vars2d(cwm,real)<a name='186'>
    write_vars1d(pd,real)<a name='187'>
    write_vars2d(winfo,real)<a name='188'>
    write_vars2d(iinfo,int)<a name='189'>
    if(f_qv) write_vars3d_part(qv,moist,real,p_qv)<a name='190'>
    if(f_qc) write_vars3d_part(qc,moist,real,p_qc)<a name='191'>
    if(f_qr) write_vars3d_part(qr,moist,real,p_qr)<a name='192'>
    if(f_qi) write_vars3d_part(qi,moist,real,p_qi)<a name='193'>
    if(f_qg) write_vars3d_part(qg,moist,real,p_qg)<a name='194'>
    if(f_qs) write_vars3d_part(qs,moist,real,p_qs)<a name='195'>
    if(f_qnr) write_vars3d_part(qnr,scalar,real,p_qnr)<a name='196'>
    if(f_qni) write_vars3d_part(qni,scalar,real,p_qni)<a name='197'>
<a name='198'>
    if(f_qv) then<a name='199'>
       write(a_message,*) f_qv,p_qv ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_269"> ( a_message )<a name='200'>
    endif<a name='201'>
    if(f_qc) then<a name='202'>
       write(a_message,*) f_qc,p_qc ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_270"> ( a_message )<a name='203'>
    endif<a name='204'>
    if(f_qr) then<a name='205'>
       write(a_message,*) f_qr,p_qr ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_271"> ( a_message )<a name='206'>
    endif<a name='207'>
    if(f_qi) then<a name='208'>
       write(a_message,*) f_qi,p_qi ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_272"> ( a_message )<a name='209'>
    endif<a name='210'>
    if(f_qg) then<a name='211'>
       write(a_message,*) f_qg,p_qg ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_273"> ( a_message )<a name='212'>
    endif<a name='213'>
    if(f_qs) then<a name='214'>
       write(a_message,*) f_qs,p_qs ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_274"> ( a_message )<a name='215'>
    endif<a name='216'>
    if(f_qnr) then<a name='217'>
       write(a_message,*) f_qnr,p_qnr ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_275"> ( a_message )<a name='218'>
    endif<a name='219'>
    if(f_qni) then<a name='220'>
       write(a_message,*) f_qni,p_qni ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_276"> ( a_message )<a name='221'>
    endif<a name='222'>
<font color=#447700>!    write_vars2d(utemp,real)<a name='223'></font>
<font color=#447700>!    write_vars2d(vtemp,real)<a name='224'></font>
<font color=#447700>!    write_vars2d(ttemp,real)<a name='225'></font>
<font color=#447700>!    write_vars2d(qtemp,real)<a name='226'></font>
<font color=#447700>!    write_vars1d(pdtemp,real)<a name='227'></font>
<font color=#447700>!    write_vars2d(cwmtemp,real)<a name='228'></font>
<a name='229'>
    assert(nf_close(fid))<a name='230'>
    write(a_message,*) "Finished Sam's special boundary output (TM) for domain ",grid%id ; CALL <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDYWRITE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_277"> ( a_message )<a name='231'>
<a name='232'>
  end subroutine bdywrite<a name='233'>
<a name='234'>
<A NAME='BDY_WRITE_REAL'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='235'>
  <font color=#993300>subroutine </font><font color=#cc0000>bdy_write_real</font>(fid,filename,            &amp;,<A href='../../call_from/BDY_WRITE_REAL.html' TARGET='index'>7</A><a name='236'>
                            xsid,xeid,ysid,yeid,     &amp;<a name='237'>
                            ids,ide,jds,jde,kds,kde, &amp;<a name='238'>
                            ims,ime,jms,jme,kms,kme, &amp;<a name='239'>
                            ips,ipe,jps,jpe,kps,kpe, &amp;<a name='240'>
                            bxs,bxe,bys,bye)<a name='241'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_65">, only: ntasks, local_communicator<a name='242'>
    implicit none<a name='243'>
    logical, external :: wrf_dm_on_monitor<a name='244'>
    integer, parameter :: bdyw=1<a name='245'>
    logical :: monitor<a name='246'>
    character(*), intent(in) :: filename<a name='247'>
    integer, intent(in) :: fid,xsid,xeid,ysid,yeid<a name='248'>
    integer, intent(in) :: ids,ide,jds,jde,kds,kde, &amp;<a name='249'>
                           ims,ime,jms,jme,kms,kme, &amp;<a name='250'>
                           ips,ipe,jps,jpe,kps,kpe<a name='251'>
    real, intent(in) :: bxs(jms:jme,kms:kme,bdyw)<a name='252'>
    real, intent(in) :: bxe(jms:jme,kms:kme,bdyw)<a name='253'>
    real, intent(in) :: bys(ims:ime,kms:kme,bdyw)<a name='254'>
    real, intent(in) :: bye(ims:ime,kms:kme,bdyw)<a name='255'>
<a name='256'>
    integer :: j1,j2,i1,i2,k1,k2, ni,nj,nk<a name='257'>
<a name='258'>
<font color=#447700>!    write(0,*) 'DUDE, THIS IS LIKE SOOOOOOO REAL'<a name='259'></font>
<a name='260'>
    monitor=<A href='../../html_code/io_netcdf/diffwrf.F90.html#WRF_DM_ON_MONITOR'>wrf_dm_on_monitor</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_ON_MONITOR_1">()<a name='261'>
<a name='262'>
    j1=max(jps,jds)<a name='263'>
    j2=min(jpe,jde)<a name='264'>
    i1=max(ips,ids)<a name='265'>
    i2=min(ipe,jde)<a name='266'>
30  format('ips=',I0,' ipe=',I0,' jps=',I0,' jpe=',I0,' kps=',I0,' kpe=',I0)<a name='267'>
31  format('i1=',I0,' i2=',I0,' j1=',I0,' j2=',I0,' k1=',I0,' k2=',I0)<a name='268'>
32  format('ni=',I0,' nj=',I0,' nk=',I0)<a name='269'>
    k1=kds<a name='270'>
    k2=kde<a name='271'>
    ni=ide-ids+1<a name='272'>
    nj=jde-jds+1<a name='273'>
    nk=kde-kds+1<a name='274'>
<font color=#447700>!    write(0,*) ips,ipe,jps,jpe,kps,kpe<a name='275'></font>
<font color=#447700>!    write(0,*) i1,i2,j1,j2,k1,k2<a name='276'></font>
<font color=#447700>!    write(0,*) ni,nj,nk<a name='277'></font>
<a name='278'>
    if(ni&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_151">('ni&lt;=0')<a name='279'>
    if(nj&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_152">('nj&lt;=0')<a name='280'>
    if(nk&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_153">('nk&lt;=0')<a name='281'>
    <a name='282'>
    if(monitor) then<a name='283'>
       call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV'>bdy_recv</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_RECV_1">()<a name='284'>
    else<a name='285'>
       call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND'>bdy_send</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_REAL' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_1">()<a name='286'>
    endif<a name='287'>
<a name='288'>
<font color=#447700>!    write(0,*) 'BUT DUDE, NO MORE REAL'<a name='289'></font>
<a name='290'>
  contains<a name='291'>
<A NAME='BDY_SEND'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='292'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_send</font> <A href='../../call_to/BDY_SEND.html' TARGET='index'>2</A>,<A href='../../call_from/BDY_SEND.html' TARGET='index'>8</A><a name='293'>
      implicit none<a name='294'>
<a name='295'>
      integer :: idum1(2),idum2(2),idum3(2),idum4(2), nreceive<a name='296'>
      real :: rdum(2)<a name='297'>
<a name='298'>
      <font color=#447700>! West boundary:<a name='299'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_1">(ips==1,j1,j2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='300'>
           bxs, jms,jme,kms,kme, nreceive,2)<a name='301'>
<a name='302'>
      <font color=#447700>! East boundary:<a name='303'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_2">(ipe&gt;=ide-1,j1,j2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='304'>
           bxe, jms,jme,kms,kme, nreceive,2)<a name='305'>
      <a name='306'>
      <font color=#447700>! South boundary:<a name='307'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_3">(jps==1,i1,i2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='308'>
           bys, ims,ime,kms,kme, nreceive,2)<a name='309'>
<a name='310'>
      <font color=#447700>! North boundary:<a name='311'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_4">(jpe&gt;=jde-1,i1,i2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='312'>
           bye, ims,ime,kms,kme, nreceive,2)<a name='313'>
    end subroutine bdy_send<a name='314'>
<a name='315'>
<A NAME='BDY_RECV'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='316'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_recv</font> <A href='../../call_to/BDY_RECV.html' TARGET='index'>2</A>,<A href='../../call_from/BDY_RECV.html' TARGET='index'>16</A><a name='317'>
      implicit none<a name='318'>
<a name='319'>
      integer :: istore(ni*nk+ntasks), ikstore(ni*nk+ntasks)<a name='320'>
      integer :: jstore(nj*nk+ntasks), jkstore(nj*nk+ntasks)<a name='321'>
      integer :: counts(ntasks), disp(ntasks)<a name='322'>
      real :: irstore(ni*nk+ntasks), jrstore(nj*nk+ntasks)<a name='323'>
      integer :: storesize, nreceive<a name='324'>
<a name='325'>
33    format('ni=',I0,' nj=',I0,' nk=',I0,' ntasks=',I0,' storesize=',I0,' or ',I0)<a name='326'>
<font color=#447700>!      write(0,33) ni,nj,nk,ntasks,ni*nk+ntasks,nj*nk+ntasks<a name='327'></font>
<a name='328'>
      <font color=#447700>! West boundary:<a name='329'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_5">(ips==1,j1,j2, counts,disp, jstore,jkstore,jrstore, &amp;<a name='330'>
           bxs, jms,jme,kms,kme, nreceive, nj*nk+ntasks)<a name='331'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_1">(jstore,jkstore,jrstore,jds,jde,kds,kde,xsid, nreceive)<a name='332'>
<a name='333'>
      <font color=#447700>! East boundary:<a name='334'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_6">(ipe&gt;=ide-1,j1,j2, counts,disp, jstore,jkstore,jrstore, &amp;<a name='335'>
           bxe, jms,jme,kms,kme, nreceive, nj*nk+ntasks)<a name='336'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_2">(jstore,jkstore,jrstore,jds,jde,kds,kde,xeid, nreceive)<a name='337'>
<a name='338'>
      <font color=#447700>! South boundary:<a name='339'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_7">(jps==1,i1,i2, counts,disp, istore,ikstore,irstore, &amp;<a name='340'>
           bys, ims,ime,kms,kme, nreceive, ni*nk+ntasks)<a name='341'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_3">(istore,ikstore,irstore,ids,ide,kds,kde,ysid, nreceive)<a name='342'>
<a name='343'>
      <font color=#447700>! North boundary:<a name='344'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_8">(jpe&gt;=jde-1,i1,i2, counts,disp, istore,ikstore,irstore, &amp;<a name='345'>
           bye, ims,ime,kms,kme, nreceive, ni*nk+ntasks)<a name='346'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_4">(istore,ikstore,irstore,ids,ide,kds,kde,yeid, nreceive)<a name='347'>
<a name='348'>
    end subroutine bdy_recv<a name='349'>
<a name='350'>
<A NAME='BDY_PROCESS_ONE'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='351'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_process_one</font>(mstore,kstore,rstore,mds,mde,kds,kde,varid, nreceive) <A href='../../call_to/BDY_PROCESS_ONE.html' TARGET='index'>8</A><a name='352'>
      implicit none<a name='353'>
      include 'netcdf.inc'<a name='354'>
      integer :: m,k,n,nm<a name='355'>
      integer, intent(in) :: mds,mde,kds,kde<a name='356'>
      integer, intent(inout) :: nreceive<a name='357'>
      integer, intent(in) :: mstore((mde-mds+1)*nk+ntasks)<a name='358'>
      integer, intent(in) :: kstore((mde-mds+1)*nk+ntasks), varid<a name='359'>
      real, intent(in) :: rstore((mde-mds+1)*nk+ntasks)<a name='360'>
<a name='361'>
      real :: writeme(mds:mde,kds:kde)<a name='362'>
<a name='363'>
      writeme=0<a name='364'>
      nm=mde-mds+1<a name='365'>
      do n=1,nreceive<a name='366'>
         if(mstore(n)&lt;0) cycle<a name='367'>
 23      format('store writeme(',I0,' : ',I0,',',I0,') = ',F0.3)<a name='368'>
<font color=#447700>!         write(0,23) n,mstore(n),kstore(n),rstore(n)<a name='369'></font>
         writeme(mstore(n),kstore(n))=rstore(n)<a name='370'>
      enddo<a name='371'>
      assert(nf_put_var_real(fid,varid,writeme))<a name='372'>
    end subroutine bdy_process_one<a name='373'>
<a name='374'>
<A NAME='BDY_SEND_ONE'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='375'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_send_one</font>(bdyactive,m1,m2, &amp; <A href='../../call_to/BDY_SEND_ONE.html' TARGET='index'>16</A>,<A href='../../call_from/BDY_SEND_ONE.html' TARGET='index'>8</A><a name='376'>
         counts,disp,mstore,kstore,rstore, &amp;<a name='377'>
         bdy, bm1,bm2, bk1,bk2, nreceive, storesize)<a name='378'>
      use mpi<a name='379'>
      implicit none<a name='380'>
      integer, intent(in) :: storesize<a name='381'>
      integer, intent(in) :: bm1,bm2,bk1,bk2<a name='382'>
      logical, intent(in) :: bdyactive<a name='383'>
      integer, intent(inout), dimension(ntasks) :: counts,disp<a name='384'>
      integer, intent(inout), dimension(storesize) :: mstore,kstore<a name='385'>
      real, intent(inout), dimension(storesize) :: rstore<a name='386'>
      integer, intent(in) :: m1,m2<a name='387'>
      integer, intent(inout) :: nreceive<a name='388'>
      real, intent(in) :: bdy(bm1:bm2,bk1:bk2,1)<a name='389'>
<a name='390'>
      real :: values((m2-m1+1)*nk)<a name='391'>
      integer :: mindex((m2-m1+1)*nk),kindex((m2-m1+1)*nk),csize,crank<a name='392'>
      integer :: mycount(2),m,k,nm,task,ierr,shift<a name='393'>
<a name='394'>
      nm=m2-m1+1<a name='395'>
<a name='396'>
      mycount(1)=0<a name='397'>
      if(monitor) then<a name='398'>
         do task=1,ntasks<a name='399'>
            counts(task)=87654321<a name='400'>
            disp(task)=12345678<a name='401'>
         enddo<a name='402'>
      endif<a name='403'>
      if(bdyactive) then<a name='404'>
         mycount(1)=(m2-m1+1)*nk<a name='405'>
      else<a name='406'>
         mycount(1)=1<a name='407'>
         mindex(1)=-99<a name='408'>
         kindex(1)=-99<a name='409'>
         values(1)=-99.<a name='410'>
      endif<a name='411'>
      <a name='412'>
      call mpi_comm_size(local_communicator,csize,ierr)<a name='413'>
      call mpi_comm_rank(local_communicator,crank,ierr)<a name='414'>
9     format('I am rank ',I0,' of ',I0,' processes in communicator ',I0)<a name='415'>
<font color=#447700>!      write(0,9) crank,csize,local_communicator<a name='416'></font>
<a name='417'>
<font color=#447700>!      write(0,*) 'ntasks=',ntasks<a name='418'></font>
<font color=#447700>!      write(0,*) 'send count=',mycount(1)<a name='419'></font>
      ierr=-999<a name='420'>
      call mpi_gather(mycount,1,MPI_INTEGER, counts,1,MPI_INTEGER, &amp;<a name='421'>
                      0,local_communicator, ierr)<a name='422'>
<font color=#447700>!      write(0,*) 'result from mpi_gather is ',ierr<a name='423'></font>
      if(monitor) then<a name='424'>
         disp(1)=0<a name='425'>
12       format(' rank ',I0,': count=',I0,' and disp=',I0)<a name='426'>
<font color=#447700>!         write(0,12) 0,counts(1),disp(1)<a name='427'></font>
         if(counts(1)&lt;0 .or. counts(1)&gt;storesize) then<a name='428'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_154">('Invalid count')<a name='429'>
         endif<a name='430'>
         do task=2,ntasks<a name='431'>
            disp(task)=disp(task-1)+counts(task-1)<a name='432'>
<font color=#447700>!            write(0,12) task-1,counts(task),disp(task)<a name='433'></font>
            if(counts(task)&lt;0 .or. counts(task)&gt;storesize) then<a name='434'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_155">('Invalid count')<a name='435'>
            endif<a name='436'>
         enddo<a name='437'>
      endif<a name='438'>
      if(bdyactive) then<a name='439'>
         do k=k1,k2<a name='440'>
            do m=m1,m2<a name='441'>
11             format('copy value(m=',I0,',k=',I0,' : shift=',I0,') = ',F0.3)<a name='442'>
               shift = (k-k1)*nm + m-m1 + 1<a name='443'>
<font color=#447700>!               write(0,11) m,k,shift,bdy(m,k,1)<a name='444'></font>
               values(shift)=bdy(m,k,1)<a name='445'>
               mindex(shift)=m<a name='446'>
               kindex(shift)=k<a name='447'>
<font color=#447700>!               write(0,*) '    ... copied.'<a name='448'></font>
            enddo<a name='449'>
         enddo<a name='450'>
      endif<a name='451'>
      if(monitor) then<a name='452'>
<font color=#447700>!         write(0,12) 0,counts(1),disp(1)<a name='453'></font>
         if(counts(1)&lt;0 .or. counts(1)&gt;storesize) then<a name='454'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_156">('Invalid count')<a name='455'>
         endif<a name='456'>
         do task=2,ntasks<a name='457'>
<font color=#447700>!            write(0,12) task-1,counts(task),disp(task)<a name='458'></font>
            if(counts(task)&lt;0 .or. counts(task)&gt;storesize) then<a name='459'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_157">('Invalid count')<a name='460'>
            endif<a name='461'>
         enddo<a name='462'>
         nreceive=counts(ntasks)+disp(ntasks)<a name='463'>
<font color=#447700>!         write(0,*) 'total received: ',nreceive<a name='464'></font>
      endif<a name='465'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='466'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='467'></font>
20 format('gatherv #',I0,' with mycount=',I0,'...')<a name='468'>
<font color=#447700>!      write(0,20) 1,mycount(1)<a name='469'></font>
<font color=#447700>!      flush(0)<a name='470'></font>
<font color=#447700>!      if(monitor) then<a name='471'></font>
<font color=#447700>!         write(0,*) 'counts(1)=',counts(1)<a name='472'></font>
<font color=#447700>!         write(0,*) 'disp(1)=',disp(1)<a name='473'></font>
<font color=#447700>!      endif<a name='474'></font>
<font color=#447700>!      write(0,*) 'mycount(1)=',mycount(1)<a name='475'></font>
<font color=#447700>!      write(0,*) 'mindex(1)=',mindex(1)<a name='476'></font>
<font color=#447700>!      flush(0)<a name='477'></font>
<a name='478'>
      call mpi_gatherv(values,mycount(1),MPI_REAL, rstore,counts,disp, &amp;<a name='479'>
                       MPI_REAL,0,local_communicator,ierr)<a name='480'>
<a name='481'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='482'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='483'></font>
<font color=#447700>!      write(0,20) 2,mycount(1)<a name='484'></font>
<font color=#447700>!      flush(0)<a name='485'></font>
<a name='486'>
      call mpi_gatherv(kindex,mycount(1),MPI_INTEGER, kstore,counts,disp, &amp;<a name='487'>
                       MPI_INTEGER,0,local_communicator,ierr)<a name='488'>
<a name='489'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='490'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='491'></font>
<font color=#447700>!      write(0,20) 3,mycount(1)<a name='492'></font>
<font color=#447700>!      flush(0)<a name='493'></font>
<a name='494'>
      call mpi_gatherv(mindex,mycount(1),MPI_INTEGER, mstore,counts,disp, &amp;<a name='495'>
                       MPI_INTEGER,0,local_communicator,ierr)<a name='496'>
<font color=#447700>!      write(0,*) 'back.'<a name='497'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='498'></font>
    end subroutine bdy_send_one<a name='499'>
  end subroutine bdy_write_real<a name='500'>
<a name='501'>
<A NAME='BDY_WRITE_INT'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='502'>
  <font color=#993300>subroutine </font><font color=#cc0000>bdy_write_int</font> (fid,filename,            &amp;,<A href='../../call_from/BDY_WRITE_INT.html' TARGET='index'>7</A><a name='503'>
                            xsid,xeid,ysid,yeid,     &amp;<a name='504'>
                            ids,ide,jds,jde,kds,kde, &amp;<a name='505'>
                            ims,ime,jms,jme,kms,kme, &amp;<a name='506'>
                            ips,ipe,jps,jpe,kps,kpe, &amp;<a name='507'>
                            bxs,bxe,bys,bye)<a name='508'>
    use <A href='../../html_code/frame/module_dm_stubs.F.html#MODULE_DM'>module_dm</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="MODULE_DM_66">, only: ntasks, local_communicator<a name='509'>
    implicit none<a name='510'>
    logical, external :: wrf_dm_on_monitor<a name='511'>
    integer, parameter :: bdyw=1<a name='512'>
    logical :: monitor<a name='513'>
    character(*), intent(in) :: filename<a name='514'>
    integer, intent(in) :: fid,xsid,xeid,ysid,yeid<a name='515'>
    integer, intent(in) :: ids,ide,jds,jde,kds,kde, &amp;<a name='516'>
                           ims,ime,jms,jme,kms,kme, &amp;<a name='517'>
                           ips,ipe,jps,jpe,kps,kpe<a name='518'>
    integer, intent(in) :: bxs(jms:jme,kms:kme,bdyw)<a name='519'>
    integer, intent(in) :: bxe(jms:jme,kms:kme,bdyw)<a name='520'>
    integer, intent(in) :: bys(ims:ime,kms:kme,bdyw)<a name='521'>
    integer, intent(in) :: bye(ims:ime,kms:kme,bdyw)<a name='522'>
<a name='523'>
    integer :: j1,j2,i1,i2,k1,k2, ni,nj,nk<a name='524'>
<a name='525'>
<font color=#447700>!    write(0,*) 'DUDE, THIS IS LIKE SOOOOOOO INTEGER'<a name='526'></font>
<a name='527'>
    monitor=<A href='../../html_code/io_netcdf/diffwrf.F90.html#WRF_DM_ON_MONITOR'>wrf_dm_on_monitor</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_DM_ON_MONITOR_2">()<a name='528'>
<a name='529'>
    j1=max(jps,jds)<a name='530'>
    j2=min(jpe,jde)<a name='531'>
    i1=max(ips,ids)<a name='532'>
    i2=min(ipe,jde)<a name='533'>
30  format('ips=',I0,' ipe=',I0,' jps=',I0,' jpe=',I0,' kps=',I0,' kpe=',I0)<a name='534'>
31  format('i1=',I0,' i2=',I0,' j1=',I0,' j2=',I0,' k1=',I0,' k2=',I0)<a name='535'>
32  format('ni=',I0,' nj=',I0,' nk=',I0)<a name='536'>
    k1=kds<a name='537'>
    k2=kde<a name='538'>
    ni=ide-ids+1<a name='539'>
    nj=jde-jds+1<a name='540'>
    nk=kde-kds+1<a name='541'>
<font color=#447700>!    write(0,*) ips,ipe,jps,jpe,kps,kpe<a name='542'></font>
<font color=#447700>!    write(0,*) i1,i2,j1,j2,k1,k2<a name='543'></font>
<font color=#447700>!    write(0,*) ni,nj,nk<a name='544'></font>
<a name='545'>
    if(ni&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_158">('ni&lt;=0')<a name='546'>
    if(nj&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_159">('nj&lt;=0')<a name='547'>
    if(nk&lt;=0) call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_160">('nk&lt;=0')<a name='548'>
    <a name='549'>
    if(monitor) then<a name='550'>
       call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV'>bdy_recv</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_RECV_2">()<a name='551'>
    else<a name='552'>
       call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND'>bdy_send</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_WRITE_INT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_2">()<a name='553'>
    endif<a name='554'>
<a name='555'>
<font color=#447700>!    write(0,*) 'BUT DUDE, NO MORE INTEGER'<a name='556'></font>
<a name='557'>
  contains<a name='558'>
<A NAME='BDY_SEND'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='559'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_send</font> <A href='../../call_to/BDY_SEND.html' TARGET='index'>2</A>,<A href='../../call_from/BDY_SEND.html' TARGET='index'>8</A><a name='560'>
      implicit none<a name='561'>
<a name='562'>
      integer :: idum1(2),idum2(2),idum3(2),idum4(2), nreceive<a name='563'>
      integer :: rdum(2)<a name='564'>
<a name='565'>
      <font color=#447700>! West boundary:<a name='566'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_9">(ips==1,j1,j2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='567'>
           bxs, jms,jme,kms,kme, nreceive,2)<a name='568'>
<a name='569'>
      <font color=#447700>! East boundary:<a name='570'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_10">(ipe&gt;=ide-1,j1,j2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='571'>
           bxe, jms,jme,kms,kme, nreceive,2)<a name='572'>
      <a name='573'>
      <font color=#447700>! South boundary:<a name='574'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_11">(jps==1,i1,i2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='575'>
           bys, ims,ime,kms,kme, nreceive,2)<a name='576'>
<a name='577'>
      <font color=#447700>! North boundary:<a name='578'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_12">(jpe&gt;=jde-1,i1,i2,idum1,idum2,idum3,idum4,rdum, &amp;<a name='579'>
           bye, ims,ime,kms,kme, nreceive,2)<a name='580'>
    end subroutine bdy_send<a name='581'>
<a name='582'>
<A NAME='BDY_RECV'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='583'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_recv</font> <A href='../../call_to/BDY_RECV.html' TARGET='index'>2</A>,<A href='../../call_from/BDY_RECV.html' TARGET='index'>16</A><a name='584'>
      implicit none<a name='585'>
<a name='586'>
      integer :: istore(ni*nk+ntasks), ikstore(ni*nk+ntasks)<a name='587'>
      integer :: jstore(nj*nk+ntasks), jkstore(nj*nk+ntasks)<a name='588'>
      integer :: counts(ntasks), disp(ntasks)<a name='589'>
      integer :: irstore(ni*nk+ntasks), jrstore(nj*nk+ntasks)<a name='590'>
      integer :: storesize, nreceive<a name='591'>
<a name='592'>
33    format('ni=',I0,' nj=',I0,' nk=',I0,' ntasks=',I0,' storesize=',I0,' or ',I0)<a name='593'>
<font color=#447700>!      write(0,33) ni,nj,nk,ntasks,ni*nk+ntasks,nj*nk+ntasks<a name='594'></font>
<a name='595'>
      <font color=#447700>! West boundary:<a name='596'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_13">(ips==1,j1,j2, counts,disp, jstore,jkstore,jrstore, &amp;<a name='597'>
           bxs, jms,jme,kms,kme, nreceive, nj*nk+ntasks)<a name='598'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_5">(jstore,jkstore,jrstore,jds,jde,kds,kde,xsid, nreceive)<a name='599'>
<a name='600'>
      <font color=#447700>! East boundary:<a name='601'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_14">(ipe&gt;=ide-1,j1,j2, counts,disp, jstore,jkstore,jrstore, &amp;<a name='602'>
           bxe, jms,jme,kms,kme, nreceive, nj*nk+ntasks)<a name='603'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_6">(jstore,jkstore,jrstore,jds,jde,kds,kde,xeid, nreceive)<a name='604'>
<a name='605'>
      <font color=#447700>! South boundary:<a name='606'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_15">(jps==1,i1,i2, counts,disp, istore,ikstore,irstore, &amp;<a name='607'>
           bys, ims,ime,kms,kme, nreceive, ni*nk+ntasks)<a name='608'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_7">(istore,ikstore,irstore,ids,ide,kds,kde,ysid, nreceive)<a name='609'>
<a name='610'>
      <font color=#447700>! North boundary:<a name='611'></font>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE'>bdy_send_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_SEND_ONE_16">(jpe&gt;=jde-1,i1,i2, counts,disp, istore,ikstore,irstore, &amp;<a name='612'>
           bye, ims,ime,kms,kme, nreceive, ni*nk+ntasks)<a name='613'>
      call <A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE'>bdy_process_one</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_RECV' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="BDY_PROCESS_ONE_8">(istore,ikstore,irstore,ids,ide,kds,kde,yeid, nreceive)<a name='614'>
<a name='615'>
    end subroutine bdy_recv<a name='616'>
<a name='617'>
<A NAME='BDY_PROCESS_ONE'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_PROCESS_ONE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='618'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_process_one</font>(mstore,kstore,rstore,mds,mde,kds,kde,varid, nreceive) <A href='../../call_to/BDY_PROCESS_ONE.html' TARGET='index'>8</A><a name='619'>
      implicit none<a name='620'>
      include 'netcdf.inc'<a name='621'>
      integer :: m,k,n,nm<a name='622'>
      integer, intent(in) :: mds,mde,kds,kde<a name='623'>
      integer, intent(inout) :: nreceive<a name='624'>
      integer, intent(in) :: mstore((mde-mds+1)*nk+ntasks)<a name='625'>
      integer, intent(in) :: kstore((mde-mds+1)*nk+ntasks), varid<a name='626'>
      integer, intent(in) :: rstore((mde-mds+1)*nk+ntasks)<a name='627'>
<a name='628'>
      integer :: writeme(mds:mde,kds:kde)<a name='629'>
<a name='630'>
      writeme=0<a name='631'>
      nm=mde-mds+1<a name='632'>
      do n=1,nreceive<a name='633'>
         if(mstore(n)&lt;0) cycle<a name='634'>
 23      format('store writeme(',I0,' : ',I0,',',I0,') = ',I0)<a name='635'>
<font color=#447700>!         write(0,23) n,mstore(n),kstore(n),rstore(n)<a name='636'></font>
         writeme(mstore(n),kstore(n))=rstore(n)<a name='637'>
      enddo<a name='638'>
      assert(nf_put_var_int(fid,varid,writeme))<a name='639'>
    end subroutine bdy_process_one<a name='640'>
<a name='641'>
<A NAME='BDY_SEND_ONE'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='642'>
    <font color=#993300>subroutine </font><font color=#cc0000>bdy_send_one</font>(bdyactive,m1,m2, &amp; <A href='../../call_to/BDY_SEND_ONE.html' TARGET='index'>16</A>,<A href='../../call_from/BDY_SEND_ONE.html' TARGET='index'>8</A><a name='643'>
         counts,disp,mstore,kstore,rstore, &amp;<a name='644'>
         bdy, bm1,bm2, bk1,bk2, nreceive, storesize)<a name='645'>
      use mpi<a name='646'>
      implicit none<a name='647'>
      integer, intent(in) :: storesize<a name='648'>
      integer, intent(in) :: bm1,bm2,bk1,bk2<a name='649'>
      logical, intent(in) :: bdyactive<a name='650'>
      integer, intent(inout), dimension(ntasks) :: counts,disp<a name='651'>
      integer, intent(inout), dimension(storesize) :: mstore,kstore<a name='652'>
      integer, intent(inout), dimension(storesize) :: rstore<a name='653'>
      integer, intent(in) :: m1,m2<a name='654'>
      integer, intent(inout) :: nreceive<a name='655'>
      integer, intent(in) :: bdy(bm1:bm2,bk1:bk2,1)<a name='656'>
<a name='657'>
      integer :: values((m2-m1+1)*nk)<a name='658'>
      integer :: mindex((m2-m1+1)*nk),kindex((m2-m1+1)*nk),csize,crank<a name='659'>
      integer :: mycount(2),m,k,nm,task,ierr,shift<a name='660'>
<a name='661'>
      nm=m2-m1+1<a name='662'>
<a name='663'>
      mycount(1)=0<a name='664'>
      if(monitor) then<a name='665'>
         do task=1,ntasks<a name='666'>
            counts(task)=87654321<a name='667'>
            disp(task)=12345678<a name='668'>
         enddo<a name='669'>
      endif<a name='670'>
      if(bdyactive) then<a name='671'>
         mycount(1)=(m2-m1+1)*nk<a name='672'>
      else<a name='673'>
         mycount(1)=1<a name='674'>
         mindex(1)=-99<a name='675'>
         kindex(1)=-99<a name='676'>
         values(1)=-99.<a name='677'>
      endif<a name='678'>
      <a name='679'>
      call mpi_comm_size(local_communicator,csize,ierr)<a name='680'>
      call mpi_comm_rank(local_communicator,crank,ierr)<a name='681'>
9     format('I am rank ',I0,' of ',I0,' processes in communicator ',I0)<a name='682'>
<font color=#447700>!      write(0,9) crank,csize,local_communicator<a name='683'></font>
<a name='684'>
<font color=#447700>!      write(0,*) 'ntasks=',ntasks<a name='685'></font>
<font color=#447700>!     write(0,*) 'send count=',mycount(1)<a name='686'></font>
      ierr=-999<a name='687'>
      call mpi_gather(mycount,1,MPI_INTEGER, counts,1,MPI_INTEGER, &amp;<a name='688'>
                      0,local_communicator, ierr)<a name='689'>
<font color=#447700>!      write(0,*) 'result from mpi_gather is ',ierr<a name='690'></font>
      if(monitor) then<a name='691'>
         disp(1)=0<a name='692'>
12       format(' rank ',I0,': count=',I0,' and disp=',I0)<a name='693'>
<font color=#447700>!         write(0,12) 0,counts(1),disp(1)<a name='694'></font>
         if(counts(1)&lt;0 .or. counts(1)&gt;storesize) then<a name='695'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_161">('Invalid count')<a name='696'>
         endif<a name='697'>
         do task=2,ntasks<a name='698'>
            disp(task)=disp(task-1)+counts(task-1)<a name='699'>
<font color=#447700>!            write(0,12) task-1,counts(task),disp(task)<a name='700'></font>
            if(counts(task)&lt;0 .or. counts(task)&gt;storesize) then<a name='701'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_162">('Invalid count')<a name='702'>
            endif<a name='703'>
         enddo<a name='704'>
      endif<a name='705'>
      if(bdyactive) then<a name='706'>
         do k=k1,k2<a name='707'>
            do m=m1,m2<a name='708'>
11             format('copy value(m=',I0,',k=',I0,' : shift=',I0,') = ',I0)<a name='709'>
               shift = (k-k1)*nm + m-m1 + 1<a name='710'>
<font color=#447700>!               write(0,11) m,k,shift,bdy(m,k,1)<a name='711'></font>
               values(shift)=bdy(m,k,1)<a name='712'>
               mindex(shift)=m<a name='713'>
               kindex(shift)=k<a name='714'>
<font color=#447700>!               write(0,*) '    ... copied.'<a name='715'></font>
            enddo<a name='716'>
         enddo<a name='717'>
      endif<a name='718'>
      if(monitor) then<a name='719'>
<font color=#447700>!         write(0,12) 0,counts(1),disp(1)<a name='720'></font>
         if(counts(1)&lt;0 .or. counts(1)&gt;storesize) then<a name='721'>
            call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_163">('Invalid count')<a name='722'>
         endif<a name='723'>
         do task=2,ntasks<a name='724'>
<font color=#447700>!            write(0,12) task-1,counts(task),disp(task)<a name='725'></font>
            if(counts(task)&lt;0 .or. counts(task)&gt;storesize) then<a name='726'>
               call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL'>wrf_error_fatal</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_SEND_ONE' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL_164">('Invalid count')<a name='727'>
            endif<a name='728'>
         enddo<a name='729'>
         nreceive=counts(ntasks)+disp(ntasks)<a name='730'>
<font color=#447700>!         write(0,*) 'total received: ',nreceive<a name='731'></font>
      endif<a name='732'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='733'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='734'></font>
20 format('gatherv #',I0,' with mycount=',I0,'...')<a name='735'>
<font color=#447700>!      write(0,20) 1,mycount(1)<a name='736'></font>
<font color=#447700>!      flush(0)<a name='737'></font>
<font color=#447700>!      if(monitor) then<a name='738'></font>
<font color=#447700>!         write(0,*) 'counts(1)=',counts(1)<a name='739'></font>
<font color=#447700>!         write(0,*) 'disp(1)=',disp(1)<a name='740'></font>
<font color=#447700>!      endif<a name='741'></font>
<font color=#447700>!      write(0,*) 'mycount(1)=',mycount(1)<a name='742'></font>
<font color=#447700>!      write(0,*) 'mindex(1)=',mindex(1)<a name='743'></font>
<font color=#447700>!      flush(0)<a name='744'></font>
<a name='745'>
      call mpi_gatherv(values,mycount(1),MPI_INTEGER, rstore,counts,disp, &amp;<a name='746'>
                       MPI_INTEGER,0,local_communicator,ierr)<a name='747'>
<a name='748'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='749'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='750'></font>
<font color=#447700>!      write(0,20) 2,mycount(1)<a name='751'></font>
<font color=#447700>!      flush(0)<a name='752'></font>
<a name='753'>
      call mpi_gatherv(kindex,mycount(1),MPI_INTEGER, kstore,counts,disp, &amp;<a name='754'>
                       MPI_INTEGER,0,local_communicator,ierr)<a name='755'>
<a name='756'>
<font color=#447700>!      write(0,*) 'barrier before gathervs'<a name='757'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='758'></font>
<font color=#447700>!      write(0,20) 3,mycount(1)<a name='759'></font>
<font color=#447700>!      flush(0)<a name='760'></font>
<a name='761'>
      call mpi_gatherv(mindex,mycount(1),MPI_INTEGER, mstore,counts,disp, &amp;<a name='762'>
                       MPI_INTEGER,0,local_communicator,ierr)<a name='763'>
<font color=#447700>!      write(0,*) 'back.'<a name='764'></font>
<font color=#447700>!      call mpi_barrier(local_communicator,ierr)<a name='765'></font>
    end subroutine bdy_send_one<a name='766'>
  end subroutine bdy_write_int<a name='767'>
<a name='768'>
<A NAME='BDY_NF_ASSERT'><A href='../../html_code/frame/module_bdywrite.F.html#BDY_NF_ASSERT' TARGET='top_target'><IMG SRC="../../gif/bar_red.gif" border=0></A><a name='769'>
  <font color=#993300>subroutine </font><font color=#cc0000>bdy_nf_assert</font>(status,filename,srcfile,srcline,fatal) <A href='../../call_to/BDY_NF_ASSERT.html' TARGET='index'>2</A>,<A href='../../call_from/BDY_NF_ASSERT.html' TARGET='index'>2</A><a name='770'>
    implicit none<a name='771'>
    character(*),intent(in) :: filename,srcfile<a name='772'>
    integer, intent(in) :: status,srcline<a name='773'>
    logical,intent(in), optional :: fatal<a name='774'>
    character*80 strerr<a name='775'>
    character*700 message<a name='776'>
<a name='777'>
    include 'netcdf.inc'<a name='778'>
<a name='779'>
    if(status/=NF_NOERR) then<a name='780'>
       strerr=nf_strerror(status)<a name='781'>
450    format(A,':',I0,': netcdf error ',I0,' (',A,') writing to "',A,'".')<a name='782'>
       write(message,450) trim(srcfile),srcline,status,trim(strerr),trim(filename)<a name='783'>
       if(present(fatal)) then<a name='784'>
          if(fatal) then<a name='785'>
             call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_ERROR_FATAL3'>wrf_error_fatal3</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_NF_ASSERT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_ERROR_FATAL3_3">(srcfile,srcline,message)<a name='786'>
          endif<a name='787'>
       endif<a name='788'>
       call <A href='../../html_code/frame/module_wrf_error.F.html#WRF_MESSAGE'>wrf_message</A><A href='../../html_code/frame/module_bdywrite.F.html#BDY_NF_ASSERT' TARGET='bottom_target'><IMG SRC="../../gif/cyan.gif" border=0></a><A NAME="WRF_MESSAGE_278">(message)<a name='789'>
    endif<a name='790'>
  end subroutine bdy_nf_assert<a name='791'>
#endif<a name='792'>
#endif<a name='793'>
end module module_bdywrite<a name='794'>
</pre></body></html>