<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>利用TROPOMI看看疫情期间NO2排放的变化 | bugsuse</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="About LoveIt Theme"><link rel="prev" href="https://bugsuse.github.io/2020/02/pycharm_vnc_ssh_break_network_limit/" /><link rel="next" href="https://bugsuse.github.io/2020/02/dive_inot_dl_pytorch_ch3/" /><link rel="canonical" href="https://bugsuse.github.io/2020/02/gee_tropomi/" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/img/site.webmanifest">
<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><meta property="og:title" content="利用TROPOMI看看疫情期间NO2排放的变化" />
<meta property="og:description" content="TROPOMI TROPOspheric Monitoring Instrument(TROPOMI)是搭载在Copernicus Sentinel-5 Precursor(S5P)卫星上用于大气成分观测的仪器，于201" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bugsuse.github.io/2020/02/gee_tropomi/" />
<meta property="article:published_time" content="2020-02-20T16:28:44+08:00" />
<meta property="article:modified_time" content="2020-02-20T16:28:44+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="利用TROPOMI看看疫情期间NO2排放的变化"/>
<meta name="twitter:description" content="TROPOMI TROPOspheric Monitoring Instrument(TROPOMI)是搭载在Copernicus Sentinel-5 Precursor(S5P)卫星上用于大气成分观测的仪器，于201"/>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "利用TROPOMI看看疫情期间NO2排放的变化",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/bugsuse.github.io\/2020\/02\/gee_tropomi\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/bugsuse.github.io\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "tropomi, python, gee","wordcount":  2302 ,
        "url": "https:\/\/bugsuse.github.io\/2020\/02\/gee_tropomi\/","datePublished": "2020-02-20T16:28:44\x2b08:00","dateModified": "2020-02-20T16:28:44\x2b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "bugsuse",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/bugsuse.github.io\/img\/res.png",
                "width":  127 ,
                "height":  40 
                }
            },"description": ""
    }
    </script><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/css/lib/animate/animate.min.css"></head>
    <body><script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="https://bugsuse.github.io">bugsuse</a>
        </div>
        <div class="navbar-menu"><a class="menu-item" href="https://bugsuse.github.io/posts" title="">Posts</a><a class="menu-item" href="https://bugsuse.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://bugsuse.github.io/model" title="">Model</a><a class="menu-item" href="https://bugsuse.github.io/tools" title="">Tools</a><a class="menu-item" href="https://bugsuse.github.io/tags" title="">Tags</a><a class="menu-item" href="https://bugsuse.github.io/categories" title="">Categories</a><a class="menu-item" href="https://bugsuse.github.io/friends" title="">Friends</a><a class="menu-item" href="https://bugsuse.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav><nav class="navbar-mobile">
    <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="https://bugsuse.github.io">bugsuse</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu"><a class="menu-item" href="https://bugsuse.github.io/posts" title="">Posts</a><a class="menu-item" href="https://bugsuse.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://bugsuse.github.io/model" title="">Model</a><a class="menu-item" href="https://bugsuse.github.io/tools" title="">Tools</a><a class="menu-item" href="https://bugsuse.github.io/tags" title="">Tags</a><a class="menu-item" href="https://bugsuse.github.io/categories" title="">Categories</a><a class="menu-item" href="https://bugsuse.github.io/friends" title="">Friends</a><a class="menu-item" href="https://bugsuse.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav>
<main class="main">
                <div class="container"><article class="page"><h1 class="post-title animated flipInX">利用TROPOMI看看疫情期间NO2排放的变化</h1><div class="post-meta">
            <div class="post-meta-main"><a class="author" href="https://bugsuse.github.io" rel="author" target="_blank">
                    <i class="fas fa-user-circle fa-fw"></i>bugsuse
                </a>&nbsp;<span class="post-category">included in&nbsp;<i class="far fa-folder fa-fw"></i><a href="https://bugsuse.github.io/categories/satellite/">Satellite</a>&nbsp;</span></div>
            <div class="post-meta-other"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-02-20>2020-02-20</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>about 2302 words&nbsp;
                <i class="far fa-clock fa-fw"></i>5 min&nbsp;</div>
        </div><div class="post-featured-image"><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2020/02/20/20200215.png" alt="featured image" class="lazyload"></div><div class="post-toc" id="post-toc">
                <h2 class="post-toc-title">Contents</h2>
                <div class="post-toc-content"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#tropomi">TROPOMI</a>
          <ul>
            <li><a href="#数据产品">数据产品</a></li>
            <li><a href="#数据获取">数据获取</a></li>
          </ul>
        </li>
        <li><a href="#google-earth-engine">Google Earth Engine</a>
          <ul>
            <li><a href="#2019-vs-2020">2019 VS 2020</a></li>
            <li><a href="#数据处理及可视化代码">数据处理及可视化代码</a></li>
          </ul>
        </li>
        <li><a href="#参考链接">参考链接</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div>
            <div class="post-toc-mobile" id="post-toc-mobile">
                <details>
                    <summary>
                        <div class="post-toc-title">
                            <span>Contents</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="post-toc-content"><nav id="TableOfContentsMobile">
  <ul>
    <li>
      <ul>
        <li><a href="#tropomi">TROPOMI</a>
          <ul>
            <li><a href="#数据产品">数据产品</a></li>
            <li><a href="#数据获取">数据获取</a></li>
          </ul>
        </li>
        <li><a href="#google-earth-engine">Google Earth Engine</a>
          <ul>
            <li><a href="#2019-vs-2020">2019 VS 2020</a></li>
            <li><a href="#数据处理及可视化代码">数据处理及可视化代码</a></li>
          </ul>
        </li>
        <li><a href="#参考链接">参考链接</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                </details>
            </div><div class="post-content"><a class="post-dummy-target" id="tropomi"></a><h3>TROPOMI</h3>
<p><strong>TROPOspheric Monitoring Instrument</strong>(TROPOMI)是搭载在Copernicus Sentinel-5 Precursor(S5P)卫星上用于大气成分观测的仪器，于2017年10月13日发射，预计服役期为7年。</p>
<p>TROPOMI的目标是为了及时并准确的提供关键大气成分的观测，主要服务于空气质量、气候变化以及臭氧层监测。TROPOMI的日全球观测将用于改善空气质量预报以及大气成分浓度的监测。趋势监测对于污染排放相关的政策决策非常有用。此外，TROPOMI还可用于火山灰监测以及航空安全方面，紫外线辐射产品可用于预警强紫外辐射。</p>
<p>高分辨率大气成分的观测，不仅能改善空气质量数值预报，而且对于改进大气中重要化学和动力过程的理解也具有积极影响。</p>
<p><img src="/img/2020/02/20/Atmosphere_composition_diagram.png" style="zoom:70%;" /></p>
<center><font size=2 size='grey'>地球大气成分演变/循环示意图</font></center>
<a class="post-dummy-target" id="数据产品"></a><h4>数据产品</h4>
<p>经过6个月的运行测试阶段后于2018年4月正式进入业务运行模式。从2018年6月中旬开始对外发布数据产品，目前提供了Level1和Level2两种数据产品。经过近一年的运行以及标定校准，数据产品空间分辨率从原先的7.2 km增加到5.6 km，并从2019年8月6日开始正式发布。对于空气质量监测来说，或许能带来更好的效果。</p>
<p><img src="/img/2020/02/20/1.png" style="zoom:70%;" /></p>
<center><font size=2 color='grey'>TROPOMI Level2数据产品</font></center>
<p><strong>注</strong>: 目前除了<code>Ozone profiles</code>和<code>UV</code>两个产品没有对外发布之外，其余产品均已对外发布。</p>
<a class="post-dummy-target" id="数据获取"></a><h4>数据获取</h4>
<a class="post-dummy-target" id="fnref:1"></a><p>S5P的数据是对外公开的，数据可通过官方Hub数据中心下载<sup><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>。用户名和密码均为：<code>s5pguest</code></p>
<p><img src="/img/2020/02/20/3.png" style="zoom:40%;" /></p>
<center><font size=2 color='grey'>Hub数据选择页面</font></center>
<p>目前数据中心提供了<code>L1B</code>和<code>L2</code>两种处理级别的数据产品，可根据需要选择下载。一般用户的可以选择下载<code>L2</code>的数据产品。<code>L2</code>数据产品提供了<code>HCHO</code>、<code>NO2</code>、<code>O3</code>、<code>CH4</code>、<code>CO</code>、<code>CLOUD</code>等产品。每一种产品有三种不同时间处理的数据产品可用：<code>NRT</code>、<code>OFFL</code>、<code>REPROCESSING</code>。</p>
<ul>
<li><code>NRT(near-real-time)</code>：此数据的时效性最好，一般在观测到3小时左右即可获取。但是数据质量可能较差。</li>
<li><code>OFFL(offline)</code>：离线数据。数据时效性相对于<code>NRT</code>滞后一些，但是数据质量较高。</li>
<li><code>Reprocessing</code>：经过多次处理之后的数据，数据质量可能更好，但时效性最差。</li>
</ul>
<p><code>L2</code>级产品是根据每一条扫描轨道处理，对于扫描轨道出现重复的数据而言，还需要进一步处理。官方也提供了工具进行处理。比如由KNMI负责开发的<a href="https://dev.knmi.nl/projects/pycama" target="_blank">PyCAMA</a>，<a href="https://github.com/stcorp/harp" target="_blank">HARP</a>，<a href="https://github.com/pytroll/satpy" target="_blank">Satpy</a>等。</p>
<p>除了利用上述工具自行处理之外，还可以通过Google Earth Engine获取处理好的Level3数据产品。下面以Google Earth Engine为例，获取TROPOMI $NO_2$数据产品，看一下此次新冠疫情对$NO_2$排放的影响。</p>
<a class="post-dummy-target" id="google-earth-engine"></a><h3>Google Earth Engine</h3>
<p>关于Google Earth Engine的介绍之前也已经提到过了。这里就不多说了。我们先来看一下2019年和2020年春节期间中国东部地区$NO_2$浓度的空间变化情况。</p>
<a class="post-dummy-target" id="2019-vs-2020"></a><h4>2019 VS 2020</h4>
<p><strong>注</strong>: 2020年的数据采用的是<code>NRT</code>近实时数据流，2019年的数据采用的是<code>OFFL</code>离线数据流。两种数据的数据质量可能存在一些差异。</p>
<br>
<iframe seamless src="/img/2020/02/20/20200124/index.html" width="100%" height="500"></iframe>
<center><font size=2 color='grey'>图1 2020年春节期间中国东部NO2浓度空间分布</font></center>
<p>仅从上图来看，无法说明$NO_2$浓度有什么问题。下面我们再来看一下2019年春节期间中国东部地区$NO_2$浓度的空间分布。
<br></p>
<iframe seamless src="/img/2020/02/20/20190205/index.html" width="100%" height="500"></iframe>
<center><font size=2 color='grey'>图2 2019年春节期间中国东部NO2浓度空间分布</font></center>
<p>从上面两张图可以看出，在不考虑气象条件的情况下，$NO_2$浓度的差异是非常明显的。这很大程度上可能是由于在此次疫情期间的交通管制所导致。通过对元宵节期间以及最近几天的$NO_2$浓度的变化分析来看，由于一些企业还没有复工，而且大部人都还在家窝着，交通管制仍然还没有完全放开，所以工业和机动车的排放相对来说是很低的。这也就导致了$NO_2$浓度低于常规浓度水平。</p>
<p>下面看一下2019年和2020年元宵节期间中国东部地区$NO_2$浓度的空间分布情况。从图中可以看出：$NO_2$浓度的空间分布情况差异非常大。</p>
<p><img src="/img/2020/02/20/4.png" style="zoom:50%;" /></p>
<center><font size=2 color='grey'>图3 左侧为2019年2月17日-2月19日NO2的平均浓度分布，右侧为2020年2月6日-2月10日NO2的平均浓度分布</center></font>
<p>以上关于2019年和2020年春节及元宵节期间中国东部地区$NO_2$浓度的空间分布情况对比均没有考虑同期气象条件的影响。仅作为学习参考。</p>
<a class="post-dummy-target" id="数据处理及可视化代码"></a><h4>数据处理及可视化代码</h4>
<p>以上$NO_2$数据产品来源于Google Earth Engine。所有代码均为python缩写。可视化采用的是<code>folium</code>，图中<code>colorbar</code>的添加使用的是<code>branca</code>，<code>geopandas</code>主要用于添加省界以及海岸线。</p>
<p><strong>注</strong>：由于未知原因，以下代码可能需要使用代理才能够成功运行。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">branca</span>
<span class="kn">import</span> <span class="nn">ee</span>

<span class="c1"># 设置代理访问 Google Earth Engine</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">http_proxy</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">http://127.0.0.1:1087</span><span class="s1">&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">https_proxy</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">https://127.0.0.1:1087</span><span class="s1">&#39;</span>

<span class="c1"># 初始化 ee</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialize</span><span class="p">(</span><span class="p">)</span>

<span class="c1"># 定义加载GEE影像数或者矢量数据方法</span>
<span class="k">def</span> <span class="nf">add_ee_layer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ee_object</span><span class="p">,</span> <span class="n">vis_params</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span><span class="p">:</span> 
    <span class="k">try</span><span class="p">:</span>     
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ee_object</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span><span class="p">:</span>     
            <span class="n">map_id_dict</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ee_object</span><span class="p">)</span><span class="o">.</span><span class="n">getMapId</span><span class="p">(</span><span class="n">vis_params</span><span class="p">)</span> 
            <span class="n">folium</span><span class="o">.</span><span class="n">raster_layers</span><span class="o">.</span><span class="n">TileLayer</span><span class="p">(</span> 
                <span class="n">tiles</span> <span class="o">=</span> <span class="n">map_id_dict</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">tile_fetcher</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_format</span><span class="p">,</span> 
                <span class="n">attr</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">Google Earth Engine</span><span class="s1">&#39;</span><span class="p">,</span> 
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> 
                <span class="n">overlay</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
                <span class="n">control</span> <span class="o">=</span> <span class="bp">True</span> 
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> 
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ee_object</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">FeatureCollection</span><span class="p">)</span><span class="p">:</span>   
            <span class="n">ee_object_new</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="p">)</span><span class="o">.</span><span class="n">paint</span><span class="p">(</span><span class="n">ee_object</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> 
            <span class="n">map_id_dict</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">ee_object_new</span><span class="p">)</span><span class="o">.</span><span class="n">getMapId</span><span class="p">(</span><span class="n">vis_params</span><span class="p">)</span> 
            <span class="n">folium</span><span class="o">.</span><span class="n">raster_layers</span><span class="o">.</span><span class="n">TileLayer</span><span class="p">(</span> 
                <span class="n">tiles</span> <span class="o">=</span> <span class="n">map_id_dict</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">tile_fetcher</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">url_format</span><span class="p">,</span> 
                <span class="n">attr</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">Google Earth Engine</span><span class="s1">&#39;</span><span class="p">,</span> 
                <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> 
                <span class="n">overlay</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> 
                <span class="n">control</span> <span class="o">=</span> <span class="bp">True</span> 
            <span class="p">)</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> 
    <span class="k">except</span><span class="p">:</span> 
        <span class="k">print</span><span class="p">(</span><span class="sa"></span><span class="s2">&#34;</span><span class="s2">Could not display {}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="p">)</span> 

<span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="o">.</span><span class="n">add_ee_layer</span> <span class="o">=</span> <span class="n">add_ee_layer</span> 

<span class="n">no2</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">COPERNICUS/S5P/NRTI/L3_NO2</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">tropospheric_NO2_column_number_density</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filterDate</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">2020-01-24</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">2020-01-28</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">viz</span> <span class="o">=</span> <span class="p">{</span>
  <span class="sa"></span><span class="s1">&#39;</span><span class="s1">min</span><span class="s1">&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="sa"></span><span class="s1">&#39;</span><span class="s1">max</span><span class="s1">&#39;</span><span class="p">:</span> <span class="mf">0.0002</span><span class="p">,</span>
  <span class="sa"></span><span class="s1">&#39;</span><span class="s1">palette</span><span class="s1">&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">#FFFFFF</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#C2C8E1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#9BA9DC</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#4C9DF4</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#86D1F9</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#A7E5EF</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#FEFC59</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#FD7822</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#FC131F</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">#A3090E</span><span class="s1">&#39;</span><span class="p">]</span><span class="p">,</span>
  <span class="sa"></span><span class="s1">&#39;</span><span class="s1">opacity</span><span class="s1">&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">my_map</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">114</span><span class="p">]</span><span class="p">,</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">780</span><span class="p">)</span> 
<span class="n">my_map</span><span class="o">.</span><span class="n">add_ee_layer</span><span class="p">(</span><span class="n">no2</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="p">)</span><span class="p">,</span> <span class="n">viz</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">DEM</span><span class="s1">&#39;</span><span class="p">)</span> 
<span class="n">colormap</span> <span class="o">=</span> <span class="n">branca</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">LinearColormap</span><span class="p">(</span><span class="n">viz</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">palette</span><span class="s1">&#39;</span><span class="p">]</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">viz</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">min</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">viz</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">max</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">)</span>
<span class="n">colormap</span><span class="o">.</span><span class="n">caption</span> <span class="o">=</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">Tropospheric NO2 Column Number Density Jan 24-28 2020(1e-3 mol/m^2)</span><span class="s1">&#39;</span>
<span class="n">colormap</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">my_map</span><span class="p">)</span>
<span class="n">my_map</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">(</span><span class="p">)</span><span class="p">)</span> 

<span class="n">my_map</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">20200124.html</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>图1和图2均是最终保存的<code>html</code>文件生成，可以交互式查看。图3采用的相同的方式生成，但是最终截图保存，并利用<code>convert</code>进行的图片水平拼接。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">convert +append 2019021_19.png 20200206_10.png 1920.png
</code></pre></td></tr></table>
</div>
<a class="post-dummy-target" id="fnref:2"></a></div><p>除了使用python进行可视化外，Google Earth Engine还提供了Code Editor可利用JS进行可视化。感兴趣的可以去把玩一下<sup><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>。</p>
<p><img src="/img/2020/02/20/31.png" style="zoom:50%;" /></p>
<center>
  <font size=2 color='grey'>Google Earth Engine Code Editor</font>
</center>
<p>就到这里了。后面有时间的话再介绍一下如何使用<a href="https://dev.knmi.nl/projects/pycama" target="_blank">PyCAMA</a>以及其他工具处理卫星数据的方法。</p>
<a class="post-dummy-target" id="参考链接"></a><h3>参考链接</h3>
<ol>
<li><a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S5P_NRTI_L3_NO2">https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S5P_NRTI_L3_NO2</a></li>
<li><a href="https://stackoverflow.com/questions/52911688/python-folium-choropleth-map-colors-incorrect/52981115#52981115">https://stackoverflow.com/questions/52911688/python-folium-choropleth-map-colors-incorrect/52981115#52981115</a></li>
<li><a href="https://python-visualization.github.io/folium/quickstart.html#GeoJSON/TopoJSON-Overlays">https://python-visualization.github.io/folium/quickstart.html#GeoJSON/TopoJSON-Overlays</a></li>
<li><a href="https://ocefpaf.github.io/python4oceanographers/blog/2015/12/14/geopandas_folium/">https://ocefpaf.github.io/python4oceanographers/blog/2015/12/14/geopandas_folium/</a></li>
<li><a href="https://ocefpaf.github.io/python4oceanographers/blog/2015/02/02/cartopy_folium_shapefile/">https://ocefpaf.github.io/python4oceanographers/blog/2015/02/02/cartopy_folium_shapefile/</a></li>
<li><a href="https://github.com/akkana/scripts/blob/master/mapping/polidistmap.py">https://github.com/akkana/scripts/blob/master/mapping/polidistmap.py</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/106147610">https://zhuanlan.zhihu.com/p/106147610</a></li>
</ol>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li  role="doc-endnote"><p><a class="post-dummy-target" id="fn:1"></a><a href="https://s5phub.copernicus.eu/dhus/#/home">https://s5phub.copernicus.eu/dhus/#/home</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li  role="doc-endnote"><p><a class="post-dummy-target" id="fn:2"></a><a href="https://code.earthengine.google.com/?scriptPath=Examples%3ADatasets%2FCOPERNICUS_S5P_NRTI_L3_NO2">https://code.earthengine.google.com/?scriptPath=Examples%3ADatasets%2FCOPERNICUS_S5P_NRTI_L3_NO2</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>

        
        <br>
        <h3>相关文章</h3><a href="https://bugsuse.github.io/content/posts/pycama_tropomi/">利用PyCAMA处理TROPOMI卫星数据</a><a href="https://bugsuse.github.io/2020/02/pycama_tropomi/">利用PyCAMA处理TROPOMI卫星数据</a><a href="https://bugsuse.github.io/content/posts/gee_tropomi/">利用TROPOMI看看疫情期间NO2排放的变化</a><div class="post-footer" id="post-footer">
        <div style="padding: 10px 0; margin: 20px auto; width: 100%; font-size:16px; text-align: center;">
        <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
            <span>打赏</span></button>
        <div id="QR" style="display: none;">
            <div id="wechat" style="display: inline-block">
                <a class="fancybox" rel="group">
                    <img id="wechat_qr" src="/img/Wechat.jpeg" alt="WeChat Pay"></a>
                <p>微信打赏</p>
            </div>
            <div id="alipay" style="display: inline-block">
                <a class="fancybox" rel="group">
                    <img id="alipay_qr" src="/img/Alipay.jpeg" alt="Alipay"></a>
                <p>支付宝打赏</p>
            </div>
        </div>
    </div>
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>The article was updated on 2020-02-20</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><span><a href="//twitter.com/share?url=https%3a%2f%2fbugsuse.github.io%2f2020%2f02%2fgee_tropomi%2f&amp;text=%e5%88%a9%e7%94%a8TROPOMI%e7%9c%8b%e7%9c%8b%e7%96%ab%e6%83%85%e6%9c%9f%e9%97%b4NO2%e6%8e%92%e6%94%be%e7%9a%84%e5%8f%98%e5%8c%96&amp;via=xxxx" target="_blank" title="Share on Twitter">
            <i class="fab fa-twitter fa-fw"></i>
        </a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fbugsuse.github.io%2f2020%2f02%2fgee_tropomi%2f" target="_blank" title="Share on Facebook">
            <i class="fab fa-facebook-square fa-fw"></i>
        </a><a href="//reddit.com/submit?url=https%3a%2f%2fbugsuse.github.io%2f2020%2f02%2fgee_tropomi%2f&amp;title=%e5%88%a9%e7%94%a8TROPOMI%e7%9c%8b%e7%9c%8b%e7%96%ab%e6%83%85%e6%9c%9f%e9%97%b4NO2%e6%8e%92%e6%94%be%e7%9a%84%e5%8f%98%e5%8c%96" target="_blank" title="Share on Reddit">
            <i class="fab fa-reddit fa-fw"></i>
        </a><a href="//service.weibo.com/share/share.php?url=https%3a%2f%2fbugsuse.github.io%2f2020%2f02%2fgee_tropomi%2f&amp;appkey=&amp;title=%e5%88%a9%e7%94%a8TROPOMI%e7%9c%8b%e7%9c%8b%e7%96%ab%e6%83%85%e6%9c%9f%e9%97%b4NO2%e6%8e%92%e6%94%be%e7%9a%84%e5%8f%98%e5%8c%96&amp;pic=%2fimg%2f2020%2f02%2f20%2f20200215.png" target="_blank" title="Share on Weibo">
            <i class="fab fa-weibo fa-fw"></i>
        </a></span></div>
        </div>
    </div>

    <div class="post-info-more">
        <section><span class="tag">
                        <a href="https://bugsuse.github.io/tags/tropomi/"><i class="fas fa-tag fa-fw"></i>&nbsp;tropomi</a>&nbsp;
                    </span><span class="tag">
                        <a href="https://bugsuse.github.io/tags/python/"><i class="fas fa-tag fa-fw"></i>&nbsp;python</a>&nbsp;
                    </span><span class="tag">
                        <a href="https://bugsuse.github.io/tags/gee/"><i class="fas fa-tag fa-fw"></i>&nbsp;gee</a>&nbsp;
                    </span></section>
        <section>
            <span><a href="javascript:window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="https://bugsuse.github.io">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="https://bugsuse.github.io/2020/02/pycharm_vnc_ssh_break_network_limit/" class="prev" rel="prev" title="Pycharm&#43;VNC&#43;SSH内网穿透"><i class="fas fa-angle-left fa-fw"></i>Pycharm&#43;VNC&#43;SSH内网穿透</a>
            <a href="https://bugsuse.github.io/2020/02/dive_inot_dl_pytorch_ch3/" class="next" rel="next" title="动手学深度学习Ch3:深度学习基础">动手学深度学习Ch3:深度学习基础<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div class="post-comment"></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2016 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://bugsuse.github.io" target="_blank">bugsuse</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer></div><a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll>
            <span>&nbsp;</span>
        </a><script src="/js/lib/jquery/jquery.slim.min.js"></script><script src="/js/lib/lazysizes/lazysizes.min.js"></script><script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script><link rel="stylesheet" href="/css/lib/katex/katex.min.css"><script src="/js/lib/katex/katex.min.js"></script><script defer src="/js/lib/katex/auto-render.min.js"></script><link rel="stylesheet" href="/css/lib/katex/copy-tex.min.css"><script defer src="/js/lib/katex/copy-tex.min.js"></script><script defer src="/js/lib/katex/mhchem.min.js"></script><script>
        document.addEventListener("DOMContentLoaded", function () {
            renderMathInElement(document.body, {
                delimiters: [
                    { left: "$$", right: "$$", display: true },
                    { left: "\\(", right: "\\)", display: false },
                    { left: "\\[", right: "\\]", display: true },{ left: "$", right: "$", display: false },]
            });
        });
    </script><script src="/js/blog.min.js"></script></body>
</html>