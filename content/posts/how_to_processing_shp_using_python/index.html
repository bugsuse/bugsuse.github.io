<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>如何使用Python处理shp文件 | bugsuse</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="About LoveIt Theme"><link rel="prev" href="https://bugsuse.github.io/content/posts/transform_files_using_iterm2_lrzsz_on_mac/" /><link rel="next" href="https://bugsuse.github.io/content/posts/how_to_download_gfs_using_multiprocessing/" /><link rel="canonical" href="https://bugsuse.github.io/content/posts/how_to_processing_shp_using_python/" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/img/site.webmanifest">
<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><meta property="og:title" content="如何使用Python处理shp文件" />
<meta property="og:description" content="涉及到空间数据处理的时候，为了比较清晰方便的看出空间数据所处的区域，通常都需要将省市边界线加到地图中。 Python中也提供了大量的shp文件" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bugsuse.github.io/content/posts/how_to_processing_shp_using_python/" />
<meta property="article:published_time" content="2019-02-01T13:46:36+08:00" />
<meta property="article:modified_time" content="2019-02-01T13:46:36+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="如何使用Python处理shp文件"/>
<meta name="twitter:description" content="涉及到空间数据处理的时候，为了比较清晰方便的看出空间数据所处的区域，通常都需要将省市边界线加到地图中。 Python中也提供了大量的shp文件"/>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "如何使用Python处理shp文件",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/bugsuse.github.io\/content\/posts\/how_to_processing_shp_using_python\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/bugsuse.github.io\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "content","keywords": "python, pyshp, fiona, geopandas","wordcount":  1339 ,
        "url": "https:\/\/bugsuse.github.io\/content\/posts\/how_to_processing_shp_using_python\/","datePublished": "2019-02-01T13:46:36\x2b08:00","dateModified": "2019-02-01T13:46:36\x2b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "bugsuse",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/bugsuse.github.io\/img\/res.png",
                "width":  127 ,
                "height":  40 
                }
            },"description": ""
    }
    </script><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/css/lib/animate/animate.min.css"></head>
    <body><script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="https://bugsuse.github.io">bugsuse</a>
        </div>
        <div class="navbar-menu"><a class="menu-item" href="https://bugsuse.github.io/posts" title="">Posts</a><a class="menu-item" href="https://bugsuse.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://bugsuse.github.io/model" title="">Model</a><a class="menu-item" href="https://bugsuse.github.io/tools" title="">Tools</a><a class="menu-item" href="https://bugsuse.github.io/tags" title="">Tags</a><a class="menu-item" href="https://bugsuse.github.io/categories" title="">Categories</a><a class="menu-item" href="https://bugsuse.github.io/friends" title="">Friends</a><a class="menu-item" href="https://bugsuse.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav><nav class="navbar-mobile">
    <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="https://bugsuse.github.io">bugsuse</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu"><a class="menu-item" href="https://bugsuse.github.io/posts" title="">Posts</a><a class="menu-item" href="https://bugsuse.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://bugsuse.github.io/model" title="">Model</a><a class="menu-item" href="https://bugsuse.github.io/tools" title="">Tools</a><a class="menu-item" href="https://bugsuse.github.io/tags" title="">Tags</a><a class="menu-item" href="https://bugsuse.github.io/categories" title="">Categories</a><a class="menu-item" href="https://bugsuse.github.io/friends" title="">Friends</a><a class="menu-item" href="https://bugsuse.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav>
<main class="main">
                <div class="container"><div class="page single"><h1 class="post-title animated pulse faster">如何使用Python处理shp文件</h1><div class="post-content"><p>涉及到空间数据处理的时候，为了比较清晰方便的看出空间数据所处的区域，通常都需要将省市边界线加到地图中。</p>
<p>Python中也提供了大量的shp文件处理方法，有底层的一些库，也有一些封装比较完整的库。比如：</p>
<ul>
<li><a href="https://github.com/Toblerity/Fiona" target="_blank">fiona</a>：基于ogr的封装，提供了更简洁的API</li>
<li><a href="https://github.com/GeospatialPython/pyshp" target="_blank">pyshp</a>：纯python实现的shape文件处理库，支持shp，shx和dbf文件的读写</li>
<li><code>ogr</code> ：gdal中的用于处理边界文件的模块</li>
<li><a href="https://github.com/geopandas/geopandas" target="_blank">geopandas</a>：基于 <code>fiona</code> 进行了封装</li>
</ul>
<a class="post-dummy-target" id="fiona"></a><h2>fiona</h2>
<a class="post-dummy-target" id="安装"></a><h3>安装</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">pip install fiona
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="读取shp文件"></a><h3>读取shp文件</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">fiona</span>

<span class="n">shps</span> <span class="o">=</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CHN_adm2.shp</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="获取shp文件中属性信息"></a><h4>获取shp文件中属性信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">schema</span> 

<span class="p">{</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">properties</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="p">[</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">int:10</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ISO</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:3</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:75</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">int:10</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:75</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">int:10</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:75</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">HASC_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:15</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CCN_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">int:10</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CCA_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:254</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">TYPE_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:50</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ENGTYPE_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:50</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NL_NAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:75</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">,</span>
              <span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">VARNAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">str:150</span><span class="s1">&#39;</span><span class="p">)</span><span class="p">]</span><span class="p">)</span><span class="p">,</span>
 <span class="sa"></span><span class="s1">&#39;</span><span class="s1">geometry</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">Polygon</span><span class="s1">&#39;</span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="获取shp文件编码"></a><h4>获取shp文件编码</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">encoding</span>

<span class="sa"></span><span class="s1">&#39;</span><span class="s1">utf-8</span><span class="s1">&#39;</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="获取shp文件投影信息"></a><h4>获取shp文件投影信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">crs</span>

<span class="p">{</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">init</span><span class="s1">&#39;</span><span class="p">:</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">epsg:4326</span><span class="s1">&#39;</span><span class="p">}</span>

<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">crs_kwt</span>

<span class="sa"></span><span class="s1">&#39;</span><span class="s1">GEOGCS[</span><span class="s1">&#34;</span><span class="s1">GCS_WGS_1984</span><span class="s1">&#34;</span><span class="s1">,DATUM[</span><span class="s1">&#34;</span><span class="s1">WGS_1984</span><span class="s1">&#34;</span><span class="s1">,SPHEROID[</span><span class="s1">&#34;</span><span class="s1">WGS_84</span><span class="s1">&#34;</span><span class="s1">,6378137.0,298.257223563]],PRIMEM[</span><span class="s1">&#34;</span><span class="s1">Greenwich</span><span class="s1">&#34;</span><span class="s1">,0.0],UNIT[</span><span class="s1">&#34;</span><span class="s1">Degree</span><span class="s1">&#34;</span><span class="s1">,0.0174532925199433],AUTHORITY[</span><span class="s1">&#34;</span><span class="s1">EPSG</span><span class="s1">&#34;</span><span class="s1">,</span><span class="s1">&#34;</span><span class="s1">4326</span><span class="s1">&#34;</span><span class="s1">]]</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="获取shape子文件"></a><h4>获取shape子文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">shps</span><span class="p">)</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="查看shape子文件信息"></a><h4>查看shape子文件信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="p">)</span>

<span class="n">dict_keys</span><span class="p">(</span><span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">type</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">id</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">geometry</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">properties</span><span class="s1">&#39;</span><span class="p">]</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><code>type</code>：表示shape子文件的类型</p>
<p><code>id</code>：shape子文件的序号</p>
<p><code>geometry</code>：包含shape子文件的类型和经纬度信息(字典类型)，包含了 <code>type</code> 和 <code>coordinates</code> 两个关键词</p>
<p><code>properties</code>：shape子文件的属性信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">type</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">id</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">geometry</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>shps 变量包含了一些方法可以获取shape文件中的每个边界，比如 <code>.next</code>，<code>.iterms</code>等。</p>
<p><code>.next</code> 方法将在 fiona 2.0版本中移除，可改用 next(iter(shps))进行单个迭代，或者使用 shps.iterms 进行循环迭代。</p>
<p>fiona中提供了shp文件的读取方法，但是并没有提供可视化方法，如果使用fiona处理，还需要单独进行画图的操作。</p>
<a class="post-dummy-target" id="写shp文件"></a><h3>写shp文件</h3>
<p>构建shp文件的操作很少使用，但有时候可能需要从已有的shp文件中提取一个子区域。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">subshp</span> <span class="o">=</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">subshp.shp</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">w</span><span class="s1">&#39;</span><span class="p">,</span> 
                    <span class="n">crs</span><span class="o">=</span><span class="n">shps</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">crs_wkt</span><span class="o">=</span><span class="n">shps</span><span class="o">.</span><span class="n">crs_wkt</span><span class="p">,</span> 
                    <span class="n">driver</span><span class="o">=</span><span class="n">shps</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> 
                    <span class="n">encoding</span><span class="o">=</span><span class="n">shps</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> 
                    <span class="n">schema</span><span class="o">=</span><span class="n">shps</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>fiona默认的方式是读，只需要改为写，然后提供源文件中的一些信息即可。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">shps</span><span class="p">)</span><span class="p">)</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">subshp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>  <span class="c1">## 写入字段</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">subshp</span><span class="o">.</span><span class="n">flush</span><span class="p">(</span><span class="p">)</span>  <span class="c1">## 更新文件</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">subshp</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="p">)</span>  <span class="c1">## 关闭文件</span>
</code></pre></td></tr></table>
</div>
</div><p>上述方法只是从源文件中随意选择了一个子区域，可以根据需要选择特定的区域，然后写入文件即可。</p>
<p>⚠️：不要忘记更新文件。</p>
<a class="post-dummy-target" id="pyshp"></a><h2>pyshp</h2>
<a class="post-dummy-target" id="安装-1"></a><h3>安装</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pip</span> <span class="n">install</span> <span class="n">pyshp</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="文件读取"></a><h3>文件读取</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">shapefile</span>

<span class="n">shps</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CHN_adm2.shp</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>读取后返回的 <code>shps</code> 中也包含了很多方法，其中 <code>.fields</code> 包含了shape文件中的一些字段信息，类似 fiona 中的 <code>.schema</code> 方法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">fields</span>

<span class="p">[</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">DeletionFlag</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">N</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ISO</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">N</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_1</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ID_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">N</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">HASC_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CCN_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">N</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CCA_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">254</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">TYPE_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">ENGTYPE_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">NL_NAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">,</span>
 <span class="p">[</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">VARNAME_2</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa"></span><span class="s1">&#39;</span><span class="s1">C</span><span class="s1">&#39;</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shps</span><span class="o">.</span><span class="n">numRecords</span>  <span class="c1"># shape文件中包含了多少个记录数，即子文件数</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="读取shape子文件"></a><h4>读取shape子文件</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span> <span class="o">=</span> <span class="n">shps</span><span class="o">.</span><span class="n">shapeRecord</span><span class="p">(</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="获取子文件属性信息"></a><h4>获取子文件属性信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">record</span>  <span class="c1"># 返回列表</span>

<span class="p">[</span><span class="mi">49</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">CHN</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">China</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="mi">1</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">Anhui</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="mi">1</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">Anqing</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="mi">0</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">Dìjíshì</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">Prefecture City</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">安庆市</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="sa"></span><span class="s1">&#39;</span><span class="s1">Ānqìng</span><span class="s1">&#39;</span><span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>类似 fiona 中获取shape子文件的属性信息，但fiona返回为字典。</p>
<a class="post-dummy-target" id="获取子文件坐标信息"></a><h4>获取子文件坐标信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">points</span> <span class="c1"># 包含了经纬度坐标</span>
<span class="o">&gt;&gt;</span><span class="o">&gt;</span> <span class="n">shp</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">bbox</span>  <span class="c1"># shape子文件范围</span>
</code></pre></td></tr></table>
</div>
</div><p>上述两个库，均可以进行shape文件的读写操作，但并没有提供可视化的方法。如果想看图的时候可以使用ArcGIS或者QGIS，导入文件即可。或者使用geopandas进行处理，geopandas提供了shape文件的处理和可视化，具有更为简便的API。</p>
<a class="post-dummy-target" id="geopandas"></a><h2>geopandas</h2>
<a class="post-dummy-target" id="安装-2"></a><h3>安装</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">pip</span> <span class="n">install</span> <span class="n">geopandas</span>
</code></pre></td></tr></table>
</div>
</div><a class="post-dummy-target" id="文件处理和可视化"></a><h3>文件处理和可视化</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">geopandas</span>

<span class="n">shps</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="sa"></span><span class="s1">&#39;</span><span class="s1">CHN_adm1.shp</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">shps</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="https://ws1.sinaimg.cn/large/006tNc79ly1fzqwda3btnj30hs0dc752.jpg" alt="" class="lazyload"></figure></p>
<p>包括库导入也只需要3行代码即可。</p>
<a class="post-dummy-target" id="参考链接"></a><h2>参考链接：</h2>
<ol>
<li><a href="https://gis.stackexchange.com/questions/113799/how-to-read-a-shapefile-in-python">https://gis.stackexchange.com/questions/113799/how-to-read-a-shapefile-in-python</a></li>
<li><a href="https://gis.stackexchange.com/questions/131716/plot-shapefile-with-matplotlib">https://gis.stackexchange.com/questions/131716/plot-shapefile-with-matplotlib</a></li>
<li><a href="https://gis.stackexchange.com/questions/97545/using-fiona-to-write-a-new-shapefile-from-scratch/97563">https://gis.stackexchange.com/questions/97545/using-fiona-to-write-a-new-shapefile-from-scratch/97563</a></li>
</ol>
</div>
    </div></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2016 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://bugsuse.github.io" target="_blank">bugsuse</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer></div><a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll>
            <span>&nbsp;</span>
        </a><script src="/js/lib/jquery/jquery.slim.min.js"></script><script src="/js/lib/lazysizes/lazysizes.min.js"></script><script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script><script src="/js/blog.min.js"></script></body>
</html>