<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>WRF模式高维数据可视化 | bugsuse</title><meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="noodp" />
<meta name="Description" content="About LoveIt Theme"><link rel="prev" href="https://atmosai.github.io/content/posts/python_shapely_set_operations/" /><link rel="next" href="https://atmosai.github.io/content/posts/nco_ncatted/" /><link rel="canonical" href="https://atmosai.github.io/content/posts/wrf_high_dimensional_data_visualization/" />
<link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/img/site.webmanifest">
<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff"><meta property="og:title" content="WRF模式高维数据可视化" />
<meta property="og:description" content="vis5d是专门开发用来进行5维数据可视化的工具，接触WRF模式看到的第一个高维可视化图就是由vis5d完成的。vis5d无法直接处理net" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://atmosai.github.io/content/posts/wrf_high_dimensional_data_visualization/" />
<meta property="article:published_time" content="2019-03-05T20:23:27+08:00" />
<meta property="article:modified_time" content="2019-03-05T20:23:27+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WRF模式高维数据可视化"/>
<meta name="twitter:description" content="vis5d是专门开发用来进行5维数据可视化的工具，接触WRF模式看到的第一个高维可视化图就是由vis5d完成的。vis5d无法直接处理net"/>
<script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "WRF模式高维数据可视化",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/atmosai.github.io\/content\/posts\/wrf_high_dimensional_data_visualization\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/atmosai.github.io\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "content","keywords": "WRF, vis5d","wordcount":  953 ,
        "url": "https:\/\/atmosai.github.io\/content\/posts\/wrf_high_dimensional_data_visualization\/","datePublished": "2019-03-05T20:23:27\x2b08:00","dateModified": "2019-03-05T20:23:27\x2b08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "bugsuse",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/atmosai.github.io\/img\/res.png",
                "width":  127 ,
                "height":  40 
                }
            },"description": ""
    }
    </script><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/css/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/css/lib/animate/animate.min.css"></head>
    <body><script>
            window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><nav class="navbar">
    <div class="navbar-container">
        <div class="navbar-header animated bounceIn">
            <a href="https://atmosai.github.io">bugsuse</a>
        </div>
        <div class="navbar-menu"><a class="menu-item" href="https://atmosai.github.io/posts" title="">Posts</a><a class="menu-item" href="https://atmosai.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://atmosai.github.io/model" title="">Model</a><a class="menu-item" href="https://atmosai.github.io/tools" title="">Tools</a><a class="menu-item" href="https://atmosai.github.io/tags" title="">Tags</a><a class="menu-item" href="https://atmosai.github.io/categories" title="">Categories</a><a class="menu-item" href="https://atmosai.github.io/friends" title="">Friends</a><a class="menu-item" href="https://atmosai.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav><nav class="navbar-mobile">
    <div class="navbar-container">
        <div class="navbar-header">
            <div class="navbar-header-title animated bounceIn">
                <a href="https://atmosai.github.io">bugsuse</a>
            </div>
            <div class="menu-toggle" id="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="navbar-menu" id="mobile-menu"><a class="menu-item" href="https://atmosai.github.io/posts" title="">Posts</a><a class="menu-item" href="https://atmosai.github.io/atmos" title="">Atmos</a><a class="menu-item" href="https://atmosai.github.io/model" title="">Model</a><a class="menu-item" href="https://atmosai.github.io/tools" title="">Tools</a><a class="menu-item" href="https://atmosai.github.io/tags" title="">Tags</a><a class="menu-item" href="https://atmosai.github.io/categories" title="">Categories</a><a class="menu-item" href="https://atmosai.github.io/friends" title="">Friends</a><a class="menu-item" href="https://atmosai.github.io/about" title="">About</a><a href="javascript:void(0);" class="theme-switch"><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a>
        </div>
    </div>
</nav>
<main class="main">
                <div class="container"><div class="page single"><h1 class="post-title animated pulse faster">WRF模式高维数据可视化</h1><div class="post-content"><p>vis5d是专门开发用来进行5维数据可视化的工具，接触WRF模式看到的第一个高维可视化图就是由vis5d完成的。vis5d无法直接处理netcdf格式文件，需要借助第三方工具将nc文件处理成vis5d可以接受的格式，比如.v5d格式。</p>
<p>早些时候ARWPost可以将WRF模式结果处理成v5d的格式，但是后来更新将此功能删除了，这是因为出现了更好的高维数据可视化工具，这些在之前也都介绍过一些。除了ARWPost之外，我们还可以利用wrf2vis5d工具进行格式转换。</p>
<p>wrf2vis5d是专门进行WRF和vis5d格式转换的工具，其依赖于vis5d，在编译wrf2vis5d之前，要先安装vis5d。</p>
<a class="post-dummy-target" id="vis5d安装"></a><h3>vis5d安装</h3>
<p>从官网下载安装包，然后解压:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">tar -zxvf vis5d-5.1.tar.Z
</code></pre></td></tr></table>
</div>
</div><p>编译:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">make
</code></pre></td></tr></table>
</div>
</div><p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2019/03/15/vis5d1.png" alt="" class="lazyload"></figure></p>
<p>一般可以选择</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">make linux-opengl
</code></pre></td></tr></table>
</div>
</div><p>执行上述编译操作后，开始分块编译，根据错误提示，找到 <code>lui5</code> 文件夹，修改其中的 Makefile中对应的 <code>linux</code>部分编译选项。</p>
<p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2019/03/15/vis5d2.png" alt="" class="lazyload"></figure></p>
<p>可以更改<code>gcc</code>为<code>icc</code>，并删除<code>-m486</code>选项，然后继续编译，碰到类似问题继续更高相应的选项。或者批量修改。</p>
<p><strong>需要修改 <code>lui5</code>, <code>src</code>, <code>util</code>,<code>import</code>中的 Makefile，对应<code>linux</code>或者<code>linux-opengl</code>的编译选项。</strong></p>
<p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2019/03/15/vis5d5.png" alt="" class="lazyload"></figure></p>
<a class="post-dummy-target" id="wrf2vis5d安装"></a><h3>wrf2vis5d安装</h3>
<p>编译完成之后，就可以编译wrf2vis5d：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">tar -zxvf wrf2vis5d.tar.gz
<span class="nb">cd</span> WRF2VIS5D/
</code></pre></td></tr></table>
</div>
</div><p>修改Makefile中部分编译选项并拷贝/链接<code>netcdf.inc</code>到WRF2VIS5D路径下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">LIBNETCDF</span> <span class="o">=</span> -L/usr/local/netcdf/lib -lnetcdf -lm    <span class="c1"># netcdf lib路径</span>
<span class="nv">LIBVIS5D</span> <span class="o">=</span> /usr/local/vis5d/src/binio.o /usr/local/vis5d/src/v5d.o   <span class="c1"># vis5d库路径</span>
<span class="nv">INCLUDE</span> <span class="o">=</span> -I/usr/local/netcdf/include -I./   <span class="c1"># netcdf include路径</span>
<span class="nv">FC</span> <span class="o">=</span> f90   <span class="c1"># 编译器选项</span>
<span class="nv">FCFLAGS</span> <span class="o">=</span> -g -C -free
</code></pre></td></tr></table>
</div>
</div><p>然后执行编译选项:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">make
</code></pre></td></tr></table>
</div>
</div><p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2019/03/15/vis5d4.png" alt="" class="lazyload"></figure></p>
<p><code>wrf_v5d_input</code>为 <code>wrf_to_v5d</code>的参数控制文件，类似WRF模式的namelist文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">-1 ! number of <span class="nb">times</span> to put in vis5d file, negative means ignore the <span class="nb">times</span>
2000-01-24_18:00:00
U      ! variable list <span class="k">for</span> vis5d file,  indent one space to skip
V      ! first five in list are special variables <span class="o">(</span>diagnosed<span class="o">)</span>
W
 THETA
 TK
TC
QVAPOR
QCLOUD
 QRAIN
 RAINC
 TSK
end_of_variable_list
wrfout_d01_000000  ! data files to pull fields from
end_of_file_list
-1 ! specify v5d vertical grid  <span class="nv">0</span><span class="o">=</span>cartesian, -1<span class="o">=</span>interp to z from lowest h, &gt;1 list levels <span class="o">(</span>z<span class="o">)</span>  desired in vis5d file
<span class="m">1</span> 1.
<span class="m">2</span> 2.
<span class="m">3</span> 3.
<span class="m">4</span> 4.
<span class="m">5</span> 5.
<span class="m">6</span> 6.
<span class="m">7</span> 7.
<span class="m">8</span> 8.
<span class="m">9</span> 9.
<span class="m">10</span> 10.
</code></pre></td></tr></table>
</div>
</div><p><code>end_of_variable_list</code> 和 <code>end_of_file_list</code> 之间为需要处理的netcdf文件，可以是多个，顺序列出即可。不需要处理的变量可删除或者<strong>变量名前留空格</strong>。</p>
<p>执行以下命令进行格式转换</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">wrf_to_v5d wrf_v5d_input wrf.v5d
</code></pre></td></tr></table>
</div>
</div><p>然后就可以将wrf.v5d作为vis5d的输入，进行高维数据可视化处理了。下图是处理结果。</p>
<p><figure><img src="/svg/loading.min.svg" data-sizes="auto" data-src="/img/2019/03/15/v5d.gif" alt="" class="lazyload"></figure></p>
</div>
    </div></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2016 - 2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://atmosai.github.io" target="_blank">bugsuse</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
    </div>
</footer></div><a href="#" class="dynamic-to-top" id="dynamic-to-top" data-scroll>
            <span>&nbsp;</span>
        </a><script src="/js/lib/jquery/jquery.slim.min.js"></script><script src="/js/lib/lazysizes/lazysizes.min.js"></script><script src="/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script>window.scroll = new SmoothScroll('[data-scroll]', {speed: 300, speedAsDuration: true});</script><script src="/js/blog.min.js"></script></body>
</html>